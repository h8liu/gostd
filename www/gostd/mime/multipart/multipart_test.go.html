<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8010201">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8010256">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8010310">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8010361">package</span>&nbsp;<span class="ident" id="8010369">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8010380">import</span>&nbsp;<span class="op" id="8010387">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010390">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010399">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010416">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010423">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010429">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010442">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010459">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010465">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010476">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8010487">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8010497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8010500">func</span>&nbsp;<span class="ident" id="8010505">TestBoundaryLine</span><span class="op" id="8010521">(</span><span class="ident" id="8010522">t</span>&nbsp;<span class="op" id="8010524">*</span><span class="ident" id="8010525">testing</span><span class="op" id="8010532">.</span><span class="ident" id="8010533">T</span><span class="op" id="8010534">)</span>&nbsp;<span class="op" id="8010536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010539">mr</span>&nbsp;<span class="op" id="8010542">:=</span>&nbsp;<span class="ident" id="8010545">NewReader</span><span class="op" id="8010554">(</span><span class="ident" id="8010555">strings</span><span class="op" id="8010562">.</span><span class="ident" id="8010563">NewReader</span><span class="op" id="8010572">(</span><span class="string" id="8010573">&#34;&#34;</span><span class="op" id="8010575">)</span><span class="op" id="8010576">,</span>&nbsp;<span class="string" id="8010578">&#34;myBoundary&#34;</span><span class="op" id="8010590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8010593">if</span>&nbsp;<span class="op" id="8010596">!</span><span class="ident" id="8010597">mr</span><span class="op" id="8010599">.</span><span class="ident" id="8010600">isBoundaryDelimiterLine</span><span class="op" id="8010623">(</span><span class="op" id="8010624">[</span><span class="op" id="8010625">]</span><span class="builtintype" id="8010626">byte</span><span class="op" id="8010630">(</span><span class="string" id="8010631">&#34;--myBoundary\r\n&#34;</span><span class="op" id="8010649">)</span><span class="op" id="8010650">)</span>&nbsp;<span class="op" id="8010652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010656">t</span><span class="op" id="8010657">.</span><span class="ident" id="8010658">Error</span><span class="op" id="8010663">(</span><span class="string" id="8010664">&#34;expected&#34;</span><span class="op" id="8010674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8010677">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8010680">if</span>&nbsp;<span class="op" id="8010683">!</span><span class="ident" id="8010684">mr</span><span class="op" id="8010686">.</span><span class="ident" id="8010687">isBoundaryDelimiterLine</span><span class="op" id="8010710">(</span><span class="op" id="8010711">[</span><span class="op" id="8010712">]</span><span class="builtintype" id="8010713">byte</span><span class="op" id="8010717">(</span><span class="string" id="8010718">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="8010737">)</span><span class="op" id="8010738">)</span>&nbsp;<span class="op" id="8010740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010744">t</span><span class="op" id="8010745">.</span><span class="ident" id="8010746">Error</span><span class="op" id="8010751">(</span><span class="string" id="8010752">&#34;expected&#34;</span><span class="op" id="8010762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8010765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8010768">if</span>&nbsp;<span class="op" id="8010771">!</span><span class="ident" id="8010772">mr</span><span class="op" id="8010774">.</span><span class="ident" id="8010775">isBoundaryDelimiterLine</span><span class="op" id="8010798">(</span><span class="op" id="8010799">[</span><span class="op" id="8010800">]</span><span class="builtintype" id="8010801">byte</span><span class="op" id="8010805">(</span><span class="string" id="8010806">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="8010823">)</span><span class="op" id="8010824">)</span>&nbsp;<span class="op" id="8010826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010830">t</span><span class="op" id="8010831">.</span><span class="ident" id="8010832">Error</span><span class="op" id="8010837">(</span><span class="string" id="8010838">&#34;expected&#34;</span><span class="op" id="8010848">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8010851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8010854">if</span>&nbsp;<span class="ident" id="8010857">mr</span><span class="op" id="8010859">.</span><span class="ident" id="8010860">isBoundaryDelimiterLine</span><span class="op" id="8010883">(</span><span class="op" id="8010884">[</span><span class="op" id="8010885">]</span><span class="builtintype" id="8010886">byte</span><span class="op" id="8010890">(</span><span class="string" id="8010891">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="8010914">)</span><span class="op" id="8010915">)</span>&nbsp;<span class="op" id="8010917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8010921">t</span><span class="op" id="8010922">.</span><span class="ident" id="8010923">Error</span><span class="op" id="8010928">(</span><span class="string" id="8010929">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8010944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8010947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8010950">if</span>&nbsp;<span class="ident" id="8010953">mr</span><span class="op" id="8010955">.</span><span class="ident" id="8010956">isBoundaryDelimiterLine</span><span class="op" id="8010979">(</span><span class="op" id="8010980">[</span><span class="op" id="8010981">]</span><span class="builtintype" id="8010982">byte</span><span class="op" id="8010986">(</span><span class="string" id="8010987">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="8011009">)</span><span class="op" id="8011010">)</span>&nbsp;<span class="op" id="8011012">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011016">t</span><span class="op" id="8011017">.</span><span class="ident" id="8011018">Error</span><span class="op" id="8011023">(</span><span class="string" id="8011024">&#34;expected&nbsp;fail&#34;</span><span class="op" id="8011039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011042">}</span><br>
<span class="lineno"></span><span class="op" id="8011044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8011047">func</span>&nbsp;<span class="ident" id="8011052">escapeString</span><span class="op" id="8011064">(</span><span class="ident" id="8011065">v</span>&nbsp;<span class="builtintype" id="8011067">string</span><span class="op" id="8011073">)</span>&nbsp;<span class="builtintype" id="8011075">string</span>&nbsp;<span class="op" id="8011082">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011085">bytes</span><span class="op" id="8011090">,</span>&nbsp;<span class="ident" id="8011092">_</span>&nbsp;<span class="op" id="8011094">:=</span>&nbsp;<span class="ident" id="8011097">json</span><span class="op" id="8011101">.</span><span class="ident" id="8011102">Marshal</span><span class="op" id="8011109">(</span><span class="ident" id="8011110">v</span><span class="op" id="8011111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8011114">return</span>&nbsp;<span class="builtintype" id="8011121">string</span><span class="op" id="8011127">(</span><span class="ident" id="8011128">bytes</span><span class="op" id="8011133">)</span><br>
<span class="lineno"></span><span class="op" id="8011135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8011138">func</span>&nbsp;<span class="ident" id="8011143">expectEq</span><span class="op" id="8011151">(</span><span class="ident" id="8011152">t</span>&nbsp;<span class="op" id="8011154">*</span><span class="ident" id="8011155">testing</span><span class="op" id="8011162">.</span><span class="ident" id="8011163">T</span><span class="op" id="8011164">,</span>&nbsp;<span class="ident" id="8011166">expected</span><span class="op" id="8011174">,</span>&nbsp;<span class="ident" id="8011176">actual</span><span class="op" id="8011182">,</span>&nbsp;<span class="ident" id="8011184">what</span>&nbsp;<span class="builtintype" id="8011189">string</span><span class="op" id="8011195">)</span>&nbsp;<span class="op" id="8011197">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8011200">if</span>&nbsp;<span class="ident" id="8011203">expected</span>&nbsp;<span class="op" id="8011212">==</span>&nbsp;<span class="ident" id="8011215">actual</span>&nbsp;<span class="op" id="8011222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8011226">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011237">t</span><span class="op" id="8011238">.</span><span class="ident" id="8011239">Errorf</span><span class="op" id="8011245">(</span><span class="string" id="8011246">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="8011314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011318">what</span><span class="op" id="8011322">,</span>&nbsp;<span class="ident" id="8011324">escapeString</span><span class="op" id="8011336">(</span><span class="ident" id="8011337">actual</span><span class="op" id="8011343">)</span><span class="op" id="8011344">,</span>&nbsp;<span class="builtinfunc" id="8011346">len</span><span class="op" id="8011349">(</span><span class="ident" id="8011350">actual</span><span class="op" id="8011356">)</span><span class="op" id="8011357">,</span>&nbsp;<span class="ident" id="8011359">escapeString</span><span class="op" id="8011371">(</span><span class="ident" id="8011372">expected</span><span class="op" id="8011380">)</span><span class="op" id="8011381">,</span>&nbsp;<span class="builtinfunc" id="8011383">len</span><span class="op" id="8011386">(</span><span class="ident" id="8011387">expected</span><span class="op" id="8011395">)</span><span class="op" id="8011396">)</span><br>
<span class="lineno">50</span><span class="op" id="8011398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8011401">func</span>&nbsp;<span class="ident" id="8011406">TestNameAccessors</span><span class="op" id="8011423">(</span><span class="ident" id="8011424">t</span>&nbsp;<span class="op" id="8011426">*</span><span class="ident" id="8011427">testing</span><span class="op" id="8011434">.</span><span class="ident" id="8011435">T</span><span class="op" id="8011436">)</span>&nbsp;<span class="op" id="8011438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011441">tests</span>&nbsp;<span class="op" id="8011447">:=</span>&nbsp;<span class="op" id="8011450">[</span><span class="op" id="8011451">...</span><span class="op" id="8011454">]</span><span class="op" id="8011455">[</span><span class="num" id="8011456">3</span><span class="op" id="8011457">]</span><span class="builtintype" id="8011458">string</span><span class="op" id="8011464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011468">{</span><span class="string" id="8011469">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8011492">,</span>&nbsp;<span class="string" id="8011494">&#34;foo&#34;</span><span class="op" id="8011499">,</span>&nbsp;<span class="string" id="8011501">&#34;&#34;</span><span class="op" id="8011503">}</span><span class="op" id="8011504">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011508">{</span><span class="string" id="8011509">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="8011532">,</span>&nbsp;<span class="string" id="8011534">&#34;foo&#34;</span><span class="op" id="8011539">,</span>&nbsp;<span class="string" id="8011541">&#34;&#34;</span><span class="op" id="8011543">}</span><span class="op" id="8011544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011548">{</span><span class="string" id="8011549">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="8011571">,</span>&nbsp;<span class="string" id="8011573">&#34;foo&#34;</span><span class="op" id="8011578">,</span>&nbsp;<span class="string" id="8011580">&#34;&#34;</span><span class="op" id="8011582">}</span><span class="op" id="8011583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011587">{</span><span class="string" id="8011588">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8011613">,</span>&nbsp;<span class="string" id="8011615">&#34;foo&#34;</span><span class="op" id="8011620">,</span>&nbsp;<span class="string" id="8011622">&#34;&#34;</span><span class="op" id="8011624">}</span><span class="op" id="8011625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011629">{</span><span class="string" id="8011630">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="8011655">,</span>&nbsp;<span class="string" id="8011657">&#34;foo&#34;</span><span class="op" id="8011662">,</span>&nbsp;<span class="string" id="8011664">&#34;&#34;</span><span class="op" id="8011666">}</span><span class="op" id="8011667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011671">{</span><span class="string" id="8011672">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="8011695">,</span>&nbsp;<span class="string" id="8011697">&#34;foo&#34;</span><span class="op" id="8011702">,</span>&nbsp;<span class="string" id="8011704">&#34;&#34;</span><span class="op" id="8011706">}</span><span class="op" id="8011707">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011711">{</span><span class="string" id="8011712">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8011765">,</span>&nbsp;<span class="string" id="8011767">&#34;foo&#34;</span><span class="op" id="8011772">,</span>&nbsp;<span class="string" id="8011774">&#34;foo.txt&#34;</span><span class="op" id="8011783">}</span><span class="op" id="8011784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011788">{</span><span class="string" id="8011789">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="8011846">,</span>&nbsp;<span class="string" id="8011848">&#34;&#34;</span><span class="op" id="8011850">,</span>&nbsp;<span class="string" id="8011852">&#34;bar.txt&#34;</span><span class="op" id="8011861">}</span><span class="op" id="8011862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8011865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8011868">for</span>&nbsp;<span class="ident" id="8011872">i</span><span class="op" id="8011873">,</span>&nbsp;<span class="ident" id="8011875">test</span>&nbsp;<span class="op" id="8011880">:=</span>&nbsp;<span class="keyword" id="8011883">range</span>&nbsp;<span class="ident" id="8011889">tests</span>&nbsp;<span class="op" id="8011895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011899">p</span>&nbsp;<span class="op" id="8011901">:=</span>&nbsp;<span class="op" id="8011904">&amp;</span><span class="ident" id="8011905">Part</span><span class="op" id="8011909">{</span><span class="ident" id="8011910">Header</span><span class="op" id="8011916">:</span>&nbsp;<span class="builtinfunc" id="8011918">make</span><span class="op" id="8011922">(</span><span class="keyword" id="8011923">map</span><span class="op" id="8011926">[</span><span class="builtintype" id="8011927">string</span><span class="op" id="8011933">]</span><span class="op" id="8011934">[</span><span class="op" id="8011935">]</span><span class="builtintype" id="8011936">string</span><span class="op" id="8011942">)</span><span class="op" id="8011943">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8011947">p</span><span class="op" id="8011948">.</span><span class="ident" id="8011949">Header</span><span class="op" id="8011955">.</span><span class="ident" id="8011956">Set</span><span class="op" id="8011959">(</span><span class="string" id="8011960">&#34;Content-Disposition&#34;</span><span class="op" id="8011981">,</span>&nbsp;<span class="ident" id="8011983">test</span><span class="op" id="8011987">[</span><span class="num" id="8011988">0</span><span class="op" id="8011989">]</span><span class="op" id="8011990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8011994">if</span>&nbsp;<span class="ident" id="8011997">g</span><span class="op" id="8011998">,</span>&nbsp;<span class="ident" id="8012000">e</span>&nbsp;<span class="op" id="8012002">:=</span>&nbsp;<span class="ident" id="8012005">p</span><span class="op" id="8012006">.</span><span class="ident" id="8012007">FormName</span><span class="op" id="8012015">(</span><span class="op" id="8012016">)</span><span class="op" id="8012017">,</span>&nbsp;<span class="ident" id="8012019">test</span><span class="op" id="8012023">[</span><span class="num" id="8012024">1</span><span class="op" id="8012025">]</span><span class="op" id="8012026">;</span>&nbsp;<span class="ident" id="8012028">g</span>&nbsp;<span class="op" id="8012030">!=</span>&nbsp;<span class="ident" id="8012033">e</span>&nbsp;<span class="op" id="8012035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012040">t</span><span class="op" id="8012041">.</span><span class="ident" id="8012042">Errorf</span><span class="op" id="8012048">(</span><span class="string" id="8012049">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8012084">,</span>&nbsp;<span class="ident" id="8012086">i</span><span class="op" id="8012087">,</span>&nbsp;<span class="ident" id="8012089">g</span><span class="op" id="8012090">,</span>&nbsp;<span class="ident" id="8012092">e</span><span class="op" id="8012093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8012097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8012101">if</span>&nbsp;<span class="ident" id="8012104">g</span><span class="op" id="8012105">,</span>&nbsp;<span class="ident" id="8012107">e</span>&nbsp;<span class="op" id="8012109">:=</span>&nbsp;<span class="ident" id="8012112">p</span><span class="op" id="8012113">.</span><span class="ident" id="8012114">FileName</span><span class="op" id="8012122">(</span><span class="op" id="8012123">)</span><span class="op" id="8012124">,</span>&nbsp;<span class="ident" id="8012126">test</span><span class="op" id="8012130">[</span><span class="num" id="8012131">2</span><span class="op" id="8012132">]</span><span class="op" id="8012133">;</span>&nbsp;<span class="ident" id="8012135">g</span>&nbsp;<span class="op" id="8012137">!=</span>&nbsp;<span class="ident" id="8012140">e</span>&nbsp;<span class="op" id="8012142">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012147">t</span><span class="op" id="8012148">.</span><span class="ident" id="8012149">Errorf</span><span class="op" id="8012155">(</span><span class="string" id="8012156">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8012191">,</span>&nbsp;<span class="ident" id="8012193">i</span><span class="op" id="8012194">,</span>&nbsp;<span class="ident" id="8012196">g</span><span class="op" id="8012197">,</span>&nbsp;<span class="ident" id="8012199">e</span><span class="op" id="8012200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8012204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8012207">}</span><br>
<span class="lineno"></span><span class="op" id="8012209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8012212">var</span>&nbsp;<span class="ident" id="8012216">longLine</span>&nbsp;<span class="op" id="8012225">=</span>&nbsp;<span class="ident" id="8012227">strings</span><span class="op" id="8012234">.</span><span class="ident" id="8012235">Repeat</span><span class="op" id="8012241">(</span><span class="string" id="8012242">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="8012262">,</span>&nbsp;<span class="op" id="8012264">(</span><span class="num" id="8012265">1</span><span class="op" id="8012266">&lt;&lt;</span><span class="num" id="8012268">20</span><span class="op" id="8012270">)</span><span class="op" id="8012271">/</span><span class="num" id="8012272">8</span><span class="op" id="8012273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8012276">func</span>&nbsp;<span class="ident" id="8012281">testMultipartBody</span><span class="op" id="8012298">(</span><span class="ident" id="8012299">sep</span>&nbsp;<span class="builtintype" id="8012303">string</span><span class="op" id="8012309">)</span>&nbsp;<span class="builtintype" id="8012311">string</span>&nbsp;<span class="op" id="8012318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012321">testBody</span>&nbsp;<span class="op" id="8012330">:=</span>&nbsp;<span class="string" id="8012333">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012690">testBody</span>&nbsp;<span class="op" id="8012699">=</span>&nbsp;<span class="ident" id="8012701">strings</span><span class="op" id="8012708">.</span><span class="ident" id="8012709">Replace</span><span class="op" id="8012716">(</span><span class="ident" id="8012717">testBody</span><span class="op" id="8012725">,</span>&nbsp;<span class="string" id="8012727">&#34;\n&#34;</span><span class="op" id="8012731">,</span>&nbsp;<span class="ident" id="8012733">sep</span><span class="op" id="8012736">,</span>&nbsp;<span class="op" id="8012738">-</span><span class="num" id="8012739">1</span><span class="op" id="8012740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8012743">return</span>&nbsp;<span class="ident" id="8012750">strings</span><span class="op" id="8012757">.</span><span class="ident" id="8012758">Replace</span><span class="op" id="8012765">(</span><span class="ident" id="8012766">testBody</span><span class="op" id="8012774">,</span>&nbsp;<span class="string" id="8012776">&#34;[longline]&#34;</span><span class="op" id="8012788">,</span>&nbsp;<span class="ident" id="8012790">longLine</span><span class="op" id="8012798">,</span>&nbsp;<span class="num" id="8012800">1</span><span class="op" id="8012801">)</span><br>
<span class="lineno">110</span><span class="op" id="8012803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8012806">func</span>&nbsp;<span class="ident" id="8012811">TestMultipart</span><span class="op" id="8012824">(</span><span class="ident" id="8012825">t</span>&nbsp;<span class="op" id="8012827">*</span><span class="ident" id="8012828">testing</span><span class="op" id="8012835">.</span><span class="ident" id="8012836">T</span><span class="op" id="8012837">)</span>&nbsp;<span class="op" id="8012839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012842">bodyReader</span>&nbsp;<span class="op" id="8012853">:=</span>&nbsp;<span class="ident" id="8012856">strings</span><span class="op" id="8012863">.</span><span class="ident" id="8012864">NewReader</span><span class="op" id="8012873">(</span><span class="ident" id="8012874">testMultipartBody</span><span class="op" id="8012891">(</span><span class="string" id="8012892">&#34;\r\n&#34;</span><span class="op" id="8012898">)</span><span class="op" id="8012899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012902">testMultipart</span><span class="op" id="8012915">(</span><span class="ident" id="8012916">t</span><span class="op" id="8012917">,</span>&nbsp;<span class="ident" id="8012919">bodyReader</span><span class="op" id="8012929">,</span>&nbsp;<span class="builtintype" id="8012931">false</span><span class="op" id="8012936">)</span><br>
<span class="lineno">115</span><span class="op" id="8012938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8012941">func</span>&nbsp;<span class="ident" id="8012946">TestMultipartOnlyNewlines</span><span class="op" id="8012971">(</span><span class="ident" id="8012972">t</span>&nbsp;<span class="op" id="8012974">*</span><span class="ident" id="8012975">testing</span><span class="op" id="8012982">.</span><span class="ident" id="8012983">T</span><span class="op" id="8012984">)</span>&nbsp;<span class="op" id="8012986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8012989">bodyReader</span>&nbsp;<span class="op" id="8013000">:=</span>&nbsp;<span class="ident" id="8013003">strings</span><span class="op" id="8013010">.</span><span class="ident" id="8013011">NewReader</span><span class="op" id="8013020">(</span><span class="ident" id="8013021">testMultipartBody</span><span class="op" id="8013038">(</span><span class="string" id="8013039">&#34;\n&#34;</span><span class="op" id="8013043">)</span><span class="op" id="8013044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013047">testMultipart</span><span class="op" id="8013060">(</span><span class="ident" id="8013061">t</span><span class="op" id="8013062">,</span>&nbsp;<span class="ident" id="8013064">bodyReader</span><span class="op" id="8013074">,</span>&nbsp;<span class="builtintype" id="8013076">true</span><span class="op" id="8013080">)</span><br>
<span class="lineno">120</span><span class="op" id="8013082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8013085">func</span>&nbsp;<span class="ident" id="8013090">TestMultipartSlowInput</span><span class="op" id="8013112">(</span><span class="ident" id="8013113">t</span>&nbsp;<span class="op" id="8013115">*</span><span class="ident" id="8013116">testing</span><span class="op" id="8013123">.</span><span class="ident" id="8013124">T</span><span class="op" id="8013125">)</span>&nbsp;<span class="op" id="8013127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013130">bodyReader</span>&nbsp;<span class="op" id="8013141">:=</span>&nbsp;<span class="ident" id="8013144">strings</span><span class="op" id="8013151">.</span><span class="ident" id="8013152">NewReader</span><span class="op" id="8013161">(</span><span class="ident" id="8013162">testMultipartBody</span><span class="op" id="8013179">(</span><span class="string" id="8013180">&#34;\r\n&#34;</span><span class="op" id="8013186">)</span><span class="op" id="8013187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013190">testMultipart</span><span class="op" id="8013203">(</span><span class="ident" id="8013204">t</span><span class="op" id="8013205">,</span>&nbsp;<span class="op" id="8013207">&amp;</span><span class="ident" id="8013208">slowReader</span><span class="op" id="8013218">{</span><span class="ident" id="8013219">bodyReader</span><span class="op" id="8013229">}</span><span class="op" id="8013230">,</span>&nbsp;<span class="builtintype" id="8013232">false</span><span class="op" id="8013237">)</span><br>
<span class="lineno">125</span><span class="op" id="8013239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8013242">func</span>&nbsp;<span class="ident" id="8013247">testMultipart</span><span class="op" id="8013260">(</span><span class="ident" id="8013261">t</span>&nbsp;<span class="op" id="8013263">*</span><span class="ident" id="8013264">testing</span><span class="op" id="8013271">.</span><span class="ident" id="8013272">T</span><span class="op" id="8013273">,</span>&nbsp;<span class="ident" id="8013275">r</span>&nbsp;<span class="ident" id="8013277">io</span><span class="op" id="8013279">.</span><span class="ident" id="8013280">Reader</span><span class="op" id="8013286">,</span>&nbsp;<span class="ident" id="8013288">onlyNewlines</span>&nbsp;<span class="builtintype" id="8013301">bool</span><span class="op" id="8013305">)</span>&nbsp;<span class="op" id="8013307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013310">reader</span>&nbsp;<span class="op" id="8013317">:=</span>&nbsp;<span class="ident" id="8013320">NewReader</span><span class="op" id="8013329">(</span><span class="ident" id="8013330">r</span><span class="op" id="8013331">,</span>&nbsp;<span class="string" id="8013333">&#34;MyBoundary&#34;</span><span class="op" id="8013345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013348">buf</span>&nbsp;<span class="op" id="8013352">:=</span>&nbsp;<span class="builtinfunc" id="8013355">new</span><span class="op" id="8013358">(</span><span class="ident" id="8013359">bytes</span><span class="op" id="8013364">.</span><span class="ident" id="8013365">Buffer</span><span class="op" id="8013371">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8013375">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013385">part</span><span class="op" id="8013389">,</span>&nbsp;<span class="ident" id="8013391">err</span>&nbsp;<span class="op" id="8013395">:=</span>&nbsp;<span class="ident" id="8013398">reader</span><span class="op" id="8013404">.</span><span class="ident" id="8013405">NextPart</span><span class="op" id="8013413">(</span><span class="op" id="8013414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013417">if</span>&nbsp;<span class="ident" id="8013420">part</span>&nbsp;<span class="op" id="8013425">==</span>&nbsp;<span class="builtintype" id="8013428">nil</span>&nbsp;<span class="op" id="8013432">||</span>&nbsp;<span class="ident" id="8013435">err</span>&nbsp;<span class="op" id="8013439">!=</span>&nbsp;<span class="builtintype" id="8013442">nil</span>&nbsp;<span class="op" id="8013446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013450">t</span><span class="op" id="8013451">.</span><span class="ident" id="8013452">Error</span><span class="op" id="8013457">(</span><span class="string" id="8013458">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="8013474">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013478">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013489">if</span>&nbsp;<span class="ident" id="8013492">x</span>&nbsp;<span class="op" id="8013494">:=</span>&nbsp;<span class="ident" id="8013497">part</span><span class="op" id="8013501">.</span><span class="ident" id="8013502">Header</span><span class="op" id="8013508">.</span><span class="ident" id="8013509">Get</span><span class="op" id="8013512">(</span><span class="string" id="8013513">&#34;Header1&#34;</span><span class="op" id="8013522">)</span><span class="op" id="8013523">;</span>&nbsp;<span class="ident" id="8013525">x</span>&nbsp;<span class="op" id="8013527">!=</span>&nbsp;<span class="string" id="8013530">&#34;value1&#34;</span>&nbsp;<span class="op" id="8013539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013543">t</span><span class="op" id="8013544">.</span><span class="ident" id="8013545">Errorf</span><span class="op" id="8013551">(</span><span class="string" id="8013552">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8013587">,</span>&nbsp;<span class="string" id="8013589">&#34;Header1&#34;</span><span class="op" id="8013598">,</span>&nbsp;<span class="ident" id="8013600">x</span><span class="op" id="8013601">,</span>&nbsp;<span class="string" id="8013603">&#34;value1&#34;</span><span class="op" id="8013611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013614">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013617">if</span>&nbsp;<span class="ident" id="8013620">x</span>&nbsp;<span class="op" id="8013622">:=</span>&nbsp;<span class="ident" id="8013625">part</span><span class="op" id="8013629">.</span><span class="ident" id="8013630">Header</span><span class="op" id="8013636">.</span><span class="ident" id="8013637">Get</span><span class="op" id="8013640">(</span><span class="string" id="8013641">&#34;foo-bar&#34;</span><span class="op" id="8013650">)</span><span class="op" id="8013651">;</span>&nbsp;<span class="ident" id="8013653">x</span>&nbsp;<span class="op" id="8013655">!=</span>&nbsp;<span class="string" id="8013658">&#34;baz&#34;</span>&nbsp;<span class="op" id="8013664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013668">t</span><span class="op" id="8013669">.</span><span class="ident" id="8013670">Errorf</span><span class="op" id="8013676">(</span><span class="string" id="8013677">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8013712">,</span>&nbsp;<span class="string" id="8013714">&#34;foo-bar&#34;</span><span class="op" id="8013723">,</span>&nbsp;<span class="ident" id="8013725">x</span><span class="op" id="8013726">,</span>&nbsp;<span class="string" id="8013728">&#34;baz&#34;</span><span class="op" id="8013733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013739">if</span>&nbsp;<span class="ident" id="8013742">x</span>&nbsp;<span class="op" id="8013744">:=</span>&nbsp;<span class="ident" id="8013747">part</span><span class="op" id="8013751">.</span><span class="ident" id="8013752">Header</span><span class="op" id="8013758">.</span><span class="ident" id="8013759">Get</span><span class="op" id="8013762">(</span><span class="string" id="8013763">&#34;Foo-Bar&#34;</span><span class="op" id="8013772">)</span><span class="op" id="8013773">;</span>&nbsp;<span class="ident" id="8013775">x</span>&nbsp;<span class="op" id="8013777">!=</span>&nbsp;<span class="string" id="8013780">&#34;baz&#34;</span>&nbsp;<span class="op" id="8013786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013790">t</span><span class="op" id="8013791">.</span><span class="ident" id="8013792">Errorf</span><span class="op" id="8013798">(</span><span class="string" id="8013799">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8013834">,</span>&nbsp;<span class="string" id="8013836">&#34;Foo-Bar&#34;</span><span class="op" id="8013845">,</span>&nbsp;<span class="ident" id="8013847">x</span><span class="op" id="8013848">,</span>&nbsp;<span class="string" id="8013850">&#34;baz&#34;</span><span class="op" id="8013855">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013861">buf</span><span class="op" id="8013864">.</span><span class="ident" id="8013865">Reset</span><span class="op" id="8013870">(</span><span class="op" id="8013871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8013874">if</span>&nbsp;<span class="ident" id="8013877">_</span><span class="op" id="8013878">,</span>&nbsp;<span class="ident" id="8013880">err</span>&nbsp;<span class="op" id="8013884">:=</span>&nbsp;<span class="ident" id="8013887">io</span><span class="op" id="8013889">.</span><span class="ident" id="8013890">Copy</span><span class="op" id="8013894">(</span><span class="ident" id="8013895">buf</span><span class="op" id="8013898">,</span>&nbsp;<span class="ident" id="8013900">part</span><span class="op" id="8013904">)</span><span class="op" id="8013905">;</span>&nbsp;<span class="ident" id="8013907">err</span>&nbsp;<span class="op" id="8013911">!=</span>&nbsp;<span class="builtintype" id="8013914">nil</span>&nbsp;<span class="op" id="8013918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013922">t</span><span class="op" id="8013923">.</span><span class="ident" id="8013924">Errorf</span><span class="op" id="8013930">(</span><span class="string" id="8013931">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8013948">,</span>&nbsp;<span class="ident" id="8013950">err</span><span class="op" id="8013953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8013956">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8013960">adjustNewlines</span>&nbsp;<span class="op" id="8013975">:=</span>&nbsp;<span class="keyword" id="8013978">func</span><span class="op" id="8013982">(</span><span class="ident" id="8013983">s</span>&nbsp;<span class="builtintype" id="8013985">string</span><span class="op" id="8013991">)</span>&nbsp;<span class="builtintype" id="8013993">string</span>&nbsp;<span class="op" id="8014000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014004">if</span>&nbsp;<span class="ident" id="8014007">onlyNewlines</span>&nbsp;<span class="op" id="8014020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014025">return</span>&nbsp;<span class="ident" id="8014032">strings</span><span class="op" id="8014039">.</span><span class="ident" id="8014040">Replace</span><span class="op" id="8014047">(</span><span class="ident" id="8014048">s</span><span class="op" id="8014049">,</span>&nbsp;<span class="string" id="8014051">&#34;\r\n&#34;</span><span class="op" id="8014057">,</span>&nbsp;<span class="string" id="8014059">&#34;\n&#34;</span><span class="op" id="8014063">,</span>&nbsp;<span class="op" id="8014065">-</span><span class="num" id="8014066">1</span><span class="op" id="8014067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014071">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014075">return</span>&nbsp;<span class="ident" id="8014082">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014089">expectEq</span><span class="op" id="8014097">(</span><span class="ident" id="8014098">t</span><span class="op" id="8014099">,</span>&nbsp;<span class="ident" id="8014101">adjustNewlines</span><span class="op" id="8014115">(</span><span class="string" id="8014116">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="8014138">)</span><span class="op" id="8014139">,</span>&nbsp;<span class="ident" id="8014141">buf</span><span class="op" id="8014144">.</span><span class="ident" id="8014145">String</span><span class="op" id="8014151">(</span><span class="op" id="8014152">)</span><span class="op" id="8014153">,</span>&nbsp;<span class="string" id="8014155">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="8014176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8014180">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014190">part</span><span class="op" id="8014194">,</span>&nbsp;<span class="ident" id="8014196">err</span>&nbsp;<span class="op" id="8014200">=</span>&nbsp;<span class="ident" id="8014202">reader</span><span class="op" id="8014208">.</span><span class="ident" id="8014209">NextPart</span><span class="op" id="8014217">(</span><span class="op" id="8014218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014221">if</span>&nbsp;<span class="ident" id="8014224">err</span>&nbsp;<span class="op" id="8014228">!=</span>&nbsp;<span class="builtintype" id="8014231">nil</span>&nbsp;<span class="op" id="8014235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014239">t</span><span class="op" id="8014240">.</span><span class="ident" id="8014241">Fatalf</span><span class="op" id="8014247">(</span><span class="string" id="8014248">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="8014273">,</span>&nbsp;<span class="ident" id="8014275">err</span><span class="op" id="8014278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014282">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014293">if</span>&nbsp;<span class="ident" id="8014296">e</span><span class="op" id="8014297">,</span>&nbsp;<span class="ident" id="8014299">g</span>&nbsp;<span class="op" id="8014301">:=</span>&nbsp;<span class="string" id="8014304">&#34;bigsection&#34;</span><span class="op" id="8014316">,</span>&nbsp;<span class="ident" id="8014318">part</span><span class="op" id="8014322">.</span><span class="ident" id="8014323">Header</span><span class="op" id="8014329">.</span><span class="ident" id="8014330">Get</span><span class="op" id="8014333">(</span><span class="string" id="8014334">&#34;name&#34;</span><span class="op" id="8014340">)</span><span class="op" id="8014341">;</span>&nbsp;<span class="ident" id="8014343">e</span>&nbsp;<span class="op" id="8014345">!=</span>&nbsp;<span class="ident" id="8014348">g</span>&nbsp;<span class="op" id="8014350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014354">t</span><span class="op" id="8014355">.</span><span class="ident" id="8014356">Errorf</span><span class="op" id="8014362">(</span><span class="string" id="8014363">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8014405">,</span>&nbsp;<span class="ident" id="8014407">e</span><span class="op" id="8014408">,</span>&nbsp;<span class="ident" id="8014410">g</span><span class="op" id="8014411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014417">buf</span><span class="op" id="8014420">.</span><span class="ident" id="8014421">Reset</span><span class="op" id="8014426">(</span><span class="op" id="8014427">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014430">if</span>&nbsp;<span class="ident" id="8014433">_</span><span class="op" id="8014434">,</span>&nbsp;<span class="ident" id="8014436">err</span>&nbsp;<span class="op" id="8014440">:=</span>&nbsp;<span class="ident" id="8014443">io</span><span class="op" id="8014445">.</span><span class="ident" id="8014446">Copy</span><span class="op" id="8014450">(</span><span class="ident" id="8014451">buf</span><span class="op" id="8014454">,</span>&nbsp;<span class="ident" id="8014456">part</span><span class="op" id="8014460">)</span><span class="op" id="8014461">;</span>&nbsp;<span class="ident" id="8014463">err</span>&nbsp;<span class="op" id="8014467">!=</span>&nbsp;<span class="builtintype" id="8014470">nil</span>&nbsp;<span class="op" id="8014474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014478">t</span><span class="op" id="8014479">.</span><span class="ident" id="8014480">Errorf</span><span class="op" id="8014486">(</span><span class="string" id="8014487">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8014504">,</span>&nbsp;<span class="ident" id="8014506">err</span><span class="op" id="8014509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014515">s</span>&nbsp;<span class="op" id="8014517">:=</span>&nbsp;<span class="ident" id="8014520">buf</span><span class="op" id="8014523">.</span><span class="ident" id="8014524">String</span><span class="op" id="8014530">(</span><span class="op" id="8014531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014534">if</span>&nbsp;<span class="builtinfunc" id="8014537">len</span><span class="op" id="8014540">(</span><span class="ident" id="8014541">s</span><span class="op" id="8014542">)</span>&nbsp;<span class="op" id="8014544">!=</span>&nbsp;<span class="builtinfunc" id="8014547">len</span><span class="op" id="8014550">(</span><span class="ident" id="8014551">longLine</span><span class="op" id="8014559">)</span>&nbsp;<span class="op" id="8014561">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014565">t</span><span class="op" id="8014566">.</span><span class="ident" id="8014567">Errorf</span><span class="op" id="8014573">(</span><span class="string" id="8014574">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="8014633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8014638">len</span><span class="op" id="8014641">(</span><span class="ident" id="8014642">longLine</span><span class="op" id="8014650">)</span><span class="op" id="8014651">,</span>&nbsp;<span class="builtinfunc" id="8014653">len</span><span class="op" id="8014656">(</span><span class="ident" id="8014657">s</span><span class="op" id="8014658">)</span><span class="op" id="8014659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014665">if</span>&nbsp;<span class="ident" id="8014668">s</span>&nbsp;<span class="op" id="8014670">!=</span>&nbsp;<span class="ident" id="8014673">longLine</span>&nbsp;<span class="op" id="8014682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014686">t</span><span class="op" id="8014687">.</span><span class="ident" id="8014688">Errorf</span><span class="op" id="8014694">(</span><span class="string" id="8014695">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="8014725">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8014732">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014742">part</span><span class="op" id="8014746">,</span>&nbsp;<span class="ident" id="8014748">err</span>&nbsp;<span class="op" id="8014752">=</span>&nbsp;<span class="ident" id="8014754">reader</span><span class="op" id="8014760">.</span><span class="ident" id="8014761">NextPart</span><span class="op" id="8014769">(</span><span class="op" id="8014770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014773">if</span>&nbsp;<span class="ident" id="8014776">part</span>&nbsp;<span class="op" id="8014781">==</span>&nbsp;<span class="builtintype" id="8014784">nil</span>&nbsp;<span class="op" id="8014788">||</span>&nbsp;<span class="ident" id="8014791">err</span>&nbsp;<span class="op" id="8014795">!=</span>&nbsp;<span class="builtintype" id="8014798">nil</span>&nbsp;<span class="op" id="8014802">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014806">t</span><span class="op" id="8014807">.</span><span class="ident" id="8014808">Error</span><span class="op" id="8014813">(</span><span class="string" id="8014814">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="8014830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014834">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014845">if</span>&nbsp;<span class="ident" id="8014848">part</span><span class="op" id="8014852">.</span><span class="ident" id="8014853">Header</span><span class="op" id="8014859">.</span><span class="ident" id="8014860">Get</span><span class="op" id="8014863">(</span><span class="string" id="8014864">&#34;foo-bar&#34;</span><span class="op" id="8014873">)</span>&nbsp;<span class="op" id="8014875">!=</span>&nbsp;<span class="string" id="8014878">&#34;bazb&#34;</span>&nbsp;<span class="op" id="8014885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014889">t</span><span class="op" id="8014890">.</span><span class="ident" id="8014891">Error</span><span class="op" id="8014896">(</span><span class="string" id="8014897">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="8014921">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014927">buf</span><span class="op" id="8014930">.</span><span class="ident" id="8014931">Reset</span><span class="op" id="8014936">(</span><span class="op" id="8014937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8014940">if</span>&nbsp;<span class="ident" id="8014943">_</span><span class="op" id="8014944">,</span>&nbsp;<span class="ident" id="8014946">err</span>&nbsp;<span class="op" id="8014950">:=</span>&nbsp;<span class="ident" id="8014953">io</span><span class="op" id="8014955">.</span><span class="ident" id="8014956">Copy</span><span class="op" id="8014960">(</span><span class="ident" id="8014961">buf</span><span class="op" id="8014964">,</span>&nbsp;<span class="ident" id="8014966">part</span><span class="op" id="8014970">)</span><span class="op" id="8014971">;</span>&nbsp;<span class="ident" id="8014973">err</span>&nbsp;<span class="op" id="8014977">!=</span>&nbsp;<span class="builtintype" id="8014980">nil</span>&nbsp;<span class="op" id="8014984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8014988">t</span><span class="op" id="8014989">.</span><span class="ident" id="8014990">Errorf</span><span class="op" id="8014996">(</span><span class="string" id="8014997">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="8015014">,</span>&nbsp;<span class="ident" id="8015016">err</span><span class="op" id="8015019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8015022">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015025">expectEq</span><span class="op" id="8015033">(</span><span class="ident" id="8015034">t</span><span class="op" id="8015035">,</span>&nbsp;<span class="ident" id="8015037">adjustNewlines</span><span class="op" id="8015051">(</span><span class="string" id="8015052">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="8015117">)</span><span class="op" id="8015118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015122">buf</span><span class="op" id="8015125">.</span><span class="ident" id="8015126">String</span><span class="op" id="8015132">(</span><span class="op" id="8015133">)</span><span class="op" id="8015134">,</span>&nbsp;<span class="string" id="8015136">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="8015152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8015156">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015166">part</span><span class="op" id="8015170">,</span>&nbsp;<span class="ident" id="8015172">err</span>&nbsp;<span class="op" id="8015176">=</span>&nbsp;<span class="ident" id="8015178">reader</span><span class="op" id="8015184">.</span><span class="ident" id="8015185">NextPart</span><span class="op" id="8015193">(</span><span class="op" id="8015194">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8015197">if</span>&nbsp;<span class="ident" id="8015200">part</span>&nbsp;<span class="op" id="8015205">==</span>&nbsp;<span class="builtintype" id="8015208">nil</span>&nbsp;<span class="op" id="8015212">||</span>&nbsp;<span class="ident" id="8015215">err</span>&nbsp;<span class="op" id="8015219">!=</span>&nbsp;<span class="builtintype" id="8015222">nil</span>&nbsp;<span class="op" id="8015226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015230">t</span><span class="op" id="8015231">.</span><span class="ident" id="8015232">Error</span><span class="op" id="8015237">(</span><span class="string" id="8015238">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="8015270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8015274">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8015282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8015286">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015309">part</span><span class="op" id="8015313">,</span>&nbsp;<span class="ident" id="8015315">err</span>&nbsp;<span class="op" id="8015319">=</span>&nbsp;<span class="ident" id="8015321">reader</span><span class="op" id="8015327">.</span><span class="ident" id="8015328">NextPart</span><span class="op" id="8015336">(</span><span class="op" id="8015337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8015340">if</span>&nbsp;<span class="ident" id="8015343">part</span>&nbsp;<span class="op" id="8015348">!=</span>&nbsp;<span class="builtintype" id="8015351">nil</span>&nbsp;<span class="op" id="8015355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015359">t</span><span class="op" id="8015360">.</span><span class="ident" id="8015361">Error</span><span class="op" id="8015366">(</span><span class="string" id="8015367">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="8015396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8015399">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8015402">if</span>&nbsp;<span class="ident" id="8015405">err</span>&nbsp;<span class="op" id="8015409">!=</span>&nbsp;<span class="ident" id="8015412">io</span><span class="op" id="8015414">.</span><span class="ident" id="8015415">EOF</span>&nbsp;<span class="op" id="8015419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015423">t</span><span class="op" id="8015424">.</span><span class="ident" id="8015425">Errorf</span><span class="op" id="8015431">(</span><span class="string" id="8015432">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8015471">,</span>&nbsp;<span class="ident" id="8015473">err</span><span class="op" id="8015476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8015479">}</span><br>
<span class="lineno"></span><span class="op" id="8015481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8015484">func</span>&nbsp;<span class="ident" id="8015489">TestVariousTextLineEndings</span><span class="op" id="8015515">(</span><span class="ident" id="8015516">t</span>&nbsp;<span class="op" id="8015518">*</span><span class="ident" id="8015519">testing</span><span class="op" id="8015526">.</span><span class="ident" id="8015527">T</span><span class="op" id="8015528">)</span>&nbsp;<span class="op" id="8015530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015533">tests</span>&nbsp;<span class="op" id="8015539">:=</span>&nbsp;<span class="op" id="8015542">[</span><span class="op" id="8015543">...</span><span class="op" id="8015546">]</span><span class="builtintype" id="8015547">string</span><span class="op" id="8015553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015557">&#34;Foo\nBar&#34;</span><span class="op" id="8015567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015571">&#34;Foo\nBar\n&#34;</span><span class="op" id="8015583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015587">&#34;Foo\r\nBar&#34;</span><span class="op" id="8015599">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015603">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="8015619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015623">&#34;Foo\rBar&#34;</span><span class="op" id="8015633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015637">&#34;Foo\rBar\r&#34;</span><span class="op" id="8015649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015653">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="8015699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8015702">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8015706">for</span>&nbsp;<span class="ident" id="8015710">testNum</span><span class="op" id="8015717">,</span>&nbsp;<span class="ident" id="8015719">expectedBody</span>&nbsp;<span class="op" id="8015732">:=</span>&nbsp;<span class="keyword" id="8015735">range</span>&nbsp;<span class="ident" id="8015741">tests</span>&nbsp;<span class="op" id="8015747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015751">body</span>&nbsp;<span class="op" id="8015756">:=</span>&nbsp;<span class="string" id="8015759">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="8015776">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015781">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8015834">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015839">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="8015846">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015851">expectedBody</span>&nbsp;<span class="op" id="8015864">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8015869">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015894">bodyReader</span>&nbsp;<span class="op" id="8015905">:=</span>&nbsp;<span class="ident" id="8015908">strings</span><span class="op" id="8015915">.</span><span class="ident" id="8015916">NewReader</span><span class="op" id="8015925">(</span><span class="ident" id="8015926">body</span><span class="op" id="8015930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015935">reader</span>&nbsp;<span class="op" id="8015942">:=</span>&nbsp;<span class="ident" id="8015945">NewReader</span><span class="op" id="8015954">(</span><span class="ident" id="8015955">bodyReader</span><span class="op" id="8015965">,</span>&nbsp;<span class="string" id="8015967">&#34;BOUNDARY&#34;</span><span class="op" id="8015977">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8015981">buf</span>&nbsp;<span class="op" id="8015985">:=</span>&nbsp;<span class="builtinfunc" id="8015988">new</span><span class="op" id="8015991">(</span><span class="ident" id="8015992">bytes</span><span class="op" id="8015997">.</span><span class="ident" id="8015998">Buffer</span><span class="op" id="8016004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016008">part</span><span class="op" id="8016012">,</span>&nbsp;<span class="ident" id="8016014">err</span>&nbsp;<span class="op" id="8016018">:=</span>&nbsp;<span class="ident" id="8016021">reader</span><span class="op" id="8016027">.</span><span class="ident" id="8016028">NextPart</span><span class="op" id="8016036">(</span><span class="op" id="8016037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016041">if</span>&nbsp;<span class="ident" id="8016044">part</span>&nbsp;<span class="op" id="8016049">==</span>&nbsp;<span class="builtintype" id="8016052">nil</span>&nbsp;<span class="op" id="8016056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016061">t</span><span class="op" id="8016062">.</span><span class="ident" id="8016063">Errorf</span><span class="op" id="8016069">(</span><span class="string" id="8016070">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="8016103">,</span>&nbsp;<span class="ident" id="8016105">testNum</span><span class="op" id="8016112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016117">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016132">if</span>&nbsp;<span class="ident" id="8016135">err</span>&nbsp;<span class="op" id="8016139">!=</span>&nbsp;<span class="builtintype" id="8016142">nil</span>&nbsp;<span class="op" id="8016146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016151">t</span><span class="op" id="8016152">.</span><span class="ident" id="8016153">Errorf</span><span class="op" id="8016159">(</span><span class="string" id="8016160">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8016193">,</span>&nbsp;<span class="ident" id="8016195">testNum</span><span class="op" id="8016202">,</span>&nbsp;<span class="ident" id="8016204">err</span><span class="op" id="8016207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016212">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016223">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016227">written</span><span class="op" id="8016234">,</span>&nbsp;<span class="ident" id="8016236">err</span>&nbsp;<span class="op" id="8016240">:=</span>&nbsp;<span class="ident" id="8016243">io</span><span class="op" id="8016245">.</span><span class="ident" id="8016246">Copy</span><span class="op" id="8016250">(</span><span class="ident" id="8016251">buf</span><span class="op" id="8016254">,</span>&nbsp;<span class="ident" id="8016256">part</span><span class="op" id="8016260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016264">expectEq</span><span class="op" id="8016272">(</span><span class="ident" id="8016273">t</span><span class="op" id="8016274">,</span>&nbsp;<span class="ident" id="8016276">expectedBody</span><span class="op" id="8016288">,</span>&nbsp;<span class="ident" id="8016290">buf</span><span class="op" id="8016293">.</span><span class="ident" id="8016294">String</span><span class="op" id="8016300">(</span><span class="op" id="8016301">)</span><span class="op" id="8016302">,</span>&nbsp;<span class="ident" id="8016304">fmt</span><span class="op" id="8016307">.</span><span class="ident" id="8016308">Sprintf</span><span class="op" id="8016315">(</span><span class="string" id="8016316">&#34;test&nbsp;%d&#34;</span><span class="op" id="8016325">,</span>&nbsp;<span class="ident" id="8016327">testNum</span><span class="op" id="8016334">)</span><span class="op" id="8016335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016339">if</span>&nbsp;<span class="ident" id="8016342">err</span>&nbsp;<span class="op" id="8016346">!=</span>&nbsp;<span class="builtintype" id="8016349">nil</span>&nbsp;<span class="op" id="8016353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016358">t</span><span class="op" id="8016359">.</span><span class="ident" id="8016360">Errorf</span><span class="op" id="8016366">(</span><span class="string" id="8016367">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="8016412">,</span>&nbsp;<span class="ident" id="8016414">written</span><span class="op" id="8016421">,</span>&nbsp;<span class="ident" id="8016423">err</span><span class="op" id="8016426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016430">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016435">part</span><span class="op" id="8016439">,</span>&nbsp;<span class="ident" id="8016441">err</span>&nbsp;<span class="op" id="8016445">=</span>&nbsp;<span class="ident" id="8016447">reader</span><span class="op" id="8016453">.</span><span class="ident" id="8016454">NextPart</span><span class="op" id="8016462">(</span><span class="op" id="8016463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016467">if</span>&nbsp;<span class="ident" id="8016470">part</span>&nbsp;<span class="op" id="8016475">!=</span>&nbsp;<span class="builtintype" id="8016478">nil</span>&nbsp;<span class="op" id="8016482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016487">t</span><span class="op" id="8016488">.</span><span class="ident" id="8016489">Errorf</span><span class="op" id="8016495">(</span><span class="string" id="8016496">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="8016524">,</span>&nbsp;<span class="ident" id="8016526">testNum</span><span class="op" id="8016533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016537">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016541">if</span>&nbsp;<span class="ident" id="8016544">err</span>&nbsp;<span class="op" id="8016548">!=</span>&nbsp;<span class="ident" id="8016551">io</span><span class="op" id="8016553">.</span><span class="ident" id="8016554">EOF</span>&nbsp;<span class="op" id="8016558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016563">t</span><span class="op" id="8016564">.</span><span class="ident" id="8016565">Errorf</span><span class="op" id="8016571">(</span><span class="string" id="8016572">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8016608">,</span>&nbsp;<span class="ident" id="8016610">testNum</span><span class="op" id="8016617">,</span>&nbsp;<span class="ident" id="8016619">err</span><span class="op" id="8016622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016630">}</span><br>
<span class="lineno">260</span><span class="op" id="8016632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016635">type</span>&nbsp;<span class="ident" id="8016640">maliciousReader</span>&nbsp;<span class="keyword" id="8016656">struct</span>&nbsp;<span class="op" id="8016663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016666">t</span>&nbsp;<span class="op" id="8016668">*</span><span class="ident" id="8016669">testing</span><span class="op" id="8016676">.</span><span class="ident" id="8016677">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016680">n</span>&nbsp;<span class="builtintype" id="8016682">int</span><br>
<span class="lineno">265</span><span class="op" id="8016686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016689">const</span>&nbsp;<span class="ident" id="8016695">maxReadThreshold</span>&nbsp;<span class="op" id="8016712">=</span>&nbsp;<span class="num" id="8016714">1</span>&nbsp;<span class="op" id="8016716">&lt;&lt;</span>&nbsp;<span class="num" id="8016719">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016723">func</span>&nbsp;<span class="op" id="8016728">(</span><span class="ident" id="8016729">mr</span>&nbsp;<span class="op" id="8016732">*</span><span class="ident" id="8016733">maliciousReader</span><span class="op" id="8016748">)</span>&nbsp;<span class="ident" id="8016750">Read</span><span class="op" id="8016754">(</span><span class="ident" id="8016755">b</span>&nbsp;<span class="op" id="8016757">[</span><span class="op" id="8016758">]</span><span class="builtintype" id="8016759">byte</span><span class="op" id="8016763">)</span>&nbsp;<span class="op" id="8016765">(</span><span class="ident" id="8016766">n</span>&nbsp;<span class="builtintype" id="8016768">int</span><span class="op" id="8016771">,</span>&nbsp;<span class="ident" id="8016773">err</span>&nbsp;<span class="builtintype" id="8016777">error</span><span class="op" id="8016782">)</span>&nbsp;<span class="op" id="8016784">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016787">mr</span><span class="op" id="8016789">.</span><span class="ident" id="8016790">n</span>&nbsp;<span class="op" id="8016792">+=</span>&nbsp;<span class="builtinfunc" id="8016795">len</span><span class="op" id="8016798">(</span><span class="ident" id="8016799">b</span><span class="op" id="8016800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016803">if</span>&nbsp;<span class="ident" id="8016806">mr</span><span class="op" id="8016808">.</span><span class="ident" id="8016809">n</span>&nbsp;<span class="op" id="8016811">&gt;=</span>&nbsp;<span class="ident" id="8016814">maxReadThreshold</span>&nbsp;<span class="op" id="8016831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016835">mr</span><span class="op" id="8016837">.</span><span class="ident" id="8016838">t</span><span class="op" id="8016839">.</span><span class="ident" id="8016840">Fatal</span><span class="op" id="8016845">(</span><span class="string" id="8016846">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="8016865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016869">return</span>&nbsp;<span class="num" id="8016876">0</span><span class="op" id="8016877">,</span>&nbsp;<span class="ident" id="8016879">io</span><span class="op" id="8016881">.</span><span class="ident" id="8016882">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8016887">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8016890">return</span>&nbsp;<span class="builtinfunc" id="8016897">len</span><span class="op" id="8016900">(</span><span class="ident" id="8016901">b</span><span class="op" id="8016902">)</span><span class="op" id="8016903">,</span>&nbsp;<span class="builtintype" id="8016905">nil</span><br>
<span class="lineno"></span><span class="op" id="8016909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016912">func</span>&nbsp;<span class="ident" id="8016917">TestLineLimit</span><span class="op" id="8016930">(</span><span class="ident" id="8016931">t</span>&nbsp;<span class="op" id="8016933">*</span><span class="ident" id="8016934">testing</span><span class="op" id="8016941">.</span><span class="ident" id="8016942">T</span><span class="op" id="8016943">)</span>&nbsp;<span class="op" id="8016945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016948">mr</span>&nbsp;<span class="op" id="8016951">:=</span>&nbsp;<span class="op" id="8016954">&amp;</span><span class="ident" id="8016955">maliciousReader</span><span class="op" id="8016970">{</span><span class="ident" id="8016971">t</span><span class="op" id="8016972">:</span>&nbsp;<span class="ident" id="8016974">t</span><span class="op" id="8016975">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8016978">r</span>&nbsp;<span class="op" id="8016980">:=</span>&nbsp;<span class="ident" id="8016983">NewReader</span><span class="op" id="8016992">(</span><span class="ident" id="8016993">mr</span><span class="op" id="8016995">,</span>&nbsp;<span class="string" id="8016997">&#34;fooBoundary&#34;</span><span class="op" id="8017010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017013">part</span><span class="op" id="8017017">,</span>&nbsp;<span class="ident" id="8017019">err</span>&nbsp;<span class="op" id="8017023">:=</span>&nbsp;<span class="ident" id="8017026">r</span><span class="op" id="8017027">.</span><span class="ident" id="8017028">NextPart</span><span class="op" id="8017036">(</span><span class="op" id="8017037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017040">if</span>&nbsp;<span class="ident" id="8017043">part</span>&nbsp;<span class="op" id="8017048">!=</span>&nbsp;<span class="builtintype" id="8017051">nil</span>&nbsp;<span class="op" id="8017055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017059">t</span><span class="op" id="8017060">.</span><span class="ident" id="8017061">Errorf</span><span class="op" id="8017067">(</span><span class="string" id="8017068">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="8017090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017093">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017096">if</span>&nbsp;<span class="ident" id="8017099">err</span>&nbsp;<span class="op" id="8017103">==</span>&nbsp;<span class="builtintype" id="8017106">nil</span>&nbsp;<span class="op" id="8017110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017114">t</span><span class="op" id="8017115">.</span><span class="ident" id="8017116">Errorf</span><span class="op" id="8017122">(</span><span class="string" id="8017123">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="8017142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017148">if</span>&nbsp;<span class="ident" id="8017151">mr</span><span class="op" id="8017153">.</span><span class="ident" id="8017154">n</span>&nbsp;<span class="op" id="8017156">&gt;=</span>&nbsp;<span class="ident" id="8017159">maxReadThreshold</span>&nbsp;<span class="op" id="8017176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017180">t</span><span class="op" id="8017181">.</span><span class="ident" id="8017182">Errorf</span><span class="op" id="8017188">(</span><span class="string" id="8017189">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8017227">,</span>&nbsp;<span class="ident" id="8017229">maxReadThreshold</span><span class="op" id="8017245">,</span>&nbsp;<span class="ident" id="8017247">mr</span><span class="op" id="8017249">.</span><span class="ident" id="8017250">n</span><span class="op" id="8017251">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017254">}</span><br>
<span class="lineno"></span><span class="op" id="8017256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8017259">func</span>&nbsp;<span class="ident" id="8017264">TestMultipartTruncated</span><span class="op" id="8017286">(</span><span class="ident" id="8017287">t</span>&nbsp;<span class="op" id="8017289">*</span><span class="ident" id="8017290">testing</span><span class="op" id="8017297">.</span><span class="ident" id="8017298">T</span><span class="op" id="8017299">)</span>&nbsp;<span class="op" id="8017301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017304">testBody</span>&nbsp;<span class="op" id="8017313">:=</span>&nbsp;<span class="string" id="8017316">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017423">body</span>&nbsp;<span class="op" id="8017428">:=</span>&nbsp;<span class="ident" id="8017431">strings</span><span class="op" id="8017438">.</span><span class="ident" id="8017439">Replace</span><span class="op" id="8017446">(</span><span class="ident" id="8017447">testBody</span><span class="op" id="8017455">,</span>&nbsp;<span class="string" id="8017457">&#34;\n&#34;</span><span class="op" id="8017461">,</span>&nbsp;<span class="string" id="8017463">&#34;\r\n&#34;</span><span class="op" id="8017469">,</span>&nbsp;<span class="op" id="8017471">-</span><span class="num" id="8017472">1</span><span class="op" id="8017473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017476">bodyReader</span>&nbsp;<span class="op" id="8017487">:=</span>&nbsp;<span class="ident" id="8017490">strings</span><span class="op" id="8017497">.</span><span class="ident" id="8017498">NewReader</span><span class="op" id="8017507">(</span><span class="ident" id="8017508">body</span><span class="op" id="8017512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017515">r</span>&nbsp;<span class="op" id="8017517">:=</span>&nbsp;<span class="ident" id="8017520">NewReader</span><span class="op" id="8017529">(</span><span class="ident" id="8017530">bodyReader</span><span class="op" id="8017540">,</span>&nbsp;<span class="string" id="8017542">&#34;MyBoundary&#34;</span><span class="op" id="8017554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017558">part</span><span class="op" id="8017562">,</span>&nbsp;<span class="ident" id="8017564">err</span>&nbsp;<span class="op" id="8017568">:=</span>&nbsp;<span class="ident" id="8017571">r</span><span class="op" id="8017572">.</span><span class="ident" id="8017573">NextPart</span><span class="op" id="8017581">(</span><span class="op" id="8017582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017585">if</span>&nbsp;<span class="ident" id="8017588">err</span>&nbsp;<span class="op" id="8017592">!=</span>&nbsp;<span class="builtintype" id="8017595">nil</span>&nbsp;<span class="op" id="8017599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017603">t</span><span class="op" id="8017604">.</span><span class="ident" id="8017605">Fatalf</span><span class="op" id="8017611">(</span><span class="string" id="8017612">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8017631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017637">_</span><span class="op" id="8017638">,</span>&nbsp;<span class="ident" id="8017640">err</span>&nbsp;<span class="op" id="8017644">=</span>&nbsp;<span class="ident" id="8017646">io</span><span class="op" id="8017648">.</span><span class="ident" id="8017649">Copy</span><span class="op" id="8017653">(</span><span class="ident" id="8017654">ioutil</span><span class="op" id="8017660">.</span><span class="ident" id="8017661">Discard</span><span class="op" id="8017668">,</span>&nbsp;<span class="ident" id="8017670">part</span><span class="op" id="8017674">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017677">if</span>&nbsp;<span class="ident" id="8017680">err</span>&nbsp;<span class="op" id="8017684">!=</span>&nbsp;<span class="ident" id="8017687">io</span><span class="op" id="8017689">.</span><span class="ident" id="8017690">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8017707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017711">t</span><span class="op" id="8017712">.</span><span class="ident" id="8017713">Fatalf</span><span class="op" id="8017719">(</span><span class="string" id="8017720">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8017764">,</span>&nbsp;<span class="ident" id="8017766">err</span><span class="op" id="8017769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017772">}</span><br>
<span class="lineno"></span><span class="op" id="8017774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8017777">type</span>&nbsp;<span class="ident" id="8017782">slowReader</span>&nbsp;<span class="keyword" id="8017793">struct</span>&nbsp;<span class="op" id="8017800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8017803">r</span>&nbsp;<span class="ident" id="8017805">io</span><span class="op" id="8017807">.</span><span class="ident" id="8017808">Reader</span><br>
<span class="lineno"></span><span class="op" id="8017815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8017818">func</span>&nbsp;<span class="op" id="8017823">(</span><span class="ident" id="8017824">s</span>&nbsp;<span class="op" id="8017826">*</span><span class="ident" id="8017827">slowReader</span><span class="op" id="8017837">)</span>&nbsp;<span class="ident" id="8017839">Read</span><span class="op" id="8017843">(</span><span class="ident" id="8017844">p</span>&nbsp;<span class="op" id="8017846">[</span><span class="op" id="8017847">]</span><span class="builtintype" id="8017848">byte</span><span class="op" id="8017852">)</span>&nbsp;<span class="op" id="8017854">(</span><span class="builtintype" id="8017855">int</span><span class="op" id="8017858">,</span>&nbsp;<span class="builtintype" id="8017860">error</span><span class="op" id="8017865">)</span>&nbsp;<span class="op" id="8017867">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017870">if</span>&nbsp;<span class="builtinfunc" id="8017873">len</span><span class="op" id="8017876">(</span><span class="ident" id="8017877">p</span><span class="op" id="8017878">)</span>&nbsp;<span class="op" id="8017880">==</span>&nbsp;<span class="num" id="8017883">0</span>&nbsp;<span class="op" id="8017885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017889">return</span>&nbsp;<span class="ident" id="8017896">s</span><span class="op" id="8017897">.</span><span class="ident" id="8017898">r</span><span class="op" id="8017899">.</span><span class="ident" id="8017900">Read</span><span class="op" id="8017904">(</span><span class="ident" id="8017905">p</span><span class="op" id="8017906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8017909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8017912">return</span>&nbsp;<span class="ident" id="8017919">s</span><span class="op" id="8017920">.</span><span class="ident" id="8017921">r</span><span class="op" id="8017922">.</span><span class="ident" id="8017923">Read</span><span class="op" id="8017927">(</span><span class="ident" id="8017928">p</span><span class="op" id="8017929">[</span><span class="op" id="8017930">:</span><span class="num" id="8017931">1</span><span class="op" id="8017932">]</span><span class="op" id="8017933">)</span><br>
<span class="lineno"></span><span class="op" id="8017935">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8017938">func</span>&nbsp;<span class="ident" id="8017943">TestLineContinuation</span><span class="op" id="8017963">(</span><span class="ident" id="8017964">t</span>&nbsp;<span class="op" id="8017966">*</span><span class="ident" id="8017967">testing</span><span class="op" id="8017974">.</span><span class="ident" id="8017975">T</span><span class="op" id="8017976">)</span>&nbsp;<span class="op" id="8017978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8017981">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8018057">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8018069">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8018136">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018197">testBody</span>&nbsp;<span class="op" id="8018206">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8018211">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018707">r</span>&nbsp;<span class="op" id="8018709">:=</span>&nbsp;<span class="ident" id="8018712">NewReader</span><span class="op" id="8018721">(</span><span class="ident" id="8018722">strings</span><span class="op" id="8018729">.</span><span class="ident" id="8018730">NewReader</span><span class="op" id="8018739">(</span><span class="ident" id="8018740">testBody</span><span class="op" id="8018748">)</span><span class="op" id="8018749">,</span>&nbsp;<span class="string" id="8018751">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="8018775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8018779">for</span>&nbsp;<span class="ident" id="8018783">i</span>&nbsp;<span class="op" id="8018785">:=</span>&nbsp;<span class="num" id="8018788">0</span><span class="op" id="8018789">;</span>&nbsp;<span class="ident" id="8018791">i</span>&nbsp;<span class="op" id="8018793">&lt;</span>&nbsp;<span class="num" id="8018795">2</span><span class="op" id="8018796">;</span>&nbsp;<span class="ident" id="8018798">i</span><span class="op" id="8018799">++</span>&nbsp;<span class="op" id="8018802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018806">part</span><span class="op" id="8018810">,</span>&nbsp;<span class="ident" id="8018812">err</span>&nbsp;<span class="op" id="8018816">:=</span>&nbsp;<span class="ident" id="8018819">r</span><span class="op" id="8018820">.</span><span class="ident" id="8018821">NextPart</span><span class="op" id="8018829">(</span><span class="op" id="8018830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8018834">if</span>&nbsp;<span class="ident" id="8018837">err</span>&nbsp;<span class="op" id="8018841">!=</span>&nbsp;<span class="builtintype" id="8018844">nil</span>&nbsp;<span class="op" id="8018848">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018853">t</span><span class="op" id="8018854">.</span><span class="ident" id="8018855">Fatalf</span><span class="op" id="8018861">(</span><span class="string" id="8018862">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="8018881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8018885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8018889">var</span>&nbsp;<span class="ident" id="8018893">buf</span>&nbsp;<span class="ident" id="8018897">bytes</span><span class="op" id="8018902">.</span><span class="ident" id="8018903">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018912">n</span><span class="op" id="8018913">,</span>&nbsp;<span class="ident" id="8018915">err</span>&nbsp;<span class="op" id="8018919">:=</span>&nbsp;<span class="ident" id="8018922">io</span><span class="op" id="8018924">.</span><span class="ident" id="8018925">Copy</span><span class="op" id="8018929">(</span><span class="op" id="8018930">&amp;</span><span class="ident" id="8018931">buf</span><span class="op" id="8018934">,</span>&nbsp;<span class="ident" id="8018936">part</span><span class="op" id="8018940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8018944">if</span>&nbsp;<span class="ident" id="8018947">err</span>&nbsp;<span class="op" id="8018951">!=</span>&nbsp;<span class="builtintype" id="8018954">nil</span>&nbsp;<span class="op" id="8018958">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8018963">t</span><span class="op" id="8018964">.</span><span class="ident" id="8018965">Errorf</span><span class="op" id="8018971">(</span><span class="string" id="8018972">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="8019013">,</span>&nbsp;<span class="ident" id="8019015">err</span><span class="op" id="8019018">,</span>&nbsp;<span class="ident" id="8019020">buf</span><span class="op" id="8019023">.</span><span class="ident" id="8019024">String</span><span class="op" id="8019030">(</span><span class="op" id="8019031">)</span><span class="op" id="8019032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8019036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8019040">if</span>&nbsp;<span class="ident" id="8019043">n</span>&nbsp;<span class="op" id="8019045">&lt;=</span>&nbsp;<span class="num" id="8019048">0</span>&nbsp;<span class="op" id="8019050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8019055">t</span><span class="op" id="8019056">.</span><span class="ident" id="8019057">Errorf</span><span class="op" id="8019063">(</span><span class="string" id="8019064">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="8019092">,</span>&nbsp;<span class="ident" id="8019094">n</span><span class="op" id="8019095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8019099">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8019102">}</span><br>
<span class="lineno"></span><span class="op" id="8019104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8019107">func</span>&nbsp;<span class="ident" id="8019112">TestQuotedPrintableEncoding</span><span class="op" id="8019139">(</span><span class="ident" id="8019140">t</span>&nbsp;<span class="op" id="8019142">*</span><span class="ident" id="8019143">testing</span><span class="op" id="8019150">.</span><span class="ident" id="8019151">T</span><span class="op" id="8019152">)</span>&nbsp;<span class="op" id="8019154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8019157">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8019195">body</span>&nbsp;<span class="op" id="8019200">:=</span>&nbsp;<span class="string" id="8019203">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8019937">r</span>&nbsp;<span class="op" id="8019939">:=</span>&nbsp;<span class="ident" id="8019942">NewReader</span><span class="op" id="8019951">(</span><span class="ident" id="8019952">strings</span><span class="op" id="8019959">.</span><span class="ident" id="8019960">NewReader</span><span class="op" id="8019969">(</span><span class="ident" id="8019970">body</span><span class="op" id="8019974">)</span><span class="op" id="8019975">,</span>&nbsp;<span class="string" id="8019977">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="8020007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020010">part</span><span class="op" id="8020014">,</span>&nbsp;<span class="ident" id="8020016">err</span>&nbsp;<span class="op" id="8020020">:=</span>&nbsp;<span class="ident" id="8020023">r</span><span class="op" id="8020024">.</span><span class="ident" id="8020025">NextPart</span><span class="op" id="8020033">(</span><span class="op" id="8020034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8020037">if</span>&nbsp;<span class="ident" id="8020040">err</span>&nbsp;<span class="op" id="8020044">!=</span>&nbsp;<span class="builtintype" id="8020047">nil</span>&nbsp;<span class="op" id="8020051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020055">t</span><span class="op" id="8020056">.</span><span class="ident" id="8020057">Fatal</span><span class="op" id="8020062">(</span><span class="ident" id="8020063">err</span><span class="op" id="8020066">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8020069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8020072">if</span>&nbsp;<span class="ident" id="8020075">te</span><span class="op" id="8020077">,</span>&nbsp;<span class="ident" id="8020079">ok</span>&nbsp;<span class="op" id="8020082">:=</span>&nbsp;<span class="ident" id="8020085">part</span><span class="op" id="8020089">.</span><span class="ident" id="8020090">Header</span><span class="op" id="8020096">[</span><span class="string" id="8020097">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="8020124">]</span><span class="op" id="8020125">;</span>&nbsp;<span class="ident" id="8020127">ok</span>&nbsp;<span class="op" id="8020130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020134">t</span><span class="op" id="8020135">.</span><span class="ident" id="8020136">Errorf</span><span class="op" id="8020142">(</span><span class="string" id="8020143">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8020187">,</span>&nbsp;<span class="ident" id="8020189">te</span><span class="op" id="8020191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8020194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8020197">var</span>&nbsp;<span class="ident" id="8020201">buf</span>&nbsp;<span class="ident" id="8020205">bytes</span><span class="op" id="8020210">.</span><span class="ident" id="8020211">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020219">_</span><span class="op" id="8020220">,</span>&nbsp;<span class="ident" id="8020222">err</span>&nbsp;<span class="op" id="8020226">=</span>&nbsp;<span class="ident" id="8020228">io</span><span class="op" id="8020230">.</span><span class="ident" id="8020231">Copy</span><span class="op" id="8020235">(</span><span class="op" id="8020236">&amp;</span><span class="ident" id="8020237">buf</span><span class="op" id="8020240">,</span>&nbsp;<span class="ident" id="8020242">part</span><span class="op" id="8020246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8020249">if</span>&nbsp;<span class="ident" id="8020252">err</span>&nbsp;<span class="op" id="8020256">!=</span>&nbsp;<span class="builtintype" id="8020259">nil</span>&nbsp;<span class="op" id="8020263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020267">t</span><span class="op" id="8020268">.</span><span class="ident" id="8020269">Error</span><span class="op" id="8020274">(</span><span class="ident" id="8020275">err</span><span class="op" id="8020278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8020281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020284">got</span>&nbsp;<span class="op" id="8020288">:=</span>&nbsp;<span class="ident" id="8020291">buf</span><span class="op" id="8020294">.</span><span class="ident" id="8020295">String</span><span class="op" id="8020301">(</span><span class="op" id="8020302">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020305">want</span>&nbsp;<span class="op" id="8020310">:=</span>&nbsp;<span class="string" id="8020313">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8020670">if</span>&nbsp;<span class="ident" id="8020673">got</span>&nbsp;<span class="op" id="8020677">!=</span>&nbsp;<span class="ident" id="8020680">want</span>&nbsp;<span class="op" id="8020685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020689">t</span><span class="op" id="8020690">.</span><span class="ident" id="8020691">Errorf</span><span class="op" id="8020697">(</span><span class="string" id="8020698">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="8020737">,</span>&nbsp;<span class="ident" id="8020739">got</span><span class="op" id="8020742">,</span>&nbsp;<span class="ident" id="8020744">want</span><span class="op" id="8020748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8020751">}</span><br>
<span class="lineno"></span><span class="op" id="8020753">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="8020756">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="8020829">func</span>&nbsp;<span class="ident" id="8020834">TestNested</span><span class="op" id="8020844">(</span><span class="ident" id="8020845">t</span>&nbsp;<span class="op" id="8020847">*</span><span class="ident" id="8020848">testing</span><span class="op" id="8020855">.</span><span class="ident" id="8020856">T</span><span class="op" id="8020857">)</span>&nbsp;<span class="op" id="8020859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8020862">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8020922">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8020969">f</span><span class="op" id="8020970">,</span>&nbsp;<span class="ident" id="8020972">err</span>&nbsp;<span class="op" id="8020976">:=</span>&nbsp;<span class="ident" id="8020979">os</span><span class="op" id="8020981">.</span><span class="ident" id="8020982">Open</span><span class="op" id="8020986">(</span><span class="string" id="8020987">&#34;testdata/nested-mime&#34;</span><span class="op" id="8021009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021012">if</span>&nbsp;<span class="ident" id="8021015">err</span>&nbsp;<span class="op" id="8021019">!=</span>&nbsp;<span class="builtintype" id="8021022">nil</span>&nbsp;<span class="op" id="8021026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021030">t</span><span class="op" id="8021031">.</span><span class="ident" id="8021032">Fatal</span><span class="op" id="8021037">(</span><span class="ident" id="8021038">err</span><span class="op" id="8021041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021047">defer</span>&nbsp;<span class="ident" id="8021053">f</span><span class="op" id="8021054">.</span><span class="ident" id="8021055">Close</span><span class="op" id="8021060">(</span><span class="op" id="8021061">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021064">mr</span>&nbsp;<span class="op" id="8021067">:=</span>&nbsp;<span class="ident" id="8021070">NewReader</span><span class="op" id="8021079">(</span><span class="ident" id="8021080">f</span><span class="op" id="8021081">,</span>&nbsp;<span class="string" id="8021083">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="8021113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021116">p</span><span class="op" id="8021117">,</span>&nbsp;<span class="ident" id="8021119">err</span>&nbsp;<span class="op" id="8021123">:=</span>&nbsp;<span class="ident" id="8021126">mr</span><span class="op" id="8021128">.</span><span class="ident" id="8021129">NextPart</span><span class="op" id="8021137">(</span><span class="op" id="8021138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021141">if</span>&nbsp;<span class="ident" id="8021144">err</span>&nbsp;<span class="op" id="8021148">!=</span>&nbsp;<span class="builtintype" id="8021151">nil</span>&nbsp;<span class="op" id="8021155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021159">t</span><span class="op" id="8021160">.</span><span class="ident" id="8021161">Fatalf</span><span class="op" id="8021167">(</span><span class="string" id="8021168">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="8021215">,</span>&nbsp;<span class="ident" id="8021217">err</span><span class="op" id="8021220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021223">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8021227">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021310">mr2</span>&nbsp;<span class="op" id="8021314">:=</span>&nbsp;<span class="ident" id="8021317">NewReader</span><span class="op" id="8021326">(</span><span class="ident" id="8021327">p</span><span class="op" id="8021328">,</span>&nbsp;<span class="string" id="8021330">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="8021360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021363">p</span><span class="op" id="8021364">,</span>&nbsp;<span class="ident" id="8021366">err</span>&nbsp;<span class="op" id="8021370">=</span>&nbsp;<span class="ident" id="8021372">mr2</span><span class="op" id="8021375">.</span><span class="ident" id="8021376">NextPart</span><span class="op" id="8021384">(</span><span class="op" id="8021385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021388">if</span>&nbsp;<span class="ident" id="8021391">err</span>&nbsp;<span class="op" id="8021395">!=</span>&nbsp;<span class="builtintype" id="8021398">nil</span>&nbsp;<span class="op" id="8021402">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021406">t</span><span class="op" id="8021407">.</span><span class="ident" id="8021408">Fatalf</span><span class="op" id="8021414">(</span><span class="string" id="8021415">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8021444">,</span>&nbsp;<span class="ident" id="8021446">err</span><span class="op" id="8021449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021455">if</span>&nbsp;<span class="ident" id="8021458">b</span><span class="op" id="8021459">,</span>&nbsp;<span class="ident" id="8021461">err</span>&nbsp;<span class="op" id="8021465">:=</span>&nbsp;<span class="ident" id="8021468">ioutil</span><span class="op" id="8021474">.</span><span class="ident" id="8021475">ReadAll</span><span class="op" id="8021482">(</span><span class="ident" id="8021483">p</span><span class="op" id="8021484">)</span><span class="op" id="8021485">;</span>&nbsp;<span class="builtintype" id="8021487">string</span><span class="op" id="8021493">(</span><span class="ident" id="8021494">b</span><span class="op" id="8021495">)</span>&nbsp;<span class="op" id="8021497">!=</span>&nbsp;<span class="string" id="8021500">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="8021513">||</span>&nbsp;<span class="ident" id="8021516">err</span>&nbsp;<span class="op" id="8021520">!=</span>&nbsp;<span class="builtintype" id="8021523">nil</span>&nbsp;<span class="op" id="8021527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021531">t</span><span class="op" id="8021532">.</span><span class="ident" id="8021533">Fatalf</span><span class="op" id="8021539">(</span><span class="string" id="8021540">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8021577">,</span>&nbsp;<span class="ident" id="8021579">b</span><span class="op" id="8021580">,</span>&nbsp;<span class="ident" id="8021582">err</span><span class="op" id="8021585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021588">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021591">p</span><span class="op" id="8021592">,</span>&nbsp;<span class="ident" id="8021594">err</span>&nbsp;<span class="op" id="8021598">=</span>&nbsp;<span class="ident" id="8021600">mr2</span><span class="op" id="8021603">.</span><span class="ident" id="8021604">NextPart</span><span class="op" id="8021612">(</span><span class="op" id="8021613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021616">if</span>&nbsp;<span class="ident" id="8021619">err</span>&nbsp;<span class="op" id="8021623">!=</span>&nbsp;<span class="builtintype" id="8021626">nil</span>&nbsp;<span class="op" id="8021630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021634">t</span><span class="op" id="8021635">.</span><span class="ident" id="8021636">Fatalf</span><span class="op" id="8021642">(</span><span class="string" id="8021643">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8021671">,</span>&nbsp;<span class="ident" id="8021673">err</span><span class="op" id="8021676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021682">if</span>&nbsp;<span class="ident" id="8021685">b</span><span class="op" id="8021686">,</span>&nbsp;<span class="ident" id="8021688">err</span>&nbsp;<span class="op" id="8021692">:=</span>&nbsp;<span class="ident" id="8021695">ioutil</span><span class="op" id="8021701">.</span><span class="ident" id="8021702">ReadAll</span><span class="op" id="8021709">(</span><span class="ident" id="8021710">p</span><span class="op" id="8021711">)</span><span class="op" id="8021712">;</span>&nbsp;<span class="builtintype" id="8021714">string</span><span class="op" id="8021720">(</span><span class="ident" id="8021721">b</span><span class="op" id="8021722">)</span>&nbsp;<span class="op" id="8021724">!=</span>&nbsp;<span class="string" id="8021727">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="8021745">||</span>&nbsp;<span class="ident" id="8021748">err</span>&nbsp;<span class="op" id="8021752">!=</span>&nbsp;<span class="builtintype" id="8021755">nil</span>&nbsp;<span class="op" id="8021759">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021763">t</span><span class="op" id="8021764">.</span><span class="ident" id="8021765">Fatalf</span><span class="op" id="8021771">(</span><span class="string" id="8021772">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8021808">,</span>&nbsp;<span class="ident" id="8021810">b</span><span class="op" id="8021811">,</span>&nbsp;<span class="ident" id="8021813">err</span><span class="op" id="8021816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021823">p</span><span class="op" id="8021824">,</span>&nbsp;<span class="ident" id="8021826">err</span>&nbsp;<span class="op" id="8021830">=</span>&nbsp;<span class="ident" id="8021832">mr2</span><span class="op" id="8021835">.</span><span class="ident" id="8021836">NextPart</span><span class="op" id="8021844">(</span><span class="op" id="8021845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8021848">if</span>&nbsp;<span class="ident" id="8021851">err</span>&nbsp;<span class="op" id="8021855">!=</span>&nbsp;<span class="ident" id="8021858">io</span><span class="op" id="8021860">.</span><span class="ident" id="8021861">EOF</span>&nbsp;<span class="op" id="8021865">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021869">t</span><span class="op" id="8021870">.</span><span class="ident" id="8021871">Fatalf</span><span class="op" id="8021877">(</span><span class="string" id="8021878">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8021918">,</span>&nbsp;<span class="ident" id="8021920">err</span><span class="op" id="8021923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8021926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8021930">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8021999">_</span><span class="op" id="8022000">,</span>&nbsp;<span class="ident" id="8022002">err</span>&nbsp;<span class="op" id="8022006">=</span>&nbsp;<span class="ident" id="8022008">mr</span><span class="op" id="8022010">.</span><span class="ident" id="8022011">NextPart</span><span class="op" id="8022019">(</span><span class="op" id="8022020">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8022023">if</span>&nbsp;<span class="ident" id="8022026">err</span>&nbsp;<span class="op" id="8022030">!=</span>&nbsp;<span class="builtintype" id="8022033">nil</span>&nbsp;<span class="op" id="8022037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022041">t</span><span class="op" id="8022042">.</span><span class="ident" id="8022043">Fatalf</span><span class="op" id="8022049">(</span><span class="string" id="8022050">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="8022101">,</span>&nbsp;<span class="ident" id="8022103">err</span><span class="op" id="8022106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022113">_</span><span class="op" id="8022114">,</span>&nbsp;<span class="ident" id="8022116">err</span>&nbsp;<span class="op" id="8022120">=</span>&nbsp;<span class="ident" id="8022122">mr</span><span class="op" id="8022124">.</span><span class="ident" id="8022125">NextPart</span><span class="op" id="8022133">(</span><span class="op" id="8022134">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8022137">if</span>&nbsp;<span class="ident" id="8022140">err</span>&nbsp;<span class="op" id="8022144">!=</span>&nbsp;<span class="ident" id="8022147">io</span><span class="op" id="8022149">.</span><span class="ident" id="8022150">EOF</span>&nbsp;<span class="op" id="8022154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022158">t</span><span class="op" id="8022159">.</span><span class="ident" id="8022160">Fatalf</span><span class="op" id="8022166">(</span><span class="string" id="8022167">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8022207">,</span>&nbsp;<span class="ident" id="8022209">err</span><span class="op" id="8022212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022215">}</span><br>
<span class="lineno"></span><span class="op" id="8022217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="8022220">type</span>&nbsp;<span class="ident" id="8022225">headerBody</span>&nbsp;<span class="keyword" id="8022236">struct</span>&nbsp;<span class="op" id="8022243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022246">header</span>&nbsp;<span class="ident" id="8022253">textproto</span><span class="op" id="8022262">.</span><span class="ident" id="8022263">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022275">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8022282">string</span><br>
<span class="lineno"></span><span class="op" id="8022289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8022292">func</span>&nbsp;<span class="ident" id="8022297">formData</span><span class="op" id="8022305">(</span><span class="ident" id="8022306">key</span><span class="op" id="8022309">,</span>&nbsp;<span class="ident" id="8022311">value</span>&nbsp;<span class="builtintype" id="8022317">string</span><span class="op" id="8022323">)</span>&nbsp;<span class="ident" id="8022325">headerBody</span>&nbsp;<span class="op" id="8022336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8022339">return</span>&nbsp;<span class="ident" id="8022346">headerBody</span><span class="op" id="8022356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022360">textproto</span><span class="op" id="8022369">.</span><span class="ident" id="8022370">MIMEHeader</span><span class="op" id="8022380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8022385">&#34;Content-Type&#34;</span><span class="op" id="8022399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022408">{</span><span class="string" id="8022409">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="8022441">}</span><span class="op" id="8022442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8022447">&#34;Content-Disposition&#34;</span><span class="op" id="8022468">:</span>&nbsp;<span class="op" id="8022470">{</span><span class="string" id="8022471">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="8022490">+</span>&nbsp;<span class="ident" id="8022492">key</span><span class="op" id="8022495">}</span><span class="op" id="8022496">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022500">}</span><span class="op" id="8022501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022505">value</span><span class="op" id="8022510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022513">}</span><br>
<span class="lineno"></span><span class="op" id="8022515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="8022518">type</span>&nbsp;<span class="ident" id="8022523">parseTest</span>&nbsp;<span class="keyword" id="8022533">struct</span>&nbsp;<span class="op" id="8022540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022543">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8022551">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022559">in</span><span class="op" id="8022561">,</span>&nbsp;<span class="ident" id="8022563">sep</span>&nbsp;<span class="builtintype" id="8022567">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8022575">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8022583">[</span><span class="op" id="8022584">]</span><span class="ident" id="8022585">headerBody</span><br>
<span class="lineno"></span><span class="op" id="8022596">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8022599">var</span>&nbsp;<span class="ident" id="8022603">parseTests</span>&nbsp;<span class="op" id="8022614">=</span>&nbsp;<span class="op" id="8022616">[</span><span class="op" id="8022617">]</span><span class="ident" id="8022618">parseTest</span><span class="op" id="8022627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022630">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022700">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022769">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022835">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022898">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8022964">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8023027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8023031">name</span><span class="op" id="8023035">:</span>&nbsp;<span class="string" id="8023037">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="8023054">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8023058">sep</span><span class="op" id="8023061">:</span>&nbsp;&nbsp;<span class="string" id="8023064">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="8023094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8023098">in</span><span class="op" id="8023100">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8023104">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="8025012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025016">want</span><span class="op" id="8025020">:</span>&nbsp;<span class="op" id="8025022">[</span><span class="op" id="8025023">]</span><span class="ident" id="8025024">headerBody</span><span class="op" id="8025034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025039">formData</span><span class="op" id="8025047">(</span><span class="string" id="8025048">&#34;otherEmpty1&#34;</span><span class="op" id="8025061">,</span>&nbsp;<span class="string" id="8025063">&#34;&#34;</span><span class="op" id="8025065">)</span><span class="op" id="8025066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025071">formData</span><span class="op" id="8025079">(</span><span class="string" id="8025080">&#34;otherFoo1&#34;</span><span class="op" id="8025091">,</span>&nbsp;<span class="string" id="8025093">&#34;foo&#34;</span><span class="op" id="8025098">)</span><span class="op" id="8025099">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025104">formData</span><span class="op" id="8025112">(</span><span class="string" id="8025113">&#34;otherFoo2&#34;</span><span class="op" id="8025124">,</span>&nbsp;<span class="string" id="8025126">&#34;foo&#34;</span><span class="op" id="8025131">)</span><span class="op" id="8025132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025137">formData</span><span class="op" id="8025145">(</span><span class="string" id="8025146">&#34;otherEmpty2&#34;</span><span class="op" id="8025159">,</span>&nbsp;<span class="string" id="8025161">&#34;&#34;</span><span class="op" id="8025163">)</span><span class="op" id="8025164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025169">formData</span><span class="op" id="8025177">(</span><span class="string" id="8025178">&#34;otherRepeatFoo&#34;</span><span class="op" id="8025194">,</span>&nbsp;<span class="string" id="8025196">&#34;foo&#34;</span><span class="op" id="8025201">)</span><span class="op" id="8025202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025207">formData</span><span class="op" id="8025215">(</span><span class="string" id="8025216">&#34;otherRepeatFoo&#34;</span><span class="op" id="8025232">,</span>&nbsp;<span class="string" id="8025234">&#34;foo&#34;</span><span class="op" id="8025239">)</span><span class="op" id="8025240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025245">formData</span><span class="op" id="8025253">(</span><span class="string" id="8025254">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8025272">,</span>&nbsp;<span class="string" id="8025274">&#34;&#34;</span><span class="op" id="8025276">)</span><span class="op" id="8025277">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025282">formData</span><span class="op" id="8025290">(</span><span class="string" id="8025291">&#34;otherRepeatEmpty&#34;</span><span class="op" id="8025309">,</span>&nbsp;<span class="string" id="8025311">&#34;&#34;</span><span class="op" id="8025313">)</span><span class="op" id="8025314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8025319">formData</span><span class="op" id="8025327">(</span><span class="string" id="8025328">&#34;submit&#34;</span><span class="op" id="8025336">,</span>&nbsp;<span class="string" id="8025338">&#34;Submit&#34;</span><span class="op" id="8025346">)</span><span class="op" id="8025347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8025352">{</span><span class="ident" id="8025353">textproto</span><span class="op" id="8025362">.</span><span class="ident" id="8025363">MIMEHeader</span><span class="op" id="8025373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8025379">&#34;Content-Type&#34;</span><span class="op" id="8025393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8025402">{</span><span class="string" id="8025403">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="8025619">}</span><span class="op" id="8025620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8025626">&#34;Content-Disposition&#34;</span><span class="op" id="8025647">:</span>&nbsp;<span class="op" id="8025649">{</span><span class="string" id="8025650">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="8025695">}</span><span class="op" id="8025696">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8025701">}</span><span class="op" id="8025702">,</span>&nbsp;<span class="string" id="8025704">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="8025951">}</span><span class="op" id="8025952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8025956">}</span><span class="op" id="8025957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8025960">}</span><span class="op" id="8025961">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8025965">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026041">name</span><span class="op" id="8026045">:</span>&nbsp;<span class="string" id="8026047">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="8026078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026082">sep</span><span class="op" id="8026085">:</span>&nbsp;&nbsp;<span class="string" id="8026088">&#34;abc&#34;</span><span class="op" id="8026093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026097">in</span><span class="op" id="8026099">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8026103">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="8026137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026141">want</span><span class="op" id="8026145">:</span>&nbsp;<span class="op" id="8026147">[</span><span class="op" id="8026148">]</span><span class="ident" id="8026149">headerBody</span><span class="op" id="8026159">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026164">{</span><span class="ident" id="8026165">textproto</span><span class="op" id="8026174">.</span><span class="ident" id="8026175">MIMEHeader</span><span class="op" id="8026185">{</span><span class="string" id="8026186">&#34;Foo&#34;</span><span class="op" id="8026191">:</span>&nbsp;<span class="op" id="8026193">{</span><span class="string" id="8026194">&#34;bar&#34;</span><span class="op" id="8026199">}</span><span class="op" id="8026200">}</span><span class="op" id="8026201">,</span>&nbsp;<span class="string" id="8026203">&#34;&#34;</span><span class="op" id="8026205">}</span><span class="op" id="8026206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026210">}</span><span class="op" id="8026211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026214">}</span><span class="op" id="8026215">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8026219">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026299">name</span><span class="op" id="8026303">:</span>&nbsp;<span class="string" id="8026305">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="8026340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026344">sep</span><span class="op" id="8026347">:</span>&nbsp;&nbsp;<span class="string" id="8026350">&#34;abc&#34;</span><span class="op" id="8026355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026359">in</span><span class="op" id="8026361">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8026365">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="8026403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026407">want</span><span class="op" id="8026411">:</span>&nbsp;<span class="op" id="8026413">[</span><span class="op" id="8026414">]</span><span class="ident" id="8026415">headerBody</span><span class="op" id="8026425">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026430">{</span><span class="ident" id="8026431">textproto</span><span class="op" id="8026440">.</span><span class="ident" id="8026441">MIMEHeader</span><span class="op" id="8026451">{</span><span class="string" id="8026452">&#34;Foo&#34;</span><span class="op" id="8026457">:</span>&nbsp;<span class="op" id="8026459">{</span><span class="string" id="8026460">&#34;bar&#34;</span><span class="op" id="8026465">}</span><span class="op" id="8026466">}</span><span class="op" id="8026467">,</span>&nbsp;<span class="string" id="8026469">&#34;&#34;</span><span class="op" id="8026471">}</span><span class="op" id="8026472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026476">}</span><span class="op" id="8026477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026480">}</span><span class="op" id="8026481">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8026485">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026511">name</span><span class="op" id="8026515">:</span>&nbsp;<span class="string" id="8026517">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="8026535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026539">sep</span><span class="op" id="8026542">:</span>&nbsp;&nbsp;<span class="string" id="8026545">&#34;abc&#34;</span><span class="op" id="8026550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026554">in</span><span class="op" id="8026556">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8026560">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="8026621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026625">want</span><span class="op" id="8026629">:</span>&nbsp;<span class="op" id="8026631">[</span><span class="op" id="8026632">]</span><span class="ident" id="8026633">headerBody</span><span class="op" id="8026643">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026648">{</span><span class="ident" id="8026649">textproto</span><span class="op" id="8026658">.</span><span class="ident" id="8026659">MIMEHeader</span><span class="op" id="8026669">{</span><span class="string" id="8026670">&#34;Foo&#34;</span><span class="op" id="8026675">:</span>&nbsp;<span class="op" id="8026677">{</span><span class="string" id="8026678">&#34;bar&#34;</span><span class="op" id="8026683">}</span><span class="op" id="8026684">}</span><span class="op" id="8026685">,</span>&nbsp;<span class="string" id="8026687">&#34;&#34;</span><span class="op" id="8026689">}</span><span class="op" id="8026690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026695">{</span><span class="ident" id="8026696">textproto</span><span class="op" id="8026705">.</span><span class="ident" id="8026706">MIMEHeader</span><span class="op" id="8026716">{</span><span class="string" id="8026717">&#34;Foo2&#34;</span><span class="op" id="8026723">:</span>&nbsp;<span class="op" id="8026725">{</span><span class="string" id="8026726">&#34;bar2&#34;</span><span class="op" id="8026732">}</span><span class="op" id="8026733">}</span><span class="op" id="8026734">,</span>&nbsp;<span class="string" id="8026736">&#34;&#34;</span><span class="op" id="8026738">}</span><span class="op" id="8026739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026743">}</span><span class="op" id="8026744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026747">}</span><span class="op" id="8026748">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8026752">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026814">name</span><span class="op" id="8026818">:</span>&nbsp;<span class="string" id="8026820">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="8026848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026852">sep</span><span class="op" id="8026855">:</span>&nbsp;&nbsp;<span class="string" id="8026858">&#34;abc&#34;</span><span class="op" id="8026863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026867">in</span><span class="op" id="8026869">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8026873">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="8026911">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8026915">want</span><span class="op" id="8026919">:</span>&nbsp;<span class="op" id="8026921">[</span><span class="op" id="8026922">]</span><span class="ident" id="8026923">headerBody</span><span class="op" id="8026933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026938">{</span><span class="ident" id="8026939">textproto</span><span class="op" id="8026948">.</span><span class="ident" id="8026949">MIMEHeader</span><span class="op" id="8026959">{</span><span class="string" id="8026960">&#34;Foo&#34;</span><span class="op" id="8026965">:</span>&nbsp;<span class="op" id="8026967">{</span><span class="string" id="8026968">&#34;bar&#34;</span><span class="op" id="8026973">}</span><span class="op" id="8026974">}</span><span class="op" id="8026975">,</span>&nbsp;<span class="string" id="8026977">&#34;&#34;</span><span class="op" id="8026979">}</span><span class="op" id="8026980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026984">}</span><span class="op" id="8026985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8026988">}</span><span class="op" id="8026989">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8026993">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027057">name</span><span class="op" id="8027061">:</span>&nbsp;<span class="string" id="8027063">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="8027091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027095">sep</span><span class="op" id="8027098">:</span>&nbsp;&nbsp;<span class="string" id="8027101">&#34;abc&#34;</span><span class="op" id="8027106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027110">in</span><span class="op" id="8027112">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8027116">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="8027153">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027157">want</span><span class="op" id="8027161">:</span>&nbsp;<span class="op" id="8027163">[</span><span class="op" id="8027164">]</span><span class="ident" id="8027165">headerBody</span><span class="op" id="8027175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027180">{</span><span class="ident" id="8027181">textproto</span><span class="op" id="8027190">.</span><span class="ident" id="8027191">MIMEHeader</span><span class="op" id="8027201">{</span><span class="string" id="8027202">&#34;Foo&#34;</span><span class="op" id="8027207">:</span>&nbsp;<span class="op" id="8027209">{</span><span class="string" id="8027210">&#34;bar&#34;</span><span class="op" id="8027215">}</span><span class="op" id="8027216">}</span><span class="op" id="8027217">,</span>&nbsp;<span class="string" id="8027219">&#34;&#34;</span><span class="op" id="8027221">}</span><span class="op" id="8027222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027226">}</span><span class="op" id="8027227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027230">}</span><span class="op" id="8027231">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8027235">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027288">name</span><span class="op" id="8027292">:</span>&nbsp;<span class="string" id="8027294">&#34;no&nbsp;parts&#34;</span><span class="op" id="8027304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027308">sep</span><span class="op" id="8027311">:</span>&nbsp;&nbsp;<span class="string" id="8027314">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="8027354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027358">in</span><span class="op" id="8027360">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8027364">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="8027412">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027416">want</span><span class="op" id="8027420">:</span>&nbsp;<span class="op" id="8027422">[</span><span class="op" id="8027423">]</span><span class="ident" id="8027424">headerBody</span><span class="op" id="8027434">{</span><span class="op" id="8027435">}</span><span class="op" id="8027436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027439">}</span><span class="op" id="8027440">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8027444">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027525">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027529">name</span><span class="op" id="8027533">:</span>&nbsp;<span class="string" id="8027535">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="8027559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027563">sep</span><span class="op" id="8027566">:</span>&nbsp;&nbsp;<span class="string" id="8027569">&#34;sep&#34;</span><span class="op" id="8027574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027578">in</span><span class="op" id="8027580">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8027584">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="8027631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027635">want</span><span class="op" id="8027639">:</span>&nbsp;<span class="op" id="8027641">[</span><span class="op" id="8027642">]</span><span class="ident" id="8027643">headerBody</span><span class="op" id="8027653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027658">{</span><span class="ident" id="8027659">textproto</span><span class="op" id="8027668">.</span><span class="ident" id="8027669">MIMEHeader</span><span class="op" id="8027679">{</span><span class="string" id="8027680">&#34;Foo&#34;</span><span class="op" id="8027685">:</span>&nbsp;<span class="op" id="8027687">{</span><span class="string" id="8027688">&#34;bar&#34;</span><span class="op" id="8027693">}</span><span class="op" id="8027694">}</span><span class="op" id="8027695">,</span>&nbsp;<span class="string" id="8027697">&#34;--sepFAKE&#34;</span><span class="op" id="8027708">}</span><span class="op" id="8027709">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027713">}</span><span class="op" id="8027714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027717">}</span><span class="op" id="8027718">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8027722">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027783">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027787">name</span><span class="op" id="8027791">:</span>&nbsp;<span class="string" id="8027793">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="8027819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027823">sep</span><span class="op" id="8027826">:</span>&nbsp;&nbsp;<span class="string" id="8027829">&#34;sep&#34;</span><span class="op" id="8027834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027838">in</span><span class="op" id="8027840">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8027844">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="8027887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8027891">want</span><span class="op" id="8027895">:</span>&nbsp;<span class="op" id="8027897">[</span><span class="op" id="8027898">]</span><span class="ident" id="8027899">headerBody</span><span class="op" id="8027909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027914">{</span><span class="ident" id="8027915">textproto</span><span class="op" id="8027924">.</span><span class="ident" id="8027925">MIMEHeader</span><span class="op" id="8027935">{</span><span class="string" id="8027936">&#34;Foo&#34;</span><span class="op" id="8027941">:</span>&nbsp;<span class="op" id="8027943">{</span><span class="string" id="8027944">&#34;bar&#34;</span><span class="op" id="8027949">}</span><span class="op" id="8027950">}</span><span class="op" id="8027951">,</span>&nbsp;<span class="string" id="8027953">&#34;text&#34;</span><span class="op" id="8027959">}</span><span class="op" id="8027960">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027964">}</span><span class="op" id="8027965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8027968">}</span><span class="op" id="8027969">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8027973">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028004">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028008">name</span><span class="op" id="8028012">:</span>&nbsp;<span class="string" id="8028014">&#34;leading&nbsp;line&#34;</span><span class="op" id="8028028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028032">sep</span><span class="op" id="8028035">:</span>&nbsp;&nbsp;<span class="string" id="8028038">&#34;MyBoundary&#34;</span><span class="op" id="8028050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028054">in</span><span class="op" id="8028056">:</span>&nbsp;<span class="ident" id="8028058">strings</span><span class="op" id="8028065">.</span><span class="ident" id="8028066">Replace</span><span class="op" id="8028073">(</span><span class="string" id="8028074">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="8028167">,</span>&nbsp;<span class="string" id="8028169">&#34;\n&#34;</span><span class="op" id="8028173">,</span>&nbsp;<span class="string" id="8028175">&#34;\r\n&#34;</span><span class="op" id="8028181">,</span>&nbsp;<span class="op" id="8028183">-</span><span class="num" id="8028184">1</span><span class="op" id="8028185">)</span><span class="op" id="8028186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028190">want</span><span class="op" id="8028194">:</span>&nbsp;<span class="op" id="8028196">[</span><span class="op" id="8028197">]</span><span class="ident" id="8028198">headerBody</span><span class="op" id="8028208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028213">{</span><span class="ident" id="8028214">textproto</span><span class="op" id="8028223">.</span><span class="ident" id="8028224">MIMEHeader</span><span class="op" id="8028234">{</span><span class="string" id="8028235">&#34;Foo&#34;</span><span class="op" id="8028240">:</span>&nbsp;<span class="op" id="8028242">{</span><span class="string" id="8028243">&#34;bar&#34;</span><span class="op" id="8028248">}</span><span class="op" id="8028249">}</span><span class="op" id="8028250">,</span>&nbsp;<span class="string" id="8028252">&#34;&#34;</span><span class="op" id="8028254">}</span><span class="op" id="8028255">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028259">}</span><span class="op" id="8028260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028263">}</span><span class="op" id="8028264">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028268">roundTripParseTest</span><span class="op" id="8028286">(</span><span class="op" id="8028287">)</span><span class="op" id="8028288">,</span><br>
<span class="lineno"></span><span class="op" id="8028290">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="8028293">func</span>&nbsp;<span class="ident" id="8028298">TestParse</span><span class="op" id="8028307">(</span><span class="ident" id="8028308">t</span>&nbsp;<span class="op" id="8028310">*</span><span class="ident" id="8028311">testing</span><span class="op" id="8028318">.</span><span class="ident" id="8028319">T</span><span class="op" id="8028320">)</span>&nbsp;<span class="op" id="8028322">{</span><br>
<span class="lineno"></span><span class="ident" id="8028324">Cases</span><span class="op" id="8028329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028332">for</span>&nbsp;<span class="ident" id="8028336">_</span><span class="op" id="8028337">,</span>&nbsp;<span class="ident" id="8028339">tt</span>&nbsp;<span class="op" id="8028342">:=</span>&nbsp;<span class="keyword" id="8028345">range</span>&nbsp;<span class="ident" id="8028351">parseTests</span>&nbsp;<span class="op" id="8028362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028366">r</span>&nbsp;<span class="op" id="8028368">:=</span>&nbsp;<span class="ident" id="8028371">NewReader</span><span class="op" id="8028380">(</span><span class="ident" id="8028381">strings</span><span class="op" id="8028388">.</span><span class="ident" id="8028389">NewReader</span><span class="op" id="8028398">(</span><span class="ident" id="8028399">tt</span><span class="op" id="8028401">.</span><span class="ident" id="8028402">in</span><span class="op" id="8028404">)</span><span class="op" id="8028405">,</span>&nbsp;<span class="ident" id="8028407">tt</span><span class="op" id="8028409">.</span><span class="ident" id="8028410">sep</span><span class="op" id="8028413">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028417">got</span>&nbsp;<span class="op" id="8028421">:=</span>&nbsp;<span class="op" id="8028424">[</span><span class="op" id="8028425">]</span><span class="ident" id="8028426">headerBody</span><span class="op" id="8028436">{</span><span class="op" id="8028437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028441">for</span>&nbsp;<span class="op" id="8028445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028450">p</span><span class="op" id="8028451">,</span>&nbsp;<span class="ident" id="8028453">err</span>&nbsp;<span class="op" id="8028457">:=</span>&nbsp;<span class="ident" id="8028460">r</span><span class="op" id="8028461">.</span><span class="ident" id="8028462">NextPart</span><span class="op" id="8028470">(</span><span class="op" id="8028471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028476">if</span>&nbsp;<span class="ident" id="8028479">err</span>&nbsp;<span class="op" id="8028483">==</span>&nbsp;<span class="ident" id="8028486">io</span><span class="op" id="8028488">.</span><span class="ident" id="8028489">EOF</span>&nbsp;<span class="op" id="8028493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028499">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028513">if</span>&nbsp;<span class="ident" id="8028516">err</span>&nbsp;<span class="op" id="8028520">!=</span>&nbsp;<span class="builtintype" id="8028523">nil</span>&nbsp;<span class="op" id="8028527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028533">t</span><span class="op" id="8028534">.</span><span class="ident" id="8028535">Errorf</span><span class="op" id="8028541">(</span><span class="string" id="8028542">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="8028568">,</span>&nbsp;<span class="ident" id="8028570">tt</span><span class="op" id="8028572">.</span><span class="ident" id="8028573">name</span><span class="op" id="8028577">,</span>&nbsp;<span class="ident" id="8028579">err</span><span class="op" id="8028582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028588">continue</span>&nbsp;<span class="ident" id="8028597">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028606">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028611">pbody</span><span class="op" id="8028616">,</span>&nbsp;<span class="ident" id="8028618">err</span>&nbsp;<span class="op" id="8028622">:=</span>&nbsp;<span class="ident" id="8028625">ioutil</span><span class="op" id="8028631">.</span><span class="ident" id="8028632">ReadAll</span><span class="op" id="8028639">(</span><span class="ident" id="8028640">p</span><span class="op" id="8028641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028646">if</span>&nbsp;<span class="ident" id="8028649">err</span>&nbsp;<span class="op" id="8028653">!=</span>&nbsp;<span class="builtintype" id="8028656">nil</span>&nbsp;<span class="op" id="8028660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028666">t</span><span class="op" id="8028667">.</span><span class="ident" id="8028668">Errorf</span><span class="op" id="8028674">(</span><span class="string" id="8028675">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="8028711">,</span>&nbsp;<span class="ident" id="8028713">tt</span><span class="op" id="8028715">.</span><span class="ident" id="8028716">name</span><span class="op" id="8028720">,</span>&nbsp;<span class="ident" id="8028722">err</span><span class="op" id="8028725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028731">continue</span>&nbsp;<span class="ident" id="8028740">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028749">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028754">got</span>&nbsp;<span class="op" id="8028758">=</span>&nbsp;<span class="builtinfunc" id="8028760">append</span><span class="op" id="8028766">(</span><span class="ident" id="8028767">got</span><span class="op" id="8028770">,</span>&nbsp;<span class="ident" id="8028772">headerBody</span><span class="op" id="8028782">{</span><span class="ident" id="8028783">p</span><span class="op" id="8028784">.</span><span class="ident" id="8028785">Header</span><span class="op" id="8028791">,</span>&nbsp;<span class="builtintype" id="8028793">string</span><span class="op" id="8028799">(</span><span class="ident" id="8028800">pbody</span><span class="op" id="8028805">)</span><span class="op" id="8028806">}</span><span class="op" id="8028807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8028811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028815">if</span>&nbsp;<span class="op" id="8028818">!</span><span class="ident" id="8028819">reflect</span><span class="op" id="8028826">.</span><span class="ident" id="8028827">DeepEqual</span><span class="op" id="8028836">(</span><span class="ident" id="8028837">tt</span><span class="op" id="8028839">.</span><span class="ident" id="8028840">want</span><span class="op" id="8028844">,</span>&nbsp;<span class="ident" id="8028846">got</span><span class="op" id="8028849">)</span>&nbsp;<span class="op" id="8028851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028856">t</span><span class="op" id="8028857">.</span><span class="ident" id="8028858">Errorf</span><span class="op" id="8028864">(</span><span class="string" id="8028865">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8028895">,</span>&nbsp;<span class="ident" id="8028897">tt</span><span class="op" id="8028899">.</span><span class="ident" id="8028900">name</span><span class="op" id="8028904">,</span>&nbsp;<span class="ident" id="8028906">got</span><span class="op" id="8028909">,</span>&nbsp;<span class="ident" id="8028911">tt</span><span class="op" id="8028913">.</span><span class="ident" id="8028914">want</span><span class="op" id="8028918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8028923">if</span>&nbsp;<span class="builtinfunc" id="8028926">len</span><span class="op" id="8028929">(</span><span class="ident" id="8028930">tt</span><span class="op" id="8028932">.</span><span class="ident" id="8028933">want</span><span class="op" id="8028937">)</span>&nbsp;<span class="op" id="8028939">!=</span>&nbsp;<span class="builtinfunc" id="8028942">len</span><span class="op" id="8028945">(</span><span class="ident" id="8028946">got</span><span class="op" id="8028949">)</span>&nbsp;<span class="op" id="8028951">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8028957">t</span><span class="op" id="8028958">.</span><span class="ident" id="8028959">Errorf</span><span class="op" id="8028965">(</span><span class="string" id="8028966">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8028998">,</span>&nbsp;<span class="ident" id="8029000">tt</span><span class="op" id="8029002">.</span><span class="ident" id="8029003">name</span><span class="op" id="8029007">,</span>&nbsp;<span class="builtinfunc" id="8029009">len</span><span class="op" id="8029012">(</span><span class="ident" id="8029013">got</span><span class="op" id="8029016">)</span><span class="op" id="8029017">,</span>&nbsp;<span class="builtinfunc" id="8029019">len</span><span class="op" id="8029022">(</span><span class="ident" id="8029023">tt</span><span class="op" id="8029025">.</span><span class="ident" id="8029026">want</span><span class="op" id="8029030">)</span><span class="op" id="8029031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029036">}</span>&nbsp;<span class="keyword" id="8029038">else</span>&nbsp;<span class="keyword" id="8029043">if</span>&nbsp;<span class="builtinfunc" id="8029046">len</span><span class="op" id="8029049">(</span><span class="ident" id="8029050">got</span><span class="op" id="8029053">)</span>&nbsp;<span class="op" id="8029055">&gt;</span>&nbsp;<span class="num" id="8029057">1</span>&nbsp;<span class="op" id="8029059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029065">for</span>&nbsp;<span class="ident" id="8029069">pi</span><span class="op" id="8029071">,</span>&nbsp;<span class="ident" id="8029073">wantPart</span>&nbsp;<span class="op" id="8029082">:=</span>&nbsp;<span class="keyword" id="8029085">range</span>&nbsp;<span class="ident" id="8029091">tt</span><span class="op" id="8029093">.</span><span class="ident" id="8029094">want</span>&nbsp;<span class="op" id="8029099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029106">if</span>&nbsp;<span class="op" id="8029109">!</span><span class="ident" id="8029110">reflect</span><span class="op" id="8029117">.</span><span class="ident" id="8029118">DeepEqual</span><span class="op" id="8029127">(</span><span class="ident" id="8029128">wantPart</span><span class="op" id="8029136">,</span>&nbsp;<span class="ident" id="8029138">got</span><span class="op" id="8029141">[</span><span class="ident" id="8029142">pi</span><span class="op" id="8029144">]</span><span class="op" id="8029145">)</span>&nbsp;<span class="op" id="8029147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029155">t</span><span class="op" id="8029156">.</span><span class="ident" id="8029157">Errorf</span><span class="op" id="8029163">(</span><span class="string" id="8029164">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="8029203">,</span>&nbsp;<span class="ident" id="8029205">tt</span><span class="op" id="8029207">.</span><span class="ident" id="8029208">name</span><span class="op" id="8029212">,</span>&nbsp;<span class="ident" id="8029214">pi</span><span class="op" id="8029216">,</span>&nbsp;<span class="ident" id="8029218">got</span><span class="op" id="8029221">[</span><span class="ident" id="8029222">pi</span><span class="op" id="8029224">]</span><span class="op" id="8029225">,</span>&nbsp;<span class="ident" id="8029227">wantPart</span><span class="op" id="8029235">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029260">}</span><br>
<span class="lineno">605</span><span class="op" id="8029262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8029265">func</span>&nbsp;<span class="ident" id="8029270">roundTripParseTest</span><span class="op" id="8029288">(</span><span class="op" id="8029289">)</span>&nbsp;<span class="ident" id="8029291">parseTest</span>&nbsp;<span class="op" id="8029301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029304">t</span>&nbsp;<span class="op" id="8029306">:=</span>&nbsp;<span class="ident" id="8029309">parseTest</span><span class="op" id="8029318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029322">name</span><span class="op" id="8029326">:</span>&nbsp;<span class="string" id="8029328">&#34;round&nbsp;trip&#34;</span><span class="op" id="8029340">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029344">want</span><span class="op" id="8029348">:</span>&nbsp;<span class="op" id="8029350">[</span><span class="op" id="8029351">]</span><span class="ident" id="8029352">headerBody</span><span class="op" id="8029362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029367">formData</span><span class="op" id="8029375">(</span><span class="string" id="8029376">&#34;empty&#34;</span><span class="op" id="8029383">,</span>&nbsp;<span class="string" id="8029385">&#34;&#34;</span><span class="op" id="8029387">)</span><span class="op" id="8029388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029393">formData</span><span class="op" id="8029401">(</span><span class="string" id="8029402">&#34;lf&#34;</span><span class="op" id="8029406">,</span>&nbsp;<span class="string" id="8029408">&#34;\n&#34;</span><span class="op" id="8029412">)</span><span class="op" id="8029413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029418">formData</span><span class="op" id="8029426">(</span><span class="string" id="8029427">&#34;cr&#34;</span><span class="op" id="8029431">,</span>&nbsp;<span class="string" id="8029433">&#34;\r&#34;</span><span class="op" id="8029437">)</span><span class="op" id="8029438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029443">formData</span><span class="op" id="8029451">(</span><span class="string" id="8029452">&#34;crlf&#34;</span><span class="op" id="8029458">,</span>&nbsp;<span class="string" id="8029460">&#34;\r\n&#34;</span><span class="op" id="8029466">)</span><span class="op" id="8029467">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029472">formData</span><span class="op" id="8029480">(</span><span class="string" id="8029481">&#34;foo&#34;</span><span class="op" id="8029486">,</span>&nbsp;<span class="string" id="8029488">&#34;bar&#34;</span><span class="op" id="8029493">)</span><span class="op" id="8029494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029498">}</span><span class="op" id="8029499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029505">var</span>&nbsp;<span class="ident" id="8029509">buf</span>&nbsp;<span class="ident" id="8029513">bytes</span><span class="op" id="8029518">.</span><span class="ident" id="8029519">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029527">w</span>&nbsp;<span class="op" id="8029529">:=</span>&nbsp;<span class="ident" id="8029532">NewWriter</span><span class="op" id="8029541">(</span><span class="op" id="8029542">&amp;</span><span class="ident" id="8029543">buf</span><span class="op" id="8029546">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029549">for</span>&nbsp;<span class="ident" id="8029553">_</span><span class="op" id="8029554">,</span>&nbsp;<span class="ident" id="8029556">p</span>&nbsp;<span class="op" id="8029558">:=</span>&nbsp;<span class="keyword" id="8029561">range</span>&nbsp;<span class="ident" id="8029567">t</span><span class="op" id="8029568">.</span><span class="ident" id="8029569">want</span>&nbsp;<span class="op" id="8029574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029578">pw</span><span class="op" id="8029580">,</span>&nbsp;<span class="ident" id="8029582">err</span>&nbsp;<span class="op" id="8029586">:=</span>&nbsp;<span class="ident" id="8029589">w</span><span class="op" id="8029590">.</span><span class="ident" id="8029591">CreatePart</span><span class="op" id="8029601">(</span><span class="ident" id="8029602">p</span><span class="op" id="8029603">.</span><span class="ident" id="8029604">header</span><span class="op" id="8029610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029614">if</span>&nbsp;<span class="ident" id="8029617">err</span>&nbsp;<span class="op" id="8029621">!=</span>&nbsp;<span class="builtintype" id="8029624">nil</span>&nbsp;<span class="op" id="8029628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8029633">panic</span><span class="op" id="8029638">(</span><span class="ident" id="8029639">err</span><span class="op" id="8029642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029646">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029650">_</span><span class="op" id="8029651">,</span>&nbsp;<span class="ident" id="8029653">err</span>&nbsp;<span class="op" id="8029657">=</span>&nbsp;<span class="ident" id="8029659">pw</span><span class="op" id="8029661">.</span><span class="ident" id="8029662">Write</span><span class="op" id="8029667">(</span><span class="op" id="8029668">[</span><span class="op" id="8029669">]</span><span class="builtintype" id="8029670">byte</span><span class="op" id="8029674">(</span><span class="ident" id="8029675">p</span><span class="op" id="8029676">.</span><span class="ident" id="8029677">body</span><span class="op" id="8029681">)</span><span class="op" id="8029682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029686">if</span>&nbsp;<span class="ident" id="8029689">err</span>&nbsp;<span class="op" id="8029693">!=</span>&nbsp;<span class="builtintype" id="8029696">nil</span>&nbsp;<span class="op" id="8029700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8029705">panic</span><span class="op" id="8029710">(</span><span class="ident" id="8029711">err</span><span class="op" id="8029714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8029721">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029724">w</span><span class="op" id="8029725">.</span><span class="ident" id="8029726">Close</span><span class="op" id="8029731">(</span><span class="op" id="8029732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029735">t</span><span class="op" id="8029736">.</span><span class="ident" id="8029737">in</span>&nbsp;<span class="op" id="8029740">=</span>&nbsp;<span class="ident" id="8029742">buf</span><span class="op" id="8029745">.</span><span class="ident" id="8029746">String</span><span class="op" id="8029752">(</span><span class="op" id="8029753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8029756">t</span><span class="op" id="8029757">.</span><span class="ident" id="8029758">sep</span>&nbsp;<span class="op" id="8029762">=</span>&nbsp;<span class="ident" id="8029764">w</span><span class="op" id="8029765">.</span><span class="ident" id="8029766">Boundary</span><span class="op" id="8029774">(</span><span class="op" id="8029775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8029778">return</span>&nbsp;<span class="ident" id="8029785">t</span><br>
<span class="lineno"></span><span class="op" id="8029787">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
