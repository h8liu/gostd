<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html" class="current">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6563211">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6563266">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6563320">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6563371">package</span>&nbsp;<span class="ident" id="6563379">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6563389">import</span>&nbsp;<span class="op" id="6563396">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6563399">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6563408">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6563418">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6563431">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6563442">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="6563464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6563467">func</span>&nbsp;<span class="ident" id="6563472">TestAddParseTree</span><span class="op" id="6563488">(</span><span class="ident" id="6563489">t</span>&nbsp;<span class="op" id="6563491">*</span><span class="ident" id="6563492">testing</span><span class="op" id="6563499">.</span><span class="ident" id="6563500">T</span><span class="op" id="6563501">)</span>&nbsp;<span class="op" id="6563503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563506">root</span>&nbsp;<span class="op" id="6563511">:=</span>&nbsp;<span class="ident" id="6563514">Must</span><span class="op" id="6563518">(</span><span class="ident" id="6563519">New</span><span class="op" id="6563522">(</span><span class="string" id="6563523">&#34;root&#34;</span><span class="op" id="6563529">)</span><span class="op" id="6563530">.</span><span class="ident" id="6563531">Parse</span><span class="op" id="6563536">(</span><span class="string" id="6563537">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="6563596">)</span><span class="op" id="6563597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563600">tree</span><span class="op" id="6563604">,</span>&nbsp;<span class="ident" id="6563606">err</span>&nbsp;<span class="op" id="6563610">:=</span>&nbsp;<span class="ident" id="6563613">parse</span><span class="op" id="6563618">.</span><span class="ident" id="6563619">Parse</span><span class="op" id="6563624">(</span><span class="string" id="6563625">&#34;t&#34;</span><span class="op" id="6563628">,</span>&nbsp;<span class="string" id="6563630">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="6563662">,</span>&nbsp;<span class="string" id="6563664">&#34;&#34;</span><span class="op" id="6563666">,</span>&nbsp;<span class="string" id="6563668">&#34;&#34;</span><span class="op" id="6563670">,</span>&nbsp;<span class="ident" id="6563672">nil</span><span class="op" id="6563675">,</span>&nbsp;<span class="ident" id="6563677">nil</span><span class="op" id="6563680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563683">if</span>&nbsp;<span class="ident" id="6563686">err</span>&nbsp;<span class="op" id="6563690">!=</span>&nbsp;<span class="ident" id="6563693">nil</span>&nbsp;<span class="op" id="6563697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563701">t</span><span class="op" id="6563702">.</span><span class="ident" id="6563703">Fatal</span><span class="op" id="6563708">(</span><span class="ident" id="6563709">err</span><span class="op" id="6563712">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563718">added</span>&nbsp;<span class="op" id="6563724">:=</span>&nbsp;<span class="ident" id="6563727">Must</span><span class="op" id="6563731">(</span><span class="ident" id="6563732">root</span><span class="op" id="6563736">.</span><span class="ident" id="6563737">AddParseTree</span><span class="op" id="6563749">(</span><span class="string" id="6563750">&#34;b&#34;</span><span class="op" id="6563753">,</span>&nbsp;<span class="ident" id="6563755">tree</span><span class="op" id="6563759">[</span><span class="string" id="6563760">&#34;b&#34;</span><span class="op" id="6563763">]</span><span class="op" id="6563764">)</span><span class="op" id="6563765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563768">b</span>&nbsp;<span class="op" id="6563770">:=</span>&nbsp;<span class="builtinfunc" id="6563773">new</span><span class="op" id="6563776">(</span><span class="ident" id="6563777">bytes</span><span class="op" id="6563782">.</span><span class="ident" id="6563783">Buffer</span><span class="op" id="6563789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563792">err</span>&nbsp;<span class="op" id="6563796">=</span>&nbsp;<span class="ident" id="6563798">added</span><span class="op" id="6563803">.</span><span class="ident" id="6563804">ExecuteTemplate</span><span class="op" id="6563819">(</span><span class="ident" id="6563820">b</span><span class="op" id="6563821">,</span>&nbsp;<span class="string" id="6563823">&#34;a&#34;</span><span class="op" id="6563826">,</span>&nbsp;<span class="string" id="6563828">&#34;1&gt;0&#34;</span><span class="op" id="6563833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563836">if</span>&nbsp;<span class="ident" id="6563839">err</span>&nbsp;<span class="op" id="6563843">!=</span>&nbsp;<span class="ident" id="6563846">nil</span>&nbsp;<span class="op" id="6563850">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563854">t</span><span class="op" id="6563855">.</span><span class="ident" id="6563856">Fatal</span><span class="op" id="6563861">(</span><span class="ident" id="6563862">err</span><span class="op" id="6563865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563871">if</span>&nbsp;<span class="ident" id="6563874">got</span><span class="op" id="6563877">,</span>&nbsp;<span class="ident" id="6563879">want</span>&nbsp;<span class="op" id="6563884">:=</span>&nbsp;<span class="ident" id="6563887">b</span><span class="op" id="6563888">.</span><span class="ident" id="6563889">String</span><span class="op" id="6563895">(</span><span class="op" id="6563896">)</span><span class="op" id="6563897">,</span>&nbsp;<span class="string" id="6563899">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="6563931">;</span>&nbsp;<span class="ident" id="6563933">got</span>&nbsp;<span class="op" id="6563937">!=</span>&nbsp;<span class="ident" id="6563940">want</span>&nbsp;<span class="op" id="6563945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563949">t</span><span class="op" id="6563950">.</span><span class="ident" id="6563951">Errorf</span><span class="op" id="6563957">(</span><span class="string" id="6563958">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6563974">,</span>&nbsp;<span class="ident" id="6563976">got</span><span class="op" id="6563979">,</span>&nbsp;<span class="ident" id="6563981">want</span><span class="op" id="6563985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563988">}</span><br>
<span class="lineno">30</span><span class="op" id="6563990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6563993">func</span>&nbsp;<span class="ident" id="6563998">TestClone</span><span class="op" id="6564007">(</span><span class="ident" id="6564008">t</span>&nbsp;<span class="op" id="6564010">*</span><span class="ident" id="6564011">testing</span><span class="op" id="6564018">.</span><span class="ident" id="6564019">T</span><span class="op" id="6564020">)</span>&nbsp;<span class="op" id="6564022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564025">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564097">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564151">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564204">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564264">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564317">const</span>&nbsp;<span class="ident" id="6564323">tmpl</span>&nbsp;<span class="op" id="6564328">=</span>&nbsp;<span class="string" id="6564330">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564396">b</span>&nbsp;<span class="op" id="6564398">:=</span>&nbsp;<span class="builtinfunc" id="6564401">new</span><span class="op" id="6564404">(</span><span class="ident" id="6564405">bytes</span><span class="op" id="6564410">.</span><span class="ident" id="6564411">Buffer</span><span class="op" id="6564417">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564421">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564459">t0</span>&nbsp;<span class="op" id="6564462">:=</span>&nbsp;<span class="ident" id="6564465">Must</span><span class="op" id="6564469">(</span><span class="ident" id="6564470">New</span><span class="op" id="6564473">(</span><span class="string" id="6564474">&#34;t0&#34;</span><span class="op" id="6564478">)</span><span class="op" id="6564479">.</span><span class="ident" id="6564480">Parse</span><span class="op" id="6564485">(</span><span class="ident" id="6564486">tmpl</span><span class="op" id="6564490">)</span><span class="op" id="6564491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564495">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564515">t1</span>&nbsp;<span class="op" id="6564518">:=</span>&nbsp;<span class="ident" id="6564521">Must</span><span class="op" id="6564525">(</span><span class="ident" id="6564526">t0</span><span class="op" id="6564528">.</span><span class="ident" id="6564529">Clone</span><span class="op" id="6564534">(</span><span class="op" id="6564535">)</span><span class="op" id="6564536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564539">Must</span><span class="op" id="6564543">(</span><span class="ident" id="6564544">t1</span><span class="op" id="6564546">.</span><span class="ident" id="6564547">Parse</span><span class="op" id="6564552">(</span><span class="string" id="6564553">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="6564589">)</span><span class="op" id="6564590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564593">Must</span><span class="op" id="6564597">(</span><span class="ident" id="6564598">t1</span><span class="op" id="6564600">.</span><span class="ident" id="6564601">Parse</span><span class="op" id="6564606">(</span><span class="string" id="6564607">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="6564640">)</span><span class="op" id="6564641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564645">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564661">b</span><span class="op" id="6564662">.</span><span class="ident" id="6564663">Reset</span><span class="op" id="6564668">(</span><span class="op" id="6564669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564672">if</span>&nbsp;<span class="ident" id="6564675">err</span>&nbsp;<span class="op" id="6564679">:=</span>&nbsp;<span class="ident" id="6564682">t1</span><span class="op" id="6564684">.</span><span class="ident" id="6564685">ExecuteTemplate</span><span class="op" id="6564700">(</span><span class="ident" id="6564701">b</span><span class="op" id="6564702">,</span>&nbsp;<span class="string" id="6564704">&#34;a&#34;</span><span class="op" id="6564707">,</span>&nbsp;<span class="string" id="6564709">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6564716">)</span><span class="op" id="6564717">;</span>&nbsp;<span class="ident" id="6564719">err</span>&nbsp;<span class="op" id="6564723">!=</span>&nbsp;<span class="ident" id="6564726">nil</span>&nbsp;<span class="op" id="6564730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564734">t</span><span class="op" id="6564735">.</span><span class="ident" id="6564736">Fatal</span><span class="op" id="6564741">(</span><span class="ident" id="6564742">err</span><span class="op" id="6564745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564751">if</span>&nbsp;<span class="ident" id="6564754">got</span><span class="op" id="6564757">,</span>&nbsp;<span class="ident" id="6564759">want</span>&nbsp;<span class="op" id="6564764">:=</span>&nbsp;<span class="ident" id="6564767">b</span><span class="op" id="6564768">.</span><span class="ident" id="6564769">String</span><span class="op" id="6564775">(</span><span class="op" id="6564776">)</span><span class="op" id="6564777">,</span>&nbsp;<span class="string" id="6564779">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="6564809">;</span>&nbsp;<span class="ident" id="6564811">got</span>&nbsp;<span class="op" id="6564815">!=</span>&nbsp;<span class="ident" id="6564818">want</span>&nbsp;<span class="op" id="6564823">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564827">t</span><span class="op" id="6564828">.</span><span class="ident" id="6564829">Errorf</span><span class="op" id="6564835">(</span><span class="string" id="6564836">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6564856">,</span>&nbsp;<span class="ident" id="6564858">got</span><span class="op" id="6564861">,</span>&nbsp;<span class="ident" id="6564863">want</span><span class="op" id="6564867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564874">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564894">t2</span>&nbsp;<span class="op" id="6564897">:=</span>&nbsp;<span class="ident" id="6564900">Must</span><span class="op" id="6564904">(</span><span class="ident" id="6564905">t0</span><span class="op" id="6564907">.</span><span class="ident" id="6564908">Clone</span><span class="op" id="6564913">(</span><span class="op" id="6564914">)</span><span class="op" id="6564915">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564918">Must</span><span class="op" id="6564922">(</span><span class="ident" id="6564923">t2</span><span class="op" id="6564925">.</span><span class="ident" id="6564926">Parse</span><span class="op" id="6564931">(</span><span class="string" id="6564932">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="6564982">)</span><span class="op" id="6564983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564986">Must</span><span class="op" id="6564990">(</span><span class="ident" id="6564991">t2</span><span class="op" id="6564993">.</span><span class="ident" id="6564994">Parse</span><span class="op" id="6564999">(</span><span class="string" id="6565000">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="6565033">)</span><span class="op" id="6565034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565038">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565054">b</span><span class="op" id="6565055">.</span><span class="ident" id="6565056">Reset</span><span class="op" id="6565061">(</span><span class="op" id="6565062">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565065">if</span>&nbsp;<span class="ident" id="6565068">err</span>&nbsp;<span class="op" id="6565072">:=</span>&nbsp;<span class="ident" id="6565075">t2</span><span class="op" id="6565077">.</span><span class="ident" id="6565078">ExecuteTemplate</span><span class="op" id="6565093">(</span><span class="ident" id="6565094">b</span><span class="op" id="6565095">,</span>&nbsp;<span class="string" id="6565097">&#34;a&#34;</span><span class="op" id="6565100">,</span>&nbsp;<span class="string" id="6565102">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6565109">)</span><span class="op" id="6565110">;</span>&nbsp;<span class="ident" id="6565112">err</span>&nbsp;<span class="op" id="6565116">!=</span>&nbsp;<span class="ident" id="6565119">nil</span>&nbsp;<span class="op" id="6565123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565127">t</span><span class="op" id="6565128">.</span><span class="ident" id="6565129">Fatal</span><span class="op" id="6565134">(</span><span class="ident" id="6565135">err</span><span class="op" id="6565138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565144">if</span>&nbsp;<span class="ident" id="6565147">got</span><span class="op" id="6565150">,</span>&nbsp;<span class="ident" id="6565152">want</span>&nbsp;<span class="op" id="6565157">:=</span>&nbsp;<span class="ident" id="6565160">b</span><span class="op" id="6565161">.</span><span class="ident" id="6565162">String</span><span class="op" id="6565168">(</span><span class="op" id="6565169">)</span><span class="op" id="6565170">,</span>&nbsp;<span class="string" id="6565172">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="6565232">;</span>&nbsp;<span class="ident" id="6565234">got</span>&nbsp;<span class="op" id="6565238">!=</span>&nbsp;<span class="ident" id="6565241">want</span>&nbsp;<span class="op" id="6565246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565250">t</span><span class="op" id="6565251">.</span><span class="ident" id="6565252">Errorf</span><span class="op" id="6565258">(</span><span class="string" id="6565259">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6565279">,</span>&nbsp;<span class="ident" id="6565281">got</span><span class="op" id="6565284">,</span>&nbsp;<span class="ident" id="6565286">want</span><span class="op" id="6565290">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565297">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565344">t3</span>&nbsp;<span class="op" id="6565347">:=</span>&nbsp;<span class="ident" id="6565350">Must</span><span class="op" id="6565354">(</span><span class="ident" id="6565355">t0</span><span class="op" id="6565357">.</span><span class="ident" id="6565358">Clone</span><span class="op" id="6565363">(</span><span class="op" id="6565364">)</span><span class="op" id="6565365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565368">Must</span><span class="op" id="6565372">(</span><span class="ident" id="6565373">t3</span><span class="op" id="6565375">.</span><span class="ident" id="6565376">Parse</span><span class="op" id="6565381">(</span><span class="string" id="6565382">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="6565416">)</span><span class="op" id="6565417">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565420">Must</span><span class="op" id="6565424">(</span><span class="ident" id="6565425">t3</span><span class="op" id="6565427">.</span><span class="ident" id="6565428">Parse</span><span class="op" id="6565433">(</span><span class="string" id="6565434">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="6565469">)</span><span class="op" id="6565470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565474">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565491">Must</span><span class="op" id="6565495">(</span><span class="ident" id="6565496">t0</span><span class="op" id="6565498">.</span><span class="ident" id="6565499">Parse</span><span class="op" id="6565504">(</span><span class="string" id="6565505">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="6565533">)</span><span class="op" id="6565534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565537">Must</span><span class="op" id="6565541">(</span><span class="ident" id="6565542">t0</span><span class="op" id="6565544">.</span><span class="ident" id="6565545">Parse</span><span class="op" id="6565550">(</span><span class="string" id="6565551">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="6565579">)</span><span class="op" id="6565580">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565584">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565647">t4</span>&nbsp;<span class="op" id="6565650">:=</span>&nbsp;<span class="ident" id="6565653">Must</span><span class="op" id="6565657">(</span><span class="ident" id="6565658">t0</span><span class="op" id="6565660">.</span><span class="ident" id="6565661">Clone</span><span class="op" id="6565666">(</span><span class="op" id="6565667">)</span><span class="op" id="6565668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565671">if</span>&nbsp;<span class="ident" id="6565674">_</span><span class="op" id="6565675">,</span>&nbsp;<span class="ident" id="6565677">err</span>&nbsp;<span class="op" id="6565681">:=</span>&nbsp;<span class="ident" id="6565684">t4</span><span class="op" id="6565686">.</span><span class="ident" id="6565687">Parse</span><span class="op" id="6565692">(</span><span class="string" id="6565693">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="6565724">)</span><span class="op" id="6565725">;</span>&nbsp;<span class="ident" id="6565727">err</span>&nbsp;<span class="op" id="6565731">==</span>&nbsp;<span class="ident" id="6565734">nil</span>&nbsp;<span class="op" id="6565738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565742">t</span><span class="op" id="6565743">.</span><span class="ident" id="6565744">Error</span><span class="op" id="6565749">(</span><span class="string" id="6565750">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6565792">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565799">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565815">b</span><span class="op" id="6565816">.</span><span class="ident" id="6565817">Reset</span><span class="op" id="6565822">(</span><span class="op" id="6565823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565826">if</span>&nbsp;<span class="ident" id="6565829">err</span>&nbsp;<span class="op" id="6565833">:=</span>&nbsp;<span class="ident" id="6565836">t0</span><span class="op" id="6565838">.</span><span class="ident" id="6565839">ExecuteTemplate</span><span class="op" id="6565854">(</span><span class="ident" id="6565855">b</span><span class="op" id="6565856">,</span>&nbsp;<span class="string" id="6565858">&#34;a&#34;</span><span class="op" id="6565861">,</span>&nbsp;<span class="string" id="6565863">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6565870">)</span><span class="op" id="6565871">;</span>&nbsp;<span class="ident" id="6565873">err</span>&nbsp;<span class="op" id="6565877">!=</span>&nbsp;<span class="ident" id="6565880">nil</span>&nbsp;<span class="op" id="6565884">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565888">t</span><span class="op" id="6565889">.</span><span class="ident" id="6565890">Fatal</span><span class="op" id="6565895">(</span><span class="ident" id="6565896">err</span><span class="op" id="6565899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565905">if</span>&nbsp;<span class="ident" id="6565908">got</span><span class="op" id="6565911">,</span>&nbsp;<span class="ident" id="6565913">want</span>&nbsp;<span class="op" id="6565918">:=</span>&nbsp;<span class="ident" id="6565921">b</span><span class="op" id="6565922">.</span><span class="ident" id="6565923">String</span><span class="op" id="6565929">(</span><span class="op" id="6565930">)</span><span class="op" id="6565931">,</span>&nbsp;<span class="string" id="6565933">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="6565952">;</span>&nbsp;<span class="ident" id="6565954">got</span>&nbsp;<span class="op" id="6565958">!=</span>&nbsp;<span class="ident" id="6565961">want</span>&nbsp;<span class="op" id="6565966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565970">t</span><span class="op" id="6565971">.</span><span class="ident" id="6565972">Errorf</span><span class="op" id="6565978">(</span><span class="string" id="6565979">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6565999">,</span>&nbsp;<span class="ident" id="6566001">got</span><span class="op" id="6566004">,</span>&nbsp;<span class="ident" id="6566006">want</span><span class="op" id="6566010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566013">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6566017">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566077">if</span>&nbsp;<span class="ident" id="6566080">_</span><span class="op" id="6566081">,</span>&nbsp;<span class="ident" id="6566083">err</span>&nbsp;<span class="op" id="6566087">:=</span>&nbsp;<span class="ident" id="6566090">t0</span><span class="op" id="6566092">.</span><span class="ident" id="6566093">Clone</span><span class="op" id="6566098">(</span><span class="op" id="6566099">)</span><span class="op" id="6566100">;</span>&nbsp;<span class="ident" id="6566102">err</span>&nbsp;<span class="op" id="6566106">==</span>&nbsp;<span class="ident" id="6566109">nil</span>&nbsp;<span class="op" id="6566113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566117">t</span><span class="op" id="6566118">.</span><span class="ident" id="6566119">Error</span><span class="op" id="6566124">(</span><span class="string" id="6566125">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6566163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566166">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6566170">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566220">if</span>&nbsp;<span class="ident" id="6566223">_</span><span class="op" id="6566224">,</span>&nbsp;<span class="ident" id="6566226">err</span>&nbsp;<span class="op" id="6566230">:=</span>&nbsp;<span class="ident" id="6566233">t0</span><span class="op" id="6566235">.</span><span class="ident" id="6566236">Lookup</span><span class="op" id="6566242">(</span><span class="string" id="6566243">&#34;a&#34;</span><span class="op" id="6566246">)</span><span class="op" id="6566247">.</span><span class="ident" id="6566248">Clone</span><span class="op" id="6566253">(</span><span class="op" id="6566254">)</span><span class="op" id="6566255">;</span>&nbsp;<span class="ident" id="6566257">err</span>&nbsp;<span class="op" id="6566261">==</span>&nbsp;<span class="ident" id="6566264">nil</span>&nbsp;<span class="op" id="6566268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566272">t</span><span class="op" id="6566273">.</span><span class="ident" id="6566274">Error</span><span class="op" id="6566279">(</span><span class="string" id="6566280">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6566330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566333">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566336">if</span>&nbsp;<span class="ident" id="6566339">_</span><span class="op" id="6566340">,</span>&nbsp;<span class="ident" id="6566342">err</span>&nbsp;<span class="op" id="6566346">:=</span>&nbsp;<span class="ident" id="6566349">t0</span><span class="op" id="6566351">.</span><span class="ident" id="6566352">Lookup</span><span class="op" id="6566358">(</span><span class="string" id="6566359">&#34;lhs&#34;</span><span class="op" id="6566364">)</span><span class="op" id="6566365">.</span><span class="ident" id="6566366">Clone</span><span class="op" id="6566371">(</span><span class="op" id="6566372">)</span><span class="op" id="6566373">;</span>&nbsp;<span class="ident" id="6566375">err</span>&nbsp;<span class="op" id="6566379">==</span>&nbsp;<span class="ident" id="6566382">nil</span>&nbsp;<span class="op" id="6566386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566390">t</span><span class="op" id="6566391">.</span><span class="ident" id="6566392">Error</span><span class="op" id="6566397">(</span><span class="string" id="6566398">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="6566450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6566457">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566473">b</span><span class="op" id="6566474">.</span><span class="ident" id="6566475">Reset</span><span class="op" id="6566480">(</span><span class="op" id="6566481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566484">if</span>&nbsp;<span class="ident" id="6566487">err</span>&nbsp;<span class="op" id="6566491">:=</span>&nbsp;<span class="ident" id="6566494">t3</span><span class="op" id="6566496">.</span><span class="ident" id="6566497">ExecuteTemplate</span><span class="op" id="6566512">(</span><span class="ident" id="6566513">b</span><span class="op" id="6566514">,</span>&nbsp;<span class="string" id="6566516">&#34;a&#34;</span><span class="op" id="6566519">,</span>&nbsp;<span class="string" id="6566521">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="6566528">)</span><span class="op" id="6566529">;</span>&nbsp;<span class="ident" id="6566531">err</span>&nbsp;<span class="op" id="6566535">!=</span>&nbsp;<span class="ident" id="6566538">nil</span>&nbsp;<span class="op" id="6566542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566546">t</span><span class="op" id="6566547">.</span><span class="ident" id="6566548">Fatal</span><span class="op" id="6566553">(</span><span class="ident" id="6566554">err</span><span class="op" id="6566557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566563">if</span>&nbsp;<span class="ident" id="6566566">got</span><span class="op" id="6566569">,</span>&nbsp;<span class="ident" id="6566571">want</span>&nbsp;<span class="op" id="6566576">:=</span>&nbsp;<span class="ident" id="6566579">b</span><span class="op" id="6566580">.</span><span class="ident" id="6566581">String</span><span class="op" id="6566587">(</span><span class="op" id="6566588">)</span><span class="op" id="6566589">,</span>&nbsp;<span class="string" id="6566591">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="6566620">;</span>&nbsp;<span class="ident" id="6566622">got</span>&nbsp;<span class="op" id="6566626">!=</span>&nbsp;<span class="ident" id="6566629">want</span>&nbsp;<span class="op" id="6566634">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566638">t</span><span class="op" id="6566639">.</span><span class="ident" id="6566640">Errorf</span><span class="op" id="6566646">(</span><span class="string" id="6566647">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6566667">,</span>&nbsp;<span class="ident" id="6566669">got</span><span class="op" id="6566672">,</span>&nbsp;<span class="ident" id="6566674">want</span><span class="op" id="6566678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566681">}</span><br>
<span class="lineno"></span><span class="op" id="6566683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6566686">func</span>&nbsp;<span class="ident" id="6566691">TestTemplates</span><span class="op" id="6566704">(</span><span class="ident" id="6566705">t</span>&nbsp;<span class="op" id="6566707">*</span><span class="ident" id="6566708">testing</span><span class="op" id="6566715">.</span><span class="ident" id="6566716">T</span><span class="op" id="6566717">)</span>&nbsp;<span class="op" id="6566719">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566722">names</span>&nbsp;<span class="op" id="6566728">:=</span>&nbsp;<span class="op" id="6566731">[</span><span class="op" id="6566732">]</span><span class="builtintype" id="6566733">string</span><span class="op" id="6566739">{</span><span class="string" id="6566740">&#34;t0&#34;</span><span class="op" id="6566744">,</span>&nbsp;<span class="string" id="6566746">&#34;a&#34;</span><span class="op" id="6566749">,</span>&nbsp;<span class="string" id="6566751">&#34;lhs&#34;</span><span class="op" id="6566756">,</span>&nbsp;<span class="string" id="6566758">&#34;rhs&#34;</span><span class="op" id="6566763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6566766">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566821">const</span>&nbsp;<span class="ident" id="6566827">tmpl</span>&nbsp;<span class="op" id="6566832">=</span>&nbsp;<span class="string" id="6566834">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566974">t0</span>&nbsp;<span class="op" id="6566977">:=</span>&nbsp;<span class="ident" id="6566980">Must</span><span class="op" id="6566984">(</span><span class="ident" id="6566985">New</span><span class="op" id="6566988">(</span><span class="string" id="6566989">&#34;t0&#34;</span><span class="op" id="6566993">)</span><span class="op" id="6566994">.</span><span class="ident" id="6566995">Parse</span><span class="op" id="6567000">(</span><span class="ident" id="6567001">tmpl</span><span class="op" id="6567005">)</span><span class="op" id="6567006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567009">templates</span>&nbsp;<span class="op" id="6567019">:=</span>&nbsp;<span class="ident" id="6567022">t0</span><span class="op" id="6567024">.</span><span class="ident" id="6567025">Templates</span><span class="op" id="6567034">(</span><span class="op" id="6567035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567038">if</span>&nbsp;<span class="builtinfunc" id="6567041">len</span><span class="op" id="6567044">(</span><span class="ident" id="6567045">templates</span><span class="op" id="6567054">)</span>&nbsp;<span class="op" id="6567056">!=</span>&nbsp;<span class="builtinfunc" id="6567059">len</span><span class="op" id="6567062">(</span><span class="ident" id="6567063">names</span><span class="op" id="6567068">)</span>&nbsp;<span class="op" id="6567070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567074">t</span><span class="op" id="6567075">.</span><span class="ident" id="6567076">Errorf</span><span class="op" id="6567082">(</span><span class="string" id="6567083">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6567114">,</span>&nbsp;<span class="builtinfunc" id="6567116">len</span><span class="op" id="6567119">(</span><span class="ident" id="6567120">names</span><span class="op" id="6567125">)</span><span class="op" id="6567126">,</span>&nbsp;<span class="builtinfunc" id="6567128">len</span><span class="op" id="6567131">(</span><span class="ident" id="6567132">templates</span><span class="op" id="6567141">)</span><span class="op" id="6567142">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567148">for</span>&nbsp;<span class="ident" id="6567152">_</span><span class="op" id="6567153">,</span>&nbsp;<span class="ident" id="6567155">name</span>&nbsp;<span class="op" id="6567160">:=</span>&nbsp;<span class="keyword" id="6567163">range</span>&nbsp;<span class="ident" id="6567169">names</span>&nbsp;<span class="op" id="6567175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567179">found</span>&nbsp;<span class="op" id="6567185">:=</span>&nbsp;<span class="builtintype" id="6567188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567196">for</span>&nbsp;<span class="ident" id="6567200">_</span><span class="op" id="6567201">,</span>&nbsp;<span class="ident" id="6567203">tmpl</span>&nbsp;<span class="op" id="6567208">:=</span>&nbsp;<span class="keyword" id="6567211">range</span>&nbsp;<span class="ident" id="6567217">templates</span>&nbsp;<span class="op" id="6567227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567232">if</span>&nbsp;<span class="ident" id="6567235">name</span>&nbsp;<span class="op" id="6567240">==</span>&nbsp;<span class="ident" id="6567243">tmpl</span><span class="op" id="6567247">.</span><span class="ident" id="6567248">text</span><span class="op" id="6567252">.</span><span class="ident" id="6567253">Name</span><span class="op" id="6567257">(</span><span class="op" id="6567258">)</span>&nbsp;<span class="op" id="6567260">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567266">found</span>&nbsp;<span class="op" id="6567272">=</span>&nbsp;<span class="builtintype" id="6567274">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567283">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567300">if</span>&nbsp;<span class="op" id="6567303">!</span><span class="ident" id="6567304">found</span>&nbsp;<span class="op" id="6567310">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567315">t</span><span class="op" id="6567316">.</span><span class="ident" id="6567317">Error</span><span class="op" id="6567322">(</span><span class="string" id="6567323">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="6567348">,</span>&nbsp;<span class="ident" id="6567350">name</span><span class="op" id="6567354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567361">}</span><br>
<span class="lineno"></span><span class="op" id="6567363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6567366">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="6567418">func</span>&nbsp;<span class="ident" id="6567423">TestCloneCrash</span><span class="op" id="6567437">(</span><span class="ident" id="6567438">t</span>&nbsp;<span class="op" id="6567440">*</span><span class="ident" id="6567441">testing</span><span class="op" id="6567448">.</span><span class="ident" id="6567449">T</span><span class="op" id="6567450">)</span>&nbsp;<span class="op" id="6567452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567455">t1</span>&nbsp;<span class="op" id="6567458">:=</span>&nbsp;<span class="ident" id="6567461">New</span><span class="op" id="6567464">(</span><span class="string" id="6567465">&#34;all&#34;</span><span class="op" id="6567470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567473">Must</span><span class="op" id="6567477">(</span><span class="ident" id="6567478">t1</span><span class="op" id="6567480">.</span><span class="ident" id="6567481">New</span><span class="op" id="6567484">(</span><span class="string" id="6567485">&#34;t1&#34;</span><span class="op" id="6567489">)</span><span class="op" id="6567490">.</span><span class="ident" id="6567491">Parse</span><span class="op" id="6567496">(</span><span class="string" id="6567497">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="6567525">)</span><span class="op" id="6567526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567529">t1</span><span class="op" id="6567531">.</span><span class="ident" id="6567532">Clone</span><span class="op" id="6567537">(</span><span class="op" id="6567538">)</span><br>
<span class="lineno">150</span><span class="op" id="6567540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6567543">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="6567598">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="6567656">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="6567697">func</span>&nbsp;<span class="ident" id="6567702">TestCloneThenParse</span><span class="op" id="6567720">(</span><span class="ident" id="6567721">t</span>&nbsp;<span class="op" id="6567723">*</span><span class="ident" id="6567724">testing</span><span class="op" id="6567731">.</span><span class="ident" id="6567732">T</span><span class="op" id="6567733">)</span>&nbsp;<span class="op" id="6567735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567738">t0</span>&nbsp;<span class="op" id="6567741">:=</span>&nbsp;<span class="ident" id="6567744">Must</span><span class="op" id="6567748">(</span><span class="ident" id="6567749">New</span><span class="op" id="6567752">(</span><span class="string" id="6567753">&#34;t0&#34;</span><span class="op" id="6567757">)</span><span class="op" id="6567758">.</span><span class="ident" id="6567759">Parse</span><span class="op" id="6567764">(</span><span class="string" id="6567765">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="6567811">)</span><span class="op" id="6567812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567815">t1</span>&nbsp;<span class="op" id="6567818">:=</span>&nbsp;<span class="ident" id="6567821">Must</span><span class="op" id="6567825">(</span><span class="ident" id="6567826">t0</span><span class="op" id="6567828">.</span><span class="ident" id="6567829">Clone</span><span class="op" id="6567834">(</span><span class="op" id="6567835">)</span><span class="op" id="6567836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567839">Must</span><span class="op" id="6567843">(</span><span class="ident" id="6567844">t1</span><span class="op" id="6567846">.</span><span class="ident" id="6567847">Parse</span><span class="op" id="6567852">(</span><span class="string" id="6567853">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="6567885">)</span><span class="op" id="6567886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567889">if</span>&nbsp;<span class="builtinfunc" id="6567892">len</span><span class="op" id="6567895">(</span><span class="ident" id="6567896">t0</span><span class="op" id="6567898">.</span><span class="ident" id="6567899">Templates</span><span class="op" id="6567908">(</span><span class="op" id="6567909">)</span><span class="op" id="6567910">)</span><span class="op" id="6567911">+</span><span class="num" id="6567912">1</span>&nbsp;<span class="op" id="6567914">!=</span>&nbsp;<span class="builtinfunc" id="6567917">len</span><span class="op" id="6567920">(</span><span class="ident" id="6567921">t1</span><span class="op" id="6567923">.</span><span class="ident" id="6567924">Templates</span><span class="op" id="6567933">(</span><span class="op" id="6567934">)</span><span class="op" id="6567935">)</span>&nbsp;<span class="op" id="6567937">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567941">t</span><span class="op" id="6567942">.</span><span class="ident" id="6567943">Error</span><span class="op" id="6567948">(</span><span class="string" id="6567949">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="6568004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6568010">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568086">err</span>&nbsp;<span class="op" id="6568090">:=</span>&nbsp;<span class="ident" id="6568093">t0</span><span class="op" id="6568095">.</span><span class="ident" id="6568096">ExecuteTemplate</span><span class="op" id="6568111">(</span><span class="ident" id="6568112">ioutil</span><span class="op" id="6568118">.</span><span class="ident" id="6568119">Discard</span><span class="op" id="6568126">,</span>&nbsp;<span class="string" id="6568128">&#34;a&#34;</span><span class="op" id="6568131">,</span>&nbsp;<span class="ident" id="6568133">nil</span><span class="op" id="6568136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568139">if</span>&nbsp;<span class="ident" id="6568142">err</span>&nbsp;<span class="op" id="6568146">==</span>&nbsp;<span class="ident" id="6568149">nil</span>&nbsp;<span class="op" id="6568153">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568157">t</span><span class="op" id="6568158">.</span><span class="ident" id="6568159">Error</span><span class="op" id="6568164">(</span><span class="string" id="6568165">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="6568200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568203">}</span><br>
<span class="lineno"></span><span class="op" id="6568205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6568208">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="6568262">func</span>&nbsp;<span class="ident" id="6568267">TestFuncMapWorksAfterClone</span><span class="op" id="6568293">(</span><span class="ident" id="6568294">t</span>&nbsp;<span class="op" id="6568296">*</span><span class="ident" id="6568297">testing</span><span class="op" id="6568304">.</span><span class="ident" id="6568305">T</span><span class="op" id="6568306">)</span>&nbsp;<span class="op" id="6568308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568311">funcs</span>&nbsp;<span class="op" id="6568317">:=</span>&nbsp;<span class="ident" id="6568320">FuncMap</span><span class="op" id="6568327">{</span><span class="string" id="6568328">&#34;customFunc&#34;</span><span class="op" id="6568340">:</span>&nbsp;<span class="keyword" id="6568342">func</span><span class="op" id="6568346">(</span><span class="op" id="6568347">)</span>&nbsp;<span class="op" id="6568349">(</span><span class="builtintype" id="6568350">string</span><span class="op" id="6568356">,</span>&nbsp;<span class="builtintype" id="6568358">error</span><span class="op" id="6568363">)</span>&nbsp;<span class="op" id="6568365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568369">return</span>&nbsp;<span class="string" id="6568376">&#34;&#34;</span><span class="op" id="6568378">,</span>&nbsp;<span class="ident" id="6568380">errors</span><span class="op" id="6568386">.</span><span class="ident" id="6568387">New</span><span class="op" id="6568390">(</span><span class="string" id="6568391">&#34;issue5980&#34;</span><span class="op" id="6568402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568405">}</span><span class="op" id="6568406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6568410">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568455">uncloned</span>&nbsp;<span class="op" id="6568464">:=</span>&nbsp;<span class="ident" id="6568467">Must</span><span class="op" id="6568471">(</span><span class="ident" id="6568472">New</span><span class="op" id="6568475">(</span><span class="string" id="6568476">&#34;&#34;</span><span class="op" id="6568478">)</span><span class="op" id="6568479">.</span><span class="ident" id="6568480">Funcs</span><span class="op" id="6568485">(</span><span class="ident" id="6568486">funcs</span><span class="op" id="6568491">)</span><span class="op" id="6568492">.</span><span class="ident" id="6568493">Parse</span><span class="op" id="6568498">(</span><span class="string" id="6568499">&#34;{{customFunc}}&#34;</span><span class="op" id="6568515">)</span><span class="op" id="6568516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568519">wantErr</span>&nbsp;<span class="op" id="6568527">:=</span>&nbsp;<span class="ident" id="6568530">uncloned</span><span class="op" id="6568538">.</span><span class="ident" id="6568539">Execute</span><span class="op" id="6568546">(</span><span class="ident" id="6568547">ioutil</span><span class="op" id="6568553">.</span><span class="ident" id="6568554">Discard</span><span class="op" id="6568561">,</span>&nbsp;<span class="ident" id="6568563">nil</span><span class="op" id="6568566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6568570">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6568649">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568697">toClone</span>&nbsp;<span class="op" id="6568705">:=</span>&nbsp;<span class="ident" id="6568708">Must</span><span class="op" id="6568712">(</span><span class="ident" id="6568713">New</span><span class="op" id="6568716">(</span><span class="string" id="6568717">&#34;&#34;</span><span class="op" id="6568719">)</span><span class="op" id="6568720">.</span><span class="ident" id="6568721">Funcs</span><span class="op" id="6568726">(</span><span class="ident" id="6568727">funcs</span><span class="op" id="6568732">)</span><span class="op" id="6568733">.</span><span class="ident" id="6568734">Parse</span><span class="op" id="6568739">(</span><span class="string" id="6568740">&#34;{{customFunc}}&#34;</span><span class="op" id="6568756">)</span><span class="op" id="6568757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568760">cloned</span>&nbsp;<span class="op" id="6568767">:=</span>&nbsp;<span class="ident" id="6568770">Must</span><span class="op" id="6568774">(</span><span class="ident" id="6568775">toClone</span><span class="op" id="6568782">.</span><span class="ident" id="6568783">Clone</span><span class="op" id="6568788">(</span><span class="op" id="6568789">)</span><span class="op" id="6568790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568793">gotErr</span>&nbsp;<span class="op" id="6568800">:=</span>&nbsp;<span class="ident" id="6568803">cloned</span><span class="op" id="6568809">.</span><span class="ident" id="6568810">Execute</span><span class="op" id="6568817">(</span><span class="ident" id="6568818">ioutil</span><span class="op" id="6568824">.</span><span class="ident" id="6568825">Discard</span><span class="op" id="6568832">,</span>&nbsp;<span class="ident" id="6568834">nil</span><span class="op" id="6568837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6568841">if</span>&nbsp;<span class="ident" id="6568844">wantErr</span><span class="op" id="6568851">.</span><span class="ident" id="6568852">Error</span><span class="op" id="6568857">(</span><span class="op" id="6568858">)</span>&nbsp;<span class="op" id="6568860">!=</span>&nbsp;<span class="ident" id="6568863">gotErr</span><span class="op" id="6568869">.</span><span class="ident" id="6568870">Error</span><span class="op" id="6568875">(</span><span class="op" id="6568876">)</span>&nbsp;<span class="op" id="6568878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568882">t</span><span class="op" id="6568883">.</span><span class="ident" id="6568884">Errorf</span><span class="op" id="6568890">(</span><span class="string" id="6568891">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6568936">,</span>&nbsp;<span class="ident" id="6568938">wantErr</span><span class="op" id="6568945">,</span>&nbsp;<span class="ident" id="6568947">gotErr</span><span class="op" id="6568953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568956">}</span><br>
<span class="lineno"></span><span class="op" id="6568958">}</span>
</div>
</body>
</html>
