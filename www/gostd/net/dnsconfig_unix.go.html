<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3585347">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3585402">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3585456">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3585507">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3585572">//&nbsp;Read&nbsp;system&nbsp;DNS&nbsp;config&nbsp;from&nbsp;/etc/resolv.conf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3585621">package</span>&nbsp;<span class="ident" id="3585629">net</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3585634">type</span>&nbsp;<span class="ident" id="3585639">dnsConfig</span>&nbsp;<span class="keyword" id="3585649">struct</span>&nbsp;<span class="op" id="3585656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585659">servers</span>&nbsp;&nbsp;<span class="op" id="3585668">[</span><span class="op" id="3585669">]</span><span class="builtintype" id="3585670">string</span>&nbsp;<span class="comment" id="3585677">//&nbsp;servers&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585696">search</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3585705">[</span><span class="op" id="3585706">]</span><span class="builtintype" id="3585707">string</span>&nbsp;<span class="comment" id="3585714">//&nbsp;suffixes&nbsp;to&nbsp;append&nbsp;to&nbsp;local&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585751">ndots</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3585760">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3585769">//&nbsp;number&nbsp;of&nbsp;dots&nbsp;in&nbsp;name&nbsp;to&nbsp;trigger&nbsp;absolute&nbsp;lookup</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585823">timeout</span>&nbsp;&nbsp;<span class="builtintype" id="3585832">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3585841">//&nbsp;seconds&nbsp;before&nbsp;giving&nbsp;up&nbsp;on&nbsp;packet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585880">attempts</span>&nbsp;<span class="builtintype" id="3585889">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3585898">//&nbsp;lost&nbsp;packets&nbsp;before&nbsp;giving&nbsp;up&nbsp;on&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585942">rotate</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3585951">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3585960">//&nbsp;round&nbsp;robin&nbsp;among&nbsp;servers</span><br>
<span class="lineno"></span><span class="op" id="3585989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3585992">//&nbsp;See&nbsp;resolv.conf(5)&nbsp;on&nbsp;a&nbsp;Linux&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="3586034">//&nbsp;TODO(rsc):&nbsp;Supposed&nbsp;to&nbsp;call&nbsp;uname()&nbsp;and&nbsp;chop&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3586096">//&nbsp;of&nbsp;the&nbsp;host&nbsp;name&nbsp;to&nbsp;get&nbsp;the&nbsp;default&nbsp;search&nbsp;domain.</span><br>
<span class="lineno"></span><span class="keyword" id="3586150">func</span>&nbsp;<span class="ident" id="3586155">dnsReadConfig</span><span class="op" id="3586168">(</span><span class="ident" id="3586169">filename</span>&nbsp;<span class="builtintype" id="3586178">string</span><span class="op" id="3586184">)</span>&nbsp;<span class="op" id="3586186">(</span><span class="op" id="3586187">*</span><span class="ident" id="3586188">dnsConfig</span><span class="op" id="3586197">,</span>&nbsp;<span class="builtintype" id="3586199">error</span><span class="op" id="3586204">)</span>&nbsp;<span class="op" id="3586206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586209">file</span><span class="op" id="3586213">,</span>&nbsp;<span class="ident" id="3586215">err</span>&nbsp;<span class="op" id="3586219">:=</span>&nbsp;<span class="ident" id="3586222">open</span><span class="op" id="3586226">(</span><span class="ident" id="3586227">filename</span><span class="op" id="3586235">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586238">if</span>&nbsp;<span class="ident" id="3586241">err</span>&nbsp;<span class="op" id="3586245">!=</span>&nbsp;<span class="ident" id="3586248">nil</span>&nbsp;<span class="op" id="3586252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586256">return</span>&nbsp;<span class="ident" id="3586263">nil</span><span class="op" id="3586266">,</span>&nbsp;<span class="op" id="3586268">&amp;</span><span class="ident" id="3586269">DNSConfigError</span><span class="op" id="3586283">{</span><span class="ident" id="3586284">err</span><span class="op" id="3586287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586293">defer</span>&nbsp;<span class="ident" id="3586299">file</span><span class="op" id="3586303">.</span><span class="builtinfunc" id="3586304">close</span><span class="op" id="3586309">(</span><span class="op" id="3586310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586313">conf</span>&nbsp;<span class="op" id="3586318">:=</span>&nbsp;<span class="op" id="3586321">&amp;</span><span class="ident" id="3586322">dnsConfig</span><span class="op" id="3586331">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586335">ndots</span><span class="op" id="3586340">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3586345">1</span><span class="op" id="3586346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586350">timeout</span><span class="op" id="3586357">:</span>&nbsp;&nbsp;<span class="num" id="3586360">5</span><span class="op" id="3586361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586365">attempts</span><span class="op" id="3586373">:</span>&nbsp;<span class="num" id="3586375">2</span><span class="op" id="3586376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586382">for</span>&nbsp;<span class="ident" id="3586386">line</span><span class="op" id="3586390">,</span>&nbsp;<span class="ident" id="3586392">ok</span>&nbsp;<span class="op" id="3586395">:=</span>&nbsp;<span class="ident" id="3586398">file</span><span class="op" id="3586402">.</span><span class="ident" id="3586403">readLine</span><span class="op" id="3586411">(</span><span class="op" id="3586412">)</span><span class="op" id="3586413">;</span>&nbsp;<span class="ident" id="3586415">ok</span><span class="op" id="3586417">;</span>&nbsp;<span class="ident" id="3586419">line</span><span class="op" id="3586423">,</span>&nbsp;<span class="ident" id="3586425">ok</span>&nbsp;<span class="op" id="3586428">=</span>&nbsp;<span class="ident" id="3586430">file</span><span class="op" id="3586434">.</span><span class="ident" id="3586435">readLine</span><span class="op" id="3586443">(</span><span class="op" id="3586444">)</span>&nbsp;<span class="op" id="3586446">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586450">f</span>&nbsp;<span class="op" id="3586452">:=</span>&nbsp;<span class="ident" id="3586455">getFields</span><span class="op" id="3586464">(</span><span class="ident" id="3586465">line</span><span class="op" id="3586469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586473">if</span>&nbsp;<span class="builtinfunc" id="3586476">len</span><span class="op" id="3586479">(</span><span class="ident" id="3586480">f</span><span class="op" id="3586481">)</span>&nbsp;<span class="op" id="3586483">&lt;</span>&nbsp;<span class="num" id="3586485">1</span>&nbsp;<span class="op" id="3586487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586492">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586507">switch</span>&nbsp;<span class="ident" id="3586514">f</span><span class="op" id="3586515">[</span><span class="num" id="3586516">0</span><span class="op" id="3586517">]</span>&nbsp;<span class="op" id="3586519">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586523">case</span>&nbsp;<span class="string" id="3586528">&#34;nameserver&#34;</span><span class="op" id="3586540">:</span>&nbsp;<span class="comment" id="3586542">//&nbsp;add&nbsp;one&nbsp;name&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586568">if</span>&nbsp;<span class="builtinfunc" id="3586571">len</span><span class="op" id="3586574">(</span><span class="ident" id="3586575">f</span><span class="op" id="3586576">)</span>&nbsp;<span class="op" id="3586578">&gt;</span>&nbsp;<span class="num" id="3586580">1</span>&nbsp;<span class="op" id="3586582">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3586585">len</span><span class="op" id="3586588">(</span><span class="ident" id="3586589">conf</span><span class="op" id="3586593">.</span><span class="ident" id="3586594">servers</span><span class="op" id="3586601">)</span>&nbsp;<span class="op" id="3586603">&lt;</span>&nbsp;<span class="num" id="3586605">3</span>&nbsp;<span class="op" id="3586607">{</span>&nbsp;<span class="comment" id="3586609">//&nbsp;small,&nbsp;but&nbsp;the&nbsp;standard&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3586646">//&nbsp;One&nbsp;more&nbsp;check:&nbsp;make&nbsp;sure&nbsp;server&nbsp;name&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3586694">//&nbsp;just&nbsp;an&nbsp;IP&nbsp;address.&nbsp;&nbsp;Otherwise&nbsp;we&nbsp;need&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3586744">//&nbsp;to&nbsp;look&nbsp;it&nbsp;up.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586766">if</span>&nbsp;<span class="ident" id="3586769">parseIPv4</span><span class="op" id="3586778">(</span><span class="ident" id="3586779">f</span><span class="op" id="3586780">[</span><span class="num" id="3586781">1</span><span class="op" id="3586782">]</span><span class="op" id="3586783">)</span>&nbsp;<span class="op" id="3586785">!=</span>&nbsp;<span class="ident" id="3586788">nil</span>&nbsp;<span class="op" id="3586792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586799">conf</span><span class="op" id="3586803">.</span><span class="ident" id="3586804">servers</span>&nbsp;<span class="op" id="3586812">=</span>&nbsp;<span class="builtinfunc" id="3586814">append</span><span class="op" id="3586820">(</span><span class="ident" id="3586821">conf</span><span class="op" id="3586825">.</span><span class="ident" id="3586826">servers</span><span class="op" id="3586833">,</span>&nbsp;<span class="ident" id="3586835">f</span><span class="op" id="3586836">[</span><span class="num" id="3586837">1</span><span class="op" id="3586838">]</span><span class="op" id="3586839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586845">}</span>&nbsp;<span class="keyword" id="3586847">else</span>&nbsp;<span class="keyword" id="3586852">if</span>&nbsp;<span class="ident" id="3586855">ip</span><span class="op" id="3586857">,</span>&nbsp;<span class="ident" id="3586859">_</span>&nbsp;<span class="op" id="3586861">:=</span>&nbsp;<span class="ident" id="3586864">parseIPv6</span><span class="op" id="3586873">(</span><span class="ident" id="3586874">f</span><span class="op" id="3586875">[</span><span class="num" id="3586876">1</span><span class="op" id="3586877">]</span><span class="op" id="3586878">,</span>&nbsp;<span class="builtintype" id="3586880">true</span><span class="op" id="3586884">)</span><span class="op" id="3586885">;</span>&nbsp;<span class="ident" id="3586887">ip</span>&nbsp;<span class="op" id="3586890">!=</span>&nbsp;<span class="ident" id="3586893">nil</span>&nbsp;<span class="op" id="3586897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586904">conf</span><span class="op" id="3586908">.</span><span class="ident" id="3586909">servers</span>&nbsp;<span class="op" id="3586917">=</span>&nbsp;<span class="builtinfunc" id="3586919">append</span><span class="op" id="3586925">(</span><span class="ident" id="3586926">conf</span><span class="op" id="3586930">.</span><span class="ident" id="3586931">servers</span><span class="op" id="3586938">,</span>&nbsp;<span class="ident" id="3586940">f</span><span class="op" id="3586941">[</span><span class="num" id="3586942">1</span><span class="op" id="3586943">]</span><span class="op" id="3586944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586950">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586960">case</span>&nbsp;<span class="string" id="3586965">&#34;domain&#34;</span><span class="op" id="3586973">:</span>&nbsp;<span class="comment" id="3586975">//&nbsp;set&nbsp;search&nbsp;path&nbsp;to&nbsp;just&nbsp;this&nbsp;domain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587017">if</span>&nbsp;<span class="builtinfunc" id="3587020">len</span><span class="op" id="3587023">(</span><span class="ident" id="3587024">f</span><span class="op" id="3587025">)</span>&nbsp;<span class="op" id="3587027">&gt;</span>&nbsp;<span class="num" id="3587029">1</span>&nbsp;<span class="op" id="3587031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587037">conf</span><span class="op" id="3587041">.</span><span class="ident" id="3587042">search</span>&nbsp;<span class="op" id="3587049">=</span>&nbsp;<span class="op" id="3587051">[</span><span class="op" id="3587052">]</span><span class="builtintype" id="3587053">string</span><span class="op" id="3587059">{</span><span class="ident" id="3587060">f</span><span class="op" id="3587061">[</span><span class="num" id="3587062">1</span><span class="op" id="3587063">]</span><span class="op" id="3587064">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587074">case</span>&nbsp;<span class="string" id="3587079">&#34;search&#34;</span><span class="op" id="3587087">:</span>&nbsp;<span class="comment" id="3587089">//&nbsp;set&nbsp;search&nbsp;path&nbsp;to&nbsp;given&nbsp;servers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587128">conf</span><span class="op" id="3587132">.</span><span class="ident" id="3587133">search</span>&nbsp;<span class="op" id="3587140">=</span>&nbsp;<span class="builtinfunc" id="3587142">make</span><span class="op" id="3587146">(</span><span class="op" id="3587147">[</span><span class="op" id="3587148">]</span><span class="builtintype" id="3587149">string</span><span class="op" id="3587155">,</span>&nbsp;<span class="builtinfunc" id="3587157">len</span><span class="op" id="3587160">(</span><span class="ident" id="3587161">f</span><span class="op" id="3587162">)</span><span class="op" id="3587163">-</span><span class="num" id="3587164">1</span><span class="op" id="3587165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587170">for</span>&nbsp;<span class="ident" id="3587174">i</span>&nbsp;<span class="op" id="3587176">:=</span>&nbsp;<span class="num" id="3587179">0</span><span class="op" id="3587180">;</span>&nbsp;<span class="ident" id="3587182">i</span>&nbsp;<span class="op" id="3587184">&lt;</span>&nbsp;<span class="builtinfunc" id="3587186">len</span><span class="op" id="3587189">(</span><span class="ident" id="3587190">conf</span><span class="op" id="3587194">.</span><span class="ident" id="3587195">search</span><span class="op" id="3587201">)</span><span class="op" id="3587202">;</span>&nbsp;<span class="ident" id="3587204">i</span><span class="op" id="3587205">++</span>&nbsp;<span class="op" id="3587208">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587214">conf</span><span class="op" id="3587218">.</span><span class="ident" id="3587219">search</span><span class="op" id="3587225">[</span><span class="ident" id="3587226">i</span><span class="op" id="3587227">]</span>&nbsp;<span class="op" id="3587229">=</span>&nbsp;<span class="ident" id="3587231">f</span><span class="op" id="3587232">[</span><span class="ident" id="3587233">i</span><span class="op" id="3587234">+</span><span class="num" id="3587235">1</span><span class="op" id="3587236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587246">case</span>&nbsp;<span class="string" id="3587251">&#34;options&#34;</span><span class="op" id="3587260">:</span>&nbsp;<span class="comment" id="3587262">//&nbsp;magic&nbsp;options</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587282">for</span>&nbsp;<span class="ident" id="3587286">i</span>&nbsp;<span class="op" id="3587288">:=</span>&nbsp;<span class="num" id="3587291">1</span><span class="op" id="3587292">;</span>&nbsp;<span class="ident" id="3587294">i</span>&nbsp;<span class="op" id="3587296">&lt;</span>&nbsp;<span class="builtinfunc" id="3587298">len</span><span class="op" id="3587301">(</span><span class="ident" id="3587302">f</span><span class="op" id="3587303">)</span><span class="op" id="3587304">;</span>&nbsp;<span class="ident" id="3587306">i</span><span class="op" id="3587307">++</span>&nbsp;<span class="op" id="3587310">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587316">s</span>&nbsp;<span class="op" id="3587318">:=</span>&nbsp;<span class="ident" id="3587321">f</span><span class="op" id="3587322">[</span><span class="ident" id="3587323">i</span><span class="op" id="3587324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587330">switch</span>&nbsp;<span class="op" id="3587337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587343">case</span>&nbsp;<span class="ident" id="3587348">hasPrefix</span><span class="op" id="3587357">(</span><span class="ident" id="3587358">s</span><span class="op" id="3587359">,</span>&nbsp;<span class="string" id="3587361">&#34;ndots:&#34;</span><span class="op" id="3587369">)</span><span class="op" id="3587370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587377">n</span><span class="op" id="3587378">,</span>&nbsp;<span class="ident" id="3587380">_</span><span class="op" id="3587381">,</span>&nbsp;<span class="ident" id="3587383">_</span>&nbsp;<span class="op" id="3587385">:=</span>&nbsp;<span class="ident" id="3587388">dtoi</span><span class="op" id="3587392">(</span><span class="ident" id="3587393">s</span><span class="op" id="3587394">,</span>&nbsp;<span class="num" id="3587396">6</span><span class="op" id="3587397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587404">if</span>&nbsp;<span class="ident" id="3587407">n</span>&nbsp;<span class="op" id="3587409">&lt;</span>&nbsp;<span class="num" id="3587411">1</span>&nbsp;<span class="op" id="3587413">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587421">n</span>&nbsp;<span class="op" id="3587423">=</span>&nbsp;<span class="num" id="3587425">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587439">conf</span><span class="op" id="3587443">.</span><span class="ident" id="3587444">ndots</span>&nbsp;<span class="op" id="3587450">=</span>&nbsp;<span class="ident" id="3587452">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587458">case</span>&nbsp;<span class="ident" id="3587463">hasPrefix</span><span class="op" id="3587472">(</span><span class="ident" id="3587473">s</span><span class="op" id="3587474">,</span>&nbsp;<span class="string" id="3587476">&#34;timeout:&#34;</span><span class="op" id="3587486">)</span><span class="op" id="3587487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587494">n</span><span class="op" id="3587495">,</span>&nbsp;<span class="ident" id="3587497">_</span><span class="op" id="3587498">,</span>&nbsp;<span class="ident" id="3587500">_</span>&nbsp;<span class="op" id="3587502">:=</span>&nbsp;<span class="ident" id="3587505">dtoi</span><span class="op" id="3587509">(</span><span class="ident" id="3587510">s</span><span class="op" id="3587511">,</span>&nbsp;<span class="num" id="3587513">8</span><span class="op" id="3587514">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587521">if</span>&nbsp;<span class="ident" id="3587524">n</span>&nbsp;<span class="op" id="3587526">&lt;</span>&nbsp;<span class="num" id="3587528">1</span>&nbsp;<span class="op" id="3587530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587538">n</span>&nbsp;<span class="op" id="3587540">=</span>&nbsp;<span class="num" id="3587542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587556">conf</span><span class="op" id="3587560">.</span><span class="ident" id="3587561">timeout</span>&nbsp;<span class="op" id="3587569">=</span>&nbsp;<span class="ident" id="3587571">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587577">case</span>&nbsp;<span class="ident" id="3587582">hasPrefix</span><span class="op" id="3587591">(</span><span class="ident" id="3587592">s</span><span class="op" id="3587593">,</span>&nbsp;<span class="string" id="3587595">&#34;attempts:&#34;</span><span class="op" id="3587606">)</span><span class="op" id="3587607">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587614">n</span><span class="op" id="3587615">,</span>&nbsp;<span class="ident" id="3587617">_</span><span class="op" id="3587618">,</span>&nbsp;<span class="ident" id="3587620">_</span>&nbsp;<span class="op" id="3587622">:=</span>&nbsp;<span class="ident" id="3587625">dtoi</span><span class="op" id="3587629">(</span><span class="ident" id="3587630">s</span><span class="op" id="3587631">,</span>&nbsp;<span class="num" id="3587633">9</span><span class="op" id="3587634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587641">if</span>&nbsp;<span class="ident" id="3587644">n</span>&nbsp;<span class="op" id="3587646">&lt;</span>&nbsp;<span class="num" id="3587648">1</span>&nbsp;<span class="op" id="3587650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587658">n</span>&nbsp;<span class="op" id="3587660">=</span>&nbsp;<span class="num" id="3587662">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587676">conf</span><span class="op" id="3587680">.</span><span class="ident" id="3587681">attempts</span>&nbsp;<span class="op" id="3587690">=</span>&nbsp;<span class="ident" id="3587692">n</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587698">case</span>&nbsp;<span class="ident" id="3587703">s</span>&nbsp;<span class="op" id="3587705">==</span>&nbsp;<span class="string" id="3587708">&#34;rotate&#34;</span><span class="op" id="3587716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3587723">conf</span><span class="op" id="3587727">.</span><span class="ident" id="3587728">rotate</span>&nbsp;<span class="op" id="3587735">=</span>&nbsp;<span class="builtintype" id="3587737">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587755">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3587758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587761">return</span>&nbsp;<span class="ident" id="3587768">conf</span><span class="op" id="3587772">,</span>&nbsp;<span class="ident" id="3587774">nil</span><br>
<span class="lineno"></span><span class="op" id="3587778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3587781">func</span>&nbsp;<span class="ident" id="3587786">hasPrefix</span><span class="op" id="3587795">(</span><span class="ident" id="3587796">s</span><span class="op" id="3587797">,</span>&nbsp;<span class="ident" id="3587799">prefix</span>&nbsp;<span class="builtintype" id="3587806">string</span><span class="op" id="3587812">)</span>&nbsp;<span class="builtintype" id="3587814">bool</span>&nbsp;<span class="op" id="3587819">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3587822">return</span>&nbsp;<span class="builtinfunc" id="3587829">len</span><span class="op" id="3587832">(</span><span class="ident" id="3587833">s</span><span class="op" id="3587834">)</span>&nbsp;<span class="op" id="3587836">&gt;=</span>&nbsp;<span class="builtinfunc" id="3587839">len</span><span class="op" id="3587842">(</span><span class="ident" id="3587843">prefix</span><span class="op" id="3587849">)</span>&nbsp;<span class="op" id="3587851">&amp;&amp;</span>&nbsp;<span class="ident" id="3587854">s</span><span class="op" id="3587855">[</span><span class="op" id="3587856">:</span><span class="builtinfunc" id="3587857">len</span><span class="op" id="3587860">(</span><span class="ident" id="3587861">prefix</span><span class="op" id="3587867">)</span><span class="op" id="3587868">]</span>&nbsp;<span class="op" id="3587870">==</span>&nbsp;<span class="ident" id="3587873">prefix</span><br>
<span class="lineno"></span><span class="op" id="3587880">}</span>
</div>
</body>
</html>
