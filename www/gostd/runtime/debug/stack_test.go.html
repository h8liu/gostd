<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6529641">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6529696">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6529750">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6529801">package</span>&nbsp;<span class="ident" id="6529809">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6529816">import</span>&nbsp;<span class="op" id="6529823">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529826">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6529837">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6529847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6529850">type</span>&nbsp;<span class="ident" id="6529855">T</span>&nbsp;<span class="builtintype" id="6529857">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6529862">func</span>&nbsp;<span class="op" id="6529867">(</span><span class="ident" id="6529868">t</span>&nbsp;<span class="op" id="6529870">*</span><span class="ident" id="6529871">T</span><span class="op" id="6529872">)</span>&nbsp;<span class="ident" id="6529874">ptrmethod</span><span class="op" id="6529883">(</span><span class="op" id="6529884">)</span>&nbsp;<span class="op" id="6529886">[</span><span class="op" id="6529887">]</span><span class="builtintype" id="6529888">byte</span>&nbsp;<span class="op" id="6529893">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529896">return</span>&nbsp;<span class="ident" id="6529903">Stack</span><span class="op" id="6529908">(</span><span class="op" id="6529909">)</span><br>
<span class="lineno"></span><span class="op" id="6529911">}</span><br>
<span class="lineno"></span><span class="keyword" id="6529913">func</span>&nbsp;<span class="op" id="6529918">(</span><span class="ident" id="6529919">t</span>&nbsp;<span class="ident" id="6529921">T</span><span class="op" id="6529922">)</span>&nbsp;<span class="ident" id="6529924">method</span><span class="op" id="6529930">(</span><span class="op" id="6529931">)</span>&nbsp;<span class="op" id="6529933">[</span><span class="op" id="6529934">]</span><span class="builtintype" id="6529935">byte</span>&nbsp;<span class="op" id="6529940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529943">return</span>&nbsp;<span class="ident" id="6529950">t</span><span class="op" id="6529951">.</span><span class="ident" id="6529952">ptrmethod</span><span class="op" id="6529961">(</span><span class="op" id="6529962">)</span><br>
<span class="lineno"></span><span class="op" id="6529964">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6529967">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="6530580">func</span>&nbsp;<span class="ident" id="6530585">TestStack</span><span class="op" id="6530594">(</span><span class="ident" id="6530595">t</span>&nbsp;<span class="op" id="6530597">*</span><span class="ident" id="6530598">testing</span><span class="op" id="6530605">.</span><span class="ident" id="6530606">T</span><span class="op" id="6530607">)</span>&nbsp;<span class="op" id="6530609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530612">b</span>&nbsp;<span class="op" id="6530614">:=</span>&nbsp;<span class="ident" id="6530617">T</span><span class="op" id="6530618">(</span><span class="num" id="6530619">0</span><span class="op" id="6530620">)</span><span class="op" id="6530621">.</span><span class="ident" id="6530622">method</span><span class="op" id="6530628">(</span><span class="op" id="6530629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530632">lines</span>&nbsp;<span class="op" id="6530638">:=</span>&nbsp;<span class="ident" id="6530641">strings</span><span class="op" id="6530648">.</span><span class="ident" id="6530649">Split</span><span class="op" id="6530654">(</span><span class="builtintype" id="6530655">string</span><span class="op" id="6530661">(</span><span class="ident" id="6530662">b</span><span class="op" id="6530663">)</span><span class="op" id="6530664">,</span>&nbsp;<span class="string" id="6530666">&#34;\n&#34;</span><span class="op" id="6530670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530673">if</span>&nbsp;<span class="builtinfunc" id="6530676">len</span><span class="op" id="6530679">(</span><span class="ident" id="6530680">lines</span><span class="op" id="6530685">)</span>&nbsp;<span class="op" id="6530687">&lt;</span>&nbsp;<span class="num" id="6530689">6</span>&nbsp;<span class="op" id="6530691">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530695">t</span><span class="op" id="6530696">.</span><span class="ident" id="6530697">Fatal</span><span class="op" id="6530702">(</span><span class="string" id="6530703">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="6530718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530724">n</span>&nbsp;<span class="op" id="6530726">:=</span>&nbsp;<span class="num" id="6530729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530732">frame</span>&nbsp;<span class="op" id="6530738">:=</span>&nbsp;<span class="keyword" id="6530741">func</span><span class="op" id="6530745">(</span><span class="ident" id="6530746">line</span><span class="op" id="6530750">,</span>&nbsp;<span class="ident" id="6530752">code</span>&nbsp;<span class="builtintype" id="6530757">string</span><span class="op" id="6530763">)</span>&nbsp;<span class="op" id="6530765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530769">check</span><span class="op" id="6530774">(</span><span class="ident" id="6530775">t</span><span class="op" id="6530776">,</span>&nbsp;<span class="ident" id="6530778">lines</span><span class="op" id="6530783">[</span><span class="ident" id="6530784">n</span><span class="op" id="6530785">]</span><span class="op" id="6530786">,</span>&nbsp;<span class="ident" id="6530788">line</span><span class="op" id="6530792">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530796">n</span><span class="op" id="6530797">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6530802">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530865">if</span>&nbsp;<span class="ident" id="6530868">strings</span><span class="op" id="6530875">.</span><span class="ident" id="6530876">HasPrefix</span><span class="op" id="6530885">(</span><span class="ident" id="6530886">lines</span><span class="op" id="6530891">[</span><span class="ident" id="6530892">n</span><span class="op" id="6530893">]</span><span class="op" id="6530894">,</span>&nbsp;<span class="string" id="6530896">&#34;\t&#34;</span><span class="op" id="6530900">)</span>&nbsp;<span class="op" id="6530902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530907">check</span><span class="op" id="6530912">(</span><span class="ident" id="6530913">t</span><span class="op" id="6530914">,</span>&nbsp;<span class="ident" id="6530916">lines</span><span class="op" id="6530921">[</span><span class="ident" id="6530922">n</span><span class="op" id="6530923">]</span><span class="op" id="6530924">,</span>&nbsp;<span class="ident" id="6530926">code</span><span class="op" id="6530930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530935">n</span><span class="op" id="6530936">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530947">frame</span><span class="op" id="6530952">(</span><span class="string" id="6530953">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6530986">,</span>&nbsp;<span class="string" id="6530988">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="6531022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531025">frame</span><span class="op" id="6531030">(</span><span class="string" id="6531031">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6531064">,</span>&nbsp;<span class="string" id="6531066">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="6531100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531103">frame</span><span class="op" id="6531108">(</span><span class="string" id="6531109">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="6531142">,</span>&nbsp;<span class="string" id="6531144">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="6531177">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531180">frame</span><span class="op" id="6531185">(</span><span class="string" id="6531186">&#34;src/testing/testing.go&#34;</span><span class="op" id="6531210">,</span>&nbsp;<span class="string" id="6531212">&#34;&#34;</span><span class="op" id="6531214">)</span><br>
<span class="lineno"></span><span class="op" id="6531216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6531219">func</span>&nbsp;<span class="ident" id="6531224">check</span><span class="op" id="6531229">(</span><span class="ident" id="6531230">t</span>&nbsp;<span class="op" id="6531232">*</span><span class="ident" id="6531233">testing</span><span class="op" id="6531240">.</span><span class="ident" id="6531241">T</span><span class="op" id="6531242">,</span>&nbsp;<span class="ident" id="6531244">line</span><span class="op" id="6531248">,</span>&nbsp;<span class="ident" id="6531250">has</span>&nbsp;<span class="builtintype" id="6531254">string</span><span class="op" id="6531260">)</span>&nbsp;<span class="op" id="6531262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531265">if</span>&nbsp;<span class="ident" id="6531268">strings</span><span class="op" id="6531275">.</span><span class="ident" id="6531276">Index</span><span class="op" id="6531281">(</span><span class="ident" id="6531282">line</span><span class="op" id="6531286">,</span>&nbsp;<span class="ident" id="6531288">has</span><span class="op" id="6531291">)</span>&nbsp;<span class="op" id="6531293">&lt;</span>&nbsp;<span class="num" id="6531295">0</span>&nbsp;<span class="op" id="6531297">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531301">t</span><span class="op" id="6531302">.</span><span class="ident" id="6531303">Errorf</span><span class="op" id="6531309">(</span><span class="string" id="6531310">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="6531329">,</span>&nbsp;<span class="ident" id="6531331">has</span><span class="op" id="6531334">,</span>&nbsp;<span class="ident" id="6531336">line</span><span class="op" id="6531340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531343">}</span><br>
<span class="lineno"></span><span class="op" id="6531345">}</span>
</div>
</body>
</html>
