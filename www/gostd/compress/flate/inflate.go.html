<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4640383">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4640438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4640492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4640543">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640593">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4640670">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4640750">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4640762">package</span>&nbsp;<span class="ident" id="4640770">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4640777">import</span>&nbsp;<span class="op" id="4640784">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4640787">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4640796">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4640802">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4640812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4640815">const</span>&nbsp;<span class="op" id="4640821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640824">maxCodeLen</span>&nbsp;<span class="op" id="4640835">=</span>&nbsp;<span class="num" id="4640837">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640843">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640874">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4640885">=</span>&nbsp;<span class="num" id="4640887">32768</span>&nbsp;<span class="comment" id="4640893">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640918">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640979">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4640988">=</span>&nbsp;<span class="num" id="4640990">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640995">maxDist</span>&nbsp;&nbsp;<span class="op" id="4641004">=</span>&nbsp;<span class="num" id="4641006">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641010">numCodes</span>&nbsp;<span class="op" id="4641019">=</span>&nbsp;<span class="num" id="4641021">19</span>&nbsp;<span class="comment" id="4641024">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4641064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641067">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4641147">type</span>&nbsp;<span class="ident" id="4641152">CorruptInputError</span>&nbsp;<span class="ident" id="4641170">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4641177">func</span>&nbsp;<span class="op" id="4641182">(</span><span class="ident" id="4641183">e</span>&nbsp;<span class="ident" id="4641185">CorruptInputError</span><span class="op" id="4641202">)</span>&nbsp;<span class="ident" id="4641204">Error</span><span class="op" id="4641209">(</span><span class="op" id="4641210">)</span>&nbsp;<span class="builtintype" id="4641212">string</span>&nbsp;<span class="op" id="4641219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641222">return</span>&nbsp;<span class="string" id="4641229">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4641267">+</span>&nbsp;<span class="ident" id="4641269">strconv</span><span class="op" id="4641276">.</span><span class="ident" id="4641277">FormatInt</span><span class="op" id="4641286">(</span><span class="ident" id="4641287">int64</span><span class="op" id="4641292">(</span><span class="ident" id="4641293">e</span><span class="op" id="4641294">)</span><span class="op" id="4641295">,</span>&nbsp;<span class="num" id="4641297">10</span><span class="op" id="4641299">)</span><br>
<span class="lineno"></span><span class="op" id="4641301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641304">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4641367">type</span>&nbsp;<span class="ident" id="4641372">InternalError</span>&nbsp;<span class="builtintype" id="4641386">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4641394">func</span>&nbsp;<span class="op" id="4641399">(</span><span class="ident" id="4641400">e</span>&nbsp;<span class="ident" id="4641402">InternalError</span><span class="op" id="4641415">)</span>&nbsp;<span class="ident" id="4641417">Error</span><span class="op" id="4641422">(</span><span class="op" id="4641423">)</span>&nbsp;<span class="builtintype" id="4641425">string</span>&nbsp;<span class="op" id="4641432">{</span>&nbsp;<span class="keyword" id="4641434">return</span>&nbsp;<span class="string" id="4641441">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4641467">+</span>&nbsp;<span class="builtintype" id="4641469">string</span><span class="op" id="4641475">(</span><span class="ident" id="4641476">e</span><span class="op" id="4641477">)</span>&nbsp;<span class="op" id="4641479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641482">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4641547">type</span>&nbsp;<span class="ident" id="4641552">ReadError</span>&nbsp;<span class="keyword" id="4641562">struct</span>&nbsp;<span class="op" id="4641569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641572">Offset</span>&nbsp;<span class="ident" id="4641579">int64</span>&nbsp;<span class="comment" id="4641585">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641622">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4641629">error</span>&nbsp;<span class="comment" id="4641635">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4641672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4641675">func</span>&nbsp;<span class="op" id="4641680">(</span><span class="ident" id="4641681">e</span>&nbsp;<span class="op" id="4641683">*</span><span class="ident" id="4641684">ReadError</span><span class="op" id="4641693">)</span>&nbsp;<span class="ident" id="4641695">Error</span><span class="op" id="4641700">(</span><span class="op" id="4641701">)</span>&nbsp;<span class="builtintype" id="4641703">string</span>&nbsp;<span class="op" id="4641710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641713">return</span>&nbsp;<span class="string" id="4641720">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4641751">+</span>&nbsp;<span class="ident" id="4641753">strconv</span><span class="op" id="4641760">.</span><span class="ident" id="4641761">FormatInt</span><span class="op" id="4641770">(</span><span class="ident" id="4641771">e</span><span class="op" id="4641772">.</span><span class="ident" id="4641773">Offset</span><span class="op" id="4641779">,</span>&nbsp;<span class="num" id="4641781">10</span><span class="op" id="4641783">)</span>&nbsp;<span class="op" id="4641785">+</span>&nbsp;<span class="string" id="4641787">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4641792">+</span>&nbsp;<span class="ident" id="4641794">e</span><span class="op" id="4641795">.</span><span class="ident" id="4641796">Err</span><span class="op" id="4641799">.</span><span class="ident" id="4641800">Error</span><span class="op" id="4641805">(</span><span class="op" id="4641806">)</span><br>
<span class="lineno"></span><span class="op" id="4641808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641811">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4641878">type</span>&nbsp;<span class="ident" id="4641883">WriteError</span>&nbsp;<span class="keyword" id="4641894">struct</span>&nbsp;<span class="op" id="4641901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641904">Offset</span>&nbsp;<span class="ident" id="4641911">int64</span>&nbsp;<span class="comment" id="4641917">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641954">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4641961">error</span>&nbsp;<span class="comment" id="4641967">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4642005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4642008">func</span>&nbsp;<span class="op" id="4642013">(</span><span class="ident" id="4642014">e</span>&nbsp;<span class="op" id="4642016">*</span><span class="ident" id="4642017">WriteError</span><span class="op" id="4642027">)</span>&nbsp;<span class="ident" id="4642029">Error</span><span class="op" id="4642034">(</span><span class="op" id="4642035">)</span>&nbsp;<span class="builtintype" id="4642037">string</span>&nbsp;<span class="op" id="4642044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642047">return</span>&nbsp;<span class="string" id="4642054">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4642086">+</span>&nbsp;<span class="ident" id="4642088">strconv</span><span class="op" id="4642095">.</span><span class="ident" id="4642096">FormatInt</span><span class="op" id="4642105">(</span><span class="ident" id="4642106">e</span><span class="op" id="4642107">.</span><span class="ident" id="4642108">Offset</span><span class="op" id="4642114">,</span>&nbsp;<span class="num" id="4642116">10</span><span class="op" id="4642118">)</span>&nbsp;<span class="op" id="4642120">+</span>&nbsp;<span class="string" id="4642122">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4642127">+</span>&nbsp;<span class="ident" id="4642129">e</span><span class="op" id="4642130">.</span><span class="ident" id="4642131">Err</span><span class="op" id="4642134">.</span><span class="ident" id="4642135">Error</span><span class="op" id="4642140">(</span><span class="op" id="4642141">)</span><br>
<span class="lineno"></span><span class="op" id="4642143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4642146">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4642220">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4642295">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4642331">type</span>&nbsp;<span class="ident" id="4642336">Resetter</span>&nbsp;<span class="keyword" id="4642345">interface</span>&nbsp;<span class="op" id="4642355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642358">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642432">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642477">Reset</span><span class="op" id="4642482">(</span><span class="ident" id="4642483">r</span>&nbsp;<span class="ident" id="4642485">io</span><span class="op" id="4642487">.</span><span class="ident" id="4642488">Reader</span><span class="op" id="4642494">,</span>&nbsp;<span class="ident" id="4642496">dict</span>&nbsp;<span class="op" id="4642501">[</span><span class="op" id="4642502">]</span><span class="builtintype" id="4642503">byte</span><span class="op" id="4642507">)</span>&nbsp;<span class="builtintype" id="4642509">error</span><br>
<span class="lineno"></span><span class="op" id="4642515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4642518">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4642591">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4642660">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4642721">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4642791">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4642865">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4642935">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4643004">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4643077">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4643149">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4643181">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4643249">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4643321">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4643390">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4643458">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4643478">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4643510">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4643556">const</span>&nbsp;<span class="op" id="4643562">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643565">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4643583">=</span>&nbsp;<span class="num" id="4643585">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643588">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4643606">=</span>&nbsp;<span class="num" id="4643608">1</span>&nbsp;<span class="op" id="4643610">&lt;&lt;</span>&nbsp;<span class="ident" id="4643613">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643631">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4643649">=</span>&nbsp;<span class="num" id="4643651">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643655">huffmanValueShift</span>&nbsp;<span class="op" id="4643673">=</span>&nbsp;<span class="num" id="4643675">4</span><br>
<span class="lineno"></span><span class="op" id="4643677">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4643680">type</span>&nbsp;<span class="ident" id="4643685">huffmanDecoder</span>&nbsp;<span class="keyword" id="4643700">struct</span>&nbsp;<span class="op" id="4643707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643710">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4643719">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4643744">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643772">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4643781">[</span><span class="ident" id="4643782">huffmanNumChunks</span><span class="op" id="4643798">]</span><span class="builtintype" id="4643799">uint32</span>&nbsp;<span class="comment" id="4643806">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643836">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4643845">[</span><span class="op" id="4643846">]</span><span class="op" id="4643847">[</span><span class="op" id="4643848">]</span><span class="builtintype" id="4643849">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4643870">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643889">linkMask</span>&nbsp;<span class="builtintype" id="4643898">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4643923">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4643959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643962">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4644028">func</span>&nbsp;<span class="op" id="4644033">(</span><span class="ident" id="4644034">h</span>&nbsp;<span class="op" id="4644036">*</span><span class="ident" id="4644037">huffmanDecoder</span><span class="op" id="4644051">)</span>&nbsp;<span class="ident" id="4644053">init</span><span class="op" id="4644057">(</span><span class="ident" id="4644058">bits</span>&nbsp;<span class="op" id="4644063">[</span><span class="op" id="4644064">]</span><span class="builtintype" id="4644065">int</span><span class="op" id="4644068">)</span>&nbsp;<span class="builtintype" id="4644070">bool</span>&nbsp;<span class="op" id="4644075">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644078">if</span>&nbsp;<span class="ident" id="4644081">h</span><span class="op" id="4644082">.</span><span class="ident" id="4644083">min</span>&nbsp;<span class="op" id="4644087">!=</span>&nbsp;<span class="num" id="4644090">0</span>&nbsp;<span class="op" id="4644092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644096">*</span><span class="ident" id="4644097">h</span>&nbsp;<span class="op" id="4644099">=</span>&nbsp;<span class="ident" id="4644101">huffmanDecoder</span><span class="op" id="4644115">{</span><span class="op" id="4644116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644123">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644165">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644197">var</span>&nbsp;<span class="ident" id="4644201">count</span>&nbsp;<span class="op" id="4644207">[</span><span class="ident" id="4644208">maxCodeLen</span><span class="op" id="4644218">]</span><span class="builtintype" id="4644219">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644224">var</span>&nbsp;<span class="ident" id="4644228">min</span><span class="op" id="4644231">,</span>&nbsp;<span class="ident" id="4644233">max</span>&nbsp;<span class="builtintype" id="4644237">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644242">for</span>&nbsp;<span class="ident" id="4644246">_</span><span class="op" id="4644247">,</span>&nbsp;<span class="ident" id="4644249">n</span>&nbsp;<span class="op" id="4644251">:=</span>&nbsp;<span class="keyword" id="4644254">range</span>&nbsp;<span class="ident" id="4644260">bits</span>&nbsp;<span class="op" id="4644265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644269">if</span>&nbsp;<span class="ident" id="4644272">n</span>&nbsp;<span class="op" id="4644274">==</span>&nbsp;<span class="num" id="4644277">0</span>&nbsp;<span class="op" id="4644279">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644284">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644299">if</span>&nbsp;<span class="ident" id="4644302">min</span>&nbsp;<span class="op" id="4644306">==</span>&nbsp;<span class="num" id="4644309">0</span>&nbsp;<span class="op" id="4644311">||</span>&nbsp;<span class="ident" id="4644314">n</span>&nbsp;<span class="op" id="4644316">&lt;</span>&nbsp;<span class="ident" id="4644318">min</span>&nbsp;<span class="op" id="4644322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644327">min</span>&nbsp;<span class="op" id="4644331">=</span>&nbsp;<span class="ident" id="4644333">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644337">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644341">if</span>&nbsp;<span class="ident" id="4644344">n</span>&nbsp;<span class="op" id="4644346">&gt;</span>&nbsp;<span class="ident" id="4644348">max</span>&nbsp;<span class="op" id="4644352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644357">max</span>&nbsp;<span class="op" id="4644361">=</span>&nbsp;<span class="ident" id="4644363">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644371">count</span><span class="op" id="4644376">[</span><span class="ident" id="4644377">n</span><span class="op" id="4644378">]</span><span class="op" id="4644379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644383">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644386">if</span>&nbsp;<span class="ident" id="4644389">max</span>&nbsp;<span class="op" id="4644393">==</span>&nbsp;<span class="num" id="4644396">0</span>&nbsp;<span class="op" id="4644398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644402">return</span>&nbsp;<span class="builtintype" id="4644409">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644420">h</span><span class="op" id="4644421">.</span><span class="ident" id="4644422">min</span>&nbsp;<span class="op" id="4644426">=</span>&nbsp;<span class="ident" id="4644428">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644433">var</span>&nbsp;<span class="ident" id="4644437">linkBits</span>&nbsp;<span class="builtintype" id="4644446">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644452">var</span>&nbsp;<span class="ident" id="4644456">numLinks</span>&nbsp;<span class="builtintype" id="4644465">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644470">if</span>&nbsp;<span class="ident" id="4644473">max</span>&nbsp;<span class="op" id="4644477">&gt;</span>&nbsp;<span class="ident" id="4644479">huffmanChunkBits</span>&nbsp;<span class="op" id="4644496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644500">linkBits</span>&nbsp;<span class="op" id="4644509">=</span>&nbsp;<span class="builtintype" id="4644511">uint</span><span class="op" id="4644515">(</span><span class="ident" id="4644516">max</span><span class="op" id="4644519">)</span>&nbsp;<span class="op" id="4644521">-</span>&nbsp;<span class="ident" id="4644523">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644542">numLinks</span>&nbsp;<span class="op" id="4644551">=</span>&nbsp;<span class="num" id="4644553">1</span>&nbsp;<span class="op" id="4644555">&lt;&lt;</span>&nbsp;<span class="ident" id="4644558">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644569">h</span><span class="op" id="4644570">.</span><span class="ident" id="4644571">linkMask</span>&nbsp;<span class="op" id="4644580">=</span>&nbsp;<span class="builtintype" id="4644582">uint32</span><span class="op" id="4644588">(</span><span class="ident" id="4644589">numLinks</span>&nbsp;<span class="op" id="4644598">-</span>&nbsp;<span class="num" id="4644600">1</span><span class="op" id="4644601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644607">code</span>&nbsp;<span class="op" id="4644612">:=</span>&nbsp;<span class="num" id="4644615">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644618">var</span>&nbsp;<span class="ident" id="4644622">nextcode</span>&nbsp;<span class="op" id="4644631">[</span><span class="ident" id="4644632">maxCodeLen</span><span class="op" id="4644642">]</span><span class="builtintype" id="4644643">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644648">for</span>&nbsp;<span class="ident" id="4644652">i</span>&nbsp;<span class="op" id="4644654">:=</span>&nbsp;<span class="ident" id="4644657">min</span><span class="op" id="4644660">;</span>&nbsp;<span class="ident" id="4644662">i</span>&nbsp;<span class="op" id="4644664">&lt;=</span>&nbsp;<span class="ident" id="4644667">max</span><span class="op" id="4644670">;</span>&nbsp;<span class="ident" id="4644672">i</span><span class="op" id="4644673">++</span>&nbsp;<span class="op" id="4644676">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644680">if</span>&nbsp;<span class="ident" id="4644683">i</span>&nbsp;<span class="op" id="4644685">==</span>&nbsp;<span class="ident" id="4644688">huffmanChunkBits</span><span class="op" id="4644704">+</span><span class="num" id="4644705">1</span>&nbsp;<span class="op" id="4644707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644712">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644737">link</span>&nbsp;<span class="op" id="4644742">:=</span>&nbsp;<span class="ident" id="4644745">code</span>&nbsp;<span class="op" id="4644750">&gt;&gt;</span>&nbsp;<span class="num" id="4644753">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644758">if</span>&nbsp;<span class="ident" id="4644761">huffmanNumChunks</span>&nbsp;<span class="op" id="4644778">&lt;</span>&nbsp;<span class="ident" id="4644780">link</span>&nbsp;<span class="op" id="4644785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644791">return</span>&nbsp;<span class="builtintype" id="4644798">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644812">h</span><span class="op" id="4644813">.</span><span class="ident" id="4644814">links</span>&nbsp;<span class="op" id="4644820">=</span>&nbsp;<span class="builtinfunc" id="4644822">make</span><span class="op" id="4644826">(</span><span class="op" id="4644827">[</span><span class="op" id="4644828">]</span><span class="op" id="4644829">[</span><span class="op" id="4644830">]</span><span class="builtintype" id="4644831">uint32</span><span class="op" id="4644837">,</span>&nbsp;<span class="ident" id="4644839">huffmanNumChunks</span><span class="op" id="4644855">-</span><span class="ident" id="4644856">link</span><span class="op" id="4644860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644865">for</span>&nbsp;<span class="ident" id="4644869">j</span>&nbsp;<span class="op" id="4644871">:=</span>&nbsp;<span class="builtintype" id="4644874">uint</span><span class="op" id="4644878">(</span><span class="ident" id="4644879">link</span><span class="op" id="4644883">)</span><span class="op" id="4644884">;</span>&nbsp;<span class="ident" id="4644886">j</span>&nbsp;<span class="op" id="4644888">&lt;</span>&nbsp;<span class="ident" id="4644890">huffmanNumChunks</span><span class="op" id="4644906">;</span>&nbsp;<span class="ident" id="4644908">j</span><span class="op" id="4644909">++</span>&nbsp;<span class="op" id="4644912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644918">reverse</span>&nbsp;<span class="op" id="4644926">:=</span>&nbsp;<span class="builtintype" id="4644929">int</span><span class="op" id="4644932">(</span><span class="ident" id="4644933">reverseByte</span><span class="op" id="4644944">[</span><span class="ident" id="4644945">j</span><span class="op" id="4644946">&gt;&gt;</span><span class="num" id="4644948">8</span><span class="op" id="4644949">]</span><span class="op" id="4644950">)</span>&nbsp;<span class="op" id="4644952">|</span>&nbsp;<span class="builtintype" id="4644954">int</span><span class="op" id="4644957">(</span><span class="ident" id="4644958">reverseByte</span><span class="op" id="4644969">[</span><span class="ident" id="4644970">j</span><span class="op" id="4644971">&amp;</span><span class="num" id="4644972">0xff</span><span class="op" id="4644976">]</span><span class="op" id="4644977">)</span><span class="op" id="4644978">&lt;&lt;</span><span class="num" id="4644980">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644986">reverse</span>&nbsp;<span class="op" id="4644994">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4644998">uint</span><span class="op" id="4645002">(</span><span class="num" id="4645003">16</span>&nbsp;<span class="op" id="4645006">-</span>&nbsp;<span class="ident" id="4645008">huffmanChunkBits</span><span class="op" id="4645024">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645030">off</span>&nbsp;<span class="op" id="4645034">:=</span>&nbsp;<span class="ident" id="4645037">j</span>&nbsp;<span class="op" id="4645039">-</span>&nbsp;<span class="builtintype" id="4645041">uint</span><span class="op" id="4645045">(</span><span class="ident" id="4645046">link</span><span class="op" id="4645050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645056">h</span><span class="op" id="4645057">.</span><span class="ident" id="4645058">chunks</span><span class="op" id="4645064">[</span><span class="ident" id="4645065">reverse</span><span class="op" id="4645072">]</span>&nbsp;<span class="op" id="4645074">=</span>&nbsp;<span class="builtintype" id="4645076">uint32</span><span class="op" id="4645082">(</span><span class="ident" id="4645083">off</span><span class="op" id="4645086">&lt;&lt;</span><span class="ident" id="4645088">huffmanValueShift</span>&nbsp;<span class="op" id="4645106">+</span>&nbsp;<span class="builtintype" id="4645108">uint</span><span class="op" id="4645112">(</span><span class="ident" id="4645113">i</span><span class="op" id="4645114">)</span><span class="op" id="4645115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645121">h</span><span class="op" id="4645122">.</span><span class="ident" id="4645123">links</span><span class="op" id="4645128">[</span><span class="ident" id="4645129">off</span><span class="op" id="4645132">]</span>&nbsp;<span class="op" id="4645134">=</span>&nbsp;<span class="builtinfunc" id="4645136">make</span><span class="op" id="4645140">(</span><span class="op" id="4645141">[</span><span class="op" id="4645142">]</span><span class="builtintype" id="4645143">uint32</span><span class="op" id="4645149">,</span>&nbsp;<span class="num" id="4645151">1</span><span class="op" id="4645152">&lt;&lt;</span><span class="ident" id="4645154">linkBits</span><span class="op" id="4645162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645171">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645175">n</span>&nbsp;<span class="op" id="4645177">:=</span>&nbsp;<span class="ident" id="4645180">count</span><span class="op" id="4645185">[</span><span class="ident" id="4645186">i</span><span class="op" id="4645187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645191">nextcode</span><span class="op" id="4645199">[</span><span class="ident" id="4645200">i</span><span class="op" id="4645201">]</span>&nbsp;<span class="op" id="4645203">=</span>&nbsp;<span class="ident" id="4645205">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645212">code</span>&nbsp;<span class="op" id="4645217">+=</span>&nbsp;<span class="ident" id="4645220">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645224">code</span>&nbsp;<span class="op" id="4645229">&lt;&lt;=</span>&nbsp;<span class="num" id="4645233">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645236">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645240">for</span>&nbsp;<span class="ident" id="4645244">i</span><span class="op" id="4645245">,</span>&nbsp;<span class="ident" id="4645247">n</span>&nbsp;<span class="op" id="4645249">:=</span>&nbsp;<span class="keyword" id="4645252">range</span>&nbsp;<span class="ident" id="4645258">bits</span>&nbsp;<span class="op" id="4645263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645267">if</span>&nbsp;<span class="ident" id="4645270">n</span>&nbsp;<span class="op" id="4645272">==</span>&nbsp;<span class="num" id="4645275">0</span>&nbsp;<span class="op" id="4645277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645282">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645293">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645297">code</span>&nbsp;<span class="op" id="4645302">:=</span>&nbsp;<span class="ident" id="4645305">nextcode</span><span class="op" id="4645313">[</span><span class="ident" id="4645314">n</span><span class="op" id="4645315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645319">nextcode</span><span class="op" id="4645327">[</span><span class="ident" id="4645328">n</span><span class="op" id="4645329">]</span><span class="op" id="4645330">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645335">chunk</span>&nbsp;<span class="op" id="4645341">:=</span>&nbsp;<span class="builtintype" id="4645344">uint32</span><span class="op" id="4645350">(</span><span class="ident" id="4645351">i</span><span class="op" id="4645352">&lt;&lt;</span><span class="ident" id="4645354">huffmanValueShift</span>&nbsp;<span class="op" id="4645372">|</span>&nbsp;<span class="ident" id="4645374">n</span><span class="op" id="4645375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645379">reverse</span>&nbsp;<span class="op" id="4645387">:=</span>&nbsp;<span class="builtintype" id="4645390">int</span><span class="op" id="4645393">(</span><span class="ident" id="4645394">reverseByte</span><span class="op" id="4645405">[</span><span class="ident" id="4645406">code</span><span class="op" id="4645410">&gt;&gt;</span><span class="num" id="4645412">8</span><span class="op" id="4645413">]</span><span class="op" id="4645414">)</span>&nbsp;<span class="op" id="4645416">|</span>&nbsp;<span class="builtintype" id="4645418">int</span><span class="op" id="4645421">(</span><span class="ident" id="4645422">reverseByte</span><span class="op" id="4645433">[</span><span class="ident" id="4645434">code</span><span class="op" id="4645438">&amp;</span><span class="num" id="4645439">0xff</span><span class="op" id="4645443">]</span><span class="op" id="4645444">)</span><span class="op" id="4645445">&lt;&lt;</span><span class="num" id="4645447">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645451">reverse</span>&nbsp;<span class="op" id="4645459">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4645463">uint</span><span class="op" id="4645467">(</span><span class="num" id="4645468">16</span>&nbsp;<span class="op" id="4645471">-</span>&nbsp;<span class="ident" id="4645473">n</span><span class="op" id="4645474">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645478">if</span>&nbsp;<span class="ident" id="4645481">n</span>&nbsp;<span class="op" id="4645483">&lt;=</span>&nbsp;<span class="ident" id="4645486">huffmanChunkBits</span>&nbsp;<span class="op" id="4645503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645508">for</span>&nbsp;<span class="ident" id="4645512">off</span>&nbsp;<span class="op" id="4645516">:=</span>&nbsp;<span class="ident" id="4645519">reverse</span><span class="op" id="4645526">;</span>&nbsp;<span class="ident" id="4645528">off</span>&nbsp;<span class="op" id="4645532">&lt;</span>&nbsp;<span class="ident" id="4645534">huffmanNumChunks</span><span class="op" id="4645550">;</span>&nbsp;<span class="ident" id="4645552">off</span>&nbsp;<span class="op" id="4645556">+=</span>&nbsp;<span class="num" id="4645559">1</span>&nbsp;<span class="op" id="4645561">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4645564">uint</span><span class="op" id="4645568">(</span><span class="ident" id="4645569">n</span><span class="op" id="4645570">)</span>&nbsp;<span class="op" id="4645572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645578">h</span><span class="op" id="4645579">.</span><span class="ident" id="4645580">chunks</span><span class="op" id="4645586">[</span><span class="ident" id="4645587">off</span><span class="op" id="4645590">]</span>&nbsp;<span class="op" id="4645592">=</span>&nbsp;<span class="ident" id="4645594">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645607">}</span>&nbsp;<span class="keyword" id="4645609">else</span>&nbsp;<span class="op" id="4645614">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645619">value</span>&nbsp;<span class="op" id="4645625">:=</span>&nbsp;<span class="ident" id="4645628">h</span><span class="op" id="4645629">.</span><span class="ident" id="4645630">chunks</span><span class="op" id="4645636">[</span><span class="ident" id="4645637">reverse</span><span class="op" id="4645644">&amp;</span><span class="op" id="4645645">(</span><span class="ident" id="4645646">huffmanNumChunks</span><span class="op" id="4645662">-</span><span class="num" id="4645663">1</span><span class="op" id="4645664">)</span><span class="op" id="4645665">]</span>&nbsp;<span class="op" id="4645667">&gt;&gt;</span>&nbsp;<span class="ident" id="4645670">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645691">if</span>&nbsp;<span class="ident" id="4645694">value</span>&nbsp;<span class="op" id="4645700">&gt;=</span>&nbsp;<span class="builtintype" id="4645703">uint32</span><span class="op" id="4645709">(</span><span class="builtinfunc" id="4645710">len</span><span class="op" id="4645713">(</span><span class="ident" id="4645714">h</span><span class="op" id="4645715">.</span><span class="ident" id="4645716">links</span><span class="op" id="4645721">)</span><span class="op" id="4645722">)</span>&nbsp;<span class="op" id="4645724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645730">return</span>&nbsp;<span class="builtintype" id="4645737">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645751">linktab</span>&nbsp;<span class="op" id="4645759">:=</span>&nbsp;<span class="ident" id="4645762">h</span><span class="op" id="4645763">.</span><span class="ident" id="4645764">links</span><span class="op" id="4645769">[</span><span class="ident" id="4645770">value</span><span class="op" id="4645775">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645780">reverse</span>&nbsp;<span class="op" id="4645788">&gt;&gt;=</span>&nbsp;<span class="ident" id="4645792">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645812">for</span>&nbsp;<span class="ident" id="4645816">off</span>&nbsp;<span class="op" id="4645820">:=</span>&nbsp;<span class="ident" id="4645823">reverse</span><span class="op" id="4645830">;</span>&nbsp;<span class="ident" id="4645832">off</span>&nbsp;<span class="op" id="4645836">&lt;</span>&nbsp;<span class="ident" id="4645838">numLinks</span><span class="op" id="4645846">;</span>&nbsp;<span class="ident" id="4645848">off</span>&nbsp;<span class="op" id="4645852">+=</span>&nbsp;<span class="num" id="4645855">1</span>&nbsp;<span class="op" id="4645857">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4645860">uint</span><span class="op" id="4645864">(</span><span class="ident" id="4645865">n</span><span class="op" id="4645866">-</span><span class="ident" id="4645867">huffmanChunkBits</span><span class="op" id="4645883">)</span>&nbsp;<span class="op" id="4645885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645891">linktab</span><span class="op" id="4645898">[</span><span class="ident" id="4645899">off</span><span class="op" id="4645902">]</span>&nbsp;<span class="op" id="4645904">=</span>&nbsp;<span class="ident" id="4645906">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645919">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645925">return</span>&nbsp;<span class="builtintype" id="4645932">true</span><br>
<span class="lineno"></span><span class="op" id="4645937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4645940">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4645990">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4646049">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4646100">type</span>&nbsp;<span class="ident" id="4646105">Reader</span>&nbsp;<span class="keyword" id="4646112">interface</span>&nbsp;<span class="op" id="4646122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646125">io</span><span class="op" id="4646127">.</span><span class="ident" id="4646128">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646136">io</span><span class="op" id="4646138">.</span><span class="ident" id="4646139">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4646150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4646153">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4646174">type</span>&nbsp;<span class="ident" id="4646179">decompressor</span>&nbsp;<span class="keyword" id="4646192">struct</span>&nbsp;<span class="op" id="4646199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646202">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646220">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646228">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646236">roffset</span>&nbsp;<span class="ident" id="4646244">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646251">woffset</span>&nbsp;<span class="ident" id="4646259">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646267">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646296">b</span>&nbsp;&nbsp;<span class="builtintype" id="4646299">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646307">nb</span>&nbsp;<span class="builtintype" id="4646310">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646317">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646368">h1</span><span class="op" id="4646370">,</span>&nbsp;<span class="ident" id="4646372">h2</span>&nbsp;<span class="ident" id="4646375">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646392">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646440">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4646449">*</span><span class="op" id="4646450">[</span><span class="ident" id="4646451">maxLit</span>&nbsp;<span class="op" id="4646458">+</span>&nbsp;<span class="ident" id="4646460">maxDist</span><span class="op" id="4646467">]</span><span class="builtintype" id="4646468">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646473">codebits</span>&nbsp;<span class="op" id="4646482">*</span><span class="op" id="4646483">[</span><span class="ident" id="4646484">numCodes</span><span class="op" id="4646492">]</span><span class="builtintype" id="4646493">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646499">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646527">hist</span>&nbsp;&nbsp;<span class="op" id="4646533">*</span><span class="op" id="4646534">[</span><span class="ident" id="4646535">maxHist</span><span class="op" id="4646542">]</span><span class="builtintype" id="4646543">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646549">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646555">int</span>&nbsp;&nbsp;<span class="comment" id="4646560">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646598">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646604">int</span>&nbsp;&nbsp;<span class="comment" id="4646609">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646645">hfull</span>&nbsp;<span class="builtintype" id="4646651">bool</span>&nbsp;<span class="comment" id="4646656">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646693">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646744">buf</span>&nbsp;<span class="op" id="4646748">[</span><span class="num" id="4646749">4</span><span class="op" id="4646750">]</span><span class="builtintype" id="4646751">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646758">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646794">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646823">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4646832">func</span><span class="op" id="4646836">(</span><span class="op" id="4646837">*</span><span class="ident" id="4646838">decompressor</span><span class="op" id="4646850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646853">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646862">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646868">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646877">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646884">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4646893">[</span><span class="op" id="4646894">]</span><span class="builtintype" id="4646895">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646901">hl</span><span class="op" id="4646903">,</span>&nbsp;<span class="ident" id="4646905">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4646910">*</span><span class="ident" id="4646911">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646927">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4646936">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646941">copyDist</span>&nbsp;<span class="builtintype" id="4646950">int</span><br>
<span class="lineno"></span><span class="op" id="4646954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4646957">func</span>&nbsp;<span class="op" id="4646962">(</span><span class="ident" id="4646963">f</span>&nbsp;<span class="op" id="4646965">*</span><span class="ident" id="4646966">decompressor</span><span class="op" id="4646978">)</span>&nbsp;<span class="ident" id="4646980">nextBlock</span><span class="op" id="4646989">(</span><span class="op" id="4646990">)</span>&nbsp;<span class="op" id="4646992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4646995">if</span>&nbsp;<span class="ident" id="4646998">f</span><span class="op" id="4646999">.</span><span class="ident" id="4647000">final</span>&nbsp;<span class="op" id="4647006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647010">if</span>&nbsp;<span class="ident" id="4647013">f</span><span class="op" id="4647014">.</span><span class="ident" id="4647015">hw</span>&nbsp;<span class="op" id="4647018">!=</span>&nbsp;<span class="ident" id="4647021">f</span><span class="op" id="4647022">.</span><span class="ident" id="4647023">hp</span>&nbsp;<span class="op" id="4647026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647031">f</span><span class="op" id="4647032">.</span><span class="ident" id="4647033">flush</span><span class="op" id="4647038">(</span><span class="op" id="4647039">(</span><span class="op" id="4647040">*</span><span class="ident" id="4647041">decompressor</span><span class="op" id="4647053">)</span><span class="op" id="4647054">.</span><span class="ident" id="4647055">nextBlock</span><span class="op" id="4647064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647069">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647082">f</span><span class="op" id="4647083">.</span><span class="ident" id="4647084">err</span>&nbsp;<span class="op" id="4647088">=</span>&nbsp;<span class="ident" id="4647090">io</span><span class="op" id="4647092">.</span><span class="ident" id="4647093">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647110">for</span>&nbsp;<span class="ident" id="4647114">f</span><span class="op" id="4647115">.</span><span class="ident" id="4647116">nb</span>&nbsp;<span class="op" id="4647119">&lt;</span>&nbsp;<span class="num" id="4647121">1</span><span class="op" id="4647122">+</span><span class="num" id="4647123">2</span>&nbsp;<span class="op" id="4647125">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647129">if</span>&nbsp;<span class="ident" id="4647132">f</span><span class="op" id="4647133">.</span><span class="ident" id="4647134">err</span>&nbsp;<span class="op" id="4647138">=</span>&nbsp;<span class="ident" id="4647140">f</span><span class="op" id="4647141">.</span><span class="ident" id="4647142">moreBits</span><span class="op" id="4647150">(</span><span class="op" id="4647151">)</span><span class="op" id="4647152">;</span>&nbsp;<span class="ident" id="4647154">f</span><span class="op" id="4647155">.</span><span class="ident" id="4647156">err</span>&nbsp;<span class="op" id="4647160">!=</span>&nbsp;<span class="ident" id="4647163">nil</span>&nbsp;<span class="op" id="4647167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647172">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647187">f</span><span class="op" id="4647188">.</span><span class="ident" id="4647189">final</span>&nbsp;<span class="op" id="4647195">=</span>&nbsp;<span class="ident" id="4647197">f</span><span class="op" id="4647198">.</span><span class="ident" id="4647199">b</span><span class="op" id="4647200">&amp;</span><span class="num" id="4647201">1</span>&nbsp;<span class="op" id="4647203">==</span>&nbsp;<span class="num" id="4647206">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647209">f</span><span class="op" id="4647210">.</span><span class="ident" id="4647211">b</span>&nbsp;<span class="op" id="4647213">&gt;&gt;=</span>&nbsp;<span class="num" id="4647217">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647220">typ</span>&nbsp;<span class="op" id="4647224">:=</span>&nbsp;<span class="ident" id="4647227">f</span><span class="op" id="4647228">.</span><span class="ident" id="4647229">b</span>&nbsp;<span class="op" id="4647231">&amp;</span>&nbsp;<span class="num" id="4647233">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647236">f</span><span class="op" id="4647237">.</span><span class="ident" id="4647238">b</span>&nbsp;<span class="op" id="4647240">&gt;&gt;=</span>&nbsp;<span class="num" id="4647244">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647247">f</span><span class="op" id="4647248">.</span><span class="ident" id="4647249">nb</span>&nbsp;<span class="op" id="4647252">-=</span>&nbsp;<span class="num" id="4647255">1</span>&nbsp;<span class="op" id="4647257">+</span>&nbsp;<span class="num" id="4647259">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647262">switch</span>&nbsp;<span class="ident" id="4647269">typ</span>&nbsp;<span class="op" id="4647273">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647276">case</span>&nbsp;<span class="num" id="4647281">0</span><span class="op" id="4647282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647286">f</span><span class="op" id="4647287">.</span><span class="ident" id="4647288">dataBlock</span><span class="op" id="4647297">(</span><span class="op" id="4647298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647301">case</span>&nbsp;<span class="num" id="4647306">1</span><span class="op" id="4647307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647311">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647349">f</span><span class="op" id="4647350">.</span><span class="ident" id="4647351">hl</span>&nbsp;<span class="op" id="4647354">=</span>&nbsp;<span class="op" id="4647356">&amp;</span><span class="ident" id="4647357">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647379">f</span><span class="op" id="4647380">.</span><span class="ident" id="4647381">hd</span>&nbsp;<span class="op" id="4647384">=</span>&nbsp;<span class="ident" id="4647386">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647392">f</span><span class="op" id="4647393">.</span><span class="ident" id="4647394">huffmanBlock</span><span class="op" id="4647406">(</span><span class="op" id="4647407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647410">case</span>&nbsp;<span class="num" id="4647415">2</span><span class="op" id="4647416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647420">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647460">if</span>&nbsp;<span class="ident" id="4647463">f</span><span class="op" id="4647464">.</span><span class="ident" id="4647465">err</span>&nbsp;<span class="op" id="4647469">=</span>&nbsp;<span class="ident" id="4647471">f</span><span class="op" id="4647472">.</span><span class="ident" id="4647473">readHuffman</span><span class="op" id="4647484">(</span><span class="op" id="4647485">)</span><span class="op" id="4647486">;</span>&nbsp;<span class="ident" id="4647488">f</span><span class="op" id="4647489">.</span><span class="ident" id="4647490">err</span>&nbsp;<span class="op" id="4647494">!=</span>&nbsp;<span class="ident" id="4647497">nil</span>&nbsp;<span class="op" id="4647501">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647506">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647518">f</span><span class="op" id="4647519">.</span><span class="ident" id="4647520">hl</span>&nbsp;<span class="op" id="4647523">=</span>&nbsp;<span class="op" id="4647525">&amp;</span><span class="ident" id="4647526">f</span><span class="op" id="4647527">.</span><span class="ident" id="4647528">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647533">f</span><span class="op" id="4647534">.</span><span class="ident" id="4647535">hd</span>&nbsp;<span class="op" id="4647538">=</span>&nbsp;<span class="op" id="4647540">&amp;</span><span class="ident" id="4647541">f</span><span class="op" id="4647542">.</span><span class="ident" id="4647543">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647548">f</span><span class="op" id="4647549">.</span><span class="ident" id="4647550">huffmanBlock</span><span class="op" id="4647562">(</span><span class="op" id="4647563">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647566">default</span><span class="op" id="4647573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647577">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647597">f</span><span class="op" id="4647598">.</span><span class="ident" id="4647599">err</span>&nbsp;<span class="op" id="4647603">=</span>&nbsp;<span class="ident" id="4647605">CorruptInputError</span><span class="op" id="4647622">(</span><span class="ident" id="4647623">f</span><span class="op" id="4647624">.</span><span class="ident" id="4647625">roffset</span><span class="op" id="4647632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647635">}</span><br>
<span class="lineno"></span><span class="op" id="4647637">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4647640">func</span>&nbsp;<span class="op" id="4647645">(</span><span class="ident" id="4647646">f</span>&nbsp;<span class="op" id="4647648">*</span><span class="ident" id="4647649">decompressor</span><span class="op" id="4647661">)</span>&nbsp;<span class="ident" id="4647663">Read</span><span class="op" id="4647667">(</span><span class="ident" id="4647668">b</span>&nbsp;<span class="op" id="4647670">[</span><span class="op" id="4647671">]</span><span class="builtintype" id="4647672">byte</span><span class="op" id="4647676">)</span>&nbsp;<span class="op" id="4647678">(</span><span class="builtintype" id="4647679">int</span><span class="op" id="4647682">,</span>&nbsp;<span class="builtintype" id="4647684">error</span><span class="op" id="4647689">)</span>&nbsp;<span class="op" id="4647691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647694">for</span>&nbsp;<span class="op" id="4647698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647702">if</span>&nbsp;<span class="builtinfunc" id="4647705">len</span><span class="op" id="4647708">(</span><span class="ident" id="4647709">f</span><span class="op" id="4647710">.</span><span class="ident" id="4647711">toRead</span><span class="op" id="4647717">)</span>&nbsp;<span class="op" id="4647719">&gt;</span>&nbsp;<span class="num" id="4647721">0</span>&nbsp;<span class="op" id="4647723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647728">n</span>&nbsp;<span class="op" id="4647730">:=</span>&nbsp;<span class="builtinfunc" id="4647733">copy</span><span class="op" id="4647737">(</span><span class="ident" id="4647738">b</span><span class="op" id="4647739">,</span>&nbsp;<span class="ident" id="4647741">f</span><span class="op" id="4647742">.</span><span class="ident" id="4647743">toRead</span><span class="op" id="4647749">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647754">f</span><span class="op" id="4647755">.</span><span class="ident" id="4647756">toRead</span>&nbsp;<span class="op" id="4647763">=</span>&nbsp;<span class="ident" id="4647765">f</span><span class="op" id="4647766">.</span><span class="ident" id="4647767">toRead</span><span class="op" id="4647773">[</span><span class="ident" id="4647774">n</span><span class="op" id="4647775">:</span><span class="op" id="4647776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647781">return</span>&nbsp;<span class="ident" id="4647788">n</span><span class="op" id="4647789">,</span>&nbsp;<span class="ident" id="4647791">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647801">if</span>&nbsp;<span class="ident" id="4647804">f</span><span class="op" id="4647805">.</span><span class="ident" id="4647806">err</span>&nbsp;<span class="op" id="4647810">!=</span>&nbsp;<span class="ident" id="4647813">nil</span>&nbsp;<span class="op" id="4647817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647822">return</span>&nbsp;<span class="num" id="4647829">0</span><span class="op" id="4647830">,</span>&nbsp;<span class="ident" id="4647832">f</span><span class="op" id="4647833">.</span><span class="ident" id="4647834">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647844">f</span><span class="op" id="4647845">.</span><span class="ident" id="4647846">step</span><span class="op" id="4647850">(</span><span class="ident" id="4647851">f</span><span class="op" id="4647852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647855">}</span><br>
<span class="lineno"></span><span class="op" id="4647857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4647860">func</span>&nbsp;<span class="op" id="4647865">(</span><span class="ident" id="4647866">f</span>&nbsp;<span class="op" id="4647868">*</span><span class="ident" id="4647869">decompressor</span><span class="op" id="4647881">)</span>&nbsp;<span class="ident" id="4647883">Close</span><span class="op" id="4647888">(</span><span class="op" id="4647889">)</span>&nbsp;<span class="builtintype" id="4647891">error</span>&nbsp;<span class="op" id="4647897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647900">if</span>&nbsp;<span class="ident" id="4647903">f</span><span class="op" id="4647904">.</span><span class="ident" id="4647905">err</span>&nbsp;<span class="op" id="4647909">==</span>&nbsp;<span class="ident" id="4647912">io</span><span class="op" id="4647914">.</span><span class="ident" id="4647915">EOF</span>&nbsp;<span class="op" id="4647919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647923">return</span>&nbsp;<span class="ident" id="4647930">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647938">return</span>&nbsp;<span class="ident" id="4647945">f</span><span class="op" id="4647946">.</span><span class="ident" id="4647947">err</span><br>
<span class="lineno">295</span><span class="op" id="4647951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4647954">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4647981">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4648024">var</span>&nbsp;<span class="ident" id="4648028">codeOrder</span>&nbsp;<span class="op" id="4648038">=</span>&nbsp;<span class="op" id="4648040">[</span><span class="op" id="4648041">...</span><span class="op" id="4648044">]</span><span class="builtintype" id="4648045">int</span><span class="op" id="4648048">{</span><span class="num" id="4648049">16</span><span class="op" id="4648051">,</span>&nbsp;<span class="num" id="4648053">17</span><span class="op" id="4648055">,</span>&nbsp;<span class="num" id="4648057">18</span><span class="op" id="4648059">,</span>&nbsp;<span class="num" id="4648061">0</span><span class="op" id="4648062">,</span>&nbsp;<span class="num" id="4648064">8</span><span class="op" id="4648065">,</span>&nbsp;<span class="num" id="4648067">7</span><span class="op" id="4648068">,</span>&nbsp;<span class="num" id="4648070">9</span><span class="op" id="4648071">,</span>&nbsp;<span class="num" id="4648073">6</span><span class="op" id="4648074">,</span>&nbsp;<span class="num" id="4648076">10</span><span class="op" id="4648078">,</span>&nbsp;<span class="num" id="4648080">5</span><span class="op" id="4648081">,</span>&nbsp;<span class="num" id="4648083">11</span><span class="op" id="4648085">,</span>&nbsp;<span class="num" id="4648087">4</span><span class="op" id="4648088">,</span>&nbsp;<span class="num" id="4648090">12</span><span class="op" id="4648092">,</span>&nbsp;<span class="num" id="4648094">3</span><span class="op" id="4648095">,</span>&nbsp;<span class="num" id="4648097">13</span><span class="op" id="4648099">,</span>&nbsp;<span class="num" id="4648101">2</span><span class="op" id="4648102">,</span>&nbsp;<span class="num" id="4648104">14</span><span class="op" id="4648106">,</span>&nbsp;<span class="num" id="4648108">1</span><span class="op" id="4648109">,</span>&nbsp;<span class="num" id="4648111">15</span><span class="op" id="4648113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4648116">func</span>&nbsp;<span class="op" id="4648121">(</span><span class="ident" id="4648122">f</span>&nbsp;<span class="op" id="4648124">*</span><span class="ident" id="4648125">decompressor</span><span class="op" id="4648137">)</span>&nbsp;<span class="ident" id="4648139">readHuffman</span><span class="op" id="4648150">(</span><span class="op" id="4648151">)</span>&nbsp;<span class="builtintype" id="4648153">error</span>&nbsp;<span class="op" id="4648159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4648162">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648195">for</span>&nbsp;<span class="ident" id="4648199">f</span><span class="op" id="4648200">.</span><span class="ident" id="4648201">nb</span>&nbsp;<span class="op" id="4648204">&lt;</span>&nbsp;<span class="num" id="4648206">5</span><span class="op" id="4648207">+</span><span class="num" id="4648208">5</span><span class="op" id="4648209">+</span><span class="num" id="4648210">4</span>&nbsp;<span class="op" id="4648212">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648216">if</span>&nbsp;<span class="ident" id="4648219">err</span>&nbsp;<span class="op" id="4648223">:=</span>&nbsp;<span class="ident" id="4648226">f</span><span class="op" id="4648227">.</span><span class="ident" id="4648228">moreBits</span><span class="op" id="4648236">(</span><span class="op" id="4648237">)</span><span class="op" id="4648238">;</span>&nbsp;<span class="ident" id="4648240">err</span>&nbsp;<span class="op" id="4648244">!=</span>&nbsp;<span class="ident" id="4648247">nil</span>&nbsp;<span class="op" id="4648251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648256">return</span>&nbsp;<span class="ident" id="4648263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648275">nlit</span>&nbsp;<span class="op" id="4648280">:=</span>&nbsp;<span class="builtintype" id="4648283">int</span><span class="op" id="4648286">(</span><span class="ident" id="4648287">f</span><span class="op" id="4648288">.</span><span class="ident" id="4648289">b</span><span class="op" id="4648290">&amp;</span><span class="num" id="4648291">0x1F</span><span class="op" id="4648295">)</span>&nbsp;<span class="op" id="4648297">+</span>&nbsp;<span class="num" id="4648299">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648304">if</span>&nbsp;<span class="ident" id="4648307">nlit</span>&nbsp;<span class="op" id="4648312">&gt;</span>&nbsp;<span class="ident" id="4648314">maxLit</span>&nbsp;<span class="op" id="4648321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648325">return</span>&nbsp;<span class="ident" id="4648332">CorruptInputError</span><span class="op" id="4648349">(</span><span class="ident" id="4648350">f</span><span class="op" id="4648351">.</span><span class="ident" id="4648352">roffset</span><span class="op" id="4648359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648365">f</span><span class="op" id="4648366">.</span><span class="ident" id="4648367">b</span>&nbsp;<span class="op" id="4648369">&gt;&gt;=</span>&nbsp;<span class="num" id="4648373">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648376">ndist</span>&nbsp;<span class="op" id="4648382">:=</span>&nbsp;<span class="builtintype" id="4648385">int</span><span class="op" id="4648388">(</span><span class="ident" id="4648389">f</span><span class="op" id="4648390">.</span><span class="ident" id="4648391">b</span><span class="op" id="4648392">&amp;</span><span class="num" id="4648393">0x1F</span><span class="op" id="4648397">)</span>&nbsp;<span class="op" id="4648399">+</span>&nbsp;<span class="num" id="4648401">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4648404">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648449">f</span><span class="op" id="4648450">.</span><span class="ident" id="4648451">b</span>&nbsp;<span class="op" id="4648453">&gt;&gt;=</span>&nbsp;<span class="num" id="4648457">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648460">nclen</span>&nbsp;<span class="op" id="4648466">:=</span>&nbsp;<span class="builtintype" id="4648469">int</span><span class="op" id="4648472">(</span><span class="ident" id="4648473">f</span><span class="op" id="4648474">.</span><span class="ident" id="4648475">b</span><span class="op" id="4648476">&amp;</span><span class="num" id="4648477">0xF</span><span class="op" id="4648480">)</span>&nbsp;<span class="op" id="4648482">+</span>&nbsp;<span class="num" id="4648484">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4648487">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648533">f</span><span class="op" id="4648534">.</span><span class="ident" id="4648535">b</span>&nbsp;<span class="op" id="4648537">&gt;&gt;=</span>&nbsp;<span class="num" id="4648541">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648544">f</span><span class="op" id="4648545">.</span><span class="ident" id="4648546">nb</span>&nbsp;<span class="op" id="4648549">-=</span>&nbsp;<span class="num" id="4648552">5</span>&nbsp;<span class="op" id="4648554">+</span>&nbsp;<span class="num" id="4648556">5</span>&nbsp;<span class="op" id="4648558">+</span>&nbsp;<span class="num" id="4648560">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4648564">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648629">for</span>&nbsp;<span class="ident" id="4648633">i</span>&nbsp;<span class="op" id="4648635">:=</span>&nbsp;<span class="num" id="4648638">0</span><span class="op" id="4648639">;</span>&nbsp;<span class="ident" id="4648641">i</span>&nbsp;<span class="op" id="4648643">&lt;</span>&nbsp;<span class="ident" id="4648645">nclen</span><span class="op" id="4648650">;</span>&nbsp;<span class="ident" id="4648652">i</span><span class="op" id="4648653">++</span>&nbsp;<span class="op" id="4648656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648660">for</span>&nbsp;<span class="ident" id="4648664">f</span><span class="op" id="4648665">.</span><span class="ident" id="4648666">nb</span>&nbsp;<span class="op" id="4648669">&lt;</span>&nbsp;<span class="num" id="4648671">3</span>&nbsp;<span class="op" id="4648673">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648678">if</span>&nbsp;<span class="ident" id="4648681">err</span>&nbsp;<span class="op" id="4648685">:=</span>&nbsp;<span class="ident" id="4648688">f</span><span class="op" id="4648689">.</span><span class="ident" id="4648690">moreBits</span><span class="op" id="4648698">(</span><span class="op" id="4648699">)</span><span class="op" id="4648700">;</span>&nbsp;<span class="ident" id="4648702">err</span>&nbsp;<span class="op" id="4648706">!=</span>&nbsp;<span class="ident" id="4648709">nil</span>&nbsp;<span class="op" id="4648713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648719">return</span>&nbsp;<span class="ident" id="4648726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648741">f</span><span class="op" id="4648742">.</span><span class="ident" id="4648743">codebits</span><span class="op" id="4648751">[</span><span class="ident" id="4648752">codeOrder</span><span class="op" id="4648761">[</span><span class="ident" id="4648762">i</span><span class="op" id="4648763">]</span><span class="op" id="4648764">]</span>&nbsp;<span class="op" id="4648766">=</span>&nbsp;<span class="builtintype" id="4648768">int</span><span class="op" id="4648771">(</span><span class="ident" id="4648772">f</span><span class="op" id="4648773">.</span><span class="ident" id="4648774">b</span>&nbsp;<span class="op" id="4648776">&amp;</span>&nbsp;<span class="num" id="4648778">0x7</span><span class="op" id="4648781">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648785">f</span><span class="op" id="4648786">.</span><span class="ident" id="4648787">b</span>&nbsp;<span class="op" id="4648789">&gt;&gt;=</span>&nbsp;<span class="num" id="4648793">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648797">f</span><span class="op" id="4648798">.</span><span class="ident" id="4648799">nb</span>&nbsp;<span class="op" id="4648802">-=</span>&nbsp;<span class="num" id="4648805">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648811">for</span>&nbsp;<span class="ident" id="4648815">i</span>&nbsp;<span class="op" id="4648817">:=</span>&nbsp;<span class="ident" id="4648820">nclen</span><span class="op" id="4648825">;</span>&nbsp;<span class="ident" id="4648827">i</span>&nbsp;<span class="op" id="4648829">&lt;</span>&nbsp;<span class="builtinfunc" id="4648831">len</span><span class="op" id="4648834">(</span><span class="ident" id="4648835">codeOrder</span><span class="op" id="4648844">)</span><span class="op" id="4648845">;</span>&nbsp;<span class="ident" id="4648847">i</span><span class="op" id="4648848">++</span>&nbsp;<span class="op" id="4648851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648855">f</span><span class="op" id="4648856">.</span><span class="ident" id="4648857">codebits</span><span class="op" id="4648865">[</span><span class="ident" id="4648866">codeOrder</span><span class="op" id="4648875">[</span><span class="ident" id="4648876">i</span><span class="op" id="4648877">]</span><span class="op" id="4648878">]</span>&nbsp;<span class="op" id="4648880">=</span>&nbsp;<span class="num" id="4648882">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648888">if</span>&nbsp;<span class="op" id="4648891">!</span><span class="ident" id="4648892">f</span><span class="op" id="4648893">.</span><span class="ident" id="4648894">h1</span><span class="op" id="4648896">.</span><span class="ident" id="4648897">init</span><span class="op" id="4648901">(</span><span class="ident" id="4648902">f</span><span class="op" id="4648903">.</span><span class="ident" id="4648904">codebits</span><span class="op" id="4648912">[</span><span class="num" id="4648913">0</span><span class="op" id="4648914">:</span><span class="op" id="4648915">]</span><span class="op" id="4648916">)</span>&nbsp;<span class="op" id="4648918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648922">return</span>&nbsp;<span class="ident" id="4648929">CorruptInputError</span><span class="op" id="4648946">(</span><span class="ident" id="4648947">f</span><span class="op" id="4648948">.</span><span class="ident" id="4648949">roffset</span><span class="op" id="4648956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4648963">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4649016">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649056">for</span>&nbsp;<span class="ident" id="4649060">i</span><span class="op" id="4649061">,</span>&nbsp;<span class="ident" id="4649063">n</span>&nbsp;<span class="op" id="4649065">:=</span>&nbsp;<span class="num" id="4649068">0</span><span class="op" id="4649069">,</span>&nbsp;<span class="ident" id="4649071">nlit</span><span class="op" id="4649075">+</span><span class="ident" id="4649076">ndist</span><span class="op" id="4649081">;</span>&nbsp;<span class="ident" id="4649083">i</span>&nbsp;<span class="op" id="4649085">&lt;</span>&nbsp;<span class="ident" id="4649087">n</span><span class="op" id="4649088">;</span>&nbsp;<span class="op" id="4649090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649094">x</span><span class="op" id="4649095">,</span>&nbsp;<span class="ident" id="4649097">err</span>&nbsp;<span class="op" id="4649101">:=</span>&nbsp;<span class="ident" id="4649104">f</span><span class="op" id="4649105">.</span><span class="ident" id="4649106">huffSym</span><span class="op" id="4649113">(</span><span class="op" id="4649114">&amp;</span><span class="ident" id="4649115">f</span><span class="op" id="4649116">.</span><span class="ident" id="4649117">h1</span><span class="op" id="4649119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649123">if</span>&nbsp;<span class="ident" id="4649126">err</span>&nbsp;<span class="op" id="4649130">!=</span>&nbsp;<span class="ident" id="4649133">nil</span>&nbsp;<span class="op" id="4649137">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649142">return</span>&nbsp;<span class="ident" id="4649149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649159">if</span>&nbsp;<span class="ident" id="4649162">x</span>&nbsp;<span class="op" id="4649164">&lt;</span>&nbsp;<span class="num" id="4649166">16</span>&nbsp;<span class="op" id="4649169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4649174">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649195">f</span><span class="op" id="4649196">.</span><span class="ident" id="4649197">bits</span><span class="op" id="4649201">[</span><span class="ident" id="4649202">i</span><span class="op" id="4649203">]</span>&nbsp;<span class="op" id="4649205">=</span>&nbsp;<span class="ident" id="4649207">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649212">i</span><span class="op" id="4649213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649219">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4649234">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649271">var</span>&nbsp;<span class="ident" id="4649275">rep</span>&nbsp;<span class="builtintype" id="4649279">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649285">var</span>&nbsp;<span class="ident" id="4649289">nb</span>&nbsp;<span class="builtintype" id="4649292">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649299">var</span>&nbsp;<span class="ident" id="4649303">b</span>&nbsp;<span class="builtintype" id="4649305">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649311">switch</span>&nbsp;<span class="ident" id="4649318">x</span>&nbsp;<span class="op" id="4649320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649324">default</span><span class="op" id="4649331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649336">return</span>&nbsp;<span class="ident" id="4649343">InternalError</span><span class="op" id="4649356">(</span><span class="string" id="4649357">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4649381">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649385">case</span>&nbsp;<span class="num" id="4649390">16</span><span class="op" id="4649392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649397">rep</span>&nbsp;<span class="op" id="4649401">=</span>&nbsp;<span class="num" id="4649403">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649408">nb</span>&nbsp;<span class="op" id="4649411">=</span>&nbsp;<span class="num" id="4649413">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649418">if</span>&nbsp;<span class="ident" id="4649421">i</span>&nbsp;<span class="op" id="4649423">==</span>&nbsp;<span class="num" id="4649426">0</span>&nbsp;<span class="op" id="4649428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649434">return</span>&nbsp;<span class="ident" id="4649441">CorruptInputError</span><span class="op" id="4649458">(</span><span class="ident" id="4649459">f</span><span class="op" id="4649460">.</span><span class="ident" id="4649461">roffset</span><span class="op" id="4649468">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649478">b</span>&nbsp;<span class="op" id="4649480">=</span>&nbsp;<span class="ident" id="4649482">f</span><span class="op" id="4649483">.</span><span class="ident" id="4649484">bits</span><span class="op" id="4649488">[</span><span class="ident" id="4649489">i</span><span class="op" id="4649490">-</span><span class="num" id="4649491">1</span><span class="op" id="4649492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649496">case</span>&nbsp;<span class="num" id="4649501">17</span><span class="op" id="4649503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649508">rep</span>&nbsp;<span class="op" id="4649512">=</span>&nbsp;<span class="num" id="4649514">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649519">nb</span>&nbsp;<span class="op" id="4649522">=</span>&nbsp;<span class="num" id="4649524">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649529">b</span>&nbsp;<span class="op" id="4649531">=</span>&nbsp;<span class="num" id="4649533">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649537">case</span>&nbsp;<span class="num" id="4649542">18</span><span class="op" id="4649544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649549">rep</span>&nbsp;<span class="op" id="4649553">=</span>&nbsp;<span class="num" id="4649555">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649561">nb</span>&nbsp;<span class="op" id="4649564">=</span>&nbsp;<span class="num" id="4649566">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649571">b</span>&nbsp;<span class="op" id="4649573">=</span>&nbsp;<span class="num" id="4649575">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649583">for</span>&nbsp;<span class="ident" id="4649587">f</span><span class="op" id="4649588">.</span><span class="ident" id="4649589">nb</span>&nbsp;<span class="op" id="4649592">&lt;</span>&nbsp;<span class="ident" id="4649594">nb</span>&nbsp;<span class="op" id="4649597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649602">if</span>&nbsp;<span class="ident" id="4649605">err</span>&nbsp;<span class="op" id="4649609">:=</span>&nbsp;<span class="ident" id="4649612">f</span><span class="op" id="4649613">.</span><span class="ident" id="4649614">moreBits</span><span class="op" id="4649622">(</span><span class="op" id="4649623">)</span><span class="op" id="4649624">;</span>&nbsp;<span class="ident" id="4649626">err</span>&nbsp;<span class="op" id="4649630">!=</span>&nbsp;<span class="ident" id="4649633">nil</span>&nbsp;<span class="op" id="4649637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649643">return</span>&nbsp;<span class="ident" id="4649650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649657">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649665">rep</span>&nbsp;<span class="op" id="4649669">+=</span>&nbsp;<span class="builtintype" id="4649672">int</span><span class="op" id="4649675">(</span><span class="ident" id="4649676">f</span><span class="op" id="4649677">.</span><span class="ident" id="4649678">b</span>&nbsp;<span class="op" id="4649680">&amp;</span>&nbsp;<span class="builtintype" id="4649682">uint32</span><span class="op" id="4649688">(</span><span class="num" id="4649689">1</span><span class="op" id="4649690">&lt;&lt;</span><span class="ident" id="4649692">nb</span><span class="op" id="4649694">-</span><span class="num" id="4649695">1</span><span class="op" id="4649696">)</span><span class="op" id="4649697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649701">f</span><span class="op" id="4649702">.</span><span class="ident" id="4649703">b</span>&nbsp;<span class="op" id="4649705">&gt;&gt;=</span>&nbsp;<span class="ident" id="4649709">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649714">f</span><span class="op" id="4649715">.</span><span class="ident" id="4649716">nb</span>&nbsp;<span class="op" id="4649719">-=</span>&nbsp;<span class="ident" id="4649722">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649727">if</span>&nbsp;<span class="ident" id="4649730">i</span><span class="op" id="4649731">+</span><span class="ident" id="4649732">rep</span>&nbsp;<span class="op" id="4649736">&gt;</span>&nbsp;<span class="ident" id="4649738">n</span>&nbsp;<span class="op" id="4649740">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649745">return</span>&nbsp;<span class="ident" id="4649752">CorruptInputError</span><span class="op" id="4649769">(</span><span class="ident" id="4649770">f</span><span class="op" id="4649771">.</span><span class="ident" id="4649772">roffset</span><span class="op" id="4649779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649787">for</span>&nbsp;<span class="ident" id="4649791">j</span>&nbsp;<span class="op" id="4649793">:=</span>&nbsp;<span class="num" id="4649796">0</span><span class="op" id="4649797">;</span>&nbsp;<span class="ident" id="4649799">j</span>&nbsp;<span class="op" id="4649801">&lt;</span>&nbsp;<span class="ident" id="4649803">rep</span><span class="op" id="4649806">;</span>&nbsp;<span class="ident" id="4649808">j</span><span class="op" id="4649809">++</span>&nbsp;<span class="op" id="4649812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649817">f</span><span class="op" id="4649818">.</span><span class="ident" id="4649819">bits</span><span class="op" id="4649823">[</span><span class="ident" id="4649824">i</span><span class="op" id="4649825">]</span>&nbsp;<span class="op" id="4649827">=</span>&nbsp;<span class="ident" id="4649829">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649834">i</span><span class="op" id="4649835">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649847">if</span>&nbsp;<span class="op" id="4649850">!</span><span class="ident" id="4649851">f</span><span class="op" id="4649852">.</span><span class="ident" id="4649853">h1</span><span class="op" id="4649855">.</span><span class="ident" id="4649856">init</span><span class="op" id="4649860">(</span><span class="ident" id="4649861">f</span><span class="op" id="4649862">.</span><span class="ident" id="4649863">bits</span><span class="op" id="4649867">[</span><span class="num" id="4649868">0</span><span class="op" id="4649869">:</span><span class="ident" id="4649870">nlit</span><span class="op" id="4649874">]</span><span class="op" id="4649875">)</span>&nbsp;<span class="op" id="4649877">||</span>&nbsp;<span class="op" id="4649880">!</span><span class="ident" id="4649881">f</span><span class="op" id="4649882">.</span><span class="ident" id="4649883">h2</span><span class="op" id="4649885">.</span><span class="ident" id="4649886">init</span><span class="op" id="4649890">(</span><span class="ident" id="4649891">f</span><span class="op" id="4649892">.</span><span class="ident" id="4649893">bits</span><span class="op" id="4649897">[</span><span class="ident" id="4649898">nlit</span><span class="op" id="4649902">:</span><span class="ident" id="4649903">nlit</span><span class="op" id="4649907">+</span><span class="ident" id="4649908">ndist</span><span class="op" id="4649913">]</span><span class="op" id="4649914">)</span>&nbsp;<span class="op" id="4649916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649920">return</span>&nbsp;<span class="ident" id="4649927">CorruptInputError</span><span class="op" id="4649944">(</span><span class="ident" id="4649945">f</span><span class="op" id="4649946">.</span><span class="ident" id="4649947">roffset</span><span class="op" id="4649954">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649961">return</span>&nbsp;<span class="ident" id="4649968">nil</span><br>
<span class="lineno"></span><span class="op" id="4649972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4649975">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4650016">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4650078">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4650145">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4650210">func</span>&nbsp;<span class="op" id="4650215">(</span><span class="ident" id="4650216">f</span>&nbsp;<span class="op" id="4650218">*</span><span class="ident" id="4650219">decompressor</span><span class="op" id="4650231">)</span>&nbsp;<span class="ident" id="4650233">huffmanBlock</span><span class="op" id="4650245">(</span><span class="op" id="4650246">)</span>&nbsp;<span class="op" id="4650248">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650251">for</span>&nbsp;<span class="op" id="4650255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650259">v</span><span class="op" id="4650260">,</span>&nbsp;<span class="ident" id="4650262">err</span>&nbsp;<span class="op" id="4650266">:=</span>&nbsp;<span class="ident" id="4650269">f</span><span class="op" id="4650270">.</span><span class="ident" id="4650271">huffSym</span><span class="op" id="4650278">(</span><span class="ident" id="4650279">f</span><span class="op" id="4650280">.</span><span class="ident" id="4650281">hl</span><span class="op" id="4650283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650287">if</span>&nbsp;<span class="ident" id="4650290">err</span>&nbsp;<span class="op" id="4650294">!=</span>&nbsp;<span class="ident" id="4650297">nil</span>&nbsp;<span class="op" id="4650301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650306">f</span><span class="op" id="4650307">.</span><span class="ident" id="4650308">err</span>&nbsp;<span class="op" id="4650312">=</span>&nbsp;<span class="ident" id="4650314">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650321">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4650330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650334">var</span>&nbsp;<span class="ident" id="4650338">n</span>&nbsp;<span class="builtintype" id="4650340">uint</span>&nbsp;<span class="comment" id="4650345">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650371">var</span>&nbsp;<span class="ident" id="4650375">length</span>&nbsp;<span class="builtintype" id="4650382">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650388">switch</span>&nbsp;<span class="op" id="4650395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650399">case</span>&nbsp;<span class="ident" id="4650404">v</span>&nbsp;<span class="op" id="4650406">&lt;</span>&nbsp;<span class="num" id="4650408">256</span><span class="op" id="4650411">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650416">f</span><span class="op" id="4650417">.</span><span class="ident" id="4650418">hist</span><span class="op" id="4650422">[</span><span class="ident" id="4650423">f</span><span class="op" id="4650424">.</span><span class="ident" id="4650425">hp</span><span class="op" id="4650427">]</span>&nbsp;<span class="op" id="4650429">=</span>&nbsp;<span class="builtintype" id="4650431">byte</span><span class="op" id="4650435">(</span><span class="ident" id="4650436">v</span><span class="op" id="4650437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650442">f</span><span class="op" id="4650443">.</span><span class="ident" id="4650444">hp</span><span class="op" id="4650446">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650452">if</span>&nbsp;<span class="ident" id="4650455">f</span><span class="op" id="4650456">.</span><span class="ident" id="4650457">hp</span>&nbsp;<span class="op" id="4650460">==</span>&nbsp;<span class="builtinfunc" id="4650463">len</span><span class="op" id="4650466">(</span><span class="ident" id="4650467">f</span><span class="op" id="4650468">.</span><span class="ident" id="4650469">hist</span><span class="op" id="4650473">)</span>&nbsp;<span class="op" id="4650475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650481">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650525">f</span><span class="op" id="4650526">.</span><span class="ident" id="4650527">flush</span><span class="op" id="4650532">(</span><span class="op" id="4650533">(</span><span class="op" id="4650534">*</span><span class="ident" id="4650535">decompressor</span><span class="op" id="4650547">)</span><span class="op" id="4650548">.</span><span class="ident" id="4650549">huffmanBlock</span><span class="op" id="4650561">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650567">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4650577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650582">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650593">case</span>&nbsp;<span class="ident" id="4650598">v</span>&nbsp;<span class="op" id="4650600">==</span>&nbsp;<span class="num" id="4650603">256</span><span class="op" id="4650606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650611">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650659">f</span><span class="op" id="4650660">.</span><span class="ident" id="4650661">step</span>&nbsp;<span class="op" id="4650666">=</span>&nbsp;<span class="op" id="4650668">(</span><span class="op" id="4650669">*</span><span class="ident" id="4650670">decompressor</span><span class="op" id="4650682">)</span><span class="op" id="4650683">.</span><span class="ident" id="4650684">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650697">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650706">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650746">case</span>&nbsp;<span class="ident" id="4650751">v</span>&nbsp;<span class="op" id="4650753">&lt;</span>&nbsp;<span class="num" id="4650755">265</span><span class="op" id="4650758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650763">length</span>&nbsp;<span class="op" id="4650770">=</span>&nbsp;<span class="ident" id="4650772">v</span>&nbsp;<span class="op" id="4650774">-</span>&nbsp;<span class="op" id="4650776">(</span><span class="num" id="4650777">257</span>&nbsp;<span class="op" id="4650781">-</span>&nbsp;<span class="num" id="4650783">3</span><span class="op" id="4650784">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650789">n</span>&nbsp;<span class="op" id="4650791">=</span>&nbsp;<span class="num" id="4650793">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650797">case</span>&nbsp;<span class="ident" id="4650802">v</span>&nbsp;<span class="op" id="4650804">&lt;</span>&nbsp;<span class="num" id="4650806">269</span><span class="op" id="4650809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650814">length</span>&nbsp;<span class="op" id="4650821">=</span>&nbsp;<span class="ident" id="4650823">v</span><span class="op" id="4650824">*</span><span class="num" id="4650825">2</span>&nbsp;<span class="op" id="4650827">-</span>&nbsp;<span class="op" id="4650829">(</span><span class="num" id="4650830">265</span><span class="op" id="4650833">*</span><span class="num" id="4650834">2</span>&nbsp;<span class="op" id="4650836">-</span>&nbsp;<span class="num" id="4650838">11</span><span class="op" id="4650840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650845">n</span>&nbsp;<span class="op" id="4650847">=</span>&nbsp;<span class="num" id="4650849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650853">case</span>&nbsp;<span class="ident" id="4650858">v</span>&nbsp;<span class="op" id="4650860">&lt;</span>&nbsp;<span class="num" id="4650862">273</span><span class="op" id="4650865">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650870">length</span>&nbsp;<span class="op" id="4650877">=</span>&nbsp;<span class="ident" id="4650879">v</span><span class="op" id="4650880">*</span><span class="num" id="4650881">4</span>&nbsp;<span class="op" id="4650883">-</span>&nbsp;<span class="op" id="4650885">(</span><span class="num" id="4650886">269</span><span class="op" id="4650889">*</span><span class="num" id="4650890">4</span>&nbsp;<span class="op" id="4650892">-</span>&nbsp;<span class="num" id="4650894">19</span><span class="op" id="4650896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650901">n</span>&nbsp;<span class="op" id="4650903">=</span>&nbsp;<span class="num" id="4650905">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650909">case</span>&nbsp;<span class="ident" id="4650914">v</span>&nbsp;<span class="op" id="4650916">&lt;</span>&nbsp;<span class="num" id="4650918">277</span><span class="op" id="4650921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650926">length</span>&nbsp;<span class="op" id="4650933">=</span>&nbsp;<span class="ident" id="4650935">v</span><span class="op" id="4650936">*</span><span class="num" id="4650937">8</span>&nbsp;<span class="op" id="4650939">-</span>&nbsp;<span class="op" id="4650941">(</span><span class="num" id="4650942">273</span><span class="op" id="4650945">*</span><span class="num" id="4650946">8</span>&nbsp;<span class="op" id="4650948">-</span>&nbsp;<span class="num" id="4650950">35</span><span class="op" id="4650952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650957">n</span>&nbsp;<span class="op" id="4650959">=</span>&nbsp;<span class="num" id="4650961">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650965">case</span>&nbsp;<span class="ident" id="4650970">v</span>&nbsp;<span class="op" id="4650972">&lt;</span>&nbsp;<span class="num" id="4650974">281</span><span class="op" id="4650977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650982">length</span>&nbsp;<span class="op" id="4650989">=</span>&nbsp;<span class="ident" id="4650991">v</span><span class="op" id="4650992">*</span><span class="num" id="4650993">16</span>&nbsp;<span class="op" id="4650996">-</span>&nbsp;<span class="op" id="4650998">(</span><span class="num" id="4650999">277</span><span class="op" id="4651002">*</span><span class="num" id="4651003">16</span>&nbsp;<span class="op" id="4651006">-</span>&nbsp;<span class="num" id="4651008">67</span><span class="op" id="4651010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651015">n</span>&nbsp;<span class="op" id="4651017">=</span>&nbsp;<span class="num" id="4651019">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651023">case</span>&nbsp;<span class="ident" id="4651028">v</span>&nbsp;<span class="op" id="4651030">&lt;</span>&nbsp;<span class="num" id="4651032">285</span><span class="op" id="4651035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651040">length</span>&nbsp;<span class="op" id="4651047">=</span>&nbsp;<span class="ident" id="4651049">v</span><span class="op" id="4651050">*</span><span class="num" id="4651051">32</span>&nbsp;<span class="op" id="4651054">-</span>&nbsp;<span class="op" id="4651056">(</span><span class="num" id="4651057">281</span><span class="op" id="4651060">*</span><span class="num" id="4651061">32</span>&nbsp;<span class="op" id="4651064">-</span>&nbsp;<span class="num" id="4651066">131</span><span class="op" id="4651069">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651074">n</span>&nbsp;<span class="op" id="4651076">=</span>&nbsp;<span class="num" id="4651078">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651082">default</span><span class="op" id="4651089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651094">length</span>&nbsp;<span class="op" id="4651101">=</span>&nbsp;<span class="num" id="4651103">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651110">n</span>&nbsp;<span class="op" id="4651112">=</span>&nbsp;<span class="num" id="4651114">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651118">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651122">if</span>&nbsp;<span class="ident" id="4651125">n</span>&nbsp;<span class="op" id="4651127">&gt;</span>&nbsp;<span class="num" id="4651129">0</span>&nbsp;<span class="op" id="4651131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651136">for</span>&nbsp;<span class="ident" id="4651140">f</span><span class="op" id="4651141">.</span><span class="ident" id="4651142">nb</span>&nbsp;<span class="op" id="4651145">&lt;</span>&nbsp;<span class="ident" id="4651147">n</span>&nbsp;<span class="op" id="4651149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651155">if</span>&nbsp;<span class="ident" id="4651158">err</span>&nbsp;<span class="op" id="4651162">=</span>&nbsp;<span class="ident" id="4651164">f</span><span class="op" id="4651165">.</span><span class="ident" id="4651166">moreBits</span><span class="op" id="4651174">(</span><span class="op" id="4651175">)</span><span class="op" id="4651176">;</span>&nbsp;<span class="ident" id="4651178">err</span>&nbsp;<span class="op" id="4651182">!=</span>&nbsp;<span class="ident" id="4651185">nil</span>&nbsp;<span class="op" id="4651189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651196">f</span><span class="op" id="4651197">.</span><span class="ident" id="4651198">err</span>&nbsp;<span class="op" id="4651202">=</span>&nbsp;<span class="ident" id="4651204">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651213">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651234">length</span>&nbsp;<span class="op" id="4651241">+=</span>&nbsp;<span class="builtintype" id="4651244">int</span><span class="op" id="4651247">(</span><span class="ident" id="4651248">f</span><span class="op" id="4651249">.</span><span class="ident" id="4651250">b</span>&nbsp;<span class="op" id="4651252">&amp;</span>&nbsp;<span class="builtintype" id="4651254">uint32</span><span class="op" id="4651260">(</span><span class="num" id="4651261">1</span><span class="op" id="4651262">&lt;&lt;</span><span class="ident" id="4651264">n</span><span class="op" id="4651265">-</span><span class="num" id="4651266">1</span><span class="op" id="4651267">)</span><span class="op" id="4651268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651273">f</span><span class="op" id="4651274">.</span><span class="ident" id="4651275">b</span>&nbsp;<span class="op" id="4651277">&gt;&gt;=</span>&nbsp;<span class="ident" id="4651281">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651286">f</span><span class="op" id="4651287">.</span><span class="ident" id="4651288">nb</span>&nbsp;<span class="op" id="4651291">-=</span>&nbsp;<span class="ident" id="4651294">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651303">var</span>&nbsp;<span class="ident" id="4651307">dist</span>&nbsp;<span class="builtintype" id="4651312">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651318">if</span>&nbsp;<span class="ident" id="4651321">f</span><span class="op" id="4651322">.</span><span class="ident" id="4651323">hd</span>&nbsp;<span class="op" id="4651326">==</span>&nbsp;<span class="ident" id="4651329">nil</span>&nbsp;<span class="op" id="4651333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651338">for</span>&nbsp;<span class="ident" id="4651342">f</span><span class="op" id="4651343">.</span><span class="ident" id="4651344">nb</span>&nbsp;<span class="op" id="4651347">&lt;</span>&nbsp;<span class="num" id="4651349">5</span>&nbsp;<span class="op" id="4651351">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651357">if</span>&nbsp;<span class="ident" id="4651360">err</span>&nbsp;<span class="op" id="4651364">=</span>&nbsp;<span class="ident" id="4651366">f</span><span class="op" id="4651367">.</span><span class="ident" id="4651368">moreBits</span><span class="op" id="4651376">(</span><span class="op" id="4651377">)</span><span class="op" id="4651378">;</span>&nbsp;<span class="ident" id="4651380">err</span>&nbsp;<span class="op" id="4651384">!=</span>&nbsp;<span class="ident" id="4651387">nil</span>&nbsp;<span class="op" id="4651391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651398">f</span><span class="op" id="4651399">.</span><span class="ident" id="4651400">err</span>&nbsp;<span class="op" id="4651404">=</span>&nbsp;<span class="ident" id="4651406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651415">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651431">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651436">dist</span>&nbsp;<span class="op" id="4651441">=</span>&nbsp;<span class="builtintype" id="4651443">int</span><span class="op" id="4651446">(</span><span class="ident" id="4651447">reverseByte</span><span class="op" id="4651458">[</span><span class="op" id="4651459">(</span><span class="ident" id="4651460">f</span><span class="op" id="4651461">.</span><span class="ident" id="4651462">b</span><span class="op" id="4651463">&amp;</span><span class="num" id="4651464">0x1F</span><span class="op" id="4651468">)</span><span class="op" id="4651469">&lt;&lt;</span><span class="num" id="4651471">3</span><span class="op" id="4651472">]</span><span class="op" id="4651473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651478">f</span><span class="op" id="4651479">.</span><span class="ident" id="4651480">b</span>&nbsp;<span class="op" id="4651482">&gt;&gt;=</span>&nbsp;<span class="num" id="4651486">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651491">f</span><span class="op" id="4651492">.</span><span class="ident" id="4651493">nb</span>&nbsp;<span class="op" id="4651496">-=</span>&nbsp;<span class="num" id="4651499">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651503">}</span>&nbsp;<span class="keyword" id="4651505">else</span>&nbsp;<span class="op" id="4651510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651515">if</span>&nbsp;<span class="ident" id="4651518">dist</span><span class="op" id="4651522">,</span>&nbsp;<span class="ident" id="4651524">err</span>&nbsp;<span class="op" id="4651528">=</span>&nbsp;<span class="ident" id="4651530">f</span><span class="op" id="4651531">.</span><span class="ident" id="4651532">huffSym</span><span class="op" id="4651539">(</span><span class="ident" id="4651540">f</span><span class="op" id="4651541">.</span><span class="ident" id="4651542">hd</span><span class="op" id="4651544">)</span><span class="op" id="4651545">;</span>&nbsp;<span class="ident" id="4651547">err</span>&nbsp;<span class="op" id="4651551">!=</span>&nbsp;<span class="ident" id="4651554">nil</span>&nbsp;<span class="op" id="4651558">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651564">f</span><span class="op" id="4651565">.</span><span class="ident" id="4651566">err</span>&nbsp;<span class="op" id="4651570">=</span>&nbsp;<span class="ident" id="4651572">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651580">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651599">switch</span>&nbsp;<span class="op" id="4651606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651610">case</span>&nbsp;<span class="ident" id="4651615">dist</span>&nbsp;<span class="op" id="4651620">&lt;</span>&nbsp;<span class="num" id="4651622">4</span><span class="op" id="4651623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651628">dist</span><span class="op" id="4651632">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651637">case</span>&nbsp;<span class="ident" id="4651642">dist</span>&nbsp;<span class="op" id="4651647">&gt;=</span>&nbsp;<span class="num" id="4651650">30</span><span class="op" id="4651652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651657">f</span><span class="op" id="4651658">.</span><span class="ident" id="4651659">err</span>&nbsp;<span class="op" id="4651663">=</span>&nbsp;<span class="ident" id="4651665">CorruptInputError</span><span class="op" id="4651682">(</span><span class="ident" id="4651683">f</span><span class="op" id="4651684">.</span><span class="ident" id="4651685">roffset</span><span class="op" id="4651692">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651697">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651706">default</span><span class="op" id="4651713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651718">nb</span>&nbsp;<span class="op" id="4651721">:=</span>&nbsp;<span class="builtintype" id="4651724">uint</span><span class="op" id="4651728">(</span><span class="ident" id="4651729">dist</span><span class="op" id="4651733">-</span><span class="num" id="4651734">2</span><span class="op" id="4651735">)</span>&nbsp;<span class="op" id="4651737">&gt;&gt;</span>&nbsp;<span class="num" id="4651740">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651745">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651795">extra</span>&nbsp;<span class="op" id="4651801">:=</span>&nbsp;<span class="op" id="4651804">(</span><span class="ident" id="4651805">dist</span>&nbsp;<span class="op" id="4651810">&amp;</span>&nbsp;<span class="num" id="4651812">1</span><span class="op" id="4651813">)</span>&nbsp;<span class="op" id="4651815">&lt;&lt;</span>&nbsp;<span class="ident" id="4651818">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651824">for</span>&nbsp;<span class="ident" id="4651828">f</span><span class="op" id="4651829">.</span><span class="ident" id="4651830">nb</span>&nbsp;<span class="op" id="4651833">&lt;</span>&nbsp;<span class="ident" id="4651835">nb</span>&nbsp;<span class="op" id="4651838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651844">if</span>&nbsp;<span class="ident" id="4651847">err</span>&nbsp;<span class="op" id="4651851">=</span>&nbsp;<span class="ident" id="4651853">f</span><span class="op" id="4651854">.</span><span class="ident" id="4651855">moreBits</span><span class="op" id="4651863">(</span><span class="op" id="4651864">)</span><span class="op" id="4651865">;</span>&nbsp;<span class="ident" id="4651867">err</span>&nbsp;<span class="op" id="4651871">!=</span>&nbsp;<span class="ident" id="4651874">nil</span>&nbsp;<span class="op" id="4651878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651885">f</span><span class="op" id="4651886">.</span><span class="ident" id="4651887">err</span>&nbsp;<span class="op" id="4651891">=</span>&nbsp;<span class="ident" id="4651893">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651902">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651913">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651923">extra</span>&nbsp;<span class="op" id="4651929">|=</span>&nbsp;<span class="builtintype" id="4651932">int</span><span class="op" id="4651935">(</span><span class="ident" id="4651936">f</span><span class="op" id="4651937">.</span><span class="ident" id="4651938">b</span>&nbsp;<span class="op" id="4651940">&amp;</span>&nbsp;<span class="builtintype" id="4651942">uint32</span><span class="op" id="4651948">(</span><span class="num" id="4651949">1</span><span class="op" id="4651950">&lt;&lt;</span><span class="ident" id="4651952">nb</span><span class="op" id="4651954">-</span><span class="num" id="4651955">1</span><span class="op" id="4651956">)</span><span class="op" id="4651957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651962">f</span><span class="op" id="4651963">.</span><span class="ident" id="4651964">b</span>&nbsp;<span class="op" id="4651966">&gt;&gt;=</span>&nbsp;<span class="ident" id="4651970">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651976">f</span><span class="op" id="4651977">.</span><span class="ident" id="4651978">nb</span>&nbsp;<span class="op" id="4651981">-=</span>&nbsp;<span class="ident" id="4651984">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651990">dist</span>&nbsp;<span class="op" id="4651995">=</span>&nbsp;<span class="num" id="4651997">1</span><span class="op" id="4651998">&lt;&lt;</span><span class="op" id="4652000">(</span><span class="ident" id="4652001">nb</span><span class="op" id="4652003">+</span><span class="num" id="4652004">1</span><span class="op" id="4652005">)</span>&nbsp;<span class="op" id="4652007">+</span>&nbsp;<span class="num" id="4652009">1</span>&nbsp;<span class="op" id="4652011">+</span>&nbsp;<span class="ident" id="4652013">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652026">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652077">if</span>&nbsp;<span class="ident" id="4652080">dist</span>&nbsp;<span class="op" id="4652085">&gt;</span>&nbsp;<span class="builtinfunc" id="4652087">len</span><span class="op" id="4652090">(</span><span class="ident" id="4652091">f</span><span class="op" id="4652092">.</span><span class="ident" id="4652093">hist</span><span class="op" id="4652097">)</span>&nbsp;<span class="op" id="4652099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652104">f</span><span class="op" id="4652105">.</span><span class="ident" id="4652106">err</span>&nbsp;<span class="op" id="4652110">=</span>&nbsp;<span class="ident" id="4652112">InternalError</span><span class="op" id="4652125">(</span><span class="string" id="4652126">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4652148">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652153">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652167">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652219">if</span>&nbsp;<span class="op" id="4652222">!</span><span class="ident" id="4652223">f</span><span class="op" id="4652224">.</span><span class="ident" id="4652225">hfull</span>&nbsp;<span class="op" id="4652231">&amp;&amp;</span>&nbsp;<span class="ident" id="4652234">dist</span>&nbsp;<span class="op" id="4652239">&gt;</span>&nbsp;<span class="ident" id="4652241">f</span><span class="op" id="4652242">.</span><span class="ident" id="4652243">hp</span>&nbsp;<span class="op" id="4652246">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652251">f</span><span class="op" id="4652252">.</span><span class="ident" id="4652253">err</span>&nbsp;<span class="op" id="4652257">=</span>&nbsp;<span class="ident" id="4652259">CorruptInputError</span><span class="op" id="4652276">(</span><span class="ident" id="4652277">f</span><span class="op" id="4652278">.</span><span class="ident" id="4652279">roffset</span><span class="op" id="4652286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652291">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652305">f</span><span class="op" id="4652306">.</span><span class="ident" id="4652307">copyLen</span><span class="op" id="4652314">,</span>&nbsp;<span class="ident" id="4652316">f</span><span class="op" id="4652317">.</span><span class="ident" id="4652318">copyDist</span>&nbsp;<span class="op" id="4652327">=</span>&nbsp;<span class="ident" id="4652329">length</span><span class="op" id="4652335">,</span>&nbsp;<span class="ident" id="4652337">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652344">if</span>&nbsp;<span class="ident" id="4652347">f</span><span class="op" id="4652348">.</span><span class="ident" id="4652349">copyHist</span><span class="op" id="4652357">(</span><span class="op" id="4652358">)</span>&nbsp;<span class="op" id="4652360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652377">}</span><br>
<span class="lineno"></span><span class="op" id="4652379">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4652382">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4652463">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4652512">func</span>&nbsp;<span class="op" id="4652517">(</span><span class="ident" id="4652518">f</span>&nbsp;<span class="op" id="4652520">*</span><span class="ident" id="4652521">decompressor</span><span class="op" id="4652533">)</span>&nbsp;<span class="ident" id="4652535">copyHist</span><span class="op" id="4652543">(</span><span class="op" id="4652544">)</span>&nbsp;<span class="builtintype" id="4652546">bool</span>&nbsp;<span class="op" id="4652551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652554">p</span>&nbsp;<span class="op" id="4652556">:=</span>&nbsp;<span class="ident" id="4652559">f</span><span class="op" id="4652560">.</span><span class="ident" id="4652561">hp</span>&nbsp;<span class="op" id="4652564">-</span>&nbsp;<span class="ident" id="4652566">f</span><span class="op" id="4652567">.</span><span class="ident" id="4652568">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652578">if</span>&nbsp;<span class="ident" id="4652581">p</span>&nbsp;<span class="op" id="4652583">&lt;</span>&nbsp;<span class="num" id="4652585">0</span>&nbsp;<span class="op" id="4652587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652591">p</span>&nbsp;<span class="op" id="4652593">+=</span>&nbsp;<span class="builtinfunc" id="4652596">len</span><span class="op" id="4652599">(</span><span class="ident" id="4652600">f</span><span class="op" id="4652601">.</span><span class="ident" id="4652602">hist</span><span class="op" id="4652606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652612">for</span>&nbsp;<span class="ident" id="4652616">f</span><span class="op" id="4652617">.</span><span class="ident" id="4652618">copyLen</span>&nbsp;<span class="op" id="4652626">&gt;</span>&nbsp;<span class="num" id="4652628">0</span>&nbsp;<span class="op" id="4652630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652634">n</span>&nbsp;<span class="op" id="4652636">:=</span>&nbsp;<span class="ident" id="4652639">f</span><span class="op" id="4652640">.</span><span class="ident" id="4652641">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652651">if</span>&nbsp;<span class="ident" id="4652654">x</span>&nbsp;<span class="op" id="4652656">:=</span>&nbsp;<span class="builtinfunc" id="4652659">len</span><span class="op" id="4652662">(</span><span class="ident" id="4652663">f</span><span class="op" id="4652664">.</span><span class="ident" id="4652665">hist</span><span class="op" id="4652669">)</span>&nbsp;<span class="op" id="4652671">-</span>&nbsp;<span class="ident" id="4652673">f</span><span class="op" id="4652674">.</span><span class="ident" id="4652675">hp</span><span class="op" id="4652677">;</span>&nbsp;<span class="ident" id="4652679">n</span>&nbsp;<span class="op" id="4652681">&gt;</span>&nbsp;<span class="ident" id="4652683">x</span>&nbsp;<span class="op" id="4652685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652690">n</span>&nbsp;<span class="op" id="4652692">=</span>&nbsp;<span class="ident" id="4652694">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652702">if</span>&nbsp;<span class="ident" id="4652705">x</span>&nbsp;<span class="op" id="4652707">:=</span>&nbsp;<span class="builtinfunc" id="4652710">len</span><span class="op" id="4652713">(</span><span class="ident" id="4652714">f</span><span class="op" id="4652715">.</span><span class="ident" id="4652716">hist</span><span class="op" id="4652720">)</span>&nbsp;<span class="op" id="4652722">-</span>&nbsp;<span class="ident" id="4652724">p</span><span class="op" id="4652725">;</span>&nbsp;<span class="ident" id="4652727">n</span>&nbsp;<span class="op" id="4652729">&gt;</span>&nbsp;<span class="ident" id="4652731">x</span>&nbsp;<span class="op" id="4652733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652738">n</span>&nbsp;<span class="op" id="4652740">=</span>&nbsp;<span class="ident" id="4652742">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652750">forwardCopy</span><span class="op" id="4652761">(</span><span class="ident" id="4652762">f</span><span class="op" id="4652763">.</span><span class="ident" id="4652764">hist</span><span class="op" id="4652768">[</span><span class="op" id="4652769">:</span><span class="op" id="4652770">]</span><span class="op" id="4652771">,</span>&nbsp;<span class="ident" id="4652773">f</span><span class="op" id="4652774">.</span><span class="ident" id="4652775">hp</span><span class="op" id="4652777">,</span>&nbsp;<span class="ident" id="4652779">p</span><span class="op" id="4652780">,</span>&nbsp;<span class="ident" id="4652782">n</span><span class="op" id="4652783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652787">p</span>&nbsp;<span class="op" id="4652789">+=</span>&nbsp;<span class="ident" id="4652792">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652796">f</span><span class="op" id="4652797">.</span><span class="ident" id="4652798">hp</span>&nbsp;<span class="op" id="4652801">+=</span>&nbsp;<span class="ident" id="4652804">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652808">f</span><span class="op" id="4652809">.</span><span class="ident" id="4652810">copyLen</span>&nbsp;<span class="op" id="4652818">-=</span>&nbsp;<span class="ident" id="4652821">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652825">if</span>&nbsp;<span class="ident" id="4652828">f</span><span class="op" id="4652829">.</span><span class="ident" id="4652830">hp</span>&nbsp;<span class="op" id="4652833">==</span>&nbsp;<span class="builtinfunc" id="4652836">len</span><span class="op" id="4652839">(</span><span class="ident" id="4652840">f</span><span class="op" id="4652841">.</span><span class="ident" id="4652842">hist</span><span class="op" id="4652846">)</span>&nbsp;<span class="op" id="4652848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652853">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652904">f</span><span class="op" id="4652905">.</span><span class="ident" id="4652906">flush</span><span class="op" id="4652911">(</span><span class="op" id="4652912">(</span><span class="op" id="4652913">*</span><span class="ident" id="4652914">decompressor</span><span class="op" id="4652926">)</span><span class="op" id="4652927">.</span><span class="ident" id="4652928">copyHuff</span><span class="op" id="4652936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652941">return</span>&nbsp;<span class="builtintype" id="4652948">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652955">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652959">if</span>&nbsp;<span class="ident" id="4652962">p</span>&nbsp;<span class="op" id="4652964">==</span>&nbsp;<span class="builtinfunc" id="4652967">len</span><span class="op" id="4652970">(</span><span class="ident" id="4652971">f</span><span class="op" id="4652972">.</span><span class="ident" id="4652973">hist</span><span class="op" id="4652977">)</span>&nbsp;<span class="op" id="4652979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652984">p</span>&nbsp;<span class="op" id="4652986">=</span>&nbsp;<span class="num" id="4652988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652998">return</span>&nbsp;<span class="builtintype" id="4653005">false</span><br>
<span class="lineno">550</span><span class="op" id="4653011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4653014">func</span>&nbsp;<span class="op" id="4653019">(</span><span class="ident" id="4653020">f</span>&nbsp;<span class="op" id="4653022">*</span><span class="ident" id="4653023">decompressor</span><span class="op" id="4653035">)</span>&nbsp;<span class="ident" id="4653037">copyHuff</span><span class="op" id="4653045">(</span><span class="op" id="4653046">)</span>&nbsp;<span class="op" id="4653048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653051">if</span>&nbsp;<span class="ident" id="4653054">f</span><span class="op" id="4653055">.</span><span class="ident" id="4653056">copyHist</span><span class="op" id="4653064">(</span><span class="op" id="4653065">)</span>&nbsp;<span class="op" id="4653067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653071">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653082">f</span><span class="op" id="4653083">.</span><span class="ident" id="4653084">huffmanBlock</span><span class="op" id="4653096">(</span><span class="op" id="4653097">)</span><br>
<span class="lineno"></span><span class="op" id="4653099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4653102">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4653165">func</span>&nbsp;<span class="op" id="4653170">(</span><span class="ident" id="4653171">f</span>&nbsp;<span class="op" id="4653173">*</span><span class="ident" id="4653174">decompressor</span><span class="op" id="4653186">)</span>&nbsp;<span class="ident" id="4653188">dataBlock</span><span class="op" id="4653197">(</span><span class="op" id="4653198">)</span>&nbsp;<span class="op" id="4653200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4653203">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4653221">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653252">f</span><span class="op" id="4653253">.</span><span class="ident" id="4653254">nb</span>&nbsp;<span class="op" id="4653257">=</span>&nbsp;<span class="num" id="4653259">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653262">f</span><span class="op" id="4653263">.</span><span class="ident" id="4653264">b</span>&nbsp;<span class="op" id="4653266">=</span>&nbsp;<span class="num" id="4653268">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4653272">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653315">nr</span><span class="op" id="4653317">,</span>&nbsp;<span class="ident" id="4653319">err</span>&nbsp;<span class="op" id="4653323">:=</span>&nbsp;<span class="ident" id="4653326">io</span><span class="op" id="4653328">.</span><span class="ident" id="4653329">ReadFull</span><span class="op" id="4653337">(</span><span class="ident" id="4653338">f</span><span class="op" id="4653339">.</span><span class="ident" id="4653340">r</span><span class="op" id="4653341">,</span>&nbsp;<span class="ident" id="4653343">f</span><span class="op" id="4653344">.</span><span class="ident" id="4653345">buf</span><span class="op" id="4653348">[</span><span class="num" id="4653349">0</span><span class="op" id="4653350">:</span><span class="num" id="4653351">4</span><span class="op" id="4653352">]</span><span class="op" id="4653353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653356">f</span><span class="op" id="4653357">.</span><span class="ident" id="4653358">roffset</span>&nbsp;<span class="op" id="4653366">+=</span>&nbsp;<span class="ident" id="4653369">int64</span><span class="op" id="4653374">(</span><span class="ident" id="4653375">nr</span><span class="op" id="4653377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653380">if</span>&nbsp;<span class="ident" id="4653383">err</span>&nbsp;<span class="op" id="4653387">!=</span>&nbsp;<span class="ident" id="4653390">nil</span>&nbsp;<span class="op" id="4653394">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653398">f</span><span class="op" id="4653399">.</span><span class="ident" id="4653400">err</span>&nbsp;<span class="op" id="4653404">=</span>&nbsp;<span class="op" id="4653406">&amp;</span><span class="ident" id="4653407">ReadError</span><span class="op" id="4653416">{</span><span class="ident" id="4653417">f</span><span class="op" id="4653418">.</span><span class="ident" id="4653419">roffset</span><span class="op" id="4653426">,</span>&nbsp;<span class="ident" id="4653428">err</span><span class="op" id="4653431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653446">n</span>&nbsp;<span class="op" id="4653448">:=</span>&nbsp;<span class="builtintype" id="4653451">int</span><span class="op" id="4653454">(</span><span class="ident" id="4653455">f</span><span class="op" id="4653456">.</span><span class="ident" id="4653457">buf</span><span class="op" id="4653460">[</span><span class="num" id="4653461">0</span><span class="op" id="4653462">]</span><span class="op" id="4653463">)</span>&nbsp;<span class="op" id="4653465">|</span>&nbsp;<span class="builtintype" id="4653467">int</span><span class="op" id="4653470">(</span><span class="ident" id="4653471">f</span><span class="op" id="4653472">.</span><span class="ident" id="4653473">buf</span><span class="op" id="4653476">[</span><span class="num" id="4653477">1</span><span class="op" id="4653478">]</span><span class="op" id="4653479">)</span><span class="op" id="4653480">&lt;&lt;</span><span class="num" id="4653482">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653485">nn</span>&nbsp;<span class="op" id="4653488">:=</span>&nbsp;<span class="builtintype" id="4653491">int</span><span class="op" id="4653494">(</span><span class="ident" id="4653495">f</span><span class="op" id="4653496">.</span><span class="ident" id="4653497">buf</span><span class="op" id="4653500">[</span><span class="num" id="4653501">2</span><span class="op" id="4653502">]</span><span class="op" id="4653503">)</span>&nbsp;<span class="op" id="4653505">|</span>&nbsp;<span class="builtintype" id="4653507">int</span><span class="op" id="4653510">(</span><span class="ident" id="4653511">f</span><span class="op" id="4653512">.</span><span class="ident" id="4653513">buf</span><span class="op" id="4653516">[</span><span class="num" id="4653517">3</span><span class="op" id="4653518">]</span><span class="op" id="4653519">)</span><span class="op" id="4653520">&lt;&lt;</span><span class="num" id="4653522">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653525">if</span>&nbsp;<span class="builtintype" id="4653528">uint16</span><span class="op" id="4653534">(</span><span class="ident" id="4653535">nn</span><span class="op" id="4653537">)</span>&nbsp;<span class="op" id="4653539">!=</span>&nbsp;<span class="builtintype" id="4653542">uint16</span><span class="op" id="4653548">(</span><span class="op" id="4653549">^</span><span class="ident" id="4653550">n</span><span class="op" id="4653551">)</span>&nbsp;<span class="op" id="4653553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653557">f</span><span class="op" id="4653558">.</span><span class="ident" id="4653559">err</span>&nbsp;<span class="op" id="4653563">=</span>&nbsp;<span class="ident" id="4653565">CorruptInputError</span><span class="op" id="4653582">(</span><span class="ident" id="4653583">f</span><span class="op" id="4653584">.</span><span class="ident" id="4653585">roffset</span><span class="op" id="4653592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653608">if</span>&nbsp;<span class="ident" id="4653611">n</span>&nbsp;<span class="op" id="4653613">==</span>&nbsp;<span class="num" id="4653616">0</span>&nbsp;<span class="op" id="4653618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4653622">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653653">f</span><span class="op" id="4653654">.</span><span class="ident" id="4653655">flush</span><span class="op" id="4653660">(</span><span class="op" id="4653661">(</span><span class="op" id="4653662">*</span><span class="ident" id="4653663">decompressor</span><span class="op" id="4653675">)</span><span class="op" id="4653676">.</span><span class="ident" id="4653677">nextBlock</span><span class="op" id="4653686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653698">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653702">f</span><span class="op" id="4653703">.</span><span class="ident" id="4653704">copyLen</span>&nbsp;<span class="op" id="4653712">=</span>&nbsp;<span class="ident" id="4653714">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653717">f</span><span class="op" id="4653718">.</span><span class="ident" id="4653719">copyData</span><span class="op" id="4653727">(</span><span class="op" id="4653728">)</span><br>
<span class="lineno"></span><span class="op" id="4653730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4653733">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4653808">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4653852">func</span>&nbsp;<span class="op" id="4653857">(</span><span class="ident" id="4653858">f</span>&nbsp;<span class="op" id="4653860">*</span><span class="ident" id="4653861">decompressor</span><span class="op" id="4653873">)</span>&nbsp;<span class="ident" id="4653875">copyData</span><span class="op" id="4653883">(</span><span class="op" id="4653884">)</span>&nbsp;<span class="op" id="4653886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653889">n</span>&nbsp;<span class="op" id="4653891">:=</span>&nbsp;<span class="ident" id="4653894">f</span><span class="op" id="4653895">.</span><span class="ident" id="4653896">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653905">for</span>&nbsp;<span class="ident" id="4653909">n</span>&nbsp;<span class="op" id="4653911">&gt;</span>&nbsp;<span class="num" id="4653913">0</span>&nbsp;<span class="op" id="4653915">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653919">m</span>&nbsp;<span class="op" id="4653921">:=</span>&nbsp;<span class="builtinfunc" id="4653924">len</span><span class="op" id="4653927">(</span><span class="ident" id="4653928">f</span><span class="op" id="4653929">.</span><span class="ident" id="4653930">hist</span><span class="op" id="4653934">)</span>&nbsp;<span class="op" id="4653936">-</span>&nbsp;<span class="ident" id="4653938">f</span><span class="op" id="4653939">.</span><span class="ident" id="4653940">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4653945">if</span>&nbsp;<span class="ident" id="4653948">m</span>&nbsp;<span class="op" id="4653950">&gt;</span>&nbsp;<span class="ident" id="4653952">n</span>&nbsp;<span class="op" id="4653954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653959">m</span>&nbsp;<span class="op" id="4653961">=</span>&nbsp;<span class="ident" id="4653963">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4653967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4653971">m</span><span class="op" id="4653972">,</span>&nbsp;<span class="ident" id="4653974">err</span>&nbsp;<span class="op" id="4653978">:=</span>&nbsp;<span class="ident" id="4653981">io</span><span class="op" id="4653983">.</span><span class="ident" id="4653984">ReadFull</span><span class="op" id="4653992">(</span><span class="ident" id="4653993">f</span><span class="op" id="4653994">.</span><span class="ident" id="4653995">r</span><span class="op" id="4653996">,</span>&nbsp;<span class="ident" id="4653998">f</span><span class="op" id="4653999">.</span><span class="ident" id="4654000">hist</span><span class="op" id="4654004">[</span><span class="ident" id="4654005">f</span><span class="op" id="4654006">.</span><span class="ident" id="4654007">hp</span><span class="op" id="4654009">:</span><span class="ident" id="4654010">f</span><span class="op" id="4654011">.</span><span class="ident" id="4654012">hp</span><span class="op" id="4654014">+</span><span class="ident" id="4654015">m</span><span class="op" id="4654016">]</span><span class="op" id="4654017">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654021">f</span><span class="op" id="4654022">.</span><span class="ident" id="4654023">roffset</span>&nbsp;<span class="op" id="4654031">+=</span>&nbsp;<span class="ident" id="4654034">int64</span><span class="op" id="4654039">(</span><span class="ident" id="4654040">m</span><span class="op" id="4654041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654045">if</span>&nbsp;<span class="ident" id="4654048">err</span>&nbsp;<span class="op" id="4654052">!=</span>&nbsp;<span class="ident" id="4654055">nil</span>&nbsp;<span class="op" id="4654059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654064">f</span><span class="op" id="4654065">.</span><span class="ident" id="4654066">err</span>&nbsp;<span class="op" id="4654070">=</span>&nbsp;<span class="op" id="4654072">&amp;</span><span class="ident" id="4654073">ReadError</span><span class="op" id="4654082">{</span><span class="ident" id="4654083">f</span><span class="op" id="4654084">.</span><span class="ident" id="4654085">roffset</span><span class="op" id="4654092">,</span>&nbsp;<span class="ident" id="4654094">err</span><span class="op" id="4654097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654102">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654111">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654115">n</span>&nbsp;<span class="op" id="4654117">-=</span>&nbsp;<span class="ident" id="4654120">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654124">f</span><span class="op" id="4654125">.</span><span class="ident" id="4654126">hp</span>&nbsp;<span class="op" id="4654129">+=</span>&nbsp;<span class="ident" id="4654132">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654136">if</span>&nbsp;<span class="ident" id="4654139">f</span><span class="op" id="4654140">.</span><span class="ident" id="4654141">hp</span>&nbsp;<span class="op" id="4654144">==</span>&nbsp;<span class="builtinfunc" id="4654147">len</span><span class="op" id="4654150">(</span><span class="ident" id="4654151">f</span><span class="op" id="4654152">.</span><span class="ident" id="4654153">hist</span><span class="op" id="4654157">)</span>&nbsp;<span class="op" id="4654159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654164">f</span><span class="op" id="4654165">.</span><span class="ident" id="4654166">copyLen</span>&nbsp;<span class="op" id="4654174">=</span>&nbsp;<span class="ident" id="4654176">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654181">f</span><span class="op" id="4654182">.</span><span class="ident" id="4654183">flush</span><span class="op" id="4654188">(</span><span class="op" id="4654189">(</span><span class="op" id="4654190">*</span><span class="ident" id="4654191">decompressor</span><span class="op" id="4654203">)</span><span class="op" id="4654204">.</span><span class="ident" id="4654205">copyData</span><span class="op" id="4654213">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654218">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654233">f</span><span class="op" id="4654234">.</span><span class="ident" id="4654235">step</span>&nbsp;<span class="op" id="4654240">=</span>&nbsp;<span class="op" id="4654242">(</span><span class="op" id="4654243">*</span><span class="ident" id="4654244">decompressor</span><span class="op" id="4654256">)</span><span class="op" id="4654257">.</span><span class="ident" id="4654258">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4654268">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4654271">func</span>&nbsp;<span class="op" id="4654276">(</span><span class="ident" id="4654277">f</span>&nbsp;<span class="op" id="4654279">*</span><span class="ident" id="4654280">decompressor</span><span class="op" id="4654292">)</span>&nbsp;<span class="ident" id="4654294">setDict</span><span class="op" id="4654301">(</span><span class="ident" id="4654302">dict</span>&nbsp;<span class="op" id="4654307">[</span><span class="op" id="4654308">]</span><span class="builtintype" id="4654309">byte</span><span class="op" id="4654313">)</span>&nbsp;<span class="op" id="4654315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654318">if</span>&nbsp;<span class="builtinfunc" id="4654321">len</span><span class="op" id="4654324">(</span><span class="ident" id="4654325">dict</span><span class="op" id="4654329">)</span>&nbsp;<span class="op" id="4654331">&gt;</span>&nbsp;<span class="builtinfunc" id="4654333">len</span><span class="op" id="4654336">(</span><span class="ident" id="4654337">f</span><span class="op" id="4654338">.</span><span class="ident" id="4654339">hist</span><span class="op" id="4654343">)</span>&nbsp;<span class="op" id="4654345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4654349">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654383">dict</span>&nbsp;<span class="op" id="4654388">=</span>&nbsp;<span class="ident" id="4654390">dict</span><span class="op" id="4654394">[</span><span class="builtinfunc" id="4654395">len</span><span class="op" id="4654398">(</span><span class="ident" id="4654399">dict</span><span class="op" id="4654403">)</span><span class="op" id="4654404">-</span><span class="builtinfunc" id="4654405">len</span><span class="op" id="4654408">(</span><span class="ident" id="4654409">f</span><span class="op" id="4654410">.</span><span class="ident" id="4654411">hist</span><span class="op" id="4654415">)</span><span class="op" id="4654416">:</span><span class="op" id="4654417">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654424">f</span><span class="op" id="4654425">.</span><span class="ident" id="4654426">hp</span>&nbsp;<span class="op" id="4654429">=</span>&nbsp;<span class="builtinfunc" id="4654431">copy</span><span class="op" id="4654435">(</span><span class="ident" id="4654436">f</span><span class="op" id="4654437">.</span><span class="ident" id="4654438">hist</span><span class="op" id="4654442">[</span><span class="op" id="4654443">:</span><span class="op" id="4654444">]</span><span class="op" id="4654445">,</span>&nbsp;<span class="ident" id="4654447">dict</span><span class="op" id="4654451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654454">if</span>&nbsp;<span class="ident" id="4654457">f</span><span class="op" id="4654458">.</span><span class="ident" id="4654459">hp</span>&nbsp;<span class="op" id="4654462">==</span>&nbsp;<span class="builtinfunc" id="4654465">len</span><span class="op" id="4654468">(</span><span class="ident" id="4654469">f</span><span class="op" id="4654470">.</span><span class="ident" id="4654471">hist</span><span class="op" id="4654475">)</span>&nbsp;<span class="op" id="4654477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654481">f</span><span class="op" id="4654482">.</span><span class="ident" id="4654483">hp</span>&nbsp;<span class="op" id="4654486">=</span>&nbsp;<span class="num" id="4654488">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654492">f</span><span class="op" id="4654493">.</span><span class="ident" id="4654494">hfull</span>&nbsp;<span class="op" id="4654500">=</span>&nbsp;<span class="builtintype" id="4654502">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654511">f</span><span class="op" id="4654512">.</span><span class="ident" id="4654513">hw</span>&nbsp;<span class="op" id="4654516">=</span>&nbsp;<span class="ident" id="4654518">f</span><span class="op" id="4654519">.</span><span class="ident" id="4654520">hp</span><br>
<span class="lineno"></span><span class="op" id="4654523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4654526">func</span>&nbsp;<span class="op" id="4654531">(</span><span class="ident" id="4654532">f</span>&nbsp;<span class="op" id="4654534">*</span><span class="ident" id="4654535">decompressor</span><span class="op" id="4654547">)</span>&nbsp;<span class="ident" id="4654549">moreBits</span><span class="op" id="4654557">(</span><span class="op" id="4654558">)</span>&nbsp;<span class="builtintype" id="4654560">error</span>&nbsp;<span class="op" id="4654566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654569">c</span><span class="op" id="4654570">,</span>&nbsp;<span class="ident" id="4654572">err</span>&nbsp;<span class="op" id="4654576">:=</span>&nbsp;<span class="ident" id="4654579">f</span><span class="op" id="4654580">.</span><span class="ident" id="4654581">r</span><span class="op" id="4654582">.</span><span class="ident" id="4654583">ReadByte</span><span class="op" id="4654591">(</span><span class="op" id="4654592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654595">if</span>&nbsp;<span class="ident" id="4654598">err</span>&nbsp;<span class="op" id="4654602">!=</span>&nbsp;<span class="ident" id="4654605">nil</span>&nbsp;<span class="op" id="4654609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654613">if</span>&nbsp;<span class="ident" id="4654616">err</span>&nbsp;<span class="op" id="4654620">==</span>&nbsp;<span class="ident" id="4654623">io</span><span class="op" id="4654625">.</span><span class="ident" id="4654626">EOF</span>&nbsp;<span class="op" id="4654630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654635">err</span>&nbsp;<span class="op" id="4654639">=</span>&nbsp;<span class="ident" id="4654641">io</span><span class="op" id="4654643">.</span><span class="ident" id="4654644">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654667">return</span>&nbsp;<span class="ident" id="4654674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654682">f</span><span class="op" id="4654683">.</span><span class="ident" id="4654684">roffset</span><span class="op" id="4654691">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654695">f</span><span class="op" id="4654696">.</span><span class="ident" id="4654697">b</span>&nbsp;<span class="op" id="4654699">|=</span>&nbsp;<span class="builtintype" id="4654702">uint32</span><span class="op" id="4654708">(</span><span class="ident" id="4654709">c</span><span class="op" id="4654710">)</span>&nbsp;<span class="op" id="4654712">&lt;&lt;</span>&nbsp;<span class="ident" id="4654715">f</span><span class="op" id="4654716">.</span><span class="ident" id="4654717">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654721">f</span><span class="op" id="4654722">.</span><span class="ident" id="4654723">nb</span>&nbsp;<span class="op" id="4654726">+=</span>&nbsp;<span class="num" id="4654729">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654732">return</span>&nbsp;<span class="ident" id="4654739">nil</span><br>
<span class="lineno"></span><span class="op" id="4654743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4654746">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4654809">func</span>&nbsp;<span class="op" id="4654814">(</span><span class="ident" id="4654815">f</span>&nbsp;<span class="op" id="4654817">*</span><span class="ident" id="4654818">decompressor</span><span class="op" id="4654830">)</span>&nbsp;<span class="ident" id="4654832">huffSym</span><span class="op" id="4654839">(</span><span class="ident" id="4654840">h</span>&nbsp;<span class="op" id="4654842">*</span><span class="ident" id="4654843">huffmanDecoder</span><span class="op" id="4654857">)</span>&nbsp;<span class="op" id="4654859">(</span><span class="builtintype" id="4654860">int</span><span class="op" id="4654863">,</span>&nbsp;<span class="builtintype" id="4654865">error</span><span class="op" id="4654870">)</span>&nbsp;<span class="op" id="4654872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654875">n</span>&nbsp;<span class="op" id="4654877">:=</span>&nbsp;<span class="builtintype" id="4654880">uint</span><span class="op" id="4654884">(</span><span class="ident" id="4654885">h</span><span class="op" id="4654886">.</span><span class="ident" id="4654887">min</span><span class="op" id="4654890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654893">for</span>&nbsp;<span class="op" id="4654897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654901">for</span>&nbsp;<span class="ident" id="4654905">f</span><span class="op" id="4654906">.</span><span class="ident" id="4654907">nb</span>&nbsp;<span class="op" id="4654910">&lt;</span>&nbsp;<span class="ident" id="4654912">n</span>&nbsp;<span class="op" id="4654914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654919">if</span>&nbsp;<span class="ident" id="4654922">err</span>&nbsp;<span class="op" id="4654926">:=</span>&nbsp;<span class="ident" id="4654929">f</span><span class="op" id="4654930">.</span><span class="ident" id="4654931">moreBits</span><span class="op" id="4654939">(</span><span class="op" id="4654940">)</span><span class="op" id="4654941">;</span>&nbsp;<span class="ident" id="4654943">err</span>&nbsp;<span class="op" id="4654947">!=</span>&nbsp;<span class="ident" id="4654950">nil</span>&nbsp;<span class="op" id="4654954">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4654960">return</span>&nbsp;<span class="num" id="4654967">0</span><span class="op" id="4654968">,</span>&nbsp;<span class="ident" id="4654970">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4654981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4654985">chunk</span>&nbsp;<span class="op" id="4654991">:=</span>&nbsp;<span class="ident" id="4654994">h</span><span class="op" id="4654995">.</span><span class="ident" id="4654996">chunks</span><span class="op" id="4655002">[</span><span class="ident" id="4655003">f</span><span class="op" id="4655004">.</span><span class="ident" id="4655005">b</span><span class="op" id="4655006">&amp;</span><span class="op" id="4655007">(</span><span class="ident" id="4655008">huffmanNumChunks</span><span class="op" id="4655024">-</span><span class="num" id="4655025">1</span><span class="op" id="4655026">)</span><span class="op" id="4655027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655031">n</span>&nbsp;<span class="op" id="4655033">=</span>&nbsp;<span class="builtintype" id="4655035">uint</span><span class="op" id="4655039">(</span><span class="ident" id="4655040">chunk</span>&nbsp;<span class="op" id="4655046">&amp;</span>&nbsp;<span class="ident" id="4655048">huffmanCountMask</span><span class="op" id="4655064">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655068">if</span>&nbsp;<span class="ident" id="4655071">n</span>&nbsp;<span class="op" id="4655073">&gt;</span>&nbsp;<span class="ident" id="4655075">huffmanChunkBits</span>&nbsp;<span class="op" id="4655092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655097">chunk</span>&nbsp;<span class="op" id="4655103">=</span>&nbsp;<span class="ident" id="4655105">h</span><span class="op" id="4655106">.</span><span class="ident" id="4655107">links</span><span class="op" id="4655112">[</span><span class="ident" id="4655113">chunk</span><span class="op" id="4655118">&gt;&gt;</span><span class="ident" id="4655120">huffmanValueShift</span><span class="op" id="4655137">]</span><span class="op" id="4655138">[</span><span class="op" id="4655139">(</span><span class="ident" id="4655140">f</span><span class="op" id="4655141">.</span><span class="ident" id="4655142">b</span><span class="op" id="4655143">&gt;&gt;</span><span class="ident" id="4655145">huffmanChunkBits</span><span class="op" id="4655161">)</span><span class="op" id="4655162">&amp;</span><span class="ident" id="4655163">h</span><span class="op" id="4655164">.</span><span class="ident" id="4655165">linkMask</span><span class="op" id="4655173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655178">n</span>&nbsp;<span class="op" id="4655180">=</span>&nbsp;<span class="builtintype" id="4655182">uint</span><span class="op" id="4655186">(</span><span class="ident" id="4655187">chunk</span>&nbsp;<span class="op" id="4655193">&amp;</span>&nbsp;<span class="ident" id="4655195">huffmanCountMask</span><span class="op" id="4655211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655216">if</span>&nbsp;<span class="ident" id="4655219">n</span>&nbsp;<span class="op" id="4655221">==</span>&nbsp;<span class="num" id="4655224">0</span>&nbsp;<span class="op" id="4655226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655232">f</span><span class="op" id="4655233">.</span><span class="ident" id="4655234">err</span>&nbsp;<span class="op" id="4655238">=</span>&nbsp;<span class="ident" id="4655240">CorruptInputError</span><span class="op" id="4655257">(</span><span class="ident" id="4655258">f</span><span class="op" id="4655259">.</span><span class="ident" id="4655260">roffset</span><span class="op" id="4655267">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655273">return</span>&nbsp;<span class="num" id="4655280">0</span><span class="op" id="4655281">,</span>&nbsp;<span class="ident" id="4655283">f</span><span class="op" id="4655284">.</span><span class="ident" id="4655285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655300">if</span>&nbsp;<span class="ident" id="4655303">n</span>&nbsp;<span class="op" id="4655305">&lt;=</span>&nbsp;<span class="ident" id="4655308">f</span><span class="op" id="4655309">.</span><span class="ident" id="4655310">nb</span>&nbsp;<span class="op" id="4655313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655318">f</span><span class="op" id="4655319">.</span><span class="ident" id="4655320">b</span>&nbsp;<span class="op" id="4655322">&gt;&gt;=</span>&nbsp;<span class="ident" id="4655326">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655331">f</span><span class="op" id="4655332">.</span><span class="ident" id="4655333">nb</span>&nbsp;<span class="op" id="4655336">-=</span>&nbsp;<span class="ident" id="4655339">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655344">return</span>&nbsp;<span class="builtintype" id="4655351">int</span><span class="op" id="4655354">(</span><span class="ident" id="4655355">chunk</span>&nbsp;<span class="op" id="4655361">&gt;&gt;</span>&nbsp;<span class="ident" id="4655364">huffmanValueShift</span><span class="op" id="4655381">)</span><span class="op" id="4655382">,</span>&nbsp;<span class="ident" id="4655384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655393">}</span><br>
<span class="lineno"></span><span class="op" id="4655395">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4655398">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4655453">func</span>&nbsp;<span class="op" id="4655458">(</span><span class="ident" id="4655459">f</span>&nbsp;<span class="op" id="4655461">*</span><span class="ident" id="4655462">decompressor</span><span class="op" id="4655474">)</span>&nbsp;<span class="ident" id="4655476">flush</span><span class="op" id="4655481">(</span><span class="ident" id="4655482">step</span>&nbsp;<span class="keyword" id="4655487">func</span><span class="op" id="4655491">(</span><span class="op" id="4655492">*</span><span class="ident" id="4655493">decompressor</span><span class="op" id="4655505">)</span><span class="op" id="4655506">)</span>&nbsp;<span class="op" id="4655508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655511">f</span><span class="op" id="4655512">.</span><span class="ident" id="4655513">toRead</span>&nbsp;<span class="op" id="4655520">=</span>&nbsp;<span class="ident" id="4655522">f</span><span class="op" id="4655523">.</span><span class="ident" id="4655524">hist</span><span class="op" id="4655528">[</span><span class="ident" id="4655529">f</span><span class="op" id="4655530">.</span><span class="ident" id="4655531">hw</span><span class="op" id="4655533">:</span><span class="ident" id="4655534">f</span><span class="op" id="4655535">.</span><span class="ident" id="4655536">hp</span><span class="op" id="4655538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655541">f</span><span class="op" id="4655542">.</span><span class="ident" id="4655543">woffset</span>&nbsp;<span class="op" id="4655551">+=</span>&nbsp;<span class="ident" id="4655554">int64</span><span class="op" id="4655559">(</span><span class="ident" id="4655560">f</span><span class="op" id="4655561">.</span><span class="ident" id="4655562">hp</span>&nbsp;<span class="op" id="4655565">-</span>&nbsp;<span class="ident" id="4655567">f</span><span class="op" id="4655568">.</span><span class="ident" id="4655569">hw</span><span class="op" id="4655571">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655574">f</span><span class="op" id="4655575">.</span><span class="ident" id="4655576">hw</span>&nbsp;<span class="op" id="4655579">=</span>&nbsp;<span class="ident" id="4655581">f</span><span class="op" id="4655582">.</span><span class="ident" id="4655583">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655587">if</span>&nbsp;<span class="ident" id="4655590">f</span><span class="op" id="4655591">.</span><span class="ident" id="4655592">hp</span>&nbsp;<span class="op" id="4655595">==</span>&nbsp;<span class="builtinfunc" id="4655598">len</span><span class="op" id="4655601">(</span><span class="ident" id="4655602">f</span><span class="op" id="4655603">.</span><span class="ident" id="4655604">hist</span><span class="op" id="4655608">)</span>&nbsp;<span class="op" id="4655610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655614">f</span><span class="op" id="4655615">.</span><span class="ident" id="4655616">hp</span>&nbsp;<span class="op" id="4655619">=</span>&nbsp;<span class="num" id="4655621">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655625">f</span><span class="op" id="4655626">.</span><span class="ident" id="4655627">hw</span>&nbsp;<span class="op" id="4655630">=</span>&nbsp;<span class="num" id="4655632">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655636">f</span><span class="op" id="4655637">.</span><span class="ident" id="4655638">hfull</span>&nbsp;<span class="op" id="4655644">=</span>&nbsp;<span class="builtintype" id="4655646">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655655">f</span><span class="op" id="4655656">.</span><span class="ident" id="4655657">step</span>&nbsp;<span class="op" id="4655662">=</span>&nbsp;<span class="ident" id="4655664">step</span><br>
<span class="lineno"></span><span class="op" id="4655669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4655672">func</span>&nbsp;<span class="ident" id="4655677">makeReader</span><span class="op" id="4655687">(</span><span class="ident" id="4655688">r</span>&nbsp;<span class="ident" id="4655690">io</span><span class="op" id="4655692">.</span><span class="ident" id="4655693">Reader</span><span class="op" id="4655699">)</span>&nbsp;<span class="ident" id="4655701">Reader</span>&nbsp;<span class="op" id="4655708">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655711">if</span>&nbsp;<span class="ident" id="4655714">rr</span><span class="op" id="4655716">,</span>&nbsp;<span class="ident" id="4655718">ok</span>&nbsp;<span class="op" id="4655721">:=</span>&nbsp;<span class="ident" id="4655724">r</span><span class="op" id="4655725">.</span><span class="op" id="4655726">(</span><span class="ident" id="4655727">Reader</span><span class="op" id="4655733">)</span><span class="op" id="4655734">;</span>&nbsp;<span class="ident" id="4655736">ok</span>&nbsp;<span class="op" id="4655739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655743">return</span>&nbsp;<span class="ident" id="4655750">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4655757">return</span>&nbsp;<span class="ident" id="4655764">bufio</span><span class="op" id="4655769">.</span><span class="ident" id="4655770">NewReader</span><span class="op" id="4655779">(</span><span class="ident" id="4655780">r</span><span class="op" id="4655781">)</span><br>
<span class="lineno"></span><span class="op" id="4655783">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4655786">func</span>&nbsp;<span class="op" id="4655791">(</span><span class="ident" id="4655792">f</span>&nbsp;<span class="op" id="4655794">*</span><span class="ident" id="4655795">decompressor</span><span class="op" id="4655807">)</span>&nbsp;<span class="ident" id="4655809">Reset</span><span class="op" id="4655814">(</span><span class="ident" id="4655815">r</span>&nbsp;<span class="ident" id="4655817">io</span><span class="op" id="4655819">.</span><span class="ident" id="4655820">Reader</span><span class="op" id="4655826">,</span>&nbsp;<span class="ident" id="4655828">dict</span>&nbsp;<span class="op" id="4655833">[</span><span class="op" id="4655834">]</span><span class="builtintype" id="4655835">byte</span><span class="op" id="4655839">)</span>&nbsp;<span class="builtintype" id="4655841">error</span>&nbsp;<span class="op" id="4655847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4655850">*</span><span class="ident" id="4655851">f</span>&nbsp;<span class="op" id="4655853">=</span>&nbsp;<span class="ident" id="4655855">decompressor</span><span class="op" id="4655867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655871">r</span><span class="op" id="4655872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655881">makeReader</span><span class="op" id="4655891">(</span><span class="ident" id="4655892">r</span><span class="op" id="4655893">)</span><span class="op" id="4655894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655898">bits</span><span class="op" id="4655902">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655908">f</span><span class="op" id="4655909">.</span><span class="ident" id="4655910">bits</span><span class="op" id="4655914">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655918">codebits</span><span class="op" id="4655926">:</span>&nbsp;<span class="ident" id="4655928">f</span><span class="op" id="4655929">.</span><span class="ident" id="4655930">codebits</span><span class="op" id="4655938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655942">hist</span><span class="op" id="4655946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655952">f</span><span class="op" id="4655953">.</span><span class="ident" id="4655954">hist</span><span class="op" id="4655958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4655962">step</span><span class="op" id="4655966">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4655972">(</span><span class="op" id="4655973">*</span><span class="ident" id="4655974">decompressor</span><span class="op" id="4655986">)</span><span class="op" id="4655987">.</span><span class="ident" id="4655988">nextBlock</span><span class="op" id="4655997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4656000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4656003">if</span>&nbsp;<span class="ident" id="4656006">dict</span>&nbsp;<span class="op" id="4656011">!=</span>&nbsp;<span class="ident" id="4656014">nil</span>&nbsp;<span class="op" id="4656018">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656022">f</span><span class="op" id="4656023">.</span><span class="ident" id="4656024">setDict</span><span class="op" id="4656031">(</span><span class="ident" id="4656032">dict</span><span class="op" id="4656036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4656039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4656042">return</span>&nbsp;<span class="ident" id="4656049">nil</span><br>
<span class="lineno"></span><span class="op" id="4656053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4656056">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4656111">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4656153">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4656200">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4656262">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4656331">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4656357">//</span><br>
<span class="lineno"></span><span class="comment" id="4656360">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4656426">func</span>&nbsp;<span class="ident" id="4656431">NewReader</span><span class="op" id="4656440">(</span><span class="ident" id="4656441">r</span>&nbsp;<span class="ident" id="4656443">io</span><span class="op" id="4656445">.</span><span class="ident" id="4656446">Reader</span><span class="op" id="4656452">)</span>&nbsp;<span class="ident" id="4656454">io</span><span class="op" id="4656456">.</span><span class="ident" id="4656457">ReadCloser</span>&nbsp;<span class="op" id="4656468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4656471">var</span>&nbsp;<span class="ident" id="4656475">f</span>&nbsp;<span class="ident" id="4656477">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656491">f</span><span class="op" id="4656492">.</span><span class="ident" id="4656493">bits</span>&nbsp;<span class="op" id="4656498">=</span>&nbsp;<span class="builtinfunc" id="4656500">new</span><span class="op" id="4656503">(</span><span class="op" id="4656504">[</span><span class="ident" id="4656505">maxLit</span>&nbsp;<span class="op" id="4656512">+</span>&nbsp;<span class="ident" id="4656514">maxDist</span><span class="op" id="4656521">]</span><span class="builtintype" id="4656522">int</span><span class="op" id="4656525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656528">f</span><span class="op" id="4656529">.</span><span class="ident" id="4656530">codebits</span>&nbsp;<span class="op" id="4656539">=</span>&nbsp;<span class="builtinfunc" id="4656541">new</span><span class="op" id="4656544">(</span><span class="op" id="4656545">[</span><span class="ident" id="4656546">numCodes</span><span class="op" id="4656554">]</span><span class="builtintype" id="4656555">int</span><span class="op" id="4656558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656561">f</span><span class="op" id="4656562">.</span><span class="ident" id="4656563">r</span>&nbsp;<span class="op" id="4656565">=</span>&nbsp;<span class="ident" id="4656567">makeReader</span><span class="op" id="4656577">(</span><span class="ident" id="4656578">r</span><span class="op" id="4656579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656582">f</span><span class="op" id="4656583">.</span><span class="ident" id="4656584">hist</span>&nbsp;<span class="op" id="4656589">=</span>&nbsp;<span class="builtinfunc" id="4656591">new</span><span class="op" id="4656594">(</span><span class="op" id="4656595">[</span><span class="ident" id="4656596">maxHist</span><span class="op" id="4656603">]</span><span class="builtintype" id="4656604">byte</span><span class="op" id="4656608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4656611">f</span><span class="op" id="4656612">.</span><span class="ident" id="4656613">step</span>&nbsp;<span class="op" id="4656618">=</span>&nbsp;<span class="op" id="4656620">(</span><span class="op" id="4656621">*</span><span class="ident" id="4656622">decompressor</span><span class="op" id="4656634">)</span><span class="op" id="4656635">.</span><span class="ident" id="4656636">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4656647">return</span>&nbsp;<span class="op" id="4656654">&amp;</span><span class="ident" id="4656655">f</span><br>
<span class="lineno"></span><span class="op" id="4656657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4656660">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4656722">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4656786">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4656853">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4656918">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4656963">//</span><br>
<span class="lineno"></span><span class="comment" id="4656966">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4657032">func</span>&nbsp;<span class="ident" id="4657037">NewReaderDict</span><span class="op" id="4657050">(</span><span class="ident" id="4657051">r</span>&nbsp;<span class="ident" id="4657053">io</span><span class="op" id="4657055">.</span><span class="ident" id="4657056">Reader</span><span class="op" id="4657062">,</span>&nbsp;<span class="ident" id="4657064">dict</span>&nbsp;<span class="op" id="4657069">[</span><span class="op" id="4657070">]</span><span class="builtintype" id="4657071">byte</span><span class="op" id="4657075">)</span>&nbsp;<span class="ident" id="4657077">io</span><span class="op" id="4657079">.</span><span class="ident" id="4657080">ReadCloser</span>&nbsp;<span class="op" id="4657091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4657094">var</span>&nbsp;<span class="ident" id="4657098">f</span>&nbsp;<span class="ident" id="4657100">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657114">f</span><span class="op" id="4657115">.</span><span class="ident" id="4657116">r</span>&nbsp;<span class="op" id="4657118">=</span>&nbsp;<span class="ident" id="4657120">makeReader</span><span class="op" id="4657130">(</span><span class="ident" id="4657131">r</span><span class="op" id="4657132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657135">f</span><span class="op" id="4657136">.</span><span class="ident" id="4657137">hist</span>&nbsp;<span class="op" id="4657142">=</span>&nbsp;<span class="builtinfunc" id="4657144">new</span><span class="op" id="4657147">(</span><span class="op" id="4657148">[</span><span class="ident" id="4657149">maxHist</span><span class="op" id="4657156">]</span><span class="builtintype" id="4657157">byte</span><span class="op" id="4657161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657164">f</span><span class="op" id="4657165">.</span><span class="ident" id="4657166">bits</span>&nbsp;<span class="op" id="4657171">=</span>&nbsp;<span class="builtinfunc" id="4657173">new</span><span class="op" id="4657176">(</span><span class="op" id="4657177">[</span><span class="ident" id="4657178">maxLit</span>&nbsp;<span class="op" id="4657185">+</span>&nbsp;<span class="ident" id="4657187">maxDist</span><span class="op" id="4657194">]</span><span class="builtintype" id="4657195">int</span><span class="op" id="4657198">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657201">f</span><span class="op" id="4657202">.</span><span class="ident" id="4657203">codebits</span>&nbsp;<span class="op" id="4657212">=</span>&nbsp;<span class="builtinfunc" id="4657214">new</span><span class="op" id="4657217">(</span><span class="op" id="4657218">[</span><span class="ident" id="4657219">numCodes</span><span class="op" id="4657227">]</span><span class="builtintype" id="4657228">int</span><span class="op" id="4657231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657234">f</span><span class="op" id="4657235">.</span><span class="ident" id="4657236">step</span>&nbsp;<span class="op" id="4657241">=</span>&nbsp;<span class="op" id="4657243">(</span><span class="op" id="4657244">*</span><span class="ident" id="4657245">decompressor</span><span class="op" id="4657257">)</span><span class="op" id="4657258">.</span><span class="ident" id="4657259">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4657270">f</span><span class="op" id="4657271">.</span><span class="ident" id="4657272">setDict</span><span class="op" id="4657279">(</span><span class="ident" id="4657280">dict</span><span class="op" id="4657284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4657287">return</span>&nbsp;<span class="op" id="4657294">&amp;</span><span class="ident" id="4657295">f</span><br>
<span class="lineno"></span><span class="op" id="4657297">}</span>
</div>
</body>
</html>
