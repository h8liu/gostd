<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6371696">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6371751">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6371805">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6371856">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6371930">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6372016">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6372057">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6372089">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6372170">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6372221">//</span><br>
<span class="lineno"></span><span class="comment" id="6372224">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6372309">//</span><br>
<span class="lineno"></span><span class="comment" id="6372312">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6372386">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6372464">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6372539">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6372615">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6372682">//</span><br>
<span class="lineno">20</span><span class="comment" id="6372685">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6372757">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6372790">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6372836">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6372868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6372922">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6372935">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6372950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6372959">//</span><br>
<span class="lineno"></span><span class="comment" id="6372962">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6372976">//</span><br>
<span class="lineno"></span><span class="comment" id="6372979">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6373004">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6373041">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6373118">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6373183">//</span><br>
<span class="lineno"></span><span class="comment" id="6373186">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6373233">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6373296">//</span><br>
<span class="lineno"></span><span class="comment" id="6373299">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6373347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6373390">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6373428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6373464">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6373477">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6373486">//</span><br>
<span class="lineno"></span><span class="comment" id="6373489">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6373551">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6373632">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6373681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6373728">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6373801">//</span><br>
<span class="lineno"></span><span class="comment" id="6373804">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6373875">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6373892">//</span><br>
<span class="lineno">55</span><span class="comment" id="6373895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6373939">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6373966">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6373992">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6374030">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6374055">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6374068">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6374077">//</span><br>
<span class="lineno"></span><span class="comment" id="6374080">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6374158">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6374239">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6374265">//</span><br>
<span class="lineno"></span><span class="comment" id="6374268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6374322">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6374401">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6374449">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6374485">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6374516">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6374547">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6374595">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6374612">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6374626">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6374635">//</span><br>
<span class="lineno"></span><span class="comment" id="6374638">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6374650">//</span><br>
<span class="lineno">80</span><span class="comment" id="6374653">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6374727">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6374812">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6374891">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6374965">//</span><br>
<span class="lineno">85</span><span class="comment" id="6374968">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6374997">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6375033">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6375065">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375074">//</span><br>
<span class="lineno">90</span><span class="comment" id="6375077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6375112">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6375153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6375191">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6375217">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6375246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6375272">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375281">//</span><br>
<span class="lineno"></span><span class="comment" id="6375284">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6375360">//</span><br>
<span class="lineno">100</span><span class="comment" id="6375363">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6375452">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6375479">//</span><br>
<span class="lineno"></span><span class="comment" id="6375482">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375512">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6375543">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375574">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375607">//</span><br>
<span class="lineno"></span><span class="comment" id="6375610">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6375694">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6375767">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6375789">//</span><br>
<span class="lineno"></span><span class="comment" id="6375792">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375829">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375867">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6375905">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6375945">//</span><br>
<span class="lineno"></span><span class="comment" id="6375948">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6376026">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6376104">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6376156">//</span><br>
<span class="lineno"></span><span class="comment" id="6376159">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6376167">//</span><br>
<span class="lineno"></span><span class="comment" id="6376170">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6376248">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6376329">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6376402">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6376441">//</span><br>
<span class="lineno"></span><span class="comment" id="6376444">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6376475">//</span><br>
<span class="lineno">130</span><span class="comment" id="6376478">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6376556">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6376631">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6376704">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6376741">//</span><br>
<span class="lineno">135</span><span class="comment" id="6376744">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6376790">//</span><br>
<span class="lineno"></span><span class="comment" id="6376793">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6376845">//</span><br>
<span class="lineno"></span><span class="comment" id="6376848">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6376934">package</span>&nbsp;<span class="ident" id="6376942">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6376951">import</span>&nbsp;<span class="op" id="6376958">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376961">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376970">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376978">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376985">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6376991">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6377002">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6377019">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6377030">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6377041">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6377049">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6377056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6377059">var</span>&nbsp;<span class="op" id="6377063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377066">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377145">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377222">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377300">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377377">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377407">short</span>&nbsp;<span class="op" id="6377413">=</span>&nbsp;<span class="ident" id="6377415">flag</span><span class="op" id="6377419">.</span><span class="ident" id="6377420">Bool</span><span class="op" id="6377424">(</span><span class="string" id="6377425">&#34;test.short&#34;</span><span class="op" id="6377437">,</span>&nbsp;<span class="builtintype" id="6377439">false</span><span class="op" id="6377444">,</span>&nbsp;<span class="string" id="6377446">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6377483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377487">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377566">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377645">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377732">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377766">outputDir</span>&nbsp;<span class="op" id="6377776">=</span>&nbsp;<span class="ident" id="6377778">flag</span><span class="op" id="6377782">.</span><span class="ident" id="6377783">String</span><span class="op" id="6377789">(</span><span class="string" id="6377790">&#34;test.outputdir&#34;</span><span class="op" id="6377806">,</span>&nbsp;<span class="string" id="6377808">&#34;&#34;</span><span class="op" id="6377810">,</span>&nbsp;<span class="string" id="6377812">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6377850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377854">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377914">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6377931">=</span>&nbsp;<span class="ident" id="6377933">flag</span><span class="op" id="6377937">.</span><span class="ident" id="6377938">Bool</span><span class="op" id="6377942">(</span><span class="string" id="6377943">&#34;test.v&#34;</span><span class="op" id="6377951">,</span>&nbsp;<span class="builtintype" id="6377953">false</span><span class="op" id="6377958">,</span>&nbsp;<span class="string" id="6377960">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6377994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377997">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378014">=</span>&nbsp;<span class="ident" id="6378016">flag</span><span class="op" id="6378020">.</span><span class="ident" id="6378021">String</span><span class="op" id="6378027">(</span><span class="string" id="6378028">&#34;test.coverprofile&#34;</span><span class="op" id="6378047">,</span>&nbsp;<span class="string" id="6378049">&#34;&#34;</span><span class="op" id="6378051">,</span>&nbsp;<span class="string" id="6378053">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6378113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378116">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378133">=</span>&nbsp;<span class="ident" id="6378135">flag</span><span class="op" id="6378139">.</span><span class="ident" id="6378140">String</span><span class="op" id="6378146">(</span><span class="string" id="6378147">&#34;test.run&#34;</span><span class="op" id="6378157">,</span>&nbsp;<span class="string" id="6378159">&#34;&#34;</span><span class="op" id="6378161">,</span>&nbsp;<span class="string" id="6378163">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6378219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378222">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378239">=</span>&nbsp;<span class="ident" id="6378241">flag</span><span class="op" id="6378245">.</span><span class="ident" id="6378246">String</span><span class="op" id="6378252">(</span><span class="string" id="6378253">&#34;test.memprofile&#34;</span><span class="op" id="6378270">,</span>&nbsp;<span class="string" id="6378272">&#34;&#34;</span><span class="op" id="6378274">,</span>&nbsp;<span class="string" id="6378276">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6378334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378337">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6378354">=</span>&nbsp;<span class="ident" id="6378356">flag</span><span class="op" id="6378360">.</span><span class="ident" id="6378361">Int</span><span class="op" id="6378364">(</span><span class="string" id="6378365">&#34;test.memprofilerate&#34;</span><span class="op" id="6378386">,</span>&nbsp;<span class="num" id="6378388">0</span><span class="op" id="6378389">,</span>&nbsp;<span class="string" id="6378391">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6378428">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378431">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378448">=</span>&nbsp;<span class="ident" id="6378450">flag</span><span class="op" id="6378454">.</span><span class="ident" id="6378455">String</span><span class="op" id="6378461">(</span><span class="string" id="6378462">&#34;test.cpuprofile&#34;</span><span class="op" id="6378479">,</span>&nbsp;<span class="string" id="6378481">&#34;&#34;</span><span class="op" id="6378483">,</span>&nbsp;<span class="string" id="6378485">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6378541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378544">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378561">=</span>&nbsp;<span class="ident" id="6378563">flag</span><span class="op" id="6378567">.</span><span class="ident" id="6378568">String</span><span class="op" id="6378574">(</span><span class="string" id="6378575">&#34;test.blockprofile&#34;</span><span class="op" id="6378594">,</span>&nbsp;<span class="string" id="6378596">&#34;&#34;</span><span class="op" id="6378598">,</span>&nbsp;<span class="string" id="6378600">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6378670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378673">blockProfileRate</span>&nbsp;<span class="op" id="6378690">=</span>&nbsp;<span class="ident" id="6378692">flag</span><span class="op" id="6378696">.</span><span class="ident" id="6378697">Int</span><span class="op" id="6378700">(</span><span class="string" id="6378701">&#34;test.blockprofilerate&#34;</span><span class="op" id="6378724">,</span>&nbsp;<span class="num" id="6378726">1</span><span class="op" id="6378727">,</span>&nbsp;<span class="string" id="6378729">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6378775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378778">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378795">=</span>&nbsp;<span class="ident" id="6378797">flag</span><span class="op" id="6378801">.</span><span class="ident" id="6378802">Duration</span><span class="op" id="6378810">(</span><span class="string" id="6378811">&#34;test.timeout&#34;</span><span class="op" id="6378825">,</span>&nbsp;<span class="num" id="6378827">0</span><span class="op" id="6378828">,</span>&nbsp;<span class="string" id="6378830">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6378887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378890">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6378907">=</span>&nbsp;<span class="ident" id="6378909">flag</span><span class="op" id="6378913">.</span><span class="ident" id="6378914">String</span><span class="op" id="6378920">(</span><span class="string" id="6378921">&#34;test.cpu&#34;</span><span class="op" id="6378931">,</span>&nbsp;<span class="string" id="6378933">&#34;&#34;</span><span class="op" id="6378935">,</span>&nbsp;<span class="string" id="6378937">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6378998">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379001">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379018">=</span>&nbsp;<span class="ident" id="6379020">flag</span><span class="op" id="6379024">.</span><span class="ident" id="6379025">Int</span><span class="op" id="6379028">(</span><span class="string" id="6379029">&#34;test.parallel&#34;</span><span class="op" id="6379044">,</span>&nbsp;<span class="ident" id="6379046">runtime</span><span class="op" id="6379053">.</span><span class="ident" id="6379054">GOMAXPROCS</span><span class="op" id="6379064">(</span><span class="num" id="6379065">0</span><span class="op" id="6379066">)</span><span class="op" id="6379067">,</span>&nbsp;<span class="string" id="6379069">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6379095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379099">haveExamples</span>&nbsp;<span class="builtintype" id="6379112">bool</span>&nbsp;<span class="comment" id="6379117">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379142">cpuList</span>&nbsp;<span class="op" id="6379150">[</span><span class="op" id="6379151">]</span><span class="builtintype" id="6379152">int</span><br>
<span class="lineno">185</span><span class="op" id="6379156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379159">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6379215">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6379258">type</span>&nbsp;<span class="ident" id="6379263">common</span>&nbsp;<span class="keyword" id="6379270">struct</span>&nbsp;<span class="op" id="6379277">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379280">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379289">sync</span><span class="op" id="6379293">.</span><span class="ident" id="6379294">RWMutex</span>&nbsp;<span class="comment" id="6379302">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379331">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6379340">[</span><span class="op" id="6379341">]</span><span class="builtintype" id="6379342">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379353">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379396">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6379405">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379418">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379452">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6379461">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379474">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379514">finished</span>&nbsp;<span class="builtintype" id="6379523">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379530">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379539">time</span><span class="op" id="6379543">.</span><span class="ident" id="6379544">Time</span>&nbsp;<span class="comment" id="6379549">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379584">duration</span>&nbsp;<span class="ident" id="6379593">time</span><span class="op" id="6379597">.</span><span class="ident" id="6379598">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379608">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379617">interface</span><span class="op" id="6379626">{</span><span class="op" id="6379627">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6379634">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379678">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379687">chan</span>&nbsp;<span class="keyword" id="6379692">interface</span><span class="op" id="6379701">{</span><span class="op" id="6379702">}</span>&nbsp;<span class="comment" id="6379704">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6379732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379735">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6379789">func</span>&nbsp;<span class="ident" id="6379794">Short</span><span class="op" id="6379799">(</span><span class="op" id="6379800">)</span>&nbsp;<span class="builtintype" id="6379802">bool</span>&nbsp;<span class="op" id="6379807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379810">return</span>&nbsp;<span class="op" id="6379817">*</span><span class="ident" id="6379818">short</span><br>
<span class="lineno">205</span><span class="op" id="6379824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379827">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6379879">func</span>&nbsp;<span class="ident" id="6379884">Verbose</span><span class="op" id="6379891">(</span><span class="op" id="6379892">)</span>&nbsp;<span class="builtintype" id="6379894">bool</span>&nbsp;<span class="op" id="6379899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379902">return</span>&nbsp;<span class="op" id="6379909">*</span><span class="ident" id="6379910">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6379917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379920">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6379992">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6380072">func</span>&nbsp;<span class="ident" id="6380077">decorate</span><span class="op" id="6380085">(</span><span class="ident" id="6380086">s</span>&nbsp;<span class="builtintype" id="6380088">string</span><span class="op" id="6380094">)</span>&nbsp;<span class="builtintype" id="6380096">string</span>&nbsp;<span class="op" id="6380103">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380106">_</span><span class="op" id="6380107">,</span>&nbsp;<span class="ident" id="6380109">file</span><span class="op" id="6380113">,</span>&nbsp;<span class="ident" id="6380115">line</span><span class="op" id="6380119">,</span>&nbsp;<span class="ident" id="6380121">ok</span>&nbsp;<span class="op" id="6380124">:=</span>&nbsp;<span class="ident" id="6380127">runtime</span><span class="op" id="6380134">.</span><span class="ident" id="6380135">Caller</span><span class="op" id="6380141">(</span><span class="num" id="6380142">3</span><span class="op" id="6380143">)</span>&nbsp;<span class="comment" id="6380145">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380183">if</span>&nbsp;<span class="ident" id="6380186">ok</span>&nbsp;<span class="op" id="6380189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380193">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380246">if</span>&nbsp;<span class="ident" id="6380249">index</span>&nbsp;<span class="op" id="6380255">:=</span>&nbsp;<span class="ident" id="6380258">strings</span><span class="op" id="6380265">.</span><span class="ident" id="6380266">LastIndex</span><span class="op" id="6380275">(</span><span class="ident" id="6380276">file</span><span class="op" id="6380280">,</span>&nbsp;<span class="string" id="6380282">&#34;/&#34;</span><span class="op" id="6380285">)</span><span class="op" id="6380286">;</span>&nbsp;<span class="ident" id="6380288">index</span>&nbsp;<span class="op" id="6380294">&gt;=</span>&nbsp;<span class="num" id="6380297">0</span>&nbsp;<span class="op" id="6380299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380304">file</span>&nbsp;<span class="op" id="6380309">=</span>&nbsp;<span class="ident" id="6380311">file</span><span class="op" id="6380315">[</span><span class="ident" id="6380316">index</span><span class="op" id="6380321">+</span><span class="num" id="6380322">1</span><span class="op" id="6380323">:</span><span class="op" id="6380324">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380328">}</span>&nbsp;<span class="keyword" id="6380330">else</span>&nbsp;<span class="keyword" id="6380335">if</span>&nbsp;<span class="ident" id="6380338">index</span>&nbsp;<span class="op" id="6380344">=</span>&nbsp;<span class="ident" id="6380346">strings</span><span class="op" id="6380353">.</span><span class="ident" id="6380354">LastIndex</span><span class="op" id="6380363">(</span><span class="ident" id="6380364">file</span><span class="op" id="6380368">,</span>&nbsp;<span class="string" id="6380370">&#34;\\&#34;</span><span class="op" id="6380374">)</span><span class="op" id="6380375">;</span>&nbsp;<span class="ident" id="6380377">index</span>&nbsp;<span class="op" id="6380383">&gt;=</span>&nbsp;<span class="num" id="6380386">0</span>&nbsp;<span class="op" id="6380388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380393">file</span>&nbsp;<span class="op" id="6380398">=</span>&nbsp;<span class="ident" id="6380400">file</span><span class="op" id="6380404">[</span><span class="ident" id="6380405">index</span><span class="op" id="6380410">+</span><span class="num" id="6380411">1</span><span class="op" id="6380412">:</span><span class="op" id="6380413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380420">}</span>&nbsp;<span class="keyword" id="6380422">else</span>&nbsp;<span class="op" id="6380427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380431">file</span>&nbsp;<span class="op" id="6380436">=</span>&nbsp;<span class="string" id="6380438">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380446">line</span>&nbsp;<span class="op" id="6380451">=</span>&nbsp;<span class="num" id="6380453">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380459">buf</span>&nbsp;<span class="op" id="6380463">:=</span>&nbsp;<span class="builtinfunc" id="6380466">new</span><span class="op" id="6380469">(</span><span class="ident" id="6380470">bytes</span><span class="op" id="6380475">.</span><span class="ident" id="6380476">Buffer</span><span class="op" id="6380482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380485">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380530">buf</span><span class="op" id="6380533">.</span><span class="ident" id="6380534">WriteByte</span><span class="op" id="6380543">(</span><span class="string" id="6380544">&#39;\t&#39;</span><span class="op" id="6380548">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380551">fmt</span><span class="op" id="6380554">.</span><span class="ident" id="6380555">Fprintf</span><span class="op" id="6380562">(</span><span class="ident" id="6380563">buf</span><span class="op" id="6380566">,</span>&nbsp;<span class="string" id="6380568">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6380577">,</span>&nbsp;<span class="ident" id="6380579">file</span><span class="op" id="6380583">,</span>&nbsp;<span class="ident" id="6380585">line</span><span class="op" id="6380589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380592">lines</span>&nbsp;<span class="op" id="6380598">:=</span>&nbsp;<span class="ident" id="6380601">strings</span><span class="op" id="6380608">.</span><span class="ident" id="6380609">Split</span><span class="op" id="6380614">(</span><span class="ident" id="6380615">s</span><span class="op" id="6380616">,</span>&nbsp;<span class="string" id="6380618">&#34;\n&#34;</span><span class="op" id="6380622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380625">if</span>&nbsp;<span class="ident" id="6380628">l</span>&nbsp;<span class="op" id="6380630">:=</span>&nbsp;<span class="builtinfunc" id="6380633">len</span><span class="op" id="6380636">(</span><span class="ident" id="6380637">lines</span><span class="op" id="6380642">)</span><span class="op" id="6380643">;</span>&nbsp;<span class="ident" id="6380645">l</span>&nbsp;<span class="op" id="6380647">&gt;</span>&nbsp;<span class="num" id="6380649">1</span>&nbsp;<span class="op" id="6380651">&amp;&amp;</span>&nbsp;<span class="ident" id="6380654">lines</span><span class="op" id="6380659">[</span><span class="ident" id="6380660">l</span><span class="op" id="6380661">-</span><span class="num" id="6380662">1</span><span class="op" id="6380663">]</span>&nbsp;<span class="op" id="6380665">==</span>&nbsp;<span class="string" id="6380668">&#34;&#34;</span>&nbsp;<span class="op" id="6380671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380675">lines</span>&nbsp;<span class="op" id="6380681">=</span>&nbsp;<span class="ident" id="6380683">lines</span><span class="op" id="6380688">[</span><span class="op" id="6380689">:</span><span class="ident" id="6380690">l</span><span class="op" id="6380691">-</span><span class="num" id="6380692">1</span><span class="op" id="6380693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380696">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380699">for</span>&nbsp;<span class="ident" id="6380703">i</span><span class="op" id="6380704">,</span>&nbsp;<span class="ident" id="6380706">line</span>&nbsp;<span class="op" id="6380711">:=</span>&nbsp;<span class="keyword" id="6380714">range</span>&nbsp;<span class="ident" id="6380720">lines</span>&nbsp;<span class="op" id="6380726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380730">if</span>&nbsp;<span class="ident" id="6380733">i</span>&nbsp;<span class="op" id="6380735">&gt;</span>&nbsp;<span class="num" id="6380737">0</span>&nbsp;<span class="op" id="6380739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380744">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380805">buf</span><span class="op" id="6380808">.</span><span class="ident" id="6380809">WriteString</span><span class="op" id="6380820">(</span><span class="string" id="6380821">&#34;\n\t\t&#34;</span><span class="op" id="6380829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380833">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380837">buf</span><span class="op" id="6380840">.</span><span class="ident" id="6380841">WriteString</span><span class="op" id="6380852">(</span><span class="ident" id="6380853">line</span><span class="op" id="6380857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380863">buf</span><span class="op" id="6380866">.</span><span class="ident" id="6380867">WriteByte</span><span class="op" id="6380876">(</span><span class="string" id="6380877">&#39;\n&#39;</span><span class="op" id="6380881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380884">return</span>&nbsp;<span class="ident" id="6380891">buf</span><span class="op" id="6380894">.</span><span class="ident" id="6380895">String</span><span class="op" id="6380901">(</span><span class="op" id="6380902">)</span><br>
<span class="lineno"></span><span class="op" id="6380904">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6380907">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6380976">func</span>&nbsp;<span class="ident" id="6380981">fmtDuration</span><span class="op" id="6380992">(</span><span class="ident" id="6380993">d</span>&nbsp;<span class="ident" id="6380995">time</span><span class="op" id="6380999">.</span><span class="ident" id="6381000">Duration</span><span class="op" id="6381008">)</span>&nbsp;<span class="builtintype" id="6381010">string</span>&nbsp;<span class="op" id="6381017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381020">return</span>&nbsp;<span class="ident" id="6381027">fmt</span><span class="op" id="6381030">.</span><span class="ident" id="6381031">Sprintf</span><span class="op" id="6381038">(</span><span class="string" id="6381039">&#34;%.2fs&#34;</span><span class="op" id="6381046">,</span>&nbsp;<span class="ident" id="6381048">d</span><span class="op" id="6381049">.</span><span class="ident" id="6381050">Seconds</span><span class="op" id="6381057">(</span><span class="op" id="6381058">)</span><span class="op" id="6381059">)</span><br>
<span class="lineno"></span><span class="op" id="6381061">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6381064">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6381106">type</span>&nbsp;<span class="ident" id="6381111">TB</span>&nbsp;<span class="keyword" id="6381114">interface</span>&nbsp;<span class="op" id="6381124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381127">Error</span><span class="op" id="6381132">(</span><span class="ident" id="6381133">args</span>&nbsp;<span class="op" id="6381138">...</span><span class="keyword" id="6381141">interface</span><span class="op" id="6381150">{</span><span class="op" id="6381151">}</span><span class="op" id="6381152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381155">Errorf</span><span class="op" id="6381161">(</span><span class="ident" id="6381162">format</span>&nbsp;<span class="builtintype" id="6381169">string</span><span class="op" id="6381175">,</span>&nbsp;<span class="ident" id="6381177">args</span>&nbsp;<span class="op" id="6381182">...</span><span class="keyword" id="6381185">interface</span><span class="op" id="6381194">{</span><span class="op" id="6381195">}</span><span class="op" id="6381196">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381199">Fail</span><span class="op" id="6381203">(</span><span class="op" id="6381204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381207">FailNow</span><span class="op" id="6381214">(</span><span class="op" id="6381215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381218">Failed</span><span class="op" id="6381224">(</span><span class="op" id="6381225">)</span>&nbsp;<span class="builtintype" id="6381227">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381233">Fatal</span><span class="op" id="6381238">(</span><span class="ident" id="6381239">args</span>&nbsp;<span class="op" id="6381244">...</span><span class="keyword" id="6381247">interface</span><span class="op" id="6381256">{</span><span class="op" id="6381257">}</span><span class="op" id="6381258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381261">Fatalf</span><span class="op" id="6381267">(</span><span class="ident" id="6381268">format</span>&nbsp;<span class="builtintype" id="6381275">string</span><span class="op" id="6381281">,</span>&nbsp;<span class="ident" id="6381283">args</span>&nbsp;<span class="op" id="6381288">...</span><span class="keyword" id="6381291">interface</span><span class="op" id="6381300">{</span><span class="op" id="6381301">}</span><span class="op" id="6381302">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381305">Log</span><span class="op" id="6381308">(</span><span class="ident" id="6381309">args</span>&nbsp;<span class="op" id="6381314">...</span><span class="keyword" id="6381317">interface</span><span class="op" id="6381326">{</span><span class="op" id="6381327">}</span><span class="op" id="6381328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381331">Logf</span><span class="op" id="6381335">(</span><span class="ident" id="6381336">format</span>&nbsp;<span class="builtintype" id="6381343">string</span><span class="op" id="6381349">,</span>&nbsp;<span class="ident" id="6381351">args</span>&nbsp;<span class="op" id="6381356">...</span><span class="keyword" id="6381359">interface</span><span class="op" id="6381368">{</span><span class="op" id="6381369">}</span><span class="op" id="6381370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381373">Skip</span><span class="op" id="6381377">(</span><span class="ident" id="6381378">args</span>&nbsp;<span class="op" id="6381383">...</span><span class="keyword" id="6381386">interface</span><span class="op" id="6381395">{</span><span class="op" id="6381396">}</span><span class="op" id="6381397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381400">SkipNow</span><span class="op" id="6381407">(</span><span class="op" id="6381408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381411">Skipf</span><span class="op" id="6381416">(</span><span class="ident" id="6381417">format</span>&nbsp;<span class="builtintype" id="6381424">string</span><span class="op" id="6381430">,</span>&nbsp;<span class="ident" id="6381432">args</span>&nbsp;<span class="op" id="6381437">...</span><span class="keyword" id="6381440">interface</span><span class="op" id="6381449">{</span><span class="op" id="6381450">}</span><span class="op" id="6381451">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381454">Skipped</span><span class="op" id="6381461">(</span><span class="op" id="6381462">)</span>&nbsp;<span class="builtintype" id="6381464">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381471">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381526">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381579">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381611">private</span><span class="op" id="6381618">(</span><span class="op" id="6381619">)</span><br>
<span class="lineno"></span><span class="op" id="6381621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6381624">var</span>&nbsp;<span class="ident" id="6381628">_</span>&nbsp;<span class="ident" id="6381630">TB</span>&nbsp;<span class="op" id="6381633">=</span>&nbsp;<span class="op" id="6381635">(</span><span class="op" id="6381636">*</span><span class="ident" id="6381637">T</span><span class="op" id="6381638">)</span><span class="op" id="6381639">(</span><span class="ident" id="6381640">nil</span><span class="op" id="6381643">)</span><br>
<span class="lineno"></span><span class="keyword" id="6381645">var</span>&nbsp;<span class="ident" id="6381649">_</span>&nbsp;<span class="ident" id="6381651">TB</span>&nbsp;<span class="op" id="6381654">=</span>&nbsp;<span class="op" id="6381656">(</span><span class="op" id="6381657">*</span><span class="ident" id="6381658">B</span><span class="op" id="6381659">)</span><span class="op" id="6381660">(</span><span class="ident" id="6381661">nil</span><span class="op" id="6381664">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6381667">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6381761">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6381842">type</span>&nbsp;<span class="ident" id="6381847">T</span>&nbsp;<span class="keyword" id="6381849">struct</span>&nbsp;<span class="op" id="6381856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381859">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381867">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6381881">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381891">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381909">startParallel</span>&nbsp;<span class="keyword" id="6381923">chan</span>&nbsp;<span class="builtintype" id="6381928">bool</span>&nbsp;<span class="comment" id="6381933">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6381970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6381973">func</span>&nbsp;<span class="op" id="6381978">(</span><span class="ident" id="6381979">c</span>&nbsp;<span class="op" id="6381981">*</span><span class="ident" id="6381982">common</span><span class="op" id="6381988">)</span>&nbsp;<span class="ident" id="6381990">private</span><span class="op" id="6381997">(</span><span class="op" id="6381998">)</span>&nbsp;<span class="op" id="6382000">{</span><span class="op" id="6382001">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6382004">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6382073">func</span>&nbsp;<span class="op" id="6382078">(</span><span class="ident" id="6382079">c</span>&nbsp;<span class="op" id="6382081">*</span><span class="ident" id="6382082">common</span><span class="op" id="6382088">)</span>&nbsp;<span class="ident" id="6382090">Fail</span><span class="op" id="6382094">(</span><span class="op" id="6382095">)</span>&nbsp;<span class="op" id="6382097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382100">c</span><span class="op" id="6382101">.</span><span class="ident" id="6382102">mu</span><span class="op" id="6382104">.</span><span class="ident" id="6382105">Lock</span><span class="op" id="6382109">(</span><span class="op" id="6382110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382113">defer</span>&nbsp;<span class="ident" id="6382119">c</span><span class="op" id="6382120">.</span><span class="ident" id="6382121">mu</span><span class="op" id="6382123">.</span><span class="ident" id="6382124">Unlock</span><span class="op" id="6382130">(</span><span class="op" id="6382131">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382134">c</span><span class="op" id="6382135">.</span><span class="ident" id="6382136">failed</span>&nbsp;<span class="op" id="6382143">=</span>&nbsp;<span class="builtintype" id="6382145">true</span><br>
<span class="lineno"></span><span class="op" id="6382150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382153">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6382204">func</span>&nbsp;<span class="op" id="6382209">(</span><span class="ident" id="6382210">c</span>&nbsp;<span class="op" id="6382212">*</span><span class="ident" id="6382213">common</span><span class="op" id="6382219">)</span>&nbsp;<span class="ident" id="6382221">Failed</span><span class="op" id="6382227">(</span><span class="op" id="6382228">)</span>&nbsp;<span class="builtintype" id="6382230">bool</span>&nbsp;<span class="op" id="6382235">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382238">c</span><span class="op" id="6382239">.</span><span class="ident" id="6382240">mu</span><span class="op" id="6382242">.</span><span class="ident" id="6382243">RLock</span><span class="op" id="6382248">(</span><span class="op" id="6382249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382252">defer</span>&nbsp;<span class="ident" id="6382258">c</span><span class="op" id="6382259">.</span><span class="ident" id="6382260">mu</span><span class="op" id="6382262">.</span><span class="ident" id="6382263">RUnlock</span><span class="op" id="6382270">(</span><span class="op" id="6382271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382274">return</span>&nbsp;<span class="ident" id="6382281">c</span><span class="op" id="6382282">.</span><span class="ident" id="6382283">failed</span><br>
<span class="lineno"></span><span class="op" id="6382290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6382293">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6382365">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6382423">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6382480">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6382537">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6382595">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6382622">func</span>&nbsp;<span class="op" id="6382627">(</span><span class="ident" id="6382628">c</span>&nbsp;<span class="op" id="6382630">*</span><span class="ident" id="6382631">common</span><span class="op" id="6382637">)</span>&nbsp;<span class="ident" id="6382639">FailNow</span><span class="op" id="6382646">(</span><span class="op" id="6382647">)</span>&nbsp;<span class="op" id="6382649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382652">c</span><span class="op" id="6382653">.</span><span class="ident" id="6382654">Fail</span><span class="op" id="6382658">(</span><span class="op" id="6382659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382663">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382721">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382776">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382837">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382900">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382904">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382946">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382950">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382971">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382994">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383015">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383019">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383081">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383143">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383205">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383274">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383343">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383415">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383479">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383543">c</span><span class="op" id="6383544">.</span><span class="ident" id="6383545">finished</span>&nbsp;<span class="op" id="6383554">=</span>&nbsp;<span class="builtintype" id="6383556">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383562">runtime</span><span class="op" id="6383569">.</span><span class="ident" id="6383570">Goexit</span><span class="op" id="6383576">(</span><span class="op" id="6383577">)</span><br>
<span class="lineno">330</span><span class="op" id="6383579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6383582">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6383648">func</span>&nbsp;<span class="op" id="6383653">(</span><span class="ident" id="6383654">c</span>&nbsp;<span class="op" id="6383656">*</span><span class="ident" id="6383657">common</span><span class="op" id="6383663">)</span>&nbsp;<span class="ident" id="6383665">log</span><span class="op" id="6383668">(</span><span class="ident" id="6383669">s</span>&nbsp;<span class="builtintype" id="6383671">string</span><span class="op" id="6383677">)</span>&nbsp;<span class="op" id="6383679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383682">c</span><span class="op" id="6383683">.</span><span class="ident" id="6383684">mu</span><span class="op" id="6383686">.</span><span class="ident" id="6383687">Lock</span><span class="op" id="6383691">(</span><span class="op" id="6383692">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383695">defer</span>&nbsp;<span class="ident" id="6383701">c</span><span class="op" id="6383702">.</span><span class="ident" id="6383703">mu</span><span class="op" id="6383705">.</span><span class="ident" id="6383706">Unlock</span><span class="op" id="6383712">(</span><span class="op" id="6383713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383716">c</span><span class="op" id="6383717">.</span><span class="ident" id="6383718">output</span>&nbsp;<span class="op" id="6383725">=</span>&nbsp;<span class="builtinfunc" id="6383727">append</span><span class="op" id="6383733">(</span><span class="ident" id="6383734">c</span><span class="op" id="6383735">.</span><span class="ident" id="6383736">output</span><span class="op" id="6383742">,</span>&nbsp;<span class="ident" id="6383744">decorate</span><span class="op" id="6383752">(</span><span class="ident" id="6383753">s</span><span class="op" id="6383754">)</span><span class="op" id="6383755">...</span><span class="op" id="6383758">)</span><br>
<span class="lineno"></span><span class="op" id="6383760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6383763">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6383840">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6383915">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6383961">func</span>&nbsp;<span class="op" id="6383966">(</span><span class="ident" id="6383967">c</span>&nbsp;<span class="op" id="6383969">*</span><span class="ident" id="6383970">common</span><span class="op" id="6383976">)</span>&nbsp;<span class="ident" id="6383978">Log</span><span class="op" id="6383981">(</span><span class="ident" id="6383982">args</span>&nbsp;<span class="op" id="6383987">...</span><span class="keyword" id="6383990">interface</span><span class="op" id="6383999">{</span><span class="op" id="6384000">}</span><span class="op" id="6384001">)</span>&nbsp;<span class="op" id="6384003">{</span>&nbsp;<span class="ident" id="6384005">c</span><span class="op" id="6384006">.</span><span class="ident" id="6384007">log</span><span class="op" id="6384010">(</span><span class="ident" id="6384011">fmt</span><span class="op" id="6384014">.</span><span class="ident" id="6384015">Sprintln</span><span class="op" id="6384023">(</span><span class="ident" id="6384024">args</span><span class="op" id="6384028">...</span><span class="op" id="6384031">)</span><span class="op" id="6384032">)</span>&nbsp;<span class="op" id="6384034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6384037">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6384113">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6384188">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6384234">func</span>&nbsp;<span class="op" id="6384239">(</span><span class="ident" id="6384240">c</span>&nbsp;<span class="op" id="6384242">*</span><span class="ident" id="6384243">common</span><span class="op" id="6384249">)</span>&nbsp;<span class="ident" id="6384251">Logf</span><span class="op" id="6384255">(</span><span class="ident" id="6384256">format</span>&nbsp;<span class="builtintype" id="6384263">string</span><span class="op" id="6384269">,</span>&nbsp;<span class="ident" id="6384271">args</span>&nbsp;<span class="op" id="6384276">...</span><span class="keyword" id="6384279">interface</span><span class="op" id="6384288">{</span><span class="op" id="6384289">}</span><span class="op" id="6384290">)</span>&nbsp;<span class="op" id="6384292">{</span>&nbsp;<span class="ident" id="6384294">c</span><span class="op" id="6384295">.</span><span class="ident" id="6384296">log</span><span class="op" id="6384299">(</span><span class="ident" id="6384300">fmt</span><span class="op" id="6384303">.</span><span class="ident" id="6384304">Sprintf</span><span class="op" id="6384311">(</span><span class="ident" id="6384312">format</span><span class="op" id="6384318">,</span>&nbsp;<span class="ident" id="6384320">args</span><span class="op" id="6384324">...</span><span class="op" id="6384327">)</span><span class="op" id="6384328">)</span>&nbsp;<span class="op" id="6384330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6384333">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6384381">func</span>&nbsp;<span class="op" id="6384386">(</span><span class="ident" id="6384387">c</span>&nbsp;<span class="op" id="6384389">*</span><span class="ident" id="6384390">common</span><span class="op" id="6384396">)</span>&nbsp;<span class="ident" id="6384398">Error</span><span class="op" id="6384403">(</span><span class="ident" id="6384404">args</span>&nbsp;<span class="op" id="6384409">...</span><span class="keyword" id="6384412">interface</span><span class="op" id="6384421">{</span><span class="op" id="6384422">}</span><span class="op" id="6384423">)</span>&nbsp;<span class="op" id="6384425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384428">c</span><span class="op" id="6384429">.</span><span class="ident" id="6384430">log</span><span class="op" id="6384433">(</span><span class="ident" id="6384434">fmt</span><span class="op" id="6384437">.</span><span class="ident" id="6384438">Sprintln</span><span class="op" id="6384446">(</span><span class="ident" id="6384447">args</span><span class="op" id="6384451">...</span><span class="op" id="6384454">)</span><span class="op" id="6384455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384458">c</span><span class="op" id="6384459">.</span><span class="ident" id="6384460">Fail</span><span class="op" id="6384464">(</span><span class="op" id="6384465">)</span><br>
<span class="lineno"></span><span class="op" id="6384467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6384470">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6384520">func</span>&nbsp;<span class="op" id="6384525">(</span><span class="ident" id="6384526">c</span>&nbsp;<span class="op" id="6384528">*</span><span class="ident" id="6384529">common</span><span class="op" id="6384535">)</span>&nbsp;<span class="ident" id="6384537">Errorf</span><span class="op" id="6384543">(</span><span class="ident" id="6384544">format</span>&nbsp;<span class="builtintype" id="6384551">string</span><span class="op" id="6384557">,</span>&nbsp;<span class="ident" id="6384559">args</span>&nbsp;<span class="op" id="6384564">...</span><span class="keyword" id="6384567">interface</span><span class="op" id="6384576">{</span><span class="op" id="6384577">}</span><span class="op" id="6384578">)</span>&nbsp;<span class="op" id="6384580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384583">c</span><span class="op" id="6384584">.</span><span class="ident" id="6384585">log</span><span class="op" id="6384588">(</span><span class="ident" id="6384589">fmt</span><span class="op" id="6384592">.</span><span class="ident" id="6384593">Sprintf</span><span class="op" id="6384600">(</span><span class="ident" id="6384601">format</span><span class="op" id="6384607">,</span>&nbsp;<span class="ident" id="6384609">args</span><span class="op" id="6384613">...</span><span class="op" id="6384616">)</span><span class="op" id="6384617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384620">c</span><span class="op" id="6384621">.</span><span class="ident" id="6384622">Fail</span><span class="op" id="6384626">(</span><span class="op" id="6384627">)</span><br>
<span class="lineno"></span><span class="op" id="6384629">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6384632">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6384683">func</span>&nbsp;<span class="op" id="6384688">(</span><span class="ident" id="6384689">c</span>&nbsp;<span class="op" id="6384691">*</span><span class="ident" id="6384692">common</span><span class="op" id="6384698">)</span>&nbsp;<span class="ident" id="6384700">Fatal</span><span class="op" id="6384705">(</span><span class="ident" id="6384706">args</span>&nbsp;<span class="op" id="6384711">...</span><span class="keyword" id="6384714">interface</span><span class="op" id="6384723">{</span><span class="op" id="6384724">}</span><span class="op" id="6384725">)</span>&nbsp;<span class="op" id="6384727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384730">c</span><span class="op" id="6384731">.</span><span class="ident" id="6384732">log</span><span class="op" id="6384735">(</span><span class="ident" id="6384736">fmt</span><span class="op" id="6384739">.</span><span class="ident" id="6384740">Sprintln</span><span class="op" id="6384748">(</span><span class="ident" id="6384749">args</span><span class="op" id="6384753">...</span><span class="op" id="6384756">)</span><span class="op" id="6384757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384760">c</span><span class="op" id="6384761">.</span><span class="ident" id="6384762">FailNow</span><span class="op" id="6384769">(</span><span class="op" id="6384770">)</span><br>
<span class="lineno">365</span><span class="op" id="6384772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6384775">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6384828">func</span>&nbsp;<span class="op" id="6384833">(</span><span class="ident" id="6384834">c</span>&nbsp;<span class="op" id="6384836">*</span><span class="ident" id="6384837">common</span><span class="op" id="6384843">)</span>&nbsp;<span class="ident" id="6384845">Fatalf</span><span class="op" id="6384851">(</span><span class="ident" id="6384852">format</span>&nbsp;<span class="builtintype" id="6384859">string</span><span class="op" id="6384865">,</span>&nbsp;<span class="ident" id="6384867">args</span>&nbsp;<span class="op" id="6384872">...</span><span class="keyword" id="6384875">interface</span><span class="op" id="6384884">{</span><span class="op" id="6384885">}</span><span class="op" id="6384886">)</span>&nbsp;<span class="op" id="6384888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384891">c</span><span class="op" id="6384892">.</span><span class="ident" id="6384893">log</span><span class="op" id="6384896">(</span><span class="ident" id="6384897">fmt</span><span class="op" id="6384900">.</span><span class="ident" id="6384901">Sprintf</span><span class="op" id="6384908">(</span><span class="ident" id="6384909">format</span><span class="op" id="6384915">,</span>&nbsp;<span class="ident" id="6384917">args</span><span class="op" id="6384921">...</span><span class="op" id="6384924">)</span><span class="op" id="6384925">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384928">c</span><span class="op" id="6384929">.</span><span class="ident" id="6384930">FailNow</span><span class="op" id="6384937">(</span><span class="op" id="6384938">)</span><br>
<span class="lineno"></span><span class="op" id="6384940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6384943">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6384993">func</span>&nbsp;<span class="op" id="6384998">(</span><span class="ident" id="6384999">c</span>&nbsp;<span class="op" id="6385001">*</span><span class="ident" id="6385002">common</span><span class="op" id="6385008">)</span>&nbsp;<span class="ident" id="6385010">Skip</span><span class="op" id="6385014">(</span><span class="ident" id="6385015">args</span>&nbsp;<span class="op" id="6385020">...</span><span class="keyword" id="6385023">interface</span><span class="op" id="6385032">{</span><span class="op" id="6385033">}</span><span class="op" id="6385034">)</span>&nbsp;<span class="op" id="6385036">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385039">c</span><span class="op" id="6385040">.</span><span class="ident" id="6385041">log</span><span class="op" id="6385044">(</span><span class="ident" id="6385045">fmt</span><span class="op" id="6385048">.</span><span class="ident" id="6385049">Sprintln</span><span class="op" id="6385057">(</span><span class="ident" id="6385058">args</span><span class="op" id="6385062">...</span><span class="op" id="6385065">)</span><span class="op" id="6385066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385069">c</span><span class="op" id="6385070">.</span><span class="ident" id="6385071">SkipNow</span><span class="op" id="6385078">(</span><span class="op" id="6385079">)</span><br>
<span class="lineno"></span><span class="op" id="6385081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385084">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6385136">func</span>&nbsp;<span class="op" id="6385141">(</span><span class="ident" id="6385142">c</span>&nbsp;<span class="op" id="6385144">*</span><span class="ident" id="6385145">common</span><span class="op" id="6385151">)</span>&nbsp;<span class="ident" id="6385153">Skipf</span><span class="op" id="6385158">(</span><span class="ident" id="6385159">format</span>&nbsp;<span class="builtintype" id="6385166">string</span><span class="op" id="6385172">,</span>&nbsp;<span class="ident" id="6385174">args</span>&nbsp;<span class="op" id="6385179">...</span><span class="keyword" id="6385182">interface</span><span class="op" id="6385191">{</span><span class="op" id="6385192">}</span><span class="op" id="6385193">)</span>&nbsp;<span class="op" id="6385195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385198">c</span><span class="op" id="6385199">.</span><span class="ident" id="6385200">log</span><span class="op" id="6385203">(</span><span class="ident" id="6385204">fmt</span><span class="op" id="6385207">.</span><span class="ident" id="6385208">Sprintf</span><span class="op" id="6385215">(</span><span class="ident" id="6385216">format</span><span class="op" id="6385222">,</span>&nbsp;<span class="ident" id="6385224">args</span><span class="op" id="6385228">...</span><span class="op" id="6385231">)</span><span class="op" id="6385232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385235">c</span><span class="op" id="6385236">.</span><span class="ident" id="6385237">SkipNow</span><span class="op" id="6385244">(</span><span class="op" id="6385245">)</span><br>
<span class="lineno"></span><span class="op" id="6385247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6385250">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6385324">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6385400">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6385472">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6385547">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6385574">func</span>&nbsp;<span class="op" id="6385579">(</span><span class="ident" id="6385580">c</span>&nbsp;<span class="op" id="6385582">*</span><span class="ident" id="6385583">common</span><span class="op" id="6385589">)</span>&nbsp;<span class="ident" id="6385591">SkipNow</span><span class="op" id="6385598">(</span><span class="op" id="6385599">)</span>&nbsp;<span class="op" id="6385601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385604">c</span><span class="op" id="6385605">.</span><span class="ident" id="6385606">skip</span><span class="op" id="6385610">(</span><span class="op" id="6385611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385614">c</span><span class="op" id="6385615">.</span><span class="ident" id="6385616">finished</span>&nbsp;<span class="op" id="6385625">=</span>&nbsp;<span class="builtintype" id="6385627">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385633">runtime</span><span class="op" id="6385640">.</span><span class="ident" id="6385641">Goexit</span><span class="op" id="6385647">(</span><span class="op" id="6385648">)</span><br>
<span class="lineno"></span><span class="op" id="6385650">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6385653">func</span>&nbsp;<span class="op" id="6385658">(</span><span class="ident" id="6385659">c</span>&nbsp;<span class="op" id="6385661">*</span><span class="ident" id="6385662">common</span><span class="op" id="6385668">)</span>&nbsp;<span class="ident" id="6385670">skip</span><span class="op" id="6385674">(</span><span class="op" id="6385675">)</span>&nbsp;<span class="op" id="6385677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385680">c</span><span class="op" id="6385681">.</span><span class="ident" id="6385682">mu</span><span class="op" id="6385684">.</span><span class="ident" id="6385685">Lock</span><span class="op" id="6385689">(</span><span class="op" id="6385690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385693">defer</span>&nbsp;<span class="ident" id="6385699">c</span><span class="op" id="6385700">.</span><span class="ident" id="6385701">mu</span><span class="op" id="6385703">.</span><span class="ident" id="6385704">Unlock</span><span class="op" id="6385710">(</span><span class="op" id="6385711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385714">c</span><span class="op" id="6385715">.</span><span class="ident" id="6385716">skipped</span>&nbsp;<span class="op" id="6385724">=</span>&nbsp;<span class="builtintype" id="6385726">true</span><br>
<span class="lineno">400</span><span class="op" id="6385731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385734">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6385783">func</span>&nbsp;<span class="op" id="6385788">(</span><span class="ident" id="6385789">c</span>&nbsp;<span class="op" id="6385791">*</span><span class="ident" id="6385792">common</span><span class="op" id="6385798">)</span>&nbsp;<span class="ident" id="6385800">Skipped</span><span class="op" id="6385807">(</span><span class="op" id="6385808">)</span>&nbsp;<span class="builtintype" id="6385810">bool</span>&nbsp;<span class="op" id="6385815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385818">c</span><span class="op" id="6385819">.</span><span class="ident" id="6385820">mu</span><span class="op" id="6385822">.</span><span class="ident" id="6385823">RLock</span><span class="op" id="6385828">(</span><span class="op" id="6385829">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385832">defer</span>&nbsp;<span class="ident" id="6385838">c</span><span class="op" id="6385839">.</span><span class="ident" id="6385840">mu</span><span class="op" id="6385842">.</span><span class="ident" id="6385843">RUnlock</span><span class="op" id="6385850">(</span><span class="op" id="6385851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385854">return</span>&nbsp;<span class="ident" id="6385861">c</span><span class="op" id="6385862">.</span><span class="ident" id="6385863">skipped</span><br>
<span class="lineno"></span><span class="op" id="6385871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385874">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6385955">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6385980">func</span>&nbsp;<span class="op" id="6385985">(</span><span class="ident" id="6385986">t</span>&nbsp;<span class="op" id="6385988">*</span><span class="ident" id="6385989">T</span><span class="op" id="6385990">)</span>&nbsp;<span class="ident" id="6385992">Parallel</span><span class="op" id="6386000">(</span><span class="op" id="6386001">)</span>&nbsp;<span class="op" id="6386003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386006">t</span><span class="op" id="6386007">.</span><span class="ident" id="6386008">signal</span>&nbsp;<span class="op" id="6386015">&lt;-</span>&nbsp;<span class="op" id="6386018">(</span><span class="op" id="6386019">*</span><span class="ident" id="6386020">T</span><span class="op" id="6386021">)</span><span class="op" id="6386022">(</span><span class="ident" id="6386023">nil</span><span class="op" id="6386026">)</span>&nbsp;<span class="comment" id="6386028">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386058">&lt;-</span><span class="ident" id="6386060">t</span><span class="op" id="6386061">.</span><span class="ident" id="6386062">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6386080">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386116">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386191">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386266">t</span><span class="op" id="6386267">.</span><span class="ident" id="6386268">start</span>&nbsp;<span class="op" id="6386274">=</span>&nbsp;<span class="ident" id="6386276">time</span><span class="op" id="6386280">.</span><span class="ident" id="6386281">Now</span><span class="op" id="6386284">(</span><span class="op" id="6386285">)</span><br>
<span class="lineno"></span><span class="op" id="6386287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386290">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6386379">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6386408">type</span>&nbsp;<span class="ident" id="6386413">InternalTest</span>&nbsp;<span class="keyword" id="6386426">struct</span>&nbsp;<span class="op" id="6386433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386436">Name</span>&nbsp;<span class="builtintype" id="6386441">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386449">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386454">func</span><span class="op" id="6386458">(</span><span class="op" id="6386459">*</span><span class="ident" id="6386460">T</span><span class="op" id="6386461">)</span><br>
<span class="lineno"></span><span class="op" id="6386463">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6386466">func</span>&nbsp;<span class="ident" id="6386471">tRunner</span><span class="op" id="6386478">(</span><span class="ident" id="6386479">t</span>&nbsp;<span class="op" id="6386481">*</span><span class="ident" id="6386482">T</span><span class="op" id="6386483">,</span>&nbsp;<span class="ident" id="6386485">test</span>&nbsp;<span class="op" id="6386490">*</span><span class="ident" id="6386491">InternalTest</span><span class="op" id="6386503">)</span>&nbsp;<span class="op" id="6386505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386508">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386566">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386624">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386683">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386726">defer</span>&nbsp;<span class="keyword" id="6386732">func</span><span class="op" id="6386736">(</span><span class="op" id="6386737">)</span>&nbsp;<span class="op" id="6386739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386743">t</span><span class="op" id="6386744">.</span><span class="ident" id="6386745">duration</span>&nbsp;<span class="op" id="6386754">=</span>&nbsp;<span class="ident" id="6386756">time</span><span class="op" id="6386760">.</span><span class="ident" id="6386761">Now</span><span class="op" id="6386764">(</span><span class="op" id="6386765">)</span><span class="op" id="6386766">.</span><span class="ident" id="6386767">Sub</span><span class="op" id="6386770">(</span><span class="ident" id="6386771">t</span><span class="op" id="6386772">.</span><span class="ident" id="6386773">start</span><span class="op" id="6386778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386782">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386845">err</span>&nbsp;<span class="op" id="6386849">:=</span>&nbsp;<span class="builtinfunc" id="6386852">recover</span><span class="op" id="6386859">(</span><span class="op" id="6386860">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386864">if</span>&nbsp;<span class="op" id="6386867">!</span><span class="ident" id="6386868">t</span><span class="op" id="6386869">.</span><span class="ident" id="6386870">finished</span>&nbsp;<span class="op" id="6386879">&amp;&amp;</span>&nbsp;<span class="ident" id="6386882">err</span>&nbsp;<span class="op" id="6386886">==</span>&nbsp;<span class="ident" id="6386889">nil</span>&nbsp;<span class="op" id="6386893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386898">err</span>&nbsp;<span class="op" id="6386902">=</span>&nbsp;<span class="ident" id="6386904">fmt</span><span class="op" id="6386907">.</span><span class="ident" id="6386908">Errorf</span><span class="op" id="6386914">(</span><span class="string" id="6386915">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6386959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386967">if</span>&nbsp;<span class="ident" id="6386970">err</span>&nbsp;<span class="op" id="6386974">!=</span>&nbsp;<span class="ident" id="6386977">nil</span>&nbsp;<span class="op" id="6386981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386986">t</span><span class="op" id="6386987">.</span><span class="ident" id="6386988">Fail</span><span class="op" id="6386992">(</span><span class="op" id="6386993">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386998">t</span><span class="op" id="6386999">.</span><span class="ident" id="6387000">report</span><span class="op" id="6387006">(</span><span class="op" id="6387007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6387012">panic</span><span class="op" id="6387017">(</span><span class="ident" id="6387018">err</span><span class="op" id="6387021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387029">t</span><span class="op" id="6387030">.</span><span class="ident" id="6387031">signal</span>&nbsp;<span class="op" id="6387038">&lt;-</span>&nbsp;<span class="ident" id="6387041">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387044">}</span><span class="op" id="6387045">(</span><span class="op" id="6387046">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387050">t</span><span class="op" id="6387051">.</span><span class="ident" id="6387052">start</span>&nbsp;<span class="op" id="6387058">=</span>&nbsp;<span class="ident" id="6387060">time</span><span class="op" id="6387064">.</span><span class="ident" id="6387065">Now</span><span class="op" id="6387068">(</span><span class="op" id="6387069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387072">test</span><span class="op" id="6387076">.</span><span class="ident" id="6387077">F</span><span class="op" id="6387078">(</span><span class="ident" id="6387079">t</span><span class="op" id="6387080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387083">t</span><span class="op" id="6387084">.</span><span class="ident" id="6387085">finished</span>&nbsp;<span class="op" id="6387094">=</span>&nbsp;<span class="builtintype" id="6387096">true</span><br>
<span class="lineno"></span><span class="op" id="6387101">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6387104">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6387197">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6387226">func</span>&nbsp;<span class="ident" id="6387231">Main</span><span class="op" id="6387235">(</span><span class="ident" id="6387236">matchString</span>&nbsp;<span class="keyword" id="6387248">func</span><span class="op" id="6387252">(</span><span class="ident" id="6387253">pat</span><span class="op" id="6387256">,</span>&nbsp;<span class="ident" id="6387258">str</span>&nbsp;<span class="builtintype" id="6387262">string</span><span class="op" id="6387268">)</span>&nbsp;<span class="op" id="6387270">(</span><span class="builtintype" id="6387271">bool</span><span class="op" id="6387275">,</span>&nbsp;<span class="builtintype" id="6387277">error</span><span class="op" id="6387282">)</span><span class="op" id="6387283">,</span>&nbsp;<span class="ident" id="6387285">tests</span>&nbsp;<span class="op" id="6387291">[</span><span class="op" id="6387292">]</span><span class="ident" id="6387293">InternalTest</span><span class="op" id="6387305">,</span>&nbsp;<span class="ident" id="6387307">benchmarks</span>&nbsp;<span class="op" id="6387318">[</span><span class="op" id="6387319">]</span><span class="ident" id="6387320">InternalBenchmark</span><span class="op" id="6387337">,</span>&nbsp;<span class="ident" id="6387339">examples</span>&nbsp;<span class="op" id="6387348">[</span><span class="op" id="6387349">]</span><span class="ident" id="6387350">InternalExample</span><span class="op" id="6387365">)</span>&nbsp;<span class="op" id="6387367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387370">os</span><span class="op" id="6387372">.</span><span class="ident" id="6387373">Exit</span><span class="op" id="6387377">(</span><span class="ident" id="6387378">MainStart</span><span class="op" id="6387387">(</span><span class="ident" id="6387388">matchString</span><span class="op" id="6387399">,</span>&nbsp;<span class="ident" id="6387401">tests</span><span class="op" id="6387406">,</span>&nbsp;<span class="ident" id="6387408">benchmarks</span><span class="op" id="6387418">,</span>&nbsp;<span class="ident" id="6387420">examples</span><span class="op" id="6387428">)</span><span class="op" id="6387429">.</span><span class="ident" id="6387430">Run</span><span class="op" id="6387433">(</span><span class="op" id="6387434">)</span><span class="op" id="6387435">)</span><br>
<span class="lineno">455</span><span class="op" id="6387437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6387440">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6387510">type</span>&nbsp;<span class="ident" id="6387515">M</span>&nbsp;<span class="keyword" id="6387517">struct</span>&nbsp;<span class="op" id="6387524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387527">matchString</span>&nbsp;<span class="keyword" id="6387539">func</span><span class="op" id="6387543">(</span><span class="ident" id="6387544">pat</span><span class="op" id="6387547">,</span>&nbsp;<span class="ident" id="6387549">str</span>&nbsp;<span class="builtintype" id="6387553">string</span><span class="op" id="6387559">)</span>&nbsp;<span class="op" id="6387561">(</span><span class="builtintype" id="6387562">bool</span><span class="op" id="6387566">,</span>&nbsp;<span class="builtintype" id="6387568">error</span><span class="op" id="6387573">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387576">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387588">[</span><span class="op" id="6387589">]</span><span class="ident" id="6387590">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387604">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6387616">[</span><span class="op" id="6387617">]</span><span class="ident" id="6387618">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387637">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387649">[</span><span class="op" id="6387650">]</span><span class="ident" id="6387651">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6387667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6387670">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6387733">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6387829">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6387881">func</span>&nbsp;<span class="ident" id="6387886">MainStart</span><span class="op" id="6387895">(</span><span class="ident" id="6387896">matchString</span>&nbsp;<span class="keyword" id="6387908">func</span><span class="op" id="6387912">(</span><span class="ident" id="6387913">pat</span><span class="op" id="6387916">,</span>&nbsp;<span class="ident" id="6387918">str</span>&nbsp;<span class="builtintype" id="6387922">string</span><span class="op" id="6387928">)</span>&nbsp;<span class="op" id="6387930">(</span><span class="builtintype" id="6387931">bool</span><span class="op" id="6387935">,</span>&nbsp;<span class="builtintype" id="6387937">error</span><span class="op" id="6387942">)</span><span class="op" id="6387943">,</span>&nbsp;<span class="ident" id="6387945">tests</span>&nbsp;<span class="op" id="6387951">[</span><span class="op" id="6387952">]</span><span class="ident" id="6387953">InternalTest</span><span class="op" id="6387965">,</span>&nbsp;<span class="ident" id="6387967">benchmarks</span>&nbsp;<span class="op" id="6387978">[</span><span class="op" id="6387979">]</span><span class="ident" id="6387980">InternalBenchmark</span><span class="op" id="6387997">,</span>&nbsp;<span class="ident" id="6387999">examples</span>&nbsp;<span class="op" id="6388008">[</span><span class="op" id="6388009">]</span><span class="ident" id="6388010">InternalExample</span><span class="op" id="6388025">)</span>&nbsp;<span class="op" id="6388027">*</span><span class="ident" id="6388028">M</span>&nbsp;<span class="op" id="6388030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388033">return</span>&nbsp;<span class="op" id="6388040">&amp;</span><span class="ident" id="6388041">M</span><span class="op" id="6388042">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388046">matchString</span><span class="op" id="6388057">:</span>&nbsp;<span class="ident" id="6388059">matchString</span><span class="op" id="6388070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388074">tests</span><span class="op" id="6388079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388087">tests</span><span class="op" id="6388092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388096">benchmarks</span><span class="op" id="6388106">:</span>&nbsp;&nbsp;<span class="ident" id="6388109">benchmarks</span><span class="op" id="6388119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388123">examples</span><span class="op" id="6388131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388136">examples</span><span class="op" id="6388144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388147">}</span><br>
<span class="lineno">475</span><span class="op" id="6388149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388152">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6388219">func</span>&nbsp;<span class="op" id="6388224">(</span><span class="ident" id="6388225">m</span>&nbsp;<span class="op" id="6388227">*</span><span class="ident" id="6388228">M</span><span class="op" id="6388229">)</span>&nbsp;<span class="ident" id="6388231">Run</span><span class="op" id="6388234">(</span><span class="op" id="6388235">)</span>&nbsp;<span class="builtintype" id="6388237">int</span>&nbsp;<span class="op" id="6388241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388244">flag</span><span class="op" id="6388248">.</span><span class="ident" id="6388249">Parse</span><span class="op" id="6388254">(</span><span class="op" id="6388255">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388258">parseCpuList</span><span class="op" id="6388270">(</span><span class="op" id="6388271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388275">before</span><span class="op" id="6388281">(</span><span class="op" id="6388282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388285">startAlarm</span><span class="op" id="6388295">(</span><span class="op" id="6388296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388299">haveExamples</span>&nbsp;<span class="op" id="6388312">=</span>&nbsp;<span class="builtinfunc" id="6388314">len</span><span class="op" id="6388317">(</span><span class="ident" id="6388318">m</span><span class="op" id="6388319">.</span><span class="ident" id="6388320">examples</span><span class="op" id="6388328">)</span>&nbsp;<span class="op" id="6388330">&gt;</span>&nbsp;<span class="num" id="6388332">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388335">testOk</span>&nbsp;<span class="op" id="6388342">:=</span>&nbsp;<span class="ident" id="6388345">RunTests</span><span class="op" id="6388353">(</span><span class="ident" id="6388354">m</span><span class="op" id="6388355">.</span><span class="ident" id="6388356">matchString</span><span class="op" id="6388367">,</span>&nbsp;<span class="ident" id="6388369">m</span><span class="op" id="6388370">.</span><span class="ident" id="6388371">tests</span><span class="op" id="6388376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388379">exampleOk</span>&nbsp;<span class="op" id="6388389">:=</span>&nbsp;<span class="ident" id="6388392">RunExamples</span><span class="op" id="6388403">(</span><span class="ident" id="6388404">m</span><span class="op" id="6388405">.</span><span class="ident" id="6388406">matchString</span><span class="op" id="6388417">,</span>&nbsp;<span class="ident" id="6388419">m</span><span class="op" id="6388420">.</span><span class="ident" id="6388421">examples</span><span class="op" id="6388429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388432">stopAlarm</span><span class="op" id="6388441">(</span><span class="op" id="6388442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388445">if</span>&nbsp;<span class="op" id="6388448">!</span><span class="ident" id="6388449">testOk</span>&nbsp;<span class="op" id="6388456">||</span>&nbsp;<span class="op" id="6388459">!</span><span class="ident" id="6388460">exampleOk</span>&nbsp;<span class="op" id="6388470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388474">fmt</span><span class="op" id="6388477">.</span><span class="ident" id="6388478">Println</span><span class="op" id="6388485">(</span><span class="string" id="6388486">&#34;FAIL&#34;</span><span class="op" id="6388492">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388496">after</span><span class="op" id="6388501">(</span><span class="op" id="6388502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388506">return</span>&nbsp;<span class="num" id="6388513">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388519">fmt</span><span class="op" id="6388522">.</span><span class="ident" id="6388523">Println</span><span class="op" id="6388530">(</span><span class="string" id="6388531">&#34;PASS&#34;</span><span class="op" id="6388537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388540">RunBenchmarks</span><span class="op" id="6388553">(</span><span class="ident" id="6388554">m</span><span class="op" id="6388555">.</span><span class="ident" id="6388556">matchString</span><span class="op" id="6388567">,</span>&nbsp;<span class="ident" id="6388569">m</span><span class="op" id="6388570">.</span><span class="ident" id="6388571">benchmarks</span><span class="op" id="6388581">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388584">after</span><span class="op" id="6388589">(</span><span class="op" id="6388590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388593">return</span>&nbsp;<span class="num" id="6388600">0</span><br>
<span class="lineno"></span><span class="op" id="6388602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388605">func</span>&nbsp;<span class="op" id="6388610">(</span><span class="ident" id="6388611">t</span>&nbsp;<span class="op" id="6388613">*</span><span class="ident" id="6388614">T</span><span class="op" id="6388615">)</span>&nbsp;<span class="ident" id="6388617">report</span><span class="op" id="6388623">(</span><span class="op" id="6388624">)</span>&nbsp;<span class="op" id="6388626">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388629">dstr</span>&nbsp;<span class="op" id="6388634">:=</span>&nbsp;<span class="ident" id="6388637">fmtDuration</span><span class="op" id="6388648">(</span><span class="ident" id="6388649">t</span><span class="op" id="6388650">.</span><span class="ident" id="6388651">duration</span><span class="op" id="6388659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388662">format</span>&nbsp;<span class="op" id="6388669">:=</span>&nbsp;<span class="string" id="6388672">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388695">if</span>&nbsp;<span class="ident" id="6388698">t</span><span class="op" id="6388699">.</span><span class="ident" id="6388700">Failed</span><span class="op" id="6388706">(</span><span class="op" id="6388707">)</span>&nbsp;<span class="op" id="6388709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388713">fmt</span><span class="op" id="6388716">.</span><span class="ident" id="6388717">Printf</span><span class="op" id="6388723">(</span><span class="ident" id="6388724">format</span><span class="op" id="6388730">,</span>&nbsp;<span class="string" id="6388732">&#34;FAIL&#34;</span><span class="op" id="6388738">,</span>&nbsp;<span class="ident" id="6388740">t</span><span class="op" id="6388741">.</span><span class="ident" id="6388742">name</span><span class="op" id="6388746">,</span>&nbsp;<span class="ident" id="6388748">dstr</span><span class="op" id="6388752">,</span>&nbsp;<span class="ident" id="6388754">t</span><span class="op" id="6388755">.</span><span class="ident" id="6388756">output</span><span class="op" id="6388762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388765">}</span>&nbsp;<span class="keyword" id="6388767">else</span>&nbsp;<span class="keyword" id="6388772">if</span>&nbsp;<span class="op" id="6388775">*</span><span class="ident" id="6388776">chatty</span>&nbsp;<span class="op" id="6388783">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388787">if</span>&nbsp;<span class="ident" id="6388790">t</span><span class="op" id="6388791">.</span><span class="ident" id="6388792">Skipped</span><span class="op" id="6388799">(</span><span class="op" id="6388800">)</span>&nbsp;<span class="op" id="6388802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388807">fmt</span><span class="op" id="6388810">.</span><span class="ident" id="6388811">Printf</span><span class="op" id="6388817">(</span><span class="ident" id="6388818">format</span><span class="op" id="6388824">,</span>&nbsp;<span class="string" id="6388826">&#34;SKIP&#34;</span><span class="op" id="6388832">,</span>&nbsp;<span class="ident" id="6388834">t</span><span class="op" id="6388835">.</span><span class="ident" id="6388836">name</span><span class="op" id="6388840">,</span>&nbsp;<span class="ident" id="6388842">dstr</span><span class="op" id="6388846">,</span>&nbsp;<span class="ident" id="6388848">t</span><span class="op" id="6388849">.</span><span class="ident" id="6388850">output</span><span class="op" id="6388856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388860">}</span>&nbsp;<span class="keyword" id="6388862">else</span>&nbsp;<span class="op" id="6388867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388872">fmt</span><span class="op" id="6388875">.</span><span class="ident" id="6388876">Printf</span><span class="op" id="6388882">(</span><span class="ident" id="6388883">format</span><span class="op" id="6388889">,</span>&nbsp;<span class="string" id="6388891">&#34;PASS&#34;</span><span class="op" id="6388897">,</span>&nbsp;<span class="ident" id="6388899">t</span><span class="op" id="6388900">.</span><span class="ident" id="6388901">name</span><span class="op" id="6388905">,</span>&nbsp;<span class="ident" id="6388907">dstr</span><span class="op" id="6388911">,</span>&nbsp;<span class="ident" id="6388913">t</span><span class="op" id="6388914">.</span><span class="ident" id="6388915">output</span><span class="op" id="6388921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388925">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388928">}</span><br>
<span class="lineno"></span><span class="op" id="6388930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388933">func</span>&nbsp;<span class="ident" id="6388938">RunTests</span><span class="op" id="6388946">(</span><span class="ident" id="6388947">matchString</span>&nbsp;<span class="keyword" id="6388959">func</span><span class="op" id="6388963">(</span><span class="ident" id="6388964">pat</span><span class="op" id="6388967">,</span>&nbsp;<span class="ident" id="6388969">str</span>&nbsp;<span class="builtintype" id="6388973">string</span><span class="op" id="6388979">)</span>&nbsp;<span class="op" id="6388981">(</span><span class="builtintype" id="6388982">bool</span><span class="op" id="6388986">,</span>&nbsp;<span class="builtintype" id="6388988">error</span><span class="op" id="6388993">)</span><span class="op" id="6388994">,</span>&nbsp;<span class="ident" id="6388996">tests</span>&nbsp;<span class="op" id="6389002">[</span><span class="op" id="6389003">]</span><span class="ident" id="6389004">InternalTest</span><span class="op" id="6389016">)</span>&nbsp;<span class="op" id="6389018">(</span><span class="ident" id="6389019">ok</span>&nbsp;<span class="builtintype" id="6389022">bool</span><span class="op" id="6389026">)</span>&nbsp;<span class="op" id="6389028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389031">ok</span>&nbsp;<span class="op" id="6389034">=</span>&nbsp;<span class="builtintype" id="6389036">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389042">if</span>&nbsp;<span class="builtinfunc" id="6389045">len</span><span class="op" id="6389048">(</span><span class="ident" id="6389049">tests</span><span class="op" id="6389054">)</span>&nbsp;<span class="op" id="6389056">==</span>&nbsp;<span class="num" id="6389059">0</span>&nbsp;<span class="op" id="6389061">&amp;&amp;</span>&nbsp;<span class="op" id="6389064">!</span><span class="ident" id="6389065">haveExamples</span>&nbsp;<span class="op" id="6389078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389082">fmt</span><span class="op" id="6389085">.</span><span class="ident" id="6389086">Fprintln</span><span class="op" id="6389094">(</span><span class="ident" id="6389095">os</span><span class="op" id="6389097">.</span><span class="ident" id="6389098">Stderr</span><span class="op" id="6389104">,</span>&nbsp;<span class="string" id="6389106">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6389141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389156">for</span>&nbsp;<span class="ident" id="6389160">_</span><span class="op" id="6389161">,</span>&nbsp;<span class="ident" id="6389163">procs</span>&nbsp;<span class="op" id="6389169">:=</span>&nbsp;<span class="keyword" id="6389172">range</span>&nbsp;<span class="ident" id="6389178">cpuList</span>&nbsp;<span class="op" id="6389186">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389190">runtime</span><span class="op" id="6389197">.</span><span class="ident" id="6389198">GOMAXPROCS</span><span class="op" id="6389208">(</span><span class="ident" id="6389209">procs</span><span class="op" id="6389214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389218">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389277">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389360">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389433">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389521">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389552">var</span>&nbsp;<span class="ident" id="6389556">collector</span>&nbsp;<span class="op" id="6389566">=</span>&nbsp;<span class="builtinfunc" id="6389568">make</span><span class="op" id="6389572">(</span><span class="keyword" id="6389573">chan</span>&nbsp;<span class="keyword" id="6389578">interface</span><span class="op" id="6389587">{</span><span class="op" id="6389588">}</span><span class="op" id="6389589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389594">numParallel</span>&nbsp;<span class="op" id="6389606">:=</span>&nbsp;<span class="num" id="6389609">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389613">startParallel</span>&nbsp;<span class="op" id="6389627">:=</span>&nbsp;<span class="builtinfunc" id="6389630">make</span><span class="op" id="6389634">(</span><span class="keyword" id="6389635">chan</span>&nbsp;<span class="builtintype" id="6389640">bool</span><span class="op" id="6389644">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389649">for</span>&nbsp;<span class="ident" id="6389653">i</span>&nbsp;<span class="op" id="6389655">:=</span>&nbsp;<span class="num" id="6389658">0</span><span class="op" id="6389659">;</span>&nbsp;<span class="ident" id="6389661">i</span>&nbsp;<span class="op" id="6389663">&lt;</span>&nbsp;<span class="builtinfunc" id="6389665">len</span><span class="op" id="6389668">(</span><span class="ident" id="6389669">tests</span><span class="op" id="6389674">)</span><span class="op" id="6389675">;</span>&nbsp;<span class="ident" id="6389677">i</span><span class="op" id="6389678">++</span>&nbsp;<span class="op" id="6389681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389686">matched</span><span class="op" id="6389693">,</span>&nbsp;<span class="ident" id="6389695">err</span>&nbsp;<span class="op" id="6389699">:=</span>&nbsp;<span class="ident" id="6389702">matchString</span><span class="op" id="6389713">(</span><span class="op" id="6389714">*</span><span class="ident" id="6389715">match</span><span class="op" id="6389720">,</span>&nbsp;<span class="ident" id="6389722">tests</span><span class="op" id="6389727">[</span><span class="ident" id="6389728">i</span><span class="op" id="6389729">]</span><span class="op" id="6389730">.</span><span class="ident" id="6389731">Name</span><span class="op" id="6389735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389740">if</span>&nbsp;<span class="ident" id="6389743">err</span>&nbsp;<span class="op" id="6389747">!=</span>&nbsp;<span class="ident" id="6389750">nil</span>&nbsp;<span class="op" id="6389754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389760">fmt</span><span class="op" id="6389763">.</span><span class="ident" id="6389764">Fprintf</span><span class="op" id="6389771">(</span><span class="ident" id="6389772">os</span><span class="op" id="6389774">.</span><span class="ident" id="6389775">Stderr</span><span class="op" id="6389781">,</span>&nbsp;<span class="string" id="6389783">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6389828">,</span>&nbsp;<span class="ident" id="6389830">err</span><span class="op" id="6389833">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389839">os</span><span class="op" id="6389841">.</span><span class="ident" id="6389842">Exit</span><span class="op" id="6389846">(</span><span class="num" id="6389847">1</span><span class="op" id="6389848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389858">if</span>&nbsp;<span class="op" id="6389861">!</span><span class="ident" id="6389862">matched</span>&nbsp;<span class="op" id="6389870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389876">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389888">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389893">testName</span>&nbsp;<span class="op" id="6389902">:=</span>&nbsp;<span class="ident" id="6389905">tests</span><span class="op" id="6389910">[</span><span class="ident" id="6389911">i</span><span class="op" id="6389912">]</span><span class="op" id="6389913">.</span><span class="ident" id="6389914">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389922">if</span>&nbsp;<span class="ident" id="6389925">procs</span>&nbsp;<span class="op" id="6389931">!=</span>&nbsp;<span class="num" id="6389934">1</span>&nbsp;<span class="op" id="6389936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389942">testName</span>&nbsp;<span class="op" id="6389951">=</span>&nbsp;<span class="ident" id="6389953">fmt</span><span class="op" id="6389956">.</span><span class="ident" id="6389957">Sprintf</span><span class="op" id="6389964">(</span><span class="string" id="6389965">&#34;%s-%d&#34;</span><span class="op" id="6389972">,</span>&nbsp;<span class="ident" id="6389974">tests</span><span class="op" id="6389979">[</span><span class="ident" id="6389980">i</span><span class="op" id="6389981">]</span><span class="op" id="6389982">.</span><span class="ident" id="6389983">Name</span><span class="op" id="6389987">,</span>&nbsp;<span class="ident" id="6389989">procs</span><span class="op" id="6389994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390004">t</span>&nbsp;<span class="op" id="6390006">:=</span>&nbsp;<span class="op" id="6390009">&amp;</span><span class="ident" id="6390010">T</span><span class="op" id="6390011">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390017">common</span><span class="op" id="6390023">:</span>&nbsp;<span class="ident" id="6390025">common</span><span class="op" id="6390031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390038">signal</span><span class="op" id="6390044">:</span>&nbsp;<span class="builtinfunc" id="6390046">make</span><span class="op" id="6390050">(</span><span class="keyword" id="6390051">chan</span>&nbsp;<span class="keyword" id="6390056">interface</span><span class="op" id="6390065">{</span><span class="op" id="6390066">}</span><span class="op" id="6390067">)</span><span class="op" id="6390068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390074">}</span><span class="op" id="6390075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390081">name</span><span class="op" id="6390085">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390096">testName</span><span class="op" id="6390104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390110">startParallel</span><span class="op" id="6390123">:</span>&nbsp;<span class="ident" id="6390125">startParallel</span><span class="op" id="6390138">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390148">t</span><span class="op" id="6390149">.</span><span class="ident" id="6390150">self</span>&nbsp;<span class="op" id="6390155">=</span>&nbsp;<span class="ident" id="6390157">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390162">if</span>&nbsp;<span class="op" id="6390165">*</span><span class="ident" id="6390166">chatty</span>&nbsp;<span class="op" id="6390173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390179">fmt</span><span class="op" id="6390182">.</span><span class="ident" id="6390183">Printf</span><span class="op" id="6390189">(</span><span class="string" id="6390190">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6390204">,</span>&nbsp;<span class="ident" id="6390206">t</span><span class="op" id="6390207">.</span><span class="ident" id="6390208">name</span><span class="op" id="6390212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390217">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390222">go</span>&nbsp;<span class="ident" id="6390225">tRunner</span><span class="op" id="6390232">(</span><span class="ident" id="6390233">t</span><span class="op" id="6390234">,</span>&nbsp;<span class="op" id="6390236">&amp;</span><span class="ident" id="6390237">tests</span><span class="op" id="6390242">[</span><span class="ident" id="6390243">i</span><span class="op" id="6390244">]</span><span class="op" id="6390245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390250">out</span>&nbsp;<span class="op" id="6390254">:=</span>&nbsp;<span class="op" id="6390257">(</span><span class="op" id="6390258">&lt;-</span><span class="ident" id="6390260">t</span><span class="op" id="6390261">.</span><span class="ident" id="6390262">signal</span><span class="op" id="6390268">)</span><span class="op" id="6390269">.</span><span class="op" id="6390270">(</span><span class="op" id="6390271">*</span><span class="ident" id="6390272">T</span><span class="op" id="6390273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390278">if</span>&nbsp;<span class="ident" id="6390281">out</span>&nbsp;<span class="op" id="6390285">==</span>&nbsp;<span class="ident" id="6390288">nil</span>&nbsp;<span class="op" id="6390292">{</span>&nbsp;<span class="comment" id="6390294">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390315">go</span>&nbsp;<span class="keyword" id="6390318">func</span><span class="op" id="6390322">(</span><span class="op" id="6390323">)</span>&nbsp;<span class="op" id="6390325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390332">collector</span>&nbsp;<span class="op" id="6390342">&lt;-</span>&nbsp;<span class="op" id="6390345">&lt;-</span><span class="ident" id="6390347">t</span><span class="op" id="6390348">.</span><span class="ident" id="6390349">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390360">}</span><span class="op" id="6390361">(</span><span class="op" id="6390362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390368">numParallel</span><span class="op" id="6390379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390386">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390403">t</span><span class="op" id="6390404">.</span><span class="ident" id="6390405">report</span><span class="op" id="6390411">(</span><span class="op" id="6390412">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390417">ok</span>&nbsp;<span class="op" id="6390420">=</span>&nbsp;<span class="ident" id="6390422">ok</span>&nbsp;<span class="op" id="6390425">&amp;&amp;</span>&nbsp;<span class="op" id="6390428">!</span><span class="ident" id="6390429">out</span><span class="op" id="6390432">.</span><span class="ident" id="6390433">Failed</span><span class="op" id="6390439">(</span><span class="op" id="6390440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390449">running</span>&nbsp;<span class="op" id="6390457">:=</span>&nbsp;<span class="num" id="6390460">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390464">for</span>&nbsp;<span class="ident" id="6390468">numParallel</span><span class="op" id="6390479">+</span><span class="ident" id="6390480">running</span>&nbsp;<span class="op" id="6390488">&gt;</span>&nbsp;<span class="num" id="6390490">0</span>&nbsp;<span class="op" id="6390492">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390497">if</span>&nbsp;<span class="ident" id="6390500">running</span>&nbsp;<span class="op" id="6390508">&lt;</span>&nbsp;<span class="op" id="6390510">*</span><span class="ident" id="6390511">parallel</span>&nbsp;<span class="op" id="6390520">&amp;&amp;</span>&nbsp;<span class="ident" id="6390523">numParallel</span>&nbsp;<span class="op" id="6390535">&gt;</span>&nbsp;<span class="num" id="6390537">0</span>&nbsp;<span class="op" id="6390539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390545">startParallel</span>&nbsp;<span class="op" id="6390559">&lt;-</span>&nbsp;<span class="builtintype" id="6390562">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390571">running</span><span class="op" id="6390578">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390585">numParallel</span><span class="op" id="6390596">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390603">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390620">t</span>&nbsp;<span class="op" id="6390622">:=</span>&nbsp;<span class="op" id="6390625">(</span><span class="op" id="6390626">&lt;-</span><span class="ident" id="6390628">collector</span><span class="op" id="6390637">)</span><span class="op" id="6390638">.</span><span class="op" id="6390639">(</span><span class="op" id="6390640">*</span><span class="ident" id="6390641">T</span><span class="op" id="6390642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390647">t</span><span class="op" id="6390648">.</span><span class="ident" id="6390649">report</span><span class="op" id="6390655">(</span><span class="op" id="6390656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390661">ok</span>&nbsp;<span class="op" id="6390664">=</span>&nbsp;<span class="ident" id="6390666">ok</span>&nbsp;<span class="op" id="6390669">&amp;&amp;</span>&nbsp;<span class="op" id="6390672">!</span><span class="ident" id="6390673">t</span><span class="op" id="6390674">.</span><span class="ident" id="6390675">Failed</span><span class="op" id="6390681">(</span><span class="op" id="6390682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390687">running</span><span class="op" id="6390694">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390705">return</span><br>
<span class="lineno"></span><span class="op" id="6390712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6390715">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6390750">func</span>&nbsp;<span class="ident" id="6390755">before</span><span class="op" id="6390761">(</span><span class="op" id="6390762">)</span>&nbsp;<span class="op" id="6390764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390767">if</span>&nbsp;<span class="op" id="6390770">*</span><span class="ident" id="6390771">memProfileRate</span>&nbsp;<span class="op" id="6390786">&gt;</span>&nbsp;<span class="num" id="6390788">0</span>&nbsp;<span class="op" id="6390790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390794">runtime</span><span class="op" id="6390801">.</span><span class="ident" id="6390802">MemProfileRate</span>&nbsp;<span class="op" id="6390817">=</span>&nbsp;<span class="op" id="6390819">*</span><span class="ident" id="6390820">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390836">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390839">if</span>&nbsp;<span class="op" id="6390842">*</span><span class="ident" id="6390843">cpuProfile</span>&nbsp;<span class="op" id="6390854">!=</span>&nbsp;<span class="string" id="6390857">&#34;&#34;</span>&nbsp;<span class="op" id="6390860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390864">f</span><span class="op" id="6390865">,</span>&nbsp;<span class="ident" id="6390867">err</span>&nbsp;<span class="op" id="6390871">:=</span>&nbsp;<span class="ident" id="6390874">os</span><span class="op" id="6390876">.</span><span class="ident" id="6390877">Create</span><span class="op" id="6390883">(</span><span class="ident" id="6390884">toOutputDir</span><span class="op" id="6390895">(</span><span class="op" id="6390896">*</span><span class="ident" id="6390897">cpuProfile</span><span class="op" id="6390907">)</span><span class="op" id="6390908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390912">if</span>&nbsp;<span class="ident" id="6390915">err</span>&nbsp;<span class="op" id="6390919">!=</span>&nbsp;<span class="ident" id="6390922">nil</span>&nbsp;<span class="op" id="6390926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390931">fmt</span><span class="op" id="6390934">.</span><span class="ident" id="6390935">Fprintf</span><span class="op" id="6390942">(</span><span class="ident" id="6390943">os</span><span class="op" id="6390945">.</span><span class="ident" id="6390946">Stderr</span><span class="op" id="6390952">,</span>&nbsp;<span class="string" id="6390954">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6390967">,</span>&nbsp;<span class="ident" id="6390969">err</span><span class="op" id="6390972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390977">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390990">if</span>&nbsp;<span class="ident" id="6390993">err</span>&nbsp;<span class="op" id="6390997">:=</span>&nbsp;<span class="ident" id="6391000">pprof</span><span class="op" id="6391005">.</span><span class="ident" id="6391006">StartCPUProfile</span><span class="op" id="6391021">(</span><span class="ident" id="6391022">f</span><span class="op" id="6391023">)</span><span class="op" id="6391024">;</span>&nbsp;<span class="ident" id="6391026">err</span>&nbsp;<span class="op" id="6391030">!=</span>&nbsp;<span class="ident" id="6391033">nil</span>&nbsp;<span class="op" id="6391037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391042">fmt</span><span class="op" id="6391045">.</span><span class="ident" id="6391046">Fprintf</span><span class="op" id="6391053">(</span><span class="ident" id="6391054">os</span><span class="op" id="6391056">.</span><span class="ident" id="6391057">Stderr</span><span class="op" id="6391063">,</span>&nbsp;<span class="string" id="6391065">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6391103">,</span>&nbsp;<span class="ident" id="6391105">err</span><span class="op" id="6391108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391113">f</span><span class="op" id="6391114">.</span><span class="ident" id="6391115">Close</span><span class="op" id="6391120">(</span><span class="op" id="6391121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391126">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391139">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391208">if</span>&nbsp;<span class="op" id="6391211">*</span><span class="ident" id="6391212">blockProfile</span>&nbsp;<span class="op" id="6391225">!=</span>&nbsp;<span class="string" id="6391228">&#34;&#34;</span>&nbsp;<span class="op" id="6391231">&amp;&amp;</span>&nbsp;<span class="op" id="6391234">*</span><span class="ident" id="6391235">blockProfileRate</span>&nbsp;<span class="op" id="6391252">&gt;=</span>&nbsp;<span class="num" id="6391255">0</span>&nbsp;<span class="op" id="6391257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391261">runtime</span><span class="op" id="6391268">.</span><span class="ident" id="6391269">SetBlockProfileRate</span><span class="op" id="6391288">(</span><span class="op" id="6391289">*</span><span class="ident" id="6391290">blockProfileRate</span><span class="op" id="6391306">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391312">if</span>&nbsp;<span class="op" id="6391315">*</span><span class="ident" id="6391316">coverProfile</span>&nbsp;<span class="op" id="6391329">!=</span>&nbsp;<span class="string" id="6391332">&#34;&#34;</span>&nbsp;<span class="op" id="6391335">&amp;&amp;</span>&nbsp;<span class="ident" id="6391338">cover</span><span class="op" id="6391343">.</span><span class="ident" id="6391344">Mode</span>&nbsp;<span class="op" id="6391349">==</span>&nbsp;<span class="string" id="6391352">&#34;&#34;</span>&nbsp;<span class="op" id="6391355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391359">fmt</span><span class="op" id="6391362">.</span><span class="ident" id="6391363">Fprintf</span><span class="op" id="6391370">(</span><span class="ident" id="6391371">os</span><span class="op" id="6391373">.</span><span class="ident" id="6391374">Stderr</span><span class="op" id="6391380">,</span>&nbsp;<span class="string" id="6391382">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6391480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391484">os</span><span class="op" id="6391486">.</span><span class="ident" id="6391487">Exit</span><span class="op" id="6391491">(</span><span class="num" id="6391492">2</span><span class="op" id="6391493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391496">}</span><br>
<span class="lineno">610</span><span class="op" id="6391498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6391501">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6391534">func</span>&nbsp;<span class="ident" id="6391539">after</span><span class="op" id="6391544">(</span><span class="op" id="6391545">)</span>&nbsp;<span class="op" id="6391547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391550">if</span>&nbsp;<span class="op" id="6391553">*</span><span class="ident" id="6391554">cpuProfile</span>&nbsp;<span class="op" id="6391565">!=</span>&nbsp;<span class="string" id="6391568">&#34;&#34;</span>&nbsp;<span class="op" id="6391571">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391575">pprof</span><span class="op" id="6391580">.</span><span class="ident" id="6391581">StopCPUProfile</span><span class="op" id="6391595">(</span><span class="op" id="6391596">)</span>&nbsp;<span class="comment" id="6391598">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391629">if</span>&nbsp;<span class="op" id="6391632">*</span><span class="ident" id="6391633">memProfile</span>&nbsp;<span class="op" id="6391644">!=</span>&nbsp;<span class="string" id="6391647">&#34;&#34;</span>&nbsp;<span class="op" id="6391650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391654">f</span><span class="op" id="6391655">,</span>&nbsp;<span class="ident" id="6391657">err</span>&nbsp;<span class="op" id="6391661">:=</span>&nbsp;<span class="ident" id="6391664">os</span><span class="op" id="6391666">.</span><span class="ident" id="6391667">Create</span><span class="op" id="6391673">(</span><span class="ident" id="6391674">toOutputDir</span><span class="op" id="6391685">(</span><span class="op" id="6391686">*</span><span class="ident" id="6391687">memProfile</span><span class="op" id="6391697">)</span><span class="op" id="6391698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391702">if</span>&nbsp;<span class="ident" id="6391705">err</span>&nbsp;<span class="op" id="6391709">!=</span>&nbsp;<span class="ident" id="6391712">nil</span>&nbsp;<span class="op" id="6391716">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391721">fmt</span><span class="op" id="6391724">.</span><span class="ident" id="6391725">Fprintf</span><span class="op" id="6391732">(</span><span class="ident" id="6391733">os</span><span class="op" id="6391735">.</span><span class="ident" id="6391736">Stderr</span><span class="op" id="6391742">,</span>&nbsp;<span class="string" id="6391744">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6391759">,</span>&nbsp;<span class="ident" id="6391761">err</span><span class="op" id="6391764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391769">os</span><span class="op" id="6391771">.</span><span class="ident" id="6391772">Exit</span><span class="op" id="6391776">(</span><span class="num" id="6391777">2</span><span class="op" id="6391778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391786">runtime</span><span class="op" id="6391793">.</span><span class="ident" id="6391794">GC</span><span class="op" id="6391796">(</span><span class="op" id="6391797">)</span>&nbsp;<span class="comment" id="6391799">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391831">if</span>&nbsp;<span class="ident" id="6391834">err</span>&nbsp;<span class="op" id="6391838">=</span>&nbsp;<span class="ident" id="6391840">pprof</span><span class="op" id="6391845">.</span><span class="ident" id="6391846">WriteHeapProfile</span><span class="op" id="6391862">(</span><span class="ident" id="6391863">f</span><span class="op" id="6391864">)</span><span class="op" id="6391865">;</span>&nbsp;<span class="ident" id="6391867">err</span>&nbsp;<span class="op" id="6391871">!=</span>&nbsp;<span class="ident" id="6391874">nil</span>&nbsp;<span class="op" id="6391878">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391883">fmt</span><span class="op" id="6391886">.</span><span class="ident" id="6391887">Fprintf</span><span class="op" id="6391894">(</span><span class="ident" id="6391895">os</span><span class="op" id="6391897">.</span><span class="ident" id="6391898">Stderr</span><span class="op" id="6391904">,</span>&nbsp;<span class="string" id="6391906">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6391937">,</span>&nbsp;<span class="op" id="6391939">*</span><span class="ident" id="6391940">memProfile</span><span class="op" id="6391950">,</span>&nbsp;<span class="ident" id="6391952">err</span><span class="op" id="6391955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391960">os</span><span class="op" id="6391962">.</span><span class="ident" id="6391963">Exit</span><span class="op" id="6391967">(</span><span class="num" id="6391968">2</span><span class="op" id="6391969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391977">f</span><span class="op" id="6391978">.</span><span class="ident" id="6391979">Close</span><span class="op" id="6391984">(</span><span class="op" id="6391985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391988">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391991">if</span>&nbsp;<span class="op" id="6391994">*</span><span class="ident" id="6391995">blockProfile</span>&nbsp;<span class="op" id="6392008">!=</span>&nbsp;<span class="string" id="6392011">&#34;&#34;</span>&nbsp;<span class="op" id="6392014">&amp;&amp;</span>&nbsp;<span class="op" id="6392017">*</span><span class="ident" id="6392018">blockProfileRate</span>&nbsp;<span class="op" id="6392035">&gt;=</span>&nbsp;<span class="num" id="6392038">0</span>&nbsp;<span class="op" id="6392040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392044">f</span><span class="op" id="6392045">,</span>&nbsp;<span class="ident" id="6392047">err</span>&nbsp;<span class="op" id="6392051">:=</span>&nbsp;<span class="ident" id="6392054">os</span><span class="op" id="6392056">.</span><span class="ident" id="6392057">Create</span><span class="op" id="6392063">(</span><span class="ident" id="6392064">toOutputDir</span><span class="op" id="6392075">(</span><span class="op" id="6392076">*</span><span class="ident" id="6392077">blockProfile</span><span class="op" id="6392089">)</span><span class="op" id="6392090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392094">if</span>&nbsp;<span class="ident" id="6392097">err</span>&nbsp;<span class="op" id="6392101">!=</span>&nbsp;<span class="ident" id="6392104">nil</span>&nbsp;<span class="op" id="6392108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392113">fmt</span><span class="op" id="6392116">.</span><span class="ident" id="6392117">Fprintf</span><span class="op" id="6392124">(</span><span class="ident" id="6392125">os</span><span class="op" id="6392127">.</span><span class="ident" id="6392128">Stderr</span><span class="op" id="6392134">,</span>&nbsp;<span class="string" id="6392136">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6392151">,</span>&nbsp;<span class="ident" id="6392153">err</span><span class="op" id="6392156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392161">os</span><span class="op" id="6392163">.</span><span class="ident" id="6392164">Exit</span><span class="op" id="6392168">(</span><span class="num" id="6392169">2</span><span class="op" id="6392170">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392178">if</span>&nbsp;<span class="ident" id="6392181">err</span>&nbsp;<span class="op" id="6392185">=</span>&nbsp;<span class="ident" id="6392187">pprof</span><span class="op" id="6392192">.</span><span class="ident" id="6392193">Lookup</span><span class="op" id="6392199">(</span><span class="string" id="6392200">&#34;block&#34;</span><span class="op" id="6392207">)</span><span class="op" id="6392208">.</span><span class="ident" id="6392209">WriteTo</span><span class="op" id="6392216">(</span><span class="ident" id="6392217">f</span><span class="op" id="6392218">,</span>&nbsp;<span class="num" id="6392220">0</span><span class="op" id="6392221">)</span><span class="op" id="6392222">;</span>&nbsp;<span class="ident" id="6392224">err</span>&nbsp;<span class="op" id="6392228">!=</span>&nbsp;<span class="ident" id="6392231">nil</span>&nbsp;<span class="op" id="6392235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392240">fmt</span><span class="op" id="6392243">.</span><span class="ident" id="6392244">Fprintf</span><span class="op" id="6392251">(</span><span class="ident" id="6392252">os</span><span class="op" id="6392254">.</span><span class="ident" id="6392255">Stderr</span><span class="op" id="6392261">,</span>&nbsp;<span class="string" id="6392263">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6392294">,</span>&nbsp;<span class="op" id="6392296">*</span><span class="ident" id="6392297">blockProfile</span><span class="op" id="6392309">,</span>&nbsp;<span class="ident" id="6392311">err</span><span class="op" id="6392314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392319">os</span><span class="op" id="6392321">.</span><span class="ident" id="6392322">Exit</span><span class="op" id="6392326">(</span><span class="num" id="6392327">2</span><span class="op" id="6392328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392332">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392336">f</span><span class="op" id="6392337">.</span><span class="ident" id="6392338">Close</span><span class="op" id="6392343">(</span><span class="op" id="6392344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392350">if</span>&nbsp;<span class="ident" id="6392353">cover</span><span class="op" id="6392358">.</span><span class="ident" id="6392359">Mode</span>&nbsp;<span class="op" id="6392364">!=</span>&nbsp;<span class="string" id="6392367">&#34;&#34;</span>&nbsp;<span class="op" id="6392370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392374">coverReport</span><span class="op" id="6392385">(</span><span class="op" id="6392386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392389">}</span><br>
<span class="lineno">645</span><span class="op" id="6392391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392394">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6392469">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6392529">func</span>&nbsp;<span class="ident" id="6392534">toOutputDir</span><span class="op" id="6392545">(</span><span class="ident" id="6392546">path</span>&nbsp;<span class="builtintype" id="6392551">string</span><span class="op" id="6392557">)</span>&nbsp;<span class="builtintype" id="6392559">string</span>&nbsp;<span class="op" id="6392566">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392569">if</span>&nbsp;<span class="op" id="6392572">*</span><span class="ident" id="6392573">outputDir</span>&nbsp;<span class="op" id="6392583">==</span>&nbsp;<span class="string" id="6392586">&#34;&#34;</span>&nbsp;<span class="op" id="6392589">||</span>&nbsp;<span class="ident" id="6392592">path</span>&nbsp;<span class="op" id="6392597">==</span>&nbsp;<span class="string" id="6392600">&#34;&#34;</span>&nbsp;<span class="op" id="6392603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392607">return</span>&nbsp;<span class="ident" id="6392614">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392623">if</span>&nbsp;<span class="ident" id="6392626">runtime</span><span class="op" id="6392633">.</span><span class="ident" id="6392634">GOOS</span>&nbsp;<span class="op" id="6392639">==</span>&nbsp;<span class="string" id="6392642">&#34;windows&#34;</span>&nbsp;<span class="op" id="6392652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392656">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392722">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392775">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392838">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392907">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392966">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393035">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393073">if</span>&nbsp;<span class="builtinfunc" id="6393076">len</span><span class="op" id="6393079">(</span><span class="ident" id="6393080">path</span><span class="op" id="6393084">)</span>&nbsp;<span class="op" id="6393086">&gt;=</span>&nbsp;<span class="num" id="6393089">2</span>&nbsp;<span class="op" id="6393091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393096">letter</span><span class="op" id="6393102">,</span>&nbsp;<span class="ident" id="6393104">colon</span>&nbsp;<span class="op" id="6393110">:=</span>&nbsp;<span class="ident" id="6393113">path</span><span class="op" id="6393117">[</span><span class="num" id="6393118">0</span><span class="op" id="6393119">]</span><span class="op" id="6393120">,</span>&nbsp;<span class="ident" id="6393122">path</span><span class="op" id="6393126">[</span><span class="num" id="6393127">1</span><span class="op" id="6393128">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393133">if</span>&nbsp;<span class="op" id="6393136">(</span><span class="string" id="6393137">&#39;a&#39;</span>&nbsp;<span class="op" id="6393141">&lt;=</span>&nbsp;<span class="ident" id="6393144">letter</span>&nbsp;<span class="op" id="6393151">&amp;&amp;</span>&nbsp;<span class="ident" id="6393154">letter</span>&nbsp;<span class="op" id="6393161">&lt;=</span>&nbsp;<span class="string" id="6393164">&#39;z&#39;</span>&nbsp;<span class="op" id="6393168">||</span>&nbsp;<span class="string" id="6393171">&#39;A&#39;</span>&nbsp;<span class="op" id="6393175">&lt;=</span>&nbsp;<span class="ident" id="6393178">letter</span>&nbsp;<span class="op" id="6393185">&amp;&amp;</span>&nbsp;<span class="ident" id="6393188">letter</span>&nbsp;<span class="op" id="6393195">&lt;=</span>&nbsp;<span class="string" id="6393198">&#39;Z&#39;</span><span class="op" id="6393201">)</span>&nbsp;<span class="op" id="6393203">&amp;&amp;</span>&nbsp;<span class="ident" id="6393206">colon</span>&nbsp;<span class="op" id="6393212">==</span>&nbsp;<span class="string" id="6393215">&#39;:&#39;</span>&nbsp;<span class="op" id="6393219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393225">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393299">return</span>&nbsp;<span class="ident" id="6393306">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393324">if</span>&nbsp;<span class="ident" id="6393327">os</span><span class="op" id="6393329">.</span><span class="ident" id="6393330">IsPathSeparator</span><span class="op" id="6393345">(</span><span class="ident" id="6393346">path</span><span class="op" id="6393350">[</span><span class="num" id="6393351">0</span><span class="op" id="6393352">]</span><span class="op" id="6393353">)</span>&nbsp;<span class="op" id="6393355">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393359">return</span>&nbsp;<span class="ident" id="6393366">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393375">return</span>&nbsp;<span class="ident" id="6393382">fmt</span><span class="op" id="6393385">.</span><span class="ident" id="6393386">Sprintf</span><span class="op" id="6393393">(</span><span class="string" id="6393394">&#34;%s%c%s&#34;</span><span class="op" id="6393402">,</span>&nbsp;<span class="op" id="6393404">*</span><span class="ident" id="6393405">outputDir</span><span class="op" id="6393414">,</span>&nbsp;<span class="ident" id="6393416">os</span><span class="op" id="6393418">.</span><span class="ident" id="6393419">PathSeparator</span><span class="op" id="6393432">,</span>&nbsp;<span class="ident" id="6393434">path</span><span class="op" id="6393438">)</span><br>
<span class="lineno"></span><span class="op" id="6393440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6393443">var</span>&nbsp;<span class="ident" id="6393447">timer</span>&nbsp;<span class="op" id="6393453">*</span><span class="ident" id="6393454">time</span><span class="op" id="6393458">.</span><span class="ident" id="6393459">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393466">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6393510">func</span>&nbsp;<span class="ident" id="6393515">startAlarm</span><span class="op" id="6393525">(</span><span class="op" id="6393526">)</span>&nbsp;<span class="op" id="6393528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393531">if</span>&nbsp;<span class="op" id="6393534">*</span><span class="ident" id="6393535">timeout</span>&nbsp;<span class="op" id="6393543">&gt;</span>&nbsp;<span class="num" id="6393545">0</span>&nbsp;<span class="op" id="6393547">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393551">timer</span>&nbsp;<span class="op" id="6393557">=</span>&nbsp;<span class="ident" id="6393559">time</span><span class="op" id="6393563">.</span><span class="ident" id="6393564">AfterFunc</span><span class="op" id="6393573">(</span><span class="op" id="6393574">*</span><span class="ident" id="6393575">timeout</span><span class="op" id="6393582">,</span>&nbsp;<span class="keyword" id="6393584">func</span><span class="op" id="6393588">(</span><span class="op" id="6393589">)</span>&nbsp;<span class="op" id="6393591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6393596">panic</span><span class="op" id="6393601">(</span><span class="ident" id="6393602">fmt</span><span class="op" id="6393605">.</span><span class="ident" id="6393606">Sprintf</span><span class="op" id="6393613">(</span><span class="string" id="6393614">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6393639">,</span>&nbsp;<span class="op" id="6393641">*</span><span class="ident" id="6393642">timeout</span><span class="op" id="6393649">)</span><span class="op" id="6393650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393654">}</span><span class="op" id="6393655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393658">}</span><br>
<span class="lineno"></span><span class="op" id="6393660">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6393663">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6393697">func</span>&nbsp;<span class="ident" id="6393702">stopAlarm</span><span class="op" id="6393711">(</span><span class="op" id="6393712">)</span>&nbsp;<span class="op" id="6393714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393717">if</span>&nbsp;<span class="op" id="6393720">*</span><span class="ident" id="6393721">timeout</span>&nbsp;<span class="op" id="6393729">&gt;</span>&nbsp;<span class="num" id="6393731">0</span>&nbsp;<span class="op" id="6393733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393737">timer</span><span class="op" id="6393742">.</span><span class="ident" id="6393743">Stop</span><span class="op" id="6393747">(</span><span class="op" id="6393748">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393751">}</span><br>
<span class="lineno"></span><span class="op" id="6393753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6393756">func</span>&nbsp;<span class="ident" id="6393761">parseCpuList</span><span class="op" id="6393773">(</span><span class="op" id="6393774">)</span>&nbsp;<span class="op" id="6393776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393779">for</span>&nbsp;<span class="ident" id="6393783">_</span><span class="op" id="6393784">,</span>&nbsp;<span class="ident" id="6393786">val</span>&nbsp;<span class="op" id="6393790">:=</span>&nbsp;<span class="keyword" id="6393793">range</span>&nbsp;<span class="ident" id="6393799">strings</span><span class="op" id="6393806">.</span><span class="ident" id="6393807">Split</span><span class="op" id="6393812">(</span><span class="op" id="6393813">*</span><span class="ident" id="6393814">cpuListStr</span><span class="op" id="6393824">,</span>&nbsp;<span class="string" id="6393826">&#34;,&#34;</span><span class="op" id="6393829">)</span>&nbsp;<span class="op" id="6393831">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393835">val</span>&nbsp;<span class="op" id="6393839">=</span>&nbsp;<span class="ident" id="6393841">strings</span><span class="op" id="6393848">.</span><span class="ident" id="6393849">TrimSpace</span><span class="op" id="6393858">(</span><span class="ident" id="6393859">val</span><span class="op" id="6393862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393866">if</span>&nbsp;<span class="ident" id="6393869">val</span>&nbsp;<span class="op" id="6393873">==</span>&nbsp;<span class="string" id="6393876">&#34;&#34;</span>&nbsp;<span class="op" id="6393879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393884">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393899">cpu</span><span class="op" id="6393902">,</span>&nbsp;<span class="ident" id="6393904">err</span>&nbsp;<span class="op" id="6393908">:=</span>&nbsp;<span class="ident" id="6393911">strconv</span><span class="op" id="6393918">.</span><span class="ident" id="6393919">Atoi</span><span class="op" id="6393923">(</span><span class="ident" id="6393924">val</span><span class="op" id="6393927">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393931">if</span>&nbsp;<span class="ident" id="6393934">err</span>&nbsp;<span class="op" id="6393938">!=</span>&nbsp;<span class="ident" id="6393941">nil</span>&nbsp;<span class="op" id="6393945">||</span>&nbsp;<span class="ident" id="6393948">cpu</span>&nbsp;<span class="op" id="6393952">&lt;=</span>&nbsp;<span class="num" id="6393955">0</span>&nbsp;<span class="op" id="6393957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393962">fmt</span><span class="op" id="6393965">.</span><span class="ident" id="6393966">Fprintf</span><span class="op" id="6393973">(</span><span class="ident" id="6393974">os</span><span class="op" id="6393976">.</span><span class="ident" id="6393977">Stderr</span><span class="op" id="6393983">,</span>&nbsp;<span class="string" id="6393985">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6394028">,</span>&nbsp;<span class="ident" id="6394030">val</span><span class="op" id="6394033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394038">os</span><span class="op" id="6394040">.</span><span class="ident" id="6394041">Exit</span><span class="op" id="6394045">(</span><span class="num" id="6394046">1</span><span class="op" id="6394047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394055">cpuList</span>&nbsp;<span class="op" id="6394063">=</span>&nbsp;<span class="builtinfunc" id="6394065">append</span><span class="op" id="6394071">(</span><span class="ident" id="6394072">cpuList</span><span class="op" id="6394079">,</span>&nbsp;<span class="ident" id="6394081">cpu</span><span class="op" id="6394084">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394090">if</span>&nbsp;<span class="ident" id="6394093">cpuList</span>&nbsp;<span class="op" id="6394101">==</span>&nbsp;<span class="ident" id="6394104">nil</span>&nbsp;<span class="op" id="6394108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394112">cpuList</span>&nbsp;<span class="op" id="6394120">=</span>&nbsp;<span class="builtinfunc" id="6394122">append</span><span class="op" id="6394128">(</span><span class="ident" id="6394129">cpuList</span><span class="op" id="6394136">,</span>&nbsp;<span class="ident" id="6394138">runtime</span><span class="op" id="6394145">.</span><span class="ident" id="6394146">GOMAXPROCS</span><span class="op" id="6394156">(</span><span class="op" id="6394157">-</span><span class="num" id="6394158">1</span><span class="op" id="6394159">)</span><span class="op" id="6394160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394163">}</span><br>
<span class="lineno"></span><span class="op" id="6394165">}</span>
</div>
</body>
</html>
