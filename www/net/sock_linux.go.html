<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1491101">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1491157">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1491211">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1491262">package</span>&nbsp;<span class="ident" id="1491270">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1491275">import</span>&nbsp;<span class="string" id="1491282">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1491293">func</span>&nbsp;<span class="ident" id="1491298">maxListenerBacklog</span><span class="op" id="1491316">(</span><span class="op" id="1491317">)</span>&nbsp;<span class="builtintype" id="1491319">int</span>&nbsp;<span class="op" id="1491323">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491326">fd</span><span class="op" id="1491328">,</span>&nbsp;<span class="ident" id="1491330">err</span>&nbsp;<span class="op" id="1491334">:=</span>&nbsp;<span class="ident" id="1491337"><a href="/net/parse.go.html#1476797">open</a></span><span class="op" id="1491341">(</span><span class="string" id="1491342">&#34;/proc/sys/net/core/somaxconn&#34;</span><span class="op" id="1491372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491375">if</span>&nbsp;<span class="ident" id="1491378"><a href="/net/sock_linux.go.html#1491330">err</a></span>&nbsp;<span class="op" id="1491382">!=</span>&nbsp;<span class="ident" id="1491385">nil</span>&nbsp;<span class="op" id="1491389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491393">return</span>&nbsp;<span class="ident" id="1491400"><a href="/net/sock_linux.go.html#1491282">syscall</a></span><span class="op" id="1491407">.</span><span class="ident" id="1491408">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491422">defer</span>&nbsp;<span class="ident" id="1491428"><a href="/net/sock_linux.go.html#1491326">fd</a></span><span class="op" id="1491430">.</span><span class="builtinfunc" id="1491431">close</span><span class="op" id="1491436">(</span><span class="op" id="1491437">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491440">l</span><span class="op" id="1491441">,</span>&nbsp;<span class="ident" id="1491443">ok</span>&nbsp;<span class="op" id="1491446">:=</span>&nbsp;<span class="ident" id="1491449"><a href="/net/sock_linux.go.html#1491326">fd</a></span><span class="op" id="1491451">.</span><span class="ident" id="1491452">readLine</span><span class="op" id="1491460">(</span><span class="op" id="1491461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491464">if</span>&nbsp;<span class="op" id="1491467">!</span><span class="ident" id="1491468"><a href="/net/sock_linux.go.html#1491443">ok</a></span>&nbsp;<span class="op" id="1491471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491475">return</span>&nbsp;<span class="ident" id="1491482"><a href="/net/sock_linux.go.html#1491282">syscall</a></span><span class="op" id="1491489">.</span><span class="ident" id="1491490">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491504">f</span>&nbsp;<span class="op" id="1491506">:=</span>&nbsp;<span class="ident" id="1491509"><a href="/net/parse.go.html#1477633">getFields</a></span><span class="op" id="1491518">(</span><span class="ident" id="1491519"><a href="/net/sock_linux.go.html#1491440">l</a></span><span class="op" id="1491520">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491523">n</span><span class="op" id="1491524">,</span>&nbsp;<span class="ident" id="1491526">_</span><span class="op" id="1491527">,</span>&nbsp;<span class="ident" id="1491529"><a href="/net/sock_linux.go.html#1491443">ok</a></span>&nbsp;<span class="op" id="1491532">:=</span>&nbsp;<span class="ident" id="1491535"><a href="/net/parse.go.html#1477870">dtoi</a></span><span class="op" id="1491539">(</span><span class="ident" id="1491540"><a href="/net/sock_linux.go.html#1491504">f</a></span><span class="op" id="1491541">[</span><span class="num" id="1491542">0</span><span class="op" id="1491543">]</span><span class="op" id="1491544">,</span>&nbsp;<span class="num" id="1491546">0</span><span class="op" id="1491547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491550">if</span>&nbsp;<span class="ident" id="1491553"><a href="/net/sock_linux.go.html#1491523">n</a></span>&nbsp;<span class="op" id="1491555">==</span>&nbsp;<span class="num" id="1491558">0</span>&nbsp;<span class="op" id="1491560">||</span>&nbsp;<span class="op" id="1491563">!</span><span class="ident" id="1491564"><a href="/net/sock_linux.go.html#1491443">ok</a></span>&nbsp;<span class="op" id="1491567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491571">return</span>&nbsp;<span class="ident" id="1491578"><a href="/net/sock_linux.go.html#1491282">syscall</a></span><span class="op" id="1491585">.</span><span class="ident" id="1491586">SOMAXCONN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1491600">//&nbsp;Linux&nbsp;stores&nbsp;the&nbsp;backlog&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1491642">//&nbsp;Truncate&nbsp;number&nbsp;to&nbsp;avoid&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1491681">//&nbsp;See&nbsp;issue&nbsp;5030.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491701">if</span>&nbsp;<span class="ident" id="1491704"><a href="/net/sock_linux.go.html#1491523">n</a></span>&nbsp;<span class="op" id="1491706">&gt;</span>&nbsp;<span class="num" id="1491708">1</span><span class="op" id="1491709">&lt;&lt;</span><span class="num" id="1491711">16</span><span class="op" id="1491713">-</span><span class="num" id="1491714">1</span>&nbsp;<span class="op" id="1491716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491720"><a href="/net/sock_linux.go.html#1491523">n</a></span>&nbsp;<span class="op" id="1491722">=</span>&nbsp;<span class="num" id="1491724">1</span><span class="op" id="1491725">&lt;&lt;</span><span class="num" id="1491727">16</span>&nbsp;<span class="op" id="1491730">-</span>&nbsp;<span class="num" id="1491732">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491735">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491738">return</span>&nbsp;<span class="ident" id="1491745"><a href="/net/sock_linux.go.html#1491523">n</a></span><br>
<span class="lineno"></span><span class="op" id="1491747">}</span>
</div>
</body>
</html>
