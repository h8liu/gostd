<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html" class="current">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2458251">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2458306">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2458360">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2458411">package</span>&nbsp;<span class="ident" id="2458419">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2458423">import</span>&nbsp;<span class="string" id="2458430">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2458441">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2458524">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2458570">func</span>&nbsp;<span class="ident" id="2458575">Pipe</span><span class="op" id="2458579">(</span><span class="op" id="2458580">)</span>&nbsp;<span class="op" id="2458582">(</span><span class="ident" id="2458583">r</span>&nbsp;<span class="op" id="2458585">*</span><span class="ident" id="2458586">File</span><span class="op" id="2458590">,</span>&nbsp;<span class="ident" id="2458592">w</span>&nbsp;<span class="op" id="2458594">*</span><span class="ident" id="2458595">File</span><span class="op" id="2458599">,</span>&nbsp;<span class="ident" id="2458601">err</span>&nbsp;<span class="builtintype" id="2458605">error</span><span class="op" id="2458610">)</span>&nbsp;<span class="op" id="2458612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2458615">var</span>&nbsp;<span class="ident" id="2458619">p</span>&nbsp;<span class="op" id="2458621">[</span><span class="num" id="2458622">2</span><span class="op" id="2458623">]</span><span class="builtintype" id="2458624">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2458630">e</span>&nbsp;<span class="op" id="2458632">:=</span>&nbsp;<span class="ident" id="2458635">syscall</span><span class="op" id="2458642">.</span><span class="ident" id="2458643">Pipe2</span><span class="op" id="2458648">(</span><span class="ident" id="2458649">p</span><span class="op" id="2458650">[</span><span class="num" id="2458651">0</span><span class="op" id="2458652">:</span><span class="op" id="2458653">]</span><span class="op" id="2458654">,</span>&nbsp;<span class="ident" id="2458656">syscall</span><span class="op" id="2458663">.</span><span class="ident" id="2458664">O_CLOEXEC</span><span class="op" id="2458673">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2458676">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2458751">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2458781">if</span>&nbsp;<span class="ident" id="2458784">e</span>&nbsp;<span class="op" id="2458786">==</span>&nbsp;<span class="ident" id="2458789">syscall</span><span class="op" id="2458796">.</span><span class="ident" id="2458797">ENOSYS</span>&nbsp;<span class="op" id="2458804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2458808">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2458861">syscall</span><span class="op" id="2458868">.</span><span class="ident" id="2458869">ForkLock</span><span class="op" id="2458877">.</span><span class="ident" id="2458878">RLock</span><span class="op" id="2458883">(</span><span class="op" id="2458884">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2458888">e</span>&nbsp;<span class="op" id="2458890">=</span>&nbsp;<span class="ident" id="2458892">syscall</span><span class="op" id="2458899">.</span><span class="ident" id="2458900">Pipe</span><span class="op" id="2458904">(</span><span class="ident" id="2458905">p</span><span class="op" id="2458906">[</span><span class="num" id="2458907">0</span><span class="op" id="2458908">:</span><span class="op" id="2458909">]</span><span class="op" id="2458910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2458914">if</span>&nbsp;<span class="ident" id="2458917">e</span>&nbsp;<span class="op" id="2458919">!=</span>&nbsp;<span class="builtintype" id="2458922">nil</span>&nbsp;<span class="op" id="2458926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2458931">syscall</span><span class="op" id="2458938">.</span><span class="ident" id="2458939">ForkLock</span><span class="op" id="2458947">.</span><span class="ident" id="2458948">RUnlock</span><span class="op" id="2458955">(</span><span class="op" id="2458956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2458961">return</span>&nbsp;<span class="builtintype" id="2458968">nil</span><span class="op" id="2458971">,</span>&nbsp;<span class="builtintype" id="2458973">nil</span><span class="op" id="2458976">,</span>&nbsp;<span class="ident" id="2458978">NewSyscallError</span><span class="op" id="2458993">(</span><span class="string" id="2458994">&#34;pipe&#34;</span><span class="op" id="2459000">,</span>&nbsp;<span class="ident" id="2459002">e</span><span class="op" id="2459003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2459007">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2459011">syscall</span><span class="op" id="2459018">.</span><span class="ident" id="2459019">CloseOnExec</span><span class="op" id="2459030">(</span><span class="ident" id="2459031">p</span><span class="op" id="2459032">[</span><span class="num" id="2459033">0</span><span class="op" id="2459034">]</span><span class="op" id="2459035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2459039">syscall</span><span class="op" id="2459046">.</span><span class="ident" id="2459047">CloseOnExec</span><span class="op" id="2459058">(</span><span class="ident" id="2459059">p</span><span class="op" id="2459060">[</span><span class="num" id="2459061">1</span><span class="op" id="2459062">]</span><span class="op" id="2459063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2459067">syscall</span><span class="op" id="2459074">.</span><span class="ident" id="2459075">ForkLock</span><span class="op" id="2459083">.</span><span class="ident" id="2459084">RUnlock</span><span class="op" id="2459091">(</span><span class="op" id="2459092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2459095">}</span>&nbsp;<span class="keyword" id="2459097">else</span>&nbsp;<span class="keyword" id="2459102">if</span>&nbsp;<span class="ident" id="2459105">e</span>&nbsp;<span class="op" id="2459107">!=</span>&nbsp;<span class="builtintype" id="2459110">nil</span>&nbsp;<span class="op" id="2459114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2459118">return</span>&nbsp;<span class="builtintype" id="2459125">nil</span><span class="op" id="2459128">,</span>&nbsp;<span class="builtintype" id="2459130">nil</span><span class="op" id="2459133">,</span>&nbsp;<span class="ident" id="2459135">NewSyscallError</span><span class="op" id="2459150">(</span><span class="string" id="2459151">&#34;pipe2&#34;</span><span class="op" id="2459158">,</span>&nbsp;<span class="ident" id="2459160">e</span><span class="op" id="2459161">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2459164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2459168">return</span>&nbsp;<span class="ident" id="2459175">NewFile</span><span class="op" id="2459182">(</span><span class="builtintype" id="2459183">uintptr</span><span class="op" id="2459190">(</span><span class="ident" id="2459191">p</span><span class="op" id="2459192">[</span><span class="num" id="2459193">0</span><span class="op" id="2459194">]</span><span class="op" id="2459195">)</span><span class="op" id="2459196">,</span>&nbsp;<span class="string" id="2459198">&#34;|0&#34;</span><span class="op" id="2459202">)</span><span class="op" id="2459203">,</span>&nbsp;<span class="ident" id="2459205">NewFile</span><span class="op" id="2459212">(</span><span class="builtintype" id="2459213">uintptr</span><span class="op" id="2459220">(</span><span class="ident" id="2459221">p</span><span class="op" id="2459222">[</span><span class="num" id="2459223">1</span><span class="op" id="2459224">]</span><span class="op" id="2459225">)</span><span class="op" id="2459226">,</span>&nbsp;<span class="string" id="2459228">&#34;|1&#34;</span><span class="op" id="2459232">)</span><span class="op" id="2459233">,</span>&nbsp;<span class="builtintype" id="2459235">nil</span><br>
<span class="lineno"></span><span class="op" id="2459239">}</span>
</div>
</body>
</html>
