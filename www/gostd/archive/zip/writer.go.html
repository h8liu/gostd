<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2907903">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2907958">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2908012">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2908063">package</span>&nbsp;<span class="ident" id="2908071">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2908076">import</span>&nbsp;<span class="op" id="2908083">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908086">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908095">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908114">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908124">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908132">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2908146">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="2908151">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2908154">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="2908194">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2908242">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="2908282">type</span>&nbsp;<span class="ident" id="2908287">Writer</span>&nbsp;<span class="keyword" id="2908294">struct</span>&nbsp;<span class="op" id="2908301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908304">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2908311">*</span><span class="ident" id="2908312">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908325">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2908332">[</span><span class="op" id="2908333">]</span><span class="op" id="2908334">*</span><span class="ident" id="2908335">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908343">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2908350">*</span><span class="ident" id="2908351">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908363">closed</span>&nbsp;<span class="builtintype" id="2908370">bool</span><br>
<span class="lineno">25</span><span class="op" id="2908375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2908378">type</span>&nbsp;<span class="ident" id="2908383">header</span>&nbsp;<span class="keyword" id="2908390">struct</span>&nbsp;<span class="op" id="2908397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2908400">*</span><span class="ident" id="2908401">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2908413">offset</span>&nbsp;<span class="ident" id="2908420">uint64</span><br>
<span class="lineno">30</span><span class="op" id="2908427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2908430">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2908489">func</span>&nbsp;<span class="ident" id="2908494">NewWriter</span><span class="op" id="2908503">(</span><span class="ident" id="2908504">w</span>&nbsp;<span class="ident" id="2908506">io</span><span class="op" id="2908508">.</span><span class="ident" id="2908509">Writer</span><span class="op" id="2908515">)</span>&nbsp;<span class="op" id="2908517">*</span><span class="ident" id="2908518">Writer</span>&nbsp;<span class="op" id="2908525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908528">return</span>&nbsp;<span class="op" id="2908535">&amp;</span><span class="ident" id="2908536">Writer</span><span class="op" id="2908542">{</span><span class="ident" id="2908543">cw</span><span class="op" id="2908545">:</span>&nbsp;<span class="op" id="2908547">&amp;</span><span class="ident" id="2908548">countWriter</span><span class="op" id="2908559">{</span><span class="ident" id="2908560">w</span><span class="op" id="2908561">:</span>&nbsp;<span class="ident" id="2908563">bufio</span><span class="op" id="2908568">.</span><span class="ident" id="2908569">NewWriter</span><span class="op" id="2908578">(</span><span class="ident" id="2908579">w</span><span class="op" id="2908580">)</span><span class="op" id="2908581">}</span><span class="op" id="2908582">}</span><br>
<span class="lineno">35</span><span class="op" id="2908584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2908587">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="2908648">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="2908721">func</span>&nbsp;<span class="op" id="2908726">(</span><span class="ident" id="2908727">w</span>&nbsp;<span class="op" id="2908729">*</span><span class="ident" id="2908730">Writer</span><span class="op" id="2908736">)</span>&nbsp;<span class="ident" id="2908738">Flush</span><span class="op" id="2908743">(</span><span class="op" id="2908744">)</span>&nbsp;<span class="builtintype" id="2908746">error</span>&nbsp;<span class="op" id="2908752">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908755">return</span>&nbsp;<span class="ident" id="2908762">w</span><span class="op" id="2908763">.</span><span class="ident" id="2908764">cw</span><span class="op" id="2908766">.</span><span class="ident" id="2908767">w</span><span class="op" id="2908768">.</span><span class="op" id="2908769">(</span><span class="op" id="2908770">*</span><span class="ident" id="2908771">bufio</span><span class="op" id="2908776">.</span><span class="ident" id="2908777">Writer</span><span class="op" id="2908783">)</span><span class="op" id="2908784">.</span><span class="ident" id="2908785">Flush</span><span class="op" id="2908790">(</span><span class="op" id="2908791">)</span><br>
<span class="lineno"></span><span class="op" id="2908793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2908796">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="2908869">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="2908927">func</span>&nbsp;<span class="op" id="2908932">(</span><span class="ident" id="2908933">w</span>&nbsp;<span class="op" id="2908935">*</span><span class="ident" id="2908936">Writer</span><span class="op" id="2908942">)</span>&nbsp;<span class="ident" id="2908944">Close</span><span class="op" id="2908949">(</span><span class="op" id="2908950">)</span>&nbsp;<span class="builtintype" id="2908952">error</span>&nbsp;<span class="op" id="2908958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2908961">if</span>&nbsp;<span class="ident" id="2908964">w</span><span class="op" id="2908965">.</span><span class="ident" id="2908966">last</span>&nbsp;<span class="op" id="2908971">!=</span>&nbsp;<span class="ident" id="2908974">nil</span>&nbsp;<span class="op" id="2908978">&amp;&amp;</span>&nbsp;<span class="op" id="2908981">!</span><span class="ident" id="2908982">w</span><span class="op" id="2908983">.</span><span class="ident" id="2908984">last</span><span class="op" id="2908988">.</span><span class="ident" id="2908989">closed</span>&nbsp;<span class="op" id="2908996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909000">if</span>&nbsp;<span class="ident" id="2909003">err</span>&nbsp;<span class="op" id="2909007">:=</span>&nbsp;<span class="ident" id="2909010">w</span><span class="op" id="2909011">.</span><span class="ident" id="2909012">last</span><span class="op" id="2909016">.</span><span class="builtinfunc" id="2909017">close</span><span class="op" id="2909022">(</span><span class="op" id="2909023">)</span><span class="op" id="2909024">;</span>&nbsp;<span class="ident" id="2909026">err</span>&nbsp;<span class="op" id="2909030">!=</span>&nbsp;<span class="ident" id="2909033">nil</span>&nbsp;<span class="op" id="2909037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909042">return</span>&nbsp;<span class="ident" id="2909049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909055">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909059">w</span><span class="op" id="2909060">.</span><span class="ident" id="2909061">last</span>&nbsp;<span class="op" id="2909066">=</span>&nbsp;<span class="ident" id="2909068">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909076">if</span>&nbsp;<span class="ident" id="2909079">w</span><span class="op" id="2909080">.</span><span class="ident" id="2909081">closed</span>&nbsp;<span class="op" id="2909088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909092">return</span>&nbsp;<span class="ident" id="2909099">errors</span><span class="op" id="2909105">.</span><span class="ident" id="2909106">New</span><span class="op" id="2909109">(</span><span class="string" id="2909110">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="2909136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2909139">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909142">w</span><span class="op" id="2909143">.</span><span class="ident" id="2909144">closed</span>&nbsp;<span class="op" id="2909151">=</span>&nbsp;<span class="builtintype" id="2909153">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909160">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909188">start</span>&nbsp;<span class="op" id="2909194">:=</span>&nbsp;<span class="ident" id="2909197">w</span><span class="op" id="2909198">.</span><span class="ident" id="2909199">cw</span><span class="op" id="2909201">.</span><span class="ident" id="2909202">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909209">for</span>&nbsp;<span class="ident" id="2909213">_</span><span class="op" id="2909214">,</span>&nbsp;<span class="ident" id="2909216">h</span>&nbsp;<span class="op" id="2909218">:=</span>&nbsp;<span class="keyword" id="2909221">range</span>&nbsp;<span class="ident" id="2909227">w</span><span class="op" id="2909228">.</span><span class="ident" id="2909229">dir</span>&nbsp;<span class="op" id="2909233">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909237">var</span>&nbsp;<span class="ident" id="2909241">buf</span>&nbsp;<span class="op" id="2909245">[</span><span class="ident" id="2909246">directoryHeaderLen</span><span class="op" id="2909264">]</span><span class="builtintype" id="2909265">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909272">b</span>&nbsp;<span class="op" id="2909274">:=</span>&nbsp;<span class="ident" id="2909277">writeBuf</span><span class="op" id="2909285">(</span><span class="ident" id="2909286">buf</span><span class="op" id="2909289">[</span><span class="op" id="2909290">:</span><span class="op" id="2909291">]</span><span class="op" id="2909292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909296">b</span><span class="op" id="2909297">.</span><span class="builtintype" id="2909298">uint32</span><span class="op" id="2909304">(</span><span class="builtintype" id="2909305">uint32</span><span class="op" id="2909311">(</span><span class="ident" id="2909312">directoryHeaderSignature</span><span class="op" id="2909336">)</span><span class="op" id="2909337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909341">b</span><span class="op" id="2909342">.</span><span class="builtintype" id="2909343">uint16</span><span class="op" id="2909349">(</span><span class="ident" id="2909350">h</span><span class="op" id="2909351">.</span><span class="ident" id="2909352">CreatorVersion</span><span class="op" id="2909366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909370">b</span><span class="op" id="2909371">.</span><span class="builtintype" id="2909372">uint16</span><span class="op" id="2909378">(</span><span class="ident" id="2909379">h</span><span class="op" id="2909380">.</span><span class="ident" id="2909381">ReaderVersion</span><span class="op" id="2909394">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909398">b</span><span class="op" id="2909399">.</span><span class="builtintype" id="2909400">uint16</span><span class="op" id="2909406">(</span><span class="ident" id="2909407">h</span><span class="op" id="2909408">.</span><span class="ident" id="2909409">Flags</span><span class="op" id="2909414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909418">b</span><span class="op" id="2909419">.</span><span class="builtintype" id="2909420">uint16</span><span class="op" id="2909426">(</span><span class="ident" id="2909427">h</span><span class="op" id="2909428">.</span><span class="ident" id="2909429">Method</span><span class="op" id="2909435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909439">b</span><span class="op" id="2909440">.</span><span class="builtintype" id="2909441">uint16</span><span class="op" id="2909447">(</span><span class="ident" id="2909448">h</span><span class="op" id="2909449">.</span><span class="ident" id="2909450">ModifiedTime</span><span class="op" id="2909462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909466">b</span><span class="op" id="2909467">.</span><span class="builtintype" id="2909468">uint16</span><span class="op" id="2909474">(</span><span class="ident" id="2909475">h</span><span class="op" id="2909476">.</span><span class="ident" id="2909477">ModifiedDate</span><span class="op" id="2909489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909493">b</span><span class="op" id="2909494">.</span><span class="builtintype" id="2909495">uint32</span><span class="op" id="2909501">(</span><span class="ident" id="2909502">h</span><span class="op" id="2909503">.</span><span class="ident" id="2909504">CRC32</span><span class="op" id="2909509">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909513">if</span>&nbsp;<span class="ident" id="2909516">h</span><span class="op" id="2909517">.</span><span class="ident" id="2909518">isZip64</span><span class="op" id="2909525">(</span><span class="op" id="2909526">)</span>&nbsp;<span class="op" id="2909528">||</span>&nbsp;<span class="ident" id="2909531">h</span><span class="op" id="2909532">.</span><span class="ident" id="2909533">offset</span>&nbsp;<span class="op" id="2909540">&gt;</span>&nbsp;<span class="ident" id="2909542">uint32max</span>&nbsp;<span class="op" id="2909552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909557">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909615">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909678">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909719">b</span><span class="op" id="2909720">.</span><span class="builtintype" id="2909721">uint32</span><span class="op" id="2909727">(</span><span class="ident" id="2909728">uint32max</span><span class="op" id="2909737">)</span>&nbsp;<span class="comment" id="2909739">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909761">b</span><span class="op" id="2909762">.</span><span class="builtintype" id="2909763">uint32</span><span class="op" id="2909769">(</span><span class="ident" id="2909770">uint32max</span><span class="op" id="2909779">)</span>&nbsp;<span class="comment" id="2909781">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2909806">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2909848">var</span>&nbsp;<span class="ident" id="2909852">buf</span>&nbsp;<span class="op" id="2909856">[</span><span class="num" id="2909857">28</span><span class="op" id="2909859">]</span><span class="builtintype" id="2909860">byte</span>&nbsp;<span class="comment" id="2909865">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909893">eb</span>&nbsp;<span class="op" id="2909896">:=</span>&nbsp;<span class="ident" id="2909899">writeBuf</span><span class="op" id="2909907">(</span><span class="ident" id="2909908">buf</span><span class="op" id="2909911">[</span><span class="op" id="2909912">:</span><span class="op" id="2909913">]</span><span class="op" id="2909914">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909919">eb</span><span class="op" id="2909921">.</span><span class="builtintype" id="2909922">uint16</span><span class="op" id="2909928">(</span><span class="ident" id="2909929">zip64ExtraId</span><span class="op" id="2909941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909946">eb</span><span class="op" id="2909948">.</span><span class="builtintype" id="2909949">uint16</span><span class="op" id="2909955">(</span><span class="num" id="2909956">24</span><span class="op" id="2909958">)</span>&nbsp;<span class="comment" id="2909960">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2909983">eb</span><span class="op" id="2909985">.</span><span class="ident" id="2909986">uint64</span><span class="op" id="2909992">(</span><span class="ident" id="2909993">h</span><span class="op" id="2909994">.</span><span class="ident" id="2909995">UncompressedSize64</span><span class="op" id="2910013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910018">eb</span><span class="op" id="2910020">.</span><span class="ident" id="2910021">uint64</span><span class="op" id="2910027">(</span><span class="ident" id="2910028">h</span><span class="op" id="2910029">.</span><span class="ident" id="2910030">CompressedSize64</span><span class="op" id="2910046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910051">eb</span><span class="op" id="2910053">.</span><span class="ident" id="2910054">uint64</span><span class="op" id="2910060">(</span><span class="ident" id="2910061">h</span><span class="op" id="2910062">.</span><span class="ident" id="2910063">offset</span><span class="op" id="2910069">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910074">h</span><span class="op" id="2910075">.</span><span class="ident" id="2910076">Extra</span>&nbsp;<span class="op" id="2910082">=</span>&nbsp;<span class="builtinfunc" id="2910084">append</span><span class="op" id="2910090">(</span><span class="ident" id="2910091">h</span><span class="op" id="2910092">.</span><span class="ident" id="2910093">Extra</span><span class="op" id="2910098">,</span>&nbsp;<span class="ident" id="2910100">buf</span><span class="op" id="2910103">[</span><span class="op" id="2910104">:</span><span class="op" id="2910105">]</span><span class="op" id="2910106">...</span><span class="op" id="2910109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910113">}</span>&nbsp;<span class="keyword" id="2910115">else</span>&nbsp;<span class="op" id="2910120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910125">b</span><span class="op" id="2910126">.</span><span class="builtintype" id="2910127">uint32</span><span class="op" id="2910133">(</span><span class="ident" id="2910134">h</span><span class="op" id="2910135">.</span><span class="ident" id="2910136">CompressedSize</span><span class="op" id="2910150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910155">b</span><span class="op" id="2910156">.</span><span class="builtintype" id="2910157">uint32</span><span class="op" id="2910163">(</span><span class="ident" id="2910164">h</span><span class="op" id="2910165">.</span><span class="ident" id="2910166">UncompressedSize</span><span class="op" id="2910182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910186">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910190">b</span><span class="op" id="2910191">.</span><span class="builtintype" id="2910192">uint16</span><span class="op" id="2910198">(</span><span class="builtintype" id="2910199">uint16</span><span class="op" id="2910205">(</span><span class="builtinfunc" id="2910206">len</span><span class="op" id="2910209">(</span><span class="ident" id="2910210">h</span><span class="op" id="2910211">.</span><span class="ident" id="2910212">Name</span><span class="op" id="2910216">)</span><span class="op" id="2910217">)</span><span class="op" id="2910218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910222">b</span><span class="op" id="2910223">.</span><span class="builtintype" id="2910224">uint16</span><span class="op" id="2910230">(</span><span class="builtintype" id="2910231">uint16</span><span class="op" id="2910237">(</span><span class="builtinfunc" id="2910238">len</span><span class="op" id="2910241">(</span><span class="ident" id="2910242">h</span><span class="op" id="2910243">.</span><span class="ident" id="2910244">Extra</span><span class="op" id="2910249">)</span><span class="op" id="2910250">)</span><span class="op" id="2910251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910255">b</span><span class="op" id="2910256">.</span><span class="builtintype" id="2910257">uint16</span><span class="op" id="2910263">(</span><span class="builtintype" id="2910264">uint16</span><span class="op" id="2910270">(</span><span class="builtinfunc" id="2910271">len</span><span class="op" id="2910274">(</span><span class="ident" id="2910275">h</span><span class="op" id="2910276">.</span><span class="ident" id="2910277">Comment</span><span class="op" id="2910284">)</span><span class="op" id="2910285">)</span><span class="op" id="2910286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910290">b</span>&nbsp;<span class="op" id="2910292">=</span>&nbsp;<span class="ident" id="2910294">b</span><span class="op" id="2910295">[</span><span class="num" id="2910296">4</span><span class="op" id="2910297">:</span><span class="op" id="2910298">]</span>&nbsp;<span class="comment" id="2910300">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910363">b</span><span class="op" id="2910364">.</span><span class="builtintype" id="2910365">uint32</span><span class="op" id="2910371">(</span><span class="ident" id="2910372">h</span><span class="op" id="2910373">.</span><span class="ident" id="2910374">ExternalAttrs</span><span class="op" id="2910387">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910391">if</span>&nbsp;<span class="ident" id="2910394">h</span><span class="op" id="2910395">.</span><span class="ident" id="2910396">offset</span>&nbsp;<span class="op" id="2910403">&gt;</span>&nbsp;<span class="ident" id="2910405">uint32max</span>&nbsp;<span class="op" id="2910415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910420">b</span><span class="op" id="2910421">.</span><span class="builtintype" id="2910422">uint32</span><span class="op" id="2910428">(</span><span class="ident" id="2910429">uint32max</span><span class="op" id="2910438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910442">}</span>&nbsp;<span class="keyword" id="2910444">else</span>&nbsp;<span class="op" id="2910449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910454">b</span><span class="op" id="2910455">.</span><span class="builtintype" id="2910456">uint32</span><span class="op" id="2910462">(</span><span class="builtintype" id="2910463">uint32</span><span class="op" id="2910469">(</span><span class="ident" id="2910470">h</span><span class="op" id="2910471">.</span><span class="ident" id="2910472">offset</span><span class="op" id="2910478">)</span><span class="op" id="2910479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910483">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910487">if</span>&nbsp;<span class="ident" id="2910490">_</span><span class="op" id="2910491">,</span>&nbsp;<span class="ident" id="2910493">err</span>&nbsp;<span class="op" id="2910497">:=</span>&nbsp;<span class="ident" id="2910500">w</span><span class="op" id="2910501">.</span><span class="ident" id="2910502">cw</span><span class="op" id="2910504">.</span><span class="ident" id="2910505">Write</span><span class="op" id="2910510">(</span><span class="ident" id="2910511">buf</span><span class="op" id="2910514">[</span><span class="op" id="2910515">:</span><span class="op" id="2910516">]</span><span class="op" id="2910517">)</span><span class="op" id="2910518">;</span>&nbsp;<span class="ident" id="2910520">err</span>&nbsp;<span class="op" id="2910524">!=</span>&nbsp;<span class="ident" id="2910527">nil</span>&nbsp;<span class="op" id="2910531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910536">return</span>&nbsp;<span class="ident" id="2910543">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910553">if</span>&nbsp;<span class="ident" id="2910556">_</span><span class="op" id="2910557">,</span>&nbsp;<span class="ident" id="2910559">err</span>&nbsp;<span class="op" id="2910563">:=</span>&nbsp;<span class="ident" id="2910566">io</span><span class="op" id="2910568">.</span><span class="ident" id="2910569">WriteString</span><span class="op" id="2910580">(</span><span class="ident" id="2910581">w</span><span class="op" id="2910582">.</span><span class="ident" id="2910583">cw</span><span class="op" id="2910585">,</span>&nbsp;<span class="ident" id="2910587">h</span><span class="op" id="2910588">.</span><span class="ident" id="2910589">Name</span><span class="op" id="2910593">)</span><span class="op" id="2910594">;</span>&nbsp;<span class="ident" id="2910596">err</span>&nbsp;<span class="op" id="2910600">!=</span>&nbsp;<span class="ident" id="2910603">nil</span>&nbsp;<span class="op" id="2910607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910612">return</span>&nbsp;<span class="ident" id="2910619">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910629">if</span>&nbsp;<span class="ident" id="2910632">_</span><span class="op" id="2910633">,</span>&nbsp;<span class="ident" id="2910635">err</span>&nbsp;<span class="op" id="2910639">:=</span>&nbsp;<span class="ident" id="2910642">w</span><span class="op" id="2910643">.</span><span class="ident" id="2910644">cw</span><span class="op" id="2910646">.</span><span class="ident" id="2910647">Write</span><span class="op" id="2910652">(</span><span class="ident" id="2910653">h</span><span class="op" id="2910654">.</span><span class="ident" id="2910655">Extra</span><span class="op" id="2910660">)</span><span class="op" id="2910661">;</span>&nbsp;<span class="ident" id="2910663">err</span>&nbsp;<span class="op" id="2910667">!=</span>&nbsp;<span class="ident" id="2910670">nil</span>&nbsp;<span class="op" id="2910674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910679">return</span>&nbsp;<span class="ident" id="2910686">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910696">if</span>&nbsp;<span class="ident" id="2910699">_</span><span class="op" id="2910700">,</span>&nbsp;<span class="ident" id="2910702">err</span>&nbsp;<span class="op" id="2910706">:=</span>&nbsp;<span class="ident" id="2910709">io</span><span class="op" id="2910711">.</span><span class="ident" id="2910712">WriteString</span><span class="op" id="2910723">(</span><span class="ident" id="2910724">w</span><span class="op" id="2910725">.</span><span class="ident" id="2910726">cw</span><span class="op" id="2910728">,</span>&nbsp;<span class="ident" id="2910730">h</span><span class="op" id="2910731">.</span><span class="ident" id="2910732">Comment</span><span class="op" id="2910739">)</span><span class="op" id="2910740">;</span>&nbsp;<span class="ident" id="2910742">err</span>&nbsp;<span class="op" id="2910746">!=</span>&nbsp;<span class="ident" id="2910749">nil</span>&nbsp;<span class="op" id="2910753">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910758">return</span>&nbsp;<span class="ident" id="2910765">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2910774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910777">end</span>&nbsp;<span class="op" id="2910781">:=</span>&nbsp;<span class="ident" id="2910784">w</span><span class="op" id="2910785">.</span><span class="ident" id="2910786">cw</span><span class="op" id="2910788">.</span><span class="ident" id="2910789">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910797">records</span>&nbsp;<span class="op" id="2910805">:=</span>&nbsp;<span class="ident" id="2910808">uint64</span><span class="op" id="2910814">(</span><span class="builtinfunc" id="2910815">len</span><span class="op" id="2910818">(</span><span class="ident" id="2910819">w</span><span class="op" id="2910820">.</span><span class="ident" id="2910821">dir</span><span class="op" id="2910824">)</span><span class="op" id="2910825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910828">size</span>&nbsp;<span class="op" id="2910833">:=</span>&nbsp;<span class="ident" id="2910836">uint64</span><span class="op" id="2910842">(</span><span class="ident" id="2910843">end</span>&nbsp;<span class="op" id="2910847">-</span>&nbsp;<span class="ident" id="2910849">start</span><span class="op" id="2910854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2910857">offset</span>&nbsp;<span class="op" id="2910864">:=</span>&nbsp;<span class="ident" id="2910867">uint64</span><span class="op" id="2910873">(</span><span class="ident" id="2910874">start</span><span class="op" id="2910879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910883">if</span>&nbsp;<span class="ident" id="2910886">records</span>&nbsp;<span class="op" id="2910894">&gt;</span>&nbsp;<span class="ident" id="2910896">uint16max</span>&nbsp;<span class="op" id="2910906">||</span>&nbsp;<span class="ident" id="2910909">size</span>&nbsp;<span class="op" id="2910914">&gt;</span>&nbsp;<span class="ident" id="2910916">uint32max</span>&nbsp;<span class="op" id="2910926">||</span>&nbsp;<span class="ident" id="2910929">offset</span>&nbsp;<span class="op" id="2910936">&gt;</span>&nbsp;<span class="ident" id="2910938">uint32max</span>&nbsp;<span class="op" id="2910948">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2910952">var</span>&nbsp;<span class="ident" id="2910956">buf</span>&nbsp;<span class="op" id="2910960">[</span><span class="ident" id="2910961">directory64EndLen</span>&nbsp;<span class="op" id="2910979">+</span>&nbsp;<span class="ident" id="2910981">directory64LocLen</span><span class="op" id="2910998">]</span><span class="builtintype" id="2910999">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911006">b</span>&nbsp;<span class="op" id="2911008">:=</span>&nbsp;<span class="ident" id="2911011">writeBuf</span><span class="op" id="2911019">(</span><span class="ident" id="2911020">buf</span><span class="op" id="2911023">[</span><span class="op" id="2911024">:</span><span class="op" id="2911025">]</span><span class="op" id="2911026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911031">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911074">b</span><span class="op" id="2911075">.</span><span class="builtintype" id="2911076">uint32</span><span class="op" id="2911082">(</span><span class="ident" id="2911083">directory64EndSignature</span><span class="op" id="2911106">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911110">b</span><span class="op" id="2911111">.</span><span class="ident" id="2911112">uint64</span><span class="op" id="2911118">(</span><span class="ident" id="2911119">directory64EndLen</span><span class="op" id="2911136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911140">b</span><span class="op" id="2911141">.</span><span class="builtintype" id="2911142">uint16</span><span class="op" id="2911148">(</span><span class="ident" id="2911149">zipVersion45</span><span class="op" id="2911161">)</span>&nbsp;<span class="comment" id="2911163">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911184">b</span><span class="op" id="2911185">.</span><span class="builtintype" id="2911186">uint16</span><span class="op" id="2911192">(</span><span class="ident" id="2911193">zipVersion45</span><span class="op" id="2911205">)</span>&nbsp;<span class="comment" id="2911207">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911238">b</span><span class="op" id="2911239">.</span><span class="builtintype" id="2911240">uint32</span><span class="op" id="2911246">(</span><span class="num" id="2911247">0</span><span class="op" id="2911248">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911261">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911286">b</span><span class="op" id="2911287">.</span><span class="builtintype" id="2911288">uint32</span><span class="op" id="2911294">(</span><span class="num" id="2911295">0</span><span class="op" id="2911296">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911309">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911373">b</span><span class="op" id="2911374">.</span><span class="ident" id="2911375">uint64</span><span class="op" id="2911381">(</span><span class="ident" id="2911382">records</span><span class="op" id="2911389">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911396">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911463">b</span><span class="op" id="2911464">.</span><span class="ident" id="2911465">uint64</span><span class="op" id="2911471">(</span><span class="ident" id="2911472">records</span><span class="op" id="2911479">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911486">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911540">b</span><span class="op" id="2911541">.</span><span class="ident" id="2911542">uint64</span><span class="op" id="2911548">(</span><span class="ident" id="2911549">size</span><span class="op" id="2911553">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911563">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911598">b</span><span class="op" id="2911599">.</span><span class="ident" id="2911600">uint64</span><span class="op" id="2911606">(</span><span class="ident" id="2911607">offset</span><span class="op" id="2911613">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911621">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2911705">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911749">b</span><span class="op" id="2911750">.</span><span class="builtintype" id="2911751">uint32</span><span class="op" id="2911757">(</span><span class="ident" id="2911758">directory64LocSignature</span><span class="op" id="2911781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911785">b</span><span class="op" id="2911786">.</span><span class="builtintype" id="2911787">uint32</span><span class="op" id="2911793">(</span><span class="num" id="2911794">0</span><span class="op" id="2911795">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911807">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911884">b</span><span class="op" id="2911885">.</span><span class="ident" id="2911886">uint64</span><span class="op" id="2911892">(</span><span class="ident" id="2911893">uint64</span><span class="op" id="2911899">(</span><span class="ident" id="2911900">end</span><span class="op" id="2911903">)</span><span class="op" id="2911904">)</span>&nbsp;<span class="comment" id="2911906">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2911972">b</span><span class="op" id="2911973">.</span><span class="builtintype" id="2911974">uint32</span><span class="op" id="2911980">(</span><span class="num" id="2911981">1</span><span class="op" id="2911982">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2911994">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912022">if</span>&nbsp;<span class="ident" id="2912025">_</span><span class="op" id="2912026">,</span>&nbsp;<span class="ident" id="2912028">err</span>&nbsp;<span class="op" id="2912032">:=</span>&nbsp;<span class="ident" id="2912035">w</span><span class="op" id="2912036">.</span><span class="ident" id="2912037">cw</span><span class="op" id="2912039">.</span><span class="ident" id="2912040">Write</span><span class="op" id="2912045">(</span><span class="ident" id="2912046">buf</span><span class="op" id="2912049">[</span><span class="op" id="2912050">:</span><span class="op" id="2912051">]</span><span class="op" id="2912052">)</span><span class="op" id="2912053">;</span>&nbsp;<span class="ident" id="2912055">err</span>&nbsp;<span class="op" id="2912059">!=</span>&nbsp;<span class="ident" id="2912062">nil</span>&nbsp;<span class="op" id="2912066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912071">return</span>&nbsp;<span class="ident" id="2912078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912089">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912152">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912202">records</span>&nbsp;<span class="op" id="2912210">=</span>&nbsp;<span class="ident" id="2912212">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912224">size</span>&nbsp;<span class="op" id="2912229">=</span>&nbsp;<span class="ident" id="2912231">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912243">offset</span>&nbsp;<span class="op" id="2912250">=</span>&nbsp;<span class="ident" id="2912252">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912267">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912288">var</span>&nbsp;<span class="ident" id="2912292">buf</span>&nbsp;<span class="op" id="2912296">[</span><span class="ident" id="2912297">directoryEndLen</span><span class="op" id="2912312">]</span><span class="builtintype" id="2912313">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912319">b</span>&nbsp;<span class="op" id="2912321">:=</span>&nbsp;<span class="ident" id="2912324">writeBuf</span><span class="op" id="2912332">(</span><span class="ident" id="2912333">buf</span><span class="op" id="2912336">[</span><span class="op" id="2912337">:</span><span class="op" id="2912338">]</span><span class="op" id="2912339">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912342">b</span><span class="op" id="2912343">.</span><span class="builtintype" id="2912344">uint32</span><span class="op" id="2912350">(</span><span class="builtintype" id="2912351">uint32</span><span class="op" id="2912357">(</span><span class="ident" id="2912358">directoryEndSignature</span><span class="op" id="2912379">)</span><span class="op" id="2912380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912383">b</span>&nbsp;<span class="op" id="2912385">=</span>&nbsp;<span class="ident" id="2912387">b</span><span class="op" id="2912388">[</span><span class="num" id="2912389">4</span><span class="op" id="2912390">:</span><span class="op" id="2912391">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2912409">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912469">b</span><span class="op" id="2912470">.</span><span class="builtintype" id="2912471">uint16</span><span class="op" id="2912477">(</span><span class="builtintype" id="2912478">uint16</span><span class="op" id="2912484">(</span><span class="ident" id="2912485">records</span><span class="op" id="2912492">)</span><span class="op" id="2912493">)</span>&nbsp;<span class="comment" id="2912495">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912527">b</span><span class="op" id="2912528">.</span><span class="builtintype" id="2912529">uint16</span><span class="op" id="2912535">(</span><span class="builtintype" id="2912536">uint16</span><span class="op" id="2912542">(</span><span class="ident" id="2912543">records</span><span class="op" id="2912550">)</span><span class="op" id="2912551">)</span>&nbsp;<span class="comment" id="2912553">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912581">b</span><span class="op" id="2912582">.</span><span class="builtintype" id="2912583">uint32</span><span class="op" id="2912589">(</span><span class="builtintype" id="2912590">uint32</span><span class="op" id="2912596">(</span><span class="ident" id="2912597">size</span><span class="op" id="2912601">)</span><span class="op" id="2912602">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2912607">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2912629">b</span><span class="op" id="2912630">.</span><span class="builtintype" id="2912631">uint32</span><span class="op" id="2912637">(</span><span class="builtintype" id="2912638">uint32</span><span class="op" id="2912644">(</span><span class="ident" id="2912645">offset</span><span class="op" id="2912651">)</span><span class="op" id="2912652">)</span>&nbsp;&nbsp;<span class="comment" id="2912655">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2912678">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912720">if</span>&nbsp;<span class="ident" id="2912723">_</span><span class="op" id="2912724">,</span>&nbsp;<span class="ident" id="2912726">err</span>&nbsp;<span class="op" id="2912730">:=</span>&nbsp;<span class="ident" id="2912733">w</span><span class="op" id="2912734">.</span><span class="ident" id="2912735">cw</span><span class="op" id="2912737">.</span><span class="ident" id="2912738">Write</span><span class="op" id="2912743">(</span><span class="ident" id="2912744">buf</span><span class="op" id="2912747">[</span><span class="op" id="2912748">:</span><span class="op" id="2912749">]</span><span class="op" id="2912750">)</span><span class="op" id="2912751">;</span>&nbsp;<span class="ident" id="2912753">err</span>&nbsp;<span class="op" id="2912757">!=</span>&nbsp;<span class="ident" id="2912760">nil</span>&nbsp;<span class="op" id="2912764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912768">return</span>&nbsp;<span class="ident" id="2912775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2912780">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2912784">return</span>&nbsp;<span class="ident" id="2912791">w</span><span class="op" id="2912792">.</span><span class="ident" id="2912793">cw</span><span class="op" id="2912795">.</span><span class="ident" id="2912796">w</span><span class="op" id="2912797">.</span><span class="op" id="2912798">(</span><span class="op" id="2912799">*</span><span class="ident" id="2912800">bufio</span><span class="op" id="2912805">.</span><span class="ident" id="2912806">Writer</span><span class="op" id="2912812">)</span><span class="op" id="2912813">.</span><span class="ident" id="2912814">Flush</span><span class="op" id="2912819">(</span><span class="op" id="2912820">)</span><br>
<span class="lineno"></span><span class="op" id="2912822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2912825">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="2912888">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2912957">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="2913025">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2913092">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="2913104">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="2913176">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2913219">func</span>&nbsp;<span class="op" id="2913224">(</span><span class="ident" id="2913225">w</span>&nbsp;<span class="op" id="2913227">*</span><span class="ident" id="2913228">Writer</span><span class="op" id="2913234">)</span>&nbsp;<span class="ident" id="2913236">Create</span><span class="op" id="2913242">(</span><span class="ident" id="2913243">name</span>&nbsp;<span class="builtintype" id="2913248">string</span><span class="op" id="2913254">)</span>&nbsp;<span class="op" id="2913256">(</span><span class="ident" id="2913257">io</span><span class="op" id="2913259">.</span><span class="ident" id="2913260">Writer</span><span class="op" id="2913266">,</span>&nbsp;<span class="builtintype" id="2913268">error</span><span class="op" id="2913273">)</span>&nbsp;<span class="op" id="2913275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913278">header</span>&nbsp;<span class="op" id="2913285">:=</span>&nbsp;<span class="op" id="2913288">&amp;</span><span class="ident" id="2913289">FileHeader</span><span class="op" id="2913299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913303">Name</span><span class="op" id="2913307">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2913311">name</span><span class="op" id="2913315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913319">Method</span><span class="op" id="2913325">:</span>&nbsp;<span class="ident" id="2913327">Deflate</span><span class="op" id="2913334">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913340">return</span>&nbsp;<span class="ident" id="2913347">w</span><span class="op" id="2913348">.</span><span class="ident" id="2913349">CreateHeader</span><span class="op" id="2913361">(</span><span class="ident" id="2913362">header</span><span class="op" id="2913368">)</span><br>
<span class="lineno"></span><span class="op" id="2913370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2913373">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="2913447">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="2913473">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2913542">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="2913614">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2913657">func</span>&nbsp;<span class="op" id="2913662">(</span><span class="ident" id="2913663">w</span>&nbsp;<span class="op" id="2913665">*</span><span class="ident" id="2913666">Writer</span><span class="op" id="2913672">)</span>&nbsp;<span class="ident" id="2913674">CreateHeader</span><span class="op" id="2913686">(</span><span class="ident" id="2913687">fh</span>&nbsp;<span class="op" id="2913690">*</span><span class="ident" id="2913691">FileHeader</span><span class="op" id="2913701">)</span>&nbsp;<span class="op" id="2913703">(</span><span class="ident" id="2913704">io</span><span class="op" id="2913706">.</span><span class="ident" id="2913707">Writer</span><span class="op" id="2913713">,</span>&nbsp;<span class="builtintype" id="2913715">error</span><span class="op" id="2913720">)</span>&nbsp;<span class="op" id="2913722">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913725">if</span>&nbsp;<span class="ident" id="2913728">w</span><span class="op" id="2913729">.</span><span class="ident" id="2913730">last</span>&nbsp;<span class="op" id="2913735">!=</span>&nbsp;<span class="ident" id="2913738">nil</span>&nbsp;<span class="op" id="2913742">&amp;&amp;</span>&nbsp;<span class="op" id="2913745">!</span><span class="ident" id="2913746">w</span><span class="op" id="2913747">.</span><span class="ident" id="2913748">last</span><span class="op" id="2913752">.</span><span class="ident" id="2913753">closed</span>&nbsp;<span class="op" id="2913760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913764">if</span>&nbsp;<span class="ident" id="2913767">err</span>&nbsp;<span class="op" id="2913771">:=</span>&nbsp;<span class="ident" id="2913774">w</span><span class="op" id="2913775">.</span><span class="ident" id="2913776">last</span><span class="op" id="2913780">.</span><span class="builtinfunc" id="2913781">close</span><span class="op" id="2913786">(</span><span class="op" id="2913787">)</span><span class="op" id="2913788">;</span>&nbsp;<span class="ident" id="2913790">err</span>&nbsp;<span class="op" id="2913794">!=</span>&nbsp;<span class="ident" id="2913797">nil</span>&nbsp;<span class="op" id="2913801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2913806">return</span>&nbsp;<span class="ident" id="2913813">nil</span><span class="op" id="2913816">,</span>&nbsp;<span class="ident" id="2913818">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2913827">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913831">fh</span><span class="op" id="2913833">.</span><span class="ident" id="2913834">Flags</span>&nbsp;<span class="op" id="2913840">|=</span>&nbsp;<span class="num" id="2913843">0x8</span>&nbsp;<span class="comment" id="2913847">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913884">fh</span><span class="op" id="2913886">.</span><span class="ident" id="2913887">CreatorVersion</span>&nbsp;<span class="op" id="2913902">=</span>&nbsp;<span class="ident" id="2913904">fh</span><span class="op" id="2913906">.</span><span class="ident" id="2913907">CreatorVersion</span><span class="op" id="2913921">&amp;</span><span class="num" id="2913922">0xff00</span>&nbsp;<span class="op" id="2913929">|</span>&nbsp;<span class="ident" id="2913931">zipVersion20</span>&nbsp;<span class="comment" id="2913944">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2913976">fh</span><span class="op" id="2913978">.</span><span class="ident" id="2913979">ReaderVersion</span>&nbsp;<span class="op" id="2913993">=</span>&nbsp;<span class="ident" id="2913995">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914010">fw</span>&nbsp;<span class="op" id="2914013">:=</span>&nbsp;<span class="op" id="2914016">&amp;</span><span class="ident" id="2914017">fileWriter</span><span class="op" id="2914027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914031">zipw</span><span class="op" id="2914035">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2914042">w</span><span class="op" id="2914043">.</span><span class="ident" id="2914044">cw</span><span class="op" id="2914046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914050">compCount</span><span class="op" id="2914059">:</span>&nbsp;<span class="op" id="2914061">&amp;</span><span class="ident" id="2914062">countWriter</span><span class="op" id="2914073">{</span><span class="ident" id="2914074">w</span><span class="op" id="2914075">:</span>&nbsp;<span class="ident" id="2914077">w</span><span class="op" id="2914078">.</span><span class="ident" id="2914079">cw</span><span class="op" id="2914081">}</span><span class="op" id="2914082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914086">crc32</span><span class="op" id="2914091">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2914097">crc32</span><span class="op" id="2914102">.</span><span class="ident" id="2914103">NewIEEE</span><span class="op" id="2914110">(</span><span class="op" id="2914111">)</span><span class="op" id="2914112">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914118">comp</span>&nbsp;<span class="op" id="2914123">:=</span>&nbsp;<span class="ident" id="2914126">compressor</span><span class="op" id="2914136">(</span><span class="ident" id="2914137">fh</span><span class="op" id="2914139">.</span><span class="ident" id="2914140">Method</span><span class="op" id="2914146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914149">if</span>&nbsp;<span class="ident" id="2914152">comp</span>&nbsp;<span class="op" id="2914157">==</span>&nbsp;<span class="ident" id="2914160">nil</span>&nbsp;<span class="op" id="2914164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914168">return</span>&nbsp;<span class="ident" id="2914175">nil</span><span class="op" id="2914178">,</span>&nbsp;<span class="ident" id="2914180">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914194">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914197">var</span>&nbsp;<span class="ident" id="2914201">err</span>&nbsp;<span class="builtintype" id="2914205">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914212">fw</span><span class="op" id="2914214">.</span><span class="ident" id="2914215">comp</span><span class="op" id="2914219">,</span>&nbsp;<span class="ident" id="2914221">err</span>&nbsp;<span class="op" id="2914225">=</span>&nbsp;<span class="ident" id="2914227">comp</span><span class="op" id="2914231">(</span><span class="ident" id="2914232">fw</span><span class="op" id="2914234">.</span><span class="ident" id="2914235">compCount</span><span class="op" id="2914244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914247">if</span>&nbsp;<span class="ident" id="2914250">err</span>&nbsp;<span class="op" id="2914254">!=</span>&nbsp;<span class="ident" id="2914257">nil</span>&nbsp;<span class="op" id="2914261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914265">return</span>&nbsp;<span class="ident" id="2914272">nil</span><span class="op" id="2914275">,</span>&nbsp;<span class="ident" id="2914277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914282">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914285">fw</span><span class="op" id="2914287">.</span><span class="ident" id="2914288">rawCount</span>&nbsp;<span class="op" id="2914297">=</span>&nbsp;<span class="op" id="2914299">&amp;</span><span class="ident" id="2914300">countWriter</span><span class="op" id="2914311">{</span><span class="ident" id="2914312">w</span><span class="op" id="2914313">:</span>&nbsp;<span class="ident" id="2914315">fw</span><span class="op" id="2914317">.</span><span class="ident" id="2914318">comp</span><span class="op" id="2914322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914326">h</span>&nbsp;<span class="op" id="2914328">:=</span>&nbsp;<span class="op" id="2914331">&amp;</span><span class="ident" id="2914332">header</span><span class="op" id="2914338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914342">FileHeader</span><span class="op" id="2914352">:</span>&nbsp;<span class="ident" id="2914354">fh</span><span class="op" id="2914356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914360">offset</span><span class="op" id="2914366">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2914372">uint64</span><span class="op" id="2914378">(</span><span class="ident" id="2914379">w</span><span class="op" id="2914380">.</span><span class="ident" id="2914381">cw</span><span class="op" id="2914383">.</span><span class="ident" id="2914384">count</span><span class="op" id="2914389">)</span><span class="op" id="2914390">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914396">w</span><span class="op" id="2914397">.</span><span class="ident" id="2914398">dir</span>&nbsp;<span class="op" id="2914402">=</span>&nbsp;<span class="builtinfunc" id="2914404">append</span><span class="op" id="2914410">(</span><span class="ident" id="2914411">w</span><span class="op" id="2914412">.</span><span class="ident" id="2914413">dir</span><span class="op" id="2914416">,</span>&nbsp;<span class="ident" id="2914418">h</span><span class="op" id="2914419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914422">fw</span><span class="op" id="2914424">.</span><span class="ident" id="2914425">header</span>&nbsp;<span class="op" id="2914432">=</span>&nbsp;<span class="ident" id="2914434">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914438">if</span>&nbsp;<span class="ident" id="2914441">err</span>&nbsp;<span class="op" id="2914445">:=</span>&nbsp;<span class="ident" id="2914448">writeHeader</span><span class="op" id="2914459">(</span><span class="ident" id="2914460">w</span><span class="op" id="2914461">.</span><span class="ident" id="2914462">cw</span><span class="op" id="2914464">,</span>&nbsp;<span class="ident" id="2914466">fh</span><span class="op" id="2914468">)</span><span class="op" id="2914469">;</span>&nbsp;<span class="ident" id="2914471">err</span>&nbsp;<span class="op" id="2914475">!=</span>&nbsp;<span class="ident" id="2914478">nil</span>&nbsp;<span class="op" id="2914482">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914486">return</span>&nbsp;<span class="ident" id="2914493">nil</span><span class="op" id="2914496">,</span>&nbsp;<span class="ident" id="2914498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2914503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914507">w</span><span class="op" id="2914508">.</span><span class="ident" id="2914509">last</span>&nbsp;<span class="op" id="2914514">=</span>&nbsp;<span class="ident" id="2914516">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914520">return</span>&nbsp;<span class="ident" id="2914527">fw</span><span class="op" id="2914529">,</span>&nbsp;<span class="ident" id="2914531">nil</span><br>
<span class="lineno">230</span><span class="op" id="2914535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2914538">func</span>&nbsp;<span class="ident" id="2914543">writeHeader</span><span class="op" id="2914554">(</span><span class="ident" id="2914555">w</span>&nbsp;<span class="ident" id="2914557">io</span><span class="op" id="2914559">.</span><span class="ident" id="2914560">Writer</span><span class="op" id="2914566">,</span>&nbsp;<span class="ident" id="2914568">h</span>&nbsp;<span class="op" id="2914570">*</span><span class="ident" id="2914571">FileHeader</span><span class="op" id="2914581">)</span>&nbsp;<span class="builtintype" id="2914583">error</span>&nbsp;<span class="op" id="2914589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2914592">var</span>&nbsp;<span class="ident" id="2914596">buf</span>&nbsp;<span class="op" id="2914600">[</span><span class="ident" id="2914601">fileHeaderLen</span><span class="op" id="2914614">]</span><span class="builtintype" id="2914615">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914621">b</span>&nbsp;<span class="op" id="2914623">:=</span>&nbsp;<span class="ident" id="2914626">writeBuf</span><span class="op" id="2914634">(</span><span class="ident" id="2914635">buf</span><span class="op" id="2914638">[</span><span class="op" id="2914639">:</span><span class="op" id="2914640">]</span><span class="op" id="2914641">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914644">b</span><span class="op" id="2914645">.</span><span class="builtintype" id="2914646">uint32</span><span class="op" id="2914652">(</span><span class="builtintype" id="2914653">uint32</span><span class="op" id="2914659">(</span><span class="ident" id="2914660">fileHeaderSignature</span><span class="op" id="2914679">)</span><span class="op" id="2914680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914683">b</span><span class="op" id="2914684">.</span><span class="builtintype" id="2914685">uint16</span><span class="op" id="2914691">(</span><span class="ident" id="2914692">h</span><span class="op" id="2914693">.</span><span class="ident" id="2914694">ReaderVersion</span><span class="op" id="2914707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914710">b</span><span class="op" id="2914711">.</span><span class="builtintype" id="2914712">uint16</span><span class="op" id="2914718">(</span><span class="ident" id="2914719">h</span><span class="op" id="2914720">.</span><span class="ident" id="2914721">Flags</span><span class="op" id="2914726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914729">b</span><span class="op" id="2914730">.</span><span class="builtintype" id="2914731">uint16</span><span class="op" id="2914737">(</span><span class="ident" id="2914738">h</span><span class="op" id="2914739">.</span><span class="ident" id="2914740">Method</span><span class="op" id="2914746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914749">b</span><span class="op" id="2914750">.</span><span class="builtintype" id="2914751">uint16</span><span class="op" id="2914757">(</span><span class="ident" id="2914758">h</span><span class="op" id="2914759">.</span><span class="ident" id="2914760">ModifiedTime</span><span class="op" id="2914772">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914775">b</span><span class="op" id="2914776">.</span><span class="builtintype" id="2914777">uint16</span><span class="op" id="2914783">(</span><span class="ident" id="2914784">h</span><span class="op" id="2914785">.</span><span class="ident" id="2914786">ModifiedDate</span><span class="op" id="2914798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914801">b</span><span class="op" id="2914802">.</span><span class="builtintype" id="2914803">uint32</span><span class="op" id="2914809">(</span><span class="num" id="2914810">0</span><span class="op" id="2914811">)</span>&nbsp;<span class="comment" id="2914813">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914863">b</span><span class="op" id="2914864">.</span><span class="builtintype" id="2914865">uint32</span><span class="op" id="2914871">(</span><span class="num" id="2914872">0</span><span class="op" id="2914873">)</span>&nbsp;<span class="comment" id="2914875">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914896">b</span><span class="op" id="2914897">.</span><span class="builtintype" id="2914898">uint32</span><span class="op" id="2914904">(</span><span class="num" id="2914905">0</span><span class="op" id="2914906">)</span>&nbsp;<span class="comment" id="2914908">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914949">b</span><span class="op" id="2914950">.</span><span class="builtintype" id="2914951">uint16</span><span class="op" id="2914957">(</span><span class="builtintype" id="2914958">uint16</span><span class="op" id="2914964">(</span><span class="builtinfunc" id="2914965">len</span><span class="op" id="2914968">(</span><span class="ident" id="2914969">h</span><span class="op" id="2914970">.</span><span class="ident" id="2914971">Name</span><span class="op" id="2914975">)</span><span class="op" id="2914976">)</span><span class="op" id="2914977">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2914980">b</span><span class="op" id="2914981">.</span><span class="builtintype" id="2914982">uint16</span><span class="op" id="2914988">(</span><span class="builtintype" id="2914989">uint16</span><span class="op" id="2914995">(</span><span class="builtinfunc" id="2914996">len</span><span class="op" id="2914999">(</span><span class="ident" id="2915000">h</span><span class="op" id="2915001">.</span><span class="ident" id="2915002">Extra</span><span class="op" id="2915007">)</span><span class="op" id="2915008">)</span><span class="op" id="2915009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915012">if</span>&nbsp;<span class="ident" id="2915015">_</span><span class="op" id="2915016">,</span>&nbsp;<span class="ident" id="2915018">err</span>&nbsp;<span class="op" id="2915022">:=</span>&nbsp;<span class="ident" id="2915025">w</span><span class="op" id="2915026">.</span><span class="ident" id="2915027">Write</span><span class="op" id="2915032">(</span><span class="ident" id="2915033">buf</span><span class="op" id="2915036">[</span><span class="op" id="2915037">:</span><span class="op" id="2915038">]</span><span class="op" id="2915039">)</span><span class="op" id="2915040">;</span>&nbsp;<span class="ident" id="2915042">err</span>&nbsp;<span class="op" id="2915046">!=</span>&nbsp;<span class="ident" id="2915049">nil</span>&nbsp;<span class="op" id="2915053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915057">return</span>&nbsp;<span class="ident" id="2915064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915072">if</span>&nbsp;<span class="ident" id="2915075">_</span><span class="op" id="2915076">,</span>&nbsp;<span class="ident" id="2915078">err</span>&nbsp;<span class="op" id="2915082">:=</span>&nbsp;<span class="ident" id="2915085">io</span><span class="op" id="2915087">.</span><span class="ident" id="2915088">WriteString</span><span class="op" id="2915099">(</span><span class="ident" id="2915100">w</span><span class="op" id="2915101">,</span>&nbsp;<span class="ident" id="2915103">h</span><span class="op" id="2915104">.</span><span class="ident" id="2915105">Name</span><span class="op" id="2915109">)</span><span class="op" id="2915110">;</span>&nbsp;<span class="ident" id="2915112">err</span>&nbsp;<span class="op" id="2915116">!=</span>&nbsp;<span class="ident" id="2915119">nil</span>&nbsp;<span class="op" id="2915123">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915127">return</span>&nbsp;<span class="ident" id="2915134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915142">_</span><span class="op" id="2915143">,</span>&nbsp;<span class="ident" id="2915145">err</span>&nbsp;<span class="op" id="2915149">:=</span>&nbsp;<span class="ident" id="2915152">w</span><span class="op" id="2915153">.</span><span class="ident" id="2915154">Write</span><span class="op" id="2915159">(</span><span class="ident" id="2915160">h</span><span class="op" id="2915161">.</span><span class="ident" id="2915162">Extra</span><span class="op" id="2915167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915170">return</span>&nbsp;<span class="ident" id="2915177">err</span><br>
<span class="lineno"></span><span class="op" id="2915181">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="2915184">type</span>&nbsp;<span class="ident" id="2915189">fileWriter</span>&nbsp;<span class="keyword" id="2915200">struct</span>&nbsp;<span class="op" id="2915207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915210">*</span><span class="ident" id="2915211">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915219">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2915229">io</span><span class="op" id="2915231">.</span><span class="ident" id="2915232">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915240">rawCount</span>&nbsp;&nbsp;<span class="op" id="2915250">*</span><span class="ident" id="2915251">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915264">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2915274">io</span><span class="op" id="2915276">.</span><span class="ident" id="2915277">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915290">compCount</span>&nbsp;<span class="op" id="2915300">*</span><span class="ident" id="2915301">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915314">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2915324">hash</span><span class="op" id="2915328">.</span><span class="ident" id="2915329">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915337">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2915347">bool</span><br>
<span class="lineno"></span><span class="op" id="2915352">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2915355">func</span>&nbsp;<span class="op" id="2915360">(</span><span class="ident" id="2915361">w</span>&nbsp;<span class="op" id="2915363">*</span><span class="ident" id="2915364">fileWriter</span><span class="op" id="2915374">)</span>&nbsp;<span class="ident" id="2915376">Write</span><span class="op" id="2915381">(</span><span class="ident" id="2915382">p</span>&nbsp;<span class="op" id="2915384">[</span><span class="op" id="2915385">]</span><span class="builtintype" id="2915386">byte</span><span class="op" id="2915390">)</span>&nbsp;<span class="op" id="2915392">(</span><span class="builtintype" id="2915393">int</span><span class="op" id="2915396">,</span>&nbsp;<span class="builtintype" id="2915398">error</span><span class="op" id="2915403">)</span>&nbsp;<span class="op" id="2915405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915408">if</span>&nbsp;<span class="ident" id="2915411">w</span><span class="op" id="2915412">.</span><span class="ident" id="2915413">closed</span>&nbsp;<span class="op" id="2915420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915424">return</span>&nbsp;<span class="num" id="2915431">0</span><span class="op" id="2915432">,</span>&nbsp;<span class="ident" id="2915434">errors</span><span class="op" id="2915440">.</span><span class="ident" id="2915441">New</span><span class="op" id="2915444">(</span><span class="string" id="2915445">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="2915472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915475">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915478">w</span><span class="op" id="2915479">.</span><span class="ident" id="2915480">crc32</span><span class="op" id="2915485">.</span><span class="ident" id="2915486">Write</span><span class="op" id="2915491">(</span><span class="ident" id="2915492">p</span><span class="op" id="2915493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915496">return</span>&nbsp;<span class="ident" id="2915503">w</span><span class="op" id="2915504">.</span><span class="ident" id="2915505">rawCount</span><span class="op" id="2915513">.</span><span class="ident" id="2915514">Write</span><span class="op" id="2915519">(</span><span class="ident" id="2915520">p</span><span class="op" id="2915521">)</span><br>
<span class="lineno"></span><span class="op" id="2915523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2915526">func</span>&nbsp;<span class="op" id="2915531">(</span><span class="ident" id="2915532">w</span>&nbsp;<span class="op" id="2915534">*</span><span class="ident" id="2915535">fileWriter</span><span class="op" id="2915545">)</span>&nbsp;<span class="builtinfunc" id="2915547">close</span><span class="op" id="2915552">(</span><span class="op" id="2915553">)</span>&nbsp;<span class="builtintype" id="2915555">error</span>&nbsp;<span class="op" id="2915561">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915564">if</span>&nbsp;<span class="ident" id="2915567">w</span><span class="op" id="2915568">.</span><span class="ident" id="2915569">closed</span>&nbsp;<span class="op" id="2915576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915580">return</span>&nbsp;<span class="ident" id="2915587">errors</span><span class="op" id="2915593">.</span><span class="ident" id="2915594">New</span><span class="op" id="2915597">(</span><span class="string" id="2915598">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="2915622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915628">w</span><span class="op" id="2915629">.</span><span class="ident" id="2915630">closed</span>&nbsp;<span class="op" id="2915637">=</span>&nbsp;<span class="builtintype" id="2915639">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915645">if</span>&nbsp;<span class="ident" id="2915648">err</span>&nbsp;<span class="op" id="2915652">:=</span>&nbsp;<span class="ident" id="2915655">w</span><span class="op" id="2915656">.</span><span class="ident" id="2915657">comp</span><span class="op" id="2915661">.</span><span class="ident" id="2915662">Close</span><span class="op" id="2915667">(</span><span class="op" id="2915668">)</span><span class="op" id="2915669">;</span>&nbsp;<span class="ident" id="2915671">err</span>&nbsp;<span class="op" id="2915675">!=</span>&nbsp;<span class="ident" id="2915678">nil</span>&nbsp;<span class="op" id="2915682">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915686">return</span>&nbsp;<span class="ident" id="2915693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2915698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2915702">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915724">fh</span>&nbsp;<span class="op" id="2915727">:=</span>&nbsp;<span class="ident" id="2915730">w</span><span class="op" id="2915731">.</span><span class="ident" id="2915732">header</span><span class="op" id="2915738">.</span><span class="ident" id="2915739">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915751">fh</span><span class="op" id="2915753">.</span><span class="ident" id="2915754">CRC32</span>&nbsp;<span class="op" id="2915760">=</span>&nbsp;<span class="ident" id="2915762">w</span><span class="op" id="2915763">.</span><span class="ident" id="2915764">crc32</span><span class="op" id="2915769">.</span><span class="ident" id="2915770">Sum32</span><span class="op" id="2915775">(</span><span class="op" id="2915776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915779">fh</span><span class="op" id="2915781">.</span><span class="ident" id="2915782">CompressedSize64</span>&nbsp;<span class="op" id="2915799">=</span>&nbsp;<span class="ident" id="2915801">uint64</span><span class="op" id="2915807">(</span><span class="ident" id="2915808">w</span><span class="op" id="2915809">.</span><span class="ident" id="2915810">compCount</span><span class="op" id="2915819">.</span><span class="ident" id="2915820">count</span><span class="op" id="2915825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915828">fh</span><span class="op" id="2915830">.</span><span class="ident" id="2915831">UncompressedSize64</span>&nbsp;<span class="op" id="2915850">=</span>&nbsp;<span class="ident" id="2915852">uint64</span><span class="op" id="2915858">(</span><span class="ident" id="2915859">w</span><span class="op" id="2915860">.</span><span class="ident" id="2915861">rawCount</span><span class="op" id="2915869">.</span><span class="ident" id="2915870">count</span><span class="op" id="2915875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2915879">if</span>&nbsp;<span class="ident" id="2915882">fh</span><span class="op" id="2915884">.</span><span class="ident" id="2915885">isZip64</span><span class="op" id="2915892">(</span><span class="op" id="2915893">)</span>&nbsp;<span class="op" id="2915895">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915899">fh</span><span class="op" id="2915901">.</span><span class="ident" id="2915902">CompressedSize</span>&nbsp;<span class="op" id="2915917">=</span>&nbsp;<span class="ident" id="2915919">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915931">fh</span><span class="op" id="2915933">.</span><span class="ident" id="2915934">UncompressedSize</span>&nbsp;<span class="op" id="2915951">=</span>&nbsp;<span class="ident" id="2915953">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2915965">fh</span><span class="op" id="2915967">.</span><span class="ident" id="2915968">ReaderVersion</span>&nbsp;<span class="op" id="2915982">=</span>&nbsp;<span class="ident" id="2915984">zipVersion45</span>&nbsp;<span class="comment" id="2915997">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916050">}</span>&nbsp;<span class="keyword" id="2916052">else</span>&nbsp;<span class="op" id="2916057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916061">fh</span><span class="op" id="2916063">.</span><span class="ident" id="2916064">CompressedSize</span>&nbsp;<span class="op" id="2916079">=</span>&nbsp;<span class="builtintype" id="2916081">uint32</span><span class="op" id="2916087">(</span><span class="ident" id="2916088">fh</span><span class="op" id="2916090">.</span><span class="ident" id="2916091">CompressedSize64</span><span class="op" id="2916107">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916111">fh</span><span class="op" id="2916113">.</span><span class="ident" id="2916114">UncompressedSize</span>&nbsp;<span class="op" id="2916131">=</span>&nbsp;<span class="builtintype" id="2916133">uint32</span><span class="op" id="2916139">(</span><span class="ident" id="2916140">fh</span><span class="op" id="2916142">.</span><span class="ident" id="2916143">UncompressedSize64</span><span class="op" id="2916161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916168">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916235">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916295">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916359">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2916424">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916488">var</span>&nbsp;<span class="ident" id="2916492">buf</span>&nbsp;<span class="op" id="2916496">[</span><span class="op" id="2916497">]</span><span class="builtintype" id="2916498">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916504">if</span>&nbsp;<span class="ident" id="2916507">fh</span><span class="op" id="2916509">.</span><span class="ident" id="2916510">isZip64</span><span class="op" id="2916517">(</span><span class="op" id="2916518">)</span>&nbsp;<span class="op" id="2916520">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916524">buf</span>&nbsp;<span class="op" id="2916528">=</span>&nbsp;<span class="builtinfunc" id="2916530">make</span><span class="op" id="2916534">(</span><span class="op" id="2916535">[</span><span class="op" id="2916536">]</span><span class="builtintype" id="2916537">byte</span><span class="op" id="2916541">,</span>&nbsp;<span class="ident" id="2916543">dataDescriptor64Len</span><span class="op" id="2916562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916565">}</span>&nbsp;<span class="keyword" id="2916567">else</span>&nbsp;<span class="op" id="2916572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916576">buf</span>&nbsp;<span class="op" id="2916580">=</span>&nbsp;<span class="builtinfunc" id="2916582">make</span><span class="op" id="2916586">(</span><span class="op" id="2916587">[</span><span class="op" id="2916588">]</span><span class="builtintype" id="2916589">byte</span><span class="op" id="2916593">,</span>&nbsp;<span class="ident" id="2916595">dataDescriptorLen</span><span class="op" id="2916612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916618">b</span>&nbsp;<span class="op" id="2916620">:=</span>&nbsp;<span class="ident" id="2916623">writeBuf</span><span class="op" id="2916631">(</span><span class="ident" id="2916632">buf</span><span class="op" id="2916635">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916638">b</span><span class="op" id="2916639">.</span><span class="builtintype" id="2916640">uint32</span><span class="op" id="2916646">(</span><span class="ident" id="2916647">dataDescriptorSignature</span><span class="op" id="2916670">)</span>&nbsp;<span class="comment" id="2916672">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916712">b</span><span class="op" id="2916713">.</span><span class="builtintype" id="2916714">uint32</span><span class="op" id="2916720">(</span><span class="ident" id="2916721">fh</span><span class="op" id="2916723">.</span><span class="ident" id="2916724">CRC32</span><span class="op" id="2916729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916732">if</span>&nbsp;<span class="ident" id="2916735">fh</span><span class="op" id="2916737">.</span><span class="ident" id="2916738">isZip64</span><span class="op" id="2916745">(</span><span class="op" id="2916746">)</span>&nbsp;<span class="op" id="2916748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916752">b</span><span class="op" id="2916753">.</span><span class="ident" id="2916754">uint64</span><span class="op" id="2916760">(</span><span class="ident" id="2916761">fh</span><span class="op" id="2916763">.</span><span class="ident" id="2916764">CompressedSize64</span><span class="op" id="2916780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916784">b</span><span class="op" id="2916785">.</span><span class="ident" id="2916786">uint64</span><span class="op" id="2916792">(</span><span class="ident" id="2916793">fh</span><span class="op" id="2916795">.</span><span class="ident" id="2916796">UncompressedSize64</span><span class="op" id="2916814">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916817">}</span>&nbsp;<span class="keyword" id="2916819">else</span>&nbsp;<span class="op" id="2916824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916828">b</span><span class="op" id="2916829">.</span><span class="builtintype" id="2916830">uint32</span><span class="op" id="2916836">(</span><span class="ident" id="2916837">fh</span><span class="op" id="2916839">.</span><span class="ident" id="2916840">CompressedSize</span><span class="op" id="2916854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916858">b</span><span class="op" id="2916859">.</span><span class="builtintype" id="2916860">uint32</span><span class="op" id="2916866">(</span><span class="ident" id="2916867">fh</span><span class="op" id="2916869">.</span><span class="ident" id="2916870">UncompressedSize</span><span class="op" id="2916886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2916889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916892">_</span><span class="op" id="2916893">,</span>&nbsp;<span class="ident" id="2916895">err</span>&nbsp;<span class="op" id="2916899">:=</span>&nbsp;<span class="ident" id="2916902">w</span><span class="op" id="2916903">.</span><span class="ident" id="2916904">zipw</span><span class="op" id="2916908">.</span><span class="ident" id="2916909">Write</span><span class="op" id="2916914">(</span><span class="ident" id="2916915">buf</span><span class="op" id="2916918">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2916921">return</span>&nbsp;<span class="ident" id="2916928">err</span><br>
<span class="lineno"></span><span class="op" id="2916932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2916935">type</span>&nbsp;<span class="ident" id="2916940">countWriter</span>&nbsp;<span class="keyword" id="2916952">struct</span>&nbsp;<span class="op" id="2916959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916962">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2916968">io</span><span class="op" id="2916970">.</span><span class="ident" id="2916971">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2916979">count</span>&nbsp;<span class="ident" id="2916985">int64</span><br>
<span class="lineno"></span><span class="op" id="2916991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2916994">func</span>&nbsp;<span class="op" id="2916999">(</span><span class="ident" id="2917000">w</span>&nbsp;<span class="op" id="2917002">*</span><span class="ident" id="2917003">countWriter</span><span class="op" id="2917014">)</span>&nbsp;<span class="ident" id="2917016">Write</span><span class="op" id="2917021">(</span><span class="ident" id="2917022">p</span>&nbsp;<span class="op" id="2917024">[</span><span class="op" id="2917025">]</span><span class="builtintype" id="2917026">byte</span><span class="op" id="2917030">)</span>&nbsp;<span class="op" id="2917032">(</span><span class="builtintype" id="2917033">int</span><span class="op" id="2917036">,</span>&nbsp;<span class="builtintype" id="2917038">error</span><span class="op" id="2917043">)</span>&nbsp;<span class="op" id="2917045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917048">n</span><span class="op" id="2917049">,</span>&nbsp;<span class="ident" id="2917051">err</span>&nbsp;<span class="op" id="2917055">:=</span>&nbsp;<span class="ident" id="2917058">w</span><span class="op" id="2917059">.</span><span class="ident" id="2917060">w</span><span class="op" id="2917061">.</span><span class="ident" id="2917062">Write</span><span class="op" id="2917067">(</span><span class="ident" id="2917068">p</span><span class="op" id="2917069">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917072">w</span><span class="op" id="2917073">.</span><span class="ident" id="2917074">count</span>&nbsp;<span class="op" id="2917080">+=</span>&nbsp;<span class="ident" id="2917083">int64</span><span class="op" id="2917088">(</span><span class="ident" id="2917089">n</span><span class="op" id="2917090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917093">return</span>&nbsp;<span class="ident" id="2917100">n</span><span class="op" id="2917101">,</span>&nbsp;<span class="ident" id="2917103">err</span><br>
<span class="lineno"></span><span class="op" id="2917107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917110">type</span>&nbsp;<span class="ident" id="2917115">nopCloser</span>&nbsp;<span class="keyword" id="2917125">struct</span>&nbsp;<span class="op" id="2917132">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917135">io</span><span class="op" id="2917137">.</span><span class="ident" id="2917138">Writer</span><br>
<span class="lineno"></span><span class="op" id="2917145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917148">func</span>&nbsp;<span class="op" id="2917153">(</span><span class="ident" id="2917154">w</span>&nbsp;<span class="ident" id="2917156">nopCloser</span><span class="op" id="2917165">)</span>&nbsp;<span class="ident" id="2917167">Close</span><span class="op" id="2917172">(</span><span class="op" id="2917173">)</span>&nbsp;<span class="builtintype" id="2917175">error</span>&nbsp;<span class="op" id="2917181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2917184">return</span>&nbsp;<span class="ident" id="2917191">nil</span><br>
<span class="lineno">340</span><span class="op" id="2917195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917198">type</span>&nbsp;<span class="ident" id="2917203">writeBuf</span>&nbsp;<span class="op" id="2917212">[</span><span class="op" id="2917213">]</span><span class="builtintype" id="2917214">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917220">func</span>&nbsp;<span class="op" id="2917225">(</span><span class="ident" id="2917226">b</span>&nbsp;<span class="op" id="2917228">*</span><span class="ident" id="2917229">writeBuf</span><span class="op" id="2917237">)</span>&nbsp;<span class="builtintype" id="2917239">uint16</span><span class="op" id="2917245">(</span><span class="ident" id="2917246">v</span>&nbsp;<span class="builtintype" id="2917248">uint16</span><span class="op" id="2917254">)</span>&nbsp;<span class="op" id="2917256">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917259">binary</span><span class="op" id="2917265">.</span><span class="ident" id="2917266">LittleEndian</span><span class="op" id="2917278">.</span><span class="ident" id="2917279">PutUint16</span><span class="op" id="2917288">(</span><span class="op" id="2917289">*</span><span class="ident" id="2917290">b</span><span class="op" id="2917291">,</span>&nbsp;<span class="ident" id="2917293">v</span><span class="op" id="2917294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917297">*</span><span class="ident" id="2917298">b</span>&nbsp;<span class="op" id="2917300">=</span>&nbsp;<span class="op" id="2917302">(</span><span class="op" id="2917303">*</span><span class="ident" id="2917304">b</span><span class="op" id="2917305">)</span><span class="op" id="2917306">[</span><span class="num" id="2917307">2</span><span class="op" id="2917308">:</span><span class="op" id="2917309">]</span><br>
<span class="lineno"></span><span class="op" id="2917311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917314">func</span>&nbsp;<span class="op" id="2917319">(</span><span class="ident" id="2917320">b</span>&nbsp;<span class="op" id="2917322">*</span><span class="ident" id="2917323">writeBuf</span><span class="op" id="2917331">)</span>&nbsp;<span class="builtintype" id="2917333">uint32</span><span class="op" id="2917339">(</span><span class="ident" id="2917340">v</span>&nbsp;<span class="builtintype" id="2917342">uint32</span><span class="op" id="2917348">)</span>&nbsp;<span class="op" id="2917350">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917353">binary</span><span class="op" id="2917359">.</span><span class="ident" id="2917360">LittleEndian</span><span class="op" id="2917372">.</span><span class="ident" id="2917373">PutUint32</span><span class="op" id="2917382">(</span><span class="op" id="2917383">*</span><span class="ident" id="2917384">b</span><span class="op" id="2917385">,</span>&nbsp;<span class="ident" id="2917387">v</span><span class="op" id="2917388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917391">*</span><span class="ident" id="2917392">b</span>&nbsp;<span class="op" id="2917394">=</span>&nbsp;<span class="op" id="2917396">(</span><span class="op" id="2917397">*</span><span class="ident" id="2917398">b</span><span class="op" id="2917399">)</span><span class="op" id="2917400">[</span><span class="num" id="2917401">4</span><span class="op" id="2917402">:</span><span class="op" id="2917403">]</span><br>
<span class="lineno"></span><span class="op" id="2917405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2917408">func</span>&nbsp;<span class="op" id="2917413">(</span><span class="ident" id="2917414">b</span>&nbsp;<span class="op" id="2917416">*</span><span class="ident" id="2917417">writeBuf</span><span class="op" id="2917425">)</span>&nbsp;<span class="ident" id="2917427">uint64</span><span class="op" id="2917433">(</span><span class="ident" id="2917434">v</span>&nbsp;<span class="ident" id="2917436">uint64</span><span class="op" id="2917442">)</span>&nbsp;<span class="op" id="2917444">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2917447">binary</span><span class="op" id="2917453">.</span><span class="ident" id="2917454">LittleEndian</span><span class="op" id="2917466">.</span><span class="ident" id="2917467">PutUint64</span><span class="op" id="2917476">(</span><span class="op" id="2917477">*</span><span class="ident" id="2917478">b</span><span class="op" id="2917479">,</span>&nbsp;<span class="ident" id="2917481">v</span><span class="op" id="2917482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2917485">*</span><span class="ident" id="2917486">b</span>&nbsp;<span class="op" id="2917488">=</span>&nbsp;<span class="op" id="2917490">(</span><span class="op" id="2917491">*</span><span class="ident" id="2917492">b</span><span class="op" id="2917493">)</span><span class="op" id="2917494">[</span><span class="num" id="2917495">8</span><span class="op" id="2917496">:</span><span class="op" id="2917497">]</span><br>
<span class="lineno"></span><span class="op" id="2917499">}</span>
</div>
</body>
</html>
