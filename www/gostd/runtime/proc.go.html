<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1592254">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1592309">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1592363">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1592414">package</span>&nbsp;<span class="ident" id="1592422">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1592431">import</span>&nbsp;<span class="string" id="1592438">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1592448">func</span>&nbsp;<span class="ident" id="1592453">newsysmon</span><span class="op" id="1592462">(</span><span class="op" id="1592463">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1592466">func</span>&nbsp;<span class="ident" id="1592471">runtime_init</span><span class="op" id="1592483">(</span><span class="op" id="1592484">)</span><br>
<span class="lineno"></span><span class="keyword" id="1592486">func</span>&nbsp;<span class="ident" id="1592491">main_init</span><span class="op" id="1592500">(</span><span class="op" id="1592501">)</span><br>
<span class="lineno"></span><span class="keyword" id="1592503">func</span>&nbsp;<span class="ident" id="1592508">main_main</span><span class="op" id="1592517">(</span><span class="op" id="1592518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1592521">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1592544">func</span>&nbsp;<span class="ident" id="1592549">main</span><span class="op" id="1592553">(</span><span class="op" id="1592554">)</span>&nbsp;<span class="op" id="1592556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1592559">g</span>&nbsp;<span class="op" id="1592561">:=</span>&nbsp;<span class="ident" id="1592564">getg</span><span class="op" id="1592568">(</span><span class="op" id="1592569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592573">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592645">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1592688">g</span><span class="op" id="1592689">.</span><span class="ident" id="1592690">m</span><span class="op" id="1592691">.</span><span class="ident" id="1592692">g0</span><span class="op" id="1592694">.</span><span class="ident" id="1592695">racectx</span>&nbsp;<span class="op" id="1592703">=</span>&nbsp;<span class="num" id="1592705">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592709">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592765">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592819">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1592878">if</span>&nbsp;<span class="ident" id="1592881">ptrSize</span>&nbsp;<span class="op" id="1592889">==</span>&nbsp;<span class="num" id="1592892">8</span>&nbsp;<span class="op" id="1592894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1592898">maxstacksize</span>&nbsp;<span class="op" id="1592911">=</span>&nbsp;<span class="num" id="1592913">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1592925">}</span>&nbsp;<span class="keyword" id="1592927">else</span>&nbsp;<span class="op" id="1592932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1592936">maxstacksize</span>&nbsp;<span class="op" id="1592949">=</span>&nbsp;<span class="num" id="1592951">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1592962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1592966">onM</span><span class="op" id="1592969">(</span><span class="ident" id="1592970">newsysmon</span><span class="op" id="1592979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1592983">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593042">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593106">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593166">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593228">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593286">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593312">lockOSThread</span><span class="op" id="1593324">(</span><span class="op" id="1593325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1593329">if</span>&nbsp;<span class="ident" id="1593332">g</span><span class="op" id="1593333">.</span><span class="ident" id="1593334">m</span>&nbsp;<span class="op" id="1593336">!=</span>&nbsp;<span class="op" id="1593339">&amp;</span><span class="ident" id="1593340">m0</span>&nbsp;<span class="op" id="1593343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593347">gothrow</span><span class="op" id="1593354">(</span><span class="string" id="1593355">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1593379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1593382">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593386">runtime_init</span><span class="op" id="1593398">(</span><span class="op" id="1593399">)</span>&nbsp;<span class="comment" id="1593401">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593427">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593500">needUnlock</span>&nbsp;<span class="op" id="1593511">:=</span>&nbsp;<span class="builtintype" id="1593514">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1593520">defer</span>&nbsp;<span class="keyword" id="1593526">func</span><span class="op" id="1593530">(</span><span class="op" id="1593531">)</span>&nbsp;<span class="op" id="1593533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1593537">if</span>&nbsp;<span class="ident" id="1593540">needUnlock</span>&nbsp;<span class="op" id="1593551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593556">unlockOSThread</span><span class="op" id="1593570">(</span><span class="op" id="1593571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1593575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1593578">}</span><span class="op" id="1593579">(</span><span class="op" id="1593580">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593584">memstats</span><span class="op" id="1593592">.</span><span class="ident" id="1593593">enablegc</span>&nbsp;<span class="op" id="1593602">=</span>&nbsp;<span class="builtintype" id="1593604">true</span>&nbsp;<span class="comment" id="1593609">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593658">main_init</span><span class="op" id="1593667">(</span><span class="op" id="1593668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593672">needUnlock</span>&nbsp;<span class="op" id="1593683">=</span>&nbsp;<span class="builtintype" id="1593685">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593692">unlockOSThread</span><span class="op" id="1593706">(</span><span class="op" id="1593707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593711">main_main</span><span class="op" id="1593720">(</span><span class="op" id="1593721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1593724">if</span>&nbsp;<span class="ident" id="1593727">raceenabled</span>&nbsp;<span class="op" id="1593739">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593743">racefini</span><span class="op" id="1593751">(</span><span class="op" id="1593752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1593755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593759">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593810">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593866">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1593927">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1593975">if</span>&nbsp;<span class="ident" id="1593978">panicking</span>&nbsp;<span class="op" id="1593988">!=</span>&nbsp;<span class="num" id="1593991">0</span>&nbsp;<span class="op" id="1593993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1593997">gopark</span><span class="op" id="1594003">(</span><span class="ident" id="1594004">nil</span><span class="op" id="1594007">,</span>&nbsp;<span class="ident" id="1594009">nil</span><span class="op" id="1594012">,</span>&nbsp;<span class="string" id="1594014">&#34;panicwait&#34;</span><span class="op" id="1594025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594028">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594032">exit</span><span class="op" id="1594036">(</span><span class="num" id="1594037">0</span><span class="op" id="1594038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594041">for</span>&nbsp;<span class="op" id="1594045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594049">var</span>&nbsp;<span class="ident" id="1594053">x</span>&nbsp;<span class="op" id="1594055">*</span><span class="builtintype" id="1594056">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594064">*</span><span class="ident" id="1594065">x</span>&nbsp;<span class="op" id="1594067">=</span>&nbsp;<span class="num" id="1594069">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594072">}</span><br>
<span class="lineno"></span><span class="op" id="1594074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1594077">var</span>&nbsp;<span class="ident" id="1594081">parkunlock_c</span>&nbsp;<span class="builtintype" id="1594094">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1594100">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1594134">func</span>&nbsp;<span class="ident" id="1594139">init</span><span class="op" id="1594143">(</span><span class="op" id="1594144">)</span>&nbsp;<span class="op" id="1594146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594149">go</span>&nbsp;<span class="ident" id="1594152">forcegchelper</span><span class="op" id="1594165">(</span><span class="op" id="1594166">)</span><br>
<span class="lineno"></span><span class="op" id="1594168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1594171">func</span>&nbsp;<span class="ident" id="1594176">forcegchelper</span><span class="op" id="1594189">(</span><span class="op" id="1594190">)</span>&nbsp;<span class="op" id="1594192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594195">forcegc</span><span class="op" id="1594202">.</span><span class="ident" id="1594203">g</span>&nbsp;<span class="op" id="1594205">=</span>&nbsp;<span class="ident" id="1594207">getg</span><span class="op" id="1594211">(</span><span class="op" id="1594212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594215">forcegc</span><span class="op" id="1594222">.</span><span class="ident" id="1594223">g</span><span class="op" id="1594224">.</span><span class="ident" id="1594225">issystem</span>&nbsp;<span class="op" id="1594234">=</span>&nbsp;<span class="builtintype" id="1594236">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594242">for</span>&nbsp;<span class="op" id="1594246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594250">lock</span><span class="op" id="1594254">(</span><span class="op" id="1594255">&amp;</span><span class="ident" id="1594256">forcegc</span><span class="op" id="1594263">.</span><span class="ident" id="1594264">lock</span><span class="op" id="1594268">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594272">if</span>&nbsp;<span class="ident" id="1594275">forcegc</span><span class="op" id="1594282">.</span><span class="ident" id="1594283">idle</span>&nbsp;<span class="op" id="1594288">!=</span>&nbsp;<span class="num" id="1594291">0</span>&nbsp;<span class="op" id="1594293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594298">gothrow</span><span class="op" id="1594305">(</span><span class="string" id="1594306">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1594328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594336">atomicstore</span><span class="op" id="1594347">(</span><span class="op" id="1594348">&amp;</span><span class="ident" id="1594349">forcegc</span><span class="op" id="1594356">.</span><span class="ident" id="1594357">idle</span><span class="op" id="1594361">,</span>&nbsp;<span class="num" id="1594363">1</span><span class="op" id="1594364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594368">goparkunlock</span><span class="op" id="1594380">(</span><span class="op" id="1594381">&amp;</span><span class="ident" id="1594382">forcegc</span><span class="op" id="1594389">.</span><span class="ident" id="1594390">lock</span><span class="op" id="1594394">,</span>&nbsp;<span class="string" id="1594396">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1594413">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1594417">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594469">if</span>&nbsp;<span class="ident" id="1594472">debug</span><span class="op" id="1594477">.</span><span class="ident" id="1594478">gctrace</span>&nbsp;<span class="op" id="1594486">&gt;</span>&nbsp;<span class="num" id="1594488">0</span>&nbsp;<span class="op" id="1594490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1594495">println</span><span class="op" id="1594502">(</span><span class="string" id="1594503">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1594514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594522">gogc</span><span class="op" id="1594526">(</span><span class="num" id="1594527">1</span><span class="op" id="1594528">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1594531">}</span><br>
<span class="lineno"></span><span class="op" id="1594533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1594536">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1594550">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1594630">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1594700">func</span>&nbsp;<span class="ident" id="1594705">Gosched</span><span class="op" id="1594712">(</span><span class="op" id="1594713">)</span>&nbsp;<span class="op" id="1594715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594718">mcall</span><span class="op" id="1594723">(</span><span class="ident" id="1594724">gosched_m</span><span class="op" id="1594733">)</span><br>
<span class="lineno"></span><span class="op" id="1594735">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1594738">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1594808">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1594863">func</span>&nbsp;<span class="ident" id="1594868">gopark</span><span class="op" id="1594874">(</span><span class="ident" id="1594875">unlockf</span>&nbsp;<span class="ident" id="1594883">unsafe</span><span class="op" id="1594889">.</span><span class="ident" id="1594890">Pointer</span><span class="op" id="1594897">,</span>&nbsp;<span class="ident" id="1594899">lock</span>&nbsp;<span class="ident" id="1594904">unsafe</span><span class="op" id="1594910">.</span><span class="ident" id="1594911">Pointer</span><span class="op" id="1594918">,</span>&nbsp;<span class="ident" id="1594920">reason</span>&nbsp;<span class="builtintype" id="1594927">string</span><span class="op" id="1594933">)</span>&nbsp;<span class="op" id="1594935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594938">mp</span>&nbsp;<span class="op" id="1594941">:=</span>&nbsp;<span class="ident" id="1594944">acquirem</span><span class="op" id="1594952">(</span><span class="op" id="1594953">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594956">gp</span>&nbsp;<span class="op" id="1594959">:=</span>&nbsp;<span class="ident" id="1594962">mp</span><span class="op" id="1594964">.</span><span class="ident" id="1594965">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1594971">status</span>&nbsp;<span class="op" id="1594978">:=</span>&nbsp;<span class="ident" id="1594981">readgstatus</span><span class="op" id="1594992">(</span><span class="ident" id="1594993">gp</span><span class="op" id="1594995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1594998">if</span>&nbsp;<span class="ident" id="1595001">status</span>&nbsp;<span class="op" id="1595008">!=</span>&nbsp;<span class="ident" id="1595011">_Grunning</span>&nbsp;<span class="op" id="1595021">&amp;&amp;</span>&nbsp;<span class="ident" id="1595024">status</span>&nbsp;<span class="op" id="1595031">!=</span>&nbsp;<span class="ident" id="1595034">_Gscanrunning</span>&nbsp;<span class="op" id="1595048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595052">gothrow</span><span class="op" id="1595059">(</span><span class="string" id="1595060">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1595082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1595085">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595088">mp</span><span class="op" id="1595090">.</span><span class="ident" id="1595091">waitlock</span>&nbsp;<span class="op" id="1595100">=</span>&nbsp;<span class="ident" id="1595102">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595108">mp</span><span class="op" id="1595110">.</span><span class="ident" id="1595111">waitunlockf</span>&nbsp;<span class="op" id="1595123">=</span>&nbsp;<span class="ident" id="1595125">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595134">gp</span><span class="op" id="1595136">.</span><span class="ident" id="1595137">waitreason</span>&nbsp;<span class="op" id="1595148">=</span>&nbsp;<span class="ident" id="1595150">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595158">releasem</span><span class="op" id="1595166">(</span><span class="ident" id="1595167">mp</span><span class="op" id="1595169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1595172">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595233">mcall</span><span class="op" id="1595238">(</span><span class="ident" id="1595239">park_m</span><span class="op" id="1595245">)</span><br>
<span class="lineno"></span><span class="op" id="1595247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1595250">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1595323">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1595391">func</span>&nbsp;<span class="ident" id="1595396">goparkunlock</span><span class="op" id="1595408">(</span><span class="ident" id="1595409">lock</span>&nbsp;<span class="op" id="1595414">*</span><span class="ident" id="1595415">mutex</span><span class="op" id="1595420">,</span>&nbsp;<span class="ident" id="1595422">reason</span>&nbsp;<span class="builtintype" id="1595429">string</span><span class="op" id="1595435">)</span>&nbsp;<span class="op" id="1595437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595440">gopark</span><span class="op" id="1595446">(</span><span class="ident" id="1595447">unsafe</span><span class="op" id="1595453">.</span><span class="ident" id="1595454">Pointer</span><span class="op" id="1595461">(</span><span class="op" id="1595462">&amp;</span><span class="ident" id="1595463">parkunlock_c</span><span class="op" id="1595475">)</span><span class="op" id="1595476">,</span>&nbsp;<span class="ident" id="1595478">unsafe</span><span class="op" id="1595484">.</span><span class="ident" id="1595485">Pointer</span><span class="op" id="1595492">(</span><span class="ident" id="1595493">lock</span><span class="op" id="1595497">)</span><span class="op" id="1595498">,</span>&nbsp;<span class="ident" id="1595500">reason</span><span class="op" id="1595506">)</span><br>
<span class="lineno"></span><span class="op" id="1595508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1595511">func</span>&nbsp;<span class="ident" id="1595516">goready</span><span class="op" id="1595523">(</span><span class="ident" id="1595524">gp</span>&nbsp;<span class="op" id="1595527">*</span><span class="ident" id="1595528">g</span><span class="op" id="1595529">)</span>&nbsp;<span class="op" id="1595531">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595534">mp</span>&nbsp;<span class="op" id="1595537">:=</span>&nbsp;<span class="ident" id="1595540">acquirem</span><span class="op" id="1595548">(</span><span class="op" id="1595549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595552">mp</span><span class="op" id="1595554">.</span><span class="ident" id="1595555">ptrarg</span><span class="op" id="1595561">[</span><span class="num" id="1595562">0</span><span class="op" id="1595563">]</span>&nbsp;<span class="op" id="1595565">=</span>&nbsp;<span class="ident" id="1595567">unsafe</span><span class="op" id="1595573">.</span><span class="ident" id="1595574">Pointer</span><span class="op" id="1595581">(</span><span class="ident" id="1595582">gp</span><span class="op" id="1595584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595587">onM</span><span class="op" id="1595590">(</span><span class="ident" id="1595591">ready_m</span><span class="op" id="1595598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595601">releasem</span><span class="op" id="1595609">(</span><span class="ident" id="1595610">mp</span><span class="op" id="1595612">)</span><br>
<span class="lineno"></span><span class="op" id="1595614">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1595617">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1595630">func</span>&nbsp;<span class="ident" id="1595635">acquireSudog</span><span class="op" id="1595647">(</span><span class="op" id="1595648">)</span>&nbsp;<span class="op" id="1595650">*</span><span class="ident" id="1595651">sudog</span>&nbsp;<span class="op" id="1595657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595660">c</span>&nbsp;<span class="op" id="1595662">:=</span>&nbsp;<span class="ident" id="1595665">gomcache</span><span class="op" id="1595673">(</span><span class="op" id="1595674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595677">s</span>&nbsp;<span class="op" id="1595679">:=</span>&nbsp;<span class="ident" id="1595682">c</span><span class="op" id="1595683">.</span><span class="ident" id="1595684">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1595696">if</span>&nbsp;<span class="ident" id="1595699">s</span>&nbsp;<span class="op" id="1595701">!=</span>&nbsp;<span class="ident" id="1595704">nil</span>&nbsp;<span class="op" id="1595708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1595712">if</span>&nbsp;<span class="ident" id="1595715">s</span><span class="op" id="1595716">.</span><span class="ident" id="1595717">elem</span>&nbsp;<span class="op" id="1595722">!=</span>&nbsp;<span class="ident" id="1595725">nil</span>&nbsp;<span class="op" id="1595729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595734">gothrow</span><span class="op" id="1595741">(</span><span class="string" id="1595742">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1595786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1595790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595794">c</span><span class="op" id="1595795">.</span><span class="ident" id="1595796">sudogcache</span>&nbsp;<span class="op" id="1595807">=</span>&nbsp;<span class="ident" id="1595809">s</span><span class="op" id="1595810">.</span><span class="ident" id="1595811">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1595818">s</span><span class="op" id="1595819">.</span><span class="ident" id="1595820">next</span>&nbsp;<span class="op" id="1595825">=</span>&nbsp;<span class="ident" id="1595827">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1595833">return</span>&nbsp;<span class="ident" id="1595840">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1595843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1595847">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1595902">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1595951">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1596012">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1596077">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1596098">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1596164">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1596228">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596286">mp</span>&nbsp;<span class="op" id="1596289">:=</span>&nbsp;<span class="ident" id="1596292">acquirem</span><span class="op" id="1596300">(</span><span class="op" id="1596301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596304">p</span>&nbsp;<span class="op" id="1596306">:=</span>&nbsp;<span class="builtinfunc" id="1596309">new</span><span class="op" id="1596312">(</span><span class="ident" id="1596313">sudog</span><span class="op" id="1596318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596321">releasem</span><span class="op" id="1596329">(</span><span class="ident" id="1596330">mp</span><span class="op" id="1596332">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596335">return</span>&nbsp;<span class="ident" id="1596342">p</span><br>
<span class="lineno"></span><span class="op" id="1596344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1596347">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1596360">func</span>&nbsp;<span class="ident" id="1596365">releaseSudog</span><span class="op" id="1596377">(</span><span class="ident" id="1596378">s</span>&nbsp;<span class="op" id="1596380">*</span><span class="ident" id="1596381">sudog</span><span class="op" id="1596386">)</span>&nbsp;<span class="op" id="1596388">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596391">if</span>&nbsp;<span class="ident" id="1596394">s</span><span class="op" id="1596395">.</span><span class="ident" id="1596396">elem</span>&nbsp;<span class="op" id="1596401">!=</span>&nbsp;<span class="ident" id="1596404">nil</span>&nbsp;<span class="op" id="1596408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596412">gothrow</span><span class="op" id="1596419">(</span><span class="string" id="1596420">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1596454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596460">if</span>&nbsp;<span class="ident" id="1596463">s</span><span class="op" id="1596464">.</span><span class="ident" id="1596465">selectdone</span>&nbsp;<span class="op" id="1596476">!=</span>&nbsp;<span class="ident" id="1596479">nil</span>&nbsp;<span class="op" id="1596483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596487">gothrow</span><span class="op" id="1596494">(</span><span class="string" id="1596495">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1596535">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596541">if</span>&nbsp;<span class="ident" id="1596544">s</span><span class="op" id="1596545">.</span><span class="ident" id="1596546">next</span>&nbsp;<span class="op" id="1596551">!=</span>&nbsp;<span class="ident" id="1596554">nil</span>&nbsp;<span class="op" id="1596558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596562">gothrow</span><span class="op" id="1596569">(</span><span class="string" id="1596570">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1596604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596610">if</span>&nbsp;<span class="ident" id="1596613">s</span><span class="op" id="1596614">.</span><span class="ident" id="1596615">prev</span>&nbsp;<span class="op" id="1596620">!=</span>&nbsp;<span class="ident" id="1596623">nil</span>&nbsp;<span class="op" id="1596627">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596631">gothrow</span><span class="op" id="1596638">(</span><span class="string" id="1596639">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1596673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596679">if</span>&nbsp;<span class="ident" id="1596682">s</span><span class="op" id="1596683">.</span><span class="ident" id="1596684">waitlink</span>&nbsp;<span class="op" id="1596693">!=</span>&nbsp;<span class="ident" id="1596696">nil</span>&nbsp;<span class="op" id="1596700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596704">gothrow</span><span class="op" id="1596711">(</span><span class="string" id="1596712">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1596750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596753">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596756">gp</span>&nbsp;<span class="op" id="1596759">:=</span>&nbsp;<span class="ident" id="1596762">getg</span><span class="op" id="1596766">(</span><span class="op" id="1596767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1596770">if</span>&nbsp;<span class="ident" id="1596773">gp</span><span class="op" id="1596775">.</span><span class="ident" id="1596776">param</span>&nbsp;<span class="op" id="1596782">!=</span>&nbsp;<span class="ident" id="1596785">nil</span>&nbsp;<span class="op" id="1596789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596793">gothrow</span><span class="op" id="1596800">(</span><span class="string" id="1596801">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1596846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1596849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596852">c</span>&nbsp;<span class="op" id="1596854">:=</span>&nbsp;<span class="ident" id="1596857">gomcache</span><span class="op" id="1596865">(</span><span class="op" id="1596866">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596869">s</span><span class="op" id="1596870">.</span><span class="ident" id="1596871">next</span>&nbsp;<span class="op" id="1596876">=</span>&nbsp;<span class="ident" id="1596878">c</span><span class="op" id="1596879">.</span><span class="ident" id="1596880">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1596892">c</span><span class="op" id="1596893">.</span><span class="ident" id="1596894">sudogcache</span>&nbsp;<span class="op" id="1596905">=</span>&nbsp;<span class="ident" id="1596907">s</span><br>
<span class="lineno"></span><span class="op" id="1596909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1596912">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1596962">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1597037">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1597050">func</span>&nbsp;<span class="ident" id="1597055">funcPC</span><span class="op" id="1597061">(</span><span class="ident" id="1597062">f</span>&nbsp;<span class="keyword" id="1597064">interface</span><span class="op" id="1597073">{</span><span class="op" id="1597074">}</span><span class="op" id="1597075">)</span>&nbsp;<span class="builtintype" id="1597077">uintptr</span>&nbsp;<span class="op" id="1597085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597088">return</span>&nbsp;<span class="op" id="1597095">*</span><span class="op" id="1597096">*</span><span class="op" id="1597097">(</span><span class="op" id="1597098">*</span><span class="op" id="1597099">*</span><span class="builtintype" id="1597100">uintptr</span><span class="op" id="1597107">)</span><span class="op" id="1597108">(</span><span class="ident" id="1597109">add</span><span class="op" id="1597112">(</span><span class="ident" id="1597113">unsafe</span><span class="op" id="1597119">.</span><span class="ident" id="1597120">Pointer</span><span class="op" id="1597127">(</span><span class="op" id="1597128">&amp;</span><span class="ident" id="1597129">f</span><span class="op" id="1597130">)</span><span class="op" id="1597131">,</span>&nbsp;<span class="ident" id="1597133">ptrSize</span><span class="op" id="1597140">)</span><span class="op" id="1597141">)</span><br>
<span class="lineno"></span><span class="op" id="1597143">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1597146">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1597170">func</span>&nbsp;<span class="ident" id="1597175">badmcall</span><span class="op" id="1597183">(</span><span class="ident" id="1597184">fn</span>&nbsp;<span class="keyword" id="1597187">func</span><span class="op" id="1597191">(</span><span class="op" id="1597192">*</span><span class="ident" id="1597193">g</span><span class="op" id="1597194">)</span><span class="op" id="1597195">)</span>&nbsp;<span class="op" id="1597197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597200">gothrow</span><span class="op" id="1597207">(</span><span class="string" id="1597208">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1597246">)</span><br>
<span class="lineno"></span><span class="op" id="1597248">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1597251">func</span>&nbsp;<span class="ident" id="1597256">badmcall2</span><span class="op" id="1597265">(</span><span class="ident" id="1597266">fn</span>&nbsp;<span class="keyword" id="1597269">func</span><span class="op" id="1597273">(</span><span class="op" id="1597274">*</span><span class="ident" id="1597275">g</span><span class="op" id="1597276">)</span><span class="op" id="1597277">)</span>&nbsp;<span class="op" id="1597279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597282">gothrow</span><span class="op" id="1597289">(</span><span class="string" id="1597290">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1597324">)</span><br>
<span class="lineno"></span><span class="op" id="1597326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1597329">func</span>&nbsp;<span class="ident" id="1597334">badreflectcall</span><span class="op" id="1597348">(</span><span class="op" id="1597349">)</span>&nbsp;<span class="op" id="1597351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1597354">panic</span><span class="op" id="1597359">(</span><span class="string" id="1597360">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1597409">)</span><br>
<span class="lineno"></span><span class="op" id="1597411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1597414">func</span>&nbsp;<span class="ident" id="1597419">lockedOSThread</span><span class="op" id="1597433">(</span><span class="op" id="1597434">)</span>&nbsp;<span class="builtintype" id="1597436">bool</span>&nbsp;<span class="op" id="1597441">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597444">gp</span>&nbsp;<span class="op" id="1597447">:=</span>&nbsp;<span class="ident" id="1597450">getg</span><span class="op" id="1597454">(</span><span class="op" id="1597455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597458">return</span>&nbsp;<span class="ident" id="1597465">gp</span><span class="op" id="1597467">.</span><span class="ident" id="1597468">lockedm</span>&nbsp;<span class="op" id="1597476">!=</span>&nbsp;<span class="ident" id="1597479">nil</span>&nbsp;<span class="op" id="1597483">&amp;&amp;</span>&nbsp;<span class="ident" id="1597486">gp</span><span class="op" id="1597488">.</span><span class="ident" id="1597489">m</span><span class="op" id="1597490">.</span><span class="ident" id="1597491">lockedg</span>&nbsp;<span class="op" id="1597499">!=</span>&nbsp;<span class="ident" id="1597502">nil</span><br>
<span class="lineno"></span><span class="op" id="1597506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1597509">func</span>&nbsp;<span class="ident" id="1597514">newP</span><span class="op" id="1597518">(</span><span class="op" id="1597519">)</span>&nbsp;<span class="op" id="1597521">*</span><span class="ident" id="1597522">p</span>&nbsp;<span class="op" id="1597524">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597527">return</span>&nbsp;<span class="builtinfunc" id="1597534">new</span><span class="op" id="1597537">(</span><span class="ident" id="1597538">p</span><span class="op" id="1597539">)</span><br>
<span class="lineno"></span><span class="op" id="1597541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1597544">func</span>&nbsp;<span class="ident" id="1597549">newM</span><span class="op" id="1597553">(</span><span class="op" id="1597554">)</span>&nbsp;<span class="op" id="1597556">*</span><span class="ident" id="1597557">m</span>&nbsp;<span class="op" id="1597559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597562">return</span>&nbsp;<span class="builtinfunc" id="1597569">new</span><span class="op" id="1597572">(</span><span class="ident" id="1597573">m</span><span class="op" id="1597574">)</span><br>
<span class="lineno">230</span><span class="op" id="1597576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1597579">func</span>&nbsp;<span class="ident" id="1597584">newG</span><span class="op" id="1597588">(</span><span class="op" id="1597589">)</span>&nbsp;<span class="op" id="1597591">*</span><span class="ident" id="1597592">g</span>&nbsp;<span class="op" id="1597594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597597">return</span>&nbsp;<span class="builtinfunc" id="1597604">new</span><span class="op" id="1597607">(</span><span class="ident" id="1597608">g</span><span class="op" id="1597609">)</span><br>
<span class="lineno"></span><span class="op" id="1597611">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1597614">func</span>&nbsp;<span class="ident" id="1597619">allgadd</span><span class="op" id="1597626">(</span><span class="ident" id="1597627">gp</span>&nbsp;<span class="op" id="1597630">*</span><span class="ident" id="1597631">g</span><span class="op" id="1597632">)</span>&nbsp;<span class="op" id="1597634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1597637">if</span>&nbsp;<span class="ident" id="1597640">readgstatus</span><span class="op" id="1597651">(</span><span class="ident" id="1597652">gp</span><span class="op" id="1597654">)</span>&nbsp;<span class="op" id="1597656">==</span>&nbsp;<span class="ident" id="1597659">_Gidle</span>&nbsp;<span class="op" id="1597666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597670">gothrow</span><span class="op" id="1597677">(</span><span class="string" id="1597678">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1597705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1597708">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597712">lock</span><span class="op" id="1597716">(</span><span class="op" id="1597717">&amp;</span><span class="ident" id="1597718">allglock</span><span class="op" id="1597726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597729">allgs</span>&nbsp;<span class="op" id="1597735">=</span>&nbsp;<span class="builtinfunc" id="1597737">append</span><span class="op" id="1597743">(</span><span class="ident" id="1597744">allgs</span><span class="op" id="1597749">,</span>&nbsp;<span class="ident" id="1597751">gp</span><span class="op" id="1597753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597756">allg</span>&nbsp;<span class="op" id="1597761">=</span>&nbsp;<span class="op" id="1597763">&amp;</span><span class="ident" id="1597764">allgs</span><span class="op" id="1597769">[</span><span class="num" id="1597770">0</span><span class="op" id="1597771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597774">allglen</span>&nbsp;<span class="op" id="1597782">=</span>&nbsp;<span class="builtintype" id="1597784">uintptr</span><span class="op" id="1597791">(</span><span class="builtinfunc" id="1597792">len</span><span class="op" id="1597795">(</span><span class="ident" id="1597796">allgs</span><span class="op" id="1597801">)</span><span class="op" id="1597802">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1597805">unlock</span><span class="op" id="1597811">(</span><span class="op" id="1597812">&amp;</span><span class="ident" id="1597813">allglock</span><span class="op" id="1597821">)</span><br>
<span class="lineno"></span><span class="op" id="1597823">}</span>
</div>
</body>
</html>
