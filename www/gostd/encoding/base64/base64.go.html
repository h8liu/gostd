<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html" class="current">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2054705">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2054760">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2054814">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2054865">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="2054936">package</span>&nbsp;<span class="ident" id="2054944">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2054952">import</span>&nbsp;<span class="op" id="2054959">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2054962">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2054971">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2054977">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2054988">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2054998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2055001">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2055022">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="2055090">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2055158">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="2055226">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2055296">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="2055359">type</span>&nbsp;<span class="ident" id="2055364">Encoding</span>&nbsp;<span class="keyword" id="2055373">struct</span>&nbsp;<span class="op" id="2055380">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055383">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2055393">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055401">decodeMap</span>&nbsp;<span class="op" id="2055411">[</span><span class="num" id="2055412">256</span><span class="op" id="2055415">]</span><span class="builtintype" id="2055416">byte</span><br>
<span class="lineno"></span><span class="op" id="2055421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2055424">const</span>&nbsp;<span class="ident" id="2055430">encodeStd</span>&nbsp;<span class="op" id="2055440">=</span>&nbsp;<span class="string" id="2055442">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="2055509">const</span>&nbsp;<span class="ident" id="2055515">encodeURL</span>&nbsp;<span class="op" id="2055525">=</span>&nbsp;<span class="string" id="2055527">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2055595">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="2055664">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2055699">func</span>&nbsp;<span class="ident" id="2055704">NewEncoding</span><span class="op" id="2055715">(</span><span class="ident" id="2055716">encoder</span>&nbsp;<span class="builtintype" id="2055724">string</span><span class="op" id="2055730">)</span>&nbsp;<span class="op" id="2055732">*</span><span class="ident" id="2055733">Encoding</span>&nbsp;<span class="op" id="2055742">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055745">e</span>&nbsp;<span class="op" id="2055747">:=</span>&nbsp;<span class="builtinfunc" id="2055750">new</span><span class="op" id="2055753">(</span><span class="ident" id="2055754">Encoding</span><span class="op" id="2055762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055765">e</span><span class="op" id="2055766">.</span><span class="ident" id="2055767">encode</span>&nbsp;<span class="op" id="2055774">=</span>&nbsp;<span class="ident" id="2055776">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2055785">for</span>&nbsp;<span class="ident" id="2055789">i</span>&nbsp;<span class="op" id="2055791">:=</span>&nbsp;<span class="num" id="2055794">0</span><span class="op" id="2055795">;</span>&nbsp;<span class="ident" id="2055797">i</span>&nbsp;<span class="op" id="2055799">&lt;</span>&nbsp;<span class="builtinfunc" id="2055801">len</span><span class="op" id="2055804">(</span><span class="ident" id="2055805">e</span><span class="op" id="2055806">.</span><span class="ident" id="2055807">decodeMap</span><span class="op" id="2055816">)</span><span class="op" id="2055817">;</span>&nbsp;<span class="ident" id="2055819">i</span><span class="op" id="2055820">++</span>&nbsp;<span class="op" id="2055823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055827">e</span><span class="op" id="2055828">.</span><span class="ident" id="2055829">decodeMap</span><span class="op" id="2055838">[</span><span class="ident" id="2055839">i</span><span class="op" id="2055840">]</span>&nbsp;<span class="op" id="2055842">=</span>&nbsp;<span class="num" id="2055844">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2055850">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2055853">for</span>&nbsp;<span class="ident" id="2055857">i</span>&nbsp;<span class="op" id="2055859">:=</span>&nbsp;<span class="num" id="2055862">0</span><span class="op" id="2055863">;</span>&nbsp;<span class="ident" id="2055865">i</span>&nbsp;<span class="op" id="2055867">&lt;</span>&nbsp;<span class="builtinfunc" id="2055869">len</span><span class="op" id="2055872">(</span><span class="ident" id="2055873">encoder</span><span class="op" id="2055880">)</span><span class="op" id="2055881">;</span>&nbsp;<span class="ident" id="2055883">i</span><span class="op" id="2055884">++</span>&nbsp;<span class="op" id="2055887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2055891">e</span><span class="op" id="2055892">.</span><span class="ident" id="2055893">decodeMap</span><span class="op" id="2055902">[</span><span class="ident" id="2055903">encoder</span><span class="op" id="2055910">[</span><span class="ident" id="2055911">i</span><span class="op" id="2055912">]</span><span class="op" id="2055913">]</span>&nbsp;<span class="op" id="2055915">=</span>&nbsp;<span class="builtintype" id="2055917">byte</span><span class="op" id="2055921">(</span><span class="ident" id="2055922">i</span><span class="op" id="2055923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2055926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2055929">return</span>&nbsp;<span class="ident" id="2055936">e</span><br>
<span class="lineno"></span><span class="op" id="2055938">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2055941">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2056003">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="2056016">var</span>&nbsp;<span class="ident" id="2056020">StdEncoding</span>&nbsp;<span class="op" id="2056032">=</span>&nbsp;<span class="ident" id="2056034">NewEncoding</span><span class="op" id="2056045">(</span><span class="ident" id="2056046">encodeStd</span><span class="op" id="2056055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2056058">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="2056127">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="2056175">var</span>&nbsp;<span class="ident" id="2056179">URLEncoding</span>&nbsp;<span class="op" id="2056191">=</span>&nbsp;<span class="ident" id="2056193">NewEncoding</span><span class="op" id="2056204">(</span><span class="ident" id="2056205">encodeURL</span><span class="op" id="2056214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2056217">var</span>&nbsp;<span class="ident" id="2056221">removeNewlinesMapper</span>&nbsp;<span class="op" id="2056242">=</span>&nbsp;<span class="keyword" id="2056244">func</span><span class="op" id="2056248">(</span><span class="ident" id="2056249">r</span>&nbsp;<span class="builtintype" id="2056251">rune</span><span class="op" id="2056255">)</span>&nbsp;<span class="builtintype" id="2056257">rune</span>&nbsp;<span class="op" id="2056262">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056265">if</span>&nbsp;<span class="ident" id="2056268">r</span>&nbsp;<span class="op" id="2056270">==</span>&nbsp;<span class="string" id="2056273">&#39;\r&#39;</span>&nbsp;<span class="op" id="2056278">||</span>&nbsp;<span class="ident" id="2056281">r</span>&nbsp;<span class="op" id="2056283">==</span>&nbsp;<span class="string" id="2056286">&#39;\n&#39;</span>&nbsp;<span class="op" id="2056291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056295">return</span>&nbsp;<span class="op" id="2056302">-</span><span class="num" id="2056303">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2056306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056309">return</span>&nbsp;<span class="ident" id="2056316">r</span><br>
<span class="lineno"></span><span class="op" id="2056318">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="2056321">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2056340">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="2056394">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="2056432">//</span><br>
<span class="lineno"></span><span class="comment" id="2056435">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="2056493">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="2056554">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="2056608">func</span>&nbsp;<span class="op" id="2056613">(</span><span class="ident" id="2056614">enc</span>&nbsp;<span class="op" id="2056618">*</span><span class="ident" id="2056619">Encoding</span><span class="op" id="2056627">)</span>&nbsp;<span class="ident" id="2056629">Encode</span><span class="op" id="2056635">(</span><span class="ident" id="2056636">dst</span><span class="op" id="2056639">,</span>&nbsp;<span class="ident" id="2056641">src</span>&nbsp;<span class="op" id="2056645">[</span><span class="op" id="2056646">]</span><span class="builtintype" id="2056647">byte</span><span class="op" id="2056651">)</span>&nbsp;<span class="op" id="2056653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056656">if</span>&nbsp;<span class="builtinfunc" id="2056659">len</span><span class="op" id="2056662">(</span><span class="ident" id="2056663">src</span><span class="op" id="2056666">)</span>&nbsp;<span class="op" id="2056668">==</span>&nbsp;<span class="num" id="2056671">0</span>&nbsp;<span class="op" id="2056673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056677">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2056685">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056689">for</span>&nbsp;<span class="builtinfunc" id="2056693">len</span><span class="op" id="2056696">(</span><span class="ident" id="2056697">src</span><span class="op" id="2056700">)</span>&nbsp;<span class="op" id="2056702">&gt;</span>&nbsp;<span class="num" id="2056704">0</span>&nbsp;<span class="op" id="2056706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056710">var</span>&nbsp;<span class="ident" id="2056714">b0</span><span class="op" id="2056716">,</span>&nbsp;<span class="ident" id="2056718">b1</span><span class="op" id="2056720">,</span>&nbsp;<span class="ident" id="2056722">b2</span><span class="op" id="2056724">,</span>&nbsp;<span class="ident" id="2056726">b3</span>&nbsp;<span class="builtintype" id="2056729">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2056737">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2056786">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056811">switch</span>&nbsp;<span class="builtinfunc" id="2056818">len</span><span class="op" id="2056821">(</span><span class="ident" id="2056822">src</span><span class="op" id="2056825">)</span>&nbsp;<span class="op" id="2056827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056831">default</span><span class="op" id="2056838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2056843">b3</span>&nbsp;<span class="op" id="2056846">=</span>&nbsp;<span class="ident" id="2056848">src</span><span class="op" id="2056851">[</span><span class="num" id="2056852">2</span><span class="op" id="2056853">]</span>&nbsp;<span class="op" id="2056855">&amp;</span>&nbsp;<span class="num" id="2056857">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2056865">b2</span>&nbsp;<span class="op" id="2056868">=</span>&nbsp;<span class="ident" id="2056870">src</span><span class="op" id="2056873">[</span><span class="num" id="2056874">2</span><span class="op" id="2056875">]</span>&nbsp;<span class="op" id="2056877">&gt;&gt;</span>&nbsp;<span class="num" id="2056880">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056885">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056899">case</span>&nbsp;<span class="num" id="2056904">2</span><span class="op" id="2056905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2056910">b2</span>&nbsp;<span class="op" id="2056913">|=</span>&nbsp;<span class="op" id="2056916">(</span><span class="ident" id="2056917">src</span><span class="op" id="2056920">[</span><span class="num" id="2056921">1</span><span class="op" id="2056922">]</span>&nbsp;<span class="op" id="2056924">&lt;&lt;</span>&nbsp;<span class="num" id="2056927">2</span><span class="op" id="2056928">)</span>&nbsp;<span class="op" id="2056930">&amp;</span>&nbsp;<span class="num" id="2056932">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2056940">b1</span>&nbsp;<span class="op" id="2056943">=</span>&nbsp;<span class="ident" id="2056945">src</span><span class="op" id="2056948">[</span><span class="num" id="2056949">1</span><span class="op" id="2056950">]</span>&nbsp;<span class="op" id="2056952">&gt;&gt;</span>&nbsp;<span class="num" id="2056955">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056960">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2056974">case</span>&nbsp;<span class="num" id="2056979">1</span><span class="op" id="2056980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2056985">b1</span>&nbsp;<span class="op" id="2056988">|=</span>&nbsp;<span class="op" id="2056991">(</span><span class="ident" id="2056992">src</span><span class="op" id="2056995">[</span><span class="num" id="2056996">0</span><span class="op" id="2056997">]</span>&nbsp;<span class="op" id="2056999">&lt;&lt;</span>&nbsp;<span class="num" id="2057002">4</span><span class="op" id="2057003">)</span>&nbsp;<span class="op" id="2057005">&amp;</span>&nbsp;<span class="num" id="2057007">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057015">b0</span>&nbsp;<span class="op" id="2057018">=</span>&nbsp;<span class="ident" id="2057020">src</span><span class="op" id="2057023">[</span><span class="num" id="2057024">0</span><span class="op" id="2057025">]</span>&nbsp;<span class="op" id="2057027">&gt;&gt;</span>&nbsp;<span class="num" id="2057030">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2057039">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057090">dst</span><span class="op" id="2057093">[</span><span class="num" id="2057094">0</span><span class="op" id="2057095">]</span>&nbsp;<span class="op" id="2057097">=</span>&nbsp;<span class="ident" id="2057099">enc</span><span class="op" id="2057102">.</span><span class="ident" id="2057103">encode</span><span class="op" id="2057109">[</span><span class="ident" id="2057110">b0</span><span class="op" id="2057112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057116">dst</span><span class="op" id="2057119">[</span><span class="num" id="2057120">1</span><span class="op" id="2057121">]</span>&nbsp;<span class="op" id="2057123">=</span>&nbsp;<span class="ident" id="2057125">enc</span><span class="op" id="2057128">.</span><span class="ident" id="2057129">encode</span><span class="op" id="2057135">[</span><span class="ident" id="2057136">b1</span><span class="op" id="2057138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057142">dst</span><span class="op" id="2057145">[</span><span class="num" id="2057146">2</span><span class="op" id="2057147">]</span>&nbsp;<span class="op" id="2057149">=</span>&nbsp;<span class="ident" id="2057151">enc</span><span class="op" id="2057154">.</span><span class="ident" id="2057155">encode</span><span class="op" id="2057161">[</span><span class="ident" id="2057162">b2</span><span class="op" id="2057164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057168">dst</span><span class="op" id="2057171">[</span><span class="num" id="2057172">3</span><span class="op" id="2057173">]</span>&nbsp;<span class="op" id="2057175">=</span>&nbsp;<span class="ident" id="2057177">enc</span><span class="op" id="2057180">.</span><span class="ident" id="2057181">encode</span><span class="op" id="2057187">[</span><span class="ident" id="2057188">b3</span><span class="op" id="2057190">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2057195">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057222">if</span>&nbsp;<span class="builtinfunc" id="2057225">len</span><span class="op" id="2057228">(</span><span class="ident" id="2057229">src</span><span class="op" id="2057232">)</span>&nbsp;<span class="op" id="2057234">&lt;</span>&nbsp;<span class="num" id="2057236">3</span>&nbsp;<span class="op" id="2057238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057243">dst</span><span class="op" id="2057246">[</span><span class="num" id="2057247">3</span><span class="op" id="2057248">]</span>&nbsp;<span class="op" id="2057250">=</span>&nbsp;<span class="string" id="2057252">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057259">if</span>&nbsp;<span class="builtinfunc" id="2057262">len</span><span class="op" id="2057265">(</span><span class="ident" id="2057266">src</span><span class="op" id="2057269">)</span>&nbsp;<span class="op" id="2057271">&lt;</span>&nbsp;<span class="num" id="2057273">2</span>&nbsp;<span class="op" id="2057275">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057281">dst</span><span class="op" id="2057284">[</span><span class="num" id="2057285">2</span><span class="op" id="2057286">]</span>&nbsp;<span class="op" id="2057288">=</span>&nbsp;<span class="string" id="2057290">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057302">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057315">src</span>&nbsp;<span class="op" id="2057319">=</span>&nbsp;<span class="ident" id="2057321">src</span><span class="op" id="2057324">[</span><span class="num" id="2057325">3</span><span class="op" id="2057326">:</span><span class="op" id="2057327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057331">dst</span>&nbsp;<span class="op" id="2057335">=</span>&nbsp;<span class="ident" id="2057337">dst</span><span class="op" id="2057340">[</span><span class="num" id="2057341">4</span><span class="op" id="2057342">:</span><span class="op" id="2057343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057346">}</span><br>
<span class="lineno"></span><span class="op" id="2057348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2057351">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="2057405">func</span>&nbsp;<span class="op" id="2057410">(</span><span class="ident" id="2057411">enc</span>&nbsp;<span class="op" id="2057415">*</span><span class="ident" id="2057416">Encoding</span><span class="op" id="2057424">)</span>&nbsp;<span class="ident" id="2057426">EncodeToString</span><span class="op" id="2057440">(</span><span class="ident" id="2057441">src</span>&nbsp;<span class="op" id="2057445">[</span><span class="op" id="2057446">]</span><span class="builtintype" id="2057447">byte</span><span class="op" id="2057451">)</span>&nbsp;<span class="builtintype" id="2057453">string</span>&nbsp;<span class="op" id="2057460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057463">buf</span>&nbsp;<span class="op" id="2057467">:=</span>&nbsp;<span class="builtinfunc" id="2057470">make</span><span class="op" id="2057474">(</span><span class="op" id="2057475">[</span><span class="op" id="2057476">]</span><span class="builtintype" id="2057477">byte</span><span class="op" id="2057481">,</span>&nbsp;<span class="ident" id="2057483">enc</span><span class="op" id="2057486">.</span><span class="ident" id="2057487">EncodedLen</span><span class="op" id="2057497">(</span><span class="builtinfunc" id="2057498">len</span><span class="op" id="2057501">(</span><span class="ident" id="2057502">src</span><span class="op" id="2057505">)</span><span class="op" id="2057506">)</span><span class="op" id="2057507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057510">enc</span><span class="op" id="2057513">.</span><span class="ident" id="2057514">Encode</span><span class="op" id="2057520">(</span><span class="ident" id="2057521">buf</span><span class="op" id="2057524">,</span>&nbsp;<span class="ident" id="2057526">src</span><span class="op" id="2057529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057532">return</span>&nbsp;<span class="builtintype" id="2057539">string</span><span class="op" id="2057545">(</span><span class="ident" id="2057546">buf</span><span class="op" id="2057549">)</span><br>
<span class="lineno">120</span><span class="op" id="2057551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2057554">type</span>&nbsp;<span class="ident" id="2057559">encoder</span>&nbsp;<span class="keyword" id="2057567">struct</span>&nbsp;<span class="op" id="2057574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057577">err</span>&nbsp;&nbsp;<span class="builtintype" id="2057582">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057589">enc</span>&nbsp;&nbsp;<span class="op" id="2057594">*</span><span class="ident" id="2057595">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057605">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057610">io</span><span class="op" id="2057612">.</span><span class="ident" id="2057613">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057621">buf</span>&nbsp;&nbsp;<span class="op" id="2057626">[</span><span class="num" id="2057627">3</span><span class="op" id="2057628">]</span><span class="builtintype" id="2057629">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2057637">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057677">nbuf</span>&nbsp;<span class="builtintype" id="2057682">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2057693">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057720">out</span>&nbsp;&nbsp;<span class="op" id="2057725">[</span><span class="num" id="2057726">1024</span><span class="op" id="2057730">]</span><span class="builtintype" id="2057731">byte</span>&nbsp;<span class="comment" id="2057736">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="2057753">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="2057756">func</span>&nbsp;<span class="op" id="2057761">(</span><span class="ident" id="2057762">e</span>&nbsp;<span class="op" id="2057764">*</span><span class="ident" id="2057765">encoder</span><span class="op" id="2057772">)</span>&nbsp;<span class="ident" id="2057774">Write</span><span class="op" id="2057779">(</span><span class="ident" id="2057780">p</span>&nbsp;<span class="op" id="2057782">[</span><span class="op" id="2057783">]</span><span class="builtintype" id="2057784">byte</span><span class="op" id="2057788">)</span>&nbsp;<span class="op" id="2057790">(</span><span class="ident" id="2057791">n</span>&nbsp;<span class="builtintype" id="2057793">int</span><span class="op" id="2057796">,</span>&nbsp;<span class="ident" id="2057798">err</span>&nbsp;<span class="builtintype" id="2057802">error</span><span class="op" id="2057807">)</span>&nbsp;<span class="op" id="2057809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057812">if</span>&nbsp;<span class="ident" id="2057815">e</span><span class="op" id="2057816">.</span><span class="ident" id="2057817">err</span>&nbsp;<span class="op" id="2057821">!=</span>&nbsp;<span class="builtintype" id="2057824">nil</span>&nbsp;<span class="op" id="2057828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057832">return</span>&nbsp;<span class="num" id="2057839">0</span><span class="op" id="2057840">,</span>&nbsp;<span class="ident" id="2057842">e</span><span class="op" id="2057843">.</span><span class="ident" id="2057844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057849">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2057853">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057873">if</span>&nbsp;<span class="ident" id="2057876">e</span><span class="op" id="2057877">.</span><span class="ident" id="2057878">nbuf</span>&nbsp;<span class="op" id="2057883">&gt;</span>&nbsp;<span class="num" id="2057885">0</span>&nbsp;<span class="op" id="2057887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057891">var</span>&nbsp;<span class="ident" id="2057895">i</span>&nbsp;<span class="builtintype" id="2057897">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2057903">for</span>&nbsp;<span class="ident" id="2057907">i</span>&nbsp;<span class="op" id="2057909">=</span>&nbsp;<span class="num" id="2057911">0</span><span class="op" id="2057912">;</span>&nbsp;<span class="ident" id="2057914">i</span>&nbsp;<span class="op" id="2057916">&lt;</span>&nbsp;<span class="builtinfunc" id="2057918">len</span><span class="op" id="2057921">(</span><span class="ident" id="2057922">p</span><span class="op" id="2057923">)</span>&nbsp;<span class="op" id="2057925">&amp;&amp;</span>&nbsp;<span class="ident" id="2057928">e</span><span class="op" id="2057929">.</span><span class="ident" id="2057930">nbuf</span>&nbsp;<span class="op" id="2057935">&lt;</span>&nbsp;<span class="num" id="2057937">3</span><span class="op" id="2057938">;</span>&nbsp;<span class="ident" id="2057940">i</span><span class="op" id="2057941">++</span>&nbsp;<span class="op" id="2057944">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057949">e</span><span class="op" id="2057950">.</span><span class="ident" id="2057951">buf</span><span class="op" id="2057954">[</span><span class="ident" id="2057955">e</span><span class="op" id="2057956">.</span><span class="ident" id="2057957">nbuf</span><span class="op" id="2057961">]</span>&nbsp;<span class="op" id="2057963">=</span>&nbsp;<span class="ident" id="2057965">p</span><span class="op" id="2057966">[</span><span class="ident" id="2057967">i</span><span class="op" id="2057968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057973">e</span><span class="op" id="2057974">.</span><span class="ident" id="2057975">nbuf</span><span class="op" id="2057979">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2057984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057988">n</span>&nbsp;<span class="op" id="2057990">+=</span>&nbsp;<span class="ident" id="2057993">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2057997">p</span>&nbsp;<span class="op" id="2057999">=</span>&nbsp;<span class="ident" id="2058001">p</span><span class="op" id="2058002">[</span><span class="ident" id="2058003">i</span><span class="op" id="2058004">:</span><span class="op" id="2058005">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058009">if</span>&nbsp;<span class="ident" id="2058012">e</span><span class="op" id="2058013">.</span><span class="ident" id="2058014">nbuf</span>&nbsp;<span class="op" id="2058019">&lt;</span>&nbsp;<span class="num" id="2058021">3</span>&nbsp;<span class="op" id="2058023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058041">e</span><span class="op" id="2058042">.</span><span class="ident" id="2058043">enc</span><span class="op" id="2058046">.</span><span class="ident" id="2058047">Encode</span><span class="op" id="2058053">(</span><span class="ident" id="2058054">e</span><span class="op" id="2058055">.</span><span class="ident" id="2058056">out</span><span class="op" id="2058059">[</span><span class="num" id="2058060">0</span><span class="op" id="2058061">:</span><span class="op" id="2058062">]</span><span class="op" id="2058063">,</span>&nbsp;<span class="ident" id="2058065">e</span><span class="op" id="2058066">.</span><span class="ident" id="2058067">buf</span><span class="op" id="2058070">[</span><span class="num" id="2058071">0</span><span class="op" id="2058072">:</span><span class="op" id="2058073">]</span><span class="op" id="2058074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058078">if</span>&nbsp;<span class="ident" id="2058081">_</span><span class="op" id="2058082">,</span>&nbsp;<span class="ident" id="2058084">e</span><span class="op" id="2058085">.</span><span class="ident" id="2058086">err</span>&nbsp;<span class="op" id="2058090">=</span>&nbsp;<span class="ident" id="2058092">e</span><span class="op" id="2058093">.</span><span class="ident" id="2058094">w</span><span class="op" id="2058095">.</span><span class="ident" id="2058096">Write</span><span class="op" id="2058101">(</span><span class="ident" id="2058102">e</span><span class="op" id="2058103">.</span><span class="ident" id="2058104">out</span><span class="op" id="2058107">[</span><span class="num" id="2058108">0</span><span class="op" id="2058109">:</span><span class="num" id="2058110">4</span><span class="op" id="2058111">]</span><span class="op" id="2058112">)</span><span class="op" id="2058113">;</span>&nbsp;<span class="ident" id="2058115">e</span><span class="op" id="2058116">.</span><span class="ident" id="2058117">err</span>&nbsp;<span class="op" id="2058121">!=</span>&nbsp;<span class="builtintype" id="2058124">nil</span>&nbsp;<span class="op" id="2058128">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058133">return</span>&nbsp;<span class="ident" id="2058140">n</span><span class="op" id="2058141">,</span>&nbsp;<span class="ident" id="2058143">e</span><span class="op" id="2058144">.</span><span class="ident" id="2058145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058155">e</span><span class="op" id="2058156">.</span><span class="ident" id="2058157">nbuf</span>&nbsp;<span class="op" id="2058162">=</span>&nbsp;<span class="num" id="2058164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2058171">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058198">for</span>&nbsp;<span class="builtinfunc" id="2058202">len</span><span class="op" id="2058205">(</span><span class="ident" id="2058206">p</span><span class="op" id="2058207">)</span>&nbsp;<span class="op" id="2058209">&gt;=</span>&nbsp;<span class="num" id="2058212">3</span>&nbsp;<span class="op" id="2058214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058218">nn</span>&nbsp;<span class="op" id="2058221">:=</span>&nbsp;<span class="builtinfunc" id="2058224">len</span><span class="op" id="2058227">(</span><span class="ident" id="2058228">e</span><span class="op" id="2058229">.</span><span class="ident" id="2058230">out</span><span class="op" id="2058233">)</span>&nbsp;<span class="op" id="2058235">/</span>&nbsp;<span class="num" id="2058237">4</span>&nbsp;<span class="op" id="2058239">*</span>&nbsp;<span class="num" id="2058241">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058245">if</span>&nbsp;<span class="ident" id="2058248">nn</span>&nbsp;<span class="op" id="2058251">&gt;</span>&nbsp;<span class="builtinfunc" id="2058253">len</span><span class="op" id="2058256">(</span><span class="ident" id="2058257">p</span><span class="op" id="2058258">)</span>&nbsp;<span class="op" id="2058260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058265">nn</span>&nbsp;<span class="op" id="2058268">=</span>&nbsp;<span class="builtinfunc" id="2058270">len</span><span class="op" id="2058273">(</span><span class="ident" id="2058274">p</span><span class="op" id="2058275">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058280">nn</span>&nbsp;<span class="op" id="2058283">-=</span>&nbsp;<span class="ident" id="2058286">nn</span>&nbsp;<span class="op" id="2058289">%</span>&nbsp;<span class="num" id="2058291">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058299">e</span><span class="op" id="2058300">.</span><span class="ident" id="2058301">enc</span><span class="op" id="2058304">.</span><span class="ident" id="2058305">Encode</span><span class="op" id="2058311">(</span><span class="ident" id="2058312">e</span><span class="op" id="2058313">.</span><span class="ident" id="2058314">out</span><span class="op" id="2058317">[</span><span class="num" id="2058318">0</span><span class="op" id="2058319">:</span><span class="op" id="2058320">]</span><span class="op" id="2058321">,</span>&nbsp;<span class="ident" id="2058323">p</span><span class="op" id="2058324">[</span><span class="num" id="2058325">0</span><span class="op" id="2058326">:</span><span class="ident" id="2058327">nn</span><span class="op" id="2058329">]</span><span class="op" id="2058330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058334">if</span>&nbsp;<span class="ident" id="2058337">_</span><span class="op" id="2058338">,</span>&nbsp;<span class="ident" id="2058340">e</span><span class="op" id="2058341">.</span><span class="ident" id="2058342">err</span>&nbsp;<span class="op" id="2058346">=</span>&nbsp;<span class="ident" id="2058348">e</span><span class="op" id="2058349">.</span><span class="ident" id="2058350">w</span><span class="op" id="2058351">.</span><span class="ident" id="2058352">Write</span><span class="op" id="2058357">(</span><span class="ident" id="2058358">e</span><span class="op" id="2058359">.</span><span class="ident" id="2058360">out</span><span class="op" id="2058363">[</span><span class="num" id="2058364">0</span>&nbsp;<span class="op" id="2058366">:</span>&nbsp;<span class="ident" id="2058368">nn</span><span class="op" id="2058370">/</span><span class="num" id="2058371">3</span><span class="op" id="2058372">*</span><span class="num" id="2058373">4</span><span class="op" id="2058374">]</span><span class="op" id="2058375">)</span><span class="op" id="2058376">;</span>&nbsp;<span class="ident" id="2058378">e</span><span class="op" id="2058379">.</span><span class="ident" id="2058380">err</span>&nbsp;<span class="op" id="2058384">!=</span>&nbsp;<span class="builtintype" id="2058387">nil</span>&nbsp;<span class="op" id="2058391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058396">return</span>&nbsp;<span class="ident" id="2058403">n</span><span class="op" id="2058404">,</span>&nbsp;<span class="ident" id="2058406">e</span><span class="op" id="2058407">.</span><span class="ident" id="2058408">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058418">n</span>&nbsp;<span class="op" id="2058420">+=</span>&nbsp;<span class="ident" id="2058423">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058428">p</span>&nbsp;<span class="op" id="2058430">=</span>&nbsp;<span class="ident" id="2058432">p</span><span class="op" id="2058433">[</span><span class="ident" id="2058434">nn</span><span class="op" id="2058436">:</span><span class="op" id="2058437">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2058444">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058465">for</span>&nbsp;<span class="ident" id="2058469">i</span>&nbsp;<span class="op" id="2058471">:=</span>&nbsp;<span class="num" id="2058474">0</span><span class="op" id="2058475">;</span>&nbsp;<span class="ident" id="2058477">i</span>&nbsp;<span class="op" id="2058479">&lt;</span>&nbsp;<span class="builtinfunc" id="2058481">len</span><span class="op" id="2058484">(</span><span class="ident" id="2058485">p</span><span class="op" id="2058486">)</span><span class="op" id="2058487">;</span>&nbsp;<span class="ident" id="2058489">i</span><span class="op" id="2058490">++</span>&nbsp;<span class="op" id="2058493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058497">e</span><span class="op" id="2058498">.</span><span class="ident" id="2058499">buf</span><span class="op" id="2058502">[</span><span class="ident" id="2058503">i</span><span class="op" id="2058504">]</span>&nbsp;<span class="op" id="2058506">=</span>&nbsp;<span class="ident" id="2058508">p</span><span class="op" id="2058509">[</span><span class="ident" id="2058510">i</span><span class="op" id="2058511">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058517">e</span><span class="op" id="2058518">.</span><span class="ident" id="2058519">nbuf</span>&nbsp;<span class="op" id="2058524">=</span>&nbsp;<span class="builtinfunc" id="2058526">len</span><span class="op" id="2058529">(</span><span class="ident" id="2058530">p</span><span class="op" id="2058531">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058534">n</span>&nbsp;<span class="op" id="2058536">+=</span>&nbsp;<span class="builtinfunc" id="2058539">len</span><span class="op" id="2058542">(</span><span class="ident" id="2058543">p</span><span class="op" id="2058544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058547">return</span><br>
<span class="lineno"></span><span class="op" id="2058554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2058557">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="2058611">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2058664">func</span>&nbsp;<span class="op" id="2058669">(</span><span class="ident" id="2058670">e</span>&nbsp;<span class="op" id="2058672">*</span><span class="ident" id="2058673">encoder</span><span class="op" id="2058680">)</span>&nbsp;<span class="ident" id="2058682">Close</span><span class="op" id="2058687">(</span><span class="op" id="2058688">)</span>&nbsp;<span class="builtintype" id="2058690">error</span>&nbsp;<span class="op" id="2058696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2058699">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058756">if</span>&nbsp;<span class="ident" id="2058759">e</span><span class="op" id="2058760">.</span><span class="ident" id="2058761">err</span>&nbsp;<span class="op" id="2058765">==</span>&nbsp;<span class="builtintype" id="2058768">nil</span>&nbsp;<span class="op" id="2058772">&amp;&amp;</span>&nbsp;<span class="ident" id="2058775">e</span><span class="op" id="2058776">.</span><span class="ident" id="2058777">nbuf</span>&nbsp;<span class="op" id="2058782">&gt;</span>&nbsp;<span class="num" id="2058784">0</span>&nbsp;<span class="op" id="2058786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058790">e</span><span class="op" id="2058791">.</span><span class="ident" id="2058792">enc</span><span class="op" id="2058795">.</span><span class="ident" id="2058796">Encode</span><span class="op" id="2058802">(</span><span class="ident" id="2058803">e</span><span class="op" id="2058804">.</span><span class="ident" id="2058805">out</span><span class="op" id="2058808">[</span><span class="num" id="2058809">0</span><span class="op" id="2058810">:</span><span class="op" id="2058811">]</span><span class="op" id="2058812">,</span>&nbsp;<span class="ident" id="2058814">e</span><span class="op" id="2058815">.</span><span class="ident" id="2058816">buf</span><span class="op" id="2058819">[</span><span class="num" id="2058820">0</span><span class="op" id="2058821">:</span><span class="ident" id="2058822">e</span><span class="op" id="2058823">.</span><span class="ident" id="2058824">nbuf</span><span class="op" id="2058828">]</span><span class="op" id="2058829">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058833">e</span><span class="op" id="2058834">.</span><span class="ident" id="2058835">nbuf</span>&nbsp;<span class="op" id="2058840">=</span>&nbsp;<span class="num" id="2058842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2058846">_</span><span class="op" id="2058847">,</span>&nbsp;<span class="ident" id="2058849">e</span><span class="op" id="2058850">.</span><span class="ident" id="2058851">err</span>&nbsp;<span class="op" id="2058855">=</span>&nbsp;<span class="ident" id="2058857">e</span><span class="op" id="2058858">.</span><span class="ident" id="2058859">w</span><span class="op" id="2058860">.</span><span class="ident" id="2058861">Write</span><span class="op" id="2058866">(</span><span class="ident" id="2058867">e</span><span class="op" id="2058868">.</span><span class="ident" id="2058869">out</span><span class="op" id="2058872">[</span><span class="num" id="2058873">0</span><span class="op" id="2058874">:</span><span class="num" id="2058875">4</span><span class="op" id="2058876">]</span><span class="op" id="2058877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2058880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2058883">return</span>&nbsp;<span class="ident" id="2058890">e</span><span class="op" id="2058891">.</span><span class="ident" id="2058892">err</span><br>
<span class="lineno"></span><span class="op" id="2058896">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="2058899">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2058967">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="2059039">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="2059099">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="2059167">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="2059196">func</span>&nbsp;<span class="ident" id="2059201">NewEncoder</span><span class="op" id="2059211">(</span><span class="ident" id="2059212">enc</span>&nbsp;<span class="op" id="2059216">*</span><span class="ident" id="2059217">Encoding</span><span class="op" id="2059225">,</span>&nbsp;<span class="ident" id="2059227">w</span>&nbsp;<span class="ident" id="2059229">io</span><span class="op" id="2059231">.</span><span class="ident" id="2059232">Writer</span><span class="op" id="2059238">)</span>&nbsp;<span class="ident" id="2059240">io</span><span class="op" id="2059242">.</span><span class="ident" id="2059243">WriteCloser</span>&nbsp;<span class="op" id="2059255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2059258">return</span>&nbsp;<span class="op" id="2059265">&amp;</span><span class="ident" id="2059266">encoder</span><span class="op" id="2059273">{</span><span class="ident" id="2059274">enc</span><span class="op" id="2059277">:</span>&nbsp;<span class="ident" id="2059279">enc</span><span class="op" id="2059282">,</span>&nbsp;<span class="ident" id="2059284">w</span><span class="op" id="2059285">:</span>&nbsp;<span class="ident" id="2059287">w</span><span class="op" id="2059288">}</span><br>
<span class="lineno"></span><span class="op" id="2059290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="2059293">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="2059358">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="2059393">func</span>&nbsp;<span class="op" id="2059398">(</span><span class="ident" id="2059399">enc</span>&nbsp;<span class="op" id="2059403">*</span><span class="ident" id="2059404">Encoding</span><span class="op" id="2059412">)</span>&nbsp;<span class="ident" id="2059414">EncodedLen</span><span class="op" id="2059424">(</span><span class="ident" id="2059425">n</span>&nbsp;<span class="builtintype" id="2059427">int</span><span class="op" id="2059430">)</span>&nbsp;<span class="builtintype" id="2059432">int</span>&nbsp;<span class="op" id="2059436">{</span>&nbsp;<span class="keyword" id="2059438">return</span>&nbsp;<span class="op" id="2059445">(</span><span class="ident" id="2059446">n</span>&nbsp;<span class="op" id="2059448">+</span>&nbsp;<span class="num" id="2059450">2</span><span class="op" id="2059451">)</span>&nbsp;<span class="op" id="2059453">/</span>&nbsp;<span class="num" id="2059455">3</span>&nbsp;<span class="op" id="2059457">*</span>&nbsp;<span class="num" id="2059459">4</span>&nbsp;<span class="op" id="2059461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2059464">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2059483">type</span>&nbsp;<span class="ident" id="2059488">CorruptInputError</span>&nbsp;<span class="ident" id="2059506">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2059513">func</span>&nbsp;<span class="op" id="2059518">(</span><span class="ident" id="2059519">e</span>&nbsp;<span class="ident" id="2059521">CorruptInputError</span><span class="op" id="2059538">)</span>&nbsp;<span class="ident" id="2059540">Error</span><span class="op" id="2059545">(</span><span class="op" id="2059546">)</span>&nbsp;<span class="builtintype" id="2059548">string</span>&nbsp;<span class="op" id="2059555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2059558">return</span>&nbsp;<span class="string" id="2059565">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="2059602">+</span>&nbsp;<span class="ident" id="2059604">strconv</span><span class="op" id="2059611">.</span><span class="ident" id="2059612">FormatInt</span><span class="op" id="2059621">(</span><span class="ident" id="2059622">int64</span><span class="op" id="2059627">(</span><span class="ident" id="2059628">e</span><span class="op" id="2059629">)</span><span class="op" id="2059630">,</span>&nbsp;<span class="num" id="2059632">10</span><span class="op" id="2059634">)</span><br>
<span class="lineno"></span><span class="op" id="2059636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2059639">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="2059709">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="2059777">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="2059847">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="2059904">func</span>&nbsp;<span class="op" id="2059909">(</span><span class="ident" id="2059910">enc</span>&nbsp;<span class="op" id="2059914">*</span><span class="ident" id="2059915">Encoding</span><span class="op" id="2059923">)</span>&nbsp;<span class="ident" id="2059925">decode</span><span class="op" id="2059931">(</span><span class="ident" id="2059932">dst</span><span class="op" id="2059935">,</span>&nbsp;<span class="ident" id="2059937">src</span>&nbsp;<span class="op" id="2059941">[</span><span class="op" id="2059942">]</span><span class="builtintype" id="2059943">byte</span><span class="op" id="2059947">)</span>&nbsp;<span class="op" id="2059949">(</span><span class="ident" id="2059950">n</span>&nbsp;<span class="builtintype" id="2059952">int</span><span class="op" id="2059955">,</span>&nbsp;<span class="ident" id="2059957">end</span>&nbsp;<span class="builtintype" id="2059961">bool</span><span class="op" id="2059965">,</span>&nbsp;<span class="ident" id="2059967">err</span>&nbsp;<span class="builtintype" id="2059971">error</span><span class="op" id="2059976">)</span>&nbsp;<span class="op" id="2059978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2059981">olen</span>&nbsp;<span class="op" id="2059986">:=</span>&nbsp;<span class="builtinfunc" id="2059989">len</span><span class="op" id="2059992">(</span><span class="ident" id="2059993">src</span><span class="op" id="2059996">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2059999">for</span>&nbsp;<span class="builtinfunc" id="2060003">len</span><span class="op" id="2060006">(</span><span class="ident" id="2060007">src</span><span class="op" id="2060010">)</span>&nbsp;<span class="op" id="2060012">&gt;</span>&nbsp;<span class="num" id="2060014">0</span>&nbsp;<span class="op" id="2060016">&amp;&amp;</span>&nbsp;<span class="op" id="2060019">!</span><span class="ident" id="2060020">end</span>&nbsp;<span class="op" id="2060024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060028">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060074">var</span>&nbsp;<span class="ident" id="2060078">dbuf</span>&nbsp;<span class="op" id="2060083">[</span><span class="num" id="2060084">4</span><span class="op" id="2060085">]</span><span class="builtintype" id="2060086">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060093">dlen</span>&nbsp;<span class="op" id="2060098">:=</span>&nbsp;<span class="num" id="2060101">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060106">for</span>&nbsp;<span class="ident" id="2060110">j</span>&nbsp;<span class="op" id="2060112">:=</span>&nbsp;<span class="keyword" id="2060115">range</span>&nbsp;<span class="ident" id="2060121">dbuf</span>&nbsp;<span class="op" id="2060126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060131">if</span>&nbsp;<span class="builtinfunc" id="2060134">len</span><span class="op" id="2060137">(</span><span class="ident" id="2060138">src</span><span class="op" id="2060141">)</span>&nbsp;<span class="op" id="2060143">==</span>&nbsp;<span class="num" id="2060146">0</span>&nbsp;<span class="op" id="2060148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060154">return</span>&nbsp;<span class="ident" id="2060161">n</span><span class="op" id="2060162">,</span>&nbsp;<span class="builtintype" id="2060164">false</span><span class="op" id="2060169">,</span>&nbsp;<span class="ident" id="2060171">CorruptInputError</span><span class="op" id="2060188">(</span><span class="ident" id="2060189">olen</span>&nbsp;<span class="op" id="2060194">-</span>&nbsp;<span class="builtinfunc" id="2060196">len</span><span class="op" id="2060199">(</span><span class="ident" id="2060200">src</span><span class="op" id="2060203">)</span>&nbsp;<span class="op" id="2060205">-</span>&nbsp;<span class="ident" id="2060207">j</span><span class="op" id="2060208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060218">in</span>&nbsp;<span class="op" id="2060221">:=</span>&nbsp;<span class="ident" id="2060224">src</span><span class="op" id="2060227">[</span><span class="num" id="2060228">0</span><span class="op" id="2060229">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060234">src</span>&nbsp;<span class="op" id="2060238">=</span>&nbsp;<span class="ident" id="2060240">src</span><span class="op" id="2060243">[</span><span class="num" id="2060244">1</span><span class="op" id="2060245">:</span><span class="op" id="2060246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060251">if</span>&nbsp;<span class="ident" id="2060254">in</span>&nbsp;<span class="op" id="2060257">==</span>&nbsp;<span class="string" id="2060260">&#39;=&#39;</span>&nbsp;<span class="op" id="2060264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060270">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060319">switch</span>&nbsp;<span class="ident" id="2060326">j</span>&nbsp;<span class="op" id="2060328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060334">case</span>&nbsp;<span class="num" id="2060339">0</span><span class="op" id="2060340">,</span>&nbsp;<span class="num" id="2060342">1</span><span class="op" id="2060343">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060350">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060376">return</span>&nbsp;<span class="ident" id="2060383">n</span><span class="op" id="2060384">,</span>&nbsp;<span class="builtintype" id="2060386">false</span><span class="op" id="2060391">,</span>&nbsp;<span class="ident" id="2060393">CorruptInputError</span><span class="op" id="2060410">(</span><span class="ident" id="2060411">olen</span>&nbsp;<span class="op" id="2060416">-</span>&nbsp;<span class="builtinfunc" id="2060418">len</span><span class="op" id="2060421">(</span><span class="ident" id="2060422">src</span><span class="op" id="2060425">)</span>&nbsp;<span class="op" id="2060427">-</span>&nbsp;<span class="num" id="2060429">1</span><span class="op" id="2060430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060436">case</span>&nbsp;<span class="num" id="2060441">2</span><span class="op" id="2060442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060449">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060510">if</span>&nbsp;<span class="builtinfunc" id="2060513">len</span><span class="op" id="2060516">(</span><span class="ident" id="2060517">src</span><span class="op" id="2060520">)</span>&nbsp;<span class="op" id="2060522">==</span>&nbsp;<span class="num" id="2060525">0</span>&nbsp;<span class="op" id="2060527">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060535">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060563">return</span>&nbsp;<span class="ident" id="2060570">n</span><span class="op" id="2060571">,</span>&nbsp;<span class="builtintype" id="2060573">false</span><span class="op" id="2060578">,</span>&nbsp;<span class="ident" id="2060580">CorruptInputError</span><span class="op" id="2060597">(</span><span class="ident" id="2060598">olen</span><span class="op" id="2060602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060616">if</span>&nbsp;<span class="ident" id="2060619">src</span><span class="op" id="2060622">[</span><span class="num" id="2060623">0</span><span class="op" id="2060624">]</span>&nbsp;<span class="op" id="2060626">!=</span>&nbsp;<span class="string" id="2060629">&#39;=&#39;</span>&nbsp;<span class="op" id="2060633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060641">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060668">return</span>&nbsp;<span class="ident" id="2060675">n</span><span class="op" id="2060676">,</span>&nbsp;<span class="builtintype" id="2060678">false</span><span class="op" id="2060683">,</span>&nbsp;<span class="ident" id="2060685">CorruptInputError</span><span class="op" id="2060702">(</span><span class="ident" id="2060703">olen</span>&nbsp;<span class="op" id="2060708">-</span>&nbsp;<span class="builtinfunc" id="2060710">len</span><span class="op" id="2060713">(</span><span class="ident" id="2060714">src</span><span class="op" id="2060717">)</span>&nbsp;<span class="op" id="2060719">-</span>&nbsp;<span class="num" id="2060721">1</span><span class="op" id="2060722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060736">src</span>&nbsp;<span class="op" id="2060740">=</span>&nbsp;<span class="ident" id="2060742">src</span><span class="op" id="2060745">[</span><span class="num" id="2060746">1</span><span class="op" id="2060747">:</span><span class="op" id="2060748">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060760">if</span>&nbsp;<span class="builtinfunc" id="2060763">len</span><span class="op" id="2060766">(</span><span class="ident" id="2060767">src</span><span class="op" id="2060770">)</span>&nbsp;<span class="op" id="2060772">&gt;</span>&nbsp;<span class="num" id="2060774">0</span>&nbsp;<span class="op" id="2060776">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2060783">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060808">err</span>&nbsp;<span class="op" id="2060812">=</span>&nbsp;<span class="ident" id="2060814">CorruptInputError</span><span class="op" id="2060831">(</span><span class="ident" id="2060832">olen</span>&nbsp;<span class="op" id="2060837">-</span>&nbsp;<span class="builtinfunc" id="2060839">len</span><span class="op" id="2060842">(</span><span class="ident" id="2060843">src</span><span class="op" id="2060846">)</span><span class="op" id="2060847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060859">dlen</span><span class="op" id="2060863">,</span>&nbsp;<span class="ident" id="2060865">end</span>&nbsp;<span class="op" id="2060869">=</span>&nbsp;<span class="ident" id="2060871">j</span><span class="op" id="2060872">,</span>&nbsp;<span class="builtintype" id="2060874">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060883">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2060892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2060897">dbuf</span><span class="op" id="2060901">[</span><span class="ident" id="2060902">j</span><span class="op" id="2060903">]</span>&nbsp;<span class="op" id="2060905">=</span>&nbsp;<span class="ident" id="2060907">enc</span><span class="op" id="2060910">.</span><span class="ident" id="2060911">decodeMap</span><span class="op" id="2060920">[</span><span class="ident" id="2060921">in</span><span class="op" id="2060923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060928">if</span>&nbsp;<span class="ident" id="2060931">dbuf</span><span class="op" id="2060935">[</span><span class="ident" id="2060936">j</span><span class="op" id="2060937">]</span>&nbsp;<span class="op" id="2060939">==</span>&nbsp;<span class="num" id="2060942">0xFF</span>&nbsp;<span class="op" id="2060947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2060953">return</span>&nbsp;<span class="ident" id="2060960">n</span><span class="op" id="2060961">,</span>&nbsp;<span class="builtintype" id="2060963">false</span><span class="op" id="2060968">,</span>&nbsp;<span class="ident" id="2060970">CorruptInputError</span><span class="op" id="2060987">(</span><span class="ident" id="2060988">olen</span>&nbsp;<span class="op" id="2060993">-</span>&nbsp;<span class="builtinfunc" id="2060995">len</span><span class="op" id="2060998">(</span><span class="ident" id="2060999">src</span><span class="op" id="2061002">)</span>&nbsp;<span class="op" id="2061004">-</span>&nbsp;<span class="num" id="2061006">1</span><span class="op" id="2061007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2061012">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2061016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2061021">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2061078">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061091">switch</span>&nbsp;<span class="ident" id="2061098">dlen</span>&nbsp;<span class="op" id="2061103">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061107">case</span>&nbsp;<span class="num" id="2061112">4</span><span class="op" id="2061113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061118">dst</span><span class="op" id="2061121">[</span><span class="num" id="2061122">2</span><span class="op" id="2061123">]</span>&nbsp;<span class="op" id="2061125">=</span>&nbsp;<span class="ident" id="2061127">dbuf</span><span class="op" id="2061131">[</span><span class="num" id="2061132">2</span><span class="op" id="2061133">]</span><span class="op" id="2061134">&lt;&lt;</span><span class="num" id="2061136">6</span>&nbsp;<span class="op" id="2061138">|</span>&nbsp;<span class="ident" id="2061140">dbuf</span><span class="op" id="2061144">[</span><span class="num" id="2061145">3</span><span class="op" id="2061146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061151">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061165">case</span>&nbsp;<span class="num" id="2061170">3</span><span class="op" id="2061171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061176">dst</span><span class="op" id="2061179">[</span><span class="num" id="2061180">1</span><span class="op" id="2061181">]</span>&nbsp;<span class="op" id="2061183">=</span>&nbsp;<span class="ident" id="2061185">dbuf</span><span class="op" id="2061189">[</span><span class="num" id="2061190">1</span><span class="op" id="2061191">]</span><span class="op" id="2061192">&lt;&lt;</span><span class="num" id="2061194">4</span>&nbsp;<span class="op" id="2061196">|</span>&nbsp;<span class="ident" id="2061198">dbuf</span><span class="op" id="2061202">[</span><span class="num" id="2061203">2</span><span class="op" id="2061204">]</span><span class="op" id="2061205">&gt;&gt;</span><span class="num" id="2061207">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061212">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061226">case</span>&nbsp;<span class="num" id="2061231">2</span><span class="op" id="2061232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061237">dst</span><span class="op" id="2061240">[</span><span class="num" id="2061241">0</span><span class="op" id="2061242">]</span>&nbsp;<span class="op" id="2061244">=</span>&nbsp;<span class="ident" id="2061246">dbuf</span><span class="op" id="2061250">[</span><span class="num" id="2061251">0</span><span class="op" id="2061252">]</span><span class="op" id="2061253">&lt;&lt;</span><span class="num" id="2061255">2</span>&nbsp;<span class="op" id="2061257">|</span>&nbsp;<span class="ident" id="2061259">dbuf</span><span class="op" id="2061263">[</span><span class="num" id="2061264">1</span><span class="op" id="2061265">]</span><span class="op" id="2061266">&gt;&gt;</span><span class="num" id="2061268">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2061272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061276">dst</span>&nbsp;<span class="op" id="2061280">=</span>&nbsp;<span class="ident" id="2061282">dst</span><span class="op" id="2061285">[</span><span class="num" id="2061286">3</span><span class="op" id="2061287">:</span><span class="op" id="2061288">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061292">n</span>&nbsp;<span class="op" id="2061294">+=</span>&nbsp;<span class="ident" id="2061297">dlen</span>&nbsp;<span class="op" id="2061302">-</span>&nbsp;<span class="num" id="2061304">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2061307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061311">return</span>&nbsp;<span class="ident" id="2061318">n</span><span class="op" id="2061319">,</span>&nbsp;<span class="ident" id="2061321">end</span><span class="op" id="2061324">,</span>&nbsp;<span class="ident" id="2061326">err</span><br>
<span class="lineno"></span><span class="op" id="2061330">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="2061333">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="2061398">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="2061467">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2061536">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="2061599">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="2061647">func</span>&nbsp;<span class="op" id="2061652">(</span><span class="ident" id="2061653">enc</span>&nbsp;<span class="op" id="2061657">*</span><span class="ident" id="2061658">Encoding</span><span class="op" id="2061666">)</span>&nbsp;<span class="ident" id="2061668">Decode</span><span class="op" id="2061674">(</span><span class="ident" id="2061675">dst</span><span class="op" id="2061678">,</span>&nbsp;<span class="ident" id="2061680">src</span>&nbsp;<span class="op" id="2061684">[</span><span class="op" id="2061685">]</span><span class="builtintype" id="2061686">byte</span><span class="op" id="2061690">)</span>&nbsp;<span class="op" id="2061692">(</span><span class="ident" id="2061693">n</span>&nbsp;<span class="builtintype" id="2061695">int</span><span class="op" id="2061698">,</span>&nbsp;<span class="ident" id="2061700">err</span>&nbsp;<span class="builtintype" id="2061704">error</span><span class="op" id="2061709">)</span>&nbsp;<span class="op" id="2061711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061714">src</span>&nbsp;<span class="op" id="2061718">=</span>&nbsp;<span class="ident" id="2061720">bytes</span><span class="op" id="2061725">.</span><span class="ident" id="2061726">Map</span><span class="op" id="2061729">(</span><span class="ident" id="2061730">removeNewlinesMapper</span><span class="op" id="2061750">,</span>&nbsp;<span class="ident" id="2061752">src</span><span class="op" id="2061755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061758">n</span><span class="op" id="2061759">,</span>&nbsp;<span class="ident" id="2061761">_</span><span class="op" id="2061762">,</span>&nbsp;<span class="ident" id="2061764">err</span>&nbsp;<span class="op" id="2061768">=</span>&nbsp;<span class="ident" id="2061770">enc</span><span class="op" id="2061773">.</span><span class="ident" id="2061774">decode</span><span class="op" id="2061780">(</span><span class="ident" id="2061781">dst</span><span class="op" id="2061784">,</span>&nbsp;<span class="ident" id="2061786">src</span><span class="op" id="2061789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2061792">return</span><br>
<span class="lineno">290</span><span class="op" id="2061799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2061802">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2061872">func</span>&nbsp;<span class="op" id="2061877">(</span><span class="ident" id="2061878">enc</span>&nbsp;<span class="op" id="2061882">*</span><span class="ident" id="2061883">Encoding</span><span class="op" id="2061891">)</span>&nbsp;<span class="ident" id="2061893">DecodeString</span><span class="op" id="2061905">(</span><span class="ident" id="2061906">s</span>&nbsp;<span class="builtintype" id="2061908">string</span><span class="op" id="2061914">)</span>&nbsp;<span class="op" id="2061916">(</span><span class="op" id="2061917">[</span><span class="op" id="2061918">]</span><span class="builtintype" id="2061919">byte</span><span class="op" id="2061923">,</span>&nbsp;<span class="builtintype" id="2061925">error</span><span class="op" id="2061930">)</span>&nbsp;<span class="op" id="2061932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061935">s</span>&nbsp;<span class="op" id="2061937">=</span>&nbsp;<span class="ident" id="2061939">strings</span><span class="op" id="2061946">.</span><span class="ident" id="2061947">Map</span><span class="op" id="2061950">(</span><span class="ident" id="2061951">removeNewlinesMapper</span><span class="op" id="2061971">,</span>&nbsp;<span class="ident" id="2061973">s</span><span class="op" id="2061974">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2061977">dbuf</span>&nbsp;<span class="op" id="2061982">:=</span>&nbsp;<span class="builtinfunc" id="2061985">make</span><span class="op" id="2061989">(</span><span class="op" id="2061990">[</span><span class="op" id="2061991">]</span><span class="builtintype" id="2061992">byte</span><span class="op" id="2061996">,</span>&nbsp;<span class="ident" id="2061998">enc</span><span class="op" id="2062001">.</span><span class="ident" id="2062002">DecodedLen</span><span class="op" id="2062012">(</span><span class="builtinfunc" id="2062013">len</span><span class="op" id="2062016">(</span><span class="ident" id="2062017">s</span><span class="op" id="2062018">)</span><span class="op" id="2062019">)</span><span class="op" id="2062020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062023">n</span><span class="op" id="2062024">,</span>&nbsp;<span class="ident" id="2062026">_</span><span class="op" id="2062027">,</span>&nbsp;<span class="ident" id="2062029">err</span>&nbsp;<span class="op" id="2062033">:=</span>&nbsp;<span class="ident" id="2062036">enc</span><span class="op" id="2062039">.</span><span class="ident" id="2062040">decode</span><span class="op" id="2062046">(</span><span class="ident" id="2062047">dbuf</span><span class="op" id="2062051">,</span>&nbsp;<span class="op" id="2062053">[</span><span class="op" id="2062054">]</span><span class="builtintype" id="2062055">byte</span><span class="op" id="2062059">(</span><span class="ident" id="2062060">s</span><span class="op" id="2062061">)</span><span class="op" id="2062062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062065">return</span>&nbsp;<span class="ident" id="2062072">dbuf</span><span class="op" id="2062076">[</span><span class="op" id="2062077">:</span><span class="ident" id="2062078">n</span><span class="op" id="2062079">]</span><span class="op" id="2062080">,</span>&nbsp;<span class="ident" id="2062082">err</span><br>
<span class="lineno"></span><span class="op" id="2062086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="2062089">type</span>&nbsp;<span class="ident" id="2062094">decoder</span>&nbsp;<span class="keyword" id="2062102">struct</span>&nbsp;<span class="op" id="2062109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062112">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2062119">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062126">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062133">*</span><span class="ident" id="2062134">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062144">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062151">io</span><span class="op" id="2062153">.</span><span class="ident" id="2062154">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062162">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2062169">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2062180">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062203">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062210">[</span><span class="num" id="2062211">1024</span><span class="op" id="2062215">]</span><span class="builtintype" id="2062216">byte</span>&nbsp;<span class="comment" id="2062221">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062240">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2062247">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062252">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062259">[</span><span class="op" id="2062260">]</span><span class="builtintype" id="2062261">byte</span>&nbsp;<span class="comment" id="2062266">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062294">outbuf</span>&nbsp;<span class="op" id="2062301">[</span><span class="num" id="2062302">1024</span>&nbsp;<span class="op" id="2062307">/</span>&nbsp;<span class="num" id="2062309">4</span>&nbsp;<span class="op" id="2062311">*</span>&nbsp;<span class="num" id="2062313">3</span><span class="op" id="2062314">]</span><span class="builtintype" id="2062315">byte</span><br>
<span class="lineno"></span><span class="op" id="2062320">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="2062323">func</span>&nbsp;<span class="op" id="2062328">(</span><span class="ident" id="2062329">d</span>&nbsp;<span class="op" id="2062331">*</span><span class="ident" id="2062332">decoder</span><span class="op" id="2062339">)</span>&nbsp;<span class="ident" id="2062341">Read</span><span class="op" id="2062345">(</span><span class="ident" id="2062346">p</span>&nbsp;<span class="op" id="2062348">[</span><span class="op" id="2062349">]</span><span class="builtintype" id="2062350">byte</span><span class="op" id="2062354">)</span>&nbsp;<span class="op" id="2062356">(</span><span class="ident" id="2062357">n</span>&nbsp;<span class="builtintype" id="2062359">int</span><span class="op" id="2062362">,</span>&nbsp;<span class="ident" id="2062364">err</span>&nbsp;<span class="builtintype" id="2062368">error</span><span class="op" id="2062373">)</span>&nbsp;<span class="op" id="2062375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062378">if</span>&nbsp;<span class="ident" id="2062381">d</span><span class="op" id="2062382">.</span><span class="ident" id="2062383">err</span>&nbsp;<span class="op" id="2062387">!=</span>&nbsp;<span class="builtintype" id="2062390">nil</span>&nbsp;<span class="op" id="2062394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062398">return</span>&nbsp;<span class="num" id="2062405">0</span><span class="op" id="2062406">,</span>&nbsp;<span class="ident" id="2062408">d</span><span class="op" id="2062409">.</span><span class="ident" id="2062410">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062415">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2062419">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062467">if</span>&nbsp;<span class="builtinfunc" id="2062470">len</span><span class="op" id="2062473">(</span><span class="ident" id="2062474">d</span><span class="op" id="2062475">.</span><span class="ident" id="2062476">out</span><span class="op" id="2062479">)</span>&nbsp;<span class="op" id="2062481">&gt;</span>&nbsp;<span class="num" id="2062483">0</span>&nbsp;<span class="op" id="2062485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062489">n</span>&nbsp;<span class="op" id="2062491">=</span>&nbsp;<span class="builtinfunc" id="2062493">copy</span><span class="op" id="2062497">(</span><span class="ident" id="2062498">p</span><span class="op" id="2062499">,</span>&nbsp;<span class="ident" id="2062501">d</span><span class="op" id="2062502">.</span><span class="ident" id="2062503">out</span><span class="op" id="2062506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062510">d</span><span class="op" id="2062511">.</span><span class="ident" id="2062512">out</span>&nbsp;<span class="op" id="2062516">=</span>&nbsp;<span class="ident" id="2062518">d</span><span class="op" id="2062519">.</span><span class="ident" id="2062520">out</span><span class="op" id="2062523">[</span><span class="ident" id="2062524">n</span><span class="op" id="2062525">:</span><span class="op" id="2062526">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062530">return</span>&nbsp;<span class="ident" id="2062537">n</span><span class="op" id="2062538">,</span>&nbsp;<span class="builtintype" id="2062540">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2062549">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062567">nn</span>&nbsp;<span class="op" id="2062570">:=</span>&nbsp;<span class="builtinfunc" id="2062573">len</span><span class="op" id="2062576">(</span><span class="ident" id="2062577">p</span><span class="op" id="2062578">)</span>&nbsp;<span class="op" id="2062580">/</span>&nbsp;<span class="num" id="2062582">3</span>&nbsp;<span class="op" id="2062584">*</span>&nbsp;<span class="num" id="2062586">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062589">if</span>&nbsp;<span class="ident" id="2062592">nn</span>&nbsp;<span class="op" id="2062595">&lt;</span>&nbsp;<span class="num" id="2062597">4</span>&nbsp;<span class="op" id="2062599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062603">nn</span>&nbsp;<span class="op" id="2062606">=</span>&nbsp;<span class="num" id="2062608">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062614">if</span>&nbsp;<span class="ident" id="2062617">nn</span>&nbsp;<span class="op" id="2062620">&gt;</span>&nbsp;<span class="builtinfunc" id="2062622">len</span><span class="op" id="2062625">(</span><span class="ident" id="2062626">d</span><span class="op" id="2062627">.</span><span class="ident" id="2062628">buf</span><span class="op" id="2062631">)</span>&nbsp;<span class="op" id="2062633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062637">nn</span>&nbsp;<span class="op" id="2062640">=</span>&nbsp;<span class="builtinfunc" id="2062642">len</span><span class="op" id="2062645">(</span><span class="ident" id="2062646">d</span><span class="op" id="2062647">.</span><span class="ident" id="2062648">buf</span><span class="op" id="2062651">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062657">nn</span><span class="op" id="2062659">,</span>&nbsp;<span class="ident" id="2062661">d</span><span class="op" id="2062662">.</span><span class="ident" id="2062663">err</span>&nbsp;<span class="op" id="2062667">=</span>&nbsp;<span class="ident" id="2062669">io</span><span class="op" id="2062671">.</span><span class="ident" id="2062672">ReadAtLeast</span><span class="op" id="2062683">(</span><span class="ident" id="2062684">d</span><span class="op" id="2062685">.</span><span class="ident" id="2062686">r</span><span class="op" id="2062687">,</span>&nbsp;<span class="ident" id="2062689">d</span><span class="op" id="2062690">.</span><span class="ident" id="2062691">buf</span><span class="op" id="2062694">[</span><span class="ident" id="2062695">d</span><span class="op" id="2062696">.</span><span class="ident" id="2062697">nbuf</span><span class="op" id="2062701">:</span><span class="ident" id="2062702">nn</span><span class="op" id="2062704">]</span><span class="op" id="2062705">,</span>&nbsp;<span class="num" id="2062707">4</span><span class="op" id="2062708">-</span><span class="ident" id="2062709">d</span><span class="op" id="2062710">.</span><span class="ident" id="2062711">nbuf</span><span class="op" id="2062715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062718">d</span><span class="op" id="2062719">.</span><span class="ident" id="2062720">nbuf</span>&nbsp;<span class="op" id="2062725">+=</span>&nbsp;<span class="ident" id="2062728">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062732">if</span>&nbsp;<span class="ident" id="2062735">d</span><span class="op" id="2062736">.</span><span class="ident" id="2062737">err</span>&nbsp;<span class="op" id="2062741">!=</span>&nbsp;<span class="builtintype" id="2062744">nil</span>&nbsp;<span class="op" id="2062748">||</span>&nbsp;<span class="ident" id="2062751">d</span><span class="op" id="2062752">.</span><span class="ident" id="2062753">nbuf</span>&nbsp;<span class="op" id="2062758">&lt;</span>&nbsp;<span class="num" id="2062760">4</span>&nbsp;<span class="op" id="2062762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062766">return</span>&nbsp;<span class="num" id="2062773">0</span><span class="op" id="2062774">,</span>&nbsp;<span class="ident" id="2062776">d</span><span class="op" id="2062777">.</span><span class="ident" id="2062778">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2062783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2062787">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062851">nr</span>&nbsp;<span class="op" id="2062854">:=</span>&nbsp;<span class="ident" id="2062857">d</span><span class="op" id="2062858">.</span><span class="ident" id="2062859">nbuf</span>&nbsp;<span class="op" id="2062864">/</span>&nbsp;<span class="num" id="2062866">4</span>&nbsp;<span class="op" id="2062868">*</span>&nbsp;<span class="num" id="2062870">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062873">nw</span>&nbsp;<span class="op" id="2062876">:=</span>&nbsp;<span class="ident" id="2062879">d</span><span class="op" id="2062880">.</span><span class="ident" id="2062881">nbuf</span>&nbsp;<span class="op" id="2062886">/</span>&nbsp;<span class="num" id="2062888">4</span>&nbsp;<span class="op" id="2062890">*</span>&nbsp;<span class="num" id="2062892">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2062895">if</span>&nbsp;<span class="ident" id="2062898">nw</span>&nbsp;<span class="op" id="2062901">&gt;</span>&nbsp;<span class="builtinfunc" id="2062903">len</span><span class="op" id="2062906">(</span><span class="ident" id="2062907">p</span><span class="op" id="2062908">)</span>&nbsp;<span class="op" id="2062910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062914">nw</span><span class="op" id="2062916">,</span>&nbsp;<span class="ident" id="2062918">d</span><span class="op" id="2062919">.</span><span class="ident" id="2062920">end</span><span class="op" id="2062923">,</span>&nbsp;<span class="ident" id="2062925">d</span><span class="op" id="2062926">.</span><span class="ident" id="2062927">err</span>&nbsp;<span class="op" id="2062931">=</span>&nbsp;<span class="ident" id="2062933">d</span><span class="op" id="2062934">.</span><span class="ident" id="2062935">enc</span><span class="op" id="2062938">.</span><span class="ident" id="2062939">decode</span><span class="op" id="2062945">(</span><span class="ident" id="2062946">d</span><span class="op" id="2062947">.</span><span class="ident" id="2062948">outbuf</span><span class="op" id="2062954">[</span><span class="num" id="2062955">0</span><span class="op" id="2062956">:</span><span class="op" id="2062957">]</span><span class="op" id="2062958">,</span>&nbsp;<span class="ident" id="2062960">d</span><span class="op" id="2062961">.</span><span class="ident" id="2062962">buf</span><span class="op" id="2062965">[</span><span class="num" id="2062966">0</span><span class="op" id="2062967">:</span><span class="ident" id="2062968">nr</span><span class="op" id="2062970">]</span><span class="op" id="2062971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2062975">d</span><span class="op" id="2062976">.</span><span class="ident" id="2062977">out</span>&nbsp;<span class="op" id="2062981">=</span>&nbsp;<span class="ident" id="2062983">d</span><span class="op" id="2062984">.</span><span class="ident" id="2062985">outbuf</span><span class="op" id="2062991">[</span><span class="num" id="2062992">0</span><span class="op" id="2062993">:</span><span class="ident" id="2062994">nw</span><span class="op" id="2062996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063000">n</span>&nbsp;<span class="op" id="2063002">=</span>&nbsp;<span class="builtinfunc" id="2063004">copy</span><span class="op" id="2063008">(</span><span class="ident" id="2063009">p</span><span class="op" id="2063010">,</span>&nbsp;<span class="ident" id="2063012">d</span><span class="op" id="2063013">.</span><span class="ident" id="2063014">out</span><span class="op" id="2063017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063021">d</span><span class="op" id="2063022">.</span><span class="ident" id="2063023">out</span>&nbsp;<span class="op" id="2063027">=</span>&nbsp;<span class="ident" id="2063029">d</span><span class="op" id="2063030">.</span><span class="ident" id="2063031">out</span><span class="op" id="2063034">[</span><span class="ident" id="2063035">n</span><span class="op" id="2063036">:</span><span class="op" id="2063037">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063040">}</span>&nbsp;<span class="keyword" id="2063042">else</span>&nbsp;<span class="op" id="2063047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063051">n</span><span class="op" id="2063052">,</span>&nbsp;<span class="ident" id="2063054">d</span><span class="op" id="2063055">.</span><span class="ident" id="2063056">end</span><span class="op" id="2063059">,</span>&nbsp;<span class="ident" id="2063061">d</span><span class="op" id="2063062">.</span><span class="ident" id="2063063">err</span>&nbsp;<span class="op" id="2063067">=</span>&nbsp;<span class="ident" id="2063069">d</span><span class="op" id="2063070">.</span><span class="ident" id="2063071">enc</span><span class="op" id="2063074">.</span><span class="ident" id="2063075">decode</span><span class="op" id="2063081">(</span><span class="ident" id="2063082">p</span><span class="op" id="2063083">,</span>&nbsp;<span class="ident" id="2063085">d</span><span class="op" id="2063086">.</span><span class="ident" id="2063087">buf</span><span class="op" id="2063090">[</span><span class="num" id="2063091">0</span><span class="op" id="2063092">:</span><span class="ident" id="2063093">nr</span><span class="op" id="2063095">]</span><span class="op" id="2063096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063102">d</span><span class="op" id="2063103">.</span><span class="ident" id="2063104">nbuf</span>&nbsp;<span class="op" id="2063109">-=</span>&nbsp;<span class="ident" id="2063112">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063116">for</span>&nbsp;<span class="ident" id="2063120">i</span>&nbsp;<span class="op" id="2063122">:=</span>&nbsp;<span class="num" id="2063125">0</span><span class="op" id="2063126">;</span>&nbsp;<span class="ident" id="2063128">i</span>&nbsp;<span class="op" id="2063130">&lt;</span>&nbsp;<span class="ident" id="2063132">d</span><span class="op" id="2063133">.</span><span class="ident" id="2063134">nbuf</span><span class="op" id="2063138">;</span>&nbsp;<span class="ident" id="2063140">i</span><span class="op" id="2063141">++</span>&nbsp;<span class="op" id="2063144">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063148">d</span><span class="op" id="2063149">.</span><span class="ident" id="2063150">buf</span><span class="op" id="2063153">[</span><span class="ident" id="2063154">i</span><span class="op" id="2063155">]</span>&nbsp;<span class="op" id="2063157">=</span>&nbsp;<span class="ident" id="2063159">d</span><span class="op" id="2063160">.</span><span class="ident" id="2063161">buf</span><span class="op" id="2063164">[</span><span class="ident" id="2063165">i</span><span class="op" id="2063166">+</span><span class="ident" id="2063167">nr</span><span class="op" id="2063169">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063176">if</span>&nbsp;<span class="ident" id="2063179">d</span><span class="op" id="2063180">.</span><span class="ident" id="2063181">err</span>&nbsp;<span class="op" id="2063185">==</span>&nbsp;<span class="builtintype" id="2063188">nil</span>&nbsp;<span class="op" id="2063192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063196">d</span><span class="op" id="2063197">.</span><span class="ident" id="2063198">err</span>&nbsp;<span class="op" id="2063202">=</span>&nbsp;<span class="ident" id="2063204">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063212">return</span>&nbsp;<span class="ident" id="2063219">n</span><span class="op" id="2063220">,</span>&nbsp;<span class="ident" id="2063222">d</span><span class="op" id="2063223">.</span><span class="ident" id="2063224">err</span><br>
<span class="lineno"></span><span class="op" id="2063228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2063231">type</span>&nbsp;<span class="ident" id="2063236">newlineFilteringReader</span>&nbsp;<span class="keyword" id="2063259">struct</span>&nbsp;<span class="op" id="2063266">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063269">wrapped</span>&nbsp;<span class="ident" id="2063277">io</span><span class="op" id="2063279">.</span><span class="ident" id="2063280">Reader</span><br>
<span class="lineno"></span><span class="op" id="2063287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2063290">func</span>&nbsp;<span class="op" id="2063295">(</span><span class="ident" id="2063296">r</span>&nbsp;<span class="op" id="2063298">*</span><span class="ident" id="2063299">newlineFilteringReader</span><span class="op" id="2063321">)</span>&nbsp;<span class="ident" id="2063323">Read</span><span class="op" id="2063327">(</span><span class="ident" id="2063328">p</span>&nbsp;<span class="op" id="2063330">[</span><span class="op" id="2063331">]</span><span class="builtintype" id="2063332">byte</span><span class="op" id="2063336">)</span>&nbsp;<span class="op" id="2063338">(</span><span class="builtintype" id="2063339">int</span><span class="op" id="2063342">,</span>&nbsp;<span class="builtintype" id="2063344">error</span><span class="op" id="2063349">)</span>&nbsp;<span class="op" id="2063351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063354">n</span><span class="op" id="2063355">,</span>&nbsp;<span class="ident" id="2063357">err</span>&nbsp;<span class="op" id="2063361">:=</span>&nbsp;<span class="ident" id="2063364">r</span><span class="op" id="2063365">.</span><span class="ident" id="2063366">wrapped</span><span class="op" id="2063373">.</span><span class="ident" id="2063374">Read</span><span class="op" id="2063378">(</span><span class="ident" id="2063379">p</span><span class="op" id="2063380">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063383">for</span>&nbsp;<span class="ident" id="2063387">n</span>&nbsp;<span class="op" id="2063389">&gt;</span>&nbsp;<span class="num" id="2063391">0</span>&nbsp;<span class="op" id="2063393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063397">offset</span>&nbsp;<span class="op" id="2063404">:=</span>&nbsp;<span class="num" id="2063407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063411">for</span>&nbsp;<span class="ident" id="2063415">i</span><span class="op" id="2063416">,</span>&nbsp;<span class="ident" id="2063418">b</span>&nbsp;<span class="op" id="2063420">:=</span>&nbsp;<span class="keyword" id="2063423">range</span>&nbsp;<span class="ident" id="2063429">p</span><span class="op" id="2063430">[</span><span class="num" id="2063431">0</span><span class="op" id="2063432">:</span><span class="ident" id="2063433">n</span><span class="op" id="2063434">]</span>&nbsp;<span class="op" id="2063436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063441">if</span>&nbsp;<span class="ident" id="2063444">b</span>&nbsp;<span class="op" id="2063446">!=</span>&nbsp;<span class="string" id="2063449">&#39;\r&#39;</span>&nbsp;<span class="op" id="2063454">&amp;&amp;</span>&nbsp;<span class="ident" id="2063457">b</span>&nbsp;<span class="op" id="2063459">!=</span>&nbsp;<span class="string" id="2063462">&#39;\n&#39;</span>&nbsp;<span class="op" id="2063467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063473">if</span>&nbsp;<span class="ident" id="2063476">i</span>&nbsp;<span class="op" id="2063478">!=</span>&nbsp;<span class="ident" id="2063481">offset</span>&nbsp;<span class="op" id="2063488">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063495">p</span><span class="op" id="2063496">[</span><span class="ident" id="2063497">offset</span><span class="op" id="2063503">]</span>&nbsp;<span class="op" id="2063505">=</span>&nbsp;<span class="ident" id="2063507">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063519">offset</span><span class="op" id="2063525">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063535">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063539">if</span>&nbsp;<span class="ident" id="2063542">offset</span>&nbsp;<span class="op" id="2063549">&gt;</span>&nbsp;<span class="num" id="2063551">0</span>&nbsp;<span class="op" id="2063553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063558">return</span>&nbsp;<span class="ident" id="2063565">offset</span><span class="op" id="2063571">,</span>&nbsp;<span class="ident" id="2063573">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2063583">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2063636">n</span><span class="op" id="2063637">,</span>&nbsp;<span class="ident" id="2063639">err</span>&nbsp;<span class="op" id="2063643">=</span>&nbsp;<span class="ident" id="2063645">r</span><span class="op" id="2063646">.</span><span class="ident" id="2063647">wrapped</span><span class="op" id="2063654">.</span><span class="ident" id="2063655">Read</span><span class="op" id="2063659">(</span><span class="ident" id="2063660">p</span><span class="op" id="2063661">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2063664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063667">return</span>&nbsp;<span class="ident" id="2063674">n</span><span class="op" id="2063675">,</span>&nbsp;<span class="ident" id="2063677">err</span><br>
<span class="lineno"></span><span class="op" id="2063681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2063684">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="2063738">func</span>&nbsp;<span class="ident" id="2063743">NewDecoder</span><span class="op" id="2063753">(</span><span class="ident" id="2063754">enc</span>&nbsp;<span class="op" id="2063758">*</span><span class="ident" id="2063759">Encoding</span><span class="op" id="2063767">,</span>&nbsp;<span class="ident" id="2063769">r</span>&nbsp;<span class="ident" id="2063771">io</span><span class="op" id="2063773">.</span><span class="ident" id="2063774">Reader</span><span class="op" id="2063780">)</span>&nbsp;<span class="ident" id="2063782">io</span><span class="op" id="2063784">.</span><span class="ident" id="2063785">Reader</span>&nbsp;<span class="op" id="2063792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2063795">return</span>&nbsp;<span class="op" id="2063802">&amp;</span><span class="ident" id="2063803">decoder</span><span class="op" id="2063810">{</span><span class="ident" id="2063811">enc</span><span class="op" id="2063814">:</span>&nbsp;<span class="ident" id="2063816">enc</span><span class="op" id="2063819">,</span>&nbsp;<span class="ident" id="2063821">r</span><span class="op" id="2063822">:</span>&nbsp;<span class="op" id="2063824">&amp;</span><span class="ident" id="2063825">newlineFilteringReader</span><span class="op" id="2063847">{</span><span class="ident" id="2063848">r</span><span class="op" id="2063849">}</span><span class="op" id="2063850">}</span><br>
<span class="lineno"></span><span class="op" id="2063852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2063855">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="2063925">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2063977">func</span>&nbsp;<span class="op" id="2063982">(</span><span class="ident" id="2063983">enc</span>&nbsp;<span class="op" id="2063987">*</span><span class="ident" id="2063988">Encoding</span><span class="op" id="2063996">)</span>&nbsp;<span class="ident" id="2063998">DecodedLen</span><span class="op" id="2064008">(</span><span class="ident" id="2064009">n</span>&nbsp;<span class="builtintype" id="2064011">int</span><span class="op" id="2064014">)</span>&nbsp;<span class="builtintype" id="2064016">int</span>&nbsp;<span class="op" id="2064020">{</span>&nbsp;<span class="keyword" id="2064022">return</span>&nbsp;<span class="ident" id="2064029">n</span>&nbsp;<span class="op" id="2064031">/</span>&nbsp;<span class="num" id="2064033">4</span>&nbsp;<span class="op" id="2064035">*</span>&nbsp;<span class="num" id="2064037">3</span>&nbsp;<span class="op" id="2064039">}</span>
</div>
</body>
</html>
