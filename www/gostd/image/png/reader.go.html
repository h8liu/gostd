<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6321104">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6321159">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6321213">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6321264">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6321323">//</span><br>
<span class="lineno"></span><span class="comment" id="6321326">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="6321384">package</span>&nbsp;<span class="ident" id="6321392">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6321397">import</span>&nbsp;<span class="op" id="6321404">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321407">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321424">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321443">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321450">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321458">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321472">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321481">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6321496">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6321501">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6321504">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6321540">const</span>&nbsp;<span class="op" id="6321546">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321549">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321566">=</span>&nbsp;<span class="num" id="6321568">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321571">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321588">=</span>&nbsp;<span class="num" id="6321590">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321593">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321610">=</span>&nbsp;<span class="num" id="6321612">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321615">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="6321632">=</span>&nbsp;<span class="num" id="6321634">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321637">ctTrueColorAlpha</span>&nbsp;<span class="op" id="6321654">=</span>&nbsp;<span class="num" id="6321656">6</span><br>
<span class="lineno"></span><span class="op" id="6321658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6321661">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6321715">const</span>&nbsp;<span class="op" id="6321721">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321724">cbInvalid</span>&nbsp;<span class="op" id="6321734">=</span>&nbsp;<span class="ident" id="6321736">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321742">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321748">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321754">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321760">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321766">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321773">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321780">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321786">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321792">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321798">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321804">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321812">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321819">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321827">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321835">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="6321843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6321846">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6321883">const</span>&nbsp;<span class="op" id="6321889">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321892">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321902">=</span>&nbsp;<span class="num" id="6321904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321907">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321917">=</span>&nbsp;<span class="num" id="6321919">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321922">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321932">=</span>&nbsp;<span class="num" id="6321934">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321937">ftAverage</span>&nbsp;<span class="op" id="6321947">=</span>&nbsp;<span class="num" id="6321949">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321952">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6321962">=</span>&nbsp;<span class="num" id="6321964">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321967">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6321977">=</span>&nbsp;<span class="num" id="6321979">5</span><br>
<span class="lineno"></span><span class="op" id="6321981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6321984">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="6322003">const</span>&nbsp;<span class="op" id="6322009">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322012">itNone</span>&nbsp;&nbsp;<span class="op" id="6322020">=</span>&nbsp;<span class="num" id="6322022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322025">itAdam7</span>&nbsp;<span class="op" id="6322033">=</span>&nbsp;<span class="num" id="6322035">1</span><br>
<span class="lineno"></span><span class="op" id="6322037">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6322040">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="6322121">type</span>&nbsp;<span class="ident" id="6322126">interlaceScan</span>&nbsp;<span class="keyword" id="6322140">struct</span>&nbsp;<span class="op" id="6322147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322150">xFactor</span><span class="op" id="6322157">,</span>&nbsp;<span class="ident" id="6322159">yFactor</span><span class="op" id="6322166">,</span>&nbsp;<span class="ident" id="6322168">xOffset</span><span class="op" id="6322175">,</span>&nbsp;<span class="ident" id="6322177">yOffset</span>&nbsp;<span class="builtintype" id="6322185">int</span><br>
<span class="lineno"></span><span class="op" id="6322189">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6322192">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="6322267">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="6322311">var</span>&nbsp;<span class="ident" id="6322315">interlacing</span>&nbsp;<span class="op" id="6322327">=</span>&nbsp;<span class="op" id="6322329">[</span><span class="op" id="6322330">]</span><span class="ident" id="6322331">interlaceScan</span><span class="op" id="6322344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322347">{</span><span class="num" id="6322348">8</span><span class="op" id="6322349">,</span>&nbsp;<span class="num" id="6322351">8</span><span class="op" id="6322352">,</span>&nbsp;<span class="num" id="6322354">0</span><span class="op" id="6322355">,</span>&nbsp;<span class="num" id="6322357">0</span><span class="op" id="6322358">}</span><span class="op" id="6322359">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322362">{</span><span class="num" id="6322363">8</span><span class="op" id="6322364">,</span>&nbsp;<span class="num" id="6322366">8</span><span class="op" id="6322367">,</span>&nbsp;<span class="num" id="6322369">4</span><span class="op" id="6322370">,</span>&nbsp;<span class="num" id="6322372">0</span><span class="op" id="6322373">}</span><span class="op" id="6322374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322377">{</span><span class="num" id="6322378">4</span><span class="op" id="6322379">,</span>&nbsp;<span class="num" id="6322381">8</span><span class="op" id="6322382">,</span>&nbsp;<span class="num" id="6322384">0</span><span class="op" id="6322385">,</span>&nbsp;<span class="num" id="6322387">4</span><span class="op" id="6322388">}</span><span class="op" id="6322389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322392">{</span><span class="num" id="6322393">4</span><span class="op" id="6322394">,</span>&nbsp;<span class="num" id="6322396">4</span><span class="op" id="6322397">,</span>&nbsp;<span class="num" id="6322399">2</span><span class="op" id="6322400">,</span>&nbsp;<span class="num" id="6322402">0</span><span class="op" id="6322403">}</span><span class="op" id="6322404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322407">{</span><span class="num" id="6322408">2</span><span class="op" id="6322409">,</span>&nbsp;<span class="num" id="6322411">4</span><span class="op" id="6322412">,</span>&nbsp;<span class="num" id="6322414">0</span><span class="op" id="6322415">,</span>&nbsp;<span class="num" id="6322417">2</span><span class="op" id="6322418">}</span><span class="op" id="6322419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322422">{</span><span class="num" id="6322423">2</span><span class="op" id="6322424">,</span>&nbsp;<span class="num" id="6322426">2</span><span class="op" id="6322427">,</span>&nbsp;<span class="num" id="6322429">1</span><span class="op" id="6322430">,</span>&nbsp;<span class="num" id="6322432">0</span><span class="op" id="6322433">}</span><span class="op" id="6322434">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322437">{</span><span class="num" id="6322438">1</span><span class="op" id="6322439">,</span>&nbsp;<span class="num" id="6322441">2</span><span class="op" id="6322442">,</span>&nbsp;<span class="num" id="6322444">0</span><span class="op" id="6322445">,</span>&nbsp;<span class="num" id="6322447">1</span><span class="op" id="6322448">}</span><span class="op" id="6322449">,</span><br>
<span class="lineno"></span><span class="op" id="6322451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322454">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="6322473">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="6322551">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6322627">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="6322702">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="6322720">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="6322764">const</span>&nbsp;<span class="op" id="6322770">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322773">dsStart</span>&nbsp;<span class="op" id="6322781">=</span>&nbsp;<span class="ident" id="6322783">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322789">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322801">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322813">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322825">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="6322836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322839">const</span>&nbsp;<span class="ident" id="6322845">pngHeader</span>&nbsp;<span class="op" id="6322855">=</span>&nbsp;<span class="string" id="6322857">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322878">type</span>&nbsp;<span class="ident" id="6322883">decoder</span>&nbsp;<span class="keyword" id="6322891">struct</span>&nbsp;<span class="op" id="6322898">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322901">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322915">io</span><span class="op" id="6322917">.</span><span class="ident" id="6322918">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322926">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322940">image</span><span class="op" id="6322945">.</span><span class="ident" id="6322946">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322953">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322967">hash</span><span class="op" id="6322971">.</span><span class="ident" id="6322972">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322980">width</span><span class="op" id="6322985">,</span>&nbsp;<span class="ident" id="6322987">height</span>&nbsp;<span class="builtintype" id="6322994">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322999">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6323013">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323018">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323032">color</span><span class="op" id="6323037">.</span><span class="ident" id="6323038">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323047">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6323061">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323066">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6323080">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323085">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6323099">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323107">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323121">[</span><span class="num" id="6323122">3</span>&nbsp;<span class="op" id="6323124">*</span>&nbsp;<span class="num" id="6323126">256</span><span class="op" id="6323129">]</span><span class="builtintype" id="6323130">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323136">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6323150">int</span><br>
<span class="lineno"></span><span class="op" id="6323154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6323157">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="6323217">type</span>&nbsp;<span class="ident" id="6323222">FormatError</span>&nbsp;<span class="builtintype" id="6323234">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6323242">func</span>&nbsp;<span class="op" id="6323247">(</span><span class="ident" id="6323248">e</span>&nbsp;<span class="ident" id="6323250">FormatError</span><span class="op" id="6323261">)</span>&nbsp;<span class="ident" id="6323263">Error</span><span class="op" id="6323268">(</span><span class="op" id="6323269">)</span>&nbsp;<span class="builtintype" id="6323271">string</span>&nbsp;<span class="op" id="6323278">{</span>&nbsp;<span class="keyword" id="6323280">return</span>&nbsp;<span class="string" id="6323287">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="6323311">+</span>&nbsp;<span class="builtintype" id="6323313">string</span><span class="op" id="6323319">(</span><span class="ident" id="6323320">e</span><span class="op" id="6323321">)</span>&nbsp;<span class="op" id="6323323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6323326">var</span>&nbsp;<span class="ident" id="6323330">chunkOrderError</span>&nbsp;<span class="op" id="6323346">=</span>&nbsp;<span class="ident" id="6323348">FormatError</span><span class="op" id="6323359">(</span><span class="string" id="6323360">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="6323380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="6323383">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="6323473">type</span>&nbsp;<span class="ident" id="6323478">UnsupportedError</span>&nbsp;<span class="builtintype" id="6323495">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6323503">func</span>&nbsp;<span class="op" id="6323508">(</span><span class="ident" id="6323509">e</span>&nbsp;<span class="ident" id="6323511">UnsupportedError</span><span class="op" id="6323527">)</span>&nbsp;<span class="ident" id="6323529">Error</span><span class="op" id="6323534">(</span><span class="op" id="6323535">)</span>&nbsp;<span class="builtintype" id="6323537">string</span>&nbsp;<span class="op" id="6323544">{</span>&nbsp;<span class="keyword" id="6323546">return</span>&nbsp;<span class="string" id="6323553">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="6323582">+</span>&nbsp;<span class="builtintype" id="6323584">string</span><span class="op" id="6323590">(</span><span class="ident" id="6323591">e</span><span class="op" id="6323592">)</span>&nbsp;<span class="op" id="6323594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6323597">func</span>&nbsp;<span class="ident" id="6323602">min</span><span class="op" id="6323605">(</span><span class="ident" id="6323606">a</span><span class="op" id="6323607">,</span>&nbsp;<span class="ident" id="6323609">b</span>&nbsp;<span class="builtintype" id="6323611">int</span><span class="op" id="6323614">)</span>&nbsp;<span class="builtintype" id="6323616">int</span>&nbsp;<span class="op" id="6323620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323623">if</span>&nbsp;<span class="ident" id="6323626">a</span>&nbsp;<span class="op" id="6323628">&lt;</span>&nbsp;<span class="ident" id="6323630">b</span>&nbsp;<span class="op" id="6323632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323636">return</span>&nbsp;<span class="ident" id="6323643">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323649">return</span>&nbsp;<span class="ident" id="6323656">b</span><br>
<span class="lineno">130</span><span class="op" id="6323658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6323661">func</span>&nbsp;<span class="op" id="6323666">(</span><span class="ident" id="6323667">d</span>&nbsp;<span class="op" id="6323669">*</span><span class="ident" id="6323670">decoder</span><span class="op" id="6323677">)</span>&nbsp;<span class="ident" id="6323679">parseIHDR</span><span class="op" id="6323688">(</span><span class="ident" id="6323689">length</span>&nbsp;<span class="builtintype" id="6323696">uint32</span><span class="op" id="6323702">)</span>&nbsp;<span class="builtintype" id="6323704">error</span>&nbsp;<span class="op" id="6323710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323713">if</span>&nbsp;<span class="ident" id="6323716">length</span>&nbsp;<span class="op" id="6323723">!=</span>&nbsp;<span class="num" id="6323726">13</span>&nbsp;<span class="op" id="6323729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323733">return</span>&nbsp;<span class="ident" id="6323740">FormatError</span><span class="op" id="6323751">(</span><span class="string" id="6323752">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="6323769">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323775">if</span>&nbsp;<span class="ident" id="6323778">_</span><span class="op" id="6323779">,</span>&nbsp;<span class="ident" id="6323781">err</span>&nbsp;<span class="op" id="6323785">:=</span>&nbsp;<span class="ident" id="6323788">io</span><span class="op" id="6323790">.</span><span class="ident" id="6323791">ReadFull</span><span class="op" id="6323799">(</span><span class="ident" id="6323800">d</span><span class="op" id="6323801">.</span><span class="ident" id="6323802">r</span><span class="op" id="6323803">,</span>&nbsp;<span class="ident" id="6323805">d</span><span class="op" id="6323806">.</span><span class="ident" id="6323807">tmp</span><span class="op" id="6323810">[</span><span class="op" id="6323811">:</span><span class="num" id="6323812">13</span><span class="op" id="6323814">]</span><span class="op" id="6323815">)</span><span class="op" id="6323816">;</span>&nbsp;<span class="ident" id="6323818">err</span>&nbsp;<span class="op" id="6323822">!=</span>&nbsp;<span class="builtintype" id="6323825">nil</span>&nbsp;<span class="op" id="6323829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323833">return</span>&nbsp;<span class="ident" id="6323840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323848">d</span><span class="op" id="6323849">.</span><span class="ident" id="6323850">crc</span><span class="op" id="6323853">.</span><span class="ident" id="6323854">Write</span><span class="op" id="6323859">(</span><span class="ident" id="6323860">d</span><span class="op" id="6323861">.</span><span class="ident" id="6323862">tmp</span><span class="op" id="6323865">[</span><span class="op" id="6323866">:</span><span class="num" id="6323867">13</span><span class="op" id="6323869">]</span><span class="op" id="6323870">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323873">if</span>&nbsp;<span class="ident" id="6323876">d</span><span class="op" id="6323877">.</span><span class="ident" id="6323878">tmp</span><span class="op" id="6323881">[</span><span class="num" id="6323882">10</span><span class="op" id="6323884">]</span>&nbsp;<span class="op" id="6323886">!=</span>&nbsp;<span class="num" id="6323889">0</span>&nbsp;<span class="op" id="6323891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323895">return</span>&nbsp;<span class="ident" id="6323902">UnsupportedError</span><span class="op" id="6323918">(</span><span class="string" id="6323919">&#34;compression&nbsp;method&#34;</span><span class="op" id="6323939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323945">if</span>&nbsp;<span class="ident" id="6323948">d</span><span class="op" id="6323949">.</span><span class="ident" id="6323950">tmp</span><span class="op" id="6323953">[</span><span class="num" id="6323954">11</span><span class="op" id="6323956">]</span>&nbsp;<span class="op" id="6323958">!=</span>&nbsp;<span class="num" id="6323961">0</span>&nbsp;<span class="op" id="6323963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323967">return</span>&nbsp;<span class="ident" id="6323974">UnsupportedError</span><span class="op" id="6323990">(</span><span class="string" id="6323991">&#34;filter&nbsp;method&#34;</span><span class="op" id="6324006">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324012">if</span>&nbsp;<span class="ident" id="6324015">d</span><span class="op" id="6324016">.</span><span class="ident" id="6324017">tmp</span><span class="op" id="6324020">[</span><span class="num" id="6324021">12</span><span class="op" id="6324023">]</span>&nbsp;<span class="op" id="6324025">!=</span>&nbsp;<span class="ident" id="6324028">itNone</span>&nbsp;<span class="op" id="6324035">&amp;&amp;</span>&nbsp;<span class="ident" id="6324038">d</span><span class="op" id="6324039">.</span><span class="ident" id="6324040">tmp</span><span class="op" id="6324043">[</span><span class="num" id="6324044">12</span><span class="op" id="6324046">]</span>&nbsp;<span class="op" id="6324048">!=</span>&nbsp;<span class="ident" id="6324051">itAdam7</span>&nbsp;<span class="op" id="6324059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324063">return</span>&nbsp;<span class="ident" id="6324070">FormatError</span><span class="op" id="6324081">(</span><span class="string" id="6324082">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="6324108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324114">d</span><span class="op" id="6324115">.</span><span class="ident" id="6324116">interlace</span>&nbsp;<span class="op" id="6324126">=</span>&nbsp;<span class="builtintype" id="6324128">int</span><span class="op" id="6324131">(</span><span class="ident" id="6324132">d</span><span class="op" id="6324133">.</span><span class="ident" id="6324134">tmp</span><span class="op" id="6324137">[</span><span class="num" id="6324138">12</span><span class="op" id="6324140">]</span><span class="op" id="6324141">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324144">w</span>&nbsp;<span class="op" id="6324146">:=</span>&nbsp;<span class="builtintype" id="6324149">int32</span><span class="op" id="6324154">(</span><span class="ident" id="6324155">binary</span><span class="op" id="6324161">.</span><span class="ident" id="6324162">BigEndian</span><span class="op" id="6324171">.</span><span class="ident" id="6324172">Uint32</span><span class="op" id="6324178">(</span><span class="ident" id="6324179">d</span><span class="op" id="6324180">.</span><span class="ident" id="6324181">tmp</span><span class="op" id="6324184">[</span><span class="num" id="6324185">0</span><span class="op" id="6324186">:</span><span class="num" id="6324187">4</span><span class="op" id="6324188">]</span><span class="op" id="6324189">)</span><span class="op" id="6324190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324193">h</span>&nbsp;<span class="op" id="6324195">:=</span>&nbsp;<span class="builtintype" id="6324198">int32</span><span class="op" id="6324203">(</span><span class="ident" id="6324204">binary</span><span class="op" id="6324210">.</span><span class="ident" id="6324211">BigEndian</span><span class="op" id="6324220">.</span><span class="ident" id="6324221">Uint32</span><span class="op" id="6324227">(</span><span class="ident" id="6324228">d</span><span class="op" id="6324229">.</span><span class="ident" id="6324230">tmp</span><span class="op" id="6324233">[</span><span class="num" id="6324234">4</span><span class="op" id="6324235">:</span><span class="num" id="6324236">8</span><span class="op" id="6324237">]</span><span class="op" id="6324238">)</span><span class="op" id="6324239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324242">if</span>&nbsp;<span class="ident" id="6324245">w</span>&nbsp;<span class="op" id="6324247">&lt;</span>&nbsp;<span class="num" id="6324249">0</span>&nbsp;<span class="op" id="6324251">||</span>&nbsp;<span class="ident" id="6324254">h</span>&nbsp;<span class="op" id="6324256">&lt;</span>&nbsp;<span class="num" id="6324258">0</span>&nbsp;<span class="op" id="6324260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324264">return</span>&nbsp;<span class="ident" id="6324271">FormatError</span><span class="op" id="6324282">(</span><span class="string" id="6324283">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="6324303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324306">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324309">nPixels</span>&nbsp;<span class="op" id="6324317">:=</span>&nbsp;<span class="ident" id="6324320">int64</span><span class="op" id="6324325">(</span><span class="ident" id="6324326">w</span><span class="op" id="6324327">)</span>&nbsp;<span class="op" id="6324329">*</span>&nbsp;<span class="ident" id="6324331">int64</span><span class="op" id="6324336">(</span><span class="ident" id="6324337">h</span><span class="op" id="6324338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324341">if</span>&nbsp;<span class="ident" id="6324344">nPixels</span>&nbsp;<span class="op" id="6324352">!=</span>&nbsp;<span class="ident" id="6324355">int64</span><span class="op" id="6324360">(</span><span class="builtintype" id="6324361">int</span><span class="op" id="6324364">(</span><span class="ident" id="6324365">nPixels</span><span class="op" id="6324372">)</span><span class="op" id="6324373">)</span>&nbsp;<span class="op" id="6324375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324379">return</span>&nbsp;<span class="ident" id="6324386">UnsupportedError</span><span class="op" id="6324402">(</span><span class="string" id="6324403">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="6324423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324429">d</span><span class="op" id="6324430">.</span><span class="ident" id="6324431">cb</span>&nbsp;<span class="op" id="6324434">=</span>&nbsp;<span class="ident" id="6324436">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324447">d</span><span class="op" id="6324448">.</span><span class="ident" id="6324449">depth</span>&nbsp;<span class="op" id="6324455">=</span>&nbsp;<span class="builtintype" id="6324457">int</span><span class="op" id="6324460">(</span><span class="ident" id="6324461">d</span><span class="op" id="6324462">.</span><span class="ident" id="6324463">tmp</span><span class="op" id="6324466">[</span><span class="num" id="6324467">8</span><span class="op" id="6324468">]</span><span class="op" id="6324469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324472">switch</span>&nbsp;<span class="ident" id="6324479">d</span><span class="op" id="6324480">.</span><span class="ident" id="6324481">depth</span>&nbsp;<span class="op" id="6324487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324490">case</span>&nbsp;<span class="num" id="6324495">1</span><span class="op" id="6324496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324500">switch</span>&nbsp;<span class="ident" id="6324507">d</span><span class="op" id="6324508">.</span><span class="ident" id="6324509">tmp</span><span class="op" id="6324512">[</span><span class="num" id="6324513">9</span><span class="op" id="6324514">]</span>&nbsp;<span class="op" id="6324516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324520">case</span>&nbsp;<span class="ident" id="6324525">ctGrayscale</span><span class="op" id="6324536">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324541">d</span><span class="op" id="6324542">.</span><span class="ident" id="6324543">cb</span>&nbsp;<span class="op" id="6324546">=</span>&nbsp;<span class="ident" id="6324548">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324555">case</span>&nbsp;<span class="ident" id="6324560">ctPaletted</span><span class="op" id="6324570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324575">d</span><span class="op" id="6324576">.</span><span class="ident" id="6324577">cb</span>&nbsp;<span class="op" id="6324580">=</span>&nbsp;<span class="ident" id="6324582">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324592">case</span>&nbsp;<span class="num" id="6324597">2</span><span class="op" id="6324598">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324602">switch</span>&nbsp;<span class="ident" id="6324609">d</span><span class="op" id="6324610">.</span><span class="ident" id="6324611">tmp</span><span class="op" id="6324614">[</span><span class="num" id="6324615">9</span><span class="op" id="6324616">]</span>&nbsp;<span class="op" id="6324618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324622">case</span>&nbsp;<span class="ident" id="6324627">ctGrayscale</span><span class="op" id="6324638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324643">d</span><span class="op" id="6324644">.</span><span class="ident" id="6324645">cb</span>&nbsp;<span class="op" id="6324648">=</span>&nbsp;<span class="ident" id="6324650">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324657">case</span>&nbsp;<span class="ident" id="6324662">ctPaletted</span><span class="op" id="6324672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324677">d</span><span class="op" id="6324678">.</span><span class="ident" id="6324679">cb</span>&nbsp;<span class="op" id="6324682">=</span>&nbsp;<span class="ident" id="6324684">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324694">case</span>&nbsp;<span class="num" id="6324699">4</span><span class="op" id="6324700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324704">switch</span>&nbsp;<span class="ident" id="6324711">d</span><span class="op" id="6324712">.</span><span class="ident" id="6324713">tmp</span><span class="op" id="6324716">[</span><span class="num" id="6324717">9</span><span class="op" id="6324718">]</span>&nbsp;<span class="op" id="6324720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324724">case</span>&nbsp;<span class="ident" id="6324729">ctGrayscale</span><span class="op" id="6324740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324745">d</span><span class="op" id="6324746">.</span><span class="ident" id="6324747">cb</span>&nbsp;<span class="op" id="6324750">=</span>&nbsp;<span class="ident" id="6324752">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324759">case</span>&nbsp;<span class="ident" id="6324764">ctPaletted</span><span class="op" id="6324774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324779">d</span><span class="op" id="6324780">.</span><span class="ident" id="6324781">cb</span>&nbsp;<span class="op" id="6324784">=</span>&nbsp;<span class="ident" id="6324786">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6324793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324796">case</span>&nbsp;<span class="num" id="6324801">8</span><span class="op" id="6324802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324806">switch</span>&nbsp;<span class="ident" id="6324813">d</span><span class="op" id="6324814">.</span><span class="ident" id="6324815">tmp</span><span class="op" id="6324818">[</span><span class="num" id="6324819">9</span><span class="op" id="6324820">]</span>&nbsp;<span class="op" id="6324822">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324826">case</span>&nbsp;<span class="ident" id="6324831">ctGrayscale</span><span class="op" id="6324842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324847">d</span><span class="op" id="6324848">.</span><span class="ident" id="6324849">cb</span>&nbsp;<span class="op" id="6324852">=</span>&nbsp;<span class="ident" id="6324854">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324861">case</span>&nbsp;<span class="ident" id="6324866">ctTrueColor</span><span class="op" id="6324877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324882">d</span><span class="op" id="6324883">.</span><span class="ident" id="6324884">cb</span>&nbsp;<span class="op" id="6324887">=</span>&nbsp;<span class="ident" id="6324889">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324897">case</span>&nbsp;<span class="ident" id="6324902">ctPaletted</span><span class="op" id="6324912">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324917">d</span><span class="op" id="6324918">.</span><span class="ident" id="6324919">cb</span>&nbsp;<span class="op" id="6324922">=</span>&nbsp;<span class="ident" id="6324924">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324931">case</span>&nbsp;<span class="ident" id="6324936">ctGrayscaleAlpha</span><span class="op" id="6324952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324957">d</span><span class="op" id="6324958">.</span><span class="ident" id="6324959">cb</span>&nbsp;<span class="op" id="6324962">=</span>&nbsp;<span class="ident" id="6324964">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6324972">case</span>&nbsp;<span class="ident" id="6324977">ctTrueColorAlpha</span><span class="op" id="6324993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6324998">d</span><span class="op" id="6324999">.</span><span class="ident" id="6325000">cb</span>&nbsp;<span class="op" id="6325003">=</span>&nbsp;<span class="ident" id="6325005">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325017">case</span>&nbsp;<span class="num" id="6325022">16</span><span class="op" id="6325024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325028">switch</span>&nbsp;<span class="ident" id="6325035">d</span><span class="op" id="6325036">.</span><span class="ident" id="6325037">tmp</span><span class="op" id="6325040">[</span><span class="num" id="6325041">9</span><span class="op" id="6325042">]</span>&nbsp;<span class="op" id="6325044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325048">case</span>&nbsp;<span class="ident" id="6325053">ctGrayscale</span><span class="op" id="6325064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325069">d</span><span class="op" id="6325070">.</span><span class="ident" id="6325071">cb</span>&nbsp;<span class="op" id="6325074">=</span>&nbsp;<span class="ident" id="6325076">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325084">case</span>&nbsp;<span class="ident" id="6325089">ctTrueColor</span><span class="op" id="6325100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325105">d</span><span class="op" id="6325106">.</span><span class="ident" id="6325107">cb</span>&nbsp;<span class="op" id="6325110">=</span>&nbsp;<span class="ident" id="6325112">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325121">case</span>&nbsp;<span class="ident" id="6325126">ctGrayscaleAlpha</span><span class="op" id="6325142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325147">d</span><span class="op" id="6325148">.</span><span class="ident" id="6325149">cb</span>&nbsp;<span class="op" id="6325152">=</span>&nbsp;<span class="ident" id="6325154">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325163">case</span>&nbsp;<span class="ident" id="6325168">ctTrueColorAlpha</span><span class="op" id="6325184">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325189">d</span><span class="op" id="6325190">.</span><span class="ident" id="6325191">cb</span>&nbsp;<span class="op" id="6325194">=</span>&nbsp;<span class="ident" id="6325196">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325212">if</span>&nbsp;<span class="ident" id="6325215">d</span><span class="op" id="6325216">.</span><span class="ident" id="6325217">cb</span>&nbsp;<span class="op" id="6325220">==</span>&nbsp;<span class="ident" id="6325223">cbInvalid</span>&nbsp;<span class="op" id="6325233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325237">return</span>&nbsp;<span class="ident" id="6325244">UnsupportedError</span><span class="op" id="6325260">(</span><span class="ident" id="6325261">fmt</span><span class="op" id="6325264">.</span><span class="ident" id="6325265">Sprintf</span><span class="op" id="6325272">(</span><span class="string" id="6325273">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="6325302">,</span>&nbsp;<span class="ident" id="6325304">d</span><span class="op" id="6325305">.</span><span class="ident" id="6325306">tmp</span><span class="op" id="6325309">[</span><span class="num" id="6325310">8</span><span class="op" id="6325311">]</span><span class="op" id="6325312">,</span>&nbsp;<span class="ident" id="6325314">d</span><span class="op" id="6325315">.</span><span class="ident" id="6325316">tmp</span><span class="op" id="6325319">[</span><span class="num" id="6325320">9</span><span class="op" id="6325321">]</span><span class="op" id="6325322">)</span><span class="op" id="6325323">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325329">d</span><span class="op" id="6325330">.</span><span class="ident" id="6325331">width</span><span class="op" id="6325336">,</span>&nbsp;<span class="ident" id="6325338">d</span><span class="op" id="6325339">.</span><span class="ident" id="6325340">height</span>&nbsp;<span class="op" id="6325347">=</span>&nbsp;<span class="builtintype" id="6325349">int</span><span class="op" id="6325352">(</span><span class="ident" id="6325353">w</span><span class="op" id="6325354">)</span><span class="op" id="6325355">,</span>&nbsp;<span class="builtintype" id="6325357">int</span><span class="op" id="6325360">(</span><span class="ident" id="6325361">h</span><span class="op" id="6325362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325365">return</span>&nbsp;<span class="ident" id="6325372">d</span><span class="op" id="6325373">.</span><span class="ident" id="6325374">verifyChecksum</span><span class="op" id="6325388">(</span><span class="op" id="6325389">)</span><br>
<span class="lineno"></span><span class="op" id="6325391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6325394">func</span>&nbsp;<span class="op" id="6325399">(</span><span class="ident" id="6325400">d</span>&nbsp;<span class="op" id="6325402">*</span><span class="ident" id="6325403">decoder</span><span class="op" id="6325410">)</span>&nbsp;<span class="ident" id="6325412">parsePLTE</span><span class="op" id="6325421">(</span><span class="ident" id="6325422">length</span>&nbsp;<span class="builtintype" id="6325429">uint32</span><span class="op" id="6325435">)</span>&nbsp;<span class="builtintype" id="6325437">error</span>&nbsp;<span class="op" id="6325443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325446">np</span>&nbsp;<span class="op" id="6325449">:=</span>&nbsp;<span class="builtintype" id="6325452">int</span><span class="op" id="6325455">(</span><span class="ident" id="6325456">length</span>&nbsp;<span class="op" id="6325463">/</span>&nbsp;<span class="num" id="6325465">3</span><span class="op" id="6325466">)</span>&nbsp;<span class="comment" id="6325468">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325503">if</span>&nbsp;<span class="ident" id="6325506">length</span><span class="op" id="6325512">%</span><span class="num" id="6325513">3</span>&nbsp;<span class="op" id="6325515">!=</span>&nbsp;<span class="num" id="6325518">0</span>&nbsp;<span class="op" id="6325520">||</span>&nbsp;<span class="ident" id="6325523">np</span>&nbsp;<span class="op" id="6325526">&lt;=</span>&nbsp;<span class="num" id="6325529">0</span>&nbsp;<span class="op" id="6325531">||</span>&nbsp;<span class="ident" id="6325534">np</span>&nbsp;<span class="op" id="6325537">&gt;</span>&nbsp;<span class="num" id="6325539">256</span>&nbsp;<span class="op" id="6325543">||</span>&nbsp;<span class="ident" id="6325546">np</span>&nbsp;<span class="op" id="6325549">&gt;</span>&nbsp;<span class="num" id="6325551">1</span><span class="op" id="6325552">&lt;&lt;</span><span class="builtintype" id="6325554">uint</span><span class="op" id="6325558">(</span><span class="ident" id="6325559">d</span><span class="op" id="6325560">.</span><span class="ident" id="6325561">depth</span><span class="op" id="6325566">)</span>&nbsp;<span class="op" id="6325568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325572">return</span>&nbsp;<span class="ident" id="6325579">FormatError</span><span class="op" id="6325590">(</span><span class="string" id="6325591">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="6325608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325611">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325614">n</span><span class="op" id="6325615">,</span>&nbsp;<span class="ident" id="6325617">err</span>&nbsp;<span class="op" id="6325621">:=</span>&nbsp;<span class="ident" id="6325624">io</span><span class="op" id="6325626">.</span><span class="ident" id="6325627">ReadFull</span><span class="op" id="6325635">(</span><span class="ident" id="6325636">d</span><span class="op" id="6325637">.</span><span class="ident" id="6325638">r</span><span class="op" id="6325639">,</span>&nbsp;<span class="ident" id="6325641">d</span><span class="op" id="6325642">.</span><span class="ident" id="6325643">tmp</span><span class="op" id="6325646">[</span><span class="op" id="6325647">:</span><span class="num" id="6325648">3</span><span class="op" id="6325649">*</span><span class="ident" id="6325650">np</span><span class="op" id="6325652">]</span><span class="op" id="6325653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325656">if</span>&nbsp;<span class="ident" id="6325659">err</span>&nbsp;<span class="op" id="6325663">!=</span>&nbsp;<span class="builtintype" id="6325666">nil</span>&nbsp;<span class="op" id="6325670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325674">return</span>&nbsp;<span class="ident" id="6325681">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325689">d</span><span class="op" id="6325690">.</span><span class="ident" id="6325691">crc</span><span class="op" id="6325694">.</span><span class="ident" id="6325695">Write</span><span class="op" id="6325700">(</span><span class="ident" id="6325701">d</span><span class="op" id="6325702">.</span><span class="ident" id="6325703">tmp</span><span class="op" id="6325706">[</span><span class="op" id="6325707">:</span><span class="ident" id="6325708">n</span><span class="op" id="6325709">]</span><span class="op" id="6325710">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325713">switch</span>&nbsp;<span class="ident" id="6325720">d</span><span class="op" id="6325721">.</span><span class="ident" id="6325722">cb</span>&nbsp;<span class="op" id="6325725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325728">case</span>&nbsp;<span class="ident" id="6325733">cbP1</span><span class="op" id="6325737">,</span>&nbsp;<span class="ident" id="6325739">cbP2</span><span class="op" id="6325743">,</span>&nbsp;<span class="ident" id="6325745">cbP4</span><span class="op" id="6325749">,</span>&nbsp;<span class="ident" id="6325751">cbP8</span><span class="op" id="6325755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325759">d</span><span class="op" id="6325760">.</span><span class="ident" id="6325761">palette</span>&nbsp;<span class="op" id="6325769">=</span>&nbsp;<span class="builtinfunc" id="6325771">make</span><span class="op" id="6325775">(</span><span class="ident" id="6325776">color</span><span class="op" id="6325781">.</span><span class="ident" id="6325782">Palette</span><span class="op" id="6325789">,</span>&nbsp;<span class="num" id="6325791">256</span><span class="op" id="6325794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325798">for</span>&nbsp;<span class="ident" id="6325802">i</span>&nbsp;<span class="op" id="6325804">:=</span>&nbsp;<span class="num" id="6325807">0</span><span class="op" id="6325808">;</span>&nbsp;<span class="ident" id="6325810">i</span>&nbsp;<span class="op" id="6325812">&lt;</span>&nbsp;<span class="ident" id="6325814">np</span><span class="op" id="6325816">;</span>&nbsp;<span class="ident" id="6325818">i</span><span class="op" id="6325819">++</span>&nbsp;<span class="op" id="6325822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6325827">d</span><span class="op" id="6325828">.</span><span class="ident" id="6325829">palette</span><span class="op" id="6325836">[</span><span class="ident" id="6325837">i</span><span class="op" id="6325838">]</span>&nbsp;<span class="op" id="6325840">=</span>&nbsp;<span class="ident" id="6325842">color</span><span class="op" id="6325847">.</span><span class="ident" id="6325848">RGBA</span><span class="op" id="6325852">{</span><span class="ident" id="6325853">d</span><span class="op" id="6325854">.</span><span class="ident" id="6325855">tmp</span><span class="op" id="6325858">[</span><span class="num" id="6325859">3</span><span class="op" id="6325860">*</span><span class="ident" id="6325861">i</span><span class="op" id="6325862">+</span><span class="num" id="6325863">0</span><span class="op" id="6325864">]</span><span class="op" id="6325865">,</span>&nbsp;<span class="ident" id="6325867">d</span><span class="op" id="6325868">.</span><span class="ident" id="6325869">tmp</span><span class="op" id="6325872">[</span><span class="num" id="6325873">3</span><span class="op" id="6325874">*</span><span class="ident" id="6325875">i</span><span class="op" id="6325876">+</span><span class="num" id="6325877">1</span><span class="op" id="6325878">]</span><span class="op" id="6325879">,</span>&nbsp;<span class="ident" id="6325881">d</span><span class="op" id="6325882">.</span><span class="ident" id="6325883">tmp</span><span class="op" id="6325886">[</span><span class="num" id="6325887">3</span><span class="op" id="6325888">*</span><span class="ident" id="6325889">i</span><span class="op" id="6325890">+</span><span class="num" id="6325891">2</span><span class="op" id="6325892">]</span><span class="op" id="6325893">,</span>&nbsp;<span class="num" id="6325895">0xff</span><span class="op" id="6325899">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6325903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6325907">for</span>&nbsp;<span class="ident" id="6325911">i</span>&nbsp;<span class="op" id="6325913">:=</span>&nbsp;<span class="ident" id="6325916">np</span><span class="op" id="6325918">;</span>&nbsp;<span class="ident" id="6325920">i</span>&nbsp;<span class="op" id="6325922">&lt;</span>&nbsp;<span class="num" id="6325924">256</span><span class="op" id="6325927">;</span>&nbsp;<span class="ident" id="6325929">i</span><span class="op" id="6325930">++</span>&nbsp;<span class="op" id="6325933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6325938">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326014">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326092">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326166">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326237">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6326279">d</span><span class="op" id="6326280">.</span><span class="ident" id="6326281">palette</span><span class="op" id="6326288">[</span><span class="ident" id="6326289">i</span><span class="op" id="6326290">]</span>&nbsp;<span class="op" id="6326292">=</span>&nbsp;<span class="ident" id="6326294">color</span><span class="op" id="6326299">.</span><span class="ident" id="6326300">RGBA</span><span class="op" id="6326304">{</span><span class="num" id="6326305">0x00</span><span class="op" id="6326309">,</span>&nbsp;<span class="num" id="6326311">0x00</span><span class="op" id="6326315">,</span>&nbsp;<span class="num" id="6326317">0x00</span><span class="op" id="6326321">,</span>&nbsp;<span class="num" id="6326323">0xff</span><span class="op" id="6326327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6326331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6326335">d</span><span class="op" id="6326336">.</span><span class="ident" id="6326337">palette</span>&nbsp;<span class="op" id="6326345">=</span>&nbsp;<span class="ident" id="6326347">d</span><span class="op" id="6326348">.</span><span class="ident" id="6326349">palette</span><span class="op" id="6326356">[</span><span class="op" id="6326357">:</span><span class="ident" id="6326358">np</span><span class="op" id="6326360">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326363">case</span>&nbsp;<span class="ident" id="6326368">cbTC8</span><span class="op" id="6326373">,</span>&nbsp;<span class="ident" id="6326375">cbTCA8</span><span class="op" id="6326381">,</span>&nbsp;<span class="ident" id="6326383">cbTC16</span><span class="op" id="6326389">,</span>&nbsp;<span class="ident" id="6326391">cbTCA16</span><span class="op" id="6326398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326402">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6326482">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326567">default</span><span class="op" id="6326574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326578">return</span>&nbsp;<span class="ident" id="6326585">FormatError</span><span class="op" id="6326596">(</span><span class="string" id="6326597">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6326624">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6326627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326630">return</span>&nbsp;<span class="ident" id="6326637">d</span><span class="op" id="6326638">.</span><span class="ident" id="6326639">verifyChecksum</span><span class="op" id="6326653">(</span><span class="op" id="6326654">)</span><br>
<span class="lineno"></span><span class="op" id="6326656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6326659">func</span>&nbsp;<span class="op" id="6326664">(</span><span class="ident" id="6326665">d</span>&nbsp;<span class="op" id="6326667">*</span><span class="ident" id="6326668">decoder</span><span class="op" id="6326675">)</span>&nbsp;<span class="ident" id="6326677">parsetRNS</span><span class="op" id="6326686">(</span><span class="ident" id="6326687">length</span>&nbsp;<span class="builtintype" id="6326694">uint32</span><span class="op" id="6326700">)</span>&nbsp;<span class="builtintype" id="6326702">error</span>&nbsp;<span class="op" id="6326708">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326711">if</span>&nbsp;<span class="ident" id="6326714">length</span>&nbsp;<span class="op" id="6326721">&gt;</span>&nbsp;<span class="num" id="6326723">256</span>&nbsp;<span class="op" id="6326727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326731">return</span>&nbsp;<span class="ident" id="6326738">FormatError</span><span class="op" id="6326749">(</span><span class="string" id="6326750">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="6326767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6326770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6326773">n</span><span class="op" id="6326774">,</span>&nbsp;<span class="ident" id="6326776">err</span>&nbsp;<span class="op" id="6326780">:=</span>&nbsp;<span class="ident" id="6326783">io</span><span class="op" id="6326785">.</span><span class="ident" id="6326786">ReadFull</span><span class="op" id="6326794">(</span><span class="ident" id="6326795">d</span><span class="op" id="6326796">.</span><span class="ident" id="6326797">r</span><span class="op" id="6326798">,</span>&nbsp;<span class="ident" id="6326800">d</span><span class="op" id="6326801">.</span><span class="ident" id="6326802">tmp</span><span class="op" id="6326805">[</span><span class="op" id="6326806">:</span><span class="ident" id="6326807">length</span><span class="op" id="6326813">]</span><span class="op" id="6326814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326817">if</span>&nbsp;<span class="ident" id="6326820">err</span>&nbsp;<span class="op" id="6326824">!=</span>&nbsp;<span class="builtintype" id="6326827">nil</span>&nbsp;<span class="op" id="6326831">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326835">return</span>&nbsp;<span class="ident" id="6326842">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6326847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6326850">d</span><span class="op" id="6326851">.</span><span class="ident" id="6326852">crc</span><span class="op" id="6326855">.</span><span class="ident" id="6326856">Write</span><span class="op" id="6326861">(</span><span class="ident" id="6326862">d</span><span class="op" id="6326863">.</span><span class="ident" id="6326864">tmp</span><span class="op" id="6326867">[</span><span class="op" id="6326868">:</span><span class="ident" id="6326869">n</span><span class="op" id="6326870">]</span><span class="op" id="6326871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326874">switch</span>&nbsp;<span class="ident" id="6326881">d</span><span class="op" id="6326882">.</span><span class="ident" id="6326883">cb</span>&nbsp;<span class="op" id="6326886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326889">case</span>&nbsp;<span class="ident" id="6326894">cbG8</span><span class="op" id="6326898">,</span>&nbsp;<span class="ident" id="6326900">cbG16</span><span class="op" id="6326905">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326909">return</span>&nbsp;<span class="ident" id="6326916">UnsupportedError</span><span class="op" id="6326932">(</span><span class="string" id="6326933">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="6326957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326960">case</span>&nbsp;<span class="ident" id="6326965">cbTC8</span><span class="op" id="6326970">,</span>&nbsp;<span class="ident" id="6326972">cbTC16</span><span class="op" id="6326978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6326982">return</span>&nbsp;<span class="ident" id="6326989">UnsupportedError</span><span class="op" id="6327005">(</span><span class="string" id="6327006">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="6327030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327033">case</span>&nbsp;<span class="ident" id="6327038">cbP1</span><span class="op" id="6327042">,</span>&nbsp;<span class="ident" id="6327044">cbP2</span><span class="op" id="6327048">,</span>&nbsp;<span class="ident" id="6327050">cbP4</span><span class="op" id="6327054">,</span>&nbsp;<span class="ident" id="6327056">cbP8</span><span class="op" id="6327060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327064">if</span>&nbsp;<span class="builtinfunc" id="6327067">len</span><span class="op" id="6327070">(</span><span class="ident" id="6327071">d</span><span class="op" id="6327072">.</span><span class="ident" id="6327073">palette</span><span class="op" id="6327080">)</span>&nbsp;<span class="op" id="6327082">&lt;</span>&nbsp;<span class="ident" id="6327084">n</span>&nbsp;<span class="op" id="6327086">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6327091">d</span><span class="op" id="6327092">.</span><span class="ident" id="6327093">palette</span>&nbsp;<span class="op" id="6327101">=</span>&nbsp;<span class="ident" id="6327103">d</span><span class="op" id="6327104">.</span><span class="ident" id="6327105">palette</span><span class="op" id="6327112">[</span><span class="op" id="6327113">:</span><span class="ident" id="6327114">n</span><span class="op" id="6327115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6327119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327123">for</span>&nbsp;<span class="ident" id="6327127">i</span>&nbsp;<span class="op" id="6327129">:=</span>&nbsp;<span class="num" id="6327132">0</span><span class="op" id="6327133">;</span>&nbsp;<span class="ident" id="6327135">i</span>&nbsp;<span class="op" id="6327137">&lt;</span>&nbsp;<span class="ident" id="6327139">n</span><span class="op" id="6327140">;</span>&nbsp;<span class="ident" id="6327142">i</span><span class="op" id="6327143">++</span>&nbsp;<span class="op" id="6327146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6327151">rgba</span>&nbsp;<span class="op" id="6327156">:=</span>&nbsp;<span class="ident" id="6327159">d</span><span class="op" id="6327160">.</span><span class="ident" id="6327161">palette</span><span class="op" id="6327168">[</span><span class="ident" id="6327169">i</span><span class="op" id="6327170">]</span><span class="op" id="6327171">.</span><span class="op" id="6327172">(</span><span class="ident" id="6327173">color</span><span class="op" id="6327178">.</span><span class="ident" id="6327179">RGBA</span><span class="op" id="6327183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6327188">d</span><span class="op" id="6327189">.</span><span class="ident" id="6327190">palette</span><span class="op" id="6327197">[</span><span class="ident" id="6327198">i</span><span class="op" id="6327199">]</span>&nbsp;<span class="op" id="6327201">=</span>&nbsp;<span class="ident" id="6327203">color</span><span class="op" id="6327208">.</span><span class="ident" id="6327209">NRGBA</span><span class="op" id="6327214">{</span><span class="ident" id="6327215">rgba</span><span class="op" id="6327219">.</span><span class="ident" id="6327220">R</span><span class="op" id="6327221">,</span>&nbsp;<span class="ident" id="6327223">rgba</span><span class="op" id="6327227">.</span><span class="ident" id="6327228">G</span><span class="op" id="6327229">,</span>&nbsp;<span class="ident" id="6327231">rgba</span><span class="op" id="6327235">.</span><span class="ident" id="6327236">B</span><span class="op" id="6327237">,</span>&nbsp;<span class="ident" id="6327239">d</span><span class="op" id="6327240">.</span><span class="ident" id="6327241">tmp</span><span class="op" id="6327244">[</span><span class="ident" id="6327245">i</span><span class="op" id="6327246">]</span><span class="op" id="6327247">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6327251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327254">case</span>&nbsp;<span class="ident" id="6327259">cbGA8</span><span class="op" id="6327264">,</span>&nbsp;<span class="ident" id="6327266">cbGA16</span><span class="op" id="6327272">,</span>&nbsp;<span class="ident" id="6327274">cbTCA8</span><span class="op" id="6327280">,</span>&nbsp;<span class="ident" id="6327282">cbTCA16</span><span class="op" id="6327289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327293">return</span>&nbsp;<span class="ident" id="6327300">FormatError</span><span class="op" id="6327311">(</span><span class="string" id="6327312">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="6327339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6327342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327345">return</span>&nbsp;<span class="ident" id="6327352">d</span><span class="op" id="6327353">.</span><span class="ident" id="6327354">verifyChecksum</span><span class="op" id="6327368">(</span><span class="op" id="6327369">)</span><br>
<span class="lineno">275</span><span class="op" id="6327371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6327374">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6327451">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="6327524">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="6327585">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="6327665">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6327745">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="6327822">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="6327877">func</span>&nbsp;<span class="op" id="6327882">(</span><span class="ident" id="6327883">d</span>&nbsp;<span class="op" id="6327885">*</span><span class="ident" id="6327886">decoder</span><span class="op" id="6327893">)</span>&nbsp;<span class="ident" id="6327895">Read</span><span class="op" id="6327899">(</span><span class="ident" id="6327900">p</span>&nbsp;<span class="op" id="6327902">[</span><span class="op" id="6327903">]</span><span class="builtintype" id="6327904">byte</span><span class="op" id="6327908">)</span>&nbsp;<span class="op" id="6327910">(</span><span class="builtintype" id="6327911">int</span><span class="op" id="6327914">,</span>&nbsp;<span class="builtintype" id="6327916">error</span><span class="op" id="6327921">)</span>&nbsp;<span class="op" id="6327923">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327926">if</span>&nbsp;<span class="builtinfunc" id="6327929">len</span><span class="op" id="6327932">(</span><span class="ident" id="6327933">p</span><span class="op" id="6327934">)</span>&nbsp;<span class="op" id="6327936">==</span>&nbsp;<span class="num" id="6327939">0</span>&nbsp;<span class="op" id="6327941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327945">return</span>&nbsp;<span class="num" id="6327952">0</span><span class="op" id="6327953">,</span>&nbsp;<span class="builtintype" id="6327955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6327960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6327963">for</span>&nbsp;<span class="ident" id="6327967">d</span><span class="op" id="6327968">.</span><span class="ident" id="6327969">idatLength</span>&nbsp;<span class="op" id="6327980">==</span>&nbsp;<span class="num" id="6327983">0</span>&nbsp;<span class="op" id="6327985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6327989">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328062">if</span>&nbsp;<span class="ident" id="6328065">err</span>&nbsp;<span class="op" id="6328069">:=</span>&nbsp;<span class="ident" id="6328072">d</span><span class="op" id="6328073">.</span><span class="ident" id="6328074">verifyChecksum</span><span class="op" id="6328088">(</span><span class="op" id="6328089">)</span><span class="op" id="6328090">;</span>&nbsp;<span class="ident" id="6328092">err</span>&nbsp;<span class="op" id="6328096">!=</span>&nbsp;<span class="builtintype" id="6328099">nil</span>&nbsp;<span class="op" id="6328103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328108">return</span>&nbsp;<span class="num" id="6328115">0</span><span class="op" id="6328116">,</span>&nbsp;<span class="ident" id="6328118">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6328128">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6328198">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328224">if</span>&nbsp;<span class="ident" id="6328227">_</span><span class="op" id="6328228">,</span>&nbsp;<span class="ident" id="6328230">err</span>&nbsp;<span class="op" id="6328234">:=</span>&nbsp;<span class="ident" id="6328237">io</span><span class="op" id="6328239">.</span><span class="ident" id="6328240">ReadFull</span><span class="op" id="6328248">(</span><span class="ident" id="6328249">d</span><span class="op" id="6328250">.</span><span class="ident" id="6328251">r</span><span class="op" id="6328252">,</span>&nbsp;<span class="ident" id="6328254">d</span><span class="op" id="6328255">.</span><span class="ident" id="6328256">tmp</span><span class="op" id="6328259">[</span><span class="op" id="6328260">:</span><span class="num" id="6328261">8</span><span class="op" id="6328262">]</span><span class="op" id="6328263">)</span><span class="op" id="6328264">;</span>&nbsp;<span class="ident" id="6328266">err</span>&nbsp;<span class="op" id="6328270">!=</span>&nbsp;<span class="builtintype" id="6328273">nil</span>&nbsp;<span class="op" id="6328277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328282">return</span>&nbsp;<span class="num" id="6328289">0</span><span class="op" id="6328290">,</span>&nbsp;<span class="ident" id="6328292">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328302">d</span><span class="op" id="6328303">.</span><span class="ident" id="6328304">idatLength</span>&nbsp;<span class="op" id="6328315">=</span>&nbsp;<span class="ident" id="6328317">binary</span><span class="op" id="6328323">.</span><span class="ident" id="6328324">BigEndian</span><span class="op" id="6328333">.</span><span class="ident" id="6328334">Uint32</span><span class="op" id="6328340">(</span><span class="ident" id="6328341">d</span><span class="op" id="6328342">.</span><span class="ident" id="6328343">tmp</span><span class="op" id="6328346">[</span><span class="op" id="6328347">:</span><span class="num" id="6328348">4</span><span class="op" id="6328349">]</span><span class="op" id="6328350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328354">if</span>&nbsp;<span class="builtintype" id="6328357">string</span><span class="op" id="6328363">(</span><span class="ident" id="6328364">d</span><span class="op" id="6328365">.</span><span class="ident" id="6328366">tmp</span><span class="op" id="6328369">[</span><span class="num" id="6328370">4</span><span class="op" id="6328371">:</span><span class="num" id="6328372">8</span><span class="op" id="6328373">]</span><span class="op" id="6328374">)</span>&nbsp;<span class="op" id="6328376">!=</span>&nbsp;<span class="string" id="6328379">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="6328386">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328391">return</span>&nbsp;<span class="num" id="6328398">0</span><span class="op" id="6328399">,</span>&nbsp;<span class="ident" id="6328401">FormatError</span><span class="op" id="6328412">(</span><span class="string" id="6328413">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6328436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328444">d</span><span class="op" id="6328445">.</span><span class="ident" id="6328446">crc</span><span class="op" id="6328449">.</span><span class="ident" id="6328450">Reset</span><span class="op" id="6328455">(</span><span class="op" id="6328456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328460">d</span><span class="op" id="6328461">.</span><span class="ident" id="6328462">crc</span><span class="op" id="6328465">.</span><span class="ident" id="6328466">Write</span><span class="op" id="6328471">(</span><span class="ident" id="6328472">d</span><span class="op" id="6328473">.</span><span class="ident" id="6328474">tmp</span><span class="op" id="6328477">[</span><span class="num" id="6328478">4</span><span class="op" id="6328479">:</span><span class="num" id="6328480">8</span><span class="op" id="6328481">]</span><span class="op" id="6328482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328485">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328488">if</span>&nbsp;<span class="builtintype" id="6328491">int</span><span class="op" id="6328494">(</span><span class="ident" id="6328495">d</span><span class="op" id="6328496">.</span><span class="ident" id="6328497">idatLength</span><span class="op" id="6328507">)</span>&nbsp;<span class="op" id="6328509">&lt;</span>&nbsp;<span class="num" id="6328511">0</span>&nbsp;<span class="op" id="6328513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328517">return</span>&nbsp;<span class="num" id="6328524">0</span><span class="op" id="6328525">,</span>&nbsp;<span class="ident" id="6328527">UnsupportedError</span><span class="op" id="6328543">(</span><span class="string" id="6328544">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="6328572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328578">n</span><span class="op" id="6328579">,</span>&nbsp;<span class="ident" id="6328581">err</span>&nbsp;<span class="op" id="6328585">:=</span>&nbsp;<span class="ident" id="6328588">d</span><span class="op" id="6328589">.</span><span class="ident" id="6328590">r</span><span class="op" id="6328591">.</span><span class="ident" id="6328592">Read</span><span class="op" id="6328596">(</span><span class="ident" id="6328597">p</span><span class="op" id="6328598">[</span><span class="op" id="6328599">:</span><span class="ident" id="6328600">min</span><span class="op" id="6328603">(</span><span class="builtinfunc" id="6328604">len</span><span class="op" id="6328607">(</span><span class="ident" id="6328608">p</span><span class="op" id="6328609">)</span><span class="op" id="6328610">,</span>&nbsp;<span class="builtintype" id="6328612">int</span><span class="op" id="6328615">(</span><span class="ident" id="6328616">d</span><span class="op" id="6328617">.</span><span class="ident" id="6328618">idatLength</span><span class="op" id="6328628">)</span><span class="op" id="6328629">)</span><span class="op" id="6328630">]</span><span class="op" id="6328631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328634">d</span><span class="op" id="6328635">.</span><span class="ident" id="6328636">crc</span><span class="op" id="6328639">.</span><span class="ident" id="6328640">Write</span><span class="op" id="6328645">(</span><span class="ident" id="6328646">p</span><span class="op" id="6328647">[</span><span class="op" id="6328648">:</span><span class="ident" id="6328649">n</span><span class="op" id="6328650">]</span><span class="op" id="6328651">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328654">d</span><span class="op" id="6328655">.</span><span class="ident" id="6328656">idatLength</span>&nbsp;<span class="op" id="6328667">-=</span>&nbsp;<span class="builtintype" id="6328670">uint32</span><span class="op" id="6328676">(</span><span class="ident" id="6328677">n</span><span class="op" id="6328678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328681">return</span>&nbsp;<span class="ident" id="6328688">n</span><span class="op" id="6328689">,</span>&nbsp;<span class="ident" id="6328691">err</span><br>
<span class="lineno"></span><span class="op" id="6328695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6328698">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="6328745">func</span>&nbsp;<span class="op" id="6328750">(</span><span class="ident" id="6328751">d</span>&nbsp;<span class="op" id="6328753">*</span><span class="ident" id="6328754">decoder</span><span class="op" id="6328761">)</span>&nbsp;<span class="ident" id="6328763">decode</span><span class="op" id="6328769">(</span><span class="op" id="6328770">)</span>&nbsp;<span class="op" id="6328772">(</span><span class="ident" id="6328773">image</span><span class="op" id="6328778">.</span><span class="ident" id="6328779">Image</span><span class="op" id="6328784">,</span>&nbsp;<span class="builtintype" id="6328786">error</span><span class="op" id="6328791">)</span>&nbsp;<span class="op" id="6328793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328796">r</span><span class="op" id="6328797">,</span>&nbsp;<span class="ident" id="6328799">err</span>&nbsp;<span class="op" id="6328803">:=</span>&nbsp;<span class="ident" id="6328806">zlib</span><span class="op" id="6328810">.</span><span class="ident" id="6328811">NewReader</span><span class="op" id="6328820">(</span><span class="ident" id="6328821">d</span><span class="op" id="6328822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328825">if</span>&nbsp;<span class="ident" id="6328828">err</span>&nbsp;<span class="op" id="6328832">!=</span>&nbsp;<span class="builtintype" id="6328835">nil</span>&nbsp;<span class="op" id="6328839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328843">return</span>&nbsp;<span class="builtintype" id="6328850">nil</span><span class="op" id="6328853">,</span>&nbsp;<span class="ident" id="6328855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328860">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328863">defer</span>&nbsp;<span class="ident" id="6328869">r</span><span class="op" id="6328870">.</span><span class="ident" id="6328871">Close</span><span class="op" id="6328876">(</span><span class="op" id="6328877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328880">var</span>&nbsp;<span class="ident" id="6328884">img</span>&nbsp;<span class="ident" id="6328888">image</span><span class="op" id="6328893">.</span><span class="ident" id="6328894">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6328901">if</span>&nbsp;<span class="ident" id="6328904">d</span><span class="op" id="6328905">.</span><span class="ident" id="6328906">interlace</span>&nbsp;<span class="op" id="6328916">==</span>&nbsp;<span class="ident" id="6328919">itNone</span>&nbsp;<span class="op" id="6328926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328930">img</span><span class="op" id="6328933">,</span>&nbsp;<span class="ident" id="6328935">err</span>&nbsp;<span class="op" id="6328939">=</span>&nbsp;<span class="ident" id="6328941">d</span><span class="op" id="6328942">.</span><span class="ident" id="6328943">readImagePass</span><span class="op" id="6328956">(</span><span class="ident" id="6328957">r</span><span class="op" id="6328958">,</span>&nbsp;<span class="num" id="6328960">0</span><span class="op" id="6328961">,</span>&nbsp;<span class="builtintype" id="6328963">false</span><span class="op" id="6328968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6328971">}</span>&nbsp;<span class="keyword" id="6328973">else</span>&nbsp;<span class="keyword" id="6328978">if</span>&nbsp;<span class="ident" id="6328981">d</span><span class="op" id="6328982">.</span><span class="ident" id="6328983">interlace</span>&nbsp;<span class="op" id="6328993">==</span>&nbsp;<span class="ident" id="6328996">itAdam7</span>&nbsp;<span class="op" id="6329004">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6329008">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329054">img</span><span class="op" id="6329057">,</span>&nbsp;<span class="ident" id="6329059">err</span>&nbsp;<span class="op" id="6329063">=</span>&nbsp;<span class="ident" id="6329065">d</span><span class="op" id="6329066">.</span><span class="ident" id="6329067">readImagePass</span><span class="op" id="6329080">(</span><span class="builtintype" id="6329081">nil</span><span class="op" id="6329084">,</span>&nbsp;<span class="num" id="6329086">0</span><span class="op" id="6329087">,</span>&nbsp;<span class="builtintype" id="6329089">true</span><span class="op" id="6329093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329097">for</span>&nbsp;<span class="ident" id="6329101">pass</span>&nbsp;<span class="op" id="6329106">:=</span>&nbsp;<span class="num" id="6329109">0</span><span class="op" id="6329110">;</span>&nbsp;<span class="ident" id="6329112">pass</span>&nbsp;<span class="op" id="6329117">&lt;</span>&nbsp;<span class="num" id="6329119">7</span><span class="op" id="6329120">;</span>&nbsp;<span class="ident" id="6329122">pass</span><span class="op" id="6329126">++</span>&nbsp;<span class="op" id="6329129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329134">imagePass</span><span class="op" id="6329143">,</span>&nbsp;<span class="ident" id="6329145">err</span>&nbsp;<span class="op" id="6329149">:=</span>&nbsp;<span class="ident" id="6329152">d</span><span class="op" id="6329153">.</span><span class="ident" id="6329154">readImagePass</span><span class="op" id="6329167">(</span><span class="ident" id="6329168">r</span><span class="op" id="6329169">,</span>&nbsp;<span class="ident" id="6329171">pass</span><span class="op" id="6329175">,</span>&nbsp;<span class="builtintype" id="6329177">false</span><span class="op" id="6329182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329187">if</span>&nbsp;<span class="ident" id="6329190">err</span>&nbsp;<span class="op" id="6329194">!=</span>&nbsp;<span class="builtintype" id="6329197">nil</span>&nbsp;<span class="op" id="6329201">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329207">return</span>&nbsp;<span class="builtintype" id="6329214">nil</span><span class="op" id="6329217">,</span>&nbsp;<span class="ident" id="6329219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329231">d</span><span class="op" id="6329232">.</span><span class="ident" id="6329233">mergePassInto</span><span class="op" id="6329246">(</span><span class="ident" id="6329247">img</span><span class="op" id="6329250">,</span>&nbsp;<span class="ident" id="6329252">imagePass</span><span class="op" id="6329261">,</span>&nbsp;<span class="ident" id="6329263">pass</span><span class="op" id="6329267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329274">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6329278">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329326">n</span>&nbsp;<span class="op" id="6329328">:=</span>&nbsp;<span class="num" id="6329331">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329334">for</span>&nbsp;<span class="ident" id="6329338">i</span>&nbsp;<span class="op" id="6329340">:=</span>&nbsp;<span class="num" id="6329343">0</span><span class="op" id="6329344">;</span>&nbsp;<span class="ident" id="6329346">n</span>&nbsp;<span class="op" id="6329348">==</span>&nbsp;<span class="num" id="6329351">0</span>&nbsp;<span class="op" id="6329353">&amp;&amp;</span>&nbsp;<span class="ident" id="6329356">err</span>&nbsp;<span class="op" id="6329360">==</span>&nbsp;<span class="builtintype" id="6329363">nil</span><span class="op" id="6329366">;</span>&nbsp;<span class="ident" id="6329368">i</span><span class="op" id="6329369">++</span>&nbsp;<span class="op" id="6329372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329376">if</span>&nbsp;<span class="ident" id="6329379">i</span>&nbsp;<span class="op" id="6329381">==</span>&nbsp;<span class="num" id="6329384">100</span>&nbsp;<span class="op" id="6329388">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329393">return</span>&nbsp;<span class="builtintype" id="6329400">nil</span><span class="op" id="6329403">,</span>&nbsp;<span class="ident" id="6329405">io</span><span class="op" id="6329407">.</span><span class="ident" id="6329408">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329428">n</span><span class="op" id="6329429">,</span>&nbsp;<span class="ident" id="6329431">err</span>&nbsp;<span class="op" id="6329435">=</span>&nbsp;<span class="ident" id="6329437">r</span><span class="op" id="6329438">.</span><span class="ident" id="6329439">Read</span><span class="op" id="6329443">(</span><span class="ident" id="6329444">d</span><span class="op" id="6329445">.</span><span class="ident" id="6329446">tmp</span><span class="op" id="6329449">[</span><span class="op" id="6329450">:</span><span class="num" id="6329451">1</span><span class="op" id="6329452">]</span><span class="op" id="6329453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329459">if</span>&nbsp;<span class="ident" id="6329462">err</span>&nbsp;<span class="op" id="6329466">!=</span>&nbsp;<span class="builtintype" id="6329469">nil</span>&nbsp;<span class="op" id="6329473">&amp;&amp;</span>&nbsp;<span class="ident" id="6329476">err</span>&nbsp;<span class="op" id="6329480">!=</span>&nbsp;<span class="ident" id="6329483">io</span><span class="op" id="6329485">.</span><span class="ident" id="6329486">EOF</span>&nbsp;<span class="op" id="6329490">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329494">return</span>&nbsp;<span class="builtintype" id="6329501">nil</span><span class="op" id="6329504">,</span>&nbsp;<span class="ident" id="6329506">FormatError</span><span class="op" id="6329517">(</span><span class="ident" id="6329518">err</span><span class="op" id="6329521">.</span><span class="ident" id="6329522">Error</span><span class="op" id="6329527">(</span><span class="op" id="6329528">)</span><span class="op" id="6329529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329535">if</span>&nbsp;<span class="ident" id="6329538">n</span>&nbsp;<span class="op" id="6329540">!=</span>&nbsp;<span class="num" id="6329543">0</span>&nbsp;<span class="op" id="6329545">||</span>&nbsp;<span class="ident" id="6329548">d</span><span class="op" id="6329549">.</span><span class="ident" id="6329550">idatLength</span>&nbsp;<span class="op" id="6329561">!=</span>&nbsp;<span class="num" id="6329564">0</span>&nbsp;<span class="op" id="6329566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329570">return</span>&nbsp;<span class="builtintype" id="6329577">nil</span><span class="op" id="6329580">,</span>&nbsp;<span class="ident" id="6329582">FormatError</span><span class="op" id="6329593">(</span><span class="string" id="6329594">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="6329615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329618">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329622">return</span>&nbsp;<span class="ident" id="6329629">img</span><span class="op" id="6329632">,</span>&nbsp;<span class="builtintype" id="6329634">nil</span><br>
<span class="lineno"></span><span class="op" id="6329638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6329641">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="6329721">func</span>&nbsp;<span class="op" id="6329726">(</span><span class="ident" id="6329727">d</span>&nbsp;<span class="op" id="6329729">*</span><span class="ident" id="6329730">decoder</span><span class="op" id="6329737">)</span>&nbsp;<span class="ident" id="6329739">readImagePass</span><span class="op" id="6329752">(</span><span class="ident" id="6329753">r</span>&nbsp;<span class="ident" id="6329755">io</span><span class="op" id="6329757">.</span><span class="ident" id="6329758">Reader</span><span class="op" id="6329764">,</span>&nbsp;<span class="ident" id="6329766">pass</span>&nbsp;<span class="builtintype" id="6329771">int</span><span class="op" id="6329774">,</span>&nbsp;<span class="ident" id="6329776">allocateOnly</span>&nbsp;<span class="builtintype" id="6329789">bool</span><span class="op" id="6329793">)</span>&nbsp;<span class="op" id="6329795">(</span><span class="ident" id="6329796">image</span><span class="op" id="6329801">.</span><span class="ident" id="6329802">Image</span><span class="op" id="6329807">,</span>&nbsp;<span class="builtintype" id="6329809">error</span><span class="op" id="6329814">)</span>&nbsp;<span class="op" id="6329816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329819">var</span>&nbsp;<span class="ident" id="6329823">bitsPerPixel</span>&nbsp;<span class="builtintype" id="6329836">int</span>&nbsp;<span class="op" id="6329840">=</span>&nbsp;<span class="num" id="6329842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329845">pixOffset</span>&nbsp;<span class="op" id="6329855">:=</span>&nbsp;<span class="num" id="6329858">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6329861">var</span>&nbsp;<span class="op" id="6329865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329869">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329878">*</span><span class="ident" id="6329879">image</span><span class="op" id="6329884">.</span><span class="ident" id="6329885">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329892">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329901">*</span><span class="ident" id="6329902">image</span><span class="op" id="6329907">.</span><span class="ident" id="6329908">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329915">paletted</span>&nbsp;<span class="op" id="6329924">*</span><span class="ident" id="6329925">image</span><span class="op" id="6329930">.</span><span class="ident" id="6329931">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329942">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6329951">*</span><span class="ident" id="6329952">image</span><span class="op" id="6329957">.</span><span class="ident" id="6329958">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329966">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6329975">*</span><span class="ident" id="6329976">image</span><span class="op" id="6329981">.</span><span class="ident" id="6329982">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6329991">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6330000">*</span><span class="ident" id="6330001">image</span><span class="op" id="6330006">.</span><span class="ident" id="6330007">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330016">nrgba64</span>&nbsp;&nbsp;<span class="op" id="6330025">*</span><span class="ident" id="6330026">image</span><span class="op" id="6330031">.</span><span class="ident" id="6330032">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330042">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330051">image</span><span class="op" id="6330056">.</span><span class="ident" id="6330057">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6330064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330067">width</span><span class="op" id="6330072">,</span>&nbsp;<span class="ident" id="6330074">height</span>&nbsp;<span class="op" id="6330081">:=</span>&nbsp;<span class="ident" id="6330084">d</span><span class="op" id="6330085">.</span><span class="ident" id="6330086">width</span><span class="op" id="6330091">,</span>&nbsp;<span class="ident" id="6330093">d</span><span class="op" id="6330094">.</span><span class="ident" id="6330095">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330103">if</span>&nbsp;<span class="ident" id="6330106">d</span><span class="op" id="6330107">.</span><span class="ident" id="6330108">interlace</span>&nbsp;<span class="op" id="6330118">==</span>&nbsp;<span class="ident" id="6330121">itAdam7</span>&nbsp;<span class="op" id="6330129">&amp;&amp;</span>&nbsp;<span class="op" id="6330132">!</span><span class="ident" id="6330133">allocateOnly</span>&nbsp;<span class="op" id="6330146">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330150">p</span>&nbsp;<span class="op" id="6330152">:=</span>&nbsp;<span class="ident" id="6330155">interlacing</span><span class="op" id="6330166">[</span><span class="ident" id="6330167">pass</span><span class="op" id="6330171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6330175">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330253">width</span>&nbsp;<span class="op" id="6330259">=</span>&nbsp;<span class="op" id="6330261">(</span><span class="ident" id="6330262">width</span>&nbsp;<span class="op" id="6330268">-</span>&nbsp;<span class="ident" id="6330270">p</span><span class="op" id="6330271">.</span><span class="ident" id="6330272">xOffset</span>&nbsp;<span class="op" id="6330280">+</span>&nbsp;<span class="ident" id="6330282">p</span><span class="op" id="6330283">.</span><span class="ident" id="6330284">xFactor</span>&nbsp;<span class="op" id="6330292">-</span>&nbsp;<span class="num" id="6330294">1</span><span class="op" id="6330295">)</span>&nbsp;<span class="op" id="6330297">/</span>&nbsp;<span class="ident" id="6330299">p</span><span class="op" id="6330300">.</span><span class="ident" id="6330301">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330311">height</span>&nbsp;<span class="op" id="6330318">=</span>&nbsp;<span class="op" id="6330320">(</span><span class="ident" id="6330321">height</span>&nbsp;<span class="op" id="6330328">-</span>&nbsp;<span class="ident" id="6330330">p</span><span class="op" id="6330331">.</span><span class="ident" id="6330332">yOffset</span>&nbsp;<span class="op" id="6330340">+</span>&nbsp;<span class="ident" id="6330342">p</span><span class="op" id="6330343">.</span><span class="ident" id="6330344">yFactor</span>&nbsp;<span class="op" id="6330352">-</span>&nbsp;<span class="num" id="6330354">1</span><span class="op" id="6330355">)</span>&nbsp;<span class="op" id="6330357">/</span>&nbsp;<span class="ident" id="6330359">p</span><span class="op" id="6330360">.</span><span class="ident" id="6330361">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6330370">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330373">switch</span>&nbsp;<span class="ident" id="6330380">d</span><span class="op" id="6330381">.</span><span class="ident" id="6330382">cb</span>&nbsp;<span class="op" id="6330385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330388">case</span>&nbsp;<span class="ident" id="6330393">cbG1</span><span class="op" id="6330397">,</span>&nbsp;<span class="ident" id="6330399">cbG2</span><span class="op" id="6330403">,</span>&nbsp;<span class="ident" id="6330405">cbG4</span><span class="op" id="6330409">,</span>&nbsp;<span class="ident" id="6330411">cbG8</span><span class="op" id="6330415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330419">bitsPerPixel</span>&nbsp;<span class="op" id="6330432">=</span>&nbsp;<span class="ident" id="6330434">d</span><span class="op" id="6330435">.</span><span class="ident" id="6330436">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330444">gray</span>&nbsp;<span class="op" id="6330449">=</span>&nbsp;<span class="ident" id="6330451">image</span><span class="op" id="6330456">.</span><span class="ident" id="6330457">NewGray</span><span class="op" id="6330464">(</span><span class="ident" id="6330465">image</span><span class="op" id="6330470">.</span><span class="ident" id="6330471">Rect</span><span class="op" id="6330475">(</span><span class="num" id="6330476">0</span><span class="op" id="6330477">,</span>&nbsp;<span class="num" id="6330479">0</span><span class="op" id="6330480">,</span>&nbsp;<span class="ident" id="6330482">width</span><span class="op" id="6330487">,</span>&nbsp;<span class="ident" id="6330489">height</span><span class="op" id="6330495">)</span><span class="op" id="6330496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330500">img</span>&nbsp;<span class="op" id="6330504">=</span>&nbsp;<span class="ident" id="6330506">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330512">case</span>&nbsp;<span class="ident" id="6330517">cbGA8</span><span class="op" id="6330522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330526">bitsPerPixel</span>&nbsp;<span class="op" id="6330539">=</span>&nbsp;<span class="num" id="6330541">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330546">nrgba</span>&nbsp;<span class="op" id="6330552">=</span>&nbsp;<span class="ident" id="6330554">image</span><span class="op" id="6330559">.</span><span class="ident" id="6330560">NewNRGBA</span><span class="op" id="6330568">(</span><span class="ident" id="6330569">image</span><span class="op" id="6330574">.</span><span class="ident" id="6330575">Rect</span><span class="op" id="6330579">(</span><span class="num" id="6330580">0</span><span class="op" id="6330581">,</span>&nbsp;<span class="num" id="6330583">0</span><span class="op" id="6330584">,</span>&nbsp;<span class="ident" id="6330586">width</span><span class="op" id="6330591">,</span>&nbsp;<span class="ident" id="6330593">height</span><span class="op" id="6330599">)</span><span class="op" id="6330600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330604">img</span>&nbsp;<span class="op" id="6330608">=</span>&nbsp;<span class="ident" id="6330610">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330617">case</span>&nbsp;<span class="ident" id="6330622">cbTC8</span><span class="op" id="6330627">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330631">bitsPerPixel</span>&nbsp;<span class="op" id="6330644">=</span>&nbsp;<span class="num" id="6330646">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330651">rgba</span>&nbsp;<span class="op" id="6330656">=</span>&nbsp;<span class="ident" id="6330658">image</span><span class="op" id="6330663">.</span><span class="ident" id="6330664">NewRGBA</span><span class="op" id="6330671">(</span><span class="ident" id="6330672">image</span><span class="op" id="6330677">.</span><span class="ident" id="6330678">Rect</span><span class="op" id="6330682">(</span><span class="num" id="6330683">0</span><span class="op" id="6330684">,</span>&nbsp;<span class="num" id="6330686">0</span><span class="op" id="6330687">,</span>&nbsp;<span class="ident" id="6330689">width</span><span class="op" id="6330694">,</span>&nbsp;<span class="ident" id="6330696">height</span><span class="op" id="6330702">)</span><span class="op" id="6330703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330707">img</span>&nbsp;<span class="op" id="6330711">=</span>&nbsp;<span class="ident" id="6330713">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330719">case</span>&nbsp;<span class="ident" id="6330724">cbP1</span><span class="op" id="6330728">,</span>&nbsp;<span class="ident" id="6330730">cbP2</span><span class="op" id="6330734">,</span>&nbsp;<span class="ident" id="6330736">cbP4</span><span class="op" id="6330740">,</span>&nbsp;<span class="ident" id="6330742">cbP8</span><span class="op" id="6330746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330750">bitsPerPixel</span>&nbsp;<span class="op" id="6330763">=</span>&nbsp;<span class="ident" id="6330765">d</span><span class="op" id="6330766">.</span><span class="ident" id="6330767">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330775">paletted</span>&nbsp;<span class="op" id="6330784">=</span>&nbsp;<span class="ident" id="6330786">image</span><span class="op" id="6330791">.</span><span class="ident" id="6330792">NewPaletted</span><span class="op" id="6330803">(</span><span class="ident" id="6330804">image</span><span class="op" id="6330809">.</span><span class="ident" id="6330810">Rect</span><span class="op" id="6330814">(</span><span class="num" id="6330815">0</span><span class="op" id="6330816">,</span>&nbsp;<span class="num" id="6330818">0</span><span class="op" id="6330819">,</span>&nbsp;<span class="ident" id="6330821">width</span><span class="op" id="6330826">,</span>&nbsp;<span class="ident" id="6330828">height</span><span class="op" id="6330834">)</span><span class="op" id="6330835">,</span>&nbsp;<span class="ident" id="6330837">d</span><span class="op" id="6330838">.</span><span class="ident" id="6330839">palette</span><span class="op" id="6330846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330850">img</span>&nbsp;<span class="op" id="6330854">=</span>&nbsp;<span class="ident" id="6330856">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330866">case</span>&nbsp;<span class="ident" id="6330871">cbTCA8</span><span class="op" id="6330877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330881">bitsPerPixel</span>&nbsp;<span class="op" id="6330894">=</span>&nbsp;<span class="num" id="6330896">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330901">nrgba</span>&nbsp;<span class="op" id="6330907">=</span>&nbsp;<span class="ident" id="6330909">image</span><span class="op" id="6330914">.</span><span class="ident" id="6330915">NewNRGBA</span><span class="op" id="6330923">(</span><span class="ident" id="6330924">image</span><span class="op" id="6330929">.</span><span class="ident" id="6330930">Rect</span><span class="op" id="6330934">(</span><span class="num" id="6330935">0</span><span class="op" id="6330936">,</span>&nbsp;<span class="num" id="6330938">0</span><span class="op" id="6330939">,</span>&nbsp;<span class="ident" id="6330941">width</span><span class="op" id="6330946">,</span>&nbsp;<span class="ident" id="6330948">height</span><span class="op" id="6330954">)</span><span class="op" id="6330955">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330959">img</span>&nbsp;<span class="op" id="6330963">=</span>&nbsp;<span class="ident" id="6330965">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6330972">case</span>&nbsp;<span class="ident" id="6330977">cbG16</span><span class="op" id="6330982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330986">bitsPerPixel</span>&nbsp;<span class="op" id="6330999">=</span>&nbsp;<span class="num" id="6331001">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331006">gray16</span>&nbsp;<span class="op" id="6331013">=</span>&nbsp;<span class="ident" id="6331015">image</span><span class="op" id="6331020">.</span><span class="ident" id="6331021">NewGray16</span><span class="op" id="6331030">(</span><span class="ident" id="6331031">image</span><span class="op" id="6331036">.</span><span class="ident" id="6331037">Rect</span><span class="op" id="6331041">(</span><span class="num" id="6331042">0</span><span class="op" id="6331043">,</span>&nbsp;<span class="num" id="6331045">0</span><span class="op" id="6331046">,</span>&nbsp;<span class="ident" id="6331048">width</span><span class="op" id="6331053">,</span>&nbsp;<span class="ident" id="6331055">height</span><span class="op" id="6331061">)</span><span class="op" id="6331062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331066">img</span>&nbsp;<span class="op" id="6331070">=</span>&nbsp;<span class="ident" id="6331072">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331080">case</span>&nbsp;<span class="ident" id="6331085">cbGA16</span><span class="op" id="6331091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331095">bitsPerPixel</span>&nbsp;<span class="op" id="6331108">=</span>&nbsp;<span class="num" id="6331110">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331115">nrgba64</span>&nbsp;<span class="op" id="6331123">=</span>&nbsp;<span class="ident" id="6331125">image</span><span class="op" id="6331130">.</span><span class="ident" id="6331131">NewNRGBA64</span><span class="op" id="6331141">(</span><span class="ident" id="6331142">image</span><span class="op" id="6331147">.</span><span class="ident" id="6331148">Rect</span><span class="op" id="6331152">(</span><span class="num" id="6331153">0</span><span class="op" id="6331154">,</span>&nbsp;<span class="num" id="6331156">0</span><span class="op" id="6331157">,</span>&nbsp;<span class="ident" id="6331159">width</span><span class="op" id="6331164">,</span>&nbsp;<span class="ident" id="6331166">height</span><span class="op" id="6331172">)</span><span class="op" id="6331173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331177">img</span>&nbsp;<span class="op" id="6331181">=</span>&nbsp;<span class="ident" id="6331183">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331192">case</span>&nbsp;<span class="ident" id="6331197">cbTC16</span><span class="op" id="6331203">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331207">bitsPerPixel</span>&nbsp;<span class="op" id="6331220">=</span>&nbsp;<span class="num" id="6331222">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331227">rgba64</span>&nbsp;<span class="op" id="6331234">=</span>&nbsp;<span class="ident" id="6331236">image</span><span class="op" id="6331241">.</span><span class="ident" id="6331242">NewRGBA64</span><span class="op" id="6331251">(</span><span class="ident" id="6331252">image</span><span class="op" id="6331257">.</span><span class="ident" id="6331258">Rect</span><span class="op" id="6331262">(</span><span class="num" id="6331263">0</span><span class="op" id="6331264">,</span>&nbsp;<span class="num" id="6331266">0</span><span class="op" id="6331267">,</span>&nbsp;<span class="ident" id="6331269">width</span><span class="op" id="6331274">,</span>&nbsp;<span class="ident" id="6331276">height</span><span class="op" id="6331282">)</span><span class="op" id="6331283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331287">img</span>&nbsp;<span class="op" id="6331291">=</span>&nbsp;<span class="ident" id="6331293">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331301">case</span>&nbsp;<span class="ident" id="6331306">cbTCA16</span><span class="op" id="6331313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331317">bitsPerPixel</span>&nbsp;<span class="op" id="6331330">=</span>&nbsp;<span class="num" id="6331332">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331337">nrgba64</span>&nbsp;<span class="op" id="6331345">=</span>&nbsp;<span class="ident" id="6331347">image</span><span class="op" id="6331352">.</span><span class="ident" id="6331353">NewNRGBA64</span><span class="op" id="6331363">(</span><span class="ident" id="6331364">image</span><span class="op" id="6331369">.</span><span class="ident" id="6331370">Rect</span><span class="op" id="6331374">(</span><span class="num" id="6331375">0</span><span class="op" id="6331376">,</span>&nbsp;<span class="num" id="6331378">0</span><span class="op" id="6331379">,</span>&nbsp;<span class="ident" id="6331381">width</span><span class="op" id="6331386">,</span>&nbsp;<span class="ident" id="6331388">height</span><span class="op" id="6331394">)</span><span class="op" id="6331395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331399">img</span>&nbsp;<span class="op" id="6331403">=</span>&nbsp;<span class="ident" id="6331405">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6331414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331417">if</span>&nbsp;<span class="ident" id="6331420">allocateOnly</span>&nbsp;<span class="op" id="6331433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331437">return</span>&nbsp;<span class="ident" id="6331444">img</span><span class="op" id="6331447">,</span>&nbsp;<span class="builtintype" id="6331449">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6331454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331457">bytesPerPixel</span>&nbsp;<span class="op" id="6331471">:=</span>&nbsp;<span class="op" id="6331474">(</span><span class="ident" id="6331475">bitsPerPixel</span>&nbsp;<span class="op" id="6331488">+</span>&nbsp;<span class="num" id="6331490">7</span><span class="op" id="6331491">)</span>&nbsp;<span class="op" id="6331493">/</span>&nbsp;<span class="num" id="6331495">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6331499">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331561">rowSize</span>&nbsp;<span class="op" id="6331569">:=</span>&nbsp;<span class="num" id="6331572">1</span>&nbsp;<span class="op" id="6331574">+</span>&nbsp;<span class="op" id="6331576">(</span><span class="ident" id="6331577">bitsPerPixel</span><span class="op" id="6331589">*</span><span class="ident" id="6331590">width</span><span class="op" id="6331595">+</span><span class="num" id="6331596">7</span><span class="op" id="6331597">)</span><span class="op" id="6331598">/</span><span class="num" id="6331599">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6331602">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331664">cr</span>&nbsp;<span class="op" id="6331667">:=</span>&nbsp;<span class="builtinfunc" id="6331670">make</span><span class="op" id="6331674">(</span><span class="op" id="6331675">[</span><span class="op" id="6331676">]</span><span class="builtintype" id="6331677">uint8</span><span class="op" id="6331682">,</span>&nbsp;<span class="ident" id="6331684">rowSize</span><span class="op" id="6331691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331694">pr</span>&nbsp;<span class="op" id="6331697">:=</span>&nbsp;<span class="builtinfunc" id="6331700">make</span><span class="op" id="6331704">(</span><span class="op" id="6331705">[</span><span class="op" id="6331706">]</span><span class="builtintype" id="6331707">uint8</span><span class="op" id="6331712">,</span>&nbsp;<span class="ident" id="6331714">rowSize</span><span class="op" id="6331721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331725">for</span>&nbsp;<span class="ident" id="6331729">y</span>&nbsp;<span class="op" id="6331731">:=</span>&nbsp;<span class="num" id="6331734">0</span><span class="op" id="6331735">;</span>&nbsp;<span class="ident" id="6331737">y</span>&nbsp;<span class="op" id="6331739">&lt;</span>&nbsp;<span class="ident" id="6331741">height</span><span class="op" id="6331747">;</span>&nbsp;<span class="ident" id="6331749">y</span><span class="op" id="6331750">++</span>&nbsp;<span class="op" id="6331753">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6331757">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331791">_</span><span class="op" id="6331792">,</span>&nbsp;<span class="ident" id="6331794">err</span>&nbsp;<span class="op" id="6331798">:=</span>&nbsp;<span class="ident" id="6331801">io</span><span class="op" id="6331803">.</span><span class="ident" id="6331804">ReadFull</span><span class="op" id="6331812">(</span><span class="ident" id="6331813">r</span><span class="op" id="6331814">,</span>&nbsp;<span class="ident" id="6331816">cr</span><span class="op" id="6331818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331822">if</span>&nbsp;<span class="ident" id="6331825">err</span>&nbsp;<span class="op" id="6331829">!=</span>&nbsp;<span class="builtintype" id="6331832">nil</span>&nbsp;<span class="op" id="6331836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331841">return</span>&nbsp;<span class="builtintype" id="6331848">nil</span><span class="op" id="6331851">,</span>&nbsp;<span class="ident" id="6331853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6331859">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6331864">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331887">cdat</span>&nbsp;<span class="op" id="6331892">:=</span>&nbsp;<span class="ident" id="6331895">cr</span><span class="op" id="6331897">[</span><span class="num" id="6331898">1</span><span class="op" id="6331899">:</span><span class="op" id="6331900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6331904">pdat</span>&nbsp;<span class="op" id="6331909">:=</span>&nbsp;<span class="ident" id="6331912">pr</span><span class="op" id="6331914">[</span><span class="num" id="6331915">1</span><span class="op" id="6331916">:</span><span class="op" id="6331917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331921">switch</span>&nbsp;<span class="ident" id="6331928">cr</span><span class="op" id="6331930">[</span><span class="num" id="6331931">0</span><span class="op" id="6331932">]</span>&nbsp;<span class="op" id="6331934">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331938">case</span>&nbsp;<span class="ident" id="6331943">ftNone</span><span class="op" id="6331949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6331954">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331966">case</span>&nbsp;<span class="ident" id="6331971">ftSub</span><span class="op" id="6331976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6331981">for</span>&nbsp;<span class="ident" id="6331985">i</span>&nbsp;<span class="op" id="6331987">:=</span>&nbsp;<span class="ident" id="6331990">bytesPerPixel</span><span class="op" id="6332003">;</span>&nbsp;<span class="ident" id="6332005">i</span>&nbsp;<span class="op" id="6332007">&lt;</span>&nbsp;<span class="builtinfunc" id="6332009">len</span><span class="op" id="6332012">(</span><span class="ident" id="6332013">cdat</span><span class="op" id="6332017">)</span><span class="op" id="6332018">;</span>&nbsp;<span class="ident" id="6332020">i</span><span class="op" id="6332021">++</span>&nbsp;<span class="op" id="6332024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332030">cdat</span><span class="op" id="6332034">[</span><span class="ident" id="6332035">i</span><span class="op" id="6332036">]</span>&nbsp;<span class="op" id="6332038">+=</span>&nbsp;<span class="ident" id="6332041">cdat</span><span class="op" id="6332045">[</span><span class="ident" id="6332046">i</span><span class="op" id="6332047">-</span><span class="ident" id="6332048">bytesPerPixel</span><span class="op" id="6332061">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332070">case</span>&nbsp;<span class="ident" id="6332075">ftUp</span><span class="op" id="6332079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332084">for</span>&nbsp;<span class="ident" id="6332088">i</span><span class="op" id="6332089">,</span>&nbsp;<span class="ident" id="6332091">p</span>&nbsp;<span class="op" id="6332093">:=</span>&nbsp;<span class="keyword" id="6332096">range</span>&nbsp;<span class="ident" id="6332102">pdat</span>&nbsp;<span class="op" id="6332107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332113">cdat</span><span class="op" id="6332117">[</span><span class="ident" id="6332118">i</span><span class="op" id="6332119">]</span>&nbsp;<span class="op" id="6332121">+=</span>&nbsp;<span class="ident" id="6332124">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332129">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332133">case</span>&nbsp;<span class="ident" id="6332138">ftAverage</span><span class="op" id="6332147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332152">for</span>&nbsp;<span class="ident" id="6332156">i</span>&nbsp;<span class="op" id="6332158">:=</span>&nbsp;<span class="num" id="6332161">0</span><span class="op" id="6332162">;</span>&nbsp;<span class="ident" id="6332164">i</span>&nbsp;<span class="op" id="6332166">&lt;</span>&nbsp;<span class="ident" id="6332168">bytesPerPixel</span><span class="op" id="6332181">;</span>&nbsp;<span class="ident" id="6332183">i</span><span class="op" id="6332184">++</span>&nbsp;<span class="op" id="6332187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332193">cdat</span><span class="op" id="6332197">[</span><span class="ident" id="6332198">i</span><span class="op" id="6332199">]</span>&nbsp;<span class="op" id="6332201">+=</span>&nbsp;<span class="ident" id="6332204">pdat</span><span class="op" id="6332208">[</span><span class="ident" id="6332209">i</span><span class="op" id="6332210">]</span>&nbsp;<span class="op" id="6332212">/</span>&nbsp;<span class="num" id="6332214">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332224">for</span>&nbsp;<span class="ident" id="6332228">i</span>&nbsp;<span class="op" id="6332230">:=</span>&nbsp;<span class="ident" id="6332233">bytesPerPixel</span><span class="op" id="6332246">;</span>&nbsp;<span class="ident" id="6332248">i</span>&nbsp;<span class="op" id="6332250">&lt;</span>&nbsp;<span class="builtinfunc" id="6332252">len</span><span class="op" id="6332255">(</span><span class="ident" id="6332256">cdat</span><span class="op" id="6332260">)</span><span class="op" id="6332261">;</span>&nbsp;<span class="ident" id="6332263">i</span><span class="op" id="6332264">++</span>&nbsp;<span class="op" id="6332267">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332273">cdat</span><span class="op" id="6332277">[</span><span class="ident" id="6332278">i</span><span class="op" id="6332279">]</span>&nbsp;<span class="op" id="6332281">+=</span>&nbsp;<span class="builtintype" id="6332284">uint8</span><span class="op" id="6332289">(</span><span class="op" id="6332290">(</span><span class="builtintype" id="6332291">int</span><span class="op" id="6332294">(</span><span class="ident" id="6332295">cdat</span><span class="op" id="6332299">[</span><span class="ident" id="6332300">i</span><span class="op" id="6332301">-</span><span class="ident" id="6332302">bytesPerPixel</span><span class="op" id="6332315">]</span><span class="op" id="6332316">)</span>&nbsp;<span class="op" id="6332318">+</span>&nbsp;<span class="builtintype" id="6332320">int</span><span class="op" id="6332323">(</span><span class="ident" id="6332324">pdat</span><span class="op" id="6332328">[</span><span class="ident" id="6332329">i</span><span class="op" id="6332330">]</span><span class="op" id="6332331">)</span><span class="op" id="6332332">)</span>&nbsp;<span class="op" id="6332334">/</span>&nbsp;<span class="num" id="6332336">2</span><span class="op" id="6332337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332346">case</span>&nbsp;<span class="ident" id="6332351">ftPaeth</span><span class="op" id="6332358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332363">filterPaeth</span><span class="op" id="6332374">(</span><span class="ident" id="6332375">cdat</span><span class="op" id="6332379">,</span>&nbsp;<span class="ident" id="6332381">pdat</span><span class="op" id="6332385">,</span>&nbsp;<span class="ident" id="6332387">bytesPerPixel</span><span class="op" id="6332400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332404">default</span><span class="op" id="6332411">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332416">return</span>&nbsp;<span class="builtintype" id="6332423">nil</span><span class="op" id="6332426">,</span>&nbsp;<span class="ident" id="6332428">FormatError</span><span class="op" id="6332439">(</span><span class="string" id="6332440">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="6332457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6332466">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332501">switch</span>&nbsp;<span class="ident" id="6332508">d</span><span class="op" id="6332509">.</span><span class="ident" id="6332510">cb</span>&nbsp;<span class="op" id="6332513">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332517">case</span>&nbsp;<span class="ident" id="6332522">cbG1</span><span class="op" id="6332526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332531">for</span>&nbsp;<span class="ident" id="6332535">x</span>&nbsp;<span class="op" id="6332537">:=</span>&nbsp;<span class="num" id="6332540">0</span><span class="op" id="6332541">;</span>&nbsp;<span class="ident" id="6332543">x</span>&nbsp;<span class="op" id="6332545">&lt;</span>&nbsp;<span class="ident" id="6332547">width</span><span class="op" id="6332552">;</span>&nbsp;<span class="ident" id="6332554">x</span>&nbsp;<span class="op" id="6332556">+=</span>&nbsp;<span class="num" id="6332559">8</span>&nbsp;<span class="op" id="6332561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332567">b</span>&nbsp;<span class="op" id="6332569">:=</span>&nbsp;<span class="ident" id="6332572">cdat</span><span class="op" id="6332576">[</span><span class="ident" id="6332577">x</span><span class="op" id="6332578">/</span><span class="num" id="6332579">8</span><span class="op" id="6332580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332586">for</span>&nbsp;<span class="ident" id="6332590">x2</span>&nbsp;<span class="op" id="6332593">:=</span>&nbsp;<span class="num" id="6332596">0</span><span class="op" id="6332597">;</span>&nbsp;<span class="ident" id="6332599">x2</span>&nbsp;<span class="op" id="6332602">&lt;</span>&nbsp;<span class="num" id="6332604">8</span>&nbsp;<span class="op" id="6332606">&amp;&amp;</span>&nbsp;<span class="ident" id="6332609">x</span><span class="op" id="6332610">+</span><span class="ident" id="6332611">x2</span>&nbsp;<span class="op" id="6332614">&lt;</span>&nbsp;<span class="ident" id="6332616">width</span><span class="op" id="6332621">;</span>&nbsp;<span class="ident" id="6332623">x2</span><span class="op" id="6332625">++</span>&nbsp;<span class="op" id="6332628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332635">gray</span><span class="op" id="6332639">.</span><span class="ident" id="6332640">SetGray</span><span class="op" id="6332647">(</span><span class="ident" id="6332648">x</span><span class="op" id="6332649">+</span><span class="ident" id="6332650">x2</span><span class="op" id="6332652">,</span>&nbsp;<span class="ident" id="6332654">y</span><span class="op" id="6332655">,</span>&nbsp;<span class="ident" id="6332657">color</span><span class="op" id="6332662">.</span><span class="ident" id="6332663">Gray</span><span class="op" id="6332667">{</span><span class="op" id="6332668">(</span><span class="ident" id="6332669">b</span>&nbsp;<span class="op" id="6332671">&gt;&gt;</span>&nbsp;<span class="num" id="6332674">7</span><span class="op" id="6332675">)</span>&nbsp;<span class="op" id="6332677">*</span>&nbsp;<span class="num" id="6332679">0xff</span><span class="op" id="6332683">}</span><span class="op" id="6332684">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332691">b</span>&nbsp;<span class="op" id="6332693">&lt;&lt;=</span>&nbsp;<span class="num" id="6332697">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332712">case</span>&nbsp;<span class="ident" id="6332717">cbG2</span><span class="op" id="6332721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332726">for</span>&nbsp;<span class="ident" id="6332730">x</span>&nbsp;<span class="op" id="6332732">:=</span>&nbsp;<span class="num" id="6332735">0</span><span class="op" id="6332736">;</span>&nbsp;<span class="ident" id="6332738">x</span>&nbsp;<span class="op" id="6332740">&lt;</span>&nbsp;<span class="ident" id="6332742">width</span><span class="op" id="6332747">;</span>&nbsp;<span class="ident" id="6332749">x</span>&nbsp;<span class="op" id="6332751">+=</span>&nbsp;<span class="num" id="6332754">4</span>&nbsp;<span class="op" id="6332756">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332762">b</span>&nbsp;<span class="op" id="6332764">:=</span>&nbsp;<span class="ident" id="6332767">cdat</span><span class="op" id="6332771">[</span><span class="ident" id="6332772">x</span><span class="op" id="6332773">/</span><span class="num" id="6332774">4</span><span class="op" id="6332775">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332781">for</span>&nbsp;<span class="ident" id="6332785">x2</span>&nbsp;<span class="op" id="6332788">:=</span>&nbsp;<span class="num" id="6332791">0</span><span class="op" id="6332792">;</span>&nbsp;<span class="ident" id="6332794">x2</span>&nbsp;<span class="op" id="6332797">&lt;</span>&nbsp;<span class="num" id="6332799">4</span>&nbsp;<span class="op" id="6332801">&amp;&amp;</span>&nbsp;<span class="ident" id="6332804">x</span><span class="op" id="6332805">+</span><span class="ident" id="6332806">x2</span>&nbsp;<span class="op" id="6332809">&lt;</span>&nbsp;<span class="ident" id="6332811">width</span><span class="op" id="6332816">;</span>&nbsp;<span class="ident" id="6332818">x2</span><span class="op" id="6332820">++</span>&nbsp;<span class="op" id="6332823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332830">gray</span><span class="op" id="6332834">.</span><span class="ident" id="6332835">SetGray</span><span class="op" id="6332842">(</span><span class="ident" id="6332843">x</span><span class="op" id="6332844">+</span><span class="ident" id="6332845">x2</span><span class="op" id="6332847">,</span>&nbsp;<span class="ident" id="6332849">y</span><span class="op" id="6332850">,</span>&nbsp;<span class="ident" id="6332852">color</span><span class="op" id="6332857">.</span><span class="ident" id="6332858">Gray</span><span class="op" id="6332862">{</span><span class="op" id="6332863">(</span><span class="ident" id="6332864">b</span>&nbsp;<span class="op" id="6332866">&gt;&gt;</span>&nbsp;<span class="num" id="6332869">6</span><span class="op" id="6332870">)</span>&nbsp;<span class="op" id="6332872">*</span>&nbsp;<span class="num" id="6332874">0x55</span><span class="op" id="6332878">}</span><span class="op" id="6332879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332886">b</span>&nbsp;<span class="op" id="6332888">&lt;&lt;=</span>&nbsp;<span class="num" id="6332892">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332898">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6332903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332907">case</span>&nbsp;<span class="ident" id="6332912">cbG4</span><span class="op" id="6332916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332921">for</span>&nbsp;<span class="ident" id="6332925">x</span>&nbsp;<span class="op" id="6332927">:=</span>&nbsp;<span class="num" id="6332930">0</span><span class="op" id="6332931">;</span>&nbsp;<span class="ident" id="6332933">x</span>&nbsp;<span class="op" id="6332935">&lt;</span>&nbsp;<span class="ident" id="6332937">width</span><span class="op" id="6332942">;</span>&nbsp;<span class="ident" id="6332944">x</span>&nbsp;<span class="op" id="6332946">+=</span>&nbsp;<span class="num" id="6332949">2</span>&nbsp;<span class="op" id="6332951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6332957">b</span>&nbsp;<span class="op" id="6332959">:=</span>&nbsp;<span class="ident" id="6332962">cdat</span><span class="op" id="6332966">[</span><span class="ident" id="6332967">x</span><span class="op" id="6332968">/</span><span class="num" id="6332969">2</span><span class="op" id="6332970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6332976">for</span>&nbsp;<span class="ident" id="6332980">x2</span>&nbsp;<span class="op" id="6332983">:=</span>&nbsp;<span class="num" id="6332986">0</span><span class="op" id="6332987">;</span>&nbsp;<span class="ident" id="6332989">x2</span>&nbsp;<span class="op" id="6332992">&lt;</span>&nbsp;<span class="num" id="6332994">2</span>&nbsp;<span class="op" id="6332996">&amp;&amp;</span>&nbsp;<span class="ident" id="6332999">x</span><span class="op" id="6333000">+</span><span class="ident" id="6333001">x2</span>&nbsp;<span class="op" id="6333004">&lt;</span>&nbsp;<span class="ident" id="6333006">width</span><span class="op" id="6333011">;</span>&nbsp;<span class="ident" id="6333013">x2</span><span class="op" id="6333015">++</span>&nbsp;<span class="op" id="6333018">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333025">gray</span><span class="op" id="6333029">.</span><span class="ident" id="6333030">SetGray</span><span class="op" id="6333037">(</span><span class="ident" id="6333038">x</span><span class="op" id="6333039">+</span><span class="ident" id="6333040">x2</span><span class="op" id="6333042">,</span>&nbsp;<span class="ident" id="6333044">y</span><span class="op" id="6333045">,</span>&nbsp;<span class="ident" id="6333047">color</span><span class="op" id="6333052">.</span><span class="ident" id="6333053">Gray</span><span class="op" id="6333057">{</span><span class="op" id="6333058">(</span><span class="ident" id="6333059">b</span>&nbsp;<span class="op" id="6333061">&gt;&gt;</span>&nbsp;<span class="num" id="6333064">4</span><span class="op" id="6333065">)</span>&nbsp;<span class="op" id="6333067">*</span>&nbsp;<span class="num" id="6333069">0x11</span><span class="op" id="6333073">}</span><span class="op" id="6333074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333081">b</span>&nbsp;<span class="op" id="6333083">&lt;&lt;=</span>&nbsp;<span class="num" id="6333087">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333102">case</span>&nbsp;<span class="ident" id="6333107">cbG8</span><span class="op" id="6333111">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6333116">copy</span><span class="op" id="6333120">(</span><span class="ident" id="6333121">gray</span><span class="op" id="6333125">.</span><span class="ident" id="6333126">Pix</span><span class="op" id="6333129">[</span><span class="ident" id="6333130">pixOffset</span><span class="op" id="6333139">:</span><span class="op" id="6333140">]</span><span class="op" id="6333141">,</span>&nbsp;<span class="ident" id="6333143">cdat</span><span class="op" id="6333147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333152">pixOffset</span>&nbsp;<span class="op" id="6333162">+=</span>&nbsp;<span class="ident" id="6333165">gray</span><span class="op" id="6333169">.</span><span class="ident" id="6333170">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333179">case</span>&nbsp;<span class="ident" id="6333184">cbGA8</span><span class="op" id="6333189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333194">for</span>&nbsp;<span class="ident" id="6333198">x</span>&nbsp;<span class="op" id="6333200">:=</span>&nbsp;<span class="num" id="6333203">0</span><span class="op" id="6333204">;</span>&nbsp;<span class="ident" id="6333206">x</span>&nbsp;<span class="op" id="6333208">&lt;</span>&nbsp;<span class="ident" id="6333210">width</span><span class="op" id="6333215">;</span>&nbsp;<span class="ident" id="6333217">x</span><span class="op" id="6333218">++</span>&nbsp;<span class="op" id="6333221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333227">ycol</span>&nbsp;<span class="op" id="6333232">:=</span>&nbsp;<span class="ident" id="6333235">cdat</span><span class="op" id="6333239">[</span><span class="num" id="6333240">2</span><span class="op" id="6333241">*</span><span class="ident" id="6333242">x</span><span class="op" id="6333243">+</span><span class="num" id="6333244">0</span><span class="op" id="6333245">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333251">nrgba</span><span class="op" id="6333256">.</span><span class="ident" id="6333257">SetNRGBA</span><span class="op" id="6333265">(</span><span class="ident" id="6333266">x</span><span class="op" id="6333267">,</span>&nbsp;<span class="ident" id="6333269">y</span><span class="op" id="6333270">,</span>&nbsp;<span class="ident" id="6333272">color</span><span class="op" id="6333277">.</span><span class="ident" id="6333278">NRGBA</span><span class="op" id="6333283">{</span><span class="ident" id="6333284">ycol</span><span class="op" id="6333288">,</span>&nbsp;<span class="ident" id="6333290">ycol</span><span class="op" id="6333294">,</span>&nbsp;<span class="ident" id="6333296">ycol</span><span class="op" id="6333300">,</span>&nbsp;<span class="ident" id="6333302">cdat</span><span class="op" id="6333306">[</span><span class="num" id="6333307">2</span><span class="op" id="6333308">*</span><span class="ident" id="6333309">x</span><span class="op" id="6333310">+</span><span class="num" id="6333311">1</span><span class="op" id="6333312">]</span><span class="op" id="6333313">}</span><span class="op" id="6333314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333323">case</span>&nbsp;<span class="ident" id="6333328">cbTC8</span><span class="op" id="6333333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333338">pix</span><span class="op" id="6333341">,</span>&nbsp;<span class="ident" id="6333343">i</span><span class="op" id="6333344">,</span>&nbsp;<span class="ident" id="6333346">j</span>&nbsp;<span class="op" id="6333348">:=</span>&nbsp;<span class="ident" id="6333351">rgba</span><span class="op" id="6333355">.</span><span class="ident" id="6333356">Pix</span><span class="op" id="6333359">,</span>&nbsp;<span class="ident" id="6333361">pixOffset</span><span class="op" id="6333370">,</span>&nbsp;<span class="num" id="6333372">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333377">for</span>&nbsp;<span class="ident" id="6333381">x</span>&nbsp;<span class="op" id="6333383">:=</span>&nbsp;<span class="num" id="6333386">0</span><span class="op" id="6333387">;</span>&nbsp;<span class="ident" id="6333389">x</span>&nbsp;<span class="op" id="6333391">&lt;</span>&nbsp;<span class="ident" id="6333393">width</span><span class="op" id="6333398">;</span>&nbsp;<span class="ident" id="6333400">x</span><span class="op" id="6333401">++</span>&nbsp;<span class="op" id="6333404">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333410">pix</span><span class="op" id="6333413">[</span><span class="ident" id="6333414">i</span><span class="op" id="6333415">+</span><span class="num" id="6333416">0</span><span class="op" id="6333417">]</span>&nbsp;<span class="op" id="6333419">=</span>&nbsp;<span class="ident" id="6333421">cdat</span><span class="op" id="6333425">[</span><span class="ident" id="6333426">j</span><span class="op" id="6333427">+</span><span class="num" id="6333428">0</span><span class="op" id="6333429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333435">pix</span><span class="op" id="6333438">[</span><span class="ident" id="6333439">i</span><span class="op" id="6333440">+</span><span class="num" id="6333441">1</span><span class="op" id="6333442">]</span>&nbsp;<span class="op" id="6333444">=</span>&nbsp;<span class="ident" id="6333446">cdat</span><span class="op" id="6333450">[</span><span class="ident" id="6333451">j</span><span class="op" id="6333452">+</span><span class="num" id="6333453">1</span><span class="op" id="6333454">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333460">pix</span><span class="op" id="6333463">[</span><span class="ident" id="6333464">i</span><span class="op" id="6333465">+</span><span class="num" id="6333466">2</span><span class="op" id="6333467">]</span>&nbsp;<span class="op" id="6333469">=</span>&nbsp;<span class="ident" id="6333471">cdat</span><span class="op" id="6333475">[</span><span class="ident" id="6333476">j</span><span class="op" id="6333477">+</span><span class="num" id="6333478">2</span><span class="op" id="6333479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333485">pix</span><span class="op" id="6333488">[</span><span class="ident" id="6333489">i</span><span class="op" id="6333490">+</span><span class="num" id="6333491">3</span><span class="op" id="6333492">]</span>&nbsp;<span class="op" id="6333494">=</span>&nbsp;<span class="num" id="6333496">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333505">i</span>&nbsp;<span class="op" id="6333507">+=</span>&nbsp;<span class="num" id="6333510">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333516">j</span>&nbsp;<span class="op" id="6333518">+=</span>&nbsp;<span class="num" id="6333521">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333531">pixOffset</span>&nbsp;<span class="op" id="6333541">+=</span>&nbsp;<span class="ident" id="6333544">rgba</span><span class="op" id="6333548">.</span><span class="ident" id="6333549">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333558">case</span>&nbsp;<span class="ident" id="6333563">cbP1</span><span class="op" id="6333567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333572">for</span>&nbsp;<span class="ident" id="6333576">x</span>&nbsp;<span class="op" id="6333578">:=</span>&nbsp;<span class="num" id="6333581">0</span><span class="op" id="6333582">;</span>&nbsp;<span class="ident" id="6333584">x</span>&nbsp;<span class="op" id="6333586">&lt;</span>&nbsp;<span class="ident" id="6333588">width</span><span class="op" id="6333593">;</span>&nbsp;<span class="ident" id="6333595">x</span>&nbsp;<span class="op" id="6333597">+=</span>&nbsp;<span class="num" id="6333600">8</span>&nbsp;<span class="op" id="6333602">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333608">b</span>&nbsp;<span class="op" id="6333610">:=</span>&nbsp;<span class="ident" id="6333613">cdat</span><span class="op" id="6333617">[</span><span class="ident" id="6333618">x</span><span class="op" id="6333619">/</span><span class="num" id="6333620">8</span><span class="op" id="6333621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333627">for</span>&nbsp;<span class="ident" id="6333631">x2</span>&nbsp;<span class="op" id="6333634">:=</span>&nbsp;<span class="num" id="6333637">0</span><span class="op" id="6333638">;</span>&nbsp;<span class="ident" id="6333640">x2</span>&nbsp;<span class="op" id="6333643">&lt;</span>&nbsp;<span class="num" id="6333645">8</span>&nbsp;<span class="op" id="6333647">&amp;&amp;</span>&nbsp;<span class="ident" id="6333650">x</span><span class="op" id="6333651">+</span><span class="ident" id="6333652">x2</span>&nbsp;<span class="op" id="6333655">&lt;</span>&nbsp;<span class="ident" id="6333657">width</span><span class="op" id="6333662">;</span>&nbsp;<span class="ident" id="6333664">x2</span><span class="op" id="6333666">++</span>&nbsp;<span class="op" id="6333669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333676">idx</span>&nbsp;<span class="op" id="6333680">:=</span>&nbsp;<span class="ident" id="6333683">b</span>&nbsp;<span class="op" id="6333685">&gt;&gt;</span>&nbsp;<span class="num" id="6333688">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333695">if</span>&nbsp;<span class="builtinfunc" id="6333698">len</span><span class="op" id="6333701">(</span><span class="ident" id="6333702">paletted</span><span class="op" id="6333710">.</span><span class="ident" id="6333711">Palette</span><span class="op" id="6333718">)</span>&nbsp;<span class="op" id="6333720">&lt;=</span>&nbsp;<span class="builtintype" id="6333723">int</span><span class="op" id="6333726">(</span><span class="ident" id="6333727">idx</span><span class="op" id="6333730">)</span>&nbsp;<span class="op" id="6333732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333740">paletted</span><span class="op" id="6333748">.</span><span class="ident" id="6333749">Palette</span>&nbsp;<span class="op" id="6333757">=</span>&nbsp;<span class="ident" id="6333759">paletted</span><span class="op" id="6333767">.</span><span class="ident" id="6333768">Palette</span><span class="op" id="6333775">[</span><span class="op" id="6333776">:</span><span class="builtintype" id="6333777">int</span><span class="op" id="6333780">(</span><span class="ident" id="6333781">idx</span><span class="op" id="6333784">)</span><span class="op" id="6333785">+</span><span class="num" id="6333786">1</span><span class="op" id="6333787">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333801">paletted</span><span class="op" id="6333809">.</span><span class="ident" id="6333810">SetColorIndex</span><span class="op" id="6333823">(</span><span class="ident" id="6333824">x</span><span class="op" id="6333825">+</span><span class="ident" id="6333826">x2</span><span class="op" id="6333828">,</span>&nbsp;<span class="ident" id="6333830">y</span><span class="op" id="6333831">,</span>&nbsp;<span class="ident" id="6333833">idx</span><span class="op" id="6333836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333843">b</span>&nbsp;<span class="op" id="6333845">&lt;&lt;=</span>&nbsp;<span class="num" id="6333849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6333860">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333864">case</span>&nbsp;<span class="ident" id="6333869">cbP2</span><span class="op" id="6333873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333878">for</span>&nbsp;<span class="ident" id="6333882">x</span>&nbsp;<span class="op" id="6333884">:=</span>&nbsp;<span class="num" id="6333887">0</span><span class="op" id="6333888">;</span>&nbsp;<span class="ident" id="6333890">x</span>&nbsp;<span class="op" id="6333892">&lt;</span>&nbsp;<span class="ident" id="6333894">width</span><span class="op" id="6333899">;</span>&nbsp;<span class="ident" id="6333901">x</span>&nbsp;<span class="op" id="6333903">+=</span>&nbsp;<span class="num" id="6333906">4</span>&nbsp;<span class="op" id="6333908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333914">b</span>&nbsp;<span class="op" id="6333916">:=</span>&nbsp;<span class="ident" id="6333919">cdat</span><span class="op" id="6333923">[</span><span class="ident" id="6333924">x</span><span class="op" id="6333925">/</span><span class="num" id="6333926">4</span><span class="op" id="6333927">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6333933">for</span>&nbsp;<span class="ident" id="6333937">x2</span>&nbsp;<span class="op" id="6333940">:=</span>&nbsp;<span class="num" id="6333943">0</span><span class="op" id="6333944">;</span>&nbsp;<span class="ident" id="6333946">x2</span>&nbsp;<span class="op" id="6333949">&lt;</span>&nbsp;<span class="num" id="6333951">4</span>&nbsp;<span class="op" id="6333953">&amp;&amp;</span>&nbsp;<span class="ident" id="6333956">x</span><span class="op" id="6333957">+</span><span class="ident" id="6333958">x2</span>&nbsp;<span class="op" id="6333961">&lt;</span>&nbsp;<span class="ident" id="6333963">width</span><span class="op" id="6333968">;</span>&nbsp;<span class="ident" id="6333970">x2</span><span class="op" id="6333972">++</span>&nbsp;<span class="op" id="6333975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333982">idx</span>&nbsp;<span class="op" id="6333986">:=</span>&nbsp;<span class="ident" id="6333989">b</span>&nbsp;<span class="op" id="6333991">&gt;&gt;</span>&nbsp;<span class="num" id="6333994">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334001">if</span>&nbsp;<span class="builtinfunc" id="6334004">len</span><span class="op" id="6334007">(</span><span class="ident" id="6334008">paletted</span><span class="op" id="6334016">.</span><span class="ident" id="6334017">Palette</span><span class="op" id="6334024">)</span>&nbsp;<span class="op" id="6334026">&lt;=</span>&nbsp;<span class="builtintype" id="6334029">int</span><span class="op" id="6334032">(</span><span class="ident" id="6334033">idx</span><span class="op" id="6334036">)</span>&nbsp;<span class="op" id="6334038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334046">paletted</span><span class="op" id="6334054">.</span><span class="ident" id="6334055">Palette</span>&nbsp;<span class="op" id="6334063">=</span>&nbsp;<span class="ident" id="6334065">paletted</span><span class="op" id="6334073">.</span><span class="ident" id="6334074">Palette</span><span class="op" id="6334081">[</span><span class="op" id="6334082">:</span><span class="builtintype" id="6334083">int</span><span class="op" id="6334086">(</span><span class="ident" id="6334087">idx</span><span class="op" id="6334090">)</span><span class="op" id="6334091">+</span><span class="num" id="6334092">1</span><span class="op" id="6334093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334107">paletted</span><span class="op" id="6334115">.</span><span class="ident" id="6334116">SetColorIndex</span><span class="op" id="6334129">(</span><span class="ident" id="6334130">x</span><span class="op" id="6334131">+</span><span class="ident" id="6334132">x2</span><span class="op" id="6334134">,</span>&nbsp;<span class="ident" id="6334136">y</span><span class="op" id="6334137">,</span>&nbsp;<span class="ident" id="6334139">idx</span><span class="op" id="6334142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334149">b</span>&nbsp;<span class="op" id="6334151">&lt;&lt;=</span>&nbsp;<span class="num" id="6334155">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334170">case</span>&nbsp;<span class="ident" id="6334175">cbP4</span><span class="op" id="6334179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334184">for</span>&nbsp;<span class="ident" id="6334188">x</span>&nbsp;<span class="op" id="6334190">:=</span>&nbsp;<span class="num" id="6334193">0</span><span class="op" id="6334194">;</span>&nbsp;<span class="ident" id="6334196">x</span>&nbsp;<span class="op" id="6334198">&lt;</span>&nbsp;<span class="ident" id="6334200">width</span><span class="op" id="6334205">;</span>&nbsp;<span class="ident" id="6334207">x</span>&nbsp;<span class="op" id="6334209">+=</span>&nbsp;<span class="num" id="6334212">2</span>&nbsp;<span class="op" id="6334214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334220">b</span>&nbsp;<span class="op" id="6334222">:=</span>&nbsp;<span class="ident" id="6334225">cdat</span><span class="op" id="6334229">[</span><span class="ident" id="6334230">x</span><span class="op" id="6334231">/</span><span class="num" id="6334232">2</span><span class="op" id="6334233">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334239">for</span>&nbsp;<span class="ident" id="6334243">x2</span>&nbsp;<span class="op" id="6334246">:=</span>&nbsp;<span class="num" id="6334249">0</span><span class="op" id="6334250">;</span>&nbsp;<span class="ident" id="6334252">x2</span>&nbsp;<span class="op" id="6334255">&lt;</span>&nbsp;<span class="num" id="6334257">2</span>&nbsp;<span class="op" id="6334259">&amp;&amp;</span>&nbsp;<span class="ident" id="6334262">x</span><span class="op" id="6334263">+</span><span class="ident" id="6334264">x2</span>&nbsp;<span class="op" id="6334267">&lt;</span>&nbsp;<span class="ident" id="6334269">width</span><span class="op" id="6334274">;</span>&nbsp;<span class="ident" id="6334276">x2</span><span class="op" id="6334278">++</span>&nbsp;<span class="op" id="6334281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334288">idx</span>&nbsp;<span class="op" id="6334292">:=</span>&nbsp;<span class="ident" id="6334295">b</span>&nbsp;<span class="op" id="6334297">&gt;&gt;</span>&nbsp;<span class="num" id="6334300">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334307">if</span>&nbsp;<span class="builtinfunc" id="6334310">len</span><span class="op" id="6334313">(</span><span class="ident" id="6334314">paletted</span><span class="op" id="6334322">.</span><span class="ident" id="6334323">Palette</span><span class="op" id="6334330">)</span>&nbsp;<span class="op" id="6334332">&lt;=</span>&nbsp;<span class="builtintype" id="6334335">int</span><span class="op" id="6334338">(</span><span class="ident" id="6334339">idx</span><span class="op" id="6334342">)</span>&nbsp;<span class="op" id="6334344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334352">paletted</span><span class="op" id="6334360">.</span><span class="ident" id="6334361">Palette</span>&nbsp;<span class="op" id="6334369">=</span>&nbsp;<span class="ident" id="6334371">paletted</span><span class="op" id="6334379">.</span><span class="ident" id="6334380">Palette</span><span class="op" id="6334387">[</span><span class="op" id="6334388">:</span><span class="builtintype" id="6334389">int</span><span class="op" id="6334392">(</span><span class="ident" id="6334393">idx</span><span class="op" id="6334396">)</span><span class="op" id="6334397">+</span><span class="num" id="6334398">1</span><span class="op" id="6334399">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334406">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334413">paletted</span><span class="op" id="6334421">.</span><span class="ident" id="6334422">SetColorIndex</span><span class="op" id="6334435">(</span><span class="ident" id="6334436">x</span><span class="op" id="6334437">+</span><span class="ident" id="6334438">x2</span><span class="op" id="6334440">,</span>&nbsp;<span class="ident" id="6334442">y</span><span class="op" id="6334443">,</span>&nbsp;<span class="ident" id="6334445">idx</span><span class="op" id="6334448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334455">b</span>&nbsp;<span class="op" id="6334457">&lt;&lt;=</span>&nbsp;<span class="num" id="6334461">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334476">case</span>&nbsp;<span class="ident" id="6334481">cbP8</span><span class="op" id="6334485">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334490">if</span>&nbsp;<span class="builtinfunc" id="6334493">len</span><span class="op" id="6334496">(</span><span class="ident" id="6334497">paletted</span><span class="op" id="6334505">.</span><span class="ident" id="6334506">Palette</span><span class="op" id="6334513">)</span>&nbsp;<span class="op" id="6334515">!=</span>&nbsp;<span class="num" id="6334518">255</span>&nbsp;<span class="op" id="6334522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334528">for</span>&nbsp;<span class="ident" id="6334532">x</span>&nbsp;<span class="op" id="6334534">:=</span>&nbsp;<span class="num" id="6334537">0</span><span class="op" id="6334538">;</span>&nbsp;<span class="ident" id="6334540">x</span>&nbsp;<span class="op" id="6334542">&lt;</span>&nbsp;<span class="ident" id="6334544">width</span><span class="op" id="6334549">;</span>&nbsp;<span class="ident" id="6334551">x</span><span class="op" id="6334552">++</span>&nbsp;<span class="op" id="6334555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334562">if</span>&nbsp;<span class="builtinfunc" id="6334565">len</span><span class="op" id="6334568">(</span><span class="ident" id="6334569">paletted</span><span class="op" id="6334577">.</span><span class="ident" id="6334578">Palette</span><span class="op" id="6334585">)</span>&nbsp;<span class="op" id="6334587">&lt;=</span>&nbsp;<span class="builtintype" id="6334590">int</span><span class="op" id="6334593">(</span><span class="ident" id="6334594">cdat</span><span class="op" id="6334598">[</span><span class="ident" id="6334599">x</span><span class="op" id="6334600">]</span><span class="op" id="6334601">)</span>&nbsp;<span class="op" id="6334603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334611">paletted</span><span class="op" id="6334619">.</span><span class="ident" id="6334620">Palette</span>&nbsp;<span class="op" id="6334628">=</span>&nbsp;<span class="ident" id="6334630">paletted</span><span class="op" id="6334638">.</span><span class="ident" id="6334639">Palette</span><span class="op" id="6334646">[</span><span class="op" id="6334647">:</span><span class="builtintype" id="6334648">int</span><span class="op" id="6334651">(</span><span class="ident" id="6334652">cdat</span><span class="op" id="6334656">[</span><span class="ident" id="6334657">x</span><span class="op" id="6334658">]</span><span class="op" id="6334659">)</span><span class="op" id="6334660">+</span><span class="num" id="6334661">1</span><span class="op" id="6334662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334669">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6334685">copy</span><span class="op" id="6334689">(</span><span class="ident" id="6334690">paletted</span><span class="op" id="6334698">.</span><span class="ident" id="6334699">Pix</span><span class="op" id="6334702">[</span><span class="ident" id="6334703">pixOffset</span><span class="op" id="6334712">:</span><span class="op" id="6334713">]</span><span class="op" id="6334714">,</span>&nbsp;<span class="ident" id="6334716">cdat</span><span class="op" id="6334720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334725">pixOffset</span>&nbsp;<span class="op" id="6334735">+=</span>&nbsp;<span class="ident" id="6334738">paletted</span><span class="op" id="6334746">.</span><span class="ident" id="6334747">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334756">case</span>&nbsp;<span class="ident" id="6334761">cbTCA8</span><span class="op" id="6334767">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6334772">copy</span><span class="op" id="6334776">(</span><span class="ident" id="6334777">nrgba</span><span class="op" id="6334782">.</span><span class="ident" id="6334783">Pix</span><span class="op" id="6334786">[</span><span class="ident" id="6334787">pixOffset</span><span class="op" id="6334796">:</span><span class="op" id="6334797">]</span><span class="op" id="6334798">,</span>&nbsp;<span class="ident" id="6334800">cdat</span><span class="op" id="6334804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334809">pixOffset</span>&nbsp;<span class="op" id="6334819">+=</span>&nbsp;<span class="ident" id="6334822">nrgba</span><span class="op" id="6334827">.</span><span class="ident" id="6334828">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334837">case</span>&nbsp;<span class="ident" id="6334842">cbG16</span><span class="op" id="6334847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334852">for</span>&nbsp;<span class="ident" id="6334856">x</span>&nbsp;<span class="op" id="6334858">:=</span>&nbsp;<span class="num" id="6334861">0</span><span class="op" id="6334862">;</span>&nbsp;<span class="ident" id="6334864">x</span>&nbsp;<span class="op" id="6334866">&lt;</span>&nbsp;<span class="ident" id="6334868">width</span><span class="op" id="6334873">;</span>&nbsp;<span class="ident" id="6334875">x</span><span class="op" id="6334876">++</span>&nbsp;<span class="op" id="6334879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334885">ycol</span>&nbsp;<span class="op" id="6334890">:=</span>&nbsp;<span class="builtintype" id="6334893">uint16</span><span class="op" id="6334899">(</span><span class="ident" id="6334900">cdat</span><span class="op" id="6334904">[</span><span class="num" id="6334905">2</span><span class="op" id="6334906">*</span><span class="ident" id="6334907">x</span><span class="op" id="6334908">+</span><span class="num" id="6334909">0</span><span class="op" id="6334910">]</span><span class="op" id="6334911">)</span><span class="op" id="6334912">&lt;&lt;</span><span class="num" id="6334914">8</span>&nbsp;<span class="op" id="6334916">|</span>&nbsp;<span class="builtintype" id="6334918">uint16</span><span class="op" id="6334924">(</span><span class="ident" id="6334925">cdat</span><span class="op" id="6334929">[</span><span class="num" id="6334930">2</span><span class="op" id="6334931">*</span><span class="ident" id="6334932">x</span><span class="op" id="6334933">+</span><span class="num" id="6334934">1</span><span class="op" id="6334935">]</span><span class="op" id="6334936">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334942">gray16</span><span class="op" id="6334948">.</span><span class="ident" id="6334949">SetGray16</span><span class="op" id="6334958">(</span><span class="ident" id="6334959">x</span><span class="op" id="6334960">,</span>&nbsp;<span class="ident" id="6334962">y</span><span class="op" id="6334963">,</span>&nbsp;<span class="ident" id="6334965">color</span><span class="op" id="6334970">.</span><span class="ident" id="6334971">Gray16</span><span class="op" id="6334977">{</span><span class="ident" id="6334978">ycol</span><span class="op" id="6334982">}</span><span class="op" id="6334983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6334988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334992">case</span>&nbsp;<span class="ident" id="6334997">cbGA16</span><span class="op" id="6335003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335008">for</span>&nbsp;<span class="ident" id="6335012">x</span>&nbsp;<span class="op" id="6335014">:=</span>&nbsp;<span class="num" id="6335017">0</span><span class="op" id="6335018">;</span>&nbsp;<span class="ident" id="6335020">x</span>&nbsp;<span class="op" id="6335022">&lt;</span>&nbsp;<span class="ident" id="6335024">width</span><span class="op" id="6335029">;</span>&nbsp;<span class="ident" id="6335031">x</span><span class="op" id="6335032">++</span>&nbsp;<span class="op" id="6335035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335041">ycol</span>&nbsp;<span class="op" id="6335046">:=</span>&nbsp;<span class="builtintype" id="6335049">uint16</span><span class="op" id="6335055">(</span><span class="ident" id="6335056">cdat</span><span class="op" id="6335060">[</span><span class="num" id="6335061">4</span><span class="op" id="6335062">*</span><span class="ident" id="6335063">x</span><span class="op" id="6335064">+</span><span class="num" id="6335065">0</span><span class="op" id="6335066">]</span><span class="op" id="6335067">)</span><span class="op" id="6335068">&lt;&lt;</span><span class="num" id="6335070">8</span>&nbsp;<span class="op" id="6335072">|</span>&nbsp;<span class="builtintype" id="6335074">uint16</span><span class="op" id="6335080">(</span><span class="ident" id="6335081">cdat</span><span class="op" id="6335085">[</span><span class="num" id="6335086">4</span><span class="op" id="6335087">*</span><span class="ident" id="6335088">x</span><span class="op" id="6335089">+</span><span class="num" id="6335090">1</span><span class="op" id="6335091">]</span><span class="op" id="6335092">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335098">acol</span>&nbsp;<span class="op" id="6335103">:=</span>&nbsp;<span class="builtintype" id="6335106">uint16</span><span class="op" id="6335112">(</span><span class="ident" id="6335113">cdat</span><span class="op" id="6335117">[</span><span class="num" id="6335118">4</span><span class="op" id="6335119">*</span><span class="ident" id="6335120">x</span><span class="op" id="6335121">+</span><span class="num" id="6335122">2</span><span class="op" id="6335123">]</span><span class="op" id="6335124">)</span><span class="op" id="6335125">&lt;&lt;</span><span class="num" id="6335127">8</span>&nbsp;<span class="op" id="6335129">|</span>&nbsp;<span class="builtintype" id="6335131">uint16</span><span class="op" id="6335137">(</span><span class="ident" id="6335138">cdat</span><span class="op" id="6335142">[</span><span class="num" id="6335143">4</span><span class="op" id="6335144">*</span><span class="ident" id="6335145">x</span><span class="op" id="6335146">+</span><span class="num" id="6335147">3</span><span class="op" id="6335148">]</span><span class="op" id="6335149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335155">nrgba64</span><span class="op" id="6335162">.</span><span class="ident" id="6335163">SetNRGBA64</span><span class="op" id="6335173">(</span><span class="ident" id="6335174">x</span><span class="op" id="6335175">,</span>&nbsp;<span class="ident" id="6335177">y</span><span class="op" id="6335178">,</span>&nbsp;<span class="ident" id="6335180">color</span><span class="op" id="6335185">.</span><span class="ident" id="6335186">NRGBA64</span><span class="op" id="6335193">{</span><span class="ident" id="6335194">ycol</span><span class="op" id="6335198">,</span>&nbsp;<span class="ident" id="6335200">ycol</span><span class="op" id="6335204">,</span>&nbsp;<span class="ident" id="6335206">ycol</span><span class="op" id="6335210">,</span>&nbsp;<span class="ident" id="6335212">acol</span><span class="op" id="6335216">}</span><span class="op" id="6335217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6335222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335226">case</span>&nbsp;<span class="ident" id="6335231">cbTC16</span><span class="op" id="6335237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335242">for</span>&nbsp;<span class="ident" id="6335246">x</span>&nbsp;<span class="op" id="6335248">:=</span>&nbsp;<span class="num" id="6335251">0</span><span class="op" id="6335252">;</span>&nbsp;<span class="ident" id="6335254">x</span>&nbsp;<span class="op" id="6335256">&lt;</span>&nbsp;<span class="ident" id="6335258">width</span><span class="op" id="6335263">;</span>&nbsp;<span class="ident" id="6335265">x</span><span class="op" id="6335266">++</span>&nbsp;<span class="op" id="6335269">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335275">rcol</span>&nbsp;<span class="op" id="6335280">:=</span>&nbsp;<span class="builtintype" id="6335283">uint16</span><span class="op" id="6335289">(</span><span class="ident" id="6335290">cdat</span><span class="op" id="6335294">[</span><span class="num" id="6335295">6</span><span class="op" id="6335296">*</span><span class="ident" id="6335297">x</span><span class="op" id="6335298">+</span><span class="num" id="6335299">0</span><span class="op" id="6335300">]</span><span class="op" id="6335301">)</span><span class="op" id="6335302">&lt;&lt;</span><span class="num" id="6335304">8</span>&nbsp;<span class="op" id="6335306">|</span>&nbsp;<span class="builtintype" id="6335308">uint16</span><span class="op" id="6335314">(</span><span class="ident" id="6335315">cdat</span><span class="op" id="6335319">[</span><span class="num" id="6335320">6</span><span class="op" id="6335321">*</span><span class="ident" id="6335322">x</span><span class="op" id="6335323">+</span><span class="num" id="6335324">1</span><span class="op" id="6335325">]</span><span class="op" id="6335326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335332">gcol</span>&nbsp;<span class="op" id="6335337">:=</span>&nbsp;<span class="builtintype" id="6335340">uint16</span><span class="op" id="6335346">(</span><span class="ident" id="6335347">cdat</span><span class="op" id="6335351">[</span><span class="num" id="6335352">6</span><span class="op" id="6335353">*</span><span class="ident" id="6335354">x</span><span class="op" id="6335355">+</span><span class="num" id="6335356">2</span><span class="op" id="6335357">]</span><span class="op" id="6335358">)</span><span class="op" id="6335359">&lt;&lt;</span><span class="num" id="6335361">8</span>&nbsp;<span class="op" id="6335363">|</span>&nbsp;<span class="builtintype" id="6335365">uint16</span><span class="op" id="6335371">(</span><span class="ident" id="6335372">cdat</span><span class="op" id="6335376">[</span><span class="num" id="6335377">6</span><span class="op" id="6335378">*</span><span class="ident" id="6335379">x</span><span class="op" id="6335380">+</span><span class="num" id="6335381">3</span><span class="op" id="6335382">]</span><span class="op" id="6335383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335389">bcol</span>&nbsp;<span class="op" id="6335394">:=</span>&nbsp;<span class="builtintype" id="6335397">uint16</span><span class="op" id="6335403">(</span><span class="ident" id="6335404">cdat</span><span class="op" id="6335408">[</span><span class="num" id="6335409">6</span><span class="op" id="6335410">*</span><span class="ident" id="6335411">x</span><span class="op" id="6335412">+</span><span class="num" id="6335413">4</span><span class="op" id="6335414">]</span><span class="op" id="6335415">)</span><span class="op" id="6335416">&lt;&lt;</span><span class="num" id="6335418">8</span>&nbsp;<span class="op" id="6335420">|</span>&nbsp;<span class="builtintype" id="6335422">uint16</span><span class="op" id="6335428">(</span><span class="ident" id="6335429">cdat</span><span class="op" id="6335433">[</span><span class="num" id="6335434">6</span><span class="op" id="6335435">*</span><span class="ident" id="6335436">x</span><span class="op" id="6335437">+</span><span class="num" id="6335438">5</span><span class="op" id="6335439">]</span><span class="op" id="6335440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335446">rgba64</span><span class="op" id="6335452">.</span><span class="ident" id="6335453">SetRGBA64</span><span class="op" id="6335462">(</span><span class="ident" id="6335463">x</span><span class="op" id="6335464">,</span>&nbsp;<span class="ident" id="6335466">y</span><span class="op" id="6335467">,</span>&nbsp;<span class="ident" id="6335469">color</span><span class="op" id="6335474">.</span><span class="ident" id="6335475">RGBA64</span><span class="op" id="6335481">{</span><span class="ident" id="6335482">rcol</span><span class="op" id="6335486">,</span>&nbsp;<span class="ident" id="6335488">gcol</span><span class="op" id="6335492">,</span>&nbsp;<span class="ident" id="6335494">bcol</span><span class="op" id="6335498">,</span>&nbsp;<span class="num" id="6335500">0xffff</span><span class="op" id="6335506">}</span><span class="op" id="6335507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6335512">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335516">case</span>&nbsp;<span class="ident" id="6335521">cbTCA16</span><span class="op" id="6335528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335533">for</span>&nbsp;<span class="ident" id="6335537">x</span>&nbsp;<span class="op" id="6335539">:=</span>&nbsp;<span class="num" id="6335542">0</span><span class="op" id="6335543">;</span>&nbsp;<span class="ident" id="6335545">x</span>&nbsp;<span class="op" id="6335547">&lt;</span>&nbsp;<span class="ident" id="6335549">width</span><span class="op" id="6335554">;</span>&nbsp;<span class="ident" id="6335556">x</span><span class="op" id="6335557">++</span>&nbsp;<span class="op" id="6335560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335566">rcol</span>&nbsp;<span class="op" id="6335571">:=</span>&nbsp;<span class="builtintype" id="6335574">uint16</span><span class="op" id="6335580">(</span><span class="ident" id="6335581">cdat</span><span class="op" id="6335585">[</span><span class="num" id="6335586">8</span><span class="op" id="6335587">*</span><span class="ident" id="6335588">x</span><span class="op" id="6335589">+</span><span class="num" id="6335590">0</span><span class="op" id="6335591">]</span><span class="op" id="6335592">)</span><span class="op" id="6335593">&lt;&lt;</span><span class="num" id="6335595">8</span>&nbsp;<span class="op" id="6335597">|</span>&nbsp;<span class="builtintype" id="6335599">uint16</span><span class="op" id="6335605">(</span><span class="ident" id="6335606">cdat</span><span class="op" id="6335610">[</span><span class="num" id="6335611">8</span><span class="op" id="6335612">*</span><span class="ident" id="6335613">x</span><span class="op" id="6335614">+</span><span class="num" id="6335615">1</span><span class="op" id="6335616">]</span><span class="op" id="6335617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335623">gcol</span>&nbsp;<span class="op" id="6335628">:=</span>&nbsp;<span class="builtintype" id="6335631">uint16</span><span class="op" id="6335637">(</span><span class="ident" id="6335638">cdat</span><span class="op" id="6335642">[</span><span class="num" id="6335643">8</span><span class="op" id="6335644">*</span><span class="ident" id="6335645">x</span><span class="op" id="6335646">+</span><span class="num" id="6335647">2</span><span class="op" id="6335648">]</span><span class="op" id="6335649">)</span><span class="op" id="6335650">&lt;&lt;</span><span class="num" id="6335652">8</span>&nbsp;<span class="op" id="6335654">|</span>&nbsp;<span class="builtintype" id="6335656">uint16</span><span class="op" id="6335662">(</span><span class="ident" id="6335663">cdat</span><span class="op" id="6335667">[</span><span class="num" id="6335668">8</span><span class="op" id="6335669">*</span><span class="ident" id="6335670">x</span><span class="op" id="6335671">+</span><span class="num" id="6335672">3</span><span class="op" id="6335673">]</span><span class="op" id="6335674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335680">bcol</span>&nbsp;<span class="op" id="6335685">:=</span>&nbsp;<span class="builtintype" id="6335688">uint16</span><span class="op" id="6335694">(</span><span class="ident" id="6335695">cdat</span><span class="op" id="6335699">[</span><span class="num" id="6335700">8</span><span class="op" id="6335701">*</span><span class="ident" id="6335702">x</span><span class="op" id="6335703">+</span><span class="num" id="6335704">4</span><span class="op" id="6335705">]</span><span class="op" id="6335706">)</span><span class="op" id="6335707">&lt;&lt;</span><span class="num" id="6335709">8</span>&nbsp;<span class="op" id="6335711">|</span>&nbsp;<span class="builtintype" id="6335713">uint16</span><span class="op" id="6335719">(</span><span class="ident" id="6335720">cdat</span><span class="op" id="6335724">[</span><span class="num" id="6335725">8</span><span class="op" id="6335726">*</span><span class="ident" id="6335727">x</span><span class="op" id="6335728">+</span><span class="num" id="6335729">5</span><span class="op" id="6335730">]</span><span class="op" id="6335731">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335737">acol</span>&nbsp;<span class="op" id="6335742">:=</span>&nbsp;<span class="builtintype" id="6335745">uint16</span><span class="op" id="6335751">(</span><span class="ident" id="6335752">cdat</span><span class="op" id="6335756">[</span><span class="num" id="6335757">8</span><span class="op" id="6335758">*</span><span class="ident" id="6335759">x</span><span class="op" id="6335760">+</span><span class="num" id="6335761">6</span><span class="op" id="6335762">]</span><span class="op" id="6335763">)</span><span class="op" id="6335764">&lt;&lt;</span><span class="num" id="6335766">8</span>&nbsp;<span class="op" id="6335768">|</span>&nbsp;<span class="builtintype" id="6335770">uint16</span><span class="op" id="6335776">(</span><span class="ident" id="6335777">cdat</span><span class="op" id="6335781">[</span><span class="num" id="6335782">8</span><span class="op" id="6335783">*</span><span class="ident" id="6335784">x</span><span class="op" id="6335785">+</span><span class="num" id="6335786">7</span><span class="op" id="6335787">]</span><span class="op" id="6335788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335794">nrgba64</span><span class="op" id="6335801">.</span><span class="ident" id="6335802">SetNRGBA64</span><span class="op" id="6335812">(</span><span class="ident" id="6335813">x</span><span class="op" id="6335814">,</span>&nbsp;<span class="ident" id="6335816">y</span><span class="op" id="6335817">,</span>&nbsp;<span class="ident" id="6335819">color</span><span class="op" id="6335824">.</span><span class="ident" id="6335825">NRGBA64</span><span class="op" id="6335832">{</span><span class="ident" id="6335833">rcol</span><span class="op" id="6335837">,</span>&nbsp;<span class="ident" id="6335839">gcol</span><span class="op" id="6335843">,</span>&nbsp;<span class="ident" id="6335845">bcol</span><span class="op" id="6335849">,</span>&nbsp;<span class="ident" id="6335851">acol</span><span class="op" id="6335855">}</span><span class="op" id="6335856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6335861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6335865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6335870">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6335926">pr</span><span class="op" id="6335928">,</span>&nbsp;<span class="ident" id="6335930">cr</span>&nbsp;<span class="op" id="6335933">=</span>&nbsp;<span class="ident" id="6335935">cr</span><span class="op" id="6335937">,</span>&nbsp;<span class="ident" id="6335939">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6335943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6335947">return</span>&nbsp;<span class="ident" id="6335954">img</span><span class="op" id="6335957">,</span>&nbsp;<span class="builtintype" id="6335959">nil</span><br>
<span class="lineno">585</span><span class="op" id="6335963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6335966">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6336029">func</span>&nbsp;<span class="op" id="6336034">(</span><span class="ident" id="6336035">d</span>&nbsp;<span class="op" id="6336037">*</span><span class="ident" id="6336038">decoder</span><span class="op" id="6336045">)</span>&nbsp;<span class="ident" id="6336047">mergePassInto</span><span class="op" id="6336060">(</span><span class="ident" id="6336061">dst</span>&nbsp;<span class="ident" id="6336065">image</span><span class="op" id="6336070">.</span><span class="ident" id="6336071">Image</span><span class="op" id="6336076">,</span>&nbsp;<span class="ident" id="6336078">src</span>&nbsp;<span class="ident" id="6336082">image</span><span class="op" id="6336087">.</span><span class="ident" id="6336088">Image</span><span class="op" id="6336093">,</span>&nbsp;<span class="ident" id="6336095">pass</span>&nbsp;<span class="builtintype" id="6336100">int</span><span class="op" id="6336103">)</span>&nbsp;<span class="op" id="6336105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336108">p</span>&nbsp;<span class="op" id="6336110">:=</span>&nbsp;<span class="ident" id="6336113">interlacing</span><span class="op" id="6336124">[</span><span class="ident" id="6336125">pass</span><span class="op" id="6336129">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336132">var</span>&nbsp;<span class="op" id="6336136">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336140">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6336154">[</span><span class="op" id="6336155">]</span><span class="builtintype" id="6336156">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336164">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6336178">[</span><span class="op" id="6336179">]</span><span class="builtintype" id="6336180">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336188">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6336202">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336208">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336222">image</span><span class="op" id="6336227">.</span><span class="ident" id="6336228">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336240">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6336254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6336259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336262">switch</span>&nbsp;<span class="ident" id="6336269">target</span>&nbsp;<span class="op" id="6336276">:=</span>&nbsp;<span class="ident" id="6336279">dst</span><span class="op" id="6336282">.</span><span class="op" id="6336283">(</span><span class="keyword" id="6336284">type</span><span class="op" id="6336288">)</span>&nbsp;<span class="op" id="6336290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336293">case</span>&nbsp;<span class="op" id="6336298">*</span><span class="ident" id="6336299">image</span><span class="op" id="6336304">.</span><span class="ident" id="6336305">Alpha</span><span class="op" id="6336310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336314">srcPix</span>&nbsp;<span class="op" id="6336321">=</span>&nbsp;<span class="ident" id="6336323">src</span><span class="op" id="6336326">.</span><span class="op" id="6336327">(</span><span class="op" id="6336328">*</span><span class="ident" id="6336329">image</span><span class="op" id="6336334">.</span><span class="ident" id="6336335">Alpha</span><span class="op" id="6336340">)</span><span class="op" id="6336341">.</span><span class="ident" id="6336342">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336348">dstPix</span><span class="op" id="6336354">,</span>&nbsp;<span class="ident" id="6336356">stride</span><span class="op" id="6336362">,</span>&nbsp;<span class="ident" id="6336364">rect</span>&nbsp;<span class="op" id="6336369">=</span>&nbsp;<span class="ident" id="6336371">target</span><span class="op" id="6336377">.</span><span class="ident" id="6336378">Pix</span><span class="op" id="6336381">,</span>&nbsp;<span class="ident" id="6336383">target</span><span class="op" id="6336389">.</span><span class="ident" id="6336390">Stride</span><span class="op" id="6336396">,</span>&nbsp;<span class="ident" id="6336398">target</span><span class="op" id="6336404">.</span><span class="ident" id="6336405">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336412">bytesPerPixel</span>&nbsp;<span class="op" id="6336426">=</span>&nbsp;<span class="num" id="6336428">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336431">case</span>&nbsp;<span class="op" id="6336436">*</span><span class="ident" id="6336437">image</span><span class="op" id="6336442">.</span><span class="ident" id="6336443">Alpha16</span><span class="op" id="6336450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336454">srcPix</span>&nbsp;<span class="op" id="6336461">=</span>&nbsp;<span class="ident" id="6336463">src</span><span class="op" id="6336466">.</span><span class="op" id="6336467">(</span><span class="op" id="6336468">*</span><span class="ident" id="6336469">image</span><span class="op" id="6336474">.</span><span class="ident" id="6336475">Alpha16</span><span class="op" id="6336482">)</span><span class="op" id="6336483">.</span><span class="ident" id="6336484">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336490">dstPix</span><span class="op" id="6336496">,</span>&nbsp;<span class="ident" id="6336498">stride</span><span class="op" id="6336504">,</span>&nbsp;<span class="ident" id="6336506">rect</span>&nbsp;<span class="op" id="6336511">=</span>&nbsp;<span class="ident" id="6336513">target</span><span class="op" id="6336519">.</span><span class="ident" id="6336520">Pix</span><span class="op" id="6336523">,</span>&nbsp;<span class="ident" id="6336525">target</span><span class="op" id="6336531">.</span><span class="ident" id="6336532">Stride</span><span class="op" id="6336538">,</span>&nbsp;<span class="ident" id="6336540">target</span><span class="op" id="6336546">.</span><span class="ident" id="6336547">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336554">bytesPerPixel</span>&nbsp;<span class="op" id="6336568">=</span>&nbsp;<span class="num" id="6336570">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336573">case</span>&nbsp;<span class="op" id="6336578">*</span><span class="ident" id="6336579">image</span><span class="op" id="6336584">.</span><span class="ident" id="6336585">Gray</span><span class="op" id="6336589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336593">srcPix</span>&nbsp;<span class="op" id="6336600">=</span>&nbsp;<span class="ident" id="6336602">src</span><span class="op" id="6336605">.</span><span class="op" id="6336606">(</span><span class="op" id="6336607">*</span><span class="ident" id="6336608">image</span><span class="op" id="6336613">.</span><span class="ident" id="6336614">Gray</span><span class="op" id="6336618">)</span><span class="op" id="6336619">.</span><span class="ident" id="6336620">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336626">dstPix</span><span class="op" id="6336632">,</span>&nbsp;<span class="ident" id="6336634">stride</span><span class="op" id="6336640">,</span>&nbsp;<span class="ident" id="6336642">rect</span>&nbsp;<span class="op" id="6336647">=</span>&nbsp;<span class="ident" id="6336649">target</span><span class="op" id="6336655">.</span><span class="ident" id="6336656">Pix</span><span class="op" id="6336659">,</span>&nbsp;<span class="ident" id="6336661">target</span><span class="op" id="6336667">.</span><span class="ident" id="6336668">Stride</span><span class="op" id="6336674">,</span>&nbsp;<span class="ident" id="6336676">target</span><span class="op" id="6336682">.</span><span class="ident" id="6336683">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336690">bytesPerPixel</span>&nbsp;<span class="op" id="6336704">=</span>&nbsp;<span class="num" id="6336706">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336709">case</span>&nbsp;<span class="op" id="6336714">*</span><span class="ident" id="6336715">image</span><span class="op" id="6336720">.</span><span class="ident" id="6336721">Gray16</span><span class="op" id="6336727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336731">srcPix</span>&nbsp;<span class="op" id="6336738">=</span>&nbsp;<span class="ident" id="6336740">src</span><span class="op" id="6336743">.</span><span class="op" id="6336744">(</span><span class="op" id="6336745">*</span><span class="ident" id="6336746">image</span><span class="op" id="6336751">.</span><span class="ident" id="6336752">Gray16</span><span class="op" id="6336758">)</span><span class="op" id="6336759">.</span><span class="ident" id="6336760">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336766">dstPix</span><span class="op" id="6336772">,</span>&nbsp;<span class="ident" id="6336774">stride</span><span class="op" id="6336780">,</span>&nbsp;<span class="ident" id="6336782">rect</span>&nbsp;<span class="op" id="6336787">=</span>&nbsp;<span class="ident" id="6336789">target</span><span class="op" id="6336795">.</span><span class="ident" id="6336796">Pix</span><span class="op" id="6336799">,</span>&nbsp;<span class="ident" id="6336801">target</span><span class="op" id="6336807">.</span><span class="ident" id="6336808">Stride</span><span class="op" id="6336814">,</span>&nbsp;<span class="ident" id="6336816">target</span><span class="op" id="6336822">.</span><span class="ident" id="6336823">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336830">bytesPerPixel</span>&nbsp;<span class="op" id="6336844">=</span>&nbsp;<span class="num" id="6336846">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336849">case</span>&nbsp;<span class="op" id="6336854">*</span><span class="ident" id="6336855">image</span><span class="op" id="6336860">.</span><span class="ident" id="6336861">NRGBA</span><span class="op" id="6336866">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336870">srcPix</span>&nbsp;<span class="op" id="6336877">=</span>&nbsp;<span class="ident" id="6336879">src</span><span class="op" id="6336882">.</span><span class="op" id="6336883">(</span><span class="op" id="6336884">*</span><span class="ident" id="6336885">image</span><span class="op" id="6336890">.</span><span class="ident" id="6336891">NRGBA</span><span class="op" id="6336896">)</span><span class="op" id="6336897">.</span><span class="ident" id="6336898">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336904">dstPix</span><span class="op" id="6336910">,</span>&nbsp;<span class="ident" id="6336912">stride</span><span class="op" id="6336918">,</span>&nbsp;<span class="ident" id="6336920">rect</span>&nbsp;<span class="op" id="6336925">=</span>&nbsp;<span class="ident" id="6336927">target</span><span class="op" id="6336933">.</span><span class="ident" id="6336934">Pix</span><span class="op" id="6336937">,</span>&nbsp;<span class="ident" id="6336939">target</span><span class="op" id="6336945">.</span><span class="ident" id="6336946">Stride</span><span class="op" id="6336952">,</span>&nbsp;<span class="ident" id="6336954">target</span><span class="op" id="6336960">.</span><span class="ident" id="6336961">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6336968">bytesPerPixel</span>&nbsp;<span class="op" id="6336982">=</span>&nbsp;<span class="num" id="6336984">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6336987">case</span>&nbsp;<span class="op" id="6336992">*</span><span class="ident" id="6336993">image</span><span class="op" id="6336998">.</span><span class="ident" id="6336999">NRGBA64</span><span class="op" id="6337006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337010">srcPix</span>&nbsp;<span class="op" id="6337017">=</span>&nbsp;<span class="ident" id="6337019">src</span><span class="op" id="6337022">.</span><span class="op" id="6337023">(</span><span class="op" id="6337024">*</span><span class="ident" id="6337025">image</span><span class="op" id="6337030">.</span><span class="ident" id="6337031">NRGBA64</span><span class="op" id="6337038">)</span><span class="op" id="6337039">.</span><span class="ident" id="6337040">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337046">dstPix</span><span class="op" id="6337052">,</span>&nbsp;<span class="ident" id="6337054">stride</span><span class="op" id="6337060">,</span>&nbsp;<span class="ident" id="6337062">rect</span>&nbsp;<span class="op" id="6337067">=</span>&nbsp;<span class="ident" id="6337069">target</span><span class="op" id="6337075">.</span><span class="ident" id="6337076">Pix</span><span class="op" id="6337079">,</span>&nbsp;<span class="ident" id="6337081">target</span><span class="op" id="6337087">.</span><span class="ident" id="6337088">Stride</span><span class="op" id="6337094">,</span>&nbsp;<span class="ident" id="6337096">target</span><span class="op" id="6337102">.</span><span class="ident" id="6337103">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337110">bytesPerPixel</span>&nbsp;<span class="op" id="6337124">=</span>&nbsp;<span class="num" id="6337126">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337129">case</span>&nbsp;<span class="op" id="6337134">*</span><span class="ident" id="6337135">image</span><span class="op" id="6337140">.</span><span class="ident" id="6337141">Paletted</span><span class="op" id="6337149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337153">srcPix</span>&nbsp;<span class="op" id="6337160">=</span>&nbsp;<span class="ident" id="6337162">src</span><span class="op" id="6337165">.</span><span class="op" id="6337166">(</span><span class="op" id="6337167">*</span><span class="ident" id="6337168">image</span><span class="op" id="6337173">.</span><span class="ident" id="6337174">Paletted</span><span class="op" id="6337182">)</span><span class="op" id="6337183">.</span><span class="ident" id="6337184">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337190">dstPix</span><span class="op" id="6337196">,</span>&nbsp;<span class="ident" id="6337198">stride</span><span class="op" id="6337204">,</span>&nbsp;<span class="ident" id="6337206">rect</span>&nbsp;<span class="op" id="6337211">=</span>&nbsp;<span class="ident" id="6337213">target</span><span class="op" id="6337219">.</span><span class="ident" id="6337220">Pix</span><span class="op" id="6337223">,</span>&nbsp;<span class="ident" id="6337225">target</span><span class="op" id="6337231">.</span><span class="ident" id="6337232">Stride</span><span class="op" id="6337238">,</span>&nbsp;<span class="ident" id="6337240">target</span><span class="op" id="6337246">.</span><span class="ident" id="6337247">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337254">bytesPerPixel</span>&nbsp;<span class="op" id="6337268">=</span>&nbsp;<span class="num" id="6337270">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337273">case</span>&nbsp;<span class="op" id="6337278">*</span><span class="ident" id="6337279">image</span><span class="op" id="6337284">.</span><span class="ident" id="6337285">RGBA</span><span class="op" id="6337289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337293">srcPix</span>&nbsp;<span class="op" id="6337300">=</span>&nbsp;<span class="ident" id="6337302">src</span><span class="op" id="6337305">.</span><span class="op" id="6337306">(</span><span class="op" id="6337307">*</span><span class="ident" id="6337308">image</span><span class="op" id="6337313">.</span><span class="ident" id="6337314">RGBA</span><span class="op" id="6337318">)</span><span class="op" id="6337319">.</span><span class="ident" id="6337320">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337326">dstPix</span><span class="op" id="6337332">,</span>&nbsp;<span class="ident" id="6337334">stride</span><span class="op" id="6337340">,</span>&nbsp;<span class="ident" id="6337342">rect</span>&nbsp;<span class="op" id="6337347">=</span>&nbsp;<span class="ident" id="6337349">target</span><span class="op" id="6337355">.</span><span class="ident" id="6337356">Pix</span><span class="op" id="6337359">,</span>&nbsp;<span class="ident" id="6337361">target</span><span class="op" id="6337367">.</span><span class="ident" id="6337368">Stride</span><span class="op" id="6337374">,</span>&nbsp;<span class="ident" id="6337376">target</span><span class="op" id="6337382">.</span><span class="ident" id="6337383">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337390">bytesPerPixel</span>&nbsp;<span class="op" id="6337404">=</span>&nbsp;<span class="num" id="6337406">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337409">case</span>&nbsp;<span class="op" id="6337414">*</span><span class="ident" id="6337415">image</span><span class="op" id="6337420">.</span><span class="ident" id="6337421">RGBA64</span><span class="op" id="6337427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337431">srcPix</span>&nbsp;<span class="op" id="6337438">=</span>&nbsp;<span class="ident" id="6337440">src</span><span class="op" id="6337443">.</span><span class="op" id="6337444">(</span><span class="op" id="6337445">*</span><span class="ident" id="6337446">image</span><span class="op" id="6337451">.</span><span class="ident" id="6337452">RGBA64</span><span class="op" id="6337458">)</span><span class="op" id="6337459">.</span><span class="ident" id="6337460">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337466">dstPix</span><span class="op" id="6337472">,</span>&nbsp;<span class="ident" id="6337474">stride</span><span class="op" id="6337480">,</span>&nbsp;<span class="ident" id="6337482">rect</span>&nbsp;<span class="op" id="6337487">=</span>&nbsp;<span class="ident" id="6337489">target</span><span class="op" id="6337495">.</span><span class="ident" id="6337496">Pix</span><span class="op" id="6337499">,</span>&nbsp;<span class="ident" id="6337501">target</span><span class="op" id="6337507">.</span><span class="ident" id="6337508">Stride</span><span class="op" id="6337514">,</span>&nbsp;<span class="ident" id="6337516">target</span><span class="op" id="6337522">.</span><span class="ident" id="6337523">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337530">bytesPerPixel</span>&nbsp;<span class="op" id="6337544">=</span>&nbsp;<span class="num" id="6337546">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337549">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337552">s</span><span class="op" id="6337553">,</span>&nbsp;<span class="ident" id="6337555">bounds</span>&nbsp;<span class="op" id="6337562">:=</span>&nbsp;<span class="num" id="6337565">0</span><span class="op" id="6337566">,</span>&nbsp;<span class="ident" id="6337568">src</span><span class="op" id="6337571">.</span><span class="ident" id="6337572">Bounds</span><span class="op" id="6337578">(</span><span class="op" id="6337579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337582">for</span>&nbsp;<span class="ident" id="6337586">y</span>&nbsp;<span class="op" id="6337588">:=</span>&nbsp;<span class="ident" id="6337591">bounds</span><span class="op" id="6337597">.</span><span class="ident" id="6337598">Min</span><span class="op" id="6337601">.</span><span class="ident" id="6337602">Y</span><span class="op" id="6337603">;</span>&nbsp;<span class="ident" id="6337605">y</span>&nbsp;<span class="op" id="6337607">&lt;</span>&nbsp;<span class="ident" id="6337609">bounds</span><span class="op" id="6337615">.</span><span class="ident" id="6337616">Max</span><span class="op" id="6337619">.</span><span class="ident" id="6337620">Y</span><span class="op" id="6337621">;</span>&nbsp;<span class="ident" id="6337623">y</span><span class="op" id="6337624">++</span>&nbsp;<span class="op" id="6337627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337631">dBase</span>&nbsp;<span class="op" id="6337637">:=</span>&nbsp;<span class="op" id="6337640">(</span><span class="ident" id="6337641">y</span><span class="op" id="6337642">*</span><span class="ident" id="6337643">p</span><span class="op" id="6337644">.</span><span class="ident" id="6337645">yFactor</span><span class="op" id="6337652">+</span><span class="ident" id="6337653">p</span><span class="op" id="6337654">.</span><span class="ident" id="6337655">yOffset</span><span class="op" id="6337662">-</span><span class="ident" id="6337663">rect</span><span class="op" id="6337667">.</span><span class="ident" id="6337668">Min</span><span class="op" id="6337671">.</span><span class="ident" id="6337672">Y</span><span class="op" id="6337673">)</span><span class="op" id="6337674">*</span><span class="ident" id="6337675">stride</span>&nbsp;<span class="op" id="6337682">+</span>&nbsp;<span class="op" id="6337684">(</span><span class="ident" id="6337685">p</span><span class="op" id="6337686">.</span><span class="ident" id="6337687">xOffset</span><span class="op" id="6337694">-</span><span class="ident" id="6337695">rect</span><span class="op" id="6337699">.</span><span class="ident" id="6337700">Min</span><span class="op" id="6337703">.</span><span class="ident" id="6337704">X</span><span class="op" id="6337705">)</span><span class="op" id="6337706">*</span><span class="ident" id="6337707">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337723">for</span>&nbsp;<span class="ident" id="6337727">x</span>&nbsp;<span class="op" id="6337729">:=</span>&nbsp;<span class="ident" id="6337732">bounds</span><span class="op" id="6337738">.</span><span class="ident" id="6337739">Min</span><span class="op" id="6337742">.</span><span class="ident" id="6337743">X</span><span class="op" id="6337744">;</span>&nbsp;<span class="ident" id="6337746">x</span>&nbsp;<span class="op" id="6337748">&lt;</span>&nbsp;<span class="ident" id="6337750">bounds</span><span class="op" id="6337756">.</span><span class="ident" id="6337757">Max</span><span class="op" id="6337760">.</span><span class="ident" id="6337761">X</span><span class="op" id="6337762">;</span>&nbsp;<span class="ident" id="6337764">x</span><span class="op" id="6337765">++</span>&nbsp;<span class="op" id="6337768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337773">d</span>&nbsp;<span class="op" id="6337775">:=</span>&nbsp;<span class="ident" id="6337778">dBase</span>&nbsp;<span class="op" id="6337784">+</span>&nbsp;<span class="ident" id="6337786">x</span><span class="op" id="6337787">*</span><span class="ident" id="6337788">p</span><span class="op" id="6337789">.</span><span class="ident" id="6337790">xFactor</span><span class="op" id="6337797">*</span><span class="ident" id="6337798">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6337815">copy</span><span class="op" id="6337819">(</span><span class="ident" id="6337820">dstPix</span><span class="op" id="6337826">[</span><span class="ident" id="6337827">d</span><span class="op" id="6337828">:</span><span class="op" id="6337829">]</span><span class="op" id="6337830">,</span>&nbsp;<span class="ident" id="6337832">srcPix</span><span class="op" id="6337838">[</span><span class="ident" id="6337839">s</span><span class="op" id="6337840">:</span><span class="ident" id="6337841">s</span><span class="op" id="6337842">+</span><span class="ident" id="6337843">bytesPerPixel</span><span class="op" id="6337856">]</span><span class="op" id="6337857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337862">s</span>&nbsp;<span class="op" id="6337864">+=</span>&nbsp;<span class="ident" id="6337867">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337886">}</span><br>
<span class="lineno"></span><span class="op" id="6337888">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="6337891">func</span>&nbsp;<span class="op" id="6337896">(</span><span class="ident" id="6337897">d</span>&nbsp;<span class="op" id="6337899">*</span><span class="ident" id="6337900">decoder</span><span class="op" id="6337907">)</span>&nbsp;<span class="ident" id="6337909">parseIDAT</span><span class="op" id="6337918">(</span><span class="ident" id="6337919">length</span>&nbsp;<span class="builtintype" id="6337926">uint32</span><span class="op" id="6337932">)</span>&nbsp;<span class="op" id="6337934">(</span><span class="ident" id="6337935">err</span>&nbsp;<span class="builtintype" id="6337939">error</span><span class="op" id="6337944">)</span>&nbsp;<span class="op" id="6337946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337949">d</span><span class="op" id="6337950">.</span><span class="ident" id="6337951">idatLength</span>&nbsp;<span class="op" id="6337962">=</span>&nbsp;<span class="ident" id="6337964">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337972">d</span><span class="op" id="6337973">.</span><span class="ident" id="6337974">img</span><span class="op" id="6337977">,</span>&nbsp;<span class="ident" id="6337979">err</span>&nbsp;<span class="op" id="6337983">=</span>&nbsp;<span class="ident" id="6337985">d</span><span class="op" id="6337986">.</span><span class="ident" id="6337987">decode</span><span class="op" id="6337993">(</span><span class="op" id="6337994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6337997">if</span>&nbsp;<span class="ident" id="6338000">err</span>&nbsp;<span class="op" id="6338004">!=</span>&nbsp;<span class="builtintype" id="6338007">nil</span>&nbsp;<span class="op" id="6338011">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338015">return</span>&nbsp;<span class="ident" id="6338022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338030">return</span>&nbsp;<span class="ident" id="6338037">d</span><span class="op" id="6338038">.</span><span class="ident" id="6338039">verifyChecksum</span><span class="op" id="6338053">(</span><span class="op" id="6338054">)</span><br>
<span class="lineno"></span><span class="op" id="6338056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="6338059">func</span>&nbsp;<span class="op" id="6338064">(</span><span class="ident" id="6338065">d</span>&nbsp;<span class="op" id="6338067">*</span><span class="ident" id="6338068">decoder</span><span class="op" id="6338075">)</span>&nbsp;<span class="ident" id="6338077">parseIEND</span><span class="op" id="6338086">(</span><span class="ident" id="6338087">length</span>&nbsp;<span class="builtintype" id="6338094">uint32</span><span class="op" id="6338100">)</span>&nbsp;<span class="builtintype" id="6338102">error</span>&nbsp;<span class="op" id="6338108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338111">if</span>&nbsp;<span class="ident" id="6338114">length</span>&nbsp;<span class="op" id="6338121">!=</span>&nbsp;<span class="num" id="6338124">0</span>&nbsp;<span class="op" id="6338126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338130">return</span>&nbsp;<span class="ident" id="6338137">FormatError</span><span class="op" id="6338148">(</span><span class="string" id="6338149">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="6338166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338172">return</span>&nbsp;<span class="ident" id="6338179">d</span><span class="op" id="6338180">.</span><span class="ident" id="6338181">verifyChecksum</span><span class="op" id="6338195">(</span><span class="op" id="6338196">)</span><br>
<span class="lineno">660</span><span class="op" id="6338198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6338201">func</span>&nbsp;<span class="op" id="6338206">(</span><span class="ident" id="6338207">d</span>&nbsp;<span class="op" id="6338209">*</span><span class="ident" id="6338210">decoder</span><span class="op" id="6338217">)</span>&nbsp;<span class="ident" id="6338219">parseChunk</span><span class="op" id="6338229">(</span><span class="op" id="6338230">)</span>&nbsp;<span class="builtintype" id="6338232">error</span>&nbsp;<span class="op" id="6338238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6338241">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338277">n</span><span class="op" id="6338278">,</span>&nbsp;<span class="ident" id="6338280">err</span>&nbsp;<span class="op" id="6338284">:=</span>&nbsp;<span class="ident" id="6338287">io</span><span class="op" id="6338289">.</span><span class="ident" id="6338290">ReadFull</span><span class="op" id="6338298">(</span><span class="ident" id="6338299">d</span><span class="op" id="6338300">.</span><span class="ident" id="6338301">r</span><span class="op" id="6338302">,</span>&nbsp;<span class="ident" id="6338304">d</span><span class="op" id="6338305">.</span><span class="ident" id="6338306">tmp</span><span class="op" id="6338309">[</span><span class="op" id="6338310">:</span><span class="num" id="6338311">8</span><span class="op" id="6338312">]</span><span class="op" id="6338313">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338316">if</span>&nbsp;<span class="ident" id="6338319">err</span>&nbsp;<span class="op" id="6338323">!=</span>&nbsp;<span class="builtintype" id="6338326">nil</span>&nbsp;<span class="op" id="6338330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338334">return</span>&nbsp;<span class="ident" id="6338341">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338349">length</span>&nbsp;<span class="op" id="6338356">:=</span>&nbsp;<span class="ident" id="6338359">binary</span><span class="op" id="6338365">.</span><span class="ident" id="6338366">BigEndian</span><span class="op" id="6338375">.</span><span class="ident" id="6338376">Uint32</span><span class="op" id="6338382">(</span><span class="ident" id="6338383">d</span><span class="op" id="6338384">.</span><span class="ident" id="6338385">tmp</span><span class="op" id="6338388">[</span><span class="op" id="6338389">:</span><span class="num" id="6338390">4</span><span class="op" id="6338391">]</span><span class="op" id="6338392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338395">d</span><span class="op" id="6338396">.</span><span class="ident" id="6338397">crc</span><span class="op" id="6338400">.</span><span class="ident" id="6338401">Reset</span><span class="op" id="6338406">(</span><span class="op" id="6338407">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338410">d</span><span class="op" id="6338411">.</span><span class="ident" id="6338412">crc</span><span class="op" id="6338415">.</span><span class="ident" id="6338416">Write</span><span class="op" id="6338421">(</span><span class="ident" id="6338422">d</span><span class="op" id="6338423">.</span><span class="ident" id="6338424">tmp</span><span class="op" id="6338427">[</span><span class="num" id="6338428">4</span><span class="op" id="6338429">:</span><span class="num" id="6338430">8</span><span class="op" id="6338431">]</span><span class="op" id="6338432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6338436">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338461">switch</span>&nbsp;<span class="builtintype" id="6338468">string</span><span class="op" id="6338474">(</span><span class="ident" id="6338475">d</span><span class="op" id="6338476">.</span><span class="ident" id="6338477">tmp</span><span class="op" id="6338480">[</span><span class="num" id="6338481">4</span><span class="op" id="6338482">:</span><span class="num" id="6338483">8</span><span class="op" id="6338484">]</span><span class="op" id="6338485">)</span>&nbsp;<span class="op" id="6338487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338490">case</span>&nbsp;<span class="string" id="6338495">&#34;IHDR&#34;</span><span class="op" id="6338501">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338505">if</span>&nbsp;<span class="ident" id="6338508">d</span><span class="op" id="6338509">.</span><span class="ident" id="6338510">stage</span>&nbsp;<span class="op" id="6338516">!=</span>&nbsp;<span class="ident" id="6338519">dsStart</span>&nbsp;<span class="op" id="6338527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338532">return</span>&nbsp;<span class="ident" id="6338539">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338561">d</span><span class="op" id="6338562">.</span><span class="ident" id="6338563">stage</span>&nbsp;<span class="op" id="6338569">=</span>&nbsp;<span class="ident" id="6338571">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338584">return</span>&nbsp;<span class="ident" id="6338591">d</span><span class="op" id="6338592">.</span><span class="ident" id="6338593">parseIHDR</span><span class="op" id="6338602">(</span><span class="ident" id="6338603">length</span><span class="op" id="6338609">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338612">case</span>&nbsp;<span class="string" id="6338617">&#34;PLTE&#34;</span><span class="op" id="6338623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338627">if</span>&nbsp;<span class="ident" id="6338630">d</span><span class="op" id="6338631">.</span><span class="ident" id="6338632">stage</span>&nbsp;<span class="op" id="6338638">!=</span>&nbsp;<span class="ident" id="6338641">dsSeenIHDR</span>&nbsp;<span class="op" id="6338652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338657">return</span>&nbsp;<span class="ident" id="6338664">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338686">d</span><span class="op" id="6338687">.</span><span class="ident" id="6338688">stage</span>&nbsp;<span class="op" id="6338694">=</span>&nbsp;<span class="ident" id="6338696">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338709">return</span>&nbsp;<span class="ident" id="6338716">d</span><span class="op" id="6338717">.</span><span class="ident" id="6338718">parsePLTE</span><span class="op" id="6338727">(</span><span class="ident" id="6338728">length</span><span class="op" id="6338734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338737">case</span>&nbsp;<span class="string" id="6338742">&#34;tRNS&#34;</span><span class="op" id="6338748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338752">if</span>&nbsp;<span class="ident" id="6338755">d</span><span class="op" id="6338756">.</span><span class="ident" id="6338757">stage</span>&nbsp;<span class="op" id="6338763">!=</span>&nbsp;<span class="ident" id="6338766">dsSeenPLTE</span>&nbsp;<span class="op" id="6338777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338782">return</span>&nbsp;<span class="ident" id="6338789">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338807">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338811">return</span>&nbsp;<span class="ident" id="6338818">d</span><span class="op" id="6338819">.</span><span class="ident" id="6338820">parsetRNS</span><span class="op" id="6338829">(</span><span class="ident" id="6338830">length</span><span class="op" id="6338836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338839">case</span>&nbsp;<span class="string" id="6338844">&#34;IDAT&#34;</span><span class="op" id="6338850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338854">if</span>&nbsp;<span class="ident" id="6338857">d</span><span class="op" id="6338858">.</span><span class="ident" id="6338859">stage</span>&nbsp;<span class="op" id="6338865">&lt;</span>&nbsp;<span class="ident" id="6338867">dsSeenIHDR</span>&nbsp;<span class="op" id="6338878">||</span>&nbsp;<span class="ident" id="6338881">d</span><span class="op" id="6338882">.</span><span class="ident" id="6338883">stage</span>&nbsp;<span class="op" id="6338889">&gt;</span>&nbsp;<span class="ident" id="6338891">dsSeenIDAT</span>&nbsp;<span class="op" id="6338902">||</span>&nbsp;<span class="op" id="6338905">(</span><span class="ident" id="6338906">d</span><span class="op" id="6338907">.</span><span class="ident" id="6338908">cb</span>&nbsp;<span class="op" id="6338911">==</span>&nbsp;<span class="ident" id="6338914">cbP8</span>&nbsp;<span class="op" id="6338919">&amp;&amp;</span>&nbsp;<span class="ident" id="6338922">d</span><span class="op" id="6338923">.</span><span class="ident" id="6338924">stage</span>&nbsp;<span class="op" id="6338930">==</span>&nbsp;<span class="ident" id="6338933">dsSeenIHDR</span><span class="op" id="6338943">)</span>&nbsp;<span class="op" id="6338945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6338950">return</span>&nbsp;<span class="ident" id="6338957">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6338975">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6338979">d</span><span class="op" id="6338980">.</span><span class="ident" id="6338981">stage</span>&nbsp;<span class="op" id="6338987">=</span>&nbsp;<span class="ident" id="6338989">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339002">return</span>&nbsp;<span class="ident" id="6339009">d</span><span class="op" id="6339010">.</span><span class="ident" id="6339011">parseIDAT</span><span class="op" id="6339020">(</span><span class="ident" id="6339021">length</span><span class="op" id="6339027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339030">case</span>&nbsp;<span class="string" id="6339035">&#34;IEND&#34;</span><span class="op" id="6339041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339045">if</span>&nbsp;<span class="ident" id="6339048">d</span><span class="op" id="6339049">.</span><span class="ident" id="6339050">stage</span>&nbsp;<span class="op" id="6339056">!=</span>&nbsp;<span class="ident" id="6339059">dsSeenIDAT</span>&nbsp;<span class="op" id="6339070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339075">return</span>&nbsp;<span class="ident" id="6339082">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339104">d</span><span class="op" id="6339105">.</span><span class="ident" id="6339106">stage</span>&nbsp;<span class="op" id="6339112">=</span>&nbsp;<span class="ident" id="6339114">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339127">return</span>&nbsp;<span class="ident" id="6339134">d</span><span class="op" id="6339135">.</span><span class="ident" id="6339136">parseIEND</span><span class="op" id="6339145">(</span><span class="ident" id="6339146">length</span><span class="op" id="6339152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6339158">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339201">var</span>&nbsp;<span class="ident" id="6339205">ignored</span>&nbsp;<span class="op" id="6339213">[</span><span class="num" id="6339214">4096</span><span class="op" id="6339218">]</span><span class="builtintype" id="6339219">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339225">for</span>&nbsp;<span class="ident" id="6339229">length</span>&nbsp;<span class="op" id="6339236">&gt;</span>&nbsp;<span class="num" id="6339238">0</span>&nbsp;<span class="op" id="6339240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339244">n</span><span class="op" id="6339245">,</span>&nbsp;<span class="ident" id="6339247">err</span>&nbsp;<span class="op" id="6339251">=</span>&nbsp;<span class="ident" id="6339253">io</span><span class="op" id="6339255">.</span><span class="ident" id="6339256">ReadFull</span><span class="op" id="6339264">(</span><span class="ident" id="6339265">d</span><span class="op" id="6339266">.</span><span class="ident" id="6339267">r</span><span class="op" id="6339268">,</span>&nbsp;<span class="ident" id="6339270">ignored</span><span class="op" id="6339277">[</span><span class="op" id="6339278">:</span><span class="ident" id="6339279">min</span><span class="op" id="6339282">(</span><span class="builtinfunc" id="6339283">len</span><span class="op" id="6339286">(</span><span class="ident" id="6339287">ignored</span><span class="op" id="6339294">)</span><span class="op" id="6339295">,</span>&nbsp;<span class="builtintype" id="6339297">int</span><span class="op" id="6339300">(</span><span class="ident" id="6339301">length</span><span class="op" id="6339307">)</span><span class="op" id="6339308">)</span><span class="op" id="6339309">]</span><span class="op" id="6339310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339314">if</span>&nbsp;<span class="ident" id="6339317">err</span>&nbsp;<span class="op" id="6339321">!=</span>&nbsp;<span class="builtintype" id="6339324">nil</span>&nbsp;<span class="op" id="6339328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339333">return</span>&nbsp;<span class="ident" id="6339340">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339350">d</span><span class="op" id="6339351">.</span><span class="ident" id="6339352">crc</span><span class="op" id="6339355">.</span><span class="ident" id="6339356">Write</span><span class="op" id="6339361">(</span><span class="ident" id="6339362">ignored</span><span class="op" id="6339369">[</span><span class="op" id="6339370">:</span><span class="ident" id="6339371">n</span><span class="op" id="6339372">]</span><span class="op" id="6339373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339377">length</span>&nbsp;<span class="op" id="6339384">-=</span>&nbsp;<span class="builtintype" id="6339387">uint32</span><span class="op" id="6339393">(</span><span class="ident" id="6339394">n</span><span class="op" id="6339395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339401">return</span>&nbsp;<span class="ident" id="6339408">d</span><span class="op" id="6339409">.</span><span class="ident" id="6339410">verifyChecksum</span><span class="op" id="6339424">(</span><span class="op" id="6339425">)</span><br>
<span class="lineno">715</span><span class="op" id="6339427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339430">func</span>&nbsp;<span class="op" id="6339435">(</span><span class="ident" id="6339436">d</span>&nbsp;<span class="op" id="6339438">*</span><span class="ident" id="6339439">decoder</span><span class="op" id="6339446">)</span>&nbsp;<span class="ident" id="6339448">verifyChecksum</span><span class="op" id="6339462">(</span><span class="op" id="6339463">)</span>&nbsp;<span class="builtintype" id="6339465">error</span>&nbsp;<span class="op" id="6339471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339474">if</span>&nbsp;<span class="ident" id="6339477">_</span><span class="op" id="6339478">,</span>&nbsp;<span class="ident" id="6339480">err</span>&nbsp;<span class="op" id="6339484">:=</span>&nbsp;<span class="ident" id="6339487">io</span><span class="op" id="6339489">.</span><span class="ident" id="6339490">ReadFull</span><span class="op" id="6339498">(</span><span class="ident" id="6339499">d</span><span class="op" id="6339500">.</span><span class="ident" id="6339501">r</span><span class="op" id="6339502">,</span>&nbsp;<span class="ident" id="6339504">d</span><span class="op" id="6339505">.</span><span class="ident" id="6339506">tmp</span><span class="op" id="6339509">[</span><span class="op" id="6339510">:</span><span class="num" id="6339511">4</span><span class="op" id="6339512">]</span><span class="op" id="6339513">)</span><span class="op" id="6339514">;</span>&nbsp;<span class="ident" id="6339516">err</span>&nbsp;<span class="op" id="6339520">!=</span>&nbsp;<span class="builtintype" id="6339523">nil</span>&nbsp;<span class="op" id="6339527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339531">return</span>&nbsp;<span class="ident" id="6339538">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339546">if</span>&nbsp;<span class="ident" id="6339549">binary</span><span class="op" id="6339555">.</span><span class="ident" id="6339556">BigEndian</span><span class="op" id="6339565">.</span><span class="ident" id="6339566">Uint32</span><span class="op" id="6339572">(</span><span class="ident" id="6339573">d</span><span class="op" id="6339574">.</span><span class="ident" id="6339575">tmp</span><span class="op" id="6339578">[</span><span class="op" id="6339579">:</span><span class="num" id="6339580">4</span><span class="op" id="6339581">]</span><span class="op" id="6339582">)</span>&nbsp;<span class="op" id="6339584">!=</span>&nbsp;<span class="ident" id="6339587">d</span><span class="op" id="6339588">.</span><span class="ident" id="6339589">crc</span><span class="op" id="6339592">.</span><span class="ident" id="6339593">Sum32</span><span class="op" id="6339598">(</span><span class="op" id="6339599">)</span>&nbsp;<span class="op" id="6339601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339605">return</span>&nbsp;<span class="ident" id="6339612">FormatError</span><span class="op" id="6339623">(</span><span class="string" id="6339624">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6339642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339648">return</span>&nbsp;<span class="builtintype" id="6339655">nil</span><br>
<span class="lineno">725</span><span class="op" id="6339659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339662">func</span>&nbsp;<span class="op" id="6339667">(</span><span class="ident" id="6339668">d</span>&nbsp;<span class="op" id="6339670">*</span><span class="ident" id="6339671">decoder</span><span class="op" id="6339678">)</span>&nbsp;<span class="ident" id="6339680">checkHeader</span><span class="op" id="6339691">(</span><span class="op" id="6339692">)</span>&nbsp;<span class="builtintype" id="6339694">error</span>&nbsp;<span class="op" id="6339700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339703">_</span><span class="op" id="6339704">,</span>&nbsp;<span class="ident" id="6339706">err</span>&nbsp;<span class="op" id="6339710">:=</span>&nbsp;<span class="ident" id="6339713">io</span><span class="op" id="6339715">.</span><span class="ident" id="6339716">ReadFull</span><span class="op" id="6339724">(</span><span class="ident" id="6339725">d</span><span class="op" id="6339726">.</span><span class="ident" id="6339727">r</span><span class="op" id="6339728">,</span>&nbsp;<span class="ident" id="6339730">d</span><span class="op" id="6339731">.</span><span class="ident" id="6339732">tmp</span><span class="op" id="6339735">[</span><span class="op" id="6339736">:</span><span class="builtinfunc" id="6339737">len</span><span class="op" id="6339740">(</span><span class="ident" id="6339741">pngHeader</span><span class="op" id="6339750">)</span><span class="op" id="6339751">]</span><span class="op" id="6339752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339755">if</span>&nbsp;<span class="ident" id="6339758">err</span>&nbsp;<span class="op" id="6339762">!=</span>&nbsp;<span class="builtintype" id="6339765">nil</span>&nbsp;<span class="op" id="6339769">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339773">return</span>&nbsp;<span class="ident" id="6339780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339788">if</span>&nbsp;<span class="builtintype" id="6339791">string</span><span class="op" id="6339797">(</span><span class="ident" id="6339798">d</span><span class="op" id="6339799">.</span><span class="ident" id="6339800">tmp</span><span class="op" id="6339803">[</span><span class="op" id="6339804">:</span><span class="builtinfunc" id="6339805">len</span><span class="op" id="6339808">(</span><span class="ident" id="6339809">pngHeader</span><span class="op" id="6339818">)</span><span class="op" id="6339819">]</span><span class="op" id="6339820">)</span>&nbsp;<span class="op" id="6339822">!=</span>&nbsp;<span class="ident" id="6339825">pngHeader</span>&nbsp;<span class="op" id="6339835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339839">return</span>&nbsp;<span class="ident" id="6339846">FormatError</span><span class="op" id="6339857">(</span><span class="string" id="6339858">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="6339874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6339877">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6339880">return</span>&nbsp;<span class="builtintype" id="6339887">nil</span><br>
<span class="lineno"></span><span class="op" id="6339891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6339894">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="6339963">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="6340022">func</span>&nbsp;<span class="ident" id="6340027">Decode</span><span class="op" id="6340033">(</span><span class="ident" id="6340034">r</span>&nbsp;<span class="ident" id="6340036">io</span><span class="op" id="6340038">.</span><span class="ident" id="6340039">Reader</span><span class="op" id="6340045">)</span>&nbsp;<span class="op" id="6340047">(</span><span class="ident" id="6340048">image</span><span class="op" id="6340053">.</span><span class="ident" id="6340054">Image</span><span class="op" id="6340059">,</span>&nbsp;<span class="builtintype" id="6340061">error</span><span class="op" id="6340066">)</span>&nbsp;<span class="op" id="6340068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340071">d</span>&nbsp;<span class="op" id="6340073">:=</span>&nbsp;<span class="op" id="6340076">&amp;</span><span class="ident" id="6340077">decoder</span><span class="op" id="6340084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340088">r</span><span class="op" id="6340089">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6340093">r</span><span class="op" id="6340094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340098">crc</span><span class="op" id="6340101">:</span>&nbsp;<span class="ident" id="6340103">crc32</span><span class="op" id="6340108">.</span><span class="ident" id="6340109">NewIEEE</span><span class="op" id="6340116">(</span><span class="op" id="6340117">)</span><span class="op" id="6340118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340121">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340124">if</span>&nbsp;<span class="ident" id="6340127">err</span>&nbsp;<span class="op" id="6340131">:=</span>&nbsp;<span class="ident" id="6340134">d</span><span class="op" id="6340135">.</span><span class="ident" id="6340136">checkHeader</span><span class="op" id="6340147">(</span><span class="op" id="6340148">)</span><span class="op" id="6340149">;</span>&nbsp;<span class="ident" id="6340151">err</span>&nbsp;<span class="op" id="6340155">!=</span>&nbsp;<span class="builtintype" id="6340158">nil</span>&nbsp;<span class="op" id="6340162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340166">if</span>&nbsp;<span class="ident" id="6340169">err</span>&nbsp;<span class="op" id="6340173">==</span>&nbsp;<span class="ident" id="6340176">io</span><span class="op" id="6340178">.</span><span class="ident" id="6340179">EOF</span>&nbsp;<span class="op" id="6340183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340188">err</span>&nbsp;<span class="op" id="6340192">=</span>&nbsp;<span class="ident" id="6340194">io</span><span class="op" id="6340196">.</span><span class="ident" id="6340197">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340220">return</span>&nbsp;<span class="builtintype" id="6340227">nil</span><span class="op" id="6340230">,</span>&nbsp;<span class="ident" id="6340232">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340240">for</span>&nbsp;<span class="ident" id="6340244">d</span><span class="op" id="6340245">.</span><span class="ident" id="6340246">stage</span>&nbsp;<span class="op" id="6340252">!=</span>&nbsp;<span class="ident" id="6340255">dsSeenIEND</span>&nbsp;<span class="op" id="6340266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340270">if</span>&nbsp;<span class="ident" id="6340273">err</span>&nbsp;<span class="op" id="6340277">:=</span>&nbsp;<span class="ident" id="6340280">d</span><span class="op" id="6340281">.</span><span class="ident" id="6340282">parseChunk</span><span class="op" id="6340292">(</span><span class="op" id="6340293">)</span><span class="op" id="6340294">;</span>&nbsp;<span class="ident" id="6340296">err</span>&nbsp;<span class="op" id="6340300">!=</span>&nbsp;<span class="builtintype" id="6340303">nil</span>&nbsp;<span class="op" id="6340307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340312">if</span>&nbsp;<span class="ident" id="6340315">err</span>&nbsp;<span class="op" id="6340319">==</span>&nbsp;<span class="ident" id="6340322">io</span><span class="op" id="6340324">.</span><span class="ident" id="6340325">EOF</span>&nbsp;<span class="op" id="6340329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340335">err</span>&nbsp;<span class="op" id="6340339">=</span>&nbsp;<span class="ident" id="6340341">io</span><span class="op" id="6340343">.</span><span class="ident" id="6340344">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340369">return</span>&nbsp;<span class="builtintype" id="6340376">nil</span><span class="op" id="6340379">,</span>&nbsp;<span class="ident" id="6340381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340393">return</span>&nbsp;<span class="ident" id="6340400">d</span><span class="op" id="6340401">.</span><span class="ident" id="6340402">img</span><span class="op" id="6340405">,</span>&nbsp;<span class="builtintype" id="6340407">nil</span><br>
<span class="lineno">760</span><span class="op" id="6340411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6340414">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6340492">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6340522">func</span>&nbsp;<span class="ident" id="6340527">DecodeConfig</span><span class="op" id="6340539">(</span><span class="ident" id="6340540">r</span>&nbsp;<span class="ident" id="6340542">io</span><span class="op" id="6340544">.</span><span class="ident" id="6340545">Reader</span><span class="op" id="6340551">)</span>&nbsp;<span class="op" id="6340553">(</span><span class="ident" id="6340554">image</span><span class="op" id="6340559">.</span><span class="ident" id="6340560">Config</span><span class="op" id="6340566">,</span>&nbsp;<span class="builtintype" id="6340568">error</span><span class="op" id="6340573">)</span>&nbsp;<span class="op" id="6340575">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340578">d</span>&nbsp;<span class="op" id="6340580">:=</span>&nbsp;<span class="op" id="6340583">&amp;</span><span class="ident" id="6340584">decoder</span><span class="op" id="6340591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340595">r</span><span class="op" id="6340596">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6340600">r</span><span class="op" id="6340601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340605">crc</span><span class="op" id="6340608">:</span>&nbsp;<span class="ident" id="6340610">crc32</span><span class="op" id="6340615">.</span><span class="ident" id="6340616">NewIEEE</span><span class="op" id="6340623">(</span><span class="op" id="6340624">)</span><span class="op" id="6340625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340631">if</span>&nbsp;<span class="ident" id="6340634">err</span>&nbsp;<span class="op" id="6340638">:=</span>&nbsp;<span class="ident" id="6340641">d</span><span class="op" id="6340642">.</span><span class="ident" id="6340643">checkHeader</span><span class="op" id="6340654">(</span><span class="op" id="6340655">)</span><span class="op" id="6340656">;</span>&nbsp;<span class="ident" id="6340658">err</span>&nbsp;<span class="op" id="6340662">!=</span>&nbsp;<span class="builtintype" id="6340665">nil</span>&nbsp;<span class="op" id="6340669">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340673">if</span>&nbsp;<span class="ident" id="6340676">err</span>&nbsp;<span class="op" id="6340680">==</span>&nbsp;<span class="ident" id="6340683">io</span><span class="op" id="6340685">.</span><span class="ident" id="6340686">EOF</span>&nbsp;<span class="op" id="6340690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340695">err</span>&nbsp;<span class="op" id="6340699">=</span>&nbsp;<span class="ident" id="6340701">io</span><span class="op" id="6340703">.</span><span class="ident" id="6340704">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340727">return</span>&nbsp;<span class="ident" id="6340734">image</span><span class="op" id="6340739">.</span><span class="ident" id="6340740">Config</span><span class="op" id="6340746">{</span><span class="op" id="6340747">}</span><span class="op" id="6340748">,</span>&nbsp;<span class="ident" id="6340750">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340755">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340758">for</span>&nbsp;<span class="op" id="6340762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340766">if</span>&nbsp;<span class="ident" id="6340769">err</span>&nbsp;<span class="op" id="6340773">:=</span>&nbsp;<span class="ident" id="6340776">d</span><span class="op" id="6340777">.</span><span class="ident" id="6340778">parseChunk</span><span class="op" id="6340788">(</span><span class="op" id="6340789">)</span><span class="op" id="6340790">;</span>&nbsp;<span class="ident" id="6340792">err</span>&nbsp;<span class="op" id="6340796">!=</span>&nbsp;<span class="builtintype" id="6340799">nil</span>&nbsp;<span class="op" id="6340803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340808">if</span>&nbsp;<span class="ident" id="6340811">err</span>&nbsp;<span class="op" id="6340815">==</span>&nbsp;<span class="ident" id="6340818">io</span><span class="op" id="6340820">.</span><span class="ident" id="6340821">EOF</span>&nbsp;<span class="op" id="6340825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340831">err</span>&nbsp;<span class="op" id="6340835">=</span>&nbsp;<span class="ident" id="6340837">io</span><span class="op" id="6340839">.</span><span class="ident" id="6340840">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340860">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340865">return</span>&nbsp;<span class="ident" id="6340872">image</span><span class="op" id="6340877">.</span><span class="ident" id="6340878">Config</span><span class="op" id="6340884">{</span><span class="op" id="6340885">}</span><span class="op" id="6340886">,</span>&nbsp;<span class="ident" id="6340888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6340894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6340898">paletted</span>&nbsp;<span class="op" id="6340907">:=</span>&nbsp;<span class="ident" id="6340910">d</span><span class="op" id="6340911">.</span><span class="ident" id="6340912">cb</span>&nbsp;<span class="op" id="6340915">==</span>&nbsp;<span class="ident" id="6340918">cbP8</span>&nbsp;<span class="op" id="6340923">||</span>&nbsp;<span class="ident" id="6340926">d</span><span class="op" id="6340927">.</span><span class="ident" id="6340928">cb</span>&nbsp;<span class="op" id="6340931">==</span>&nbsp;<span class="ident" id="6340934">cbP4</span>&nbsp;<span class="op" id="6340939">||</span>&nbsp;<span class="ident" id="6340942">d</span><span class="op" id="6340943">.</span><span class="ident" id="6340944">cb</span>&nbsp;<span class="op" id="6340947">==</span>&nbsp;<span class="ident" id="6340950">cbP2</span>&nbsp;<span class="op" id="6340955">||</span>&nbsp;<span class="ident" id="6340958">d</span><span class="op" id="6340959">.</span><span class="ident" id="6340960">cb</span>&nbsp;<span class="op" id="6340963">==</span>&nbsp;<span class="ident" id="6340966">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6340973">if</span>&nbsp;<span class="ident" id="6340976">d</span><span class="op" id="6340977">.</span><span class="ident" id="6340978">stage</span>&nbsp;<span class="op" id="6340984">==</span>&nbsp;<span class="ident" id="6340987">dsSeenIHDR</span>&nbsp;<span class="op" id="6340998">&amp;&amp;</span>&nbsp;<span class="op" id="6341001">!</span><span class="ident" id="6341002">paletted</span>&nbsp;<span class="op" id="6341011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341016">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341028">if</span>&nbsp;<span class="ident" id="6341031">d</span><span class="op" id="6341032">.</span><span class="ident" id="6341033">stage</span>&nbsp;<span class="op" id="6341039">==</span>&nbsp;<span class="ident" id="6341042">dsSeenPLTE</span>&nbsp;<span class="op" id="6341053">&amp;&amp;</span>&nbsp;<span class="ident" id="6341056">paletted</span>&nbsp;<span class="op" id="6341065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341070">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341081">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341084">var</span>&nbsp;<span class="ident" id="6341088">cm</span>&nbsp;<span class="ident" id="6341091">color</span><span class="op" id="6341096">.</span><span class="ident" id="6341097">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341104">switch</span>&nbsp;<span class="ident" id="6341111">d</span><span class="op" id="6341112">.</span><span class="ident" id="6341113">cb</span>&nbsp;<span class="op" id="6341116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341119">case</span>&nbsp;<span class="ident" id="6341124">cbG1</span><span class="op" id="6341128">,</span>&nbsp;<span class="ident" id="6341130">cbG2</span><span class="op" id="6341134">,</span>&nbsp;<span class="ident" id="6341136">cbG4</span><span class="op" id="6341140">,</span>&nbsp;<span class="ident" id="6341142">cbG8</span><span class="op" id="6341146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341150">cm</span>&nbsp;<span class="op" id="6341153">=</span>&nbsp;<span class="ident" id="6341155">color</span><span class="op" id="6341160">.</span><span class="ident" id="6341161">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341172">case</span>&nbsp;<span class="ident" id="6341177">cbGA8</span><span class="op" id="6341182">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341186">cm</span>&nbsp;<span class="op" id="6341189">=</span>&nbsp;<span class="ident" id="6341191">color</span><span class="op" id="6341196">.</span><span class="ident" id="6341197">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341209">case</span>&nbsp;<span class="ident" id="6341214">cbTC8</span><span class="op" id="6341219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341223">cm</span>&nbsp;<span class="op" id="6341226">=</span>&nbsp;<span class="ident" id="6341228">color</span><span class="op" id="6341233">.</span><span class="ident" id="6341234">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341245">case</span>&nbsp;<span class="ident" id="6341250">cbP1</span><span class="op" id="6341254">,</span>&nbsp;<span class="ident" id="6341256">cbP2</span><span class="op" id="6341260">,</span>&nbsp;<span class="ident" id="6341262">cbP4</span><span class="op" id="6341266">,</span>&nbsp;<span class="ident" id="6341268">cbP8</span><span class="op" id="6341272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341276">cm</span>&nbsp;<span class="op" id="6341279">=</span>&nbsp;<span class="ident" id="6341281">d</span><span class="op" id="6341282">.</span><span class="ident" id="6341283">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341292">case</span>&nbsp;<span class="ident" id="6341297">cbTCA8</span><span class="op" id="6341303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341307">cm</span>&nbsp;<span class="op" id="6341310">=</span>&nbsp;<span class="ident" id="6341312">color</span><span class="op" id="6341317">.</span><span class="ident" id="6341318">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341330">case</span>&nbsp;<span class="ident" id="6341335">cbG16</span><span class="op" id="6341340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341344">cm</span>&nbsp;<span class="op" id="6341347">=</span>&nbsp;<span class="ident" id="6341349">color</span><span class="op" id="6341354">.</span><span class="ident" id="6341355">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341368">case</span>&nbsp;<span class="ident" id="6341373">cbGA16</span><span class="op" id="6341379">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341383">cm</span>&nbsp;<span class="op" id="6341386">=</span>&nbsp;<span class="ident" id="6341388">color</span><span class="op" id="6341393">.</span><span class="ident" id="6341394">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341408">case</span>&nbsp;<span class="ident" id="6341413">cbTC16</span><span class="op" id="6341419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341423">cm</span>&nbsp;<span class="op" id="6341426">=</span>&nbsp;<span class="ident" id="6341428">color</span><span class="op" id="6341433">.</span><span class="ident" id="6341434">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341447">case</span>&nbsp;<span class="ident" id="6341452">cbTCA16</span><span class="op" id="6341459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341463">cm</span>&nbsp;<span class="op" id="6341466">=</span>&nbsp;<span class="ident" id="6341468">color</span><span class="op" id="6341473">.</span><span class="ident" id="6341474">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6341491">return</span>&nbsp;<span class="ident" id="6341498">image</span><span class="op" id="6341503">.</span><span class="ident" id="6341504">Config</span><span class="op" id="6341510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341514">ColorModel</span><span class="op" id="6341524">:</span>&nbsp;<span class="ident" id="6341526">cm</span><span class="op" id="6341528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341532">Width</span><span class="op" id="6341537">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341544">d</span><span class="op" id="6341545">.</span><span class="ident" id="6341546">width</span><span class="op" id="6341551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341555">Height</span><span class="op" id="6341561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341567">d</span><span class="op" id="6341568">.</span><span class="ident" id="6341569">height</span><span class="op" id="6341575">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341578">}</span><span class="op" id="6341579">,</span>&nbsp;<span class="builtintype" id="6341581">nil</span><br>
<span class="lineno"></span><span class="op" id="6341585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6341588">func</span>&nbsp;<span class="ident" id="6341593">init</span><span class="op" id="6341597">(</span><span class="op" id="6341598">)</span>&nbsp;<span class="op" id="6341600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6341603">image</span><span class="op" id="6341608">.</span><span class="ident" id="6341609">RegisterFormat</span><span class="op" id="6341623">(</span><span class="string" id="6341624">&#34;png&#34;</span><span class="op" id="6341629">,</span>&nbsp;<span class="ident" id="6341631">pngHeader</span><span class="op" id="6341640">,</span>&nbsp;<span class="ident" id="6341642">Decode</span><span class="op" id="6341648">,</span>&nbsp;<span class="ident" id="6341650">DecodeConfig</span><span class="op" id="6341662">)</span><br>
<span class="lineno">820</span><span class="op" id="6341664">}</span>
</div>
</body>
</html>
