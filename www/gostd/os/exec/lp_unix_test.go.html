<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7486820">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7486876">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7486930">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7486981">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7487046">package</span>&nbsp;<span class="ident" id="7487054">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7487060">import</span>&nbsp;<span class="op" id="7487067">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7487070">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7487083">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7487089">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7487099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7487102">func</span>&nbsp;<span class="ident" id="7487107">TestLookPathUnixEmptyPath</span><span class="op" id="7487132">(</span><span class="ident" id="7487133">t</span>&nbsp;<span class="op" id="7487135">*</span><span class="ident" id="7487136">testing</span><span class="op" id="7487143">.</span><span class="ident" id="7487144">T</span><span class="op" id="7487145">)</span>&nbsp;<span class="op" id="7487147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487150">tmp</span><span class="op" id="7487153">,</span>&nbsp;<span class="ident" id="7487155">err</span>&nbsp;<span class="op" id="7487159">:=</span>&nbsp;<span class="ident" id="7487162">ioutil</span><span class="op" id="7487168">.</span><span class="ident" id="7487169">TempDir</span><span class="op" id="7487176">(</span><span class="string" id="7487177">&#34;&#34;</span><span class="op" id="7487179">,</span>&nbsp;<span class="string" id="7487181">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7487208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487211">if</span>&nbsp;<span class="ident" id="7487214">err</span>&nbsp;<span class="op" id="7487218">!=</span>&nbsp;<span class="ident" id="7487221">nil</span>&nbsp;<span class="op" id="7487225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487229">t</span><span class="op" id="7487230">.</span><span class="ident" id="7487231">Fatal</span><span class="op" id="7487236">(</span><span class="string" id="7487237">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487255">,</span>&nbsp;<span class="ident" id="7487257">err</span><span class="op" id="7487260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487263">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487266">defer</span>&nbsp;<span class="ident" id="7487272">os</span><span class="op" id="7487274">.</span><span class="ident" id="7487275">RemoveAll</span><span class="op" id="7487284">(</span><span class="ident" id="7487285">tmp</span><span class="op" id="7487288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487291">wd</span><span class="op" id="7487293">,</span>&nbsp;<span class="ident" id="7487295">err</span>&nbsp;<span class="op" id="7487299">:=</span>&nbsp;<span class="ident" id="7487302">os</span><span class="op" id="7487304">.</span><span class="ident" id="7487305">Getwd</span><span class="op" id="7487310">(</span><span class="op" id="7487311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487314">if</span>&nbsp;<span class="ident" id="7487317">err</span>&nbsp;<span class="op" id="7487321">!=</span>&nbsp;<span class="ident" id="7487324">nil</span>&nbsp;<span class="op" id="7487328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487332">t</span><span class="op" id="7487333">.</span><span class="ident" id="7487334">Fatal</span><span class="op" id="7487339">(</span><span class="string" id="7487340">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487356">,</span>&nbsp;<span class="ident" id="7487358">err</span><span class="op" id="7487361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487364">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487367">err</span>&nbsp;<span class="op" id="7487371">=</span>&nbsp;<span class="ident" id="7487373">os</span><span class="op" id="7487375">.</span><span class="ident" id="7487376">Chdir</span><span class="op" id="7487381">(</span><span class="ident" id="7487382">tmp</span><span class="op" id="7487385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487388">if</span>&nbsp;<span class="ident" id="7487391">err</span>&nbsp;<span class="op" id="7487395">!=</span>&nbsp;<span class="ident" id="7487398">nil</span>&nbsp;<span class="op" id="7487402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487406">t</span><span class="op" id="7487407">.</span><span class="ident" id="7487408">Fatal</span><span class="op" id="7487413">(</span><span class="string" id="7487414">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487430">,</span>&nbsp;<span class="ident" id="7487432">err</span><span class="op" id="7487435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487441">defer</span>&nbsp;<span class="ident" id="7487447">os</span><span class="op" id="7487449">.</span><span class="ident" id="7487450">Chdir</span><span class="op" id="7487455">(</span><span class="ident" id="7487456">wd</span><span class="op" id="7487458">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487462">f</span><span class="op" id="7487463">,</span>&nbsp;<span class="ident" id="7487465">err</span>&nbsp;<span class="op" id="7487469">:=</span>&nbsp;<span class="ident" id="7487472">os</span><span class="op" id="7487474">.</span><span class="ident" id="7487475">OpenFile</span><span class="op" id="7487483">(</span><span class="string" id="7487484">&#34;exec_me&#34;</span><span class="op" id="7487493">,</span>&nbsp;<span class="ident" id="7487495">os</span><span class="op" id="7487497">.</span><span class="ident" id="7487498">O_CREATE</span><span class="op" id="7487506">|</span><span class="ident" id="7487507">os</span><span class="op" id="7487509">.</span><span class="ident" id="7487510">O_EXCL</span><span class="op" id="7487516">,</span>&nbsp;<span class="num" id="7487518">0700</span><span class="op" id="7487522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487525">if</span>&nbsp;<span class="ident" id="7487528">err</span>&nbsp;<span class="op" id="7487532">!=</span>&nbsp;<span class="ident" id="7487535">nil</span>&nbsp;<span class="op" id="7487539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487543">t</span><span class="op" id="7487544">.</span><span class="ident" id="7487545">Fatal</span><span class="op" id="7487550">(</span><span class="string" id="7487551">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487570">,</span>&nbsp;<span class="ident" id="7487572">err</span><span class="op" id="7487575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487578">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487581">err</span>&nbsp;<span class="op" id="7487585">=</span>&nbsp;<span class="ident" id="7487587">f</span><span class="op" id="7487588">.</span><span class="ident" id="7487589">Close</span><span class="op" id="7487594">(</span><span class="op" id="7487595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487598">if</span>&nbsp;<span class="ident" id="7487601">err</span>&nbsp;<span class="op" id="7487605">!=</span>&nbsp;<span class="ident" id="7487608">nil</span>&nbsp;<span class="op" id="7487612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487616">t</span><span class="op" id="7487617">.</span><span class="ident" id="7487618">Fatal</span><span class="op" id="7487623">(</span><span class="string" id="7487624">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487640">,</span>&nbsp;<span class="ident" id="7487642">err</span><span class="op" id="7487645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487652">pathenv</span>&nbsp;<span class="op" id="7487660">:=</span>&nbsp;<span class="ident" id="7487663">os</span><span class="op" id="7487665">.</span><span class="ident" id="7487666">Getenv</span><span class="op" id="7487672">(</span><span class="string" id="7487673">&#34;PATH&#34;</span><span class="op" id="7487679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487682">defer</span>&nbsp;<span class="ident" id="7487688">os</span><span class="op" id="7487690">.</span><span class="ident" id="7487691">Setenv</span><span class="op" id="7487697">(</span><span class="string" id="7487698">&#34;PATH&#34;</span><span class="op" id="7487704">,</span>&nbsp;<span class="ident" id="7487706">pathenv</span><span class="op" id="7487713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487717">err</span>&nbsp;<span class="op" id="7487721">=</span>&nbsp;<span class="ident" id="7487723">os</span><span class="op" id="7487725">.</span><span class="ident" id="7487726">Setenv</span><span class="op" id="7487732">(</span><span class="string" id="7487733">&#34;PATH&#34;</span><span class="op" id="7487739">,</span>&nbsp;<span class="string" id="7487741">&#34;&#34;</span><span class="op" id="7487743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487746">if</span>&nbsp;<span class="ident" id="7487749">err</span>&nbsp;<span class="op" id="7487753">!=</span>&nbsp;<span class="ident" id="7487756">nil</span>&nbsp;<span class="op" id="7487760">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487764">t</span><span class="op" id="7487765">.</span><span class="ident" id="7487766">Fatal</span><span class="op" id="7487771">(</span><span class="string" id="7487772">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7487789">,</span>&nbsp;<span class="ident" id="7487791">err</span><span class="op" id="7487794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487801">path</span><span class="op" id="7487805">,</span>&nbsp;<span class="ident" id="7487807">err</span>&nbsp;<span class="op" id="7487811">:=</span>&nbsp;<span class="ident" id="7487814">LookPath</span><span class="op" id="7487822">(</span><span class="string" id="7487823">&#34;exec_me&#34;</span><span class="op" id="7487832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487835">if</span>&nbsp;<span class="ident" id="7487838">err</span>&nbsp;<span class="op" id="7487842">==</span>&nbsp;<span class="ident" id="7487845">nil</span>&nbsp;<span class="op" id="7487849">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487853">t</span><span class="op" id="7487854">.</span><span class="ident" id="7487855">Fatal</span><span class="op" id="7487860">(</span><span class="string" id="7487861">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7487900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487906">if</span>&nbsp;<span class="ident" id="7487909">path</span>&nbsp;<span class="op" id="7487914">!=</span>&nbsp;<span class="string" id="7487917">&#34;&#34;</span>&nbsp;<span class="op" id="7487920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487924">t</span><span class="op" id="7487925">.</span><span class="ident" id="7487926">Fatalf</span><span class="op" id="7487932">(</span><span class="string" id="7487933">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7487970">,</span>&nbsp;<span class="ident" id="7487972">path</span><span class="op" id="7487976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487979">}</span><br>
<span class="lineno">55</span><span class="op" id="7487981">}</span>
</div>
</body>
</html>
