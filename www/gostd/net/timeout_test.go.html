<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7901624">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7901679">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7901733">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7901784">package</span>&nbsp;<span class="ident" id="7901792">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7901797">import</span>&nbsp;<span class="op" id="7901804">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901807">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901814">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901820">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901833">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901844">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7901855">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7901862">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7901865">func</span>&nbsp;<span class="ident" id="7901870">isTimeout</span><span class="op" id="7901879">(</span><span class="ident" id="7901880">err</span>&nbsp;<span class="builtintype" id="7901884">error</span><span class="op" id="7901889">)</span>&nbsp;<span class="builtintype" id="7901891">bool</span>&nbsp;<span class="op" id="7901896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901899">e</span><span class="op" id="7901900">,</span>&nbsp;<span class="ident" id="7901902">ok</span>&nbsp;<span class="op" id="7901905">:=</span>&nbsp;<span class="ident" id="7901908">err</span><span class="op" id="7901911">.</span><span class="op" id="7901912">(</span><span class="ident" id="7901913">Error</span><span class="op" id="7901918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901921">return</span>&nbsp;<span class="ident" id="7901928">ok</span>&nbsp;<span class="op" id="7901931">&amp;&amp;</span>&nbsp;<span class="ident" id="7901934">e</span><span class="op" id="7901935">.</span><span class="ident" id="7901936">Timeout</span><span class="op" id="7901943">(</span><span class="op" id="7901944">)</span><br>
<span class="lineno"></span><span class="op" id="7901946">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7901949">type</span>&nbsp;<span class="ident" id="7901954">copyRes</span>&nbsp;<span class="keyword" id="7901962">struct</span>&nbsp;<span class="op" id="7901969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901972">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7901976">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901983">err</span>&nbsp;<span class="builtintype" id="7901987">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901994">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7901998">time</span><span class="op" id="7902002">.</span><span class="ident" id="7902003">Duration</span><br>
<span class="lineno">25</span><span class="op" id="7902012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7902015">func</span>&nbsp;<span class="ident" id="7902020">TestAcceptTimeout</span><span class="op" id="7902037">(</span><span class="ident" id="7902038">t</span>&nbsp;<span class="op" id="7902040">*</span><span class="ident" id="7902041">testing</span><span class="op" id="7902048">.</span><span class="ident" id="7902049">T</span><span class="op" id="7902050">)</span>&nbsp;<span class="op" id="7902052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902055">switch</span>&nbsp;<span class="ident" id="7902062">runtime</span><span class="op" id="7902069">.</span><span class="ident" id="7902070">GOOS</span>&nbsp;<span class="op" id="7902075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902078">case</span>&nbsp;<span class="string" id="7902083">&#34;plan9&#34;</span><span class="op" id="7902090">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902094">t</span><span class="op" id="7902095">.</span><span class="ident" id="7902096">Skipf</span><span class="op" id="7902101">(</span><span class="string" id="7902102">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7902123">,</span>&nbsp;<span class="ident" id="7902125">runtime</span><span class="op" id="7902132">.</span><span class="ident" id="7902133">GOOS</span><span class="op" id="7902137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902144">ln</span>&nbsp;<span class="op" id="7902147">:=</span>&nbsp;<span class="ident" id="7902150">newLocalListener</span><span class="op" id="7902166">(</span><span class="ident" id="7902167">t</span><span class="op" id="7902168">)</span><span class="op" id="7902169">.</span><span class="op" id="7902170">(</span><span class="op" id="7902171">*</span><span class="ident" id="7902172">TCPListener</span><span class="op" id="7902183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902186">defer</span>&nbsp;<span class="ident" id="7902192">ln</span><span class="op" id="7902194">.</span><span class="ident" id="7902195">Close</span><span class="op" id="7902200">(</span><span class="op" id="7902201">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902204">ln</span><span class="op" id="7902206">.</span><span class="ident" id="7902207">SetDeadline</span><span class="op" id="7902218">(</span><span class="ident" id="7902219">time</span><span class="op" id="7902223">.</span><span class="ident" id="7902224">Now</span><span class="op" id="7902227">(</span><span class="op" id="7902228">)</span><span class="op" id="7902229">.</span><span class="ident" id="7902230">Add</span><span class="op" id="7902233">(</span><span class="op" id="7902234">-</span><span class="num" id="7902235">1</span>&nbsp;<span class="op" id="7902237">*</span>&nbsp;<span class="ident" id="7902239">time</span><span class="op" id="7902243">.</span><span class="ident" id="7902244">Second</span><span class="op" id="7902250">)</span><span class="op" id="7902251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902254">if</span>&nbsp;<span class="ident" id="7902257">_</span><span class="op" id="7902258">,</span>&nbsp;<span class="ident" id="7902260">err</span>&nbsp;<span class="op" id="7902264">:=</span>&nbsp;<span class="ident" id="7902267">ln</span><span class="op" id="7902269">.</span><span class="ident" id="7902270">Accept</span><span class="op" id="7902276">(</span><span class="op" id="7902277">)</span><span class="op" id="7902278">;</span>&nbsp;<span class="op" id="7902280">!</span><span class="ident" id="7902281">isTimeout</span><span class="op" id="7902290">(</span><span class="ident" id="7902291">err</span><span class="op" id="7902294">)</span>&nbsp;<span class="op" id="7902296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902300">t</span><span class="op" id="7902301">.</span><span class="ident" id="7902302">Fatalf</span><span class="op" id="7902308">(</span><span class="string" id="7902309">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7902342">,</span>&nbsp;<span class="ident" id="7902344">errTimeout</span><span class="op" id="7902354">,</span>&nbsp;<span class="ident" id="7902356">err</span><span class="op" id="7902359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902365">if</span>&nbsp;<span class="ident" id="7902368">_</span><span class="op" id="7902369">,</span>&nbsp;<span class="ident" id="7902371">err</span>&nbsp;<span class="op" id="7902375">:=</span>&nbsp;<span class="ident" id="7902378">ln</span><span class="op" id="7902380">.</span><span class="ident" id="7902381">Accept</span><span class="op" id="7902387">(</span><span class="op" id="7902388">)</span><span class="op" id="7902389">;</span>&nbsp;<span class="op" id="7902391">!</span><span class="ident" id="7902392">isTimeout</span><span class="op" id="7902401">(</span><span class="ident" id="7902402">err</span><span class="op" id="7902405">)</span>&nbsp;<span class="op" id="7902407">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902411">t</span><span class="op" id="7902412">.</span><span class="ident" id="7902413">Fatalf</span><span class="op" id="7902419">(</span><span class="string" id="7902420">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7902453">,</span>&nbsp;<span class="ident" id="7902455">errTimeout</span><span class="op" id="7902465">,</span>&nbsp;<span class="ident" id="7902467">err</span><span class="op" id="7902470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902476">ln</span><span class="op" id="7902478">.</span><span class="ident" id="7902479">SetDeadline</span><span class="op" id="7902490">(</span><span class="ident" id="7902491">time</span><span class="op" id="7902495">.</span><span class="ident" id="7902496">Now</span><span class="op" id="7902499">(</span><span class="op" id="7902500">)</span><span class="op" id="7902501">.</span><span class="ident" id="7902502">Add</span><span class="op" id="7902505">(</span><span class="num" id="7902506">100</span>&nbsp;<span class="op" id="7902510">*</span>&nbsp;<span class="ident" id="7902512">time</span><span class="op" id="7902516">.</span><span class="ident" id="7902517">Millisecond</span><span class="op" id="7902528">)</span><span class="op" id="7902529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902532">if</span>&nbsp;<span class="ident" id="7902535">_</span><span class="op" id="7902536">,</span>&nbsp;<span class="ident" id="7902538">err</span>&nbsp;<span class="op" id="7902542">:=</span>&nbsp;<span class="ident" id="7902545">ln</span><span class="op" id="7902547">.</span><span class="ident" id="7902548">Accept</span><span class="op" id="7902554">(</span><span class="op" id="7902555">)</span><span class="op" id="7902556">;</span>&nbsp;<span class="op" id="7902558">!</span><span class="ident" id="7902559">isTimeout</span><span class="op" id="7902568">(</span><span class="ident" id="7902569">err</span><span class="op" id="7902572">)</span>&nbsp;<span class="op" id="7902574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902578">t</span><span class="op" id="7902579">.</span><span class="ident" id="7902580">Fatalf</span><span class="op" id="7902586">(</span><span class="string" id="7902587">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7902620">,</span>&nbsp;<span class="ident" id="7902622">errTimeout</span><span class="op" id="7902632">,</span>&nbsp;<span class="ident" id="7902634">err</span><span class="op" id="7902637">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902643">if</span>&nbsp;<span class="ident" id="7902646">_</span><span class="op" id="7902647">,</span>&nbsp;<span class="ident" id="7902649">err</span>&nbsp;<span class="op" id="7902653">:=</span>&nbsp;<span class="ident" id="7902656">ln</span><span class="op" id="7902658">.</span><span class="ident" id="7902659">Accept</span><span class="op" id="7902665">(</span><span class="op" id="7902666">)</span><span class="op" id="7902667">;</span>&nbsp;<span class="op" id="7902669">!</span><span class="ident" id="7902670">isTimeout</span><span class="op" id="7902679">(</span><span class="ident" id="7902680">err</span><span class="op" id="7902683">)</span>&nbsp;<span class="op" id="7902685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902689">t</span><span class="op" id="7902690">.</span><span class="ident" id="7902691">Fatalf</span><span class="op" id="7902697">(</span><span class="string" id="7902698">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7902731">,</span>&nbsp;<span class="ident" id="7902733">errTimeout</span><span class="op" id="7902743">,</span>&nbsp;<span class="ident" id="7902745">err</span><span class="op" id="7902748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902754">ln</span><span class="op" id="7902756">.</span><span class="ident" id="7902757">SetDeadline</span><span class="op" id="7902768">(</span><span class="ident" id="7902769">noDeadline</span><span class="op" id="7902779">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902782">errc</span>&nbsp;<span class="op" id="7902787">:=</span>&nbsp;<span class="builtinfunc" id="7902790">make</span><span class="op" id="7902794">(</span><span class="keyword" id="7902795">chan</span>&nbsp;<span class="builtintype" id="7902800">error</span><span class="op" id="7902805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902808">go</span>&nbsp;<span class="keyword" id="7902811">func</span><span class="op" id="7902815">(</span><span class="op" id="7902816">)</span>&nbsp;<span class="op" id="7902818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902822">_</span><span class="op" id="7902823">,</span>&nbsp;<span class="ident" id="7902825">err</span>&nbsp;<span class="op" id="7902829">:=</span>&nbsp;<span class="ident" id="7902832">ln</span><span class="op" id="7902834">.</span><span class="ident" id="7902835">Accept</span><span class="op" id="7902841">(</span><span class="op" id="7902842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902846">errc</span>&nbsp;<span class="op" id="7902851">&lt;-</span>&nbsp;<span class="ident" id="7902854">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902859">}</span><span class="op" id="7902860">(</span><span class="op" id="7902861">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902864">time</span><span class="op" id="7902868">.</span><span class="ident" id="7902869">Sleep</span><span class="op" id="7902874">(</span><span class="num" id="7902875">100</span>&nbsp;<span class="op" id="7902879">*</span>&nbsp;<span class="ident" id="7902881">time</span><span class="op" id="7902885">.</span><span class="ident" id="7902886">Millisecond</span><span class="op" id="7902897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902900">select</span>&nbsp;<span class="op" id="7902907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902910">case</span>&nbsp;<span class="ident" id="7902915">err</span>&nbsp;<span class="op" id="7902919">:=</span>&nbsp;<span class="op" id="7902922">&lt;-</span><span class="ident" id="7902924">errc</span><span class="op" id="7902928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902932">t</span><span class="op" id="7902933">.</span><span class="ident" id="7902934">Fatalf</span><span class="op" id="7902940">(</span><span class="string" id="7902941">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7903001">,</span>&nbsp;<span class="ident" id="7903003">err</span><span class="op" id="7903006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903009">default</span><span class="op" id="7903016">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903022">ln</span><span class="op" id="7903024">.</span><span class="ident" id="7903025">Close</span><span class="op" id="7903030">(</span><span class="op" id="7903031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903034">switch</span>&nbsp;<span class="ident" id="7903041">nerr</span>&nbsp;<span class="op" id="7903046">:=</span>&nbsp;<span class="op" id="7903049">&lt;-</span><span class="ident" id="7903051">errc</span><span class="op" id="7903055">;</span>&nbsp;<span class="ident" id="7903057">err</span>&nbsp;<span class="op" id="7903061">:=</span>&nbsp;<span class="ident" id="7903064">nerr</span><span class="op" id="7903068">.</span><span class="op" id="7903069">(</span><span class="keyword" id="7903070">type</span><span class="op" id="7903074">)</span>&nbsp;<span class="op" id="7903076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903079">case</span>&nbsp;<span class="op" id="7903084">*</span><span class="ident" id="7903085">OpError</span><span class="op" id="7903092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903096">if</span>&nbsp;<span class="ident" id="7903099">err</span><span class="op" id="7903102">.</span><span class="ident" id="7903103">Err</span>&nbsp;<span class="op" id="7903107">!=</span>&nbsp;<span class="ident" id="7903110">errClosing</span>&nbsp;<span class="op" id="7903121">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903126">t</span><span class="op" id="7903127">.</span><span class="ident" id="7903128">Fatalf</span><span class="op" id="7903134">(</span><span class="string" id="7903135">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7903168">,</span>&nbsp;<span class="ident" id="7903170">errClosing</span><span class="op" id="7903180">,</span>&nbsp;<span class="ident" id="7903182">err</span><span class="op" id="7903185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903192">default</span><span class="op" id="7903199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903203">if</span>&nbsp;<span class="ident" id="7903206">err</span>&nbsp;<span class="op" id="7903210">!=</span>&nbsp;<span class="ident" id="7903213">errClosing</span>&nbsp;<span class="op" id="7903224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903229">t</span><span class="op" id="7903230">.</span><span class="ident" id="7903231">Fatalf</span><span class="op" id="7903237">(</span><span class="string" id="7903238">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7903271">,</span>&nbsp;<span class="ident" id="7903273">errClosing</span><span class="op" id="7903283">,</span>&nbsp;<span class="ident" id="7903285">err</span><span class="op" id="7903288">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903295">}</span><br>
<span class="lineno"></span><span class="op" id="7903297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7903300">func</span>&nbsp;<span class="ident" id="7903305">TestReadTimeout</span><span class="op" id="7903320">(</span><span class="ident" id="7903321">t</span>&nbsp;<span class="op" id="7903323">*</span><span class="ident" id="7903324">testing</span><span class="op" id="7903331">.</span><span class="ident" id="7903332">T</span><span class="op" id="7903333">)</span>&nbsp;<span class="op" id="7903335">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903338">switch</span>&nbsp;<span class="ident" id="7903345">runtime</span><span class="op" id="7903352">.</span><span class="ident" id="7903353">GOOS</span>&nbsp;<span class="op" id="7903358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903361">case</span>&nbsp;<span class="string" id="7903366">&#34;plan9&#34;</span><span class="op" id="7903373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903377">t</span><span class="op" id="7903378">.</span><span class="ident" id="7903379">Skipf</span><span class="op" id="7903384">(</span><span class="string" id="7903385">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7903406">,</span>&nbsp;<span class="ident" id="7903408">runtime</span><span class="op" id="7903415">.</span><span class="ident" id="7903416">GOOS</span><span class="op" id="7903420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903427">ln</span>&nbsp;<span class="op" id="7903430">:=</span>&nbsp;<span class="ident" id="7903433">newLocalListener</span><span class="op" id="7903449">(</span><span class="ident" id="7903450">t</span><span class="op" id="7903451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903454">defer</span>&nbsp;<span class="ident" id="7903460">ln</span><span class="op" id="7903462">.</span><span class="ident" id="7903463">Close</span><span class="op" id="7903468">(</span><span class="op" id="7903469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903472">c</span><span class="op" id="7903473">,</span>&nbsp;<span class="ident" id="7903475">err</span>&nbsp;<span class="op" id="7903479">:=</span>&nbsp;<span class="ident" id="7903482">DialTCP</span><span class="op" id="7903489">(</span><span class="string" id="7903490">&#34;tcp&#34;</span><span class="op" id="7903495">,</span>&nbsp;<span class="ident" id="7903497">nil</span><span class="op" id="7903500">,</span>&nbsp;<span class="ident" id="7903502">ln</span><span class="op" id="7903504">.</span><span class="ident" id="7903505">Addr</span><span class="op" id="7903509">(</span><span class="op" id="7903510">)</span><span class="op" id="7903511">.</span><span class="op" id="7903512">(</span><span class="op" id="7903513">*</span><span class="ident" id="7903514">TCPAddr</span><span class="op" id="7903521">)</span><span class="op" id="7903522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903525">if</span>&nbsp;<span class="ident" id="7903528">err</span>&nbsp;<span class="op" id="7903532">!=</span>&nbsp;<span class="ident" id="7903535">nil</span>&nbsp;<span class="op" id="7903539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903543">t</span><span class="op" id="7903544">.</span><span class="ident" id="7903545">Fatalf</span><span class="op" id="7903551">(</span><span class="string" id="7903552">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7903565">,</span>&nbsp;<span class="ident" id="7903567">err</span><span class="op" id="7903570">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903576">defer</span>&nbsp;<span class="ident" id="7903582">c</span><span class="op" id="7903583">.</span><span class="ident" id="7903584">Close</span><span class="op" id="7903589">(</span><span class="op" id="7903590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903593">c</span><span class="op" id="7903594">.</span><span class="ident" id="7903595">SetDeadline</span><span class="op" id="7903606">(</span><span class="ident" id="7903607">time</span><span class="op" id="7903611">.</span><span class="ident" id="7903612">Now</span><span class="op" id="7903615">(</span><span class="op" id="7903616">)</span><span class="op" id="7903617">.</span><span class="ident" id="7903618">Add</span><span class="op" id="7903621">(</span><span class="ident" id="7903622">time</span><span class="op" id="7903626">.</span><span class="ident" id="7903627">Hour</span><span class="op" id="7903631">)</span><span class="op" id="7903632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903635">c</span><span class="op" id="7903636">.</span><span class="ident" id="7903637">SetReadDeadline</span><span class="op" id="7903652">(</span><span class="ident" id="7903653">time</span><span class="op" id="7903657">.</span><span class="ident" id="7903658">Now</span><span class="op" id="7903661">(</span><span class="op" id="7903662">)</span><span class="op" id="7903663">.</span><span class="ident" id="7903664">Add</span><span class="op" id="7903667">(</span><span class="op" id="7903668">-</span><span class="num" id="7903669">1</span>&nbsp;<span class="op" id="7903671">*</span>&nbsp;<span class="ident" id="7903673">time</span><span class="op" id="7903677">.</span><span class="ident" id="7903678">Second</span><span class="op" id="7903684">)</span><span class="op" id="7903685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903688">buf</span>&nbsp;<span class="op" id="7903692">:=</span>&nbsp;<span class="builtinfunc" id="7903695">make</span><span class="op" id="7903699">(</span><span class="op" id="7903700">[</span><span class="op" id="7903701">]</span><span class="builtintype" id="7903702">byte</span><span class="op" id="7903706">,</span>&nbsp;<span class="num" id="7903708">1</span><span class="op" id="7903709">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903712">if</span>&nbsp;<span class="ident" id="7903715">_</span><span class="op" id="7903716">,</span>&nbsp;<span class="ident" id="7903718">err</span>&nbsp;<span class="op" id="7903722">=</span>&nbsp;<span class="ident" id="7903724">c</span><span class="op" id="7903725">.</span><span class="ident" id="7903726">Read</span><span class="op" id="7903730">(</span><span class="ident" id="7903731">buf</span><span class="op" id="7903734">)</span><span class="op" id="7903735">;</span>&nbsp;<span class="op" id="7903737">!</span><span class="ident" id="7903738">isTimeout</span><span class="op" id="7903747">(</span><span class="ident" id="7903748">err</span><span class="op" id="7903751">)</span>&nbsp;<span class="op" id="7903753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903757">t</span><span class="op" id="7903758">.</span><span class="ident" id="7903759">Fatalf</span><span class="op" id="7903765">(</span><span class="string" id="7903766">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7903797">,</span>&nbsp;<span class="ident" id="7903799">errTimeout</span><span class="op" id="7903809">,</span>&nbsp;<span class="ident" id="7903811">err</span><span class="op" id="7903814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903820">if</span>&nbsp;<span class="ident" id="7903823">_</span><span class="op" id="7903824">,</span>&nbsp;<span class="ident" id="7903826">err</span>&nbsp;<span class="op" id="7903830">=</span>&nbsp;<span class="ident" id="7903832">c</span><span class="op" id="7903833">.</span><span class="ident" id="7903834">Read</span><span class="op" id="7903838">(</span><span class="ident" id="7903839">buf</span><span class="op" id="7903842">)</span><span class="op" id="7903843">;</span>&nbsp;<span class="op" id="7903845">!</span><span class="ident" id="7903846">isTimeout</span><span class="op" id="7903855">(</span><span class="ident" id="7903856">err</span><span class="op" id="7903859">)</span>&nbsp;<span class="op" id="7903861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903865">t</span><span class="op" id="7903866">.</span><span class="ident" id="7903867">Fatalf</span><span class="op" id="7903873">(</span><span class="string" id="7903874">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7903905">,</span>&nbsp;<span class="ident" id="7903907">errTimeout</span><span class="op" id="7903917">,</span>&nbsp;<span class="ident" id="7903919">err</span><span class="op" id="7903922">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903928">c</span><span class="op" id="7903929">.</span><span class="ident" id="7903930">SetDeadline</span><span class="op" id="7903941">(</span><span class="ident" id="7903942">time</span><span class="op" id="7903946">.</span><span class="ident" id="7903947">Now</span><span class="op" id="7903950">(</span><span class="op" id="7903951">)</span><span class="op" id="7903952">.</span><span class="ident" id="7903953">Add</span><span class="op" id="7903956">(</span><span class="num" id="7903957">100</span>&nbsp;<span class="op" id="7903961">*</span>&nbsp;<span class="ident" id="7903963">time</span><span class="op" id="7903967">.</span><span class="ident" id="7903968">Millisecond</span><span class="op" id="7903979">)</span><span class="op" id="7903980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903983">if</span>&nbsp;<span class="ident" id="7903986">_</span><span class="op" id="7903987">,</span>&nbsp;<span class="ident" id="7903989">err</span>&nbsp;<span class="op" id="7903993">=</span>&nbsp;<span class="ident" id="7903995">c</span><span class="op" id="7903996">.</span><span class="ident" id="7903997">Read</span><span class="op" id="7904001">(</span><span class="ident" id="7904002">buf</span><span class="op" id="7904005">)</span><span class="op" id="7904006">;</span>&nbsp;<span class="op" id="7904008">!</span><span class="ident" id="7904009">isTimeout</span><span class="op" id="7904018">(</span><span class="ident" id="7904019">err</span><span class="op" id="7904022">)</span>&nbsp;<span class="op" id="7904024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904028">t</span><span class="op" id="7904029">.</span><span class="ident" id="7904030">Fatalf</span><span class="op" id="7904036">(</span><span class="string" id="7904037">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7904068">,</span>&nbsp;<span class="ident" id="7904070">errTimeout</span><span class="op" id="7904080">,</span>&nbsp;<span class="ident" id="7904082">err</span><span class="op" id="7904085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904088">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904091">if</span>&nbsp;<span class="ident" id="7904094">_</span><span class="op" id="7904095">,</span>&nbsp;<span class="ident" id="7904097">err</span>&nbsp;<span class="op" id="7904101">=</span>&nbsp;<span class="ident" id="7904103">c</span><span class="op" id="7904104">.</span><span class="ident" id="7904105">Read</span><span class="op" id="7904109">(</span><span class="ident" id="7904110">buf</span><span class="op" id="7904113">)</span><span class="op" id="7904114">;</span>&nbsp;<span class="op" id="7904116">!</span><span class="ident" id="7904117">isTimeout</span><span class="op" id="7904126">(</span><span class="ident" id="7904127">err</span><span class="op" id="7904130">)</span>&nbsp;<span class="op" id="7904132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904136">t</span><span class="op" id="7904137">.</span><span class="ident" id="7904138">Fatalf</span><span class="op" id="7904144">(</span><span class="string" id="7904145">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7904176">,</span>&nbsp;<span class="ident" id="7904178">errTimeout</span><span class="op" id="7904188">,</span>&nbsp;<span class="ident" id="7904190">err</span><span class="op" id="7904193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904199">c</span><span class="op" id="7904200">.</span><span class="ident" id="7904201">SetReadDeadline</span><span class="op" id="7904216">(</span><span class="ident" id="7904217">noDeadline</span><span class="op" id="7904227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904230">c</span><span class="op" id="7904231">.</span><span class="ident" id="7904232">SetWriteDeadline</span><span class="op" id="7904248">(</span><span class="ident" id="7904249">time</span><span class="op" id="7904253">.</span><span class="ident" id="7904254">Now</span><span class="op" id="7904257">(</span><span class="op" id="7904258">)</span><span class="op" id="7904259">.</span><span class="ident" id="7904260">Add</span><span class="op" id="7904263">(</span><span class="op" id="7904264">-</span><span class="num" id="7904265">1</span>&nbsp;<span class="op" id="7904267">*</span>&nbsp;<span class="ident" id="7904269">time</span><span class="op" id="7904273">.</span><span class="ident" id="7904274">Second</span><span class="op" id="7904280">)</span><span class="op" id="7904281">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904284">errc</span>&nbsp;<span class="op" id="7904289">:=</span>&nbsp;<span class="builtinfunc" id="7904292">make</span><span class="op" id="7904296">(</span><span class="keyword" id="7904297">chan</span>&nbsp;<span class="builtintype" id="7904302">error</span><span class="op" id="7904307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904310">go</span>&nbsp;<span class="keyword" id="7904313">func</span><span class="op" id="7904317">(</span><span class="op" id="7904318">)</span>&nbsp;<span class="op" id="7904320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904324">_</span><span class="op" id="7904325">,</span>&nbsp;<span class="ident" id="7904327">err</span>&nbsp;<span class="op" id="7904331">:=</span>&nbsp;<span class="ident" id="7904334">c</span><span class="op" id="7904335">.</span><span class="ident" id="7904336">Read</span><span class="op" id="7904340">(</span><span class="ident" id="7904341">buf</span><span class="op" id="7904344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904348">errc</span>&nbsp;<span class="op" id="7904353">&lt;-</span>&nbsp;<span class="ident" id="7904356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904361">}</span><span class="op" id="7904362">(</span><span class="op" id="7904363">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904366">time</span><span class="op" id="7904370">.</span><span class="ident" id="7904371">Sleep</span><span class="op" id="7904376">(</span><span class="num" id="7904377">100</span>&nbsp;<span class="op" id="7904381">*</span>&nbsp;<span class="ident" id="7904383">time</span><span class="op" id="7904387">.</span><span class="ident" id="7904388">Millisecond</span><span class="op" id="7904399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904402">select</span>&nbsp;<span class="op" id="7904409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904412">case</span>&nbsp;<span class="ident" id="7904417">err</span>&nbsp;<span class="op" id="7904421">:=</span>&nbsp;<span class="op" id="7904424">&lt;-</span><span class="ident" id="7904426">errc</span><span class="op" id="7904430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904434">t</span><span class="op" id="7904435">.</span><span class="ident" id="7904436">Fatalf</span><span class="op" id="7904442">(</span><span class="string" id="7904443">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7904501">,</span>&nbsp;<span class="ident" id="7904503">err</span><span class="op" id="7904506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904509">default</span><span class="op" id="7904516">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904522">c</span><span class="op" id="7904523">.</span><span class="ident" id="7904524">Close</span><span class="op" id="7904529">(</span><span class="op" id="7904530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904533">switch</span>&nbsp;<span class="ident" id="7904540">nerr</span>&nbsp;<span class="op" id="7904545">:=</span>&nbsp;<span class="op" id="7904548">&lt;-</span><span class="ident" id="7904550">errc</span><span class="op" id="7904554">;</span>&nbsp;<span class="ident" id="7904556">err</span>&nbsp;<span class="op" id="7904560">:=</span>&nbsp;<span class="ident" id="7904563">nerr</span><span class="op" id="7904567">.</span><span class="op" id="7904568">(</span><span class="keyword" id="7904569">type</span><span class="op" id="7904573">)</span>&nbsp;<span class="op" id="7904575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904578">case</span>&nbsp;<span class="op" id="7904583">*</span><span class="ident" id="7904584">OpError</span><span class="op" id="7904591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904595">if</span>&nbsp;<span class="ident" id="7904598">err</span><span class="op" id="7904601">.</span><span class="ident" id="7904602">Err</span>&nbsp;<span class="op" id="7904606">!=</span>&nbsp;<span class="ident" id="7904609">errClosing</span>&nbsp;<span class="op" id="7904620">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904625">t</span><span class="op" id="7904626">.</span><span class="ident" id="7904627">Fatalf</span><span class="op" id="7904633">(</span><span class="string" id="7904634">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7904665">,</span>&nbsp;<span class="ident" id="7904667">errClosing</span><span class="op" id="7904677">,</span>&nbsp;<span class="ident" id="7904679">err</span><span class="op" id="7904682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904689">default</span><span class="op" id="7904696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904700">if</span>&nbsp;<span class="ident" id="7904703">err</span>&nbsp;<span class="op" id="7904707">==</span>&nbsp;<span class="ident" id="7904710">io</span><span class="op" id="7904712">.</span><span class="ident" id="7904713">EOF</span>&nbsp;<span class="op" id="7904717">&amp;&amp;</span>&nbsp;<span class="ident" id="7904720">runtime</span><span class="op" id="7904727">.</span><span class="ident" id="7904728">GOOS</span>&nbsp;<span class="op" id="7904733">==</span>&nbsp;<span class="string" id="7904736">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7904743">{</span>&nbsp;<span class="comment" id="7904745">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904787">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904799">if</span>&nbsp;<span class="ident" id="7904802">err</span>&nbsp;<span class="op" id="7904806">!=</span>&nbsp;<span class="ident" id="7904809">errClosing</span>&nbsp;<span class="op" id="7904820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904825">t</span><span class="op" id="7904826">.</span><span class="ident" id="7904827">Fatalf</span><span class="op" id="7904833">(</span><span class="string" id="7904834">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7904865">,</span>&nbsp;<span class="ident" id="7904867">errClosing</span><span class="op" id="7904877">,</span>&nbsp;<span class="ident" id="7904879">err</span><span class="op" id="7904882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904889">}</span><br>
<span class="lineno">130</span><span class="op" id="7904891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7904894">func</span>&nbsp;<span class="ident" id="7904899">TestWriteTimeout</span><span class="op" id="7904915">(</span><span class="ident" id="7904916">t</span>&nbsp;<span class="op" id="7904918">*</span><span class="ident" id="7904919">testing</span><span class="op" id="7904926">.</span><span class="ident" id="7904927">T</span><span class="op" id="7904928">)</span>&nbsp;<span class="op" id="7904930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904933">switch</span>&nbsp;<span class="ident" id="7904940">runtime</span><span class="op" id="7904947">.</span><span class="ident" id="7904948">GOOS</span>&nbsp;<span class="op" id="7904953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904956">case</span>&nbsp;<span class="string" id="7904961">&#34;plan9&#34;</span><span class="op" id="7904968">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904972">t</span><span class="op" id="7904973">.</span><span class="ident" id="7904974">Skipf</span><span class="op" id="7904979">(</span><span class="string" id="7904980">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7905001">,</span>&nbsp;<span class="ident" id="7905003">runtime</span><span class="op" id="7905010">.</span><span class="ident" id="7905011">GOOS</span><span class="op" id="7905015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905022">ln</span>&nbsp;<span class="op" id="7905025">:=</span>&nbsp;<span class="ident" id="7905028">newLocalListener</span><span class="op" id="7905044">(</span><span class="ident" id="7905045">t</span><span class="op" id="7905046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905049">defer</span>&nbsp;<span class="ident" id="7905055">ln</span><span class="op" id="7905057">.</span><span class="ident" id="7905058">Close</span><span class="op" id="7905063">(</span><span class="op" id="7905064">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905067">c</span><span class="op" id="7905068">,</span>&nbsp;<span class="ident" id="7905070">err</span>&nbsp;<span class="op" id="7905074">:=</span>&nbsp;<span class="ident" id="7905077">DialTCP</span><span class="op" id="7905084">(</span><span class="string" id="7905085">&#34;tcp&#34;</span><span class="op" id="7905090">,</span>&nbsp;<span class="ident" id="7905092">nil</span><span class="op" id="7905095">,</span>&nbsp;<span class="ident" id="7905097">ln</span><span class="op" id="7905099">.</span><span class="ident" id="7905100">Addr</span><span class="op" id="7905104">(</span><span class="op" id="7905105">)</span><span class="op" id="7905106">.</span><span class="op" id="7905107">(</span><span class="op" id="7905108">*</span><span class="ident" id="7905109">TCPAddr</span><span class="op" id="7905116">)</span><span class="op" id="7905117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905120">if</span>&nbsp;<span class="ident" id="7905123">err</span>&nbsp;<span class="op" id="7905127">!=</span>&nbsp;<span class="ident" id="7905130">nil</span>&nbsp;<span class="op" id="7905134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905138">t</span><span class="op" id="7905139">.</span><span class="ident" id="7905140">Fatalf</span><span class="op" id="7905146">(</span><span class="string" id="7905147">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7905160">,</span>&nbsp;<span class="ident" id="7905162">err</span><span class="op" id="7905165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905171">defer</span>&nbsp;<span class="ident" id="7905177">c</span><span class="op" id="7905178">.</span><span class="ident" id="7905179">Close</span><span class="op" id="7905184">(</span><span class="op" id="7905185">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905188">c</span><span class="op" id="7905189">.</span><span class="ident" id="7905190">SetDeadline</span><span class="op" id="7905201">(</span><span class="ident" id="7905202">time</span><span class="op" id="7905206">.</span><span class="ident" id="7905207">Now</span><span class="op" id="7905210">(</span><span class="op" id="7905211">)</span><span class="op" id="7905212">.</span><span class="ident" id="7905213">Add</span><span class="op" id="7905216">(</span><span class="ident" id="7905217">time</span><span class="op" id="7905221">.</span><span class="ident" id="7905222">Hour</span><span class="op" id="7905226">)</span><span class="op" id="7905227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905230">c</span><span class="op" id="7905231">.</span><span class="ident" id="7905232">SetWriteDeadline</span><span class="op" id="7905248">(</span><span class="ident" id="7905249">time</span><span class="op" id="7905253">.</span><span class="ident" id="7905254">Now</span><span class="op" id="7905257">(</span><span class="op" id="7905258">)</span><span class="op" id="7905259">.</span><span class="ident" id="7905260">Add</span><span class="op" id="7905263">(</span><span class="op" id="7905264">-</span><span class="num" id="7905265">1</span>&nbsp;<span class="op" id="7905267">*</span>&nbsp;<span class="ident" id="7905269">time</span><span class="op" id="7905273">.</span><span class="ident" id="7905274">Second</span><span class="op" id="7905280">)</span><span class="op" id="7905281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905284">buf</span>&nbsp;<span class="op" id="7905288">:=</span>&nbsp;<span class="builtinfunc" id="7905291">make</span><span class="op" id="7905295">(</span><span class="op" id="7905296">[</span><span class="op" id="7905297">]</span><span class="builtintype" id="7905298">byte</span><span class="op" id="7905302">,</span>&nbsp;<span class="num" id="7905304">4096</span><span class="op" id="7905308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905311">writeUntilTimeout</span>&nbsp;<span class="op" id="7905329">:=</span>&nbsp;<span class="keyword" id="7905332">func</span><span class="op" id="7905336">(</span><span class="op" id="7905337">)</span>&nbsp;<span class="op" id="7905339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905343">for</span>&nbsp;<span class="op" id="7905347">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905352">_</span><span class="op" id="7905353">,</span>&nbsp;<span class="ident" id="7905355">err</span>&nbsp;<span class="op" id="7905359">:=</span>&nbsp;<span class="ident" id="7905362">c</span><span class="op" id="7905363">.</span><span class="ident" id="7905364">Write</span><span class="op" id="7905369">(</span><span class="ident" id="7905370">buf</span><span class="op" id="7905373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905378">if</span>&nbsp;<span class="ident" id="7905381">err</span>&nbsp;<span class="op" id="7905385">!=</span>&nbsp;<span class="ident" id="7905388">nil</span>&nbsp;<span class="op" id="7905392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905398">if</span>&nbsp;<span class="ident" id="7905401">isTimeout</span><span class="op" id="7905410">(</span><span class="ident" id="7905411">err</span><span class="op" id="7905414">)</span>&nbsp;<span class="op" id="7905416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905434">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905440">t</span><span class="op" id="7905441">.</span><span class="ident" id="7905442">Fatalf</span><span class="op" id="7905448">(</span><span class="string" id="7905449">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7905481">,</span>&nbsp;<span class="ident" id="7905483">errTimeout</span><span class="op" id="7905493">,</span>&nbsp;<span class="ident" id="7905495">err</span><span class="op" id="7905498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905513">writeUntilTimeout</span><span class="op" id="7905530">(</span><span class="op" id="7905531">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905534">c</span><span class="op" id="7905535">.</span><span class="ident" id="7905536">SetDeadline</span><span class="op" id="7905547">(</span><span class="ident" id="7905548">time</span><span class="op" id="7905552">.</span><span class="ident" id="7905553">Now</span><span class="op" id="7905556">(</span><span class="op" id="7905557">)</span><span class="op" id="7905558">.</span><span class="ident" id="7905559">Add</span><span class="op" id="7905562">(</span><span class="num" id="7905563">10</span>&nbsp;<span class="op" id="7905566">*</span>&nbsp;<span class="ident" id="7905568">time</span><span class="op" id="7905572">.</span><span class="ident" id="7905573">Millisecond</span><span class="op" id="7905584">)</span><span class="op" id="7905585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905588">writeUntilTimeout</span><span class="op" id="7905605">(</span><span class="op" id="7905606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905609">writeUntilTimeout</span><span class="op" id="7905626">(</span><span class="op" id="7905627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905630">c</span><span class="op" id="7905631">.</span><span class="ident" id="7905632">SetWriteDeadline</span><span class="op" id="7905648">(</span><span class="ident" id="7905649">noDeadline</span><span class="op" id="7905659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905662">c</span><span class="op" id="7905663">.</span><span class="ident" id="7905664">SetReadDeadline</span><span class="op" id="7905679">(</span><span class="ident" id="7905680">time</span><span class="op" id="7905684">.</span><span class="ident" id="7905685">Now</span><span class="op" id="7905688">(</span><span class="op" id="7905689">)</span><span class="op" id="7905690">.</span><span class="ident" id="7905691">Add</span><span class="op" id="7905694">(</span><span class="op" id="7905695">-</span><span class="num" id="7905696">1</span>&nbsp;<span class="op" id="7905698">*</span>&nbsp;<span class="ident" id="7905700">time</span><span class="op" id="7905704">.</span><span class="ident" id="7905705">Second</span><span class="op" id="7905711">)</span><span class="op" id="7905712">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905715">errc</span>&nbsp;<span class="op" id="7905720">:=</span>&nbsp;<span class="builtinfunc" id="7905723">make</span><span class="op" id="7905727">(</span><span class="keyword" id="7905728">chan</span>&nbsp;<span class="builtintype" id="7905733">error</span><span class="op" id="7905738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905741">go</span>&nbsp;<span class="keyword" id="7905744">func</span><span class="op" id="7905748">(</span><span class="op" id="7905749">)</span>&nbsp;<span class="op" id="7905751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905755">for</span>&nbsp;<span class="op" id="7905759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905764">_</span><span class="op" id="7905765">,</span>&nbsp;<span class="ident" id="7905767">err</span>&nbsp;<span class="op" id="7905771">:=</span>&nbsp;<span class="ident" id="7905774">c</span><span class="op" id="7905775">.</span><span class="ident" id="7905776">Write</span><span class="op" id="7905781">(</span><span class="ident" id="7905782">buf</span><span class="op" id="7905785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905790">if</span>&nbsp;<span class="ident" id="7905793">err</span>&nbsp;<span class="op" id="7905797">!=</span>&nbsp;<span class="ident" id="7905800">nil</span>&nbsp;<span class="op" id="7905804">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905810">errc</span>&nbsp;<span class="op" id="7905815">&lt;-</span>&nbsp;<span class="ident" id="7905818">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905832">}</span><span class="op" id="7905833">(</span><span class="op" id="7905834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905837">time</span><span class="op" id="7905841">.</span><span class="ident" id="7905842">Sleep</span><span class="op" id="7905847">(</span><span class="num" id="7905848">100</span>&nbsp;<span class="op" id="7905852">*</span>&nbsp;<span class="ident" id="7905854">time</span><span class="op" id="7905858">.</span><span class="ident" id="7905859">Millisecond</span><span class="op" id="7905870">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905873">select</span>&nbsp;<span class="op" id="7905880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905883">case</span>&nbsp;<span class="ident" id="7905888">err</span>&nbsp;<span class="op" id="7905892">:=</span>&nbsp;<span class="op" id="7905895">&lt;-</span><span class="ident" id="7905897">errc</span><span class="op" id="7905901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905905">t</span><span class="op" id="7905906">.</span><span class="ident" id="7905907">Fatalf</span><span class="op" id="7905913">(</span><span class="string" id="7905914">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7905973">,</span>&nbsp;<span class="ident" id="7905975">err</span><span class="op" id="7905978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905981">default</span><span class="op" id="7905988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905991">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905994">c</span><span class="op" id="7905995">.</span><span class="ident" id="7905996">Close</span><span class="op" id="7906001">(</span><span class="op" id="7906002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906005">switch</span>&nbsp;<span class="ident" id="7906012">nerr</span>&nbsp;<span class="op" id="7906017">:=</span>&nbsp;<span class="op" id="7906020">&lt;-</span><span class="ident" id="7906022">errc</span><span class="op" id="7906026">;</span>&nbsp;<span class="ident" id="7906028">err</span>&nbsp;<span class="op" id="7906032">:=</span>&nbsp;<span class="ident" id="7906035">nerr</span><span class="op" id="7906039">.</span><span class="op" id="7906040">(</span><span class="keyword" id="7906041">type</span><span class="op" id="7906045">)</span>&nbsp;<span class="op" id="7906047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906050">case</span>&nbsp;<span class="op" id="7906055">*</span><span class="ident" id="7906056">OpError</span><span class="op" id="7906063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906067">if</span>&nbsp;<span class="ident" id="7906070">err</span><span class="op" id="7906073">.</span><span class="ident" id="7906074">Err</span>&nbsp;<span class="op" id="7906078">!=</span>&nbsp;<span class="ident" id="7906081">errClosing</span>&nbsp;<span class="op" id="7906092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906097">t</span><span class="op" id="7906098">.</span><span class="ident" id="7906099">Fatalf</span><span class="op" id="7906105">(</span><span class="string" id="7906106">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7906138">,</span>&nbsp;<span class="ident" id="7906140">errClosing</span><span class="op" id="7906150">,</span>&nbsp;<span class="ident" id="7906152">err</span><span class="op" id="7906155">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906162">default</span><span class="op" id="7906169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906173">if</span>&nbsp;<span class="ident" id="7906176">err</span>&nbsp;<span class="op" id="7906180">!=</span>&nbsp;<span class="ident" id="7906183">errClosing</span>&nbsp;<span class="op" id="7906194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906199">t</span><span class="op" id="7906200">.</span><span class="ident" id="7906201">Fatalf</span><span class="op" id="7906207">(</span><span class="string" id="7906208">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7906240">,</span>&nbsp;<span class="ident" id="7906242">errClosing</span><span class="op" id="7906252">,</span>&nbsp;<span class="ident" id="7906254">err</span><span class="op" id="7906257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906261">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906264">}</span><br>
<span class="lineno"></span><span class="op" id="7906266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906269">func</span>&nbsp;<span class="ident" id="7906274">testTimeout</span><span class="op" id="7906285">(</span><span class="ident" id="7906286">t</span>&nbsp;<span class="op" id="7906288">*</span><span class="ident" id="7906289">testing</span><span class="op" id="7906296">.</span><span class="ident" id="7906297">T</span><span class="op" id="7906298">,</span>&nbsp;<span class="ident" id="7906300">net</span><span class="op" id="7906303">,</span>&nbsp;<span class="ident" id="7906305">addr</span>&nbsp;<span class="builtintype" id="7906310">string</span><span class="op" id="7906316">,</span>&nbsp;<span class="ident" id="7906318">readFrom</span>&nbsp;<span class="builtintype" id="7906327">bool</span><span class="op" id="7906331">)</span>&nbsp;<span class="op" id="7906333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906336">c</span><span class="op" id="7906337">,</span>&nbsp;<span class="ident" id="7906339">err</span>&nbsp;<span class="op" id="7906343">:=</span>&nbsp;<span class="ident" id="7906346">Dial</span><span class="op" id="7906350">(</span><span class="ident" id="7906351">net</span><span class="op" id="7906354">,</span>&nbsp;<span class="ident" id="7906356">addr</span><span class="op" id="7906360">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906363">if</span>&nbsp;<span class="ident" id="7906366">err</span>&nbsp;<span class="op" id="7906370">!=</span>&nbsp;<span class="ident" id="7906373">nil</span>&nbsp;<span class="op" id="7906377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906381">t</span><span class="op" id="7906382">.</span><span class="ident" id="7906383">Errorf</span><span class="op" id="7906389">(</span><span class="string" id="7906390">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7906415">,</span>&nbsp;<span class="ident" id="7906417">net</span><span class="op" id="7906420">,</span>&nbsp;<span class="ident" id="7906422">addr</span><span class="op" id="7906426">,</span>&nbsp;<span class="ident" id="7906428">err</span><span class="op" id="7906431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906446">defer</span>&nbsp;<span class="ident" id="7906452">c</span><span class="op" id="7906453">.</span><span class="ident" id="7906454">Close</span><span class="op" id="7906459">(</span><span class="op" id="7906460">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906463">what</span>&nbsp;<span class="op" id="7906468">:=</span>&nbsp;<span class="string" id="7906471">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906479">if</span>&nbsp;<span class="ident" id="7906482">readFrom</span>&nbsp;<span class="op" id="7906491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906495">what</span>&nbsp;<span class="op" id="7906500">=</span>&nbsp;<span class="string" id="7906502">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906518">errc</span>&nbsp;<span class="op" id="7906523">:=</span>&nbsp;<span class="builtinfunc" id="7906526">make</span><span class="op" id="7906530">(</span><span class="keyword" id="7906531">chan</span>&nbsp;<span class="builtintype" id="7906536">error</span><span class="op" id="7906541">,</span>&nbsp;<span class="num" id="7906543">1</span><span class="op" id="7906544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906547">go</span>&nbsp;<span class="keyword" id="7906550">func</span><span class="op" id="7906554">(</span><span class="op" id="7906555">)</span>&nbsp;<span class="op" id="7906557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906561">t0</span>&nbsp;<span class="op" id="7906564">:=</span>&nbsp;<span class="ident" id="7906567">time</span><span class="op" id="7906571">.</span><span class="ident" id="7906572">Now</span><span class="op" id="7906575">(</span><span class="op" id="7906576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906580">c</span><span class="op" id="7906581">.</span><span class="ident" id="7906582">SetReadDeadline</span><span class="op" id="7906597">(</span><span class="ident" id="7906598">time</span><span class="op" id="7906602">.</span><span class="ident" id="7906603">Now</span><span class="op" id="7906606">(</span><span class="op" id="7906607">)</span><span class="op" id="7906608">.</span><span class="ident" id="7906609">Add</span><span class="op" id="7906612">(</span><span class="num" id="7906613">100</span>&nbsp;<span class="op" id="7906617">*</span>&nbsp;<span class="ident" id="7906619">time</span><span class="op" id="7906623">.</span><span class="ident" id="7906624">Millisecond</span><span class="op" id="7906635">)</span><span class="op" id="7906636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906640">var</span>&nbsp;<span class="ident" id="7906644">b</span>&nbsp;<span class="op" id="7906646">[</span><span class="num" id="7906647">100</span><span class="op" id="7906650">]</span><span class="builtintype" id="7906651">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906658">var</span>&nbsp;<span class="ident" id="7906662">n</span>&nbsp;<span class="builtintype" id="7906664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906670">var</span>&nbsp;<span class="ident" id="7906674">err</span>&nbsp;<span class="builtintype" id="7906678">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906686">if</span>&nbsp;<span class="ident" id="7906689">readFrom</span>&nbsp;<span class="op" id="7906698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906703">n</span><span class="op" id="7906704">,</span>&nbsp;<span class="ident" id="7906706">_</span><span class="op" id="7906707">,</span>&nbsp;<span class="ident" id="7906709">err</span>&nbsp;<span class="op" id="7906713">=</span>&nbsp;<span class="ident" id="7906715">c</span><span class="op" id="7906716">.</span><span class="op" id="7906717">(</span><span class="ident" id="7906718">PacketConn</span><span class="op" id="7906728">)</span><span class="op" id="7906729">.</span><span class="ident" id="7906730">ReadFrom</span><span class="op" id="7906738">(</span><span class="ident" id="7906739">b</span><span class="op" id="7906740">[</span><span class="num" id="7906741">0</span><span class="op" id="7906742">:</span><span class="op" id="7906743">]</span><span class="op" id="7906744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906748">}</span>&nbsp;<span class="keyword" id="7906750">else</span>&nbsp;<span class="op" id="7906755">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906760">n</span><span class="op" id="7906761">,</span>&nbsp;<span class="ident" id="7906763">err</span>&nbsp;<span class="op" id="7906767">=</span>&nbsp;<span class="ident" id="7906769">c</span><span class="op" id="7906770">.</span><span class="ident" id="7906771">Read</span><span class="op" id="7906775">(</span><span class="ident" id="7906776">b</span><span class="op" id="7906777">[</span><span class="num" id="7906778">0</span><span class="op" id="7906779">:</span><span class="op" id="7906780">]</span><span class="op" id="7906781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906789">t1</span>&nbsp;<span class="op" id="7906792">:=</span>&nbsp;<span class="ident" id="7906795">time</span><span class="op" id="7906799">.</span><span class="ident" id="7906800">Now</span><span class="op" id="7906803">(</span><span class="op" id="7906804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906808">if</span>&nbsp;<span class="ident" id="7906811">n</span>&nbsp;<span class="op" id="7906813">!=</span>&nbsp;<span class="num" id="7906816">0</span>&nbsp;<span class="op" id="7906818">||</span>&nbsp;<span class="ident" id="7906821">err</span>&nbsp;<span class="op" id="7906825">==</span>&nbsp;<span class="ident" id="7906828">nil</span>&nbsp;<span class="op" id="7906832">||</span>&nbsp;<span class="op" id="7906835">!</span><span class="ident" id="7906836">err</span><span class="op" id="7906839">.</span><span class="op" id="7906840">(</span><span class="ident" id="7906841">Error</span><span class="op" id="7906846">)</span><span class="op" id="7906847">.</span><span class="ident" id="7906848">Timeout</span><span class="op" id="7906855">(</span><span class="op" id="7906856">)</span>&nbsp;<span class="op" id="7906858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906863">errc</span>&nbsp;<span class="op" id="7906868">&lt;-</span>&nbsp;<span class="ident" id="7906871">fmt</span><span class="op" id="7906874">.</span><span class="ident" id="7906875">Errorf</span><span class="op" id="7906881">(</span><span class="string" id="7906882">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7906928">,</span>&nbsp;<span class="ident" id="7906930">what</span><span class="op" id="7906934">,</span>&nbsp;<span class="ident" id="7906936">net</span><span class="op" id="7906939">,</span>&nbsp;<span class="ident" id="7906941">addr</span><span class="op" id="7906945">,</span>&nbsp;<span class="ident" id="7906947">n</span><span class="op" id="7906948">,</span>&nbsp;<span class="ident" id="7906950">err</span><span class="op" id="7906953">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906958">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906971">if</span>&nbsp;<span class="ident" id="7906974">dt</span>&nbsp;<span class="op" id="7906977">:=</span>&nbsp;<span class="ident" id="7906980">t1</span><span class="op" id="7906982">.</span><span class="ident" id="7906983">Sub</span><span class="op" id="7906986">(</span><span class="ident" id="7906987">t0</span><span class="op" id="7906989">)</span><span class="op" id="7906990">;</span>&nbsp;<span class="ident" id="7906992">dt</span>&nbsp;<span class="op" id="7906995">&lt;</span>&nbsp;<span class="num" id="7906997">50</span><span class="op" id="7906999">*</span><span class="ident" id="7907000">time</span><span class="op" id="7907004">.</span><span class="ident" id="7907005">Millisecond</span>&nbsp;<span class="op" id="7907017">||</span>&nbsp;<span class="op" id="7907020">!</span><span class="ident" id="7907021">testing</span><span class="op" id="7907028">.</span><span class="ident" id="7907029">Short</span><span class="op" id="7907034">(</span><span class="op" id="7907035">)</span>&nbsp;<span class="op" id="7907037">&amp;&amp;</span>&nbsp;<span class="ident" id="7907040">dt</span>&nbsp;<span class="op" id="7907043">&gt;</span>&nbsp;<span class="num" id="7907045">250</span><span class="op" id="7907048">*</span><span class="ident" id="7907049">time</span><span class="op" id="7907053">.</span><span class="ident" id="7907054">Millisecond</span>&nbsp;<span class="op" id="7907066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907071">errc</span>&nbsp;<span class="op" id="7907076">&lt;-</span>&nbsp;<span class="ident" id="7907079">fmt</span><span class="op" id="7907082">.</span><span class="ident" id="7907083">Errorf</span><span class="op" id="7907089">(</span><span class="string" id="7907090">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7907125">,</span>&nbsp;<span class="ident" id="7907127">what</span><span class="op" id="7907131">,</span>&nbsp;<span class="ident" id="7907133">net</span><span class="op" id="7907136">,</span>&nbsp;<span class="ident" id="7907138">addr</span><span class="op" id="7907142">,</span>&nbsp;<span class="ident" id="7907144">dt</span><span class="op" id="7907146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907151">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907164">errc</span>&nbsp;<span class="op" id="7907169">&lt;-</span>&nbsp;<span class="ident" id="7907172">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907177">}</span><span class="op" id="7907178">(</span><span class="op" id="7907179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907182">select</span>&nbsp;<span class="op" id="7907189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907192">case</span>&nbsp;<span class="ident" id="7907197">err</span>&nbsp;<span class="op" id="7907201">:=</span>&nbsp;<span class="op" id="7907204">&lt;-</span><span class="ident" id="7907206">errc</span><span class="op" id="7907210">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907214">if</span>&nbsp;<span class="ident" id="7907217">err</span>&nbsp;<span class="op" id="7907221">!=</span>&nbsp;<span class="ident" id="7907224">nil</span>&nbsp;<span class="op" id="7907228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907233">t</span><span class="op" id="7907234">.</span><span class="ident" id="7907235">Error</span><span class="op" id="7907240">(</span><span class="ident" id="7907241">err</span><span class="op" id="7907244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907251">case</span>&nbsp;<span class="op" id="7907256">&lt;-</span><span class="ident" id="7907258">time</span><span class="op" id="7907262">.</span><span class="ident" id="7907263">After</span><span class="op" id="7907268">(</span><span class="num" id="7907269">1</span>&nbsp;<span class="op" id="7907271">*</span>&nbsp;<span class="ident" id="7907273">time</span><span class="op" id="7907277">.</span><span class="ident" id="7907278">Second</span><span class="op" id="7907284">)</span><span class="op" id="7907285">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907289">t</span><span class="op" id="7907290">.</span><span class="ident" id="7907291">Errorf</span><span class="op" id="7907297">(</span><span class="string" id="7907298">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7907344">,</span>&nbsp;<span class="ident" id="7907346">what</span><span class="op" id="7907350">,</span>&nbsp;<span class="ident" id="7907352">net</span><span class="op" id="7907355">,</span>&nbsp;<span class="ident" id="7907357">addr</span><span class="op" id="7907361">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907364">}</span><br>
<span class="lineno"></span><span class="op" id="7907366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907369">func</span>&nbsp;<span class="ident" id="7907374">TestTimeoutUDP</span><span class="op" id="7907388">(</span><span class="ident" id="7907389">t</span>&nbsp;<span class="op" id="7907391">*</span><span class="ident" id="7907392">testing</span><span class="op" id="7907399">.</span><span class="ident" id="7907400">T</span><span class="op" id="7907401">)</span>&nbsp;<span class="op" id="7907403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907406">switch</span>&nbsp;<span class="ident" id="7907413">runtime</span><span class="op" id="7907420">.</span><span class="ident" id="7907421">GOOS</span>&nbsp;<span class="op" id="7907426">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907429">case</span>&nbsp;<span class="string" id="7907434">&#34;plan9&#34;</span><span class="op" id="7907441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907445">t</span><span class="op" id="7907446">.</span><span class="ident" id="7907447">Skipf</span><span class="op" id="7907452">(</span><span class="string" id="7907453">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7907474">,</span>&nbsp;<span class="ident" id="7907476">runtime</span><span class="op" id="7907483">.</span><span class="ident" id="7907484">GOOS</span><span class="op" id="7907488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907495">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907538">listening</span>&nbsp;<span class="op" id="7907548">:=</span>&nbsp;<span class="builtinfunc" id="7907551">make</span><span class="op" id="7907555">(</span><span class="keyword" id="7907556">chan</span>&nbsp;<span class="builtintype" id="7907561">string</span><span class="op" id="7907567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907570">done</span>&nbsp;<span class="op" id="7907575">:=</span>&nbsp;<span class="builtinfunc" id="7907578">make</span><span class="op" id="7907582">(</span><span class="keyword" id="7907583">chan</span>&nbsp;<span class="builtintype" id="7907588">int</span><span class="op" id="7907591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907594">go</span>&nbsp;<span class="ident" id="7907597">runDatagramPacketConnServer</span><span class="op" id="7907624">(</span><span class="ident" id="7907625">t</span><span class="op" id="7907626">,</span>&nbsp;<span class="string" id="7907628">&#34;udp&#34;</span><span class="op" id="7907633">,</span>&nbsp;<span class="string" id="7907635">&#34;127.0.0.1:0&#34;</span><span class="op" id="7907648">,</span>&nbsp;<span class="ident" id="7907650">listening</span><span class="op" id="7907659">,</span>&nbsp;<span class="ident" id="7907661">done</span><span class="op" id="7907665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907668">addr</span>&nbsp;<span class="op" id="7907673">:=</span>&nbsp;<span class="op" id="7907676">&lt;-</span><span class="ident" id="7907678">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907690">testTimeout</span><span class="op" id="7907701">(</span><span class="ident" id="7907702">t</span><span class="op" id="7907703">,</span>&nbsp;<span class="string" id="7907705">&#34;udp&#34;</span><span class="op" id="7907710">,</span>&nbsp;<span class="ident" id="7907712">addr</span><span class="op" id="7907716">,</span>&nbsp;<span class="builtintype" id="7907718">false</span><span class="op" id="7907723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907726">testTimeout</span><span class="op" id="7907737">(</span><span class="ident" id="7907738">t</span><span class="op" id="7907739">,</span>&nbsp;<span class="string" id="7907741">&#34;udp&#34;</span><span class="op" id="7907746">,</span>&nbsp;<span class="ident" id="7907748">addr</span><span class="op" id="7907752">,</span>&nbsp;<span class="builtintype" id="7907754">true</span><span class="op" id="7907758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907761">&lt;-</span><span class="ident" id="7907763">done</span><br>
<span class="lineno"></span><span class="op" id="7907768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7907771">func</span>&nbsp;<span class="ident" id="7907776">TestTimeoutTCP</span><span class="op" id="7907790">(</span><span class="ident" id="7907791">t</span>&nbsp;<span class="op" id="7907793">*</span><span class="ident" id="7907794">testing</span><span class="op" id="7907801">.</span><span class="ident" id="7907802">T</span><span class="op" id="7907803">)</span>&nbsp;<span class="op" id="7907805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907808">switch</span>&nbsp;<span class="ident" id="7907815">runtime</span><span class="op" id="7907822">.</span><span class="ident" id="7907823">GOOS</span>&nbsp;<span class="op" id="7907828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907831">case</span>&nbsp;<span class="string" id="7907836">&#34;plan9&#34;</span><span class="op" id="7907843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907847">t</span><span class="op" id="7907848">.</span><span class="ident" id="7907849">Skipf</span><span class="op" id="7907854">(</span><span class="string" id="7907855">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7907876">,</span>&nbsp;<span class="ident" id="7907878">runtime</span><span class="op" id="7907885">.</span><span class="ident" id="7907886">GOOS</span><span class="op" id="7907890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907893">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907897">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907940">listening</span>&nbsp;<span class="op" id="7907950">:=</span>&nbsp;<span class="builtinfunc" id="7907953">make</span><span class="op" id="7907957">(</span><span class="keyword" id="7907958">chan</span>&nbsp;<span class="builtintype" id="7907963">string</span><span class="op" id="7907969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907972">done</span>&nbsp;<span class="op" id="7907977">:=</span>&nbsp;<span class="builtinfunc" id="7907980">make</span><span class="op" id="7907984">(</span><span class="keyword" id="7907985">chan</span>&nbsp;<span class="builtintype" id="7907990">int</span><span class="op" id="7907993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907996">go</span>&nbsp;<span class="ident" id="7907999">runStreamConnServer</span><span class="op" id="7908018">(</span><span class="ident" id="7908019">t</span><span class="op" id="7908020">,</span>&nbsp;<span class="string" id="7908022">&#34;tcp&#34;</span><span class="op" id="7908027">,</span>&nbsp;<span class="string" id="7908029">&#34;127.0.0.1:0&#34;</span><span class="op" id="7908042">,</span>&nbsp;<span class="ident" id="7908044">listening</span><span class="op" id="7908053">,</span>&nbsp;<span class="ident" id="7908055">done</span><span class="op" id="7908059">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908062">addr</span>&nbsp;<span class="op" id="7908067">:=</span>&nbsp;<span class="op" id="7908070">&lt;-</span><span class="ident" id="7908072">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908084">testTimeout</span><span class="op" id="7908095">(</span><span class="ident" id="7908096">t</span><span class="op" id="7908097">,</span>&nbsp;<span class="string" id="7908099">&#34;tcp&#34;</span><span class="op" id="7908104">,</span>&nbsp;<span class="ident" id="7908106">addr</span><span class="op" id="7908110">,</span>&nbsp;<span class="builtintype" id="7908112">false</span><span class="op" id="7908117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908120">&lt;-</span><span class="ident" id="7908122">done</span><br>
<span class="lineno"></span><span class="op" id="7908127">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7908130">func</span>&nbsp;<span class="ident" id="7908135">TestDeadlineReset</span><span class="op" id="7908152">(</span><span class="ident" id="7908153">t</span>&nbsp;<span class="op" id="7908155">*</span><span class="ident" id="7908156">testing</span><span class="op" id="7908163">.</span><span class="ident" id="7908164">T</span><span class="op" id="7908165">)</span>&nbsp;<span class="op" id="7908167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908170">switch</span>&nbsp;<span class="ident" id="7908177">runtime</span><span class="op" id="7908184">.</span><span class="ident" id="7908185">GOOS</span>&nbsp;<span class="op" id="7908190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908193">case</span>&nbsp;<span class="string" id="7908198">&#34;plan9&#34;</span><span class="op" id="7908205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908209">t</span><span class="op" id="7908210">.</span><span class="ident" id="7908211">Skipf</span><span class="op" id="7908216">(</span><span class="string" id="7908217">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7908238">,</span>&nbsp;<span class="ident" id="7908240">runtime</span><span class="op" id="7908247">.</span><span class="ident" id="7908248">GOOS</span><span class="op" id="7908252">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908258">ln</span><span class="op" id="7908260">,</span>&nbsp;<span class="ident" id="7908262">err</span>&nbsp;<span class="op" id="7908266">:=</span>&nbsp;<span class="ident" id="7908269">Listen</span><span class="op" id="7908275">(</span><span class="string" id="7908276">&#34;tcp&#34;</span><span class="op" id="7908281">,</span>&nbsp;<span class="string" id="7908283">&#34;127.0.0.1:0&#34;</span><span class="op" id="7908296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908299">if</span>&nbsp;<span class="ident" id="7908302">err</span>&nbsp;<span class="op" id="7908306">!=</span>&nbsp;<span class="ident" id="7908309">nil</span>&nbsp;<span class="op" id="7908313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908317">t</span><span class="op" id="7908318">.</span><span class="ident" id="7908319">Fatal</span><span class="op" id="7908324">(</span><span class="ident" id="7908325">err</span><span class="op" id="7908328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908331">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908334">defer</span>&nbsp;<span class="ident" id="7908340">ln</span><span class="op" id="7908342">.</span><span class="ident" id="7908343">Close</span><span class="op" id="7908348">(</span><span class="op" id="7908349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908352">tl</span>&nbsp;<span class="op" id="7908355">:=</span>&nbsp;<span class="ident" id="7908358">ln</span><span class="op" id="7908360">.</span><span class="op" id="7908361">(</span><span class="op" id="7908362">*</span><span class="ident" id="7908363">TCPListener</span><span class="op" id="7908374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908377">tl</span><span class="op" id="7908379">.</span><span class="ident" id="7908380">SetDeadline</span><span class="op" id="7908391">(</span><span class="ident" id="7908392">time</span><span class="op" id="7908396">.</span><span class="ident" id="7908397">Now</span><span class="op" id="7908400">(</span><span class="op" id="7908401">)</span><span class="op" id="7908402">.</span><span class="ident" id="7908403">Add</span><span class="op" id="7908406">(</span><span class="num" id="7908407">1</span>&nbsp;<span class="op" id="7908409">*</span>&nbsp;<span class="ident" id="7908411">time</span><span class="op" id="7908415">.</span><span class="ident" id="7908416">Minute</span><span class="op" id="7908422">)</span><span class="op" id="7908423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908426">tl</span><span class="op" id="7908428">.</span><span class="ident" id="7908429">SetDeadline</span><span class="op" id="7908440">(</span><span class="ident" id="7908441">noDeadline</span><span class="op" id="7908451">)</span>&nbsp;<span class="comment" id="7908453">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908466">errc</span>&nbsp;<span class="op" id="7908471">:=</span>&nbsp;<span class="builtinfunc" id="7908474">make</span><span class="op" id="7908478">(</span><span class="keyword" id="7908479">chan</span>&nbsp;<span class="builtintype" id="7908484">error</span><span class="op" id="7908489">,</span>&nbsp;<span class="num" id="7908491">1</span><span class="op" id="7908492">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908495">go</span>&nbsp;<span class="keyword" id="7908498">func</span><span class="op" id="7908502">(</span><span class="op" id="7908503">)</span>&nbsp;<span class="op" id="7908505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908509">_</span><span class="op" id="7908510">,</span>&nbsp;<span class="ident" id="7908512">err</span>&nbsp;<span class="op" id="7908516">:=</span>&nbsp;<span class="ident" id="7908519">ln</span><span class="op" id="7908521">.</span><span class="ident" id="7908522">Accept</span><span class="op" id="7908528">(</span><span class="op" id="7908529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908533">errc</span>&nbsp;<span class="op" id="7908538">&lt;-</span>&nbsp;<span class="ident" id="7908541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908546">}</span><span class="op" id="7908547">(</span><span class="op" id="7908548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908551">select</span>&nbsp;<span class="op" id="7908558">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908561">case</span>&nbsp;<span class="op" id="7908566">&lt;-</span><span class="ident" id="7908568">time</span><span class="op" id="7908572">.</span><span class="ident" id="7908573">After</span><span class="op" id="7908578">(</span><span class="num" id="7908579">50</span>&nbsp;<span class="op" id="7908582">*</span>&nbsp;<span class="ident" id="7908584">time</span><span class="op" id="7908588">.</span><span class="ident" id="7908589">Millisecond</span><span class="op" id="7908600">)</span><span class="op" id="7908601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908605">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908615">case</span>&nbsp;<span class="ident" id="7908620">err</span>&nbsp;<span class="op" id="7908624">:=</span>&nbsp;<span class="op" id="7908627">&lt;-</span><span class="ident" id="7908629">errc</span><span class="op" id="7908633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908637">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908679">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908701">t</span><span class="op" id="7908702">.</span><span class="ident" id="7908703">Errorf</span><span class="op" id="7908709">(</span><span class="string" id="7908710">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="7908749">,</span>&nbsp;<span class="ident" id="7908751">err</span><span class="op" id="7908754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908757">}</span><br>
<span class="lineno"></span><span class="op" id="7908759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7908762">func</span>&nbsp;<span class="ident" id="7908767">TestTimeoutAccept</span><span class="op" id="7908784">(</span><span class="ident" id="7908785">t</span>&nbsp;<span class="op" id="7908787">*</span><span class="ident" id="7908788">testing</span><span class="op" id="7908795">.</span><span class="ident" id="7908796">T</span><span class="op" id="7908797">)</span>&nbsp;<span class="op" id="7908799">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908802">switch</span>&nbsp;<span class="ident" id="7908809">runtime</span><span class="op" id="7908816">.</span><span class="ident" id="7908817">GOOS</span>&nbsp;<span class="op" id="7908822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908825">case</span>&nbsp;<span class="string" id="7908830">&#34;plan9&#34;</span><span class="op" id="7908837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908841">t</span><span class="op" id="7908842">.</span><span class="ident" id="7908843">Skipf</span><span class="op" id="7908848">(</span><span class="string" id="7908849">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7908870">,</span>&nbsp;<span class="ident" id="7908872">runtime</span><span class="op" id="7908879">.</span><span class="ident" id="7908880">GOOS</span><span class="op" id="7908884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908890">ln</span><span class="op" id="7908892">,</span>&nbsp;<span class="ident" id="7908894">err</span>&nbsp;<span class="op" id="7908898">:=</span>&nbsp;<span class="ident" id="7908901">Listen</span><span class="op" id="7908907">(</span><span class="string" id="7908908">&#34;tcp&#34;</span><span class="op" id="7908913">,</span>&nbsp;<span class="string" id="7908915">&#34;127.0.0.1:0&#34;</span><span class="op" id="7908928">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908931">if</span>&nbsp;<span class="ident" id="7908934">err</span>&nbsp;<span class="op" id="7908938">!=</span>&nbsp;<span class="ident" id="7908941">nil</span>&nbsp;<span class="op" id="7908945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908949">t</span><span class="op" id="7908950">.</span><span class="ident" id="7908951">Fatal</span><span class="op" id="7908956">(</span><span class="ident" id="7908957">err</span><span class="op" id="7908960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908966">defer</span>&nbsp;<span class="ident" id="7908972">ln</span><span class="op" id="7908974">.</span><span class="ident" id="7908975">Close</span><span class="op" id="7908980">(</span><span class="op" id="7908981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908984">tl</span>&nbsp;<span class="op" id="7908987">:=</span>&nbsp;<span class="ident" id="7908990">ln</span><span class="op" id="7908992">.</span><span class="op" id="7908993">(</span><span class="op" id="7908994">*</span><span class="ident" id="7908995">TCPListener</span><span class="op" id="7909006">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909009">tl</span><span class="op" id="7909011">.</span><span class="ident" id="7909012">SetDeadline</span><span class="op" id="7909023">(</span><span class="ident" id="7909024">time</span><span class="op" id="7909028">.</span><span class="ident" id="7909029">Now</span><span class="op" id="7909032">(</span><span class="op" id="7909033">)</span><span class="op" id="7909034">.</span><span class="ident" id="7909035">Add</span><span class="op" id="7909038">(</span><span class="num" id="7909039">100</span>&nbsp;<span class="op" id="7909043">*</span>&nbsp;<span class="ident" id="7909045">time</span><span class="op" id="7909049">.</span><span class="ident" id="7909050">Millisecond</span><span class="op" id="7909061">)</span><span class="op" id="7909062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909065">errc</span>&nbsp;<span class="op" id="7909070">:=</span>&nbsp;<span class="builtinfunc" id="7909073">make</span><span class="op" id="7909077">(</span><span class="keyword" id="7909078">chan</span>&nbsp;<span class="builtintype" id="7909083">error</span><span class="op" id="7909088">,</span>&nbsp;<span class="num" id="7909090">1</span><span class="op" id="7909091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909094">go</span>&nbsp;<span class="keyword" id="7909097">func</span><span class="op" id="7909101">(</span><span class="op" id="7909102">)</span>&nbsp;<span class="op" id="7909104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909108">_</span><span class="op" id="7909109">,</span>&nbsp;<span class="ident" id="7909111">err</span>&nbsp;<span class="op" id="7909115">:=</span>&nbsp;<span class="ident" id="7909118">ln</span><span class="op" id="7909120">.</span><span class="ident" id="7909121">Accept</span><span class="op" id="7909127">(</span><span class="op" id="7909128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909132">errc</span>&nbsp;<span class="op" id="7909137">&lt;-</span>&nbsp;<span class="ident" id="7909140">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909145">}</span><span class="op" id="7909146">(</span><span class="op" id="7909147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909150">select</span>&nbsp;<span class="op" id="7909157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909160">case</span>&nbsp;<span class="op" id="7909165">&lt;-</span><span class="ident" id="7909167">time</span><span class="op" id="7909171">.</span><span class="ident" id="7909172">After</span><span class="op" id="7909177">(</span><span class="num" id="7909178">1</span>&nbsp;<span class="op" id="7909180">*</span>&nbsp;<span class="ident" id="7909182">time</span><span class="op" id="7909186">.</span><span class="ident" id="7909187">Second</span><span class="op" id="7909193">)</span><span class="op" id="7909194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7909198">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909239">t</span><span class="op" id="7909240">.</span><span class="ident" id="7909241">Errorf</span><span class="op" id="7909247">(</span><span class="string" id="7909248">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="7909290">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909293">case</span>&nbsp;<span class="op" id="7909298">&lt;-</span><span class="ident" id="7909300">errc</span><span class="op" id="7909304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7909308">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909318">}</span><br>
<span class="lineno"></span><span class="op" id="7909320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7909323">func</span>&nbsp;<span class="ident" id="7909328">TestReadWriteDeadline</span><span class="op" id="7909349">(</span><span class="ident" id="7909350">t</span>&nbsp;<span class="op" id="7909352">*</span><span class="ident" id="7909353">testing</span><span class="op" id="7909360">.</span><span class="ident" id="7909361">T</span><span class="op" id="7909362">)</span>&nbsp;<span class="op" id="7909364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909367">switch</span>&nbsp;<span class="ident" id="7909374">runtime</span><span class="op" id="7909381">.</span><span class="ident" id="7909382">GOOS</span>&nbsp;<span class="op" id="7909387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909390">case</span>&nbsp;<span class="string" id="7909395">&#34;plan9&#34;</span><span class="op" id="7909402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909406">t</span><span class="op" id="7909407">.</span><span class="ident" id="7909408">Skipf</span><span class="op" id="7909413">(</span><span class="string" id="7909414">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7909435">,</span>&nbsp;<span class="ident" id="7909437">runtime</span><span class="op" id="7909444">.</span><span class="ident" id="7909445">GOOS</span><span class="op" id="7909449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909452">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909456">const</span>&nbsp;<span class="op" id="7909462">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909466">readTimeout</span>&nbsp;&nbsp;<span class="op" id="7909479">=</span>&nbsp;<span class="num" id="7909481">50</span>&nbsp;<span class="op" id="7909484">*</span>&nbsp;<span class="ident" id="7909486">time</span><span class="op" id="7909490">.</span><span class="ident" id="7909491">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909505">writeTimeout</span>&nbsp;<span class="op" id="7909518">=</span>&nbsp;<span class="num" id="7909520">250</span>&nbsp;<span class="op" id="7909524">*</span>&nbsp;<span class="ident" id="7909526">time</span><span class="op" id="7909530">.</span><span class="ident" id="7909531">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909544">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909547">checkTimeout</span>&nbsp;<span class="op" id="7909560">:=</span>&nbsp;<span class="keyword" id="7909563">func</span><span class="op" id="7909567">(</span><span class="ident" id="7909568">command</span>&nbsp;<span class="builtintype" id="7909576">string</span><span class="op" id="7909582">,</span>&nbsp;<span class="ident" id="7909584">start</span>&nbsp;<span class="ident" id="7909590">time</span><span class="op" id="7909594">.</span><span class="ident" id="7909595">Time</span><span class="op" id="7909599">,</span>&nbsp;<span class="ident" id="7909601">should</span>&nbsp;<span class="ident" id="7909608">time</span><span class="op" id="7909612">.</span><span class="ident" id="7909613">Duration</span><span class="op" id="7909621">)</span>&nbsp;<span class="op" id="7909623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909627">is</span>&nbsp;<span class="op" id="7909630">:=</span>&nbsp;<span class="ident" id="7909633">time</span><span class="op" id="7909637">.</span><span class="ident" id="7909638">Now</span><span class="op" id="7909641">(</span><span class="op" id="7909642">)</span><span class="op" id="7909643">.</span><span class="ident" id="7909644">Sub</span><span class="op" id="7909647">(</span><span class="ident" id="7909648">start</span><span class="op" id="7909653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909657">d</span>&nbsp;<span class="op" id="7909659">:=</span>&nbsp;<span class="ident" id="7909662">is</span>&nbsp;<span class="op" id="7909665">-</span>&nbsp;<span class="ident" id="7909667">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909676">if</span>&nbsp;<span class="ident" id="7909679">d</span>&nbsp;<span class="op" id="7909681">&lt;</span>&nbsp;<span class="op" id="7909683">-</span><span class="num" id="7909684">30</span><span class="op" id="7909686">*</span><span class="ident" id="7909687">time</span><span class="op" id="7909691">.</span><span class="ident" id="7909692">Millisecond</span>&nbsp;<span class="op" id="7909704">||</span>&nbsp;<span class="op" id="7909707">!</span><span class="ident" id="7909708">testing</span><span class="op" id="7909715">.</span><span class="ident" id="7909716">Short</span><span class="op" id="7909721">(</span><span class="op" id="7909722">)</span>&nbsp;<span class="op" id="7909724">&amp;&amp;</span>&nbsp;<span class="num" id="7909727">150</span><span class="op" id="7909730">*</span><span class="ident" id="7909731">time</span><span class="op" id="7909735">.</span><span class="ident" id="7909736">Millisecond</span>&nbsp;<span class="op" id="7909748">&lt;</span>&nbsp;<span class="ident" id="7909750">d</span>&nbsp;<span class="op" id="7909752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909757">t</span><span class="op" id="7909758">.</span><span class="ident" id="7909759">Errorf</span><span class="op" id="7909765">(</span><span class="string" id="7909766">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="7909809">,</span>&nbsp;<span class="ident" id="7909811">command</span><span class="op" id="7909818">,</span>&nbsp;<span class="ident" id="7909820">is</span><span class="op" id="7909822">,</span>&nbsp;<span class="ident" id="7909824">should</span><span class="op" id="7909830">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909841">ln</span><span class="op" id="7909843">,</span>&nbsp;<span class="ident" id="7909845">err</span>&nbsp;<span class="op" id="7909849">:=</span>&nbsp;<span class="ident" id="7909852">Listen</span><span class="op" id="7909858">(</span><span class="string" id="7909859">&#34;tcp&#34;</span><span class="op" id="7909864">,</span>&nbsp;<span class="string" id="7909866">&#34;127.0.0.1:0&#34;</span><span class="op" id="7909879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909882">if</span>&nbsp;<span class="ident" id="7909885">err</span>&nbsp;<span class="op" id="7909889">!=</span>&nbsp;<span class="ident" id="7909892">nil</span>&nbsp;<span class="op" id="7909896">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909900">t</span><span class="op" id="7909901">.</span><span class="ident" id="7909902">Fatalf</span><span class="op" id="7909908">(</span><span class="string" id="7909909">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7909930">,</span>&nbsp;<span class="ident" id="7909932">err</span><span class="op" id="7909935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909941">defer</span>&nbsp;<span class="ident" id="7909947">ln</span><span class="op" id="7909949">.</span><span class="ident" id="7909950">Close</span><span class="op" id="7909955">(</span><span class="op" id="7909956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909960">lnquit</span>&nbsp;<span class="op" id="7909967">:=</span>&nbsp;<span class="builtinfunc" id="7909970">make</span><span class="op" id="7909974">(</span><span class="keyword" id="7909975">chan</span>&nbsp;<span class="builtintype" id="7909980">bool</span><span class="op" id="7909984">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909988">go</span>&nbsp;<span class="keyword" id="7909991">func</span><span class="op" id="7909995">(</span><span class="op" id="7909996">)</span>&nbsp;<span class="op" id="7909998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910002">c</span><span class="op" id="7910003">,</span>&nbsp;<span class="ident" id="7910005">err</span>&nbsp;<span class="op" id="7910009">:=</span>&nbsp;<span class="ident" id="7910012">ln</span><span class="op" id="7910014">.</span><span class="ident" id="7910015">Accept</span><span class="op" id="7910021">(</span><span class="op" id="7910022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910026">if</span>&nbsp;<span class="ident" id="7910029">err</span>&nbsp;<span class="op" id="7910033">!=</span>&nbsp;<span class="ident" id="7910036">nil</span>&nbsp;<span class="op" id="7910040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910045">t</span><span class="op" id="7910046">.</span><span class="ident" id="7910047">Errorf</span><span class="op" id="7910053">(</span><span class="string" id="7910054">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7910066">,</span>&nbsp;<span class="ident" id="7910068">err</span><span class="op" id="7910071">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910089">defer</span>&nbsp;<span class="ident" id="7910095">c</span><span class="op" id="7910096">.</span><span class="ident" id="7910097">Close</span><span class="op" id="7910102">(</span><span class="op" id="7910103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910107">lnquit</span>&nbsp;<span class="op" id="7910114">&lt;-</span>&nbsp;<span class="builtintype" id="7910117">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910123">}</span><span class="op" id="7910124">(</span><span class="op" id="7910125">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910129">c</span><span class="op" id="7910130">,</span>&nbsp;<span class="ident" id="7910132">err</span>&nbsp;<span class="op" id="7910136">:=</span>&nbsp;<span class="ident" id="7910139">Dial</span><span class="op" id="7910143">(</span><span class="string" id="7910144">&#34;tcp&#34;</span><span class="op" id="7910149">,</span>&nbsp;<span class="ident" id="7910151">ln</span><span class="op" id="7910153">.</span><span class="ident" id="7910154">Addr</span><span class="op" id="7910158">(</span><span class="op" id="7910159">)</span><span class="op" id="7910160">.</span><span class="ident" id="7910161">String</span><span class="op" id="7910167">(</span><span class="op" id="7910168">)</span><span class="op" id="7910169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910172">if</span>&nbsp;<span class="ident" id="7910175">err</span>&nbsp;<span class="op" id="7910179">!=</span>&nbsp;<span class="ident" id="7910182">nil</span>&nbsp;<span class="op" id="7910186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910190">t</span><span class="op" id="7910191">.</span><span class="ident" id="7910192">Fatalf</span><span class="op" id="7910198">(</span><span class="string" id="7910199">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7910209">,</span>&nbsp;<span class="ident" id="7910211">err</span><span class="op" id="7910214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910217">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910220">defer</span>&nbsp;<span class="ident" id="7910226">c</span><span class="op" id="7910227">.</span><span class="ident" id="7910228">Close</span><span class="op" id="7910233">(</span><span class="op" id="7910234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910238">start</span>&nbsp;<span class="op" id="7910244">:=</span>&nbsp;<span class="ident" id="7910247">time</span><span class="op" id="7910251">.</span><span class="ident" id="7910252">Now</span><span class="op" id="7910255">(</span><span class="op" id="7910256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910259">err</span>&nbsp;<span class="op" id="7910263">=</span>&nbsp;<span class="ident" id="7910265">c</span><span class="op" id="7910266">.</span><span class="ident" id="7910267">SetReadDeadline</span><span class="op" id="7910282">(</span><span class="ident" id="7910283">start</span><span class="op" id="7910288">.</span><span class="ident" id="7910289">Add</span><span class="op" id="7910292">(</span><span class="ident" id="7910293">readTimeout</span><span class="op" id="7910304">)</span><span class="op" id="7910305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910308">if</span>&nbsp;<span class="ident" id="7910311">err</span>&nbsp;<span class="op" id="7910315">!=</span>&nbsp;<span class="ident" id="7910318">nil</span>&nbsp;<span class="op" id="7910322">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910326">t</span><span class="op" id="7910327">.</span><span class="ident" id="7910328">Fatalf</span><span class="op" id="7910334">(</span><span class="string" id="7910335">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="7910356">,</span>&nbsp;<span class="ident" id="7910358">err</span><span class="op" id="7910361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910367">err</span>&nbsp;<span class="op" id="7910371">=</span>&nbsp;<span class="ident" id="7910373">c</span><span class="op" id="7910374">.</span><span class="ident" id="7910375">SetWriteDeadline</span><span class="op" id="7910391">(</span><span class="ident" id="7910392">start</span><span class="op" id="7910397">.</span><span class="ident" id="7910398">Add</span><span class="op" id="7910401">(</span><span class="ident" id="7910402">writeTimeout</span><span class="op" id="7910414">)</span><span class="op" id="7910415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910418">if</span>&nbsp;<span class="ident" id="7910421">err</span>&nbsp;<span class="op" id="7910425">!=</span>&nbsp;<span class="ident" id="7910428">nil</span>&nbsp;<span class="op" id="7910432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910436">t</span><span class="op" id="7910437">.</span><span class="ident" id="7910438">Fatalf</span><span class="op" id="7910444">(</span><span class="string" id="7910445">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="7910467">,</span>&nbsp;<span class="ident" id="7910469">err</span><span class="op" id="7910472">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910479">quit</span>&nbsp;<span class="op" id="7910484">:=</span>&nbsp;<span class="builtinfunc" id="7910487">make</span><span class="op" id="7910491">(</span><span class="keyword" id="7910492">chan</span>&nbsp;<span class="builtintype" id="7910497">bool</span><span class="op" id="7910501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910505">go</span>&nbsp;<span class="keyword" id="7910508">func</span><span class="op" id="7910512">(</span><span class="op" id="7910513">)</span>&nbsp;<span class="op" id="7910515">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910519">var</span>&nbsp;<span class="ident" id="7910523">buf</span>&nbsp;<span class="op" id="7910527">[</span><span class="num" id="7910528">10</span><span class="op" id="7910530">]</span><span class="builtintype" id="7910531">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910538">_</span><span class="op" id="7910539">,</span>&nbsp;<span class="ident" id="7910541">err</span>&nbsp;<span class="op" id="7910545">:=</span>&nbsp;<span class="ident" id="7910548">c</span><span class="op" id="7910549">.</span><span class="ident" id="7910550">Read</span><span class="op" id="7910554">(</span><span class="ident" id="7910555">buf</span><span class="op" id="7910558">[</span><span class="op" id="7910559">:</span><span class="op" id="7910560">]</span><span class="op" id="7910561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910565">if</span>&nbsp;<span class="ident" id="7910568">err</span>&nbsp;<span class="op" id="7910572">==</span>&nbsp;<span class="ident" id="7910575">nil</span>&nbsp;<span class="op" id="7910579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910584">t</span><span class="op" id="7910585">.</span><span class="ident" id="7910586">Errorf</span><span class="op" id="7910592">(</span><span class="string" id="7910593">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="7910618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910622">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910626">checkTimeout</span><span class="op" id="7910638">(</span><span class="string" id="7910639">&#34;Read&#34;</span><span class="op" id="7910645">,</span>&nbsp;<span class="ident" id="7910647">start</span><span class="op" id="7910652">,</span>&nbsp;<span class="ident" id="7910654">readTimeout</span><span class="op" id="7910665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910669">quit</span>&nbsp;<span class="op" id="7910674">&lt;-</span>&nbsp;<span class="builtintype" id="7910677">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910683">}</span><span class="op" id="7910684">(</span><span class="op" id="7910685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910689">go</span>&nbsp;<span class="keyword" id="7910692">func</span><span class="op" id="7910696">(</span><span class="op" id="7910697">)</span>&nbsp;<span class="op" id="7910699">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910703">var</span>&nbsp;<span class="ident" id="7910707">buf</span>&nbsp;<span class="op" id="7910711">[</span><span class="num" id="7910712">10000</span><span class="op" id="7910717">]</span><span class="builtintype" id="7910718">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910725">for</span>&nbsp;<span class="op" id="7910729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910734">_</span><span class="op" id="7910735">,</span>&nbsp;<span class="ident" id="7910737">err</span>&nbsp;<span class="op" id="7910741">:=</span>&nbsp;<span class="ident" id="7910744">c</span><span class="op" id="7910745">.</span><span class="ident" id="7910746">Write</span><span class="op" id="7910751">(</span><span class="ident" id="7910752">buf</span><span class="op" id="7910755">[</span><span class="op" id="7910756">:</span><span class="op" id="7910757">]</span><span class="op" id="7910758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910763">if</span>&nbsp;<span class="ident" id="7910766">err</span>&nbsp;<span class="op" id="7910770">!=</span>&nbsp;<span class="ident" id="7910773">nil</span>&nbsp;<span class="op" id="7910777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910783">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910800">checkTimeout</span><span class="op" id="7910812">(</span><span class="string" id="7910813">&#34;Write&#34;</span><span class="op" id="7910820">,</span>&nbsp;<span class="ident" id="7910822">start</span><span class="op" id="7910827">,</span>&nbsp;<span class="ident" id="7910829">writeTimeout</span><span class="op" id="7910841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910845">quit</span>&nbsp;<span class="op" id="7910850">&lt;-</span>&nbsp;<span class="builtintype" id="7910853">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910859">}</span><span class="op" id="7910860">(</span><span class="op" id="7910861">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910865">&lt;-</span><span class="ident" id="7910867">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910873">&lt;-</span><span class="ident" id="7910875">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910881">&lt;-</span><span class="ident" id="7910883">lnquit</span><br>
<span class="lineno"></span><span class="op" id="7910890">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="7910893">type</span>&nbsp;<span class="ident" id="7910898">neverEnding</span>&nbsp;<span class="builtintype" id="7910910">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7910916">func</span>&nbsp;<span class="op" id="7910921">(</span><span class="ident" id="7910922">b</span>&nbsp;<span class="ident" id="7910924">neverEnding</span><span class="op" id="7910935">)</span>&nbsp;<span class="ident" id="7910937">Read</span><span class="op" id="7910941">(</span><span class="ident" id="7910942">p</span>&nbsp;<span class="op" id="7910944">[</span><span class="op" id="7910945">]</span><span class="builtintype" id="7910946">byte</span><span class="op" id="7910950">)</span>&nbsp;<span class="op" id="7910952">(</span><span class="ident" id="7910953">n</span>&nbsp;<span class="builtintype" id="7910955">int</span><span class="op" id="7910958">,</span>&nbsp;<span class="ident" id="7910960">err</span>&nbsp;<span class="builtintype" id="7910964">error</span><span class="op" id="7910969">)</span>&nbsp;<span class="op" id="7910971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910974">for</span>&nbsp;<span class="ident" id="7910978">i</span>&nbsp;<span class="op" id="7910980">:=</span>&nbsp;<span class="keyword" id="7910983">range</span>&nbsp;<span class="ident" id="7910989">p</span>&nbsp;<span class="op" id="7910991">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910995">p</span><span class="op" id="7910996">[</span><span class="ident" id="7910997">i</span><span class="op" id="7910998">]</span>&nbsp;<span class="op" id="7911000">=</span>&nbsp;<span class="builtintype" id="7911002">byte</span><span class="op" id="7911006">(</span><span class="ident" id="7911007">b</span><span class="op" id="7911008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911014">return</span>&nbsp;<span class="builtinfunc" id="7911021">len</span><span class="op" id="7911024">(</span><span class="ident" id="7911025">p</span><span class="op" id="7911026">)</span><span class="op" id="7911027">,</span>&nbsp;<span class="ident" id="7911029">nil</span><br>
<span class="lineno"></span><span class="op" id="7911033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="7911036">func</span>&nbsp;<span class="ident" id="7911041">TestVariousDeadlines1Proc</span><span class="op" id="7911066">(</span><span class="ident" id="7911067">t</span>&nbsp;<span class="op" id="7911069">*</span><span class="ident" id="7911070">testing</span><span class="op" id="7911077">.</span><span class="ident" id="7911078">T</span><span class="op" id="7911079">)</span>&nbsp;<span class="op" id="7911081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911084">testVariousDeadlines</span><span class="op" id="7911104">(</span><span class="ident" id="7911105">t</span><span class="op" id="7911106">,</span>&nbsp;<span class="num" id="7911108">1</span><span class="op" id="7911109">)</span><br>
<span class="lineno"></span><span class="op" id="7911111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911114">func</span>&nbsp;<span class="ident" id="7911119">TestVariousDeadlines4Proc</span><span class="op" id="7911144">(</span><span class="ident" id="7911145">t</span>&nbsp;<span class="op" id="7911147">*</span><span class="ident" id="7911148">testing</span><span class="op" id="7911155">.</span><span class="ident" id="7911156">T</span><span class="op" id="7911157">)</span>&nbsp;<span class="op" id="7911159">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911162">testVariousDeadlines</span><span class="op" id="7911182">(</span><span class="ident" id="7911183">t</span><span class="op" id="7911184">,</span>&nbsp;<span class="num" id="7911186">4</span><span class="op" id="7911187">)</span><br>
<span class="lineno"></span><span class="op" id="7911189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911192">func</span>&nbsp;<span class="ident" id="7911197">testVariousDeadlines</span><span class="op" id="7911217">(</span><span class="ident" id="7911218">t</span>&nbsp;<span class="op" id="7911220">*</span><span class="ident" id="7911221">testing</span><span class="op" id="7911228">.</span><span class="ident" id="7911229">T</span><span class="op" id="7911230">,</span>&nbsp;<span class="ident" id="7911232">maxProcs</span>&nbsp;<span class="builtintype" id="7911241">int</span><span class="op" id="7911244">)</span>&nbsp;<span class="op" id="7911246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911249">switch</span>&nbsp;<span class="ident" id="7911256">runtime</span><span class="op" id="7911263">.</span><span class="ident" id="7911264">GOOS</span>&nbsp;<span class="op" id="7911269">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911272">case</span>&nbsp;<span class="string" id="7911277">&#34;plan9&#34;</span><span class="op" id="7911284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911288">t</span><span class="op" id="7911289">.</span><span class="ident" id="7911290">Skipf</span><span class="op" id="7911295">(</span><span class="string" id="7911296">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7911317">,</span>&nbsp;<span class="ident" id="7911319">runtime</span><span class="op" id="7911326">.</span><span class="ident" id="7911327">GOOS</span><span class="op" id="7911331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911338">defer</span>&nbsp;<span class="ident" id="7911344">runtime</span><span class="op" id="7911351">.</span><span class="ident" id="7911352">GOMAXPROCS</span><span class="op" id="7911362">(</span><span class="ident" id="7911363">runtime</span><span class="op" id="7911370">.</span><span class="ident" id="7911371">GOMAXPROCS</span><span class="op" id="7911381">(</span><span class="ident" id="7911382">maxProcs</span><span class="op" id="7911390">)</span><span class="op" id="7911391">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911394">ln</span>&nbsp;<span class="op" id="7911397">:=</span>&nbsp;<span class="ident" id="7911400">newLocalListener</span><span class="op" id="7911416">(</span><span class="ident" id="7911417">t</span><span class="op" id="7911418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911421">defer</span>&nbsp;<span class="ident" id="7911427">ln</span><span class="op" id="7911429">.</span><span class="ident" id="7911430">Close</span><span class="op" id="7911435">(</span><span class="op" id="7911436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911439">acceptc</span>&nbsp;<span class="op" id="7911447">:=</span>&nbsp;<span class="builtinfunc" id="7911450">make</span><span class="op" id="7911454">(</span><span class="keyword" id="7911455">chan</span>&nbsp;<span class="builtintype" id="7911460">error</span><span class="op" id="7911465">,</span>&nbsp;<span class="num" id="7911467">1</span><span class="op" id="7911468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7911472">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7911542">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911565">servec</span>&nbsp;<span class="op" id="7911572">:=</span>&nbsp;<span class="builtinfunc" id="7911575">make</span><span class="op" id="7911579">(</span><span class="keyword" id="7911580">chan</span>&nbsp;<span class="ident" id="7911585">copyRes</span><span class="op" id="7911592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911595">go</span>&nbsp;<span class="keyword" id="7911598">func</span><span class="op" id="7911602">(</span><span class="op" id="7911603">)</span>&nbsp;<span class="op" id="7911605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911609">for</span>&nbsp;<span class="op" id="7911613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911618">c</span><span class="op" id="7911619">,</span>&nbsp;<span class="ident" id="7911621">err</span>&nbsp;<span class="op" id="7911625">:=</span>&nbsp;<span class="ident" id="7911628">ln</span><span class="op" id="7911630">.</span><span class="ident" id="7911631">Accept</span><span class="op" id="7911637">(</span><span class="op" id="7911638">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911643">if</span>&nbsp;<span class="ident" id="7911646">err</span>&nbsp;<span class="op" id="7911650">!=</span>&nbsp;<span class="ident" id="7911653">nil</span>&nbsp;<span class="op" id="7911657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911663">acceptc</span>&nbsp;<span class="op" id="7911671">&lt;-</span>&nbsp;<span class="ident" id="7911674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911682">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911697">go</span>&nbsp;<span class="keyword" id="7911700">func</span><span class="op" id="7911704">(</span><span class="op" id="7911705">)</span>&nbsp;<span class="op" id="7911707">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911713">t0</span>&nbsp;<span class="op" id="7911716">:=</span>&nbsp;<span class="ident" id="7911719">time</span><span class="op" id="7911723">.</span><span class="ident" id="7911724">Now</span><span class="op" id="7911727">(</span><span class="op" id="7911728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911734">n</span><span class="op" id="7911735">,</span>&nbsp;<span class="ident" id="7911737">err</span>&nbsp;<span class="op" id="7911741">:=</span>&nbsp;<span class="ident" id="7911744">io</span><span class="op" id="7911746">.</span><span class="ident" id="7911747">Copy</span><span class="op" id="7911751">(</span><span class="ident" id="7911752">c</span><span class="op" id="7911753">,</span>&nbsp;<span class="ident" id="7911755">neverEnding</span><span class="op" id="7911766">(</span><span class="string" id="7911767">&#39;a&#39;</span><span class="op" id="7911770">)</span><span class="op" id="7911771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911777">d</span>&nbsp;<span class="op" id="7911779">:=</span>&nbsp;<span class="ident" id="7911782">time</span><span class="op" id="7911786">.</span><span class="ident" id="7911787">Since</span><span class="op" id="7911792">(</span><span class="ident" id="7911793">t0</span><span class="op" id="7911795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911801">c</span><span class="op" id="7911802">.</span><span class="ident" id="7911803">Close</span><span class="op" id="7911808">(</span><span class="op" id="7911809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911815">servec</span>&nbsp;<span class="op" id="7911822">&lt;-</span>&nbsp;<span class="ident" id="7911825">copyRes</span><span class="op" id="7911832">{</span><span class="ident" id="7911833">n</span><span class="op" id="7911834">,</span>&nbsp;<span class="ident" id="7911836">err</span><span class="op" id="7911839">,</span>&nbsp;<span class="ident" id="7911841">d</span><span class="op" id="7911842">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911847">}</span><span class="op" id="7911848">(</span><span class="op" id="7911849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911856">}</span><span class="op" id="7911857">(</span><span class="op" id="7911858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911862">for</span>&nbsp;<span class="ident" id="7911866">_</span><span class="op" id="7911867">,</span>&nbsp;<span class="ident" id="7911869">timeout</span>&nbsp;<span class="op" id="7911877">:=</span>&nbsp;<span class="keyword" id="7911880">range</span>&nbsp;<span class="op" id="7911886">[</span><span class="op" id="7911887">]</span><span class="ident" id="7911888">time</span><span class="op" id="7911892">.</span><span class="ident" id="7911893">Duration</span><span class="op" id="7911901">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7911905">1</span>&nbsp;<span class="op" id="7911907">*</span>&nbsp;<span class="ident" id="7911909">time</span><span class="op" id="7911913">.</span><span class="ident" id="7911914">Nanosecond</span><span class="op" id="7911924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7911928">2</span>&nbsp;<span class="op" id="7911930">*</span>&nbsp;<span class="ident" id="7911932">time</span><span class="op" id="7911936">.</span><span class="ident" id="7911937">Nanosecond</span><span class="op" id="7911947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7911951">5</span>&nbsp;<span class="op" id="7911953">*</span>&nbsp;<span class="ident" id="7911955">time</span><span class="op" id="7911959">.</span><span class="ident" id="7911960">Nanosecond</span><span class="op" id="7911970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7911974">50</span>&nbsp;<span class="op" id="7911977">*</span>&nbsp;<span class="ident" id="7911979">time</span><span class="op" id="7911983">.</span><span class="ident" id="7911984">Nanosecond</span><span class="op" id="7911994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7911998">100</span>&nbsp;<span class="op" id="7912002">*</span>&nbsp;<span class="ident" id="7912004">time</span><span class="op" id="7912008">.</span><span class="ident" id="7912009">Nanosecond</span><span class="op" id="7912019">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912023">200</span>&nbsp;<span class="op" id="7912027">*</span>&nbsp;<span class="ident" id="7912029">time</span><span class="op" id="7912033">.</span><span class="ident" id="7912034">Nanosecond</span><span class="op" id="7912044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912048">500</span>&nbsp;<span class="op" id="7912052">*</span>&nbsp;<span class="ident" id="7912054">time</span><span class="op" id="7912058">.</span><span class="ident" id="7912059">Nanosecond</span><span class="op" id="7912069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912073">750</span>&nbsp;<span class="op" id="7912077">*</span>&nbsp;<span class="ident" id="7912079">time</span><span class="op" id="7912083">.</span><span class="ident" id="7912084">Nanosecond</span><span class="op" id="7912094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912098">1</span>&nbsp;<span class="op" id="7912100">*</span>&nbsp;<span class="ident" id="7912102">time</span><span class="op" id="7912106">.</span><span class="ident" id="7912107">Microsecond</span><span class="op" id="7912118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912122">5</span>&nbsp;<span class="op" id="7912124">*</span>&nbsp;<span class="ident" id="7912126">time</span><span class="op" id="7912130">.</span><span class="ident" id="7912131">Microsecond</span><span class="op" id="7912142">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912146">25</span>&nbsp;<span class="op" id="7912149">*</span>&nbsp;<span class="ident" id="7912151">time</span><span class="op" id="7912155">.</span><span class="ident" id="7912156">Microsecond</span><span class="op" id="7912167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912171">250</span>&nbsp;<span class="op" id="7912175">*</span>&nbsp;<span class="ident" id="7912177">time</span><span class="op" id="7912181">.</span><span class="ident" id="7912182">Microsecond</span><span class="op" id="7912193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912197">500</span>&nbsp;<span class="op" id="7912201">*</span>&nbsp;<span class="ident" id="7912203">time</span><span class="op" id="7912207">.</span><span class="ident" id="7912208">Microsecond</span><span class="op" id="7912219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912223">1</span>&nbsp;<span class="op" id="7912225">*</span>&nbsp;<span class="ident" id="7912227">time</span><span class="op" id="7912231">.</span><span class="ident" id="7912232">Millisecond</span><span class="op" id="7912243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912247">5</span>&nbsp;<span class="op" id="7912249">*</span>&nbsp;<span class="ident" id="7912251">time</span><span class="op" id="7912255">.</span><span class="ident" id="7912256">Millisecond</span><span class="op" id="7912267">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912271">100</span>&nbsp;<span class="op" id="7912275">*</span>&nbsp;<span class="ident" id="7912277">time</span><span class="op" id="7912281">.</span><span class="ident" id="7912282">Millisecond</span><span class="op" id="7912293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912297">250</span>&nbsp;<span class="op" id="7912301">*</span>&nbsp;<span class="ident" id="7912303">time</span><span class="op" id="7912307">.</span><span class="ident" id="7912308">Millisecond</span><span class="op" id="7912319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912323">500</span>&nbsp;<span class="op" id="7912327">*</span>&nbsp;<span class="ident" id="7912329">time</span><span class="op" id="7912333">.</span><span class="ident" id="7912334">Millisecond</span><span class="op" id="7912345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7912349">1</span>&nbsp;<span class="op" id="7912351">*</span>&nbsp;<span class="ident" id="7912353">time</span><span class="op" id="7912357">.</span><span class="ident" id="7912358">Second</span><span class="op" id="7912364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912367">}</span>&nbsp;<span class="op" id="7912369">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912373">numRuns</span>&nbsp;<span class="op" id="7912381">:=</span>&nbsp;<span class="num" id="7912384">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912388">if</span>&nbsp;<span class="ident" id="7912391">testing</span><span class="op" id="7912398">.</span><span class="ident" id="7912399">Short</span><span class="op" id="7912404">(</span><span class="op" id="7912405">)</span>&nbsp;<span class="op" id="7912407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912412">numRuns</span>&nbsp;<span class="op" id="7912420">=</span>&nbsp;<span class="num" id="7912422">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912427">if</span>&nbsp;<span class="ident" id="7912430">timeout</span>&nbsp;<span class="op" id="7912438">&gt;</span>&nbsp;<span class="num" id="7912440">500</span><span class="op" id="7912443">*</span><span class="ident" id="7912444">time</span><span class="op" id="7912448">.</span><span class="ident" id="7912449">Microsecond</span>&nbsp;<span class="op" id="7912461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912467">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912487">for</span>&nbsp;<span class="ident" id="7912491">run</span>&nbsp;<span class="op" id="7912495">:=</span>&nbsp;<span class="num" id="7912498">0</span><span class="op" id="7912499">;</span>&nbsp;<span class="ident" id="7912501">run</span>&nbsp;<span class="op" id="7912505">&lt;</span>&nbsp;<span class="ident" id="7912507">numRuns</span><span class="op" id="7912514">;</span>&nbsp;<span class="ident" id="7912516">run</span><span class="op" id="7912519">++</span>&nbsp;<span class="op" id="7912522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912527">name</span>&nbsp;<span class="op" id="7912532">:=</span>&nbsp;<span class="ident" id="7912535">fmt</span><span class="op" id="7912538">.</span><span class="ident" id="7912539">Sprintf</span><span class="op" id="7912546">(</span><span class="string" id="7912547">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="7912561">,</span>&nbsp;<span class="ident" id="7912563">timeout</span><span class="op" id="7912570">,</span>&nbsp;<span class="ident" id="7912572">run</span><span class="op" id="7912575">+</span><span class="num" id="7912576">1</span><span class="op" id="7912577">,</span>&nbsp;<span class="ident" id="7912579">numRuns</span><span class="op" id="7912586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912591">t</span><span class="op" id="7912592">.</span><span class="ident" id="7912593">Log</span><span class="op" id="7912596">(</span><span class="ident" id="7912597">name</span><span class="op" id="7912601">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912607">c</span><span class="op" id="7912608">,</span>&nbsp;<span class="ident" id="7912610">err</span>&nbsp;<span class="op" id="7912614">:=</span>&nbsp;<span class="ident" id="7912617">Dial</span><span class="op" id="7912621">(</span><span class="string" id="7912622">&#34;tcp&#34;</span><span class="op" id="7912627">,</span>&nbsp;<span class="ident" id="7912629">ln</span><span class="op" id="7912631">.</span><span class="ident" id="7912632">Addr</span><span class="op" id="7912636">(</span><span class="op" id="7912637">)</span><span class="op" id="7912638">.</span><span class="ident" id="7912639">String</span><span class="op" id="7912645">(</span><span class="op" id="7912646">)</span><span class="op" id="7912647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912652">if</span>&nbsp;<span class="ident" id="7912655">err</span>&nbsp;<span class="op" id="7912659">!=</span>&nbsp;<span class="ident" id="7912662">nil</span>&nbsp;<span class="op" id="7912666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912672">t</span><span class="op" id="7912673">.</span><span class="ident" id="7912674">Fatalf</span><span class="op" id="7912680">(</span><span class="string" id="7912681">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7912691">,</span>&nbsp;<span class="ident" id="7912693">err</span><span class="op" id="7912696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912701">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912706">clientc</span>&nbsp;<span class="op" id="7912714">:=</span>&nbsp;<span class="builtinfunc" id="7912717">make</span><span class="op" id="7912721">(</span><span class="keyword" id="7912722">chan</span>&nbsp;<span class="ident" id="7912727">copyRes</span><span class="op" id="7912734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912739">go</span>&nbsp;<span class="keyword" id="7912742">func</span><span class="op" id="7912746">(</span><span class="op" id="7912747">)</span>&nbsp;<span class="op" id="7912749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912755">t0</span>&nbsp;<span class="op" id="7912758">:=</span>&nbsp;<span class="ident" id="7912761">time</span><span class="op" id="7912765">.</span><span class="ident" id="7912766">Now</span><span class="op" id="7912769">(</span><span class="op" id="7912770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912776">c</span><span class="op" id="7912777">.</span><span class="ident" id="7912778">SetDeadline</span><span class="op" id="7912789">(</span><span class="ident" id="7912790">t0</span><span class="op" id="7912792">.</span><span class="ident" id="7912793">Add</span><span class="op" id="7912796">(</span><span class="ident" id="7912797">timeout</span><span class="op" id="7912804">)</span><span class="op" id="7912805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912811">n</span><span class="op" id="7912812">,</span>&nbsp;<span class="ident" id="7912814">err</span>&nbsp;<span class="op" id="7912818">:=</span>&nbsp;<span class="ident" id="7912821">io</span><span class="op" id="7912823">.</span><span class="ident" id="7912824">Copy</span><span class="op" id="7912828">(</span><span class="ident" id="7912829">ioutil</span><span class="op" id="7912835">.</span><span class="ident" id="7912836">Discard</span><span class="op" id="7912843">,</span>&nbsp;<span class="ident" id="7912845">c</span><span class="op" id="7912846">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912852">d</span>&nbsp;<span class="op" id="7912854">:=</span>&nbsp;<span class="ident" id="7912857">time</span><span class="op" id="7912861">.</span><span class="ident" id="7912862">Since</span><span class="op" id="7912867">(</span><span class="ident" id="7912868">t0</span><span class="op" id="7912870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912876">c</span><span class="op" id="7912877">.</span><span class="ident" id="7912878">Close</span><span class="op" id="7912883">(</span><span class="op" id="7912884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912890">clientc</span>&nbsp;<span class="op" id="7912898">&lt;-</span>&nbsp;<span class="ident" id="7912901">copyRes</span><span class="op" id="7912908">{</span><span class="ident" id="7912909">n</span><span class="op" id="7912910">,</span>&nbsp;<span class="ident" id="7912912">err</span><span class="op" id="7912915">,</span>&nbsp;<span class="ident" id="7912917">d</span><span class="op" id="7912918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912923">}</span><span class="op" id="7912924">(</span><span class="op" id="7912925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912931">tooLong</span>&nbsp;<span class="op" id="7912939">:=</span>&nbsp;<span class="num" id="7912942">5</span>&nbsp;<span class="op" id="7912944">*</span>&nbsp;<span class="ident" id="7912946">time</span><span class="op" id="7912950">.</span><span class="ident" id="7912951">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912961">select</span>&nbsp;<span class="op" id="7912968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912973">case</span>&nbsp;<span class="ident" id="7912978">res</span>&nbsp;<span class="op" id="7912982">:=</span>&nbsp;<span class="op" id="7912985">&lt;-</span><span class="ident" id="7912987">clientc</span><span class="op" id="7912994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913000">if</span>&nbsp;<span class="ident" id="7913003">isTimeout</span><span class="op" id="7913012">(</span><span class="ident" id="7913013">res</span><span class="op" id="7913016">.</span><span class="ident" id="7913017">err</span><span class="op" id="7913020">)</span>&nbsp;<span class="op" id="7913022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913029">t</span><span class="op" id="7913030">.</span><span class="ident" id="7913031">Logf</span><span class="op" id="7913035">(</span><span class="string" id="7913036">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7913092">,</span>&nbsp;<span class="ident" id="7913094">name</span><span class="op" id="7913098">,</span>&nbsp;<span class="ident" id="7913100">res</span><span class="op" id="7913103">.</span><span class="ident" id="7913104">d</span><span class="op" id="7913105">,</span>&nbsp;<span class="ident" id="7913107">res</span><span class="op" id="7913110">.</span><span class="ident" id="7913111">n</span><span class="op" id="7913112">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913118">}</span>&nbsp;<span class="keyword" id="7913120">else</span>&nbsp;<span class="op" id="7913125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913132">t</span><span class="op" id="7913133">.</span><span class="ident" id="7913134">Fatalf</span><span class="op" id="7913140">(</span><span class="string" id="7913141">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="7913186">,</span>&nbsp;<span class="ident" id="7913188">name</span><span class="op" id="7913192">,</span>&nbsp;<span class="ident" id="7913194">res</span><span class="op" id="7913197">.</span><span class="ident" id="7913198">n</span><span class="op" id="7913199">,</span>&nbsp;<span class="ident" id="7913201">res</span><span class="op" id="7913204">.</span><span class="ident" id="7913205">err</span><span class="op" id="7913208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913219">case</span>&nbsp;<span class="op" id="7913224">&lt;-</span><span class="ident" id="7913226">time</span><span class="op" id="7913230">.</span><span class="ident" id="7913231">After</span><span class="op" id="7913236">(</span><span class="ident" id="7913237">tooLong</span><span class="op" id="7913244">)</span><span class="op" id="7913245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913251">t</span><span class="op" id="7913252">.</span><span class="ident" id="7913253">Fatalf</span><span class="op" id="7913259">(</span><span class="string" id="7913260">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="7913325">,</span>&nbsp;<span class="ident" id="7913327">name</span><span class="op" id="7913331">,</span>&nbsp;<span class="ident" id="7913333">tooLong</span><span class="op" id="7913340">,</span>&nbsp;<span class="ident" id="7913342">timeout</span><span class="op" id="7913349">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913360">select</span>&nbsp;<span class="op" id="7913367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913372">case</span>&nbsp;<span class="ident" id="7913377">res</span>&nbsp;<span class="op" id="7913381">:=</span>&nbsp;<span class="op" id="7913384">&lt;-</span><span class="ident" id="7913386">servec</span><span class="op" id="7913392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913398">t</span><span class="op" id="7913399">.</span><span class="ident" id="7913400">Logf</span><span class="op" id="7913404">(</span><span class="string" id="7913405">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="7913440">,</span>&nbsp;<span class="ident" id="7913442">name</span><span class="op" id="7913446">,</span>&nbsp;<span class="ident" id="7913448">res</span><span class="op" id="7913451">.</span><span class="ident" id="7913452">d</span><span class="op" id="7913453">,</span>&nbsp;<span class="ident" id="7913455">res</span><span class="op" id="7913458">.</span><span class="ident" id="7913459">n</span><span class="op" id="7913460">,</span>&nbsp;<span class="ident" id="7913462">res</span><span class="op" id="7913465">.</span><span class="ident" id="7913466">err</span><span class="op" id="7913469">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913474">case</span>&nbsp;<span class="ident" id="7913479">err</span>&nbsp;<span class="op" id="7913483">:=</span>&nbsp;<span class="op" id="7913486">&lt;-</span><span class="ident" id="7913488">acceptc</span><span class="op" id="7913495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913501">t</span><span class="op" id="7913502">.</span><span class="ident" id="7913503">Fatalf</span><span class="op" id="7913509">(</span><span class="string" id="7913510">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7913538">,</span>&nbsp;<span class="ident" id="7913540">name</span><span class="op" id="7913544">,</span>&nbsp;<span class="ident" id="7913546">err</span><span class="op" id="7913549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913554">case</span>&nbsp;<span class="op" id="7913559">&lt;-</span><span class="ident" id="7913561">time</span><span class="op" id="7913565">.</span><span class="ident" id="7913566">After</span><span class="op" id="7913571">(</span><span class="ident" id="7913572">tooLong</span><span class="op" id="7913579">)</span><span class="op" id="7913580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913586">t</span><span class="op" id="7913587">.</span><span class="ident" id="7913588">Fatalf</span><span class="op" id="7913594">(</span><span class="string" id="7913595">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="7913649">,</span>&nbsp;<span class="ident" id="7913651">name</span><span class="op" id="7913655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913660">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913667">}</span><br>
<span class="lineno"></span><span class="op" id="7913669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7913672">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="7913742">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="7913779">func</span>&nbsp;<span class="ident" id="7913784">TestReadDeadlineDataAvailable</span><span class="op" id="7913813">(</span><span class="ident" id="7913814">t</span>&nbsp;<span class="op" id="7913816">*</span><span class="ident" id="7913817">testing</span><span class="op" id="7913824">.</span><span class="ident" id="7913825">T</span><span class="op" id="7913826">)</span>&nbsp;<span class="op" id="7913828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913831">switch</span>&nbsp;<span class="ident" id="7913838">runtime</span><span class="op" id="7913845">.</span><span class="ident" id="7913846">GOOS</span>&nbsp;<span class="op" id="7913851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913854">case</span>&nbsp;<span class="string" id="7913859">&#34;plan9&#34;</span><span class="op" id="7913866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913870">t</span><span class="op" id="7913871">.</span><span class="ident" id="7913872">Skipf</span><span class="op" id="7913877">(</span><span class="string" id="7913878">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7913899">,</span>&nbsp;<span class="ident" id="7913901">runtime</span><span class="op" id="7913908">.</span><span class="ident" id="7913909">GOOS</span><span class="op" id="7913913">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913920">ln</span>&nbsp;<span class="op" id="7913923">:=</span>&nbsp;<span class="ident" id="7913926">newLocalListener</span><span class="op" id="7913942">(</span><span class="ident" id="7913943">t</span><span class="op" id="7913944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913947">defer</span>&nbsp;<span class="ident" id="7913953">ln</span><span class="op" id="7913955">.</span><span class="ident" id="7913956">Close</span><span class="op" id="7913961">(</span><span class="op" id="7913962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913966">servec</span>&nbsp;<span class="op" id="7913973">:=</span>&nbsp;<span class="builtinfunc" id="7913976">make</span><span class="op" id="7913980">(</span><span class="keyword" id="7913981">chan</span>&nbsp;<span class="ident" id="7913986">copyRes</span><span class="op" id="7913993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913996">const</span>&nbsp;<span class="ident" id="7914002">msg</span>&nbsp;<span class="op" id="7914006">=</span>&nbsp;<span class="string" id="7914008">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914068">go</span>&nbsp;<span class="keyword" id="7914071">func</span><span class="op" id="7914075">(</span><span class="op" id="7914076">)</span>&nbsp;<span class="op" id="7914078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914082">c</span><span class="op" id="7914083">,</span>&nbsp;<span class="ident" id="7914085">err</span>&nbsp;<span class="op" id="7914089">:=</span>&nbsp;<span class="ident" id="7914092">ln</span><span class="op" id="7914094">.</span><span class="ident" id="7914095">Accept</span><span class="op" id="7914101">(</span><span class="op" id="7914102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914106">if</span>&nbsp;<span class="ident" id="7914109">err</span>&nbsp;<span class="op" id="7914113">!=</span>&nbsp;<span class="ident" id="7914116">nil</span>&nbsp;<span class="op" id="7914120">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914125">t</span><span class="op" id="7914126">.</span><span class="ident" id="7914127">Errorf</span><span class="op" id="7914133">(</span><span class="string" id="7914134">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7914146">,</span>&nbsp;<span class="ident" id="7914148">err</span><span class="op" id="7914151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914169">defer</span>&nbsp;<span class="ident" id="7914175">c</span><span class="op" id="7914176">.</span><span class="ident" id="7914177">Close</span><span class="op" id="7914182">(</span><span class="op" id="7914183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914187">n</span><span class="op" id="7914188">,</span>&nbsp;<span class="ident" id="7914190">err</span>&nbsp;<span class="op" id="7914194">:=</span>&nbsp;<span class="ident" id="7914197">c</span><span class="op" id="7914198">.</span><span class="ident" id="7914199">Write</span><span class="op" id="7914204">(</span><span class="op" id="7914205">[</span><span class="op" id="7914206">]</span><span class="builtintype" id="7914207">byte</span><span class="op" id="7914211">(</span><span class="ident" id="7914212">msg</span><span class="op" id="7914215">)</span><span class="op" id="7914216">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914220">servec</span>&nbsp;<span class="op" id="7914227">&lt;-</span>&nbsp;<span class="ident" id="7914230">copyRes</span><span class="op" id="7914237">{</span><span class="ident" id="7914238">n</span><span class="op" id="7914239">:</span>&nbsp;<span class="ident" id="7914241">int64</span><span class="op" id="7914246">(</span><span class="ident" id="7914247">n</span><span class="op" id="7914248">)</span><span class="op" id="7914249">,</span>&nbsp;<span class="ident" id="7914251">err</span><span class="op" id="7914254">:</span>&nbsp;<span class="ident" id="7914256">err</span><span class="op" id="7914259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914262">}</span><span class="op" id="7914263">(</span><span class="op" id="7914264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914268">c</span><span class="op" id="7914269">,</span>&nbsp;<span class="ident" id="7914271">err</span>&nbsp;<span class="op" id="7914275">:=</span>&nbsp;<span class="ident" id="7914278">Dial</span><span class="op" id="7914282">(</span><span class="string" id="7914283">&#34;tcp&#34;</span><span class="op" id="7914288">,</span>&nbsp;<span class="ident" id="7914290">ln</span><span class="op" id="7914292">.</span><span class="ident" id="7914293">Addr</span><span class="op" id="7914297">(</span><span class="op" id="7914298">)</span><span class="op" id="7914299">.</span><span class="ident" id="7914300">String</span><span class="op" id="7914306">(</span><span class="op" id="7914307">)</span><span class="op" id="7914308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914311">if</span>&nbsp;<span class="ident" id="7914314">err</span>&nbsp;<span class="op" id="7914318">!=</span>&nbsp;<span class="ident" id="7914321">nil</span>&nbsp;<span class="op" id="7914325">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914329">t</span><span class="op" id="7914330">.</span><span class="ident" id="7914331">Fatalf</span><span class="op" id="7914337">(</span><span class="string" id="7914338">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7914348">,</span>&nbsp;<span class="ident" id="7914350">err</span><span class="op" id="7914353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914359">defer</span>&nbsp;<span class="ident" id="7914365">c</span><span class="op" id="7914366">.</span><span class="ident" id="7914367">Close</span><span class="op" id="7914372">(</span><span class="op" id="7914373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914376">if</span>&nbsp;<span class="ident" id="7914379">res</span>&nbsp;<span class="op" id="7914383">:=</span>&nbsp;<span class="op" id="7914386">&lt;-</span><span class="ident" id="7914388">servec</span><span class="op" id="7914394">;</span>&nbsp;<span class="ident" id="7914396">res</span><span class="op" id="7914399">.</span><span class="ident" id="7914400">err</span>&nbsp;<span class="op" id="7914404">!=</span>&nbsp;<span class="ident" id="7914407">nil</span>&nbsp;<span class="op" id="7914411">||</span>&nbsp;<span class="ident" id="7914414">res</span><span class="op" id="7914417">.</span><span class="ident" id="7914418">n</span>&nbsp;<span class="op" id="7914420">!=</span>&nbsp;<span class="ident" id="7914423">int64</span><span class="op" id="7914428">(</span><span class="builtinfunc" id="7914429">len</span><span class="op" id="7914432">(</span><span class="ident" id="7914433">msg</span><span class="op" id="7914436">)</span><span class="op" id="7914437">)</span>&nbsp;<span class="op" id="7914439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914443">t</span><span class="op" id="7914444">.</span><span class="ident" id="7914445">Fatalf</span><span class="op" id="7914451">(</span><span class="string" id="7914452">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="7914511">,</span>&nbsp;<span class="ident" id="7914513">res</span><span class="op" id="7914516">.</span><span class="ident" id="7914517">n</span><span class="op" id="7914518">,</span>&nbsp;<span class="ident" id="7914520">res</span><span class="op" id="7914523">.</span><span class="ident" id="7914524">err</span><span class="op" id="7914527">,</span>&nbsp;<span class="builtinfunc" id="7914529">len</span><span class="op" id="7914532">(</span><span class="ident" id="7914533">msg</span><span class="op" id="7914536">)</span><span class="op" id="7914537">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914543">c</span><span class="op" id="7914544">.</span><span class="ident" id="7914545">SetReadDeadline</span><span class="op" id="7914560">(</span><span class="ident" id="7914561">time</span><span class="op" id="7914565">.</span><span class="ident" id="7914566">Now</span><span class="op" id="7914569">(</span><span class="op" id="7914570">)</span><span class="op" id="7914571">.</span><span class="ident" id="7914572">Add</span><span class="op" id="7914575">(</span><span class="op" id="7914576">-</span><span class="num" id="7914577">5</span>&nbsp;<span class="op" id="7914579">*</span>&nbsp;<span class="ident" id="7914581">time</span><span class="op" id="7914585">.</span><span class="ident" id="7914586">Second</span><span class="op" id="7914592">)</span><span class="op" id="7914593">)</span>&nbsp;<span class="comment" id="7914595">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914612">buf</span>&nbsp;<span class="op" id="7914616">:=</span>&nbsp;<span class="builtinfunc" id="7914619">make</span><span class="op" id="7914623">(</span><span class="op" id="7914624">[</span><span class="op" id="7914625">]</span><span class="builtintype" id="7914626">byte</span><span class="op" id="7914630">,</span>&nbsp;<span class="builtinfunc" id="7914632">len</span><span class="op" id="7914635">(</span><span class="ident" id="7914636">msg</span><span class="op" id="7914639">)</span><span class="op" id="7914640">/</span><span class="num" id="7914641">2</span><span class="op" id="7914642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914645">n</span><span class="op" id="7914646">,</span>&nbsp;<span class="ident" id="7914648">err</span>&nbsp;<span class="op" id="7914652">:=</span>&nbsp;<span class="ident" id="7914655">c</span><span class="op" id="7914656">.</span><span class="ident" id="7914657">Read</span><span class="op" id="7914661">(</span><span class="ident" id="7914662">buf</span><span class="op" id="7914665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914668">if</span>&nbsp;<span class="ident" id="7914671">n</span>&nbsp;<span class="op" id="7914673">&gt;</span>&nbsp;<span class="num" id="7914675">0</span>&nbsp;<span class="op" id="7914677">||</span>&nbsp;<span class="op" id="7914680">!</span><span class="ident" id="7914681">isTimeout</span><span class="op" id="7914690">(</span><span class="ident" id="7914691">err</span><span class="op" id="7914694">)</span>&nbsp;<span class="op" id="7914696">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914700">t</span><span class="op" id="7914701">.</span><span class="ident" id="7914702">Fatalf</span><span class="op" id="7914708">(</span><span class="string" id="7914709">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="7914756">,</span>&nbsp;<span class="ident" id="7914758">n</span><span class="op" id="7914759">,</span>&nbsp;<span class="ident" id="7914761">buf</span><span class="op" id="7914764">[</span><span class="op" id="7914765">:</span><span class="ident" id="7914766">n</span><span class="op" id="7914767">]</span><span class="op" id="7914768">,</span>&nbsp;<span class="ident" id="7914770">err</span><span class="op" id="7914773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914776">}</span><br>
<span class="lineno"></span><span class="op" id="7914778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7914781">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="7914855">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="7914902">func</span>&nbsp;<span class="ident" id="7914907">TestWriteDeadlineBufferAvailable</span><span class="op" id="7914939">(</span><span class="ident" id="7914940">t</span>&nbsp;<span class="op" id="7914942">*</span><span class="ident" id="7914943">testing</span><span class="op" id="7914950">.</span><span class="ident" id="7914951">T</span><span class="op" id="7914952">)</span>&nbsp;<span class="op" id="7914954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914957">switch</span>&nbsp;<span class="ident" id="7914964">runtime</span><span class="op" id="7914971">.</span><span class="ident" id="7914972">GOOS</span>&nbsp;<span class="op" id="7914977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914980">case</span>&nbsp;<span class="string" id="7914985">&#34;plan9&#34;</span><span class="op" id="7914992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914996">t</span><span class="op" id="7914997">.</span><span class="ident" id="7914998">Skipf</span><span class="op" id="7915003">(</span><span class="string" id="7915004">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7915025">,</span>&nbsp;<span class="ident" id="7915027">runtime</span><span class="op" id="7915034">.</span><span class="ident" id="7915035">GOOS</span><span class="op" id="7915039">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915046">ln</span>&nbsp;<span class="op" id="7915049">:=</span>&nbsp;<span class="ident" id="7915052">newLocalListener</span><span class="op" id="7915068">(</span><span class="ident" id="7915069">t</span><span class="op" id="7915070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915073">defer</span>&nbsp;<span class="ident" id="7915079">ln</span><span class="op" id="7915081">.</span><span class="ident" id="7915082">Close</span><span class="op" id="7915087">(</span><span class="op" id="7915088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915092">servec</span>&nbsp;<span class="op" id="7915099">:=</span>&nbsp;<span class="builtinfunc" id="7915102">make</span><span class="op" id="7915106">(</span><span class="keyword" id="7915107">chan</span>&nbsp;<span class="ident" id="7915112">copyRes</span><span class="op" id="7915119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915122">go</span>&nbsp;<span class="keyword" id="7915125">func</span><span class="op" id="7915129">(</span><span class="op" id="7915130">)</span>&nbsp;<span class="op" id="7915132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915136">c</span><span class="op" id="7915137">,</span>&nbsp;<span class="ident" id="7915139">err</span>&nbsp;<span class="op" id="7915143">:=</span>&nbsp;<span class="ident" id="7915146">ln</span><span class="op" id="7915148">.</span><span class="ident" id="7915149">Accept</span><span class="op" id="7915155">(</span><span class="op" id="7915156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915160">if</span>&nbsp;<span class="ident" id="7915163">err</span>&nbsp;<span class="op" id="7915167">!=</span>&nbsp;<span class="ident" id="7915170">nil</span>&nbsp;<span class="op" id="7915174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915179">t</span><span class="op" id="7915180">.</span><span class="ident" id="7915181">Errorf</span><span class="op" id="7915187">(</span><span class="string" id="7915188">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7915200">,</span>&nbsp;<span class="ident" id="7915202">err</span><span class="op" id="7915205">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915210">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915223">defer</span>&nbsp;<span class="ident" id="7915229">c</span><span class="op" id="7915230">.</span><span class="ident" id="7915231">Close</span><span class="op" id="7915236">(</span><span class="op" id="7915237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915241">c</span><span class="op" id="7915242">.</span><span class="ident" id="7915243">SetWriteDeadline</span><span class="op" id="7915259">(</span><span class="ident" id="7915260">time</span><span class="op" id="7915264">.</span><span class="ident" id="7915265">Now</span><span class="op" id="7915268">(</span><span class="op" id="7915269">)</span><span class="op" id="7915270">.</span><span class="ident" id="7915271">Add</span><span class="op" id="7915274">(</span><span class="op" id="7915275">-</span><span class="num" id="7915276">5</span>&nbsp;<span class="op" id="7915278">*</span>&nbsp;<span class="ident" id="7915280">time</span><span class="op" id="7915284">.</span><span class="ident" id="7915285">Second</span><span class="op" id="7915291">)</span><span class="op" id="7915292">)</span>&nbsp;<span class="comment" id="7915294">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915311">n</span><span class="op" id="7915312">,</span>&nbsp;<span class="ident" id="7915314">err</span>&nbsp;<span class="op" id="7915318">:=</span>&nbsp;<span class="ident" id="7915321">c</span><span class="op" id="7915322">.</span><span class="ident" id="7915323">Write</span><span class="op" id="7915328">(</span><span class="op" id="7915329">[</span><span class="op" id="7915330">]</span><span class="builtintype" id="7915331">byte</span><span class="op" id="7915335">{</span><span class="string" id="7915336">&#39;x&#39;</span><span class="op" id="7915339">}</span><span class="op" id="7915340">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915344">servec</span>&nbsp;<span class="op" id="7915351">&lt;-</span>&nbsp;<span class="ident" id="7915354">copyRes</span><span class="op" id="7915361">{</span><span class="ident" id="7915362">n</span><span class="op" id="7915363">:</span>&nbsp;<span class="ident" id="7915365">int64</span><span class="op" id="7915370">(</span><span class="ident" id="7915371">n</span><span class="op" id="7915372">)</span><span class="op" id="7915373">,</span>&nbsp;<span class="ident" id="7915375">err</span><span class="op" id="7915378">:</span>&nbsp;<span class="ident" id="7915380">err</span><span class="op" id="7915383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915386">}</span><span class="op" id="7915387">(</span><span class="op" id="7915388">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915392">c</span><span class="op" id="7915393">,</span>&nbsp;<span class="ident" id="7915395">err</span>&nbsp;<span class="op" id="7915399">:=</span>&nbsp;<span class="ident" id="7915402">Dial</span><span class="op" id="7915406">(</span><span class="string" id="7915407">&#34;tcp&#34;</span><span class="op" id="7915412">,</span>&nbsp;<span class="ident" id="7915414">ln</span><span class="op" id="7915416">.</span><span class="ident" id="7915417">Addr</span><span class="op" id="7915421">(</span><span class="op" id="7915422">)</span><span class="op" id="7915423">.</span><span class="ident" id="7915424">String</span><span class="op" id="7915430">(</span><span class="op" id="7915431">)</span><span class="op" id="7915432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915435">if</span>&nbsp;<span class="ident" id="7915438">err</span>&nbsp;<span class="op" id="7915442">!=</span>&nbsp;<span class="ident" id="7915445">nil</span>&nbsp;<span class="op" id="7915449">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915453">t</span><span class="op" id="7915454">.</span><span class="ident" id="7915455">Fatalf</span><span class="op" id="7915461">(</span><span class="string" id="7915462">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7915472">,</span>&nbsp;<span class="ident" id="7915474">err</span><span class="op" id="7915477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915483">defer</span>&nbsp;<span class="ident" id="7915489">c</span><span class="op" id="7915490">.</span><span class="ident" id="7915491">Close</span><span class="op" id="7915496">(</span><span class="op" id="7915497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915500">res</span>&nbsp;<span class="op" id="7915504">:=</span>&nbsp;<span class="op" id="7915507">&lt;-</span><span class="ident" id="7915509">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915517">if</span>&nbsp;<span class="ident" id="7915520">res</span><span class="op" id="7915523">.</span><span class="ident" id="7915524">n</span>&nbsp;<span class="op" id="7915526">!=</span>&nbsp;<span class="num" id="7915529">0</span>&nbsp;<span class="op" id="7915531">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915535">t</span><span class="op" id="7915536">.</span><span class="ident" id="7915537">Errorf</span><span class="op" id="7915543">(</span><span class="string" id="7915544">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7915564">,</span>&nbsp;<span class="ident" id="7915566">res</span><span class="op" id="7915569">.</span><span class="ident" id="7915570">n</span><span class="op" id="7915571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915577">if</span>&nbsp;<span class="op" id="7915580">!</span><span class="ident" id="7915581">isTimeout</span><span class="op" id="7915590">(</span><span class="ident" id="7915591">res</span><span class="op" id="7915594">.</span><span class="ident" id="7915595">err</span><span class="op" id="7915598">)</span>&nbsp;<span class="op" id="7915600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915604">t</span><span class="op" id="7915605">.</span><span class="ident" id="7915606">Errorf</span><span class="op" id="7915612">(</span><span class="string" id="7915613">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7915645">,</span>&nbsp;<span class="ident" id="7915647">res</span><span class="op" id="7915650">.</span><span class="ident" id="7915651">err</span><span class="op" id="7915654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915657">}</span><br>
<span class="lineno">600</span><span class="op" id="7915659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7915662">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="7915742">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="7915788">func</span>&nbsp;<span class="ident" id="7915793">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="7915830">(</span><span class="ident" id="7915831">t</span>&nbsp;<span class="op" id="7915833">*</span><span class="ident" id="7915834">testing</span><span class="op" id="7915841">.</span><span class="ident" id="7915842">T</span><span class="op" id="7915843">)</span>&nbsp;<span class="op" id="7915845">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915848">switch</span>&nbsp;<span class="ident" id="7915855">runtime</span><span class="op" id="7915862">.</span><span class="ident" id="7915863">GOOS</span>&nbsp;<span class="op" id="7915868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915871">case</span>&nbsp;<span class="string" id="7915876">&#34;plan9&#34;</span><span class="op" id="7915883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915887">t</span><span class="op" id="7915888">.</span><span class="ident" id="7915889">Skipf</span><span class="op" id="7915894">(</span><span class="string" id="7915895">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7915916">,</span>&nbsp;<span class="ident" id="7915918">runtime</span><span class="op" id="7915925">.</span><span class="ident" id="7915926">GOOS</span><span class="op" id="7915930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915937">ln</span>&nbsp;<span class="op" id="7915940">:=</span>&nbsp;<span class="ident" id="7915943">newLocalListener</span><span class="op" id="7915959">(</span><span class="ident" id="7915960">t</span><span class="op" id="7915961">)</span><span class="op" id="7915962">.</span><span class="op" id="7915963">(</span><span class="op" id="7915964">*</span><span class="ident" id="7915965">TCPListener</span><span class="op" id="7915976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915979">defer</span>&nbsp;<span class="ident" id="7915985">ln</span><span class="op" id="7915987">.</span><span class="ident" id="7915988">Close</span><span class="op" id="7915993">(</span><span class="op" id="7915994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915998">go</span>&nbsp;<span class="keyword" id="7916001">func</span><span class="op" id="7916005">(</span><span class="op" id="7916006">)</span>&nbsp;<span class="op" id="7916008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916012">c</span><span class="op" id="7916013">,</span>&nbsp;<span class="ident" id="7916015">err</span>&nbsp;<span class="op" id="7916019">:=</span>&nbsp;<span class="ident" id="7916022">Dial</span><span class="op" id="7916026">(</span><span class="string" id="7916027">&#34;tcp&#34;</span><span class="op" id="7916032">,</span>&nbsp;<span class="ident" id="7916034">ln</span><span class="op" id="7916036">.</span><span class="ident" id="7916037">Addr</span><span class="op" id="7916041">(</span><span class="op" id="7916042">)</span><span class="op" id="7916043">.</span><span class="ident" id="7916044">String</span><span class="op" id="7916050">(</span><span class="op" id="7916051">)</span><span class="op" id="7916052">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916056">if</span>&nbsp;<span class="ident" id="7916059">err</span>&nbsp;<span class="op" id="7916063">!=</span>&nbsp;<span class="ident" id="7916066">nil</span>&nbsp;<span class="op" id="7916070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916075">t</span><span class="op" id="7916076">.</span><span class="ident" id="7916077">Errorf</span><span class="op" id="7916083">(</span><span class="string" id="7916084">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7916094">,</span>&nbsp;<span class="ident" id="7916096">err</span><span class="op" id="7916099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916117">defer</span>&nbsp;<span class="ident" id="7916123">c</span><span class="op" id="7916124">.</span><span class="ident" id="7916125">Close</span><span class="op" id="7916130">(</span><span class="op" id="7916131">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916135">var</span>&nbsp;<span class="ident" id="7916139">buf</span>&nbsp;<span class="op" id="7916143">[</span><span class="num" id="7916144">1</span><span class="op" id="7916145">]</span><span class="builtintype" id="7916146">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916153">c</span><span class="op" id="7916154">.</span><span class="ident" id="7916155">Read</span><span class="op" id="7916159">(</span><span class="ident" id="7916160">buf</span><span class="op" id="7916163">[</span><span class="op" id="7916164">:</span><span class="op" id="7916165">]</span><span class="op" id="7916166">)</span>&nbsp;<span class="comment" id="7916168">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916221">}</span><span class="op" id="7916222">(</span><span class="op" id="7916223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916226">time</span><span class="op" id="7916230">.</span><span class="ident" id="7916231">Sleep</span><span class="op" id="7916236">(</span><span class="num" id="7916237">10</span>&nbsp;<span class="op" id="7916240">*</span>&nbsp;<span class="ident" id="7916242">time</span><span class="op" id="7916246">.</span><span class="ident" id="7916247">Millisecond</span><span class="op" id="7916258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916261">ln</span><span class="op" id="7916263">.</span><span class="ident" id="7916264">SetDeadline</span><span class="op" id="7916275">(</span><span class="ident" id="7916276">time</span><span class="op" id="7916280">.</span><span class="ident" id="7916281">Now</span><span class="op" id="7916284">(</span><span class="op" id="7916285">)</span><span class="op" id="7916286">.</span><span class="ident" id="7916287">Add</span><span class="op" id="7916290">(</span><span class="op" id="7916291">-</span><span class="num" id="7916292">5</span>&nbsp;<span class="op" id="7916294">*</span>&nbsp;<span class="ident" id="7916296">time</span><span class="op" id="7916300">.</span><span class="ident" id="7916301">Second</span><span class="op" id="7916307">)</span><span class="op" id="7916308">)</span>&nbsp;<span class="comment" id="7916310">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916326">c</span><span class="op" id="7916327">,</span>&nbsp;<span class="ident" id="7916329">err</span>&nbsp;<span class="op" id="7916333">:=</span>&nbsp;<span class="ident" id="7916336">ln</span><span class="op" id="7916338">.</span><span class="ident" id="7916339">Accept</span><span class="op" id="7916345">(</span><span class="op" id="7916346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916349">if</span>&nbsp;<span class="ident" id="7916352">err</span>&nbsp;<span class="op" id="7916356">==</span>&nbsp;<span class="ident" id="7916359">nil</span>&nbsp;<span class="op" id="7916363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916367">defer</span>&nbsp;<span class="ident" id="7916373">c</span><span class="op" id="7916374">.</span><span class="ident" id="7916375">Close</span><span class="op" id="7916380">(</span><span class="op" id="7916381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916387">if</span>&nbsp;<span class="op" id="7916390">!</span><span class="ident" id="7916391">isTimeout</span><span class="op" id="7916400">(</span><span class="ident" id="7916401">err</span><span class="op" id="7916404">)</span>&nbsp;<span class="op" id="7916406">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916410">t</span><span class="op" id="7916411">.</span><span class="ident" id="7916412">Fatalf</span><span class="op" id="7916418">(</span><span class="string" id="7916419">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7916449">,</span>&nbsp;<span class="ident" id="7916451">err</span><span class="op" id="7916454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916457">}</span><br>
<span class="lineno"></span><span class="op" id="7916459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7916462">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="7916534">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="7916588">func</span>&nbsp;<span class="ident" id="7916593">TestConnectDeadlineInThePast</span><span class="op" id="7916621">(</span><span class="ident" id="7916622">t</span>&nbsp;<span class="op" id="7916624">*</span><span class="ident" id="7916625">testing</span><span class="op" id="7916632">.</span><span class="ident" id="7916633">T</span><span class="op" id="7916634">)</span>&nbsp;<span class="op" id="7916636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916639">switch</span>&nbsp;<span class="ident" id="7916646">runtime</span><span class="op" id="7916653">.</span><span class="ident" id="7916654">GOOS</span>&nbsp;<span class="op" id="7916659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916662">case</span>&nbsp;<span class="string" id="7916667">&#34;plan9&#34;</span><span class="op" id="7916674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916678">t</span><span class="op" id="7916679">.</span><span class="ident" id="7916680">Skipf</span><span class="op" id="7916685">(</span><span class="string" id="7916686">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7916707">,</span>&nbsp;<span class="ident" id="7916709">runtime</span><span class="op" id="7916716">.</span><span class="ident" id="7916717">GOOS</span><span class="op" id="7916721">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916728">ln</span>&nbsp;<span class="op" id="7916731">:=</span>&nbsp;<span class="ident" id="7916734">newLocalListener</span><span class="op" id="7916750">(</span><span class="ident" id="7916751">t</span><span class="op" id="7916752">)</span><span class="op" id="7916753">.</span><span class="op" id="7916754">(</span><span class="op" id="7916755">*</span><span class="ident" id="7916756">TCPListener</span><span class="op" id="7916767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916770">defer</span>&nbsp;<span class="ident" id="7916776">ln</span><span class="op" id="7916778">.</span><span class="ident" id="7916779">Close</span><span class="op" id="7916784">(</span><span class="op" id="7916785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916789">go</span>&nbsp;<span class="keyword" id="7916792">func</span><span class="op" id="7916796">(</span><span class="op" id="7916797">)</span>&nbsp;<span class="op" id="7916799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916803">c</span><span class="op" id="7916804">,</span>&nbsp;<span class="ident" id="7916806">err</span>&nbsp;<span class="op" id="7916810">:=</span>&nbsp;<span class="ident" id="7916813">ln</span><span class="op" id="7916815">.</span><span class="ident" id="7916816">Accept</span><span class="op" id="7916822">(</span><span class="op" id="7916823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916827">if</span>&nbsp;<span class="ident" id="7916830">err</span>&nbsp;<span class="op" id="7916834">==</span>&nbsp;<span class="ident" id="7916837">nil</span>&nbsp;<span class="op" id="7916841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916846">defer</span>&nbsp;<span class="ident" id="7916852">c</span><span class="op" id="7916853">.</span><span class="ident" id="7916854">Close</span><span class="op" id="7916859">(</span><span class="op" id="7916860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916864">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916867">}</span><span class="op" id="7916868">(</span><span class="op" id="7916869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916872">time</span><span class="op" id="7916876">.</span><span class="ident" id="7916877">Sleep</span><span class="op" id="7916882">(</span><span class="num" id="7916883">10</span>&nbsp;<span class="op" id="7916886">*</span>&nbsp;<span class="ident" id="7916888">time</span><span class="op" id="7916892">.</span><span class="ident" id="7916893">Millisecond</span><span class="op" id="7916904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916907">c</span><span class="op" id="7916908">,</span>&nbsp;<span class="ident" id="7916910">err</span>&nbsp;<span class="op" id="7916914">:=</span>&nbsp;<span class="ident" id="7916917">DialTimeout</span><span class="op" id="7916928">(</span><span class="string" id="7916929">&#34;tcp&#34;</span><span class="op" id="7916934">,</span>&nbsp;<span class="ident" id="7916936">ln</span><span class="op" id="7916938">.</span><span class="ident" id="7916939">Addr</span><span class="op" id="7916943">(</span><span class="op" id="7916944">)</span><span class="op" id="7916945">.</span><span class="ident" id="7916946">String</span><span class="op" id="7916952">(</span><span class="op" id="7916953">)</span><span class="op" id="7916954">,</span>&nbsp;<span class="op" id="7916956">-</span><span class="num" id="7916957">5</span><span class="op" id="7916958">*</span><span class="ident" id="7916959">time</span><span class="op" id="7916963">.</span><span class="ident" id="7916964">Second</span><span class="op" id="7916970">)</span>&nbsp;<span class="comment" id="7916972">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916988">if</span>&nbsp;<span class="ident" id="7916991">err</span>&nbsp;<span class="op" id="7916995">==</span>&nbsp;<span class="ident" id="7916998">nil</span>&nbsp;<span class="op" id="7917002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917006">defer</span>&nbsp;<span class="ident" id="7917012">c</span><span class="op" id="7917013">.</span><span class="ident" id="7917014">Close</span><span class="op" id="7917019">(</span><span class="op" id="7917020">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917026">if</span>&nbsp;<span class="op" id="7917029">!</span><span class="ident" id="7917030">isTimeout</span><span class="op" id="7917039">(</span><span class="ident" id="7917040">err</span><span class="op" id="7917043">)</span>&nbsp;<span class="op" id="7917045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917049">t</span><span class="op" id="7917050">.</span><span class="ident" id="7917051">Fatalf</span><span class="op" id="7917057">(</span><span class="string" id="7917058">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7917093">,</span>&nbsp;<span class="ident" id="7917095">err</span><span class="op" id="7917098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917101">}</span><br>
<span class="lineno"></span><span class="op" id="7917103">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="7917106">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="7917168">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="7917210">func</span>&nbsp;<span class="ident" id="7917215">TestProlongTimeout</span><span class="op" id="7917233">(</span><span class="ident" id="7917234">t</span>&nbsp;<span class="op" id="7917236">*</span><span class="ident" id="7917237">testing</span><span class="op" id="7917244">.</span><span class="ident" id="7917245">T</span><span class="op" id="7917246">)</span>&nbsp;<span class="op" id="7917248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917251">switch</span>&nbsp;<span class="ident" id="7917258">runtime</span><span class="op" id="7917265">.</span><span class="ident" id="7917266">GOOS</span>&nbsp;<span class="op" id="7917271">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917274">case</span>&nbsp;<span class="string" id="7917279">&#34;plan9&#34;</span><span class="op" id="7917286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917290">t</span><span class="op" id="7917291">.</span><span class="ident" id="7917292">Skipf</span><span class="op" id="7917297">(</span><span class="string" id="7917298">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7917319">,</span>&nbsp;<span class="ident" id="7917321">runtime</span><span class="op" id="7917328">.</span><span class="ident" id="7917329">GOOS</span><span class="op" id="7917333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917340">ln</span>&nbsp;<span class="op" id="7917343">:=</span>&nbsp;<span class="ident" id="7917346">newLocalListener</span><span class="op" id="7917362">(</span><span class="ident" id="7917363">t</span><span class="op" id="7917364">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917367">defer</span>&nbsp;<span class="ident" id="7917373">ln</span><span class="op" id="7917375">.</span><span class="ident" id="7917376">Close</span><span class="op" id="7917381">(</span><span class="op" id="7917382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917385">connected</span>&nbsp;<span class="op" id="7917395">:=</span>&nbsp;<span class="builtinfunc" id="7917398">make</span><span class="op" id="7917402">(</span><span class="keyword" id="7917403">chan</span>&nbsp;<span class="builtintype" id="7917408">bool</span><span class="op" id="7917412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917415">go</span>&nbsp;<span class="keyword" id="7917418">func</span><span class="op" id="7917422">(</span><span class="op" id="7917423">)</span>&nbsp;<span class="op" id="7917425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917429">s</span><span class="op" id="7917430">,</span>&nbsp;<span class="ident" id="7917432">err</span>&nbsp;<span class="op" id="7917436">:=</span>&nbsp;<span class="ident" id="7917439">ln</span><span class="op" id="7917441">.</span><span class="ident" id="7917442">Accept</span><span class="op" id="7917448">(</span><span class="op" id="7917449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917453">connected</span>&nbsp;<span class="op" id="7917463">&lt;-</span>&nbsp;<span class="builtintype" id="7917466">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917473">if</span>&nbsp;<span class="ident" id="7917476">err</span>&nbsp;<span class="op" id="7917480">!=</span>&nbsp;<span class="ident" id="7917483">nil</span>&nbsp;<span class="op" id="7917487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917492">t</span><span class="op" id="7917493">.</span><span class="ident" id="7917494">Errorf</span><span class="op" id="7917500">(</span><span class="string" id="7917501">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="7917516">,</span>&nbsp;<span class="ident" id="7917518">err</span><span class="op" id="7917521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917526">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917539">defer</span>&nbsp;<span class="ident" id="7917545">s</span><span class="op" id="7917546">.</span><span class="ident" id="7917547">Close</span><span class="op" id="7917552">(</span><span class="op" id="7917553">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917557">s</span><span class="op" id="7917558">.</span><span class="ident" id="7917559">SetDeadline</span><span class="op" id="7917570">(</span><span class="ident" id="7917571">time</span><span class="op" id="7917575">.</span><span class="ident" id="7917576">Now</span><span class="op" id="7917579">(</span><span class="op" id="7917580">)</span><span class="op" id="7917581">.</span><span class="ident" id="7917582">Add</span><span class="op" id="7917585">(</span><span class="ident" id="7917586">time</span><span class="op" id="7917590">.</span><span class="ident" id="7917591">Hour</span><span class="op" id="7917595">)</span><span class="op" id="7917596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917600">go</span>&nbsp;<span class="keyword" id="7917603">func</span><span class="op" id="7917607">(</span><span class="op" id="7917608">)</span>&nbsp;<span class="op" id="7917610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917615">var</span>&nbsp;<span class="ident" id="7917619">buf</span>&nbsp;<span class="op" id="7917623">[</span><span class="num" id="7917624">4096</span><span class="op" id="7917628">]</span><span class="builtintype" id="7917629">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917637">for</span>&nbsp;<span class="op" id="7917641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917647">_</span><span class="op" id="7917648">,</span>&nbsp;<span class="ident" id="7917650">err</span>&nbsp;<span class="op" id="7917654">:=</span>&nbsp;<span class="ident" id="7917657">s</span><span class="op" id="7917658">.</span><span class="ident" id="7917659">Write</span><span class="op" id="7917664">(</span><span class="ident" id="7917665">buf</span><span class="op" id="7917668">[</span><span class="op" id="7917669">:</span><span class="op" id="7917670">]</span><span class="op" id="7917671">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917677">if</span>&nbsp;<span class="ident" id="7917680">err</span>&nbsp;<span class="op" id="7917684">!=</span>&nbsp;<span class="ident" id="7917687">nil</span>&nbsp;<span class="op" id="7917691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917698">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917714">s</span><span class="op" id="7917715">.</span><span class="ident" id="7917716">SetDeadline</span><span class="op" id="7917727">(</span><span class="ident" id="7917728">time</span><span class="op" id="7917732">.</span><span class="ident" id="7917733">Now</span><span class="op" id="7917736">(</span><span class="op" id="7917737">)</span><span class="op" id="7917738">.</span><span class="ident" id="7917739">Add</span><span class="op" id="7917742">(</span><span class="ident" id="7917743">time</span><span class="op" id="7917747">.</span><span class="ident" id="7917748">Hour</span><span class="op" id="7917752">)</span><span class="op" id="7917753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917758">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917762">}</span><span class="op" id="7917763">(</span><span class="op" id="7917764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917768">buf</span>&nbsp;<span class="op" id="7917772">:=</span>&nbsp;<span class="builtinfunc" id="7917775">make</span><span class="op" id="7917779">(</span><span class="op" id="7917780">[</span><span class="op" id="7917781">]</span><span class="builtintype" id="7917782">byte</span><span class="op" id="7917786">,</span>&nbsp;<span class="num" id="7917788">1</span><span class="op" id="7917789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917793">for</span>&nbsp;<span class="op" id="7917797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917802">_</span><span class="op" id="7917803">,</span>&nbsp;<span class="ident" id="7917805">err</span>&nbsp;<span class="op" id="7917809">:=</span>&nbsp;<span class="ident" id="7917812">s</span><span class="op" id="7917813">.</span><span class="ident" id="7917814">Read</span><span class="op" id="7917818">(</span><span class="ident" id="7917819">buf</span><span class="op" id="7917822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917827">if</span>&nbsp;<span class="ident" id="7917830">err</span>&nbsp;<span class="op" id="7917834">!=</span>&nbsp;<span class="ident" id="7917837">nil</span>&nbsp;<span class="op" id="7917841">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917847">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917861">s</span><span class="op" id="7917862">.</span><span class="ident" id="7917863">SetDeadline</span><span class="op" id="7917874">(</span><span class="ident" id="7917875">time</span><span class="op" id="7917879">.</span><span class="ident" id="7917880">Now</span><span class="op" id="7917883">(</span><span class="op" id="7917884">)</span><span class="op" id="7917885">.</span><span class="ident" id="7917886">Add</span><span class="op" id="7917889">(</span><span class="ident" id="7917890">time</span><span class="op" id="7917894">.</span><span class="ident" id="7917895">Hour</span><span class="op" id="7917899">)</span><span class="op" id="7917900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917907">}</span><span class="op" id="7917908">(</span><span class="op" id="7917909">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917912">c</span><span class="op" id="7917913">,</span>&nbsp;<span class="ident" id="7917915">err</span>&nbsp;<span class="op" id="7917919">:=</span>&nbsp;<span class="ident" id="7917922">Dial</span><span class="op" id="7917926">(</span><span class="string" id="7917927">&#34;tcp&#34;</span><span class="op" id="7917932">,</span>&nbsp;<span class="ident" id="7917934">ln</span><span class="op" id="7917936">.</span><span class="ident" id="7917937">Addr</span><span class="op" id="7917941">(</span><span class="op" id="7917942">)</span><span class="op" id="7917943">.</span><span class="ident" id="7917944">String</span><span class="op" id="7917950">(</span><span class="op" id="7917951">)</span><span class="op" id="7917952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917955">if</span>&nbsp;<span class="ident" id="7917958">err</span>&nbsp;<span class="op" id="7917962">!=</span>&nbsp;<span class="ident" id="7917965">nil</span>&nbsp;<span class="op" id="7917969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917973">t</span><span class="op" id="7917974">.</span><span class="ident" id="7917975">Fatalf</span><span class="op" id="7917981">(</span><span class="string" id="7917982">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="7917995">,</span>&nbsp;<span class="ident" id="7917997">err</span><span class="op" id="7918000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918006">defer</span>&nbsp;<span class="ident" id="7918012">c</span><span class="op" id="7918013">.</span><span class="ident" id="7918014">Close</span><span class="op" id="7918019">(</span><span class="op" id="7918020">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918023">&lt;-</span><span class="ident" id="7918025">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918036">for</span>&nbsp;<span class="ident" id="7918040">i</span>&nbsp;<span class="op" id="7918042">:=</span>&nbsp;<span class="num" id="7918045">0</span><span class="op" id="7918046">;</span>&nbsp;<span class="ident" id="7918048">i</span>&nbsp;<span class="op" id="7918050">&lt;</span>&nbsp;<span class="num" id="7918052">1024</span><span class="op" id="7918056">;</span>&nbsp;<span class="ident" id="7918058">i</span><span class="op" id="7918059">++</span>&nbsp;<span class="op" id="7918062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918066">var</span>&nbsp;<span class="ident" id="7918070">buf</span>&nbsp;<span class="op" id="7918074">[</span><span class="num" id="7918075">1</span><span class="op" id="7918076">]</span><span class="builtintype" id="7918077">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918084">c</span><span class="op" id="7918085">.</span><span class="ident" id="7918086">Write</span><span class="op" id="7918091">(</span><span class="ident" id="7918092">buf</span><span class="op" id="7918095">[</span><span class="op" id="7918096">:</span><span class="op" id="7918097">]</span><span class="op" id="7918098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918101">}</span><br>
<span class="lineno">710</span><span class="op" id="7918103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7918106">func</span>&nbsp;<span class="ident" id="7918111">TestDeadlineRace</span><span class="op" id="7918127">(</span><span class="ident" id="7918128">t</span>&nbsp;<span class="op" id="7918130">*</span><span class="ident" id="7918131">testing</span><span class="op" id="7918138">.</span><span class="ident" id="7918139">T</span><span class="op" id="7918140">)</span>&nbsp;<span class="op" id="7918142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918145">switch</span>&nbsp;<span class="ident" id="7918152">runtime</span><span class="op" id="7918159">.</span><span class="ident" id="7918160">GOOS</span>&nbsp;<span class="op" id="7918165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918168">case</span>&nbsp;<span class="string" id="7918173">&#34;nacl&#34;</span><span class="op" id="7918179">,</span>&nbsp;<span class="string" id="7918181">&#34;plan9&#34;</span><span class="op" id="7918188">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918192">t</span><span class="op" id="7918193">.</span><span class="ident" id="7918194">Skipf</span><span class="op" id="7918199">(</span><span class="string" id="7918200">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7918221">,</span>&nbsp;<span class="ident" id="7918223">runtime</span><span class="op" id="7918230">.</span><span class="ident" id="7918231">GOOS</span><span class="op" id="7918235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918242">N</span>&nbsp;<span class="op" id="7918244">:=</span>&nbsp;<span class="num" id="7918247">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918253">if</span>&nbsp;<span class="ident" id="7918256">testing</span><span class="op" id="7918263">.</span><span class="ident" id="7918264">Short</span><span class="op" id="7918269">(</span><span class="op" id="7918270">)</span>&nbsp;<span class="op" id="7918272">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918276">N</span>&nbsp;<span class="op" id="7918278">=</span>&nbsp;<span class="num" id="7918280">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918287">defer</span>&nbsp;<span class="ident" id="7918293">runtime</span><span class="op" id="7918300">.</span><span class="ident" id="7918301">GOMAXPROCS</span><span class="op" id="7918311">(</span><span class="ident" id="7918312">runtime</span><span class="op" id="7918319">.</span><span class="ident" id="7918320">GOMAXPROCS</span><span class="op" id="7918330">(</span><span class="num" id="7918331">4</span><span class="op" id="7918332">)</span><span class="op" id="7918333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918336">ln</span>&nbsp;<span class="op" id="7918339">:=</span>&nbsp;<span class="ident" id="7918342">newLocalListener</span><span class="op" id="7918358">(</span><span class="ident" id="7918359">t</span><span class="op" id="7918360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918363">defer</span>&nbsp;<span class="ident" id="7918369">ln</span><span class="op" id="7918371">.</span><span class="ident" id="7918372">Close</span><span class="op" id="7918377">(</span><span class="op" id="7918378">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918381">c</span><span class="op" id="7918382">,</span>&nbsp;<span class="ident" id="7918384">err</span>&nbsp;<span class="op" id="7918388">:=</span>&nbsp;<span class="ident" id="7918391">Dial</span><span class="op" id="7918395">(</span><span class="string" id="7918396">&#34;tcp&#34;</span><span class="op" id="7918401">,</span>&nbsp;<span class="ident" id="7918403">ln</span><span class="op" id="7918405">.</span><span class="ident" id="7918406">Addr</span><span class="op" id="7918410">(</span><span class="op" id="7918411">)</span><span class="op" id="7918412">.</span><span class="ident" id="7918413">String</span><span class="op" id="7918419">(</span><span class="op" id="7918420">)</span><span class="op" id="7918421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918424">if</span>&nbsp;<span class="ident" id="7918427">err</span>&nbsp;<span class="op" id="7918431">!=</span>&nbsp;<span class="ident" id="7918434">nil</span>&nbsp;<span class="op" id="7918438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918442">t</span><span class="op" id="7918443">.</span><span class="ident" id="7918444">Fatalf</span><span class="op" id="7918450">(</span><span class="string" id="7918451">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7918461">,</span>&nbsp;<span class="ident" id="7918463">err</span><span class="op" id="7918466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918472">defer</span>&nbsp;<span class="ident" id="7918478">c</span><span class="op" id="7918479">.</span><span class="ident" id="7918480">Close</span><span class="op" id="7918485">(</span><span class="op" id="7918486">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918489">done</span>&nbsp;<span class="op" id="7918494">:=</span>&nbsp;<span class="builtinfunc" id="7918497">make</span><span class="op" id="7918501">(</span><span class="keyword" id="7918502">chan</span>&nbsp;<span class="builtintype" id="7918507">bool</span><span class="op" id="7918511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918514">go</span>&nbsp;<span class="keyword" id="7918517">func</span><span class="op" id="7918521">(</span><span class="op" id="7918522">)</span>&nbsp;<span class="op" id="7918524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918528">t</span>&nbsp;<span class="op" id="7918530">:=</span>&nbsp;<span class="ident" id="7918533">time</span><span class="op" id="7918537">.</span><span class="ident" id="7918538">NewTicker</span><span class="op" id="7918547">(</span><span class="num" id="7918548">2</span>&nbsp;<span class="op" id="7918550">*</span>&nbsp;<span class="ident" id="7918552">time</span><span class="op" id="7918556">.</span><span class="ident" id="7918557">Microsecond</span><span class="op" id="7918568">)</span><span class="op" id="7918569">.</span><span class="ident" id="7918570">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918574">for</span>&nbsp;<span class="ident" id="7918578">i</span>&nbsp;<span class="op" id="7918580">:=</span>&nbsp;<span class="num" id="7918583">0</span><span class="op" id="7918584">;</span>&nbsp;<span class="ident" id="7918586">i</span>&nbsp;<span class="op" id="7918588">&lt;</span>&nbsp;<span class="ident" id="7918590">N</span><span class="op" id="7918591">;</span>&nbsp;<span class="ident" id="7918593">i</span><span class="op" id="7918594">++</span>&nbsp;<span class="op" id="7918597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918602">if</span>&nbsp;<span class="ident" id="7918605">err</span>&nbsp;<span class="op" id="7918609">:=</span>&nbsp;<span class="ident" id="7918612">c</span><span class="op" id="7918613">.</span><span class="ident" id="7918614">SetDeadline</span><span class="op" id="7918625">(</span><span class="ident" id="7918626">time</span><span class="op" id="7918630">.</span><span class="ident" id="7918631">Now</span><span class="op" id="7918634">(</span><span class="op" id="7918635">)</span><span class="op" id="7918636">.</span><span class="ident" id="7918637">Add</span><span class="op" id="7918640">(</span><span class="num" id="7918641">2</span>&nbsp;<span class="op" id="7918643">*</span>&nbsp;<span class="ident" id="7918645">time</span><span class="op" id="7918649">.</span><span class="ident" id="7918650">Microsecond</span><span class="op" id="7918661">)</span><span class="op" id="7918662">)</span><span class="op" id="7918663">;</span>&nbsp;<span class="ident" id="7918665">err</span>&nbsp;<span class="op" id="7918669">!=</span>&nbsp;<span class="ident" id="7918672">nil</span>&nbsp;<span class="op" id="7918676">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918682">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918696">&lt;-</span><span class="ident" id="7918698">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918706">done</span>&nbsp;<span class="op" id="7918711">&lt;-</span>&nbsp;<span class="builtintype" id="7918714">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918720">}</span><span class="op" id="7918721">(</span><span class="op" id="7918722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918725">var</span>&nbsp;<span class="ident" id="7918729">buf</span>&nbsp;<span class="op" id="7918733">[</span><span class="num" id="7918734">1</span><span class="op" id="7918735">]</span><span class="builtintype" id="7918736">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918742">for</span>&nbsp;<span class="ident" id="7918746">i</span>&nbsp;<span class="op" id="7918748">:=</span>&nbsp;<span class="num" id="7918751">0</span><span class="op" id="7918752">;</span>&nbsp;<span class="ident" id="7918754">i</span>&nbsp;<span class="op" id="7918756">&lt;</span>&nbsp;<span class="ident" id="7918758">N</span><span class="op" id="7918759">;</span>&nbsp;<span class="ident" id="7918761">i</span><span class="op" id="7918762">++</span>&nbsp;<span class="op" id="7918765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918769">c</span><span class="op" id="7918770">.</span><span class="ident" id="7918771">Read</span><span class="op" id="7918775">(</span><span class="ident" id="7918776">buf</span><span class="op" id="7918779">[</span><span class="op" id="7918780">:</span><span class="op" id="7918781">]</span><span class="op" id="7918782">)</span>&nbsp;<span class="comment" id="7918784">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918819">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918822">c</span><span class="op" id="7918823">.</span><span class="ident" id="7918824">Close</span><span class="op" id="7918829">(</span><span class="op" id="7918830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918833">&lt;-</span><span class="ident" id="7918835">done</span><br>
<span class="lineno"></span><span class="op" id="7918840">}</span>
</div>
</body>
</html>
