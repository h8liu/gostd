<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3140500">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3140556">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3140610">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3140661">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3140739">package</span>&nbsp;<span class="ident" id="3140747">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3140752">import</span>&nbsp;<span class="op" id="3140759">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3140762">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3140772">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3140778">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3140789">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3140796">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3140799">func</span>&nbsp;<span class="ident" id="3140804">unixSocket</span><span class="op" id="3140814">(</span><span class="ident" id="3140815">net</span>&nbsp;<span class="builtintype" id="3140819">string</span><span class="op" id="3140825">,</span>&nbsp;<span class="ident" id="3140827">laddr</span><span class="op" id="3140832">,</span>&nbsp;<span class="ident" id="3140834">raddr</span>&nbsp;<span class="ident" id="3140840">sockaddr</span><span class="op" id="3140848">,</span>&nbsp;<span class="ident" id="3140850">mode</span>&nbsp;<span class="builtintype" id="3140855">string</span><span class="op" id="3140861">,</span>&nbsp;<span class="ident" id="3140863">deadline</span>&nbsp;<span class="ident" id="3140872">time</span><span class="op" id="3140876">.</span><span class="ident" id="3140877">Time</span><span class="op" id="3140881">)</span>&nbsp;<span class="op" id="3140883">(</span><span class="op" id="3140884">*</span><span class="ident" id="3140885">netFD</span><span class="op" id="3140890">,</span>&nbsp;<span class="builtintype" id="3140892">error</span><span class="op" id="3140897">)</span>&nbsp;<span class="op" id="3140899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140902">var</span>&nbsp;<span class="ident" id="3140906">sotype</span>&nbsp;<span class="builtintype" id="3140913">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140918">switch</span>&nbsp;<span class="ident" id="3140925">net</span>&nbsp;<span class="op" id="3140929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140932">case</span>&nbsp;<span class="string" id="3140937">&#34;unix&#34;</span><span class="op" id="3140943">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140947">sotype</span>&nbsp;<span class="op" id="3140954">=</span>&nbsp;<span class="ident" id="3140956">syscall</span><span class="op" id="3140963">.</span><span class="ident" id="3140964">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140977">case</span>&nbsp;<span class="string" id="3140982">&#34;unixgram&#34;</span><span class="op" id="3140992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140996">sotype</span>&nbsp;<span class="op" id="3141003">=</span>&nbsp;<span class="ident" id="3141005">syscall</span><span class="op" id="3141012">.</span><span class="ident" id="3141013">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141025">case</span>&nbsp;<span class="string" id="3141030">&#34;unixpacket&#34;</span><span class="op" id="3141042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141046">sotype</span>&nbsp;<span class="op" id="3141053">=</span>&nbsp;<span class="ident" id="3141055">syscall</span><span class="op" id="3141062">.</span><span class="ident" id="3141063">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141079">default</span><span class="op" id="3141086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141090">return</span>&nbsp;<span class="ident" id="3141097">nil</span><span class="op" id="3141100">,</span>&nbsp;<span class="ident" id="3141102">UnknownNetworkError</span><span class="op" id="3141121">(</span><span class="ident" id="3141122">net</span><span class="op" id="3141125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141132">switch</span>&nbsp;<span class="ident" id="3141139">mode</span>&nbsp;<span class="op" id="3141144">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141147">case</span>&nbsp;<span class="string" id="3141152">&#34;dial&#34;</span><span class="op" id="3141158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141162">if</span>&nbsp;<span class="ident" id="3141165">laddr</span>&nbsp;<span class="op" id="3141171">!=</span>&nbsp;<span class="ident" id="3141174">nil</span>&nbsp;<span class="op" id="3141178">&amp;&amp;</span>&nbsp;<span class="ident" id="3141181">laddr</span><span class="op" id="3141186">.</span><span class="ident" id="3141187">isWildcard</span><span class="op" id="3141197">(</span><span class="op" id="3141198">)</span>&nbsp;<span class="op" id="3141200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141205">laddr</span>&nbsp;<span class="op" id="3141211">=</span>&nbsp;<span class="ident" id="3141213">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141223">if</span>&nbsp;<span class="ident" id="3141226">raddr</span>&nbsp;<span class="op" id="3141232">!=</span>&nbsp;<span class="ident" id="3141235">nil</span>&nbsp;<span class="op" id="3141239">&amp;&amp;</span>&nbsp;<span class="ident" id="3141242">raddr</span><span class="op" id="3141247">.</span><span class="ident" id="3141248">isWildcard</span><span class="op" id="3141258">(</span><span class="op" id="3141259">)</span>&nbsp;<span class="op" id="3141261">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141266">raddr</span>&nbsp;<span class="op" id="3141272">=</span>&nbsp;<span class="ident" id="3141274">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141284">if</span>&nbsp;<span class="ident" id="3141287">raddr</span>&nbsp;<span class="op" id="3141293">==</span>&nbsp;<span class="ident" id="3141296">nil</span>&nbsp;<span class="op" id="3141300">&amp;&amp;</span>&nbsp;<span class="op" id="3141303">(</span><span class="ident" id="3141304">sotype</span>&nbsp;<span class="op" id="3141311">!=</span>&nbsp;<span class="ident" id="3141314">syscall</span><span class="op" id="3141321">.</span><span class="ident" id="3141322">SOCK_DGRAM</span>&nbsp;<span class="op" id="3141333">||</span>&nbsp;<span class="ident" id="3141336">laddr</span>&nbsp;<span class="op" id="3141342">==</span>&nbsp;<span class="ident" id="3141345">nil</span><span class="op" id="3141348">)</span>&nbsp;<span class="op" id="3141350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141355">return</span>&nbsp;<span class="ident" id="3141362">nil</span><span class="op" id="3141365">,</span>&nbsp;<span class="ident" id="3141367">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141387">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141390">case</span>&nbsp;<span class="string" id="3141395">&#34;listen&#34;</span><span class="op" id="3141403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141406">default</span><span class="op" id="3141413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141417">return</span>&nbsp;<span class="ident" id="3141424">nil</span><span class="op" id="3141427">,</span>&nbsp;<span class="ident" id="3141429">errors</span><span class="op" id="3141435">.</span><span class="ident" id="3141436">New</span><span class="op" id="3141439">(</span><span class="string" id="3141440">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3141457">+</span>&nbsp;<span class="ident" id="3141459">mode</span><span class="op" id="3141463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141470">fd</span><span class="op" id="3141472">,</span>&nbsp;<span class="ident" id="3141474">err</span>&nbsp;<span class="op" id="3141478">:=</span>&nbsp;<span class="ident" id="3141481">socket</span><span class="op" id="3141487">(</span><span class="ident" id="3141488">net</span><span class="op" id="3141491">,</span>&nbsp;<span class="ident" id="3141493">syscall</span><span class="op" id="3141500">.</span><span class="ident" id="3141501">AF_UNIX</span><span class="op" id="3141508">,</span>&nbsp;<span class="ident" id="3141510">sotype</span><span class="op" id="3141516">,</span>&nbsp;<span class="num" id="3141518">0</span><span class="op" id="3141519">,</span>&nbsp;<span class="builtintype" id="3141521">false</span><span class="op" id="3141526">,</span>&nbsp;<span class="ident" id="3141528">laddr</span><span class="op" id="3141533">,</span>&nbsp;<span class="ident" id="3141535">raddr</span><span class="op" id="3141540">,</span>&nbsp;<span class="ident" id="3141542">deadline</span><span class="op" id="3141550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141553">if</span>&nbsp;<span class="ident" id="3141556">err</span>&nbsp;<span class="op" id="3141560">!=</span>&nbsp;<span class="ident" id="3141563">nil</span>&nbsp;<span class="op" id="3141567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141571">return</span>&nbsp;<span class="ident" id="3141578">nil</span><span class="op" id="3141581">,</span>&nbsp;<span class="ident" id="3141583">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141591">return</span>&nbsp;<span class="ident" id="3141598">fd</span><span class="op" id="3141600">,</span>&nbsp;<span class="ident" id="3141602">nil</span><br>
<span class="lineno">50</span><span class="op" id="3141606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3141609">func</span>&nbsp;<span class="ident" id="3141614">sockaddrToUnix</span><span class="op" id="3141628">(</span><span class="ident" id="3141629">sa</span>&nbsp;<span class="ident" id="3141632">syscall</span><span class="op" id="3141639">.</span><span class="ident" id="3141640">Sockaddr</span><span class="op" id="3141648">)</span>&nbsp;<span class="ident" id="3141650">Addr</span>&nbsp;<span class="op" id="3141655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141658">if</span>&nbsp;<span class="ident" id="3141661">s</span><span class="op" id="3141662">,</span>&nbsp;<span class="ident" id="3141664">ok</span>&nbsp;<span class="op" id="3141667">:=</span>&nbsp;<span class="ident" id="3141670">sa</span><span class="op" id="3141672">.</span><span class="op" id="3141673">(</span><span class="op" id="3141674">*</span><span class="ident" id="3141675">syscall</span><span class="op" id="3141682">.</span><span class="ident" id="3141683">SockaddrUnix</span><span class="op" id="3141695">)</span><span class="op" id="3141696">;</span>&nbsp;<span class="ident" id="3141698">ok</span>&nbsp;<span class="op" id="3141701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141705">return</span>&nbsp;<span class="op" id="3141712">&amp;</span><span class="ident" id="3141713">UnixAddr</span><span class="op" id="3141721">{</span><span class="ident" id="3141722">Name</span><span class="op" id="3141726">:</span>&nbsp;<span class="ident" id="3141728">s</span><span class="op" id="3141729">.</span><span class="ident" id="3141730">Name</span><span class="op" id="3141734">,</span>&nbsp;<span class="ident" id="3141736">Net</span><span class="op" id="3141739">:</span>&nbsp;<span class="string" id="3141741">&#34;unix&#34;</span><span class="op" id="3141747">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141753">return</span>&nbsp;<span class="ident" id="3141760">nil</span><br>
<span class="lineno"></span><span class="op" id="3141764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3141767">func</span>&nbsp;<span class="ident" id="3141772">sockaddrToUnixgram</span><span class="op" id="3141790">(</span><span class="ident" id="3141791">sa</span>&nbsp;<span class="ident" id="3141794">syscall</span><span class="op" id="3141801">.</span><span class="ident" id="3141802">Sockaddr</span><span class="op" id="3141810">)</span>&nbsp;<span class="ident" id="3141812">Addr</span>&nbsp;<span class="op" id="3141817">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141820">if</span>&nbsp;<span class="ident" id="3141823">s</span><span class="op" id="3141824">,</span>&nbsp;<span class="ident" id="3141826">ok</span>&nbsp;<span class="op" id="3141829">:=</span>&nbsp;<span class="ident" id="3141832">sa</span><span class="op" id="3141834">.</span><span class="op" id="3141835">(</span><span class="op" id="3141836">*</span><span class="ident" id="3141837">syscall</span><span class="op" id="3141844">.</span><span class="ident" id="3141845">SockaddrUnix</span><span class="op" id="3141857">)</span><span class="op" id="3141858">;</span>&nbsp;<span class="ident" id="3141860">ok</span>&nbsp;<span class="op" id="3141863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141867">return</span>&nbsp;<span class="op" id="3141874">&amp;</span><span class="ident" id="3141875">UnixAddr</span><span class="op" id="3141883">{</span><span class="ident" id="3141884">Name</span><span class="op" id="3141888">:</span>&nbsp;<span class="ident" id="3141890">s</span><span class="op" id="3141891">.</span><span class="ident" id="3141892">Name</span><span class="op" id="3141896">,</span>&nbsp;<span class="ident" id="3141898">Net</span><span class="op" id="3141901">:</span>&nbsp;<span class="string" id="3141903">&#34;unixgram&#34;</span><span class="op" id="3141913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141919">return</span>&nbsp;<span class="ident" id="3141926">nil</span><br>
<span class="lineno"></span><span class="op" id="3141930">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3141933">func</span>&nbsp;<span class="ident" id="3141938">sockaddrToUnixpacket</span><span class="op" id="3141958">(</span><span class="ident" id="3141959">sa</span>&nbsp;<span class="ident" id="3141962">syscall</span><span class="op" id="3141969">.</span><span class="ident" id="3141970">Sockaddr</span><span class="op" id="3141978">)</span>&nbsp;<span class="ident" id="3141980">Addr</span>&nbsp;<span class="op" id="3141985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141988">if</span>&nbsp;<span class="ident" id="3141991">s</span><span class="op" id="3141992">,</span>&nbsp;<span class="ident" id="3141994">ok</span>&nbsp;<span class="op" id="3141997">:=</span>&nbsp;<span class="ident" id="3142000">sa</span><span class="op" id="3142002">.</span><span class="op" id="3142003">(</span><span class="op" id="3142004">*</span><span class="ident" id="3142005">syscall</span><span class="op" id="3142012">.</span><span class="ident" id="3142013">SockaddrUnix</span><span class="op" id="3142025">)</span><span class="op" id="3142026">;</span>&nbsp;<span class="ident" id="3142028">ok</span>&nbsp;<span class="op" id="3142031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142035">return</span>&nbsp;<span class="op" id="3142042">&amp;</span><span class="ident" id="3142043">UnixAddr</span><span class="op" id="3142051">{</span><span class="ident" id="3142052">Name</span><span class="op" id="3142056">:</span>&nbsp;<span class="ident" id="3142058">s</span><span class="op" id="3142059">.</span><span class="ident" id="3142060">Name</span><span class="op" id="3142064">,</span>&nbsp;<span class="ident" id="3142066">Net</span><span class="op" id="3142069">:</span>&nbsp;<span class="string" id="3142071">&#34;unixpacket&#34;</span><span class="op" id="3142083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142086">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142089">return</span>&nbsp;<span class="ident" id="3142096">nil</span><br>
<span class="lineno"></span><span class="op" id="3142100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3142103">func</span>&nbsp;<span class="ident" id="3142108">sotypeToNet</span><span class="op" id="3142119">(</span><span class="ident" id="3142120">sotype</span>&nbsp;<span class="builtintype" id="3142127">int</span><span class="op" id="3142130">)</span>&nbsp;<span class="builtintype" id="3142132">string</span>&nbsp;<span class="op" id="3142139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142142">switch</span>&nbsp;<span class="ident" id="3142149">sotype</span>&nbsp;<span class="op" id="3142156">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142159">case</span>&nbsp;<span class="ident" id="3142164">syscall</span><span class="op" id="3142171">.</span><span class="ident" id="3142172">SOCK_STREAM</span><span class="op" id="3142183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142187">return</span>&nbsp;<span class="string" id="3142194">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142202">case</span>&nbsp;<span class="ident" id="3142207">syscall</span><span class="op" id="3142214">.</span><span class="ident" id="3142215">SOCK_DGRAM</span><span class="op" id="3142225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142229">return</span>&nbsp;<span class="string" id="3142236">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142248">case</span>&nbsp;<span class="ident" id="3142253">syscall</span><span class="op" id="3142260">.</span><span class="ident" id="3142261">SOCK_SEQPACKET</span><span class="op" id="3142275">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142279">return</span>&nbsp;<span class="string" id="3142286">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142300">default</span><span class="op" id="3142307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3142311">panic</span><span class="op" id="3142316">(</span><span class="string" id="3142317">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3142350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142353">}</span><br>
<span class="lineno"></span><span class="op" id="3142355">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3142358">func</span>&nbsp;<span class="op" id="3142363">(</span><span class="ident" id="3142364">a</span>&nbsp;<span class="op" id="3142366">*</span><span class="ident" id="3142367">UnixAddr</span><span class="op" id="3142375">)</span>&nbsp;<span class="ident" id="3142377">family</span><span class="op" id="3142383">(</span><span class="op" id="3142384">)</span>&nbsp;<span class="builtintype" id="3142386">int</span>&nbsp;<span class="op" id="3142390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142393">return</span>&nbsp;<span class="ident" id="3142400">syscall</span><span class="op" id="3142407">.</span><span class="ident" id="3142408">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3142416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3142419">func</span>&nbsp;<span class="op" id="3142424">(</span><span class="ident" id="3142425">a</span>&nbsp;<span class="op" id="3142427">*</span><span class="ident" id="3142428">UnixAddr</span><span class="op" id="3142436">)</span>&nbsp;<span class="ident" id="3142438">isWildcard</span><span class="op" id="3142448">(</span><span class="op" id="3142449">)</span>&nbsp;<span class="builtintype" id="3142451">bool</span>&nbsp;<span class="op" id="3142456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142459">return</span>&nbsp;<span class="ident" id="3142466">a</span>&nbsp;<span class="op" id="3142468">==</span>&nbsp;<span class="ident" id="3142471">nil</span>&nbsp;<span class="op" id="3142475">||</span>&nbsp;<span class="ident" id="3142478">a</span><span class="op" id="3142479">.</span><span class="ident" id="3142480">Name</span>&nbsp;<span class="op" id="3142485">==</span>&nbsp;<span class="string" id="3142488">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3142491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3142494">func</span>&nbsp;<span class="op" id="3142499">(</span><span class="ident" id="3142500">a</span>&nbsp;<span class="op" id="3142502">*</span><span class="ident" id="3142503">UnixAddr</span><span class="op" id="3142511">)</span>&nbsp;<span class="ident" id="3142513">sockaddr</span><span class="op" id="3142521">(</span><span class="ident" id="3142522">family</span>&nbsp;<span class="builtintype" id="3142529">int</span><span class="op" id="3142532">)</span>&nbsp;<span class="op" id="3142534">(</span><span class="ident" id="3142535">syscall</span><span class="op" id="3142542">.</span><span class="ident" id="3142543">Sockaddr</span><span class="op" id="3142551">,</span>&nbsp;<span class="builtintype" id="3142553">error</span><span class="op" id="3142558">)</span>&nbsp;<span class="op" id="3142560">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142563">if</span>&nbsp;<span class="ident" id="3142566">a</span>&nbsp;<span class="op" id="3142568">==</span>&nbsp;<span class="ident" id="3142571">nil</span>&nbsp;<span class="op" id="3142575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142579">return</span>&nbsp;<span class="ident" id="3142586">nil</span><span class="op" id="3142589">,</span>&nbsp;<span class="ident" id="3142591">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142599">return</span>&nbsp;<span class="op" id="3142606">&amp;</span><span class="ident" id="3142607">syscall</span><span class="op" id="3142614">.</span><span class="ident" id="3142615">SockaddrUnix</span><span class="op" id="3142627">{</span><span class="ident" id="3142628">Name</span><span class="op" id="3142632">:</span>&nbsp;<span class="ident" id="3142634">a</span><span class="op" id="3142635">.</span><span class="ident" id="3142636">Name</span><span class="op" id="3142640">}</span><span class="op" id="3142641">,</span>&nbsp;<span class="ident" id="3142643">nil</span><br>
<span class="lineno"></span><span class="op" id="3142647">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3142650">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3142721">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3142748">type</span>&nbsp;<span class="ident" id="3142753">UnixConn</span>&nbsp;<span class="keyword" id="3142762">struct</span>&nbsp;<span class="op" id="3142769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142772">conn</span><br>
<span class="lineno">105</span><span class="op" id="3142777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3142780">func</span>&nbsp;<span class="ident" id="3142785">newUnixConn</span><span class="op" id="3142796">(</span><span class="ident" id="3142797">fd</span>&nbsp;<span class="op" id="3142800">*</span><span class="ident" id="3142801">netFD</span><span class="op" id="3142806">)</span>&nbsp;<span class="op" id="3142808">*</span><span class="ident" id="3142809">UnixConn</span>&nbsp;<span class="op" id="3142818">{</span>&nbsp;<span class="keyword" id="3142820">return</span>&nbsp;<span class="op" id="3142827">&amp;</span><span class="ident" id="3142828">UnixConn</span><span class="op" id="3142836">{</span><span class="ident" id="3142837">conn</span><span class="op" id="3142841">{</span><span class="ident" id="3142842">fd</span><span class="op" id="3142844">}</span><span class="op" id="3142845">}</span>&nbsp;<span class="op" id="3142847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3142850">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3142921">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3142992">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3143007">//</span><br>
<span class="lineno"></span><span class="comment" id="3143010">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3143075">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3143142">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3143162">func</span>&nbsp;<span class="op" id="3143167">(</span><span class="ident" id="3143168">c</span>&nbsp;<span class="op" id="3143170">*</span><span class="ident" id="3143171">UnixConn</span><span class="op" id="3143179">)</span>&nbsp;<span class="ident" id="3143181">ReadFromUnix</span><span class="op" id="3143193">(</span><span class="ident" id="3143194">b</span>&nbsp;<span class="op" id="3143196">[</span><span class="op" id="3143197">]</span><span class="builtintype" id="3143198">byte</span><span class="op" id="3143202">)</span>&nbsp;<span class="op" id="3143204">(</span><span class="ident" id="3143205">n</span>&nbsp;<span class="builtintype" id="3143207">int</span><span class="op" id="3143210">,</span>&nbsp;<span class="ident" id="3143212">addr</span>&nbsp;<span class="op" id="3143217">*</span><span class="ident" id="3143218">UnixAddr</span><span class="op" id="3143226">,</span>&nbsp;<span class="ident" id="3143228">err</span>&nbsp;<span class="builtintype" id="3143232">error</span><span class="op" id="3143237">)</span>&nbsp;<span class="op" id="3143239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143242">if</span>&nbsp;<span class="op" id="3143245">!</span><span class="ident" id="3143246">c</span><span class="op" id="3143247">.</span><span class="ident" id="3143248">ok</span><span class="op" id="3143250">(</span><span class="op" id="3143251">)</span>&nbsp;<span class="op" id="3143253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143257">return</span>&nbsp;<span class="num" id="3143264">0</span><span class="op" id="3143265">,</span>&nbsp;<span class="ident" id="3143267">nil</span><span class="op" id="3143270">,</span>&nbsp;<span class="ident" id="3143272">syscall</span><span class="op" id="3143279">.</span><span class="ident" id="3143280">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143288">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143291">n</span><span class="op" id="3143292">,</span>&nbsp;<span class="ident" id="3143294">sa</span><span class="op" id="3143296">,</span>&nbsp;<span class="ident" id="3143298">err</span>&nbsp;<span class="op" id="3143302">:=</span>&nbsp;<span class="ident" id="3143305">c</span><span class="op" id="3143306">.</span><span class="ident" id="3143307">fd</span><span class="op" id="3143309">.</span><span class="ident" id="3143310">readFrom</span><span class="op" id="3143318">(</span><span class="ident" id="3143319">b</span><span class="op" id="3143320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143323">switch</span>&nbsp;<span class="ident" id="3143330">sa</span>&nbsp;<span class="op" id="3143333">:=</span>&nbsp;<span class="ident" id="3143336">sa</span><span class="op" id="3143338">.</span><span class="op" id="3143339">(</span><span class="keyword" id="3143340">type</span><span class="op" id="3143344">)</span>&nbsp;<span class="op" id="3143346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143349">case</span>&nbsp;<span class="op" id="3143354">*</span><span class="ident" id="3143355">syscall</span><span class="op" id="3143362">.</span><span class="ident" id="3143363">SockaddrUnix</span><span class="op" id="3143375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143379">if</span>&nbsp;<span class="ident" id="3143382">sa</span><span class="op" id="3143384">.</span><span class="ident" id="3143385">Name</span>&nbsp;<span class="op" id="3143390">!=</span>&nbsp;<span class="string" id="3143393">&#34;&#34;</span>&nbsp;<span class="op" id="3143396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143401">addr</span>&nbsp;<span class="op" id="3143406">=</span>&nbsp;<span class="op" id="3143408">&amp;</span><span class="ident" id="3143409">UnixAddr</span><span class="op" id="3143417">{</span><span class="ident" id="3143418">Name</span><span class="op" id="3143422">:</span>&nbsp;<span class="ident" id="3143424">sa</span><span class="op" id="3143426">.</span><span class="ident" id="3143427">Name</span><span class="op" id="3143431">,</span>&nbsp;<span class="ident" id="3143433">Net</span><span class="op" id="3143436">:</span>&nbsp;<span class="ident" id="3143438">sotypeToNet</span><span class="op" id="3143449">(</span><span class="ident" id="3143450">c</span><span class="op" id="3143451">.</span><span class="ident" id="3143452">fd</span><span class="op" id="3143454">.</span><span class="ident" id="3143455">sotype</span><span class="op" id="3143461">)</span><span class="op" id="3143462">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143472">return</span><br>
<span class="lineno"></span><span class="op" id="3143479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3143482">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3143537">func</span>&nbsp;<span class="op" id="3143542">(</span><span class="ident" id="3143543">c</span>&nbsp;<span class="op" id="3143545">*</span><span class="ident" id="3143546">UnixConn</span><span class="op" id="3143554">)</span>&nbsp;<span class="ident" id="3143556">ReadFrom</span><span class="op" id="3143564">(</span><span class="ident" id="3143565">b</span>&nbsp;<span class="op" id="3143567">[</span><span class="op" id="3143568">]</span><span class="builtintype" id="3143569">byte</span><span class="op" id="3143573">)</span>&nbsp;<span class="op" id="3143575">(</span><span class="builtintype" id="3143576">int</span><span class="op" id="3143579">,</span>&nbsp;<span class="ident" id="3143581">Addr</span><span class="op" id="3143585">,</span>&nbsp;<span class="builtintype" id="3143587">error</span><span class="op" id="3143592">)</span>&nbsp;<span class="op" id="3143594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143597">if</span>&nbsp;<span class="op" id="3143600">!</span><span class="ident" id="3143601">c</span><span class="op" id="3143602">.</span><span class="ident" id="3143603">ok</span><span class="op" id="3143605">(</span><span class="op" id="3143606">)</span>&nbsp;<span class="op" id="3143608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143612">return</span>&nbsp;<span class="num" id="3143619">0</span><span class="op" id="3143620">,</span>&nbsp;<span class="ident" id="3143622">nil</span><span class="op" id="3143625">,</span>&nbsp;<span class="ident" id="3143627">syscall</span><span class="op" id="3143634">.</span><span class="ident" id="3143635">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143643">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143646">n</span><span class="op" id="3143647">,</span>&nbsp;<span class="ident" id="3143649">addr</span><span class="op" id="3143653">,</span>&nbsp;<span class="ident" id="3143655">err</span>&nbsp;<span class="op" id="3143659">:=</span>&nbsp;<span class="ident" id="3143662">c</span><span class="op" id="3143663">.</span><span class="ident" id="3143664">ReadFromUnix</span><span class="op" id="3143676">(</span><span class="ident" id="3143677">b</span><span class="op" id="3143678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143681">return</span>&nbsp;<span class="ident" id="3143688">n</span><span class="op" id="3143689">,</span>&nbsp;<span class="ident" id="3143691">addr</span><span class="op" id="3143695">.</span><span class="ident" id="3143696">toAddr</span><span class="op" id="3143702">(</span><span class="op" id="3143703">)</span><span class="op" id="3143704">,</span>&nbsp;<span class="ident" id="3143706">err</span><br>
<span class="lineno"></span><span class="op" id="3143710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3143713">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3143782">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3143853">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3143924">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3143994">func</span>&nbsp;<span class="op" id="3143999">(</span><span class="ident" id="3144000">c</span>&nbsp;<span class="op" id="3144002">*</span><span class="ident" id="3144003">UnixConn</span><span class="op" id="3144011">)</span>&nbsp;<span class="ident" id="3144013">ReadMsgUnix</span><span class="op" id="3144024">(</span><span class="ident" id="3144025">b</span><span class="op" id="3144026">,</span>&nbsp;<span class="ident" id="3144028">oob</span>&nbsp;<span class="op" id="3144032">[</span><span class="op" id="3144033">]</span><span class="builtintype" id="3144034">byte</span><span class="op" id="3144038">)</span>&nbsp;<span class="op" id="3144040">(</span><span class="ident" id="3144041">n</span><span class="op" id="3144042">,</span>&nbsp;<span class="ident" id="3144044">oobn</span><span class="op" id="3144048">,</span>&nbsp;<span class="ident" id="3144050">flags</span>&nbsp;<span class="builtintype" id="3144056">int</span><span class="op" id="3144059">,</span>&nbsp;<span class="ident" id="3144061">addr</span>&nbsp;<span class="op" id="3144066">*</span><span class="ident" id="3144067">UnixAddr</span><span class="op" id="3144075">,</span>&nbsp;<span class="ident" id="3144077">err</span>&nbsp;<span class="builtintype" id="3144081">error</span><span class="op" id="3144086">)</span>&nbsp;<span class="op" id="3144088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144091">if</span>&nbsp;<span class="op" id="3144094">!</span><span class="ident" id="3144095">c</span><span class="op" id="3144096">.</span><span class="ident" id="3144097">ok</span><span class="op" id="3144099">(</span><span class="op" id="3144100">)</span>&nbsp;<span class="op" id="3144102">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144106">return</span>&nbsp;<span class="num" id="3144113">0</span><span class="op" id="3144114">,</span>&nbsp;<span class="num" id="3144116">0</span><span class="op" id="3144117">,</span>&nbsp;<span class="num" id="3144119">0</span><span class="op" id="3144120">,</span>&nbsp;<span class="ident" id="3144122">nil</span><span class="op" id="3144125">,</span>&nbsp;<span class="ident" id="3144127">syscall</span><span class="op" id="3144134">.</span><span class="ident" id="3144135">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144146">n</span><span class="op" id="3144147">,</span>&nbsp;<span class="ident" id="3144149">oobn</span><span class="op" id="3144153">,</span>&nbsp;<span class="ident" id="3144155">flags</span><span class="op" id="3144160">,</span>&nbsp;<span class="ident" id="3144162">sa</span><span class="op" id="3144164">,</span>&nbsp;<span class="ident" id="3144166">err</span>&nbsp;<span class="op" id="3144170">:=</span>&nbsp;<span class="ident" id="3144173">c</span><span class="op" id="3144174">.</span><span class="ident" id="3144175">fd</span><span class="op" id="3144177">.</span><span class="ident" id="3144178">readMsg</span><span class="op" id="3144185">(</span><span class="ident" id="3144186">b</span><span class="op" id="3144187">,</span>&nbsp;<span class="ident" id="3144189">oob</span><span class="op" id="3144192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144195">switch</span>&nbsp;<span class="ident" id="3144202">sa</span>&nbsp;<span class="op" id="3144205">:=</span>&nbsp;<span class="ident" id="3144208">sa</span><span class="op" id="3144210">.</span><span class="op" id="3144211">(</span><span class="keyword" id="3144212">type</span><span class="op" id="3144216">)</span>&nbsp;<span class="op" id="3144218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144221">case</span>&nbsp;<span class="op" id="3144226">*</span><span class="ident" id="3144227">syscall</span><span class="op" id="3144234">.</span><span class="ident" id="3144235">SockaddrUnix</span><span class="op" id="3144247">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144251">if</span>&nbsp;<span class="ident" id="3144254">sa</span><span class="op" id="3144256">.</span><span class="ident" id="3144257">Name</span>&nbsp;<span class="op" id="3144262">!=</span>&nbsp;<span class="string" id="3144265">&#34;&#34;</span>&nbsp;<span class="op" id="3144268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144273">addr</span>&nbsp;<span class="op" id="3144278">=</span>&nbsp;<span class="op" id="3144280">&amp;</span><span class="ident" id="3144281">UnixAddr</span><span class="op" id="3144289">{</span><span class="ident" id="3144290">Name</span><span class="op" id="3144294">:</span>&nbsp;<span class="ident" id="3144296">sa</span><span class="op" id="3144298">.</span><span class="ident" id="3144299">Name</span><span class="op" id="3144303">,</span>&nbsp;<span class="ident" id="3144305">Net</span><span class="op" id="3144308">:</span>&nbsp;<span class="ident" id="3144310">sotypeToNet</span><span class="op" id="3144321">(</span><span class="ident" id="3144322">c</span><span class="op" id="3144323">.</span><span class="ident" id="3144324">fd</span><span class="op" id="3144326">.</span><span class="ident" id="3144327">sotype</span><span class="op" id="3144333">)</span><span class="op" id="3144334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144344">return</span><br>
<span class="lineno">155</span><span class="op" id="3144351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3144354">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3144428">//</span><br>
<span class="lineno"></span><span class="comment" id="3144431">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3144495">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3144562">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3144631">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3144644">func</span>&nbsp;<span class="op" id="3144649">(</span><span class="ident" id="3144650">c</span>&nbsp;<span class="op" id="3144652">*</span><span class="ident" id="3144653">UnixConn</span><span class="op" id="3144661">)</span>&nbsp;<span class="ident" id="3144663">WriteToUnix</span><span class="op" id="3144674">(</span><span class="ident" id="3144675">b</span>&nbsp;<span class="op" id="3144677">[</span><span class="op" id="3144678">]</span><span class="builtintype" id="3144679">byte</span><span class="op" id="3144683">,</span>&nbsp;<span class="ident" id="3144685">addr</span>&nbsp;<span class="op" id="3144690">*</span><span class="ident" id="3144691">UnixAddr</span><span class="op" id="3144699">)</span>&nbsp;<span class="op" id="3144701">(</span><span class="ident" id="3144702">n</span>&nbsp;<span class="builtintype" id="3144704">int</span><span class="op" id="3144707">,</span>&nbsp;<span class="ident" id="3144709">err</span>&nbsp;<span class="builtintype" id="3144713">error</span><span class="op" id="3144718">)</span>&nbsp;<span class="op" id="3144720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144723">if</span>&nbsp;<span class="op" id="3144726">!</span><span class="ident" id="3144727">c</span><span class="op" id="3144728">.</span><span class="ident" id="3144729">ok</span><span class="op" id="3144731">(</span><span class="op" id="3144732">)</span>&nbsp;<span class="op" id="3144734">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144738">return</span>&nbsp;<span class="num" id="3144745">0</span><span class="op" id="3144746">,</span>&nbsp;<span class="ident" id="3144748">syscall</span><span class="op" id="3144755">.</span><span class="ident" id="3144756">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144767">if</span>&nbsp;<span class="ident" id="3144770">c</span><span class="op" id="3144771">.</span><span class="ident" id="3144772">fd</span><span class="op" id="3144774">.</span><span class="ident" id="3144775">isConnected</span>&nbsp;<span class="op" id="3144787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144791">return</span>&nbsp;<span class="num" id="3144798">0</span><span class="op" id="3144799">,</span>&nbsp;<span class="op" id="3144801">&amp;</span><span class="ident" id="3144802">OpError</span><span class="op" id="3144809">{</span><span class="ident" id="3144810">Op</span><span class="op" id="3144812">:</span>&nbsp;<span class="string" id="3144814">&#34;write&#34;</span><span class="op" id="3144821">,</span>&nbsp;<span class="ident" id="3144823">Net</span><span class="op" id="3144826">:</span>&nbsp;<span class="ident" id="3144828">c</span><span class="op" id="3144829">.</span><span class="ident" id="3144830">fd</span><span class="op" id="3144832">.</span><span class="ident" id="3144833">net</span><span class="op" id="3144836">,</span>&nbsp;<span class="ident" id="3144838">Addr</span><span class="op" id="3144842">:</span>&nbsp;<span class="ident" id="3144844">addr</span><span class="op" id="3144848">,</span>&nbsp;<span class="ident" id="3144850">Err</span><span class="op" id="3144853">:</span>&nbsp;<span class="ident" id="3144855">ErrWriteToConnected</span><span class="op" id="3144874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144877">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144880">if</span>&nbsp;<span class="ident" id="3144883">addr</span>&nbsp;<span class="op" id="3144888">==</span>&nbsp;<span class="ident" id="3144891">nil</span>&nbsp;<span class="op" id="3144895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144899">return</span>&nbsp;<span class="num" id="3144906">0</span><span class="op" id="3144907">,</span>&nbsp;<span class="op" id="3144909">&amp;</span><span class="ident" id="3144910">OpError</span><span class="op" id="3144917">{</span><span class="ident" id="3144918">Op</span><span class="op" id="3144920">:</span>&nbsp;<span class="string" id="3144922">&#34;write&#34;</span><span class="op" id="3144929">,</span>&nbsp;<span class="ident" id="3144931">Net</span><span class="op" id="3144934">:</span>&nbsp;<span class="ident" id="3144936">c</span><span class="op" id="3144937">.</span><span class="ident" id="3144938">fd</span><span class="op" id="3144940">.</span><span class="ident" id="3144941">net</span><span class="op" id="3144944">,</span>&nbsp;<span class="ident" id="3144946">Addr</span><span class="op" id="3144950">:</span>&nbsp;<span class="ident" id="3144952">nil</span><span class="op" id="3144955">,</span>&nbsp;<span class="ident" id="3144957">Err</span><span class="op" id="3144960">:</span>&nbsp;<span class="ident" id="3144962">errMissingAddress</span><span class="op" id="3144979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144985">if</span>&nbsp;<span class="ident" id="3144988">addr</span><span class="op" id="3144992">.</span><span class="ident" id="3144993">Net</span>&nbsp;<span class="op" id="3144997">!=</span>&nbsp;<span class="ident" id="3145000">sotypeToNet</span><span class="op" id="3145011">(</span><span class="ident" id="3145012">c</span><span class="op" id="3145013">.</span><span class="ident" id="3145014">fd</span><span class="op" id="3145016">.</span><span class="ident" id="3145017">sotype</span><span class="op" id="3145023">)</span>&nbsp;<span class="op" id="3145025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145029">return</span>&nbsp;<span class="num" id="3145036">0</span><span class="op" id="3145037">,</span>&nbsp;<span class="ident" id="3145039">syscall</span><span class="op" id="3145046">.</span><span class="ident" id="3145047">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145064">sa</span>&nbsp;<span class="op" id="3145067">:=</span>&nbsp;<span class="op" id="3145070">&amp;</span><span class="ident" id="3145071">syscall</span><span class="op" id="3145078">.</span><span class="ident" id="3145079">SockaddrUnix</span><span class="op" id="3145091">{</span><span class="ident" id="3145092">Name</span><span class="op" id="3145096">:</span>&nbsp;<span class="ident" id="3145098">addr</span><span class="op" id="3145102">.</span><span class="ident" id="3145103">Name</span><span class="op" id="3145107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145110">return</span>&nbsp;<span class="ident" id="3145117">c</span><span class="op" id="3145118">.</span><span class="ident" id="3145119">fd</span><span class="op" id="3145121">.</span><span class="ident" id="3145122">writeTo</span><span class="op" id="3145129">(</span><span class="ident" id="3145130">b</span><span class="op" id="3145131">,</span>&nbsp;<span class="ident" id="3145133">sa</span><span class="op" id="3145135">)</span><br>
<span class="lineno"></span><span class="op" id="3145137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3145140">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3145193">func</span>&nbsp;<span class="op" id="3145198">(</span><span class="ident" id="3145199">c</span>&nbsp;<span class="op" id="3145201">*</span><span class="ident" id="3145202">UnixConn</span><span class="op" id="3145210">)</span>&nbsp;<span class="ident" id="3145212">WriteTo</span><span class="op" id="3145219">(</span><span class="ident" id="3145220">b</span>&nbsp;<span class="op" id="3145222">[</span><span class="op" id="3145223">]</span><span class="builtintype" id="3145224">byte</span><span class="op" id="3145228">,</span>&nbsp;<span class="ident" id="3145230">addr</span>&nbsp;<span class="ident" id="3145235">Addr</span><span class="op" id="3145239">)</span>&nbsp;<span class="op" id="3145241">(</span><span class="ident" id="3145242">n</span>&nbsp;<span class="builtintype" id="3145244">int</span><span class="op" id="3145247">,</span>&nbsp;<span class="ident" id="3145249">err</span>&nbsp;<span class="builtintype" id="3145253">error</span><span class="op" id="3145258">)</span>&nbsp;<span class="op" id="3145260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145263">if</span>&nbsp;<span class="op" id="3145266">!</span><span class="ident" id="3145267">c</span><span class="op" id="3145268">.</span><span class="ident" id="3145269">ok</span><span class="op" id="3145271">(</span><span class="op" id="3145272">)</span>&nbsp;<span class="op" id="3145274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145278">return</span>&nbsp;<span class="num" id="3145285">0</span><span class="op" id="3145286">,</span>&nbsp;<span class="ident" id="3145288">syscall</span><span class="op" id="3145295">.</span><span class="ident" id="3145296">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145304">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145307">a</span><span class="op" id="3145308">,</span>&nbsp;<span class="ident" id="3145310">ok</span>&nbsp;<span class="op" id="3145313">:=</span>&nbsp;<span class="ident" id="3145316">addr</span><span class="op" id="3145320">.</span><span class="op" id="3145321">(</span><span class="op" id="3145322">*</span><span class="ident" id="3145323">UnixAddr</span><span class="op" id="3145331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145334">if</span>&nbsp;<span class="op" id="3145337">!</span><span class="ident" id="3145338">ok</span>&nbsp;<span class="op" id="3145341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145345">return</span>&nbsp;<span class="num" id="3145352">0</span><span class="op" id="3145353">,</span>&nbsp;<span class="op" id="3145355">&amp;</span><span class="ident" id="3145356">OpError</span><span class="op" id="3145363">{</span><span class="string" id="3145364">&#34;write&#34;</span><span class="op" id="3145371">,</span>&nbsp;<span class="ident" id="3145373">c</span><span class="op" id="3145374">.</span><span class="ident" id="3145375">fd</span><span class="op" id="3145377">.</span><span class="ident" id="3145378">net</span><span class="op" id="3145381">,</span>&nbsp;<span class="ident" id="3145383">addr</span><span class="op" id="3145387">,</span>&nbsp;<span class="ident" id="3145389">syscall</span><span class="op" id="3145396">.</span><span class="ident" id="3145397">EINVAL</span><span class="op" id="3145403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145409">return</span>&nbsp;<span class="ident" id="3145416">c</span><span class="op" id="3145417">.</span><span class="ident" id="3145418">WriteToUnix</span><span class="op" id="3145429">(</span><span class="ident" id="3145430">b</span><span class="op" id="3145431">,</span>&nbsp;<span class="ident" id="3145433">a</span><span class="op" id="3145434">)</span><br>
<span class="lineno">190</span><span class="op" id="3145436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3145439">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3145506">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3145574">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3145630">func</span>&nbsp;<span class="op" id="3145635">(</span><span class="ident" id="3145636">c</span>&nbsp;<span class="op" id="3145638">*</span><span class="ident" id="3145639">UnixConn</span><span class="op" id="3145647">)</span>&nbsp;<span class="ident" id="3145649">WriteMsgUnix</span><span class="op" id="3145661">(</span><span class="ident" id="3145662">b</span><span class="op" id="3145663">,</span>&nbsp;<span class="ident" id="3145665">oob</span>&nbsp;<span class="op" id="3145669">[</span><span class="op" id="3145670">]</span><span class="builtintype" id="3145671">byte</span><span class="op" id="3145675">,</span>&nbsp;<span class="ident" id="3145677">addr</span>&nbsp;<span class="op" id="3145682">*</span><span class="ident" id="3145683">UnixAddr</span><span class="op" id="3145691">)</span>&nbsp;<span class="op" id="3145693">(</span><span class="ident" id="3145694">n</span><span class="op" id="3145695">,</span>&nbsp;<span class="ident" id="3145697">oobn</span>&nbsp;<span class="builtintype" id="3145702">int</span><span class="op" id="3145705">,</span>&nbsp;<span class="ident" id="3145707">err</span>&nbsp;<span class="builtintype" id="3145711">error</span><span class="op" id="3145716">)</span>&nbsp;<span class="op" id="3145718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145721">if</span>&nbsp;<span class="op" id="3145724">!</span><span class="ident" id="3145725">c</span><span class="op" id="3145726">.</span><span class="ident" id="3145727">ok</span><span class="op" id="3145729">(</span><span class="op" id="3145730">)</span>&nbsp;<span class="op" id="3145732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145736">return</span>&nbsp;<span class="num" id="3145743">0</span><span class="op" id="3145744">,</span>&nbsp;<span class="num" id="3145746">0</span><span class="op" id="3145747">,</span>&nbsp;<span class="ident" id="3145749">syscall</span><span class="op" id="3145756">.</span><span class="ident" id="3145757">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145768">if</span>&nbsp;<span class="ident" id="3145771">c</span><span class="op" id="3145772">.</span><span class="ident" id="3145773">fd</span><span class="op" id="3145775">.</span><span class="ident" id="3145776">sotype</span>&nbsp;<span class="op" id="3145783">==</span>&nbsp;<span class="ident" id="3145786">syscall</span><span class="op" id="3145793">.</span><span class="ident" id="3145794">SOCK_DGRAM</span>&nbsp;<span class="op" id="3145805">&amp;&amp;</span>&nbsp;<span class="ident" id="3145808">c</span><span class="op" id="3145809">.</span><span class="ident" id="3145810">fd</span><span class="op" id="3145812">.</span><span class="ident" id="3145813">isConnected</span>&nbsp;<span class="op" id="3145825">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145829">return</span>&nbsp;<span class="num" id="3145836">0</span><span class="op" id="3145837">,</span>&nbsp;<span class="num" id="3145839">0</span><span class="op" id="3145840">,</span>&nbsp;<span class="op" id="3145842">&amp;</span><span class="ident" id="3145843">OpError</span><span class="op" id="3145850">{</span><span class="ident" id="3145851">Op</span><span class="op" id="3145853">:</span>&nbsp;<span class="string" id="3145855">&#34;write&#34;</span><span class="op" id="3145862">,</span>&nbsp;<span class="ident" id="3145864">Net</span><span class="op" id="3145867">:</span>&nbsp;<span class="ident" id="3145869">c</span><span class="op" id="3145870">.</span><span class="ident" id="3145871">fd</span><span class="op" id="3145873">.</span><span class="ident" id="3145874">net</span><span class="op" id="3145877">,</span>&nbsp;<span class="ident" id="3145879">Addr</span><span class="op" id="3145883">:</span>&nbsp;<span class="ident" id="3145885">addr</span><span class="op" id="3145889">,</span>&nbsp;<span class="ident" id="3145891">Err</span><span class="op" id="3145894">:</span>&nbsp;<span class="ident" id="3145896">ErrWriteToConnected</span><span class="op" id="3145915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145921">if</span>&nbsp;<span class="ident" id="3145924">addr</span>&nbsp;<span class="op" id="3145929">!=</span>&nbsp;<span class="ident" id="3145932">nil</span>&nbsp;<span class="op" id="3145936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145940">if</span>&nbsp;<span class="ident" id="3145943">addr</span><span class="op" id="3145947">.</span><span class="ident" id="3145948">Net</span>&nbsp;<span class="op" id="3145952">!=</span>&nbsp;<span class="ident" id="3145955">sotypeToNet</span><span class="op" id="3145966">(</span><span class="ident" id="3145967">c</span><span class="op" id="3145968">.</span><span class="ident" id="3145969">fd</span><span class="op" id="3145971">.</span><span class="ident" id="3145972">sotype</span><span class="op" id="3145978">)</span>&nbsp;<span class="op" id="3145980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145985">return</span>&nbsp;<span class="num" id="3145992">0</span><span class="op" id="3145993">,</span>&nbsp;<span class="num" id="3145995">0</span><span class="op" id="3145996">,</span>&nbsp;<span class="ident" id="3145998">syscall</span><span class="op" id="3146005">.</span><span class="ident" id="3146006">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146025">sa</span>&nbsp;<span class="op" id="3146028">:=</span>&nbsp;<span class="op" id="3146031">&amp;</span><span class="ident" id="3146032">syscall</span><span class="op" id="3146039">.</span><span class="ident" id="3146040">SockaddrUnix</span><span class="op" id="3146052">{</span><span class="ident" id="3146053">Name</span><span class="op" id="3146057">:</span>&nbsp;<span class="ident" id="3146059">addr</span><span class="op" id="3146063">.</span><span class="ident" id="3146064">Name</span><span class="op" id="3146068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146072">return</span>&nbsp;<span class="ident" id="3146079">c</span><span class="op" id="3146080">.</span><span class="ident" id="3146081">fd</span><span class="op" id="3146083">.</span><span class="ident" id="3146084">writeMsg</span><span class="op" id="3146092">(</span><span class="ident" id="3146093">b</span><span class="op" id="3146094">,</span>&nbsp;<span class="ident" id="3146096">oob</span><span class="op" id="3146099">,</span>&nbsp;<span class="ident" id="3146101">sa</span><span class="op" id="3146103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146109">return</span>&nbsp;<span class="ident" id="3146116">c</span><span class="op" id="3146117">.</span><span class="ident" id="3146118">fd</span><span class="op" id="3146120">.</span><span class="ident" id="3146121">writeMsg</span><span class="op" id="3146129">(</span><span class="ident" id="3146130">b</span><span class="op" id="3146131">,</span>&nbsp;<span class="ident" id="3146133">oob</span><span class="op" id="3146136">,</span>&nbsp;<span class="ident" id="3146138">nil</span><span class="op" id="3146141">)</span><br>
<span class="lineno">210</span><span class="op" id="3146143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3146146">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3146218">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3146257">func</span>&nbsp;<span class="op" id="3146262">(</span><span class="ident" id="3146263">c</span>&nbsp;<span class="op" id="3146265">*</span><span class="ident" id="3146266">UnixConn</span><span class="op" id="3146274">)</span>&nbsp;<span class="ident" id="3146276">CloseRead</span><span class="op" id="3146285">(</span><span class="op" id="3146286">)</span>&nbsp;<span class="builtintype" id="3146288">error</span>&nbsp;<span class="op" id="3146294">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146297">if</span>&nbsp;<span class="op" id="3146300">!</span><span class="ident" id="3146301">c</span><span class="op" id="3146302">.</span><span class="ident" id="3146303">ok</span><span class="op" id="3146305">(</span><span class="op" id="3146306">)</span>&nbsp;<span class="op" id="3146308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146312">return</span>&nbsp;<span class="ident" id="3146319">syscall</span><span class="op" id="3146326">.</span><span class="ident" id="3146327">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146338">return</span>&nbsp;<span class="ident" id="3146345">c</span><span class="op" id="3146346">.</span><span class="ident" id="3146347">fd</span><span class="op" id="3146349">.</span><span class="ident" id="3146350">closeRead</span><span class="op" id="3146359">(</span><span class="op" id="3146360">)</span><br>
<span class="lineno"></span><span class="op" id="3146362">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3146365">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3146438">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3146477">func</span>&nbsp;<span class="op" id="3146482">(</span><span class="ident" id="3146483">c</span>&nbsp;<span class="op" id="3146485">*</span><span class="ident" id="3146486">UnixConn</span><span class="op" id="3146494">)</span>&nbsp;<span class="ident" id="3146496">CloseWrite</span><span class="op" id="3146506">(</span><span class="op" id="3146507">)</span>&nbsp;<span class="builtintype" id="3146509">error</span>&nbsp;<span class="op" id="3146515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146518">if</span>&nbsp;<span class="op" id="3146521">!</span><span class="ident" id="3146522">c</span><span class="op" id="3146523">.</span><span class="ident" id="3146524">ok</span><span class="op" id="3146526">(</span><span class="op" id="3146527">)</span>&nbsp;<span class="op" id="3146529">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146533">return</span>&nbsp;<span class="ident" id="3146540">syscall</span><span class="op" id="3146547">.</span><span class="ident" id="3146548">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146559">return</span>&nbsp;<span class="ident" id="3146566">c</span><span class="op" id="3146567">.</span><span class="ident" id="3146568">fd</span><span class="op" id="3146570">.</span><span class="ident" id="3146571">closeWrite</span><span class="op" id="3146581">(</span><span class="op" id="3146582">)</span><br>
<span class="lineno"></span><span class="op" id="3146584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3146587">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3146656">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3146726">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3146786">func</span>&nbsp;<span class="ident" id="3146791">DialUnix</span><span class="op" id="3146799">(</span><span class="ident" id="3146800">net</span>&nbsp;<span class="builtintype" id="3146804">string</span><span class="op" id="3146810">,</span>&nbsp;<span class="ident" id="3146812">laddr</span><span class="op" id="3146817">,</span>&nbsp;<span class="ident" id="3146819">raddr</span>&nbsp;<span class="op" id="3146825">*</span><span class="ident" id="3146826">UnixAddr</span><span class="op" id="3146834">)</span>&nbsp;<span class="op" id="3146836">(</span><span class="op" id="3146837">*</span><span class="ident" id="3146838">UnixConn</span><span class="op" id="3146846">,</span>&nbsp;<span class="builtintype" id="3146848">error</span><span class="op" id="3146853">)</span>&nbsp;<span class="op" id="3146855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146858">switch</span>&nbsp;<span class="ident" id="3146865">net</span>&nbsp;<span class="op" id="3146869">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146872">case</span>&nbsp;<span class="string" id="3146877">&#34;unix&#34;</span><span class="op" id="3146883">,</span>&nbsp;<span class="string" id="3146885">&#34;unixgram&#34;</span><span class="op" id="3146895">,</span>&nbsp;<span class="string" id="3146897">&#34;unixpacket&#34;</span><span class="op" id="3146909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146912">default</span><span class="op" id="3146919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146923">return</span>&nbsp;<span class="ident" id="3146930">nil</span><span class="op" id="3146933">,</span>&nbsp;<span class="op" id="3146935">&amp;</span><span class="ident" id="3146936">OpError</span><span class="op" id="3146943">{</span><span class="ident" id="3146944">Op</span><span class="op" id="3146946">:</span>&nbsp;<span class="string" id="3146948">&#34;dial&#34;</span><span class="op" id="3146954">,</span>&nbsp;<span class="ident" id="3146956">Net</span><span class="op" id="3146959">:</span>&nbsp;<span class="ident" id="3146961">net</span><span class="op" id="3146964">,</span>&nbsp;<span class="ident" id="3146966">Addr</span><span class="op" id="3146970">:</span>&nbsp;<span class="ident" id="3146972">raddr</span><span class="op" id="3146977">,</span>&nbsp;<span class="ident" id="3146979">Err</span><span class="op" id="3146982">:</span>&nbsp;<span class="ident" id="3146984">UnknownNetworkError</span><span class="op" id="3147003">(</span><span class="ident" id="3147004">net</span><span class="op" id="3147007">)</span><span class="op" id="3147008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147014">return</span>&nbsp;<span class="ident" id="3147021">dialUnix</span><span class="op" id="3147029">(</span><span class="ident" id="3147030">net</span><span class="op" id="3147033">,</span>&nbsp;<span class="ident" id="3147035">laddr</span><span class="op" id="3147040">,</span>&nbsp;<span class="ident" id="3147042">raddr</span><span class="op" id="3147047">,</span>&nbsp;<span class="ident" id="3147049">noDeadline</span><span class="op" id="3147059">)</span><br>
<span class="lineno">240</span><span class="op" id="3147061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3147064">func</span>&nbsp;<span class="ident" id="3147069">dialUnix</span><span class="op" id="3147077">(</span><span class="ident" id="3147078">net</span>&nbsp;<span class="builtintype" id="3147082">string</span><span class="op" id="3147088">,</span>&nbsp;<span class="ident" id="3147090">laddr</span><span class="op" id="3147095">,</span>&nbsp;<span class="ident" id="3147097">raddr</span>&nbsp;<span class="op" id="3147103">*</span><span class="ident" id="3147104">UnixAddr</span><span class="op" id="3147112">,</span>&nbsp;<span class="ident" id="3147114">deadline</span>&nbsp;<span class="ident" id="3147123">time</span><span class="op" id="3147127">.</span><span class="ident" id="3147128">Time</span><span class="op" id="3147132">)</span>&nbsp;<span class="op" id="3147134">(</span><span class="op" id="3147135">*</span><span class="ident" id="3147136">UnixConn</span><span class="op" id="3147144">,</span>&nbsp;<span class="builtintype" id="3147146">error</span><span class="op" id="3147151">)</span>&nbsp;<span class="op" id="3147153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147156">fd</span><span class="op" id="3147158">,</span>&nbsp;<span class="ident" id="3147160">err</span>&nbsp;<span class="op" id="3147164">:=</span>&nbsp;<span class="ident" id="3147167">unixSocket</span><span class="op" id="3147177">(</span><span class="ident" id="3147178">net</span><span class="op" id="3147181">,</span>&nbsp;<span class="ident" id="3147183">laddr</span><span class="op" id="3147188">,</span>&nbsp;<span class="ident" id="3147190">raddr</span><span class="op" id="3147195">,</span>&nbsp;<span class="string" id="3147197">&#34;dial&#34;</span><span class="op" id="3147203">,</span>&nbsp;<span class="ident" id="3147205">deadline</span><span class="op" id="3147213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147216">if</span>&nbsp;<span class="ident" id="3147219">err</span>&nbsp;<span class="op" id="3147223">!=</span>&nbsp;<span class="ident" id="3147226">nil</span>&nbsp;<span class="op" id="3147230">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147234">return</span>&nbsp;<span class="ident" id="3147241">nil</span><span class="op" id="3147244">,</span>&nbsp;<span class="op" id="3147246">&amp;</span><span class="ident" id="3147247">OpError</span><span class="op" id="3147254">{</span><span class="ident" id="3147255">Op</span><span class="op" id="3147257">:</span>&nbsp;<span class="string" id="3147259">&#34;dial&#34;</span><span class="op" id="3147265">,</span>&nbsp;<span class="ident" id="3147267">Net</span><span class="op" id="3147270">:</span>&nbsp;<span class="ident" id="3147272">net</span><span class="op" id="3147275">,</span>&nbsp;<span class="ident" id="3147277">Addr</span><span class="op" id="3147281">:</span>&nbsp;<span class="ident" id="3147283">raddr</span><span class="op" id="3147288">,</span>&nbsp;<span class="ident" id="3147290">Err</span><span class="op" id="3147293">:</span>&nbsp;<span class="ident" id="3147295">err</span><span class="op" id="3147298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147304">return</span>&nbsp;<span class="ident" id="3147311">newUnixConn</span><span class="op" id="3147322">(</span><span class="ident" id="3147323">fd</span><span class="op" id="3147325">)</span><span class="op" id="3147326">,</span>&nbsp;<span class="ident" id="3147328">nil</span><br>
<span class="lineno"></span><span class="op" id="3147332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3147335">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3147401">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3147470">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3147489">type</span>&nbsp;<span class="ident" id="3147494">UnixListener</span>&nbsp;<span class="keyword" id="3147507">struct</span>&nbsp;<span class="op" id="3147514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147517">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3147522">*</span><span class="ident" id="3147523">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147530">path</span>&nbsp;<span class="builtintype" id="3147535">string</span><br>
<span class="lineno"></span><span class="op" id="3147542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3147545">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3147615">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3147682">func</span>&nbsp;<span class="ident" id="3147687">ListenUnix</span><span class="op" id="3147697">(</span><span class="ident" id="3147698">net</span>&nbsp;<span class="builtintype" id="3147702">string</span><span class="op" id="3147708">,</span>&nbsp;<span class="ident" id="3147710">laddr</span>&nbsp;<span class="op" id="3147716">*</span><span class="ident" id="3147717">UnixAddr</span><span class="op" id="3147725">)</span>&nbsp;<span class="op" id="3147727">(</span><span class="op" id="3147728">*</span><span class="ident" id="3147729">UnixListener</span><span class="op" id="3147741">,</span>&nbsp;<span class="builtintype" id="3147743">error</span><span class="op" id="3147748">)</span>&nbsp;<span class="op" id="3147750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147753">switch</span>&nbsp;<span class="ident" id="3147760">net</span>&nbsp;<span class="op" id="3147764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147767">case</span>&nbsp;<span class="string" id="3147772">&#34;unix&#34;</span><span class="op" id="3147778">,</span>&nbsp;<span class="string" id="3147780">&#34;unixpacket&#34;</span><span class="op" id="3147792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147795">default</span><span class="op" id="3147802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147806">return</span>&nbsp;<span class="ident" id="3147813">nil</span><span class="op" id="3147816">,</span>&nbsp;<span class="op" id="3147818">&amp;</span><span class="ident" id="3147819">OpError</span><span class="op" id="3147826">{</span><span class="ident" id="3147827">Op</span><span class="op" id="3147829">:</span>&nbsp;<span class="string" id="3147831">&#34;listen&#34;</span><span class="op" id="3147839">,</span>&nbsp;<span class="ident" id="3147841">Net</span><span class="op" id="3147844">:</span>&nbsp;<span class="ident" id="3147846">net</span><span class="op" id="3147849">,</span>&nbsp;<span class="ident" id="3147851">Addr</span><span class="op" id="3147855">:</span>&nbsp;<span class="ident" id="3147857">laddr</span><span class="op" id="3147862">,</span>&nbsp;<span class="ident" id="3147864">Err</span><span class="op" id="3147867">:</span>&nbsp;<span class="ident" id="3147869">UnknownNetworkError</span><span class="op" id="3147888">(</span><span class="ident" id="3147889">net</span><span class="op" id="3147892">)</span><span class="op" id="3147893">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147899">if</span>&nbsp;<span class="ident" id="3147902">laddr</span>&nbsp;<span class="op" id="3147908">==</span>&nbsp;<span class="ident" id="3147911">nil</span>&nbsp;<span class="op" id="3147915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147919">return</span>&nbsp;<span class="ident" id="3147926">nil</span><span class="op" id="3147929">,</span>&nbsp;<span class="op" id="3147931">&amp;</span><span class="ident" id="3147932">OpError</span><span class="op" id="3147939">{</span><span class="ident" id="3147940">Op</span><span class="op" id="3147942">:</span>&nbsp;<span class="string" id="3147944">&#34;listen&#34;</span><span class="op" id="3147952">,</span>&nbsp;<span class="ident" id="3147954">Net</span><span class="op" id="3147957">:</span>&nbsp;<span class="ident" id="3147959">net</span><span class="op" id="3147962">,</span>&nbsp;<span class="ident" id="3147964">Addr</span><span class="op" id="3147968">:</span>&nbsp;<span class="ident" id="3147970">nil</span><span class="op" id="3147973">,</span>&nbsp;<span class="ident" id="3147975">Err</span><span class="op" id="3147978">:</span>&nbsp;<span class="ident" id="3147980">errMissingAddress</span><span class="op" id="3147997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148003">fd</span><span class="op" id="3148005">,</span>&nbsp;<span class="ident" id="3148007">err</span>&nbsp;<span class="op" id="3148011">:=</span>&nbsp;<span class="ident" id="3148014">unixSocket</span><span class="op" id="3148024">(</span><span class="ident" id="3148025">net</span><span class="op" id="3148028">,</span>&nbsp;<span class="ident" id="3148030">laddr</span><span class="op" id="3148035">,</span>&nbsp;<span class="ident" id="3148037">nil</span><span class="op" id="3148040">,</span>&nbsp;<span class="string" id="3148042">&#34;listen&#34;</span><span class="op" id="3148050">,</span>&nbsp;<span class="ident" id="3148052">noDeadline</span><span class="op" id="3148062">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148065">if</span>&nbsp;<span class="ident" id="3148068">err</span>&nbsp;<span class="op" id="3148072">!=</span>&nbsp;<span class="ident" id="3148075">nil</span>&nbsp;<span class="op" id="3148079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148083">return</span>&nbsp;<span class="ident" id="3148090">nil</span><span class="op" id="3148093">,</span>&nbsp;<span class="op" id="3148095">&amp;</span><span class="ident" id="3148096">OpError</span><span class="op" id="3148103">{</span><span class="ident" id="3148104">Op</span><span class="op" id="3148106">:</span>&nbsp;<span class="string" id="3148108">&#34;listen&#34;</span><span class="op" id="3148116">,</span>&nbsp;<span class="ident" id="3148118">Net</span><span class="op" id="3148121">:</span>&nbsp;<span class="ident" id="3148123">net</span><span class="op" id="3148126">,</span>&nbsp;<span class="ident" id="3148128">Addr</span><span class="op" id="3148132">:</span>&nbsp;<span class="ident" id="3148134">laddr</span><span class="op" id="3148139">,</span>&nbsp;<span class="ident" id="3148141">Err</span><span class="op" id="3148144">:</span>&nbsp;<span class="ident" id="3148146">err</span><span class="op" id="3148149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148155">return</span>&nbsp;<span class="op" id="3148162">&amp;</span><span class="ident" id="3148163">UnixListener</span><span class="op" id="3148175">{</span><span class="ident" id="3148176">fd</span><span class="op" id="3148178">,</span>&nbsp;<span class="ident" id="3148180">fd</span><span class="op" id="3148182">.</span><span class="ident" id="3148183">laddr</span><span class="op" id="3148188">.</span><span class="ident" id="3148189">String</span><span class="op" id="3148195">(</span><span class="op" id="3148196">)</span><span class="op" id="3148197">}</span><span class="op" id="3148198">,</span>&nbsp;<span class="ident" id="3148200">nil</span><br>
<span class="lineno"></span><span class="op" id="3148204">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3148207">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3148272">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3148287">func</span>&nbsp;<span class="op" id="3148292">(</span><span class="ident" id="3148293">l</span>&nbsp;<span class="op" id="3148295">*</span><span class="ident" id="3148296">UnixListener</span><span class="op" id="3148308">)</span>&nbsp;<span class="ident" id="3148310">AcceptUnix</span><span class="op" id="3148320">(</span><span class="op" id="3148321">)</span>&nbsp;<span class="op" id="3148323">(</span><span class="op" id="3148324">*</span><span class="ident" id="3148325">UnixConn</span><span class="op" id="3148333">,</span>&nbsp;<span class="builtintype" id="3148335">error</span><span class="op" id="3148340">)</span>&nbsp;<span class="op" id="3148342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148345">if</span>&nbsp;<span class="ident" id="3148348">l</span>&nbsp;<span class="op" id="3148350">==</span>&nbsp;<span class="ident" id="3148353">nil</span>&nbsp;<span class="op" id="3148357">||</span>&nbsp;<span class="ident" id="3148360">l</span><span class="op" id="3148361">.</span><span class="ident" id="3148362">fd</span>&nbsp;<span class="op" id="3148365">==</span>&nbsp;<span class="ident" id="3148368">nil</span>&nbsp;<span class="op" id="3148372">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148376">return</span>&nbsp;<span class="ident" id="3148383">nil</span><span class="op" id="3148386">,</span>&nbsp;<span class="ident" id="3148388">syscall</span><span class="op" id="3148395">.</span><span class="ident" id="3148396">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148407">fd</span><span class="op" id="3148409">,</span>&nbsp;<span class="ident" id="3148411">err</span>&nbsp;<span class="op" id="3148415">:=</span>&nbsp;<span class="ident" id="3148418">l</span><span class="op" id="3148419">.</span><span class="ident" id="3148420">fd</span><span class="op" id="3148422">.</span><span class="ident" id="3148423">accept</span><span class="op" id="3148429">(</span><span class="op" id="3148430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148433">if</span>&nbsp;<span class="ident" id="3148436">err</span>&nbsp;<span class="op" id="3148440">!=</span>&nbsp;<span class="ident" id="3148443">nil</span>&nbsp;<span class="op" id="3148447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148451">return</span>&nbsp;<span class="ident" id="3148458">nil</span><span class="op" id="3148461">,</span>&nbsp;<span class="ident" id="3148463">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148471">c</span>&nbsp;<span class="op" id="3148473">:=</span>&nbsp;<span class="ident" id="3148476">newUnixConn</span><span class="op" id="3148487">(</span><span class="ident" id="3148488">fd</span><span class="op" id="3148490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148493">return</span>&nbsp;<span class="ident" id="3148500">c</span><span class="op" id="3148501">,</span>&nbsp;<span class="ident" id="3148503">nil</span><br>
<span class="lineno"></span><span class="op" id="3148507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3148510">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3148579">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3148634">func</span>&nbsp;<span class="op" id="3148639">(</span><span class="ident" id="3148640">l</span>&nbsp;<span class="op" id="3148642">*</span><span class="ident" id="3148643">UnixListener</span><span class="op" id="3148655">)</span>&nbsp;<span class="ident" id="3148657">Accept</span><span class="op" id="3148663">(</span><span class="op" id="3148664">)</span>&nbsp;<span class="op" id="3148666">(</span><span class="ident" id="3148667">c</span>&nbsp;<span class="ident" id="3148669">Conn</span><span class="op" id="3148673">,</span>&nbsp;<span class="ident" id="3148675">err</span>&nbsp;<span class="builtintype" id="3148679">error</span><span class="op" id="3148684">)</span>&nbsp;<span class="op" id="3148686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148689">c1</span><span class="op" id="3148691">,</span>&nbsp;<span class="ident" id="3148693">err</span>&nbsp;<span class="op" id="3148697">:=</span>&nbsp;<span class="ident" id="3148700">l</span><span class="op" id="3148701">.</span><span class="ident" id="3148702">AcceptUnix</span><span class="op" id="3148712">(</span><span class="op" id="3148713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148716">if</span>&nbsp;<span class="ident" id="3148719">err</span>&nbsp;<span class="op" id="3148723">!=</span>&nbsp;<span class="ident" id="3148726">nil</span>&nbsp;<span class="op" id="3148730">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148734">return</span>&nbsp;<span class="ident" id="3148741">nil</span><span class="op" id="3148744">,</span>&nbsp;<span class="ident" id="3148746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148754">return</span>&nbsp;<span class="ident" id="3148761">c1</span><span class="op" id="3148763">,</span>&nbsp;<span class="ident" id="3148765">nil</span><br>
<span class="lineno"></span><span class="op" id="3148769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3148772">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3148836">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3148867">func</span>&nbsp;<span class="op" id="3148872">(</span><span class="ident" id="3148873">l</span>&nbsp;<span class="op" id="3148875">*</span><span class="ident" id="3148876">UnixListener</span><span class="op" id="3148888">)</span>&nbsp;<span class="ident" id="3148890">Close</span><span class="op" id="3148895">(</span><span class="op" id="3148896">)</span>&nbsp;<span class="builtintype" id="3148898">error</span>&nbsp;<span class="op" id="3148904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148907">if</span>&nbsp;<span class="ident" id="3148910">l</span>&nbsp;<span class="op" id="3148912">==</span>&nbsp;<span class="ident" id="3148915">nil</span>&nbsp;<span class="op" id="3148919">||</span>&nbsp;<span class="ident" id="3148922">l</span><span class="op" id="3148923">.</span><span class="ident" id="3148924">fd</span>&nbsp;<span class="op" id="3148927">==</span>&nbsp;<span class="ident" id="3148930">nil</span>&nbsp;<span class="op" id="3148934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148938">return</span>&nbsp;<span class="ident" id="3148945">syscall</span><span class="op" id="3148952">.</span><span class="ident" id="3148953">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148965">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149007">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149048">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149086">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149129">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149174">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149217">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149259">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149307">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149353">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149387">if</span>&nbsp;<span class="ident" id="3149390">l</span><span class="op" id="3149391">.</span><span class="ident" id="3149392">path</span><span class="op" id="3149396">[</span><span class="num" id="3149397">0</span><span class="op" id="3149398">]</span>&nbsp;<span class="op" id="3149400">!=</span>&nbsp;<span class="string" id="3149403">&#39;@&#39;</span>&nbsp;<span class="op" id="3149407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149411">syscall</span><span class="op" id="3149418">.</span><span class="ident" id="3149419">Unlink</span><span class="op" id="3149425">(</span><span class="ident" id="3149426">l</span><span class="op" id="3149427">.</span><span class="ident" id="3149428">path</span><span class="op" id="3149432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149435">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149438">return</span>&nbsp;<span class="ident" id="3149445">l</span><span class="op" id="3149446">.</span><span class="ident" id="3149447">fd</span><span class="op" id="3149449">.</span><span class="ident" id="3149450">Close</span><span class="op" id="3149455">(</span><span class="op" id="3149456">)</span><br>
<span class="lineno"></span><span class="op" id="3149458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3149461">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3149509">func</span>&nbsp;<span class="op" id="3149514">(</span><span class="ident" id="3149515">l</span>&nbsp;<span class="op" id="3149517">*</span><span class="ident" id="3149518">UnixListener</span><span class="op" id="3149530">)</span>&nbsp;<span class="ident" id="3149532">Addr</span><span class="op" id="3149536">(</span><span class="op" id="3149537">)</span>&nbsp;<span class="ident" id="3149539">Addr</span>&nbsp;<span class="op" id="3149544">{</span>&nbsp;<span class="keyword" id="3149546">return</span>&nbsp;<span class="ident" id="3149553">l</span><span class="op" id="3149554">.</span><span class="ident" id="3149555">fd</span><span class="op" id="3149557">.</span><span class="ident" id="3149558">laddr</span>&nbsp;<span class="op" id="3149564">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3149567">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3149630">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3149674">func</span>&nbsp;<span class="op" id="3149679">(</span><span class="ident" id="3149680">l</span>&nbsp;<span class="op" id="3149682">*</span><span class="ident" id="3149683">UnixListener</span><span class="op" id="3149695">)</span>&nbsp;<span class="ident" id="3149697">SetDeadline</span><span class="op" id="3149708">(</span><span class="ident" id="3149709">t</span>&nbsp;<span class="ident" id="3149711">time</span><span class="op" id="3149715">.</span><span class="ident" id="3149716">Time</span><span class="op" id="3149720">)</span>&nbsp;<span class="op" id="3149722">(</span><span class="ident" id="3149723">err</span>&nbsp;<span class="builtintype" id="3149727">error</span><span class="op" id="3149732">)</span>&nbsp;<span class="op" id="3149734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149737">if</span>&nbsp;<span class="ident" id="3149740">l</span>&nbsp;<span class="op" id="3149742">==</span>&nbsp;<span class="ident" id="3149745">nil</span>&nbsp;<span class="op" id="3149749">||</span>&nbsp;<span class="ident" id="3149752">l</span><span class="op" id="3149753">.</span><span class="ident" id="3149754">fd</span>&nbsp;<span class="op" id="3149757">==</span>&nbsp;<span class="ident" id="3149760">nil</span>&nbsp;<span class="op" id="3149764">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149768">return</span>&nbsp;<span class="ident" id="3149775">syscall</span><span class="op" id="3149782">.</span><span class="ident" id="3149783">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149794">return</span>&nbsp;<span class="ident" id="3149801">l</span><span class="op" id="3149802">.</span><span class="ident" id="3149803">fd</span><span class="op" id="3149805">.</span><span class="ident" id="3149806">setDeadline</span><span class="op" id="3149817">(</span><span class="ident" id="3149818">t</span><span class="op" id="3149819">)</span><br>
<span class="lineno"></span><span class="op" id="3149821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3149824">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3149890">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3149960">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3150025">//</span><br>
<span class="lineno"></span><span class="comment" id="3150028">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3150092">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3150158">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3150222">func</span>&nbsp;<span class="op" id="3150227">(</span><span class="ident" id="3150228">l</span>&nbsp;<span class="op" id="3150230">*</span><span class="ident" id="3150231">UnixListener</span><span class="op" id="3150243">)</span>&nbsp;<span class="ident" id="3150245">File</span><span class="op" id="3150249">(</span><span class="op" id="3150250">)</span>&nbsp;<span class="op" id="3150252">(</span><span class="ident" id="3150253">f</span>&nbsp;<span class="op" id="3150255">*</span><span class="ident" id="3150256">os</span><span class="op" id="3150258">.</span><span class="ident" id="3150259">File</span><span class="op" id="3150263">,</span>&nbsp;<span class="ident" id="3150265">err</span>&nbsp;<span class="builtintype" id="3150269">error</span><span class="op" id="3150274">)</span>&nbsp;<span class="op" id="3150276">{</span>&nbsp;<span class="keyword" id="3150278">return</span>&nbsp;<span class="ident" id="3150285">l</span><span class="op" id="3150286">.</span><span class="ident" id="3150287">fd</span><span class="op" id="3150289">.</span><span class="ident" id="3150290">dup</span><span class="op" id="3150293">(</span><span class="op" id="3150294">)</span>&nbsp;<span class="op" id="3150296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3150299">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3150370">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3150438">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3150508">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3150567">func</span>&nbsp;<span class="ident" id="3150572">ListenUnixgram</span><span class="op" id="3150586">(</span><span class="ident" id="3150587">net</span>&nbsp;<span class="builtintype" id="3150591">string</span><span class="op" id="3150597">,</span>&nbsp;<span class="ident" id="3150599">laddr</span>&nbsp;<span class="op" id="3150605">*</span><span class="ident" id="3150606">UnixAddr</span><span class="op" id="3150614">)</span>&nbsp;<span class="op" id="3150616">(</span><span class="op" id="3150617">*</span><span class="ident" id="3150618">UnixConn</span><span class="op" id="3150626">,</span>&nbsp;<span class="builtintype" id="3150628">error</span><span class="op" id="3150633">)</span>&nbsp;<span class="op" id="3150635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150638">switch</span>&nbsp;<span class="ident" id="3150645">net</span>&nbsp;<span class="op" id="3150649">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150652">case</span>&nbsp;<span class="string" id="3150657">&#34;unixgram&#34;</span><span class="op" id="3150667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150670">default</span><span class="op" id="3150677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150681">return</span>&nbsp;<span class="ident" id="3150688">nil</span><span class="op" id="3150691">,</span>&nbsp;<span class="op" id="3150693">&amp;</span><span class="ident" id="3150694">OpError</span><span class="op" id="3150701">{</span><span class="ident" id="3150702">Op</span><span class="op" id="3150704">:</span>&nbsp;<span class="string" id="3150706">&#34;listen&#34;</span><span class="op" id="3150714">,</span>&nbsp;<span class="ident" id="3150716">Net</span><span class="op" id="3150719">:</span>&nbsp;<span class="ident" id="3150721">net</span><span class="op" id="3150724">,</span>&nbsp;<span class="ident" id="3150726">Addr</span><span class="op" id="3150730">:</span>&nbsp;<span class="ident" id="3150732">laddr</span><span class="op" id="3150737">,</span>&nbsp;<span class="ident" id="3150739">Err</span><span class="op" id="3150742">:</span>&nbsp;<span class="ident" id="3150744">UnknownNetworkError</span><span class="op" id="3150763">(</span><span class="ident" id="3150764">net</span><span class="op" id="3150767">)</span><span class="op" id="3150768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150774">if</span>&nbsp;<span class="ident" id="3150777">laddr</span>&nbsp;<span class="op" id="3150783">==</span>&nbsp;<span class="ident" id="3150786">nil</span>&nbsp;<span class="op" id="3150790">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150794">return</span>&nbsp;<span class="ident" id="3150801">nil</span><span class="op" id="3150804">,</span>&nbsp;<span class="op" id="3150806">&amp;</span><span class="ident" id="3150807">OpError</span><span class="op" id="3150814">{</span><span class="ident" id="3150815">Op</span><span class="op" id="3150817">:</span>&nbsp;<span class="string" id="3150819">&#34;listen&#34;</span><span class="op" id="3150827">,</span>&nbsp;<span class="ident" id="3150829">Net</span><span class="op" id="3150832">:</span>&nbsp;<span class="ident" id="3150834">net</span><span class="op" id="3150837">,</span>&nbsp;<span class="ident" id="3150839">Addr</span><span class="op" id="3150843">:</span>&nbsp;<span class="ident" id="3150845">nil</span><span class="op" id="3150848">,</span>&nbsp;<span class="ident" id="3150850">Err</span><span class="op" id="3150853">:</span>&nbsp;<span class="ident" id="3150855">errMissingAddress</span><span class="op" id="3150872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150878">fd</span><span class="op" id="3150880">,</span>&nbsp;<span class="ident" id="3150882">err</span>&nbsp;<span class="op" id="3150886">:=</span>&nbsp;<span class="ident" id="3150889">unixSocket</span><span class="op" id="3150899">(</span><span class="ident" id="3150900">net</span><span class="op" id="3150903">,</span>&nbsp;<span class="ident" id="3150905">laddr</span><span class="op" id="3150910">,</span>&nbsp;<span class="ident" id="3150912">nil</span><span class="op" id="3150915">,</span>&nbsp;<span class="string" id="3150917">&#34;listen&#34;</span><span class="op" id="3150925">,</span>&nbsp;<span class="ident" id="3150927">noDeadline</span><span class="op" id="3150937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150940">if</span>&nbsp;<span class="ident" id="3150943">err</span>&nbsp;<span class="op" id="3150947">!=</span>&nbsp;<span class="ident" id="3150950">nil</span>&nbsp;<span class="op" id="3150954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150958">return</span>&nbsp;<span class="ident" id="3150965">nil</span><span class="op" id="3150968">,</span>&nbsp;<span class="op" id="3150970">&amp;</span><span class="ident" id="3150971">OpError</span><span class="op" id="3150978">{</span><span class="ident" id="3150979">Op</span><span class="op" id="3150981">:</span>&nbsp;<span class="string" id="3150983">&#34;listen&#34;</span><span class="op" id="3150991">,</span>&nbsp;<span class="ident" id="3150993">Net</span><span class="op" id="3150996">:</span>&nbsp;<span class="ident" id="3150998">net</span><span class="op" id="3151001">,</span>&nbsp;<span class="ident" id="3151003">Addr</span><span class="op" id="3151007">:</span>&nbsp;<span class="ident" id="3151009">laddr</span><span class="op" id="3151014">,</span>&nbsp;<span class="ident" id="3151016">Err</span><span class="op" id="3151019">:</span>&nbsp;<span class="ident" id="3151021">err</span><span class="op" id="3151024">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151030">return</span>&nbsp;<span class="ident" id="3151037">newUnixConn</span><span class="op" id="3151048">(</span><span class="ident" id="3151049">fd</span><span class="op" id="3151051">)</span><span class="op" id="3151052">,</span>&nbsp;<span class="ident" id="3151054">nil</span><br>
<span class="lineno"></span><span class="op" id="3151058">}</span>
</div>
</body>
</html>
