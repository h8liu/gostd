<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html" class="current">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4413417">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4413472">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4413526">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4413577">package</span>&nbsp;<span class="ident" id="4413585">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4413593">import</span>&nbsp;<span class="op" id="4413600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4413603">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4413620">&#34;errors&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4413629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4413632">//&nbsp;AEAD&nbsp;is&nbsp;a&nbsp;cipher&nbsp;mode&nbsp;providing&nbsp;authenticated&nbsp;encryption&nbsp;with&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4413708">//&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4413717">type</span>&nbsp;<span class="ident" id="4413722">AEAD</span>&nbsp;<span class="keyword" id="4413727">interface</span>&nbsp;<span class="op" id="4413737">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4413740">//&nbsp;NonceSize&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;nonce&nbsp;that&nbsp;must&nbsp;be&nbsp;passed&nbsp;to&nbsp;Seal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4413812">//&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4413826">NonceSize</span><span class="op" id="4413835">(</span><span class="op" id="4413836">)</span>&nbsp;<span class="builtintype" id="4413838">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4413844">//&nbsp;Overhead&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;difference&nbsp;between&nbsp;the&nbsp;lengths&nbsp;of&nbsp;a</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4413913">//&nbsp;plaintext&nbsp;and&nbsp;ciphertext.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4413943">Overhead</span><span class="op" id="4413951">(</span><span class="op" id="4413952">)</span>&nbsp;<span class="builtintype" id="4413954">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4413960">//&nbsp;Seal&nbsp;encrypts&nbsp;and&nbsp;authenticates&nbsp;plaintext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414025">//&nbsp;additional&nbsp;data&nbsp;and&nbsp;appends&nbsp;the&nbsp;result&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414098">//&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()&nbsp;bytes&nbsp;long&nbsp;and&nbsp;unique&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414169">//&nbsp;time,&nbsp;for&nbsp;a&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414196">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414200">//&nbsp;The&nbsp;plaintext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4414259">Seal</span><span class="op" id="4414263">(</span><span class="ident" id="4414264">dst</span><span class="op" id="4414267">,</span>&nbsp;<span class="ident" id="4414269">nonce</span><span class="op" id="4414274">,</span>&nbsp;<span class="ident" id="4414276">plaintext</span><span class="op" id="4414285">,</span>&nbsp;<span class="ident" id="4414287">data</span>&nbsp;<span class="op" id="4414292">[</span><span class="op" id="4414293">]</span><span class="builtintype" id="4414294">byte</span><span class="op" id="4414298">)</span>&nbsp;<span class="op" id="4414300">[</span><span class="op" id="4414301">]</span><span class="builtintype" id="4414302">byte</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414309">//&nbsp;Open&nbsp;decrypts&nbsp;and&nbsp;authenticates&nbsp;ciphertext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414375">//&nbsp;additional&nbsp;data&nbsp;and,&nbsp;if&nbsp;successful,&nbsp;appends&nbsp;the&nbsp;resulting&nbsp;plaintext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414447">//&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414518">//&nbsp;bytes&nbsp;long&nbsp;and&nbsp;both&nbsp;it&nbsp;and&nbsp;the&nbsp;additional&nbsp;data&nbsp;must&nbsp;match&nbsp;the</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414584">//&nbsp;value&nbsp;passed&nbsp;to&nbsp;Seal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414610">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414614">//&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4414674">Open</span><span class="op" id="4414678">(</span><span class="ident" id="4414679">dst</span><span class="op" id="4414682">,</span>&nbsp;<span class="ident" id="4414684">nonce</span><span class="op" id="4414689">,</span>&nbsp;<span class="ident" id="4414691">ciphertext</span><span class="op" id="4414701">,</span>&nbsp;<span class="ident" id="4414703">data</span>&nbsp;<span class="op" id="4414708">[</span><span class="op" id="4414709">]</span><span class="builtintype" id="4414710">byte</span><span class="op" id="4414714">)</span>&nbsp;<span class="op" id="4414716">(</span><span class="op" id="4414717">[</span><span class="op" id="4414718">]</span><span class="builtintype" id="4414719">byte</span><span class="op" id="4414723">,</span>&nbsp;<span class="builtintype" id="4414725">error</span><span class="op" id="4414730">)</span><br>
<span class="lineno"></span><span class="op" id="4414732">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4414735">//&nbsp;gcmFieldElement&nbsp;represents&nbsp;a&nbsp;value&nbsp;in&nbsp;GF(2¹²⁸).&nbsp;In&nbsp;order&nbsp;to&nbsp;reflect&nbsp;the&nbsp;GCM</span><br>
<span class="lineno"></span><span class="comment" id="4414818">//&nbsp;standard&nbsp;and&nbsp;make&nbsp;getUint64&nbsp;suitable&nbsp;for&nbsp;marshaling&nbsp;these&nbsp;values,&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4414896">//&nbsp;are&nbsp;stored&nbsp;backwards.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="4414934">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁰&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno">45</span><span class="comment" id="4414995">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶³&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="4415056">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶⁴&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="4415121">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x¹²⁷&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4415185">type</span>&nbsp;<span class="ident" id="4415190">gcmFieldElement</span>&nbsp;<span class="keyword" id="4415206">struct</span>&nbsp;<span class="op" id="4415213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415216">low</span><span class="op" id="4415219">,</span>&nbsp;<span class="ident" id="4415221">high</span>&nbsp;<span class="builtintype" id="4415226">uint64</span><br>
<span class="lineno">50</span><span class="op" id="4415233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415236">//&nbsp;gcm&nbsp;represents&nbsp;a&nbsp;Galois&nbsp;Counter&nbsp;Mode&nbsp;with&nbsp;a&nbsp;specific&nbsp;key.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4415301">//&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4415396">type</span>&nbsp;<span class="ident" id="4415401">gcm</span>&nbsp;<span class="keyword" id="4415405">struct</span>&nbsp;<span class="op" id="4415412">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415415">cipher</span>&nbsp;<span class="ident" id="4415422"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415429">//&nbsp;productTable&nbsp;contains&nbsp;the&nbsp;first&nbsp;sixteen&nbsp;powers&nbsp;of&nbsp;the&nbsp;key,&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415495">//&nbsp;However,&nbsp;they&nbsp;are&nbsp;in&nbsp;bit&nbsp;reversed&nbsp;order.&nbsp;See&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415552">productTable</span>&nbsp;<span class="op" id="4415565">[</span><span class="num" id="4415566">16</span><span class="op" id="4415568">]</span><span class="ident" id="4415569"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><br>
<span class="lineno"></span><span class="op" id="4415585">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="4415588">//&nbsp;NewGCM&nbsp;returns&nbsp;the&nbsp;given&nbsp;128-bit,&nbsp;block&nbsp;cipher&nbsp;wrapped&nbsp;in&nbsp;Galois&nbsp;Counter&nbsp;Mode.</span><br>
<span class="lineno"></span><span class="keyword" id="4415670">func</span>&nbsp;<span class="ident" id="4415675">NewGCM</span><span class="op" id="4415681">(</span><span class="ident" id="4415682">cipher</span>&nbsp;<span class="ident" id="4415689"><a href="/gostd/crypto/cipher/cipher.go.html#4410698">Block</a></span><span class="op" id="4415694">)</span>&nbsp;<span class="op" id="4415696">(</span><span class="ident" id="4415697"><a href="/gostd/crypto/cipher/gcm.go.html#4413722">AEAD</a></span><span class="op" id="4415701">,</span>&nbsp;<span class="builtintype" id="4415703">error</span><span class="op" id="4415708">)</span>&nbsp;<span class="op" id="4415710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4415713">if</span>&nbsp;<span class="ident" id="4415716"><a href="/gostd/crypto/cipher/gcm.go.html#4415682">cipher</a></span><span class="op" id="4415722">.</span><span class="ident" id="4415723"><a href="/gostd/crypto/cipher/cipher.go.html#4410764">BlockSize</a></span><span class="op" id="4415732">(</span><span class="op" id="4415733">)</span>&nbsp;<span class="op" id="4415735">!=</span>&nbsp;<span class="ident" id="4415738"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span>&nbsp;<span class="op" id="4415751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4415755">return</span>&nbsp;<span class="builtintype" id="4415762">nil</span><span class="op" id="4415765">,</span>&nbsp;<span class="ident" id="4415767"><a href="/gostd/crypto/cipher/gcm.go.html#4413620">errors</a></span><span class="op" id="4415773">.</span><span class="ident" id="4415774"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4415777">(</span><span class="string" id="4415778">&#34;cipher:&nbsp;NewGCM&nbsp;requires&nbsp;128-bit&nbsp;block&nbsp;cipher&#34;</span><span class="op" id="4415824">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4415827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4415831">var</span>&nbsp;<span class="ident" id="4415835">key</span>&nbsp;<span class="op" id="4415839">[</span><span class="ident" id="4415840"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4415852">]</span><span class="builtintype" id="4415853">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415859"><a href="/gostd/crypto/cipher/gcm.go.html#4415682">cipher</a></span><span class="op" id="4415865">.</span><span class="ident" id="4415866"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4415873">(</span><span class="ident" id="4415874"><a href="/gostd/crypto/cipher/gcm.go.html#4415835">key</a></span><span class="op" id="4415877">[</span><span class="op" id="4415878">:</span><span class="op" id="4415879">]</span><span class="op" id="4415880">,</span>&nbsp;<span class="ident" id="4415882"><a href="/gostd/crypto/cipher/gcm.go.html#4415835">key</a></span><span class="op" id="4415885">[</span><span class="op" id="4415886">:</span><span class="op" id="4415887">]</span><span class="op" id="4415888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415892">g</span>&nbsp;<span class="op" id="4415894">:=</span>&nbsp;<span class="op" id="4415897">&amp;</span><span class="ident" id="4415898"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4415901">{</span><span class="ident" id="4415902"><a href="/gostd/crypto/cipher/gcm.go.html#4415415">cipher</a></span><span class="op" id="4415908">:</span>&nbsp;<span class="ident" id="4415910"><a href="/gostd/crypto/cipher/gcm.go.html#4415682">cipher</a></span><span class="op" id="4415916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415920">//&nbsp;We&nbsp;precompute&nbsp;16&nbsp;multiples&nbsp;of&nbsp;|key|.&nbsp;However,&nbsp;when&nbsp;we&nbsp;do&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415989">//&nbsp;into&nbsp;this&nbsp;table&nbsp;we&#39;ll&nbsp;be&nbsp;using&nbsp;bits&nbsp;from&nbsp;a&nbsp;field&nbsp;element&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4416054">//&nbsp;therefore&nbsp;the&nbsp;bits&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order.&nbsp;So&nbsp;normally&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4416123">//&nbsp;would&nbsp;expect,&nbsp;say,&nbsp;4*key&nbsp;to&nbsp;be&nbsp;in&nbsp;index&nbsp;4&nbsp;of&nbsp;the&nbsp;table&nbsp;but&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4416193">//&nbsp;this&nbsp;bit&nbsp;ordering&nbsp;it&nbsp;will&nbsp;actually&nbsp;be&nbsp;in&nbsp;index&nbsp;0010&nbsp;(base&nbsp;2)&nbsp;=&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416263">x</span>&nbsp;<span class="op" id="4416265">:=</span>&nbsp;<span class="ident" id="4416268"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4416283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416287"><a href="/gostd/crypto/cipher/gcm.go.html#4422747">getUint64</a></span><span class="op" id="4416296">(</span><span class="ident" id="4416297"><a href="/gostd/crypto/cipher/gcm.go.html#4415835">key</a></span><span class="op" id="4416300">[</span><span class="op" id="4416301">:</span><span class="num" id="4416302">8</span><span class="op" id="4416303">]</span><span class="op" id="4416304">)</span><span class="op" id="4416305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416309"><a href="/gostd/crypto/cipher/gcm.go.html#4422747">getUint64</a></span><span class="op" id="4416318">(</span><span class="ident" id="4416319"><a href="/gostd/crypto/cipher/gcm.go.html#4415835">key</a></span><span class="op" id="4416322">[</span><span class="num" id="4416323">8</span><span class="op" id="4416324">:</span><span class="op" id="4416325">]</span><span class="op" id="4416326">)</span><span class="op" id="4416327">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4416330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416333"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416334">.</span><span class="ident" id="4416335"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4416347">[</span><span class="ident" id="4416348"><a href="/gostd/crypto/cipher/gcm.go.html#4418233">reverseBits</a></span><span class="op" id="4416359">(</span><span class="num" id="4416360">1</span><span class="op" id="4416361">)</span><span class="op" id="4416362">]</span>&nbsp;<span class="op" id="4416364">=</span>&nbsp;<span class="ident" id="4416366"><a href="/gostd/crypto/cipher/gcm.go.html#4416263">x</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4416370">for</span>&nbsp;<span class="ident" id="4416374">i</span>&nbsp;<span class="op" id="4416376">:=</span>&nbsp;<span class="num" id="4416379">2</span><span class="op" id="4416380">;</span>&nbsp;<span class="ident" id="4416382"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span>&nbsp;<span class="op" id="4416384">&lt;</span>&nbsp;<span class="num" id="4416386">16</span><span class="op" id="4416388">;</span>&nbsp;<span class="ident" id="4416390"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span>&nbsp;<span class="op" id="4416392">+=</span>&nbsp;<span class="num" id="4416395">2</span>&nbsp;<span class="op" id="4416397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416401"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416402">.</span><span class="ident" id="4416403"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4416415">[</span><span class="ident" id="4416416"><a href="/gostd/crypto/cipher/gcm.go.html#4418233">reverseBits</a></span><span class="op" id="4416427">(</span><span class="ident" id="4416428"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span><span class="op" id="4416429">)</span><span class="op" id="4416430">]</span>&nbsp;<span class="op" id="4416432">=</span>&nbsp;<span class="ident" id="4416434"><a href="/gostd/crypto/cipher/gcm.go.html#4418661">gcmDouble</a></span><span class="op" id="4416443">(</span><span class="op" id="4416444">&amp;</span><span class="ident" id="4416445"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416446">.</span><span class="ident" id="4416447"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4416459">[</span><span class="ident" id="4416460"><a href="/gostd/crypto/cipher/gcm.go.html#4418233">reverseBits</a></span><span class="op" id="4416471">(</span><span class="ident" id="4416472"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span><span class="op" id="4416473">/</span><span class="num" id="4416474">2</span><span class="op" id="4416475">)</span><span class="op" id="4416476">]</span><span class="op" id="4416477">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416481"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416482">.</span><span class="ident" id="4416483"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4416495">[</span><span class="ident" id="4416496"><a href="/gostd/crypto/cipher/gcm.go.html#4418233">reverseBits</a></span><span class="op" id="4416507">(</span><span class="ident" id="4416508"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span><span class="op" id="4416509">+</span><span class="num" id="4416510">1</span><span class="op" id="4416511">)</span><span class="op" id="4416512">]</span>&nbsp;<span class="op" id="4416514">=</span>&nbsp;<span class="ident" id="4416516"><a href="/gostd/crypto/cipher/gcm.go.html#4418423">gcmAdd</a></span><span class="op" id="4416522">(</span><span class="op" id="4416523">&amp;</span><span class="ident" id="4416524"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416525">.</span><span class="ident" id="4416526"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4416538">[</span><span class="ident" id="4416539"><a href="/gostd/crypto/cipher/gcm.go.html#4418233">reverseBits</a></span><span class="op" id="4416550">(</span><span class="ident" id="4416551"><a href="/gostd/crypto/cipher/gcm.go.html#4416374">i</a></span><span class="op" id="4416552">)</span><span class="op" id="4416553">]</span><span class="op" id="4416554">,</span>&nbsp;<span class="op" id="4416556">&amp;</span><span class="ident" id="4416557"><a href="/gostd/crypto/cipher/gcm.go.html#4416263">x</a></span><span class="op" id="4416558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4416561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4416565">return</span>&nbsp;<span class="ident" id="4416572"><a href="/gostd/crypto/cipher/gcm.go.html#4415892">g</a></span><span class="op" id="4416573">,</span>&nbsp;<span class="builtintype" id="4416575">nil</span><br>
<span class="lineno"></span><span class="op" id="4416579">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4416582">const</span>&nbsp;<span class="op" id="4416588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416591">gcmBlockSize</span>&nbsp;<span class="op" id="4416604">=</span>&nbsp;<span class="num" id="4416606">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416610">gcmTagSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4416623">=</span>&nbsp;<span class="num" id="4416625">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416629">gcmNonceSize</span>&nbsp;<span class="op" id="4416642">=</span>&nbsp;<span class="num" id="4416644">12</span><br>
<span class="lineno">95</span><span class="op" id="4416647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4416650">func</span>&nbsp;<span class="op" id="4416655">(</span><span class="op" id="4416656">*</span><span class="ident" id="4416657"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4416660">)</span>&nbsp;<span class="ident" id="4416662">NonceSize</span><span class="op" id="4416671">(</span><span class="op" id="4416672">)</span>&nbsp;<span class="builtintype" id="4416674">int</span>&nbsp;<span class="op" id="4416678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4416681">return</span>&nbsp;<span class="ident" id="4416688"><a href="/gostd/crypto/cipher/gcm.go.html#4416629">gcmNonceSize</a></span><br>
<span class="lineno"></span><span class="op" id="4416701">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4416704">func</span>&nbsp;<span class="op" id="4416709">(</span><span class="op" id="4416710">*</span><span class="ident" id="4416711"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4416714">)</span>&nbsp;<span class="ident" id="4416716">Overhead</span><span class="op" id="4416724">(</span><span class="op" id="4416725">)</span>&nbsp;<span class="builtintype" id="4416727">int</span>&nbsp;<span class="op" id="4416731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4416734">return</span>&nbsp;<span class="ident" id="4416741"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><br>
<span class="lineno"></span><span class="op" id="4416752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="4416755">func</span>&nbsp;<span class="op" id="4416760">(</span><span class="ident" id="4416761">g</span>&nbsp;<span class="op" id="4416763">*</span><span class="ident" id="4416764"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4416767">)</span>&nbsp;<span class="ident" id="4416769">Seal</span><span class="op" id="4416773">(</span><span class="ident" id="4416774">dst</span><span class="op" id="4416777">,</span>&nbsp;<span class="ident" id="4416779">nonce</span><span class="op" id="4416784">,</span>&nbsp;<span class="ident" id="4416786">plaintext</span><span class="op" id="4416795">,</span>&nbsp;<span class="ident" id="4416797">data</span>&nbsp;<span class="op" id="4416802">[</span><span class="op" id="4416803">]</span><span class="builtintype" id="4416804">byte</span><span class="op" id="4416808">)</span>&nbsp;<span class="op" id="4416810">[</span><span class="op" id="4416811">]</span><span class="builtintype" id="4416812">byte</span>&nbsp;<span class="op" id="4416817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4416820">if</span>&nbsp;<span class="builtinfunc" id="4416823">len</span><span class="op" id="4416826">(</span><span class="ident" id="4416827"><a href="/gostd/crypto/cipher/gcm.go.html#4416779">nonce</a></span><span class="op" id="4416832">)</span>&nbsp;<span class="op" id="4416834">!=</span>&nbsp;<span class="ident" id="4416837"><a href="/gostd/crypto/cipher/gcm.go.html#4416629">gcmNonceSize</a></span>&nbsp;<span class="op" id="4416850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4416854">panic</span><span class="op" id="4416859">(</span><span class="string" id="4416860">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="4416905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4416908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4416912">ret</span><span class="op" id="4416915">,</span>&nbsp;<span class="ident" id="4416917">out</span>&nbsp;<span class="op" id="4416921">:=</span>&nbsp;<span class="ident" id="4416924"><a href="/gostd/crypto/cipher/gcm.go.html#4421604">sliceForAppend</a></span><span class="op" id="4416938">(</span><span class="ident" id="4416939"><a href="/gostd/crypto/cipher/gcm.go.html#4416774">dst</a></span><span class="op" id="4416942">,</span>&nbsp;<span class="builtinfunc" id="4416944">len</span><span class="op" id="4416947">(</span><span class="ident" id="4416948"><a href="/gostd/crypto/cipher/gcm.go.html#4416786">plaintext</a></span><span class="op" id="4416957">)</span><span class="op" id="4416958">+</span><span class="ident" id="4416959"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><span class="op" id="4416969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4416973">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417004">var</span>&nbsp;<span class="ident" id="4417008">counter</span><span class="op" id="4417015">,</span>&nbsp;<span class="ident" id="4417017">tagMask</span>&nbsp;<span class="op" id="4417025">[</span><span class="ident" id="4417026"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4417038">]</span><span class="builtintype" id="4417039">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4417045">copy</span><span class="op" id="4417049">(</span><span class="ident" id="4417050"><a href="/gostd/crypto/cipher/gcm.go.html#4417008">counter</a></span><span class="op" id="4417057">[</span><span class="op" id="4417058">:</span><span class="op" id="4417059">]</span><span class="op" id="4417060">,</span>&nbsp;<span class="ident" id="4417062"><a href="/gostd/crypto/cipher/gcm.go.html#4416779">nonce</a></span><span class="op" id="4417067">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417070"><a href="/gostd/crypto/cipher/gcm.go.html#4417008">counter</a></span><span class="op" id="4417077">[</span><span class="ident" id="4417078"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4417090">-</span><span class="num" id="4417091">1</span><span class="op" id="4417092">]</span>&nbsp;<span class="op" id="4417094">=</span>&nbsp;<span class="num" id="4417096">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417100"><a href="/gostd/crypto/cipher/gcm.go.html#4416761">g</a></span><span class="op" id="4417101">.</span><span class="ident" id="4417102"><a href="/gostd/crypto/cipher/gcm.go.html#4415415">cipher</a></span><span class="op" id="4417108">.</span><span class="ident" id="4417109"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4417116">(</span><span class="ident" id="4417117"><a href="/gostd/crypto/cipher/gcm.go.html#4417017">tagMask</a></span><span class="op" id="4417124">[</span><span class="op" id="4417125">:</span><span class="op" id="4417126">]</span><span class="op" id="4417127">,</span>&nbsp;<span class="ident" id="4417129"><a href="/gostd/crypto/cipher/gcm.go.html#4417008">counter</a></span><span class="op" id="4417136">[</span><span class="op" id="4417137">:</span><span class="op" id="4417138">]</span><span class="op" id="4417139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417142"><a href="/gostd/crypto/cipher/gcm.go.html#4421130">gcmInc32</a></span><span class="op" id="4417150">(</span><span class="op" id="4417151">&amp;</span><span class="ident" id="4417152"><a href="/gostd/crypto/cipher/gcm.go.html#4417008">counter</a></span><span class="op" id="4417159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417163"><a href="/gostd/crypto/cipher/gcm.go.html#4416761">g</a></span><span class="op" id="4417164">.</span><span class="ident" id="4417165"><a href="/gostd/crypto/cipher/gcm.go.html#4421896">counterCrypt</a></span><span class="op" id="4417177">(</span><span class="ident" id="4417178"><a href="/gostd/crypto/cipher/gcm.go.html#4416917">out</a></span><span class="op" id="4417181">,</span>&nbsp;<span class="ident" id="4417183"><a href="/gostd/crypto/cipher/gcm.go.html#4416786">plaintext</a></span><span class="op" id="4417192">,</span>&nbsp;<span class="op" id="4417194">&amp;</span><span class="ident" id="4417195"><a href="/gostd/crypto/cipher/gcm.go.html#4417008">counter</a></span><span class="op" id="4417202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417205"><a href="/gostd/crypto/cipher/gcm.go.html#4416761">g</a></span><span class="op" id="4417206">.</span><span class="ident" id="4417207"><a href="/gostd/crypto/cipher/gcm.go.html#4422407">auth</a></span><span class="op" id="4417211">(</span><span class="ident" id="4417212"><a href="/gostd/crypto/cipher/gcm.go.html#4416917">out</a></span><span class="op" id="4417215">[</span><span class="builtinfunc" id="4417216">len</span><span class="op" id="4417219">(</span><span class="ident" id="4417220"><a href="/gostd/crypto/cipher/gcm.go.html#4416786">plaintext</a></span><span class="op" id="4417229">)</span><span class="op" id="4417230">:</span><span class="op" id="4417231">]</span><span class="op" id="4417232">,</span>&nbsp;<span class="ident" id="4417234"><a href="/gostd/crypto/cipher/gcm.go.html#4416917">out</a></span><span class="op" id="4417237">[</span><span class="op" id="4417238">:</span><span class="builtinfunc" id="4417239">len</span><span class="op" id="4417242">(</span><span class="ident" id="4417243"><a href="/gostd/crypto/cipher/gcm.go.html#4416786">plaintext</a></span><span class="op" id="4417252">)</span><span class="op" id="4417253">]</span><span class="op" id="4417254">,</span>&nbsp;<span class="ident" id="4417256"><a href="/gostd/crypto/cipher/gcm.go.html#4416797">data</a></span><span class="op" id="4417260">,</span>&nbsp;<span class="op" id="4417262">&amp;</span><span class="ident" id="4417263"><a href="/gostd/crypto/cipher/gcm.go.html#4417017">tagMask</a></span><span class="op" id="4417270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417274">return</span>&nbsp;<span class="ident" id="4417281"><a href="/gostd/crypto/cipher/gcm.go.html#4416912">ret</a></span><br>
<span class="lineno"></span><span class="op" id="4417285">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="4417288">var</span>&nbsp;<span class="ident" id="4417292">errOpen</span>&nbsp;<span class="op" id="4417300">=</span>&nbsp;<span class="ident" id="4417302"><a href="/gostd/crypto/cipher/gcm.go.html#4413620">errors</a></span><span class="op" id="4417308">.</span><span class="ident" id="4417309"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4417312">(</span><span class="string" id="4417313">&#34;cipher:&nbsp;message&nbsp;authentication&nbsp;failed&#34;</span><span class="op" id="4417352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4417355">func</span>&nbsp;<span class="op" id="4417360">(</span><span class="ident" id="4417361">g</span>&nbsp;<span class="op" id="4417363">*</span><span class="ident" id="4417364"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4417367">)</span>&nbsp;<span class="ident" id="4417369">Open</span><span class="op" id="4417373">(</span><span class="ident" id="4417374">dst</span><span class="op" id="4417377">,</span>&nbsp;<span class="ident" id="4417379">nonce</span><span class="op" id="4417384">,</span>&nbsp;<span class="ident" id="4417386">ciphertext</span><span class="op" id="4417396">,</span>&nbsp;<span class="ident" id="4417398">data</span>&nbsp;<span class="op" id="4417403">[</span><span class="op" id="4417404">]</span><span class="builtintype" id="4417405">byte</span><span class="op" id="4417409">)</span>&nbsp;<span class="op" id="4417411">(</span><span class="op" id="4417412">[</span><span class="op" id="4417413">]</span><span class="builtintype" id="4417414">byte</span><span class="op" id="4417418">,</span>&nbsp;<span class="builtintype" id="4417420">error</span><span class="op" id="4417425">)</span>&nbsp;<span class="op" id="4417427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417430">if</span>&nbsp;<span class="builtinfunc" id="4417433">len</span><span class="op" id="4417436">(</span><span class="ident" id="4417437"><a href="/gostd/crypto/cipher/gcm.go.html#4417379">nonce</a></span><span class="op" id="4417442">)</span>&nbsp;<span class="op" id="4417444">!=</span>&nbsp;<span class="ident" id="4417447"><a href="/gostd/crypto/cipher/gcm.go.html#4416629">gcmNonceSize</a></span>&nbsp;<span class="op" id="4417460">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4417464">panic</span><span class="op" id="4417469">(</span><span class="string" id="4417470">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="4417515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4417518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417522">if</span>&nbsp;<span class="builtinfunc" id="4417525">len</span><span class="op" id="4417528">(</span><span class="ident" id="4417529"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417539">)</span>&nbsp;<span class="op" id="4417541">&lt;</span>&nbsp;<span class="ident" id="4417543"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span>&nbsp;<span class="op" id="4417554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417558">return</span>&nbsp;<span class="builtintype" id="4417565">nil</span><span class="op" id="4417568">,</span>&nbsp;<span class="ident" id="4417570"><a href="/gostd/crypto/cipher/gcm.go.html#4417292">errOpen</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4417579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417582">tag</span>&nbsp;<span class="op" id="4417586">:=</span>&nbsp;<span class="ident" id="4417589"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417599">[</span><span class="builtinfunc" id="4417600">len</span><span class="op" id="4417603">(</span><span class="ident" id="4417604"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417614">)</span><span class="op" id="4417615">-</span><span class="ident" id="4417616"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><span class="op" id="4417626">:</span><span class="op" id="4417627">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417630"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span>&nbsp;<span class="op" id="4417641">=</span>&nbsp;<span class="ident" id="4417643"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417653">[</span><span class="op" id="4417654">:</span><span class="builtinfunc" id="4417655">len</span><span class="op" id="4417658">(</span><span class="ident" id="4417659"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417669">)</span><span class="op" id="4417670">-</span><span class="ident" id="4417671"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><span class="op" id="4417681">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4417685">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417716">var</span>&nbsp;<span class="ident" id="4417720">counter</span><span class="op" id="4417727">,</span>&nbsp;<span class="ident" id="4417729">tagMask</span>&nbsp;<span class="op" id="4417737">[</span><span class="ident" id="4417738"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4417750">]</span><span class="builtintype" id="4417751">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4417757">copy</span><span class="op" id="4417761">(</span><span class="ident" id="4417762"><a href="/gostd/crypto/cipher/gcm.go.html#4417720">counter</a></span><span class="op" id="4417769">[</span><span class="op" id="4417770">:</span><span class="op" id="4417771">]</span><span class="op" id="4417772">,</span>&nbsp;<span class="ident" id="4417774"><a href="/gostd/crypto/cipher/gcm.go.html#4417379">nonce</a></span><span class="op" id="4417779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417782"><a href="/gostd/crypto/cipher/gcm.go.html#4417720">counter</a></span><span class="op" id="4417789">[</span><span class="ident" id="4417790"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4417802">-</span><span class="num" id="4417803">1</span><span class="op" id="4417804">]</span>&nbsp;<span class="op" id="4417806">=</span>&nbsp;<span class="num" id="4417808">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417812"><a href="/gostd/crypto/cipher/gcm.go.html#4417361">g</a></span><span class="op" id="4417813">.</span><span class="ident" id="4417814"><a href="/gostd/crypto/cipher/gcm.go.html#4415415">cipher</a></span><span class="op" id="4417820">.</span><span class="ident" id="4417821"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4417828">(</span><span class="ident" id="4417829"><a href="/gostd/crypto/cipher/gcm.go.html#4417729">tagMask</a></span><span class="op" id="4417836">[</span><span class="op" id="4417837">:</span><span class="op" id="4417838">]</span><span class="op" id="4417839">,</span>&nbsp;<span class="ident" id="4417841"><a href="/gostd/crypto/cipher/gcm.go.html#4417720">counter</a></span><span class="op" id="4417848">[</span><span class="op" id="4417849">:</span><span class="op" id="4417850">]</span><span class="op" id="4417851">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417854"><a href="/gostd/crypto/cipher/gcm.go.html#4421130">gcmInc32</a></span><span class="op" id="4417862">(</span><span class="op" id="4417863">&amp;</span><span class="ident" id="4417864"><a href="/gostd/crypto/cipher/gcm.go.html#4417720">counter</a></span><span class="op" id="4417871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417875">var</span>&nbsp;<span class="ident" id="4417879">expectedTag</span>&nbsp;<span class="op" id="4417891">[</span><span class="ident" id="4417892"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><span class="op" id="4417902">]</span><span class="builtintype" id="4417903">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4417909"><a href="/gostd/crypto/cipher/gcm.go.html#4417361">g</a></span><span class="op" id="4417910">.</span><span class="ident" id="4417911"><a href="/gostd/crypto/cipher/gcm.go.html#4422407">auth</a></span><span class="op" id="4417915">(</span><span class="ident" id="4417916"><a href="/gostd/crypto/cipher/gcm.go.html#4417879">expectedTag</a></span><span class="op" id="4417927">[</span><span class="op" id="4417928">:</span><span class="op" id="4417929">]</span><span class="op" id="4417930">,</span>&nbsp;<span class="ident" id="4417932"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4417942">,</span>&nbsp;<span class="ident" id="4417944"><a href="/gostd/crypto/cipher/gcm.go.html#4417398">data</a></span><span class="op" id="4417948">,</span>&nbsp;<span class="op" id="4417950">&amp;</span><span class="ident" id="4417951"><a href="/gostd/crypto/cipher/gcm.go.html#4417729">tagMask</a></span><span class="op" id="4417958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4417962">if</span>&nbsp;<span class="ident" id="4417965"><a href="/gostd/crypto/cipher/gcm.go.html#4413603">subtle</a></span><span class="op" id="4417971">.</span><span class="ident" id="4417972"><a href="/gostd/crypto/subtle/constant_time.go.html#4428560">ConstantTimeCompare</a></span><span class="op" id="4417991">(</span><span class="ident" id="4417992"><a href="/gostd/crypto/cipher/gcm.go.html#4417879">expectedTag</a></span><span class="op" id="4418003">[</span><span class="op" id="4418004">:</span><span class="op" id="4418005">]</span><span class="op" id="4418006">,</span>&nbsp;<span class="ident" id="4418008"><a href="/gostd/crypto/cipher/gcm.go.html#4417582">tag</a></span><span class="op" id="4418011">)</span>&nbsp;<span class="op" id="4418013">!=</span>&nbsp;<span class="num" id="4418016">1</span>&nbsp;<span class="op" id="4418018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4418022">return</span>&nbsp;<span class="builtintype" id="4418029">nil</span><span class="op" id="4418032">,</span>&nbsp;<span class="ident" id="4418034"><a href="/gostd/crypto/cipher/gcm.go.html#4417292">errOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4418043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418047">ret</span><span class="op" id="4418050">,</span>&nbsp;<span class="ident" id="4418052">out</span>&nbsp;<span class="op" id="4418056">:=</span>&nbsp;<span class="ident" id="4418059"><a href="/gostd/crypto/cipher/gcm.go.html#4421604">sliceForAppend</a></span><span class="op" id="4418073">(</span><span class="ident" id="4418074"><a href="/gostd/crypto/cipher/gcm.go.html#4417374">dst</a></span><span class="op" id="4418077">,</span>&nbsp;<span class="builtinfunc" id="4418079">len</span><span class="op" id="4418082">(</span><span class="ident" id="4418083"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4418093">)</span><span class="op" id="4418094">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418097"><a href="/gostd/crypto/cipher/gcm.go.html#4417361">g</a></span><span class="op" id="4418098">.</span><span class="ident" id="4418099"><a href="/gostd/crypto/cipher/gcm.go.html#4421896">counterCrypt</a></span><span class="op" id="4418111">(</span><span class="ident" id="4418112"><a href="/gostd/crypto/cipher/gcm.go.html#4418052">out</a></span><span class="op" id="4418115">,</span>&nbsp;<span class="ident" id="4418117"><a href="/gostd/crypto/cipher/gcm.go.html#4417386">ciphertext</a></span><span class="op" id="4418127">,</span>&nbsp;<span class="op" id="4418129">&amp;</span><span class="ident" id="4418130"><a href="/gostd/crypto/cipher/gcm.go.html#4417720">counter</a></span><span class="op" id="4418137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4418141">return</span>&nbsp;<span class="ident" id="4418148"><a href="/gostd/crypto/cipher/gcm.go.html#4418047">ret</a></span><span class="op" id="4418151">,</span>&nbsp;<span class="builtintype" id="4418153">nil</span><br>
<span class="lineno"></span><span class="op" id="4418157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4418160">//&nbsp;reverseBits&nbsp;reverses&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;4-bit&nbsp;number&nbsp;in&nbsp;i.</span><br>
<span class="lineno"></span><span class="keyword" id="4418228">func</span>&nbsp;<span class="ident" id="4418233">reverseBits</span><span class="op" id="4418244">(</span><span class="ident" id="4418245">i</span>&nbsp;<span class="builtintype" id="4418247">int</span><span class="op" id="4418250">)</span>&nbsp;<span class="builtintype" id="4418252">int</span>&nbsp;<span class="op" id="4418256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418259"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418261">=</span>&nbsp;<span class="op" id="4418263">(</span><span class="op" id="4418264">(</span><span class="ident" id="4418265"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418267">&lt;&lt;</span>&nbsp;<span class="num" id="4418270">2</span><span class="op" id="4418271">)</span>&nbsp;<span class="op" id="4418273">&amp;</span>&nbsp;<span class="num" id="4418275">0xc</span><span class="op" id="4418278">)</span>&nbsp;<span class="op" id="4418280">|</span>&nbsp;<span class="op" id="4418282">(</span><span class="op" id="4418283">(</span><span class="ident" id="4418284"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418286">&gt;&gt;</span>&nbsp;<span class="num" id="4418289">2</span><span class="op" id="4418290">)</span>&nbsp;<span class="op" id="4418292">&amp;</span>&nbsp;<span class="num" id="4418294">0x3</span><span class="op" id="4418297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418300"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418302">=</span>&nbsp;<span class="op" id="4418304">(</span><span class="op" id="4418305">(</span><span class="ident" id="4418306"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418308">&lt;&lt;</span>&nbsp;<span class="num" id="4418311">1</span><span class="op" id="4418312">)</span>&nbsp;<span class="op" id="4418314">&amp;</span>&nbsp;<span class="num" id="4418316">0xa</span><span class="op" id="4418319">)</span>&nbsp;<span class="op" id="4418321">|</span>&nbsp;<span class="op" id="4418323">(</span><span class="op" id="4418324">(</span><span class="ident" id="4418325"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span>&nbsp;<span class="op" id="4418327">&gt;&gt;</span>&nbsp;<span class="num" id="4418330">1</span><span class="op" id="4418331">)</span>&nbsp;<span class="op" id="4418333">&amp;</span>&nbsp;<span class="num" id="4418335">0x5</span><span class="op" id="4418338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4418341">return</span>&nbsp;<span class="ident" id="4418348"><a href="/gostd/crypto/cipher/gcm.go.html#4418245">i</a></span><br>
<span class="lineno">165</span><span class="op" id="4418350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418353">//&nbsp;gcmAdd&nbsp;adds&nbsp;two&nbsp;elements&nbsp;of&nbsp;GF(2¹²⁸)&nbsp;and&nbsp;returns&nbsp;the&nbsp;sum.</span><br>
<span class="lineno"></span><span class="keyword" id="4418418">func</span>&nbsp;<span class="ident" id="4418423">gcmAdd</span><span class="op" id="4418429">(</span><span class="ident" id="4418430">x</span><span class="op" id="4418431">,</span>&nbsp;<span class="ident" id="4418433">y</span>&nbsp;<span class="op" id="4418435">*</span><span class="ident" id="4418436"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4418451">)</span>&nbsp;<span class="ident" id="4418453"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span>&nbsp;<span class="op" id="4418469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4418472">//&nbsp;Addition&nbsp;in&nbsp;a&nbsp;characteristic&nbsp;2&nbsp;field&nbsp;is&nbsp;just&nbsp;XOR.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4418526">return</span>&nbsp;<span class="ident" id="4418533"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4418548">{</span><span class="ident" id="4418549"><a href="/gostd/crypto/cipher/gcm.go.html#4418430">x</a></span><span class="op" id="4418550">.</span><span class="ident" id="4418551"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4418555">^</span>&nbsp;<span class="ident" id="4418557"><a href="/gostd/crypto/cipher/gcm.go.html#4418433">y</a></span><span class="op" id="4418558">.</span><span class="ident" id="4418559"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span><span class="op" id="4418562">,</span>&nbsp;<span class="ident" id="4418564"><a href="/gostd/crypto/cipher/gcm.go.html#4418430">x</a></span><span class="op" id="4418565">.</span><span class="ident" id="4418566"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4418571">^</span>&nbsp;<span class="ident" id="4418573"><a href="/gostd/crypto/cipher/gcm.go.html#4418433">y</a></span><span class="op" id="4418574">.</span><span class="ident" id="4418575"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span><span class="op" id="4418579">}</span><br>
<span class="lineno"></span><span class="op" id="4418581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418584">//&nbsp;gcmDouble&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;doubling&nbsp;an&nbsp;element&nbsp;of&nbsp;GF(2¹²⁸).</span><br>
<span class="lineno"></span><span class="keyword" id="4418656">func</span>&nbsp;<span class="ident" id="4418661">gcmDouble</span><span class="op" id="4418670">(</span><span class="ident" id="4418671">x</span>&nbsp;<span class="op" id="4418673">*</span><span class="ident" id="4418674"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4418689">)</span>&nbsp;<span class="op" id="4418691">(</span><span class="ident" id="4418692">double</span>&nbsp;<span class="ident" id="4418699"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4418714">)</span>&nbsp;<span class="op" id="4418716">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418719">msbSet</span>&nbsp;<span class="op" id="4418726">:=</span>&nbsp;<span class="ident" id="4418729"><a href="/gostd/crypto/cipher/gcm.go.html#4418671">x</a></span><span class="op" id="4418730">.</span><span class="ident" id="4418731"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span><span class="op" id="4418735">&amp;</span><span class="num" id="4418736">1</span>&nbsp;<span class="op" id="4418738">==</span>&nbsp;<span class="num" id="4418741">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4418745">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;bit-ordering,&nbsp;doubling&nbsp;is&nbsp;actually&nbsp;a&nbsp;right&nbsp;shift.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418814"><a href="/gostd/crypto/cipher/gcm.go.html#4418692">double</a></span><span class="op" id="4418820">.</span><span class="ident" id="4418821"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4418826">=</span>&nbsp;<span class="ident" id="4418828"><a href="/gostd/crypto/cipher/gcm.go.html#4418671">x</a></span><span class="op" id="4418829">.</span><span class="ident" id="4418830"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4418835">&gt;&gt;</span>&nbsp;<span class="num" id="4418838">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418841"><a href="/gostd/crypto/cipher/gcm.go.html#4418692">double</a></span><span class="op" id="4418847">.</span><span class="ident" id="4418848"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4418853">|=</span>&nbsp;<span class="ident" id="4418856"><a href="/gostd/crypto/cipher/gcm.go.html#4418671">x</a></span><span class="op" id="4418857">.</span><span class="ident" id="4418858"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4418862">&lt;&lt;</span>&nbsp;<span class="num" id="4418865">63</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4418869"><a href="/gostd/crypto/cipher/gcm.go.html#4418692">double</a></span><span class="op" id="4418875">.</span><span class="ident" id="4418876"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4418880">=</span>&nbsp;<span class="ident" id="4418882"><a href="/gostd/crypto/cipher/gcm.go.html#4418671">x</a></span><span class="op" id="4418883">.</span><span class="ident" id="4418884"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4418888">&gt;&gt;</span>&nbsp;<span class="num" id="4418891">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4418895">//&nbsp;If&nbsp;the&nbsp;most-significant&nbsp;bit&nbsp;was&nbsp;set&nbsp;before&nbsp;shifting&nbsp;then&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4418960">//&nbsp;conceptually,&nbsp;becomes&nbsp;a&nbsp;term&nbsp;of&nbsp;x^128.&nbsp;This&nbsp;is&nbsp;greater&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419028">//&nbsp;irreducible&nbsp;polynomial&nbsp;so&nbsp;the&nbsp;result&nbsp;has&nbsp;to&nbsp;be&nbsp;reduced.&nbsp;The</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419092">//&nbsp;irreducible&nbsp;polynomial&nbsp;is&nbsp;1+x+x^2+x^7+x^128.&nbsp;We&nbsp;can&nbsp;subtract&nbsp;that&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419165">//&nbsp;eliminate&nbsp;the&nbsp;term&nbsp;at&nbsp;x^128&nbsp;which&nbsp;also&nbsp;means&nbsp;subtracting&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419236">//&nbsp;four&nbsp;terms.&nbsp;In&nbsp;characteristic&nbsp;2&nbsp;fields,&nbsp;subtraction&nbsp;==&nbsp;addition&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419307">//&nbsp;XOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419316">if</span>&nbsp;<span class="ident" id="4419319"><a href="/gostd/crypto/cipher/gcm.go.html#4418719">msbSet</a></span>&nbsp;<span class="op" id="4419326">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419330"><a href="/gostd/crypto/cipher/gcm.go.html#4418692">double</a></span><span class="op" id="4419336">.</span><span class="ident" id="4419337"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4419341">^=</span>&nbsp;<span class="num" id="4419344">0xe100000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4419364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419368">return</span><br>
<span class="lineno"></span><span class="op" id="4419375">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="4419378">var</span>&nbsp;<span class="ident" id="4419382">gcmReductionTable</span>&nbsp;<span class="op" id="4419400">=</span>&nbsp;<span class="op" id="4419402">[</span><span class="op" id="4419403">]</span><span class="builtintype" id="4419404">uint16</span><span class="op" id="4419410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4419413">0x0000</span><span class="op" id="4419419">,</span>&nbsp;<span class="num" id="4419421">0x1c20</span><span class="op" id="4419427">,</span>&nbsp;<span class="num" id="4419429">0x3840</span><span class="op" id="4419435">,</span>&nbsp;<span class="num" id="4419437">0x2460</span><span class="op" id="4419443">,</span>&nbsp;<span class="num" id="4419445">0x7080</span><span class="op" id="4419451">,</span>&nbsp;<span class="num" id="4419453">0x6ca0</span><span class="op" id="4419459">,</span>&nbsp;<span class="num" id="4419461">0x48c0</span><span class="op" id="4419467">,</span>&nbsp;<span class="num" id="4419469">0x54e0</span><span class="op" id="4419475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4419478">0xe100</span><span class="op" id="4419484">,</span>&nbsp;<span class="num" id="4419486">0xfd20</span><span class="op" id="4419492">,</span>&nbsp;<span class="num" id="4419494">0xd940</span><span class="op" id="4419500">,</span>&nbsp;<span class="num" id="4419502">0xc560</span><span class="op" id="4419508">,</span>&nbsp;<span class="num" id="4419510">0x9180</span><span class="op" id="4419516">,</span>&nbsp;<span class="num" id="4419518">0x8da0</span><span class="op" id="4419524">,</span>&nbsp;<span class="num" id="4419526">0xa9c0</span><span class="op" id="4419532">,</span>&nbsp;<span class="num" id="4419534">0xb5e0</span><span class="op" id="4419540">,</span><br>
<span class="lineno"></span><span class="op" id="4419542">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4419545">//&nbsp;mul&nbsp;sets&nbsp;y&nbsp;to&nbsp;y*H,&nbsp;where&nbsp;H&nbsp;is&nbsp;the&nbsp;GCM&nbsp;key,&nbsp;fixed&nbsp;during&nbsp;NewGCM.</span><br>
<span class="lineno"></span><span class="keyword" id="4419612">func</span>&nbsp;<span class="op" id="4419617">(</span><span class="ident" id="4419618">g</span>&nbsp;<span class="op" id="4419620">*</span><span class="ident" id="4419621"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4419624">)</span>&nbsp;<span class="ident" id="4419626">mul</span><span class="op" id="4419629">(</span><span class="ident" id="4419630">y</span>&nbsp;<span class="op" id="4419632">*</span><span class="ident" id="4419633"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4419648">)</span>&nbsp;<span class="op" id="4419650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419653">var</span>&nbsp;<span class="ident" id="4419657">z</span>&nbsp;<span class="ident" id="4419659"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419677">for</span>&nbsp;<span class="ident" id="4419681">i</span>&nbsp;<span class="op" id="4419683">:=</span>&nbsp;<span class="num" id="4419686">0</span><span class="op" id="4419687">;</span>&nbsp;<span class="ident" id="4419689"><a href="/gostd/crypto/cipher/gcm.go.html#4419681">i</a></span>&nbsp;<span class="op" id="4419691">&lt;</span>&nbsp;<span class="num" id="4419693">2</span><span class="op" id="4419694">;</span>&nbsp;<span class="ident" id="4419696"><a href="/gostd/crypto/cipher/gcm.go.html#4419681">i</a></span><span class="op" id="4419697">++</span>&nbsp;<span class="op" id="4419700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419704">word</span>&nbsp;<span class="op" id="4419709">:=</span>&nbsp;<span class="ident" id="4419712"><a href="/gostd/crypto/cipher/gcm.go.html#4419630">y</a></span><span class="op" id="4419713">.</span><span class="ident" id="4419714"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419721">if</span>&nbsp;<span class="ident" id="4419724"><a href="/gostd/crypto/cipher/gcm.go.html#4419681">i</a></span>&nbsp;<span class="op" id="4419726">==</span>&nbsp;<span class="num" id="4419729">1</span>&nbsp;<span class="op" id="4419731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419736"><a href="/gostd/crypto/cipher/gcm.go.html#4419704">word</a></span>&nbsp;<span class="op" id="4419741">=</span>&nbsp;<span class="ident" id="4419743"><a href="/gostd/crypto/cipher/gcm.go.html#4419630">y</a></span><span class="op" id="4419744">.</span><span class="ident" id="4419745"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4419751">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419756">//&nbsp;Multiplication&nbsp;works&nbsp;by&nbsp;multiplying&nbsp;z&nbsp;by&nbsp;16&nbsp;and&nbsp;adding&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419819">//&nbsp;one&nbsp;of&nbsp;the&nbsp;precomputed&nbsp;multiples&nbsp;of&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4419863">for</span>&nbsp;<span class="ident" id="4419867">j</span>&nbsp;<span class="op" id="4419869">:=</span>&nbsp;<span class="num" id="4419872">0</span><span class="op" id="4419873">;</span>&nbsp;<span class="ident" id="4419875"><a href="/gostd/crypto/cipher/gcm.go.html#4419867">j</a></span>&nbsp;<span class="op" id="4419877">&lt;</span>&nbsp;<span class="num" id="4419879">64</span><span class="op" id="4419881">;</span>&nbsp;<span class="ident" id="4419883"><a href="/gostd/crypto/cipher/gcm.go.html#4419867">j</a></span>&nbsp;<span class="op" id="4419885">+=</span>&nbsp;<span class="num" id="4419888">4</span>&nbsp;<span class="op" id="4419890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419895">msw</span>&nbsp;<span class="op" id="4419899">:=</span>&nbsp;<span class="ident" id="4419902"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419903">.</span><span class="ident" id="4419904"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4419909">&amp;</span>&nbsp;<span class="num" id="4419911">0xf</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419918"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419919">.</span><span class="ident" id="4419920"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4419925">&gt;&gt;=</span>&nbsp;<span class="num" id="4419929">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419934"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419935">.</span><span class="ident" id="4419936"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4419941">|=</span>&nbsp;<span class="ident" id="4419944"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419945">.</span><span class="ident" id="4419946"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4419950">&lt;&lt;</span>&nbsp;<span class="num" id="4419953">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419959"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419960">.</span><span class="ident" id="4419961"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4419965">&gt;&gt;=</span>&nbsp;<span class="num" id="4419969">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4419974"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4419975">.</span><span class="ident" id="4419976"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4419980">^=</span>&nbsp;<span class="builtintype" id="4419983">uint64</span><span class="op" id="4419989">(</span><span class="ident" id="4419990"><a href="/gostd/crypto/cipher/gcm.go.html#4419382">gcmReductionTable</a></span><span class="op" id="4420007">[</span><span class="ident" id="4420008"><a href="/gostd/crypto/cipher/gcm.go.html#4419895">msw</a></span><span class="op" id="4420011">]</span><span class="op" id="4420012">)</span>&nbsp;<span class="op" id="4420014">&lt;&lt;</span>&nbsp;<span class="num" id="4420017">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4420024">//&nbsp;the&nbsp;values&nbsp;in&nbsp;|table|&nbsp;are&nbsp;ordered&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4420068">//&nbsp;little-endian&nbsp;bit&nbsp;positions.&nbsp;See&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4420119">//&nbsp;in&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420136">t</span>&nbsp;<span class="op" id="4420138">:=</span>&nbsp;<span class="op" id="4420141">&amp;</span><span class="ident" id="4420142"><a href="/gostd/crypto/cipher/gcm.go.html#4419618">g</a></span><span class="op" id="4420143">.</span><span class="ident" id="4420144"><a href="/gostd/crypto/cipher/gcm.go.html#4415552">productTable</a></span><span class="op" id="4420156">[</span><span class="ident" id="4420157"><a href="/gostd/crypto/cipher/gcm.go.html#4419704">word</a></span><span class="op" id="4420161">&amp;</span><span class="num" id="4420162">0xf</span><span class="op" id="4420165">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420171"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4420172">.</span><span class="ident" id="4420173"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4420177">^=</span>&nbsp;<span class="ident" id="4420180"><a href="/gostd/crypto/cipher/gcm.go.html#4420136">t</a></span><span class="op" id="4420181">.</span><span class="ident" id="4420182"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420189"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><span class="op" id="4420190">.</span><span class="ident" id="4420191"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4420196">^=</span>&nbsp;<span class="ident" id="4420199"><a href="/gostd/crypto/cipher/gcm.go.html#4420136">t</a></span><span class="op" id="4420200">.</span><span class="ident" id="4420201"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420209"><a href="/gostd/crypto/cipher/gcm.go.html#4419704">word</a></span>&nbsp;<span class="op" id="4420214">&gt;&gt;=</span>&nbsp;<span class="num" id="4420218">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420225">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420229">*</span><span class="ident" id="4420230"><a href="/gostd/crypto/cipher/gcm.go.html#4419630">y</a></span>&nbsp;<span class="op" id="4420232">=</span>&nbsp;<span class="ident" id="4420234"><a href="/gostd/crypto/cipher/gcm.go.html#4419657">z</a></span><br>
<span class="lineno"></span><span class="op" id="4420236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420239">//&nbsp;updateBlocks&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;blocks,&nbsp;based&nbsp;on</span><br>
<span class="lineno">235</span><span class="comment" id="4420314">//&nbsp;Horner&#39;s&nbsp;rule.&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;in&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4420390">func</span>&nbsp;<span class="op" id="4420395">(</span><span class="ident" id="4420396">g</span>&nbsp;<span class="op" id="4420398">*</span><span class="ident" id="4420399"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4420402">)</span>&nbsp;<span class="ident" id="4420404">updateBlocks</span><span class="op" id="4420416">(</span><span class="ident" id="4420417">y</span>&nbsp;<span class="op" id="4420419">*</span><span class="ident" id="4420420"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4420435">,</span>&nbsp;<span class="ident" id="4420437">blocks</span>&nbsp;<span class="op" id="4420444">[</span><span class="op" id="4420445">]</span><span class="builtintype" id="4420446">byte</span><span class="op" id="4420450">)</span>&nbsp;<span class="op" id="4420452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4420455">for</span>&nbsp;<span class="builtinfunc" id="4420459">len</span><span class="op" id="4420462">(</span><span class="ident" id="4420463"><a href="/gostd/crypto/cipher/gcm.go.html#4420437">blocks</a></span><span class="op" id="4420469">)</span>&nbsp;<span class="op" id="4420471">&gt;</span>&nbsp;<span class="num" id="4420473">0</span>&nbsp;<span class="op" id="4420475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420479"><a href="/gostd/crypto/cipher/gcm.go.html#4420417">y</a></span><span class="op" id="4420480">.</span><span class="ident" id="4420481"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4420485">^=</span>&nbsp;<span class="ident" id="4420488"><a href="/gostd/crypto/cipher/gcm.go.html#4422747">getUint64</a></span><span class="op" id="4420497">(</span><span class="ident" id="4420498"><a href="/gostd/crypto/cipher/gcm.go.html#4420437">blocks</a></span><span class="op" id="4420504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420508"><a href="/gostd/crypto/cipher/gcm.go.html#4420417">y</a></span><span class="op" id="4420509">.</span><span class="ident" id="4420510"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4420515">^=</span>&nbsp;<span class="ident" id="4420518"><a href="/gostd/crypto/cipher/gcm.go.html#4422747">getUint64</a></span><span class="op" id="4420527">(</span><span class="ident" id="4420528"><a href="/gostd/crypto/cipher/gcm.go.html#4420437">blocks</a></span><span class="op" id="4420534">[</span><span class="num" id="4420535">8</span><span class="op" id="4420536">:</span><span class="op" id="4420537">]</span><span class="op" id="4420538">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420542"><a href="/gostd/crypto/cipher/gcm.go.html#4420396">g</a></span><span class="op" id="4420543">.</span><span class="ident" id="4420544"><a href="/gostd/crypto/cipher/gcm.go.html#4419626">mul</a></span><span class="op" id="4420547">(</span><span class="ident" id="4420548"><a href="/gostd/crypto/cipher/gcm.go.html#4420417">y</a></span><span class="op" id="4420549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420553"><a href="/gostd/crypto/cipher/gcm.go.html#4420437">blocks</a></span>&nbsp;<span class="op" id="4420560">=</span>&nbsp;<span class="ident" id="4420562"><a href="/gostd/crypto/cipher/gcm.go.html#4420437">blocks</a></span><span class="op" id="4420568">[</span><span class="ident" id="4420569"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4420581">:</span><span class="op" id="4420582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420585">}</span><br>
<span class="lineno"></span><span class="op" id="4420587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4420590">//&nbsp;update&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;data.&nbsp;If&nbsp;data&nbsp;is&nbsp;not&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4420665">//&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;long&nbsp;then&nbsp;the&nbsp;remainder&nbsp;is&nbsp;zero&nbsp;padded.</span><br>
<span class="lineno"></span><span class="keyword" id="4420739">func</span>&nbsp;<span class="op" id="4420744">(</span><span class="ident" id="4420745">g</span>&nbsp;<span class="op" id="4420747">*</span><span class="ident" id="4420748"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4420751">)</span>&nbsp;<span class="ident" id="4420753">update</span><span class="op" id="4420759">(</span><span class="ident" id="4420760">y</span>&nbsp;<span class="op" id="4420762">*</span><span class="ident" id="4420763"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><span class="op" id="4420778">,</span>&nbsp;<span class="ident" id="4420780">data</span>&nbsp;<span class="op" id="4420785">[</span><span class="op" id="4420786">]</span><span class="builtintype" id="4420787">byte</span><span class="op" id="4420791">)</span>&nbsp;<span class="op" id="4420793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420796">fullBlocks</span>&nbsp;<span class="op" id="4420807">:=</span>&nbsp;<span class="op" id="4420810">(</span><span class="builtinfunc" id="4420811">len</span><span class="op" id="4420814">(</span><span class="ident" id="4420815"><a href="/gostd/crypto/cipher/gcm.go.html#4420780">data</a></span><span class="op" id="4420819">)</span>&nbsp;<span class="op" id="4420821">&gt;&gt;</span>&nbsp;<span class="num" id="4420824">4</span><span class="op" id="4420825">)</span>&nbsp;<span class="op" id="4420827">&lt;&lt;</span>&nbsp;<span class="num" id="4420830">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420833"><a href="/gostd/crypto/cipher/gcm.go.html#4420745">g</a></span><span class="op" id="4420834">.</span><span class="ident" id="4420835"><a href="/gostd/crypto/cipher/gcm.go.html#4420404">updateBlocks</a></span><span class="op" id="4420847">(</span><span class="ident" id="4420848"><a href="/gostd/crypto/cipher/gcm.go.html#4420760">y</a></span><span class="op" id="4420849">,</span>&nbsp;<span class="ident" id="4420851"><a href="/gostd/crypto/cipher/gcm.go.html#4420780">data</a></span><span class="op" id="4420855">[</span><span class="op" id="4420856">:</span><span class="ident" id="4420857"><a href="/gostd/crypto/cipher/gcm.go.html#4420796">fullBlocks</a></span><span class="op" id="4420867">]</span><span class="op" id="4420868">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4420872">if</span>&nbsp;<span class="builtinfunc" id="4420875">len</span><span class="op" id="4420878">(</span><span class="ident" id="4420879"><a href="/gostd/crypto/cipher/gcm.go.html#4420780">data</a></span><span class="op" id="4420883">)</span>&nbsp;<span class="op" id="4420885">!=</span>&nbsp;<span class="ident" id="4420888"><a href="/gostd/crypto/cipher/gcm.go.html#4420796">fullBlocks</a></span>&nbsp;<span class="op" id="4420899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4420903">var</span>&nbsp;<span class="ident" id="4420907">partialBlock</span>&nbsp;<span class="op" id="4420920">[</span><span class="ident" id="4420921"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4420933">]</span><span class="builtintype" id="4420934">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4420941">copy</span><span class="op" id="4420945">(</span><span class="ident" id="4420946"><a href="/gostd/crypto/cipher/gcm.go.html#4420907">partialBlock</a></span><span class="op" id="4420958">[</span><span class="op" id="4420959">:</span><span class="op" id="4420960">]</span><span class="op" id="4420961">,</span>&nbsp;<span class="ident" id="4420963"><a href="/gostd/crypto/cipher/gcm.go.html#4420780">data</a></span><span class="op" id="4420967">[</span><span class="ident" id="4420968"><a href="/gostd/crypto/cipher/gcm.go.html#4420796">fullBlocks</a></span><span class="op" id="4420978">:</span><span class="op" id="4420979">]</span><span class="op" id="4420980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4420984"><a href="/gostd/crypto/cipher/gcm.go.html#4420745">g</a></span><span class="op" id="4420985">.</span><span class="ident" id="4420986"><a href="/gostd/crypto/cipher/gcm.go.html#4420404">updateBlocks</a></span><span class="op" id="4420998">(</span><span class="ident" id="4420999"><a href="/gostd/crypto/cipher/gcm.go.html#4420760">y</a></span><span class="op" id="4421000">,</span>&nbsp;<span class="ident" id="4421002"><a href="/gostd/crypto/cipher/gcm.go.html#4420907">partialBlock</a></span><span class="op" id="4421014">[</span><span class="op" id="4421015">:</span><span class="op" id="4421016">]</span><span class="op" id="4421017">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421020">}</span><br>
<span class="lineno"></span><span class="op" id="4421022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4421025">//&nbsp;gcmInc32&nbsp;treats&nbsp;the&nbsp;final&nbsp;four&nbsp;bytes&nbsp;of&nbsp;counterBlock&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4421103">//&nbsp;and&nbsp;increments&nbsp;it.</span><br>
<span class="lineno">260</span><span class="keyword" id="4421125">func</span>&nbsp;<span class="ident" id="4421130">gcmInc32</span><span class="op" id="4421138">(</span><span class="ident" id="4421139">counterBlock</span>&nbsp;<span class="op" id="4421152">*</span><span class="op" id="4421153">[</span><span class="num" id="4421154">16</span><span class="op" id="4421156">]</span><span class="builtintype" id="4421157">byte</span><span class="op" id="4421161">)</span>&nbsp;<span class="op" id="4421163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421166">for</span>&nbsp;<span class="ident" id="4421170">i</span>&nbsp;<span class="op" id="4421172">:=</span>&nbsp;<span class="ident" id="4421175"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span>&nbsp;<span class="op" id="4421188">-</span>&nbsp;<span class="num" id="4421190">1</span><span class="op" id="4421191">;</span>&nbsp;<span class="ident" id="4421193"><a href="/gostd/crypto/cipher/gcm.go.html#4421170">i</a></span>&nbsp;<span class="op" id="4421195">&gt;=</span>&nbsp;<span class="ident" id="4421198"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4421210">-</span><span class="num" id="4421211">4</span><span class="op" id="4421212">;</span>&nbsp;<span class="ident" id="4421214"><a href="/gostd/crypto/cipher/gcm.go.html#4421170">i</a></span><span class="op" id="4421215">--</span>&nbsp;<span class="op" id="4421218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4421222"><a href="/gostd/crypto/cipher/gcm.go.html#4421139">counterBlock</a></span><span class="op" id="4421234">[</span><span class="ident" id="4421235"><a href="/gostd/crypto/cipher/gcm.go.html#4421170">i</a></span><span class="op" id="4421236">]</span><span class="op" id="4421237">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421242">if</span>&nbsp;<span class="ident" id="4421245"><a href="/gostd/crypto/cipher/gcm.go.html#4421139">counterBlock</a></span><span class="op" id="4421257">[</span><span class="ident" id="4421258"><a href="/gostd/crypto/cipher/gcm.go.html#4421170">i</a></span><span class="op" id="4421259">]</span>&nbsp;<span class="op" id="4421261">!=</span>&nbsp;<span class="num" id="4421264">0</span>&nbsp;<span class="op" id="4421266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421271">break</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421282">}</span><br>
<span class="lineno"></span><span class="op" id="4421284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4421287">//&nbsp;sliceForAppend&nbsp;takes&nbsp;a&nbsp;slice&nbsp;and&nbsp;a&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;It&nbsp;returns&nbsp;a</span><br>
<span class="lineno">270</span><span class="comment" id="4421365">//&nbsp;slice&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;given&nbsp;slice&nbsp;followed&nbsp;by&nbsp;that&nbsp;many&nbsp;bytes&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4421445">//&nbsp;second&nbsp;slice&nbsp;that&nbsp;aliases&nbsp;into&nbsp;it&nbsp;and&nbsp;contains&nbsp;only&nbsp;the&nbsp;extra&nbsp;bytes.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4421524">//&nbsp;original&nbsp;slice&nbsp;has&nbsp;sufficient&nbsp;capacity&nbsp;then&nbsp;no&nbsp;allocation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="4421599">func</span>&nbsp;<span class="ident" id="4421604">sliceForAppend</span><span class="op" id="4421618">(</span><span class="ident" id="4421619">in</span>&nbsp;<span class="op" id="4421622">[</span><span class="op" id="4421623">]</span><span class="builtintype" id="4421624">byte</span><span class="op" id="4421628">,</span>&nbsp;<span class="ident" id="4421630">n</span>&nbsp;<span class="builtintype" id="4421632">int</span><span class="op" id="4421635">)</span>&nbsp;<span class="op" id="4421637">(</span><span class="ident" id="4421638">head</span><span class="op" id="4421642">,</span>&nbsp;<span class="ident" id="4421644">tail</span>&nbsp;<span class="op" id="4421649">[</span><span class="op" id="4421650">]</span><span class="builtintype" id="4421651">byte</span><span class="op" id="4421655">)</span>&nbsp;<span class="op" id="4421657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421660">if</span>&nbsp;<span class="ident" id="4421663">total</span>&nbsp;<span class="op" id="4421669">:=</span>&nbsp;<span class="builtinfunc" id="4421672">len</span><span class="op" id="4421675">(</span><span class="ident" id="4421676"><a href="/gostd/crypto/cipher/gcm.go.html#4421619">in</a></span><span class="op" id="4421678">)</span>&nbsp;<span class="op" id="4421680">+</span>&nbsp;<span class="ident" id="4421682"><a href="/gostd/crypto/cipher/gcm.go.html#4421630">n</a></span><span class="op" id="4421683">;</span>&nbsp;<span class="builtinfunc" id="4421685">cap</span><span class="op" id="4421688">(</span><span class="ident" id="4421689"><a href="/gostd/crypto/cipher/gcm.go.html#4421619">in</a></span><span class="op" id="4421691">)</span>&nbsp;<span class="op" id="4421693">&gt;=</span>&nbsp;<span class="ident" id="4421696"><a href="/gostd/crypto/cipher/gcm.go.html#4421663">total</a></span>&nbsp;<span class="op" id="4421702">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4421706"><a href="/gostd/crypto/cipher/gcm.go.html#4421638">head</a></span>&nbsp;<span class="op" id="4421711">=</span>&nbsp;<span class="ident" id="4421713"><a href="/gostd/crypto/cipher/gcm.go.html#4421619">in</a></span><span class="op" id="4421715">[</span><span class="op" id="4421716">:</span><span class="ident" id="4421717"><a href="/gostd/crypto/cipher/gcm.go.html#4421663">total</a></span><span class="op" id="4421722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421725">}</span>&nbsp;<span class="keyword" id="4421727">else</span>&nbsp;<span class="op" id="4421732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4421736"><a href="/gostd/crypto/cipher/gcm.go.html#4421638">head</a></span>&nbsp;<span class="op" id="4421741">=</span>&nbsp;<span class="builtinfunc" id="4421743">make</span><span class="op" id="4421747">(</span><span class="op" id="4421748">[</span><span class="op" id="4421749">]</span><span class="builtintype" id="4421750">byte</span><span class="op" id="4421754">,</span>&nbsp;<span class="ident" id="4421756"><a href="/gostd/crypto/cipher/gcm.go.html#4421663">total</a></span><span class="op" id="4421761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4421765">copy</span><span class="op" id="4421769">(</span><span class="ident" id="4421770"><a href="/gostd/crypto/cipher/gcm.go.html#4421638">head</a></span><span class="op" id="4421774">,</span>&nbsp;<span class="ident" id="4421776"><a href="/gostd/crypto/cipher/gcm.go.html#4421619">in</a></span><span class="op" id="4421778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421781">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4421784"><a href="/gostd/crypto/cipher/gcm.go.html#4421644">tail</a></span>&nbsp;<span class="op" id="4421789">=</span>&nbsp;<span class="ident" id="4421791"><a href="/gostd/crypto/cipher/gcm.go.html#4421638">head</a></span><span class="op" id="4421795">[</span><span class="builtinfunc" id="4421796">len</span><span class="op" id="4421799">(</span><span class="ident" id="4421800"><a href="/gostd/crypto/cipher/gcm.go.html#4421619">in</a></span><span class="op" id="4421802">)</span><span class="op" id="4421803">:</span><span class="op" id="4421804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421807">return</span><br>
<span class="lineno"></span><span class="op" id="4421814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4421817">//&nbsp;counterCrypt&nbsp;crypts&nbsp;in&nbsp;to&nbsp;out&nbsp;using&nbsp;g.cipher&nbsp;in&nbsp;counter&nbsp;mode.</span><br>
<span class="lineno">285</span><span class="keyword" id="4421882">func</span>&nbsp;<span class="op" id="4421887">(</span><span class="ident" id="4421888">g</span>&nbsp;<span class="op" id="4421890">*</span><span class="ident" id="4421891"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4421894">)</span>&nbsp;<span class="ident" id="4421896">counterCrypt</span><span class="op" id="4421908">(</span><span class="ident" id="4421909">out</span><span class="op" id="4421912">,</span>&nbsp;<span class="ident" id="4421914">in</span>&nbsp;<span class="op" id="4421917">[</span><span class="op" id="4421918">]</span><span class="builtintype" id="4421919">byte</span><span class="op" id="4421923">,</span>&nbsp;<span class="ident" id="4421925">counter</span>&nbsp;<span class="op" id="4421933">*</span><span class="op" id="4421934">[</span><span class="ident" id="4421935"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4421947">]</span><span class="builtintype" id="4421948">byte</span><span class="op" id="4421952">)</span>&nbsp;<span class="op" id="4421954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421957">var</span>&nbsp;<span class="ident" id="4421961">mask</span>&nbsp;<span class="op" id="4421966">[</span><span class="ident" id="4421967"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4421979">]</span><span class="builtintype" id="4421980">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4421987">for</span>&nbsp;<span class="builtinfunc" id="4421991">len</span><span class="op" id="4421994">(</span><span class="ident" id="4421995"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span><span class="op" id="4421997">)</span>&nbsp;<span class="op" id="4421999">&gt;=</span>&nbsp;<span class="ident" id="4422002"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span>&nbsp;<span class="op" id="4422015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422019"><a href="/gostd/crypto/cipher/gcm.go.html#4421888">g</a></span><span class="op" id="4422020">.</span><span class="ident" id="4422021"><a href="/gostd/crypto/cipher/gcm.go.html#4415415">cipher</a></span><span class="op" id="4422027">.</span><span class="ident" id="4422028"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4422035">(</span><span class="ident" id="4422036"><a href="/gostd/crypto/cipher/gcm.go.html#4421961">mask</a></span><span class="op" id="4422040">[</span><span class="op" id="4422041">:</span><span class="op" id="4422042">]</span><span class="op" id="4422043">,</span>&nbsp;<span class="ident" id="4422045"><a href="/gostd/crypto/cipher/gcm.go.html#4421925">counter</a></span><span class="op" id="4422052">[</span><span class="op" id="4422053">:</span><span class="op" id="4422054">]</span><span class="op" id="4422055">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422059"><a href="/gostd/crypto/cipher/gcm.go.html#4421130">gcmInc32</a></span><span class="op" id="4422067">(</span><span class="ident" id="4422068"><a href="/gostd/crypto/cipher/gcm.go.html#4421925">counter</a></span><span class="op" id="4422075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422080"><a href="/gostd/crypto/cipher/xor.go.html#4427944">xorWords</a></span><span class="op" id="4422088">(</span><span class="ident" id="4422089"><a href="/gostd/crypto/cipher/gcm.go.html#4421909">out</a></span><span class="op" id="4422092">,</span>&nbsp;<span class="ident" id="4422094"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span><span class="op" id="4422096">,</span>&nbsp;<span class="ident" id="4422098"><a href="/gostd/crypto/cipher/gcm.go.html#4421961">mask</a></span><span class="op" id="4422102">[</span><span class="op" id="4422103">:</span><span class="op" id="4422104">]</span><span class="op" id="4422105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422109"><a href="/gostd/crypto/cipher/gcm.go.html#4421909">out</a></span>&nbsp;<span class="op" id="4422113">=</span>&nbsp;<span class="ident" id="4422115"><a href="/gostd/crypto/cipher/gcm.go.html#4421909">out</a></span><span class="op" id="4422118">[</span><span class="ident" id="4422119"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4422131">:</span><span class="op" id="4422132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422136"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span>&nbsp;<span class="op" id="4422139">=</span>&nbsp;<span class="ident" id="4422141"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span><span class="op" id="4422143">[</span><span class="ident" id="4422144"><a href="/gostd/crypto/cipher/gcm.go.html#4416591">gcmBlockSize</a></span><span class="op" id="4422156">:</span><span class="op" id="4422157">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4422160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4422164">if</span>&nbsp;<span class="builtinfunc" id="4422167">len</span><span class="op" id="4422170">(</span><span class="ident" id="4422171"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span><span class="op" id="4422173">)</span>&nbsp;<span class="op" id="4422175">&gt;</span>&nbsp;<span class="num" id="4422177">0</span>&nbsp;<span class="op" id="4422179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422183"><a href="/gostd/crypto/cipher/gcm.go.html#4421888">g</a></span><span class="op" id="4422184">.</span><span class="ident" id="4422185"><a href="/gostd/crypto/cipher/gcm.go.html#4415415">cipher</a></span><span class="op" id="4422191">.</span><span class="ident" id="4422192"><a href="/gostd/crypto/cipher/cipher.go.html#4410882">Encrypt</a></span><span class="op" id="4422199">(</span><span class="ident" id="4422200"><a href="/gostd/crypto/cipher/gcm.go.html#4421961">mask</a></span><span class="op" id="4422204">[</span><span class="op" id="4422205">:</span><span class="op" id="4422206">]</span><span class="op" id="4422207">,</span>&nbsp;<span class="ident" id="4422209"><a href="/gostd/crypto/cipher/gcm.go.html#4421925">counter</a></span><span class="op" id="4422216">[</span><span class="op" id="4422217">:</span><span class="op" id="4422218">]</span><span class="op" id="4422219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422223"><a href="/gostd/crypto/cipher/gcm.go.html#4421130">gcmInc32</a></span><span class="op" id="4422231">(</span><span class="ident" id="4422232"><a href="/gostd/crypto/cipher/gcm.go.html#4421925">counter</a></span><span class="op" id="4422239">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422243"><a href="/gostd/crypto/cipher/xor.go.html#4427201">xorBytes</a></span><span class="op" id="4422251">(</span><span class="ident" id="4422252"><a href="/gostd/crypto/cipher/gcm.go.html#4421909">out</a></span><span class="op" id="4422255">,</span>&nbsp;<span class="ident" id="4422257"><a href="/gostd/crypto/cipher/gcm.go.html#4421914">in</a></span><span class="op" id="4422259">,</span>&nbsp;<span class="ident" id="4422261"><a href="/gostd/crypto/cipher/gcm.go.html#4421961">mask</a></span><span class="op" id="4422265">[</span><span class="op" id="4422266">:</span><span class="op" id="4422267">]</span><span class="op" id="4422268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4422271">}</span><br>
<span class="lineno"></span><span class="op" id="4422273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422276">//&nbsp;auth&nbsp;calculates&nbsp;GHASH(ciphertext,&nbsp;additionalData),&nbsp;masks&nbsp;the&nbsp;result&nbsp;with</span><br>
<span class="lineno">305</span><span class="comment" id="4422352">//&nbsp;tagMask&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="4422393">func</span>&nbsp;<span class="op" id="4422398">(</span><span class="ident" id="4422399">g</span>&nbsp;<span class="op" id="4422401">*</span><span class="ident" id="4422402"><a href="/gostd/crypto/cipher/gcm.go.html#4415401">gcm</a></span><span class="op" id="4422405">)</span>&nbsp;<span class="ident" id="4422407">auth</span><span class="op" id="4422411">(</span><span class="ident" id="4422412">out</span><span class="op" id="4422415">,</span>&nbsp;<span class="ident" id="4422417">ciphertext</span><span class="op" id="4422427">,</span>&nbsp;<span class="ident" id="4422429">additionalData</span>&nbsp;<span class="op" id="4422444">[</span><span class="op" id="4422445">]</span><span class="builtintype" id="4422446">byte</span><span class="op" id="4422450">,</span>&nbsp;<span class="ident" id="4422452">tagMask</span>&nbsp;<span class="op" id="4422460">*</span><span class="op" id="4422461">[</span><span class="ident" id="4422462"><a href="/gostd/crypto/cipher/gcm.go.html#4416610">gcmTagSize</a></span><span class="op" id="4422472">]</span><span class="builtintype" id="4422473">byte</span><span class="op" id="4422477">)</span>&nbsp;<span class="op" id="4422479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4422482">var</span>&nbsp;<span class="ident" id="4422486">y</span>&nbsp;<span class="ident" id="4422488"><a href="/gostd/crypto/cipher/gcm.go.html#4415190">gcmFieldElement</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422505"><a href="/gostd/crypto/cipher/gcm.go.html#4422399">g</a></span><span class="op" id="4422506">.</span><span class="ident" id="4422507"><a href="/gostd/crypto/cipher/gcm.go.html#4420753">update</a></span><span class="op" id="4422513">(</span><span class="op" id="4422514">&amp;</span><span class="ident" id="4422515"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422516">,</span>&nbsp;<span class="ident" id="4422518"><a href="/gostd/crypto/cipher/gcm.go.html#4422429">additionalData</a></span><span class="op" id="4422532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422535"><a href="/gostd/crypto/cipher/gcm.go.html#4422399">g</a></span><span class="op" id="4422536">.</span><span class="ident" id="4422537"><a href="/gostd/crypto/cipher/gcm.go.html#4420753">update</a></span><span class="op" id="4422543">(</span><span class="op" id="4422544">&amp;</span><span class="ident" id="4422545"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422546">,</span>&nbsp;<span class="ident" id="4422548"><a href="/gostd/crypto/cipher/gcm.go.html#4422417">ciphertext</a></span><span class="op" id="4422558">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422562"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422563">.</span><span class="ident" id="4422564"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span>&nbsp;<span class="op" id="4422568">^=</span>&nbsp;<span class="builtintype" id="4422571">uint64</span><span class="op" id="4422577">(</span><span class="builtinfunc" id="4422578">len</span><span class="op" id="4422581">(</span><span class="ident" id="4422582"><a href="/gostd/crypto/cipher/gcm.go.html#4422429">additionalData</a></span><span class="op" id="4422596">)</span><span class="op" id="4422597">)</span>&nbsp;<span class="op" id="4422599">*</span>&nbsp;<span class="num" id="4422601">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422604"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422605">.</span><span class="ident" id="4422606"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span>&nbsp;<span class="op" id="4422611">^=</span>&nbsp;<span class="builtintype" id="4422614">uint64</span><span class="op" id="4422620">(</span><span class="builtinfunc" id="4422621">len</span><span class="op" id="4422624">(</span><span class="ident" id="4422625"><a href="/gostd/crypto/cipher/gcm.go.html#4422417">ciphertext</a></span><span class="op" id="4422635">)</span><span class="op" id="4422636">)</span>&nbsp;<span class="op" id="4422638">*</span>&nbsp;<span class="num" id="4422640">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422644"><a href="/gostd/crypto/cipher/gcm.go.html#4422399">g</a></span><span class="op" id="4422645">.</span><span class="ident" id="4422646"><a href="/gostd/crypto/cipher/gcm.go.html#4419626">mul</a></span><span class="op" id="4422649">(</span><span class="op" id="4422650">&amp;</span><span class="ident" id="4422651"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422652">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422656"><a href="/gostd/crypto/cipher/gcm.go.html#4422986">putUint64</a></span><span class="op" id="4422665">(</span><span class="ident" id="4422666"><a href="/gostd/crypto/cipher/gcm.go.html#4422412">out</a></span><span class="op" id="4422669">,</span>&nbsp;<span class="ident" id="4422671"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422672">.</span><span class="ident" id="4422673"><a href="/gostd/crypto/cipher/gcm.go.html#4415216">low</a></span><span class="op" id="4422676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422679"><a href="/gostd/crypto/cipher/gcm.go.html#4422986">putUint64</a></span><span class="op" id="4422688">(</span><span class="ident" id="4422689"><a href="/gostd/crypto/cipher/gcm.go.html#4422412">out</a></span><span class="op" id="4422692">[</span><span class="num" id="4422693">8</span><span class="op" id="4422694">:</span><span class="op" id="4422695">]</span><span class="op" id="4422696">,</span>&nbsp;<span class="ident" id="4422698"><a href="/gostd/crypto/cipher/gcm.go.html#4422486">y</a></span><span class="op" id="4422699">.</span><span class="ident" id="4422700"><a href="/gostd/crypto/cipher/gcm.go.html#4415221">high</a></span><span class="op" id="4422704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422708"><a href="/gostd/crypto/cipher/xor.go.html#4427944">xorWords</a></span><span class="op" id="4422716">(</span><span class="ident" id="4422717"><a href="/gostd/crypto/cipher/gcm.go.html#4422412">out</a></span><span class="op" id="4422720">,</span>&nbsp;<span class="ident" id="4422722"><a href="/gostd/crypto/cipher/gcm.go.html#4422412">out</a></span><span class="op" id="4422725">,</span>&nbsp;<span class="ident" id="4422727"><a href="/gostd/crypto/cipher/gcm.go.html#4422452">tagMask</a></span><span class="op" id="4422734">[</span><span class="op" id="4422735">:</span><span class="op" id="4422736">]</span><span class="op" id="4422737">)</span><br>
<span class="lineno">320</span><span class="op" id="4422739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4422742">func</span>&nbsp;<span class="ident" id="4422747">getUint64</span><span class="op" id="4422756">(</span><span class="ident" id="4422757">data</span>&nbsp;<span class="op" id="4422762">[</span><span class="op" id="4422763">]</span><span class="builtintype" id="4422764">byte</span><span class="op" id="4422768">)</span>&nbsp;<span class="builtintype" id="4422770">uint64</span>&nbsp;<span class="op" id="4422777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4422780">r</span>&nbsp;<span class="op" id="4422782">:=</span>&nbsp;<span class="builtintype" id="4422785">uint64</span><span class="op" id="4422791">(</span><span class="ident" id="4422792"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422796">[</span><span class="num" id="4422797">0</span><span class="op" id="4422798">]</span><span class="op" id="4422799">)</span><span class="op" id="4422800">&lt;&lt;</span><span class="num" id="4422802">56</span>&nbsp;<span class="op" id="4422805">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422809">uint64</span><span class="op" id="4422815">(</span><span class="ident" id="4422816"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422820">[</span><span class="num" id="4422821">1</span><span class="op" id="4422822">]</span><span class="op" id="4422823">)</span><span class="op" id="4422824">&lt;&lt;</span><span class="num" id="4422826">48</span>&nbsp;<span class="op" id="4422829">|</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422833">uint64</span><span class="op" id="4422839">(</span><span class="ident" id="4422840"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422844">[</span><span class="num" id="4422845">2</span><span class="op" id="4422846">]</span><span class="op" id="4422847">)</span><span class="op" id="4422848">&lt;&lt;</span><span class="num" id="4422850">40</span>&nbsp;<span class="op" id="4422853">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422857">uint64</span><span class="op" id="4422863">(</span><span class="ident" id="4422864"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422868">[</span><span class="num" id="4422869">3</span><span class="op" id="4422870">]</span><span class="op" id="4422871">)</span><span class="op" id="4422872">&lt;&lt;</span><span class="num" id="4422874">32</span>&nbsp;<span class="op" id="4422877">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422881">uint64</span><span class="op" id="4422887">(</span><span class="ident" id="4422888"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422892">[</span><span class="num" id="4422893">4</span><span class="op" id="4422894">]</span><span class="op" id="4422895">)</span><span class="op" id="4422896">&lt;&lt;</span><span class="num" id="4422898">24</span>&nbsp;<span class="op" id="4422901">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422905">uint64</span><span class="op" id="4422911">(</span><span class="ident" id="4422912"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422916">[</span><span class="num" id="4422917">5</span><span class="op" id="4422918">]</span><span class="op" id="4422919">)</span><span class="op" id="4422920">&lt;&lt;</span><span class="num" id="4422922">16</span>&nbsp;<span class="op" id="4422925">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422929">uint64</span><span class="op" id="4422935">(</span><span class="ident" id="4422936"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422940">[</span><span class="num" id="4422941">6</span><span class="op" id="4422942">]</span><span class="op" id="4422943">)</span><span class="op" id="4422944">&lt;&lt;</span><span class="num" id="4422946">8</span>&nbsp;<span class="op" id="4422948">|</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4422952">uint64</span><span class="op" id="4422958">(</span><span class="ident" id="4422959"><a href="/gostd/crypto/cipher/gcm.go.html#4422757">data</a></span><span class="op" id="4422963">[</span><span class="num" id="4422964">7</span><span class="op" id="4422965">]</span><span class="op" id="4422966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4422969">return</span>&nbsp;<span class="ident" id="4422976"><a href="/gostd/crypto/cipher/gcm.go.html#4422780">r</a></span><br>
<span class="lineno"></span><span class="op" id="4422978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4422981">func</span>&nbsp;<span class="ident" id="4422986">putUint64</span><span class="op" id="4422995">(</span><span class="ident" id="4422996">out</span>&nbsp;<span class="op" id="4423000">[</span><span class="op" id="4423001">]</span><span class="builtintype" id="4423002">byte</span><span class="op" id="4423006">,</span>&nbsp;<span class="ident" id="4423008">v</span>&nbsp;<span class="builtintype" id="4423010">uint64</span><span class="op" id="4423016">)</span>&nbsp;<span class="op" id="4423018">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423021"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423024">[</span><span class="num" id="4423025">0</span><span class="op" id="4423026">]</span>&nbsp;<span class="op" id="4423028">=</span>&nbsp;<span class="builtintype" id="4423030">byte</span><span class="op" id="4423034">(</span><span class="ident" id="4423035"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423037">&gt;&gt;</span>&nbsp;<span class="num" id="4423040">56</span><span class="op" id="4423042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423045"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423048">[</span><span class="num" id="4423049">1</span><span class="op" id="4423050">]</span>&nbsp;<span class="op" id="4423052">=</span>&nbsp;<span class="builtintype" id="4423054">byte</span><span class="op" id="4423058">(</span><span class="ident" id="4423059"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423061">&gt;&gt;</span>&nbsp;<span class="num" id="4423064">48</span><span class="op" id="4423066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423069"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423072">[</span><span class="num" id="4423073">2</span><span class="op" id="4423074">]</span>&nbsp;<span class="op" id="4423076">=</span>&nbsp;<span class="builtintype" id="4423078">byte</span><span class="op" id="4423082">(</span><span class="ident" id="4423083"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423085">&gt;&gt;</span>&nbsp;<span class="num" id="4423088">40</span><span class="op" id="4423090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423093"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423096">[</span><span class="num" id="4423097">3</span><span class="op" id="4423098">]</span>&nbsp;<span class="op" id="4423100">=</span>&nbsp;<span class="builtintype" id="4423102">byte</span><span class="op" id="4423106">(</span><span class="ident" id="4423107"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423109">&gt;&gt;</span>&nbsp;<span class="num" id="4423112">32</span><span class="op" id="4423114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423117"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423120">[</span><span class="num" id="4423121">4</span><span class="op" id="4423122">]</span>&nbsp;<span class="op" id="4423124">=</span>&nbsp;<span class="builtintype" id="4423126">byte</span><span class="op" id="4423130">(</span><span class="ident" id="4423131"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423133">&gt;&gt;</span>&nbsp;<span class="num" id="4423136">24</span><span class="op" id="4423138">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423141"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423144">[</span><span class="num" id="4423145">5</span><span class="op" id="4423146">]</span>&nbsp;<span class="op" id="4423148">=</span>&nbsp;<span class="builtintype" id="4423150">byte</span><span class="op" id="4423154">(</span><span class="ident" id="4423155"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423157">&gt;&gt;</span>&nbsp;<span class="num" id="4423160">16</span><span class="op" id="4423162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423165"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423168">[</span><span class="num" id="4423169">6</span><span class="op" id="4423170">]</span>&nbsp;<span class="op" id="4423172">=</span>&nbsp;<span class="builtintype" id="4423174">byte</span><span class="op" id="4423178">(</span><span class="ident" id="4423179"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span>&nbsp;<span class="op" id="4423181">&gt;&gt;</span>&nbsp;<span class="num" id="4423184">8</span><span class="op" id="4423185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423188"><a href="/gostd/crypto/cipher/gcm.go.html#4422996">out</a></span><span class="op" id="4423191">[</span><span class="num" id="4423192">7</span><span class="op" id="4423193">]</span>&nbsp;<span class="op" id="4423195">=</span>&nbsp;<span class="builtintype" id="4423197">byte</span><span class="op" id="4423201">(</span><span class="ident" id="4423202"><a href="/gostd/crypto/cipher/gcm.go.html#4423008">v</a></span><span class="op" id="4423203">)</span><br>
<span class="lineno"></span><span class="op" id="4423205">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
