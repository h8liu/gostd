<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5384662">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5384717">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5384771">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5384822">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5384899">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5384929">//</span><br>
<span class="lineno"></span><span class="comment" id="5384932">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5384948">//</span><br>
<span class="lineno">10</span><span class="comment" id="5384951">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5384984">//&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5385018">//</span><br>
<span class="lineno"></span><span class="comment" id="5385021">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5385047">//&nbsp;&nbsp;&nbsp;&nbsp;offsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5385132">//&nbsp;&nbsp;&nbsp;&nbsp;offsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5385223">//</span><br>
<span class="lineno"></span><span class="keyword" id="5385226">package</span>&nbsp;<span class="ident" id="5385234">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5385247">import</span>&nbsp;<span class="op" id="5385254">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5385257">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5385266">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5385285">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5385291">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5385301">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5385308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5385311">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5385373">type</span>&nbsp;<span class="ident" id="5385378">Index</span>&nbsp;<span class="keyword" id="5385384">struct</span>&nbsp;<span class="op" id="5385391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385394">data</span>&nbsp;<span class="op" id="5385399">[</span><span class="op" id="5385400">]</span><span class="builtintype" id="5385401">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385407">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5385412">[</span><span class="op" id="5385413">]</span><span class="builtintype" id="5385414">int</span>&nbsp;<span class="comment" id="5385418">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5385465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5385468">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5385505">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5385562">func</span>&nbsp;<span class="ident" id="5385567">New</span><span class="op" id="5385570">(</span><span class="ident" id="5385571">data</span>&nbsp;<span class="op" id="5385576">[</span><span class="op" id="5385577">]</span><span class="builtintype" id="5385578">byte</span><span class="op" id="5385582">)</span>&nbsp;<span class="op" id="5385584">*</span><span class="ident" id="5385585">Index</span>&nbsp;<span class="op" id="5385591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385594">return</span>&nbsp;<span class="op" id="5385601">&amp;</span><span class="ident" id="5385602">Index</span><span class="op" id="5385607">{</span><span class="ident" id="5385608">data</span><span class="op" id="5385612">,</span>&nbsp;<span class="ident" id="5385614">qsufsort</span><span class="op" id="5385622">(</span><span class="ident" id="5385623">data</span><span class="op" id="5385627">)</span><span class="op" id="5385628">}</span><br>
<span class="lineno"></span><span class="op" id="5385630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5385633">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5385697">func</span>&nbsp;<span class="ident" id="5385702">writeInt</span><span class="op" id="5385710">(</span><span class="ident" id="5385711">w</span>&nbsp;<span class="ident" id="5385713">io</span><span class="op" id="5385715">.</span><span class="ident" id="5385716">Writer</span><span class="op" id="5385722">,</span>&nbsp;<span class="ident" id="5385724">buf</span>&nbsp;<span class="op" id="5385728">[</span><span class="op" id="5385729">]</span><span class="builtintype" id="5385730">byte</span><span class="op" id="5385734">,</span>&nbsp;<span class="ident" id="5385736">x</span>&nbsp;<span class="builtintype" id="5385738">int</span><span class="op" id="5385741">)</span>&nbsp;<span class="builtintype" id="5385743">error</span>&nbsp;<span class="op" id="5385749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385752">binary</span><span class="op" id="5385758">.</span><span class="ident" id="5385759">PutVarint</span><span class="op" id="5385768">(</span><span class="ident" id="5385769">buf</span><span class="op" id="5385772">,</span>&nbsp;<span class="ident" id="5385774">int64</span><span class="op" id="5385779">(</span><span class="ident" id="5385780">x</span><span class="op" id="5385781">)</span><span class="op" id="5385782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385785">_</span><span class="op" id="5385786">,</span>&nbsp;<span class="ident" id="5385788">err</span>&nbsp;<span class="op" id="5385792">:=</span>&nbsp;<span class="ident" id="5385795">w</span><span class="op" id="5385796">.</span><span class="ident" id="5385797">Write</span><span class="op" id="5385802">(</span><span class="ident" id="5385803">buf</span><span class="op" id="5385806">[</span><span class="num" id="5385807">0</span><span class="op" id="5385808">:</span><span class="ident" id="5385809">binary</span><span class="op" id="5385815">.</span><span class="ident" id="5385816">MaxVarintLen64</span><span class="op" id="5385830">]</span><span class="op" id="5385831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5385834">return</span>&nbsp;<span class="ident" id="5385841">err</span><br>
<span class="lineno"></span><span class="op" id="5385845">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5385848">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5385925">func</span>&nbsp;<span class="ident" id="5385930">readInt</span><span class="op" id="5385937">(</span><span class="ident" id="5385938">r</span>&nbsp;<span class="ident" id="5385940">io</span><span class="op" id="5385942">.</span><span class="ident" id="5385943">Reader</span><span class="op" id="5385949">,</span>&nbsp;<span class="ident" id="5385951">buf</span>&nbsp;<span class="op" id="5385955">[</span><span class="op" id="5385956">]</span><span class="builtintype" id="5385957">byte</span><span class="op" id="5385961">)</span>&nbsp;<span class="op" id="5385963">(</span><span class="builtintype" id="5385964">int</span><span class="op" id="5385967">,</span>&nbsp;<span class="builtintype" id="5385969">error</span><span class="op" id="5385974">)</span>&nbsp;<span class="op" id="5385976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5385979">_</span><span class="op" id="5385980">,</span>&nbsp;<span class="ident" id="5385982">err</span>&nbsp;<span class="op" id="5385986">:=</span>&nbsp;<span class="ident" id="5385989">io</span><span class="op" id="5385991">.</span><span class="ident" id="5385992">ReadFull</span><span class="op" id="5386000">(</span><span class="ident" id="5386001">r</span><span class="op" id="5386002">,</span>&nbsp;<span class="ident" id="5386004">buf</span><span class="op" id="5386007">[</span><span class="num" id="5386008">0</span><span class="op" id="5386009">:</span><span class="ident" id="5386010">binary</span><span class="op" id="5386016">.</span><span class="ident" id="5386017">MaxVarintLen64</span><span class="op" id="5386031">]</span><span class="op" id="5386032">)</span>&nbsp;<span class="comment" id="5386034">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386064">x</span><span class="op" id="5386065">,</span>&nbsp;<span class="ident" id="5386067">_</span>&nbsp;<span class="op" id="5386069">:=</span>&nbsp;<span class="ident" id="5386072">binary</span><span class="op" id="5386078">.</span><span class="ident" id="5386079">Varint</span><span class="op" id="5386085">(</span><span class="ident" id="5386086">buf</span><span class="op" id="5386089">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386092">return</span>&nbsp;<span class="builtintype" id="5386099">int</span><span class="op" id="5386102">(</span><span class="ident" id="5386103">x</span><span class="op" id="5386104">)</span><span class="op" id="5386105">,</span>&nbsp;<span class="ident" id="5386107">err</span><br>
<span class="lineno"></span><span class="op" id="5386111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5386114">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5386164">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5386200">func</span>&nbsp;<span class="ident" id="5386205">writeSlice</span><span class="op" id="5386215">(</span><span class="ident" id="5386216">w</span>&nbsp;<span class="ident" id="5386218">io</span><span class="op" id="5386220">.</span><span class="ident" id="5386221">Writer</span><span class="op" id="5386227">,</span>&nbsp;<span class="ident" id="5386229">buf</span>&nbsp;<span class="op" id="5386233">[</span><span class="op" id="5386234">]</span><span class="builtintype" id="5386235">byte</span><span class="op" id="5386239">,</span>&nbsp;<span class="ident" id="5386241">data</span>&nbsp;<span class="op" id="5386246">[</span><span class="op" id="5386247">]</span><span class="builtintype" id="5386248">int</span><span class="op" id="5386251">)</span>&nbsp;<span class="op" id="5386253">(</span><span class="ident" id="5386254">n</span>&nbsp;<span class="builtintype" id="5386256">int</span><span class="op" id="5386259">,</span>&nbsp;<span class="ident" id="5386261">err</span>&nbsp;<span class="builtintype" id="5386265">error</span><span class="op" id="5386270">)</span>&nbsp;<span class="op" id="5386272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386275">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386319">p</span>&nbsp;<span class="op" id="5386321">:=</span>&nbsp;<span class="ident" id="5386324">binary</span><span class="op" id="5386330">.</span><span class="ident" id="5386331">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386347">for</span>&nbsp;<span class="op" id="5386351">;</span>&nbsp;<span class="ident" id="5386353">n</span>&nbsp;<span class="op" id="5386355">&lt;</span>&nbsp;<span class="builtinfunc" id="5386357">len</span><span class="op" id="5386360">(</span><span class="ident" id="5386361">data</span><span class="op" id="5386365">)</span>&nbsp;<span class="op" id="5386367">&amp;&amp;</span>&nbsp;<span class="ident" id="5386370">p</span><span class="op" id="5386371">+</span><span class="ident" id="5386372">binary</span><span class="op" id="5386378">.</span><span class="ident" id="5386379">MaxVarintLen64</span>&nbsp;<span class="op" id="5386394">&lt;=</span>&nbsp;<span class="builtinfunc" id="5386397">len</span><span class="op" id="5386400">(</span><span class="ident" id="5386401">buf</span><span class="op" id="5386404">)</span><span class="op" id="5386405">;</span>&nbsp;<span class="ident" id="5386407">n</span><span class="op" id="5386408">++</span>&nbsp;<span class="op" id="5386411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386415">p</span>&nbsp;<span class="op" id="5386417">+=</span>&nbsp;<span class="ident" id="5386420">binary</span><span class="op" id="5386426">.</span><span class="ident" id="5386427">PutUvarint</span><span class="op" id="5386437">(</span><span class="ident" id="5386438">buf</span><span class="op" id="5386441">[</span><span class="ident" id="5386442">p</span><span class="op" id="5386443">:</span><span class="op" id="5386444">]</span><span class="op" id="5386445">,</span>&nbsp;<span class="ident" id="5386447">uint64</span><span class="op" id="5386453">(</span><span class="ident" id="5386454">data</span><span class="op" id="5386458">[</span><span class="ident" id="5386459">n</span><span class="op" id="5386460">]</span><span class="op" id="5386461">)</span><span class="op" id="5386462">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5386465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386469">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386492">binary</span><span class="op" id="5386498">.</span><span class="ident" id="5386499">PutVarint</span><span class="op" id="5386508">(</span><span class="ident" id="5386509">buf</span><span class="op" id="5386512">,</span>&nbsp;<span class="ident" id="5386514">int64</span><span class="op" id="5386519">(</span><span class="ident" id="5386520">p</span><span class="op" id="5386521">)</span><span class="op" id="5386522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386526">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386543">_</span><span class="op" id="5386544">,</span>&nbsp;<span class="ident" id="5386546">err</span>&nbsp;<span class="op" id="5386550">=</span>&nbsp;<span class="ident" id="5386552">w</span><span class="op" id="5386553">.</span><span class="ident" id="5386554">Write</span><span class="op" id="5386559">(</span><span class="ident" id="5386560">buf</span><span class="op" id="5386563">[</span><span class="num" id="5386564">0</span><span class="op" id="5386565">:</span><span class="ident" id="5386566">p</span><span class="op" id="5386567">]</span><span class="op" id="5386568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386571">return</span><br>
<span class="lineno"></span><span class="op" id="5386578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5386581">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5386631">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5386666">func</span>&nbsp;<span class="ident" id="5386671">readSlice</span><span class="op" id="5386680">(</span><span class="ident" id="5386681">r</span>&nbsp;<span class="ident" id="5386683">io</span><span class="op" id="5386685">.</span><span class="ident" id="5386686">Reader</span><span class="op" id="5386692">,</span>&nbsp;<span class="ident" id="5386694">buf</span>&nbsp;<span class="op" id="5386698">[</span><span class="op" id="5386699">]</span><span class="builtintype" id="5386700">byte</span><span class="op" id="5386704">,</span>&nbsp;<span class="ident" id="5386706">data</span>&nbsp;<span class="op" id="5386711">[</span><span class="op" id="5386712">]</span><span class="builtintype" id="5386713">int</span><span class="op" id="5386716">)</span>&nbsp;<span class="op" id="5386718">(</span><span class="ident" id="5386719">n</span>&nbsp;<span class="builtintype" id="5386721">int</span><span class="op" id="5386724">,</span>&nbsp;<span class="ident" id="5386726">err</span>&nbsp;<span class="builtintype" id="5386730">error</span><span class="op" id="5386735">)</span>&nbsp;<span class="op" id="5386737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386740">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386761">var</span>&nbsp;<span class="ident" id="5386765">size</span>&nbsp;<span class="builtintype" id="5386770">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5386775">size</span><span class="op" id="5386779">,</span>&nbsp;<span class="ident" id="5386781">err</span>&nbsp;<span class="op" id="5386785">=</span>&nbsp;<span class="ident" id="5386787">readInt</span><span class="op" id="5386794">(</span><span class="ident" id="5386795">r</span><span class="op" id="5386796">,</span>&nbsp;<span class="ident" id="5386798">buf</span><span class="op" id="5386801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386804">if</span>&nbsp;<span class="ident" id="5386807">err</span>&nbsp;<span class="op" id="5386811">!=</span>&nbsp;<span class="builtintype" id="5386814">nil</span>&nbsp;<span class="op" id="5386818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386822">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5386830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386834">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386863">if</span>&nbsp;<span class="ident" id="5386866">_</span><span class="op" id="5386867">,</span>&nbsp;<span class="ident" id="5386869">err</span>&nbsp;<span class="op" id="5386873">=</span>&nbsp;<span class="ident" id="5386875">io</span><span class="op" id="5386877">.</span><span class="ident" id="5386878">ReadFull</span><span class="op" id="5386886">(</span><span class="ident" id="5386887">r</span><span class="op" id="5386888">,</span>&nbsp;<span class="ident" id="5386890">buf</span><span class="op" id="5386893">[</span><span class="ident" id="5386894">binary</span><span class="op" id="5386900">.</span><span class="ident" id="5386901">MaxVarintLen64</span><span class="op" id="5386915">:</span><span class="ident" id="5386916">size</span><span class="op" id="5386920">]</span><span class="op" id="5386921">)</span><span class="op" id="5386922">;</span>&nbsp;<span class="ident" id="5386924">err</span>&nbsp;<span class="op" id="5386928">!=</span>&nbsp;<span class="builtintype" id="5386931">nil</span>&nbsp;<span class="op" id="5386935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386939">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5386947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5386951">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5386997">for</span>&nbsp;<span class="ident" id="5387001">p</span>&nbsp;<span class="op" id="5387003">:=</span>&nbsp;<span class="ident" id="5387006">binary</span><span class="op" id="5387012">.</span><span class="ident" id="5387013">MaxVarintLen64</span><span class="op" id="5387027">;</span>&nbsp;<span class="ident" id="5387029">p</span>&nbsp;<span class="op" id="5387031">&lt;</span>&nbsp;<span class="ident" id="5387033">size</span><span class="op" id="5387037">;</span>&nbsp;<span class="ident" id="5387039">n</span><span class="op" id="5387040">++</span>&nbsp;<span class="op" id="5387043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387047">x</span><span class="op" id="5387048">,</span>&nbsp;<span class="ident" id="5387050">w</span>&nbsp;<span class="op" id="5387052">:=</span>&nbsp;<span class="ident" id="5387055">binary</span><span class="op" id="5387061">.</span><span class="ident" id="5387062">Uvarint</span><span class="op" id="5387069">(</span><span class="ident" id="5387070">buf</span><span class="op" id="5387073">[</span><span class="ident" id="5387074">p</span><span class="op" id="5387075">:</span><span class="op" id="5387076">]</span><span class="op" id="5387077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387081">data</span><span class="op" id="5387085">[</span><span class="ident" id="5387086">n</span><span class="op" id="5387087">]</span>&nbsp;<span class="op" id="5387089">=</span>&nbsp;<span class="builtintype" id="5387091">int</span><span class="op" id="5387094">(</span><span class="ident" id="5387095">x</span><span class="op" id="5387096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387100">p</span>&nbsp;<span class="op" id="5387102">+=</span>&nbsp;<span class="ident" id="5387105">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387112">return</span><br>
<span class="lineno"></span><span class="op" id="5387119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5387122">const</span>&nbsp;<span class="ident" id="5387128">bufSize</span>&nbsp;<span class="op" id="5387136">=</span>&nbsp;<span class="num" id="5387138">16</span>&nbsp;<span class="op" id="5387141">&lt;&lt;</span>&nbsp;<span class="num" id="5387144">10</span>&nbsp;<span class="comment" id="5387147">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5387187">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5387245">func</span>&nbsp;<span class="op" id="5387250">(</span><span class="ident" id="5387251">x</span>&nbsp;<span class="op" id="5387253">*</span><span class="ident" id="5387254">Index</span><span class="op" id="5387259">)</span>&nbsp;<span class="ident" id="5387261">Read</span><span class="op" id="5387265">(</span><span class="ident" id="5387266">r</span>&nbsp;<span class="ident" id="5387268">io</span><span class="op" id="5387270">.</span><span class="ident" id="5387271">Reader</span><span class="op" id="5387277">)</span>&nbsp;<span class="builtintype" id="5387279">error</span>&nbsp;<span class="op" id="5387285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387288">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387313">buf</span>&nbsp;<span class="op" id="5387317">:=</span>&nbsp;<span class="builtinfunc" id="5387320">make</span><span class="op" id="5387324">(</span><span class="op" id="5387325">[</span><span class="op" id="5387326">]</span><span class="builtintype" id="5387327">byte</span><span class="op" id="5387331">,</span>&nbsp;<span class="ident" id="5387333">bufSize</span><span class="op" id="5387340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387344">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387360">n</span><span class="op" id="5387361">,</span>&nbsp;<span class="ident" id="5387363">err</span>&nbsp;<span class="op" id="5387367">:=</span>&nbsp;<span class="ident" id="5387370">readInt</span><span class="op" id="5387377">(</span><span class="ident" id="5387378">r</span><span class="op" id="5387379">,</span>&nbsp;<span class="ident" id="5387381">buf</span><span class="op" id="5387384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387387">if</span>&nbsp;<span class="ident" id="5387390">err</span>&nbsp;<span class="op" id="5387394">!=</span>&nbsp;<span class="builtintype" id="5387397">nil</span>&nbsp;<span class="op" id="5387401">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387405">return</span>&nbsp;<span class="ident" id="5387412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387421">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387440">if</span>&nbsp;<span class="num" id="5387443">2</span><span class="op" id="5387444">*</span><span class="ident" id="5387445">n</span>&nbsp;<span class="op" id="5387447">&lt;</span>&nbsp;<span class="builtinfunc" id="5387449">cap</span><span class="op" id="5387452">(</span><span class="ident" id="5387453">x</span><span class="op" id="5387454">.</span><span class="ident" id="5387455">data</span><span class="op" id="5387459">)</span>&nbsp;<span class="op" id="5387461">||</span>&nbsp;<span class="builtinfunc" id="5387464">cap</span><span class="op" id="5387467">(</span><span class="ident" id="5387468">x</span><span class="op" id="5387469">.</span><span class="ident" id="5387470">data</span><span class="op" id="5387474">)</span>&nbsp;<span class="op" id="5387476">&lt;</span>&nbsp;<span class="ident" id="5387478">n</span>&nbsp;<span class="op" id="5387480">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387484">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387538">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387580">x</span><span class="op" id="5387581">.</span><span class="ident" id="5387582">data</span>&nbsp;<span class="op" id="5387587">=</span>&nbsp;<span class="builtinfunc" id="5387589">make</span><span class="op" id="5387593">(</span><span class="op" id="5387594">[</span><span class="op" id="5387595">]</span><span class="builtintype" id="5387596">byte</span><span class="op" id="5387600">,</span>&nbsp;<span class="ident" id="5387602">n</span><span class="op" id="5387603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387607">x</span><span class="op" id="5387608">.</span><span class="ident" id="5387609">sa</span>&nbsp;<span class="op" id="5387612">=</span>&nbsp;<span class="builtinfunc" id="5387614">make</span><span class="op" id="5387618">(</span><span class="op" id="5387619">[</span><span class="op" id="5387620">]</span><span class="builtintype" id="5387621">int</span><span class="op" id="5387624">,</span>&nbsp;<span class="ident" id="5387626">n</span><span class="op" id="5387627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387630">}</span>&nbsp;<span class="keyword" id="5387632">else</span>&nbsp;<span class="op" id="5387637">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387641">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387670">x</span><span class="op" id="5387671">.</span><span class="ident" id="5387672">data</span>&nbsp;<span class="op" id="5387677">=</span>&nbsp;<span class="ident" id="5387679">x</span><span class="op" id="5387680">.</span><span class="ident" id="5387681">data</span><span class="op" id="5387685">[</span><span class="num" id="5387686">0</span><span class="op" id="5387687">:</span><span class="ident" id="5387688">n</span><span class="op" id="5387689">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387693">x</span><span class="op" id="5387694">.</span><span class="ident" id="5387695">sa</span>&nbsp;<span class="op" id="5387698">=</span>&nbsp;<span class="ident" id="5387700">x</span><span class="op" id="5387701">.</span><span class="ident" id="5387702">sa</span><span class="op" id="5387704">[</span><span class="num" id="5387705">0</span><span class="op" id="5387706">:</span><span class="ident" id="5387707">n</span><span class="op" id="5387708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387715">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387729">if</span>&nbsp;<span class="ident" id="5387732">_</span><span class="op" id="5387733">,</span>&nbsp;<span class="ident" id="5387735">err</span>&nbsp;<span class="op" id="5387739">:=</span>&nbsp;<span class="ident" id="5387742">io</span><span class="op" id="5387744">.</span><span class="ident" id="5387745">ReadFull</span><span class="op" id="5387753">(</span><span class="ident" id="5387754">r</span><span class="op" id="5387755">,</span>&nbsp;<span class="ident" id="5387757">x</span><span class="op" id="5387758">.</span><span class="ident" id="5387759">data</span><span class="op" id="5387763">)</span><span class="op" id="5387764">;</span>&nbsp;<span class="ident" id="5387766">err</span>&nbsp;<span class="op" id="5387770">!=</span>&nbsp;<span class="builtintype" id="5387773">nil</span>&nbsp;<span class="op" id="5387777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387781">return</span>&nbsp;<span class="ident" id="5387788">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5387797">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387812">for</span>&nbsp;<span class="ident" id="5387816">sa</span>&nbsp;<span class="op" id="5387819">:=</span>&nbsp;<span class="ident" id="5387822">x</span><span class="op" id="5387823">.</span><span class="ident" id="5387824">sa</span><span class="op" id="5387826">;</span>&nbsp;<span class="builtinfunc" id="5387828">len</span><span class="op" id="5387831">(</span><span class="ident" id="5387832">sa</span><span class="op" id="5387834">)</span>&nbsp;<span class="op" id="5387836">&gt;</span>&nbsp;<span class="num" id="5387838">0</span><span class="op" id="5387839">;</span>&nbsp;<span class="op" id="5387841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387845">n</span><span class="op" id="5387846">,</span>&nbsp;<span class="ident" id="5387848">err</span>&nbsp;<span class="op" id="5387852">:=</span>&nbsp;<span class="ident" id="5387855">readSlice</span><span class="op" id="5387864">(</span><span class="ident" id="5387865">r</span><span class="op" id="5387866">,</span>&nbsp;<span class="ident" id="5387868">buf</span><span class="op" id="5387871">,</span>&nbsp;<span class="ident" id="5387873">sa</span><span class="op" id="5387875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387879">if</span>&nbsp;<span class="ident" id="5387882">err</span>&nbsp;<span class="op" id="5387886">!=</span>&nbsp;<span class="builtintype" id="5387889">nil</span>&nbsp;<span class="op" id="5387893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387898">return</span>&nbsp;<span class="ident" id="5387905">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5387915">sa</span>&nbsp;<span class="op" id="5387918">=</span>&nbsp;<span class="ident" id="5387920">sa</span><span class="op" id="5387922">[</span><span class="ident" id="5387923">n</span><span class="op" id="5387924">:</span><span class="op" id="5387925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5387928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5387931">return</span>&nbsp;<span class="builtintype" id="5387938">nil</span><br>
<span class="lineno"></span><span class="op" id="5387942">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5387945">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5387979">func</span>&nbsp;<span class="op" id="5387984">(</span><span class="ident" id="5387985">x</span>&nbsp;<span class="op" id="5387987">*</span><span class="ident" id="5387988">Index</span><span class="op" id="5387993">)</span>&nbsp;<span class="ident" id="5387995">Write</span><span class="op" id="5388000">(</span><span class="ident" id="5388001">w</span>&nbsp;<span class="ident" id="5388003">io</span><span class="op" id="5388005">.</span><span class="ident" id="5388006">Writer</span><span class="op" id="5388012">)</span>&nbsp;<span class="builtintype" id="5388014">error</span>&nbsp;<span class="op" id="5388020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388023">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5388049">buf</span>&nbsp;<span class="op" id="5388053">:=</span>&nbsp;<span class="builtinfunc" id="5388056">make</span><span class="op" id="5388060">(</span><span class="op" id="5388061">[</span><span class="op" id="5388062">]</span><span class="builtintype" id="5388063">byte</span><span class="op" id="5388067">,</span>&nbsp;<span class="ident" id="5388069">bufSize</span><span class="op" id="5388076">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388080">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388097">if</span>&nbsp;<span class="ident" id="5388100">err</span>&nbsp;<span class="op" id="5388104">:=</span>&nbsp;<span class="ident" id="5388107">writeInt</span><span class="op" id="5388115">(</span><span class="ident" id="5388116">w</span><span class="op" id="5388117">,</span>&nbsp;<span class="ident" id="5388119">buf</span><span class="op" id="5388122">,</span>&nbsp;<span class="builtinfunc" id="5388124">len</span><span class="op" id="5388127">(</span><span class="ident" id="5388128">x</span><span class="op" id="5388129">.</span><span class="ident" id="5388130">data</span><span class="op" id="5388134">)</span><span class="op" id="5388135">)</span><span class="op" id="5388136">;</span>&nbsp;<span class="ident" id="5388138">err</span>&nbsp;<span class="op" id="5388142">!=</span>&nbsp;<span class="builtintype" id="5388145">nil</span>&nbsp;<span class="op" id="5388149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388153">return</span>&nbsp;<span class="ident" id="5388160">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388165">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388169">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388184">if</span>&nbsp;<span class="ident" id="5388187">_</span><span class="op" id="5388188">,</span>&nbsp;<span class="ident" id="5388190">err</span>&nbsp;<span class="op" id="5388194">:=</span>&nbsp;<span class="ident" id="5388197">w</span><span class="op" id="5388198">.</span><span class="ident" id="5388199">Write</span><span class="op" id="5388204">(</span><span class="ident" id="5388205">x</span><span class="op" id="5388206">.</span><span class="ident" id="5388207">data</span><span class="op" id="5388211">)</span><span class="op" id="5388212">;</span>&nbsp;<span class="ident" id="5388214">err</span>&nbsp;<span class="op" id="5388218">!=</span>&nbsp;<span class="builtintype" id="5388221">nil</span>&nbsp;<span class="op" id="5388225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388229">return</span>&nbsp;<span class="ident" id="5388236">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388241">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388245">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388261">for</span>&nbsp;<span class="ident" id="5388265">sa</span>&nbsp;<span class="op" id="5388268">:=</span>&nbsp;<span class="ident" id="5388271">x</span><span class="op" id="5388272">.</span><span class="ident" id="5388273">sa</span><span class="op" id="5388275">;</span>&nbsp;<span class="builtinfunc" id="5388277">len</span><span class="op" id="5388280">(</span><span class="ident" id="5388281">sa</span><span class="op" id="5388283">)</span>&nbsp;<span class="op" id="5388285">&gt;</span>&nbsp;<span class="num" id="5388287">0</span><span class="op" id="5388288">;</span>&nbsp;<span class="op" id="5388290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5388294">n</span><span class="op" id="5388295">,</span>&nbsp;<span class="ident" id="5388297">err</span>&nbsp;<span class="op" id="5388301">:=</span>&nbsp;<span class="ident" id="5388304">writeSlice</span><span class="op" id="5388314">(</span><span class="ident" id="5388315">w</span><span class="op" id="5388316">,</span>&nbsp;<span class="ident" id="5388318">buf</span><span class="op" id="5388321">,</span>&nbsp;<span class="ident" id="5388323">sa</span><span class="op" id="5388325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388329">if</span>&nbsp;<span class="ident" id="5388332">err</span>&nbsp;<span class="op" id="5388336">!=</span>&nbsp;<span class="builtintype" id="5388339">nil</span>&nbsp;<span class="op" id="5388343">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388348">return</span>&nbsp;<span class="ident" id="5388355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5388365">sa</span>&nbsp;<span class="op" id="5388368">=</span>&nbsp;<span class="ident" id="5388370">sa</span><span class="op" id="5388372">[</span><span class="ident" id="5388373">n</span><span class="op" id="5388374">:</span><span class="op" id="5388375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5388378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388381">return</span>&nbsp;<span class="builtintype" id="5388388">nil</span><br>
<span class="lineno">160</span><span class="op" id="5388392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5388395">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5388455">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5388483">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5388486">func</span>&nbsp;<span class="op" id="5388491">(</span><span class="ident" id="5388492">x</span>&nbsp;<span class="op" id="5388494">*</span><span class="ident" id="5388495">Index</span><span class="op" id="5388500">)</span>&nbsp;<span class="ident" id="5388502">Bytes</span><span class="op" id="5388507">(</span><span class="op" id="5388508">)</span>&nbsp;<span class="op" id="5388510">[</span><span class="op" id="5388511">]</span><span class="builtintype" id="5388512">byte</span>&nbsp;<span class="op" id="5388517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388520">return</span>&nbsp;<span class="ident" id="5388527">x</span><span class="op" id="5388528">.</span><span class="ident" id="5388529">data</span><br>
<span class="lineno"></span><span class="op" id="5388534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5388537">func</span>&nbsp;<span class="op" id="5388542">(</span><span class="ident" id="5388543">x</span>&nbsp;<span class="op" id="5388545">*</span><span class="ident" id="5388546">Index</span><span class="op" id="5388551">)</span>&nbsp;<span class="ident" id="5388553">at</span><span class="op" id="5388555">(</span><span class="ident" id="5388556">i</span>&nbsp;<span class="builtintype" id="5388558">int</span><span class="op" id="5388561">)</span>&nbsp;<span class="op" id="5388563">[</span><span class="op" id="5388564">]</span><span class="builtintype" id="5388565">byte</span>&nbsp;<span class="op" id="5388570">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5388573">return</span>&nbsp;<span class="ident" id="5388580">x</span><span class="op" id="5388581">.</span><span class="ident" id="5388582">data</span><span class="op" id="5388586">[</span><span class="ident" id="5388587">x</span><span class="op" id="5388588">.</span><span class="ident" id="5388589">sa</span><span class="op" id="5388591">[</span><span class="ident" id="5388592">i</span><span class="op" id="5388593">]</span><span class="op" id="5388594">:</span><span class="op" id="5388595">]</span><br>
<span class="lineno"></span><span class="op" id="5388597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5388600">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5388668">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5388704">func</span>&nbsp;<span class="op" id="5388709">(</span><span class="ident" id="5388710">x</span>&nbsp;<span class="op" id="5388712">*</span><span class="ident" id="5388713">Index</span><span class="op" id="5388718">)</span>&nbsp;<span class="ident" id="5388720">lookupAll</span><span class="op" id="5388729">(</span><span class="ident" id="5388730">s</span>&nbsp;<span class="op" id="5388732">[</span><span class="op" id="5388733">]</span><span class="builtintype" id="5388734">byte</span><span class="op" id="5388738">)</span>&nbsp;<span class="op" id="5388740">[</span><span class="op" id="5388741">]</span><span class="builtintype" id="5388742">int</span>&nbsp;<span class="op" id="5388746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388749">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388792">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5388845">i</span>&nbsp;<span class="op" id="5388847">:=</span>&nbsp;<span class="ident" id="5388850">sort</span><span class="op" id="5388854">.</span><span class="ident" id="5388855">Search</span><span class="op" id="5388861">(</span><span class="builtinfunc" id="5388862">len</span><span class="op" id="5388865">(</span><span class="ident" id="5388866">x</span><span class="op" id="5388867">.</span><span class="ident" id="5388868">sa</span><span class="op" id="5388870">)</span><span class="op" id="5388871">,</span>&nbsp;<span class="keyword" id="5388873">func</span><span class="op" id="5388877">(</span><span class="ident" id="5388878">i</span>&nbsp;<span class="builtintype" id="5388880">int</span><span class="op" id="5388883">)</span>&nbsp;<span class="builtintype" id="5388885">bool</span>&nbsp;<span class="op" id="5388890">{</span>&nbsp;<span class="keyword" id="5388892">return</span>&nbsp;<span class="ident" id="5388899">bytes</span><span class="op" id="5388904">.</span><span class="ident" id="5388905">Compare</span><span class="op" id="5388912">(</span><span class="ident" id="5388913">x</span><span class="op" id="5388914">.</span><span class="ident" id="5388915">at</span><span class="op" id="5388917">(</span><span class="ident" id="5388918">i</span><span class="op" id="5388919">)</span><span class="op" id="5388920">,</span>&nbsp;<span class="ident" id="5388922">s</span><span class="op" id="5388923">)</span>&nbsp;<span class="op" id="5388925">&gt;=</span>&nbsp;<span class="num" id="5388928">0</span>&nbsp;<span class="op" id="5388930">}</span><span class="op" id="5388931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5388934">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5389001">j</span>&nbsp;<span class="op" id="5389003">:=</span>&nbsp;<span class="ident" id="5389006">i</span>&nbsp;<span class="op" id="5389008">+</span>&nbsp;<span class="ident" id="5389010">sort</span><span class="op" id="5389014">.</span><span class="ident" id="5389015">Search</span><span class="op" id="5389021">(</span><span class="builtinfunc" id="5389022">len</span><span class="op" id="5389025">(</span><span class="ident" id="5389026">x</span><span class="op" id="5389027">.</span><span class="ident" id="5389028">sa</span><span class="op" id="5389030">)</span><span class="op" id="5389031">-</span><span class="ident" id="5389032">i</span><span class="op" id="5389033">,</span>&nbsp;<span class="keyword" id="5389035">func</span><span class="op" id="5389039">(</span><span class="ident" id="5389040">j</span>&nbsp;<span class="builtintype" id="5389042">int</span><span class="op" id="5389045">)</span>&nbsp;<span class="builtintype" id="5389047">bool</span>&nbsp;<span class="op" id="5389052">{</span>&nbsp;<span class="keyword" id="5389054">return</span>&nbsp;<span class="op" id="5389061">!</span><span class="ident" id="5389062">bytes</span><span class="op" id="5389067">.</span><span class="ident" id="5389068">HasPrefix</span><span class="op" id="5389077">(</span><span class="ident" id="5389078">x</span><span class="op" id="5389079">.</span><span class="ident" id="5389080">at</span><span class="op" id="5389082">(</span><span class="ident" id="5389083">j</span><span class="op" id="5389084">+</span><span class="ident" id="5389085">i</span><span class="op" id="5389086">)</span><span class="op" id="5389087">,</span>&nbsp;<span class="ident" id="5389089">s</span><span class="op" id="5389090">)</span>&nbsp;<span class="op" id="5389092">}</span><span class="op" id="5389093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5389096">return</span>&nbsp;<span class="ident" id="5389103">x</span><span class="op" id="5389104">.</span><span class="ident" id="5389105">sa</span><span class="op" id="5389107">[</span><span class="ident" id="5389108">i</span><span class="op" id="5389109">:</span><span class="ident" id="5389110">j</span><span class="op" id="5389111">]</span><br>
<span class="lineno"></span><span class="op" id="5389113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5389116">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5389196">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5389267">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5389330">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5389394">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5389423">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5389426">func</span>&nbsp;<span class="op" id="5389431">(</span><span class="ident" id="5389432">x</span>&nbsp;<span class="op" id="5389434">*</span><span class="ident" id="5389435">Index</span><span class="op" id="5389440">)</span>&nbsp;<span class="ident" id="5389442">Lookup</span><span class="op" id="5389448">(</span><span class="ident" id="5389449">s</span>&nbsp;<span class="op" id="5389451">[</span><span class="op" id="5389452">]</span><span class="builtintype" id="5389453">byte</span><span class="op" id="5389457">,</span>&nbsp;<span class="ident" id="5389459">n</span>&nbsp;<span class="builtintype" id="5389461">int</span><span class="op" id="5389464">)</span>&nbsp;<span class="op" id="5389466">(</span><span class="ident" id="5389467">result</span>&nbsp;<span class="op" id="5389474">[</span><span class="op" id="5389475">]</span><span class="builtintype" id="5389476">int</span><span class="op" id="5389479">)</span>&nbsp;<span class="op" id="5389481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5389484">if</span>&nbsp;<span class="builtinfunc" id="5389487">len</span><span class="op" id="5389490">(</span><span class="ident" id="5389491">s</span><span class="op" id="5389492">)</span>&nbsp;<span class="op" id="5389494">&gt;</span>&nbsp;<span class="num" id="5389496">0</span>&nbsp;<span class="op" id="5389498">&amp;&amp;</span>&nbsp;<span class="ident" id="5389501">n</span>&nbsp;<span class="op" id="5389503">!=</span>&nbsp;<span class="num" id="5389506">0</span>&nbsp;<span class="op" id="5389508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5389512">matches</span>&nbsp;<span class="op" id="5389520">:=</span>&nbsp;<span class="ident" id="5389523">x</span><span class="op" id="5389524">.</span><span class="ident" id="5389525">lookupAll</span><span class="op" id="5389534">(</span><span class="ident" id="5389535">s</span><span class="op" id="5389536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5389540">if</span>&nbsp;<span class="ident" id="5389543">n</span>&nbsp;<span class="op" id="5389545">&lt;</span>&nbsp;<span class="num" id="5389547">0</span>&nbsp;<span class="op" id="5389549">||</span>&nbsp;<span class="builtinfunc" id="5389552">len</span><span class="op" id="5389555">(</span><span class="ident" id="5389556">matches</span><span class="op" id="5389563">)</span>&nbsp;<span class="op" id="5389565">&lt;</span>&nbsp;<span class="ident" id="5389567">n</span>&nbsp;<span class="op" id="5389569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5389574">n</span>&nbsp;<span class="op" id="5389576">=</span>&nbsp;<span class="builtinfunc" id="5389578">len</span><span class="op" id="5389581">(</span><span class="ident" id="5389582">matches</span><span class="op" id="5389589">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5389593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5389597">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5389625">if</span>&nbsp;<span class="ident" id="5389628">n</span>&nbsp;<span class="op" id="5389630">&gt;</span>&nbsp;<span class="num" id="5389632">0</span>&nbsp;<span class="op" id="5389634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5389639">result</span>&nbsp;<span class="op" id="5389646">=</span>&nbsp;<span class="builtinfunc" id="5389648">make</span><span class="op" id="5389652">(</span><span class="op" id="5389653">[</span><span class="op" id="5389654">]</span><span class="builtintype" id="5389655">int</span><span class="op" id="5389658">,</span>&nbsp;<span class="ident" id="5389660">n</span><span class="op" id="5389661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5389666">copy</span><span class="op" id="5389670">(</span><span class="ident" id="5389671">result</span><span class="op" id="5389677">,</span>&nbsp;<span class="ident" id="5389679">matches</span><span class="op" id="5389686">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5389690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5389693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5389696">return</span><br>
<span class="lineno"></span><span class="op" id="5389703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5389706">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5389778">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5389849">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5389919">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5389989">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5390063">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5390080">//</span><br>
<span class="lineno"></span><span class="keyword" id="5390083">func</span>&nbsp;<span class="op" id="5390088">(</span><span class="ident" id="5390089">x</span>&nbsp;<span class="op" id="5390091">*</span><span class="ident" id="5390092">Index</span><span class="op" id="5390097">)</span>&nbsp;<span class="ident" id="5390099">FindAllIndex</span><span class="op" id="5390111">(</span><span class="ident" id="5390112">r</span>&nbsp;<span class="op" id="5390114">*</span><span class="ident" id="5390115">regexp</span><span class="op" id="5390121">.</span><span class="ident" id="5390122">Regexp</span><span class="op" id="5390128">,</span>&nbsp;<span class="ident" id="5390130">n</span>&nbsp;<span class="builtintype" id="5390132">int</span><span class="op" id="5390135">)</span>&nbsp;<span class="op" id="5390137">(</span><span class="ident" id="5390138">result</span>&nbsp;<span class="op" id="5390145">[</span><span class="op" id="5390146">]</span><span class="op" id="5390147">[</span><span class="op" id="5390148">]</span><span class="builtintype" id="5390149">int</span><span class="op" id="5390152">)</span>&nbsp;<span class="op" id="5390154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390157">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390218">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5390254">prefix</span><span class="op" id="5390260">,</span>&nbsp;<span class="ident" id="5390262">complete</span>&nbsp;<span class="op" id="5390271">:=</span>&nbsp;<span class="ident" id="5390274">r</span><span class="op" id="5390275">.</span><span class="ident" id="5390276">LiteralPrefix</span><span class="op" id="5390289">(</span><span class="op" id="5390290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5390293">lit</span>&nbsp;<span class="op" id="5390297">:=</span>&nbsp;<span class="op" id="5390300">[</span><span class="op" id="5390301">]</span><span class="builtintype" id="5390302">byte</span><span class="op" id="5390306">(</span><span class="ident" id="5390307">prefix</span><span class="op" id="5390313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390317">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5390360">if</span>&nbsp;<span class="ident" id="5390363">prefix</span>&nbsp;<span class="op" id="5390370">==</span>&nbsp;<span class="string" id="5390373">&#34;&#34;</span>&nbsp;<span class="op" id="5390376">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5390380">return</span>&nbsp;<span class="ident" id="5390387">r</span><span class="op" id="5390388">.</span><span class="ident" id="5390389">FindAllIndex</span><span class="op" id="5390401">(</span><span class="ident" id="5390402">x</span><span class="op" id="5390403">.</span><span class="ident" id="5390404">data</span><span class="op" id="5390408">,</span>&nbsp;<span class="ident" id="5390410">n</span><span class="op" id="5390411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5390414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390418">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390477">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5390505">if</span>&nbsp;<span class="ident" id="5390508">complete</span>&nbsp;<span class="op" id="5390517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390521">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390589">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390659">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390724">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390795">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5390864">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5390892">for</span>&nbsp;<span class="ident" id="5390896">n1</span>&nbsp;<span class="op" id="5390899">:=</span>&nbsp;<span class="ident" id="5390902">n</span><span class="op" id="5390903">;</span>&nbsp;<span class="op" id="5390905">;</span>&nbsp;<span class="ident" id="5390907">n1</span>&nbsp;<span class="op" id="5390910">+=</span>&nbsp;<span class="num" id="5390913">2</span>&nbsp;<span class="op" id="5390915">*</span>&nbsp;<span class="op" id="5390917">(</span><span class="ident" id="5390918">n</span>&nbsp;<span class="op" id="5390920">-</span>&nbsp;<span class="builtinfunc" id="5390922">len</span><span class="op" id="5390925">(</span><span class="ident" id="5390926">result</span><span class="op" id="5390932">)</span><span class="op" id="5390933">)</span>&nbsp;<span class="comment" id="5390935">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5390953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5390958">indices</span>&nbsp;<span class="op" id="5390966">:=</span>&nbsp;<span class="ident" id="5390969">x</span><span class="op" id="5390970">.</span><span class="ident" id="5390971">Lookup</span><span class="op" id="5390977">(</span><span class="ident" id="5390978">lit</span><span class="op" id="5390981">,</span>&nbsp;<span class="ident" id="5390983">n1</span><span class="op" id="5390985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5390990">if</span>&nbsp;<span class="builtinfunc" id="5390993">len</span><span class="op" id="5390996">(</span><span class="ident" id="5390997">indices</span><span class="op" id="5391004">)</span>&nbsp;<span class="op" id="5391006">==</span>&nbsp;<span class="num" id="5391009">0</span>&nbsp;<span class="op" id="5391011">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391017">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391032">sort</span><span class="op" id="5391036">.</span><span class="ident" id="5391037">Ints</span><span class="op" id="5391041">(</span><span class="ident" id="5391042">indices</span><span class="op" id="5391049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391054">pairs</span>&nbsp;<span class="op" id="5391060">:=</span>&nbsp;<span class="builtinfunc" id="5391063">make</span><span class="op" id="5391067">(</span><span class="op" id="5391068">[</span><span class="op" id="5391069">]</span><span class="builtintype" id="5391070">int</span><span class="op" id="5391073">,</span>&nbsp;<span class="num" id="5391075">2</span><span class="op" id="5391076">*</span><span class="builtinfunc" id="5391077">len</span><span class="op" id="5391080">(</span><span class="ident" id="5391081">indices</span><span class="op" id="5391088">)</span><span class="op" id="5391089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391094">result</span>&nbsp;<span class="op" id="5391101">=</span>&nbsp;<span class="builtinfunc" id="5391103">make</span><span class="op" id="5391107">(</span><span class="op" id="5391108">[</span><span class="op" id="5391109">]</span><span class="op" id="5391110">[</span><span class="op" id="5391111">]</span><span class="builtintype" id="5391112">int</span><span class="op" id="5391115">,</span>&nbsp;<span class="builtinfunc" id="5391117">len</span><span class="op" id="5391120">(</span><span class="ident" id="5391121">indices</span><span class="op" id="5391128">)</span><span class="op" id="5391129">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391134">count</span>&nbsp;<span class="op" id="5391140">:=</span>&nbsp;<span class="num" id="5391143">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391148">prev</span>&nbsp;<span class="op" id="5391153">:=</span>&nbsp;<span class="num" id="5391156">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391161">for</span>&nbsp;<span class="ident" id="5391165">_</span><span class="op" id="5391166">,</span>&nbsp;<span class="ident" id="5391168">i</span>&nbsp;<span class="op" id="5391170">:=</span>&nbsp;<span class="keyword" id="5391173">range</span>&nbsp;<span class="ident" id="5391179">indices</span>&nbsp;<span class="op" id="5391187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391193">if</span>&nbsp;<span class="ident" id="5391196">count</span>&nbsp;<span class="op" id="5391202">==</span>&nbsp;<span class="ident" id="5391205">n</span>&nbsp;<span class="op" id="5391207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391214">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391230">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391283">if</span>&nbsp;<span class="ident" id="5391286">prev</span>&nbsp;<span class="op" id="5391291">&lt;=</span>&nbsp;<span class="ident" id="5391294">i</span>&nbsp;<span class="op" id="5391296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391303">j</span>&nbsp;<span class="op" id="5391305">:=</span>&nbsp;<span class="num" id="5391308">2</span>&nbsp;<span class="op" id="5391310">*</span>&nbsp;<span class="ident" id="5391312">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391323">pairs</span><span class="op" id="5391328">[</span><span class="ident" id="5391329">j</span><span class="op" id="5391330">+</span><span class="num" id="5391331">0</span><span class="op" id="5391332">]</span>&nbsp;<span class="op" id="5391334">=</span>&nbsp;<span class="ident" id="5391336">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391343">pairs</span><span class="op" id="5391348">[</span><span class="ident" id="5391349">j</span><span class="op" id="5391350">+</span><span class="num" id="5391351">1</span><span class="op" id="5391352">]</span>&nbsp;<span class="op" id="5391354">=</span>&nbsp;<span class="ident" id="5391356">i</span>&nbsp;<span class="op" id="5391358">+</span>&nbsp;<span class="builtinfunc" id="5391360">len</span><span class="op" id="5391363">(</span><span class="ident" id="5391364">lit</span><span class="op" id="5391367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391374">result</span><span class="op" id="5391380">[</span><span class="ident" id="5391381">count</span><span class="op" id="5391386">]</span>&nbsp;<span class="op" id="5391388">=</span>&nbsp;<span class="ident" id="5391390">pairs</span><span class="op" id="5391395">[</span><span class="ident" id="5391396">j</span>&nbsp;<span class="op" id="5391398">:</span>&nbsp;<span class="ident" id="5391400">j</span><span class="op" id="5391401">+</span><span class="num" id="5391402">2</span><span class="op" id="5391403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391410">count</span><span class="op" id="5391415">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391423">prev</span>&nbsp;<span class="op" id="5391428">=</span>&nbsp;<span class="ident" id="5391430">i</span>&nbsp;<span class="op" id="5391432">+</span>&nbsp;<span class="builtinfunc" id="5391434">len</span><span class="op" id="5391437">(</span><span class="ident" id="5391438">lit</span><span class="op" id="5391441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391447">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391457">result</span>&nbsp;<span class="op" id="5391464">=</span>&nbsp;<span class="ident" id="5391466">result</span><span class="op" id="5391472">[</span><span class="num" id="5391473">0</span><span class="op" id="5391474">:</span><span class="ident" id="5391475">count</span><span class="op" id="5391480">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391485">if</span>&nbsp;<span class="builtinfunc" id="5391488">len</span><span class="op" id="5391491">(</span><span class="ident" id="5391492">result</span><span class="op" id="5391498">)</span>&nbsp;<span class="op" id="5391500">&gt;=</span>&nbsp;<span class="ident" id="5391503">n</span>&nbsp;<span class="op" id="5391505">||</span>&nbsp;<span class="builtinfunc" id="5391508">len</span><span class="op" id="5391511">(</span><span class="ident" id="5391512">indices</span><span class="op" id="5391519">)</span>&nbsp;<span class="op" id="5391521">!=</span>&nbsp;<span class="ident" id="5391524">n1</span>&nbsp;<span class="op" id="5391527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391533">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391592">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391643">if</span>&nbsp;<span class="builtinfunc" id="5391646">len</span><span class="op" id="5391649">(</span><span class="ident" id="5391650">result</span><span class="op" id="5391656">)</span>&nbsp;<span class="op" id="5391658">==</span>&nbsp;<span class="num" id="5391661">0</span>&nbsp;<span class="op" id="5391663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391668">result</span>&nbsp;<span class="op" id="5391675">=</span>&nbsp;<span class="builtintype" id="5391677">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5391687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5391695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391699">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391763">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391831">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5391864">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5391931">r</span>&nbsp;<span class="op" id="5391933">=</span>&nbsp;<span class="ident" id="5391935">regexp</span><span class="op" id="5391941">.</span><span class="ident" id="5391942">MustCompile</span><span class="op" id="5391953">(</span><span class="string" id="5391954">&#34;^&#34;</span>&nbsp;<span class="op" id="5391958">+</span>&nbsp;<span class="ident" id="5391960">r</span><span class="op" id="5391961">.</span><span class="ident" id="5391962">String</span><span class="op" id="5391968">(</span><span class="op" id="5391969">)</span><span class="op" id="5391970">)</span>&nbsp;<span class="comment" id="5391972">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5392005">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392069">for</span>&nbsp;<span class="ident" id="5392073">n1</span>&nbsp;<span class="op" id="5392076">:=</span>&nbsp;<span class="ident" id="5392079">n</span><span class="op" id="5392080">;</span>&nbsp;<span class="op" id="5392082">;</span>&nbsp;<span class="ident" id="5392084">n1</span>&nbsp;<span class="op" id="5392087">+=</span>&nbsp;<span class="num" id="5392090">2</span>&nbsp;<span class="op" id="5392092">*</span>&nbsp;<span class="op" id="5392094">(</span><span class="ident" id="5392095">n</span>&nbsp;<span class="op" id="5392097">-</span>&nbsp;<span class="builtinfunc" id="5392099">len</span><span class="op" id="5392102">(</span><span class="ident" id="5392103">result</span><span class="op" id="5392109">)</span><span class="op" id="5392110">)</span>&nbsp;<span class="comment" id="5392112">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5392130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392134">indices</span>&nbsp;<span class="op" id="5392142">:=</span>&nbsp;<span class="ident" id="5392145">x</span><span class="op" id="5392146">.</span><span class="ident" id="5392147">Lookup</span><span class="op" id="5392153">(</span><span class="ident" id="5392154">lit</span><span class="op" id="5392157">,</span>&nbsp;<span class="ident" id="5392159">n1</span><span class="op" id="5392161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392165">if</span>&nbsp;<span class="builtinfunc" id="5392168">len</span><span class="op" id="5392171">(</span><span class="ident" id="5392172">indices</span><span class="op" id="5392179">)</span>&nbsp;<span class="op" id="5392181">==</span>&nbsp;<span class="num" id="5392184">0</span>&nbsp;<span class="op" id="5392186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392191">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392204">sort</span><span class="op" id="5392208">.</span><span class="ident" id="5392209">Ints</span><span class="op" id="5392213">(</span><span class="ident" id="5392214">indices</span><span class="op" id="5392221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392225">result</span>&nbsp;<span class="op" id="5392232">=</span>&nbsp;<span class="ident" id="5392234">result</span><span class="op" id="5392240">[</span><span class="num" id="5392241">0</span><span class="op" id="5392242">:</span><span class="num" id="5392243">0</span><span class="op" id="5392244">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392248">prev</span>&nbsp;<span class="op" id="5392253">:=</span>&nbsp;<span class="num" id="5392256">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392260">for</span>&nbsp;<span class="ident" id="5392264">_</span><span class="op" id="5392265">,</span>&nbsp;<span class="ident" id="5392267">i</span>&nbsp;<span class="op" id="5392269">:=</span>&nbsp;<span class="keyword" id="5392272">range</span>&nbsp;<span class="ident" id="5392278">indices</span>&nbsp;<span class="op" id="5392286">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392291">if</span>&nbsp;<span class="builtinfunc" id="5392294">len</span><span class="op" id="5392297">(</span><span class="ident" id="5392298">result</span><span class="op" id="5392304">)</span>&nbsp;<span class="op" id="5392306">==</span>&nbsp;<span class="ident" id="5392309">n</span>&nbsp;<span class="op" id="5392311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392317">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392331">m</span>&nbsp;<span class="op" id="5392333">:=</span>&nbsp;<span class="ident" id="5392336">r</span><span class="op" id="5392337">.</span><span class="ident" id="5392338">FindIndex</span><span class="op" id="5392347">(</span><span class="ident" id="5392348">x</span><span class="op" id="5392349">.</span><span class="ident" id="5392350">data</span><span class="op" id="5392354">[</span><span class="ident" id="5392355">i</span><span class="op" id="5392356">:</span><span class="op" id="5392357">]</span><span class="op" id="5392358">)</span>&nbsp;<span class="comment" id="5392360">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5392401">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392453">if</span>&nbsp;<span class="ident" id="5392456">m</span>&nbsp;<span class="op" id="5392458">!=</span>&nbsp;<span class="builtintype" id="5392461">nil</span>&nbsp;<span class="op" id="5392465">&amp;&amp;</span>&nbsp;<span class="ident" id="5392468">prev</span>&nbsp;<span class="op" id="5392473">&lt;=</span>&nbsp;<span class="ident" id="5392476">i</span>&nbsp;<span class="op" id="5392478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392484">m</span><span class="op" id="5392485">[</span><span class="num" id="5392486">0</span><span class="op" id="5392487">]</span>&nbsp;<span class="op" id="5392489">=</span>&nbsp;<span class="ident" id="5392491">i</span>&nbsp;<span class="comment" id="5392493">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392510">m</span><span class="op" id="5392511">[</span><span class="num" id="5392512">1</span><span class="op" id="5392513">]</span>&nbsp;<span class="op" id="5392515">+=</span>&nbsp;<span class="ident" id="5392518">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392524">result</span>&nbsp;<span class="op" id="5392531">=</span>&nbsp;<span class="builtinfunc" id="5392533">append</span><span class="op" id="5392539">(</span><span class="ident" id="5392540">result</span><span class="op" id="5392546">,</span>&nbsp;<span class="ident" id="5392548">m</span><span class="op" id="5392549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392555">prev</span>&nbsp;<span class="op" id="5392560">=</span>&nbsp;<span class="ident" id="5392562">m</span><span class="op" id="5392563">[</span><span class="num" id="5392564">1</span><span class="op" id="5392565">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392578">if</span>&nbsp;<span class="builtinfunc" id="5392581">len</span><span class="op" id="5392584">(</span><span class="ident" id="5392585">result</span><span class="op" id="5392591">)</span>&nbsp;<span class="op" id="5392593">&gt;=</span>&nbsp;<span class="ident" id="5392596">n</span>&nbsp;<span class="op" id="5392598">||</span>&nbsp;<span class="builtinfunc" id="5392601">len</span><span class="op" id="5392604">(</span><span class="ident" id="5392605">indices</span><span class="op" id="5392612">)</span>&nbsp;<span class="op" id="5392614">!=</span>&nbsp;<span class="ident" id="5392617">n1</span>&nbsp;<span class="op" id="5392620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5392625">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5392683">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392716">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392730">if</span>&nbsp;<span class="builtinfunc" id="5392733">len</span><span class="op" id="5392736">(</span><span class="ident" id="5392737">result</span><span class="op" id="5392743">)</span>&nbsp;<span class="op" id="5392745">==</span>&nbsp;<span class="num" id="5392748">0</span>&nbsp;<span class="op" id="5392750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5392754">result</span>&nbsp;<span class="op" id="5392761">=</span>&nbsp;<span class="builtintype" id="5392763">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5392771">return</span><br>
<span class="lineno"></span><span class="op" id="5392778">}</span>
</div>
</body>
</html>
