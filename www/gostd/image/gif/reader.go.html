<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5553393">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5553448">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5553502">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5553553">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5553612">//</span><br>
<span class="lineno"></span><span class="comment" id="5553615">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="5553694">package</span>&nbsp;<span class="ident" id="5553702">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5553707">import</span>&nbsp;<span class="op" id="5553714">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553717">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553726">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553742">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553752">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553759">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553768">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5553783">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5553788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5553791">var</span>&nbsp;<span class="op" id="5553795">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553798">errNotEnough</span>&nbsp;<span class="op" id="5553811">=</span>&nbsp;<span class="ident" id="5553813">errors</span><span class="op" id="5553819">.</span><span class="ident" id="5553820">New</span><span class="op" id="5553823">(</span><span class="string" id="5553824">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="5553852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553855">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5553868">=</span>&nbsp;<span class="ident" id="5553870">errors</span><span class="op" id="5553876">.</span><span class="ident" id="5553877">New</span><span class="op" id="5553880">(</span><span class="string" id="5553881">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="5553907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5553910">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="5553923">=</span>&nbsp;<span class="ident" id="5553925">errors</span><span class="op" id="5553931">.</span><span class="ident" id="5553932">New</span><span class="op" id="5553935">(</span><span class="string" id="5553936">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="5553962">)</span><br>
<span class="lineno"></span><span class="op" id="5553964">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5553967">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="5554062">type</span>&nbsp;<span class="ident" id="5554067">reader</span>&nbsp;<span class="keyword" id="5554074">interface</span>&nbsp;<span class="op" id="5554084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554087">io</span><span class="op" id="5554089">.</span><span class="ident" id="5554090">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554098">io</span><span class="op" id="5554100">.</span><span class="ident" id="5554101">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="5554112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5554115">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="5554129">const</span>&nbsp;<span class="op" id="5554135">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554138">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554150">fColorMapFollows</span>&nbsp;<span class="op" id="5554167">=</span>&nbsp;<span class="num" id="5554169">1</span>&nbsp;<span class="op" id="5554171">&lt;&lt;</span>&nbsp;<span class="num" id="5554174">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554178">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554196">ifLocalColorTable</span>&nbsp;<span class="op" id="5554214">=</span>&nbsp;<span class="num" id="5554216">1</span>&nbsp;<span class="op" id="5554218">&lt;&lt;</span>&nbsp;<span class="num" id="5554221">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554224">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554242">=</span>&nbsp;<span class="num" id="5554244">1</span>&nbsp;<span class="op" id="5554246">&lt;&lt;</span>&nbsp;<span class="num" id="5554249">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554252">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5554270">=</span>&nbsp;<span class="num" id="5554272">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554276">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554303">gcTransparentColorSet</span>&nbsp;<span class="op" id="5554325">=</span>&nbsp;<span class="num" id="5554327">1</span>&nbsp;<span class="op" id="5554329">&lt;&lt;</span>&nbsp;<span class="num" id="5554332">0</span><br>
<span class="lineno"></span><span class="op" id="5554334">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5554337">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="5554360">const</span>&nbsp;<span class="op" id="5554366">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554369">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554386">=</span>&nbsp;<span class="num" id="5554388">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554394">sImageDescriptor</span>&nbsp;<span class="op" id="5554411">=</span>&nbsp;<span class="num" id="5554413">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554419">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554436">=</span>&nbsp;<span class="num" id="5554438">0x3B</span><br>
<span class="lineno"></span><span class="op" id="5554443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5554446">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5554461">const</span>&nbsp;<span class="op" id="5554467">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554470">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554486">=</span>&nbsp;<span class="num" id="5554488">0x01</span>&nbsp;<span class="comment" id="5554493">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554508">eGraphicControl</span>&nbsp;<span class="op" id="5554524">=</span>&nbsp;<span class="num" id="5554526">0xF9</span>&nbsp;<span class="comment" id="5554531">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554551">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554567">=</span>&nbsp;<span class="num" id="5554569">0xFE</span>&nbsp;<span class="comment" id="5554574">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554586">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5554602">=</span>&nbsp;<span class="num" id="5554604">0xFF</span>&nbsp;<span class="comment" id="5554609">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="5554624">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5554627">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5554677">type</span>&nbsp;<span class="ident" id="5554682">decoder</span>&nbsp;<span class="keyword" id="5554690">struct</span>&nbsp;<span class="op" id="5554697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554700">r</span>&nbsp;<span class="ident" id="5554702">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554711">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554728">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554744">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554752">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554768">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554773">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554789">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554794">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554810">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554816">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554832">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554838">backgroundIndex</span>&nbsp;<span class="builtintype" id="5554854">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554860">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554876">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554881">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5554897">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554903">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554927">aspect</span>&nbsp;<span class="builtintype" id="5554934">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554941">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5554968">imageFields</span>&nbsp;<span class="builtintype" id="5554980">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5554987">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555014">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5555034">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555040">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="5555060">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555067">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555081">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5555096">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555102">globalColorMap</span>&nbsp;<span class="ident" id="5555117">color</span><span class="op" id="5555122">.</span><span class="ident" id="5555123">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5555133">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555157">delay</span>&nbsp;<span class="op" id="5555163">[</span><span class="op" id="5555164">]</span><span class="builtintype" id="5555165">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555170">image</span>&nbsp;<span class="op" id="5555176">[</span><span class="op" id="5555177">]</span><span class="op" id="5555178">*</span><span class="ident" id="5555179">image</span><span class="op" id="5555184">.</span><span class="ident" id="5555185">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555195">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5555201">[</span><span class="num" id="5555202">1024</span><span class="op" id="5555206">]</span><span class="builtintype" id="5555207">byte</span>&nbsp;<span class="comment" id="5555212">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="5555261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5555264">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5555331">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5555398">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5555462">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="5555532">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5555601">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="5555630">type</span>&nbsp;<span class="ident" id="5555635">blockReader</span>&nbsp;<span class="keyword" id="5555647">struct</span>&nbsp;<span class="op" id="5555654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555657">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555663">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555671">slice</span>&nbsp;<span class="op" id="5555677">[</span><span class="op" id="5555678">]</span><span class="builtintype" id="5555679">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555685">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5555691">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555698">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5555704">[</span><span class="num" id="5555705">256</span><span class="op" id="5555708">]</span><span class="builtintype" id="5555709">byte</span><br>
<span class="lineno"></span><span class="op" id="5555714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5555717">func</span>&nbsp;<span class="op" id="5555722">(</span><span class="ident" id="5555723">b</span>&nbsp;<span class="op" id="5555725">*</span><span class="ident" id="5555726">blockReader</span><span class="op" id="5555737">)</span>&nbsp;<span class="ident" id="5555739">Read</span><span class="op" id="5555743">(</span><span class="ident" id="5555744">p</span>&nbsp;<span class="op" id="5555746">[</span><span class="op" id="5555747">]</span><span class="builtintype" id="5555748">byte</span><span class="op" id="5555752">)</span>&nbsp;<span class="op" id="5555754">(</span><span class="builtintype" id="5555755">int</span><span class="op" id="5555758">,</span>&nbsp;<span class="builtintype" id="5555760">error</span><span class="op" id="5555765">)</span>&nbsp;<span class="op" id="5555767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555770">if</span>&nbsp;<span class="ident" id="5555773">b</span><span class="op" id="5555774">.</span><span class="ident" id="5555775">err</span>&nbsp;<span class="op" id="5555779">!=</span>&nbsp;<span class="ident" id="5555782">nil</span>&nbsp;<span class="op" id="5555786">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555790">return</span>&nbsp;<span class="num" id="5555797">0</span><span class="op" id="5555798">,</span>&nbsp;<span class="ident" id="5555800">b</span><span class="op" id="5555801">.</span><span class="ident" id="5555802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555810">if</span>&nbsp;<span class="builtinfunc" id="5555813">len</span><span class="op" id="5555816">(</span><span class="ident" id="5555817">p</span><span class="op" id="5555818">)</span>&nbsp;<span class="op" id="5555820">==</span>&nbsp;<span class="num" id="5555823">0</span>&nbsp;<span class="op" id="5555825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555829">return</span>&nbsp;<span class="num" id="5555836">0</span><span class="op" id="5555837">,</span>&nbsp;<span class="ident" id="5555839">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555844">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555847">if</span>&nbsp;<span class="builtinfunc" id="5555850">len</span><span class="op" id="5555853">(</span><span class="ident" id="5555854">b</span><span class="op" id="5555855">.</span><span class="ident" id="5555856">slice</span><span class="op" id="5555861">)</span>&nbsp;<span class="op" id="5555863">==</span>&nbsp;<span class="num" id="5555866">0</span>&nbsp;<span class="op" id="5555868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555872">var</span>&nbsp;<span class="ident" id="5555876">blockLen</span>&nbsp;<span class="builtintype" id="5555885">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555893">blockLen</span><span class="op" id="5555901">,</span>&nbsp;<span class="ident" id="5555903">b</span><span class="op" id="5555904">.</span><span class="ident" id="5555905">err</span>&nbsp;<span class="op" id="5555909">=</span>&nbsp;<span class="ident" id="5555911">b</span><span class="op" id="5555912">.</span><span class="ident" id="5555913">r</span><span class="op" id="5555914">.</span><span class="ident" id="5555915">ReadByte</span><span class="op" id="5555923">(</span><span class="op" id="5555924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555928">if</span>&nbsp;<span class="ident" id="5555931">b</span><span class="op" id="5555932">.</span><span class="ident" id="5555933">err</span>&nbsp;<span class="op" id="5555937">!=</span>&nbsp;<span class="ident" id="5555940">nil</span>&nbsp;<span class="op" id="5555944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555949">return</span>&nbsp;<span class="num" id="5555956">0</span><span class="op" id="5555957">,</span>&nbsp;<span class="ident" id="5555959">b</span><span class="op" id="5555960">.</span><span class="ident" id="5555961">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5555967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5555971">if</span>&nbsp;<span class="ident" id="5555974">blockLen</span>&nbsp;<span class="op" id="5555983">==</span>&nbsp;<span class="num" id="5555986">0</span>&nbsp;<span class="op" id="5555988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5555993">b</span><span class="op" id="5555994">.</span><span class="ident" id="5555995">err</span>&nbsp;<span class="op" id="5555999">=</span>&nbsp;<span class="ident" id="5556001">io</span><span class="op" id="5556003">.</span><span class="ident" id="5556004">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556011">return</span>&nbsp;<span class="num" id="5556018">0</span><span class="op" id="5556019">,</span>&nbsp;<span class="ident" id="5556021">b</span><span class="op" id="5556022">.</span><span class="ident" id="5556023">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556029">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556033">b</span><span class="op" id="5556034">.</span><span class="ident" id="5556035">slice</span>&nbsp;<span class="op" id="5556041">=</span>&nbsp;<span class="ident" id="5556043">b</span><span class="op" id="5556044">.</span><span class="ident" id="5556045">tmp</span><span class="op" id="5556048">[</span><span class="num" id="5556049">0</span><span class="op" id="5556050">:</span><span class="ident" id="5556051">blockLen</span><span class="op" id="5556059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556063">if</span>&nbsp;<span class="ident" id="5556066">_</span><span class="op" id="5556067">,</span>&nbsp;<span class="ident" id="5556069">b</span><span class="op" id="5556070">.</span><span class="ident" id="5556071">err</span>&nbsp;<span class="op" id="5556075">=</span>&nbsp;<span class="ident" id="5556077">io</span><span class="op" id="5556079">.</span><span class="ident" id="5556080">ReadFull</span><span class="op" id="5556088">(</span><span class="ident" id="5556089">b</span><span class="op" id="5556090">.</span><span class="ident" id="5556091">r</span><span class="op" id="5556092">,</span>&nbsp;<span class="ident" id="5556094">b</span><span class="op" id="5556095">.</span><span class="ident" id="5556096">slice</span><span class="op" id="5556101">)</span><span class="op" id="5556102">;</span>&nbsp;<span class="ident" id="5556104">b</span><span class="op" id="5556105">.</span><span class="ident" id="5556106">err</span>&nbsp;<span class="op" id="5556110">!=</span>&nbsp;<span class="ident" id="5556113">nil</span>&nbsp;<span class="op" id="5556117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556122">return</span>&nbsp;<span class="num" id="5556129">0</span><span class="op" id="5556130">,</span>&nbsp;<span class="ident" id="5556132">b</span><span class="op" id="5556133">.</span><span class="ident" id="5556134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556143">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556146">n</span>&nbsp;<span class="op" id="5556148">:=</span>&nbsp;<span class="builtinfunc" id="5556151">copy</span><span class="op" id="5556155">(</span><span class="ident" id="5556156">p</span><span class="op" id="5556157">,</span>&nbsp;<span class="ident" id="5556159">b</span><span class="op" id="5556160">.</span><span class="ident" id="5556161">slice</span><span class="op" id="5556166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556169">b</span><span class="op" id="5556170">.</span><span class="ident" id="5556171">slice</span>&nbsp;<span class="op" id="5556177">=</span>&nbsp;<span class="ident" id="5556179">b</span><span class="op" id="5556180">.</span><span class="ident" id="5556181">slice</span><span class="op" id="5556186">[</span><span class="ident" id="5556187">n</span><span class="op" id="5556188">:</span><span class="op" id="5556189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556192">return</span>&nbsp;<span class="ident" id="5556199">n</span><span class="op" id="5556200">,</span>&nbsp;<span class="ident" id="5556202">nil</span><br>
<span class="lineno"></span><span class="op" id="5556206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5556209">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5556272">func</span>&nbsp;<span class="op" id="5556277">(</span><span class="ident" id="5556278">d</span>&nbsp;<span class="op" id="5556280">*</span><span class="ident" id="5556281">decoder</span><span class="op" id="5556288">)</span>&nbsp;<span class="ident" id="5556290">decode</span><span class="op" id="5556296">(</span><span class="ident" id="5556297">r</span>&nbsp;<span class="ident" id="5556299">io</span><span class="op" id="5556301">.</span><span class="ident" id="5556302">Reader</span><span class="op" id="5556308">,</span>&nbsp;<span class="ident" id="5556310">configOnly</span>&nbsp;<span class="builtintype" id="5556321">bool</span><span class="op" id="5556325">)</span>&nbsp;<span class="builtintype" id="5556327">error</span>&nbsp;<span class="op" id="5556333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5556336">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556386">if</span>&nbsp;<span class="ident" id="5556389">rr</span><span class="op" id="5556391">,</span>&nbsp;<span class="ident" id="5556393">ok</span>&nbsp;<span class="op" id="5556396">:=</span>&nbsp;<span class="ident" id="5556399">r</span><span class="op" id="5556400">.</span><span class="op" id="5556401">(</span><span class="ident" id="5556402">reader</span><span class="op" id="5556408">)</span><span class="op" id="5556409">;</span>&nbsp;<span class="ident" id="5556411">ok</span>&nbsp;<span class="op" id="5556414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556418">d</span><span class="op" id="5556419">.</span><span class="ident" id="5556420">r</span>&nbsp;<span class="op" id="5556422">=</span>&nbsp;<span class="ident" id="5556424">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556428">}</span>&nbsp;<span class="keyword" id="5556430">else</span>&nbsp;<span class="op" id="5556435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556439">d</span><span class="op" id="5556440">.</span><span class="ident" id="5556441">r</span>&nbsp;<span class="op" id="5556443">=</span>&nbsp;<span class="ident" id="5556445">bufio</span><span class="op" id="5556450">.</span><span class="ident" id="5556451">NewReader</span><span class="op" id="5556460">(</span><span class="ident" id="5556461">r</span><span class="op" id="5556462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556469">err</span>&nbsp;<span class="op" id="5556473">:=</span>&nbsp;<span class="ident" id="5556476">d</span><span class="op" id="5556477">.</span><span class="ident" id="5556478">readHeaderAndScreenDescriptor</span><span class="op" id="5556507">(</span><span class="op" id="5556508">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556511">if</span>&nbsp;<span class="ident" id="5556514">err</span>&nbsp;<span class="op" id="5556518">!=</span>&nbsp;<span class="ident" id="5556521">nil</span>&nbsp;<span class="op" id="5556525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556529">return</span>&nbsp;<span class="ident" id="5556536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556544">if</span>&nbsp;<span class="ident" id="5556547">configOnly</span>&nbsp;<span class="op" id="5556558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556562">return</span>&nbsp;<span class="ident" id="5556569">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556578">if</span>&nbsp;<span class="ident" id="5556581">d</span><span class="op" id="5556582">.</span><span class="ident" id="5556583">headerFields</span><span class="op" id="5556595">&amp;</span><span class="ident" id="5556596">fColorMapFollows</span>&nbsp;<span class="op" id="5556613">!=</span>&nbsp;<span class="num" id="5556616">0</span>&nbsp;<span class="op" id="5556618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556622">if</span>&nbsp;<span class="ident" id="5556625">d</span><span class="op" id="5556626">.</span><span class="ident" id="5556627">globalColorMap</span><span class="op" id="5556641">,</span>&nbsp;<span class="ident" id="5556643">err</span>&nbsp;<span class="op" id="5556647">=</span>&nbsp;<span class="ident" id="5556649">d</span><span class="op" id="5556650">.</span><span class="ident" id="5556651">readColorMap</span><span class="op" id="5556663">(</span><span class="op" id="5556664">)</span><span class="op" id="5556665">;</span>&nbsp;<span class="ident" id="5556667">err</span>&nbsp;<span class="op" id="5556671">!=</span>&nbsp;<span class="ident" id="5556674">nil</span>&nbsp;<span class="op" id="5556678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556683">return</span>&nbsp;<span class="ident" id="5556690">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556703">for</span>&nbsp;<span class="op" id="5556707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556711">c</span><span class="op" id="5556712">,</span>&nbsp;<span class="ident" id="5556714">err</span>&nbsp;<span class="op" id="5556718">:=</span>&nbsp;<span class="ident" id="5556721">d</span><span class="op" id="5556722">.</span><span class="ident" id="5556723">r</span><span class="op" id="5556724">.</span><span class="ident" id="5556725">ReadByte</span><span class="op" id="5556733">(</span><span class="op" id="5556734">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556738">if</span>&nbsp;<span class="ident" id="5556741">err</span>&nbsp;<span class="op" id="5556745">!=</span>&nbsp;<span class="ident" id="5556748">nil</span>&nbsp;<span class="op" id="5556752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556757">return</span>&nbsp;<span class="ident" id="5556764">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556774">switch</span>&nbsp;<span class="ident" id="5556781">c</span>&nbsp;<span class="op" id="5556783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556787">case</span>&nbsp;<span class="ident" id="5556792">sExtension</span><span class="op" id="5556802">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556807">if</span>&nbsp;<span class="ident" id="5556810">err</span>&nbsp;<span class="op" id="5556814">=</span>&nbsp;<span class="ident" id="5556816">d</span><span class="op" id="5556817">.</span><span class="ident" id="5556818">readExtension</span><span class="op" id="5556831">(</span><span class="op" id="5556832">)</span><span class="op" id="5556833">;</span>&nbsp;<span class="ident" id="5556835">err</span>&nbsp;<span class="op" id="5556839">!=</span>&nbsp;<span class="ident" id="5556842">nil</span>&nbsp;<span class="op" id="5556846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556852">return</span>&nbsp;<span class="ident" id="5556859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556871">case</span>&nbsp;<span class="ident" id="5556876">sImageDescriptor</span><span class="op" id="5556892">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556897">m</span><span class="op" id="5556898">,</span>&nbsp;<span class="ident" id="5556900">err</span>&nbsp;<span class="op" id="5556904">:=</span>&nbsp;<span class="ident" id="5556907">d</span><span class="op" id="5556908">.</span><span class="ident" id="5556909">newImageFromDescriptor</span><span class="op" id="5556931">(</span><span class="op" id="5556932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556937">if</span>&nbsp;<span class="ident" id="5556940">err</span>&nbsp;<span class="op" id="5556944">!=</span>&nbsp;<span class="ident" id="5556947">nil</span>&nbsp;<span class="op" id="5556951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5556957">return</span>&nbsp;<span class="ident" id="5556964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5556971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5556976">useLocalColorMap</span>&nbsp;<span class="op" id="5556993">:=</span>&nbsp;<span class="ident" id="5556996">d</span><span class="op" id="5556997">.</span><span class="ident" id="5556998">imageFields</span><span class="op" id="5557009">&amp;</span><span class="ident" id="5557010">fColorMapFollows</span>&nbsp;<span class="op" id="5557027">!=</span>&nbsp;<span class="num" id="5557030">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557035">if</span>&nbsp;<span class="ident" id="5557038">useLocalColorMap</span>&nbsp;<span class="op" id="5557055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557061">m</span><span class="op" id="5557062">.</span><span class="ident" id="5557063">Palette</span><span class="op" id="5557070">,</span>&nbsp;<span class="ident" id="5557072">err</span>&nbsp;<span class="op" id="5557076">=</span>&nbsp;<span class="ident" id="5557078">d</span><span class="op" id="5557079">.</span><span class="ident" id="5557080">readColorMap</span><span class="op" id="5557092">(</span><span class="op" id="5557093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557099">if</span>&nbsp;<span class="ident" id="5557102">err</span>&nbsp;<span class="op" id="5557106">!=</span>&nbsp;<span class="ident" id="5557109">nil</span>&nbsp;<span class="op" id="5557113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557120">return</span>&nbsp;<span class="ident" id="5557127">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557135">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557140">}</span>&nbsp;<span class="keyword" id="5557142">else</span>&nbsp;<span class="op" id="5557147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557153">m</span><span class="op" id="5557154">.</span><span class="ident" id="5557155">Palette</span>&nbsp;<span class="op" id="5557163">=</span>&nbsp;<span class="ident" id="5557165">d</span><span class="op" id="5557166">.</span><span class="ident" id="5557167">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557190">if</span>&nbsp;<span class="ident" id="5557193">d</span><span class="op" id="5557194">.</span><span class="ident" id="5557195">hasTransparentIndex</span>&nbsp;<span class="op" id="5557215">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5557218">int</span><span class="op" id="5557221">(</span><span class="ident" id="5557222">d</span><span class="op" id="5557223">.</span><span class="ident" id="5557224">transparentIndex</span><span class="op" id="5557240">)</span>&nbsp;<span class="op" id="5557242">&lt;</span>&nbsp;<span class="builtinfunc" id="5557244">len</span><span class="op" id="5557247">(</span><span class="ident" id="5557248">m</span><span class="op" id="5557249">.</span><span class="ident" id="5557250">Palette</span><span class="op" id="5557257">)</span>&nbsp;<span class="op" id="5557259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557265">if</span>&nbsp;<span class="op" id="5557268">!</span><span class="ident" id="5557269">useLocalColorMap</span>&nbsp;<span class="op" id="5557286">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557293">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557329">m</span><span class="op" id="5557330">.</span><span class="ident" id="5557331">Palette</span>&nbsp;<span class="op" id="5557339">=</span>&nbsp;<span class="builtinfunc" id="5557341">append</span><span class="op" id="5557347">(</span><span class="ident" id="5557348">color</span><span class="op" id="5557353">.</span><span class="ident" id="5557354">Palette</span><span class="op" id="5557361">(</span><span class="ident" id="5557362">nil</span><span class="op" id="5557365">)</span><span class="op" id="5557366">,</span>&nbsp;<span class="ident" id="5557368">d</span><span class="op" id="5557369">.</span><span class="ident" id="5557370">globalColorMap</span><span class="op" id="5557384">...</span><span class="op" id="5557387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557399">m</span><span class="op" id="5557400">.</span><span class="ident" id="5557401">Palette</span><span class="op" id="5557408">[</span><span class="ident" id="5557409">d</span><span class="op" id="5557410">.</span><span class="ident" id="5557411">transparentIndex</span><span class="op" id="5557427">]</span>&nbsp;<span class="op" id="5557429">=</span>&nbsp;<span class="ident" id="5557431">color</span><span class="op" id="5557436">.</span><span class="ident" id="5557437">RGBA</span><span class="op" id="5557441">{</span><span class="op" id="5557442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557447">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557452">litWidth</span><span class="op" id="5557460">,</span>&nbsp;<span class="ident" id="5557462">err</span>&nbsp;<span class="op" id="5557466">:=</span>&nbsp;<span class="ident" id="5557469">d</span><span class="op" id="5557470">.</span><span class="ident" id="5557471">r</span><span class="op" id="5557472">.</span><span class="ident" id="5557473">ReadByte</span><span class="op" id="5557481">(</span><span class="op" id="5557482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557487">if</span>&nbsp;<span class="ident" id="5557490">err</span>&nbsp;<span class="op" id="5557494">!=</span>&nbsp;<span class="ident" id="5557497">nil</span>&nbsp;<span class="op" id="5557501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557507">return</span>&nbsp;<span class="ident" id="5557514">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557526">if</span>&nbsp;<span class="ident" id="5557529">litWidth</span>&nbsp;<span class="op" id="5557538">&lt;</span>&nbsp;<span class="num" id="5557540">2</span>&nbsp;<span class="op" id="5557542">||</span>&nbsp;<span class="ident" id="5557545">litWidth</span>&nbsp;<span class="op" id="5557554">&gt;</span>&nbsp;<span class="num" id="5557556">8</span>&nbsp;<span class="op" id="5557558">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557564">return</span>&nbsp;<span class="ident" id="5557571">fmt</span><span class="op" id="5557574">.</span><span class="ident" id="5557575">Errorf</span><span class="op" id="5557581">(</span><span class="string" id="5557582">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="5557626">,</span>&nbsp;<span class="ident" id="5557628">litWidth</span><span class="op" id="5557636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557646">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557690">br</span>&nbsp;<span class="op" id="5557693">:=</span>&nbsp;<span class="op" id="5557696">&amp;</span><span class="ident" id="5557697">blockReader</span><span class="op" id="5557708">{</span><span class="ident" id="5557709">r</span><span class="op" id="5557710">:</span>&nbsp;<span class="ident" id="5557712">d</span><span class="op" id="5557713">.</span><span class="ident" id="5557714">r</span><span class="op" id="5557715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5557720">lzwr</span>&nbsp;<span class="op" id="5557725">:=</span>&nbsp;<span class="ident" id="5557728">lzw</span><span class="op" id="5557731">.</span><span class="ident" id="5557732">NewReader</span><span class="op" id="5557741">(</span><span class="ident" id="5557742">br</span><span class="op" id="5557744">,</span>&nbsp;<span class="ident" id="5557746">lzw</span><span class="op" id="5557749">.</span><span class="ident" id="5557750">LSB</span><span class="op" id="5557753">,</span>&nbsp;<span class="builtintype" id="5557755">int</span><span class="op" id="5557758">(</span><span class="ident" id="5557759">litWidth</span><span class="op" id="5557767">)</span><span class="op" id="5557768">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557773">defer</span>&nbsp;<span class="ident" id="5557779">lzwr</span><span class="op" id="5557783">.</span><span class="ident" id="5557784">Close</span><span class="op" id="5557789">(</span><span class="op" id="5557790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557795">if</span>&nbsp;<span class="ident" id="5557798">_</span><span class="op" id="5557799">,</span>&nbsp;<span class="ident" id="5557801">err</span>&nbsp;<span class="op" id="5557805">=</span>&nbsp;<span class="ident" id="5557807">io</span><span class="op" id="5557809">.</span><span class="ident" id="5557810">ReadFull</span><span class="op" id="5557818">(</span><span class="ident" id="5557819">lzwr</span><span class="op" id="5557823">,</span>&nbsp;<span class="ident" id="5557825">m</span><span class="op" id="5557826">.</span><span class="ident" id="5557827">Pix</span><span class="op" id="5557830">)</span><span class="op" id="5557831">;</span>&nbsp;<span class="ident" id="5557833">err</span>&nbsp;<span class="op" id="5557837">!=</span>&nbsp;<span class="ident" id="5557840">nil</span>&nbsp;<span class="op" id="5557844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557850">if</span>&nbsp;<span class="ident" id="5557853">err</span>&nbsp;<span class="op" id="5557857">!=</span>&nbsp;<span class="ident" id="5557860">io</span><span class="op" id="5557862">.</span><span class="ident" id="5557863">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5557880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557887">return</span>&nbsp;<span class="ident" id="5557894">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557902">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5557908">return</span>&nbsp;<span class="ident" id="5557915">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557936">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5557998">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558030">if</span>&nbsp;<span class="ident" id="5558033">n</span><span class="op" id="5558034">,</span>&nbsp;<span class="ident" id="5558036">err</span>&nbsp;<span class="op" id="5558040">:=</span>&nbsp;<span class="ident" id="5558043">lzwr</span><span class="op" id="5558047">.</span><span class="ident" id="5558048">Read</span><span class="op" id="5558052">(</span><span class="ident" id="5558053">d</span><span class="op" id="5558054">.</span><span class="ident" id="5558055">tmp</span><span class="op" id="5558058">[</span><span class="op" id="5558059">:</span><span class="num" id="5558060">1</span><span class="op" id="5558061">]</span><span class="op" id="5558062">)</span><span class="op" id="5558063">;</span>&nbsp;<span class="ident" id="5558065">n</span>&nbsp;<span class="op" id="5558067">!=</span>&nbsp;<span class="num" id="5558070">0</span>&nbsp;<span class="op" id="5558072">||</span>&nbsp;<span class="ident" id="5558075">err</span>&nbsp;<span class="op" id="5558079">!=</span>&nbsp;<span class="ident" id="5558082">io</span><span class="op" id="5558084">.</span><span class="ident" id="5558085">EOF</span>&nbsp;<span class="op" id="5558089">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558095">if</span>&nbsp;<span class="ident" id="5558098">err</span>&nbsp;<span class="op" id="5558102">!=</span>&nbsp;<span class="ident" id="5558105">nil</span>&nbsp;<span class="op" id="5558109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558116">return</span>&nbsp;<span class="ident" id="5558123">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558137">return</span>&nbsp;<span class="ident" id="5558144">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558158">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558163">if</span>&nbsp;<span class="ident" id="5558166">n</span><span class="op" id="5558167">,</span>&nbsp;<span class="ident" id="5558169">err</span>&nbsp;<span class="op" id="5558173">:=</span>&nbsp;<span class="ident" id="5558176">br</span><span class="op" id="5558178">.</span><span class="ident" id="5558179">Read</span><span class="op" id="5558183">(</span><span class="ident" id="5558184">d</span><span class="op" id="5558185">.</span><span class="ident" id="5558186">tmp</span><span class="op" id="5558189">[</span><span class="op" id="5558190">:</span><span class="num" id="5558191">1</span><span class="op" id="5558192">]</span><span class="op" id="5558193">)</span><span class="op" id="5558194">;</span>&nbsp;<span class="ident" id="5558196">n</span>&nbsp;<span class="op" id="5558198">!=</span>&nbsp;<span class="num" id="5558201">0</span>&nbsp;<span class="op" id="5558203">||</span>&nbsp;<span class="ident" id="5558206">err</span>&nbsp;<span class="op" id="5558210">!=</span>&nbsp;<span class="ident" id="5558213">io</span><span class="op" id="5558215">.</span><span class="ident" id="5558216">EOF</span>&nbsp;<span class="op" id="5558220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558226">if</span>&nbsp;<span class="ident" id="5558229">err</span>&nbsp;<span class="op" id="5558233">!=</span>&nbsp;<span class="ident" id="5558236">nil</span>&nbsp;<span class="op" id="5558240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558247">return</span>&nbsp;<span class="ident" id="5558254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558268">return</span>&nbsp;<span class="ident" id="5558275">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558295">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558354">if</span>&nbsp;<span class="builtinfunc" id="5558357">len</span><span class="op" id="5558360">(</span><span class="ident" id="5558361">m</span><span class="op" id="5558362">.</span><span class="ident" id="5558363">Palette</span><span class="op" id="5558370">)</span>&nbsp;<span class="op" id="5558372">&lt;</span>&nbsp;<span class="num" id="5558374">256</span>&nbsp;<span class="op" id="5558378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558384">for</span>&nbsp;<span class="ident" id="5558388">_</span><span class="op" id="5558389">,</span>&nbsp;<span class="ident" id="5558391">pixel</span>&nbsp;<span class="op" id="5558397">:=</span>&nbsp;<span class="keyword" id="5558400">range</span>&nbsp;<span class="ident" id="5558406">m</span><span class="op" id="5558407">.</span><span class="ident" id="5558408">Pix</span>&nbsp;<span class="op" id="5558412">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558419">if</span>&nbsp;<span class="builtintype" id="5558422">int</span><span class="op" id="5558425">(</span><span class="ident" id="5558426">pixel</span><span class="op" id="5558431">)</span>&nbsp;<span class="op" id="5558433">&gt;=</span>&nbsp;<span class="builtinfunc" id="5558436">len</span><span class="op" id="5558439">(</span><span class="ident" id="5558440">m</span><span class="op" id="5558441">.</span><span class="ident" id="5558442">Palette</span><span class="op" id="5558449">)</span>&nbsp;<span class="op" id="5558451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558459">return</span>&nbsp;<span class="ident" id="5558466">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558494">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558500">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558541">if</span>&nbsp;<span class="ident" id="5558544">d</span><span class="op" id="5558545">.</span><span class="ident" id="5558546">imageFields</span><span class="op" id="5558557">&amp;</span><span class="ident" id="5558558">ifInterlace</span>&nbsp;<span class="op" id="5558570">!=</span>&nbsp;<span class="num" id="5558573">0</span>&nbsp;<span class="op" id="5558575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558581">uninterlace</span><span class="op" id="5558592">(</span><span class="ident" id="5558593">m</span><span class="op" id="5558594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558599">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558605">d</span><span class="op" id="5558606">.</span><span class="ident" id="5558607">image</span>&nbsp;<span class="op" id="5558613">=</span>&nbsp;<span class="builtinfunc" id="5558615">append</span><span class="op" id="5558621">(</span><span class="ident" id="5558622">d</span><span class="op" id="5558623">.</span><span class="ident" id="5558624">image</span><span class="op" id="5558629">,</span>&nbsp;<span class="ident" id="5558631">m</span><span class="op" id="5558632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558637">d</span><span class="op" id="5558638">.</span><span class="ident" id="5558639">delay</span>&nbsp;<span class="op" id="5558645">=</span>&nbsp;<span class="builtinfunc" id="5558647">append</span><span class="op" id="5558653">(</span><span class="ident" id="5558654">d</span><span class="op" id="5558655">.</span><span class="ident" id="5558656">delay</span><span class="op" id="5558661">,</span>&nbsp;<span class="ident" id="5558663">d</span><span class="op" id="5558664">.</span><span class="ident" id="5558665">delayTime</span><span class="op" id="5558674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558679">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558747">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5558819">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558880">d</span><span class="op" id="5558881">.</span><span class="ident" id="5558882">delayTime</span>&nbsp;<span class="op" id="5558892">=</span>&nbsp;<span class="num" id="5558894">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558899">d</span><span class="op" id="5558900">.</span><span class="ident" id="5558901">hasTransparentIndex</span>&nbsp;<span class="op" id="5558921">=</span>&nbsp;<span class="builtintype" id="5558923">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558932">case</span>&nbsp;<span class="ident" id="5558937">sTrailer</span><span class="op" id="5558945">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558950">if</span>&nbsp;<span class="builtinfunc" id="5558953">len</span><span class="op" id="5558956">(</span><span class="ident" id="5558957">d</span><span class="op" id="5558958">.</span><span class="ident" id="5558959">image</span><span class="op" id="5558964">)</span>&nbsp;<span class="op" id="5558966">==</span>&nbsp;<span class="num" id="5558969">0</span>&nbsp;<span class="op" id="5558971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5558977">return</span>&nbsp;<span class="ident" id="5558984">io</span><span class="op" id="5558986">.</span><span class="ident" id="5558987">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559012">return</span>&nbsp;<span class="ident" id="5559019">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559026">default</span><span class="op" id="5559033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559038">return</span>&nbsp;<span class="ident" id="5559045">fmt</span><span class="op" id="5559048">.</span><span class="ident" id="5559049">Errorf</span><span class="op" id="5559055">(</span><span class="string" id="5559056">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="5559089">,</span>&nbsp;<span class="ident" id="5559091">c</span><span class="op" id="5559092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559099">}</span><br>
<span class="lineno"></span><span class="op" id="5559101">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5559104">func</span>&nbsp;<span class="op" id="5559109">(</span><span class="ident" id="5559110">d</span>&nbsp;<span class="op" id="5559112">*</span><span class="ident" id="5559113">decoder</span><span class="op" id="5559120">)</span>&nbsp;<span class="ident" id="5559122">readHeaderAndScreenDescriptor</span><span class="op" id="5559151">(</span><span class="op" id="5559152">)</span>&nbsp;<span class="builtintype" id="5559154">error</span>&nbsp;<span class="op" id="5559160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559163">_</span><span class="op" id="5559164">,</span>&nbsp;<span class="ident" id="5559166">err</span>&nbsp;<span class="op" id="5559170">:=</span>&nbsp;<span class="ident" id="5559173">io</span><span class="op" id="5559175">.</span><span class="ident" id="5559176">ReadFull</span><span class="op" id="5559184">(</span><span class="ident" id="5559185">d</span><span class="op" id="5559186">.</span><span class="ident" id="5559187">r</span><span class="op" id="5559188">,</span>&nbsp;<span class="ident" id="5559190">d</span><span class="op" id="5559191">.</span><span class="ident" id="5559192">tmp</span><span class="op" id="5559195">[</span><span class="num" id="5559196">0</span><span class="op" id="5559197">:</span><span class="num" id="5559198">13</span><span class="op" id="5559200">]</span><span class="op" id="5559201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559204">if</span>&nbsp;<span class="ident" id="5559207">err</span>&nbsp;<span class="op" id="5559211">!=</span>&nbsp;<span class="ident" id="5559214">nil</span>&nbsp;<span class="op" id="5559218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559222">return</span>&nbsp;<span class="ident" id="5559229">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559237">d</span><span class="op" id="5559238">.</span><span class="ident" id="5559239">vers</span>&nbsp;<span class="op" id="5559244">=</span>&nbsp;<span class="builtintype" id="5559246">string</span><span class="op" id="5559252">(</span><span class="ident" id="5559253">d</span><span class="op" id="5559254">.</span><span class="ident" id="5559255">tmp</span><span class="op" id="5559258">[</span><span class="num" id="5559259">0</span><span class="op" id="5559260">:</span><span class="num" id="5559261">6</span><span class="op" id="5559262">]</span><span class="op" id="5559263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559266">if</span>&nbsp;<span class="ident" id="5559269">d</span><span class="op" id="5559270">.</span><span class="ident" id="5559271">vers</span>&nbsp;<span class="op" id="5559276">!=</span>&nbsp;<span class="string" id="5559279">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="5559288">&amp;&amp;</span>&nbsp;<span class="ident" id="5559291">d</span><span class="op" id="5559292">.</span><span class="ident" id="5559293">vers</span>&nbsp;<span class="op" id="5559298">!=</span>&nbsp;<span class="string" id="5559301">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="5559310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559314">return</span>&nbsp;<span class="ident" id="5559321">fmt</span><span class="op" id="5559324">.</span><span class="ident" id="5559325">Errorf</span><span class="op" id="5559331">(</span><span class="string" id="5559332">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="5559364">,</span>&nbsp;<span class="ident" id="5559366">d</span><span class="op" id="5559367">.</span><span class="ident" id="5559368">vers</span><span class="op" id="5559372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559375">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559378">d</span><span class="op" id="5559379">.</span><span class="ident" id="5559380">width</span>&nbsp;<span class="op" id="5559386">=</span>&nbsp;<span class="builtintype" id="5559388">int</span><span class="op" id="5559391">(</span><span class="ident" id="5559392">d</span><span class="op" id="5559393">.</span><span class="ident" id="5559394">tmp</span><span class="op" id="5559397">[</span><span class="num" id="5559398">6</span><span class="op" id="5559399">]</span><span class="op" id="5559400">)</span>&nbsp;<span class="op" id="5559402">+</span>&nbsp;<span class="builtintype" id="5559404">int</span><span class="op" id="5559407">(</span><span class="ident" id="5559408">d</span><span class="op" id="5559409">.</span><span class="ident" id="5559410">tmp</span><span class="op" id="5559413">[</span><span class="num" id="5559414">7</span><span class="op" id="5559415">]</span><span class="op" id="5559416">)</span><span class="op" id="5559417">&lt;&lt;</span><span class="num" id="5559419">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559422">d</span><span class="op" id="5559423">.</span><span class="ident" id="5559424">height</span>&nbsp;<span class="op" id="5559431">=</span>&nbsp;<span class="builtintype" id="5559433">int</span><span class="op" id="5559436">(</span><span class="ident" id="5559437">d</span><span class="op" id="5559438">.</span><span class="ident" id="5559439">tmp</span><span class="op" id="5559442">[</span><span class="num" id="5559443">8</span><span class="op" id="5559444">]</span><span class="op" id="5559445">)</span>&nbsp;<span class="op" id="5559447">+</span>&nbsp;<span class="builtintype" id="5559449">int</span><span class="op" id="5559452">(</span><span class="ident" id="5559453">d</span><span class="op" id="5559454">.</span><span class="ident" id="5559455">tmp</span><span class="op" id="5559458">[</span><span class="num" id="5559459">9</span><span class="op" id="5559460">]</span><span class="op" id="5559461">)</span><span class="op" id="5559462">&lt;&lt;</span><span class="num" id="5559464">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559467">d</span><span class="op" id="5559468">.</span><span class="ident" id="5559469">headerFields</span>&nbsp;<span class="op" id="5559482">=</span>&nbsp;<span class="ident" id="5559484">d</span><span class="op" id="5559485">.</span><span class="ident" id="5559486">tmp</span><span class="op" id="5559489">[</span><span class="num" id="5559490">10</span><span class="op" id="5559492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559495">d</span><span class="op" id="5559496">.</span><span class="ident" id="5559497">backgroundIndex</span>&nbsp;<span class="op" id="5559513">=</span>&nbsp;<span class="ident" id="5559515">d</span><span class="op" id="5559516">.</span><span class="ident" id="5559517">tmp</span><span class="op" id="5559520">[</span><span class="num" id="5559521">11</span><span class="op" id="5559523">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559526">d</span><span class="op" id="5559527">.</span><span class="ident" id="5559528">aspect</span>&nbsp;<span class="op" id="5559535">=</span>&nbsp;<span class="ident" id="5559537">d</span><span class="op" id="5559538">.</span><span class="ident" id="5559539">tmp</span><span class="op" id="5559542">[</span><span class="num" id="5559543">12</span><span class="op" id="5559545">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559548">d</span><span class="op" id="5559549">.</span><span class="ident" id="5559550">loopCount</span>&nbsp;<span class="op" id="5559560">=</span>&nbsp;<span class="op" id="5559562">-</span><span class="num" id="5559563">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559566">d</span><span class="op" id="5559567">.</span><span class="ident" id="5559568">pixelSize</span>&nbsp;<span class="op" id="5559578">=</span>&nbsp;<span class="builtintype" id="5559580">uint</span><span class="op" id="5559584">(</span><span class="ident" id="5559585">d</span><span class="op" id="5559586">.</span><span class="ident" id="5559587">headerFields</span><span class="op" id="5559599">&amp;</span><span class="num" id="5559600">7</span><span class="op" id="5559601">)</span>&nbsp;<span class="op" id="5559603">+</span>&nbsp;<span class="num" id="5559605">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559608">return</span>&nbsp;<span class="ident" id="5559615">nil</span><br>
<span class="lineno"></span><span class="op" id="5559619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5559622">func</span>&nbsp;<span class="op" id="5559627">(</span><span class="ident" id="5559628">d</span>&nbsp;<span class="op" id="5559630">*</span><span class="ident" id="5559631">decoder</span><span class="op" id="5559638">)</span>&nbsp;<span class="ident" id="5559640">readColorMap</span><span class="op" id="5559652">(</span><span class="op" id="5559653">)</span>&nbsp;<span class="op" id="5559655">(</span><span class="ident" id="5559656">color</span><span class="op" id="5559661">.</span><span class="ident" id="5559662">Palette</span><span class="op" id="5559669">,</span>&nbsp;<span class="builtintype" id="5559671">error</span><span class="op" id="5559676">)</span>&nbsp;<span class="op" id="5559678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559681">if</span>&nbsp;<span class="ident" id="5559684">d</span><span class="op" id="5559685">.</span><span class="ident" id="5559686">pixelSize</span>&nbsp;<span class="op" id="5559696">&gt;</span>&nbsp;<span class="num" id="5559698">8</span>&nbsp;<span class="op" id="5559700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559704">return</span>&nbsp;<span class="ident" id="5559711">nil</span><span class="op" id="5559714">,</span>&nbsp;<span class="ident" id="5559716">fmt</span><span class="op" id="5559719">.</span><span class="ident" id="5559720">Errorf</span><span class="op" id="5559726">(</span><span class="string" id="5559727">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="5559764">,</span>&nbsp;<span class="ident" id="5559766">d</span><span class="op" id="5559767">.</span><span class="ident" id="5559768">pixelSize</span><span class="op" id="5559777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559783">numColors</span>&nbsp;<span class="op" id="5559793">:=</span>&nbsp;<span class="num" id="5559796">1</span>&nbsp;<span class="op" id="5559798">&lt;&lt;</span>&nbsp;<span class="ident" id="5559801">d</span><span class="op" id="5559802">.</span><span class="ident" id="5559803">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559814">if</span>&nbsp;<span class="ident" id="5559817">d</span><span class="op" id="5559818">.</span><span class="ident" id="5559819">imageFields</span><span class="op" id="5559830">&amp;</span><span class="ident" id="5559831">ifLocalColorTable</span>&nbsp;<span class="op" id="5559849">!=</span>&nbsp;<span class="num" id="5559852">0</span>&nbsp;<span class="op" id="5559854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559858">numColors</span>&nbsp;<span class="op" id="5559868">=</span>&nbsp;<span class="num" id="5559870">1</span>&nbsp;<span class="op" id="5559872">&lt;&lt;</span>&nbsp;<span class="op" id="5559875">(</span><span class="op" id="5559876">(</span><span class="ident" id="5559877">d</span><span class="op" id="5559878">.</span><span class="ident" id="5559879">imageFields</span>&nbsp;<span class="op" id="5559891">&amp;</span>&nbsp;<span class="ident" id="5559893">ifPixelSizeMask</span><span class="op" id="5559908">)</span>&nbsp;<span class="op" id="5559910">+</span>&nbsp;<span class="num" id="5559912">1</span><span class="op" id="5559913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5559916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559919">numValues</span>&nbsp;<span class="op" id="5559929">:=</span>&nbsp;<span class="num" id="5559932">3</span>&nbsp;<span class="op" id="5559934">*</span>&nbsp;<span class="ident" id="5559936">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559947">_</span><span class="op" id="5559948">,</span>&nbsp;<span class="ident" id="5559950">err</span>&nbsp;<span class="op" id="5559954">:=</span>&nbsp;<span class="ident" id="5559957">io</span><span class="op" id="5559959">.</span><span class="ident" id="5559960">ReadFull</span><span class="op" id="5559968">(</span><span class="ident" id="5559969">d</span><span class="op" id="5559970">.</span><span class="ident" id="5559971">r</span><span class="op" id="5559972">,</span>&nbsp;<span class="ident" id="5559974">d</span><span class="op" id="5559975">.</span><span class="ident" id="5559976">tmp</span><span class="op" id="5559979">[</span><span class="num" id="5559980">0</span><span class="op" id="5559981">:</span><span class="ident" id="5559982">numValues</span><span class="op" id="5559991">]</span><span class="op" id="5559992">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5559995">if</span>&nbsp;<span class="ident" id="5559998">err</span>&nbsp;<span class="op" id="5560002">!=</span>&nbsp;<span class="ident" id="5560005">nil</span>&nbsp;<span class="op" id="5560009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560013">return</span>&nbsp;<span class="ident" id="5560020">nil</span><span class="op" id="5560023">,</span>&nbsp;<span class="ident" id="5560025">fmt</span><span class="op" id="5560028">.</span><span class="ident" id="5560029">Errorf</span><span class="op" id="5560035">(</span><span class="string" id="5560036">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="5560070">,</span>&nbsp;<span class="ident" id="5560072">err</span><span class="op" id="5560075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560081">colorMap</span>&nbsp;<span class="op" id="5560090">:=</span>&nbsp;<span class="builtinfunc" id="5560093">make</span><span class="op" id="5560097">(</span><span class="ident" id="5560098">color</span><span class="op" id="5560103">.</span><span class="ident" id="5560104">Palette</span><span class="op" id="5560111">,</span>&nbsp;<span class="ident" id="5560113">numColors</span><span class="op" id="5560122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560125">j</span>&nbsp;<span class="op" id="5560127">:=</span>&nbsp;<span class="num" id="5560130">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560133">for</span>&nbsp;<span class="ident" id="5560137">i</span>&nbsp;<span class="op" id="5560139">:=</span>&nbsp;<span class="keyword" id="5560142">range</span>&nbsp;<span class="ident" id="5560148">colorMap</span>&nbsp;<span class="op" id="5560157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560161">colorMap</span><span class="op" id="5560169">[</span><span class="ident" id="5560170">i</span><span class="op" id="5560171">]</span>&nbsp;<span class="op" id="5560173">=</span>&nbsp;<span class="ident" id="5560175">color</span><span class="op" id="5560180">.</span><span class="ident" id="5560181">RGBA</span><span class="op" id="5560185">{</span><span class="ident" id="5560186">d</span><span class="op" id="5560187">.</span><span class="ident" id="5560188">tmp</span><span class="op" id="5560191">[</span><span class="ident" id="5560192">j</span><span class="op" id="5560193">+</span><span class="num" id="5560194">0</span><span class="op" id="5560195">]</span><span class="op" id="5560196">,</span>&nbsp;<span class="ident" id="5560198">d</span><span class="op" id="5560199">.</span><span class="ident" id="5560200">tmp</span><span class="op" id="5560203">[</span><span class="ident" id="5560204">j</span><span class="op" id="5560205">+</span><span class="num" id="5560206">1</span><span class="op" id="5560207">]</span><span class="op" id="5560208">,</span>&nbsp;<span class="ident" id="5560210">d</span><span class="op" id="5560211">.</span><span class="ident" id="5560212">tmp</span><span class="op" id="5560215">[</span><span class="ident" id="5560216">j</span><span class="op" id="5560217">+</span><span class="num" id="5560218">2</span><span class="op" id="5560219">]</span><span class="op" id="5560220">,</span>&nbsp;<span class="num" id="5560222">0xFF</span><span class="op" id="5560226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560230">j</span>&nbsp;<span class="op" id="5560232">+=</span>&nbsp;<span class="num" id="5560235">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560241">return</span>&nbsp;<span class="ident" id="5560248">colorMap</span><span class="op" id="5560256">,</span>&nbsp;<span class="ident" id="5560258">nil</span><br>
<span class="lineno">295</span><span class="op" id="5560262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5560265">func</span>&nbsp;<span class="op" id="5560270">(</span><span class="ident" id="5560271">d</span>&nbsp;<span class="op" id="5560273">*</span><span class="ident" id="5560274">decoder</span><span class="op" id="5560281">)</span>&nbsp;<span class="ident" id="5560283">readExtension</span><span class="op" id="5560296">(</span><span class="op" id="5560297">)</span>&nbsp;<span class="builtintype" id="5560299">error</span>&nbsp;<span class="op" id="5560305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560308">extension</span><span class="op" id="5560317">,</span>&nbsp;<span class="ident" id="5560319">err</span>&nbsp;<span class="op" id="5560323">:=</span>&nbsp;<span class="ident" id="5560326">d</span><span class="op" id="5560327">.</span><span class="ident" id="5560328">r</span><span class="op" id="5560329">.</span><span class="ident" id="5560330">ReadByte</span><span class="op" id="5560338">(</span><span class="op" id="5560339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560342">if</span>&nbsp;<span class="ident" id="5560345">err</span>&nbsp;<span class="op" id="5560349">!=</span>&nbsp;<span class="ident" id="5560352">nil</span>&nbsp;<span class="op" id="5560356">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560360">return</span>&nbsp;<span class="ident" id="5560367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560375">size</span>&nbsp;<span class="op" id="5560380">:=</span>&nbsp;<span class="num" id="5560383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560386">switch</span>&nbsp;<span class="ident" id="5560393">extension</span>&nbsp;<span class="op" id="5560403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560406">case</span>&nbsp;<span class="ident" id="5560411">eText</span><span class="op" id="5560416">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560420">size</span>&nbsp;<span class="op" id="5560425">=</span>&nbsp;<span class="num" id="5560427">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560431">case</span>&nbsp;<span class="ident" id="5560436">eGraphicControl</span><span class="op" id="5560451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560455">return</span>&nbsp;<span class="ident" id="5560462">d</span><span class="op" id="5560463">.</span><span class="ident" id="5560464">readGraphicControl</span><span class="op" id="5560482">(</span><span class="op" id="5560483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560486">case</span>&nbsp;<span class="ident" id="5560491">eComment</span><span class="op" id="5560499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560503">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560540">case</span>&nbsp;<span class="ident" id="5560545">eApplication</span><span class="op" id="5560557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560561">b</span><span class="op" id="5560562">,</span>&nbsp;<span class="ident" id="5560564">err</span>&nbsp;<span class="op" id="5560568">:=</span>&nbsp;<span class="ident" id="5560571">d</span><span class="op" id="5560572">.</span><span class="ident" id="5560573">r</span><span class="op" id="5560574">.</span><span class="ident" id="5560575">ReadByte</span><span class="op" id="5560583">(</span><span class="op" id="5560584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560588">if</span>&nbsp;<span class="ident" id="5560591">err</span>&nbsp;<span class="op" id="5560595">!=</span>&nbsp;<span class="ident" id="5560598">nil</span>&nbsp;<span class="op" id="5560602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560607">return</span>&nbsp;<span class="ident" id="5560614">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560620">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560624">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560688">size</span>&nbsp;<span class="op" id="5560693">=</span>&nbsp;<span class="builtintype" id="5560695">int</span><span class="op" id="5560698">(</span><span class="ident" id="5560699">b</span><span class="op" id="5560700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560703">default</span><span class="op" id="5560710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560714">return</span>&nbsp;<span class="ident" id="5560721">fmt</span><span class="op" id="5560724">.</span><span class="ident" id="5560725">Errorf</span><span class="op" id="5560731">(</span><span class="string" id="5560732">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="5560763">,</span>&nbsp;<span class="ident" id="5560765">extension</span><span class="op" id="5560774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560777">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560780">if</span>&nbsp;<span class="ident" id="5560783">size</span>&nbsp;<span class="op" id="5560788">&gt;</span>&nbsp;<span class="num" id="5560790">0</span>&nbsp;<span class="op" id="5560792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560796">if</span>&nbsp;<span class="ident" id="5560799">_</span><span class="op" id="5560800">,</span>&nbsp;<span class="ident" id="5560802">err</span>&nbsp;<span class="op" id="5560806">:=</span>&nbsp;<span class="ident" id="5560809">io</span><span class="op" id="5560811">.</span><span class="ident" id="5560812">ReadFull</span><span class="op" id="5560820">(</span><span class="ident" id="5560821">d</span><span class="op" id="5560822">.</span><span class="ident" id="5560823">r</span><span class="op" id="5560824">,</span>&nbsp;<span class="ident" id="5560826">d</span><span class="op" id="5560827">.</span><span class="ident" id="5560828">tmp</span><span class="op" id="5560831">[</span><span class="num" id="5560832">0</span><span class="op" id="5560833">:</span><span class="ident" id="5560834">size</span><span class="op" id="5560838">]</span><span class="op" id="5560839">)</span><span class="op" id="5560840">;</span>&nbsp;<span class="ident" id="5560842">err</span>&nbsp;<span class="op" id="5560846">!=</span>&nbsp;<span class="ident" id="5560849">nil</span>&nbsp;<span class="op" id="5560853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560858">return</span>&nbsp;<span class="ident" id="5560865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560874">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560878">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560953">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5560994">if</span>&nbsp;<span class="ident" id="5560997">extension</span>&nbsp;<span class="op" id="5561007">==</span>&nbsp;<span class="ident" id="5561010">eApplication</span>&nbsp;<span class="op" id="5561023">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5561026">string</span><span class="op" id="5561032">(</span><span class="ident" id="5561033">d</span><span class="op" id="5561034">.</span><span class="ident" id="5561035">tmp</span><span class="op" id="5561038">[</span><span class="op" id="5561039">:</span><span class="ident" id="5561040">size</span><span class="op" id="5561044">]</span><span class="op" id="5561045">)</span>&nbsp;<span class="op" id="5561047">==</span>&nbsp;<span class="string" id="5561050">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="5561064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561068">n</span><span class="op" id="5561069">,</span>&nbsp;<span class="ident" id="5561071">err</span>&nbsp;<span class="op" id="5561075">:=</span>&nbsp;<span class="ident" id="5561078">d</span><span class="op" id="5561079">.</span><span class="ident" id="5561080">readBlock</span><span class="op" id="5561089">(</span><span class="op" id="5561090">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561094">if</span>&nbsp;<span class="ident" id="5561097">n</span>&nbsp;<span class="op" id="5561099">==</span>&nbsp;<span class="num" id="5561102">0</span>&nbsp;<span class="op" id="5561104">||</span>&nbsp;<span class="ident" id="5561107">err</span>&nbsp;<span class="op" id="5561111">!=</span>&nbsp;<span class="ident" id="5561114">nil</span>&nbsp;<span class="op" id="5561118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561123">return</span>&nbsp;<span class="ident" id="5561130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561140">if</span>&nbsp;<span class="ident" id="5561143">n</span>&nbsp;<span class="op" id="5561145">==</span>&nbsp;<span class="num" id="5561148">3</span>&nbsp;<span class="op" id="5561150">&amp;&amp;</span>&nbsp;<span class="ident" id="5561153">d</span><span class="op" id="5561154">.</span><span class="ident" id="5561155">tmp</span><span class="op" id="5561158">[</span><span class="num" id="5561159">0</span><span class="op" id="5561160">]</span>&nbsp;<span class="op" id="5561162">==</span>&nbsp;<span class="num" id="5561165">1</span>&nbsp;<span class="op" id="5561167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561172">d</span><span class="op" id="5561173">.</span><span class="ident" id="5561174">loopCount</span>&nbsp;<span class="op" id="5561184">=</span>&nbsp;<span class="builtintype" id="5561186">int</span><span class="op" id="5561189">(</span><span class="ident" id="5561190">d</span><span class="op" id="5561191">.</span><span class="ident" id="5561192">tmp</span><span class="op" id="5561195">[</span><span class="num" id="5561196">1</span><span class="op" id="5561197">]</span><span class="op" id="5561198">)</span>&nbsp;<span class="op" id="5561200">|</span>&nbsp;<span class="builtintype" id="5561202">int</span><span class="op" id="5561205">(</span><span class="ident" id="5561206">d</span><span class="op" id="5561207">.</span><span class="ident" id="5561208">tmp</span><span class="op" id="5561211">[</span><span class="num" id="5561212">2</span><span class="op" id="5561213">]</span><span class="op" id="5561214">)</span><span class="op" id="5561215">&lt;&lt;</span><span class="num" id="5561217">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561227">for</span>&nbsp;<span class="op" id="5561231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561235">n</span><span class="op" id="5561236">,</span>&nbsp;<span class="ident" id="5561238">err</span>&nbsp;<span class="op" id="5561242">:=</span>&nbsp;<span class="ident" id="5561245">d</span><span class="op" id="5561246">.</span><span class="ident" id="5561247">readBlock</span><span class="op" id="5561256">(</span><span class="op" id="5561257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561261">if</span>&nbsp;<span class="ident" id="5561264">n</span>&nbsp;<span class="op" id="5561266">==</span>&nbsp;<span class="num" id="5561269">0</span>&nbsp;<span class="op" id="5561271">||</span>&nbsp;<span class="ident" id="5561274">err</span>&nbsp;<span class="op" id="5561278">!=</span>&nbsp;<span class="ident" id="5561281">nil</span>&nbsp;<span class="op" id="5561285">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561290">return</span>&nbsp;<span class="ident" id="5561297">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561306">}</span><br>
<span class="lineno"></span><span class="op" id="5561308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="5561311">func</span>&nbsp;<span class="op" id="5561316">(</span><span class="ident" id="5561317">d</span>&nbsp;<span class="op" id="5561319">*</span><span class="ident" id="5561320">decoder</span><span class="op" id="5561327">)</span>&nbsp;<span class="ident" id="5561329">readGraphicControl</span><span class="op" id="5561347">(</span><span class="op" id="5561348">)</span>&nbsp;<span class="builtintype" id="5561350">error</span>&nbsp;<span class="op" id="5561356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561359">if</span>&nbsp;<span class="ident" id="5561362">_</span><span class="op" id="5561363">,</span>&nbsp;<span class="ident" id="5561365">err</span>&nbsp;<span class="op" id="5561369">:=</span>&nbsp;<span class="ident" id="5561372">io</span><span class="op" id="5561374">.</span><span class="ident" id="5561375">ReadFull</span><span class="op" id="5561383">(</span><span class="ident" id="5561384">d</span><span class="op" id="5561385">.</span><span class="ident" id="5561386">r</span><span class="op" id="5561387">,</span>&nbsp;<span class="ident" id="5561389">d</span><span class="op" id="5561390">.</span><span class="ident" id="5561391">tmp</span><span class="op" id="5561394">[</span><span class="num" id="5561395">0</span><span class="op" id="5561396">:</span><span class="num" id="5561397">6</span><span class="op" id="5561398">]</span><span class="op" id="5561399">)</span><span class="op" id="5561400">;</span>&nbsp;<span class="ident" id="5561402">err</span>&nbsp;<span class="op" id="5561406">!=</span>&nbsp;<span class="ident" id="5561409">nil</span>&nbsp;<span class="op" id="5561413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561417">return</span>&nbsp;<span class="ident" id="5561424">fmt</span><span class="op" id="5561427">.</span><span class="ident" id="5561428">Errorf</span><span class="op" id="5561434">(</span><span class="string" id="5561435">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="5561472">,</span>&nbsp;<span class="ident" id="5561474">err</span><span class="op" id="5561477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561483">d</span><span class="op" id="5561484">.</span><span class="ident" id="5561485">flags</span>&nbsp;<span class="op" id="5561491">=</span>&nbsp;<span class="ident" id="5561493">d</span><span class="op" id="5561494">.</span><span class="ident" id="5561495">tmp</span><span class="op" id="5561498">[</span><span class="num" id="5561499">1</span><span class="op" id="5561500">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561503">d</span><span class="op" id="5561504">.</span><span class="ident" id="5561505">delayTime</span>&nbsp;<span class="op" id="5561515">=</span>&nbsp;<span class="builtintype" id="5561517">int</span><span class="op" id="5561520">(</span><span class="ident" id="5561521">d</span><span class="op" id="5561522">.</span><span class="ident" id="5561523">tmp</span><span class="op" id="5561526">[</span><span class="num" id="5561527">2</span><span class="op" id="5561528">]</span><span class="op" id="5561529">)</span>&nbsp;<span class="op" id="5561531">|</span>&nbsp;<span class="builtintype" id="5561533">int</span><span class="op" id="5561536">(</span><span class="ident" id="5561537">d</span><span class="op" id="5561538">.</span><span class="ident" id="5561539">tmp</span><span class="op" id="5561542">[</span><span class="num" id="5561543">3</span><span class="op" id="5561544">]</span><span class="op" id="5561545">)</span><span class="op" id="5561546">&lt;&lt;</span><span class="num" id="5561548">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561551">if</span>&nbsp;<span class="ident" id="5561554">d</span><span class="op" id="5561555">.</span><span class="ident" id="5561556">flags</span><span class="op" id="5561561">&amp;</span><span class="ident" id="5561562">gcTransparentColorSet</span>&nbsp;<span class="op" id="5561584">!=</span>&nbsp;<span class="num" id="5561587">0</span>&nbsp;<span class="op" id="5561589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561593">d</span><span class="op" id="5561594">.</span><span class="ident" id="5561595">transparentIndex</span>&nbsp;<span class="op" id="5561612">=</span>&nbsp;<span class="ident" id="5561614">d</span><span class="op" id="5561615">.</span><span class="ident" id="5561616">tmp</span><span class="op" id="5561619">[</span><span class="num" id="5561620">4</span><span class="op" id="5561621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561625">d</span><span class="op" id="5561626">.</span><span class="ident" id="5561627">hasTransparentIndex</span>&nbsp;<span class="op" id="5561647">=</span>&nbsp;<span class="builtintype" id="5561649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561655">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561658">return</span>&nbsp;<span class="ident" id="5561665">nil</span><br>
<span class="lineno"></span><span class="op" id="5561669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5561672">func</span>&nbsp;<span class="op" id="5561677">(</span><span class="ident" id="5561678">d</span>&nbsp;<span class="op" id="5561680">*</span><span class="ident" id="5561681">decoder</span><span class="op" id="5561688">)</span>&nbsp;<span class="ident" id="5561690">newImageFromDescriptor</span><span class="op" id="5561712">(</span><span class="op" id="5561713">)</span>&nbsp;<span class="op" id="5561715">(</span><span class="op" id="5561716">*</span><span class="ident" id="5561717">image</span><span class="op" id="5561722">.</span><span class="ident" id="5561723">Paletted</span><span class="op" id="5561731">,</span>&nbsp;<span class="builtintype" id="5561733">error</span><span class="op" id="5561738">)</span>&nbsp;<span class="op" id="5561740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561743">if</span>&nbsp;<span class="ident" id="5561746">_</span><span class="op" id="5561747">,</span>&nbsp;<span class="ident" id="5561749">err</span>&nbsp;<span class="op" id="5561753">:=</span>&nbsp;<span class="ident" id="5561756">io</span><span class="op" id="5561758">.</span><span class="ident" id="5561759">ReadFull</span><span class="op" id="5561767">(</span><span class="ident" id="5561768">d</span><span class="op" id="5561769">.</span><span class="ident" id="5561770">r</span><span class="op" id="5561771">,</span>&nbsp;<span class="ident" id="5561773">d</span><span class="op" id="5561774">.</span><span class="ident" id="5561775">tmp</span><span class="op" id="5561778">[</span><span class="num" id="5561779">0</span><span class="op" id="5561780">:</span><span class="num" id="5561781">9</span><span class="op" id="5561782">]</span><span class="op" id="5561783">)</span><span class="op" id="5561784">;</span>&nbsp;<span class="ident" id="5561786">err</span>&nbsp;<span class="op" id="5561790">!=</span>&nbsp;<span class="ident" id="5561793">nil</span>&nbsp;<span class="op" id="5561797">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5561801">return</span>&nbsp;<span class="ident" id="5561808">nil</span><span class="op" id="5561811">,</span>&nbsp;<span class="ident" id="5561813">fmt</span><span class="op" id="5561816">.</span><span class="ident" id="5561817">Errorf</span><span class="op" id="5561823">(</span><span class="string" id="5561824">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="5561862">,</span>&nbsp;<span class="ident" id="5561864">err</span><span class="op" id="5561867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5561870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561873">left</span>&nbsp;<span class="op" id="5561878">:=</span>&nbsp;<span class="builtintype" id="5561881">int</span><span class="op" id="5561884">(</span><span class="ident" id="5561885">d</span><span class="op" id="5561886">.</span><span class="ident" id="5561887">tmp</span><span class="op" id="5561890">[</span><span class="num" id="5561891">0</span><span class="op" id="5561892">]</span><span class="op" id="5561893">)</span>&nbsp;<span class="op" id="5561895">+</span>&nbsp;<span class="builtintype" id="5561897">int</span><span class="op" id="5561900">(</span><span class="ident" id="5561901">d</span><span class="op" id="5561902">.</span><span class="ident" id="5561903">tmp</span><span class="op" id="5561906">[</span><span class="num" id="5561907">1</span><span class="op" id="5561908">]</span><span class="op" id="5561909">)</span><span class="op" id="5561910">&lt;&lt;</span><span class="num" id="5561912">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561915">top</span>&nbsp;<span class="op" id="5561919">:=</span>&nbsp;<span class="builtintype" id="5561922">int</span><span class="op" id="5561925">(</span><span class="ident" id="5561926">d</span><span class="op" id="5561927">.</span><span class="ident" id="5561928">tmp</span><span class="op" id="5561931">[</span><span class="num" id="5561932">2</span><span class="op" id="5561933">]</span><span class="op" id="5561934">)</span>&nbsp;<span class="op" id="5561936">+</span>&nbsp;<span class="builtintype" id="5561938">int</span><span class="op" id="5561941">(</span><span class="ident" id="5561942">d</span><span class="op" id="5561943">.</span><span class="ident" id="5561944">tmp</span><span class="op" id="5561947">[</span><span class="num" id="5561948">3</span><span class="op" id="5561949">]</span><span class="op" id="5561950">)</span><span class="op" id="5561951">&lt;&lt;</span><span class="num" id="5561953">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561956">width</span>&nbsp;<span class="op" id="5561962">:=</span>&nbsp;<span class="builtintype" id="5561965">int</span><span class="op" id="5561968">(</span><span class="ident" id="5561969">d</span><span class="op" id="5561970">.</span><span class="ident" id="5561971">tmp</span><span class="op" id="5561974">[</span><span class="num" id="5561975">4</span><span class="op" id="5561976">]</span><span class="op" id="5561977">)</span>&nbsp;<span class="op" id="5561979">+</span>&nbsp;<span class="builtintype" id="5561981">int</span><span class="op" id="5561984">(</span><span class="ident" id="5561985">d</span><span class="op" id="5561986">.</span><span class="ident" id="5561987">tmp</span><span class="op" id="5561990">[</span><span class="num" id="5561991">5</span><span class="op" id="5561992">]</span><span class="op" id="5561993">)</span><span class="op" id="5561994">&lt;&lt;</span><span class="num" id="5561996">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5561999">height</span>&nbsp;<span class="op" id="5562006">:=</span>&nbsp;<span class="builtintype" id="5562009">int</span><span class="op" id="5562012">(</span><span class="ident" id="5562013">d</span><span class="op" id="5562014">.</span><span class="ident" id="5562015">tmp</span><span class="op" id="5562018">[</span><span class="num" id="5562019">6</span><span class="op" id="5562020">]</span><span class="op" id="5562021">)</span>&nbsp;<span class="op" id="5562023">+</span>&nbsp;<span class="builtintype" id="5562025">int</span><span class="op" id="5562028">(</span><span class="ident" id="5562029">d</span><span class="op" id="5562030">.</span><span class="ident" id="5562031">tmp</span><span class="op" id="5562034">[</span><span class="num" id="5562035">7</span><span class="op" id="5562036">]</span><span class="op" id="5562037">)</span><span class="op" id="5562038">&lt;&lt;</span><span class="num" id="5562040">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5562043">d</span><span class="op" id="5562044">.</span><span class="ident" id="5562045">imageFields</span>&nbsp;<span class="op" id="5562057">=</span>&nbsp;<span class="ident" id="5562059">d</span><span class="op" id="5562060">.</span><span class="ident" id="5562061">tmp</span><span class="op" id="5562064">[</span><span class="num" id="5562065">8</span><span class="op" id="5562066">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5562070">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5562127">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5562189">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5562247">bounds</span>&nbsp;<span class="op" id="5562254">:=</span>&nbsp;<span class="ident" id="5562257">image</span><span class="op" id="5562262">.</span><span class="ident" id="5562263">Rect</span><span class="op" id="5562267">(</span><span class="ident" id="5562268">left</span><span class="op" id="5562272">,</span>&nbsp;<span class="ident" id="5562274">top</span><span class="op" id="5562277">,</span>&nbsp;<span class="ident" id="5562279">left</span><span class="op" id="5562283">+</span><span class="ident" id="5562284">width</span><span class="op" id="5562289">,</span>&nbsp;<span class="ident" id="5562291">top</span><span class="op" id="5562294">+</span><span class="ident" id="5562295">height</span><span class="op" id="5562301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562304">if</span>&nbsp;<span class="ident" id="5562307">bounds</span>&nbsp;<span class="op" id="5562314">!=</span>&nbsp;<span class="ident" id="5562317">bounds</span><span class="op" id="5562323">.</span><span class="ident" id="5562324">Intersect</span><span class="op" id="5562333">(</span><span class="ident" id="5562334">image</span><span class="op" id="5562339">.</span><span class="ident" id="5562340">Rect</span><span class="op" id="5562344">(</span><span class="num" id="5562345">0</span><span class="op" id="5562346">,</span>&nbsp;<span class="num" id="5562348">0</span><span class="op" id="5562349">,</span>&nbsp;<span class="ident" id="5562351">d</span><span class="op" id="5562352">.</span><span class="ident" id="5562353">width</span><span class="op" id="5562358">,</span>&nbsp;<span class="ident" id="5562360">d</span><span class="op" id="5562361">.</span><span class="ident" id="5562362">height</span><span class="op" id="5562368">)</span><span class="op" id="5562369">)</span>&nbsp;<span class="op" id="5562371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562375">return</span>&nbsp;<span class="ident" id="5562382">nil</span><span class="op" id="5562385">,</span>&nbsp;<span class="ident" id="5562387">errors</span><span class="op" id="5562393">.</span><span class="ident" id="5562394">New</span><span class="op" id="5562397">(</span><span class="string" id="5562398">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="5562442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5562445">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562448">return</span>&nbsp;<span class="ident" id="5562455">image</span><span class="op" id="5562460">.</span><span class="ident" id="5562461">NewPaletted</span><span class="op" id="5562472">(</span><span class="ident" id="5562473">bounds</span><span class="op" id="5562479">,</span>&nbsp;<span class="ident" id="5562481">nil</span><span class="op" id="5562484">)</span><span class="op" id="5562485">,</span>&nbsp;<span class="ident" id="5562487">nil</span><br>
<span class="lineno"></span><span class="op" id="5562491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5562494">func</span>&nbsp;<span class="op" id="5562499">(</span><span class="ident" id="5562500">d</span>&nbsp;<span class="op" id="5562502">*</span><span class="ident" id="5562503">decoder</span><span class="op" id="5562510">)</span>&nbsp;<span class="ident" id="5562512">readBlock</span><span class="op" id="5562521">(</span><span class="op" id="5562522">)</span>&nbsp;<span class="op" id="5562524">(</span><span class="builtintype" id="5562525">int</span><span class="op" id="5562528">,</span>&nbsp;<span class="builtintype" id="5562530">error</span><span class="op" id="5562535">)</span>&nbsp;<span class="op" id="5562537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5562540">n</span><span class="op" id="5562541">,</span>&nbsp;<span class="ident" id="5562543">err</span>&nbsp;<span class="op" id="5562547">:=</span>&nbsp;<span class="ident" id="5562550">d</span><span class="op" id="5562551">.</span><span class="ident" id="5562552">r</span><span class="op" id="5562553">.</span><span class="ident" id="5562554">ReadByte</span><span class="op" id="5562562">(</span><span class="op" id="5562563">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562566">if</span>&nbsp;<span class="ident" id="5562569">n</span>&nbsp;<span class="op" id="5562571">==</span>&nbsp;<span class="num" id="5562574">0</span>&nbsp;<span class="op" id="5562576">||</span>&nbsp;<span class="ident" id="5562579">err</span>&nbsp;<span class="op" id="5562583">!=</span>&nbsp;<span class="ident" id="5562586">nil</span>&nbsp;<span class="op" id="5562590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562594">return</span>&nbsp;<span class="num" id="5562601">0</span><span class="op" id="5562602">,</span>&nbsp;<span class="ident" id="5562604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5562609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5562612">return</span>&nbsp;<span class="ident" id="5562619">io</span><span class="op" id="5562621">.</span><span class="ident" id="5562622">ReadFull</span><span class="op" id="5562630">(</span><span class="ident" id="5562631">d</span><span class="op" id="5562632">.</span><span class="ident" id="5562633">r</span><span class="op" id="5562634">,</span>&nbsp;<span class="ident" id="5562636">d</span><span class="op" id="5562637">.</span><span class="ident" id="5562638">tmp</span><span class="op" id="5562641">[</span><span class="num" id="5562642">0</span><span class="op" id="5562643">:</span><span class="ident" id="5562644">n</span><span class="op" id="5562645">]</span><span class="op" id="5562646">)</span><br>
<span class="lineno"></span><span class="op" id="5562648">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="5562651">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="5562728">type</span>&nbsp;<span class="ident" id="5562733">interlaceScan</span>&nbsp;<span class="keyword" id="5562747">struct</span>&nbsp;<span class="op" id="5562754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5562757">skip</span><span class="op" id="5562761">,</span>&nbsp;<span class="ident" id="5562763">start</span>&nbsp;<span class="builtintype" id="5562769">int</span><br>
<span class="lineno"></span><span class="op" id="5562773">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="5562776">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5562847">var</span>&nbsp;<span class="ident" id="5562851">interlacing</span>&nbsp;<span class="op" id="5562863">=</span>&nbsp;<span class="op" id="5562865">[</span><span class="op" id="5562866">]</span><span class="ident" id="5562867">interlaceScan</span><span class="op" id="5562880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5562883">{</span><span class="num" id="5562884">8</span><span class="op" id="5562885">,</span>&nbsp;<span class="num" id="5562887">0</span><span class="op" id="5562888">}</span><span class="op" id="5562889">,</span>&nbsp;<span class="comment" id="5562891">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5562942">{</span><span class="num" id="5562943">8</span><span class="op" id="5562944">,</span>&nbsp;<span class="num" id="5562946">4</span><span class="op" id="5562947">}</span><span class="op" id="5562948">,</span>&nbsp;<span class="comment" id="5562950">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5563001">{</span><span class="num" id="5563002">4</span><span class="op" id="5563003">,</span>&nbsp;<span class="num" id="5563005">2</span><span class="op" id="5563006">}</span><span class="op" id="5563007">,</span>&nbsp;<span class="comment" id="5563009">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5563060">{</span><span class="num" id="5563061">2</span><span class="op" id="5563062">,</span>&nbsp;<span class="num" id="5563064">1</span><span class="op" id="5563065">}</span><span class="op" id="5563066">,</span>&nbsp;<span class="comment" id="5563068">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="5563118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5563121">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="5563196">func</span>&nbsp;<span class="ident" id="5563201">uninterlace</span><span class="op" id="5563212">(</span><span class="ident" id="5563213">m</span>&nbsp;<span class="op" id="5563215">*</span><span class="ident" id="5563216">image</span><span class="op" id="5563221">.</span><span class="ident" id="5563222">Paletted</span><span class="op" id="5563230">)</span>&nbsp;<span class="op" id="5563232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563235">var</span>&nbsp;<span class="ident" id="5563239">nPix</span>&nbsp;<span class="op" id="5563244">[</span><span class="op" id="5563245">]</span><span class="builtintype" id="5563246">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563253">dx</span>&nbsp;<span class="op" id="5563256">:=</span>&nbsp;<span class="ident" id="5563259">m</span><span class="op" id="5563260">.</span><span class="ident" id="5563261">Bounds</span><span class="op" id="5563267">(</span><span class="op" id="5563268">)</span><span class="op" id="5563269">.</span><span class="ident" id="5563270">Dx</span><span class="op" id="5563272">(</span><span class="op" id="5563273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563276">dy</span>&nbsp;<span class="op" id="5563279">:=</span>&nbsp;<span class="ident" id="5563282">m</span><span class="op" id="5563283">.</span><span class="ident" id="5563284">Bounds</span><span class="op" id="5563290">(</span><span class="op" id="5563291">)</span><span class="op" id="5563292">.</span><span class="ident" id="5563293">Dy</span><span class="op" id="5563295">(</span><span class="op" id="5563296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563299">nPix</span>&nbsp;<span class="op" id="5563304">=</span>&nbsp;<span class="builtinfunc" id="5563306">make</span><span class="op" id="5563310">(</span><span class="op" id="5563311">[</span><span class="op" id="5563312">]</span><span class="builtintype" id="5563313">uint8</span><span class="op" id="5563318">,</span>&nbsp;<span class="ident" id="5563320">dx</span><span class="op" id="5563322">*</span><span class="ident" id="5563323">dy</span><span class="op" id="5563325">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563328">offset</span>&nbsp;<span class="op" id="5563335">:=</span>&nbsp;<span class="num" id="5563338">0</span>&nbsp;<span class="comment" id="5563340">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563394">for</span>&nbsp;<span class="ident" id="5563398">_</span><span class="op" id="5563399">,</span>&nbsp;<span class="ident" id="5563401">pass</span>&nbsp;<span class="op" id="5563406">:=</span>&nbsp;<span class="keyword" id="5563409">range</span>&nbsp;<span class="ident" id="5563415">interlacing</span>&nbsp;<span class="op" id="5563427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563431">nOffset</span>&nbsp;<span class="op" id="5563439">:=</span>&nbsp;<span class="ident" id="5563442">pass</span><span class="op" id="5563446">.</span><span class="ident" id="5563447">start</span>&nbsp;<span class="op" id="5563453">*</span>&nbsp;<span class="ident" id="5563455">dx</span>&nbsp;<span class="comment" id="5563458">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563508">for</span>&nbsp;<span class="ident" id="5563512">y</span>&nbsp;<span class="op" id="5563514">:=</span>&nbsp;<span class="ident" id="5563517">pass</span><span class="op" id="5563521">.</span><span class="ident" id="5563522">start</span><span class="op" id="5563527">;</span>&nbsp;<span class="ident" id="5563529">y</span>&nbsp;<span class="op" id="5563531">&lt;</span>&nbsp;<span class="ident" id="5563533">dy</span><span class="op" id="5563535">;</span>&nbsp;<span class="ident" id="5563537">y</span>&nbsp;<span class="op" id="5563539">+=</span>&nbsp;<span class="ident" id="5563542">pass</span><span class="op" id="5563546">.</span><span class="ident" id="5563547">skip</span>&nbsp;<span class="op" id="5563552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5563557">copy</span><span class="op" id="5563561">(</span><span class="ident" id="5563562">nPix</span><span class="op" id="5563566">[</span><span class="ident" id="5563567">nOffset</span><span class="op" id="5563574">:</span><span class="ident" id="5563575">nOffset</span><span class="op" id="5563582">+</span><span class="ident" id="5563583">dx</span><span class="op" id="5563585">]</span><span class="op" id="5563586">,</span>&nbsp;<span class="ident" id="5563588">m</span><span class="op" id="5563589">.</span><span class="ident" id="5563590">Pix</span><span class="op" id="5563593">[</span><span class="ident" id="5563594">offset</span><span class="op" id="5563600">:</span><span class="ident" id="5563601">offset</span><span class="op" id="5563607">+</span><span class="ident" id="5563608">dx</span><span class="op" id="5563610">]</span><span class="op" id="5563611">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563616">offset</span>&nbsp;<span class="op" id="5563623">+=</span>&nbsp;<span class="ident" id="5563626">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563632">nOffset</span>&nbsp;<span class="op" id="5563640">+=</span>&nbsp;<span class="ident" id="5563643">dx</span>&nbsp;<span class="op" id="5563646">*</span>&nbsp;<span class="ident" id="5563648">pass</span><span class="op" id="5563652">.</span><span class="ident" id="5563653">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5563660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5563663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5563666">m</span><span class="op" id="5563667">.</span><span class="ident" id="5563668">Pix</span>&nbsp;<span class="op" id="5563672">=</span>&nbsp;<span class="ident" id="5563674">nPix</span><br>
<span class="lineno">415</span><span class="op" id="5563679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5563682">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="5563748">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5563776">func</span>&nbsp;<span class="ident" id="5563781">Decode</span><span class="op" id="5563787">(</span><span class="ident" id="5563788">r</span>&nbsp;<span class="ident" id="5563790">io</span><span class="op" id="5563792">.</span><span class="ident" id="5563793">Reader</span><span class="op" id="5563799">)</span>&nbsp;<span class="op" id="5563801">(</span><span class="ident" id="5563802">image</span><span class="op" id="5563807">.</span><span class="ident" id="5563808">Image</span><span class="op" id="5563813">,</span>&nbsp;<span class="builtintype" id="5563815">error</span><span class="op" id="5563820">)</span>&nbsp;<span class="op" id="5563822">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563825">var</span>&nbsp;<span class="ident" id="5563829">d</span>&nbsp;<span class="ident" id="5563831">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563840">if</span>&nbsp;<span class="ident" id="5563843">err</span>&nbsp;<span class="op" id="5563847">:=</span>&nbsp;<span class="ident" id="5563850">d</span><span class="op" id="5563851">.</span><span class="ident" id="5563852">decode</span><span class="op" id="5563858">(</span><span class="ident" id="5563859">r</span><span class="op" id="5563860">,</span>&nbsp;<span class="builtintype" id="5563862">false</span><span class="op" id="5563867">)</span><span class="op" id="5563868">;</span>&nbsp;<span class="ident" id="5563870">err</span>&nbsp;<span class="op" id="5563874">!=</span>&nbsp;<span class="ident" id="5563877">nil</span>&nbsp;<span class="op" id="5563881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563885">return</span>&nbsp;<span class="ident" id="5563892">nil</span><span class="op" id="5563895">,</span>&nbsp;<span class="ident" id="5563897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5563902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5563905">return</span>&nbsp;<span class="ident" id="5563912">d</span><span class="op" id="5563913">.</span><span class="ident" id="5563914">image</span><span class="op" id="5563919">[</span><span class="num" id="5563920">0</span><span class="op" id="5563921">]</span><span class="op" id="5563922">,</span>&nbsp;<span class="ident" id="5563924">nil</span><br>
<span class="lineno">425</span><span class="op" id="5563928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5563931">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5564000">type</span>&nbsp;<span class="ident" id="5564005">GIF</span>&nbsp;<span class="keyword" id="5564009">struct</span>&nbsp;<span class="op" id="5564016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564019">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564029">[</span><span class="op" id="5564030">]</span><span class="op" id="5564031">*</span><span class="ident" id="5564032">image</span><span class="op" id="5564037">.</span><span class="ident" id="5564038">Paletted</span>&nbsp;<span class="comment" id="5564047">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564074">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564084">[</span><span class="op" id="5564085">]</span><span class="builtintype" id="5564086">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5564102">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564172">LoopCount</span>&nbsp;<span class="builtintype" id="5564182">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5564200">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="5564219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5564222">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="5564294">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5564321">func</span>&nbsp;<span class="ident" id="5564326">DecodeAll</span><span class="op" id="5564335">(</span><span class="ident" id="5564336">r</span>&nbsp;<span class="ident" id="5564338">io</span><span class="op" id="5564340">.</span><span class="ident" id="5564341">Reader</span><span class="op" id="5564347">)</span>&nbsp;<span class="op" id="5564349">(</span><span class="op" id="5564350">*</span><span class="ident" id="5564351">GIF</span><span class="op" id="5564354">,</span>&nbsp;<span class="builtintype" id="5564356">error</span><span class="op" id="5564361">)</span>&nbsp;<span class="op" id="5564363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564366">var</span>&nbsp;<span class="ident" id="5564370">d</span>&nbsp;<span class="ident" id="5564372">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564381">if</span>&nbsp;<span class="ident" id="5564384">err</span>&nbsp;<span class="op" id="5564388">:=</span>&nbsp;<span class="ident" id="5564391">d</span><span class="op" id="5564392">.</span><span class="ident" id="5564393">decode</span><span class="op" id="5564399">(</span><span class="ident" id="5564400">r</span><span class="op" id="5564401">,</span>&nbsp;<span class="builtintype" id="5564403">false</span><span class="op" id="5564408">)</span><span class="op" id="5564409">;</span>&nbsp;<span class="ident" id="5564411">err</span>&nbsp;<span class="op" id="5564415">!=</span>&nbsp;<span class="ident" id="5564418">nil</span>&nbsp;<span class="op" id="5564422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564426">return</span>&nbsp;<span class="ident" id="5564433">nil</span><span class="op" id="5564436">,</span>&nbsp;<span class="ident" id="5564438">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564446">gif</span>&nbsp;<span class="op" id="5564450">:=</span>&nbsp;<span class="op" id="5564453">&amp;</span><span class="ident" id="5564454">GIF</span><span class="op" id="5564457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564461">Image</span><span class="op" id="5564466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564472">d</span><span class="op" id="5564473">.</span><span class="ident" id="5564474">image</span><span class="op" id="5564479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564483">LoopCount</span><span class="op" id="5564492">:</span>&nbsp;<span class="ident" id="5564494">d</span><span class="op" id="5564495">.</span><span class="ident" id="5564496">loopCount</span><span class="op" id="5564505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564509">Delay</span><span class="op" id="5564514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564520">d</span><span class="op" id="5564521">.</span><span class="ident" id="5564522">delay</span><span class="op" id="5564527">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564533">return</span>&nbsp;<span class="ident" id="5564540">gif</span><span class="op" id="5564543">,</span>&nbsp;<span class="ident" id="5564545">nil</span><br>
<span class="lineno"></span><span class="op" id="5564549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5564552">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="5564629">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5564667">func</span>&nbsp;<span class="ident" id="5564672">DecodeConfig</span><span class="op" id="5564684">(</span><span class="ident" id="5564685">r</span>&nbsp;<span class="ident" id="5564687">io</span><span class="op" id="5564689">.</span><span class="ident" id="5564690">Reader</span><span class="op" id="5564696">)</span>&nbsp;<span class="op" id="5564698">(</span><span class="ident" id="5564699">image</span><span class="op" id="5564704">.</span><span class="ident" id="5564705">Config</span><span class="op" id="5564711">,</span>&nbsp;<span class="builtintype" id="5564713">error</span><span class="op" id="5564718">)</span>&nbsp;<span class="op" id="5564720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564723">var</span>&nbsp;<span class="ident" id="5564727">d</span>&nbsp;<span class="ident" id="5564729">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564738">if</span>&nbsp;<span class="ident" id="5564741">err</span>&nbsp;<span class="op" id="5564745">:=</span>&nbsp;<span class="ident" id="5564748">d</span><span class="op" id="5564749">.</span><span class="ident" id="5564750">decode</span><span class="op" id="5564756">(</span><span class="ident" id="5564757">r</span><span class="op" id="5564758">,</span>&nbsp;<span class="builtintype" id="5564760">true</span><span class="op" id="5564764">)</span><span class="op" id="5564765">;</span>&nbsp;<span class="ident" id="5564767">err</span>&nbsp;<span class="op" id="5564771">!=</span>&nbsp;<span class="ident" id="5564774">nil</span>&nbsp;<span class="op" id="5564778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564782">return</span>&nbsp;<span class="ident" id="5564789">image</span><span class="op" id="5564794">.</span><span class="ident" id="5564795">Config</span><span class="op" id="5564801">{</span><span class="op" id="5564802">}</span><span class="op" id="5564803">,</span>&nbsp;<span class="ident" id="5564805">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5564813">return</span>&nbsp;<span class="ident" id="5564820">image</span><span class="op" id="5564825">.</span><span class="ident" id="5564826">Config</span><span class="op" id="5564832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564836">ColorModel</span><span class="op" id="5564846">:</span>&nbsp;<span class="ident" id="5564848">d</span><span class="op" id="5564849">.</span><span class="ident" id="5564850">globalColorMap</span><span class="op" id="5564864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564868">Width</span><span class="op" id="5564873">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564880">d</span><span class="op" id="5564881">.</span><span class="ident" id="5564882">width</span><span class="op" id="5564887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564891">Height</span><span class="op" id="5564897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564903">d</span><span class="op" id="5564904">.</span><span class="ident" id="5564905">height</span><span class="op" id="5564911">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5564914">}</span><span class="op" id="5564915">,</span>&nbsp;<span class="ident" id="5564917">nil</span><br>
<span class="lineno"></span><span class="op" id="5564921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5564924">func</span>&nbsp;<span class="ident" id="5564929">init</span><span class="op" id="5564933">(</span><span class="op" id="5564934">)</span>&nbsp;<span class="op" id="5564936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5564939">image</span><span class="op" id="5564944">.</span><span class="ident" id="5564945">RegisterFormat</span><span class="op" id="5564959">(</span><span class="string" id="5564960">&#34;gif&#34;</span><span class="op" id="5564965">,</span>&nbsp;<span class="string" id="5564967">&#34;GIF8?a&#34;</span><span class="op" id="5564975">,</span>&nbsp;<span class="ident" id="5564977">Decode</span><span class="op" id="5564983">,</span>&nbsp;<span class="ident" id="5564985">DecodeConfig</span><span class="op" id="5564997">)</span><br>
<span class="lineno">465</span><span class="op" id="5564999">}</span>
</div>
</body>
</html>
