<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3749860">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3749915">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3749969">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3750020">package</span>&nbsp;<span class="ident" id="3750028">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750033">import</span>&nbsp;<span class="op" id="3750040">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750043">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750053">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750068">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750082">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750097">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3750114">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3750121">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3750124">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3750196">func</span>&nbsp;<span class="ident" id="3750201">splitPreMasterSecret</span><span class="op" id="3750221">(</span><span class="ident" id="3750222">secret</span>&nbsp;<span class="op" id="3750229">[</span><span class="op" id="3750230">]</span><span class="builtintype" id="3750231">byte</span><span class="op" id="3750235">)</span>&nbsp;<span class="op" id="3750237">(</span><span class="ident" id="3750238">s1</span><span class="op" id="3750240">,</span>&nbsp;<span class="ident" id="3750242">s2</span>&nbsp;<span class="op" id="3750245">[</span><span class="op" id="3750246">]</span><span class="builtintype" id="3750247">byte</span><span class="op" id="3750251">)</span>&nbsp;<span class="op" id="3750253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750256">s1</span>&nbsp;<span class="op" id="3750259">=</span>&nbsp;<span class="ident" id="3750261">secret</span><span class="op" id="3750267">[</span><span class="num" id="3750268">0</span>&nbsp;<span class="op" id="3750270">:</span>&nbsp;<span class="op" id="3750272">(</span><span class="builtinfunc" id="3750273">len</span><span class="op" id="3750276">(</span><span class="ident" id="3750277">secret</span><span class="op" id="3750283">)</span><span class="op" id="3750284">+</span><span class="num" id="3750285">1</span><span class="op" id="3750286">)</span><span class="op" id="3750287">/</span><span class="num" id="3750288">2</span><span class="op" id="3750289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750292">s2</span>&nbsp;<span class="op" id="3750295">=</span>&nbsp;<span class="ident" id="3750297">secret</span><span class="op" id="3750303">[</span><span class="builtinfunc" id="3750304">len</span><span class="op" id="3750307">(</span><span class="ident" id="3750308">secret</span><span class="op" id="3750314">)</span><span class="op" id="3750315">/</span><span class="num" id="3750316">2</span><span class="op" id="3750317">:</span><span class="op" id="3750318">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750321">return</span><br>
<span class="lineno"></span><span class="op" id="3750328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3750331">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3750407">func</span>&nbsp;<span class="ident" id="3750412">pHash</span><span class="op" id="3750417">(</span><span class="ident" id="3750418">result</span><span class="op" id="3750424">,</span>&nbsp;<span class="ident" id="3750426">secret</span><span class="op" id="3750432">,</span>&nbsp;<span class="ident" id="3750434">seed</span>&nbsp;<span class="op" id="3750439">[</span><span class="op" id="3750440">]</span><span class="builtintype" id="3750441">byte</span><span class="op" id="3750445">,</span>&nbsp;<span class="ident" id="3750447">hash</span>&nbsp;<span class="keyword" id="3750452">func</span><span class="op" id="3750456">(</span><span class="op" id="3750457">)</span>&nbsp;<span class="ident" id="3750459">hash</span><span class="op" id="3750463">.</span><span class="ident" id="3750464">Hash</span><span class="op" id="3750468">)</span>&nbsp;<span class="op" id="3750470">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750473">h</span>&nbsp;<span class="op" id="3750475">:=</span>&nbsp;<span class="ident" id="3750478">hmac</span><span class="op" id="3750482">.</span><span class="ident" id="3750483">New</span><span class="op" id="3750486">(</span><span class="ident" id="3750487">hash</span><span class="op" id="3750491">,</span>&nbsp;<span class="ident" id="3750493">secret</span><span class="op" id="3750499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750502">h</span><span class="op" id="3750503">.</span><span class="ident" id="3750504">Write</span><span class="op" id="3750509">(</span><span class="ident" id="3750510">seed</span><span class="op" id="3750514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750517">a</span>&nbsp;<span class="op" id="3750519">:=</span>&nbsp;<span class="ident" id="3750522">h</span><span class="op" id="3750523">.</span><span class="ident" id="3750524">Sum</span><span class="op" id="3750527">(</span><span class="ident" id="3750528">nil</span><span class="op" id="3750531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750535">j</span>&nbsp;<span class="op" id="3750537">:=</span>&nbsp;<span class="num" id="3750540">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750543">for</span>&nbsp;<span class="ident" id="3750547">j</span>&nbsp;<span class="op" id="3750549">&lt;</span>&nbsp;<span class="builtinfunc" id="3750551">len</span><span class="op" id="3750554">(</span><span class="ident" id="3750555">result</span><span class="op" id="3750561">)</span>&nbsp;<span class="op" id="3750563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750567">h</span><span class="op" id="3750568">.</span><span class="ident" id="3750569">Reset</span><span class="op" id="3750574">(</span><span class="op" id="3750575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750579">h</span><span class="op" id="3750580">.</span><span class="ident" id="3750581">Write</span><span class="op" id="3750586">(</span><span class="ident" id="3750587">a</span><span class="op" id="3750588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750592">h</span><span class="op" id="3750593">.</span><span class="ident" id="3750594">Write</span><span class="op" id="3750599">(</span><span class="ident" id="3750600">seed</span><span class="op" id="3750604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750608">b</span>&nbsp;<span class="op" id="3750610">:=</span>&nbsp;<span class="ident" id="3750613">h</span><span class="op" id="3750614">.</span><span class="ident" id="3750615">Sum</span><span class="op" id="3750618">(</span><span class="ident" id="3750619">nil</span><span class="op" id="3750622">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750626">todo</span>&nbsp;<span class="op" id="3750631">:=</span>&nbsp;<span class="builtinfunc" id="3750634">len</span><span class="op" id="3750637">(</span><span class="ident" id="3750638">b</span><span class="op" id="3750639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750643">if</span>&nbsp;<span class="ident" id="3750646">j</span><span class="op" id="3750647">+</span><span class="ident" id="3750648">todo</span>&nbsp;<span class="op" id="3750653">&gt;</span>&nbsp;<span class="builtinfunc" id="3750655">len</span><span class="op" id="3750658">(</span><span class="ident" id="3750659">result</span><span class="op" id="3750665">)</span>&nbsp;<span class="op" id="3750667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750672">todo</span>&nbsp;<span class="op" id="3750677">=</span>&nbsp;<span class="builtinfunc" id="3750679">len</span><span class="op" id="3750682">(</span><span class="ident" id="3750683">result</span><span class="op" id="3750689">)</span>&nbsp;<span class="op" id="3750691">-</span>&nbsp;<span class="ident" id="3750693">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3750697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3750701">copy</span><span class="op" id="3750705">(</span><span class="ident" id="3750706">result</span><span class="op" id="3750712">[</span><span class="ident" id="3750713">j</span><span class="op" id="3750714">:</span><span class="ident" id="3750715">j</span><span class="op" id="3750716">+</span><span class="ident" id="3750717">todo</span><span class="op" id="3750721">]</span><span class="op" id="3750722">,</span>&nbsp;<span class="ident" id="3750724">b</span><span class="op" id="3750725">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750729">j</span>&nbsp;<span class="op" id="3750731">+=</span>&nbsp;<span class="ident" id="3750734">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750742">h</span><span class="op" id="3750743">.</span><span class="ident" id="3750744">Reset</span><span class="op" id="3750749">(</span><span class="op" id="3750750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750754">h</span><span class="op" id="3750755">.</span><span class="ident" id="3750756">Write</span><span class="op" id="3750761">(</span><span class="ident" id="3750762">a</span><span class="op" id="3750763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750767">a</span>&nbsp;<span class="op" id="3750769">=</span>&nbsp;<span class="ident" id="3750771">h</span><span class="op" id="3750772">.</span><span class="ident" id="3750773">Sum</span><span class="op" id="3750776">(</span><span class="ident" id="3750777">nil</span><span class="op" id="3750780">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3750783">}</span><br>
<span class="lineno"></span><span class="op" id="3750785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3750788">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3750879">func</span>&nbsp;<span class="ident" id="3750884">prf10</span><span class="op" id="3750889">(</span><span class="ident" id="3750890">result</span><span class="op" id="3750896">,</span>&nbsp;<span class="ident" id="3750898">secret</span><span class="op" id="3750904">,</span>&nbsp;<span class="ident" id="3750906">label</span><span class="op" id="3750911">,</span>&nbsp;<span class="ident" id="3750913">seed</span>&nbsp;<span class="op" id="3750918">[</span><span class="op" id="3750919">]</span><span class="builtintype" id="3750920">byte</span><span class="op" id="3750924">)</span>&nbsp;<span class="op" id="3750926">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750929">hashSHA1</span>&nbsp;<span class="op" id="3750938">:=</span>&nbsp;<span class="ident" id="3750941">sha1</span><span class="op" id="3750945">.</span><span class="ident" id="3750946">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750951">hashMD5</span>&nbsp;<span class="op" id="3750959">:=</span>&nbsp;<span class="ident" id="3750962">md5</span><span class="op" id="3750965">.</span><span class="ident" id="3750966">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750972">labelAndSeed</span>&nbsp;<span class="op" id="3750985">:=</span>&nbsp;<span class="builtinfunc" id="3750988">make</span><span class="op" id="3750992">(</span><span class="op" id="3750993">[</span><span class="op" id="3750994">]</span><span class="builtintype" id="3750995">byte</span><span class="op" id="3750999">,</span>&nbsp;<span class="builtinfunc" id="3751001">len</span><span class="op" id="3751004">(</span><span class="ident" id="3751005">label</span><span class="op" id="3751010">)</span><span class="op" id="3751011">+</span><span class="builtinfunc" id="3751012">len</span><span class="op" id="3751015">(</span><span class="ident" id="3751016">seed</span><span class="op" id="3751020">)</span><span class="op" id="3751021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3751024">copy</span><span class="op" id="3751028">(</span><span class="ident" id="3751029">labelAndSeed</span><span class="op" id="3751041">,</span>&nbsp;<span class="ident" id="3751043">label</span><span class="op" id="3751048">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3751051">copy</span><span class="op" id="3751055">(</span><span class="ident" id="3751056">labelAndSeed</span><span class="op" id="3751068">[</span><span class="builtinfunc" id="3751069">len</span><span class="op" id="3751072">(</span><span class="ident" id="3751073">label</span><span class="op" id="3751078">)</span><span class="op" id="3751079">:</span><span class="op" id="3751080">]</span><span class="op" id="3751081">,</span>&nbsp;<span class="ident" id="3751083">seed</span><span class="op" id="3751087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751091">s1</span><span class="op" id="3751093">,</span>&nbsp;<span class="ident" id="3751095">s2</span>&nbsp;<span class="op" id="3751098">:=</span>&nbsp;<span class="ident" id="3751101">splitPreMasterSecret</span><span class="op" id="3751121">(</span><span class="ident" id="3751122">secret</span><span class="op" id="3751128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751131">pHash</span><span class="op" id="3751136">(</span><span class="ident" id="3751137">result</span><span class="op" id="3751143">,</span>&nbsp;<span class="ident" id="3751145">s1</span><span class="op" id="3751147">,</span>&nbsp;<span class="ident" id="3751149">labelAndSeed</span><span class="op" id="3751161">,</span>&nbsp;<span class="ident" id="3751163">hashMD5</span><span class="op" id="3751170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751173">result2</span>&nbsp;<span class="op" id="3751181">:=</span>&nbsp;<span class="builtinfunc" id="3751184">make</span><span class="op" id="3751188">(</span><span class="op" id="3751189">[</span><span class="op" id="3751190">]</span><span class="builtintype" id="3751191">byte</span><span class="op" id="3751195">,</span>&nbsp;<span class="builtinfunc" id="3751197">len</span><span class="op" id="3751200">(</span><span class="ident" id="3751201">result</span><span class="op" id="3751207">)</span><span class="op" id="3751208">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751211">pHash</span><span class="op" id="3751216">(</span><span class="ident" id="3751217">result2</span><span class="op" id="3751224">,</span>&nbsp;<span class="ident" id="3751226">s2</span><span class="op" id="3751228">,</span>&nbsp;<span class="ident" id="3751230">labelAndSeed</span><span class="op" id="3751242">,</span>&nbsp;<span class="ident" id="3751244">hashSHA1</span><span class="op" id="3751252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751256">for</span>&nbsp;<span class="ident" id="3751260">i</span><span class="op" id="3751261">,</span>&nbsp;<span class="ident" id="3751263">b</span>&nbsp;<span class="op" id="3751265">:=</span>&nbsp;<span class="keyword" id="3751268">range</span>&nbsp;<span class="ident" id="3751274">result2</span>&nbsp;<span class="op" id="3751282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751286">result</span><span class="op" id="3751292">[</span><span class="ident" id="3751293">i</span><span class="op" id="3751294">]</span>&nbsp;<span class="op" id="3751296">^=</span>&nbsp;<span class="ident" id="3751299">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3751302">}</span><br>
<span class="lineno">65</span><span class="op" id="3751304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3751307">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3751398">func</span>&nbsp;<span class="ident" id="3751403">prf12</span><span class="op" id="3751408">(</span><span class="ident" id="3751409">result</span><span class="op" id="3751415">,</span>&nbsp;<span class="ident" id="3751417">secret</span><span class="op" id="3751423">,</span>&nbsp;<span class="ident" id="3751425">label</span><span class="op" id="3751430">,</span>&nbsp;<span class="ident" id="3751432">seed</span>&nbsp;<span class="op" id="3751437">[</span><span class="op" id="3751438">]</span><span class="builtintype" id="3751439">byte</span><span class="op" id="3751443">)</span>&nbsp;<span class="op" id="3751445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751448">labelAndSeed</span>&nbsp;<span class="op" id="3751461">:=</span>&nbsp;<span class="builtinfunc" id="3751464">make</span><span class="op" id="3751468">(</span><span class="op" id="3751469">[</span><span class="op" id="3751470">]</span><span class="builtintype" id="3751471">byte</span><span class="op" id="3751475">,</span>&nbsp;<span class="builtinfunc" id="3751477">len</span><span class="op" id="3751480">(</span><span class="ident" id="3751481">label</span><span class="op" id="3751486">)</span><span class="op" id="3751487">+</span><span class="builtinfunc" id="3751488">len</span><span class="op" id="3751491">(</span><span class="ident" id="3751492">seed</span><span class="op" id="3751496">)</span><span class="op" id="3751497">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3751500">copy</span><span class="op" id="3751504">(</span><span class="ident" id="3751505">labelAndSeed</span><span class="op" id="3751517">,</span>&nbsp;<span class="ident" id="3751519">label</span><span class="op" id="3751524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3751527">copy</span><span class="op" id="3751531">(</span><span class="ident" id="3751532">labelAndSeed</span><span class="op" id="3751544">[</span><span class="builtinfunc" id="3751545">len</span><span class="op" id="3751548">(</span><span class="ident" id="3751549">label</span><span class="op" id="3751554">)</span><span class="op" id="3751555">:</span><span class="op" id="3751556">]</span><span class="op" id="3751557">,</span>&nbsp;<span class="ident" id="3751559">seed</span><span class="op" id="3751563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751567">pHash</span><span class="op" id="3751572">(</span><span class="ident" id="3751573">result</span><span class="op" id="3751579">,</span>&nbsp;<span class="ident" id="3751581">secret</span><span class="op" id="3751587">,</span>&nbsp;<span class="ident" id="3751589">labelAndSeed</span><span class="op" id="3751601">,</span>&nbsp;<span class="ident" id="3751603">sha256</span><span class="op" id="3751609">.</span><span class="ident" id="3751610">New</span><span class="op" id="3751613">)</span><br>
<span class="lineno"></span><span class="op" id="3751615">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3751618">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3751688">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="3751761">func</span>&nbsp;<span class="ident" id="3751766">prf30</span><span class="op" id="3751771">(</span><span class="ident" id="3751772">result</span><span class="op" id="3751778">,</span>&nbsp;<span class="ident" id="3751780">secret</span><span class="op" id="3751786">,</span>&nbsp;<span class="ident" id="3751788">label</span><span class="op" id="3751793">,</span>&nbsp;<span class="ident" id="3751795">seed</span>&nbsp;<span class="op" id="3751800">[</span><span class="op" id="3751801">]</span><span class="builtintype" id="3751802">byte</span><span class="op" id="3751806">)</span>&nbsp;<span class="op" id="3751808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751811">hashSHA1</span>&nbsp;<span class="op" id="3751820">:=</span>&nbsp;<span class="ident" id="3751823">sha1</span><span class="op" id="3751827">.</span><span class="ident" id="3751828">New</span><span class="op" id="3751831">(</span><span class="op" id="3751832">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751835">hashMD5</span>&nbsp;<span class="op" id="3751843">:=</span>&nbsp;<span class="ident" id="3751846">md5</span><span class="op" id="3751849">.</span><span class="ident" id="3751850">New</span><span class="op" id="3751853">(</span><span class="op" id="3751854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751858">done</span>&nbsp;<span class="op" id="3751863">:=</span>&nbsp;<span class="num" id="3751866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751869">i</span>&nbsp;<span class="op" id="3751871">:=</span>&nbsp;<span class="num" id="3751874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3751877">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3751948">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3752020">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3752092">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752111">var</span>&nbsp;<span class="ident" id="3752115">b</span>&nbsp;<span class="op" id="3752117">[</span><span class="num" id="3752118">11</span><span class="op" id="3752120">]</span><span class="builtintype" id="3752121">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752127">for</span>&nbsp;<span class="ident" id="3752131">done</span>&nbsp;<span class="op" id="3752136">&lt;</span>&nbsp;<span class="builtinfunc" id="3752138">len</span><span class="op" id="3752141">(</span><span class="ident" id="3752142">result</span><span class="op" id="3752148">)</span>&nbsp;<span class="op" id="3752150">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752154">for</span>&nbsp;<span class="ident" id="3752158">j</span>&nbsp;<span class="op" id="3752160">:=</span>&nbsp;<span class="num" id="3752163">0</span><span class="op" id="3752164">;</span>&nbsp;<span class="ident" id="3752166">j</span>&nbsp;<span class="op" id="3752168">&lt;=</span>&nbsp;<span class="ident" id="3752171">i</span><span class="op" id="3752172">;</span>&nbsp;<span class="ident" id="3752174">j</span><span class="op" id="3752175">++</span>&nbsp;<span class="op" id="3752178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752183">b</span><span class="op" id="3752184">[</span><span class="ident" id="3752185">j</span><span class="op" id="3752186">]</span>&nbsp;<span class="op" id="3752188">=</span>&nbsp;<span class="string" id="3752190">&#39;A&#39;</span>&nbsp;<span class="op" id="3752194">+</span>&nbsp;<span class="builtintype" id="3752196">byte</span><span class="op" id="3752200">(</span><span class="ident" id="3752201">i</span><span class="op" id="3752202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752211">hashSHA1</span><span class="op" id="3752219">.</span><span class="ident" id="3752220">Reset</span><span class="op" id="3752225">(</span><span class="op" id="3752226">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752230">hashSHA1</span><span class="op" id="3752238">.</span><span class="ident" id="3752239">Write</span><span class="op" id="3752244">(</span><span class="ident" id="3752245">b</span><span class="op" id="3752246">[</span><span class="op" id="3752247">:</span><span class="ident" id="3752248">i</span><span class="op" id="3752249">+</span><span class="num" id="3752250">1</span><span class="op" id="3752251">]</span><span class="op" id="3752252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752256">hashSHA1</span><span class="op" id="3752264">.</span><span class="ident" id="3752265">Write</span><span class="op" id="3752270">(</span><span class="ident" id="3752271">secret</span><span class="op" id="3752277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752281">hashSHA1</span><span class="op" id="3752289">.</span><span class="ident" id="3752290">Write</span><span class="op" id="3752295">(</span><span class="ident" id="3752296">seed</span><span class="op" id="3752300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752304">digest</span>&nbsp;<span class="op" id="3752311">:=</span>&nbsp;<span class="ident" id="3752314">hashSHA1</span><span class="op" id="3752322">.</span><span class="ident" id="3752323">Sum</span><span class="op" id="3752326">(</span><span class="ident" id="3752327">nil</span><span class="op" id="3752330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752335">hashMD5</span><span class="op" id="3752342">.</span><span class="ident" id="3752343">Reset</span><span class="op" id="3752348">(</span><span class="op" id="3752349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752353">hashMD5</span><span class="op" id="3752360">.</span><span class="ident" id="3752361">Write</span><span class="op" id="3752366">(</span><span class="ident" id="3752367">secret</span><span class="op" id="3752373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752377">hashMD5</span><span class="op" id="3752384">.</span><span class="ident" id="3752385">Write</span><span class="op" id="3752390">(</span><span class="ident" id="3752391">digest</span><span class="op" id="3752397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752402">done</span>&nbsp;<span class="op" id="3752407">+=</span>&nbsp;<span class="builtinfunc" id="3752410">copy</span><span class="op" id="3752414">(</span><span class="ident" id="3752415">result</span><span class="op" id="3752421">[</span><span class="ident" id="3752422">done</span><span class="op" id="3752426">:</span><span class="op" id="3752427">]</span><span class="op" id="3752428">,</span>&nbsp;<span class="ident" id="3752430">hashMD5</span><span class="op" id="3752437">.</span><span class="ident" id="3752438">Sum</span><span class="op" id="3752441">(</span><span class="ident" id="3752442">nil</span><span class="op" id="3752445">)</span><span class="op" id="3752446">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752450">i</span><span class="op" id="3752451">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752455">}</span><br>
<span class="lineno"></span><span class="op" id="3752457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3752460">const</span>&nbsp;<span class="op" id="3752466">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752469">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3752490">=</span>&nbsp;<span class="num" id="3752492">32</span>&nbsp;<span class="comment" id="3752495">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752536">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3752557">=</span>&nbsp;<span class="num" id="3752559">48</span>&nbsp;<span class="comment" id="3752562">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752604">finishedVerifyLength</span>&nbsp;<span class="op" id="3752625">=</span>&nbsp;<span class="num" id="3752627">12</span>&nbsp;<span class="comment" id="3752630">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="3752678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3752681">var</span>&nbsp;<span class="ident" id="3752685">masterSecretLabel</span>&nbsp;<span class="op" id="3752703">=</span>&nbsp;<span class="op" id="3752705">[</span><span class="op" id="3752706">]</span><span class="builtintype" id="3752707">byte</span><span class="op" id="3752711">(</span><span class="string" id="3752712">&#34;master&nbsp;secret&#34;</span><span class="op" id="3752727">)</span><br>
<span class="lineno"></span><span class="keyword" id="3752729">var</span>&nbsp;<span class="ident" id="3752733">keyExpansionLabel</span>&nbsp;<span class="op" id="3752751">=</span>&nbsp;<span class="op" id="3752753">[</span><span class="op" id="3752754">]</span><span class="builtintype" id="3752755">byte</span><span class="op" id="3752759">(</span><span class="string" id="3752760">&#34;key&nbsp;expansion&#34;</span><span class="op" id="3752775">)</span><br>
<span class="lineno"></span><span class="keyword" id="3752777">var</span>&nbsp;<span class="ident" id="3752781">clientFinishedLabel</span>&nbsp;<span class="op" id="3752801">=</span>&nbsp;<span class="op" id="3752803">[</span><span class="op" id="3752804">]</span><span class="builtintype" id="3752805">byte</span><span class="op" id="3752809">(</span><span class="string" id="3752810">&#34;client&nbsp;finished&#34;</span><span class="op" id="3752827">)</span><br>
<span class="lineno"></span><span class="keyword" id="3752829">var</span>&nbsp;<span class="ident" id="3752833">serverFinishedLabel</span>&nbsp;<span class="op" id="3752853">=</span>&nbsp;<span class="op" id="3752855">[</span><span class="op" id="3752856">]</span><span class="builtintype" id="3752857">byte</span><span class="op" id="3752861">(</span><span class="string" id="3752862">&#34;server&nbsp;finished&#34;</span><span class="op" id="3752879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3752882">func</span>&nbsp;<span class="ident" id="3752887">prfForVersion</span><span class="op" id="3752900">(</span><span class="ident" id="3752901">version</span>&nbsp;<span class="builtintype" id="3752909">uint16</span><span class="op" id="3752915">)</span>&nbsp;<span class="keyword" id="3752917">func</span><span class="op" id="3752921">(</span><span class="ident" id="3752922">result</span><span class="op" id="3752928">,</span>&nbsp;<span class="ident" id="3752930">secret</span><span class="op" id="3752936">,</span>&nbsp;<span class="ident" id="3752938">label</span><span class="op" id="3752943">,</span>&nbsp;<span class="ident" id="3752945">seed</span>&nbsp;<span class="op" id="3752950">[</span><span class="op" id="3752951">]</span><span class="builtintype" id="3752952">byte</span><span class="op" id="3752956">)</span>&nbsp;<span class="op" id="3752958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752961">switch</span>&nbsp;<span class="ident" id="3752968">version</span>&nbsp;<span class="op" id="3752976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752979">case</span>&nbsp;<span class="ident" id="3752984">VersionSSL30</span><span class="op" id="3752996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753000">return</span>&nbsp;<span class="ident" id="3753007">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753014">case</span>&nbsp;<span class="ident" id="3753019">VersionTLS10</span><span class="op" id="3753031">,</span>&nbsp;<span class="ident" id="3753033">VersionTLS11</span><span class="op" id="3753045">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753049">return</span>&nbsp;<span class="ident" id="3753056">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753063">case</span>&nbsp;<span class="ident" id="3753068">VersionTLS12</span><span class="op" id="3753080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753084">return</span>&nbsp;<span class="ident" id="3753091">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753098">default</span><span class="op" id="3753105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3753109">panic</span><span class="op" id="3753114">(</span><span class="string" id="3753115">&#34;unknown&nbsp;version&#34;</span><span class="op" id="3753132">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753135">}</span><br>
<span class="lineno"></span><span class="op" id="3753137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3753140">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="3753217">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="3753279">func</span>&nbsp;<span class="ident" id="3753284">masterFromPreMasterSecret</span><span class="op" id="3753309">(</span><span class="ident" id="3753310">version</span>&nbsp;<span class="builtintype" id="3753318">uint16</span><span class="op" id="3753324">,</span>&nbsp;<span class="ident" id="3753326">preMasterSecret</span><span class="op" id="3753341">,</span>&nbsp;<span class="ident" id="3753343">clientRandom</span><span class="op" id="3753355">,</span>&nbsp;<span class="ident" id="3753357">serverRandom</span>&nbsp;<span class="op" id="3753370">[</span><span class="op" id="3753371">]</span><span class="builtintype" id="3753372">byte</span><span class="op" id="3753376">)</span>&nbsp;<span class="op" id="3753378">[</span><span class="op" id="3753379">]</span><span class="builtintype" id="3753380">byte</span>&nbsp;<span class="op" id="3753385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753388">var</span>&nbsp;<span class="ident" id="3753392">seed</span>&nbsp;<span class="op" id="3753397">[</span><span class="ident" id="3753398">tlsRandomLength</span>&nbsp;<span class="op" id="3753414">*</span>&nbsp;<span class="num" id="3753416">2</span><span class="op" id="3753417">]</span><span class="builtintype" id="3753418">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3753424">copy</span><span class="op" id="3753428">(</span><span class="ident" id="3753429">seed</span><span class="op" id="3753433">[</span><span class="num" id="3753434">0</span><span class="op" id="3753435">:</span><span class="builtinfunc" id="3753436">len</span><span class="op" id="3753439">(</span><span class="ident" id="3753440">clientRandom</span><span class="op" id="3753452">)</span><span class="op" id="3753453">]</span><span class="op" id="3753454">,</span>&nbsp;<span class="ident" id="3753456">clientRandom</span><span class="op" id="3753468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3753471">copy</span><span class="op" id="3753475">(</span><span class="ident" id="3753476">seed</span><span class="op" id="3753480">[</span><span class="builtinfunc" id="3753481">len</span><span class="op" id="3753484">(</span><span class="ident" id="3753485">clientRandom</span><span class="op" id="3753497">)</span><span class="op" id="3753498">:</span><span class="op" id="3753499">]</span><span class="op" id="3753500">,</span>&nbsp;<span class="ident" id="3753502">serverRandom</span><span class="op" id="3753514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753517">masterSecret</span>&nbsp;<span class="op" id="3753530">:=</span>&nbsp;<span class="builtinfunc" id="3753533">make</span><span class="op" id="3753537">(</span><span class="op" id="3753538">[</span><span class="op" id="3753539">]</span><span class="builtintype" id="3753540">byte</span><span class="op" id="3753544">,</span>&nbsp;<span class="ident" id="3753546">masterSecretLength</span><span class="op" id="3753564">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753567">prfForVersion</span><span class="op" id="3753580">(</span><span class="ident" id="3753581">version</span><span class="op" id="3753588">)</span><span class="op" id="3753589">(</span><span class="ident" id="3753590">masterSecret</span><span class="op" id="3753602">,</span>&nbsp;<span class="ident" id="3753604">preMasterSecret</span><span class="op" id="3753619">,</span>&nbsp;<span class="ident" id="3753621">masterSecretLabel</span><span class="op" id="3753638">,</span>&nbsp;<span class="ident" id="3753640">seed</span><span class="op" id="3753644">[</span><span class="num" id="3753645">0</span><span class="op" id="3753646">:</span><span class="op" id="3753647">]</span><span class="op" id="3753648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753651">return</span>&nbsp;<span class="ident" id="3753658">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="3753671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3753674">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="3753744">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3753822">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3753848">func</span>&nbsp;<span class="ident" id="3753853">keysFromMasterSecret</span><span class="op" id="3753873">(</span><span class="ident" id="3753874">version</span>&nbsp;<span class="builtintype" id="3753882">uint16</span><span class="op" id="3753888">,</span>&nbsp;<span class="ident" id="3753890">masterSecret</span><span class="op" id="3753902">,</span>&nbsp;<span class="ident" id="3753904">clientRandom</span><span class="op" id="3753916">,</span>&nbsp;<span class="ident" id="3753918">serverRandom</span>&nbsp;<span class="op" id="3753931">[</span><span class="op" id="3753932">]</span><span class="builtintype" id="3753933">byte</span><span class="op" id="3753937">,</span>&nbsp;<span class="ident" id="3753939">macLen</span><span class="op" id="3753945">,</span>&nbsp;<span class="ident" id="3753947">keyLen</span><span class="op" id="3753953">,</span>&nbsp;<span class="ident" id="3753955">ivLen</span>&nbsp;<span class="builtintype" id="3753961">int</span><span class="op" id="3753964">)</span>&nbsp;<span class="op" id="3753966">(</span><span class="ident" id="3753967">clientMAC</span><span class="op" id="3753976">,</span>&nbsp;<span class="ident" id="3753978">serverMAC</span><span class="op" id="3753987">,</span>&nbsp;<span class="ident" id="3753989">clientKey</span><span class="op" id="3753998">,</span>&nbsp;<span class="ident" id="3754000">serverKey</span><span class="op" id="3754009">,</span>&nbsp;<span class="ident" id="3754011">clientIV</span><span class="op" id="3754019">,</span>&nbsp;<span class="ident" id="3754021">serverIV</span>&nbsp;<span class="op" id="3754030">[</span><span class="op" id="3754031">]</span><span class="builtintype" id="3754032">byte</span><span class="op" id="3754036">)</span>&nbsp;<span class="op" id="3754038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754041">var</span>&nbsp;<span class="ident" id="3754045">seed</span>&nbsp;<span class="op" id="3754050">[</span><span class="ident" id="3754051">tlsRandomLength</span>&nbsp;<span class="op" id="3754067">*</span>&nbsp;<span class="num" id="3754069">2</span><span class="op" id="3754070">]</span><span class="builtintype" id="3754071">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3754077">copy</span><span class="op" id="3754081">(</span><span class="ident" id="3754082">seed</span><span class="op" id="3754086">[</span><span class="num" id="3754087">0</span><span class="op" id="3754088">:</span><span class="builtinfunc" id="3754089">len</span><span class="op" id="3754092">(</span><span class="ident" id="3754093">clientRandom</span><span class="op" id="3754105">)</span><span class="op" id="3754106">]</span><span class="op" id="3754107">,</span>&nbsp;<span class="ident" id="3754109">serverRandom</span><span class="op" id="3754121">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3754124">copy</span><span class="op" id="3754128">(</span><span class="ident" id="3754129">seed</span><span class="op" id="3754133">[</span><span class="builtinfunc" id="3754134">len</span><span class="op" id="3754137">(</span><span class="ident" id="3754138">serverRandom</span><span class="op" id="3754150">)</span><span class="op" id="3754151">:</span><span class="op" id="3754152">]</span><span class="op" id="3754153">,</span>&nbsp;<span class="ident" id="3754155">clientRandom</span><span class="op" id="3754167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754171">n</span>&nbsp;<span class="op" id="3754173">:=</span>&nbsp;<span class="num" id="3754176">2</span><span class="op" id="3754177">*</span><span class="ident" id="3754178">macLen</span>&nbsp;<span class="op" id="3754185">+</span>&nbsp;<span class="num" id="3754187">2</span><span class="op" id="3754188">*</span><span class="ident" id="3754189">keyLen</span>&nbsp;<span class="op" id="3754196">+</span>&nbsp;<span class="num" id="3754198">2</span><span class="op" id="3754199">*</span><span class="ident" id="3754200">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754207">keyMaterial</span>&nbsp;<span class="op" id="3754219">:=</span>&nbsp;<span class="builtinfunc" id="3754222">make</span><span class="op" id="3754226">(</span><span class="op" id="3754227">[</span><span class="op" id="3754228">]</span><span class="builtintype" id="3754229">byte</span><span class="op" id="3754233">,</span>&nbsp;<span class="ident" id="3754235">n</span><span class="op" id="3754236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754239">prfForVersion</span><span class="op" id="3754252">(</span><span class="ident" id="3754253">version</span><span class="op" id="3754260">)</span><span class="op" id="3754261">(</span><span class="ident" id="3754262">keyMaterial</span><span class="op" id="3754273">,</span>&nbsp;<span class="ident" id="3754275">masterSecret</span><span class="op" id="3754287">,</span>&nbsp;<span class="ident" id="3754289">keyExpansionLabel</span><span class="op" id="3754306">,</span>&nbsp;<span class="ident" id="3754308">seed</span><span class="op" id="3754312">[</span><span class="num" id="3754313">0</span><span class="op" id="3754314">:</span><span class="op" id="3754315">]</span><span class="op" id="3754316">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754319">clientMAC</span>&nbsp;<span class="op" id="3754329">=</span>&nbsp;<span class="ident" id="3754331">keyMaterial</span><span class="op" id="3754342">[</span><span class="op" id="3754343">:</span><span class="ident" id="3754344">macLen</span><span class="op" id="3754350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754353">keyMaterial</span>&nbsp;<span class="op" id="3754365">=</span>&nbsp;<span class="ident" id="3754367">keyMaterial</span><span class="op" id="3754378">[</span><span class="ident" id="3754379">macLen</span><span class="op" id="3754385">:</span><span class="op" id="3754386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754389">serverMAC</span>&nbsp;<span class="op" id="3754399">=</span>&nbsp;<span class="ident" id="3754401">keyMaterial</span><span class="op" id="3754412">[</span><span class="op" id="3754413">:</span><span class="ident" id="3754414">macLen</span><span class="op" id="3754420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754423">keyMaterial</span>&nbsp;<span class="op" id="3754435">=</span>&nbsp;<span class="ident" id="3754437">keyMaterial</span><span class="op" id="3754448">[</span><span class="ident" id="3754449">macLen</span><span class="op" id="3754455">:</span><span class="op" id="3754456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754459">clientKey</span>&nbsp;<span class="op" id="3754469">=</span>&nbsp;<span class="ident" id="3754471">keyMaterial</span><span class="op" id="3754482">[</span><span class="op" id="3754483">:</span><span class="ident" id="3754484">keyLen</span><span class="op" id="3754490">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754493">keyMaterial</span>&nbsp;<span class="op" id="3754505">=</span>&nbsp;<span class="ident" id="3754507">keyMaterial</span><span class="op" id="3754518">[</span><span class="ident" id="3754519">keyLen</span><span class="op" id="3754525">:</span><span class="op" id="3754526">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754529">serverKey</span>&nbsp;<span class="op" id="3754539">=</span>&nbsp;<span class="ident" id="3754541">keyMaterial</span><span class="op" id="3754552">[</span><span class="op" id="3754553">:</span><span class="ident" id="3754554">keyLen</span><span class="op" id="3754560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754563">keyMaterial</span>&nbsp;<span class="op" id="3754575">=</span>&nbsp;<span class="ident" id="3754577">keyMaterial</span><span class="op" id="3754588">[</span><span class="ident" id="3754589">keyLen</span><span class="op" id="3754595">:</span><span class="op" id="3754596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754599">clientIV</span>&nbsp;<span class="op" id="3754608">=</span>&nbsp;<span class="ident" id="3754610">keyMaterial</span><span class="op" id="3754621">[</span><span class="op" id="3754622">:</span><span class="ident" id="3754623">ivLen</span><span class="op" id="3754628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754631">keyMaterial</span>&nbsp;<span class="op" id="3754643">=</span>&nbsp;<span class="ident" id="3754645">keyMaterial</span><span class="op" id="3754656">[</span><span class="ident" id="3754657">ivLen</span><span class="op" id="3754662">:</span><span class="op" id="3754663">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3754666">serverIV</span>&nbsp;<span class="op" id="3754675">=</span>&nbsp;<span class="ident" id="3754677">keyMaterial</span><span class="op" id="3754688">[</span><span class="op" id="3754689">:</span><span class="ident" id="3754690">ivLen</span><span class="op" id="3754695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754698">return</span><br>
<span class="lineno"></span><span class="op" id="3754705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3754708">func</span>&nbsp;<span class="ident" id="3754713">newFinishedHash</span><span class="op" id="3754728">(</span><span class="ident" id="3754729">version</span>&nbsp;<span class="builtintype" id="3754737">uint16</span><span class="op" id="3754743">)</span>&nbsp;<span class="ident" id="3754745">finishedHash</span>&nbsp;<span class="op" id="3754758">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754761">if</span>&nbsp;<span class="ident" id="3754764">version</span>&nbsp;<span class="op" id="3754772">&gt;=</span>&nbsp;<span class="ident" id="3754775">VersionTLS12</span>&nbsp;<span class="op" id="3754788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754792">return</span>&nbsp;<span class="ident" id="3754799">finishedHash</span><span class="op" id="3754811">{</span><span class="ident" id="3754812">sha256</span><span class="op" id="3754818">.</span><span class="ident" id="3754819">New</span><span class="op" id="3754822">(</span><span class="op" id="3754823">)</span><span class="op" id="3754824">,</span>&nbsp;<span class="ident" id="3754826">sha256</span><span class="op" id="3754832">.</span><span class="ident" id="3754833">New</span><span class="op" id="3754836">(</span><span class="op" id="3754837">)</span><span class="op" id="3754838">,</span>&nbsp;<span class="ident" id="3754840">nil</span><span class="op" id="3754843">,</span>&nbsp;<span class="ident" id="3754845">nil</span><span class="op" id="3754848">,</span>&nbsp;<span class="ident" id="3754850">version</span><span class="op" id="3754857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3754860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3754863">return</span>&nbsp;<span class="ident" id="3754870">finishedHash</span><span class="op" id="3754882">{</span><span class="ident" id="3754883">sha1</span><span class="op" id="3754887">.</span><span class="ident" id="3754888">New</span><span class="op" id="3754891">(</span><span class="op" id="3754892">)</span><span class="op" id="3754893">,</span>&nbsp;<span class="ident" id="3754895">sha1</span><span class="op" id="3754899">.</span><span class="ident" id="3754900">New</span><span class="op" id="3754903">(</span><span class="op" id="3754904">)</span><span class="op" id="3754905">,</span>&nbsp;<span class="ident" id="3754907">md5</span><span class="op" id="3754910">.</span><span class="ident" id="3754911">New</span><span class="op" id="3754914">(</span><span class="op" id="3754915">)</span><span class="op" id="3754916">,</span>&nbsp;<span class="ident" id="3754918">md5</span><span class="op" id="3754921">.</span><span class="ident" id="3754922">New</span><span class="op" id="3754925">(</span><span class="op" id="3754926">)</span><span class="op" id="3754927">,</span>&nbsp;<span class="ident" id="3754929">version</span><span class="op" id="3754936">}</span><br>
<span class="lineno"></span><span class="op" id="3754938">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3754941">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="3755019">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3755059">type</span>&nbsp;<span class="ident" id="3755064">finishedHash</span>&nbsp;<span class="keyword" id="3755077">struct</span>&nbsp;<span class="op" id="3755084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755087">client</span>&nbsp;<span class="ident" id="3755094">hash</span><span class="op" id="3755098">.</span><span class="ident" id="3755099">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755105">server</span>&nbsp;<span class="ident" id="3755112">hash</span><span class="op" id="3755116">.</span><span class="ident" id="3755117">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3755124">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755182">clientMD5</span>&nbsp;<span class="ident" id="3755192">hash</span><span class="op" id="3755196">.</span><span class="ident" id="3755197">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755203">serverMD5</span>&nbsp;<span class="ident" id="3755213">hash</span><span class="op" id="3755217">.</span><span class="ident" id="3755218">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755225">version</span>&nbsp;<span class="builtintype" id="3755233">uint16</span><br>
<span class="lineno"></span><span class="op" id="3755240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3755243">func</span>&nbsp;<span class="op" id="3755248">(</span><span class="ident" id="3755249">h</span>&nbsp;<span class="ident" id="3755251">finishedHash</span><span class="op" id="3755263">)</span>&nbsp;<span class="ident" id="3755265">Write</span><span class="op" id="3755270">(</span><span class="ident" id="3755271">msg</span>&nbsp;<span class="op" id="3755275">[</span><span class="op" id="3755276">]</span><span class="builtintype" id="3755277">byte</span><span class="op" id="3755281">)</span>&nbsp;<span class="op" id="3755283">(</span><span class="ident" id="3755284">n</span>&nbsp;<span class="builtintype" id="3755286">int</span><span class="op" id="3755289">,</span>&nbsp;<span class="ident" id="3755291">err</span>&nbsp;<span class="builtintype" id="3755295">error</span><span class="op" id="3755300">)</span>&nbsp;<span class="op" id="3755302">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755305">h</span><span class="op" id="3755306">.</span><span class="ident" id="3755307">client</span><span class="op" id="3755313">.</span><span class="ident" id="3755314">Write</span><span class="op" id="3755319">(</span><span class="ident" id="3755320">msg</span><span class="op" id="3755323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755326">h</span><span class="op" id="3755327">.</span><span class="ident" id="3755328">server</span><span class="op" id="3755334">.</span><span class="ident" id="3755335">Write</span><span class="op" id="3755340">(</span><span class="ident" id="3755341">msg</span><span class="op" id="3755344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3755348">if</span>&nbsp;<span class="ident" id="3755351">h</span><span class="op" id="3755352">.</span><span class="ident" id="3755353">version</span>&nbsp;<span class="op" id="3755361">&lt;</span>&nbsp;<span class="ident" id="3755363">VersionTLS12</span>&nbsp;<span class="op" id="3755376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755380">h</span><span class="op" id="3755381">.</span><span class="ident" id="3755382">clientMD5</span><span class="op" id="3755391">.</span><span class="ident" id="3755392">Write</span><span class="op" id="3755397">(</span><span class="ident" id="3755398">msg</span><span class="op" id="3755401">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755405">h</span><span class="op" id="3755406">.</span><span class="ident" id="3755407">serverMD5</span><span class="op" id="3755416">.</span><span class="ident" id="3755417">Write</span><span class="op" id="3755422">(</span><span class="ident" id="3755423">msg</span><span class="op" id="3755426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3755429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3755432">return</span>&nbsp;<span class="builtinfunc" id="3755439">len</span><span class="op" id="3755442">(</span><span class="ident" id="3755443">msg</span><span class="op" id="3755446">)</span><span class="op" id="3755447">,</span>&nbsp;<span class="ident" id="3755449">nil</span><br>
<span class="lineno"></span><span class="op" id="3755453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3755456">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="3755534">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="3755606">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3755619">func</span>&nbsp;<span class="ident" id="3755624">finishedSum30</span><span class="op" id="3755637">(</span><span class="ident" id="3755638">md5</span><span class="op" id="3755641">,</span>&nbsp;<span class="ident" id="3755643">sha1</span>&nbsp;<span class="ident" id="3755648">hash</span><span class="op" id="3755652">.</span><span class="ident" id="3755653">Hash</span><span class="op" id="3755657">,</span>&nbsp;<span class="ident" id="3755659">masterSecret</span>&nbsp;<span class="op" id="3755672">[</span><span class="op" id="3755673">]</span><span class="builtintype" id="3755674">byte</span><span class="op" id="3755678">,</span>&nbsp;<span class="ident" id="3755680">magic</span>&nbsp;<span class="op" id="3755686">[</span><span class="num" id="3755687">4</span><span class="op" id="3755688">]</span><span class="builtintype" id="3755689">byte</span><span class="op" id="3755693">)</span>&nbsp;<span class="op" id="3755695">[</span><span class="op" id="3755696">]</span><span class="builtintype" id="3755697">byte</span>&nbsp;<span class="op" id="3755702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755705">md5</span><span class="op" id="3755708">.</span><span class="ident" id="3755709">Write</span><span class="op" id="3755714">(</span><span class="ident" id="3755715">magic</span><span class="op" id="3755720">[</span><span class="op" id="3755721">:</span><span class="op" id="3755722">]</span><span class="op" id="3755723">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755726">md5</span><span class="op" id="3755729">.</span><span class="ident" id="3755730">Write</span><span class="op" id="3755735">(</span><span class="ident" id="3755736">masterSecret</span><span class="op" id="3755748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755751">md5</span><span class="op" id="3755754">.</span><span class="ident" id="3755755">Write</span><span class="op" id="3755760">(</span><span class="ident" id="3755761">ssl30Pad1</span><span class="op" id="3755770">[</span><span class="op" id="3755771">:</span><span class="op" id="3755772">]</span><span class="op" id="3755773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755776">md5Digest</span>&nbsp;<span class="op" id="3755786">:=</span>&nbsp;<span class="ident" id="3755789">md5</span><span class="op" id="3755792">.</span><span class="ident" id="3755793">Sum</span><span class="op" id="3755796">(</span><span class="ident" id="3755797">nil</span><span class="op" id="3755800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755804">md5</span><span class="op" id="3755807">.</span><span class="ident" id="3755808">Reset</span><span class="op" id="3755813">(</span><span class="op" id="3755814">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755817">md5</span><span class="op" id="3755820">.</span><span class="ident" id="3755821">Write</span><span class="op" id="3755826">(</span><span class="ident" id="3755827">masterSecret</span><span class="op" id="3755839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755842">md5</span><span class="op" id="3755845">.</span><span class="ident" id="3755846">Write</span><span class="op" id="3755851">(</span><span class="ident" id="3755852">ssl30Pad2</span><span class="op" id="3755861">[</span><span class="op" id="3755862">:</span><span class="op" id="3755863">]</span><span class="op" id="3755864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755867">md5</span><span class="op" id="3755870">.</span><span class="ident" id="3755871">Write</span><span class="op" id="3755876">(</span><span class="ident" id="3755877">md5Digest</span><span class="op" id="3755886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755889">md5Digest</span>&nbsp;<span class="op" id="3755899">=</span>&nbsp;<span class="ident" id="3755901">md5</span><span class="op" id="3755904">.</span><span class="ident" id="3755905">Sum</span><span class="op" id="3755908">(</span><span class="ident" id="3755909">nil</span><span class="op" id="3755912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755916">sha1</span><span class="op" id="3755920">.</span><span class="ident" id="3755921">Write</span><span class="op" id="3755926">(</span><span class="ident" id="3755927">magic</span><span class="op" id="3755932">[</span><span class="op" id="3755933">:</span><span class="op" id="3755934">]</span><span class="op" id="3755935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755938">sha1</span><span class="op" id="3755942">.</span><span class="ident" id="3755943">Write</span><span class="op" id="3755948">(</span><span class="ident" id="3755949">masterSecret</span><span class="op" id="3755961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755964">sha1</span><span class="op" id="3755968">.</span><span class="ident" id="3755969">Write</span><span class="op" id="3755974">(</span><span class="ident" id="3755975">ssl30Pad1</span><span class="op" id="3755984">[</span><span class="op" id="3755985">:</span><span class="num" id="3755986">40</span><span class="op" id="3755988">]</span><span class="op" id="3755989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3755992">sha1Digest</span>&nbsp;<span class="op" id="3756003">:=</span>&nbsp;<span class="ident" id="3756006">sha1</span><span class="op" id="3756010">.</span><span class="ident" id="3756011">Sum</span><span class="op" id="3756014">(</span><span class="ident" id="3756015">nil</span><span class="op" id="3756018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756022">sha1</span><span class="op" id="3756026">.</span><span class="ident" id="3756027">Reset</span><span class="op" id="3756032">(</span><span class="op" id="3756033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756036">sha1</span><span class="op" id="3756040">.</span><span class="ident" id="3756041">Write</span><span class="op" id="3756046">(</span><span class="ident" id="3756047">masterSecret</span><span class="op" id="3756059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756062">sha1</span><span class="op" id="3756066">.</span><span class="ident" id="3756067">Write</span><span class="op" id="3756072">(</span><span class="ident" id="3756073">ssl30Pad2</span><span class="op" id="3756082">[</span><span class="op" id="3756083">:</span><span class="num" id="3756084">40</span><span class="op" id="3756086">]</span><span class="op" id="3756087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756090">sha1</span><span class="op" id="3756094">.</span><span class="ident" id="3756095">Write</span><span class="op" id="3756100">(</span><span class="ident" id="3756101">sha1Digest</span><span class="op" id="3756111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756114">sha1Digest</span>&nbsp;<span class="op" id="3756125">=</span>&nbsp;<span class="ident" id="3756127">sha1</span><span class="op" id="3756131">.</span><span class="ident" id="3756132">Sum</span><span class="op" id="3756135">(</span><span class="ident" id="3756136">nil</span><span class="op" id="3756139">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756143">ret</span>&nbsp;<span class="op" id="3756147">:=</span>&nbsp;<span class="builtinfunc" id="3756150">make</span><span class="op" id="3756154">(</span><span class="op" id="3756155">[</span><span class="op" id="3756156">]</span><span class="builtintype" id="3756157">byte</span><span class="op" id="3756161">,</span>&nbsp;<span class="builtinfunc" id="3756163">len</span><span class="op" id="3756166">(</span><span class="ident" id="3756167">md5Digest</span><span class="op" id="3756176">)</span><span class="op" id="3756177">+</span><span class="builtinfunc" id="3756178">len</span><span class="op" id="3756181">(</span><span class="ident" id="3756182">sha1Digest</span><span class="op" id="3756192">)</span><span class="op" id="3756193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3756196">copy</span><span class="op" id="3756200">(</span><span class="ident" id="3756201">ret</span><span class="op" id="3756204">,</span>&nbsp;<span class="ident" id="3756206">md5Digest</span><span class="op" id="3756215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3756218">copy</span><span class="op" id="3756222">(</span><span class="ident" id="3756223">ret</span><span class="op" id="3756226">[</span><span class="builtinfunc" id="3756227">len</span><span class="op" id="3756230">(</span><span class="ident" id="3756231">md5Digest</span><span class="op" id="3756240">)</span><span class="op" id="3756241">:</span><span class="op" id="3756242">]</span><span class="op" id="3756243">,</span>&nbsp;<span class="ident" id="3756245">sha1Digest</span><span class="op" id="3756255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756258">return</span>&nbsp;<span class="ident" id="3756265">ret</span><br>
<span class="lineno">230</span><span class="op" id="3756269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3756272">var</span>&nbsp;<span class="ident" id="3756276">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="3756300">=</span>&nbsp;<span class="op" id="3756302">[</span><span class="num" id="3756303">4</span><span class="op" id="3756304">]</span><span class="builtintype" id="3756305">byte</span><span class="op" id="3756309">{</span><span class="num" id="3756310">0x43</span><span class="op" id="3756314">,</span>&nbsp;<span class="num" id="3756316">0x4c</span><span class="op" id="3756320">,</span>&nbsp;<span class="num" id="3756322">0x4e</span><span class="op" id="3756326">,</span>&nbsp;<span class="num" id="3756328">0x54</span><span class="op" id="3756332">}</span><br>
<span class="lineno"></span><span class="keyword" id="3756334">var</span>&nbsp;<span class="ident" id="3756338">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="3756362">=</span>&nbsp;<span class="op" id="3756364">[</span><span class="num" id="3756365">4</span><span class="op" id="3756366">]</span><span class="builtintype" id="3756367">byte</span><span class="op" id="3756371">{</span><span class="num" id="3756372">0x53</span><span class="op" id="3756376">,</span>&nbsp;<span class="num" id="3756378">0x52</span><span class="op" id="3756382">,</span>&nbsp;<span class="num" id="3756384">0x56</span><span class="op" id="3756388">,</span>&nbsp;<span class="num" id="3756390">0x52</span><span class="op" id="3756394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3756397">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3756471">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3756492">func</span>&nbsp;<span class="op" id="3756497">(</span><span class="ident" id="3756498">h</span>&nbsp;<span class="ident" id="3756500">finishedHash</span><span class="op" id="3756512">)</span>&nbsp;<span class="ident" id="3756514">clientSum</span><span class="op" id="3756523">(</span><span class="ident" id="3756524">masterSecret</span>&nbsp;<span class="op" id="3756537">[</span><span class="op" id="3756538">]</span><span class="builtintype" id="3756539">byte</span><span class="op" id="3756543">)</span>&nbsp;<span class="op" id="3756545">[</span><span class="op" id="3756546">]</span><span class="builtintype" id="3756547">byte</span>&nbsp;<span class="op" id="3756552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756555">if</span>&nbsp;<span class="ident" id="3756558">h</span><span class="op" id="3756559">.</span><span class="ident" id="3756560">version</span>&nbsp;<span class="op" id="3756568">==</span>&nbsp;<span class="ident" id="3756571">VersionSSL30</span>&nbsp;<span class="op" id="3756584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756588">return</span>&nbsp;<span class="ident" id="3756595">finishedSum30</span><span class="op" id="3756608">(</span><span class="ident" id="3756609">h</span><span class="op" id="3756610">.</span><span class="ident" id="3756611">clientMD5</span><span class="op" id="3756620">,</span>&nbsp;<span class="ident" id="3756622">h</span><span class="op" id="3756623">.</span><span class="ident" id="3756624">client</span><span class="op" id="3756630">,</span>&nbsp;<span class="ident" id="3756632">masterSecret</span><span class="op" id="3756644">,</span>&nbsp;<span class="ident" id="3756646">ssl3ClientFinishedMagic</span><span class="op" id="3756669">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3756672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756676">out</span>&nbsp;<span class="op" id="3756680">:=</span>&nbsp;<span class="builtinfunc" id="3756683">make</span><span class="op" id="3756687">(</span><span class="op" id="3756688">[</span><span class="op" id="3756689">]</span><span class="builtintype" id="3756690">byte</span><span class="op" id="3756694">,</span>&nbsp;<span class="ident" id="3756696">finishedVerifyLength</span><span class="op" id="3756716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3756719">if</span>&nbsp;<span class="ident" id="3756722">h</span><span class="op" id="3756723">.</span><span class="ident" id="3756724">version</span>&nbsp;<span class="op" id="3756732">&gt;=</span>&nbsp;<span class="ident" id="3756735">VersionTLS12</span>&nbsp;<span class="op" id="3756748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756752">seed</span>&nbsp;<span class="op" id="3756757">:=</span>&nbsp;<span class="ident" id="3756760">h</span><span class="op" id="3756761">.</span><span class="ident" id="3756762">client</span><span class="op" id="3756768">.</span><span class="ident" id="3756769">Sum</span><span class="op" id="3756772">(</span><span class="ident" id="3756773">nil</span><span class="op" id="3756776">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756780">prf12</span><span class="op" id="3756785">(</span><span class="ident" id="3756786">out</span><span class="op" id="3756789">,</span>&nbsp;<span class="ident" id="3756791">masterSecret</span><span class="op" id="3756803">,</span>&nbsp;<span class="ident" id="3756805">clientFinishedLabel</span><span class="op" id="3756824">,</span>&nbsp;<span class="ident" id="3756826">seed</span><span class="op" id="3756830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3756833">}</span>&nbsp;<span class="keyword" id="3756835">else</span>&nbsp;<span class="op" id="3756840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756844">seed</span>&nbsp;<span class="op" id="3756849">:=</span>&nbsp;<span class="builtinfunc" id="3756852">make</span><span class="op" id="3756856">(</span><span class="op" id="3756857">[</span><span class="op" id="3756858">]</span><span class="builtintype" id="3756859">byte</span><span class="op" id="3756863">,</span>&nbsp;<span class="num" id="3756865">0</span><span class="op" id="3756866">,</span>&nbsp;<span class="ident" id="3756868">md5</span><span class="op" id="3756871">.</span><span class="ident" id="3756872">Size</span><span class="op" id="3756876">+</span><span class="ident" id="3756877">sha1</span><span class="op" id="3756881">.</span><span class="ident" id="3756882">Size</span><span class="op" id="3756886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756890">seed</span>&nbsp;<span class="op" id="3756895">=</span>&nbsp;<span class="ident" id="3756897">h</span><span class="op" id="3756898">.</span><span class="ident" id="3756899">clientMD5</span><span class="op" id="3756908">.</span><span class="ident" id="3756909">Sum</span><span class="op" id="3756912">(</span><span class="ident" id="3756913">seed</span><span class="op" id="3756917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756921">seed</span>&nbsp;<span class="op" id="3756926">=</span>&nbsp;<span class="ident" id="3756928">h</span><span class="op" id="3756929">.</span><span class="ident" id="3756930">client</span><span class="op" id="3756936">.</span><span class="ident" id="3756937">Sum</span><span class="op" id="3756940">(</span><span class="ident" id="3756941">seed</span><span class="op" id="3756945">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3756949">prf10</span><span class="op" id="3756954">(</span><span class="ident" id="3756955">out</span><span class="op" id="3756958">,</span>&nbsp;<span class="ident" id="3756960">masterSecret</span><span class="op" id="3756972">,</span>&nbsp;<span class="ident" id="3756974">clientFinishedLabel</span><span class="op" id="3756993">,</span>&nbsp;<span class="ident" id="3756995">seed</span><span class="op" id="3756999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757005">return</span>&nbsp;<span class="ident" id="3757012">out</span><br>
<span class="lineno"></span><span class="op" id="3757016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3757019">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3757093">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3757114">func</span>&nbsp;<span class="op" id="3757119">(</span><span class="ident" id="3757120">h</span>&nbsp;<span class="ident" id="3757122">finishedHash</span><span class="op" id="3757134">)</span>&nbsp;<span class="ident" id="3757136">serverSum</span><span class="op" id="3757145">(</span><span class="ident" id="3757146">masterSecret</span>&nbsp;<span class="op" id="3757159">[</span><span class="op" id="3757160">]</span><span class="builtintype" id="3757161">byte</span><span class="op" id="3757165">)</span>&nbsp;<span class="op" id="3757167">[</span><span class="op" id="3757168">]</span><span class="builtintype" id="3757169">byte</span>&nbsp;<span class="op" id="3757174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757177">if</span>&nbsp;<span class="ident" id="3757180">h</span><span class="op" id="3757181">.</span><span class="ident" id="3757182">version</span>&nbsp;<span class="op" id="3757190">==</span>&nbsp;<span class="ident" id="3757193">VersionSSL30</span>&nbsp;<span class="op" id="3757206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757210">return</span>&nbsp;<span class="ident" id="3757217">finishedSum30</span><span class="op" id="3757230">(</span><span class="ident" id="3757231">h</span><span class="op" id="3757232">.</span><span class="ident" id="3757233">serverMD5</span><span class="op" id="3757242">,</span>&nbsp;<span class="ident" id="3757244">h</span><span class="op" id="3757245">.</span><span class="ident" id="3757246">server</span><span class="op" id="3757252">,</span>&nbsp;<span class="ident" id="3757254">masterSecret</span><span class="op" id="3757266">,</span>&nbsp;<span class="ident" id="3757268">ssl3ServerFinishedMagic</span><span class="op" id="3757291">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757298">out</span>&nbsp;<span class="op" id="3757302">:=</span>&nbsp;<span class="builtinfunc" id="3757305">make</span><span class="op" id="3757309">(</span><span class="op" id="3757310">[</span><span class="op" id="3757311">]</span><span class="builtintype" id="3757312">byte</span><span class="op" id="3757316">,</span>&nbsp;<span class="ident" id="3757318">finishedVerifyLength</span><span class="op" id="3757338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757341">if</span>&nbsp;<span class="ident" id="3757344">h</span><span class="op" id="3757345">.</span><span class="ident" id="3757346">version</span>&nbsp;<span class="op" id="3757354">&gt;=</span>&nbsp;<span class="ident" id="3757357">VersionTLS12</span>&nbsp;<span class="op" id="3757370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757374">seed</span>&nbsp;<span class="op" id="3757379">:=</span>&nbsp;<span class="ident" id="3757382">h</span><span class="op" id="3757383">.</span><span class="ident" id="3757384">server</span><span class="op" id="3757390">.</span><span class="ident" id="3757391">Sum</span><span class="op" id="3757394">(</span><span class="ident" id="3757395">nil</span><span class="op" id="3757398">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757402">prf12</span><span class="op" id="3757407">(</span><span class="ident" id="3757408">out</span><span class="op" id="3757411">,</span>&nbsp;<span class="ident" id="3757413">masterSecret</span><span class="op" id="3757425">,</span>&nbsp;<span class="ident" id="3757427">serverFinishedLabel</span><span class="op" id="3757446">,</span>&nbsp;<span class="ident" id="3757448">seed</span><span class="op" id="3757452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757455">}</span>&nbsp;<span class="keyword" id="3757457">else</span>&nbsp;<span class="op" id="3757462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757466">seed</span>&nbsp;<span class="op" id="3757471">:=</span>&nbsp;<span class="builtinfunc" id="3757474">make</span><span class="op" id="3757478">(</span><span class="op" id="3757479">[</span><span class="op" id="3757480">]</span><span class="builtintype" id="3757481">byte</span><span class="op" id="3757485">,</span>&nbsp;<span class="num" id="3757487">0</span><span class="op" id="3757488">,</span>&nbsp;<span class="ident" id="3757490">md5</span><span class="op" id="3757493">.</span><span class="ident" id="3757494">Size</span><span class="op" id="3757498">+</span><span class="ident" id="3757499">sha1</span><span class="op" id="3757503">.</span><span class="ident" id="3757504">Size</span><span class="op" id="3757508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757512">seed</span>&nbsp;<span class="op" id="3757517">=</span>&nbsp;<span class="ident" id="3757519">h</span><span class="op" id="3757520">.</span><span class="ident" id="3757521">serverMD5</span><span class="op" id="3757530">.</span><span class="ident" id="3757531">Sum</span><span class="op" id="3757534">(</span><span class="ident" id="3757535">seed</span><span class="op" id="3757539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757543">seed</span>&nbsp;<span class="op" id="3757548">=</span>&nbsp;<span class="ident" id="3757550">h</span><span class="op" id="3757551">.</span><span class="ident" id="3757552">server</span><span class="op" id="3757558">.</span><span class="ident" id="3757559">Sum</span><span class="op" id="3757562">(</span><span class="ident" id="3757563">seed</span><span class="op" id="3757567">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757571">prf10</span><span class="op" id="3757576">(</span><span class="ident" id="3757577">out</span><span class="op" id="3757580">,</span>&nbsp;<span class="ident" id="3757582">masterSecret</span><span class="op" id="3757594">,</span>&nbsp;<span class="ident" id="3757596">serverFinishedLabel</span><span class="op" id="3757615">,</span>&nbsp;<span class="ident" id="3757617">seed</span><span class="op" id="3757621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757627">return</span>&nbsp;<span class="ident" id="3757634">out</span><br>
<span class="lineno"></span><span class="op" id="3757638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3757641">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3757719">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3757775">func</span>&nbsp;<span class="op" id="3757780">(</span><span class="ident" id="3757781">h</span>&nbsp;<span class="ident" id="3757783">finishedHash</span><span class="op" id="3757795">)</span>&nbsp;<span class="ident" id="3757797">hashForClientCertificate</span><span class="op" id="3757821">(</span><span class="ident" id="3757822">sigType</span>&nbsp;<span class="builtintype" id="3757830">uint8</span><span class="op" id="3757835">)</span>&nbsp;<span class="op" id="3757837">(</span><span class="op" id="3757838">[</span><span class="op" id="3757839">]</span><span class="builtintype" id="3757840">byte</span><span class="op" id="3757844">,</span>&nbsp;<span class="ident" id="3757846">crypto</span><span class="op" id="3757852">.</span><span class="ident" id="3757853">Hash</span><span class="op" id="3757857">,</span>&nbsp;<span class="builtintype" id="3757859">uint8</span><span class="op" id="3757864">)</span>&nbsp;<span class="op" id="3757866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757869">if</span>&nbsp;<span class="ident" id="3757872">h</span><span class="op" id="3757873">.</span><span class="ident" id="3757874">version</span>&nbsp;<span class="op" id="3757882">&gt;=</span>&nbsp;<span class="ident" id="3757885">VersionTLS12</span>&nbsp;<span class="op" id="3757898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3757902">digest</span>&nbsp;<span class="op" id="3757909">:=</span>&nbsp;<span class="ident" id="3757912">h</span><span class="op" id="3757913">.</span><span class="ident" id="3757914">server</span><span class="op" id="3757920">.</span><span class="ident" id="3757921">Sum</span><span class="op" id="3757924">(</span><span class="ident" id="3757925">nil</span><span class="op" id="3757928">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757932">return</span>&nbsp;<span class="ident" id="3757939">digest</span><span class="op" id="3757945">,</span>&nbsp;<span class="ident" id="3757947">crypto</span><span class="op" id="3757953">.</span><span class="ident" id="3757954">SHA256</span><span class="op" id="3757960">,</span>&nbsp;<span class="ident" id="3757962">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3757974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3757977">if</span>&nbsp;<span class="ident" id="3757980">sigType</span>&nbsp;<span class="op" id="3757988">==</span>&nbsp;<span class="ident" id="3757991">signatureECDSA</span>&nbsp;<span class="op" id="3758006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758010">digest</span>&nbsp;<span class="op" id="3758017">:=</span>&nbsp;<span class="ident" id="3758020">h</span><span class="op" id="3758021">.</span><span class="ident" id="3758022">server</span><span class="op" id="3758028">.</span><span class="ident" id="3758029">Sum</span><span class="op" id="3758032">(</span><span class="ident" id="3758033">nil</span><span class="op" id="3758036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758040">return</span>&nbsp;<span class="ident" id="3758047">digest</span><span class="op" id="3758053">,</span>&nbsp;<span class="ident" id="3758055">crypto</span><span class="op" id="3758061">.</span><span class="ident" id="3758062">SHA1</span><span class="op" id="3758066">,</span>&nbsp;<span class="ident" id="3758068">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3758078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758082">digest</span>&nbsp;<span class="op" id="3758089">:=</span>&nbsp;<span class="builtinfunc" id="3758092">make</span><span class="op" id="3758096">(</span><span class="op" id="3758097">[</span><span class="op" id="3758098">]</span><span class="builtintype" id="3758099">byte</span><span class="op" id="3758103">,</span>&nbsp;<span class="num" id="3758105">0</span><span class="op" id="3758106">,</span>&nbsp;<span class="num" id="3758108">36</span><span class="op" id="3758110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758113">digest</span>&nbsp;<span class="op" id="3758120">=</span>&nbsp;<span class="ident" id="3758122">h</span><span class="op" id="3758123">.</span><span class="ident" id="3758124">serverMD5</span><span class="op" id="3758133">.</span><span class="ident" id="3758134">Sum</span><span class="op" id="3758137">(</span><span class="ident" id="3758138">digest</span><span class="op" id="3758144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3758147">digest</span>&nbsp;<span class="op" id="3758154">=</span>&nbsp;<span class="ident" id="3758156">h</span><span class="op" id="3758157">.</span><span class="ident" id="3758158">server</span><span class="op" id="3758164">.</span><span class="ident" id="3758165">Sum</span><span class="op" id="3758168">(</span><span class="ident" id="3758169">digest</span><span class="op" id="3758175">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3758178">return</span>&nbsp;<span class="ident" id="3758185">digest</span><span class="op" id="3758191">,</span>&nbsp;<span class="ident" id="3758193">crypto</span><span class="op" id="3758199">.</span><span class="ident" id="3758200">MD5SHA1</span><span class="op" id="3758207">,</span>&nbsp;<span class="num" id="3758209">0</span>&nbsp;<span class="comment" id="3758211">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="3758243">}</span>
</div>
</body>
</html>
