<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7323995">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7324050">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7324104">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7324155">package</span>&nbsp;<span class="ident" id="7324163">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7324168">import</span>&nbsp;<span class="op" id="7324175">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324178">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324187">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324194">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324200">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324213">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324219">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324230">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324241">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324252">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7324270">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7324277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7324280">type</span>&nbsp;<span class="ident" id="7324285">writerTestEntry</span>&nbsp;<span class="keyword" id="7324301">struct</span>&nbsp;<span class="op" id="7324308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324311">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7324320">*</span><span class="ident" id="7324321"><a href="/archive/tar/common.go.html#5196742">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324329">contents</span>&nbsp;<span class="builtintype" id="7324338">string</span><br>
<span class="lineno"></span><span class="op" id="7324345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7324348">type</span>&nbsp;<span class="ident" id="7324353">writerTest</span>&nbsp;<span class="keyword" id="7324364">struct</span>&nbsp;<span class="op" id="7324371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324374">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7324382">string</span>&nbsp;<span class="comment" id="7324389">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324421">entries</span>&nbsp;<span class="op" id="7324429">[</span><span class="op" id="7324430">]</span><span class="op" id="7324431">*</span><span class="ident" id="7324432"><a href="/archive/tar/writer_test.go.html#7324285">writerTestEntry</a></span><br>
<span class="lineno"></span><span class="op" id="7324448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7324451">var</span>&nbsp;<span class="ident" id="7324455">writerTests</span>&nbsp;<span class="op" id="7324467">=</span>&nbsp;<span class="op" id="7324469">[</span><span class="op" id="7324470">]</span><span class="op" id="7324471">*</span><span class="ident" id="7324472"><a href="/archive/tar/writer_test.go.html#7324353">writerTest</a></span><span class="op" id="7324482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324485">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324542">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324565">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7324596">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324677">file</span><span class="op" id="7324681">:</span>&nbsp;<span class="string" id="7324683">&#34;testdata/writer.tar&#34;</span><span class="op" id="7324704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324708">entries</span><span class="op" id="7324715">:</span>&nbsp;<span class="op" id="7324717">[</span><span class="op" id="7324718">]</span><span class="op" id="7324719">*</span><span class="ident" id="7324720"><a href="/archive/tar/writer_test.go.html#7324285">writerTestEntry</a></span><span class="op" id="7324735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324746">header</span><span class="op" id="7324752">:</span>&nbsp;<span class="op" id="7324754">&amp;</span><span class="ident" id="7324755"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7324761">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324768">Name</span><span class="op" id="7324772">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7324778">&#34;small.txt&#34;</span><span class="op" id="7324789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324796">Mode</span><span class="op" id="7324800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324806">0640</span><span class="op" id="7324810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324817">Uid</span><span class="op" id="7324820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324827">73025</span><span class="op" id="7324832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324839">Gid</span><span class="op" id="7324842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324849">5000</span><span class="op" id="7324853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324860">Size</span><span class="op" id="7324864">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7324870">5</span><span class="op" id="7324871">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324878">ModTime</span><span class="op" id="7324885">:</span>&nbsp;&nbsp;<span class="ident" id="7324888"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7324892">.</span><span class="ident" id="7324893">Unix</span><span class="op" id="7324897">(</span><span class="num" id="7324898">1246508266</span><span class="op" id="7324908">,</span>&nbsp;<span class="num" id="7324910">0</span><span class="op" id="7324911">)</span><span class="op" id="7324912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324919">Typeflag</span><span class="op" id="7324927">:</span>&nbsp;<span class="string" id="7324929">&#39;0&#39;</span><span class="op" id="7324932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324939">Uname</span><span class="op" id="7324944">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7324949">&#34;dsymonds&#34;</span><span class="op" id="7324959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324966">Gname</span><span class="op" id="7324971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7324976">&#34;eng&#34;</span><span class="op" id="7324981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7324987">}</span><span class="op" id="7324988">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7324994">contents</span><span class="op" id="7325002">:</span>&nbsp;<span class="string" id="7325004">&#34;Kilts&#34;</span><span class="op" id="7325011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325016">}</span><span class="op" id="7325017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325028">header</span><span class="op" id="7325034">:</span>&nbsp;<span class="op" id="7325036">&amp;</span><span class="ident" id="7325037"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7325043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325050">Name</span><span class="op" id="7325054">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325060">&#34;small2.txt&#34;</span><span class="op" id="7325072">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325079">Mode</span><span class="op" id="7325083">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325089">0640</span><span class="op" id="7325093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325100">Uid</span><span class="op" id="7325103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325110">73025</span><span class="op" id="7325115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325122">Gid</span><span class="op" id="7325125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325132">5000</span><span class="op" id="7325136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325143">Size</span><span class="op" id="7325147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325153">11</span><span class="op" id="7325155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325162">ModTime</span><span class="op" id="7325169">:</span>&nbsp;&nbsp;<span class="ident" id="7325172"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7325176">.</span><span class="ident" id="7325177">Unix</span><span class="op" id="7325181">(</span><span class="num" id="7325182">1245217492</span><span class="op" id="7325192">,</span>&nbsp;<span class="num" id="7325194">0</span><span class="op" id="7325195">)</span><span class="op" id="7325196">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325203">Typeflag</span><span class="op" id="7325211">:</span>&nbsp;<span class="string" id="7325213">&#39;0&#39;</span><span class="op" id="7325216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325223">Uname</span><span class="op" id="7325228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325233">&#34;dsymonds&#34;</span><span class="op" id="7325243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325250">Gname</span><span class="op" id="7325255">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325260">&#34;eng&#34;</span><span class="op" id="7325265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325271">}</span><span class="op" id="7325272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325278">contents</span><span class="op" id="7325286">:</span>&nbsp;<span class="string" id="7325288">&#34;Google.com\n&#34;</span><span class="op" id="7325302">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325307">}</span><span class="op" id="7325308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325319">header</span><span class="op" id="7325325">:</span>&nbsp;<span class="op" id="7325327">&amp;</span><span class="ident" id="7325328"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7325334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325341">Name</span><span class="op" id="7325345">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325351">&#34;link.txt&#34;</span><span class="op" id="7325361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325368">Mode</span><span class="op" id="7325372">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325378">0777</span><span class="op" id="7325382">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325389">Uid</span><span class="op" id="7325392">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325399">1000</span><span class="op" id="7325403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325410">Gid</span><span class="op" id="7325413">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325420">1000</span><span class="op" id="7325424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325431">Size</span><span class="op" id="7325435">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325441">0</span><span class="op" id="7325442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325449">ModTime</span><span class="op" id="7325456">:</span>&nbsp;&nbsp;<span class="ident" id="7325459"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7325463">.</span><span class="ident" id="7325464">Unix</span><span class="op" id="7325468">(</span><span class="num" id="7325469">1314603082</span><span class="op" id="7325479">,</span>&nbsp;<span class="num" id="7325481">0</span><span class="op" id="7325482">)</span><span class="op" id="7325483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325490">Typeflag</span><span class="op" id="7325498">:</span>&nbsp;<span class="string" id="7325500">&#39;2&#39;</span><span class="op" id="7325503">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325510">Linkname</span><span class="op" id="7325518">:</span>&nbsp;<span class="string" id="7325520">&#34;small.txt&#34;</span><span class="op" id="7325531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325538">Uname</span><span class="op" id="7325543">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325548">&#34;strings&#34;</span><span class="op" id="7325557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325564">Gname</span><span class="op" id="7325569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325574">&#34;strings&#34;</span><span class="op" id="7325583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325589">}</span><span class="op" id="7325590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7325596">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325614">}</span><span class="op" id="7325615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325619">}</span><span class="op" id="7325620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325623">}</span><span class="op" id="7325624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7325627">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7325690">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7325752">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325830">file</span><span class="op" id="7325834">:</span>&nbsp;<span class="string" id="7325836">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7325861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325865">entries</span><span class="op" id="7325872">:</span>&nbsp;<span class="op" id="7325874">[</span><span class="op" id="7325875">]</span><span class="op" id="7325876">*</span><span class="ident" id="7325877"><a href="/archive/tar/writer_test.go.html#7324285">writerTestEntry</a></span><span class="op" id="7325892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7325897">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325903">header</span><span class="op" id="7325909">:</span>&nbsp;<span class="op" id="7325911">&amp;</span><span class="ident" id="7325912"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7325918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325925">Name</span><span class="op" id="7325929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7325935">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7325950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325957">Mode</span><span class="op" id="7325961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325967">0640</span><span class="op" id="7325971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7325978">Uid</span><span class="op" id="7325981">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7325988">73025</span><span class="op" id="7325993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326000">Gid</span><span class="op" id="7326003">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326010">5000</span><span class="op" id="7326014">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326021">Size</span><span class="op" id="7326025">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326031">16</span>&nbsp;<span class="op" id="7326034">&lt;&lt;</span>&nbsp;<span class="num" id="7326037">30</span><span class="op" id="7326039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326046">ModTime</span><span class="op" id="7326053">:</span>&nbsp;&nbsp;<span class="ident" id="7326056"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7326060">.</span><span class="ident" id="7326061">Unix</span><span class="op" id="7326065">(</span><span class="num" id="7326066">1254699560</span><span class="op" id="7326076">,</span>&nbsp;<span class="num" id="7326078">0</span><span class="op" id="7326079">)</span><span class="op" id="7326080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326087">Typeflag</span><span class="op" id="7326095">:</span>&nbsp;<span class="string" id="7326097">&#39;0&#39;</span><span class="op" id="7326100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326107">Uname</span><span class="op" id="7326112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326117">&#34;dsymonds&#34;</span><span class="op" id="7326127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326134">Gname</span><span class="op" id="7326139">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326144">&#34;eng&#34;</span><span class="op" id="7326149">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326155">}</span><span class="op" id="7326156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326162">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326183">contents</span><span class="op" id="7326191">:</span>&nbsp;<span class="ident" id="7326193"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7326200">.</span><span class="ident" id="7326201">Repeat</span><span class="op" id="7326207">(</span><span class="string" id="7326208">&#34;\x00&#34;</span><span class="op" id="7326214">,</span>&nbsp;<span class="num" id="7326216">4</span><span class="op" id="7326217">&lt;&lt;</span><span class="num" id="7326219">10</span><span class="op" id="7326221">)</span><span class="op" id="7326222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326227">}</span><span class="op" id="7326228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326232">}</span><span class="op" id="7326233">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326236">}</span><span class="op" id="7326237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326240">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326303">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326376">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326466">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326470">file</span><span class="op" id="7326474">:</span>&nbsp;<span class="string" id="7326476">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7326506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326510">entries</span><span class="op" id="7326517">:</span>&nbsp;<span class="op" id="7326519">[</span><span class="op" id="7326520">]</span><span class="op" id="7326521">*</span><span class="ident" id="7326522"><a href="/archive/tar/writer_test.go.html#7324285">writerTestEntry</a></span><span class="op" id="7326537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326548">header</span><span class="op" id="7326554">:</span>&nbsp;<span class="op" id="7326556">&amp;</span><span class="ident" id="7326557"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7326563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326570">Name</span><span class="op" id="7326574">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7326580"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7326587">.</span><span class="ident" id="7326588">Repeat</span><span class="op" id="7326594">(</span><span class="string" id="7326595">&#34;longname/&#34;</span><span class="op" id="7326606">,</span>&nbsp;<span class="num" id="7326608">15</span><span class="op" id="7326610">)</span>&nbsp;<span class="op" id="7326612">+</span>&nbsp;<span class="string" id="7326614">&#34;16gig.txt&#34;</span><span class="op" id="7326625">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326632">Mode</span><span class="op" id="7326636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326642">0644</span><span class="op" id="7326646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326653">Uid</span><span class="op" id="7326656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326663">1000</span><span class="op" id="7326667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326674">Gid</span><span class="op" id="7326677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326684">1000</span><span class="op" id="7326688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326695">Size</span><span class="op" id="7326699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7326705">16</span>&nbsp;<span class="op" id="7326708">&lt;&lt;</span>&nbsp;<span class="num" id="7326711">30</span><span class="op" id="7326713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326720">ModTime</span><span class="op" id="7326727">:</span>&nbsp;&nbsp;<span class="ident" id="7326730"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7326734">.</span><span class="ident" id="7326735">Unix</span><span class="op" id="7326739">(</span><span class="num" id="7326740">1399583047</span><span class="op" id="7326750">,</span>&nbsp;<span class="num" id="7326752">0</span><span class="op" id="7326753">)</span><span class="op" id="7326754">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326761">Typeflag</span><span class="op" id="7326769">:</span>&nbsp;<span class="string" id="7326771">&#39;0&#39;</span><span class="op" id="7326774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326781">Uname</span><span class="op" id="7326786">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326791">&#34;guillaume&#34;</span><span class="op" id="7326802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326809">Gname</span><span class="op" id="7326814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7326819">&#34;guillaume&#34;</span><span class="op" id="7326830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326836">}</span><span class="op" id="7326837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326843">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7326864">contents</span><span class="op" id="7326872">:</span>&nbsp;<span class="ident" id="7326874"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7326881">.</span><span class="ident" id="7326882">Repeat</span><span class="op" id="7326888">(</span><span class="string" id="7326889">&#34;\x00&#34;</span><span class="op" id="7326895">,</span>&nbsp;<span class="num" id="7326897">4</span><span class="op" id="7326898">&lt;&lt;</span><span class="num" id="7326900">10</span><span class="op" id="7326902">)</span><span class="op" id="7326903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326908">}</span><span class="op" id="7326909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326913">}</span><span class="op" id="7326914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7326917">}</span><span class="op" id="7326918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326921">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7326967">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327029">file</span><span class="op" id="7327033">:</span>&nbsp;<span class="string" id="7327035">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7327055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327059">entries</span><span class="op" id="7327066">:</span>&nbsp;<span class="op" id="7327068">[</span><span class="op" id="7327069">]</span><span class="op" id="7327070">*</span><span class="ident" id="7327071"><a href="/archive/tar/writer_test.go.html#7324285">writerTestEntry</a></span><span class="op" id="7327086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327091">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327097">header</span><span class="op" id="7327103">:</span>&nbsp;<span class="op" id="7327105">&amp;</span><span class="ident" id="7327106"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7327112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327119">Name</span><span class="op" id="7327123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7327129"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7327136">.</span><span class="ident" id="7327137">Repeat</span><span class="op" id="7327143">(</span><span class="string" id="7327144">&#34;longname/&#34;</span><span class="op" id="7327155">,</span>&nbsp;<span class="num" id="7327157">15</span><span class="op" id="7327159">)</span>&nbsp;<span class="op" id="7327161">+</span>&nbsp;<span class="string" id="7327163">&#34;file.txt&#34;</span><span class="op" id="7327173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327180">Mode</span><span class="op" id="7327184">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327190">0644</span><span class="op" id="7327194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327201">Uid</span><span class="op" id="7327204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327211">0765</span><span class="op" id="7327215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327222">Gid</span><span class="op" id="7327225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327232">024</span><span class="op" id="7327235">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327242">Size</span><span class="op" id="7327246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7327252">06</span><span class="op" id="7327254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327261">ModTime</span><span class="op" id="7327268">:</span>&nbsp;&nbsp;<span class="ident" id="7327271"><a href="/archive/tar/writer_test.go.html#7324270">time</a></span><span class="op" id="7327275">.</span><span class="ident" id="7327276">Unix</span><span class="op" id="7327280">(</span><span class="num" id="7327281">1360135598</span><span class="op" id="7327291">,</span>&nbsp;<span class="num" id="7327293">0</span><span class="op" id="7327294">)</span><span class="op" id="7327295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327302">Typeflag</span><span class="op" id="7327310">:</span>&nbsp;<span class="string" id="7327312">&#39;0&#39;</span><span class="op" id="7327315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327322">Uname</span><span class="op" id="7327327">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7327332">&#34;shane&#34;</span><span class="op" id="7327339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327346">Gname</span><span class="op" id="7327351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7327356">&#34;staff&#34;</span><span class="op" id="7327363">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327369">}</span><span class="op" id="7327370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327376">contents</span><span class="op" id="7327384">:</span>&nbsp;<span class="string" id="7327386">&#34;hello\n&#34;</span><span class="op" id="7327395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327400">}</span><span class="op" id="7327401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327405">}</span><span class="op" id="7327406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327409">}</span><span class="op" id="7327410">,</span><br>
<span class="lineno">150</span><span class="op" id="7327412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7327415">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7327510">func</span>&nbsp;<span class="ident" id="7327515">bytestr</span><span class="op" id="7327522">(</span><span class="ident" id="7327523">offset</span>&nbsp;<span class="builtintype" id="7327530">int</span><span class="op" id="7327533">,</span>&nbsp;<span class="ident" id="7327535">b</span>&nbsp;<span class="op" id="7327537">[</span><span class="op" id="7327538">]</span><span class="builtintype" id="7327539">byte</span><span class="op" id="7327543">)</span>&nbsp;<span class="builtintype" id="7327545">string</span>&nbsp;<span class="op" id="7327552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327555">const</span>&nbsp;<span class="ident" id="7327561">rowLen</span>&nbsp;<span class="op" id="7327568">=</span>&nbsp;<span class="num" id="7327570">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327574">s</span>&nbsp;<span class="op" id="7327576">:=</span>&nbsp;<span class="ident" id="7327579"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7327582">.</span><span class="ident" id="7327583">Sprintf</span><span class="op" id="7327590">(</span><span class="string" id="7327591">&#34;%04x&nbsp;&#34;</span><span class="op" id="7327598">,</span>&nbsp;<span class="ident" id="7327600"><a href="/archive/tar/writer_test.go.html#7327523">offset</a></span><span class="op" id="7327606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327609">for</span>&nbsp;<span class="ident" id="7327613">_</span><span class="op" id="7327614">,</span>&nbsp;<span class="ident" id="7327616">ch</span>&nbsp;<span class="op" id="7327619">:=</span>&nbsp;<span class="keyword" id="7327622">range</span>&nbsp;<span class="ident" id="7327628"><a href="/archive/tar/writer_test.go.html#7327535">b</a></span>&nbsp;<span class="op" id="7327630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327634">switch</span>&nbsp;<span class="op" id="7327641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327645">case</span>&nbsp;<span class="string" id="7327650">&#39;0&#39;</span>&nbsp;<span class="op" id="7327654">&lt;=</span>&nbsp;<span class="ident" id="7327657"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327660">&amp;&amp;</span>&nbsp;<span class="ident" id="7327663"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327666">&lt;=</span>&nbsp;<span class="string" id="7327669">&#39;9&#39;</span><span class="op" id="7327672">,</span>&nbsp;<span class="string" id="7327674">&#39;A&#39;</span>&nbsp;<span class="op" id="7327678">&lt;=</span>&nbsp;<span class="ident" id="7327681"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327684">&amp;&amp;</span>&nbsp;<span class="ident" id="7327687"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327690">&lt;=</span>&nbsp;<span class="string" id="7327693">&#39;Z&#39;</span><span class="op" id="7327696">,</span>&nbsp;<span class="string" id="7327698">&#39;a&#39;</span>&nbsp;<span class="op" id="7327702">&lt;=</span>&nbsp;<span class="ident" id="7327705"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327708">&amp;&amp;</span>&nbsp;<span class="ident" id="7327711"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span>&nbsp;<span class="op" id="7327714">&lt;=</span>&nbsp;<span class="string" id="7327717">&#39;z&#39;</span><span class="op" id="7327720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327725"><a href="/archive/tar/writer_test.go.html#7327574">s</a></span>&nbsp;<span class="op" id="7327727">+=</span>&nbsp;<span class="ident" id="7327730"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7327733">.</span><span class="ident" id="7327734">Sprintf</span><span class="op" id="7327741">(</span><span class="string" id="7327742">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7327748">,</span>&nbsp;<span class="ident" id="7327750"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span><span class="op" id="7327752">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327756">default</span><span class="op" id="7327763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327768"><a href="/archive/tar/writer_test.go.html#7327574">s</a></span>&nbsp;<span class="op" id="7327770">+=</span>&nbsp;<span class="ident" id="7327773"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7327776">.</span><span class="ident" id="7327777">Sprintf</span><span class="op" id="7327784">(</span><span class="string" id="7327785">&#34;&nbsp;%02x&#34;</span><span class="op" id="7327792">,</span>&nbsp;<span class="ident" id="7327794"><a href="/archive/tar/writer_test.go.html#7327616">ch</a></span><span class="op" id="7327796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7327803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327806">return</span>&nbsp;<span class="ident" id="7327813"><a href="/archive/tar/writer_test.go.html#7327574">s</a></span><br>
<span class="lineno">165</span><span class="op" id="7327815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7327818">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7327871">func</span>&nbsp;<span class="ident" id="7327876">bytediff</span><span class="op" id="7327884">(</span><span class="ident" id="7327885">a</span>&nbsp;<span class="op" id="7327887">[</span><span class="op" id="7327888">]</span><span class="builtintype" id="7327889">byte</span><span class="op" id="7327893">,</span>&nbsp;<span class="ident" id="7327895">b</span>&nbsp;<span class="op" id="7327897">[</span><span class="op" id="7327898">]</span><span class="builtintype" id="7327899">byte</span><span class="op" id="7327903">)</span>&nbsp;<span class="builtintype" id="7327905">string</span>&nbsp;<span class="op" id="7327912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327915">const</span>&nbsp;<span class="ident" id="7327921">rowLen</span>&nbsp;<span class="op" id="7327928">=</span>&nbsp;<span class="num" id="7327930">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7327934">s</span>&nbsp;<span class="op" id="7327936">:=</span>&nbsp;<span class="ident" id="7327939"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7327942">.</span><span class="ident" id="7327943">Sprintf</span><span class="op" id="7327950">(</span><span class="string" id="7327951">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7327978">,</span>&nbsp;<span class="builtinfunc" id="7327980">len</span><span class="op" id="7327983">(</span><span class="ident" id="7327984"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7327985">)</span><span class="op" id="7327986">,</span>&nbsp;<span class="builtinfunc" id="7327988">len</span><span class="op" id="7327991">(</span><span class="ident" id="7327992"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7327993">)</span><span class="op" id="7327994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7327997">for</span>&nbsp;<span class="ident" id="7328001">offset</span>&nbsp;<span class="op" id="7328008">:=</span>&nbsp;<span class="num" id="7328011">0</span><span class="op" id="7328012">;</span>&nbsp;<span class="builtinfunc" id="7328014">len</span><span class="op" id="7328017">(</span><span class="ident" id="7328018"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7328019">)</span><span class="op" id="7328020">+</span><span class="builtinfunc" id="7328021">len</span><span class="op" id="7328024">(</span><span class="ident" id="7328025"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7328026">)</span>&nbsp;<span class="op" id="7328028">&gt;</span>&nbsp;<span class="num" id="7328030">0</span><span class="op" id="7328031">;</span>&nbsp;<span class="ident" id="7328033"><a href="/archive/tar/writer_test.go.html#7328001">offset</a></span>&nbsp;<span class="op" id="7328040">+=</span>&nbsp;<span class="ident" id="7328043"><a href="/archive/tar/writer_test.go.html#7327921">rowLen</a></span>&nbsp;<span class="op" id="7328050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328054">na</span><span class="op" id="7328056">,</span>&nbsp;<span class="ident" id="7328058">nb</span>&nbsp;<span class="op" id="7328061">:=</span>&nbsp;<span class="ident" id="7328064"><a href="/archive/tar/writer_test.go.html#7327921">rowLen</a></span><span class="op" id="7328070">,</span>&nbsp;<span class="ident" id="7328072"><a href="/archive/tar/writer_test.go.html#7327921">rowLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328081">if</span>&nbsp;<span class="ident" id="7328084"><a href="/archive/tar/writer_test.go.html#7328054">na</a></span>&nbsp;<span class="op" id="7328087">&gt;</span>&nbsp;<span class="builtinfunc" id="7328089">len</span><span class="op" id="7328092">(</span><span class="ident" id="7328093"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7328094">)</span>&nbsp;<span class="op" id="7328096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328101"><a href="/archive/tar/writer_test.go.html#7328054">na</a></span>&nbsp;<span class="op" id="7328104">=</span>&nbsp;<span class="builtinfunc" id="7328106">len</span><span class="op" id="7328109">(</span><span class="ident" id="7328110"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7328111">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328119">if</span>&nbsp;<span class="ident" id="7328122"><a href="/archive/tar/writer_test.go.html#7328058">nb</a></span>&nbsp;<span class="op" id="7328125">&gt;</span>&nbsp;<span class="builtinfunc" id="7328127">len</span><span class="op" id="7328130">(</span><span class="ident" id="7328131"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7328132">)</span>&nbsp;<span class="op" id="7328134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328139"><a href="/archive/tar/writer_test.go.html#7328058">nb</a></span>&nbsp;<span class="op" id="7328142">=</span>&nbsp;<span class="builtinfunc" id="7328144">len</span><span class="op" id="7328147">(</span><span class="ident" id="7328148"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7328149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328157">sa</span>&nbsp;<span class="op" id="7328160">:=</span>&nbsp;<span class="ident" id="7328163"><a href="/archive/tar/writer_test.go.html#7327515">bytestr</a></span><span class="op" id="7328170">(</span><span class="ident" id="7328171"><a href="/archive/tar/writer_test.go.html#7328001">offset</a></span><span class="op" id="7328177">,</span>&nbsp;<span class="ident" id="7328179"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7328180">[</span><span class="num" id="7328181">0</span><span class="op" id="7328182">:</span><span class="ident" id="7328183"><a href="/archive/tar/writer_test.go.html#7328054">na</a></span><span class="op" id="7328185">]</span><span class="op" id="7328186">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328190">sb</span>&nbsp;<span class="op" id="7328193">:=</span>&nbsp;<span class="ident" id="7328196"><a href="/archive/tar/writer_test.go.html#7327515">bytestr</a></span><span class="op" id="7328203">(</span><span class="ident" id="7328204"><a href="/archive/tar/writer_test.go.html#7328001">offset</a></span><span class="op" id="7328210">,</span>&nbsp;<span class="ident" id="7328212"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7328213">[</span><span class="num" id="7328214">0</span><span class="op" id="7328215">:</span><span class="ident" id="7328216"><a href="/archive/tar/writer_test.go.html#7328058">nb</a></span><span class="op" id="7328218">]</span><span class="op" id="7328219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328223">if</span>&nbsp;<span class="ident" id="7328226"><a href="/archive/tar/writer_test.go.html#7328157">sa</a></span>&nbsp;<span class="op" id="7328229">!=</span>&nbsp;<span class="ident" id="7328232"><a href="/archive/tar/writer_test.go.html#7328190">sb</a></span>&nbsp;<span class="op" id="7328235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328240"><a href="/archive/tar/writer_test.go.html#7327934">s</a></span>&nbsp;<span class="op" id="7328242">+=</span>&nbsp;<span class="ident" id="7328245"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7328248">.</span><span class="ident" id="7328249">Sprintf</span><span class="op" id="7328256">(</span><span class="string" id="7328257">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7328269">,</span>&nbsp;<span class="ident" id="7328271"><a href="/archive/tar/writer_test.go.html#7328157">sa</a></span><span class="op" id="7328273">,</span>&nbsp;<span class="ident" id="7328275"><a href="/archive/tar/writer_test.go.html#7328190">sb</a></span><span class="op" id="7328277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328285"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span>&nbsp;<span class="op" id="7328287">=</span>&nbsp;<span class="ident" id="7328289"><a href="/archive/tar/writer_test.go.html#7327885">a</a></span><span class="op" id="7328290">[</span><span class="ident" id="7328291"><a href="/archive/tar/writer_test.go.html#7328054">na</a></span><span class="op" id="7328293">:</span><span class="op" id="7328294">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328298"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span>&nbsp;<span class="op" id="7328300">=</span>&nbsp;<span class="ident" id="7328302"><a href="/archive/tar/writer_test.go.html#7327895">b</a></span><span class="op" id="7328303">[</span><span class="ident" id="7328304"><a href="/archive/tar/writer_test.go.html#7328058">nb</a></span><span class="op" id="7328306">:</span><span class="op" id="7328307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328313">return</span>&nbsp;<span class="ident" id="7328320"><a href="/archive/tar/writer_test.go.html#7327934">s</a></span><br>
<span class="lineno"></span><span class="op" id="7328322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7328325">func</span>&nbsp;<span class="ident" id="7328330">TestWriter</span><span class="op" id="7328340">(</span><span class="ident" id="7328341">t</span>&nbsp;<span class="op" id="7328343">*</span><span class="ident" id="7328344"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7328351">.</span><span class="ident" id="7328352">T</span><span class="op" id="7328353">)</span>&nbsp;<span class="op" id="7328355">{</span><br>
<span class="lineno"></span><span class="ident" id="7328357">testLoop</span><span class="op" id="7328365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328368">for</span>&nbsp;<span class="ident" id="7328372">i</span><span class="op" id="7328373">,</span>&nbsp;<span class="ident" id="7328375">test</span>&nbsp;<span class="op" id="7328380">:=</span>&nbsp;<span class="keyword" id="7328383">range</span>&nbsp;<span class="ident" id="7328389"><a href="/archive/tar/writer_test.go.html#7324455">writerTests</a></span>&nbsp;<span class="op" id="7328401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328405">expected</span><span class="op" id="7328413">,</span>&nbsp;<span class="ident" id="7328415">err</span>&nbsp;<span class="op" id="7328419">:=</span>&nbsp;<span class="ident" id="7328422"><a href="/archive/tar/writer_test.go.html#7324200">ioutil</a></span><span class="op" id="7328428">.</span><span class="ident" id="7328429">ReadFile</span><span class="op" id="7328437">(</span><span class="ident" id="7328438"><a href="/archive/tar/writer_test.go.html#7328375">test</a></span><span class="op" id="7328442">.</span><span class="ident" id="7328443">file</span><span class="op" id="7328447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328451">if</span>&nbsp;<span class="ident" id="7328454"><a href="/archive/tar/writer_test.go.html#7328415">err</a></span>&nbsp;<span class="op" id="7328458">!=</span>&nbsp;<span class="ident" id="7328461">nil</span>&nbsp;<span class="op" id="7328465">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328470"><a href="/archive/tar/writer_test.go.html#7328341">t</a></span><span class="op" id="7328471">.</span><span class="ident" id="7328472">Errorf</span><span class="op" id="7328478">(</span><span class="string" id="7328479">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7328510">,</span>&nbsp;<span class="ident" id="7328512"><a href="/archive/tar/writer_test.go.html#7328372">i</a></span><span class="op" id="7328513">,</span>&nbsp;<span class="ident" id="7328515"><a href="/archive/tar/writer_test.go.html#7328415">err</a></span><span class="op" id="7328518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328523">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328539">buf</span>&nbsp;<span class="op" id="7328543">:=</span>&nbsp;<span class="builtinfunc" id="7328546">new</span><span class="op" id="7328549">(</span><span class="ident" id="7328550"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7328555">.</span><span class="ident" id="7328556">Buffer</span><span class="op" id="7328562">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328566">tw</span>&nbsp;<span class="op" id="7328569">:=</span>&nbsp;<span class="ident" id="7328572"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7328581">(</span><span class="ident" id="7328582"><a href="/archive/tar/writer_test.go.html#7324252">iotest</a></span><span class="op" id="7328588">.</span><span class="ident" id="7328589">TruncateWriter</span><span class="op" id="7328603">(</span><span class="ident" id="7328604"><a href="/archive/tar/writer_test.go.html#7328539">buf</a></span><span class="op" id="7328607">,</span>&nbsp;<span class="num" id="7328609">4</span><span class="op" id="7328610">&lt;&lt;</span><span class="num" id="7328612">10</span><span class="op" id="7328614">)</span><span class="op" id="7328615">)</span>&nbsp;<span class="comment" id="7328617">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328648">big</span>&nbsp;<span class="op" id="7328652">:=</span>&nbsp;<span class="ident" id="7328655">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328663">for</span>&nbsp;<span class="ident" id="7328667">j</span><span class="op" id="7328668">,</span>&nbsp;<span class="ident" id="7328670">entry</span>&nbsp;<span class="op" id="7328676">:=</span>&nbsp;<span class="keyword" id="7328679">range</span>&nbsp;<span class="ident" id="7328685"><a href="/archive/tar/writer_test.go.html#7328375">test</a></span><span class="op" id="7328689">.</span><span class="ident" id="7328690">entries</span>&nbsp;<span class="op" id="7328698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328703"><a href="/archive/tar/writer_test.go.html#7328648">big</a></span>&nbsp;<span class="op" id="7328707">=</span>&nbsp;<span class="ident" id="7328709"><a href="/archive/tar/writer_test.go.html#7328648">big</a></span>&nbsp;<span class="op" id="7328713">||</span>&nbsp;<span class="ident" id="7328716"><a href="/archive/tar/writer_test.go.html#7328670">entry</a></span><span class="op" id="7328721">.</span><span class="ident" id="7328722">header</span><span class="op" id="7328728">.</span><span class="ident" id="7328729">Size</span>&nbsp;<span class="op" id="7328734">&gt;</span>&nbsp;<span class="num" id="7328736">1</span><span class="op" id="7328737">&lt;&lt;</span><span class="num" id="7328739">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328745">if</span>&nbsp;<span class="ident" id="7328748">err</span>&nbsp;<span class="op" id="7328752">:=</span>&nbsp;<span class="ident" id="7328755"><a href="/archive/tar/writer_test.go.html#7328566">tw</a></span><span class="op" id="7328757">.</span><span class="ident" id="7328758">WriteHeader</span><span class="op" id="7328769">(</span><span class="ident" id="7328770"><a href="/archive/tar/writer_test.go.html#7328670">entry</a></span><span class="op" id="7328775">.</span><span class="ident" id="7328776">header</span><span class="op" id="7328782">)</span><span class="op" id="7328783">;</span>&nbsp;<span class="ident" id="7328785"><a href="/archive/tar/writer_test.go.html#7328748">err</a></span>&nbsp;<span class="op" id="7328789">!=</span>&nbsp;<span class="ident" id="7328792">nil</span>&nbsp;<span class="op" id="7328796">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328802"><a href="/archive/tar/writer_test.go.html#7328341">t</a></span><span class="op" id="7328803">.</span><span class="ident" id="7328804">Errorf</span><span class="op" id="7328810">(</span><span class="string" id="7328811">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7328857">,</span>&nbsp;<span class="ident" id="7328859"><a href="/archive/tar/writer_test.go.html#7328372">i</a></span><span class="op" id="7328860">,</span>&nbsp;<span class="ident" id="7328862"><a href="/archive/tar/writer_test.go.html#7328667">j</a></span><span class="op" id="7328863">,</span>&nbsp;<span class="ident" id="7328865"><a href="/archive/tar/writer_test.go.html#7328748">err</a></span><span class="op" id="7328868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328874">continue</span>&nbsp;<span class="ident" id="7328883">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7328895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7328900">if</span>&nbsp;<span class="ident" id="7328903">_</span><span class="op" id="7328904">,</span>&nbsp;<span class="ident" id="7328906">err</span>&nbsp;<span class="op" id="7328910">:=</span>&nbsp;<span class="ident" id="7328913"><a href="/archive/tar/writer_test.go.html#7324194">io</a></span><span class="op" id="7328915">.</span><span class="ident" id="7328916">WriteString</span><span class="op" id="7328927">(</span><span class="ident" id="7328928"><a href="/archive/tar/writer_test.go.html#7328566">tw</a></span><span class="op" id="7328930">,</span>&nbsp;<span class="ident" id="7328932"><a href="/archive/tar/writer_test.go.html#7328670">entry</a></span><span class="op" id="7328937">.</span><span class="ident" id="7328938">contents</span><span class="op" id="7328946">)</span><span class="op" id="7328947">;</span>&nbsp;<span class="ident" id="7328949"><a href="/archive/tar/writer_test.go.html#7328906">err</a></span>&nbsp;<span class="op" id="7328953">!=</span>&nbsp;<span class="ident" id="7328956">nil</span>&nbsp;<span class="op" id="7328960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7328966"><a href="/archive/tar/writer_test.go.html#7328341">t</a></span><span class="op" id="7328967">.</span><span class="ident" id="7328968">Errorf</span><span class="op" id="7328974">(</span><span class="string" id="7328975">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7329023">,</span>&nbsp;<span class="ident" id="7329025"><a href="/archive/tar/writer_test.go.html#7328372">i</a></span><span class="op" id="7329026">,</span>&nbsp;<span class="ident" id="7329028"><a href="/archive/tar/writer_test.go.html#7328667">j</a></span><span class="op" id="7329029">,</span>&nbsp;<span class="ident" id="7329031"><a href="/archive/tar/writer_test.go.html#7328906">err</a></span><span class="op" id="7329034">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329040">continue</span>&nbsp;<span class="ident" id="7329049">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7329069">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329129">if</span>&nbsp;<span class="ident" id="7329132">err</span>&nbsp;<span class="op" id="7329136">:=</span>&nbsp;<span class="ident" id="7329139"><a href="/archive/tar/writer_test.go.html#7328566">tw</a></span><span class="op" id="7329141">.</span><span class="ident" id="7329142">Close</span><span class="op" id="7329147">(</span><span class="op" id="7329148">)</span><span class="op" id="7329149">;</span>&nbsp;<span class="ident" id="7329151"><a href="/archive/tar/writer_test.go.html#7329132">err</a></span>&nbsp;<span class="op" id="7329155">!=</span>&nbsp;<span class="ident" id="7329158">nil</span>&nbsp;<span class="op" id="7329162">&amp;&amp;</span>&nbsp;<span class="op" id="7329165">!</span><span class="ident" id="7329166"><a href="/archive/tar/writer_test.go.html#7328648">big</a></span>&nbsp;<span class="op" id="7329170">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329175"><a href="/archive/tar/writer_test.go.html#7328341">t</a></span><span class="op" id="7329176">.</span><span class="ident" id="7329177">Errorf</span><span class="op" id="7329183">(</span><span class="string" id="7329184">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7329221">,</span>&nbsp;<span class="ident" id="7329223"><a href="/archive/tar/writer_test.go.html#7328372">i</a></span><span class="op" id="7329224">,</span>&nbsp;<span class="ident" id="7329226"><a href="/archive/tar/writer_test.go.html#7329132">err</a></span><span class="op" id="7329229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329234">continue</span>&nbsp;<span class="ident" id="7329243">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329259">actual</span>&nbsp;<span class="op" id="7329266">:=</span>&nbsp;<span class="ident" id="7329269"><a href="/archive/tar/writer_test.go.html#7328539">buf</a></span><span class="op" id="7329272">.</span><span class="ident" id="7329273">Bytes</span><span class="op" id="7329278">(</span><span class="op" id="7329279">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329283">if</span>&nbsp;<span class="op" id="7329286">!</span><span class="ident" id="7329287"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7329292">.</span><span class="ident" id="7329293">Equal</span><span class="op" id="7329298">(</span><span class="ident" id="7329299"><a href="/archive/tar/writer_test.go.html#7328405">expected</a></span><span class="op" id="7329307">,</span>&nbsp;<span class="ident" id="7329309"><a href="/archive/tar/writer_test.go.html#7329259">actual</a></span><span class="op" id="7329315">)</span>&nbsp;<span class="op" id="7329317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329322"><a href="/archive/tar/writer_test.go.html#7328341">t</a></span><span class="op" id="7329323">.</span><span class="ident" id="7329324">Errorf</span><span class="op" id="7329330">(</span><span class="string" id="7329331">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7329386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329392"><a href="/archive/tar/writer_test.go.html#7328372">i</a></span><span class="op" id="7329393">,</span>&nbsp;<span class="ident" id="7329395"><a href="/archive/tar/writer_test.go.html#7327876">bytediff</a></span><span class="op" id="7329403">(</span><span class="ident" id="7329404"><a href="/archive/tar/writer_test.go.html#7328405">expected</a></span><span class="op" id="7329412">,</span>&nbsp;<span class="ident" id="7329414"><a href="/archive/tar/writer_test.go.html#7329259">actual</a></span><span class="op" id="7329420">)</span><span class="op" id="7329421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329429">if</span>&nbsp;<span class="ident" id="7329432"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7329439">.</span><span class="ident" id="7329440">Short</span><span class="op" id="7329445">(</span><span class="op" id="7329446">)</span>&nbsp;<span class="op" id="7329448">{</span>&nbsp;<span class="comment" id="7329450">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329497">}</span><br>
<span class="lineno"></span><span class="op" id="7329499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7329502">func</span>&nbsp;<span class="ident" id="7329507">TestPax</span><span class="op" id="7329514">(</span><span class="ident" id="7329515">t</span>&nbsp;<span class="op" id="7329517">*</span><span class="ident" id="7329518"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7329525">.</span><span class="ident" id="7329526">T</span><span class="op" id="7329527">)</span>&nbsp;<span class="op" id="7329529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7329532">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329572">fileinfo</span><span class="op" id="7329580">,</span>&nbsp;<span class="ident" id="7329582">err</span>&nbsp;<span class="op" id="7329586">:=</span>&nbsp;<span class="ident" id="7329589"><a href="/archive/tar/writer_test.go.html#7324213">os</a></span><span class="op" id="7329591">.</span><span class="ident" id="7329592">Stat</span><span class="op" id="7329596">(</span><span class="string" id="7329597">&#34;testdata/small.txt&#34;</span><span class="op" id="7329617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329620">if</span>&nbsp;<span class="ident" id="7329623"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7329627">!=</span>&nbsp;<span class="ident" id="7329630">nil</span>&nbsp;<span class="op" id="7329634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329638"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7329639">.</span><span class="ident" id="7329640">Fatal</span><span class="op" id="7329645">(</span><span class="ident" id="7329646"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span><span class="op" id="7329649">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329655">hdr</span><span class="op" id="7329658">,</span>&nbsp;<span class="ident" id="7329660"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7329664">:=</span>&nbsp;<span class="ident" id="7329667"><a href="/archive/tar/common.go.html#5201063">FileInfoHeader</a></span><span class="op" id="7329681">(</span><span class="ident" id="7329682"><a href="/archive/tar/writer_test.go.html#7329572">fileinfo</a></span><span class="op" id="7329690">,</span>&nbsp;<span class="string" id="7329692">&#34;&#34;</span><span class="op" id="7329694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329697">if</span>&nbsp;<span class="ident" id="7329700"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7329704">!=</span>&nbsp;<span class="ident" id="7329707">nil</span>&nbsp;<span class="op" id="7329711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329715"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7329716">.</span><span class="ident" id="7329717">Fatalf</span><span class="op" id="7329723">(</span><span class="string" id="7329724">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7329737">,</span>&nbsp;<span class="ident" id="7329739"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span><span class="op" id="7329742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7329745">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7329748">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329788">longName</span>&nbsp;<span class="op" id="7329797">:=</span>&nbsp;<span class="ident" id="7329800"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7329807">.</span><span class="ident" id="7329808">Repeat</span><span class="op" id="7329814">(</span><span class="string" id="7329815">&#34;ab&#34;</span><span class="op" id="7329819">,</span>&nbsp;<span class="num" id="7329821">100</span><span class="op" id="7329824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329827">contents</span>&nbsp;<span class="op" id="7329836">:=</span>&nbsp;<span class="ident" id="7329839"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7329846">.</span><span class="ident" id="7329847">Repeat</span><span class="op" id="7329853">(</span><span class="string" id="7329854">&#34;&nbsp;&#34;</span><span class="op" id="7329857">,</span>&nbsp;<span class="builtintype" id="7329859">int</span><span class="op" id="7329862">(</span><span class="ident" id="7329863"><a href="/archive/tar/writer_test.go.html#7329655">hdr</a></span><span class="op" id="7329866">.</span><span class="ident" id="7329867">Size</span><span class="op" id="7329871">)</span><span class="op" id="7329872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329875"><a href="/archive/tar/writer_test.go.html#7329655">hdr</a></span><span class="op" id="7329878">.</span><span class="ident" id="7329879">Name</span>&nbsp;<span class="op" id="7329884">=</span>&nbsp;<span class="ident" id="7329886"><a href="/archive/tar/writer_test.go.html#7329788">longName</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329896">var</span>&nbsp;<span class="ident" id="7329900">buf</span>&nbsp;<span class="ident" id="7329904"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7329909">.</span><span class="ident" id="7329910">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329918">writer</span>&nbsp;<span class="op" id="7329925">:=</span>&nbsp;<span class="ident" id="7329928"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7329937">(</span><span class="op" id="7329938">&amp;</span><span class="ident" id="7329939"><a href="/archive/tar/writer_test.go.html#7329900">buf</a></span><span class="op" id="7329942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7329945">if</span>&nbsp;<span class="ident" id="7329948">err</span>&nbsp;<span class="op" id="7329952">:=</span>&nbsp;<span class="ident" id="7329955"><a href="/archive/tar/writer_test.go.html#7329918">writer</a></span><span class="op" id="7329961">.</span><span class="ident" id="7329962">WriteHeader</span><span class="op" id="7329973">(</span><span class="ident" id="7329974"><a href="/archive/tar/writer_test.go.html#7329655">hdr</a></span><span class="op" id="7329977">)</span><span class="op" id="7329978">;</span>&nbsp;<span class="ident" id="7329980"><a href="/archive/tar/writer_test.go.html#7329948">err</a></span>&nbsp;<span class="op" id="7329984">!=</span>&nbsp;<span class="ident" id="7329987">nil</span>&nbsp;<span class="op" id="7329991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7329995"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7329996">.</span><span class="ident" id="7329997">Fatal</span><span class="op" id="7330002">(</span><span class="ident" id="7330003"><a href="/archive/tar/writer_test.go.html#7329948">err</a></span><span class="op" id="7330006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330012">if</span>&nbsp;<span class="ident" id="7330015">_</span><span class="op" id="7330016">,</span>&nbsp;<span class="ident" id="7330018"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7330022">=</span>&nbsp;<span class="ident" id="7330024"><a href="/archive/tar/writer_test.go.html#7329918">writer</a></span><span class="op" id="7330030">.</span><span class="ident" id="7330031">Write</span><span class="op" id="7330036">(</span><span class="op" id="7330037">[</span><span class="op" id="7330038">]</span><span class="builtintype" id="7330039">byte</span><span class="op" id="7330043">(</span><span class="ident" id="7330044"><a href="/archive/tar/writer_test.go.html#7329827">contents</a></span><span class="op" id="7330052">)</span><span class="op" id="7330053">)</span><span class="op" id="7330054">;</span>&nbsp;<span class="ident" id="7330056"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7330060">!=</span>&nbsp;<span class="ident" id="7330063">nil</span>&nbsp;<span class="op" id="7330067">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330071"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7330072">.</span><span class="ident" id="7330073">Fatal</span><span class="op" id="7330078">(</span><span class="ident" id="7330079"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span><span class="op" id="7330082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330088">if</span>&nbsp;<span class="ident" id="7330091">err</span>&nbsp;<span class="op" id="7330095">:=</span>&nbsp;<span class="ident" id="7330098"><a href="/archive/tar/writer_test.go.html#7329918">writer</a></span><span class="op" id="7330104">.</span><span class="ident" id="7330105">Close</span><span class="op" id="7330110">(</span><span class="op" id="7330111">)</span><span class="op" id="7330112">;</span>&nbsp;<span class="ident" id="7330114"><a href="/archive/tar/writer_test.go.html#7330091">err</a></span>&nbsp;<span class="op" id="7330118">!=</span>&nbsp;<span class="ident" id="7330121">nil</span>&nbsp;<span class="op" id="7330125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330129"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7330130">.</span><span class="ident" id="7330131">Fatal</span><span class="op" id="7330136">(</span><span class="ident" id="7330137"><a href="/archive/tar/writer_test.go.html#7330091">err</a></span><span class="op" id="7330140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330143">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330146">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330204">if</span>&nbsp;<span class="op" id="7330207">!</span><span class="ident" id="7330208"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7330213">.</span><span class="ident" id="7330214">Contains</span><span class="op" id="7330222">(</span><span class="ident" id="7330223"><a href="/archive/tar/writer_test.go.html#7329900">buf</a></span><span class="op" id="7330226">.</span><span class="ident" id="7330227">Bytes</span><span class="op" id="7330232">(</span><span class="op" id="7330233">)</span><span class="op" id="7330234">,</span>&nbsp;<span class="op" id="7330236">[</span><span class="op" id="7330237">]</span><span class="builtintype" id="7330238">byte</span><span class="op" id="7330242">(</span><span class="string" id="7330243">&#34;PaxHeaders.&#34;</span><span class="op" id="7330256">)</span><span class="op" id="7330257">)</span>&nbsp;<span class="op" id="7330259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330263"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7330264">.</span><span class="ident" id="7330265">Fatal</span><span class="op" id="7330270">(</span><span class="string" id="7330271">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7330320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330326">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330388">reader</span>&nbsp;<span class="op" id="7330395">:=</span>&nbsp;<span class="ident" id="7330398"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7330407">(</span><span class="op" id="7330408">&amp;</span><span class="ident" id="7330409"><a href="/archive/tar/writer_test.go.html#7329900">buf</a></span><span class="op" id="7330412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330415"><a href="/archive/tar/writer_test.go.html#7329655">hdr</a></span><span class="op" id="7330418">,</span>&nbsp;<span class="ident" id="7330420"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7330424">=</span>&nbsp;<span class="ident" id="7330426"><a href="/archive/tar/writer_test.go.html#7330388">reader</a></span><span class="op" id="7330432">.</span><span class="ident" id="7330433">Next</span><span class="op" id="7330437">(</span><span class="op" id="7330438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330441">if</span>&nbsp;<span class="ident" id="7330444"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span>&nbsp;<span class="op" id="7330448">!=</span>&nbsp;<span class="ident" id="7330451">nil</span>&nbsp;<span class="op" id="7330455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330459"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7330460">.</span><span class="ident" id="7330461">Fatal</span><span class="op" id="7330466">(</span><span class="ident" id="7330467"><a href="/archive/tar/writer_test.go.html#7329582">err</a></span><span class="op" id="7330470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330473">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330476">if</span>&nbsp;<span class="ident" id="7330479"><a href="/archive/tar/writer_test.go.html#7329655">hdr</a></span><span class="op" id="7330482">.</span><span class="ident" id="7330483">Name</span>&nbsp;<span class="op" id="7330488">!=</span>&nbsp;<span class="ident" id="7330491"><a href="/archive/tar/writer_test.go.html#7329788">longName</a></span>&nbsp;<span class="op" id="7330500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330504"><a href="/archive/tar/writer_test.go.html#7329515">t</a></span><span class="op" id="7330505">.</span><span class="ident" id="7330506">Fatal</span><span class="op" id="7330511">(</span><span class="string" id="7330512">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7330545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330548">}</span><br>
<span class="lineno"></span><span class="op" id="7330550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7330553">func</span>&nbsp;<span class="ident" id="7330558">TestPaxSymlink</span><span class="op" id="7330572">(</span><span class="ident" id="7330573">t</span>&nbsp;<span class="op" id="7330575">*</span><span class="ident" id="7330576"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7330583">.</span><span class="ident" id="7330584">T</span><span class="op" id="7330585">)</span>&nbsp;<span class="op" id="7330587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330590">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330634">fileinfo</span><span class="op" id="7330642">,</span>&nbsp;<span class="ident" id="7330644">err</span>&nbsp;<span class="op" id="7330648">:=</span>&nbsp;<span class="ident" id="7330651"><a href="/archive/tar/writer_test.go.html#7324213">os</a></span><span class="op" id="7330653">.</span><span class="ident" id="7330654">Stat</span><span class="op" id="7330658">(</span><span class="string" id="7330659">&#34;testdata/small.txt&#34;</span><span class="op" id="7330679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330682">if</span>&nbsp;<span class="ident" id="7330685"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span>&nbsp;<span class="op" id="7330689">!=</span>&nbsp;<span class="ident" id="7330692">nil</span>&nbsp;<span class="op" id="7330696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330700"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7330701">.</span><span class="ident" id="7330702">Fatal</span><span class="op" id="7330707">(</span><span class="ident" id="7330708"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span><span class="op" id="7330711">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330717">hdr</span><span class="op" id="7330720">,</span>&nbsp;<span class="ident" id="7330722"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span>&nbsp;<span class="op" id="7330726">:=</span>&nbsp;<span class="ident" id="7330729"><a href="/archive/tar/common.go.html#5201063">FileInfoHeader</a></span><span class="op" id="7330743">(</span><span class="ident" id="7330744"><a href="/archive/tar/writer_test.go.html#7330634">fileinfo</a></span><span class="op" id="7330752">,</span>&nbsp;<span class="string" id="7330754">&#34;&#34;</span><span class="op" id="7330756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330759"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7330762">.</span><span class="ident" id="7330763">Typeflag</span>&nbsp;<span class="op" id="7330772">=</span>&nbsp;<span class="ident" id="7330774"><a href="/archive/tar/common.go.html#5196096">TypeSymlink</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330787">if</span>&nbsp;<span class="ident" id="7330790"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span>&nbsp;<span class="op" id="7330794">!=</span>&nbsp;<span class="ident" id="7330797">nil</span>&nbsp;<span class="op" id="7330801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330805"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7330806">.</span><span class="ident" id="7330807">Fatalf</span><span class="op" id="7330813">(</span><span class="string" id="7330814">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7330828">,</span>&nbsp;<span class="ident" id="7330830"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span><span class="op" id="7330833">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7330836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7330839">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330883">longLinkname</span>&nbsp;<span class="op" id="7330896">:=</span>&nbsp;<span class="ident" id="7330899"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7330906">.</span><span class="ident" id="7330907">Repeat</span><span class="op" id="7330913">(</span><span class="string" id="7330914">&#34;1234567890/1234567890&#34;</span><span class="op" id="7330937">,</span>&nbsp;<span class="num" id="7330939">10</span><span class="op" id="7330941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330944"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7330947">.</span><span class="ident" id="7330948">Linkname</span>&nbsp;<span class="op" id="7330957">=</span>&nbsp;<span class="ident" id="7330959"><a href="/archive/tar/writer_test.go.html#7330883">longLinkname</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7330974"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7330977">.</span><span class="ident" id="7330978">Size</span>&nbsp;<span class="op" id="7330983">=</span>&nbsp;<span class="num" id="7330985">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7330988">var</span>&nbsp;<span class="ident" id="7330992">buf</span>&nbsp;<span class="ident" id="7330996"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7331001">.</span><span class="ident" id="7331002">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331010">writer</span>&nbsp;<span class="op" id="7331017">:=</span>&nbsp;<span class="ident" id="7331020"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7331029">(</span><span class="op" id="7331030">&amp;</span><span class="ident" id="7331031"><a href="/archive/tar/writer_test.go.html#7330992">buf</a></span><span class="op" id="7331034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331037">if</span>&nbsp;<span class="ident" id="7331040">err</span>&nbsp;<span class="op" id="7331044">:=</span>&nbsp;<span class="ident" id="7331047"><a href="/archive/tar/writer_test.go.html#7331010">writer</a></span><span class="op" id="7331053">.</span><span class="ident" id="7331054">WriteHeader</span><span class="op" id="7331065">(</span><span class="ident" id="7331066"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7331069">)</span><span class="op" id="7331070">;</span>&nbsp;<span class="ident" id="7331072"><a href="/archive/tar/writer_test.go.html#7331040">err</a></span>&nbsp;<span class="op" id="7331076">!=</span>&nbsp;<span class="ident" id="7331079">nil</span>&nbsp;<span class="op" id="7331083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331087"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7331088">.</span><span class="ident" id="7331089">Fatal</span><span class="op" id="7331094">(</span><span class="ident" id="7331095"><a href="/archive/tar/writer_test.go.html#7331040">err</a></span><span class="op" id="7331098">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331104">if</span>&nbsp;<span class="ident" id="7331107">err</span>&nbsp;<span class="op" id="7331111">:=</span>&nbsp;<span class="ident" id="7331114"><a href="/archive/tar/writer_test.go.html#7331010">writer</a></span><span class="op" id="7331120">.</span><span class="ident" id="7331121">Close</span><span class="op" id="7331126">(</span><span class="op" id="7331127">)</span><span class="op" id="7331128">;</span>&nbsp;<span class="ident" id="7331130"><a href="/archive/tar/writer_test.go.html#7331107">err</a></span>&nbsp;<span class="op" id="7331134">!=</span>&nbsp;<span class="ident" id="7331137">nil</span>&nbsp;<span class="op" id="7331141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331145"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7331146">.</span><span class="ident" id="7331147">Fatal</span><span class="op" id="7331152">(</span><span class="ident" id="7331153"><a href="/archive/tar/writer_test.go.html#7331107">err</a></span><span class="op" id="7331156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331162">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331220">if</span>&nbsp;<span class="op" id="7331223">!</span><span class="ident" id="7331224"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7331229">.</span><span class="ident" id="7331230">Contains</span><span class="op" id="7331238">(</span><span class="ident" id="7331239"><a href="/archive/tar/writer_test.go.html#7330992">buf</a></span><span class="op" id="7331242">.</span><span class="ident" id="7331243">Bytes</span><span class="op" id="7331248">(</span><span class="op" id="7331249">)</span><span class="op" id="7331250">,</span>&nbsp;<span class="op" id="7331252">[</span><span class="op" id="7331253">]</span><span class="builtintype" id="7331254">byte</span><span class="op" id="7331258">(</span><span class="string" id="7331259">&#34;PaxHeaders.&#34;</span><span class="op" id="7331272">)</span><span class="op" id="7331273">)</span>&nbsp;<span class="op" id="7331275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331279"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7331280">.</span><span class="ident" id="7331281">Fatal</span><span class="op" id="7331286">(</span><span class="string" id="7331287">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7331336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331342">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331404">reader</span>&nbsp;<span class="op" id="7331411">:=</span>&nbsp;<span class="ident" id="7331414"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7331423">(</span><span class="op" id="7331424">&amp;</span><span class="ident" id="7331425"><a href="/archive/tar/writer_test.go.html#7330992">buf</a></span><span class="op" id="7331428">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331431"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7331434">,</span>&nbsp;<span class="ident" id="7331436"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span>&nbsp;<span class="op" id="7331440">=</span>&nbsp;<span class="ident" id="7331442"><a href="/archive/tar/writer_test.go.html#7331404">reader</a></span><span class="op" id="7331448">.</span><span class="ident" id="7331449">Next</span><span class="op" id="7331453">(</span><span class="op" id="7331454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331457">if</span>&nbsp;<span class="ident" id="7331460"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span>&nbsp;<span class="op" id="7331464">!=</span>&nbsp;<span class="ident" id="7331467">nil</span>&nbsp;<span class="op" id="7331471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331475"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7331476">.</span><span class="ident" id="7331477">Fatal</span><span class="op" id="7331482">(</span><span class="ident" id="7331483"><a href="/archive/tar/writer_test.go.html#7330644">err</a></span><span class="op" id="7331486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331492">if</span>&nbsp;<span class="ident" id="7331495"><a href="/archive/tar/writer_test.go.html#7330717">hdr</a></span><span class="op" id="7331498">.</span><span class="ident" id="7331499">Linkname</span>&nbsp;<span class="op" id="7331508">!=</span>&nbsp;<span class="ident" id="7331511"><a href="/archive/tar/writer_test.go.html#7330883">longLinkname</a></span>&nbsp;<span class="op" id="7331524">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331528"><a href="/archive/tar/writer_test.go.html#7330573">t</a></span><span class="op" id="7331529">.</span><span class="ident" id="7331530">Fatal</span><span class="op" id="7331535">(</span><span class="string" id="7331536">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7331569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331572">}</span><br>
<span class="lineno"></span><span class="op" id="7331574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7331577">func</span>&nbsp;<span class="ident" id="7331582">TestPaxNonAscii</span><span class="op" id="7331597">(</span><span class="ident" id="7331598">t</span>&nbsp;<span class="op" id="7331600">*</span><span class="ident" id="7331601"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7331608">.</span><span class="ident" id="7331609">T</span><span class="op" id="7331610">)</span>&nbsp;<span class="op" id="7331612">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331615">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331687">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331742">fileinfo</span><span class="op" id="7331750">,</span>&nbsp;<span class="ident" id="7331752">err</span>&nbsp;<span class="op" id="7331756">:=</span>&nbsp;<span class="ident" id="7331759"><a href="/archive/tar/writer_test.go.html#7324213">os</a></span><span class="op" id="7331761">.</span><span class="ident" id="7331762">Stat</span><span class="op" id="7331766">(</span><span class="string" id="7331767">&#34;testdata/small.txt&#34;</span><span class="op" id="7331787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331790">if</span>&nbsp;<span class="ident" id="7331793"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7331797">!=</span>&nbsp;<span class="ident" id="7331800">nil</span>&nbsp;<span class="op" id="7331804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331808"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7331809">.</span><span class="ident" id="7331810">Fatal</span><span class="op" id="7331815">(</span><span class="ident" id="7331816"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span><span class="op" id="7331819">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331826">hdr</span><span class="op" id="7331829">,</span>&nbsp;<span class="ident" id="7331831"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7331835">:=</span>&nbsp;<span class="ident" id="7331838"><a href="/archive/tar/common.go.html#5201063">FileInfoHeader</a></span><span class="op" id="7331852">(</span><span class="ident" id="7331853"><a href="/archive/tar/writer_test.go.html#7331742">fileinfo</a></span><span class="op" id="7331861">,</span>&nbsp;<span class="string" id="7331863">&#34;&#34;</span><span class="op" id="7331865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7331868">if</span>&nbsp;<span class="ident" id="7331871"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7331875">!=</span>&nbsp;<span class="ident" id="7331878">nil</span>&nbsp;<span class="op" id="7331882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331886"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7331887">.</span><span class="ident" id="7331888">Fatalf</span><span class="op" id="7331894">(</span><span class="string" id="7331895">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7331909">,</span>&nbsp;<span class="ident" id="7331911"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span><span class="op" id="7331914">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7331917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7331921">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331942">chineseFilename</span>&nbsp;<span class="op" id="7331958">:=</span>&nbsp;<span class="string" id="7331961">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7331974">chineseGroupname</span>&nbsp;<span class="op" id="7331991">:=</span>&nbsp;<span class="string" id="7331994">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332001">chineseUsername</span>&nbsp;<span class="op" id="7332017">:=</span>&nbsp;<span class="string" id="7332020">&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332034"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332037">.</span><span class="ident" id="7332038">Name</span>&nbsp;<span class="op" id="7332043">=</span>&nbsp;<span class="ident" id="7332045"><a href="/archive/tar/writer_test.go.html#7331942">chineseFilename</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332062"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332065">.</span><span class="ident" id="7332066">Gname</span>&nbsp;<span class="op" id="7332072">=</span>&nbsp;<span class="ident" id="7332074"><a href="/archive/tar/writer_test.go.html#7331974">chineseGroupname</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332092"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332095">.</span><span class="ident" id="7332096">Uname</span>&nbsp;<span class="op" id="7332102">=</span>&nbsp;<span class="ident" id="7332104"><a href="/archive/tar/writer_test.go.html#7332001">chineseUsername</a></span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332122">contents</span>&nbsp;<span class="op" id="7332131">:=</span>&nbsp;<span class="ident" id="7332134"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7332141">.</span><span class="ident" id="7332142">Repeat</span><span class="op" id="7332148">(</span><span class="string" id="7332149">&#34;&nbsp;&#34;</span><span class="op" id="7332152">,</span>&nbsp;<span class="builtintype" id="7332154">int</span><span class="op" id="7332157">(</span><span class="ident" id="7332158"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332161">.</span><span class="ident" id="7332162">Size</span><span class="op" id="7332166">)</span><span class="op" id="7332167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332171">var</span>&nbsp;<span class="ident" id="7332175">buf</span>&nbsp;<span class="ident" id="7332179"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7332184">.</span><span class="ident" id="7332185">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332193">writer</span>&nbsp;<span class="op" id="7332200">:=</span>&nbsp;<span class="ident" id="7332203"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7332212">(</span><span class="op" id="7332213">&amp;</span><span class="ident" id="7332214"><a href="/archive/tar/writer_test.go.html#7332175">buf</a></span><span class="op" id="7332217">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332220">if</span>&nbsp;<span class="ident" id="7332223">err</span>&nbsp;<span class="op" id="7332227">:=</span>&nbsp;<span class="ident" id="7332230"><a href="/archive/tar/writer_test.go.html#7332193">writer</a></span><span class="op" id="7332236">.</span><span class="ident" id="7332237">WriteHeader</span><span class="op" id="7332248">(</span><span class="ident" id="7332249"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332252">)</span><span class="op" id="7332253">;</span>&nbsp;<span class="ident" id="7332255"><a href="/archive/tar/writer_test.go.html#7332223">err</a></span>&nbsp;<span class="op" id="7332259">!=</span>&nbsp;<span class="ident" id="7332262">nil</span>&nbsp;<span class="op" id="7332266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332270"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332271">.</span><span class="ident" id="7332272">Fatal</span><span class="op" id="7332277">(</span><span class="ident" id="7332278"><a href="/archive/tar/writer_test.go.html#7332223">err</a></span><span class="op" id="7332281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332287">if</span>&nbsp;<span class="ident" id="7332290">_</span><span class="op" id="7332291">,</span>&nbsp;<span class="ident" id="7332293"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7332297">=</span>&nbsp;<span class="ident" id="7332299"><a href="/archive/tar/writer_test.go.html#7332193">writer</a></span><span class="op" id="7332305">.</span><span class="ident" id="7332306">Write</span><span class="op" id="7332311">(</span><span class="op" id="7332312">[</span><span class="op" id="7332313">]</span><span class="builtintype" id="7332314">byte</span><span class="op" id="7332318">(</span><span class="ident" id="7332319"><a href="/archive/tar/writer_test.go.html#7332122">contents</a></span><span class="op" id="7332327">)</span><span class="op" id="7332328">)</span><span class="op" id="7332329">;</span>&nbsp;<span class="ident" id="7332331"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7332335">!=</span>&nbsp;<span class="ident" id="7332338">nil</span>&nbsp;<span class="op" id="7332342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332346"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332347">.</span><span class="ident" id="7332348">Fatal</span><span class="op" id="7332353">(</span><span class="ident" id="7332354"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span><span class="op" id="7332357">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332363">if</span>&nbsp;<span class="ident" id="7332366">err</span>&nbsp;<span class="op" id="7332370">:=</span>&nbsp;<span class="ident" id="7332373"><a href="/archive/tar/writer_test.go.html#7332193">writer</a></span><span class="op" id="7332379">.</span><span class="ident" id="7332380">Close</span><span class="op" id="7332385">(</span><span class="op" id="7332386">)</span><span class="op" id="7332387">;</span>&nbsp;<span class="ident" id="7332389"><a href="/archive/tar/writer_test.go.html#7332366">err</a></span>&nbsp;<span class="op" id="7332393">!=</span>&nbsp;<span class="ident" id="7332396">nil</span>&nbsp;<span class="op" id="7332400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332404"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332405">.</span><span class="ident" id="7332406">Fatal</span><span class="op" id="7332411">(</span><span class="ident" id="7332412"><a href="/archive/tar/writer_test.go.html#7332366">err</a></span><span class="op" id="7332415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7332421">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332479">if</span>&nbsp;<span class="op" id="7332482">!</span><span class="ident" id="7332483"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7332488">.</span><span class="ident" id="7332489">Contains</span><span class="op" id="7332497">(</span><span class="ident" id="7332498"><a href="/archive/tar/writer_test.go.html#7332175">buf</a></span><span class="op" id="7332501">.</span><span class="ident" id="7332502">Bytes</span><span class="op" id="7332507">(</span><span class="op" id="7332508">)</span><span class="op" id="7332509">,</span>&nbsp;<span class="op" id="7332511">[</span><span class="op" id="7332512">]</span><span class="builtintype" id="7332513">byte</span><span class="op" id="7332517">(</span><span class="string" id="7332518">&#34;PaxHeaders.&#34;</span><span class="op" id="7332531">)</span><span class="op" id="7332532">)</span>&nbsp;<span class="op" id="7332534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332538"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332539">.</span><span class="ident" id="7332540">Fatal</span><span class="op" id="7332545">(</span><span class="string" id="7332546">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7332595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7332601">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332663">reader</span>&nbsp;<span class="op" id="7332670">:=</span>&nbsp;<span class="ident" id="7332673"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7332682">(</span><span class="op" id="7332683">&amp;</span><span class="ident" id="7332684"><a href="/archive/tar/writer_test.go.html#7332175">buf</a></span><span class="op" id="7332687">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332690"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332693">,</span>&nbsp;<span class="ident" id="7332695"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7332699">=</span>&nbsp;<span class="ident" id="7332701"><a href="/archive/tar/writer_test.go.html#7332663">reader</a></span><span class="op" id="7332707">.</span><span class="ident" id="7332708">Next</span><span class="op" id="7332712">(</span><span class="op" id="7332713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332716">if</span>&nbsp;<span class="ident" id="7332719"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span>&nbsp;<span class="op" id="7332723">!=</span>&nbsp;<span class="ident" id="7332726">nil</span>&nbsp;<span class="op" id="7332730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332734"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332735">.</span><span class="ident" id="7332736">Fatal</span><span class="op" id="7332741">(</span><span class="ident" id="7332742"><a href="/archive/tar/writer_test.go.html#7331752">err</a></span><span class="op" id="7332745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332751">if</span>&nbsp;<span class="ident" id="7332754"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332757">.</span><span class="ident" id="7332758">Name</span>&nbsp;<span class="op" id="7332763">!=</span>&nbsp;<span class="ident" id="7332766"><a href="/archive/tar/writer_test.go.html#7331942">chineseFilename</a></span>&nbsp;<span class="op" id="7332782">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332786"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332787">.</span><span class="ident" id="7332788">Fatal</span><span class="op" id="7332793">(</span><span class="string" id="7332794">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7332825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332831">if</span>&nbsp;<span class="ident" id="7332834"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332837">.</span><span class="ident" id="7332838">Gname</span>&nbsp;<span class="op" id="7332844">!=</span>&nbsp;<span class="ident" id="7332847"><a href="/archive/tar/writer_test.go.html#7331974">chineseGroupname</a></span>&nbsp;<span class="op" id="7332864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332868"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332869">.</span><span class="ident" id="7332870">Fatal</span><span class="op" id="7332875">(</span><span class="string" id="7332876">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7332908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332911">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7332914">if</span>&nbsp;<span class="ident" id="7332917"><a href="/archive/tar/writer_test.go.html#7331826">hdr</a></span><span class="op" id="7332920">.</span><span class="ident" id="7332921">Uname</span>&nbsp;<span class="op" id="7332927">!=</span>&nbsp;<span class="ident" id="7332930"><a href="/archive/tar/writer_test.go.html#7332001">chineseUsername</a></span>&nbsp;<span class="op" id="7332946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7332950"><a href="/archive/tar/writer_test.go.html#7331598">t</a></span><span class="op" id="7332951">.</span><span class="ident" id="7332952">Fatal</span><span class="op" id="7332957">(</span><span class="string" id="7332958">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7332989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7332992">}</span><br>
<span class="lineno"></span><span class="op" id="7332994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7332997">func</span>&nbsp;<span class="ident" id="7333002">TestPaxXattrs</span><span class="op" id="7333015">(</span><span class="ident" id="7333016">t</span>&nbsp;<span class="op" id="7333018">*</span><span class="ident" id="7333019"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7333026">.</span><span class="ident" id="7333027">T</span><span class="op" id="7333028">)</span>&nbsp;<span class="op" id="7333030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333033">xattrs</span>&nbsp;<span class="op" id="7333040">:=</span>&nbsp;<span class="keyword" id="7333043">map</span><span class="op" id="7333046">[</span><span class="builtintype" id="7333047">string</span><span class="op" id="7333053">]</span><span class="builtintype" id="7333054">string</span><span class="op" id="7333060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333064">&#34;user.key&#34;</span><span class="op" id="7333074">:</span>&nbsp;<span class="string" id="7333076">&#34;value&#34;</span><span class="op" id="7333083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7333090">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333126">fileinfo</span><span class="op" id="7333134">,</span>&nbsp;<span class="ident" id="7333136">err</span>&nbsp;<span class="op" id="7333140">:=</span>&nbsp;<span class="ident" id="7333143"><a href="/archive/tar/writer_test.go.html#7324213">os</a></span><span class="op" id="7333145">.</span><span class="ident" id="7333146">Stat</span><span class="op" id="7333150">(</span><span class="string" id="7333151">&#34;testdata/small.txt&#34;</span><span class="op" id="7333171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333174">if</span>&nbsp;<span class="ident" id="7333177"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333181">!=</span>&nbsp;<span class="ident" id="7333184">nil</span>&nbsp;<span class="op" id="7333188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333192"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333193">.</span><span class="ident" id="7333194">Fatal</span><span class="op" id="7333199">(</span><span class="ident" id="7333200"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span><span class="op" id="7333203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333206">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333209">hdr</span><span class="op" id="7333212">,</span>&nbsp;<span class="ident" id="7333214"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333218">:=</span>&nbsp;<span class="ident" id="7333221"><a href="/archive/tar/common.go.html#5201063">FileInfoHeader</a></span><span class="op" id="7333235">(</span><span class="ident" id="7333236"><a href="/archive/tar/writer_test.go.html#7333126">fileinfo</a></span><span class="op" id="7333244">,</span>&nbsp;<span class="string" id="7333246">&#34;&#34;</span><span class="op" id="7333248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333251">if</span>&nbsp;<span class="ident" id="7333254"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333258">!=</span>&nbsp;<span class="ident" id="7333261">nil</span>&nbsp;<span class="op" id="7333265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333269"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333270">.</span><span class="ident" id="7333271">Fatalf</span><span class="op" id="7333277">(</span><span class="string" id="7333278">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7333291">,</span>&nbsp;<span class="ident" id="7333293"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span><span class="op" id="7333296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333302">contents</span>&nbsp;<span class="op" id="7333311">:=</span>&nbsp;<span class="string" id="7333314">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333323"><a href="/archive/tar/writer_test.go.html#7333209">hdr</a></span><span class="op" id="7333326">.</span><span class="ident" id="7333327">Xattrs</span>&nbsp;<span class="op" id="7333334">=</span>&nbsp;<span class="ident" id="7333336"><a href="/archive/tar/writer_test.go.html#7333033">xattrs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333344">var</span>&nbsp;<span class="ident" id="7333348">buf</span>&nbsp;<span class="ident" id="7333352"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7333357">.</span><span class="ident" id="7333358">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333366">writer</span>&nbsp;<span class="op" id="7333373">:=</span>&nbsp;<span class="ident" id="7333376"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7333385">(</span><span class="op" id="7333386">&amp;</span><span class="ident" id="7333387"><a href="/archive/tar/writer_test.go.html#7333348">buf</a></span><span class="op" id="7333390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333393">if</span>&nbsp;<span class="ident" id="7333396">err</span>&nbsp;<span class="op" id="7333400">:=</span>&nbsp;<span class="ident" id="7333403"><a href="/archive/tar/writer_test.go.html#7333366">writer</a></span><span class="op" id="7333409">.</span><span class="ident" id="7333410">WriteHeader</span><span class="op" id="7333421">(</span><span class="ident" id="7333422"><a href="/archive/tar/writer_test.go.html#7333209">hdr</a></span><span class="op" id="7333425">)</span><span class="op" id="7333426">;</span>&nbsp;<span class="ident" id="7333428"><a href="/archive/tar/writer_test.go.html#7333396">err</a></span>&nbsp;<span class="op" id="7333432">!=</span>&nbsp;<span class="ident" id="7333435">nil</span>&nbsp;<span class="op" id="7333439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333443"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333444">.</span><span class="ident" id="7333445">Fatal</span><span class="op" id="7333450">(</span><span class="ident" id="7333451"><a href="/archive/tar/writer_test.go.html#7333396">err</a></span><span class="op" id="7333454">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333460">if</span>&nbsp;<span class="ident" id="7333463">_</span><span class="op" id="7333464">,</span>&nbsp;<span class="ident" id="7333466"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333470">=</span>&nbsp;<span class="ident" id="7333472"><a href="/archive/tar/writer_test.go.html#7333366">writer</a></span><span class="op" id="7333478">.</span><span class="ident" id="7333479">Write</span><span class="op" id="7333484">(</span><span class="op" id="7333485">[</span><span class="op" id="7333486">]</span><span class="builtintype" id="7333487">byte</span><span class="op" id="7333491">(</span><span class="ident" id="7333492"><a href="/archive/tar/writer_test.go.html#7333302">contents</a></span><span class="op" id="7333500">)</span><span class="op" id="7333501">)</span><span class="op" id="7333502">;</span>&nbsp;<span class="ident" id="7333504"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333508">!=</span>&nbsp;<span class="ident" id="7333511">nil</span>&nbsp;<span class="op" id="7333515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333519"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333520">.</span><span class="ident" id="7333521">Fatal</span><span class="op" id="7333526">(</span><span class="ident" id="7333527"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span><span class="op" id="7333530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333536">if</span>&nbsp;<span class="ident" id="7333539">err</span>&nbsp;<span class="op" id="7333543">:=</span>&nbsp;<span class="ident" id="7333546"><a href="/archive/tar/writer_test.go.html#7333366">writer</a></span><span class="op" id="7333552">.</span><span class="ident" id="7333553">Close</span><span class="op" id="7333558">(</span><span class="op" id="7333559">)</span><span class="op" id="7333560">;</span>&nbsp;<span class="ident" id="7333562"><a href="/archive/tar/writer_test.go.html#7333539">err</a></span>&nbsp;<span class="op" id="7333566">!=</span>&nbsp;<span class="ident" id="7333569">nil</span>&nbsp;<span class="op" id="7333573">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333577"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333578">.</span><span class="ident" id="7333579">Fatal</span><span class="op" id="7333584">(</span><span class="ident" id="7333585"><a href="/archive/tar/writer_test.go.html#7333539">err</a></span><span class="op" id="7333588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7333594">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333655">reader</span>&nbsp;<span class="op" id="7333662">:=</span>&nbsp;<span class="ident" id="7333665"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7333674">(</span><span class="op" id="7333675">&amp;</span><span class="ident" id="7333676"><a href="/archive/tar/writer_test.go.html#7333348">buf</a></span><span class="op" id="7333679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333682"><a href="/archive/tar/writer_test.go.html#7333209">hdr</a></span><span class="op" id="7333685">,</span>&nbsp;<span class="ident" id="7333687"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333691">=</span>&nbsp;<span class="ident" id="7333693"><a href="/archive/tar/writer_test.go.html#7333655">reader</a></span><span class="op" id="7333699">.</span><span class="ident" id="7333700">Next</span><span class="op" id="7333704">(</span><span class="op" id="7333705">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333708">if</span>&nbsp;<span class="ident" id="7333711"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span>&nbsp;<span class="op" id="7333715">!=</span>&nbsp;<span class="ident" id="7333718">nil</span>&nbsp;<span class="op" id="7333722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333726"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333727">.</span><span class="ident" id="7333728">Fatal</span><span class="op" id="7333733">(</span><span class="ident" id="7333734"><a href="/archive/tar/writer_test.go.html#7333136">err</a></span><span class="op" id="7333737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333743">if</span>&nbsp;<span class="op" id="7333746">!</span><span class="ident" id="7333747"><a href="/archive/tar/writer_test.go.html#7324219">reflect</a></span><span class="op" id="7333754">.</span><span class="ident" id="7333755">DeepEqual</span><span class="op" id="7333764">(</span><span class="ident" id="7333765"><a href="/archive/tar/writer_test.go.html#7333209">hdr</a></span><span class="op" id="7333768">.</span><span class="ident" id="7333769">Xattrs</span><span class="op" id="7333775">,</span>&nbsp;<span class="ident" id="7333777"><a href="/archive/tar/writer_test.go.html#7333033">xattrs</a></span><span class="op" id="7333783">)</span>&nbsp;<span class="op" id="7333785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333789"><a href="/archive/tar/writer_test.go.html#7333016">t</a></span><span class="op" id="7333790">.</span><span class="ident" id="7333791">Fatalf</span><span class="op" id="7333797">(</span><span class="string" id="7333798">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7333852">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333857"><a href="/archive/tar/writer_test.go.html#7333209">hdr</a></span><span class="op" id="7333860">.</span><span class="ident" id="7333861">Xattrs</span><span class="op" id="7333867">,</span>&nbsp;<span class="ident" id="7333869"><a href="/archive/tar/writer_test.go.html#7333033">xattrs</a></span><span class="op" id="7333875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333878">}</span><br>
<span class="lineno"></span><span class="op" id="7333880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7333883">func</span>&nbsp;<span class="ident" id="7333888">TestPAXHeader</span><span class="op" id="7333901">(</span><span class="ident" id="7333902">t</span>&nbsp;<span class="op" id="7333904">*</span><span class="ident" id="7333905"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7333912">.</span><span class="ident" id="7333913">T</span><span class="op" id="7333914">)</span>&nbsp;<span class="op" id="7333916">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333919">medName</span>&nbsp;<span class="op" id="7333927">:=</span>&nbsp;<span class="ident" id="7333930"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7333937">.</span><span class="ident" id="7333938">Repeat</span><span class="op" id="7333944">(</span><span class="string" id="7333945">&#34;CD&#34;</span><span class="op" id="7333949">,</span>&nbsp;<span class="num" id="7333951">50</span><span class="op" id="7333953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333956">longName</span>&nbsp;<span class="op" id="7333965">:=</span>&nbsp;<span class="ident" id="7333968"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7333975">.</span><span class="ident" id="7333976">Repeat</span><span class="op" id="7333982">(</span><span class="string" id="7333983">&#34;AB&#34;</span><span class="op" id="7333987">,</span>&nbsp;<span class="num" id="7333989">100</span><span class="op" id="7333992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333995">paxTests</span>&nbsp;<span class="op" id="7334004">:=</span>&nbsp;<span class="op" id="7334007">[</span><span class="op" id="7334008">]</span><span class="op" id="7334009">[</span><span class="num" id="7334010">2</span><span class="op" id="7334011">]</span><span class="builtintype" id="7334012">string</span><span class="op" id="7334018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334022">{</span><span class="ident" id="7334023"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span>&nbsp;<span class="op" id="7334031">+</span>&nbsp;<span class="string" id="7334033">&#34;=/etc/hosts&#34;</span><span class="op" id="7334046">,</span>&nbsp;<span class="string" id="7334048">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7334070">}</span><span class="op" id="7334071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334075">{</span><span class="string" id="7334076">&#34;a=b&#34;</span><span class="op" id="7334081">,</span>&nbsp;<span class="string" id="7334083">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7334092">}</span><span class="op" id="7334093">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7334104">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334129">{</span><span class="string" id="7334130">&#34;a=names&#34;</span><span class="op" id="7334139">,</span>&nbsp;<span class="string" id="7334141">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7334155">}</span><span class="op" id="7334156">,</span>&nbsp;<span class="comment" id="7334158">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334191">{</span><span class="ident" id="7334192"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span>&nbsp;<span class="op" id="7334200">+</span>&nbsp;<span class="string" id="7334202">&#34;=&#34;</span>&nbsp;<span class="op" id="7334206">+</span>&nbsp;<span class="ident" id="7334208"><a href="/archive/tar/writer_test.go.html#7333956">longName</a></span><span class="op" id="7334216">,</span>&nbsp;<span class="ident" id="7334218"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7334221">.</span><span class="ident" id="7334222">Sprintf</span><span class="op" id="7334229">(</span><span class="string" id="7334230">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7334245">,</span>&nbsp;<span class="ident" id="7334247"><a href="/archive/tar/writer_test.go.html#7333956">longName</a></span><span class="op" id="7334255">)</span><span class="op" id="7334256">}</span><span class="op" id="7334257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334261">{</span><span class="ident" id="7334262"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span>&nbsp;<span class="op" id="7334270">+</span>&nbsp;<span class="string" id="7334272">&#34;=&#34;</span>&nbsp;<span class="op" id="7334276">+</span>&nbsp;<span class="ident" id="7334278"><a href="/archive/tar/writer_test.go.html#7333919">medName</a></span><span class="op" id="7334285">,</span>&nbsp;<span class="ident" id="7334287"><a href="/archive/tar/writer_test.go.html#7324187">fmt</a></span><span class="op" id="7334290">.</span><span class="ident" id="7334291">Sprintf</span><span class="op" id="7334298">(</span><span class="string" id="7334299">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7334314">,</span>&nbsp;<span class="ident" id="7334316"><a href="/archive/tar/writer_test.go.html#7333919">medName</a></span><span class="op" id="7334323">)</span><span class="op" id="7334324">}</span><span class="op" id="7334325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334329">for</span>&nbsp;<span class="ident" id="7334333">_</span><span class="op" id="7334334">,</span>&nbsp;<span class="ident" id="7334336">test</span>&nbsp;<span class="op" id="7334341">:=</span>&nbsp;<span class="keyword" id="7334344">range</span>&nbsp;<span class="ident" id="7334350"><a href="/archive/tar/writer_test.go.html#7333995">paxTests</a></span>&nbsp;<span class="op" id="7334359">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334363">key</span><span class="op" id="7334366">,</span>&nbsp;<span class="ident" id="7334368">expected</span>&nbsp;<span class="op" id="7334377">:=</span>&nbsp;<span class="ident" id="7334380"><a href="/archive/tar/writer_test.go.html#7334336">test</a></span><span class="op" id="7334384">[</span><span class="num" id="7334385">0</span><span class="op" id="7334386">]</span><span class="op" id="7334387">,</span>&nbsp;<span class="ident" id="7334389"><a href="/archive/tar/writer_test.go.html#7334336">test</a></span><span class="op" id="7334393">[</span><span class="num" id="7334394">1</span><span class="op" id="7334395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334399">if</span>&nbsp;<span class="ident" id="7334402">result</span>&nbsp;<span class="op" id="7334409">:=</span>&nbsp;<span class="ident" id="7334412"><a href="/archive/tar/writer.go.html#5237202">paxHeader</a></span><span class="op" id="7334421">(</span><span class="ident" id="7334422"><a href="/archive/tar/writer_test.go.html#7334363">key</a></span><span class="op" id="7334425">)</span><span class="op" id="7334426">;</span>&nbsp;<span class="ident" id="7334428"><a href="/archive/tar/writer_test.go.html#7334402">result</a></span>&nbsp;<span class="op" id="7334435">!=</span>&nbsp;<span class="ident" id="7334438"><a href="/archive/tar/writer_test.go.html#7334368">expected</a></span>&nbsp;<span class="op" id="7334447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334452"><a href="/archive/tar/writer_test.go.html#7333902">t</a></span><span class="op" id="7334453">.</span><span class="ident" id="7334454">Fatalf</span><span class="op" id="7334460">(</span><span class="string" id="7334461">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7334493">,</span>&nbsp;<span class="ident" id="7334495"><a href="/archive/tar/writer_test.go.html#7334402">result</a></span><span class="op" id="7334501">,</span>&nbsp;<span class="ident" id="7334503"><a href="/archive/tar/writer_test.go.html#7334368">expected</a></span><span class="op" id="7334511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334518">}</span><br>
<span class="lineno">420</span><span class="op" id="7334520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7334523">func</span>&nbsp;<span class="ident" id="7334528">TestUSTARLongName</span><span class="op" id="7334545">(</span><span class="ident" id="7334546">t</span>&nbsp;<span class="op" id="7334548">*</span><span class="ident" id="7334549"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7334556">.</span><span class="ident" id="7334557">T</span><span class="op" id="7334558">)</span>&nbsp;<span class="op" id="7334560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334563">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334661">fileinfo</span><span class="op" id="7334669">,</span>&nbsp;<span class="ident" id="7334671">err</span>&nbsp;<span class="op" id="7334675">:=</span>&nbsp;<span class="ident" id="7334678"><a href="/archive/tar/writer_test.go.html#7324213">os</a></span><span class="op" id="7334680">.</span><span class="ident" id="7334681">Stat</span><span class="op" id="7334685">(</span><span class="string" id="7334686">&#34;testdata/small.txt&#34;</span><span class="op" id="7334706">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334709">if</span>&nbsp;<span class="ident" id="7334712"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span>&nbsp;<span class="op" id="7334716">!=</span>&nbsp;<span class="ident" id="7334719">nil</span>&nbsp;<span class="op" id="7334723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334727"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7334728">.</span><span class="ident" id="7334729">Fatal</span><span class="op" id="7334734">(</span><span class="ident" id="7334735"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span><span class="op" id="7334738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334744">hdr</span><span class="op" id="7334747">,</span>&nbsp;<span class="ident" id="7334749"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span>&nbsp;<span class="op" id="7334753">:=</span>&nbsp;<span class="ident" id="7334756"><a href="/archive/tar/common.go.html#5201063">FileInfoHeader</a></span><span class="op" id="7334770">(</span><span class="ident" id="7334771"><a href="/archive/tar/writer_test.go.html#7334661">fileinfo</a></span><span class="op" id="7334779">,</span>&nbsp;<span class="string" id="7334781">&#34;&#34;</span><span class="op" id="7334783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334786"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7334789">.</span><span class="ident" id="7334790">Typeflag</span>&nbsp;<span class="op" id="7334799">=</span>&nbsp;<span class="ident" id="7334801"><a href="/archive/tar/common.go.html#5196243">TypeDir</a></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334810">if</span>&nbsp;<span class="ident" id="7334813"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span>&nbsp;<span class="op" id="7334817">!=</span>&nbsp;<span class="ident" id="7334820">nil</span>&nbsp;<span class="op" id="7334824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334828"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7334829">.</span><span class="ident" id="7334830">Fatalf</span><span class="op" id="7334836">(</span><span class="string" id="7334837">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7334851">,</span>&nbsp;<span class="ident" id="7334853"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span><span class="op" id="7334856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334862">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334947">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335026">longName</span>&nbsp;<span class="op" id="7335035">:=</span>&nbsp;<span class="string" id="7335038">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335297"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7335300">.</span><span class="ident" id="7335301">Name</span>&nbsp;<span class="op" id="7335306">=</span>&nbsp;<span class="ident" id="7335308"><a href="/archive/tar/writer_test.go.html#7335026">longName</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335319"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7335322">.</span><span class="ident" id="7335323">Size</span>&nbsp;<span class="op" id="7335328">=</span>&nbsp;<span class="num" id="7335330">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335333">var</span>&nbsp;<span class="ident" id="7335337">buf</span>&nbsp;<span class="ident" id="7335341"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7335346">.</span><span class="ident" id="7335347">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335355">writer</span>&nbsp;<span class="op" id="7335362">:=</span>&nbsp;<span class="ident" id="7335365"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7335374">(</span><span class="op" id="7335375">&amp;</span><span class="ident" id="7335376"><a href="/archive/tar/writer_test.go.html#7335337">buf</a></span><span class="op" id="7335379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335382">if</span>&nbsp;<span class="ident" id="7335385">err</span>&nbsp;<span class="op" id="7335389">:=</span>&nbsp;<span class="ident" id="7335392"><a href="/archive/tar/writer_test.go.html#7335355">writer</a></span><span class="op" id="7335398">.</span><span class="ident" id="7335399">WriteHeader</span><span class="op" id="7335410">(</span><span class="ident" id="7335411"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7335414">)</span><span class="op" id="7335415">;</span>&nbsp;<span class="ident" id="7335417"><a href="/archive/tar/writer_test.go.html#7335385">err</a></span>&nbsp;<span class="op" id="7335421">!=</span>&nbsp;<span class="ident" id="7335424">nil</span>&nbsp;<span class="op" id="7335428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335432"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7335433">.</span><span class="ident" id="7335434">Fatal</span><span class="op" id="7335439">(</span><span class="ident" id="7335440"><a href="/archive/tar/writer_test.go.html#7335385">err</a></span><span class="op" id="7335443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335449">if</span>&nbsp;<span class="ident" id="7335452">err</span>&nbsp;<span class="op" id="7335456">:=</span>&nbsp;<span class="ident" id="7335459"><a href="/archive/tar/writer_test.go.html#7335355">writer</a></span><span class="op" id="7335465">.</span><span class="ident" id="7335466">Close</span><span class="op" id="7335471">(</span><span class="op" id="7335472">)</span><span class="op" id="7335473">;</span>&nbsp;<span class="ident" id="7335475"><a href="/archive/tar/writer_test.go.html#7335452">err</a></span>&nbsp;<span class="op" id="7335479">!=</span>&nbsp;<span class="ident" id="7335482">nil</span>&nbsp;<span class="op" id="7335486">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335490"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7335491">.</span><span class="ident" id="7335492">Fatal</span><span class="op" id="7335497">(</span><span class="ident" id="7335498"><a href="/archive/tar/writer_test.go.html#7335452">err</a></span><span class="op" id="7335501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335507">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335569">reader</span>&nbsp;<span class="op" id="7335576">:=</span>&nbsp;<span class="ident" id="7335579"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7335588">(</span><span class="op" id="7335589">&amp;</span><span class="ident" id="7335590"><a href="/archive/tar/writer_test.go.html#7335337">buf</a></span><span class="op" id="7335593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335596"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7335599">,</span>&nbsp;<span class="ident" id="7335601"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span>&nbsp;<span class="op" id="7335605">=</span>&nbsp;<span class="ident" id="7335607"><a href="/archive/tar/writer_test.go.html#7335569">reader</a></span><span class="op" id="7335613">.</span><span class="ident" id="7335614">Next</span><span class="op" id="7335618">(</span><span class="op" id="7335619">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335622">if</span>&nbsp;<span class="ident" id="7335625"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span>&nbsp;<span class="op" id="7335629">!=</span>&nbsp;<span class="ident" id="7335632">nil</span>&nbsp;<span class="op" id="7335636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335640"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7335641">.</span><span class="ident" id="7335642">Fatal</span><span class="op" id="7335647">(</span><span class="ident" id="7335648"><a href="/archive/tar/writer_test.go.html#7334671">err</a></span><span class="op" id="7335651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335657">if</span>&nbsp;<span class="ident" id="7335660"><a href="/archive/tar/writer_test.go.html#7334744">hdr</a></span><span class="op" id="7335663">.</span><span class="ident" id="7335664">Name</span>&nbsp;<span class="op" id="7335669">!=</span>&nbsp;<span class="ident" id="7335672"><a href="/archive/tar/writer_test.go.html#7335026">longName</a></span>&nbsp;<span class="op" id="7335681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335685"><a href="/archive/tar/writer_test.go.html#7334546">t</a></span><span class="op" id="7335686">.</span><span class="ident" id="7335687">Fatal</span><span class="op" id="7335692">(</span><span class="string" id="7335693">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7335721">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335724">}</span><br>
<span class="lineno"></span><span class="op" id="7335726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7335729">func</span>&nbsp;<span class="ident" id="7335734">TestValidTypeflagWithPAXHeader</span><span class="op" id="7335764">(</span><span class="ident" id="7335765">t</span>&nbsp;<span class="op" id="7335767">*</span><span class="ident" id="7335768"><a href="/archive/tar/writer_test.go.html#7324241">testing</a></span><span class="op" id="7335775">.</span><span class="ident" id="7335776">T</span><span class="op" id="7335777">)</span>&nbsp;<span class="op" id="7335779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335782">var</span>&nbsp;<span class="ident" id="7335786">buffer</span>&nbsp;<span class="ident" id="7335793"><a href="/archive/tar/writer_test.go.html#7324178">bytes</a></span><span class="op" id="7335798">.</span><span class="ident" id="7335799">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335807">tw</span>&nbsp;<span class="op" id="7335810">:=</span>&nbsp;<span class="ident" id="7335813"><a href="/archive/tar/writer.go.html#5228179">NewWriter</a></span><span class="op" id="7335822">(</span><span class="op" id="7335823">&amp;</span><span class="ident" id="7335824"><a href="/archive/tar/writer_test.go.html#7335786">buffer</a></span><span class="op" id="7335830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335834">fileName</span>&nbsp;<span class="op" id="7335843">:=</span>&nbsp;<span class="ident" id="7335846"><a href="/archive/tar/writer_test.go.html#7324230">strings</a></span><span class="op" id="7335853">.</span><span class="ident" id="7335854">Repeat</span><span class="op" id="7335860">(</span><span class="string" id="7335861">&#34;ab&#34;</span><span class="op" id="7335865">,</span>&nbsp;<span class="num" id="7335867">100</span><span class="op" id="7335870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335874">hdr</span>&nbsp;<span class="op" id="7335878">:=</span>&nbsp;<span class="op" id="7335881">&amp;</span><span class="ident" id="7335882"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="7335888">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335892">Name</span><span class="op" id="7335896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7335902"><a href="/archive/tar/writer_test.go.html#7335834">fileName</a></span><span class="op" id="7335910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335914">Size</span><span class="op" id="7335918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7335924">4</span><span class="op" id="7335925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335929">Typeflag</span><span class="op" id="7335937">:</span>&nbsp;<span class="num" id="7335939">0</span><span class="op" id="7335940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335946">if</span>&nbsp;<span class="ident" id="7335949">err</span>&nbsp;<span class="op" id="7335953">:=</span>&nbsp;<span class="ident" id="7335956"><a href="/archive/tar/writer_test.go.html#7335807">tw</a></span><span class="op" id="7335958">.</span><span class="ident" id="7335959">WriteHeader</span><span class="op" id="7335970">(</span><span class="ident" id="7335971"><a href="/archive/tar/writer_test.go.html#7335874">hdr</a></span><span class="op" id="7335974">)</span><span class="op" id="7335975">;</span>&nbsp;<span class="ident" id="7335977"><a href="/archive/tar/writer_test.go.html#7335949">err</a></span>&nbsp;<span class="op" id="7335981">!=</span>&nbsp;<span class="ident" id="7335984">nil</span>&nbsp;<span class="op" id="7335988">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335992"><a href="/archive/tar/writer_test.go.html#7335765">t</a></span><span class="op" id="7335993">.</span><span class="ident" id="7335994">Fatalf</span><span class="op" id="7336000">(</span><span class="string" id="7336001">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7336029">,</span>&nbsp;<span class="ident" id="7336031"><a href="/archive/tar/writer_test.go.html#7335949">err</a></span><span class="op" id="7336034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336040">if</span>&nbsp;<span class="ident" id="7336043">_</span><span class="op" id="7336044">,</span>&nbsp;<span class="ident" id="7336046">err</span>&nbsp;<span class="op" id="7336050">:=</span>&nbsp;<span class="ident" id="7336053"><a href="/archive/tar/writer_test.go.html#7335807">tw</a></span><span class="op" id="7336055">.</span><span class="ident" id="7336056">Write</span><span class="op" id="7336061">(</span><span class="op" id="7336062">[</span><span class="op" id="7336063">]</span><span class="builtintype" id="7336064">byte</span><span class="op" id="7336068">(</span><span class="string" id="7336069">&#34;fooo&#34;</span><span class="op" id="7336075">)</span><span class="op" id="7336076">)</span><span class="op" id="7336077">;</span>&nbsp;<span class="ident" id="7336079"><a href="/archive/tar/writer_test.go.html#7336046">err</a></span>&nbsp;<span class="op" id="7336083">!=</span>&nbsp;<span class="ident" id="7336086">nil</span>&nbsp;<span class="op" id="7336090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336094"><a href="/archive/tar/writer_test.go.html#7335765">t</a></span><span class="op" id="7336095">.</span><span class="ident" id="7336096">Fatalf</span><span class="op" id="7336102">(</span><span class="string" id="7336103">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7336140">,</span>&nbsp;<span class="ident" id="7336142"><a href="/archive/tar/writer_test.go.html#7336046">err</a></span><span class="op" id="7336145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336148">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336151"><a href="/archive/tar/writer_test.go.html#7335807">tw</a></span><span class="op" id="7336153">.</span><span class="ident" id="7336154">Close</span><span class="op" id="7336159">(</span><span class="op" id="7336160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336164">tr</span>&nbsp;<span class="op" id="7336167">:=</span>&nbsp;<span class="ident" id="7336170"><a href="/archive/tar/reader.go.html#5205723">NewReader</a></span><span class="op" id="7336179">(</span><span class="op" id="7336180">&amp;</span><span class="ident" id="7336181"><a href="/archive/tar/writer_test.go.html#7335786">buffer</a></span><span class="op" id="7336187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336191">for</span>&nbsp;<span class="op" id="7336195">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336199">header</span><span class="op" id="7336205">,</span>&nbsp;<span class="ident" id="7336207">err</span>&nbsp;<span class="op" id="7336211">:=</span>&nbsp;<span class="ident" id="7336214"><a href="/archive/tar/writer_test.go.html#7336164">tr</a></span><span class="op" id="7336216">.</span><span class="ident" id="7336217">Next</span><span class="op" id="7336221">(</span><span class="op" id="7336222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336226">if</span>&nbsp;<span class="ident" id="7336229"><a href="/archive/tar/writer_test.go.html#7336207">err</a></span>&nbsp;<span class="op" id="7336233">==</span>&nbsp;<span class="ident" id="7336236"><a href="/archive/tar/writer_test.go.html#7324194">io</a></span><span class="op" id="7336238">.</span><span class="ident" id="7336239">EOF</span>&nbsp;<span class="op" id="7336243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336248">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336260">if</span>&nbsp;<span class="ident" id="7336263"><a href="/archive/tar/writer_test.go.html#7336207">err</a></span>&nbsp;<span class="op" id="7336267">!=</span>&nbsp;<span class="ident" id="7336270">nil</span>&nbsp;<span class="op" id="7336274">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336279"><a href="/archive/tar/writer_test.go.html#7335765">t</a></span><span class="op" id="7336280">.</span><span class="ident" id="7336281">Fatalf</span><span class="op" id="7336287">(</span><span class="string" id="7336288">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7336315">,</span>&nbsp;<span class="ident" id="7336317"><a href="/archive/tar/writer_test.go.html#7336207">err</a></span><span class="op" id="7336320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336328">if</span>&nbsp;<span class="ident" id="7336331"><a href="/archive/tar/writer_test.go.html#7336199">header</a></span><span class="op" id="7336337">.</span><span class="ident" id="7336338">Typeflag</span>&nbsp;<span class="op" id="7336347">!=</span>&nbsp;<span class="num" id="7336350">0</span>&nbsp;<span class="op" id="7336352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336357"><a href="/archive/tar/writer_test.go.html#7335765">t</a></span><span class="op" id="7336358">.</span><span class="ident" id="7336359">Fatalf</span><span class="op" id="7336365">(</span><span class="string" id="7336366">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7336403">,</span>&nbsp;<span class="ident" id="7336405"><a href="/archive/tar/writer_test.go.html#7336199">header</a></span><span class="op" id="7336411">.</span><span class="ident" id="7336412">Typeflag</span><span class="op" id="7336420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336424">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336427">}</span><br>
<span class="lineno"></span><span class="op" id="7336429">}</span>
</div>
</body>
</html>
