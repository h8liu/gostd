<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6121414">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6121469">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6121523">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6121574">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="6121627">package</span>&nbsp;<span class="ident" id="6121635">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121644">import</span>&nbsp;<span class="op" id="6121651">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121654">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121661">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121671">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121683">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121689">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121695">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121706">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121717">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6121735">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6121745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6121748">const</span>&nbsp;<span class="op" id="6121754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121757">maxNewlines</span>&nbsp;<span class="op" id="6121769">=</span>&nbsp;<span class="num" id="6121771">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6121777">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121825">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121837">=</span>&nbsp;<span class="builtintype" id="6121839">false</span>&nbsp;<span class="comment" id="6121845">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121870">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121882">=</span>&nbsp;<span class="num" id="6121884">1</span>&nbsp;<span class="op" id="6121886">&lt;&lt;</span>&nbsp;<span class="num" id="6121889">30</span><br>
<span class="lineno"></span><span class="op" id="6121892">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6121895">type</span>&nbsp;<span class="ident" id="6121900">whiteSpace</span>&nbsp;<span class="builtintype" id="6121911">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6121917">const</span>&nbsp;<span class="op" id="6121923">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121926">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6121935">=</span>&nbsp;<span class="ident" id="6121937">whiteSpace</span><span class="op" id="6121947">(</span><span class="num" id="6121948">0</span><span class="op" id="6121949">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121952">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121961">=</span>&nbsp;<span class="ident" id="6121963">whiteSpace</span><span class="op" id="6121973">(</span><span class="string" id="6121974">&#39;&nbsp;&#39;</span><span class="op" id="6121977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6121980">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6121989">=</span>&nbsp;<span class="ident" id="6121991">whiteSpace</span><span class="op" id="6122001">(</span><span class="string" id="6122002">&#39;\v&#39;</span><span class="op" id="6122006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122009">newline</span>&nbsp;&nbsp;<span class="op" id="6122018">=</span>&nbsp;<span class="ident" id="6122020">whiteSpace</span><span class="op" id="6122030">(</span><span class="string" id="6122031">&#39;\n&#39;</span><span class="op" id="6122035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122038">formfeed</span>&nbsp;<span class="op" id="6122047">=</span>&nbsp;<span class="ident" id="6122049">whiteSpace</span><span class="op" id="6122059">(</span><span class="string" id="6122060">&#39;\f&#39;</span><span class="op" id="6122064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122067">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6122076">=</span>&nbsp;<span class="ident" id="6122078">whiteSpace</span><span class="op" id="6122088">(</span><span class="string" id="6122089">&#39;&gt;&#39;</span><span class="op" id="6122092">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122095">unindent</span>&nbsp;<span class="op" id="6122104">=</span>&nbsp;<span class="ident" id="6122106">whiteSpace</span><span class="op" id="6122116">(</span><span class="string" id="6122117">&#39;&lt;&#39;</span><span class="op" id="6122120">)</span><br>
<span class="lineno"></span><span class="op" id="6122122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6122125">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="6122179">type</span>&nbsp;<span class="ident" id="6122184">pmode</span>&nbsp;<span class="builtintype" id="6122190">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6122195">const</span>&nbsp;<span class="op" id="6122201">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122204">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122221">pmode</span>&nbsp;<span class="op" id="6122227">=</span>&nbsp;<span class="num" id="6122229">1</span>&nbsp;<span class="op" id="6122231">&lt;&lt;</span>&nbsp;<span class="ident" id="6122234">iota</span>&nbsp;<span class="comment" id="6122239">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122287">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122322">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="6122374">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6122377">type</span>&nbsp;<span class="ident" id="6122382">commentInfo</span>&nbsp;<span class="keyword" id="6122394">struct</span>&nbsp;<span class="op" id="6122401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122404">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6122419">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122437">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122463">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122478">*</span><span class="ident" id="6122479">ast</span><span class="op" id="6122482">.</span><span class="ident" id="6122483">CommentGroup</span>&nbsp;<span class="comment" id="6122496">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122535">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="6122550">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122568">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122649">commentNewline</span>&nbsp;<span class="builtintype" id="6122664">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122682">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="6122729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6122732">type</span>&nbsp;<span class="ident" id="6122737">printer</span>&nbsp;<span class="keyword" id="6122745">struct</span>&nbsp;<span class="op" id="6122752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6122755">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122812">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122820">fset</span>&nbsp;<span class="op" id="6122825">*</span><span class="ident" id="6122826">token</span><span class="op" id="6122831">.</span><span class="ident" id="6122832">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6122842">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122860">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6122872">[</span><span class="op" id="6122873">]</span><span class="builtintype" id="6122874">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122885">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122908">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6122920">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122933">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6122957">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6122969">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6122982">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123007">impliedSemi</span>&nbsp;<span class="builtintype" id="6123019">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6123032">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123076">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123088">token</span><span class="op" id="6123093">.</span><span class="ident" id="6123094">Token</span>&nbsp;&nbsp;<span class="comment" id="6123101">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123159">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123171">token</span><span class="op" id="6123176">.</span><span class="ident" id="6123177">Token</span>&nbsp;&nbsp;<span class="comment" id="6123184">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123243">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123255">[</span><span class="op" id="6123256">]</span><span class="ident" id="6123257">whiteSpace</span>&nbsp;<span class="comment" id="6123268">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123293">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123307">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123374">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123442">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123508">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123574">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123618">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123626">token</span><span class="op" id="6123631">.</span><span class="ident" id="6123632">Position</span>&nbsp;<span class="comment" id="6123641">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123684">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123692">token</span><span class="op" id="6123697">.</span><span class="ident" id="6123698">Position</span>&nbsp;<span class="comment" id="6123707">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123744">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6123752">token</span><span class="op" id="6123757">.</span><span class="ident" id="6123758">Position</span>&nbsp;<span class="comment" id="6123767">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123810">linePtr</span>&nbsp;<span class="op" id="6123818">*</span><span class="builtintype" id="6123819">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6123833">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123893">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123954">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6123970">[</span><span class="op" id="6123971">]</span><span class="op" id="6123972">*</span><span class="ident" id="6123973">ast</span><span class="op" id="6123976">.</span><span class="ident" id="6123977">CommentGroup</span>&nbsp;<span class="comment" id="6123990">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124005">useNodeComments</span>&nbsp;<span class="builtintype" id="6124021">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6124041">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124097">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124164">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124178">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124220">nodeSizes</span>&nbsp;<span class="keyword" id="6124230">map</span><span class="op" id="6124233">[</span><span class="ident" id="6124234">ast</span><span class="op" id="6124237">.</span><span class="ident" id="6124238">Node</span><span class="op" id="6124242">]</span><span class="builtintype" id="6124243">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6124249">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124300">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="6124311">token</span><span class="op" id="6124316">.</span><span class="ident" id="6124317">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124322">cachedLine</span>&nbsp;<span class="builtintype" id="6124333">int</span>&nbsp;<span class="comment" id="6124337">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="6124372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6124375">func</span>&nbsp;<span class="op" id="6124380">(</span><span class="ident" id="6124381">p</span>&nbsp;<span class="op" id="6124383">*</span><span class="ident" id="6124384">printer</span><span class="op" id="6124391">)</span>&nbsp;<span class="ident" id="6124393">init</span><span class="op" id="6124397">(</span><span class="ident" id="6124398">cfg</span>&nbsp;<span class="op" id="6124402">*</span><span class="ident" id="6124403">Config</span><span class="op" id="6124409">,</span>&nbsp;<span class="ident" id="6124411">fset</span>&nbsp;<span class="op" id="6124416">*</span><span class="ident" id="6124417">token</span><span class="op" id="6124422">.</span><span class="ident" id="6124423">FileSet</span><span class="op" id="6124430">,</span>&nbsp;<span class="ident" id="6124432">nodeSizes</span>&nbsp;<span class="keyword" id="6124442">map</span><span class="op" id="6124445">[</span><span class="ident" id="6124446">ast</span><span class="op" id="6124449">.</span><span class="ident" id="6124450">Node</span><span class="op" id="6124454">]</span><span class="builtintype" id="6124455">int</span><span class="op" id="6124458">)</span>&nbsp;<span class="op" id="6124460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124463">p</span><span class="op" id="6124464">.</span><span class="ident" id="6124465">Config</span>&nbsp;<span class="op" id="6124472">=</span>&nbsp;<span class="op" id="6124474">*</span><span class="ident" id="6124475">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124480">p</span><span class="op" id="6124481">.</span><span class="ident" id="6124482">fset</span>&nbsp;<span class="op" id="6124487">=</span>&nbsp;<span class="ident" id="6124489">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124495">p</span><span class="op" id="6124496">.</span><span class="ident" id="6124497">pos</span>&nbsp;<span class="op" id="6124501">=</span>&nbsp;<span class="ident" id="6124503">token</span><span class="op" id="6124508">.</span><span class="ident" id="6124509">Position</span><span class="op" id="6124517">{</span><span class="ident" id="6124518">Line</span><span class="op" id="6124522">:</span>&nbsp;<span class="num" id="6124524">1</span><span class="op" id="6124525">,</span>&nbsp;<span class="ident" id="6124527">Column</span><span class="op" id="6124533">:</span>&nbsp;<span class="num" id="6124535">1</span><span class="op" id="6124536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124539">p</span><span class="op" id="6124540">.</span><span class="ident" id="6124541">out</span>&nbsp;<span class="op" id="6124545">=</span>&nbsp;<span class="ident" id="6124547">token</span><span class="op" id="6124552">.</span><span class="ident" id="6124553">Position</span><span class="op" id="6124561">{</span><span class="ident" id="6124562">Line</span><span class="op" id="6124566">:</span>&nbsp;<span class="num" id="6124568">1</span><span class="op" id="6124569">,</span>&nbsp;<span class="ident" id="6124571">Column</span><span class="op" id="6124577">:</span>&nbsp;<span class="num" id="6124579">1</span><span class="op" id="6124580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124583">p</span><span class="op" id="6124584">.</span><span class="ident" id="6124585">wsbuf</span>&nbsp;<span class="op" id="6124591">=</span>&nbsp;<span class="builtinfunc" id="6124593">make</span><span class="op" id="6124597">(</span><span class="op" id="6124598">[</span><span class="op" id="6124599">]</span><span class="ident" id="6124600">whiteSpace</span><span class="op" id="6124610">,</span>&nbsp;<span class="num" id="6124612">0</span><span class="op" id="6124613">,</span>&nbsp;<span class="num" id="6124615">16</span><span class="op" id="6124617">)</span>&nbsp;<span class="comment" id="6124619">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124654">p</span><span class="op" id="6124655">.</span><span class="ident" id="6124656">nodeSizes</span>&nbsp;<span class="op" id="6124666">=</span>&nbsp;<span class="ident" id="6124668">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124679">p</span><span class="op" id="6124680">.</span><span class="ident" id="6124681">cachedPos</span>&nbsp;<span class="op" id="6124691">=</span>&nbsp;<span class="op" id="6124693">-</span><span class="num" id="6124694">1</span><br>
<span class="lineno"></span><span class="op" id="6124696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6124699">func</span>&nbsp;<span class="op" id="6124704">(</span><span class="ident" id="6124705">p</span>&nbsp;<span class="op" id="6124707">*</span><span class="ident" id="6124708">printer</span><span class="op" id="6124715">)</span>&nbsp;<span class="ident" id="6124717">internalError</span><span class="op" id="6124730">(</span><span class="ident" id="6124731">msg</span>&nbsp;<span class="op" id="6124735">...</span><span class="keyword" id="6124738">interface</span><span class="op" id="6124747">{</span><span class="op" id="6124748">}</span><span class="op" id="6124749">)</span>&nbsp;<span class="op" id="6124751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6124754">if</span>&nbsp;<span class="ident" id="6124757">debug</span>&nbsp;<span class="op" id="6124763">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124767">fmt</span><span class="op" id="6124770">.</span><span class="ident" id="6124771">Print</span><span class="op" id="6124776">(</span><span class="ident" id="6124777">p</span><span class="op" id="6124778">.</span><span class="ident" id="6124779">pos</span><span class="op" id="6124782">.</span><span class="ident" id="6124783">String</span><span class="op" id="6124789">(</span><span class="op" id="6124790">)</span>&nbsp;<span class="op" id="6124792">+</span>&nbsp;<span class="string" id="6124794">&#34;:&nbsp;&#34;</span><span class="op" id="6124798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6124802">fmt</span><span class="op" id="6124805">.</span><span class="ident" id="6124806">Println</span><span class="op" id="6124813">(</span><span class="ident" id="6124814">msg</span><span class="op" id="6124817">...</span><span class="op" id="6124820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6124824">panic</span><span class="op" id="6124829">(</span><span class="string" id="6124830">&#34;go/printer&#34;</span><span class="op" id="6124842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6124845">}</span><br>
<span class="lineno"></span><span class="op" id="6124847">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="6124850">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6124921">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="6124997">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6125070">func</span>&nbsp;<span class="op" id="6125075">(</span><span class="ident" id="6125076">p</span>&nbsp;<span class="op" id="6125078">*</span><span class="ident" id="6125079">printer</span><span class="op" id="6125086">)</span>&nbsp;<span class="ident" id="6125088">commentsHaveNewline</span><span class="op" id="6125107">(</span><span class="ident" id="6125108">list</span>&nbsp;<span class="op" id="6125113">[</span><span class="op" id="6125114">]</span><span class="op" id="6125115">*</span><span class="ident" id="6125116">ast</span><span class="op" id="6125119">.</span><span class="ident" id="6125120">Comment</span><span class="op" id="6125127">)</span>&nbsp;<span class="builtintype" id="6125129">bool</span>&nbsp;<span class="op" id="6125134">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125137">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125155">line</span>&nbsp;<span class="op" id="6125160">:=</span>&nbsp;<span class="ident" id="6125163">p</span><span class="op" id="6125164">.</span><span class="ident" id="6125165">lineFor</span><span class="op" id="6125172">(</span><span class="ident" id="6125173">list</span><span class="op" id="6125177">[</span><span class="num" id="6125178">0</span><span class="op" id="6125179">]</span><span class="op" id="6125180">.</span><span class="ident" id="6125181">Pos</span><span class="op" id="6125184">(</span><span class="op" id="6125185">)</span><span class="op" id="6125186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125189">for</span>&nbsp;<span class="ident" id="6125193">i</span><span class="op" id="6125194">,</span>&nbsp;<span class="ident" id="6125196">c</span>&nbsp;<span class="op" id="6125198">:=</span>&nbsp;<span class="keyword" id="6125201">range</span>&nbsp;<span class="ident" id="6125207">list</span>&nbsp;<span class="op" id="6125212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125216">if</span>&nbsp;<span class="ident" id="6125219">i</span>&nbsp;<span class="op" id="6125221">&gt;</span>&nbsp;<span class="num" id="6125223">0</span>&nbsp;<span class="op" id="6125225">&amp;&amp;</span>&nbsp;<span class="ident" id="6125228">p</span><span class="op" id="6125229">.</span><span class="ident" id="6125230">lineFor</span><span class="op" id="6125237">(</span><span class="ident" id="6125238">list</span><span class="op" id="6125242">[</span><span class="ident" id="6125243">i</span><span class="op" id="6125244">]</span><span class="op" id="6125245">.</span><span class="ident" id="6125246">Pos</span><span class="op" id="6125249">(</span><span class="op" id="6125250">)</span><span class="op" id="6125251">)</span>&nbsp;<span class="op" id="6125253">!=</span>&nbsp;<span class="ident" id="6125256">line</span>&nbsp;<span class="op" id="6125261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125266">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125306">return</span>&nbsp;<span class="builtintype" id="6125313">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125324">if</span>&nbsp;<span class="ident" id="6125327">t</span>&nbsp;<span class="op" id="6125329">:=</span>&nbsp;<span class="ident" id="6125332">c</span><span class="op" id="6125333">.</span><span class="ident" id="6125334">Text</span><span class="op" id="6125338">;</span>&nbsp;<span class="builtinfunc" id="6125340">len</span><span class="op" id="6125343">(</span><span class="ident" id="6125344">t</span><span class="op" id="6125345">)</span>&nbsp;<span class="op" id="6125347">&gt;=</span>&nbsp;<span class="num" id="6125350">2</span>&nbsp;<span class="op" id="6125352">&amp;&amp;</span>&nbsp;<span class="op" id="6125355">(</span><span class="ident" id="6125356">t</span><span class="op" id="6125357">[</span><span class="num" id="6125358">1</span><span class="op" id="6125359">]</span>&nbsp;<span class="op" id="6125361">==</span>&nbsp;<span class="string" id="6125364">&#39;/&#39;</span>&nbsp;<span class="op" id="6125368">||</span>&nbsp;<span class="ident" id="6125371">strings</span><span class="op" id="6125378">.</span><span class="ident" id="6125379">Contains</span><span class="op" id="6125387">(</span><span class="ident" id="6125388">t</span><span class="op" id="6125389">,</span>&nbsp;<span class="string" id="6125391">&#34;\n&#34;</span><span class="op" id="6125395">)</span><span class="op" id="6125396">)</span>&nbsp;<span class="op" id="6125398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125403">return</span>&nbsp;<span class="builtintype" id="6125410">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125417">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125423">_</span>&nbsp;<span class="op" id="6125425">=</span>&nbsp;<span class="ident" id="6125427">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125433">return</span>&nbsp;<span class="builtintype" id="6125440">false</span><br>
<span class="lineno"></span><span class="op" id="6125446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6125449">func</span>&nbsp;<span class="op" id="6125454">(</span><span class="ident" id="6125455">p</span>&nbsp;<span class="op" id="6125457">*</span><span class="ident" id="6125458">printer</span><span class="op" id="6125465">)</span>&nbsp;<span class="ident" id="6125467">nextComment</span><span class="op" id="6125478">(</span><span class="op" id="6125479">)</span>&nbsp;<span class="op" id="6125481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125484">for</span>&nbsp;<span class="ident" id="6125488">p</span><span class="op" id="6125489">.</span><span class="ident" id="6125490">cindex</span>&nbsp;<span class="op" id="6125497">&lt;</span>&nbsp;<span class="builtinfunc" id="6125499">len</span><span class="op" id="6125502">(</span><span class="ident" id="6125503">p</span><span class="op" id="6125504">.</span><span class="ident" id="6125505">comments</span><span class="op" id="6125513">)</span>&nbsp;<span class="op" id="6125515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125519">c</span>&nbsp;<span class="op" id="6125521">:=</span>&nbsp;<span class="ident" id="6125524">p</span><span class="op" id="6125525">.</span><span class="ident" id="6125526">comments</span><span class="op" id="6125534">[</span><span class="ident" id="6125535">p</span><span class="op" id="6125536">.</span><span class="ident" id="6125537">cindex</span><span class="op" id="6125543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125547">p</span><span class="op" id="6125548">.</span><span class="ident" id="6125549">cindex</span><span class="op" id="6125555">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125560">if</span>&nbsp;<span class="ident" id="6125563">list</span>&nbsp;<span class="op" id="6125568">:=</span>&nbsp;<span class="ident" id="6125571">c</span><span class="op" id="6125572">.</span><span class="ident" id="6125573">List</span><span class="op" id="6125577">;</span>&nbsp;<span class="builtinfunc" id="6125579">len</span><span class="op" id="6125582">(</span><span class="ident" id="6125583">list</span><span class="op" id="6125587">)</span>&nbsp;<span class="op" id="6125589">&gt;</span>&nbsp;<span class="num" id="6125591">0</span>&nbsp;<span class="op" id="6125593">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125598">p</span><span class="op" id="6125599">.</span><span class="ident" id="6125600">comment</span>&nbsp;<span class="op" id="6125608">=</span>&nbsp;<span class="ident" id="6125610">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125615">p</span><span class="op" id="6125616">.</span><span class="ident" id="6125617">commentOffset</span>&nbsp;<span class="op" id="6125631">=</span>&nbsp;<span class="ident" id="6125633">p</span><span class="op" id="6125634">.</span><span class="ident" id="6125635">posFor</span><span class="op" id="6125641">(</span><span class="ident" id="6125642">list</span><span class="op" id="6125646">[</span><span class="num" id="6125647">0</span><span class="op" id="6125648">]</span><span class="op" id="6125649">.</span><span class="ident" id="6125650">Pos</span><span class="op" id="6125653">(</span><span class="op" id="6125654">)</span><span class="op" id="6125655">)</span><span class="op" id="6125656">.</span><span class="ident" id="6125657">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125667">p</span><span class="op" id="6125668">.</span><span class="ident" id="6125669">commentNewline</span>&nbsp;<span class="op" id="6125684">=</span>&nbsp;<span class="ident" id="6125686">p</span><span class="op" id="6125687">.</span><span class="ident" id="6125688">commentsHaveNewline</span><span class="op" id="6125707">(</span><span class="ident" id="6125708">list</span><span class="op" id="6125712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6125717">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125726">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125730">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125791">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6125854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6125857">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6125878">p</span><span class="op" id="6125879">.</span><span class="ident" id="6125880">commentOffset</span>&nbsp;<span class="op" id="6125894">=</span>&nbsp;<span class="ident" id="6125896">infinity</span><br>
<span class="lineno">145</span><span class="op" id="6125905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6125908">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="6125975">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="6126043">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="6126081">//</span><br>
<span class="lineno"></span><span class="keyword" id="6126084">func</span>&nbsp;<span class="op" id="6126089">(</span><span class="ident" id="6126090">p</span>&nbsp;<span class="op" id="6126092">*</span><span class="ident" id="6126093">printer</span><span class="op" id="6126100">)</span>&nbsp;<span class="ident" id="6126102">commentBefore</span><span class="op" id="6126115">(</span><span class="ident" id="6126116">next</span>&nbsp;<span class="ident" id="6126121">token</span><span class="op" id="6126126">.</span><span class="ident" id="6126127">Position</span><span class="op" id="6126135">)</span>&nbsp;<span class="builtintype" id="6126137">bool</span>&nbsp;<span class="op" id="6126142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126145">return</span>&nbsp;<span class="ident" id="6126152">p</span><span class="op" id="6126153">.</span><span class="ident" id="6126154">commentOffset</span>&nbsp;<span class="op" id="6126168">&lt;</span>&nbsp;<span class="ident" id="6126170">next</span><span class="op" id="6126174">.</span><span class="ident" id="6126175">Offset</span>&nbsp;<span class="op" id="6126182">&amp;&amp;</span>&nbsp;<span class="op" id="6126185">(</span><span class="op" id="6126186">!</span><span class="ident" id="6126187">p</span><span class="op" id="6126188">.</span><span class="ident" id="6126189">impliedSemi</span>&nbsp;<span class="op" id="6126201">||</span>&nbsp;<span class="op" id="6126204">!</span><span class="ident" id="6126205">p</span><span class="op" id="6126206">.</span><span class="ident" id="6126207">commentNewline</span><span class="op" id="6126221">)</span><br>
<span class="lineno"></span><span class="op" id="6126223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="6126226">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6126281">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6126336">//</span><br>
<span class="lineno"></span><span class="keyword" id="6126339">func</span>&nbsp;<span class="op" id="6126344">(</span><span class="ident" id="6126345">p</span>&nbsp;<span class="op" id="6126347">*</span><span class="ident" id="6126348">printer</span><span class="op" id="6126355">)</span>&nbsp;<span class="ident" id="6126357">commentSizeBefore</span><span class="op" id="6126374">(</span><span class="ident" id="6126375">next</span>&nbsp;<span class="ident" id="6126380">token</span><span class="op" id="6126385">.</span><span class="ident" id="6126386">Position</span><span class="op" id="6126394">)</span>&nbsp;<span class="builtintype" id="6126396">int</span>&nbsp;<span class="op" id="6126400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6126403">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126472">defer</span>&nbsp;<span class="keyword" id="6126478">func</span><span class="op" id="6126482">(</span><span class="ident" id="6126483">info</span>&nbsp;<span class="ident" id="6126488">commentInfo</span><span class="op" id="6126499">)</span>&nbsp;<span class="op" id="6126501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126505">p</span><span class="op" id="6126506">.</span><span class="ident" id="6126507">commentInfo</span>&nbsp;<span class="op" id="6126519">=</span>&nbsp;<span class="ident" id="6126521">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126527">}</span><span class="op" id="6126528">(</span><span class="ident" id="6126529">p</span><span class="op" id="6126530">.</span><span class="ident" id="6126531">commentInfo</span><span class="op" id="6126542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126546">size</span>&nbsp;<span class="op" id="6126551">:=</span>&nbsp;<span class="num" id="6126554">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126557">for</span>&nbsp;<span class="ident" id="6126561">p</span><span class="op" id="6126562">.</span><span class="ident" id="6126563">commentBefore</span><span class="op" id="6126576">(</span><span class="ident" id="6126577">next</span><span class="op" id="6126581">)</span>&nbsp;<span class="op" id="6126583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126587">for</span>&nbsp;<span class="ident" id="6126591">_</span><span class="op" id="6126592">,</span>&nbsp;<span class="ident" id="6126594">c</span>&nbsp;<span class="op" id="6126596">:=</span>&nbsp;<span class="keyword" id="6126599">range</span>&nbsp;<span class="ident" id="6126605">p</span><span class="op" id="6126606">.</span><span class="ident" id="6126607">comment</span><span class="op" id="6126614">.</span><span class="ident" id="6126615">List</span>&nbsp;<span class="op" id="6126620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126625">size</span>&nbsp;<span class="op" id="6126630">+=</span>&nbsp;<span class="builtinfunc" id="6126633">len</span><span class="op" id="6126636">(</span><span class="ident" id="6126637">c</span><span class="op" id="6126638">.</span><span class="ident" id="6126639">Text</span><span class="op" id="6126643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126651">p</span><span class="op" id="6126652">.</span><span class="ident" id="6126653">nextComment</span><span class="op" id="6126664">(</span><span class="op" id="6126665">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6126668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6126671">return</span>&nbsp;<span class="ident" id="6126678">size</span><br>
<span class="lineno"></span><span class="op" id="6126683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6126686">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="6126759">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6126833">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6126909">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6126925">//</span><br>
<span class="lineno"></span><span class="keyword" id="6126928">func</span>&nbsp;<span class="op" id="6126933">(</span><span class="ident" id="6126934">p</span>&nbsp;<span class="op" id="6126936">*</span><span class="ident" id="6126937">printer</span><span class="op" id="6126944">)</span>&nbsp;<span class="ident" id="6126946">recordLine</span><span class="op" id="6126956">(</span><span class="ident" id="6126957">linePtr</span>&nbsp;<span class="op" id="6126965">*</span><span class="builtintype" id="6126966">int</span><span class="op" id="6126969">)</span>&nbsp;<span class="op" id="6126971">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6126974">p</span><span class="op" id="6126975">.</span><span class="ident" id="6126976">linePtr</span>&nbsp;<span class="op" id="6126984">=</span>&nbsp;<span class="ident" id="6126986">linePtr</span><br>
<span class="lineno"></span><span class="op" id="6126994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6126997">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="6127065">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="6127133">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="6127203">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="6127259">//</span><br>
<span class="lineno"></span><span class="keyword" id="6127262">func</span>&nbsp;<span class="op" id="6127267">(</span><span class="ident" id="6127268">p</span>&nbsp;<span class="op" id="6127270">*</span><span class="ident" id="6127271">printer</span><span class="op" id="6127278">)</span>&nbsp;<span class="ident" id="6127280">linesFrom</span><span class="op" id="6127289">(</span><span class="ident" id="6127290">line</span>&nbsp;<span class="builtintype" id="6127295">int</span><span class="op" id="6127298">)</span>&nbsp;<span class="builtintype" id="6127300">int</span>&nbsp;<span class="op" id="6127304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127307">return</span>&nbsp;<span class="ident" id="6127314">p</span><span class="op" id="6127315">.</span><span class="ident" id="6127316">out</span><span class="op" id="6127319">.</span><span class="ident" id="6127320">Line</span>&nbsp;<span class="op" id="6127325">-</span>&nbsp;<span class="ident" id="6127327">line</span><br>
<span class="lineno">190</span><span class="op" id="6127332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6127335">func</span>&nbsp;<span class="op" id="6127340">(</span><span class="ident" id="6127341">p</span>&nbsp;<span class="op" id="6127343">*</span><span class="ident" id="6127344">printer</span><span class="op" id="6127351">)</span>&nbsp;<span class="ident" id="6127353">posFor</span><span class="op" id="6127359">(</span><span class="ident" id="6127360">pos</span>&nbsp;<span class="ident" id="6127364">token</span><span class="op" id="6127369">.</span><span class="ident" id="6127370">Pos</span><span class="op" id="6127373">)</span>&nbsp;<span class="ident" id="6127375">token</span><span class="op" id="6127380">.</span><span class="ident" id="6127381">Position</span>&nbsp;<span class="op" id="6127390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6127393">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127455">return</span>&nbsp;<span class="ident" id="6127462">p</span><span class="op" id="6127463">.</span><span class="ident" id="6127464">fset</span><span class="op" id="6127468">.</span><span class="ident" id="6127469">Position</span><span class="op" id="6127477">(</span><span class="ident" id="6127478">pos</span><span class="op" id="6127481">)</span><br>
<span class="lineno">195</span><span class="op" id="6127483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6127486">func</span>&nbsp;<span class="op" id="6127491">(</span><span class="ident" id="6127492">p</span>&nbsp;<span class="op" id="6127494">*</span><span class="ident" id="6127495">printer</span><span class="op" id="6127502">)</span>&nbsp;<span class="ident" id="6127504">lineFor</span><span class="op" id="6127511">(</span><span class="ident" id="6127512">pos</span>&nbsp;<span class="ident" id="6127516">token</span><span class="op" id="6127521">.</span><span class="ident" id="6127522">Pos</span><span class="op" id="6127525">)</span>&nbsp;<span class="builtintype" id="6127527">int</span>&nbsp;<span class="op" id="6127531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127534">if</span>&nbsp;<span class="ident" id="6127537">pos</span>&nbsp;<span class="op" id="6127541">!=</span>&nbsp;<span class="ident" id="6127544">p</span><span class="op" id="6127545">.</span><span class="ident" id="6127546">cachedPos</span>&nbsp;<span class="op" id="6127556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127560">p</span><span class="op" id="6127561">.</span><span class="ident" id="6127562">cachedPos</span>&nbsp;<span class="op" id="6127572">=</span>&nbsp;<span class="ident" id="6127574">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127580">p</span><span class="op" id="6127581">.</span><span class="ident" id="6127582">cachedLine</span>&nbsp;<span class="op" id="6127593">=</span>&nbsp;<span class="ident" id="6127595">p</span><span class="op" id="6127596">.</span><span class="ident" id="6127597">fset</span><span class="op" id="6127601">.</span><span class="ident" id="6127602">Position</span><span class="op" id="6127610">(</span><span class="ident" id="6127611">pos</span><span class="op" id="6127614">)</span><span class="op" id="6127615">.</span><span class="ident" id="6127616">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6127622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127625">return</span>&nbsp;<span class="ident" id="6127632">p</span><span class="op" id="6127633">.</span><span class="ident" id="6127634">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="6127645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6127648">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="6127723">func</span>&nbsp;<span class="op" id="6127728">(</span><span class="ident" id="6127729">p</span>&nbsp;<span class="op" id="6127731">*</span><span class="ident" id="6127732">printer</span><span class="op" id="6127739">)</span>&nbsp;<span class="ident" id="6127741">atLineBegin</span><span class="op" id="6127752">(</span><span class="ident" id="6127753">pos</span>&nbsp;<span class="ident" id="6127757">token</span><span class="op" id="6127762">.</span><span class="ident" id="6127763">Position</span><span class="op" id="6127771">)</span>&nbsp;<span class="op" id="6127773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6127776">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6127816">if</span>&nbsp;<span class="ident" id="6127819">p</span><span class="op" id="6127820">.</span><span class="ident" id="6127821">Config</span><span class="op" id="6127827">.</span><span class="ident" id="6127828">Mode</span><span class="op" id="6127832">&amp;</span><span class="ident" id="6127833">SourcePos</span>&nbsp;<span class="op" id="6127843">!=</span>&nbsp;<span class="num" id="6127846">0</span>&nbsp;<span class="op" id="6127848">&amp;&amp;</span>&nbsp;<span class="ident" id="6127851">pos</span><span class="op" id="6127854">.</span><span class="ident" id="6127855">IsValid</span><span class="op" id="6127862">(</span><span class="op" id="6127863">)</span>&nbsp;<span class="op" id="6127865">&amp;&amp;</span>&nbsp;<span class="op" id="6127868">(</span><span class="ident" id="6127869">p</span><span class="op" id="6127870">.</span><span class="ident" id="6127871">out</span><span class="op" id="6127874">.</span><span class="ident" id="6127875">Line</span>&nbsp;<span class="op" id="6127880">!=</span>&nbsp;<span class="ident" id="6127883">pos</span><span class="op" id="6127886">.</span><span class="ident" id="6127887">Line</span>&nbsp;<span class="op" id="6127892">||</span>&nbsp;<span class="ident" id="6127895">p</span><span class="op" id="6127896">.</span><span class="ident" id="6127897">out</span><span class="op" id="6127900">.</span><span class="ident" id="6127901">Filename</span>&nbsp;<span class="op" id="6127910">!=</span>&nbsp;<span class="ident" id="6127913">pos</span><span class="op" id="6127916">.</span><span class="ident" id="6127917">Filename</span><span class="op" id="6127925">)</span>&nbsp;<span class="op" id="6127927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6127931">p</span><span class="op" id="6127932">.</span><span class="ident" id="6127933">output</span>&nbsp;<span class="op" id="6127940">=</span>&nbsp;<span class="builtinfunc" id="6127942">append</span><span class="op" id="6127948">(</span><span class="ident" id="6127949">p</span><span class="op" id="6127950">.</span><span class="ident" id="6127951">output</span><span class="op" id="6127957">,</span>&nbsp;<span class="ident" id="6127959">tabwriter</span><span class="op" id="6127968">.</span><span class="ident" id="6127969">Escape</span><span class="op" id="6127975">)</span>&nbsp;<span class="comment" id="6127977">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128035">p</span><span class="op" id="6128036">.</span><span class="ident" id="6128037">output</span>&nbsp;<span class="op" id="6128044">=</span>&nbsp;<span class="builtinfunc" id="6128046">append</span><span class="op" id="6128052">(</span><span class="ident" id="6128053">p</span><span class="op" id="6128054">.</span><span class="ident" id="6128055">output</span><span class="op" id="6128061">,</span>&nbsp;<span class="ident" id="6128063">fmt</span><span class="op" id="6128066">.</span><span class="ident" id="6128067">Sprintf</span><span class="op" id="6128074">(</span><span class="string" id="6128075">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="6128091">,</span>&nbsp;<span class="ident" id="6128093">pos</span><span class="op" id="6128096">.</span><span class="ident" id="6128097">Filename</span><span class="op" id="6128105">,</span>&nbsp;<span class="ident" id="6128107">pos</span><span class="op" id="6128110">.</span><span class="ident" id="6128111">Line</span><span class="op" id="6128115">)</span><span class="op" id="6128116">...</span><span class="op" id="6128119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128123">p</span><span class="op" id="6128124">.</span><span class="ident" id="6128125">output</span>&nbsp;<span class="op" id="6128132">=</span>&nbsp;<span class="builtinfunc" id="6128134">append</span><span class="op" id="6128140">(</span><span class="ident" id="6128141">p</span><span class="op" id="6128142">.</span><span class="ident" id="6128143">output</span><span class="op" id="6128149">,</span>&nbsp;<span class="ident" id="6128151">tabwriter</span><span class="op" id="6128160">.</span><span class="ident" id="6128161">Escape</span><span class="op" id="6128167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128171">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128212">p</span><span class="op" id="6128213">.</span><span class="ident" id="6128214">out</span><span class="op" id="6128217">.</span><span class="ident" id="6128218">Filename</span>&nbsp;<span class="op" id="6128227">=</span>&nbsp;<span class="ident" id="6128229">pos</span><span class="op" id="6128232">.</span><span class="ident" id="6128233">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128244">p</span><span class="op" id="6128245">.</span><span class="ident" id="6128246">out</span><span class="op" id="6128249">.</span><span class="ident" id="6128250">Line</span>&nbsp;<span class="op" id="6128255">=</span>&nbsp;<span class="ident" id="6128257">pos</span><span class="op" id="6128260">.</span><span class="ident" id="6128261">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128271">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128293">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128336">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128379">n</span>&nbsp;<span class="op" id="6128381">:=</span>&nbsp;<span class="ident" id="6128384">p</span><span class="op" id="6128385">.</span><span class="ident" id="6128386">Config</span><span class="op" id="6128392">.</span><span class="ident" id="6128393">Indent</span>&nbsp;<span class="op" id="6128400">+</span>&nbsp;<span class="ident" id="6128402">p</span><span class="op" id="6128403">.</span><span class="ident" id="6128404">indent</span>&nbsp;<span class="comment" id="6128411">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128440">for</span>&nbsp;<span class="ident" id="6128444">i</span>&nbsp;<span class="op" id="6128446">:=</span>&nbsp;<span class="num" id="6128449">0</span><span class="op" id="6128450">;</span>&nbsp;<span class="ident" id="6128452">i</span>&nbsp;<span class="op" id="6128454">&lt;</span>&nbsp;<span class="ident" id="6128456">n</span><span class="op" id="6128457">;</span>&nbsp;<span class="ident" id="6128459">i</span><span class="op" id="6128460">++</span>&nbsp;<span class="op" id="6128463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128467">p</span><span class="op" id="6128468">.</span><span class="ident" id="6128469">output</span>&nbsp;<span class="op" id="6128476">=</span>&nbsp;<span class="builtinfunc" id="6128478">append</span><span class="op" id="6128484">(</span><span class="ident" id="6128485">p</span><span class="op" id="6128486">.</span><span class="ident" id="6128487">output</span><span class="op" id="6128493">,</span>&nbsp;<span class="string" id="6128495">&#39;\t&#39;</span><span class="op" id="6128499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128506">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128527">p</span><span class="op" id="6128528">.</span><span class="ident" id="6128529">pos</span><span class="op" id="6128532">.</span><span class="ident" id="6128533">Offset</span>&nbsp;<span class="op" id="6128540">+=</span>&nbsp;<span class="ident" id="6128543">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128546">p</span><span class="op" id="6128547">.</span><span class="ident" id="6128548">pos</span><span class="op" id="6128551">.</span><span class="ident" id="6128552">Column</span>&nbsp;<span class="op" id="6128559">+=</span>&nbsp;<span class="ident" id="6128562">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128565">p</span><span class="op" id="6128566">.</span><span class="ident" id="6128567">out</span><span class="op" id="6128570">.</span><span class="ident" id="6128571">Column</span>&nbsp;<span class="op" id="6128578">+=</span>&nbsp;<span class="ident" id="6128581">n</span><br>
<span class="lineno"></span><span class="op" id="6128583">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="6128586">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="6128648">func</span>&nbsp;<span class="op" id="6128653">(</span><span class="ident" id="6128654">p</span>&nbsp;<span class="op" id="6128656">*</span><span class="ident" id="6128657">printer</span><span class="op" id="6128664">)</span>&nbsp;<span class="ident" id="6128666">writeByte</span><span class="op" id="6128675">(</span><span class="ident" id="6128676">ch</span>&nbsp;<span class="builtintype" id="6128679">byte</span><span class="op" id="6128683">,</span>&nbsp;<span class="ident" id="6128685">n</span>&nbsp;<span class="builtintype" id="6128687">int</span><span class="op" id="6128690">)</span>&nbsp;<span class="op" id="6128692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128695">if</span>&nbsp;<span class="ident" id="6128698">p</span><span class="op" id="6128699">.</span><span class="ident" id="6128700">out</span><span class="op" id="6128703">.</span><span class="ident" id="6128704">Column</span>&nbsp;<span class="op" id="6128711">==</span>&nbsp;<span class="num" id="6128714">1</span>&nbsp;<span class="op" id="6128716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128720">p</span><span class="op" id="6128721">.</span><span class="ident" id="6128722">atLineBegin</span><span class="op" id="6128733">(</span><span class="ident" id="6128734">p</span><span class="op" id="6128735">.</span><span class="ident" id="6128736">pos</span><span class="op" id="6128739">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128746">for</span>&nbsp;<span class="ident" id="6128750">i</span>&nbsp;<span class="op" id="6128752">:=</span>&nbsp;<span class="num" id="6128755">0</span><span class="op" id="6128756">;</span>&nbsp;<span class="ident" id="6128758">i</span>&nbsp;<span class="op" id="6128760">&lt;</span>&nbsp;<span class="ident" id="6128762">n</span><span class="op" id="6128763">;</span>&nbsp;<span class="ident" id="6128765">i</span><span class="op" id="6128766">++</span>&nbsp;<span class="op" id="6128769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128773">p</span><span class="op" id="6128774">.</span><span class="ident" id="6128775">output</span>&nbsp;<span class="op" id="6128782">=</span>&nbsp;<span class="builtinfunc" id="6128784">append</span><span class="op" id="6128790">(</span><span class="ident" id="6128791">p</span><span class="op" id="6128792">.</span><span class="ident" id="6128793">output</span><span class="op" id="6128799">,</span>&nbsp;<span class="ident" id="6128801">ch</span><span class="op" id="6128803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128806">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6128810">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128831">p</span><span class="op" id="6128832">.</span><span class="ident" id="6128833">pos</span><span class="op" id="6128836">.</span><span class="ident" id="6128837">Offset</span>&nbsp;<span class="op" id="6128844">+=</span>&nbsp;<span class="ident" id="6128847">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128850">if</span>&nbsp;<span class="ident" id="6128853">ch</span>&nbsp;<span class="op" id="6128856">==</span>&nbsp;<span class="string" id="6128859">&#39;\n&#39;</span>&nbsp;<span class="op" id="6128864">||</span>&nbsp;<span class="ident" id="6128867">ch</span>&nbsp;<span class="op" id="6128870">==</span>&nbsp;<span class="string" id="6128873">&#39;\f&#39;</span>&nbsp;<span class="op" id="6128878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128882">p</span><span class="op" id="6128883">.</span><span class="ident" id="6128884">pos</span><span class="op" id="6128887">.</span><span class="ident" id="6128888">Line</span>&nbsp;<span class="op" id="6128893">+=</span>&nbsp;<span class="ident" id="6128896">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128900">p</span><span class="op" id="6128901">.</span><span class="ident" id="6128902">out</span><span class="op" id="6128905">.</span><span class="ident" id="6128906">Line</span>&nbsp;<span class="op" id="6128911">+=</span>&nbsp;<span class="ident" id="6128914">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128918">p</span><span class="op" id="6128919">.</span><span class="ident" id="6128920">pos</span><span class="op" id="6128923">.</span><span class="ident" id="6128924">Column</span>&nbsp;<span class="op" id="6128931">=</span>&nbsp;<span class="num" id="6128933">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128937">p</span><span class="op" id="6128938">.</span><span class="ident" id="6128939">out</span><span class="op" id="6128942">.</span><span class="ident" id="6128943">Column</span>&nbsp;<span class="op" id="6128950">=</span>&nbsp;<span class="num" id="6128952">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6128956">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6128964">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128967">p</span><span class="op" id="6128968">.</span><span class="ident" id="6128969">pos</span><span class="op" id="6128972">.</span><span class="ident" id="6128973">Column</span>&nbsp;<span class="op" id="6128980">+=</span>&nbsp;<span class="ident" id="6128983">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6128986">p</span><span class="op" id="6128987">.</span><span class="ident" id="6128988">out</span><span class="op" id="6128991">.</span><span class="ident" id="6128992">Column</span>&nbsp;<span class="op" id="6128999">+=</span>&nbsp;<span class="ident" id="6129002">n</span><br>
<span class="lineno"></span><span class="op" id="6129004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6129007">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="6129080">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="6129156">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="6129213">//</span><br>
<span class="lineno"></span><span class="comment" id="6129216">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6129284">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="6129357">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6129429">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="6129505">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6129578">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="6129613">//</span><br>
<span class="lineno">265</span><span class="keyword" id="6129616">func</span>&nbsp;<span class="op" id="6129621">(</span><span class="ident" id="6129622">p</span>&nbsp;<span class="op" id="6129624">*</span><span class="ident" id="6129625">printer</span><span class="op" id="6129632">)</span>&nbsp;<span class="ident" id="6129634">writeString</span><span class="op" id="6129645">(</span><span class="ident" id="6129646">pos</span>&nbsp;<span class="ident" id="6129650">token</span><span class="op" id="6129655">.</span><span class="ident" id="6129656">Position</span><span class="op" id="6129664">,</span>&nbsp;<span class="ident" id="6129666">s</span>&nbsp;<span class="builtintype" id="6129668">string</span><span class="op" id="6129674">,</span>&nbsp;<span class="ident" id="6129676">isLit</span>&nbsp;<span class="builtintype" id="6129682">bool</span><span class="op" id="6129686">)</span>&nbsp;<span class="op" id="6129688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129691">if</span>&nbsp;<span class="ident" id="6129694">p</span><span class="op" id="6129695">.</span><span class="ident" id="6129696">out</span><span class="op" id="6129699">.</span><span class="ident" id="6129700">Column</span>&nbsp;<span class="op" id="6129707">==</span>&nbsp;<span class="num" id="6129710">1</span>&nbsp;<span class="op" id="6129712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129716">p</span><span class="op" id="6129717">.</span><span class="ident" id="6129718">atLineBegin</span><span class="op" id="6129729">(</span><span class="ident" id="6129730">pos</span><span class="op" id="6129733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6129740">if</span>&nbsp;<span class="ident" id="6129743">pos</span><span class="op" id="6129746">.</span><span class="ident" id="6129747">IsValid</span><span class="op" id="6129754">(</span><span class="op" id="6129755">)</span>&nbsp;<span class="op" id="6129757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6129761">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6129829">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6129892">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6129957">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6129984">p</span><span class="op" id="6129985">.</span><span class="ident" id="6129986">pos</span>&nbsp;<span class="op" id="6129990">=</span>&nbsp;<span class="ident" id="6129992">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6129997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130001">if</span>&nbsp;<span class="ident" id="6130004">isLit</span>&nbsp;<span class="op" id="6130010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130014">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130071">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130130">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130192">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130214">p</span><span class="op" id="6130215">.</span><span class="ident" id="6130216">output</span>&nbsp;<span class="op" id="6130223">=</span>&nbsp;<span class="builtinfunc" id="6130225">append</span><span class="op" id="6130231">(</span><span class="ident" id="6130232">p</span><span class="op" id="6130233">.</span><span class="ident" id="6130234">output</span><span class="op" id="6130240">,</span>&nbsp;<span class="ident" id="6130242">tabwriter</span><span class="op" id="6130251">.</span><span class="ident" id="6130252">Escape</span><span class="op" id="6130258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130261">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130265">if</span>&nbsp;<span class="ident" id="6130268">debug</span>&nbsp;<span class="op" id="6130274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130278">p</span><span class="op" id="6130279">.</span><span class="ident" id="6130280">output</span>&nbsp;<span class="op" id="6130287">=</span>&nbsp;<span class="builtinfunc" id="6130289">append</span><span class="op" id="6130295">(</span><span class="ident" id="6130296">p</span><span class="op" id="6130297">.</span><span class="ident" id="6130298">output</span><span class="op" id="6130304">,</span>&nbsp;<span class="ident" id="6130306">fmt</span><span class="op" id="6130309">.</span><span class="ident" id="6130310">Sprintf</span><span class="op" id="6130317">(</span><span class="string" id="6130318">&#34;/*%s*/&#34;</span><span class="op" id="6130326">,</span>&nbsp;<span class="ident" id="6130328">pos</span><span class="op" id="6130331">)</span><span class="op" id="6130332">...</span><span class="op" id="6130335">)</span>&nbsp;<span class="comment" id="6130337">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130365">p</span><span class="op" id="6130366">.</span><span class="ident" id="6130367">output</span>&nbsp;<span class="op" id="6130374">=</span>&nbsp;<span class="builtinfunc" id="6130376">append</span><span class="op" id="6130382">(</span><span class="ident" id="6130383">p</span><span class="op" id="6130384">.</span><span class="ident" id="6130385">output</span><span class="op" id="6130391">,</span>&nbsp;<span class="ident" id="6130393">s</span><span class="op" id="6130394">...</span><span class="op" id="6130397">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130401">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130422">nlines</span>&nbsp;<span class="op" id="6130429">:=</span>&nbsp;<span class="num" id="6130432">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130435">var</span>&nbsp;<span class="ident" id="6130439">li</span>&nbsp;<span class="builtintype" id="6130442">int</span>&nbsp;<span class="comment" id="6130446">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130493">for</span>&nbsp;<span class="ident" id="6130497">i</span>&nbsp;<span class="op" id="6130499">:=</span>&nbsp;<span class="num" id="6130502">0</span><span class="op" id="6130503">;</span>&nbsp;<span class="ident" id="6130505">i</span>&nbsp;<span class="op" id="6130507">&lt;</span>&nbsp;<span class="builtinfunc" id="6130509">len</span><span class="op" id="6130512">(</span><span class="ident" id="6130513">s</span><span class="op" id="6130514">)</span><span class="op" id="6130515">;</span>&nbsp;<span class="ident" id="6130517">i</span><span class="op" id="6130518">++</span>&nbsp;<span class="op" id="6130521">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6130525">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130585">if</span>&nbsp;<span class="ident" id="6130588">s</span><span class="op" id="6130589">[</span><span class="ident" id="6130590">i</span><span class="op" id="6130591">]</span>&nbsp;<span class="op" id="6130593">==</span>&nbsp;<span class="string" id="6130596">&#39;\n&#39;</span>&nbsp;<span class="op" id="6130601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130606">nlines</span><span class="op" id="6130612">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130618">li</span>&nbsp;<span class="op" id="6130621">=</span>&nbsp;<span class="ident" id="6130623">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130627">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130633">p</span><span class="op" id="6130634">.</span><span class="ident" id="6130635">pos</span><span class="op" id="6130638">.</span><span class="ident" id="6130639">Offset</span>&nbsp;<span class="op" id="6130646">+=</span>&nbsp;<span class="builtinfunc" id="6130649">len</span><span class="op" id="6130652">(</span><span class="ident" id="6130653">s</span><span class="op" id="6130654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130657">if</span>&nbsp;<span class="ident" id="6130660">nlines</span>&nbsp;<span class="op" id="6130667">&gt;</span>&nbsp;<span class="num" id="6130669">0</span>&nbsp;<span class="op" id="6130671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130675">p</span><span class="op" id="6130676">.</span><span class="ident" id="6130677">pos</span><span class="op" id="6130680">.</span><span class="ident" id="6130681">Line</span>&nbsp;<span class="op" id="6130686">+=</span>&nbsp;<span class="ident" id="6130689">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130698">p</span><span class="op" id="6130699">.</span><span class="ident" id="6130700">out</span><span class="op" id="6130703">.</span><span class="ident" id="6130704">Line</span>&nbsp;<span class="op" id="6130709">+=</span>&nbsp;<span class="ident" id="6130712">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130721">c</span>&nbsp;<span class="op" id="6130723">:=</span>&nbsp;<span class="builtinfunc" id="6130726">len</span><span class="op" id="6130729">(</span><span class="ident" id="6130730">s</span><span class="op" id="6130731">)</span>&nbsp;<span class="op" id="6130733">-</span>&nbsp;<span class="ident" id="6130735">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130740">p</span><span class="op" id="6130741">.</span><span class="ident" id="6130742">pos</span><span class="op" id="6130745">.</span><span class="ident" id="6130746">Column</span>&nbsp;<span class="op" id="6130753">=</span>&nbsp;<span class="ident" id="6130755">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130759">p</span><span class="op" id="6130760">.</span><span class="ident" id="6130761">out</span><span class="op" id="6130764">.</span><span class="ident" id="6130765">Column</span>&nbsp;<span class="op" id="6130772">=</span>&nbsp;<span class="ident" id="6130774">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130777">}</span>&nbsp;<span class="keyword" id="6130779">else</span>&nbsp;<span class="op" id="6130784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130788">p</span><span class="op" id="6130789">.</span><span class="ident" id="6130790">pos</span><span class="op" id="6130793">.</span><span class="ident" id="6130794">Column</span>&nbsp;<span class="op" id="6130801">+=</span>&nbsp;<span class="builtinfunc" id="6130804">len</span><span class="op" id="6130807">(</span><span class="ident" id="6130808">s</span><span class="op" id="6130809">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130813">p</span><span class="op" id="6130814">.</span><span class="ident" id="6130815">out</span><span class="op" id="6130818">.</span><span class="ident" id="6130819">Column</span>&nbsp;<span class="op" id="6130826">+=</span>&nbsp;<span class="builtinfunc" id="6130829">len</span><span class="op" id="6130832">(</span><span class="ident" id="6130833">s</span><span class="op" id="6130834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6130841">if</span>&nbsp;<span class="ident" id="6130844">isLit</span>&nbsp;<span class="op" id="6130850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130854">p</span><span class="op" id="6130855">.</span><span class="ident" id="6130856">output</span>&nbsp;<span class="op" id="6130863">=</span>&nbsp;<span class="builtinfunc" id="6130865">append</span><span class="op" id="6130871">(</span><span class="ident" id="6130872">p</span><span class="op" id="6130873">.</span><span class="ident" id="6130874">output</span><span class="op" id="6130880">,</span>&nbsp;<span class="ident" id="6130882">tabwriter</span><span class="op" id="6130891">.</span><span class="ident" id="6130892">Escape</span><span class="op" id="6130898">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6130901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6130905">p</span><span class="op" id="6130906">.</span><span class="ident" id="6130907">last</span>&nbsp;<span class="op" id="6130912">=</span>&nbsp;<span class="ident" id="6130914">p</span><span class="op" id="6130915">.</span><span class="ident" id="6130916">pos</span><br>
<span class="lineno"></span><span class="op" id="6130920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="6130923">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="6130985">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6131047">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="6131103">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="6131165">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="6131228">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6131288">//</span><br>
<span class="lineno"></span><span class="keyword" id="6131291">func</span>&nbsp;<span class="op" id="6131296">(</span><span class="ident" id="6131297">p</span>&nbsp;<span class="op" id="6131299">*</span><span class="ident" id="6131300">printer</span><span class="op" id="6131307">)</span>&nbsp;<span class="ident" id="6131309">writeCommentPrefix</span><span class="op" id="6131327">(</span><span class="ident" id="6131328">pos</span><span class="op" id="6131331">,</span>&nbsp;<span class="ident" id="6131333">next</span>&nbsp;<span class="ident" id="6131338">token</span><span class="op" id="6131343">.</span><span class="ident" id="6131344">Position</span><span class="op" id="6131352">,</span>&nbsp;<span class="ident" id="6131354">prev</span><span class="op" id="6131358">,</span>&nbsp;<span class="ident" id="6131360">comment</span>&nbsp;<span class="op" id="6131368">*</span><span class="ident" id="6131369">ast</span><span class="op" id="6131372">.</span><span class="ident" id="6131373">Comment</span><span class="op" id="6131380">,</span>&nbsp;<span class="ident" id="6131382">tok</span>&nbsp;<span class="ident" id="6131386">token</span><span class="op" id="6131391">.</span><span class="ident" id="6131392">Token</span><span class="op" id="6131397">)</span>&nbsp;<span class="op" id="6131399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131402">if</span>&nbsp;<span class="builtinfunc" id="6131405">len</span><span class="op" id="6131408">(</span><span class="ident" id="6131409">p</span><span class="op" id="6131410">.</span><span class="ident" id="6131411">output</span><span class="op" id="6131417">)</span>&nbsp;<span class="op" id="6131419">==</span>&nbsp;<span class="num" id="6131422">0</span>&nbsp;<span class="op" id="6131424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131428">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131506">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6131514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131518">if</span>&nbsp;<span class="ident" id="6131521">pos</span><span class="op" id="6131524">.</span><span class="ident" id="6131525">IsValid</span><span class="op" id="6131532">(</span><span class="op" id="6131533">)</span>&nbsp;<span class="op" id="6131535">&amp;&amp;</span>&nbsp;<span class="ident" id="6131538">pos</span><span class="op" id="6131541">.</span><span class="ident" id="6131542">Filename</span>&nbsp;<span class="op" id="6131551">!=</span>&nbsp;<span class="ident" id="6131554">p</span><span class="op" id="6131555">.</span><span class="ident" id="6131556">last</span><span class="op" id="6131560">.</span><span class="ident" id="6131561">Filename</span>&nbsp;<span class="op" id="6131570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131574">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6131632">p</span><span class="op" id="6131633">.</span><span class="ident" id="6131634">writeByte</span><span class="op" id="6131643">(</span><span class="string" id="6131644">&#39;\f&#39;</span><span class="op" id="6131648">,</span>&nbsp;<span class="ident" id="6131650">maxNewlines</span><span class="op" id="6131661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131665">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6131673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131677">if</span>&nbsp;<span class="ident" id="6131680">pos</span><span class="op" id="6131683">.</span><span class="ident" id="6131684">Line</span>&nbsp;<span class="op" id="6131689">==</span>&nbsp;<span class="ident" id="6131692">p</span><span class="op" id="6131693">.</span><span class="ident" id="6131694">last</span><span class="op" id="6131698">.</span><span class="ident" id="6131699">Line</span>&nbsp;<span class="op" id="6131704">&amp;&amp;</span>&nbsp;<span class="op" id="6131707">(</span><span class="ident" id="6131708">prev</span>&nbsp;<span class="op" id="6131713">==</span>&nbsp;<span class="ident" id="6131716">nil</span>&nbsp;<span class="op" id="6131720">||</span>&nbsp;<span class="ident" id="6131723">prev</span><span class="op" id="6131727">.</span><span class="ident" id="6131728">Text</span><span class="op" id="6131732">[</span><span class="num" id="6131733">1</span><span class="op" id="6131734">]</span>&nbsp;<span class="op" id="6131736">!=</span>&nbsp;<span class="string" id="6131739">&#39;/&#39;</span><span class="op" id="6131742">)</span>&nbsp;<span class="op" id="6131744">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131748">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131792">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6131834">hasSep</span>&nbsp;<span class="op" id="6131841">:=</span>&nbsp;<span class="builtintype" id="6131844">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131852">if</span>&nbsp;<span class="ident" id="6131855">prev</span>&nbsp;<span class="op" id="6131860">==</span>&nbsp;<span class="ident" id="6131863">nil</span>&nbsp;<span class="op" id="6131867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131872">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6131911">j</span>&nbsp;<span class="op" id="6131913">:=</span>&nbsp;<span class="num" id="6131916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131921">for</span>&nbsp;<span class="ident" id="6131925">i</span><span class="op" id="6131926">,</span>&nbsp;<span class="ident" id="6131928">ch</span>&nbsp;<span class="op" id="6131931">:=</span>&nbsp;<span class="keyword" id="6131934">range</span>&nbsp;<span class="ident" id="6131940">p</span><span class="op" id="6131941">.</span><span class="ident" id="6131942">wsbuf</span>&nbsp;<span class="op" id="6131948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131954">switch</span>&nbsp;<span class="ident" id="6131961">ch</span>&nbsp;<span class="op" id="6131964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6131970">case</span>&nbsp;<span class="ident" id="6131975">blank</span><span class="op" id="6131980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6131987">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132030">p</span><span class="op" id="6132031">.</span><span class="ident" id="6132032">wsbuf</span><span class="op" id="6132037">[</span><span class="ident" id="6132038">i</span><span class="op" id="6132039">]</span>&nbsp;<span class="op" id="6132041">=</span>&nbsp;<span class="ident" id="6132043">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132055">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132068">case</span>&nbsp;<span class="ident" id="6132073">vtab</span><span class="op" id="6132077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132084">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132126">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132177">hasSep</span>&nbsp;<span class="op" id="6132184">=</span>&nbsp;<span class="builtintype" id="6132186">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132196">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132209">case</span>&nbsp;<span class="ident" id="6132214">indent</span><span class="op" id="6132220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132227">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132261">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132280">j</span>&nbsp;<span class="op" id="6132282">=</span>&nbsp;<span class="ident" id="6132284">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132290">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132304">p</span><span class="op" id="6132305">.</span><span class="ident" id="6132306">writeWhitespace</span><span class="op" id="6132321">(</span><span class="ident" id="6132322">j</span><span class="op" id="6132323">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132331">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132378">if</span>&nbsp;<span class="op" id="6132381">!</span><span class="ident" id="6132382">hasSep</span>&nbsp;<span class="op" id="6132389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132394">sep</span>&nbsp;<span class="op" id="6132398">:=</span>&nbsp;<span class="builtintype" id="6132401">byte</span><span class="op" id="6132405">(</span><span class="string" id="6132406">&#39;\t&#39;</span><span class="op" id="6132410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132415">if</span>&nbsp;<span class="ident" id="6132418">pos</span><span class="op" id="6132421">.</span><span class="ident" id="6132422">Line</span>&nbsp;<span class="op" id="6132427">==</span>&nbsp;<span class="ident" id="6132430">next</span><span class="op" id="6132434">.</span><span class="ident" id="6132435">Line</span>&nbsp;<span class="op" id="6132440">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132446">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132498">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132550">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132587">sep</span>&nbsp;<span class="op" id="6132591">=</span>&nbsp;<span class="string" id="6132593">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132600">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132605">p</span><span class="op" id="6132606">.</span><span class="ident" id="6132607">writeByte</span><span class="op" id="6132616">(</span><span class="ident" id="6132617">sep</span><span class="op" id="6132620">,</span>&nbsp;<span class="num" id="6132622">1</span><span class="op" id="6132623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6132631">}</span>&nbsp;<span class="keyword" id="6132633">else</span>&nbsp;<span class="op" id="6132638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132642">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132676">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132719">droppedLinebreak</span>&nbsp;<span class="op" id="6132736">:=</span>&nbsp;<span class="builtintype" id="6132739">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132747">j</span>&nbsp;<span class="op" id="6132749">:=</span>&nbsp;<span class="num" id="6132752">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132756">for</span>&nbsp;<span class="ident" id="6132760">i</span><span class="op" id="6132761">,</span>&nbsp;<span class="ident" id="6132763">ch</span>&nbsp;<span class="op" id="6132766">:=</span>&nbsp;<span class="keyword" id="6132769">range</span>&nbsp;<span class="ident" id="6132775">p</span><span class="op" id="6132776">.</span><span class="ident" id="6132777">wsbuf</span>&nbsp;<span class="op" id="6132783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132788">switch</span>&nbsp;<span class="ident" id="6132795">ch</span>&nbsp;<span class="op" id="6132798">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132803">case</span>&nbsp;<span class="ident" id="6132808">blank</span><span class="op" id="6132813">,</span>&nbsp;<span class="ident" id="6132815">vtab</span><span class="op" id="6132819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132825">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6132884">p</span><span class="op" id="6132885">.</span><span class="ident" id="6132886">wsbuf</span><span class="op" id="6132891">[</span><span class="ident" id="6132892">i</span><span class="op" id="6132893">]</span>&nbsp;<span class="op" id="6132895">=</span>&nbsp;<span class="ident" id="6132897">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132908">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132920">case</span>&nbsp;<span class="ident" id="6132925">indent</span><span class="op" id="6132931">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6132937">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132970">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6132982">case</span>&nbsp;<span class="ident" id="6132987">unindent</span><span class="op" id="6132995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133001">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133051">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133098">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133152">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133194">if</span>&nbsp;<span class="ident" id="6133197">i</span><span class="op" id="6133198">+</span><span class="num" id="6133199">1</span>&nbsp;<span class="op" id="6133201">&lt;</span>&nbsp;<span class="builtinfunc" id="6133203">len</span><span class="op" id="6133206">(</span><span class="ident" id="6133207">p</span><span class="op" id="6133208">.</span><span class="ident" id="6133209">wsbuf</span><span class="op" id="6133214">)</span>&nbsp;<span class="op" id="6133216">&amp;&amp;</span>&nbsp;<span class="ident" id="6133219">p</span><span class="op" id="6133220">.</span><span class="ident" id="6133221">wsbuf</span><span class="op" id="6133226">[</span><span class="ident" id="6133227">i</span><span class="op" id="6133228">+</span><span class="num" id="6133229">1</span><span class="op" id="6133230">]</span>&nbsp;<span class="op" id="6133232">==</span>&nbsp;<span class="ident" id="6133235">unindent</span>&nbsp;<span class="op" id="6133244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133251">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6133264">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133270">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133334">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133392">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133449">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133507">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133562">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133620">if</span>&nbsp;<span class="ident" id="6133623">tok</span>&nbsp;<span class="op" id="6133627">!=</span>&nbsp;<span class="ident" id="6133630">token</span><span class="op" id="6133635">.</span><span class="ident" id="6133636">RBRACE</span>&nbsp;<span class="op" id="6133643">&amp;&amp;</span>&nbsp;<span class="ident" id="6133646">pos</span><span class="op" id="6133649">.</span><span class="ident" id="6133650">Column</span>&nbsp;<span class="op" id="6133657">==</span>&nbsp;<span class="ident" id="6133660">next</span><span class="op" id="6133664">.</span><span class="ident" id="6133665">Column</span>&nbsp;<span class="op" id="6133672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133679">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6133692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133697">case</span>&nbsp;<span class="ident" id="6133702">newline</span><span class="op" id="6133709">,</span>&nbsp;<span class="ident" id="6133711">formfeed</span><span class="op" id="6133719">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133725">p</span><span class="op" id="6133726">.</span><span class="ident" id="6133727">wsbuf</span><span class="op" id="6133732">[</span><span class="ident" id="6133733">i</span><span class="op" id="6133734">]</span>&nbsp;<span class="op" id="6133736">=</span>&nbsp;<span class="ident" id="6133738">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133749">droppedLinebreak</span>&nbsp;<span class="op" id="6133766">=</span>&nbsp;<span class="ident" id="6133768">prev</span>&nbsp;<span class="op" id="6133773">==</span>&nbsp;<span class="ident" id="6133776">nil</span>&nbsp;<span class="comment" id="6133780">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6133826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133831">j</span>&nbsp;<span class="op" id="6133833">=</span>&nbsp;<span class="ident" id="6133835">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133840">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6133848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133852">p</span><span class="op" id="6133853">.</span><span class="ident" id="6133854">writeWhitespace</span><span class="op" id="6133869">(</span><span class="ident" id="6133870">j</span><span class="op" id="6133871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6133876">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133931">n</span>&nbsp;<span class="op" id="6133933">:=</span>&nbsp;<span class="num" id="6133936">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6133940">if</span>&nbsp;<span class="ident" id="6133943">pos</span><span class="op" id="6133946">.</span><span class="ident" id="6133947">IsValid</span><span class="op" id="6133954">(</span><span class="op" id="6133955">)</span>&nbsp;<span class="op" id="6133957">&amp;&amp;</span>&nbsp;<span class="ident" id="6133960">p</span><span class="op" id="6133961">.</span><span class="ident" id="6133962">last</span><span class="op" id="6133966">.</span><span class="ident" id="6133967">IsValid</span><span class="op" id="6133974">(</span><span class="op" id="6133975">)</span>&nbsp;<span class="op" id="6133977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6133982">n</span>&nbsp;<span class="op" id="6133984">=</span>&nbsp;<span class="ident" id="6133986">pos</span><span class="op" id="6133989">.</span><span class="ident" id="6133990">Line</span>&nbsp;<span class="op" id="6133995">-</span>&nbsp;<span class="ident" id="6133997">p</span><span class="op" id="6133998">.</span><span class="ident" id="6133999">last</span><span class="op" id="6134003">.</span><span class="ident" id="6134004">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134012">if</span>&nbsp;<span class="ident" id="6134015">n</span>&nbsp;<span class="op" id="6134017">&lt;</span>&nbsp;<span class="num" id="6134019">0</span>&nbsp;<span class="op" id="6134021">{</span>&nbsp;<span class="comment" id="6134023">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134050">n</span>&nbsp;<span class="op" id="6134052">=</span>&nbsp;<span class="num" id="6134054">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134059">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134068">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134122">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134174">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134228">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134282">if</span>&nbsp;<span class="ident" id="6134285">p</span><span class="op" id="6134286">.</span><span class="ident" id="6134287">indent</span>&nbsp;<span class="op" id="6134294">==</span>&nbsp;<span class="num" id="6134297">0</span>&nbsp;<span class="op" id="6134299">&amp;&amp;</span>&nbsp;<span class="ident" id="6134302">droppedLinebreak</span>&nbsp;<span class="op" id="6134319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134324">n</span><span class="op" id="6134325">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134335">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134383">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134431">if</span>&nbsp;<span class="ident" id="6134434">n</span>&nbsp;<span class="op" id="6134436">==</span>&nbsp;<span class="num" id="6134439">0</span>&nbsp;<span class="op" id="6134441">&amp;&amp;</span>&nbsp;<span class="ident" id="6134444">prev</span>&nbsp;<span class="op" id="6134449">!=</span>&nbsp;<span class="ident" id="6134452">nil</span>&nbsp;<span class="op" id="6134456">&amp;&amp;</span>&nbsp;<span class="ident" id="6134459">prev</span><span class="op" id="6134463">.</span><span class="ident" id="6134464">Text</span><span class="op" id="6134468">[</span><span class="num" id="6134469">1</span><span class="op" id="6134470">]</span>&nbsp;<span class="op" id="6134472">==</span>&nbsp;<span class="string" id="6134475">&#39;/&#39;</span>&nbsp;<span class="op" id="6134479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134484">n</span>&nbsp;<span class="op" id="6134486">=</span>&nbsp;<span class="num" id="6134488">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134492">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134497">if</span>&nbsp;<span class="ident" id="6134500">n</span>&nbsp;<span class="op" id="6134502">&gt;</span>&nbsp;<span class="num" id="6134504">0</span>&nbsp;<span class="op" id="6134506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134511">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134566">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6134621">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6134665">p</span><span class="op" id="6134666">.</span><span class="ident" id="6134667">writeByte</span><span class="op" id="6134676">(</span><span class="string" id="6134677">&#39;\f&#39;</span><span class="op" id="6134681">,</span>&nbsp;<span class="ident" id="6134683">nlimit</span><span class="op" id="6134689">(</span><span class="ident" id="6134690">n</span><span class="op" id="6134691">)</span><span class="op" id="6134692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134699">}</span><br>
<span class="lineno"></span><span class="op" id="6134701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="6134704">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="6134751">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="6134814">//</span><br>
<span class="lineno"></span><span class="keyword" id="6134817">func</span>&nbsp;<span class="ident" id="6134822">isBlank</span><span class="op" id="6134829">(</span><span class="ident" id="6134830">s</span>&nbsp;<span class="builtintype" id="6134832">string</span><span class="op" id="6134838">)</span>&nbsp;<span class="builtintype" id="6134840">bool</span>&nbsp;<span class="op" id="6134845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134848">for</span>&nbsp;<span class="ident" id="6134852">i</span>&nbsp;<span class="op" id="6134854">:=</span>&nbsp;<span class="num" id="6134857">0</span><span class="op" id="6134858">;</span>&nbsp;<span class="ident" id="6134860">i</span>&nbsp;<span class="op" id="6134862">&lt;</span>&nbsp;<span class="builtinfunc" id="6134864">len</span><span class="op" id="6134867">(</span><span class="ident" id="6134868">s</span><span class="op" id="6134869">)</span><span class="op" id="6134870">;</span>&nbsp;<span class="ident" id="6134872">i</span><span class="op" id="6134873">++</span>&nbsp;<span class="op" id="6134876">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134880">if</span>&nbsp;<span class="ident" id="6134883">s</span><span class="op" id="6134884">[</span><span class="ident" id="6134885">i</span><span class="op" id="6134886">]</span>&nbsp;<span class="op" id="6134888">&gt;</span>&nbsp;<span class="string" id="6134890">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6134894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134899">return</span>&nbsp;<span class="builtintype" id="6134906">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6134917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6134920">return</span>&nbsp;<span class="builtintype" id="6134927">true</span><br>
<span class="lineno">460</span><span class="op" id="6134932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6134935">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="6134989">func</span>&nbsp;<span class="ident" id="6134994">commonPrefix</span><span class="op" id="6135006">(</span><span class="ident" id="6135007">a</span><span class="op" id="6135008">,</span>&nbsp;<span class="ident" id="6135010">b</span>&nbsp;<span class="builtintype" id="6135012">string</span><span class="op" id="6135018">)</span>&nbsp;<span class="builtintype" id="6135020">string</span>&nbsp;<span class="op" id="6135027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135030">i</span>&nbsp;<span class="op" id="6135032">:=</span>&nbsp;<span class="num" id="6135035">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135038">for</span>&nbsp;<span class="ident" id="6135042">i</span>&nbsp;<span class="op" id="6135044">&lt;</span>&nbsp;<span class="builtinfunc" id="6135046">len</span><span class="op" id="6135049">(</span><span class="ident" id="6135050">a</span><span class="op" id="6135051">)</span>&nbsp;<span class="op" id="6135053">&amp;&amp;</span>&nbsp;<span class="ident" id="6135056">i</span>&nbsp;<span class="op" id="6135058">&lt;</span>&nbsp;<span class="builtinfunc" id="6135060">len</span><span class="op" id="6135063">(</span><span class="ident" id="6135064">b</span><span class="op" id="6135065">)</span>&nbsp;<span class="op" id="6135067">&amp;&amp;</span>&nbsp;<span class="ident" id="6135070">a</span><span class="op" id="6135071">[</span><span class="ident" id="6135072">i</span><span class="op" id="6135073">]</span>&nbsp;<span class="op" id="6135075">==</span>&nbsp;<span class="ident" id="6135078">b</span><span class="op" id="6135079">[</span><span class="ident" id="6135080">i</span><span class="op" id="6135081">]</span>&nbsp;<span class="op" id="6135083">&amp;&amp;</span>&nbsp;<span class="op" id="6135086">(</span><span class="ident" id="6135087">a</span><span class="op" id="6135088">[</span><span class="ident" id="6135089">i</span><span class="op" id="6135090">]</span>&nbsp;<span class="op" id="6135092">&lt;=</span>&nbsp;<span class="string" id="6135095">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6135099">||</span>&nbsp;<span class="ident" id="6135102">a</span><span class="op" id="6135103">[</span><span class="ident" id="6135104">i</span><span class="op" id="6135105">]</span>&nbsp;<span class="op" id="6135107">==</span>&nbsp;<span class="string" id="6135110">&#39;*&#39;</span><span class="op" id="6135113">)</span>&nbsp;<span class="op" id="6135115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6135119">i</span><span class="op" id="6135120">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6135124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135127">return</span>&nbsp;<span class="ident" id="6135134">a</span><span class="op" id="6135135">[</span><span class="num" id="6135136">0</span><span class="op" id="6135137">:</span><span class="ident" id="6135138">i</span><span class="op" id="6135139">]</span><br>
<span class="lineno"></span><span class="op" id="6135141">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="6135144">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="6135201">func</span>&nbsp;<span class="ident" id="6135206">trimRight</span><span class="op" id="6135215">(</span><span class="ident" id="6135216">s</span>&nbsp;<span class="builtintype" id="6135218">string</span><span class="op" id="6135224">)</span>&nbsp;<span class="builtintype" id="6135226">string</span>&nbsp;<span class="op" id="6135233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135236">return</span>&nbsp;<span class="ident" id="6135243">strings</span><span class="op" id="6135250">.</span><span class="ident" id="6135251">TrimRightFunc</span><span class="op" id="6135264">(</span><span class="ident" id="6135265">s</span><span class="op" id="6135266">,</span>&nbsp;<span class="ident" id="6135268">unicode</span><span class="op" id="6135275">.</span><span class="ident" id="6135276">IsSpace</span><span class="op" id="6135283">)</span><br>
<span class="lineno"></span><span class="op" id="6135285">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="6135288">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6135372">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="6135457">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6135537">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="6135617">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="6135641">//</span><br>
<span class="lineno"></span><span class="keyword" id="6135644">func</span>&nbsp;<span class="ident" id="6135649">stripCommonPrefix</span><span class="op" id="6135666">(</span><span class="ident" id="6135667">lines</span>&nbsp;<span class="op" id="6135673">[</span><span class="op" id="6135674">]</span><span class="builtintype" id="6135675">string</span><span class="op" id="6135681">)</span>&nbsp;<span class="op" id="6135683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135686">if</span>&nbsp;<span class="builtinfunc" id="6135689">len</span><span class="op" id="6135692">(</span><span class="ident" id="6135693">lines</span><span class="op" id="6135698">)</span>&nbsp;<span class="op" id="6135700">&lt;=</span>&nbsp;<span class="num" id="6135703">1</span>&nbsp;<span class="op" id="6135705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6135709">return</span>&nbsp;<span class="comment" id="6135716">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6135753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6135756">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6135776">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6135833">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6135890">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6135944">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136002">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136060">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136118">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136159">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136221">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136283">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136344">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136405">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136465">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136479">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136483">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136543">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6136603">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136657">var</span>&nbsp;<span class="ident" id="6136661">prefix</span>&nbsp;<span class="builtintype" id="6136668">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136676">if</span>&nbsp;<span class="builtinfunc" id="6136679">len</span><span class="op" id="6136682">(</span><span class="ident" id="6136683">lines</span><span class="op" id="6136688">)</span>&nbsp;<span class="op" id="6136690">&gt;</span>&nbsp;<span class="num" id="6136692">2</span>&nbsp;<span class="op" id="6136694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136698">first</span>&nbsp;<span class="op" id="6136704">:=</span>&nbsp;<span class="builtintype" id="6136707">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136714">for</span>&nbsp;<span class="ident" id="6136718">i</span><span class="op" id="6136719">,</span>&nbsp;<span class="ident" id="6136721">line</span>&nbsp;<span class="op" id="6136726">:=</span>&nbsp;<span class="keyword" id="6136729">range</span>&nbsp;<span class="ident" id="6136735">lines</span><span class="op" id="6136740">[</span><span class="num" id="6136741">1</span>&nbsp;<span class="op" id="6136743">:</span>&nbsp;<span class="builtinfunc" id="6136745">len</span><span class="op" id="6136748">(</span><span class="ident" id="6136749">lines</span><span class="op" id="6136754">)</span><span class="op" id="6136755">-</span><span class="num" id="6136756">1</span><span class="op" id="6136757">]</span>&nbsp;<span class="op" id="6136759">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136764">switch</span>&nbsp;<span class="op" id="6136771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136776">case</span>&nbsp;<span class="ident" id="6136781">isBlank</span><span class="op" id="6136788">(</span><span class="ident" id="6136789">line</span><span class="op" id="6136793">)</span><span class="op" id="6136794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136800">lines</span><span class="op" id="6136805">[</span><span class="num" id="6136806">1</span><span class="op" id="6136807">+</span><span class="ident" id="6136808">i</span><span class="op" id="6136809">]</span>&nbsp;<span class="op" id="6136811">=</span>&nbsp;<span class="string" id="6136813">&#34;&#34;</span>&nbsp;<span class="comment" id="6136816">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136849">case</span>&nbsp;<span class="ident" id="6136854">first</span><span class="op" id="6136859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136865">prefix</span>&nbsp;<span class="op" id="6136872">=</span>&nbsp;<span class="ident" id="6136874">commonPrefix</span><span class="op" id="6136886">(</span><span class="ident" id="6136887">line</span><span class="op" id="6136891">,</span>&nbsp;<span class="ident" id="6136893">line</span><span class="op" id="6136897">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136903">first</span>&nbsp;<span class="op" id="6136909">=</span>&nbsp;<span class="builtintype" id="6136911">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6136920">default</span><span class="op" id="6136927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6136933">prefix</span>&nbsp;<span class="op" id="6136940">=</span>&nbsp;<span class="ident" id="6136942">commonPrefix</span><span class="op" id="6136954">(</span><span class="ident" id="6136955">prefix</span><span class="op" id="6136961">,</span>&nbsp;<span class="ident" id="6136963">line</span><span class="op" id="6136967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136976">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6136979">}</span>&nbsp;<span class="keyword" id="6136981">else</span>&nbsp;<span class="op" id="6136986">{</span>&nbsp;<span class="comment" id="6136988">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137052">line</span>&nbsp;<span class="op" id="6137057">:=</span>&nbsp;<span class="ident" id="6137060">lines</span><span class="op" id="6137065">[</span><span class="num" id="6137066">1</span><span class="op" id="6137067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137071">prefix</span>&nbsp;<span class="op" id="6137078">=</span>&nbsp;<span class="ident" id="6137080">commonPrefix</span><span class="op" id="6137092">(</span><span class="ident" id="6137093">line</span><span class="op" id="6137097">,</span>&nbsp;<span class="ident" id="6137099">line</span><span class="op" id="6137103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6137106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137110">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137190">lineOfStars</span>&nbsp;<span class="op" id="6137202">:=</span>&nbsp;<span class="builtintype" id="6137205">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6137212">if</span>&nbsp;<span class="ident" id="6137215">i</span>&nbsp;<span class="op" id="6137217">:=</span>&nbsp;<span class="ident" id="6137220">strings</span><span class="op" id="6137227">.</span><span class="ident" id="6137228">Index</span><span class="op" id="6137233">(</span><span class="ident" id="6137234">prefix</span><span class="op" id="6137240">,</span>&nbsp;<span class="string" id="6137242">&#34;*&#34;</span><span class="op" id="6137245">)</span><span class="op" id="6137246">;</span>&nbsp;<span class="ident" id="6137248">i</span>&nbsp;<span class="op" id="6137250">&gt;=</span>&nbsp;<span class="num" id="6137253">0</span>&nbsp;<span class="op" id="6137255">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137259">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6137287">if</span>&nbsp;<span class="ident" id="6137290">i</span>&nbsp;<span class="op" id="6137292">&gt;</span>&nbsp;<span class="num" id="6137294">0</span>&nbsp;<span class="op" id="6137296">&amp;&amp;</span>&nbsp;<span class="ident" id="6137299">prefix</span><span class="op" id="6137305">[</span><span class="ident" id="6137306">i</span><span class="op" id="6137307">-</span><span class="num" id="6137308">1</span><span class="op" id="6137309">]</span>&nbsp;<span class="op" id="6137311">==</span>&nbsp;<span class="string" id="6137314">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6137318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137323">i</span><span class="op" id="6137324">--</span>&nbsp;<span class="comment" id="6137327">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6137390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137394">prefix</span>&nbsp;<span class="op" id="6137401">=</span>&nbsp;<span class="ident" id="6137403">prefix</span><span class="op" id="6137409">[</span><span class="num" id="6137410">0</span><span class="op" id="6137411">:</span><span class="ident" id="6137412">i</span><span class="op" id="6137413">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137417">lineOfStars</span>&nbsp;<span class="op" id="6137429">=</span>&nbsp;<span class="builtintype" id="6137431">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6137437">}</span>&nbsp;<span class="keyword" id="6137439">else</span>&nbsp;<span class="op" id="6137444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137448">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137479">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137541">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137603">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137666">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137727">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137789">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6137850">first</span>&nbsp;<span class="op" id="6137856">:=</span>&nbsp;<span class="ident" id="6137859">lines</span><span class="op" id="6137864">[</span><span class="num" id="6137865">0</span><span class="op" id="6137866">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6137870">if</span>&nbsp;<span class="ident" id="6137873">isBlank</span><span class="op" id="6137880">(</span><span class="ident" id="6137881">first</span><span class="op" id="6137886">[</span><span class="num" id="6137887">2</span><span class="op" id="6137888">:</span><span class="op" id="6137889">]</span><span class="op" id="6137890">)</span>&nbsp;<span class="op" id="6137892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137897">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137938">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6137985">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138037">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138090">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138115">i</span>&nbsp;<span class="op" id="6138117">:=</span>&nbsp;<span class="builtinfunc" id="6138120">len</span><span class="op" id="6138123">(</span><span class="ident" id="6138124">prefix</span><span class="op" id="6138130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138135">for</span>&nbsp;<span class="ident" id="6138139">n</span>&nbsp;<span class="op" id="6138141">:=</span>&nbsp;<span class="num" id="6138144">0</span><span class="op" id="6138145">;</span>&nbsp;<span class="ident" id="6138147">n</span>&nbsp;<span class="op" id="6138149">&lt;</span>&nbsp;<span class="num" id="6138151">3</span>&nbsp;<span class="op" id="6138153">&amp;&amp;</span>&nbsp;<span class="ident" id="6138156">i</span>&nbsp;<span class="op" id="6138158">&gt;</span>&nbsp;<span class="num" id="6138160">0</span>&nbsp;<span class="op" id="6138162">&amp;&amp;</span>&nbsp;<span class="ident" id="6138165">prefix</span><span class="op" id="6138171">[</span><span class="ident" id="6138172">i</span><span class="op" id="6138173">-</span><span class="num" id="6138174">1</span><span class="op" id="6138175">]</span>&nbsp;<span class="op" id="6138177">==</span>&nbsp;<span class="string" id="6138180">&#39;&nbsp;&#39;</span><span class="op" id="6138183">;</span>&nbsp;<span class="ident" id="6138185">n</span><span class="op" id="6138186">++</span>&nbsp;<span class="op" id="6138189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138195">i</span><span class="op" id="6138196">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138202">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138207">if</span>&nbsp;<span class="ident" id="6138210">i</span>&nbsp;<span class="op" id="6138212">==</span>&nbsp;<span class="builtinfunc" id="6138215">len</span><span class="op" id="6138218">(</span><span class="ident" id="6138219">prefix</span><span class="op" id="6138225">)</span>&nbsp;<span class="op" id="6138227">&amp;&amp;</span>&nbsp;<span class="ident" id="6138230">i</span>&nbsp;<span class="op" id="6138232">&gt;</span>&nbsp;<span class="num" id="6138234">0</span>&nbsp;<span class="op" id="6138236">&amp;&amp;</span>&nbsp;<span class="ident" id="6138239">prefix</span><span class="op" id="6138245">[</span><span class="ident" id="6138246">i</span><span class="op" id="6138247">-</span><span class="num" id="6138248">1</span><span class="op" id="6138249">]</span>&nbsp;<span class="op" id="6138251">==</span>&nbsp;<span class="string" id="6138254">&#39;\t&#39;</span>&nbsp;<span class="op" id="6138259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138265">i</span><span class="op" id="6138266">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138277">prefix</span>&nbsp;<span class="op" id="6138284">=</span>&nbsp;<span class="ident" id="6138286">prefix</span><span class="op" id="6138292">[</span><span class="num" id="6138293">0</span><span class="op" id="6138294">:</span><span class="ident" id="6138295">i</span><span class="op" id="6138296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138300">}</span>&nbsp;<span class="keyword" id="6138302">else</span>&nbsp;<span class="op" id="6138307">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138312">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138349">suffix</span>&nbsp;<span class="op" id="6138356">:=</span>&nbsp;<span class="builtinfunc" id="6138359">make</span><span class="op" id="6138363">(</span><span class="op" id="6138364">[</span><span class="op" id="6138365">]</span><span class="builtintype" id="6138366">byte</span><span class="op" id="6138370">,</span>&nbsp;<span class="builtinfunc" id="6138372">len</span><span class="op" id="6138375">(</span><span class="ident" id="6138376">first</span><span class="op" id="6138381">)</span><span class="op" id="6138382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138387">n</span>&nbsp;<span class="op" id="6138389">:=</span>&nbsp;<span class="num" id="6138392">2</span>&nbsp;<span class="comment" id="6138394">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138423">for</span>&nbsp;<span class="ident" id="6138427">n</span>&nbsp;<span class="op" id="6138429">&lt;</span>&nbsp;<span class="builtinfunc" id="6138431">len</span><span class="op" id="6138434">(</span><span class="ident" id="6138435">first</span><span class="op" id="6138440">)</span>&nbsp;<span class="op" id="6138442">&amp;&amp;</span>&nbsp;<span class="ident" id="6138445">first</span><span class="op" id="6138450">[</span><span class="ident" id="6138451">n</span><span class="op" id="6138452">]</span>&nbsp;<span class="op" id="6138454">&lt;=</span>&nbsp;<span class="string" id="6138457">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6138461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138467">suffix</span><span class="op" id="6138473">[</span><span class="ident" id="6138474">n</span><span class="op" id="6138475">]</span>&nbsp;<span class="op" id="6138477">=</span>&nbsp;<span class="ident" id="6138479">first</span><span class="op" id="6138484">[</span><span class="ident" id="6138485">n</span><span class="op" id="6138486">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138492">n</span><span class="op" id="6138493">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138504">if</span>&nbsp;<span class="ident" id="6138507">n</span>&nbsp;<span class="op" id="6138509">&gt;</span>&nbsp;<span class="num" id="6138511">2</span>&nbsp;<span class="op" id="6138513">&amp;&amp;</span>&nbsp;<span class="ident" id="6138516">suffix</span><span class="op" id="6138522">[</span><span class="num" id="6138523">2</span><span class="op" id="6138524">]</span>&nbsp;<span class="op" id="6138526">==</span>&nbsp;<span class="string" id="6138529">&#39;\t&#39;</span>&nbsp;<span class="op" id="6138534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138540">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138586">suffix</span>&nbsp;<span class="op" id="6138593">=</span>&nbsp;<span class="ident" id="6138595">suffix</span><span class="op" id="6138601">[</span><span class="num" id="6138602">2</span><span class="op" id="6138603">:</span><span class="ident" id="6138604">n</span><span class="op" id="6138605">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138610">}</span>&nbsp;<span class="keyword" id="6138612">else</span>&nbsp;<span class="op" id="6138617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138623">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138658">suffix</span><span class="op" id="6138664">[</span><span class="num" id="6138665">0</span><span class="op" id="6138666">]</span><span class="op" id="6138667">,</span>&nbsp;<span class="ident" id="6138669">suffix</span><span class="op" id="6138675">[</span><span class="num" id="6138676">1</span><span class="op" id="6138677">]</span>&nbsp;<span class="op" id="6138679">=</span>&nbsp;<span class="string" id="6138681">&#39;&nbsp;&#39;</span><span class="op" id="6138684">,</span>&nbsp;<span class="string" id="6138686">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138694">suffix</span>&nbsp;<span class="op" id="6138701">=</span>&nbsp;<span class="ident" id="6138703">suffix</span><span class="op" id="6138709">[</span><span class="num" id="6138710">0</span><span class="op" id="6138711">:</span><span class="ident" id="6138712">n</span><span class="op" id="6138713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138718">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138723">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138781">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138835">prefix</span>&nbsp;<span class="op" id="6138842">=</span>&nbsp;<span class="ident" id="6138844">strings</span><span class="op" id="6138851">.</span><span class="ident" id="6138852">TrimSuffix</span><span class="op" id="6138862">(</span><span class="ident" id="6138863">prefix</span><span class="op" id="6138869">,</span>&nbsp;<span class="builtintype" id="6138871">string</span><span class="op" id="6138877">(</span><span class="ident" id="6138878">suffix</span><span class="op" id="6138884">)</span><span class="op" id="6138885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138892">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138896">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6138961">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139026">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139037">last</span>&nbsp;<span class="op" id="6139042">:=</span>&nbsp;<span class="ident" id="6139045">lines</span><span class="op" id="6139050">[</span><span class="builtinfunc" id="6139051">len</span><span class="op" id="6139054">(</span><span class="ident" id="6139055">lines</span><span class="op" id="6139060">)</span><span class="op" id="6139061">-</span><span class="num" id="6139062">1</span><span class="op" id="6139063">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139066">closing</span>&nbsp;<span class="op" id="6139074">:=</span>&nbsp;<span class="string" id="6139077">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139083">i</span>&nbsp;<span class="op" id="6139085">:=</span>&nbsp;<span class="ident" id="6139088">strings</span><span class="op" id="6139095">.</span><span class="ident" id="6139096">Index</span><span class="op" id="6139101">(</span><span class="ident" id="6139102">last</span><span class="op" id="6139106">,</span>&nbsp;<span class="ident" id="6139108">closing</span><span class="op" id="6139115">)</span>&nbsp;<span class="comment" id="6139117">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139156">if</span>&nbsp;<span class="ident" id="6139159">isBlank</span><span class="op" id="6139166">(</span><span class="ident" id="6139167">last</span><span class="op" id="6139171">[</span><span class="num" id="6139172">0</span><span class="op" id="6139173">:</span><span class="ident" id="6139174">i</span><span class="op" id="6139175">]</span><span class="op" id="6139176">)</span>&nbsp;<span class="op" id="6139178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139182">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139222">if</span>&nbsp;<span class="ident" id="6139225">lineOfStars</span>&nbsp;<span class="op" id="6139237">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139242">closing</span>&nbsp;<span class="op" id="6139250">=</span>&nbsp;<span class="string" id="6139252">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="6139258">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139297">lines</span><span class="op" id="6139302">[</span><span class="builtinfunc" id="6139303">len</span><span class="op" id="6139306">(</span><span class="ident" id="6139307">lines</span><span class="op" id="6139312">)</span><span class="op" id="6139313">-</span><span class="num" id="6139314">1</span><span class="op" id="6139315">]</span>&nbsp;<span class="op" id="6139317">=</span>&nbsp;<span class="ident" id="6139319">prefix</span>&nbsp;<span class="op" id="6139326">+</span>&nbsp;<span class="ident" id="6139328">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139337">}</span>&nbsp;<span class="keyword" id="6139339">else</span>&nbsp;<span class="op" id="6139344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139348">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139399">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139451">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139478">prefix</span>&nbsp;<span class="op" id="6139485">=</span>&nbsp;<span class="ident" id="6139487">commonPrefix</span><span class="op" id="6139499">(</span><span class="ident" id="6139500">prefix</span><span class="op" id="6139506">,</span>&nbsp;<span class="ident" id="6139508">last</span><span class="op" id="6139512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139519">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139588">for</span>&nbsp;<span class="ident" id="6139592">i</span><span class="op" id="6139593">,</span>&nbsp;<span class="ident" id="6139595">line</span>&nbsp;<span class="op" id="6139600">:=</span>&nbsp;<span class="keyword" id="6139603">range</span>&nbsp;<span class="ident" id="6139609">lines</span>&nbsp;<span class="op" id="6139615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139619">if</span>&nbsp;<span class="ident" id="6139622">i</span>&nbsp;<span class="op" id="6139624">&gt;</span>&nbsp;<span class="num" id="6139626">0</span>&nbsp;<span class="op" id="6139628">&amp;&amp;</span>&nbsp;<span class="ident" id="6139631">line</span>&nbsp;<span class="op" id="6139636">!=</span>&nbsp;<span class="string" id="6139639">&#34;&#34;</span>&nbsp;<span class="op" id="6139642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139647">lines</span><span class="op" id="6139652">[</span><span class="ident" id="6139653">i</span><span class="op" id="6139654">]</span>&nbsp;<span class="op" id="6139656">=</span>&nbsp;<span class="ident" id="6139658">line</span><span class="op" id="6139662">[</span><span class="builtinfunc" id="6139663">len</span><span class="op" id="6139666">(</span><span class="ident" id="6139667">prefix</span><span class="op" id="6139673">)</span><span class="op" id="6139674">:</span><span class="op" id="6139675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139679">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139682">}</span><br>
<span class="lineno"></span><span class="op" id="6139684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6139687">func</span>&nbsp;<span class="op" id="6139692">(</span><span class="ident" id="6139693">p</span>&nbsp;<span class="op" id="6139695">*</span><span class="ident" id="6139696">printer</span><span class="op" id="6139703">)</span>&nbsp;<span class="ident" id="6139705">writeComment</span><span class="op" id="6139717">(</span><span class="ident" id="6139718">comment</span>&nbsp;<span class="op" id="6139726">*</span><span class="ident" id="6139727">ast</span><span class="op" id="6139730">.</span><span class="ident" id="6139731">Comment</span><span class="op" id="6139738">)</span>&nbsp;<span class="op" id="6139740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139743">text</span>&nbsp;<span class="op" id="6139748">:=</span>&nbsp;<span class="ident" id="6139751">comment</span><span class="op" id="6139758">.</span><span class="ident" id="6139759">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139765">pos</span>&nbsp;<span class="op" id="6139769">:=</span>&nbsp;<span class="ident" id="6139772">p</span><span class="op" id="6139773">.</span><span class="ident" id="6139774">posFor</span><span class="op" id="6139780">(</span><span class="ident" id="6139781">comment</span><span class="op" id="6139788">.</span><span class="ident" id="6139789">Pos</span><span class="op" id="6139792">(</span><span class="op" id="6139793">)</span><span class="op" id="6139794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139798">const</span>&nbsp;<span class="ident" id="6139804">linePrefix</span>&nbsp;<span class="op" id="6139815">=</span>&nbsp;<span class="string" id="6139817">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139828">if</span>&nbsp;<span class="ident" id="6139831">strings</span><span class="op" id="6139838">.</span><span class="ident" id="6139839">HasPrefix</span><span class="op" id="6139848">(</span><span class="ident" id="6139849">text</span><span class="op" id="6139853">,</span>&nbsp;<span class="ident" id="6139855">linePrefix</span><span class="op" id="6139865">)</span>&nbsp;<span class="op" id="6139867">&amp;&amp;</span>&nbsp;<span class="op" id="6139870">(</span><span class="op" id="6139871">!</span><span class="ident" id="6139872">pos</span><span class="op" id="6139875">.</span><span class="ident" id="6139876">IsValid</span><span class="op" id="6139883">(</span><span class="op" id="6139884">)</span>&nbsp;<span class="op" id="6139886">||</span>&nbsp;<span class="ident" id="6139889">pos</span><span class="op" id="6139892">.</span><span class="ident" id="6139893">Column</span>&nbsp;<span class="op" id="6139900">==</span>&nbsp;<span class="num" id="6139903">1</span><span class="op" id="6139904">)</span>&nbsp;<span class="op" id="6139906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6139910">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139941">ldir</span>&nbsp;<span class="op" id="6139946">:=</span>&nbsp;<span class="ident" id="6139949">strings</span><span class="op" id="6139956">.</span><span class="ident" id="6139957">TrimSpace</span><span class="op" id="6139966">(</span><span class="ident" id="6139967">text</span><span class="op" id="6139971">[</span><span class="builtinfunc" id="6139972">len</span><span class="op" id="6139975">(</span><span class="ident" id="6139976">linePrefix</span><span class="op" id="6139986">)</span><span class="op" id="6139987">:</span><span class="op" id="6139988">]</span><span class="op" id="6139989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139993">if</span>&nbsp;<span class="ident" id="6139996">i</span>&nbsp;<span class="op" id="6139998">:=</span>&nbsp;<span class="ident" id="6140001">strings</span><span class="op" id="6140008">.</span><span class="ident" id="6140009">LastIndex</span><span class="op" id="6140018">(</span><span class="ident" id="6140019">ldir</span><span class="op" id="6140023">,</span>&nbsp;<span class="string" id="6140025">&#34;:&#34;</span><span class="op" id="6140028">)</span><span class="op" id="6140029">;</span>&nbsp;<span class="ident" id="6140031">i</span>&nbsp;<span class="op" id="6140033">&gt;=</span>&nbsp;<span class="num" id="6140036">0</span>&nbsp;<span class="op" id="6140038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140043">if</span>&nbsp;<span class="ident" id="6140046">line</span><span class="op" id="6140050">,</span>&nbsp;<span class="ident" id="6140052">err</span>&nbsp;<span class="op" id="6140056">:=</span>&nbsp;<span class="ident" id="6140059">strconv</span><span class="op" id="6140066">.</span><span class="ident" id="6140067">Atoi</span><span class="op" id="6140071">(</span><span class="ident" id="6140072">ldir</span><span class="op" id="6140076">[</span><span class="ident" id="6140077">i</span><span class="op" id="6140078">+</span><span class="num" id="6140079">1</span><span class="op" id="6140080">:</span><span class="op" id="6140081">]</span><span class="op" id="6140082">)</span><span class="op" id="6140083">;</span>&nbsp;<span class="ident" id="6140085">err</span>&nbsp;<span class="op" id="6140089">==</span>&nbsp;<span class="ident" id="6140092">nil</span>&nbsp;<span class="op" id="6140096">&amp;&amp;</span>&nbsp;<span class="ident" id="6140099">line</span>&nbsp;<span class="op" id="6140104">&gt;</span>&nbsp;<span class="num" id="6140106">0</span>&nbsp;<span class="op" id="6140108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140114">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140170">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140226">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140282">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140338">indent</span>&nbsp;<span class="op" id="6140345">:=</span>&nbsp;<span class="ident" id="6140348">p</span><span class="op" id="6140349">.</span><span class="ident" id="6140350">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140361">p</span><span class="op" id="6140362">.</span><span class="ident" id="6140363">indent</span>&nbsp;<span class="op" id="6140370">=</span>&nbsp;<span class="num" id="6140372">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140378">defer</span>&nbsp;<span class="keyword" id="6140384">func</span><span class="op" id="6140388">(</span><span class="op" id="6140389">)</span>&nbsp;<span class="op" id="6140391">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140398">p</span><span class="op" id="6140399">.</span><span class="ident" id="6140400">pos</span><span class="op" id="6140403">.</span><span class="ident" id="6140404">Filename</span>&nbsp;<span class="op" id="6140413">=</span>&nbsp;<span class="ident" id="6140415">ldir</span><span class="op" id="6140419">[</span><span class="op" id="6140420">:</span><span class="ident" id="6140421">i</span><span class="op" id="6140422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140429">p</span><span class="op" id="6140430">.</span><span class="ident" id="6140431">pos</span><span class="op" id="6140434">.</span><span class="ident" id="6140435">Line</span>&nbsp;<span class="op" id="6140440">=</span>&nbsp;<span class="ident" id="6140442">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140452">p</span><span class="op" id="6140453">.</span><span class="ident" id="6140454">pos</span><span class="op" id="6140457">.</span><span class="ident" id="6140458">Column</span>&nbsp;<span class="op" id="6140465">=</span>&nbsp;<span class="num" id="6140467">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140474">p</span><span class="op" id="6140475">.</span><span class="ident" id="6140476">indent</span>&nbsp;<span class="op" id="6140483">=</span>&nbsp;<span class="ident" id="6140485">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140496">}</span><span class="op" id="6140497">(</span><span class="op" id="6140498">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140514">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140560">if</span>&nbsp;<span class="ident" id="6140563">text</span><span class="op" id="6140567">[</span><span class="num" id="6140568">1</span><span class="op" id="6140569">]</span>&nbsp;<span class="op" id="6140571">==</span>&nbsp;<span class="string" id="6140574">&#39;/&#39;</span>&nbsp;<span class="op" id="6140578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140582">p</span><span class="op" id="6140583">.</span><span class="ident" id="6140584">writeString</span><span class="op" id="6140595">(</span><span class="ident" id="6140596">pos</span><span class="op" id="6140599">,</span>&nbsp;<span class="ident" id="6140601">trimRight</span><span class="op" id="6140610">(</span><span class="ident" id="6140611">text</span><span class="op" id="6140615">)</span><span class="op" id="6140616">,</span>&nbsp;<span class="builtintype" id="6140618">true</span><span class="op" id="6140622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140626">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140638">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140696">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140751">lines</span>&nbsp;<span class="op" id="6140757">:=</span>&nbsp;<span class="ident" id="6140760">strings</span><span class="op" id="6140767">.</span><span class="ident" id="6140768">Split</span><span class="op" id="6140773">(</span><span class="ident" id="6140774">text</span><span class="op" id="6140778">,</span>&nbsp;<span class="string" id="6140780">&#34;\n&#34;</span><span class="op" id="6140784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140788">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140845">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140907">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140968">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141031">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141091">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141121">if</span>&nbsp;<span class="ident" id="6141124">pos</span><span class="op" id="6141127">.</span><span class="ident" id="6141128">IsValid</span><span class="op" id="6141135">(</span><span class="op" id="6141136">)</span>&nbsp;<span class="op" id="6141138">&amp;&amp;</span>&nbsp;<span class="ident" id="6141141">pos</span><span class="op" id="6141144">.</span><span class="ident" id="6141145">Column</span>&nbsp;<span class="op" id="6141152">==</span>&nbsp;<span class="num" id="6141155">1</span>&nbsp;<span class="op" id="6141157">&amp;&amp;</span>&nbsp;<span class="ident" id="6141160">p</span><span class="op" id="6141161">.</span><span class="ident" id="6141162">indent</span>&nbsp;<span class="op" id="6141169">&gt;</span>&nbsp;<span class="num" id="6141171">0</span>&nbsp;<span class="op" id="6141173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141177">for</span>&nbsp;<span class="ident" id="6141181">i</span><span class="op" id="6141182">,</span>&nbsp;<span class="ident" id="6141184">line</span>&nbsp;<span class="op" id="6141189">:=</span>&nbsp;<span class="keyword" id="6141192">range</span>&nbsp;<span class="ident" id="6141198">lines</span><span class="op" id="6141203">[</span><span class="num" id="6141204">1</span><span class="op" id="6141205">:</span><span class="op" id="6141206">]</span>&nbsp;<span class="op" id="6141208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141213">lines</span><span class="op" id="6141218">[</span><span class="num" id="6141219">1</span><span class="op" id="6141220">+</span><span class="ident" id="6141221">i</span><span class="op" id="6141222">]</span>&nbsp;<span class="op" id="6141224">=</span>&nbsp;<span class="string" id="6141226">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="6141232">+</span>&nbsp;<span class="ident" id="6141234">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141244">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141248">stripCommonPrefix</span><span class="op" id="6141265">(</span><span class="ident" id="6141266">lines</span><span class="op" id="6141271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141275">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141323">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141368">for</span>&nbsp;<span class="ident" id="6141372">i</span><span class="op" id="6141373">,</span>&nbsp;<span class="ident" id="6141375">line</span>&nbsp;<span class="op" id="6141380">:=</span>&nbsp;<span class="keyword" id="6141383">range</span>&nbsp;<span class="ident" id="6141389">lines</span>&nbsp;<span class="op" id="6141395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141399">if</span>&nbsp;<span class="ident" id="6141402">i</span>&nbsp;<span class="op" id="6141404">&gt;</span>&nbsp;<span class="num" id="6141406">0</span>&nbsp;<span class="op" id="6141408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141413">p</span><span class="op" id="6141414">.</span><span class="ident" id="6141415">writeByte</span><span class="op" id="6141424">(</span><span class="string" id="6141425">&#39;\f&#39;</span><span class="op" id="6141429">,</span>&nbsp;<span class="num" id="6141431">1</span><span class="op" id="6141432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141437">pos</span>&nbsp;<span class="op" id="6141441">=</span>&nbsp;<span class="ident" id="6141443">p</span><span class="op" id="6141444">.</span><span class="ident" id="6141445">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141451">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141455">if</span>&nbsp;<span class="builtinfunc" id="6141458">len</span><span class="op" id="6141461">(</span><span class="ident" id="6141462">line</span><span class="op" id="6141466">)</span>&nbsp;<span class="op" id="6141468">&gt;</span>&nbsp;<span class="num" id="6141470">0</span>&nbsp;<span class="op" id="6141472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141477">p</span><span class="op" id="6141478">.</span><span class="ident" id="6141479">writeString</span><span class="op" id="6141490">(</span><span class="ident" id="6141491">pos</span><span class="op" id="6141494">,</span>&nbsp;<span class="ident" id="6141496">trimRight</span><span class="op" id="6141505">(</span><span class="ident" id="6141506">line</span><span class="op" id="6141510">)</span><span class="op" id="6141511">,</span>&nbsp;<span class="builtintype" id="6141513">true</span><span class="op" id="6141517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141524">}</span><br>
<span class="lineno"></span><span class="op" id="6141526">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="6141529">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="6141600">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="6141671">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6141740">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="6141808">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6141880">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6141891">//</span><br>
<span class="lineno"></span><span class="keyword" id="6141894">func</span>&nbsp;<span class="op" id="6141899">(</span><span class="ident" id="6141900">p</span>&nbsp;<span class="op" id="6141902">*</span><span class="ident" id="6141903">printer</span><span class="op" id="6141910">)</span>&nbsp;<span class="ident" id="6141912">writeCommentSuffix</span><span class="op" id="6141930">(</span><span class="ident" id="6141931">needsLinebreak</span>&nbsp;<span class="builtintype" id="6141946">bool</span><span class="op" id="6141950">)</span>&nbsp;<span class="op" id="6141952">(</span><span class="ident" id="6141953">wroteNewline</span><span class="op" id="6141965">,</span>&nbsp;<span class="ident" id="6141967">droppedFF</span>&nbsp;<span class="builtintype" id="6141977">bool</span><span class="op" id="6141981">)</span>&nbsp;<span class="op" id="6141983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141986">for</span>&nbsp;<span class="ident" id="6141990">i</span><span class="op" id="6141991">,</span>&nbsp;<span class="ident" id="6141993">ch</span>&nbsp;<span class="op" id="6141996">:=</span>&nbsp;<span class="keyword" id="6141999">range</span>&nbsp;<span class="ident" id="6142005">p</span><span class="op" id="6142006">.</span><span class="ident" id="6142007">wsbuf</span>&nbsp;<span class="op" id="6142013">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142017">switch</span>&nbsp;<span class="ident" id="6142024">ch</span>&nbsp;<span class="op" id="6142027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142031">case</span>&nbsp;<span class="ident" id="6142036">blank</span><span class="op" id="6142041">,</span>&nbsp;<span class="ident" id="6142043">vtab</span><span class="op" id="6142047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142052">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142085">p</span><span class="op" id="6142086">.</span><span class="ident" id="6142087">wsbuf</span><span class="op" id="6142092">[</span><span class="ident" id="6142093">i</span><span class="op" id="6142094">]</span>&nbsp;<span class="op" id="6142096">=</span>&nbsp;<span class="ident" id="6142098">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142107">case</span>&nbsp;<span class="ident" id="6142112">indent</span><span class="op" id="6142118">,</span>&nbsp;<span class="ident" id="6142120">unindent</span><span class="op" id="6142128">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142133">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142173">case</span>&nbsp;<span class="ident" id="6142178">newline</span><span class="op" id="6142185">,</span>&nbsp;<span class="ident" id="6142187">formfeed</span><span class="op" id="6142195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142200">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142248">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142295">if</span>&nbsp;<span class="ident" id="6142298">needsLinebreak</span>&nbsp;<span class="op" id="6142313">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142319">needsLinebreak</span>&nbsp;<span class="op" id="6142334">=</span>&nbsp;<span class="builtintype" id="6142336">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142346">wroteNewline</span>&nbsp;<span class="op" id="6142359">=</span>&nbsp;<span class="builtintype" id="6142361">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142369">}</span>&nbsp;<span class="keyword" id="6142371">else</span>&nbsp;<span class="op" id="6142376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142382">if</span>&nbsp;<span class="ident" id="6142385">ch</span>&nbsp;<span class="op" id="6142388">==</span>&nbsp;<span class="ident" id="6142391">formfeed</span>&nbsp;<span class="op" id="6142400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142407">droppedFF</span>&nbsp;<span class="op" id="6142417">=</span>&nbsp;<span class="builtintype" id="6142419">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142434">p</span><span class="op" id="6142435">.</span><span class="ident" id="6142436">wsbuf</span><span class="op" id="6142441">[</span><span class="ident" id="6142442">i</span><span class="op" id="6142443">]</span>&nbsp;<span class="op" id="6142445">=</span>&nbsp;<span class="ident" id="6142447">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142464">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142467">p</span><span class="op" id="6142468">.</span><span class="ident" id="6142469">writeWhitespace</span><span class="op" id="6142484">(</span><span class="builtinfunc" id="6142485">len</span><span class="op" id="6142488">(</span><span class="ident" id="6142489">p</span><span class="op" id="6142490">.</span><span class="ident" id="6142491">wsbuf</span><span class="op" id="6142496">)</span><span class="op" id="6142497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142501">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142536">if</span>&nbsp;<span class="ident" id="6142539">needsLinebreak</span>&nbsp;<span class="op" id="6142554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142558">p</span><span class="op" id="6142559">.</span><span class="ident" id="6142560">writeByte</span><span class="op" id="6142569">(</span><span class="string" id="6142570">&#39;\n&#39;</span><span class="op" id="6142574">,</span>&nbsp;<span class="num" id="6142576">1</span><span class="op" id="6142577">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142581">wroteNewline</span>&nbsp;<span class="op" id="6142594">=</span>&nbsp;<span class="builtintype" id="6142596">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142606">return</span><br>
<span class="lineno"></span><span class="op" id="6142613">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="6142616">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6142695">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6142776">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="6142855">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="6142933">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6143013">//</span><br>
<span class="lineno"></span><span class="keyword" id="6143016">func</span>&nbsp;<span class="op" id="6143021">(</span><span class="ident" id="6143022">p</span>&nbsp;<span class="op" id="6143024">*</span><span class="ident" id="6143025">printer</span><span class="op" id="6143032">)</span>&nbsp;<span class="ident" id="6143034">intersperseComments</span><span class="op" id="6143053">(</span><span class="ident" id="6143054">next</span>&nbsp;<span class="ident" id="6143059">token</span><span class="op" id="6143064">.</span><span class="ident" id="6143065">Position</span><span class="op" id="6143073">,</span>&nbsp;<span class="ident" id="6143075">tok</span>&nbsp;<span class="ident" id="6143079">token</span><span class="op" id="6143084">.</span><span class="ident" id="6143085">Token</span><span class="op" id="6143090">)</span>&nbsp;<span class="op" id="6143092">(</span><span class="ident" id="6143093">wroteNewline</span><span class="op" id="6143105">,</span>&nbsp;<span class="ident" id="6143107">droppedFF</span>&nbsp;<span class="builtintype" id="6143117">bool</span><span class="op" id="6143121">)</span>&nbsp;<span class="op" id="6143123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143126">var</span>&nbsp;<span class="ident" id="6143130">last</span>&nbsp;<span class="op" id="6143135">*</span><span class="ident" id="6143136">ast</span><span class="op" id="6143139">.</span><span class="ident" id="6143140">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143149">for</span>&nbsp;<span class="ident" id="6143153">p</span><span class="op" id="6143154">.</span><span class="ident" id="6143155">commentBefore</span><span class="op" id="6143168">(</span><span class="ident" id="6143169">next</span><span class="op" id="6143173">)</span>&nbsp;<span class="op" id="6143175">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143179">for</span>&nbsp;<span class="ident" id="6143183">_</span><span class="op" id="6143184">,</span>&nbsp;<span class="ident" id="6143186">c</span>&nbsp;<span class="op" id="6143188">:=</span>&nbsp;<span class="keyword" id="6143191">range</span>&nbsp;<span class="ident" id="6143197">p</span><span class="op" id="6143198">.</span><span class="ident" id="6143199">comment</span><span class="op" id="6143206">.</span><span class="ident" id="6143207">List</span>&nbsp;<span class="op" id="6143212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143217">p</span><span class="op" id="6143218">.</span><span class="ident" id="6143219">writeCommentPrefix</span><span class="op" id="6143237">(</span><span class="ident" id="6143238">p</span><span class="op" id="6143239">.</span><span class="ident" id="6143240">posFor</span><span class="op" id="6143246">(</span><span class="ident" id="6143247">c</span><span class="op" id="6143248">.</span><span class="ident" id="6143249">Pos</span><span class="op" id="6143252">(</span><span class="op" id="6143253">)</span><span class="op" id="6143254">)</span><span class="op" id="6143255">,</span>&nbsp;<span class="ident" id="6143257">next</span><span class="op" id="6143261">,</span>&nbsp;<span class="ident" id="6143263">last</span><span class="op" id="6143267">,</span>&nbsp;<span class="ident" id="6143269">c</span><span class="op" id="6143270">,</span>&nbsp;<span class="ident" id="6143272">tok</span><span class="op" id="6143275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143280">p</span><span class="op" id="6143281">.</span><span class="ident" id="6143282">writeComment</span><span class="op" id="6143294">(</span><span class="ident" id="6143295">c</span><span class="op" id="6143296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143301">last</span>&nbsp;<span class="op" id="6143306">=</span>&nbsp;<span class="ident" id="6143308">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143312">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143316">p</span><span class="op" id="6143317">.</span><span class="ident" id="6143318">nextComment</span><span class="op" id="6143329">(</span><span class="op" id="6143330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143337">if</span>&nbsp;<span class="ident" id="6143340">last</span>&nbsp;<span class="op" id="6143345">!=</span>&nbsp;<span class="ident" id="6143348">nil</span>&nbsp;<span class="op" id="6143352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143356">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143421">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143491">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143559">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143625">if</span>&nbsp;<span class="ident" id="6143628">p</span><span class="op" id="6143629">.</span><span class="ident" id="6143630">mode</span><span class="op" id="6143634">&amp;</span><span class="ident" id="6143635">noExtraBlank</span>&nbsp;<span class="op" id="6143648">==</span>&nbsp;<span class="num" id="6143651">0</span>&nbsp;<span class="op" id="6143653">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143659">last</span><span class="op" id="6143663">.</span><span class="ident" id="6143664">Text</span><span class="op" id="6143668">[</span><span class="num" id="6143669">1</span><span class="op" id="6143670">]</span>&nbsp;<span class="op" id="6143672">==</span>&nbsp;<span class="string" id="6143675">&#39;*&#39;</span>&nbsp;<span class="op" id="6143679">&amp;&amp;</span>&nbsp;<span class="ident" id="6143682">p</span><span class="op" id="6143683">.</span><span class="ident" id="6143684">lineFor</span><span class="op" id="6143691">(</span><span class="ident" id="6143692">last</span><span class="op" id="6143696">.</span><span class="ident" id="6143697">Pos</span><span class="op" id="6143700">(</span><span class="op" id="6143701">)</span><span class="op" id="6143702">)</span>&nbsp;<span class="op" id="6143704">==</span>&nbsp;<span class="ident" id="6143707">next</span><span class="op" id="6143711">.</span><span class="ident" id="6143712">Line</span>&nbsp;<span class="op" id="6143717">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143723">tok</span>&nbsp;<span class="op" id="6143727">!=</span>&nbsp;<span class="ident" id="6143730">token</span><span class="op" id="6143735">.</span><span class="ident" id="6143736">COMMA</span>&nbsp;<span class="op" id="6143742">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143748">(</span><span class="ident" id="6143749">tok</span>&nbsp;<span class="op" id="6143753">!=</span>&nbsp;<span class="ident" id="6143756">token</span><span class="op" id="6143761">.</span><span class="ident" id="6143762">RPAREN</span>&nbsp;<span class="op" id="6143769">||</span>&nbsp;<span class="ident" id="6143772">p</span><span class="op" id="6143773">.</span><span class="ident" id="6143774">prevOpen</span>&nbsp;<span class="op" id="6143783">==</span>&nbsp;<span class="ident" id="6143786">token</span><span class="op" id="6143791">.</span><span class="ident" id="6143792">LPAREN</span><span class="op" id="6143798">)</span>&nbsp;<span class="op" id="6143800">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143806">(</span><span class="ident" id="6143807">tok</span>&nbsp;<span class="op" id="6143811">!=</span>&nbsp;<span class="ident" id="6143814">token</span><span class="op" id="6143819">.</span><span class="ident" id="6143820">RBRACK</span>&nbsp;<span class="op" id="6143827">||</span>&nbsp;<span class="ident" id="6143830">p</span><span class="op" id="6143831">.</span><span class="ident" id="6143832">prevOpen</span>&nbsp;<span class="op" id="6143841">==</span>&nbsp;<span class="ident" id="6143844">token</span><span class="op" id="6143849">.</span><span class="ident" id="6143850">LBRACK</span><span class="op" id="6143856">)</span>&nbsp;<span class="op" id="6143858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143863">p</span><span class="op" id="6143864">.</span><span class="ident" id="6143865">writeByte</span><span class="op" id="6143874">(</span><span class="string" id="6143875">&#39;&nbsp;&#39;</span><span class="op" id="6143878">,</span>&nbsp;<span class="num" id="6143880">1</span><span class="op" id="6143881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143885">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143889">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143954">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144018">needsLinebreak</span>&nbsp;<span class="op" id="6144033">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144039">last</span><span class="op" id="6144043">.</span><span class="ident" id="6144044">Text</span><span class="op" id="6144048">[</span><span class="num" id="6144049">1</span><span class="op" id="6144050">]</span>&nbsp;<span class="op" id="6144052">==</span>&nbsp;<span class="string" id="6144055">&#39;/&#39;</span>&nbsp;<span class="op" id="6144059">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144066">tok</span>&nbsp;<span class="op" id="6144070">==</span>&nbsp;<span class="ident" id="6144073">token</span><span class="op" id="6144078">.</span><span class="ident" id="6144079">RBRACE</span>&nbsp;<span class="op" id="6144086">&amp;&amp;</span>&nbsp;<span class="ident" id="6144089">p</span><span class="op" id="6144090">.</span><span class="ident" id="6144091">mode</span><span class="op" id="6144095">&amp;</span><span class="ident" id="6144096">noExtraLinebreak</span>&nbsp;<span class="op" id="6144113">==</span>&nbsp;<span class="num" id="6144116">0</span>&nbsp;<span class="op" id="6144118">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144125">tok</span>&nbsp;<span class="op" id="6144129">==</span>&nbsp;<span class="ident" id="6144132">token</span><span class="op" id="6144137">.</span><span class="ident" id="6144138">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144144">return</span>&nbsp;<span class="ident" id="6144151">p</span><span class="op" id="6144152">.</span><span class="ident" id="6144153">writeCommentSuffix</span><span class="op" id="6144171">(</span><span class="ident" id="6144172">needsLinebreak</span><span class="op" id="6144186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6144189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144193">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144255">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144313">p</span><span class="op" id="6144314">.</span><span class="ident" id="6144315">internalError</span><span class="op" id="6144328">(</span><span class="string" id="6144329">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="6144382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144385">return</span><br>
<span class="lineno"></span><span class="op" id="6144392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="6144395">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="6144453">func</span>&nbsp;<span class="op" id="6144458">(</span><span class="ident" id="6144459">p</span>&nbsp;<span class="op" id="6144461">*</span><span class="ident" id="6144462">printer</span><span class="op" id="6144469">)</span>&nbsp;<span class="ident" id="6144471">writeWhitespace</span><span class="op" id="6144486">(</span><span class="ident" id="6144487">n</span>&nbsp;<span class="builtintype" id="6144489">int</span><span class="op" id="6144492">)</span>&nbsp;<span class="op" id="6144494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144497">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144515">for</span>&nbsp;<span class="ident" id="6144519">i</span>&nbsp;<span class="op" id="6144521">:=</span>&nbsp;<span class="num" id="6144524">0</span><span class="op" id="6144525">;</span>&nbsp;<span class="ident" id="6144527">i</span>&nbsp;<span class="op" id="6144529">&lt;</span>&nbsp;<span class="ident" id="6144531">n</span><span class="op" id="6144532">;</span>&nbsp;<span class="ident" id="6144534">i</span><span class="op" id="6144535">++</span>&nbsp;<span class="op" id="6144538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144542">switch</span>&nbsp;<span class="ident" id="6144549">ch</span>&nbsp;<span class="op" id="6144552">:=</span>&nbsp;<span class="ident" id="6144555">p</span><span class="op" id="6144556">.</span><span class="ident" id="6144557">wsbuf</span><span class="op" id="6144562">[</span><span class="ident" id="6144563">i</span><span class="op" id="6144564">]</span><span class="op" id="6144565">;</span>&nbsp;<span class="ident" id="6144567">ch</span>&nbsp;<span class="op" id="6144570">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144574">case</span>&nbsp;<span class="ident" id="6144579">ignore</span><span class="op" id="6144585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144590">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144603">case</span>&nbsp;<span class="ident" id="6144608">indent</span><span class="op" id="6144614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144619">p</span><span class="op" id="6144620">.</span><span class="ident" id="6144621">indent</span><span class="op" id="6144627">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144632">case</span>&nbsp;<span class="ident" id="6144637">unindent</span><span class="op" id="6144645">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144650">p</span><span class="op" id="6144651">.</span><span class="ident" id="6144652">indent</span><span class="op" id="6144658">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144664">if</span>&nbsp;<span class="ident" id="6144667">p</span><span class="op" id="6144668">.</span><span class="ident" id="6144669">indent</span>&nbsp;<span class="op" id="6144676">&lt;</span>&nbsp;<span class="num" id="6144678">0</span>&nbsp;<span class="op" id="6144680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144686">p</span><span class="op" id="6144687">.</span><span class="ident" id="6144688">internalError</span><span class="op" id="6144701">(</span><span class="string" id="6144702">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="6144725">,</span>&nbsp;<span class="ident" id="6144727">p</span><span class="op" id="6144728">.</span><span class="ident" id="6144729">indent</span><span class="op" id="6144735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6144741">p</span><span class="op" id="6144742">.</span><span class="ident" id="6144743">indent</span>&nbsp;<span class="op" id="6144750">=</span>&nbsp;<span class="num" id="6144752">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6144757">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6144761">case</span>&nbsp;<span class="ident" id="6144766">newline</span><span class="op" id="6144773">,</span>&nbsp;<span class="ident" id="6144775">formfeed</span><span class="op" id="6144783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144788">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144846">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144905">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6144961">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145017">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145077">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145122">if</span>&nbsp;<span class="ident" id="6145125">i</span><span class="op" id="6145126">+</span><span class="num" id="6145127">1</span>&nbsp;<span class="op" id="6145129">&lt;</span>&nbsp;<span class="ident" id="6145131">n</span>&nbsp;<span class="op" id="6145133">&amp;&amp;</span>&nbsp;<span class="ident" id="6145136">p</span><span class="op" id="6145137">.</span><span class="ident" id="6145138">wsbuf</span><span class="op" id="6145143">[</span><span class="ident" id="6145144">i</span><span class="op" id="6145145">+</span><span class="num" id="6145146">1</span><span class="op" id="6145147">]</span>&nbsp;<span class="op" id="6145149">==</span>&nbsp;<span class="ident" id="6145152">unindent</span>&nbsp;<span class="op" id="6145161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145167">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145223">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145284">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145344">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145407">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145427">p</span><span class="op" id="6145428">.</span><span class="ident" id="6145429">wsbuf</span><span class="op" id="6145434">[</span><span class="ident" id="6145435">i</span><span class="op" id="6145436">]</span><span class="op" id="6145437">,</span>&nbsp;<span class="ident" id="6145439">p</span><span class="op" id="6145440">.</span><span class="ident" id="6145441">wsbuf</span><span class="op" id="6145446">[</span><span class="ident" id="6145447">i</span><span class="op" id="6145448">+</span><span class="num" id="6145449">1</span><span class="op" id="6145450">]</span>&nbsp;<span class="op" id="6145452">=</span>&nbsp;<span class="ident" id="6145454">unindent</span><span class="op" id="6145462">,</span>&nbsp;<span class="ident" id="6145464">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145477">i</span><span class="op" id="6145478">--</span>&nbsp;<span class="comment" id="6145481">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145500">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145517">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145531">default</span><span class="op" id="6145538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145543">p</span><span class="op" id="6145544">.</span><span class="ident" id="6145545">writeByte</span><span class="op" id="6145554">(</span><span class="builtintype" id="6145555">byte</span><span class="op" id="6145559">(</span><span class="ident" id="6145560">ch</span><span class="op" id="6145562">)</span><span class="op" id="6145563">,</span>&nbsp;<span class="num" id="6145565">1</span><span class="op" id="6145566">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6145577">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145610">l</span>&nbsp;<span class="op" id="6145612">:=</span>&nbsp;<span class="builtinfunc" id="6145615">copy</span><span class="op" id="6145619">(</span><span class="ident" id="6145620">p</span><span class="op" id="6145621">.</span><span class="ident" id="6145622">wsbuf</span><span class="op" id="6145627">,</span>&nbsp;<span class="ident" id="6145629">p</span><span class="op" id="6145630">.</span><span class="ident" id="6145631">wsbuf</span><span class="op" id="6145636">[</span><span class="ident" id="6145637">n</span><span class="op" id="6145638">:</span><span class="op" id="6145639">]</span><span class="op" id="6145640">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145643">p</span><span class="op" id="6145644">.</span><span class="ident" id="6145645">wsbuf</span>&nbsp;<span class="op" id="6145651">=</span>&nbsp;<span class="ident" id="6145653">p</span><span class="op" id="6145654">.</span><span class="ident" id="6145655">wsbuf</span><span class="op" id="6145660">[</span><span class="op" id="6145661">:</span><span class="ident" id="6145662">l</span><span class="op" id="6145663">]</span><br>
<span class="lineno"></span><span class="op" id="6145665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6145668">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6145748">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="6145771">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="6145806">func</span>&nbsp;<span class="ident" id="6145811">nlimit</span><span class="op" id="6145817">(</span><span class="ident" id="6145818">n</span>&nbsp;<span class="builtintype" id="6145820">int</span><span class="op" id="6145823">)</span>&nbsp;<span class="builtintype" id="6145825">int</span>&nbsp;<span class="op" id="6145829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145832">if</span>&nbsp;<span class="ident" id="6145835">n</span>&nbsp;<span class="op" id="6145837">&gt;</span>&nbsp;<span class="ident" id="6145839">maxNewlines</span>&nbsp;<span class="op" id="6145851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145855">n</span>&nbsp;<span class="op" id="6145857">=</span>&nbsp;<span class="ident" id="6145859">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6145872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145875">return</span>&nbsp;<span class="ident" id="6145882">n</span><br>
<span class="lineno"></span><span class="op" id="6145884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6145887">func</span>&nbsp;<span class="ident" id="6145892">mayCombine</span><span class="op" id="6145902">(</span><span class="ident" id="6145903">prev</span>&nbsp;<span class="ident" id="6145908">token</span><span class="op" id="6145913">.</span><span class="ident" id="6145914">Token</span><span class="op" id="6145919">,</span>&nbsp;<span class="ident" id="6145921">next</span>&nbsp;<span class="builtintype" id="6145926">byte</span><span class="op" id="6145930">)</span>&nbsp;<span class="op" id="6145932">(</span><span class="ident" id="6145933">b</span>&nbsp;<span class="builtintype" id="6145935">bool</span><span class="op" id="6145939">)</span>&nbsp;<span class="op" id="6145941">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145944">switch</span>&nbsp;<span class="ident" id="6145951">prev</span>&nbsp;<span class="op" id="6145956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6145959">case</span>&nbsp;<span class="ident" id="6145964">token</span><span class="op" id="6145969">.</span><span class="ident" id="6145970">INT</span><span class="op" id="6145973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6145977">b</span>&nbsp;<span class="op" id="6145979">=</span>&nbsp;<span class="ident" id="6145981">next</span>&nbsp;<span class="op" id="6145986">==</span>&nbsp;<span class="string" id="6145989">&#39;.&#39;</span>&nbsp;<span class="comment" id="6145993">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146000">case</span>&nbsp;<span class="ident" id="6146005">token</span><span class="op" id="6146010">.</span><span class="ident" id="6146011">ADD</span><span class="op" id="6146014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146018">b</span>&nbsp;<span class="op" id="6146020">=</span>&nbsp;<span class="ident" id="6146022">next</span>&nbsp;<span class="op" id="6146027">==</span>&nbsp;<span class="string" id="6146030">&#39;+&#39;</span>&nbsp;<span class="comment" id="6146034">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146041">case</span>&nbsp;<span class="ident" id="6146046">token</span><span class="op" id="6146051">.</span><span class="ident" id="6146052">SUB</span><span class="op" id="6146055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146059">b</span>&nbsp;<span class="op" id="6146061">=</span>&nbsp;<span class="ident" id="6146063">next</span>&nbsp;<span class="op" id="6146068">==</span>&nbsp;<span class="string" id="6146071">&#39;-&#39;</span>&nbsp;<span class="comment" id="6146075">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146082">case</span>&nbsp;<span class="ident" id="6146087">token</span><span class="op" id="6146092">.</span><span class="ident" id="6146093">QUO</span><span class="op" id="6146096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146100">b</span>&nbsp;<span class="op" id="6146102">=</span>&nbsp;<span class="ident" id="6146104">next</span>&nbsp;<span class="op" id="6146109">==</span>&nbsp;<span class="string" id="6146112">&#39;*&#39;</span>&nbsp;<span class="comment" id="6146116">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146123">case</span>&nbsp;<span class="ident" id="6146128">token</span><span class="op" id="6146133">.</span><span class="ident" id="6146134">LSS</span><span class="op" id="6146137">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146141">b</span>&nbsp;<span class="op" id="6146143">=</span>&nbsp;<span class="ident" id="6146145">next</span>&nbsp;<span class="op" id="6146150">==</span>&nbsp;<span class="string" id="6146153">&#39;-&#39;</span>&nbsp;<span class="op" id="6146157">||</span>&nbsp;<span class="ident" id="6146160">next</span>&nbsp;<span class="op" id="6146165">==</span>&nbsp;<span class="string" id="6146168">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="6146172">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146185">case</span>&nbsp;<span class="ident" id="6146190">token</span><span class="op" id="6146195">.</span><span class="ident" id="6146196">AND</span><span class="op" id="6146199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6146203">b</span>&nbsp;<span class="op" id="6146205">=</span>&nbsp;<span class="ident" id="6146207">next</span>&nbsp;<span class="op" id="6146212">==</span>&nbsp;<span class="string" id="6146215">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="6146219">||</span>&nbsp;<span class="ident" id="6146222">next</span>&nbsp;<span class="op" id="6146227">==</span>&nbsp;<span class="string" id="6146230">&#39;^&#39;</span>&nbsp;<span class="comment" id="6146234">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6146247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146250">return</span><br>
<span class="lineno">825</span><span class="op" id="6146257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6146260">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="6146330">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="6146400">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="6146469">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="6146519">//</span><br>
<span class="lineno"></span><span class="comment" id="6146522">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="6146593">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="6146662">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="6146732">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6146802">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6146844">//</span><br>
<span class="lineno"></span><span class="keyword" id="6146847">func</span>&nbsp;<span class="op" id="6146852">(</span><span class="ident" id="6146853">p</span>&nbsp;<span class="op" id="6146855">*</span><span class="ident" id="6146856">printer</span><span class="op" id="6146863">)</span>&nbsp;<span class="builtinfunc" id="6146865">print</span><span class="op" id="6146870">(</span><span class="ident" id="6146871">args</span>&nbsp;<span class="op" id="6146876">...</span><span class="keyword" id="6146879">interface</span><span class="op" id="6146888">{</span><span class="op" id="6146889">}</span><span class="op" id="6146890">)</span>&nbsp;<span class="op" id="6146892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146895">for</span>&nbsp;<span class="ident" id="6146899">_</span><span class="op" id="6146900">,</span>&nbsp;<span class="ident" id="6146902">arg</span>&nbsp;<span class="op" id="6146906">:=</span>&nbsp;<span class="keyword" id="6146909">range</span>&nbsp;<span class="ident" id="6146915">args</span>&nbsp;<span class="op" id="6146920">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6146924">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146963">var</span>&nbsp;<span class="ident" id="6146967">data</span>&nbsp;<span class="builtintype" id="6146972">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146981">var</span>&nbsp;<span class="ident" id="6146985">isLit</span>&nbsp;<span class="builtintype" id="6146991">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6146998">var</span>&nbsp;<span class="ident" id="6147002">impliedSemi</span>&nbsp;<span class="builtintype" id="6147014">bool</span>&nbsp;<span class="comment" id="6147019">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147064">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147107">switch</span>&nbsp;<span class="ident" id="6147114">p</span><span class="op" id="6147115">.</span><span class="ident" id="6147116">lastTok</span>&nbsp;<span class="op" id="6147124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147128">case</span>&nbsp;<span class="ident" id="6147133">token</span><span class="op" id="6147138">.</span><span class="ident" id="6147139">ILLEGAL</span><span class="op" id="6147146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147151">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147177">case</span>&nbsp;<span class="ident" id="6147182">token</span><span class="op" id="6147187">.</span><span class="ident" id="6147188">LPAREN</span><span class="op" id="6147194">,</span>&nbsp;<span class="ident" id="6147196">token</span><span class="op" id="6147201">.</span><span class="ident" id="6147202">LBRACK</span><span class="op" id="6147208">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147213">p</span><span class="op" id="6147214">.</span><span class="ident" id="6147215">prevOpen</span>&nbsp;<span class="op" id="6147224">=</span>&nbsp;<span class="ident" id="6147226">p</span><span class="op" id="6147227">.</span><span class="ident" id="6147228">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147238">default</span><span class="op" id="6147245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147250">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147296">p</span><span class="op" id="6147297">.</span><span class="ident" id="6147298">prevOpen</span>&nbsp;<span class="op" id="6147307">=</span>&nbsp;<span class="ident" id="6147309">token</span><span class="op" id="6147314">.</span><span class="ident" id="6147315">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147325">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147330">switch</span>&nbsp;<span class="ident" id="6147337">x</span>&nbsp;<span class="op" id="6147339">:=</span>&nbsp;<span class="ident" id="6147342">arg</span><span class="op" id="6147345">.</span><span class="op" id="6147346">(</span><span class="keyword" id="6147347">type</span><span class="op" id="6147351">)</span>&nbsp;<span class="op" id="6147353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147357">case</span>&nbsp;<span class="ident" id="6147362">pmode</span><span class="op" id="6147367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147372">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147398">p</span><span class="op" id="6147399">.</span><span class="ident" id="6147400">mode</span>&nbsp;<span class="op" id="6147405">^=</span>&nbsp;<span class="ident" id="6147408">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147413">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147425">case</span>&nbsp;<span class="ident" id="6147430">whiteSpace</span><span class="op" id="6147440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147445">if</span>&nbsp;<span class="ident" id="6147448">x</span>&nbsp;<span class="op" id="6147450">==</span>&nbsp;<span class="ident" id="6147453">ignore</span>&nbsp;<span class="op" id="6147460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147466">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147512">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147560">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147597">i</span>&nbsp;<span class="op" id="6147599">:=</span>&nbsp;<span class="builtinfunc" id="6147602">len</span><span class="op" id="6147605">(</span><span class="ident" id="6147606">p</span><span class="op" id="6147607">.</span><span class="ident" id="6147608">wsbuf</span><span class="op" id="6147613">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147618">if</span>&nbsp;<span class="ident" id="6147621">i</span>&nbsp;<span class="op" id="6147623">==</span>&nbsp;<span class="builtinfunc" id="6147626">cap</span><span class="op" id="6147629">(</span><span class="ident" id="6147630">p</span><span class="op" id="6147631">.</span><span class="ident" id="6147632">wsbuf</span><span class="op" id="6147637">)</span>&nbsp;<span class="op" id="6147639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147645">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147703">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147761">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147810">p</span><span class="op" id="6147811">.</span><span class="ident" id="6147812">writeWhitespace</span><span class="op" id="6147827">(</span><span class="ident" id="6147828">i</span><span class="op" id="6147829">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147835">i</span>&nbsp;<span class="op" id="6147837">=</span>&nbsp;<span class="num" id="6147839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6147844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147849">p</span><span class="op" id="6147850">.</span><span class="ident" id="6147851">wsbuf</span>&nbsp;<span class="op" id="6147857">=</span>&nbsp;<span class="ident" id="6147859">p</span><span class="op" id="6147860">.</span><span class="ident" id="6147861">wsbuf</span><span class="op" id="6147866">[</span><span class="num" id="6147867">0</span>&nbsp;<span class="op" id="6147869">:</span>&nbsp;<span class="ident" id="6147871">i</span><span class="op" id="6147872">+</span><span class="num" id="6147873">1</span><span class="op" id="6147874">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6147879">p</span><span class="op" id="6147880">.</span><span class="ident" id="6147881">wsbuf</span><span class="op" id="6147886">[</span><span class="ident" id="6147887">i</span><span class="op" id="6147888">]</span>&nbsp;<span class="op" id="6147890">=</span>&nbsp;<span class="ident" id="6147892">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6147897">if</span>&nbsp;<span class="ident" id="6147900">x</span>&nbsp;<span class="op" id="6147902">==</span>&nbsp;<span class="ident" id="6147905">newline</span>&nbsp;<span class="op" id="6147913">||</span>&nbsp;<span class="ident" id="6147916">x</span>&nbsp;<span class="op" id="6147918">==</span>&nbsp;<span class="ident" id="6147921">formfeed</span>&nbsp;<span class="op" id="6147930">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147936">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6147993">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148051">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148110">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148130">p</span><span class="op" id="6148131">.</span><span class="ident" id="6148132">impliedSemi</span>&nbsp;<span class="op" id="6148144">=</span>&nbsp;<span class="builtintype" id="6148146">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148160">p</span><span class="op" id="6148161">.</span><span class="ident" id="6148162">lastTok</span>&nbsp;<span class="op" id="6148170">=</span>&nbsp;<span class="ident" id="6148172">token</span><span class="op" id="6148177">.</span><span class="ident" id="6148178">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148189">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148201">case</span>&nbsp;<span class="op" id="6148206">*</span><span class="ident" id="6148207">ast</span><span class="op" id="6148210">.</span><span class="ident" id="6148211">Ident</span><span class="op" id="6148216">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148221">data</span>&nbsp;<span class="op" id="6148226">=</span>&nbsp;<span class="ident" id="6148228">x</span><span class="op" id="6148229">.</span><span class="ident" id="6148230">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148238">impliedSemi</span>&nbsp;<span class="op" id="6148250">=</span>&nbsp;<span class="builtintype" id="6148252">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148260">p</span><span class="op" id="6148261">.</span><span class="ident" id="6148262">lastTok</span>&nbsp;<span class="op" id="6148270">=</span>&nbsp;<span class="ident" id="6148272">token</span><span class="op" id="6148277">.</span><span class="ident" id="6148278">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148287">case</span>&nbsp;<span class="op" id="6148292">*</span><span class="ident" id="6148293">ast</span><span class="op" id="6148296">.</span><span class="ident" id="6148297">BasicLit</span><span class="op" id="6148305">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148310">data</span>&nbsp;<span class="op" id="6148315">=</span>&nbsp;<span class="ident" id="6148317">x</span><span class="op" id="6148318">.</span><span class="ident" id="6148319">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148328">isLit</span>&nbsp;<span class="op" id="6148334">=</span>&nbsp;<span class="builtintype" id="6148336">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148344">impliedSemi</span>&nbsp;<span class="op" id="6148356">=</span>&nbsp;<span class="builtintype" id="6148358">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148366">p</span><span class="op" id="6148367">.</span><span class="ident" id="6148368">lastTok</span>&nbsp;<span class="op" id="6148376">=</span>&nbsp;<span class="ident" id="6148378">x</span><span class="op" id="6148379">.</span><span class="ident" id="6148380">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148388">case</span>&nbsp;<span class="ident" id="6148393">token</span><span class="op" id="6148398">.</span><span class="ident" id="6148399">Token</span><span class="op" id="6148404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148409">s</span>&nbsp;<span class="op" id="6148411">:=</span>&nbsp;<span class="ident" id="6148414">x</span><span class="op" id="6148415">.</span><span class="ident" id="6148416">String</span><span class="op" id="6148422">(</span><span class="op" id="6148423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148428">if</span>&nbsp;<span class="ident" id="6148431">mayCombine</span><span class="op" id="6148441">(</span><span class="ident" id="6148442">p</span><span class="op" id="6148443">.</span><span class="ident" id="6148444">lastTok</span><span class="op" id="6148451">,</span>&nbsp;<span class="ident" id="6148453">s</span><span class="op" id="6148454">[</span><span class="num" id="6148455">0</span><span class="op" id="6148456">]</span><span class="op" id="6148457">)</span>&nbsp;<span class="op" id="6148459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148465">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148515">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148566">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148615">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148667">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148719">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148763">if</span>&nbsp;<span class="builtinfunc" id="6148766">len</span><span class="op" id="6148769">(</span><span class="ident" id="6148770">p</span><span class="op" id="6148771">.</span><span class="ident" id="6148772">wsbuf</span><span class="op" id="6148777">)</span>&nbsp;<span class="op" id="6148779">!=</span>&nbsp;<span class="num" id="6148782">0</span>&nbsp;<span class="op" id="6148784">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148791">p</span><span class="op" id="6148792">.</span><span class="ident" id="6148793">internalError</span><span class="op" id="6148806">(</span><span class="string" id="6148807">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="6148836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148848">p</span><span class="op" id="6148849">.</span><span class="ident" id="6148850">wsbuf</span>&nbsp;<span class="op" id="6148856">=</span>&nbsp;<span class="ident" id="6148858">p</span><span class="op" id="6148859">.</span><span class="ident" id="6148860">wsbuf</span><span class="op" id="6148865">[</span><span class="num" id="6148866">0</span><span class="op" id="6148867">:</span><span class="num" id="6148868">1</span><span class="op" id="6148869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148875">p</span><span class="op" id="6148876">.</span><span class="ident" id="6148877">wsbuf</span><span class="op" id="6148882">[</span><span class="num" id="6148883">0</span><span class="op" id="6148884">]</span>&nbsp;<span class="op" id="6148886">=</span>&nbsp;<span class="string" id="6148888">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148895">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148900">data</span>&nbsp;<span class="op" id="6148905">=</span>&nbsp;<span class="ident" id="6148907">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6148912">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148972">switch</span>&nbsp;<span class="ident" id="6148979">x</span>&nbsp;<span class="op" id="6148981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148986">case</span>&nbsp;<span class="ident" id="6148991">token</span><span class="op" id="6148996">.</span><span class="ident" id="6148997">BREAK</span><span class="op" id="6149002">,</span>&nbsp;<span class="ident" id="6149004">token</span><span class="op" id="6149009">.</span><span class="ident" id="6149010">CONTINUE</span><span class="op" id="6149018">,</span>&nbsp;<span class="ident" id="6149020">token</span><span class="op" id="6149025">.</span><span class="ident" id="6149026">FALLTHROUGH</span><span class="op" id="6149037">,</span>&nbsp;<span class="ident" id="6149039">token</span><span class="op" id="6149044">.</span><span class="ident" id="6149045">RETURN</span><span class="op" id="6149051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149057">token</span><span class="op" id="6149062">.</span><span class="ident" id="6149063">INC</span><span class="op" id="6149066">,</span>&nbsp;<span class="ident" id="6149068">token</span><span class="op" id="6149073">.</span><span class="ident" id="6149074">DEC</span><span class="op" id="6149077">,</span>&nbsp;<span class="ident" id="6149079">token</span><span class="op" id="6149084">.</span><span class="ident" id="6149085">RPAREN</span><span class="op" id="6149091">,</span>&nbsp;<span class="ident" id="6149093">token</span><span class="op" id="6149098">.</span><span class="ident" id="6149099">RBRACK</span><span class="op" id="6149105">,</span>&nbsp;<span class="ident" id="6149107">token</span><span class="op" id="6149112">.</span><span class="ident" id="6149113">RBRACE</span><span class="op" id="6149119">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149125">impliedSemi</span>&nbsp;<span class="op" id="6149137">=</span>&nbsp;<span class="builtintype" id="6149139">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149152">p</span><span class="op" id="6149153">.</span><span class="ident" id="6149154">lastTok</span>&nbsp;<span class="op" id="6149162">=</span>&nbsp;<span class="ident" id="6149164">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149169">case</span>&nbsp;<span class="ident" id="6149174">token</span><span class="op" id="6149179">.</span><span class="ident" id="6149180">Pos</span><span class="op" id="6149183">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149188">if</span>&nbsp;<span class="ident" id="6149191">x</span><span class="op" id="6149192">.</span><span class="ident" id="6149193">IsValid</span><span class="op" id="6149200">(</span><span class="op" id="6149201">)</span>&nbsp;<span class="op" id="6149203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149209">p</span><span class="op" id="6149210">.</span><span class="ident" id="6149211">pos</span>&nbsp;<span class="op" id="6149215">=</span>&nbsp;<span class="ident" id="6149217">p</span><span class="op" id="6149218">.</span><span class="ident" id="6149219">posFor</span><span class="op" id="6149225">(</span><span class="ident" id="6149226">x</span><span class="op" id="6149227">)</span>&nbsp;<span class="comment" id="6149229">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149271">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149283">case</span>&nbsp;<span class="builtintype" id="6149288">string</span><span class="op" id="6149294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149299">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149341">data</span>&nbsp;<span class="op" id="6149346">=</span>&nbsp;<span class="ident" id="6149348">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149353">isLit</span>&nbsp;<span class="op" id="6149359">=</span>&nbsp;<span class="builtintype" id="6149361">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149369">impliedSemi</span>&nbsp;<span class="op" id="6149381">=</span>&nbsp;<span class="builtintype" id="6149383">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149391">p</span><span class="op" id="6149392">.</span><span class="ident" id="6149393">lastTok</span>&nbsp;<span class="op" id="6149401">=</span>&nbsp;<span class="ident" id="6149403">token</span><span class="op" id="6149408">.</span><span class="ident" id="6149409">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149419">default</span><span class="op" id="6149426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149431">fmt</span><span class="op" id="6149434">.</span><span class="ident" id="6149435">Fprintf</span><span class="op" id="6149442">(</span><span class="ident" id="6149443">os</span><span class="op" id="6149445">.</span><span class="ident" id="6149446">Stderr</span><span class="op" id="6149452">,</span>&nbsp;<span class="string" id="6149454">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="6149493">,</span>&nbsp;<span class="ident" id="6149495">arg</span><span class="op" id="6149498">,</span>&nbsp;<span class="ident" id="6149500">arg</span><span class="op" id="6149503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6149508">panic</span><span class="op" id="6149513">(</span><span class="string" id="6149514">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="6149531">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149539">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149556">next</span>&nbsp;<span class="op" id="6149561">:=</span>&nbsp;<span class="ident" id="6149564">p</span><span class="op" id="6149565">.</span><span class="ident" id="6149566">pos</span>&nbsp;<span class="comment" id="6149570">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149616">wroteNewline</span><span class="op" id="6149628">,</span>&nbsp;<span class="ident" id="6149630">droppedFF</span>&nbsp;<span class="op" id="6149640">:=</span>&nbsp;<span class="ident" id="6149643">p</span><span class="op" id="6149644">.</span><span class="ident" id="6149645">flush</span><span class="op" id="6149650">(</span><span class="ident" id="6149651">next</span><span class="op" id="6149655">,</span>&nbsp;<span class="ident" id="6149657">p</span><span class="op" id="6149658">.</span><span class="ident" id="6149659">lastTok</span><span class="op" id="6149666">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149671">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149732">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149792">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149857">if</span>&nbsp;<span class="op" id="6149860">!</span><span class="ident" id="6149861">p</span><span class="op" id="6149862">.</span><span class="ident" id="6149863">impliedSemi</span>&nbsp;<span class="op" id="6149875">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149880">n</span>&nbsp;<span class="op" id="6149882">:=</span>&nbsp;<span class="ident" id="6149885">nlimit</span><span class="op" id="6149891">(</span><span class="ident" id="6149892">next</span><span class="op" id="6149896">.</span><span class="ident" id="6149897">Line</span>&nbsp;<span class="op" id="6149902">-</span>&nbsp;<span class="ident" id="6149904">p</span><span class="op" id="6149905">.</span><span class="ident" id="6149906">pos</span><span class="op" id="6149909">.</span><span class="ident" id="6149910">Line</span><span class="op" id="6149914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149919">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149974">if</span>&nbsp;<span class="ident" id="6149977">wroteNewline</span>&nbsp;<span class="op" id="6149990">&amp;&amp;</span>&nbsp;<span class="ident" id="6149993">n</span>&nbsp;<span class="op" id="6149995">==</span>&nbsp;<span class="ident" id="6149998">maxNewlines</span>&nbsp;<span class="op" id="6150010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150016">n</span>&nbsp;<span class="op" id="6150018">=</span>&nbsp;<span class="ident" id="6150020">maxNewlines</span>&nbsp;<span class="op" id="6150032">-</span>&nbsp;<span class="num" id="6150034">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150039">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150044">if</span>&nbsp;<span class="ident" id="6150047">n</span>&nbsp;<span class="op" id="6150049">&gt;</span>&nbsp;<span class="num" id="6150051">0</span>&nbsp;<span class="op" id="6150053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150059">ch</span>&nbsp;<span class="op" id="6150062">:=</span>&nbsp;<span class="builtintype" id="6150065">byte</span><span class="op" id="6150069">(</span><span class="string" id="6150070">&#39;\n&#39;</span><span class="op" id="6150074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150080">if</span>&nbsp;<span class="ident" id="6150083">droppedFF</span>&nbsp;<span class="op" id="6150093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150100">ch</span>&nbsp;<span class="op" id="6150103">=</span>&nbsp;<span class="string" id="6150105">&#39;\f&#39;</span>&nbsp;<span class="comment" id="6150110">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150158">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150164">p</span><span class="op" id="6150165">.</span><span class="ident" id="6150166">writeByte</span><span class="op" id="6150175">(</span><span class="ident" id="6150176">ch</span><span class="op" id="6150178">,</span>&nbsp;<span class="ident" id="6150180">n</span><span class="op" id="6150181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150187">impliedSemi</span>&nbsp;<span class="op" id="6150199">=</span>&nbsp;<span class="builtintype" id="6150201">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150219">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150288">if</span>&nbsp;<span class="ident" id="6150291">p</span><span class="op" id="6150292">.</span><span class="ident" id="6150293">linePtr</span>&nbsp;<span class="op" id="6150301">!=</span>&nbsp;<span class="ident" id="6150304">nil</span>&nbsp;<span class="op" id="6150308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150313">*</span><span class="ident" id="6150314">p</span><span class="op" id="6150315">.</span><span class="ident" id="6150316">linePtr</span>&nbsp;<span class="op" id="6150324">=</span>&nbsp;<span class="ident" id="6150326">p</span><span class="op" id="6150327">.</span><span class="ident" id="6150328">out</span><span class="op" id="6150331">.</span><span class="ident" id="6150332">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150340">p</span><span class="op" id="6150341">.</span><span class="ident" id="6150342">linePtr</span>&nbsp;<span class="op" id="6150350">=</span>&nbsp;<span class="ident" id="6150352">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150358">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150363">p</span><span class="op" id="6150364">.</span><span class="ident" id="6150365">writeString</span><span class="op" id="6150376">(</span><span class="ident" id="6150377">next</span><span class="op" id="6150381">,</span>&nbsp;<span class="ident" id="6150383">data</span><span class="op" id="6150387">,</span>&nbsp;<span class="ident" id="6150389">isLit</span><span class="op" id="6150394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150398">p</span><span class="op" id="6150399">.</span><span class="ident" id="6150400">impliedSemi</span>&nbsp;<span class="op" id="6150412">=</span>&nbsp;<span class="ident" id="6150414">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150427">}</span><br>
<span class="lineno"></span><span class="op" id="6150429">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="6150432">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="6150504">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="6150577">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6150654">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="6150665">//</span><br>
<span class="lineno"></span><span class="keyword" id="6150668">func</span>&nbsp;<span class="op" id="6150673">(</span><span class="ident" id="6150674">p</span>&nbsp;<span class="op" id="6150676">*</span><span class="ident" id="6150677">printer</span><span class="op" id="6150684">)</span>&nbsp;<span class="ident" id="6150686">flush</span><span class="op" id="6150691">(</span><span class="ident" id="6150692">next</span>&nbsp;<span class="ident" id="6150697">token</span><span class="op" id="6150702">.</span><span class="ident" id="6150703">Position</span><span class="op" id="6150711">,</span>&nbsp;<span class="ident" id="6150713">tok</span>&nbsp;<span class="ident" id="6150717">token</span><span class="op" id="6150722">.</span><span class="ident" id="6150723">Token</span><span class="op" id="6150728">)</span>&nbsp;<span class="op" id="6150730">(</span><span class="ident" id="6150731">wroteNewline</span><span class="op" id="6150743">,</span>&nbsp;<span class="ident" id="6150745">droppedFF</span>&nbsp;<span class="builtintype" id="6150755">bool</span><span class="op" id="6150759">)</span>&nbsp;<span class="op" id="6150761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150764">if</span>&nbsp;<span class="ident" id="6150767">p</span><span class="op" id="6150768">.</span><span class="ident" id="6150769">commentBefore</span><span class="op" id="6150782">(</span><span class="ident" id="6150783">next</span><span class="op" id="6150787">)</span>&nbsp;<span class="op" id="6150789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150793">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150859">wroteNewline</span><span class="op" id="6150871">,</span>&nbsp;<span class="ident" id="6150873">droppedFF</span>&nbsp;<span class="op" id="6150883">=</span>&nbsp;<span class="ident" id="6150885">p</span><span class="op" id="6150886">.</span><span class="ident" id="6150887">intersperseComments</span><span class="op" id="6150906">(</span><span class="ident" id="6150907">next</span><span class="op" id="6150911">,</span>&nbsp;<span class="ident" id="6150913">tok</span><span class="op" id="6150916">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150919">}</span>&nbsp;<span class="keyword" id="6150921">else</span>&nbsp;<span class="op" id="6150926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6150930">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150976">p</span><span class="op" id="6150977">.</span><span class="ident" id="6150978">writeWhitespace</span><span class="op" id="6150993">(</span><span class="builtinfunc" id="6150994">len</span><span class="op" id="6150997">(</span><span class="ident" id="6150998">p</span><span class="op" id="6150999">.</span><span class="ident" id="6151000">wsbuf</span><span class="op" id="6151005">)</span><span class="op" id="6151006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151012">return</span><br>
<span class="lineno">990</span><span class="op" id="6151019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151022">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="6151089">func</span>&nbsp;<span class="ident" id="6151094">getDoc</span><span class="op" id="6151100">(</span><span class="ident" id="6151101">n</span>&nbsp;<span class="ident" id="6151103">ast</span><span class="op" id="6151106">.</span><span class="ident" id="6151107">Node</span><span class="op" id="6151111">)</span>&nbsp;<span class="op" id="6151113">*</span><span class="ident" id="6151114">ast</span><span class="op" id="6151117">.</span><span class="ident" id="6151118">CommentGroup</span>&nbsp;<span class="op" id="6151131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151134">switch</span>&nbsp;<span class="ident" id="6151141">n</span>&nbsp;<span class="op" id="6151143">:=</span>&nbsp;<span class="ident" id="6151146">n</span><span class="op" id="6151147">.</span><span class="op" id="6151148">(</span><span class="keyword" id="6151149">type</span><span class="op" id="6151153">)</span>&nbsp;<span class="op" id="6151155">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151158">case</span>&nbsp;<span class="op" id="6151163">*</span><span class="ident" id="6151164">ast</span><span class="op" id="6151167">.</span><span class="ident" id="6151168">Field</span><span class="op" id="6151173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151177">return</span>&nbsp;<span class="ident" id="6151184">n</span><span class="op" id="6151185">.</span><span class="ident" id="6151186">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151191">case</span>&nbsp;<span class="op" id="6151196">*</span><span class="ident" id="6151197">ast</span><span class="op" id="6151200">.</span><span class="ident" id="6151201">ImportSpec</span><span class="op" id="6151211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151215">return</span>&nbsp;<span class="ident" id="6151222">n</span><span class="op" id="6151223">.</span><span class="ident" id="6151224">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151229">case</span>&nbsp;<span class="op" id="6151234">*</span><span class="ident" id="6151235">ast</span><span class="op" id="6151238">.</span><span class="ident" id="6151239">ValueSpec</span><span class="op" id="6151248">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151252">return</span>&nbsp;<span class="ident" id="6151259">n</span><span class="op" id="6151260">.</span><span class="ident" id="6151261">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151266">case</span>&nbsp;<span class="op" id="6151271">*</span><span class="ident" id="6151272">ast</span><span class="op" id="6151275">.</span><span class="ident" id="6151276">TypeSpec</span><span class="op" id="6151284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151288">return</span>&nbsp;<span class="ident" id="6151295">n</span><span class="op" id="6151296">.</span><span class="ident" id="6151297">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151302">case</span>&nbsp;<span class="op" id="6151307">*</span><span class="ident" id="6151308">ast</span><span class="op" id="6151311">.</span><span class="ident" id="6151312">GenDecl</span><span class="op" id="6151319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151323">return</span>&nbsp;<span class="ident" id="6151330">n</span><span class="op" id="6151331">.</span><span class="ident" id="6151332">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151337">case</span>&nbsp;<span class="op" id="6151342">*</span><span class="ident" id="6151343">ast</span><span class="op" id="6151346">.</span><span class="ident" id="6151347">FuncDecl</span><span class="op" id="6151355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151359">return</span>&nbsp;<span class="ident" id="6151366">n</span><span class="op" id="6151367">.</span><span class="ident" id="6151368">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151373">case</span>&nbsp;<span class="op" id="6151378">*</span><span class="ident" id="6151379">ast</span><span class="op" id="6151382">.</span><span class="ident" id="6151383">File</span><span class="op" id="6151387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151391">return</span>&nbsp;<span class="ident" id="6151398">n</span><span class="op" id="6151399">.</span><span class="ident" id="6151400">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151405">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151408">return</span>&nbsp;<span class="ident" id="6151415">nil</span><br>
<span class="lineno"></span><span class="op" id="6151419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6151422">func</span>&nbsp;<span class="op" id="6151427">(</span><span class="ident" id="6151428">p</span>&nbsp;<span class="op" id="6151430">*</span><span class="ident" id="6151431">printer</span><span class="op" id="6151438">)</span>&nbsp;<span class="ident" id="6151440">printNode</span><span class="op" id="6151449">(</span><span class="ident" id="6151450">node</span>&nbsp;<span class="keyword" id="6151455">interface</span><span class="op" id="6151464">{</span><span class="op" id="6151465">}</span><span class="op" id="6151466">)</span>&nbsp;<span class="builtintype" id="6151468">error</span>&nbsp;<span class="op" id="6151474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151477">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151511">var</span>&nbsp;<span class="ident" id="6151515">comments</span>&nbsp;<span class="op" id="6151524">[</span><span class="op" id="6151525">]</span><span class="op" id="6151526">*</span><span class="ident" id="6151527">ast</span><span class="op" id="6151530">.</span><span class="ident" id="6151531">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151545">if</span>&nbsp;<span class="ident" id="6151548">cnode</span><span class="op" id="6151553">,</span>&nbsp;<span class="ident" id="6151555">ok</span>&nbsp;<span class="op" id="6151558">:=</span>&nbsp;<span class="ident" id="6151561">node</span><span class="op" id="6151565">.</span><span class="op" id="6151566">(</span><span class="op" id="6151567">*</span><span class="ident" id="6151568">CommentedNode</span><span class="op" id="6151581">)</span><span class="op" id="6151582">;</span>&nbsp;<span class="ident" id="6151584">ok</span>&nbsp;<span class="op" id="6151587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151591">node</span>&nbsp;<span class="op" id="6151596">=</span>&nbsp;<span class="ident" id="6151598">cnode</span><span class="op" id="6151603">.</span><span class="ident" id="6151604">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151611">comments</span>&nbsp;<span class="op" id="6151620">=</span>&nbsp;<span class="ident" id="6151622">cnode</span><span class="op" id="6151627">.</span><span class="ident" id="6151628">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151638">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151642">if</span>&nbsp;<span class="ident" id="6151645">comments</span>&nbsp;<span class="op" id="6151654">!=</span>&nbsp;<span class="ident" id="6151657">nil</span>&nbsp;<span class="op" id="6151661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151665">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151727">n</span><span class="op" id="6151728">,</span>&nbsp;<span class="ident" id="6151730">ok</span>&nbsp;<span class="op" id="6151733">:=</span>&nbsp;<span class="ident" id="6151736">node</span><span class="op" id="6151740">.</span><span class="op" id="6151741">(</span><span class="ident" id="6151742">ast</span><span class="op" id="6151745">.</span><span class="ident" id="6151746">Node</span><span class="op" id="6151750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151754">if</span>&nbsp;<span class="op" id="6151757">!</span><span class="ident" id="6151758">ok</span>&nbsp;<span class="op" id="6151761">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151766">goto</span>&nbsp;<span class="ident" id="6151771">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151789">beg</span>&nbsp;<span class="op" id="6151793">:=</span>&nbsp;<span class="ident" id="6151796">n</span><span class="op" id="6151797">.</span><span class="ident" id="6151798">Pos</span><span class="op" id="6151801">(</span><span class="op" id="6151802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151806">end</span>&nbsp;<span class="op" id="6151810">:=</span>&nbsp;<span class="ident" id="6151813">n</span><span class="op" id="6151814">.</span><span class="ident" id="6151815">End</span><span class="op" id="6151818">(</span><span class="op" id="6151819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151823">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151870">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151914">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151960">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152011">if</span>&nbsp;<span class="ident" id="6152014">doc</span>&nbsp;<span class="op" id="6152018">:=</span>&nbsp;<span class="ident" id="6152021">getDoc</span><span class="op" id="6152027">(</span><span class="ident" id="6152028">n</span><span class="op" id="6152029">)</span><span class="op" id="6152030">;</span>&nbsp;<span class="ident" id="6152032">doc</span>&nbsp;<span class="op" id="6152036">!=</span>&nbsp;<span class="ident" id="6152039">nil</span>&nbsp;<span class="op" id="6152043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152048">beg</span>&nbsp;<span class="op" id="6152052">=</span>&nbsp;<span class="ident" id="6152054">doc</span><span class="op" id="6152057">.</span><span class="ident" id="6152058">Pos</span><span class="op" id="6152061">(</span><span class="op" id="6152062">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152070">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152119">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152146">i</span>&nbsp;<span class="op" id="6152148">:=</span>&nbsp;<span class="num" id="6152151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152155">for</span>&nbsp;<span class="ident" id="6152159">i</span>&nbsp;<span class="op" id="6152161">&lt;</span>&nbsp;<span class="builtinfunc" id="6152163">len</span><span class="op" id="6152166">(</span><span class="ident" id="6152167">comments</span><span class="op" id="6152175">)</span>&nbsp;<span class="op" id="6152177">&amp;&amp;</span>&nbsp;<span class="ident" id="6152180">comments</span><span class="op" id="6152188">[</span><span class="ident" id="6152189">i</span><span class="op" id="6152190">]</span><span class="op" id="6152191">.</span><span class="ident" id="6152192">End</span><span class="op" id="6152195">(</span><span class="op" id="6152196">)</span>&nbsp;<span class="op" id="6152198">&lt;</span>&nbsp;<span class="ident" id="6152200">beg</span>&nbsp;<span class="op" id="6152204">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152209">i</span><span class="op" id="6152210">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152219">j</span>&nbsp;<span class="op" id="6152221">:=</span>&nbsp;<span class="ident" id="6152224">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152228">for</span>&nbsp;<span class="ident" id="6152232">j</span>&nbsp;<span class="op" id="6152234">&lt;</span>&nbsp;<span class="builtinfunc" id="6152236">len</span><span class="op" id="6152239">(</span><span class="ident" id="6152240">comments</span><span class="op" id="6152248">)</span>&nbsp;<span class="op" id="6152250">&amp;&amp;</span>&nbsp;<span class="ident" id="6152253">comments</span><span class="op" id="6152261">[</span><span class="ident" id="6152262">j</span><span class="op" id="6152263">]</span><span class="op" id="6152264">.</span><span class="ident" id="6152265">Pos</span><span class="op" id="6152268">(</span><span class="op" id="6152269">)</span>&nbsp;<span class="op" id="6152271">&lt;</span>&nbsp;<span class="ident" id="6152273">end</span>&nbsp;<span class="op" id="6152277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152282">j</span><span class="op" id="6152283">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152292">if</span>&nbsp;<span class="ident" id="6152295">i</span>&nbsp;<span class="op" id="6152297">&lt;</span>&nbsp;<span class="ident" id="6152299">j</span>&nbsp;<span class="op" id="6152301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152306">p</span><span class="op" id="6152307">.</span><span class="ident" id="6152308">comments</span>&nbsp;<span class="op" id="6152317">=</span>&nbsp;<span class="ident" id="6152319">comments</span><span class="op" id="6152327">[</span><span class="ident" id="6152328">i</span><span class="op" id="6152329">:</span><span class="ident" id="6152330">j</span><span class="op" id="6152331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152338">}</span>&nbsp;<span class="keyword" id="6152340">else</span>&nbsp;<span class="keyword" id="6152345">if</span>&nbsp;<span class="ident" id="6152348">n</span><span class="op" id="6152349">,</span>&nbsp;<span class="ident" id="6152351">ok</span>&nbsp;<span class="op" id="6152354">:=</span>&nbsp;<span class="ident" id="6152357">node</span><span class="op" id="6152361">.</span><span class="op" id="6152362">(</span><span class="op" id="6152363">*</span><span class="ident" id="6152364">ast</span><span class="op" id="6152367">.</span><span class="ident" id="6152368">File</span><span class="op" id="6152372">)</span><span class="op" id="6152373">;</span>&nbsp;<span class="ident" id="6152375">ok</span>&nbsp;<span class="op" id="6152378">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152382">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152417">p</span><span class="op" id="6152418">.</span><span class="ident" id="6152419">comments</span>&nbsp;<span class="op" id="6152428">=</span>&nbsp;<span class="ident" id="6152430">n</span><span class="op" id="6152431">.</span><span class="ident" id="6152432">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152446">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152494">p</span><span class="op" id="6152495">.</span><span class="ident" id="6152496">useNodeComments</span>&nbsp;<span class="op" id="6152512">=</span>&nbsp;<span class="ident" id="6152514">p</span><span class="op" id="6152515">.</span><span class="ident" id="6152516">comments</span>&nbsp;<span class="op" id="6152525">==</span>&nbsp;<span class="ident" id="6152528">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152534">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152565">p</span><span class="op" id="6152566">.</span><span class="ident" id="6152567">nextComment</span><span class="op" id="6152578">(</span><span class="op" id="6152579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152583">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152599">switch</span>&nbsp;<span class="ident" id="6152606">n</span>&nbsp;<span class="op" id="6152608">:=</span>&nbsp;<span class="ident" id="6152611">node</span><span class="op" id="6152615">.</span><span class="op" id="6152616">(</span><span class="keyword" id="6152617">type</span><span class="op" id="6152621">)</span>&nbsp;<span class="op" id="6152623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152626">case</span>&nbsp;<span class="ident" id="6152631">ast</span><span class="op" id="6152634">.</span><span class="ident" id="6152635">Expr</span><span class="op" id="6152639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152643">p</span><span class="op" id="6152644">.</span><span class="ident" id="6152645">expr</span><span class="op" id="6152649">(</span><span class="ident" id="6152650">n</span><span class="op" id="6152651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152654">case</span>&nbsp;<span class="ident" id="6152659">ast</span><span class="op" id="6152662">.</span><span class="ident" id="6152663">Stmt</span><span class="op" id="6152667">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152671">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152734">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152793">if</span>&nbsp;<span class="ident" id="6152796">_</span><span class="op" id="6152797">,</span>&nbsp;<span class="ident" id="6152799">ok</span>&nbsp;<span class="op" id="6152802">:=</span>&nbsp;<span class="ident" id="6152805">n</span><span class="op" id="6152806">.</span><span class="op" id="6152807">(</span><span class="op" id="6152808">*</span><span class="ident" id="6152809">ast</span><span class="op" id="6152812">.</span><span class="ident" id="6152813">LabeledStmt</span><span class="op" id="6152824">)</span><span class="op" id="6152825">;</span>&nbsp;<span class="ident" id="6152827">ok</span>&nbsp;<span class="op" id="6152830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152835">p</span><span class="op" id="6152836">.</span><span class="ident" id="6152837">indent</span>&nbsp;<span class="op" id="6152844">=</span>&nbsp;<span class="num" id="6152846">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152850">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152854">p</span><span class="op" id="6152855">.</span><span class="ident" id="6152856">stmt</span><span class="op" id="6152860">(</span><span class="ident" id="6152861">n</span><span class="op" id="6152862">,</span>&nbsp;<span class="builtintype" id="6152864">false</span><span class="op" id="6152869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152872">case</span>&nbsp;<span class="ident" id="6152877">ast</span><span class="op" id="6152880">.</span><span class="ident" id="6152881">Decl</span><span class="op" id="6152885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152889">p</span><span class="op" id="6152890">.</span><span class="ident" id="6152891">decl</span><span class="op" id="6152895">(</span><span class="ident" id="6152896">n</span><span class="op" id="6152897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152900">case</span>&nbsp;<span class="ident" id="6152905">ast</span><span class="op" id="6152908">.</span><span class="ident" id="6152909">Spec</span><span class="op" id="6152913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152917">p</span><span class="op" id="6152918">.</span><span class="ident" id="6152919">spec</span><span class="op" id="6152923">(</span><span class="ident" id="6152924">n</span><span class="op" id="6152925">,</span>&nbsp;<span class="num" id="6152927">1</span><span class="op" id="6152928">,</span>&nbsp;<span class="builtintype" id="6152930">false</span><span class="op" id="6152935">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152938">case</span>&nbsp;<span class="op" id="6152943">[</span><span class="op" id="6152944">]</span><span class="ident" id="6152945">ast</span><span class="op" id="6152948">.</span><span class="ident" id="6152949">Stmt</span><span class="op" id="6152953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152957">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153020">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153079">for</span>&nbsp;<span class="ident" id="6153083">_</span><span class="op" id="6153084">,</span>&nbsp;<span class="ident" id="6153086">s</span>&nbsp;<span class="op" id="6153088">:=</span>&nbsp;<span class="keyword" id="6153091">range</span>&nbsp;<span class="ident" id="6153097">n</span>&nbsp;<span class="op" id="6153099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153104">if</span>&nbsp;<span class="ident" id="6153107">_</span><span class="op" id="6153108">,</span>&nbsp;<span class="ident" id="6153110">ok</span>&nbsp;<span class="op" id="6153113">:=</span>&nbsp;<span class="ident" id="6153116">s</span><span class="op" id="6153117">.</span><span class="op" id="6153118">(</span><span class="op" id="6153119">*</span><span class="ident" id="6153120">ast</span><span class="op" id="6153123">.</span><span class="ident" id="6153124">LabeledStmt</span><span class="op" id="6153135">)</span><span class="op" id="6153136">;</span>&nbsp;<span class="ident" id="6153138">ok</span>&nbsp;<span class="op" id="6153141">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153147">p</span><span class="op" id="6153148">.</span><span class="ident" id="6153149">indent</span>&nbsp;<span class="op" id="6153156">=</span>&nbsp;<span class="num" id="6153158">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153171">p</span><span class="op" id="6153172">.</span><span class="ident" id="6153173">stmtList</span><span class="op" id="6153181">(</span><span class="ident" id="6153182">n</span><span class="op" id="6153183">,</span>&nbsp;<span class="num" id="6153185">0</span><span class="op" id="6153186">,</span>&nbsp;<span class="builtintype" id="6153188">false</span><span class="op" id="6153193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153196">case</span>&nbsp;<span class="op" id="6153201">[</span><span class="op" id="6153202">]</span><span class="ident" id="6153203">ast</span><span class="op" id="6153206">.</span><span class="ident" id="6153207">Decl</span><span class="op" id="6153211">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153215">p</span><span class="op" id="6153216">.</span><span class="ident" id="6153217">declList</span><span class="op" id="6153225">(</span><span class="ident" id="6153226">n</span><span class="op" id="6153227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153230">case</span>&nbsp;<span class="op" id="6153235">*</span><span class="ident" id="6153236">ast</span><span class="op" id="6153239">.</span><span class="ident" id="6153240">File</span><span class="op" id="6153244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153248">p</span><span class="op" id="6153249">.</span><span class="ident" id="6153250">file</span><span class="op" id="6153254">(</span><span class="ident" id="6153255">n</span><span class="op" id="6153256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153259">default</span><span class="op" id="6153266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153270">goto</span>&nbsp;<span class="ident" id="6153275">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153292">return</span>&nbsp;<span class="ident" id="6153299">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="6153304">unsupported</span><span class="op" id="6153315">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153318">return</span>&nbsp;<span class="ident" id="6153325">fmt</span><span class="op" id="6153328">.</span><span class="ident" id="6153329">Errorf</span><span class="op" id="6153335">(</span><span class="string" id="6153336">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="6153374">,</span>&nbsp;<span class="ident" id="6153376">node</span><span class="op" id="6153380">)</span><br>
<span class="lineno"></span><span class="op" id="6153382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6153385">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6153465">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="6153477">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="6153544">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="6153613">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="6153682">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="6153751">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="6153773">//</span><br>
<span class="lineno"></span><span class="keyword" id="6153776">type</span>&nbsp;<span class="ident" id="6153781">trimmer</span>&nbsp;<span class="keyword" id="6153789">struct</span>&nbsp;<span class="op" id="6153796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153799">output</span>&nbsp;<span class="ident" id="6153806">io</span><span class="op" id="6153808">.</span><span class="ident" id="6153809">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153817">state</span>&nbsp;&nbsp;<span class="builtintype" id="6153824">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153829">space</span>&nbsp;&nbsp;<span class="op" id="6153836">[</span><span class="op" id="6153837">]</span><span class="builtintype" id="6153838">byte</span><br>
<span class="lineno"></span><span class="op" id="6153843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6153846">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="6153892">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="6153937">const</span>&nbsp;<span class="op" id="6153943">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153946">inSpace</span>&nbsp;&nbsp;<span class="op" id="6153955">=</span>&nbsp;<span class="ident" id="6153957">iota</span>&nbsp;<span class="comment" id="6153962">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153979">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6153995">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154042">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6154058">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="6154073">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="6154076">func</span>&nbsp;<span class="op" id="6154081">(</span><span class="ident" id="6154082">p</span>&nbsp;<span class="op" id="6154084">*</span><span class="ident" id="6154085">trimmer</span><span class="op" id="6154092">)</span>&nbsp;<span class="ident" id="6154094">resetSpace</span><span class="op" id="6154104">(</span><span class="op" id="6154105">)</span>&nbsp;<span class="op" id="6154107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154110">p</span><span class="op" id="6154111">.</span><span class="ident" id="6154112">state</span>&nbsp;<span class="op" id="6154118">=</span>&nbsp;<span class="ident" id="6154120">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154129">p</span><span class="op" id="6154130">.</span><span class="ident" id="6154131">space</span>&nbsp;<span class="op" id="6154137">=</span>&nbsp;<span class="ident" id="6154139">p</span><span class="op" id="6154140">.</span><span class="ident" id="6154141">space</span><span class="op" id="6154146">[</span><span class="num" id="6154147">0</span><span class="op" id="6154148">:</span><span class="num" id="6154149">0</span><span class="op" id="6154150">]</span><br>
<span class="lineno"></span><span class="op" id="6154152">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="6154155">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6154225">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="6154295">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6154363">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="6154430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6154462">var</span>&nbsp;<span class="ident" id="6154466">aNewline</span>&nbsp;<span class="op" id="6154475">=</span>&nbsp;<span class="op" id="6154477">[</span><span class="op" id="6154478">]</span><span class="builtintype" id="6154479">byte</span><span class="op" id="6154483">(</span><span class="string" id="6154484">&#34;\n&#34;</span><span class="op" id="6154488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6154491">func</span>&nbsp;<span class="op" id="6154496">(</span><span class="ident" id="6154497">p</span>&nbsp;<span class="op" id="6154499">*</span><span class="ident" id="6154500">trimmer</span><span class="op" id="6154507">)</span>&nbsp;<span class="ident" id="6154509">Write</span><span class="op" id="6154514">(</span><span class="ident" id="6154515">data</span>&nbsp;<span class="op" id="6154520">[</span><span class="op" id="6154521">]</span><span class="builtintype" id="6154522">byte</span><span class="op" id="6154526">)</span>&nbsp;<span class="op" id="6154528">(</span><span class="ident" id="6154529">n</span>&nbsp;<span class="builtintype" id="6154531">int</span><span class="op" id="6154534">,</span>&nbsp;<span class="ident" id="6154536">err</span>&nbsp;<span class="builtintype" id="6154540">error</span><span class="op" id="6154545">)</span>&nbsp;<span class="op" id="6154547">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154550">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154566">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154590">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154615">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154648">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154675">m</span>&nbsp;<span class="op" id="6154677">:=</span>&nbsp;<span class="num" id="6154680">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154683">var</span>&nbsp;<span class="ident" id="6154687">b</span>&nbsp;<span class="builtintype" id="6154689">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154695">for</span>&nbsp;<span class="ident" id="6154699">n</span><span class="op" id="6154700">,</span>&nbsp;<span class="ident" id="6154702">b</span>&nbsp;<span class="op" id="6154704">=</span>&nbsp;<span class="keyword" id="6154706">range</span>&nbsp;<span class="ident" id="6154712">data</span>&nbsp;<span class="op" id="6154717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154721">if</span>&nbsp;<span class="ident" id="6154724">b</span>&nbsp;<span class="op" id="6154726">==</span>&nbsp;<span class="string" id="6154729">&#39;\v&#39;</span>&nbsp;<span class="op" id="6154734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154739">b</span>&nbsp;<span class="op" id="6154741">=</span>&nbsp;<span class="string" id="6154743">&#39;\t&#39;</span>&nbsp;<span class="comment" id="6154748">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154773">switch</span>&nbsp;<span class="ident" id="6154780">p</span><span class="op" id="6154781">.</span><span class="ident" id="6154782">state</span>&nbsp;<span class="op" id="6154788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154792">case</span>&nbsp;<span class="ident" id="6154797">inSpace</span><span class="op" id="6154804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154809">switch</span>&nbsp;<span class="ident" id="6154816">b</span>&nbsp;<span class="op" id="6154818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154823">case</span>&nbsp;<span class="string" id="6154828">&#39;\t&#39;</span><span class="op" id="6154832">,</span>&nbsp;<span class="string" id="6154834">&#39;&nbsp;&#39;</span><span class="op" id="6154837">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154843">p</span><span class="op" id="6154844">.</span><span class="ident" id="6154845">space</span>&nbsp;<span class="op" id="6154851">=</span>&nbsp;<span class="builtinfunc" id="6154853">append</span><span class="op" id="6154859">(</span><span class="ident" id="6154860">p</span><span class="op" id="6154861">.</span><span class="ident" id="6154862">space</span><span class="op" id="6154867">,</span>&nbsp;<span class="ident" id="6154869">b</span><span class="op" id="6154870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154875">case</span>&nbsp;<span class="string" id="6154880">&#39;\n&#39;</span><span class="op" id="6154884">,</span>&nbsp;<span class="string" id="6154886">&#39;\f&#39;</span><span class="op" id="6154890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154896">p</span><span class="op" id="6154897">.</span><span class="ident" id="6154898">resetSpace</span><span class="op" id="6154908">(</span><span class="op" id="6154909">)</span>&nbsp;<span class="comment" id="6154911">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154941">_</span><span class="op" id="6154942">,</span>&nbsp;<span class="ident" id="6154944">err</span>&nbsp;<span class="op" id="6154948">=</span>&nbsp;<span class="ident" id="6154950">p</span><span class="op" id="6154951">.</span><span class="ident" id="6154952">output</span><span class="op" id="6154958">.</span><span class="ident" id="6154959">Write</span><span class="op" id="6154964">(</span><span class="ident" id="6154965">aNewline</span><span class="op" id="6154973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154978">case</span>&nbsp;<span class="ident" id="6154983">tabwriter</span><span class="op" id="6154992">.</span><span class="ident" id="6154993">Escape</span><span class="op" id="6154999">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155005">_</span><span class="op" id="6155006">,</span>&nbsp;<span class="ident" id="6155008">err</span>&nbsp;<span class="op" id="6155012">=</span>&nbsp;<span class="ident" id="6155014">p</span><span class="op" id="6155015">.</span><span class="ident" id="6155016">output</span><span class="op" id="6155022">.</span><span class="ident" id="6155023">Write</span><span class="op" id="6155028">(</span><span class="ident" id="6155029">p</span><span class="op" id="6155030">.</span><span class="ident" id="6155031">space</span><span class="op" id="6155036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155042">p</span><span class="op" id="6155043">.</span><span class="ident" id="6155044">state</span>&nbsp;<span class="op" id="6155050">=</span>&nbsp;<span class="ident" id="6155052">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155065">m</span>&nbsp;<span class="op" id="6155067">=</span>&nbsp;<span class="ident" id="6155069">n</span>&nbsp;<span class="op" id="6155071">+</span>&nbsp;<span class="num" id="6155073">1</span>&nbsp;<span class="comment" id="6155075">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155107">default</span><span class="op" id="6155114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155120">_</span><span class="op" id="6155121">,</span>&nbsp;<span class="ident" id="6155123">err</span>&nbsp;<span class="op" id="6155127">=</span>&nbsp;<span class="ident" id="6155129">p</span><span class="op" id="6155130">.</span><span class="ident" id="6155131">output</span><span class="op" id="6155137">.</span><span class="ident" id="6155138">Write</span><span class="op" id="6155143">(</span><span class="ident" id="6155144">p</span><span class="op" id="6155145">.</span><span class="ident" id="6155146">space</span><span class="op" id="6155151">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155157">p</span><span class="op" id="6155158">.</span><span class="ident" id="6155159">state</span>&nbsp;<span class="op" id="6155165">=</span>&nbsp;<span class="ident" id="6155167">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155178">m</span>&nbsp;<span class="op" id="6155180">=</span>&nbsp;<span class="ident" id="6155182">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155191">case</span>&nbsp;<span class="ident" id="6155196">inEscape</span><span class="op" id="6155204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155209">if</span>&nbsp;<span class="ident" id="6155212">b</span>&nbsp;<span class="op" id="6155214">==</span>&nbsp;<span class="ident" id="6155217">tabwriter</span><span class="op" id="6155226">.</span><span class="ident" id="6155227">Escape</span>&nbsp;<span class="op" id="6155234">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155240">_</span><span class="op" id="6155241">,</span>&nbsp;<span class="ident" id="6155243">err</span>&nbsp;<span class="op" id="6155247">=</span>&nbsp;<span class="ident" id="6155249">p</span><span class="op" id="6155250">.</span><span class="ident" id="6155251">output</span><span class="op" id="6155257">.</span><span class="ident" id="6155258">Write</span><span class="op" id="6155263">(</span><span class="ident" id="6155264">data</span><span class="op" id="6155268">[</span><span class="ident" id="6155269">m</span><span class="op" id="6155270">:</span><span class="ident" id="6155271">n</span><span class="op" id="6155272">]</span><span class="op" id="6155273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155279">p</span><span class="op" id="6155280">.</span><span class="ident" id="6155281">resetSpace</span><span class="op" id="6155291">(</span><span class="op" id="6155292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155301">case</span>&nbsp;<span class="ident" id="6155306">inText</span><span class="op" id="6155312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155317">switch</span>&nbsp;<span class="ident" id="6155324">b</span>&nbsp;<span class="op" id="6155326">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155331">case</span>&nbsp;<span class="string" id="6155336">&#39;\t&#39;</span><span class="op" id="6155340">,</span>&nbsp;<span class="string" id="6155342">&#39;&nbsp;&#39;</span><span class="op" id="6155345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155351">_</span><span class="op" id="6155352">,</span>&nbsp;<span class="ident" id="6155354">err</span>&nbsp;<span class="op" id="6155358">=</span>&nbsp;<span class="ident" id="6155360">p</span><span class="op" id="6155361">.</span><span class="ident" id="6155362">output</span><span class="op" id="6155368">.</span><span class="ident" id="6155369">Write</span><span class="op" id="6155374">(</span><span class="ident" id="6155375">data</span><span class="op" id="6155379">[</span><span class="ident" id="6155380">m</span><span class="op" id="6155381">:</span><span class="ident" id="6155382">n</span><span class="op" id="6155383">]</span><span class="op" id="6155384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155390">p</span><span class="op" id="6155391">.</span><span class="ident" id="6155392">resetSpace</span><span class="op" id="6155402">(</span><span class="op" id="6155403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155409">p</span><span class="op" id="6155410">.</span><span class="ident" id="6155411">space</span>&nbsp;<span class="op" id="6155417">=</span>&nbsp;<span class="builtinfunc" id="6155419">append</span><span class="op" id="6155425">(</span><span class="ident" id="6155426">p</span><span class="op" id="6155427">.</span><span class="ident" id="6155428">space</span><span class="op" id="6155433">,</span>&nbsp;<span class="ident" id="6155435">b</span><span class="op" id="6155436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155441">case</span>&nbsp;<span class="string" id="6155446">&#39;\n&#39;</span><span class="op" id="6155450">,</span>&nbsp;<span class="string" id="6155452">&#39;\f&#39;</span><span class="op" id="6155456">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155462">_</span><span class="op" id="6155463">,</span>&nbsp;<span class="ident" id="6155465">err</span>&nbsp;<span class="op" id="6155469">=</span>&nbsp;<span class="ident" id="6155471">p</span><span class="op" id="6155472">.</span><span class="ident" id="6155473">output</span><span class="op" id="6155479">.</span><span class="ident" id="6155480">Write</span><span class="op" id="6155485">(</span><span class="ident" id="6155486">data</span><span class="op" id="6155490">[</span><span class="ident" id="6155491">m</span><span class="op" id="6155492">:</span><span class="ident" id="6155493">n</span><span class="op" id="6155494">]</span><span class="op" id="6155495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155501">p</span><span class="op" id="6155502">.</span><span class="ident" id="6155503">resetSpace</span><span class="op" id="6155513">(</span><span class="op" id="6155514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155520">_</span><span class="op" id="6155521">,</span>&nbsp;<span class="ident" id="6155523">err</span>&nbsp;<span class="op" id="6155527">=</span>&nbsp;<span class="ident" id="6155529">p</span><span class="op" id="6155530">.</span><span class="ident" id="6155531">output</span><span class="op" id="6155537">.</span><span class="ident" id="6155538">Write</span><span class="op" id="6155543">(</span><span class="ident" id="6155544">aNewline</span><span class="op" id="6155552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155557">case</span>&nbsp;<span class="ident" id="6155562">tabwriter</span><span class="op" id="6155571">.</span><span class="ident" id="6155572">Escape</span><span class="op" id="6155578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155584">_</span><span class="op" id="6155585">,</span>&nbsp;<span class="ident" id="6155587">err</span>&nbsp;<span class="op" id="6155591">=</span>&nbsp;<span class="ident" id="6155593">p</span><span class="op" id="6155594">.</span><span class="ident" id="6155595">output</span><span class="op" id="6155601">.</span><span class="ident" id="6155602">Write</span><span class="op" id="6155607">(</span><span class="ident" id="6155608">data</span><span class="op" id="6155612">[</span><span class="ident" id="6155613">m</span><span class="op" id="6155614">:</span><span class="ident" id="6155615">n</span><span class="op" id="6155616">]</span><span class="op" id="6155617">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155623">p</span><span class="op" id="6155624">.</span><span class="ident" id="6155625">state</span>&nbsp;<span class="op" id="6155631">=</span>&nbsp;<span class="ident" id="6155633">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155646">m</span>&nbsp;<span class="op" id="6155648">=</span>&nbsp;<span class="ident" id="6155650">n</span>&nbsp;<span class="op" id="6155652">+</span>&nbsp;<span class="num" id="6155654">1</span>&nbsp;<span class="comment" id="6155656">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155692">default</span><span class="op" id="6155699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6155704">panic</span><span class="op" id="6155709">(</span><span class="string" id="6155710">&#34;unreachable&#34;</span><span class="op" id="6155723">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155731">if</span>&nbsp;<span class="ident" id="6155734">err</span>&nbsp;<span class="op" id="6155738">!=</span>&nbsp;<span class="ident" id="6155741">nil</span>&nbsp;<span class="op" id="6155745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155750">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155762">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155765">n</span>&nbsp;<span class="op" id="6155767">=</span>&nbsp;<span class="builtinfunc" id="6155769">len</span><span class="op" id="6155772">(</span><span class="ident" id="6155773">data</span><span class="op" id="6155777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155781">switch</span>&nbsp;<span class="ident" id="6155788">p</span><span class="op" id="6155789">.</span><span class="ident" id="6155790">state</span>&nbsp;<span class="op" id="6155796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155799">case</span>&nbsp;<span class="ident" id="6155804">inEscape</span><span class="op" id="6155812">,</span>&nbsp;<span class="ident" id="6155814">inText</span><span class="op" id="6155820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155824">_</span><span class="op" id="6155825">,</span>&nbsp;<span class="ident" id="6155827">err</span>&nbsp;<span class="op" id="6155831">=</span>&nbsp;<span class="ident" id="6155833">p</span><span class="op" id="6155834">.</span><span class="ident" id="6155835">output</span><span class="op" id="6155841">.</span><span class="ident" id="6155842">Write</span><span class="op" id="6155847">(</span><span class="ident" id="6155848">data</span><span class="op" id="6155852">[</span><span class="ident" id="6155853">m</span><span class="op" id="6155854">:</span><span class="ident" id="6155855">n</span><span class="op" id="6155856">]</span><span class="op" id="6155857">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155861">p</span><span class="op" id="6155862">.</span><span class="ident" id="6155863">resetSpace</span><span class="op" id="6155873">(</span><span class="op" id="6155874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155881">return</span><br>
<span class="lineno"></span><span class="op" id="6155888">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="6155891">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6155971">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6155992">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="6156057">type</span>&nbsp;<span class="ident" id="6156062">Mode</span>&nbsp;<span class="builtintype" id="6156067">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6156073">const</span>&nbsp;<span class="op" id="6156079">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156082">RawFormat</span>&nbsp;<span class="ident" id="6156092">Mode</span>&nbsp;<span class="op" id="6156097">=</span>&nbsp;<span class="num" id="6156099">1</span>&nbsp;<span class="op" id="6156101">&lt;&lt;</span>&nbsp;<span class="ident" id="6156104">iota</span>&nbsp;<span class="comment" id="6156109">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156166">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6156193">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156247">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6156274">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156319">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6156346">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="6156408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6156411">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="6156459">type</span>&nbsp;<span class="ident" id="6156464">Config</span>&nbsp;<span class="keyword" id="6156471">struct</span>&nbsp;<span class="op" id="6156478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156481">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156490">Mode</span>&nbsp;<span class="comment" id="6156495">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156510">Tabwidth</span>&nbsp;<span class="builtintype" id="6156519">int</span>&nbsp;&nbsp;<span class="comment" id="6156524">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156539">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6156548">int</span>&nbsp;&nbsp;<span class="comment" id="6156553">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="6156612">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="6156615">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="6156704">func</span>&nbsp;<span class="op" id="6156709">(</span><span class="ident" id="6156710">cfg</span>&nbsp;<span class="op" id="6156714">*</span><span class="ident" id="6156715">Config</span><span class="op" id="6156721">)</span>&nbsp;<span class="ident" id="6156723">fprint</span><span class="op" id="6156729">(</span><span class="ident" id="6156730">output</span>&nbsp;<span class="ident" id="6156737">io</span><span class="op" id="6156739">.</span><span class="ident" id="6156740">Writer</span><span class="op" id="6156746">,</span>&nbsp;<span class="ident" id="6156748">fset</span>&nbsp;<span class="op" id="6156753">*</span><span class="ident" id="6156754">token</span><span class="op" id="6156759">.</span><span class="ident" id="6156760">FileSet</span><span class="op" id="6156767">,</span>&nbsp;<span class="ident" id="6156769">node</span>&nbsp;<span class="keyword" id="6156774">interface</span><span class="op" id="6156783">{</span><span class="op" id="6156784">}</span><span class="op" id="6156785">,</span>&nbsp;<span class="ident" id="6156787">nodeSizes</span>&nbsp;<span class="keyword" id="6156797">map</span><span class="op" id="6156800">[</span><span class="ident" id="6156801">ast</span><span class="op" id="6156804">.</span><span class="ident" id="6156805">Node</span><span class="op" id="6156809">]</span><span class="builtintype" id="6156810">int</span><span class="op" id="6156813">)</span>&nbsp;<span class="op" id="6156815">(</span><span class="ident" id="6156816">err</span>&nbsp;<span class="builtintype" id="6156820">error</span><span class="op" id="6156825">)</span>&nbsp;<span class="op" id="6156827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156830">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156845">var</span>&nbsp;<span class="ident" id="6156849">p</span>&nbsp;<span class="ident" id="6156851">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156860">p</span><span class="op" id="6156861">.</span><span class="ident" id="6156862">init</span><span class="op" id="6156866">(</span><span class="ident" id="6156867">cfg</span><span class="op" id="6156870">,</span>&nbsp;<span class="ident" id="6156872">fset</span><span class="op" id="6156876">,</span>&nbsp;<span class="ident" id="6156878">nodeSizes</span><span class="op" id="6156887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156890">if</span>&nbsp;<span class="ident" id="6156893">err</span>&nbsp;<span class="op" id="6156897">=</span>&nbsp;<span class="ident" id="6156899">p</span><span class="op" id="6156900">.</span><span class="ident" id="6156901">printNode</span><span class="op" id="6156910">(</span><span class="ident" id="6156911">node</span><span class="op" id="6156915">)</span><span class="op" id="6156916">;</span>&nbsp;<span class="ident" id="6156918">err</span>&nbsp;<span class="op" id="6156922">!=</span>&nbsp;<span class="ident" id="6156925">nil</span>&nbsp;<span class="op" id="6156929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156933">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156944">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156975">p</span><span class="op" id="6156976">.</span><span class="ident" id="6156977">impliedSemi</span>&nbsp;<span class="op" id="6156989">=</span>&nbsp;<span class="builtintype" id="6156991">false</span>&nbsp;<span class="comment" id="6156997">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157025">p</span><span class="op" id="6157026">.</span><span class="ident" id="6157027">flush</span><span class="op" id="6157032">(</span><span class="ident" id="6157033">token</span><span class="op" id="6157038">.</span><span class="ident" id="6157039">Position</span><span class="op" id="6157047">{</span><span class="ident" id="6157048">Offset</span><span class="op" id="6157054">:</span>&nbsp;<span class="ident" id="6157056">infinity</span><span class="op" id="6157064">,</span>&nbsp;<span class="ident" id="6157066">Line</span><span class="op" id="6157070">:</span>&nbsp;<span class="ident" id="6157072">infinity</span><span class="op" id="6157080">}</span><span class="op" id="6157081">,</span>&nbsp;<span class="ident" id="6157083">token</span><span class="op" id="6157088">.</span><span class="ident" id="6157089">EOF</span><span class="op" id="6157092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157096">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157167">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157239">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157304">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157371">output</span>&nbsp;<span class="op" id="6157378">=</span>&nbsp;<span class="op" id="6157380">&amp;</span><span class="ident" id="6157381">trimmer</span><span class="op" id="6157388">{</span><span class="ident" id="6157389">output</span><span class="op" id="6157395">:</span>&nbsp;<span class="ident" id="6157397">output</span><span class="op" id="6157403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157407">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157460">if</span>&nbsp;<span class="ident" id="6157463">cfg</span><span class="op" id="6157466">.</span><span class="ident" id="6157467">Mode</span><span class="op" id="6157471">&amp;</span><span class="ident" id="6157472">RawFormat</span>&nbsp;<span class="op" id="6157482">==</span>&nbsp;<span class="num" id="6157485">0</span>&nbsp;<span class="op" id="6157487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157491">minwidth</span>&nbsp;<span class="op" id="6157500">:=</span>&nbsp;<span class="ident" id="6157503">cfg</span><span class="op" id="6157506">.</span><span class="ident" id="6157507">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157519">padchar</span>&nbsp;<span class="op" id="6157527">:=</span>&nbsp;<span class="builtintype" id="6157530">byte</span><span class="op" id="6157534">(</span><span class="string" id="6157535">&#39;\t&#39;</span><span class="op" id="6157539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157543">if</span>&nbsp;<span class="ident" id="6157546">cfg</span><span class="op" id="6157549">.</span><span class="ident" id="6157550">Mode</span><span class="op" id="6157554">&amp;</span><span class="ident" id="6157555">UseSpaces</span>&nbsp;<span class="op" id="6157565">!=</span>&nbsp;<span class="num" id="6157568">0</span>&nbsp;<span class="op" id="6157570">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157575">padchar</span>&nbsp;<span class="op" id="6157583">=</span>&nbsp;<span class="string" id="6157585">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157596">twmode</span>&nbsp;<span class="op" id="6157603">:=</span>&nbsp;<span class="ident" id="6157606">tabwriter</span><span class="op" id="6157615">.</span><span class="ident" id="6157616">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157638">if</span>&nbsp;<span class="ident" id="6157641">cfg</span><span class="op" id="6157644">.</span><span class="ident" id="6157645">Mode</span><span class="op" id="6157649">&amp;</span><span class="ident" id="6157650">TabIndent</span>&nbsp;<span class="op" id="6157660">!=</span>&nbsp;<span class="num" id="6157663">0</span>&nbsp;<span class="op" id="6157665">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157670">minwidth</span>&nbsp;<span class="op" id="6157679">=</span>&nbsp;<span class="num" id="6157681">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157686">twmode</span>&nbsp;<span class="op" id="6157693">|=</span>&nbsp;<span class="ident" id="6157696">tabwriter</span><span class="op" id="6157705">.</span><span class="ident" id="6157706">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157723">output</span>&nbsp;<span class="op" id="6157730">=</span>&nbsp;<span class="ident" id="6157732">tabwriter</span><span class="op" id="6157741">.</span><span class="ident" id="6157742">NewWriter</span><span class="op" id="6157751">(</span><span class="ident" id="6157752">output</span><span class="op" id="6157758">,</span>&nbsp;<span class="ident" id="6157760">minwidth</span><span class="op" id="6157768">,</span>&nbsp;<span class="ident" id="6157770">cfg</span><span class="op" id="6157773">.</span><span class="ident" id="6157774">Tabwidth</span><span class="op" id="6157782">,</span>&nbsp;<span class="num" id="6157784">1</span><span class="op" id="6157785">,</span>&nbsp;<span class="ident" id="6157787">padchar</span><span class="op" id="6157794">,</span>&nbsp;<span class="ident" id="6157796">twmode</span><span class="op" id="6157802">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157809">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157866">if</span>&nbsp;<span class="ident" id="6157869">_</span><span class="op" id="6157870">,</span>&nbsp;<span class="ident" id="6157872">err</span>&nbsp;<span class="op" id="6157876">=</span>&nbsp;<span class="ident" id="6157878">output</span><span class="op" id="6157884">.</span><span class="ident" id="6157885">Write</span><span class="op" id="6157890">(</span><span class="ident" id="6157891">p</span><span class="op" id="6157892">.</span><span class="ident" id="6157893">output</span><span class="op" id="6157899">)</span><span class="op" id="6157900">;</span>&nbsp;<span class="ident" id="6157902">err</span>&nbsp;<span class="op" id="6157906">!=</span>&nbsp;<span class="ident" id="6157909">nil</span>&nbsp;<span class="op" id="6157913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157917">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157929">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157957">if</span>&nbsp;<span class="ident" id="6157960">tw</span><span class="op" id="6157962">,</span>&nbsp;<span class="ident" id="6157964">_</span>&nbsp;<span class="op" id="6157966">:=</span>&nbsp;<span class="ident" id="6157969">output</span><span class="op" id="6157975">.</span><span class="op" id="6157976">(</span><span class="op" id="6157977">*</span><span class="ident" id="6157978">tabwriter</span><span class="op" id="6157987">.</span><span class="ident" id="6157988">Writer</span><span class="op" id="6157994">)</span><span class="op" id="6157995">;</span>&nbsp;<span class="ident" id="6157997">tw</span>&nbsp;<span class="op" id="6158000">!=</span>&nbsp;<span class="ident" id="6158003">nil</span>&nbsp;<span class="op" id="6158007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158011">err</span>&nbsp;<span class="op" id="6158015">=</span>&nbsp;<span class="ident" id="6158017">tw</span><span class="op" id="6158019">.</span><span class="ident" id="6158020">Flush</span><span class="op" id="6158025">(</span><span class="op" id="6158026">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158033">return</span><br>
<span class="lineno"></span><span class="op" id="6158040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="6158043">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6158110">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6158176">//</span><br>
<span class="lineno"></span><span class="keyword" id="6158179">type</span>&nbsp;<span class="ident" id="6158184">CommentedNode</span>&nbsp;<span class="keyword" id="6158198">struct</span>&nbsp;<span class="op" id="6158205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158208">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158217">interface</span><span class="op" id="6158226">{</span><span class="op" id="6158227">}</span>&nbsp;<span class="comment" id="6158229">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158289">Comments</span>&nbsp;<span class="op" id="6158298">[</span><span class="op" id="6158299">]</span><span class="op" id="6158300">*</span><span class="ident" id="6158301">ast</span><span class="op" id="6158304">.</span><span class="ident" id="6158305">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="6158318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6158321">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="6158400">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="6158470">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="6158546">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="6158620">//</span><br>
<span class="lineno"></span><span class="keyword" id="6158623">func</span>&nbsp;<span class="op" id="6158628">(</span><span class="ident" id="6158629">cfg</span>&nbsp;<span class="op" id="6158633">*</span><span class="ident" id="6158634">Config</span><span class="op" id="6158640">)</span>&nbsp;<span class="ident" id="6158642">Fprint</span><span class="op" id="6158648">(</span><span class="ident" id="6158649">output</span>&nbsp;<span class="ident" id="6158656">io</span><span class="op" id="6158658">.</span><span class="ident" id="6158659">Writer</span><span class="op" id="6158665">,</span>&nbsp;<span class="ident" id="6158667">fset</span>&nbsp;<span class="op" id="6158672">*</span><span class="ident" id="6158673">token</span><span class="op" id="6158678">.</span><span class="ident" id="6158679">FileSet</span><span class="op" id="6158686">,</span>&nbsp;<span class="ident" id="6158688">node</span>&nbsp;<span class="keyword" id="6158693">interface</span><span class="op" id="6158702">{</span><span class="op" id="6158703">}</span><span class="op" id="6158704">)</span>&nbsp;<span class="builtintype" id="6158706">error</span>&nbsp;<span class="op" id="6158712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158715">return</span>&nbsp;<span class="ident" id="6158722">cfg</span><span class="op" id="6158725">.</span><span class="ident" id="6158726">fprint</span><span class="op" id="6158732">(</span><span class="ident" id="6158733">output</span><span class="op" id="6158739">,</span>&nbsp;<span class="ident" id="6158741">fset</span><span class="op" id="6158745">,</span>&nbsp;<span class="ident" id="6158747">node</span><span class="op" id="6158751">,</span>&nbsp;<span class="builtinfunc" id="6158753">make</span><span class="op" id="6158757">(</span><span class="keyword" id="6158758">map</span><span class="op" id="6158761">[</span><span class="ident" id="6158762">ast</span><span class="op" id="6158765">.</span><span class="ident" id="6158766">Node</span><span class="op" id="6158770">]</span><span class="builtintype" id="6158771">int</span><span class="op" id="6158774">)</span><span class="op" id="6158775">)</span><br>
<span class="lineno">1285</span><span class="op" id="6158777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6158780">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6158829">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="6158878">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="6158881">func</span>&nbsp;<span class="ident" id="6158886">Fprint</span><span class="op" id="6158892">(</span><span class="ident" id="6158893">output</span>&nbsp;<span class="ident" id="6158900">io</span><span class="op" id="6158902">.</span><span class="ident" id="6158903">Writer</span><span class="op" id="6158909">,</span>&nbsp;<span class="ident" id="6158911">fset</span>&nbsp;<span class="op" id="6158916">*</span><span class="ident" id="6158917">token</span><span class="op" id="6158922">.</span><span class="ident" id="6158923">FileSet</span><span class="op" id="6158930">,</span>&nbsp;<span class="ident" id="6158932">node</span>&nbsp;<span class="keyword" id="6158937">interface</span><span class="op" id="6158946">{</span><span class="op" id="6158947">}</span><span class="op" id="6158948">)</span>&nbsp;<span class="builtintype" id="6158950">error</span>&nbsp;<span class="op" id="6158956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158959">return</span>&nbsp;<span class="op" id="6158966">(</span><span class="op" id="6158967">&amp;</span><span class="ident" id="6158968">Config</span><span class="op" id="6158974">{</span><span class="ident" id="6158975">Tabwidth</span><span class="op" id="6158983">:</span>&nbsp;<span class="num" id="6158985">8</span><span class="op" id="6158986">}</span><span class="op" id="6158987">)</span><span class="op" id="6158988">.</span><span class="ident" id="6158989">Fprint</span><span class="op" id="6158995">(</span><span class="ident" id="6158996">output</span><span class="op" id="6159002">,</span>&nbsp;<span class="ident" id="6159004">fset</span><span class="op" id="6159008">,</span>&nbsp;<span class="ident" id="6159010">node</span><span class="op" id="6159014">)</span><br>
<span class="lineno"></span><span class="op" id="6159016">}</span>
</div>
</body>
</html>
