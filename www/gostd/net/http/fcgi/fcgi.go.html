<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html" class="current">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6041108">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6041163">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6041217">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6041268">//&nbsp;Package&nbsp;fcgi&nbsp;implements&nbsp;the&nbsp;FastCGI&nbsp;protocol.</span><br>
<span class="lineno"></span><span class="comment" id="6041317">//&nbsp;Currently&nbsp;only&nbsp;the&nbsp;responder&nbsp;role&nbsp;is&nbsp;supported.</span><br>
<span class="lineno"></span><span class="comment" id="6041368">//&nbsp;The&nbsp;protocol&nbsp;is&nbsp;defined&nbsp;at&nbsp;http://www.fastcgi.com/drupal/node/6?q=node/22</span><br>
<span class="lineno"></span><span class="keyword" id="6041445">package</span>&nbsp;<span class="ident" id="6041453">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6041459">//&nbsp;This&nbsp;file&nbsp;defines&nbsp;the&nbsp;raw&nbsp;protocol&nbsp;and&nbsp;some&nbsp;utilities&nbsp;used&nbsp;by&nbsp;the&nbsp;child&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6041538">//&nbsp;the&nbsp;host.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6041552">import</span>&nbsp;<span class="op" id="6041559">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041562">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041571">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041580">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041599">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041609">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041615">&#34;sync&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6041622">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041625">//&nbsp;recType&nbsp;is&nbsp;a&nbsp;record&nbsp;type,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6041668">//&nbsp;http://www.fastcgi.com/devkit/doc/fcgi-spec.html#S8</span><br>
<span class="lineno"></span><span class="keyword" id="6041723">type</span>&nbsp;<span class="ident" id="6041728">recType</span>&nbsp;<span class="builtintype" id="6041736">uint8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6041743">const</span>&nbsp;<span class="op" id="6041749">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041752">typeBeginRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041772"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041780">=</span>&nbsp;<span class="num" id="6041782">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041785">typeAbortRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041805"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041813">=</span>&nbsp;<span class="num" id="6041815">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041818">typeEndRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041838"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041846">=</span>&nbsp;<span class="num" id="6041848">3</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041851">typeParams</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041871"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041879">=</span>&nbsp;<span class="num" id="6041881">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041884">typeStdin</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041904"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041912">=</span>&nbsp;<span class="num" id="6041914">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041917">typeStdout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041937"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041945">=</span>&nbsp;<span class="num" id="6041947">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041950">typeStderr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041970"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6041978">=</span>&nbsp;<span class="num" id="6041980">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041983">typeData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042003"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6042011">=</span>&nbsp;<span class="num" id="6042013">8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042016">typeGetValues</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042036"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6042044">=</span>&nbsp;<span class="num" id="6042046">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042049">typeGetValuesResult</span>&nbsp;<span class="ident" id="6042069"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6042077">=</span>&nbsp;<span class="num" id="6042079">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042083">typeUnknownType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042103"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span>&nbsp;<span class="op" id="6042111">=</span>&nbsp;<span class="num" id="6042113">11</span><br>
<span class="lineno"></span><span class="op" id="6042116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="6042119">//&nbsp;keep&nbsp;the&nbsp;connection&nbsp;between&nbsp;web-server&nbsp;and&nbsp;responder&nbsp;open&nbsp;after&nbsp;request</span><br>
<span class="lineno"></span><span class="keyword" id="6042194">const</span>&nbsp;<span class="ident" id="6042200">flagKeepConn</span>&nbsp;<span class="op" id="6042213">=</span>&nbsp;<span class="num" id="6042215">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042218">const</span>&nbsp;<span class="op" id="6042224">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042227">maxWrite</span>&nbsp;<span class="op" id="6042236">=</span>&nbsp;<span class="num" id="6042238">65535</span>&nbsp;<span class="comment" id="6042244">//&nbsp;maximum&nbsp;record&nbsp;body</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042268">maxPad</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6042277">=</span>&nbsp;<span class="num" id="6042279">255</span><br>
<span class="lineno"></span><span class="op" id="6042283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042286">const</span>&nbsp;<span class="op" id="6042292">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042295">roleResponder</span>&nbsp;<span class="op" id="6042309">=</span>&nbsp;<span class="ident" id="6042311">iota</span>&nbsp;<span class="op" id="6042316">+</span>&nbsp;<span class="num" id="6042318">1</span>&nbsp;<span class="comment" id="6042320">//&nbsp;only&nbsp;Responders&nbsp;are&nbsp;implemented.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042357">roleAuthorizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042373">roleFilter</span><br>
<span class="lineno"></span><span class="op" id="6042384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042387">const</span>&nbsp;<span class="op" id="6042393">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042396">statusRequestComplete</span>&nbsp;<span class="op" id="6042418">=</span>&nbsp;<span class="ident" id="6042420">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042426">statusCantMultiplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042447">statusOverloaded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042465">statusUnknownRole</span><br>
<span class="lineno"></span><span class="op" id="6042483">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6042486">const</span>&nbsp;<span class="ident" id="6042492">headerLen</span>&nbsp;<span class="op" id="6042502">=</span>&nbsp;<span class="num" id="6042504">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042507">type</span>&nbsp;<span class="ident" id="6042512">header</span>&nbsp;<span class="keyword" id="6042519">struct</span>&nbsp;<span class="op" id="6042526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042529">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6042543">uint8</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042550">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042564"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042573">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6042587">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042595">ContentLength</span>&nbsp;<span class="builtintype" id="6042609">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042617">PaddingLength</span>&nbsp;<span class="builtintype" id="6042631">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042638">Reserved</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6042652">uint8</span><br>
<span class="lineno">70</span><span class="op" id="6042658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042661">type</span>&nbsp;<span class="ident" id="6042666">beginRequest</span>&nbsp;<span class="keyword" id="6042679">struct</span>&nbsp;<span class="op" id="6042686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042689">role</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6042698">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042706">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6042715">uint8</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042722">reserved</span>&nbsp;<span class="op" id="6042731">[</span><span class="num" id="6042732">5</span><span class="op" id="6042733">]</span><span class="builtintype" id="6042734">uint8</span><br>
<span class="lineno"></span><span class="op" id="6042740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042743">func</span>&nbsp;<span class="op" id="6042748">(</span><span class="ident" id="6042749">br</span>&nbsp;<span class="op" id="6042752">*</span><span class="ident" id="6042753"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042666">beginRequest</a></span><span class="op" id="6042765">)</span>&nbsp;<span class="ident" id="6042767">read</span><span class="op" id="6042771">(</span><span class="ident" id="6042772">content</span>&nbsp;<span class="op" id="6042780">[</span><span class="op" id="6042781">]</span><span class="builtintype" id="6042782">byte</span><span class="op" id="6042786">)</span>&nbsp;<span class="builtintype" id="6042788">error</span>&nbsp;<span class="op" id="6042794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042797">if</span>&nbsp;<span class="builtinfunc" id="6042800">len</span><span class="op" id="6042803">(</span><span class="ident" id="6042804"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042772">content</a></span><span class="op" id="6042811">)</span>&nbsp;<span class="op" id="6042813">!=</span>&nbsp;<span class="num" id="6042816">8</span>&nbsp;<span class="op" id="6042818">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042822">return</span>&nbsp;<span class="ident" id="6042829"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041599">errors</a></span><span class="op" id="6042835">.</span><span class="ident" id="6042836"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6042839">(</span><span class="string" id="6042840">&#34;fcgi:&nbsp;invalid&nbsp;begin&nbsp;request&nbsp;record&#34;</span><span class="op" id="6042876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042882"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042749">br</a></span><span class="op" id="6042884">.</span><span class="ident" id="6042885"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042689">role</a></span>&nbsp;<span class="op" id="6042890">=</span>&nbsp;<span class="ident" id="6042892"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6042898">.</span><span class="ident" id="6042899"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6042908">.</span><span class="ident" id="6042909"><a href="/gostd/encoding/binary/binary.go.html#2988241">Uint16</a></span><span class="op" id="6042915">(</span><span class="ident" id="6042916"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042772">content</a></span><span class="op" id="6042923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042926"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042749">br</a></span><span class="op" id="6042928">.</span><span class="ident" id="6042929"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042706">flags</a></span>&nbsp;<span class="op" id="6042935">=</span>&nbsp;<span class="ident" id="6042937"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042772">content</a></span><span class="op" id="6042944">[</span><span class="num" id="6042945">2</span><span class="op" id="6042946">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042949">return</span>&nbsp;<span class="builtintype" id="6042956">nil</span><br>
<span class="lineno">85</span><span class="op" id="6042960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6042963">//&nbsp;for&nbsp;padding&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;allocate&nbsp;all&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="6043020">//&nbsp;not&nbsp;synchronized&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;the&nbsp;contents&nbsp;are</span><br>
<span class="lineno"></span><span class="keyword" id="6043084">var</span>&nbsp;<span class="ident" id="6043088">pad</span>&nbsp;<span class="op" id="6043092">[</span><span class="ident" id="6043093"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042268">maxPad</a></span><span class="op" id="6043099">]</span><span class="builtintype" id="6043100">byte</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6043106">func</span>&nbsp;<span class="op" id="6043111">(</span><span class="ident" id="6043112">h</span>&nbsp;<span class="op" id="6043114">*</span><span class="ident" id="6043115"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042512">header</a></span><span class="op" id="6043121">)</span>&nbsp;<span class="ident" id="6043123">init</span><span class="op" id="6043127">(</span><span class="ident" id="6043128">recType</span>&nbsp;<span class="ident" id="6043136"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><span class="op" id="6043143">,</span>&nbsp;<span class="ident" id="6043145">reqId</span>&nbsp;<span class="builtintype" id="6043151">uint16</span><span class="op" id="6043157">,</span>&nbsp;<span class="ident" id="6043159">contentLength</span>&nbsp;<span class="builtintype" id="6043173">int</span><span class="op" id="6043176">)</span>&nbsp;<span class="op" id="6043178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043181"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043112">h</a></span><span class="op" id="6043182">.</span><span class="ident" id="6043183"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042529">Version</a></span>&nbsp;<span class="op" id="6043191">=</span>&nbsp;<span class="num" id="6043193">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043196"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043112">h</a></span><span class="op" id="6043197">.</span><span class="ident" id="6043198"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042550">Type</a></span>&nbsp;<span class="op" id="6043203">=</span>&nbsp;<span class="ident" id="6043205"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043128">recType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043214"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043112">h</a></span><span class="op" id="6043215">.</span><span class="ident" id="6043216"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span>&nbsp;<span class="op" id="6043219">=</span>&nbsp;<span class="ident" id="6043221"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043145">reqId</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043228"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043112">h</a></span><span class="op" id="6043229">.</span><span class="ident" id="6043230"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042595">ContentLength</a></span>&nbsp;<span class="op" id="6043244">=</span>&nbsp;<span class="builtintype" id="6043246">uint16</span><span class="op" id="6043252">(</span><span class="ident" id="6043253"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043159">contentLength</a></span><span class="op" id="6043266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043269"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043112">h</a></span><span class="op" id="6043270">.</span><span class="ident" id="6043271"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042617">PaddingLength</a></span>&nbsp;<span class="op" id="6043285">=</span>&nbsp;<span class="builtintype" id="6043287">uint8</span><span class="op" id="6043292">(</span><span class="op" id="6043293">-</span><span class="ident" id="6043294"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043159">contentLength</a></span>&nbsp;<span class="op" id="6043308">&amp;</span>&nbsp;<span class="num" id="6043310">7</span><span class="op" id="6043311">)</span><br>
<span class="lineno"></span><span class="op" id="6043313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6043316">//&nbsp;conn&nbsp;sends&nbsp;records&nbsp;over&nbsp;rwc</span><br>
<span class="lineno">100</span><span class="keyword" id="6043347">type</span>&nbsp;<span class="ident" id="6043352">conn</span>&nbsp;<span class="keyword" id="6043357">struct</span>&nbsp;<span class="op" id="6043364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043367">mutex</span>&nbsp;<span class="ident" id="6043373"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041615">sync</a></span><span class="op" id="6043377">.</span><span class="ident" id="6043378"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043385">rwc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6043391"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041609">io</a></span><span class="op" id="6043393">.</span><span class="ident" id="6043394"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043412">//&nbsp;to&nbsp;avoid&nbsp;allocations</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043437">buf</span>&nbsp;<span class="ident" id="6043441"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041571">bytes</a></span><span class="op" id="6043446">.</span><span class="ident" id="6043447"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043455">h</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6043459"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042512">header</a></span><br>
<span class="lineno"></span><span class="op" id="6043466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043469">func</span>&nbsp;<span class="ident" id="6043474">newConn</span><span class="op" id="6043481">(</span><span class="ident" id="6043482">rwc</span>&nbsp;<span class="ident" id="6043486"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041609">io</a></span><span class="op" id="6043488">.</span><span class="ident" id="6043489"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><span class="op" id="6043504">)</span>&nbsp;<span class="op" id="6043506">*</span><span class="ident" id="6043507"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span>&nbsp;<span class="op" id="6043512">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043515">return</span>&nbsp;<span class="op" id="6043522">&amp;</span><span class="ident" id="6043523"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6043527">{</span><span class="ident" id="6043528"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043385">rwc</a></span><span class="op" id="6043531">:</span>&nbsp;<span class="ident" id="6043533"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043482">rwc</a></span><span class="op" id="6043536">}</span><br>
<span class="lineno"></span><span class="op" id="6043538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043541">func</span>&nbsp;<span class="op" id="6043546">(</span><span class="ident" id="6043547">c</span>&nbsp;<span class="op" id="6043549">*</span><span class="ident" id="6043550"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6043554">)</span>&nbsp;<span class="ident" id="6043556">Close</span><span class="op" id="6043561">(</span><span class="op" id="6043562">)</span>&nbsp;<span class="builtintype" id="6043564">error</span>&nbsp;<span class="op" id="6043570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043573"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043547">c</a></span><span class="op" id="6043574">.</span><span class="ident" id="6043575"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043367">mutex</a></span><span class="op" id="6043580">.</span><span class="ident" id="6043581"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6043585">(</span><span class="op" id="6043586">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043589">defer</span>&nbsp;<span class="ident" id="6043595"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043547">c</a></span><span class="op" id="6043596">.</span><span class="ident" id="6043597"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043367">mutex</a></span><span class="op" id="6043602">.</span><span class="ident" id="6043603"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6043609">(</span><span class="op" id="6043610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043613">return</span>&nbsp;<span class="ident" id="6043620"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043547">c</a></span><span class="op" id="6043621">.</span><span class="ident" id="6043622"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043385">rwc</a></span><span class="op" id="6043625">.</span><span class="ident" id="6043626"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6043631">(</span><span class="op" id="6043632">)</span><br>
<span class="lineno"></span><span class="op" id="6043634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043637">type</span>&nbsp;<span class="ident" id="6043642">record</span>&nbsp;<span class="keyword" id="6043649">struct</span>&nbsp;<span class="op" id="6043656">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043659">h</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6043663"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042512">header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043671">buf</span>&nbsp;<span class="op" id="6043675">[</span><span class="ident" id="6043676"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042227">maxWrite</a></span>&nbsp;<span class="op" id="6043685">+</span>&nbsp;<span class="ident" id="6043687"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042268">maxPad</a></span><span class="op" id="6043693">]</span><span class="builtintype" id="6043694">byte</span><br>
<span class="lineno"></span><span class="op" id="6043699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043702">func</span>&nbsp;<span class="op" id="6043707">(</span><span class="ident" id="6043708">rec</span>&nbsp;<span class="op" id="6043712">*</span><span class="ident" id="6043713"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043642">record</a></span><span class="op" id="6043719">)</span>&nbsp;<span class="ident" id="6043721">read</span><span class="op" id="6043725">(</span><span class="ident" id="6043726">r</span>&nbsp;<span class="ident" id="6043728"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041609">io</a></span><span class="op" id="6043730">.</span><span class="ident" id="6043731"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6043737">)</span>&nbsp;<span class="op" id="6043739">(</span><span class="ident" id="6043740">err</span>&nbsp;<span class="builtintype" id="6043744">error</span><span class="op" id="6043749">)</span>&nbsp;<span class="op" id="6043751">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043754">if</span>&nbsp;<span class="ident" id="6043757"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span>&nbsp;<span class="op" id="6043761">=</span>&nbsp;<span class="ident" id="6043763"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6043769">.</span><span class="ident" id="6043770"><a href="/gostd/encoding/binary/binary.go.html#2989675">Read</a></span><span class="op" id="6043774">(</span><span class="ident" id="6043775"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043726">r</a></span><span class="op" id="6043776">,</span>&nbsp;<span class="ident" id="6043778"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6043784">.</span><span class="ident" id="6043785"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6043794">,</span>&nbsp;<span class="op" id="6043796">&amp;</span><span class="ident" id="6043797"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043708">rec</a></span><span class="op" id="6043800">.</span><span class="ident" id="6043801"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6043802">)</span><span class="op" id="6043803">;</span>&nbsp;<span class="ident" id="6043805"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span>&nbsp;<span class="op" id="6043809">!=</span>&nbsp;<span class="builtintype" id="6043812">nil</span>&nbsp;<span class="op" id="6043816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043820">return</span>&nbsp;<span class="ident" id="6043827"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043835">if</span>&nbsp;<span class="ident" id="6043838"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043708">rec</a></span><span class="op" id="6043841">.</span><span class="ident" id="6043842"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6043843">.</span><span class="ident" id="6043844"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042529">Version</a></span>&nbsp;<span class="op" id="6043852">!=</span>&nbsp;<span class="num" id="6043855">1</span>&nbsp;<span class="op" id="6043857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043861">return</span>&nbsp;<span class="ident" id="6043868"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041599">errors</a></span><span class="op" id="6043874">.</span><span class="ident" id="6043875"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6043878">(</span><span class="string" id="6043879">&#34;fcgi:&nbsp;invalid&nbsp;header&nbsp;version&#34;</span><span class="op" id="6043909">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043915">n</span>&nbsp;<span class="op" id="6043917">:=</span>&nbsp;<span class="builtintype" id="6043920">int</span><span class="op" id="6043923">(</span><span class="ident" id="6043924"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043708">rec</a></span><span class="op" id="6043927">.</span><span class="ident" id="6043928"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6043929">.</span><span class="ident" id="6043930"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042595">ContentLength</a></span><span class="op" id="6043943">)</span>&nbsp;<span class="op" id="6043945">+</span>&nbsp;<span class="builtintype" id="6043947">int</span><span class="op" id="6043950">(</span><span class="ident" id="6043951"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043708">rec</a></span><span class="op" id="6043954">.</span><span class="ident" id="6043955"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6043956">.</span><span class="ident" id="6043957"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042617">PaddingLength</a></span><span class="op" id="6043970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043973">if</span>&nbsp;<span class="ident" id="6043976">_</span><span class="op" id="6043977">,</span>&nbsp;<span class="ident" id="6043979"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span>&nbsp;<span class="op" id="6043983">=</span>&nbsp;<span class="ident" id="6043985"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041609">io</a></span><span class="op" id="6043987">.</span><span class="ident" id="6043988"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="6043996">(</span><span class="ident" id="6043997"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043726">r</a></span><span class="op" id="6043998">,</span>&nbsp;<span class="ident" id="6044000"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043708">rec</a></span><span class="op" id="6044003">.</span><span class="ident" id="6044004"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043671">buf</a></span><span class="op" id="6044007">[</span><span class="op" id="6044008">:</span><span class="ident" id="6044009"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043915">n</a></span><span class="op" id="6044010">]</span><span class="op" id="6044011">)</span><span class="op" id="6044012">;</span>&nbsp;<span class="ident" id="6044014"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span>&nbsp;<span class="op" id="6044018">!=</span>&nbsp;<span class="builtintype" id="6044021">nil</span>&nbsp;<span class="op" id="6044025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044029">return</span>&nbsp;<span class="ident" id="6044036"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043740">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044041">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044044">return</span>&nbsp;<span class="builtintype" id="6044051">nil</span><br>
<span class="lineno"></span><span class="op" id="6044055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6044058">func</span>&nbsp;<span class="op" id="6044063">(</span><span class="ident" id="6044064">r</span>&nbsp;<span class="op" id="6044066">*</span><span class="ident" id="6044067"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043642">record</a></span><span class="op" id="6044073">)</span>&nbsp;<span class="ident" id="6044075">content</span><span class="op" id="6044082">(</span><span class="op" id="6044083">)</span>&nbsp;<span class="op" id="6044085">[</span><span class="op" id="6044086">]</span><span class="builtintype" id="6044087">byte</span>&nbsp;<span class="op" id="6044092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044095">return</span>&nbsp;<span class="ident" id="6044102"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044064">r</a></span><span class="op" id="6044103">.</span><span class="ident" id="6044104"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043671">buf</a></span><span class="op" id="6044107">[</span><span class="op" id="6044108">:</span><span class="ident" id="6044109"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044064">r</a></span><span class="op" id="6044110">.</span><span class="ident" id="6044111"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6044112">.</span><span class="ident" id="6044113"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042595">ContentLength</a></span><span class="op" id="6044126">]</span><br>
<span class="lineno">140</span><span class="op" id="6044128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6044131">//&nbsp;writeRecord&nbsp;writes&nbsp;and&nbsp;sends&nbsp;a&nbsp;single&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="6044180">func</span>&nbsp;<span class="op" id="6044185">(</span><span class="ident" id="6044186">c</span>&nbsp;<span class="op" id="6044188">*</span><span class="ident" id="6044189"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6044193">)</span>&nbsp;<span class="ident" id="6044195">writeRecord</span><span class="op" id="6044206">(</span><span class="ident" id="6044207">recType</span>&nbsp;<span class="ident" id="6044215"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><span class="op" id="6044222">,</span>&nbsp;<span class="ident" id="6044224">reqId</span>&nbsp;<span class="builtintype" id="6044230">uint16</span><span class="op" id="6044236">,</span>&nbsp;<span class="ident" id="6044238">b</span>&nbsp;<span class="op" id="6044240">[</span><span class="op" id="6044241">]</span><span class="builtintype" id="6044242">byte</span><span class="op" id="6044246">)</span>&nbsp;<span class="builtintype" id="6044248">error</span>&nbsp;<span class="op" id="6044254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044257"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044258">.</span><span class="ident" id="6044259"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043367">mutex</a></span><span class="op" id="6044264">.</span><span class="ident" id="6044265"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6044269">(</span><span class="op" id="6044270">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044273">defer</span>&nbsp;<span class="ident" id="6044279"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044280">.</span><span class="ident" id="6044281"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043367">mutex</a></span><span class="op" id="6044286">.</span><span class="ident" id="6044287"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6044293">(</span><span class="op" id="6044294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044297"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044298">.</span><span class="ident" id="6044299"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043437">buf</a></span><span class="op" id="6044302">.</span><span class="ident" id="6044303"><a href="/gostd/bytes/buffer.go.html#1385417">Reset</a></span><span class="op" id="6044308">(</span><span class="op" id="6044309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044312"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044313">.</span><span class="ident" id="6044314"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043455">h</a></span><span class="op" id="6044315">.</span><span class="ident" id="6044316"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043123">init</a></span><span class="op" id="6044320">(</span><span class="ident" id="6044321"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044207">recType</a></span><span class="op" id="6044328">,</span>&nbsp;<span class="ident" id="6044330"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044224">reqId</a></span><span class="op" id="6044335">,</span>&nbsp;<span class="builtinfunc" id="6044337">len</span><span class="op" id="6044340">(</span><span class="ident" id="6044341"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044238">b</a></span><span class="op" id="6044342">)</span><span class="op" id="6044343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044346">if</span>&nbsp;<span class="ident" id="6044349">err</span>&nbsp;<span class="op" id="6044353">:=</span>&nbsp;<span class="ident" id="6044356"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6044362">.</span><span class="ident" id="6044363"><a href="/gostd/encoding/binary/binary.go.html#2991871">Write</a></span><span class="op" id="6044368">(</span><span class="op" id="6044369">&amp;</span><span class="ident" id="6044370"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044371">.</span><span class="ident" id="6044372"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043437">buf</a></span><span class="op" id="6044375">,</span>&nbsp;<span class="ident" id="6044377"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6044383">.</span><span class="ident" id="6044384"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6044393">,</span>&nbsp;<span class="ident" id="6044395"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044396">.</span><span class="ident" id="6044397"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043455">h</a></span><span class="op" id="6044398">)</span><span class="op" id="6044399">;</span>&nbsp;<span class="ident" id="6044401"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044349">err</a></span>&nbsp;<span class="op" id="6044405">!=</span>&nbsp;<span class="builtintype" id="6044408">nil</span>&nbsp;<span class="op" id="6044412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044416">return</span>&nbsp;<span class="ident" id="6044423"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044349">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044431">if</span>&nbsp;<span class="ident" id="6044434">_</span><span class="op" id="6044435">,</span>&nbsp;<span class="ident" id="6044437">err</span>&nbsp;<span class="op" id="6044441">:=</span>&nbsp;<span class="ident" id="6044444"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044445">.</span><span class="ident" id="6044446"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043437">buf</a></span><span class="op" id="6044449">.</span><span class="ident" id="6044450"><a href="/gostd/bytes/buffer.go.html#1387016">Write</a></span><span class="op" id="6044455">(</span><span class="ident" id="6044456"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044238">b</a></span><span class="op" id="6044457">)</span><span class="op" id="6044458">;</span>&nbsp;<span class="ident" id="6044460"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044437">err</a></span>&nbsp;<span class="op" id="6044464">!=</span>&nbsp;<span class="builtintype" id="6044467">nil</span>&nbsp;<span class="op" id="6044471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044475">return</span>&nbsp;<span class="ident" id="6044482"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044437">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044490">if</span>&nbsp;<span class="ident" id="6044493">_</span><span class="op" id="6044494">,</span>&nbsp;<span class="ident" id="6044496">err</span>&nbsp;<span class="op" id="6044500">:=</span>&nbsp;<span class="ident" id="6044503"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044504">.</span><span class="ident" id="6044505"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043437">buf</a></span><span class="op" id="6044508">.</span><span class="ident" id="6044509"><a href="/gostd/bytes/buffer.go.html#1387016">Write</a></span><span class="op" id="6044514">(</span><span class="ident" id="6044515"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043088">pad</a></span><span class="op" id="6044518">[</span><span class="op" id="6044519">:</span><span class="ident" id="6044520"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044521">.</span><span class="ident" id="6044522"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043455">h</a></span><span class="op" id="6044523">.</span><span class="ident" id="6044524"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042617">PaddingLength</a></span><span class="op" id="6044537">]</span><span class="op" id="6044538">)</span><span class="op" id="6044539">;</span>&nbsp;<span class="ident" id="6044541"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044496">err</a></span>&nbsp;<span class="op" id="6044545">!=</span>&nbsp;<span class="builtintype" id="6044548">nil</span>&nbsp;<span class="op" id="6044552">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044556">return</span>&nbsp;<span class="ident" id="6044563"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044496">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044571">_</span><span class="op" id="6044572">,</span>&nbsp;<span class="ident" id="6044574">err</span>&nbsp;<span class="op" id="6044578">:=</span>&nbsp;<span class="ident" id="6044581"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044582">.</span><span class="ident" id="6044583"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043385">rwc</a></span><span class="op" id="6044586">.</span><span class="ident" id="6044587"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6044592">(</span><span class="ident" id="6044593"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044186">c</a></span><span class="op" id="6044594">.</span><span class="ident" id="6044595"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043437">buf</a></span><span class="op" id="6044598">.</span><span class="ident" id="6044599"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6044604">(</span><span class="op" id="6044605">)</span><span class="op" id="6044606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044609">return</span>&nbsp;<span class="ident" id="6044616"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044574">err</a></span><br>
<span class="lineno"></span><span class="op" id="6044620">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6044623">func</span>&nbsp;<span class="op" id="6044628">(</span><span class="ident" id="6044629">c</span>&nbsp;<span class="op" id="6044631">*</span><span class="ident" id="6044632"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6044636">)</span>&nbsp;<span class="ident" id="6044638">writeBeginRequest</span><span class="op" id="6044655">(</span><span class="ident" id="6044656">reqId</span>&nbsp;<span class="builtintype" id="6044662">uint16</span><span class="op" id="6044668">,</span>&nbsp;<span class="ident" id="6044670">role</span>&nbsp;<span class="builtintype" id="6044675">uint16</span><span class="op" id="6044681">,</span>&nbsp;<span class="ident" id="6044683">flags</span>&nbsp;<span class="builtintype" id="6044689">uint8</span><span class="op" id="6044694">)</span>&nbsp;<span class="builtintype" id="6044696">error</span>&nbsp;<span class="op" id="6044702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044705">b</span>&nbsp;<span class="op" id="6044707">:=</span>&nbsp;<span class="op" id="6044710">[</span><span class="num" id="6044711">8</span><span class="op" id="6044712">]</span><span class="builtintype" id="6044713">byte</span><span class="op" id="6044717">{</span><span class="builtintype" id="6044718">byte</span><span class="op" id="6044722">(</span><span class="ident" id="6044723"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044670">role</a></span>&nbsp;<span class="op" id="6044728">&gt;&gt;</span>&nbsp;<span class="num" id="6044731">8</span><span class="op" id="6044732">)</span><span class="op" id="6044733">,</span>&nbsp;<span class="builtintype" id="6044735">byte</span><span class="op" id="6044739">(</span><span class="ident" id="6044740"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044670">role</a></span><span class="op" id="6044744">)</span><span class="op" id="6044745">,</span>&nbsp;<span class="ident" id="6044747"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044683">flags</a></span><span class="op" id="6044752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044755">return</span>&nbsp;<span class="ident" id="6044762"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044629">c</a></span><span class="op" id="6044763">.</span><span class="ident" id="6044764"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6044775">(</span><span class="ident" id="6044776"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041752">typeBeginRequest</a></span><span class="op" id="6044792">,</span>&nbsp;<span class="ident" id="6044794"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044656">reqId</a></span><span class="op" id="6044799">,</span>&nbsp;<span class="ident" id="6044801"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044705">b</a></span><span class="op" id="6044802">[</span><span class="op" id="6044803">:</span><span class="op" id="6044804">]</span><span class="op" id="6044805">)</span><br>
<span class="lineno"></span><span class="op" id="6044807">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6044810">func</span>&nbsp;<span class="op" id="6044815">(</span><span class="ident" id="6044816">c</span>&nbsp;<span class="op" id="6044818">*</span><span class="ident" id="6044819"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6044823">)</span>&nbsp;<span class="ident" id="6044825">writeEndRequest</span><span class="op" id="6044840">(</span><span class="ident" id="6044841">reqId</span>&nbsp;<span class="builtintype" id="6044847">uint16</span><span class="op" id="6044853">,</span>&nbsp;<span class="ident" id="6044855">appStatus</span>&nbsp;<span class="builtintype" id="6044865">int</span><span class="op" id="6044868">,</span>&nbsp;<span class="ident" id="6044870">protocolStatus</span>&nbsp;<span class="builtintype" id="6044885">uint8</span><span class="op" id="6044890">)</span>&nbsp;<span class="builtintype" id="6044892">error</span>&nbsp;<span class="op" id="6044898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044901">b</span>&nbsp;<span class="op" id="6044903">:=</span>&nbsp;<span class="builtinfunc" id="6044906">make</span><span class="op" id="6044910">(</span><span class="op" id="6044911">[</span><span class="op" id="6044912">]</span><span class="builtintype" id="6044913">byte</span><span class="op" id="6044917">,</span>&nbsp;<span class="num" id="6044919">8</span><span class="op" id="6044920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044923"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6044929">.</span><span class="ident" id="6044930"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6044939">.</span><span class="ident" id="6044940"><a href="/gostd/encoding/binary/binary.go.html#2988537">PutUint32</a></span><span class="op" id="6044949">(</span><span class="ident" id="6044950"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044901">b</a></span><span class="op" id="6044951">,</span>&nbsp;<span class="builtintype" id="6044953">uint32</span><span class="op" id="6044959">(</span><span class="ident" id="6044960"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044855">appStatus</a></span><span class="op" id="6044969">)</span><span class="op" id="6044970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044973"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044901">b</a></span><span class="op" id="6044974">[</span><span class="num" id="6044975">4</span><span class="op" id="6044976">]</span>&nbsp;<span class="op" id="6044978">=</span>&nbsp;<span class="ident" id="6044980"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044870">protocolStatus</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044996">return</span>&nbsp;<span class="ident" id="6045003"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044816">c</a></span><span class="op" id="6045004">.</span><span class="ident" id="6045005"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6045016">(</span><span class="ident" id="6045017"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041818">typeEndRequest</a></span><span class="op" id="6045031">,</span>&nbsp;<span class="ident" id="6045033"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044841">reqId</a></span><span class="op" id="6045038">,</span>&nbsp;<span class="ident" id="6045040"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044901">b</a></span><span class="op" id="6045041">)</span><br>
<span class="lineno"></span><span class="op" id="6045043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045046">func</span>&nbsp;<span class="op" id="6045051">(</span><span class="ident" id="6045052">c</span>&nbsp;<span class="op" id="6045054">*</span><span class="ident" id="6045055"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6045059">)</span>&nbsp;<span class="ident" id="6045061">writePairs</span><span class="op" id="6045071">(</span><span class="ident" id="6045072">recType</span>&nbsp;<span class="ident" id="6045080"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><span class="op" id="6045087">,</span>&nbsp;<span class="ident" id="6045089">reqId</span>&nbsp;<span class="builtintype" id="6045095">uint16</span><span class="op" id="6045101">,</span>&nbsp;<span class="ident" id="6045103">pairs</span>&nbsp;<span class="keyword" id="6045109">map</span><span class="op" id="6045112">[</span><span class="builtintype" id="6045113">string</span><span class="op" id="6045119">]</span><span class="builtintype" id="6045120">string</span><span class="op" id="6045126">)</span>&nbsp;<span class="builtintype" id="6045128">error</span>&nbsp;<span class="op" id="6045134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045137">w</span>&nbsp;<span class="op" id="6045139">:=</span>&nbsp;<span class="ident" id="6045142"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046347">newWriter</a></span><span class="op" id="6045151">(</span><span class="ident" id="6045152"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045052">c</a></span><span class="op" id="6045153">,</span>&nbsp;<span class="ident" id="6045155"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045072">recType</a></span><span class="op" id="6045162">,</span>&nbsp;<span class="ident" id="6045164"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045089">reqId</a></span><span class="op" id="6045169">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045172">b</span>&nbsp;<span class="op" id="6045174">:=</span>&nbsp;<span class="builtinfunc" id="6045177">make</span><span class="op" id="6045181">(</span><span class="op" id="6045182">[</span><span class="op" id="6045183">]</span><span class="builtintype" id="6045184">byte</span><span class="op" id="6045188">,</span>&nbsp;<span class="num" id="6045190">8</span><span class="op" id="6045191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045194">for</span>&nbsp;<span class="ident" id="6045198">k</span><span class="op" id="6045199">,</span>&nbsp;<span class="ident" id="6045201">v</span>&nbsp;<span class="op" id="6045203">:=</span>&nbsp;<span class="keyword" id="6045206">range</span>&nbsp;<span class="ident" id="6045212"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045103">pairs</a></span>&nbsp;<span class="op" id="6045218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045222">n</span>&nbsp;<span class="op" id="6045224">:=</span>&nbsp;<span class="ident" id="6045227"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045889">encodeSize</a></span><span class="op" id="6045237">(</span><span class="ident" id="6045238"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045172">b</a></span><span class="op" id="6045239">,</span>&nbsp;<span class="builtintype" id="6045241">uint32</span><span class="op" id="6045247">(</span><span class="builtinfunc" id="6045248">len</span><span class="op" id="6045251">(</span><span class="ident" id="6045252"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045198">k</a></span><span class="op" id="6045253">)</span><span class="op" id="6045254">)</span><span class="op" id="6045255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045259"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045222">n</a></span>&nbsp;<span class="op" id="6045261">+=</span>&nbsp;<span class="ident" id="6045264"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045889">encodeSize</a></span><span class="op" id="6045274">(</span><span class="ident" id="6045275"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045172">b</a></span><span class="op" id="6045276">[</span><span class="ident" id="6045277"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045222">n</a></span><span class="op" id="6045278">:</span><span class="op" id="6045279">]</span><span class="op" id="6045280">,</span>&nbsp;<span class="builtintype" id="6045282">uint32</span><span class="op" id="6045288">(</span><span class="builtinfunc" id="6045289">len</span><span class="op" id="6045292">(</span><span class="ident" id="6045293"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045201">v</a></span><span class="op" id="6045294">)</span><span class="op" id="6045295">)</span><span class="op" id="6045296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045300">if</span>&nbsp;<span class="ident" id="6045303">_</span><span class="op" id="6045304">,</span>&nbsp;<span class="ident" id="6045306">err</span>&nbsp;<span class="op" id="6045310">:=</span>&nbsp;<span class="ident" id="6045313"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045137">w</a></span><span class="op" id="6045314">.</span><span class="ident" id="6045315"><a href="/gostd/bufio/bufio.go.html#1368329">Write</a></span><span class="op" id="6045320">(</span><span class="ident" id="6045321"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045172">b</a></span><span class="op" id="6045322">[</span><span class="op" id="6045323">:</span><span class="ident" id="6045324"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045222">n</a></span><span class="op" id="6045325">]</span><span class="op" id="6045326">)</span><span class="op" id="6045327">;</span>&nbsp;<span class="ident" id="6045329"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045306">err</a></span>&nbsp;<span class="op" id="6045333">!=</span>&nbsp;<span class="builtintype" id="6045336">nil</span>&nbsp;<span class="op" id="6045340">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045345">return</span>&nbsp;<span class="ident" id="6045352"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045306">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045362">if</span>&nbsp;<span class="ident" id="6045365">_</span><span class="op" id="6045366">,</span>&nbsp;<span class="ident" id="6045368">err</span>&nbsp;<span class="op" id="6045372">:=</span>&nbsp;<span class="ident" id="6045375"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045137">w</a></span><span class="op" id="6045376">.</span><span class="ident" id="6045377"><a href="/gostd/bufio/bufio.go.html#1369779">WriteString</a></span><span class="op" id="6045388">(</span><span class="ident" id="6045389"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045198">k</a></span><span class="op" id="6045390">)</span><span class="op" id="6045391">;</span>&nbsp;<span class="ident" id="6045393"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045368">err</a></span>&nbsp;<span class="op" id="6045397">!=</span>&nbsp;<span class="builtintype" id="6045400">nil</span>&nbsp;<span class="op" id="6045404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045409">return</span>&nbsp;<span class="ident" id="6045416"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045368">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045422">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045426">if</span>&nbsp;<span class="ident" id="6045429">_</span><span class="op" id="6045430">,</span>&nbsp;<span class="ident" id="6045432">err</span>&nbsp;<span class="op" id="6045436">:=</span>&nbsp;<span class="ident" id="6045439"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045137">w</a></span><span class="op" id="6045440">.</span><span class="ident" id="6045441"><a href="/gostd/bufio/bufio.go.html#1369779">WriteString</a></span><span class="op" id="6045452">(</span><span class="ident" id="6045453"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045201">v</a></span><span class="op" id="6045454">)</span><span class="op" id="6045455">;</span>&nbsp;<span class="ident" id="6045457"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045432">err</a></span>&nbsp;<span class="op" id="6045461">!=</span>&nbsp;<span class="builtintype" id="6045464">nil</span>&nbsp;<span class="op" id="6045468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045473">return</span>&nbsp;<span class="ident" id="6045480"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045432">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045492"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045137">w</a></span><span class="op" id="6045493">.</span><span class="ident" id="6045494"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046221">Close</a></span><span class="op" id="6045499">(</span><span class="op" id="6045500">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045503">return</span>&nbsp;<span class="builtintype" id="6045510">nil</span><br>
<span class="lineno"></span><span class="op" id="6045514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045517">func</span>&nbsp;<span class="ident" id="6045522">readSize</span><span class="op" id="6045530">(</span><span class="ident" id="6045531">s</span>&nbsp;<span class="op" id="6045533">[</span><span class="op" id="6045534">]</span><span class="builtintype" id="6045535">byte</span><span class="op" id="6045539">)</span>&nbsp;<span class="op" id="6045541">(</span><span class="builtintype" id="6045542">uint32</span><span class="op" id="6045548">,</span>&nbsp;<span class="builtintype" id="6045550">int</span><span class="op" id="6045553">)</span>&nbsp;<span class="op" id="6045555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045558">if</span>&nbsp;<span class="builtinfunc" id="6045561">len</span><span class="op" id="6045564">(</span><span class="ident" id="6045565"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045531">s</a></span><span class="op" id="6045566">)</span>&nbsp;<span class="op" id="6045568">==</span>&nbsp;<span class="num" id="6045571">0</span>&nbsp;<span class="op" id="6045573">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045577">return</span>&nbsp;<span class="num" id="6045584">0</span><span class="op" id="6045585">,</span>&nbsp;<span class="num" id="6045587">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045593">size</span><span class="op" id="6045597">,</span>&nbsp;<span class="ident" id="6045599">n</span>&nbsp;<span class="op" id="6045601">:=</span>&nbsp;<span class="builtintype" id="6045604">uint32</span><span class="op" id="6045610">(</span><span class="ident" id="6045611"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045531">s</a></span><span class="op" id="6045612">[</span><span class="num" id="6045613">0</span><span class="op" id="6045614">]</span><span class="op" id="6045615">)</span><span class="op" id="6045616">,</span>&nbsp;<span class="num" id="6045618">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045621">if</span>&nbsp;<span class="ident" id="6045624"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045593">size</a></span><span class="op" id="6045628">&amp;</span><span class="op" id="6045629">(</span><span class="num" id="6045630">1</span><span class="op" id="6045631">&lt;&lt;</span><span class="num" id="6045633">7</span><span class="op" id="6045634">)</span>&nbsp;<span class="op" id="6045636">!=</span>&nbsp;<span class="num" id="6045639">0</span>&nbsp;<span class="op" id="6045641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045645">if</span>&nbsp;<span class="builtinfunc" id="6045648">len</span><span class="op" id="6045651">(</span><span class="ident" id="6045652"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045531">s</a></span><span class="op" id="6045653">)</span>&nbsp;<span class="op" id="6045655">&lt;</span>&nbsp;<span class="num" id="6045657">4</span>&nbsp;<span class="op" id="6045659">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045664">return</span>&nbsp;<span class="num" id="6045671">0</span><span class="op" id="6045672">,</span>&nbsp;<span class="num" id="6045674">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045682"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045599">n</a></span>&nbsp;<span class="op" id="6045684">=</span>&nbsp;<span class="num" id="6045686">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045690"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045593">size</a></span>&nbsp;<span class="op" id="6045695">=</span>&nbsp;<span class="ident" id="6045697"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6045703">.</span><span class="ident" id="6045704"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6045713">.</span><span class="ident" id="6045714"><a href="/gostd/encoding/binary/binary.go.html#2988414">Uint32</a></span><span class="op" id="6045720">(</span><span class="ident" id="6045721"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045531">s</a></span><span class="op" id="6045722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045726"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045593">size</a></span>&nbsp;<span class="op" id="6045731">&amp;^=</span>&nbsp;<span class="num" id="6045735">1</span>&nbsp;<span class="op" id="6045737">&lt;&lt;</span>&nbsp;<span class="num" id="6045740">31</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045747">return</span>&nbsp;<span class="ident" id="6045754"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045593">size</a></span><span class="op" id="6045758">,</span>&nbsp;<span class="ident" id="6045760"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045599">n</a></span><br>
<span class="lineno"></span><span class="op" id="6045762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045765">func</span>&nbsp;<span class="ident" id="6045770">readString</span><span class="op" id="6045780">(</span><span class="ident" id="6045781">s</span>&nbsp;<span class="op" id="6045783">[</span><span class="op" id="6045784">]</span><span class="builtintype" id="6045785">byte</span><span class="op" id="6045789">,</span>&nbsp;<span class="ident" id="6045791">size</span>&nbsp;<span class="builtintype" id="6045796">uint32</span><span class="op" id="6045802">)</span>&nbsp;<span class="builtintype" id="6045804">string</span>&nbsp;<span class="op" id="6045811">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045814">if</span>&nbsp;<span class="ident" id="6045817"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045791">size</a></span>&nbsp;<span class="op" id="6045822">&gt;</span>&nbsp;<span class="builtintype" id="6045824">uint32</span><span class="op" id="6045830">(</span><span class="builtinfunc" id="6045831">len</span><span class="op" id="6045834">(</span><span class="ident" id="6045835"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045781">s</a></span><span class="op" id="6045836">)</span><span class="op" id="6045837">)</span>&nbsp;<span class="op" id="6045839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045843">return</span>&nbsp;<span class="string" id="6045850">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045857">return</span>&nbsp;<span class="builtintype" id="6045864">string</span><span class="op" id="6045870">(</span><span class="ident" id="6045871"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045781">s</a></span><span class="op" id="6045872">[</span><span class="op" id="6045873">:</span><span class="ident" id="6045874"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045791">size</a></span><span class="op" id="6045878">]</span><span class="op" id="6045879">)</span><br>
<span class="lineno"></span><span class="op" id="6045881">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6045884">func</span>&nbsp;<span class="ident" id="6045889">encodeSize</span><span class="op" id="6045899">(</span><span class="ident" id="6045900">b</span>&nbsp;<span class="op" id="6045902">[</span><span class="op" id="6045903">]</span><span class="builtintype" id="6045904">byte</span><span class="op" id="6045908">,</span>&nbsp;<span class="ident" id="6045910">size</span>&nbsp;<span class="builtintype" id="6045915">uint32</span><span class="op" id="6045921">)</span>&nbsp;<span class="builtintype" id="6045923">int</span>&nbsp;<span class="op" id="6045927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045930">if</span>&nbsp;<span class="ident" id="6045933"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045910">size</a></span>&nbsp;<span class="op" id="6045938">&gt;</span>&nbsp;<span class="num" id="6045940">127</span>&nbsp;<span class="op" id="6045944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045948"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045910">size</a></span>&nbsp;<span class="op" id="6045953">|=</span>&nbsp;<span class="num" id="6045956">1</span>&nbsp;<span class="op" id="6045958">&lt;&lt;</span>&nbsp;<span class="num" id="6045961">31</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045966"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041580">binary</a></span><span class="op" id="6045972">.</span><span class="ident" id="6045973"><a href="/gostd/encoding/binary/binary.go.html#2987146">BigEndian</a></span><span class="op" id="6045982">.</span><span class="ident" id="6045983"><a href="/gostd/encoding/binary/binary.go.html#2988537">PutUint32</a></span><span class="op" id="6045992">(</span><span class="ident" id="6045993"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045900">b</a></span><span class="op" id="6045994">,</span>&nbsp;<span class="ident" id="6045996"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045910">size</a></span><span class="op" id="6046000">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046004">return</span>&nbsp;<span class="num" id="6046011">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046017"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045900">b</a></span><span class="op" id="6046018">[</span><span class="num" id="6046019">0</span><span class="op" id="6046020">]</span>&nbsp;<span class="op" id="6046022">=</span>&nbsp;<span class="builtintype" id="6046024">byte</span><span class="op" id="6046028">(</span><span class="ident" id="6046029"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045910">size</a></span><span class="op" id="6046033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046036">return</span>&nbsp;<span class="num" id="6046043">1</span><br>
<span class="lineno"></span><span class="op" id="6046045">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="6046048">//&nbsp;bufWriter&nbsp;encapsulates&nbsp;bufio.Writer&nbsp;but&nbsp;also&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;stream&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6046130">//&nbsp;Closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6046141">type</span>&nbsp;<span class="ident" id="6046146">bufWriter</span>&nbsp;<span class="keyword" id="6046156">struct</span>&nbsp;<span class="op" id="6046163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046166">closer</span>&nbsp;<span class="ident" id="6046173"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041609">io</a></span><span class="op" id="6046175">.</span><span class="ident" id="6046176"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046184">*</span><span class="ident" id="6046185"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041562">bufio</a></span><span class="op" id="6046190">.</span><span class="ident" id="6046191"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><br>
<span class="lineno"></span><span class="op" id="6046198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6046201">func</span>&nbsp;<span class="op" id="6046206">(</span><span class="ident" id="6046207">w</span>&nbsp;<span class="op" id="6046209">*</span><span class="ident" id="6046210"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046146">bufWriter</a></span><span class="op" id="6046219">)</span>&nbsp;<span class="ident" id="6046221">Close</span><span class="op" id="6046226">(</span><span class="op" id="6046227">)</span>&nbsp;<span class="builtintype" id="6046229">error</span>&nbsp;<span class="op" id="6046235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046238">if</span>&nbsp;<span class="ident" id="6046241">err</span>&nbsp;<span class="op" id="6046245">:=</span>&nbsp;<span class="ident" id="6046248"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046207">w</a></span><span class="op" id="6046249">.</span><span class="ident" id="6046250"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046184">Writer</a></span><span class="op" id="6046256">.</span><span class="ident" id="6046257"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="6046262">(</span><span class="op" id="6046263">)</span><span class="op" id="6046264">;</span>&nbsp;<span class="ident" id="6046266"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046241">err</a></span>&nbsp;<span class="op" id="6046270">!=</span>&nbsp;<span class="builtintype" id="6046273">nil</span>&nbsp;<span class="op" id="6046277">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046281"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046207">w</a></span><span class="op" id="6046282">.</span><span class="ident" id="6046283"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046166">closer</a></span><span class="op" id="6046289">.</span><span class="ident" id="6046290"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6046295">(</span><span class="op" id="6046296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046300">return</span>&nbsp;<span class="ident" id="6046307"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046241">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046315">return</span>&nbsp;<span class="ident" id="6046322"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046207">w</a></span><span class="op" id="6046323">.</span><span class="ident" id="6046324"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046166">closer</a></span><span class="op" id="6046330">.</span><span class="ident" id="6046331"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6046336">(</span><span class="op" id="6046337">)</span><br>
<span class="lineno"></span><span class="op" id="6046339">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6046342">func</span>&nbsp;<span class="ident" id="6046347">newWriter</span><span class="op" id="6046356">(</span><span class="ident" id="6046357">c</span>&nbsp;<span class="op" id="6046359">*</span><span class="ident" id="6046360"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><span class="op" id="6046364">,</span>&nbsp;<span class="ident" id="6046366">recType</span>&nbsp;<span class="ident" id="6046374"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><span class="op" id="6046381">,</span>&nbsp;<span class="ident" id="6046383">reqId</span>&nbsp;<span class="builtintype" id="6046389">uint16</span><span class="op" id="6046395">)</span>&nbsp;<span class="op" id="6046397">*</span><span class="ident" id="6046398"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046146">bufWriter</a></span>&nbsp;<span class="op" id="6046408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046411">s</span>&nbsp;<span class="op" id="6046413">:=</span>&nbsp;<span class="op" id="6046416">&amp;</span><span class="ident" id="6046417"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046664">streamWriter</a></span><span class="op" id="6046429">{</span><span class="ident" id="6046430"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046687">c</a></span><span class="op" id="6046431">:</span>&nbsp;<span class="ident" id="6046433"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046357">c</a></span><span class="op" id="6046434">,</span>&nbsp;<span class="ident" id="6046436"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046702">recType</a></span><span class="op" id="6046443">:</span>&nbsp;<span class="ident" id="6046445"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046366">recType</a></span><span class="op" id="6046452">,</span>&nbsp;<span class="ident" id="6046454"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046719">reqId</a></span><span class="op" id="6046459">:</span>&nbsp;<span class="ident" id="6046461"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046383">reqId</a></span><span class="op" id="6046466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046469">w</span>&nbsp;<span class="op" id="6046471">:=</span>&nbsp;<span class="ident" id="6046474"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041562">bufio</a></span><span class="op" id="6046479">.</span><span class="ident" id="6046480"><a href="/gostd/bufio/bufio.go.html#1366830">NewWriterSize</a></span><span class="op" id="6046493">(</span><span class="ident" id="6046494"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046411">s</a></span><span class="op" id="6046495">,</span>&nbsp;<span class="ident" id="6046497"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042227">maxWrite</a></span><span class="op" id="6046505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046508">return</span>&nbsp;<span class="op" id="6046515">&amp;</span><span class="ident" id="6046516"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046146">bufWriter</a></span><span class="op" id="6046525">{</span><span class="ident" id="6046526"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046411">s</a></span><span class="op" id="6046527">,</span>&nbsp;<span class="ident" id="6046529"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046469">w</a></span><span class="op" id="6046530">}</span><br>
<span class="lineno">245</span><span class="op" id="6046532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6046535">//&nbsp;streamWriter&nbsp;abstracts&nbsp;out&nbsp;the&nbsp;separation&nbsp;of&nbsp;a&nbsp;stream&nbsp;into&nbsp;discrete&nbsp;records.</span><br>
<span class="lineno"></span><span class="comment" id="6046615">//&nbsp;It&nbsp;only&nbsp;writes&nbsp;maxWrite&nbsp;bytes&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6046659">type</span>&nbsp;<span class="ident" id="6046664">streamWriter</span>&nbsp;<span class="keyword" id="6046677">struct</span>&nbsp;<span class="op" id="6046684">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046687">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046695">*</span><span class="ident" id="6046696"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046702">recType</span>&nbsp;<span class="ident" id="6046710"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041728">recType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046719">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6046727">uint16</span><br>
<span class="lineno"></span><span class="op" id="6046734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6046737">func</span>&nbsp;<span class="op" id="6046742">(</span><span class="ident" id="6046743">w</span>&nbsp;<span class="op" id="6046745">*</span><span class="ident" id="6046746"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046664">streamWriter</a></span><span class="op" id="6046758">)</span>&nbsp;<span class="ident" id="6046760">Write</span><span class="op" id="6046765">(</span><span class="ident" id="6046766">p</span>&nbsp;<span class="op" id="6046768">[</span><span class="op" id="6046769">]</span><span class="builtintype" id="6046770">byte</span><span class="op" id="6046774">)</span>&nbsp;<span class="op" id="6046776">(</span><span class="builtintype" id="6046777">int</span><span class="op" id="6046780">,</span>&nbsp;<span class="builtintype" id="6046782">error</span><span class="op" id="6046787">)</span>&nbsp;<span class="op" id="6046789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046792">nn</span>&nbsp;<span class="op" id="6046795">:=</span>&nbsp;<span class="num" id="6046798">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046801">for</span>&nbsp;<span class="builtinfunc" id="6046805">len</span><span class="op" id="6046808">(</span><span class="ident" id="6046809"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046766">p</a></span><span class="op" id="6046810">)</span>&nbsp;<span class="op" id="6046812">&gt;</span>&nbsp;<span class="num" id="6046814">0</span>&nbsp;<span class="op" id="6046816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046820">n</span>&nbsp;<span class="op" id="6046822">:=</span>&nbsp;<span class="builtinfunc" id="6046825">len</span><span class="op" id="6046828">(</span><span class="ident" id="6046829"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046766">p</a></span><span class="op" id="6046830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046834">if</span>&nbsp;<span class="ident" id="6046837"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046820">n</a></span>&nbsp;<span class="op" id="6046839">&gt;</span>&nbsp;<span class="ident" id="6046841"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042227">maxWrite</a></span>&nbsp;<span class="op" id="6046850">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046855"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046820">n</a></span>&nbsp;<span class="op" id="6046857">=</span>&nbsp;<span class="ident" id="6046859"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042227">maxWrite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046874">if</span>&nbsp;<span class="ident" id="6046877">err</span>&nbsp;<span class="op" id="6046881">:=</span>&nbsp;<span class="ident" id="6046884"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046743">w</a></span><span class="op" id="6046885">.</span><span class="ident" id="6046886"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046687">c</a></span><span class="op" id="6046887">.</span><span class="ident" id="6046888"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6046899">(</span><span class="ident" id="6046900"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046743">w</a></span><span class="op" id="6046901">.</span><span class="ident" id="6046902"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046702">recType</a></span><span class="op" id="6046909">,</span>&nbsp;<span class="ident" id="6046911"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046743">w</a></span><span class="op" id="6046912">.</span><span class="ident" id="6046913"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046719">reqId</a></span><span class="op" id="6046918">,</span>&nbsp;<span class="ident" id="6046920"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046766">p</a></span><span class="op" id="6046921">[</span><span class="op" id="6046922">:</span><span class="ident" id="6046923"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046820">n</a></span><span class="op" id="6046924">]</span><span class="op" id="6046925">)</span><span class="op" id="6046926">;</span>&nbsp;<span class="ident" id="6046928"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046877">err</a></span>&nbsp;<span class="op" id="6046932">!=</span>&nbsp;<span class="builtintype" id="6046935">nil</span>&nbsp;<span class="op" id="6046939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046944">return</span>&nbsp;<span class="ident" id="6046951"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046792">nn</a></span><span class="op" id="6046953">,</span>&nbsp;<span class="ident" id="6046955"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046877">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046961">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046965"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046792">nn</a></span>&nbsp;<span class="op" id="6046968">+=</span>&nbsp;<span class="ident" id="6046971"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046820">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046975"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046766">p</a></span>&nbsp;<span class="op" id="6046977">=</span>&nbsp;<span class="ident" id="6046979"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046766">p</a></span><span class="op" id="6046980">[</span><span class="ident" id="6046981"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046820">n</a></span><span class="op" id="6046982">:</span><span class="op" id="6046983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046989">return</span>&nbsp;<span class="ident" id="6046996"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046792">nn</a></span><span class="op" id="6046998">,</span>&nbsp;<span class="builtintype" id="6047000">nil</span><br>
<span class="lineno"></span><span class="op" id="6047004">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6047007">func</span>&nbsp;<span class="op" id="6047012">(</span><span class="ident" id="6047013">w</span>&nbsp;<span class="op" id="6047015">*</span><span class="ident" id="6047016"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046664">streamWriter</a></span><span class="op" id="6047028">)</span>&nbsp;<span class="ident" id="6047030">Close</span><span class="op" id="6047035">(</span><span class="op" id="6047036">)</span>&nbsp;<span class="builtintype" id="6047038">error</span>&nbsp;<span class="op" id="6047044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047047">//&nbsp;send&nbsp;empty&nbsp;record&nbsp;to&nbsp;close&nbsp;the&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047089">return</span>&nbsp;<span class="ident" id="6047096"><a href="/gostd/net/http/fcgi/fcgi.go.html#6047013">w</a></span><span class="op" id="6047097">.</span><span class="ident" id="6047098"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046687">c</a></span><span class="op" id="6047099">.</span><span class="ident" id="6047100"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6047111">(</span><span class="ident" id="6047112"><a href="/gostd/net/http/fcgi/fcgi.go.html#6047013">w</a></span><span class="op" id="6047113">.</span><span class="ident" id="6047114"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046702">recType</a></span><span class="op" id="6047121">,</span>&nbsp;<span class="ident" id="6047123"><a href="/gostd/net/http/fcgi/fcgi.go.html#6047013">w</a></span><span class="op" id="6047124">.</span><span class="ident" id="6047125"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046719">reqId</a></span><span class="op" id="6047130">,</span>&nbsp;<span class="builtintype" id="6047132">nil</span><span class="op" id="6047135">)</span><br>
<span class="lineno"></span><span class="op" id="6047137">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
