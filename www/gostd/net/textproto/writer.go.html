<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4570747">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4570803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4570857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4570908">package</span>&nbsp;<span class="ident" id="4570916">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4570927">import</span>&nbsp;<span class="op" id="4570934">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4570937">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4570946">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4570953">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4570958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4570961">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="4571016">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="4571080">type</span>&nbsp;<span class="ident" id="4571085">Writer</span>&nbsp;<span class="keyword" id="4571092">struct</span>&nbsp;<span class="op" id="4571099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571102">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4571106">*</span><span class="ident" id="4571107">bufio</span><span class="op" id="4571112">.</span><span class="ident" id="4571113">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571121">dot</span>&nbsp;<span class="op" id="4571125">*</span><span class="ident" id="4571126">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="4571136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4571139">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4571187">func</span>&nbsp;<span class="ident" id="4571192">NewWriter</span><span class="op" id="4571201">(</span><span class="ident" id="4571202">w</span>&nbsp;<span class="op" id="4571204">*</span><span class="ident" id="4571205">bufio</span><span class="op" id="4571210">.</span><span class="ident" id="4571211">Writer</span><span class="op" id="4571217">)</span>&nbsp;<span class="op" id="4571219">*</span><span class="ident" id="4571220">Writer</span>&nbsp;<span class="op" id="4571227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571230">return</span>&nbsp;<span class="op" id="4571237">&amp;</span><span class="ident" id="4571238">Writer</span><span class="op" id="4571244">{</span><span class="ident" id="4571245">W</span><span class="op" id="4571246">:</span>&nbsp;<span class="ident" id="4571248">w</span><span class="op" id="4571249">}</span><br>
<span class="lineno"></span><span class="op" id="4571251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4571254">var</span>&nbsp;<span class="ident" id="4571258">crnl</span>&nbsp;<span class="op" id="4571263">=</span>&nbsp;<span class="op" id="4571265">[</span><span class="op" id="4571266">]</span><span class="builtintype" id="4571267">byte</span><span class="op" id="4571271">{</span><span class="string" id="4571272">&#39;\r&#39;</span><span class="op" id="4571276">,</span>&nbsp;<span class="string" id="4571278">&#39;\n&#39;</span><span class="op" id="4571282">}</span><br>
<span class="lineno"></span><span class="keyword" id="4571284">var</span>&nbsp;<span class="ident" id="4571288">dotcrnl</span>&nbsp;<span class="op" id="4571296">=</span>&nbsp;<span class="op" id="4571298">[</span><span class="op" id="4571299">]</span><span class="builtintype" id="4571300">byte</span><span class="op" id="4571304">{</span><span class="string" id="4571305">&#39;.&#39;</span><span class="op" id="4571308">,</span>&nbsp;<span class="string" id="4571310">&#39;\r&#39;</span><span class="op" id="4571314">,</span>&nbsp;<span class="string" id="4571316">&#39;\n&#39;</span><span class="op" id="4571320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4571323">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="4571383">func</span>&nbsp;<span class="op" id="4571388">(</span><span class="ident" id="4571389">w</span>&nbsp;<span class="op" id="4571391">*</span><span class="ident" id="4571392">Writer</span><span class="op" id="4571398">)</span>&nbsp;<span class="ident" id="4571400">PrintfLine</span><span class="op" id="4571410">(</span><span class="ident" id="4571411">format</span>&nbsp;<span class="builtintype" id="4571418">string</span><span class="op" id="4571424">,</span>&nbsp;<span class="ident" id="4571426">args</span>&nbsp;<span class="op" id="4571431">...</span><span class="keyword" id="4571434">interface</span><span class="op" id="4571443">{</span><span class="op" id="4571444">}</span><span class="op" id="4571445">)</span>&nbsp;<span class="builtintype" id="4571447">error</span>&nbsp;<span class="op" id="4571453">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571456">w</span><span class="op" id="4571457">.</span><span class="ident" id="4571458">closeDot</span><span class="op" id="4571466">(</span><span class="op" id="4571467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571470">fmt</span><span class="op" id="4571473">.</span><span class="ident" id="4571474">Fprintf</span><span class="op" id="4571481">(</span><span class="ident" id="4571482">w</span><span class="op" id="4571483">.</span><span class="ident" id="4571484">W</span><span class="op" id="4571485">,</span>&nbsp;<span class="ident" id="4571487">format</span><span class="op" id="4571493">,</span>&nbsp;<span class="ident" id="4571495">args</span><span class="op" id="4571499">...</span><span class="op" id="4571502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571505">w</span><span class="op" id="4571506">.</span><span class="ident" id="4571507">W</span><span class="op" id="4571508">.</span><span class="ident" id="4571509">Write</span><span class="op" id="4571514">(</span><span class="ident" id="4571515">crnl</span><span class="op" id="4571519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4571522">return</span>&nbsp;<span class="ident" id="4571529">w</span><span class="op" id="4571530">.</span><span class="ident" id="4571531">W</span><span class="op" id="4571532">.</span><span class="ident" id="4571533">Flush</span><span class="op" id="4571538">(</span><span class="op" id="4571539">)</span><br>
<span class="lineno"></span><span class="op" id="4571541">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4571544">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4571621">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="4571680">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4571753">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="4571815">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4571867">//</span><br>
<span class="lineno"></span><span class="comment" id="4571870">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4571957">func</span>&nbsp;<span class="op" id="4571962">(</span><span class="ident" id="4571963">w</span>&nbsp;<span class="op" id="4571965">*</span><span class="ident" id="4571966">Writer</span><span class="op" id="4571972">)</span>&nbsp;<span class="ident" id="4571974">DotWriter</span><span class="op" id="4571983">(</span><span class="op" id="4571984">)</span>&nbsp;<span class="ident" id="4571986">io</span><span class="op" id="4571988">.</span><span class="ident" id="4571989">WriteCloser</span>&nbsp;<span class="op" id="4572001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572004">w</span><span class="op" id="4572005">.</span><span class="ident" id="4572006">closeDot</span><span class="op" id="4572014">(</span><span class="op" id="4572015">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572018">w</span><span class="op" id="4572019">.</span><span class="ident" id="4572020">dot</span>&nbsp;<span class="op" id="4572024">=</span>&nbsp;<span class="op" id="4572026">&amp;</span><span class="ident" id="4572027">dotWriter</span><span class="op" id="4572036">{</span><span class="ident" id="4572037">w</span><span class="op" id="4572038">:</span>&nbsp;<span class="ident" id="4572040">w</span><span class="op" id="4572041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572044">return</span>&nbsp;<span class="ident" id="4572051">w</span><span class="op" id="4572052">.</span><span class="ident" id="4572053">dot</span><br>
<span class="lineno"></span><span class="op" id="4572057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4572060">func</span>&nbsp;<span class="op" id="4572065">(</span><span class="ident" id="4572066">w</span>&nbsp;<span class="op" id="4572068">*</span><span class="ident" id="4572069">Writer</span><span class="op" id="4572075">)</span>&nbsp;<span class="ident" id="4572077">closeDot</span><span class="op" id="4572085">(</span><span class="op" id="4572086">)</span>&nbsp;<span class="op" id="4572088">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572091">if</span>&nbsp;<span class="ident" id="4572094">w</span><span class="op" id="4572095">.</span><span class="ident" id="4572096">dot</span>&nbsp;<span class="op" id="4572100">!=</span>&nbsp;<span class="ident" id="4572103">nil</span>&nbsp;<span class="op" id="4572107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572111">w</span><span class="op" id="4572112">.</span><span class="ident" id="4572113">dot</span><span class="op" id="4572116">.</span><span class="ident" id="4572117">Close</span><span class="op" id="4572122">(</span><span class="op" id="4572123">)</span>&nbsp;<span class="comment" id="4572125">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572146">}</span><br>
<span class="lineno"></span><span class="op" id="4572148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4572151">type</span>&nbsp;<span class="ident" id="4572156">dotWriter</span>&nbsp;<span class="keyword" id="4572166">struct</span>&nbsp;<span class="op" id="4572173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572176">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4572182">*</span><span class="ident" id="4572183">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572191">state</span>&nbsp;<span class="builtintype" id="4572197">int</span><br>
<span class="lineno"></span><span class="op" id="4572201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4572204">const</span>&nbsp;<span class="op" id="4572210">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572213">wstateBeginLine</span>&nbsp;<span class="op" id="4572229">=</span>&nbsp;<span class="ident" id="4572231">iota</span>&nbsp;<span class="comment" id="4572236">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572287">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572310">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572349">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4572372">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="4572406">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4572409">func</span>&nbsp;<span class="op" id="4572414">(</span><span class="ident" id="4572415">d</span>&nbsp;<span class="op" id="4572417">*</span><span class="ident" id="4572418">dotWriter</span><span class="op" id="4572427">)</span>&nbsp;<span class="ident" id="4572429">Write</span><span class="op" id="4572434">(</span><span class="ident" id="4572435">b</span>&nbsp;<span class="op" id="4572437">[</span><span class="op" id="4572438">]</span><span class="builtintype" id="4572439">byte</span><span class="op" id="4572443">)</span>&nbsp;<span class="op" id="4572445">(</span><span class="ident" id="4572446">n</span>&nbsp;<span class="builtintype" id="4572448">int</span><span class="op" id="4572451">,</span>&nbsp;<span class="ident" id="4572453">err</span>&nbsp;<span class="builtintype" id="4572457">error</span><span class="op" id="4572462">)</span>&nbsp;<span class="op" id="4572464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572467">bw</span>&nbsp;<span class="op" id="4572470">:=</span>&nbsp;<span class="ident" id="4572473">d</span><span class="op" id="4572474">.</span><span class="ident" id="4572475">w</span><span class="op" id="4572476">.</span><span class="ident" id="4572477">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572480">for</span>&nbsp;<span class="ident" id="4572484">n</span>&nbsp;<span class="op" id="4572486">&lt;</span>&nbsp;<span class="builtinfunc" id="4572488">len</span><span class="op" id="4572491">(</span><span class="ident" id="4572492">b</span><span class="op" id="4572493">)</span>&nbsp;<span class="op" id="4572495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572499">c</span>&nbsp;<span class="op" id="4572501">:=</span>&nbsp;<span class="ident" id="4572504">b</span><span class="op" id="4572505">[</span><span class="ident" id="4572506">n</span><span class="op" id="4572507">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572511">switch</span>&nbsp;<span class="ident" id="4572518">d</span><span class="op" id="4572519">.</span><span class="ident" id="4572520">state</span>&nbsp;<span class="op" id="4572526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572530">case</span>&nbsp;<span class="ident" id="4572535">wstateBeginLine</span><span class="op" id="4572550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572555">d</span><span class="op" id="4572556">.</span><span class="ident" id="4572557">state</span>&nbsp;<span class="op" id="4572563">=</span>&nbsp;<span class="ident" id="4572565">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572579">if</span>&nbsp;<span class="ident" id="4572582">c</span>&nbsp;<span class="op" id="4572584">==</span>&nbsp;<span class="string" id="4572587">&#39;.&#39;</span>&nbsp;<span class="op" id="4572591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4572597">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572623">bw</span><span class="op" id="4572625">.</span><span class="ident" id="4572626">WriteByte</span><span class="op" id="4572635">(</span><span class="string" id="4572636">&#39;.&#39;</span><span class="op" id="4572639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572649">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572664">case</span>&nbsp;<span class="ident" id="4572669">wstateData</span><span class="op" id="4572679">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572684">if</span>&nbsp;<span class="ident" id="4572687">c</span>&nbsp;<span class="op" id="4572689">==</span>&nbsp;<span class="string" id="4572692">&#39;\r&#39;</span>&nbsp;<span class="op" id="4572697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572703">d</span><span class="op" id="4572704">.</span><span class="ident" id="4572705">state</span>&nbsp;<span class="op" id="4572711">=</span>&nbsp;<span class="ident" id="4572713">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572730">if</span>&nbsp;<span class="ident" id="4572733">c</span>&nbsp;<span class="op" id="4572735">==</span>&nbsp;<span class="string" id="4572738">&#39;\n&#39;</span>&nbsp;<span class="op" id="4572743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572749">bw</span><span class="op" id="4572751">.</span><span class="ident" id="4572752">WriteByte</span><span class="op" id="4572761">(</span><span class="string" id="4572762">&#39;\r&#39;</span><span class="op" id="4572766">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572772">d</span><span class="op" id="4572773">.</span><span class="ident" id="4572774">state</span>&nbsp;<span class="op" id="4572780">=</span>&nbsp;<span class="ident" id="4572782">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572806">case</span>&nbsp;<span class="ident" id="4572811">wstateCR</span><span class="op" id="4572819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572824">d</span><span class="op" id="4572825">.</span><span class="ident" id="4572826">state</span>&nbsp;<span class="op" id="4572832">=</span>&nbsp;<span class="ident" id="4572834">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572848">if</span>&nbsp;<span class="ident" id="4572851">c</span>&nbsp;<span class="op" id="4572853">==</span>&nbsp;<span class="string" id="4572856">&#39;\n&#39;</span>&nbsp;<span class="op" id="4572861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572867">d</span><span class="op" id="4572868">.</span><span class="ident" id="4572869">state</span>&nbsp;<span class="op" id="4572875">=</span>&nbsp;<span class="ident" id="4572877">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572904">if</span>&nbsp;<span class="ident" id="4572907">err</span>&nbsp;<span class="op" id="4572911">=</span>&nbsp;<span class="ident" id="4572913">bw</span><span class="op" id="4572915">.</span><span class="ident" id="4572916">WriteByte</span><span class="op" id="4572925">(</span><span class="ident" id="4572926">c</span><span class="op" id="4572927">)</span><span class="op" id="4572928">;</span>&nbsp;<span class="ident" id="4572930">err</span>&nbsp;<span class="op" id="4572934">!=</span>&nbsp;<span class="ident" id="4572937">nil</span>&nbsp;<span class="op" id="4572941">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4572958">n</span><span class="op" id="4572959">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4572963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4572966">return</span><br>
<span class="lineno">100</span><span class="op" id="4572973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4572976">func</span>&nbsp;<span class="op" id="4572981">(</span><span class="ident" id="4572982">d</span>&nbsp;<span class="op" id="4572984">*</span><span class="ident" id="4572985">dotWriter</span><span class="op" id="4572994">)</span>&nbsp;<span class="ident" id="4572996">Close</span><span class="op" id="4573001">(</span><span class="op" id="4573002">)</span>&nbsp;<span class="builtintype" id="4573004">error</span>&nbsp;<span class="op" id="4573010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573013">if</span>&nbsp;<span class="ident" id="4573016">d</span><span class="op" id="4573017">.</span><span class="ident" id="4573018">w</span><span class="op" id="4573019">.</span><span class="ident" id="4573020">dot</span>&nbsp;<span class="op" id="4573024">==</span>&nbsp;<span class="ident" id="4573027">d</span>&nbsp;<span class="op" id="4573029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573033">d</span><span class="op" id="4573034">.</span><span class="ident" id="4573035">w</span><span class="op" id="4573036">.</span><span class="ident" id="4573037">dot</span>&nbsp;<span class="op" id="4573041">=</span>&nbsp;<span class="ident" id="4573043">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4573048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573051">bw</span>&nbsp;<span class="op" id="4573054">:=</span>&nbsp;<span class="ident" id="4573057">d</span><span class="op" id="4573058">.</span><span class="ident" id="4573059">w</span><span class="op" id="4573060">.</span><span class="ident" id="4573061">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573064">switch</span>&nbsp;<span class="ident" id="4573071">d</span><span class="op" id="4573072">.</span><span class="ident" id="4573073">state</span>&nbsp;<span class="op" id="4573079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573082">default</span><span class="op" id="4573089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573093">bw</span><span class="op" id="4573095">.</span><span class="ident" id="4573096">WriteByte</span><span class="op" id="4573105">(</span><span class="string" id="4573106">&#39;\r&#39;</span><span class="op" id="4573110">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573114">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573127">case</span>&nbsp;<span class="ident" id="4573132">wstateCR</span><span class="op" id="4573140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573144">bw</span><span class="op" id="4573146">.</span><span class="ident" id="4573147">WriteByte</span><span class="op" id="4573156">(</span><span class="string" id="4573157">&#39;\n&#39;</span><span class="op" id="4573161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573165">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573178">case</span>&nbsp;<span class="ident" id="4573183">wstateBeginLine</span><span class="op" id="4573198">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4573202">bw</span><span class="op" id="4573204">.</span><span class="ident" id="4573205">Write</span><span class="op" id="4573210">(</span><span class="ident" id="4573211">dotcrnl</span><span class="op" id="4573218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4573221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4573224">return</span>&nbsp;<span class="ident" id="4573231">bw</span><span class="op" id="4573233">.</span><span class="ident" id="4573234">Flush</span><span class="op" id="4573239">(</span><span class="op" id="4573240">)</span><br>
<span class="lineno"></span><span class="op" id="4573242">}</span>
</div>
</body>
</html>
