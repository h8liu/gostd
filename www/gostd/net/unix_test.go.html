<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8365465">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8365521">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8365575">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8365626">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365659">package</span>&nbsp;<span class="ident" id="8365667">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365672">import</span>&nbsp;<span class="op" id="8365679">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365682">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365691">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365697">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365708">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365719">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365730">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8365741">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8365748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8365751">func</span>&nbsp;<span class="ident" id="8365756">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="8365789">(</span><span class="ident" id="8365790">t</span>&nbsp;<span class="op" id="8365792">*</span><span class="ident" id="8365793">testing</span><span class="op" id="8365800">.</span><span class="ident" id="8365801">T</span><span class="op" id="8365802">)</span>&nbsp;<span class="op" id="8365804">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365807">addr</span>&nbsp;<span class="op" id="8365812">:=</span>&nbsp;<span class="ident" id="8365815">testUnixAddr</span><span class="op" id="8365827">(</span><span class="op" id="8365828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365831">la</span><span class="op" id="8365833">,</span>&nbsp;<span class="ident" id="8365835">err</span>&nbsp;<span class="op" id="8365839">:=</span>&nbsp;<span class="ident" id="8365842">ResolveUnixAddr</span><span class="op" id="8365857">(</span><span class="string" id="8365858">&#34;unixgram&#34;</span><span class="op" id="8365868">,</span>&nbsp;<span class="ident" id="8365870">addr</span><span class="op" id="8365874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365877">if</span>&nbsp;<span class="ident" id="8365880">err</span>&nbsp;<span class="op" id="8365884">!=</span>&nbsp;<span class="ident" id="8365887">nil</span>&nbsp;<span class="op" id="8365891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365895">t</span><span class="op" id="8365896">.</span><span class="ident" id="8365897">Fatalf</span><span class="op" id="8365903">(</span><span class="string" id="8365904">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8365932">,</span>&nbsp;<span class="ident" id="8365934">err</span><span class="op" id="8365937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365940">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365943">c</span><span class="op" id="8365944">,</span>&nbsp;<span class="ident" id="8365946">err</span>&nbsp;<span class="op" id="8365950">:=</span>&nbsp;<span class="ident" id="8365953">ListenUnixgram</span><span class="op" id="8365967">(</span><span class="string" id="8365968">&#34;unixgram&#34;</span><span class="op" id="8365978">,</span>&nbsp;<span class="ident" id="8365980">la</span><span class="op" id="8365982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365985">if</span>&nbsp;<span class="ident" id="8365988">err</span>&nbsp;<span class="op" id="8365992">!=</span>&nbsp;<span class="ident" id="8365995">nil</span>&nbsp;<span class="op" id="8365999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366003">t</span><span class="op" id="8366004">.</span><span class="ident" id="8366005">Fatalf</span><span class="op" id="8366011">(</span><span class="string" id="8366012">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8366039">,</span>&nbsp;<span class="ident" id="8366041">err</span><span class="op" id="8366044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366050">defer</span>&nbsp;<span class="keyword" id="8366056">func</span><span class="op" id="8366060">(</span><span class="op" id="8366061">)</span>&nbsp;<span class="op" id="8366063">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366067">c</span><span class="op" id="8366068">.</span><span class="ident" id="8366069">Close</span><span class="op" id="8366074">(</span><span class="op" id="8366075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366079">os</span><span class="op" id="8366081">.</span><span class="ident" id="8366082">Remove</span><span class="op" id="8366088">(</span><span class="ident" id="8366089">addr</span><span class="op" id="8366093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366096">}</span><span class="op" id="8366097">(</span><span class="op" id="8366098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366102">off</span>&nbsp;<span class="op" id="8366106">:=</span>&nbsp;<span class="builtinfunc" id="8366109">make</span><span class="op" id="8366113">(</span><span class="keyword" id="8366114">chan</span>&nbsp;<span class="builtintype" id="8366119">bool</span><span class="op" id="8366123">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366126">data</span>&nbsp;<span class="op" id="8366131">:=</span>&nbsp;<span class="op" id="8366134">[</span><span class="num" id="8366135">5</span><span class="op" id="8366136">]</span><span class="builtintype" id="8366137">byte</span><span class="op" id="8366141">{</span><span class="num" id="8366142">1</span><span class="op" id="8366143">,</span>&nbsp;<span class="num" id="8366145">2</span><span class="op" id="8366146">,</span>&nbsp;<span class="num" id="8366148">3</span><span class="op" id="8366149">,</span>&nbsp;<span class="num" id="8366151">4</span><span class="op" id="8366152">,</span>&nbsp;<span class="num" id="8366154">5</span><span class="op" id="8366155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366158">go</span>&nbsp;<span class="keyword" id="8366161">func</span><span class="op" id="8366165">(</span><span class="op" id="8366166">)</span>&nbsp;<span class="op" id="8366168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366172">defer</span>&nbsp;<span class="keyword" id="8366178">func</span><span class="op" id="8366182">(</span><span class="op" id="8366183">)</span>&nbsp;<span class="op" id="8366185">{</span>&nbsp;<span class="ident" id="8366187">off</span>&nbsp;<span class="op" id="8366191">&lt;-</span>&nbsp;<span class="builtintype" id="8366194">true</span>&nbsp;<span class="op" id="8366199">}</span><span class="op" id="8366200">(</span><span class="op" id="8366201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366205">s</span><span class="op" id="8366206">,</span>&nbsp;<span class="ident" id="8366208">err</span>&nbsp;<span class="op" id="8366212">:=</span>&nbsp;<span class="ident" id="8366215">syscall</span><span class="op" id="8366222">.</span><span class="ident" id="8366223">Socket</span><span class="op" id="8366229">(</span><span class="ident" id="8366230">syscall</span><span class="op" id="8366237">.</span><span class="ident" id="8366238">AF_UNIX</span><span class="op" id="8366245">,</span>&nbsp;<span class="ident" id="8366247">syscall</span><span class="op" id="8366254">.</span><span class="ident" id="8366255">SOCK_DGRAM</span><span class="op" id="8366265">,</span>&nbsp;<span class="num" id="8366267">0</span><span class="op" id="8366268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366272">if</span>&nbsp;<span class="ident" id="8366275">err</span>&nbsp;<span class="op" id="8366279">!=</span>&nbsp;<span class="ident" id="8366282">nil</span>&nbsp;<span class="op" id="8366286">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366291">t</span><span class="op" id="8366292">.</span><span class="ident" id="8366293">Errorf</span><span class="op" id="8366299">(</span><span class="string" id="8366300">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8366327">,</span>&nbsp;<span class="ident" id="8366329">err</span><span class="op" id="8366332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366337">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366350">defer</span>&nbsp;<span class="ident" id="8366356">syscall</span><span class="op" id="8366363">.</span><span class="ident" id="8366364">Close</span><span class="op" id="8366369">(</span><span class="ident" id="8366370">s</span><span class="op" id="8366371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366375">rsa</span>&nbsp;<span class="op" id="8366379">:=</span>&nbsp;<span class="op" id="8366382">&amp;</span><span class="ident" id="8366383">syscall</span><span class="op" id="8366390">.</span><span class="ident" id="8366391">SockaddrUnix</span><span class="op" id="8366403">{</span><span class="ident" id="8366404">Name</span><span class="op" id="8366408">:</span>&nbsp;<span class="ident" id="8366410">addr</span><span class="op" id="8366414">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366418">if</span>&nbsp;<span class="ident" id="8366421">err</span>&nbsp;<span class="op" id="8366425">:=</span>&nbsp;<span class="ident" id="8366428">syscall</span><span class="op" id="8366435">.</span><span class="ident" id="8366436">Sendto</span><span class="op" id="8366442">(</span><span class="ident" id="8366443">s</span><span class="op" id="8366444">,</span>&nbsp;<span class="ident" id="8366446">data</span><span class="op" id="8366450">[</span><span class="op" id="8366451">:</span><span class="op" id="8366452">]</span><span class="op" id="8366453">,</span>&nbsp;<span class="num" id="8366455">0</span><span class="op" id="8366456">,</span>&nbsp;<span class="ident" id="8366458">rsa</span><span class="op" id="8366461">)</span><span class="op" id="8366462">;</span>&nbsp;<span class="ident" id="8366464">err</span>&nbsp;<span class="op" id="8366468">!=</span>&nbsp;<span class="ident" id="8366471">nil</span>&nbsp;<span class="op" id="8366475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366480">t</span><span class="op" id="8366481">.</span><span class="ident" id="8366482">Errorf</span><span class="op" id="8366488">(</span><span class="string" id="8366489">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8366516">,</span>&nbsp;<span class="ident" id="8366518">err</span><span class="op" id="8366521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366526">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366538">}</span><span class="op" id="8366539">(</span><span class="op" id="8366540">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366544">&lt;-</span><span class="ident" id="8366546">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366551">b</span>&nbsp;<span class="op" id="8366553">:=</span>&nbsp;<span class="builtinfunc" id="8366556">make</span><span class="op" id="8366560">(</span><span class="op" id="8366561">[</span><span class="op" id="8366562">]</span><span class="builtintype" id="8366563">byte</span><span class="op" id="8366567">,</span>&nbsp;<span class="num" id="8366569">64</span><span class="op" id="8366571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366574">c</span><span class="op" id="8366575">.</span><span class="ident" id="8366576">SetReadDeadline</span><span class="op" id="8366591">(</span><span class="ident" id="8366592">time</span><span class="op" id="8366596">.</span><span class="ident" id="8366597">Now</span><span class="op" id="8366600">(</span><span class="op" id="8366601">)</span><span class="op" id="8366602">.</span><span class="ident" id="8366603">Add</span><span class="op" id="8366606">(</span><span class="num" id="8366607">100</span>&nbsp;<span class="op" id="8366611">*</span>&nbsp;<span class="ident" id="8366613">time</span><span class="op" id="8366617">.</span><span class="ident" id="8366618">Millisecond</span><span class="op" id="8366629">)</span><span class="op" id="8366630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366633">n</span><span class="op" id="8366634">,</span>&nbsp;<span class="ident" id="8366636">from</span><span class="op" id="8366640">,</span>&nbsp;<span class="ident" id="8366642">err</span>&nbsp;<span class="op" id="8366646">:=</span>&nbsp;<span class="ident" id="8366649">c</span><span class="op" id="8366650">.</span><span class="ident" id="8366651">ReadFrom</span><span class="op" id="8366659">(</span><span class="ident" id="8366660">b</span><span class="op" id="8366661">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366664">if</span>&nbsp;<span class="ident" id="8366667">err</span>&nbsp;<span class="op" id="8366671">!=</span>&nbsp;<span class="ident" id="8366674">nil</span>&nbsp;<span class="op" id="8366678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366682">t</span><span class="op" id="8366683">.</span><span class="ident" id="8366684">Fatalf</span><span class="op" id="8366690">(</span><span class="string" id="8366691">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8366721">,</span>&nbsp;<span class="ident" id="8366723">err</span><span class="op" id="8366726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366732">if</span>&nbsp;<span class="ident" id="8366735">from</span>&nbsp;<span class="op" id="8366740">!=</span>&nbsp;<span class="ident" id="8366743">nil</span>&nbsp;<span class="op" id="8366747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366751">t</span><span class="op" id="8366752">.</span><span class="ident" id="8366753">Fatalf</span><span class="op" id="8366759">(</span><span class="string" id="8366760">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8366784">,</span>&nbsp;<span class="ident" id="8366786">from</span><span class="op" id="8366790">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8366796">if</span>&nbsp;<span class="op" id="8366799">!</span><span class="ident" id="8366800">bytes</span><span class="op" id="8366805">.</span><span class="ident" id="8366806">Equal</span><span class="op" id="8366811">(</span><span class="ident" id="8366812">b</span><span class="op" id="8366813">[</span><span class="op" id="8366814">:</span><span class="ident" id="8366815">n</span><span class="op" id="8366816">]</span><span class="op" id="8366817">,</span>&nbsp;<span class="ident" id="8366819">data</span><span class="op" id="8366823">[</span><span class="op" id="8366824">:</span><span class="op" id="8366825">]</span><span class="op" id="8366826">)</span>&nbsp;<span class="op" id="8366828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8366832">t</span><span class="op" id="8366833">.</span><span class="ident" id="8366834">Fatalf</span><span class="op" id="8366840">(</span><span class="string" id="8366841">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8366858">,</span>&nbsp;<span class="ident" id="8366860">b</span><span class="op" id="8366861">[</span><span class="op" id="8366862">:</span><span class="ident" id="8366863">n</span><span class="op" id="8366864">]</span><span class="op" id="8366865">,</span>&nbsp;<span class="ident" id="8366867">data</span><span class="op" id="8366871">[</span><span class="op" id="8366872">:</span><span class="op" id="8366873">]</span><span class="op" id="8366874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8366877">}</span><br>
<span class="lineno"></span><span class="op" id="8366879">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8366882">func</span>&nbsp;<span class="ident" id="8366887">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="8366922">(</span><span class="ident" id="8366923">t</span>&nbsp;<span class="op" id="8366925">*</span><span class="ident" id="8366926">testing</span><span class="op" id="8366933">.</span><span class="ident" id="8366934">T</span><span class="op" id="8366935">)</span>&nbsp;<span class="op" id="8366937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8366940">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8366997">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367063">addr</span>&nbsp;<span class="op" id="8367068">:=</span>&nbsp;<span class="ident" id="8367071">testUnixAddr</span><span class="op" id="8367083">(</span><span class="op" id="8367084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367087">la</span><span class="op" id="8367089">,</span>&nbsp;<span class="ident" id="8367091">err</span>&nbsp;<span class="op" id="8367095">:=</span>&nbsp;<span class="ident" id="8367098">ResolveUnixAddr</span><span class="op" id="8367113">(</span><span class="string" id="8367114">&#34;unixgram&#34;</span><span class="op" id="8367124">,</span>&nbsp;<span class="ident" id="8367126">addr</span><span class="op" id="8367130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367133">if</span>&nbsp;<span class="ident" id="8367136">err</span>&nbsp;<span class="op" id="8367140">!=</span>&nbsp;<span class="ident" id="8367143">nil</span>&nbsp;<span class="op" id="8367147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367151">t</span><span class="op" id="8367152">.</span><span class="ident" id="8367153">Fatalf</span><span class="op" id="8367159">(</span><span class="string" id="8367160">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8367188">,</span>&nbsp;<span class="ident" id="8367190">err</span><span class="op" id="8367193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367196">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367199">c</span><span class="op" id="8367200">,</span>&nbsp;<span class="ident" id="8367202">err</span>&nbsp;<span class="op" id="8367206">:=</span>&nbsp;<span class="ident" id="8367209">ListenUnixgram</span><span class="op" id="8367223">(</span><span class="string" id="8367224">&#34;unixgram&#34;</span><span class="op" id="8367234">,</span>&nbsp;<span class="ident" id="8367236">la</span><span class="op" id="8367238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367241">if</span>&nbsp;<span class="ident" id="8367244">err</span>&nbsp;<span class="op" id="8367248">!=</span>&nbsp;<span class="ident" id="8367251">nil</span>&nbsp;<span class="op" id="8367255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367259">t</span><span class="op" id="8367260">.</span><span class="ident" id="8367261">Fatalf</span><span class="op" id="8367267">(</span><span class="string" id="8367268">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8367295">,</span>&nbsp;<span class="ident" id="8367297">err</span><span class="op" id="8367300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367306">defer</span>&nbsp;<span class="keyword" id="8367312">func</span><span class="op" id="8367316">(</span><span class="op" id="8367317">)</span>&nbsp;<span class="op" id="8367319">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367323">c</span><span class="op" id="8367324">.</span><span class="ident" id="8367325">Close</span><span class="op" id="8367330">(</span><span class="op" id="8367331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367335">os</span><span class="op" id="8367337">.</span><span class="ident" id="8367338">Remove</span><span class="op" id="8367344">(</span><span class="ident" id="8367345">addr</span><span class="op" id="8367349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367352">}</span><span class="op" id="8367353">(</span><span class="op" id="8367354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367358">off</span>&nbsp;<span class="op" id="8367362">:=</span>&nbsp;<span class="builtinfunc" id="8367365">make</span><span class="op" id="8367369">(</span><span class="keyword" id="8367370">chan</span>&nbsp;<span class="builtintype" id="8367375">bool</span><span class="op" id="8367379">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367382">go</span>&nbsp;<span class="keyword" id="8367385">func</span><span class="op" id="8367389">(</span><span class="op" id="8367390">)</span>&nbsp;<span class="op" id="8367392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367396">defer</span>&nbsp;<span class="keyword" id="8367402">func</span><span class="op" id="8367406">(</span><span class="op" id="8367407">)</span>&nbsp;<span class="op" id="8367409">{</span>&nbsp;<span class="ident" id="8367411">off</span>&nbsp;<span class="op" id="8367415">&lt;-</span>&nbsp;<span class="builtintype" id="8367418">true</span>&nbsp;<span class="op" id="8367423">}</span><span class="op" id="8367424">(</span><span class="op" id="8367425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367429">c</span><span class="op" id="8367430">,</span>&nbsp;<span class="ident" id="8367432">err</span>&nbsp;<span class="op" id="8367436">:=</span>&nbsp;<span class="ident" id="8367439">DialUnix</span><span class="op" id="8367447">(</span><span class="string" id="8367448">&#34;unixgram&#34;</span><span class="op" id="8367458">,</span>&nbsp;<span class="ident" id="8367460">nil</span><span class="op" id="8367463">,</span>&nbsp;<span class="ident" id="8367465">la</span><span class="op" id="8367467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367471">if</span>&nbsp;<span class="ident" id="8367474">err</span>&nbsp;<span class="op" id="8367478">!=</span>&nbsp;<span class="ident" id="8367481">nil</span>&nbsp;<span class="op" id="8367485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367490">t</span><span class="op" id="8367491">.</span><span class="ident" id="8367492">Errorf</span><span class="op" id="8367498">(</span><span class="string" id="8367499">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8367520">,</span>&nbsp;<span class="ident" id="8367522">err</span><span class="op" id="8367525">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367530">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367543">defer</span>&nbsp;<span class="ident" id="8367549">c</span><span class="op" id="8367550">.</span><span class="ident" id="8367551">Close</span><span class="op" id="8367556">(</span><span class="op" id="8367557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367561">if</span>&nbsp;<span class="ident" id="8367564">_</span><span class="op" id="8367565">,</span>&nbsp;<span class="ident" id="8367567">err</span>&nbsp;<span class="op" id="8367571">:=</span>&nbsp;<span class="ident" id="8367574">c</span><span class="op" id="8367575">.</span><span class="ident" id="8367576">Write</span><span class="op" id="8367581">(</span><span class="op" id="8367582">[</span><span class="op" id="8367583">]</span><span class="builtintype" id="8367584">byte</span><span class="op" id="8367588">{</span><span class="num" id="8367589">1</span><span class="op" id="8367590">,</span>&nbsp;<span class="num" id="8367592">2</span><span class="op" id="8367593">,</span>&nbsp;<span class="num" id="8367595">3</span><span class="op" id="8367596">,</span>&nbsp;<span class="num" id="8367598">4</span><span class="op" id="8367599">,</span>&nbsp;<span class="num" id="8367601">5</span><span class="op" id="8367602">}</span><span class="op" id="8367603">)</span><span class="op" id="8367604">;</span>&nbsp;<span class="ident" id="8367606">err</span>&nbsp;<span class="op" id="8367610">!=</span>&nbsp;<span class="ident" id="8367613">nil</span>&nbsp;<span class="op" id="8367617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367622">t</span><span class="op" id="8367623">.</span><span class="ident" id="8367624">Errorf</span><span class="op" id="8367630">(</span><span class="string" id="8367631">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8367658">,</span>&nbsp;<span class="ident" id="8367660">err</span><span class="op" id="8367663">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367668">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367680">}</span><span class="op" id="8367681">(</span><span class="op" id="8367682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367686">&lt;-</span><span class="ident" id="8367688">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367693">c</span><span class="op" id="8367694">.</span><span class="ident" id="8367695">SetReadDeadline</span><span class="op" id="8367710">(</span><span class="ident" id="8367711">time</span><span class="op" id="8367715">.</span><span class="ident" id="8367716">Now</span><span class="op" id="8367719">(</span><span class="op" id="8367720">)</span><span class="op" id="8367721">.</span><span class="ident" id="8367722">Add</span><span class="op" id="8367725">(</span><span class="num" id="8367726">100</span>&nbsp;<span class="op" id="8367730">*</span>&nbsp;<span class="ident" id="8367732">time</span><span class="op" id="8367736">.</span><span class="ident" id="8367737">Millisecond</span><span class="op" id="8367748">)</span><span class="op" id="8367749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367752">_</span><span class="op" id="8367753">,</span>&nbsp;<span class="ident" id="8367755">from</span><span class="op" id="8367759">,</span>&nbsp;<span class="ident" id="8367761">err</span>&nbsp;<span class="op" id="8367765">:=</span>&nbsp;<span class="ident" id="8367768">c</span><span class="op" id="8367769">.</span><span class="ident" id="8367770">ReadFrom</span><span class="op" id="8367778">(</span><span class="ident" id="8367779">nil</span><span class="op" id="8367782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367785">if</span>&nbsp;<span class="ident" id="8367788">err</span>&nbsp;<span class="op" id="8367792">!=</span>&nbsp;<span class="ident" id="8367795">nil</span>&nbsp;<span class="op" id="8367799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367803">t</span><span class="op" id="8367804">.</span><span class="ident" id="8367805">Fatalf</span><span class="op" id="8367811">(</span><span class="string" id="8367812">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8367842">,</span>&nbsp;<span class="ident" id="8367844">err</span><span class="op" id="8367847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367850">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367853">if</span>&nbsp;<span class="ident" id="8367856">from</span>&nbsp;<span class="op" id="8367861">!=</span>&nbsp;<span class="ident" id="8367864">nil</span>&nbsp;<span class="op" id="8367868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367872">t</span><span class="op" id="8367873">.</span><span class="ident" id="8367874">Fatalf</span><span class="op" id="8367880">(</span><span class="string" id="8367881">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8367905">,</span>&nbsp;<span class="ident" id="8367907">from</span><span class="op" id="8367911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8367914">}</span><br>
<span class="lineno"></span><span class="op" id="8367916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8367919">func</span>&nbsp;<span class="ident" id="8367924">TestUnixgramAutobind</span><span class="op" id="8367944">(</span><span class="ident" id="8367945">t</span>&nbsp;<span class="op" id="8367947">*</span><span class="ident" id="8367948">testing</span><span class="op" id="8367955">.</span><span class="ident" id="8367956">T</span><span class="op" id="8367957">)</span>&nbsp;<span class="op" id="8367959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8367962">if</span>&nbsp;<span class="ident" id="8367965">runtime</span><span class="op" id="8367972">.</span><span class="ident" id="8367973">GOOS</span>&nbsp;<span class="op" id="8367978">!=</span>&nbsp;<span class="string" id="8367981">&#34;linux&#34;</span>&nbsp;<span class="op" id="8367989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8367993">t</span><span class="op" id="8367994">.</span><span class="ident" id="8367995">Skip</span><span class="op" id="8367999">(</span><span class="string" id="8368000">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8368034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368041">laddr</span>&nbsp;<span class="op" id="8368047">:=</span>&nbsp;<span class="op" id="8368050">&amp;</span><span class="ident" id="8368051">UnixAddr</span><span class="op" id="8368059">{</span><span class="ident" id="8368060">Name</span><span class="op" id="8368064">:</span>&nbsp;<span class="string" id="8368066">&#34;&#34;</span><span class="op" id="8368068">,</span>&nbsp;<span class="ident" id="8368070">Net</span><span class="op" id="8368073">:</span>&nbsp;<span class="string" id="8368075">&#34;unixgram&#34;</span><span class="op" id="8368085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368088">c1</span><span class="op" id="8368090">,</span>&nbsp;<span class="ident" id="8368092">err</span>&nbsp;<span class="op" id="8368096">:=</span>&nbsp;<span class="ident" id="8368099">ListenUnixgram</span><span class="op" id="8368113">(</span><span class="string" id="8368114">&#34;unixgram&#34;</span><span class="op" id="8368124">,</span>&nbsp;<span class="ident" id="8368126">laddr</span><span class="op" id="8368131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368134">if</span>&nbsp;<span class="ident" id="8368137">err</span>&nbsp;<span class="op" id="8368141">!=</span>&nbsp;<span class="ident" id="8368144">nil</span>&nbsp;<span class="op" id="8368148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368152">t</span><span class="op" id="8368153">.</span><span class="ident" id="8368154">Fatalf</span><span class="op" id="8368160">(</span><span class="string" id="8368161">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8368188">,</span>&nbsp;<span class="ident" id="8368190">err</span><span class="op" id="8368193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368196">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368199">defer</span>&nbsp;<span class="ident" id="8368205">c1</span><span class="op" id="8368207">.</span><span class="ident" id="8368208">Close</span><span class="op" id="8368213">(</span><span class="op" id="8368214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8368218">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368252">autoAddr</span>&nbsp;<span class="op" id="8368261">:=</span>&nbsp;<span class="ident" id="8368264">c1</span><span class="op" id="8368266">.</span><span class="ident" id="8368267">LocalAddr</span><span class="op" id="8368276">(</span><span class="op" id="8368277">)</span><span class="op" id="8368278">.</span><span class="op" id="8368279">(</span><span class="op" id="8368280">*</span><span class="ident" id="8368281">UnixAddr</span><span class="op" id="8368289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368292">if</span>&nbsp;<span class="builtinfunc" id="8368295">len</span><span class="op" id="8368298">(</span><span class="ident" id="8368299">autoAddr</span><span class="op" id="8368307">.</span><span class="ident" id="8368308">Name</span><span class="op" id="8368312">)</span>&nbsp;<span class="op" id="8368314">&lt;=</span>&nbsp;<span class="num" id="8368317">1</span>&nbsp;<span class="op" id="8368319">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368323">t</span><span class="op" id="8368324">.</span><span class="ident" id="8368325">Fatalf</span><span class="op" id="8368331">(</span><span class="string" id="8368332">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8368362">,</span>&nbsp;<span class="ident" id="8368364">autoAddr</span><span class="op" id="8368372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368378">if</span>&nbsp;<span class="ident" id="8368381">autoAddr</span><span class="op" id="8368389">.</span><span class="ident" id="8368390">Name</span><span class="op" id="8368394">[</span><span class="num" id="8368395">0</span><span class="op" id="8368396">]</span>&nbsp;<span class="op" id="8368398">!=</span>&nbsp;<span class="string" id="8368401">&#39;@&#39;</span>&nbsp;<span class="op" id="8368405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368409">t</span><span class="op" id="8368410">.</span><span class="ident" id="8368411">Fatalf</span><span class="op" id="8368417">(</span><span class="string" id="8368418">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8368448">,</span>&nbsp;<span class="ident" id="8368450">autoAddr</span><span class="op" id="8368458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368461">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368465">c2</span><span class="op" id="8368467">,</span>&nbsp;<span class="ident" id="8368469">err</span>&nbsp;<span class="op" id="8368473">:=</span>&nbsp;<span class="ident" id="8368476">DialUnix</span><span class="op" id="8368484">(</span><span class="string" id="8368485">&#34;unixgram&#34;</span><span class="op" id="8368495">,</span>&nbsp;<span class="ident" id="8368497">nil</span><span class="op" id="8368500">,</span>&nbsp;<span class="ident" id="8368502">autoAddr</span><span class="op" id="8368510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368513">if</span>&nbsp;<span class="ident" id="8368516">err</span>&nbsp;<span class="op" id="8368520">!=</span>&nbsp;<span class="ident" id="8368523">nil</span>&nbsp;<span class="op" id="8368527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368531">t</span><span class="op" id="8368532">.</span><span class="ident" id="8368533">Fatalf</span><span class="op" id="8368539">(</span><span class="string" id="8368540">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8368561">,</span>&nbsp;<span class="ident" id="8368563">err</span><span class="op" id="8368566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368569">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368572">defer</span>&nbsp;<span class="ident" id="8368578">c2</span><span class="op" id="8368580">.</span><span class="ident" id="8368581">Close</span><span class="op" id="8368586">(</span><span class="op" id="8368587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368591">if</span>&nbsp;<span class="op" id="8368594">!</span><span class="ident" id="8368595">reflect</span><span class="op" id="8368602">.</span><span class="ident" id="8368603">DeepEqual</span><span class="op" id="8368612">(</span><span class="ident" id="8368613">c1</span><span class="op" id="8368615">.</span><span class="ident" id="8368616">LocalAddr</span><span class="op" id="8368625">(</span><span class="op" id="8368626">)</span><span class="op" id="8368627">,</span>&nbsp;<span class="ident" id="8368629">c2</span><span class="op" id="8368631">.</span><span class="ident" id="8368632">RemoteAddr</span><span class="op" id="8368642">(</span><span class="op" id="8368643">)</span><span class="op" id="8368644">)</span>&nbsp;<span class="op" id="8368646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368650">t</span><span class="op" id="8368651">.</span><span class="ident" id="8368652">Fatalf</span><span class="op" id="8368658">(</span><span class="string" id="8368659">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8368697">,</span>&nbsp;<span class="ident" id="8368699">c1</span><span class="op" id="8368701">.</span><span class="ident" id="8368702">LocalAddr</span><span class="op" id="8368711">(</span><span class="op" id="8368712">)</span><span class="op" id="8368713">,</span>&nbsp;<span class="ident" id="8368715">c2</span><span class="op" id="8368717">.</span><span class="ident" id="8368718">RemoteAddr</span><span class="op" id="8368728">(</span><span class="op" id="8368729">)</span><span class="op" id="8368730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368733">}</span><br>
<span class="lineno">140</span><span class="op" id="8368735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8368738">func</span>&nbsp;<span class="ident" id="8368743">TestUnixAutobindClose</span><span class="op" id="8368764">(</span><span class="ident" id="8368765">t</span>&nbsp;<span class="op" id="8368767">*</span><span class="ident" id="8368768">testing</span><span class="op" id="8368775">.</span><span class="ident" id="8368776">T</span><span class="op" id="8368777">)</span>&nbsp;<span class="op" id="8368779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368782">if</span>&nbsp;<span class="ident" id="8368785">runtime</span><span class="op" id="8368792">.</span><span class="ident" id="8368793">GOOS</span>&nbsp;<span class="op" id="8368798">!=</span>&nbsp;<span class="string" id="8368801">&#34;linux&#34;</span>&nbsp;<span class="op" id="8368809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368813">t</span><span class="op" id="8368814">.</span><span class="ident" id="8368815">Skip</span><span class="op" id="8368819">(</span><span class="string" id="8368820">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8368854">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368860">laddr</span>&nbsp;<span class="op" id="8368866">:=</span>&nbsp;<span class="op" id="8368869">&amp;</span><span class="ident" id="8368870">UnixAddr</span><span class="op" id="8368878">{</span><span class="ident" id="8368879">Name</span><span class="op" id="8368883">:</span>&nbsp;<span class="string" id="8368885">&#34;&#34;</span><span class="op" id="8368887">,</span>&nbsp;<span class="ident" id="8368889">Net</span><span class="op" id="8368892">:</span>&nbsp;<span class="string" id="8368894">&#34;unix&#34;</span><span class="op" id="8368900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368903">ln</span><span class="op" id="8368905">,</span>&nbsp;<span class="ident" id="8368907">err</span>&nbsp;<span class="op" id="8368911">:=</span>&nbsp;<span class="ident" id="8368914">ListenUnix</span><span class="op" id="8368924">(</span><span class="string" id="8368925">&#34;unix&#34;</span><span class="op" id="8368931">,</span>&nbsp;<span class="ident" id="8368933">laddr</span><span class="op" id="8368938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8368941">if</span>&nbsp;<span class="ident" id="8368944">err</span>&nbsp;<span class="op" id="8368948">!=</span>&nbsp;<span class="ident" id="8368951">nil</span>&nbsp;<span class="op" id="8368955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368959">t</span><span class="op" id="8368960">.</span><span class="ident" id="8368961">Fatalf</span><span class="op" id="8368967">(</span><span class="string" id="8368968">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8368991">,</span>&nbsp;<span class="ident" id="8368993">err</span><span class="op" id="8368996">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369002">ln</span><span class="op" id="8369004">.</span><span class="ident" id="8369005">Close</span><span class="op" id="8369010">(</span><span class="op" id="8369011">)</span><br>
<span class="lineno"></span><span class="op" id="8369013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8369016">func</span>&nbsp;<span class="ident" id="8369021">TestUnixgramWrite</span><span class="op" id="8369038">(</span><span class="ident" id="8369039">t</span>&nbsp;<span class="op" id="8369041">*</span><span class="ident" id="8369042">testing</span><span class="op" id="8369049">.</span><span class="ident" id="8369050">T</span><span class="op" id="8369051">)</span>&nbsp;<span class="op" id="8369053">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369056">addr</span>&nbsp;<span class="op" id="8369061">:=</span>&nbsp;<span class="ident" id="8369064">testUnixAddr</span><span class="op" id="8369076">(</span><span class="op" id="8369077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369080">laddr</span><span class="op" id="8369085">,</span>&nbsp;<span class="ident" id="8369087">err</span>&nbsp;<span class="op" id="8369091">:=</span>&nbsp;<span class="ident" id="8369094">ResolveUnixAddr</span><span class="op" id="8369109">(</span><span class="string" id="8369110">&#34;unixgram&#34;</span><span class="op" id="8369120">,</span>&nbsp;<span class="ident" id="8369122">addr</span><span class="op" id="8369126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369129">if</span>&nbsp;<span class="ident" id="8369132">err</span>&nbsp;<span class="op" id="8369136">!=</span>&nbsp;<span class="ident" id="8369139">nil</span>&nbsp;<span class="op" id="8369143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369147">t</span><span class="op" id="8369148">.</span><span class="ident" id="8369149">Fatalf</span><span class="op" id="8369155">(</span><span class="string" id="8369156">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8369184">,</span>&nbsp;<span class="ident" id="8369186">err</span><span class="op" id="8369189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369192">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369195">c</span><span class="op" id="8369196">,</span>&nbsp;<span class="ident" id="8369198">err</span>&nbsp;<span class="op" id="8369202">:=</span>&nbsp;<span class="ident" id="8369205">ListenPacket</span><span class="op" id="8369217">(</span><span class="string" id="8369218">&#34;unixgram&#34;</span><span class="op" id="8369228">,</span>&nbsp;<span class="ident" id="8369230">addr</span><span class="op" id="8369234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369237">if</span>&nbsp;<span class="ident" id="8369240">err</span>&nbsp;<span class="op" id="8369244">!=</span>&nbsp;<span class="ident" id="8369247">nil</span>&nbsp;<span class="op" id="8369251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369255">t</span><span class="op" id="8369256">.</span><span class="ident" id="8369257">Fatalf</span><span class="op" id="8369263">(</span><span class="string" id="8369264">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8369289">,</span>&nbsp;<span class="ident" id="8369291">err</span><span class="op" id="8369294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369300">defer</span>&nbsp;<span class="ident" id="8369306">os</span><span class="op" id="8369308">.</span><span class="ident" id="8369309">Remove</span><span class="op" id="8369315">(</span><span class="ident" id="8369316">addr</span><span class="op" id="8369320">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369323">defer</span>&nbsp;<span class="ident" id="8369329">c</span><span class="op" id="8369330">.</span><span class="ident" id="8369331">Close</span><span class="op" id="8369336">(</span><span class="op" id="8369337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369341">testUnixgramWriteConn</span><span class="op" id="8369362">(</span><span class="ident" id="8369363">t</span><span class="op" id="8369364">,</span>&nbsp;<span class="ident" id="8369366">laddr</span><span class="op" id="8369371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369374">testUnixgramWritePacketConn</span><span class="op" id="8369401">(</span><span class="ident" id="8369402">t</span><span class="op" id="8369403">,</span>&nbsp;<span class="ident" id="8369405">laddr</span><span class="op" id="8369410">)</span><br>
<span class="lineno"></span><span class="op" id="8369412">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8369415">func</span>&nbsp;<span class="ident" id="8369420">testUnixgramWriteConn</span><span class="op" id="8369441">(</span><span class="ident" id="8369442">t</span>&nbsp;<span class="op" id="8369444">*</span><span class="ident" id="8369445">testing</span><span class="op" id="8369452">.</span><span class="ident" id="8369453">T</span><span class="op" id="8369454">,</span>&nbsp;<span class="ident" id="8369456">raddr</span>&nbsp;<span class="op" id="8369462">*</span><span class="ident" id="8369463">UnixAddr</span><span class="op" id="8369471">)</span>&nbsp;<span class="op" id="8369473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369476">c</span><span class="op" id="8369477">,</span>&nbsp;<span class="ident" id="8369479">err</span>&nbsp;<span class="op" id="8369483">:=</span>&nbsp;<span class="ident" id="8369486">Dial</span><span class="op" id="8369490">(</span><span class="string" id="8369491">&#34;unixgram&#34;</span><span class="op" id="8369501">,</span>&nbsp;<span class="ident" id="8369503">raddr</span><span class="op" id="8369508">.</span><span class="ident" id="8369509">String</span><span class="op" id="8369515">(</span><span class="op" id="8369516">)</span><span class="op" id="8369517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369520">if</span>&nbsp;<span class="ident" id="8369523">err</span>&nbsp;<span class="op" id="8369527">!=</span>&nbsp;<span class="ident" id="8369530">nil</span>&nbsp;<span class="op" id="8369534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369538">t</span><span class="op" id="8369539">.</span><span class="ident" id="8369540">Fatalf</span><span class="op" id="8369546">(</span><span class="string" id="8369547">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8369564">,</span>&nbsp;<span class="ident" id="8369566">err</span><span class="op" id="8369569">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369575">defer</span>&nbsp;<span class="ident" id="8369581">c</span><span class="op" id="8369582">.</span><span class="ident" id="8369583">Close</span><span class="op" id="8369588">(</span><span class="op" id="8369589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369593">if</span>&nbsp;<span class="ident" id="8369596">_</span><span class="op" id="8369597">,</span>&nbsp;<span class="ident" id="8369599">err</span>&nbsp;<span class="op" id="8369603">:=</span>&nbsp;<span class="ident" id="8369606">c</span><span class="op" id="8369607">.</span><span class="op" id="8369608">(</span><span class="op" id="8369609">*</span><span class="ident" id="8369610">UnixConn</span><span class="op" id="8369618">)</span><span class="op" id="8369619">.</span><span class="ident" id="8369620">WriteToUnix</span><span class="op" id="8369631">(</span><span class="op" id="8369632">[</span><span class="op" id="8369633">]</span><span class="builtintype" id="8369634">byte</span><span class="op" id="8369638">(</span><span class="string" id="8369639">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8369672">)</span><span class="op" id="8369673">,</span>&nbsp;<span class="ident" id="8369675">raddr</span><span class="op" id="8369680">)</span><span class="op" id="8369681">;</span>&nbsp;<span class="ident" id="8369683">err</span>&nbsp;<span class="op" id="8369687">==</span>&nbsp;<span class="ident" id="8369690">nil</span>&nbsp;<span class="op" id="8369694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369698">t</span><span class="op" id="8369699">.</span><span class="ident" id="8369700">Fatal</span><span class="op" id="8369705">(</span><span class="string" id="8369706">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8369731">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369734">}</span>&nbsp;<span class="keyword" id="8369736">else</span>&nbsp;<span class="keyword" id="8369741">if</span>&nbsp;<span class="ident" id="8369744">err</span><span class="op" id="8369747">.</span><span class="op" id="8369748">(</span><span class="op" id="8369749">*</span><span class="ident" id="8369750">OpError</span><span class="op" id="8369757">)</span><span class="op" id="8369758">.</span><span class="ident" id="8369759">Err</span>&nbsp;<span class="op" id="8369763">!=</span>&nbsp;<span class="ident" id="8369766">ErrWriteToConnected</span>&nbsp;<span class="op" id="8369786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369790">t</span><span class="op" id="8369791">.</span><span class="ident" id="8369792">Fatalf</span><span class="op" id="8369798">(</span><span class="string" id="8369799">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8369851">,</span>&nbsp;<span class="ident" id="8369853">err</span><span class="op" id="8369856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369862">if</span>&nbsp;<span class="ident" id="8369865">_</span><span class="op" id="8369866">,</span>&nbsp;<span class="ident" id="8369868">err</span>&nbsp;<span class="op" id="8369872">=</span>&nbsp;<span class="ident" id="8369874">c</span><span class="op" id="8369875">.</span><span class="op" id="8369876">(</span><span class="op" id="8369877">*</span><span class="ident" id="8369878">UnixConn</span><span class="op" id="8369886">)</span><span class="op" id="8369887">.</span><span class="ident" id="8369888">WriteTo</span><span class="op" id="8369895">(</span><span class="op" id="8369896">[</span><span class="op" id="8369897">]</span><span class="builtintype" id="8369898">byte</span><span class="op" id="8369902">(</span><span class="string" id="8369903">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8369936">)</span><span class="op" id="8369937">,</span>&nbsp;<span class="ident" id="8369939">raddr</span><span class="op" id="8369944">)</span><span class="op" id="8369945">;</span>&nbsp;<span class="ident" id="8369947">err</span>&nbsp;<span class="op" id="8369951">==</span>&nbsp;<span class="ident" id="8369954">nil</span>&nbsp;<span class="op" id="8369958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369962">t</span><span class="op" id="8369963">.</span><span class="ident" id="8369964">Fatal</span><span class="op" id="8369969">(</span><span class="string" id="8369970">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8369991">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369994">}</span>&nbsp;<span class="keyword" id="8369996">else</span>&nbsp;<span class="keyword" id="8370001">if</span>&nbsp;<span class="ident" id="8370004">err</span><span class="op" id="8370007">.</span><span class="op" id="8370008">(</span><span class="op" id="8370009">*</span><span class="ident" id="8370010">OpError</span><span class="op" id="8370017">)</span><span class="op" id="8370018">.</span><span class="ident" id="8370019">Err</span>&nbsp;<span class="op" id="8370023">!=</span>&nbsp;<span class="ident" id="8370026">ErrWriteToConnected</span>&nbsp;<span class="op" id="8370046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370050">t</span><span class="op" id="8370051">.</span><span class="ident" id="8370052">Fatalf</span><span class="op" id="8370058">(</span><span class="string" id="8370059">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8370107">,</span>&nbsp;<span class="ident" id="8370109">err</span><span class="op" id="8370112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370118">if</span>&nbsp;<span class="ident" id="8370121">_</span><span class="op" id="8370122">,</span>&nbsp;<span class="ident" id="8370124">_</span><span class="op" id="8370125">,</span>&nbsp;<span class="ident" id="8370127">err</span>&nbsp;<span class="op" id="8370131">=</span>&nbsp;<span class="ident" id="8370133">c</span><span class="op" id="8370134">.</span><span class="op" id="8370135">(</span><span class="op" id="8370136">*</span><span class="ident" id="8370137">UnixConn</span><span class="op" id="8370145">)</span><span class="op" id="8370146">.</span><span class="ident" id="8370147">WriteMsgUnix</span><span class="op" id="8370159">(</span><span class="op" id="8370160">[</span><span class="op" id="8370161">]</span><span class="builtintype" id="8370162">byte</span><span class="op" id="8370166">(</span><span class="string" id="8370167">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8370200">)</span><span class="op" id="8370201">,</span>&nbsp;<span class="ident" id="8370203">nil</span><span class="op" id="8370206">,</span>&nbsp;<span class="ident" id="8370208">raddr</span><span class="op" id="8370213">)</span><span class="op" id="8370214">;</span>&nbsp;<span class="ident" id="8370216">err</span>&nbsp;<span class="op" id="8370220">==</span>&nbsp;<span class="ident" id="8370223">nil</span>&nbsp;<span class="op" id="8370227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370231">t</span><span class="op" id="8370232">.</span><span class="ident" id="8370233">Fatal</span><span class="op" id="8370238">(</span><span class="string" id="8370239">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8370260">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370263">}</span>&nbsp;<span class="keyword" id="8370265">else</span>&nbsp;<span class="keyword" id="8370270">if</span>&nbsp;<span class="ident" id="8370273">err</span><span class="op" id="8370276">.</span><span class="op" id="8370277">(</span><span class="op" id="8370278">*</span><span class="ident" id="8370279">OpError</span><span class="op" id="8370286">)</span><span class="op" id="8370287">.</span><span class="ident" id="8370288">Err</span>&nbsp;<span class="op" id="8370292">!=</span>&nbsp;<span class="ident" id="8370295">ErrWriteToConnected</span>&nbsp;<span class="op" id="8370315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370319">t</span><span class="op" id="8370320">.</span><span class="ident" id="8370321">Fatalf</span><span class="op" id="8370327">(</span><span class="string" id="8370328">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8370381">,</span>&nbsp;<span class="ident" id="8370383">err</span><span class="op" id="8370386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370392">if</span>&nbsp;<span class="ident" id="8370395">_</span><span class="op" id="8370396">,</span>&nbsp;<span class="ident" id="8370398">err</span>&nbsp;<span class="op" id="8370402">:=</span>&nbsp;<span class="ident" id="8370405">c</span><span class="op" id="8370406">.</span><span class="ident" id="8370407">Write</span><span class="op" id="8370412">(</span><span class="op" id="8370413">[</span><span class="op" id="8370414">]</span><span class="builtintype" id="8370415">byte</span><span class="op" id="8370419">(</span><span class="string" id="8370420">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8370453">)</span><span class="op" id="8370454">)</span><span class="op" id="8370455">;</span>&nbsp;<span class="ident" id="8370457">err</span>&nbsp;<span class="op" id="8370461">!=</span>&nbsp;<span class="ident" id="8370464">nil</span>&nbsp;<span class="op" id="8370468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370472">t</span><span class="op" id="8370473">.</span><span class="ident" id="8370474">Fatalf</span><span class="op" id="8370480">(</span><span class="string" id="8370481">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8370499">,</span>&nbsp;<span class="ident" id="8370501">err</span><span class="op" id="8370504">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370507">}</span><br>
<span class="lineno"></span><span class="op" id="8370509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8370512">func</span>&nbsp;<span class="ident" id="8370517">testUnixgramWritePacketConn</span><span class="op" id="8370544">(</span><span class="ident" id="8370545">t</span>&nbsp;<span class="op" id="8370547">*</span><span class="ident" id="8370548">testing</span><span class="op" id="8370555">.</span><span class="ident" id="8370556">T</span><span class="op" id="8370557">,</span>&nbsp;<span class="ident" id="8370559">raddr</span>&nbsp;<span class="op" id="8370565">*</span><span class="ident" id="8370566">UnixAddr</span><span class="op" id="8370574">)</span>&nbsp;<span class="op" id="8370576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370579">addr</span>&nbsp;<span class="op" id="8370584">:=</span>&nbsp;<span class="ident" id="8370587">testUnixAddr</span><span class="op" id="8370599">(</span><span class="op" id="8370600">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370603">c</span><span class="op" id="8370604">,</span>&nbsp;<span class="ident" id="8370606">err</span>&nbsp;<span class="op" id="8370610">:=</span>&nbsp;<span class="ident" id="8370613">ListenPacket</span><span class="op" id="8370625">(</span><span class="string" id="8370626">&#34;unixgram&#34;</span><span class="op" id="8370636">,</span>&nbsp;<span class="ident" id="8370638">addr</span><span class="op" id="8370642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370645">if</span>&nbsp;<span class="ident" id="8370648">err</span>&nbsp;<span class="op" id="8370652">!=</span>&nbsp;<span class="ident" id="8370655">nil</span>&nbsp;<span class="op" id="8370659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370663">t</span><span class="op" id="8370664">.</span><span class="ident" id="8370665">Fatalf</span><span class="op" id="8370671">(</span><span class="string" id="8370672">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8370697">,</span>&nbsp;<span class="ident" id="8370699">err</span><span class="op" id="8370702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370708">defer</span>&nbsp;<span class="ident" id="8370714">os</span><span class="op" id="8370716">.</span><span class="ident" id="8370717">Remove</span><span class="op" id="8370723">(</span><span class="ident" id="8370724">addr</span><span class="op" id="8370728">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370731">defer</span>&nbsp;<span class="ident" id="8370737">c</span><span class="op" id="8370738">.</span><span class="ident" id="8370739">Close</span><span class="op" id="8370744">(</span><span class="op" id="8370745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370749">if</span>&nbsp;<span class="ident" id="8370752">_</span><span class="op" id="8370753">,</span>&nbsp;<span class="ident" id="8370755">err</span>&nbsp;<span class="op" id="8370759">:=</span>&nbsp;<span class="ident" id="8370762">c</span><span class="op" id="8370763">.</span><span class="op" id="8370764">(</span><span class="op" id="8370765">*</span><span class="ident" id="8370766">UnixConn</span><span class="op" id="8370774">)</span><span class="op" id="8370775">.</span><span class="ident" id="8370776">WriteToUnix</span><span class="op" id="8370787">(</span><span class="op" id="8370788">[</span><span class="op" id="8370789">]</span><span class="builtintype" id="8370790">byte</span><span class="op" id="8370794">(</span><span class="string" id="8370795">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8370823">)</span><span class="op" id="8370824">,</span>&nbsp;<span class="ident" id="8370826">raddr</span><span class="op" id="8370831">)</span><span class="op" id="8370832">;</span>&nbsp;<span class="ident" id="8370834">err</span>&nbsp;<span class="op" id="8370838">!=</span>&nbsp;<span class="ident" id="8370841">nil</span>&nbsp;<span class="op" id="8370845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370849">t</span><span class="op" id="8370850">.</span><span class="ident" id="8370851">Fatalf</span><span class="op" id="8370857">(</span><span class="string" id="8370858">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8370882">,</span>&nbsp;<span class="ident" id="8370884">err</span><span class="op" id="8370887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370890">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370893">if</span>&nbsp;<span class="ident" id="8370896">_</span><span class="op" id="8370897">,</span>&nbsp;<span class="ident" id="8370899">err</span>&nbsp;<span class="op" id="8370903">:=</span>&nbsp;<span class="ident" id="8370906">c</span><span class="op" id="8370907">.</span><span class="ident" id="8370908">WriteTo</span><span class="op" id="8370915">(</span><span class="op" id="8370916">[</span><span class="op" id="8370917">]</span><span class="builtintype" id="8370918">byte</span><span class="op" id="8370922">(</span><span class="string" id="8370923">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8370951">)</span><span class="op" id="8370952">,</span>&nbsp;<span class="ident" id="8370954">raddr</span><span class="op" id="8370959">)</span><span class="op" id="8370960">;</span>&nbsp;<span class="ident" id="8370962">err</span>&nbsp;<span class="op" id="8370966">!=</span>&nbsp;<span class="ident" id="8370969">nil</span>&nbsp;<span class="op" id="8370973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370977">t</span><span class="op" id="8370978">.</span><span class="ident" id="8370979">Fatalf</span><span class="op" id="8370985">(</span><span class="string" id="8370986">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371006">,</span>&nbsp;<span class="ident" id="8371008">err</span><span class="op" id="8371011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371017">if</span>&nbsp;<span class="ident" id="8371020">_</span><span class="op" id="8371021">,</span>&nbsp;<span class="ident" id="8371023">_</span><span class="op" id="8371024">,</span>&nbsp;<span class="ident" id="8371026">err</span>&nbsp;<span class="op" id="8371030">:=</span>&nbsp;<span class="ident" id="8371033">c</span><span class="op" id="8371034">.</span><span class="op" id="8371035">(</span><span class="op" id="8371036">*</span><span class="ident" id="8371037">UnixConn</span><span class="op" id="8371045">)</span><span class="op" id="8371046">.</span><span class="ident" id="8371047">WriteMsgUnix</span><span class="op" id="8371059">(</span><span class="op" id="8371060">[</span><span class="op" id="8371061">]</span><span class="builtintype" id="8371062">byte</span><span class="op" id="8371066">(</span><span class="string" id="8371067">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8371095">)</span><span class="op" id="8371096">,</span>&nbsp;<span class="ident" id="8371098">nil</span><span class="op" id="8371101">,</span>&nbsp;<span class="ident" id="8371103">raddr</span><span class="op" id="8371108">)</span><span class="op" id="8371109">;</span>&nbsp;<span class="ident" id="8371111">err</span>&nbsp;<span class="op" id="8371115">!=</span>&nbsp;<span class="ident" id="8371118">nil</span>&nbsp;<span class="op" id="8371122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371126">t</span><span class="op" id="8371127">.</span><span class="ident" id="8371128">Fatalf</span><span class="op" id="8371134">(</span><span class="string" id="8371135">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371160">,</span>&nbsp;<span class="ident" id="8371162">err</span><span class="op" id="8371165">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371171">if</span>&nbsp;<span class="ident" id="8371174">_</span><span class="op" id="8371175">,</span>&nbsp;<span class="ident" id="8371177">err</span>&nbsp;<span class="op" id="8371181">:=</span>&nbsp;<span class="ident" id="8371184">c</span><span class="op" id="8371185">.</span><span class="op" id="8371186">(</span><span class="op" id="8371187">*</span><span class="ident" id="8371188">UnixConn</span><span class="op" id="8371196">)</span><span class="op" id="8371197">.</span><span class="ident" id="8371198">Write</span><span class="op" id="8371203">(</span><span class="op" id="8371204">[</span><span class="op" id="8371205">]</span><span class="builtintype" id="8371206">byte</span><span class="op" id="8371210">(</span><span class="string" id="8371211">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8371239">)</span><span class="op" id="8371240">)</span><span class="op" id="8371241">;</span>&nbsp;<span class="ident" id="8371243">err</span>&nbsp;<span class="op" id="8371247">==</span>&nbsp;<span class="ident" id="8371250">nil</span>&nbsp;<span class="op" id="8371254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371258">t</span><span class="op" id="8371259">.</span><span class="ident" id="8371260">Fatal</span><span class="op" id="8371265">(</span><span class="string" id="8371266">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8371285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371288">}</span><br>
<span class="lineno"></span><span class="op" id="8371290">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8371293">func</span>&nbsp;<span class="ident" id="8371298">TestUnixConnLocalAndRemoteNames</span><span class="op" id="8371329">(</span><span class="ident" id="8371330">t</span>&nbsp;<span class="op" id="8371332">*</span><span class="ident" id="8371333">testing</span><span class="op" id="8371340">.</span><span class="ident" id="8371341">T</span><span class="op" id="8371342">)</span>&nbsp;<span class="op" id="8371344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371347">for</span>&nbsp;<span class="ident" id="8371351">_</span><span class="op" id="8371352">,</span>&nbsp;<span class="ident" id="8371354">laddr</span>&nbsp;<span class="op" id="8371360">:=</span>&nbsp;<span class="keyword" id="8371363">range</span>&nbsp;<span class="op" id="8371369">[</span><span class="op" id="8371370">]</span><span class="builtintype" id="8371371">string</span><span class="op" id="8371377">{</span><span class="string" id="8371378">&#34;&#34;</span><span class="op" id="8371380">,</span>&nbsp;<span class="ident" id="8371382">testUnixAddr</span><span class="op" id="8371394">(</span><span class="op" id="8371395">)</span><span class="op" id="8371396">}</span>&nbsp;<span class="op" id="8371398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371402">laddr</span>&nbsp;<span class="op" id="8371408">:=</span>&nbsp;<span class="ident" id="8371411">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371419">taddr</span>&nbsp;<span class="op" id="8371425">:=</span>&nbsp;<span class="ident" id="8371428">testUnixAddr</span><span class="op" id="8371440">(</span><span class="op" id="8371441">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371445">ta</span><span class="op" id="8371447">,</span>&nbsp;<span class="ident" id="8371449">err</span>&nbsp;<span class="op" id="8371453">:=</span>&nbsp;<span class="ident" id="8371456">ResolveUnixAddr</span><span class="op" id="8371471">(</span><span class="string" id="8371472">&#34;unix&#34;</span><span class="op" id="8371478">,</span>&nbsp;<span class="ident" id="8371480">taddr</span><span class="op" id="8371485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371489">if</span>&nbsp;<span class="ident" id="8371492">err</span>&nbsp;<span class="op" id="8371496">!=</span>&nbsp;<span class="ident" id="8371499">nil</span>&nbsp;<span class="op" id="8371503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371508">t</span><span class="op" id="8371509">.</span><span class="ident" id="8371510">Fatalf</span><span class="op" id="8371516">(</span><span class="string" id="8371517">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371545">,</span>&nbsp;<span class="ident" id="8371547">err</span><span class="op" id="8371550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371558">ln</span><span class="op" id="8371560">,</span>&nbsp;<span class="ident" id="8371562">err</span>&nbsp;<span class="op" id="8371566">:=</span>&nbsp;<span class="ident" id="8371569">ListenUnix</span><span class="op" id="8371579">(</span><span class="string" id="8371580">&#34;unix&#34;</span><span class="op" id="8371586">,</span>&nbsp;<span class="ident" id="8371588">ta</span><span class="op" id="8371590">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371594">if</span>&nbsp;<span class="ident" id="8371597">err</span>&nbsp;<span class="op" id="8371601">!=</span>&nbsp;<span class="ident" id="8371604">nil</span>&nbsp;<span class="op" id="8371608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371613">t</span><span class="op" id="8371614">.</span><span class="ident" id="8371615">Fatalf</span><span class="op" id="8371621">(</span><span class="string" id="8371622">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371645">,</span>&nbsp;<span class="ident" id="8371647">err</span><span class="op" id="8371650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371658">defer</span>&nbsp;<span class="keyword" id="8371664">func</span><span class="op" id="8371668">(</span><span class="op" id="8371669">)</span>&nbsp;<span class="op" id="8371671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371676">ln</span><span class="op" id="8371678">.</span><span class="ident" id="8371679">Close</span><span class="op" id="8371684">(</span><span class="op" id="8371685">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371690">os</span><span class="op" id="8371692">.</span><span class="ident" id="8371693">Remove</span><span class="op" id="8371699">(</span><span class="ident" id="8371700">taddr</span><span class="op" id="8371705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371709">}</span><span class="op" id="8371710">(</span><span class="op" id="8371711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371716">done</span>&nbsp;<span class="op" id="8371721">:=</span>&nbsp;<span class="builtinfunc" id="8371724">make</span><span class="op" id="8371728">(</span><span class="keyword" id="8371729">chan</span>&nbsp;<span class="builtintype" id="8371734">int</span><span class="op" id="8371737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371741">go</span>&nbsp;<span class="ident" id="8371744">transponder</span><span class="op" id="8371755">(</span><span class="ident" id="8371756">t</span><span class="op" id="8371757">,</span>&nbsp;<span class="ident" id="8371759">ln</span><span class="op" id="8371761">,</span>&nbsp;<span class="ident" id="8371763">done</span><span class="op" id="8371767">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371772">la</span><span class="op" id="8371774">,</span>&nbsp;<span class="ident" id="8371776">err</span>&nbsp;<span class="op" id="8371780">:=</span>&nbsp;<span class="ident" id="8371783">ResolveUnixAddr</span><span class="op" id="8371798">(</span><span class="string" id="8371799">&#34;unix&#34;</span><span class="op" id="8371805">,</span>&nbsp;<span class="ident" id="8371807">laddr</span><span class="op" id="8371812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371816">if</span>&nbsp;<span class="ident" id="8371819">err</span>&nbsp;<span class="op" id="8371823">!=</span>&nbsp;<span class="ident" id="8371826">nil</span>&nbsp;<span class="op" id="8371830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371835">t</span><span class="op" id="8371836">.</span><span class="ident" id="8371837">Fatalf</span><span class="op" id="8371843">(</span><span class="string" id="8371844">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371872">,</span>&nbsp;<span class="ident" id="8371874">err</span><span class="op" id="8371877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371881">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371885">c</span><span class="op" id="8371886">,</span>&nbsp;<span class="ident" id="8371888">err</span>&nbsp;<span class="op" id="8371892">:=</span>&nbsp;<span class="ident" id="8371895">DialUnix</span><span class="op" id="8371903">(</span><span class="string" id="8371904">&#34;unix&#34;</span><span class="op" id="8371910">,</span>&nbsp;<span class="ident" id="8371912">la</span><span class="op" id="8371914">,</span>&nbsp;<span class="ident" id="8371916">ta</span><span class="op" id="8371918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371922">if</span>&nbsp;<span class="ident" id="8371925">err</span>&nbsp;<span class="op" id="8371929">!=</span>&nbsp;<span class="ident" id="8371932">nil</span>&nbsp;<span class="op" id="8371936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371941">t</span><span class="op" id="8371942">.</span><span class="ident" id="8371943">Fatalf</span><span class="op" id="8371949">(</span><span class="string" id="8371950">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8371971">,</span>&nbsp;<span class="ident" id="8371973">err</span><span class="op" id="8371976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8371984">defer</span>&nbsp;<span class="keyword" id="8371990">func</span><span class="op" id="8371994">(</span><span class="op" id="8371995">)</span>&nbsp;<span class="op" id="8371997">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372002">c</span><span class="op" id="8372003">.</span><span class="ident" id="8372004">Close</span><span class="op" id="8372009">(</span><span class="op" id="8372010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372015">if</span>&nbsp;<span class="ident" id="8372018">la</span>&nbsp;<span class="op" id="8372021">!=</span>&nbsp;<span class="ident" id="8372024">nil</span>&nbsp;<span class="op" id="8372028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372034">defer</span>&nbsp;<span class="ident" id="8372040">os</span><span class="op" id="8372042">.</span><span class="ident" id="8372043">Remove</span><span class="op" id="8372049">(</span><span class="ident" id="8372050">laddr</span><span class="op" id="8372055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372064">}</span><span class="op" id="8372065">(</span><span class="op" id="8372066">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372070">if</span>&nbsp;<span class="ident" id="8372073">_</span><span class="op" id="8372074">,</span>&nbsp;<span class="ident" id="8372076">err</span>&nbsp;<span class="op" id="8372080">:=</span>&nbsp;<span class="ident" id="8372083">c</span><span class="op" id="8372084">.</span><span class="ident" id="8372085">Write</span><span class="op" id="8372090">(</span><span class="op" id="8372091">[</span><span class="op" id="8372092">]</span><span class="builtintype" id="8372093">byte</span><span class="op" id="8372097">(</span><span class="string" id="8372098">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="8372135">)</span><span class="op" id="8372136">)</span><span class="op" id="8372137">;</span>&nbsp;<span class="ident" id="8372139">err</span>&nbsp;<span class="op" id="8372143">!=</span>&nbsp;<span class="ident" id="8372146">nil</span>&nbsp;<span class="op" id="8372150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372155">t</span><span class="op" id="8372156">.</span><span class="ident" id="8372157">Fatalf</span><span class="op" id="8372163">(</span><span class="string" id="8372164">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8372191">,</span>&nbsp;<span class="ident" id="8372193">err</span><span class="op" id="8372196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372205">switch</span>&nbsp;<span class="ident" id="8372212">runtime</span><span class="op" id="8372219">.</span><span class="ident" id="8372220">GOOS</span>&nbsp;<span class="op" id="8372225">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372229">case</span>&nbsp;<span class="string" id="8372234">&#34;android&#34;</span><span class="op" id="8372243">,</span>&nbsp;<span class="string" id="8372245">&#34;linux&#34;</span><span class="op" id="8372252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372257">if</span>&nbsp;<span class="ident" id="8372260">laddr</span>&nbsp;<span class="op" id="8372266">==</span>&nbsp;<span class="string" id="8372269">&#34;&#34;</span>&nbsp;<span class="op" id="8372272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372278">laddr</span>&nbsp;<span class="op" id="8372284">=</span>&nbsp;<span class="string" id="8372286">&#34;@&#34;</span>&nbsp;<span class="comment" id="8372290">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372317">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372321">var</span>&nbsp;<span class="ident" id="8372325">connAddrs</span>&nbsp;<span class="op" id="8372335">=</span>&nbsp;<span class="op" id="8372337">[</span><span class="num" id="8372338">3</span><span class="op" id="8372339">]</span><span class="keyword" id="8372340">struct</span><span class="op" id="8372346">{</span>&nbsp;<span class="ident" id="8372348">got</span><span class="op" id="8372351">,</span>&nbsp;<span class="ident" id="8372353">want</span>&nbsp;<span class="ident" id="8372358">Addr</span>&nbsp;<span class="op" id="8372363">}</span><span class="op" id="8372364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372369">{</span><span class="ident" id="8372370">ln</span><span class="op" id="8372372">.</span><span class="ident" id="8372373">Addr</span><span class="op" id="8372377">(</span><span class="op" id="8372378">)</span><span class="op" id="8372379">,</span>&nbsp;<span class="ident" id="8372381">ta</span><span class="op" id="8372383">}</span><span class="op" id="8372384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372389">{</span><span class="ident" id="8372390">c</span><span class="op" id="8372391">.</span><span class="ident" id="8372392">LocalAddr</span><span class="op" id="8372401">(</span><span class="op" id="8372402">)</span><span class="op" id="8372403">,</span>&nbsp;<span class="op" id="8372405">&amp;</span><span class="ident" id="8372406">UnixAddr</span><span class="op" id="8372414">{</span><span class="ident" id="8372415">Name</span><span class="op" id="8372419">:</span>&nbsp;<span class="ident" id="8372421">laddr</span><span class="op" id="8372426">,</span>&nbsp;<span class="ident" id="8372428">Net</span><span class="op" id="8372431">:</span>&nbsp;<span class="string" id="8372433">&#34;unix&#34;</span><span class="op" id="8372439">}</span><span class="op" id="8372440">}</span><span class="op" id="8372441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372446">{</span><span class="ident" id="8372447">c</span><span class="op" id="8372448">.</span><span class="ident" id="8372449">RemoteAddr</span><span class="op" id="8372459">(</span><span class="op" id="8372460">)</span><span class="op" id="8372461">,</span>&nbsp;<span class="ident" id="8372463">ta</span><span class="op" id="8372465">}</span><span class="op" id="8372466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372470">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372474">for</span>&nbsp;<span class="ident" id="8372478">_</span><span class="op" id="8372479">,</span>&nbsp;<span class="ident" id="8372481">ca</span>&nbsp;<span class="op" id="8372484">:=</span>&nbsp;<span class="keyword" id="8372487">range</span>&nbsp;<span class="ident" id="8372493">connAddrs</span>&nbsp;<span class="op" id="8372503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372508">if</span>&nbsp;<span class="op" id="8372511">!</span><span class="ident" id="8372512">reflect</span><span class="op" id="8372519">.</span><span class="ident" id="8372520">DeepEqual</span><span class="op" id="8372529">(</span><span class="ident" id="8372530">ca</span><span class="op" id="8372532">.</span><span class="ident" id="8372533">got</span><span class="op" id="8372536">,</span>&nbsp;<span class="ident" id="8372538">ca</span><span class="op" id="8372540">.</span><span class="ident" id="8372541">want</span><span class="op" id="8372545">)</span>&nbsp;<span class="op" id="8372547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372553">t</span><span class="op" id="8372554">.</span><span class="ident" id="8372555">Fatalf</span><span class="op" id="8372561">(</span><span class="string" id="8372562">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8372585">,</span>&nbsp;<span class="ident" id="8372587">ca</span><span class="op" id="8372589">.</span><span class="ident" id="8372590">got</span><span class="op" id="8372593">,</span>&nbsp;<span class="ident" id="8372595">ca</span><span class="op" id="8372597">.</span><span class="ident" id="8372598">want</span><span class="op" id="8372602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372611">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372616">&lt;-</span><span class="ident" id="8372618">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372624">}</span><br>
<span class="lineno"></span><span class="op" id="8372626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8372629">func</span>&nbsp;<span class="ident" id="8372634">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="8372669">(</span><span class="ident" id="8372670">t</span>&nbsp;<span class="op" id="8372672">*</span><span class="ident" id="8372673">testing</span><span class="op" id="8372680">.</span><span class="ident" id="8372681">T</span><span class="op" id="8372682">)</span>&nbsp;<span class="op" id="8372684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372687">for</span>&nbsp;<span class="ident" id="8372691">_</span><span class="op" id="8372692">,</span>&nbsp;<span class="ident" id="8372694">laddr</span>&nbsp;<span class="op" id="8372700">:=</span>&nbsp;<span class="keyword" id="8372703">range</span>&nbsp;<span class="op" id="8372709">[</span><span class="op" id="8372710">]</span><span class="builtintype" id="8372711">string</span><span class="op" id="8372717">{</span><span class="string" id="8372718">&#34;&#34;</span><span class="op" id="8372720">,</span>&nbsp;<span class="ident" id="8372722">testUnixAddr</span><span class="op" id="8372734">(</span><span class="op" id="8372735">)</span><span class="op" id="8372736">}</span>&nbsp;<span class="op" id="8372738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372742">laddr</span>&nbsp;<span class="op" id="8372748">:=</span>&nbsp;<span class="ident" id="8372751">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372759">taddr</span>&nbsp;<span class="op" id="8372765">:=</span>&nbsp;<span class="ident" id="8372768">testUnixAddr</span><span class="op" id="8372780">(</span><span class="op" id="8372781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372785">ta</span><span class="op" id="8372787">,</span>&nbsp;<span class="ident" id="8372789">err</span>&nbsp;<span class="op" id="8372793">:=</span>&nbsp;<span class="ident" id="8372796">ResolveUnixAddr</span><span class="op" id="8372811">(</span><span class="string" id="8372812">&#34;unixgram&#34;</span><span class="op" id="8372822">,</span>&nbsp;<span class="ident" id="8372824">taddr</span><span class="op" id="8372829">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372833">if</span>&nbsp;<span class="ident" id="8372836">err</span>&nbsp;<span class="op" id="8372840">!=</span>&nbsp;<span class="ident" id="8372843">nil</span>&nbsp;<span class="op" id="8372847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372852">t</span><span class="op" id="8372853">.</span><span class="ident" id="8372854">Fatalf</span><span class="op" id="8372860">(</span><span class="string" id="8372861">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8372889">,</span>&nbsp;<span class="ident" id="8372891">err</span><span class="op" id="8372894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8372898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372902">c1</span><span class="op" id="8372904">,</span>&nbsp;<span class="ident" id="8372906">err</span>&nbsp;<span class="op" id="8372910">:=</span>&nbsp;<span class="ident" id="8372913">ListenUnixgram</span><span class="op" id="8372927">(</span><span class="string" id="8372928">&#34;unixgram&#34;</span><span class="op" id="8372938">,</span>&nbsp;<span class="ident" id="8372940">ta</span><span class="op" id="8372942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8372946">if</span>&nbsp;<span class="ident" id="8372949">err</span>&nbsp;<span class="op" id="8372953">!=</span>&nbsp;<span class="ident" id="8372956">nil</span>&nbsp;<span class="op" id="8372960">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8372965">t</span><span class="op" id="8372966">.</span><span class="ident" id="8372967">Fatalf</span><span class="op" id="8372973">(</span><span class="string" id="8372974">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8373001">,</span>&nbsp;<span class="ident" id="8373003">err</span><span class="op" id="8373006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373014">defer</span>&nbsp;<span class="keyword" id="8373020">func</span><span class="op" id="8373024">(</span><span class="op" id="8373025">)</span>&nbsp;<span class="op" id="8373027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373032">c1</span><span class="op" id="8373034">.</span><span class="ident" id="8373035">Close</span><span class="op" id="8373040">(</span><span class="op" id="8373041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373046">os</span><span class="op" id="8373048">.</span><span class="ident" id="8373049">Remove</span><span class="op" id="8373055">(</span><span class="ident" id="8373056">taddr</span><span class="op" id="8373061">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373065">}</span><span class="op" id="8373066">(</span><span class="op" id="8373067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373072">var</span>&nbsp;<span class="ident" id="8373076">la</span>&nbsp;<span class="op" id="8373079">*</span><span class="ident" id="8373080">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373091">if</span>&nbsp;<span class="ident" id="8373094">laddr</span>&nbsp;<span class="op" id="8373100">!=</span>&nbsp;<span class="string" id="8373103">&#34;&#34;</span>&nbsp;<span class="op" id="8373106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373111">if</span>&nbsp;<span class="ident" id="8373114">la</span><span class="op" id="8373116">,</span>&nbsp;<span class="ident" id="8373118">err</span>&nbsp;<span class="op" id="8373122">=</span>&nbsp;<span class="ident" id="8373124">ResolveUnixAddr</span><span class="op" id="8373139">(</span><span class="string" id="8373140">&#34;unixgram&#34;</span><span class="op" id="8373150">,</span>&nbsp;<span class="ident" id="8373152">laddr</span><span class="op" id="8373157">)</span><span class="op" id="8373158">;</span>&nbsp;<span class="ident" id="8373160">err</span>&nbsp;<span class="op" id="8373164">!=</span>&nbsp;<span class="ident" id="8373167">nil</span>&nbsp;<span class="op" id="8373171">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373177">t</span><span class="op" id="8373178">.</span><span class="ident" id="8373179">Fatalf</span><span class="op" id="8373185">(</span><span class="string" id="8373186">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8373214">,</span>&nbsp;<span class="ident" id="8373216">err</span><span class="op" id="8373219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373232">c2</span><span class="op" id="8373234">,</span>&nbsp;<span class="ident" id="8373236">err</span>&nbsp;<span class="op" id="8373240">:=</span>&nbsp;<span class="ident" id="8373243">DialUnix</span><span class="op" id="8373251">(</span><span class="string" id="8373252">&#34;unixgram&#34;</span><span class="op" id="8373262">,</span>&nbsp;<span class="ident" id="8373264">la</span><span class="op" id="8373266">,</span>&nbsp;<span class="ident" id="8373268">ta</span><span class="op" id="8373270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373274">if</span>&nbsp;<span class="ident" id="8373277">err</span>&nbsp;<span class="op" id="8373281">!=</span>&nbsp;<span class="ident" id="8373284">nil</span>&nbsp;<span class="op" id="8373288">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373293">t</span><span class="op" id="8373294">.</span><span class="ident" id="8373295">Fatalf</span><span class="op" id="8373301">(</span><span class="string" id="8373302">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8373323">,</span>&nbsp;<span class="ident" id="8373325">err</span><span class="op" id="8373328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373336">defer</span>&nbsp;<span class="keyword" id="8373342">func</span><span class="op" id="8373346">(</span><span class="op" id="8373347">)</span>&nbsp;<span class="op" id="8373349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373354">c2</span><span class="op" id="8373356">.</span><span class="ident" id="8373357">Close</span><span class="op" id="8373362">(</span><span class="op" id="8373363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373368">if</span>&nbsp;<span class="ident" id="8373371">la</span>&nbsp;<span class="op" id="8373374">!=</span>&nbsp;<span class="ident" id="8373377">nil</span>&nbsp;<span class="op" id="8373381">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373387">defer</span>&nbsp;<span class="ident" id="8373393">os</span><span class="op" id="8373395">.</span><span class="ident" id="8373396">Remove</span><span class="op" id="8373402">(</span><span class="ident" id="8373403">laddr</span><span class="op" id="8373408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373417">}</span><span class="op" id="8373418">(</span><span class="op" id="8373419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373424">switch</span>&nbsp;<span class="ident" id="8373431">runtime</span><span class="op" id="8373438">.</span><span class="ident" id="8373439">GOOS</span>&nbsp;<span class="op" id="8373444">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373448">case</span>&nbsp;<span class="string" id="8373453">&#34;android&#34;</span><span class="op" id="8373462">,</span>&nbsp;<span class="string" id="8373464">&#34;linux&#34;</span><span class="op" id="8373471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373476">if</span>&nbsp;<span class="ident" id="8373479">laddr</span>&nbsp;<span class="op" id="8373485">==</span>&nbsp;<span class="string" id="8373488">&#34;&#34;</span>&nbsp;<span class="op" id="8373491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373497">laddr</span>&nbsp;<span class="op" id="8373503">=</span>&nbsp;<span class="string" id="8373505">&#34;@&#34;</span>&nbsp;<span class="comment" id="8373509">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373536">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373541">var</span>&nbsp;<span class="ident" id="8373545">connAddrs</span>&nbsp;<span class="op" id="8373555">=</span>&nbsp;<span class="op" id="8373557">[</span><span class="num" id="8373558">4</span><span class="op" id="8373559">]</span><span class="keyword" id="8373560">struct</span><span class="op" id="8373566">{</span>&nbsp;<span class="ident" id="8373568">got</span><span class="op" id="8373571">,</span>&nbsp;<span class="ident" id="8373573">want</span>&nbsp;<span class="ident" id="8373578">Addr</span>&nbsp;<span class="op" id="8373583">}</span><span class="op" id="8373584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373589">{</span><span class="ident" id="8373590">c1</span><span class="op" id="8373592">.</span><span class="ident" id="8373593">LocalAddr</span><span class="op" id="8373602">(</span><span class="op" id="8373603">)</span><span class="op" id="8373604">,</span>&nbsp;<span class="ident" id="8373606">ta</span><span class="op" id="8373608">}</span><span class="op" id="8373609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373614">{</span><span class="ident" id="8373615">c1</span><span class="op" id="8373617">.</span><span class="ident" id="8373618">RemoteAddr</span><span class="op" id="8373628">(</span><span class="op" id="8373629">)</span><span class="op" id="8373630">,</span>&nbsp;<span class="ident" id="8373632">nil</span><span class="op" id="8373635">}</span><span class="op" id="8373636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373641">{</span><span class="ident" id="8373642">c2</span><span class="op" id="8373644">.</span><span class="ident" id="8373645">LocalAddr</span><span class="op" id="8373654">(</span><span class="op" id="8373655">)</span><span class="op" id="8373656">,</span>&nbsp;<span class="op" id="8373658">&amp;</span><span class="ident" id="8373659">UnixAddr</span><span class="op" id="8373667">{</span><span class="ident" id="8373668">Name</span><span class="op" id="8373672">:</span>&nbsp;<span class="ident" id="8373674">laddr</span><span class="op" id="8373679">,</span>&nbsp;<span class="ident" id="8373681">Net</span><span class="op" id="8373684">:</span>&nbsp;<span class="string" id="8373686">&#34;unixgram&#34;</span><span class="op" id="8373696">}</span><span class="op" id="8373697">}</span><span class="op" id="8373698">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373703">{</span><span class="ident" id="8373704">c2</span><span class="op" id="8373706">.</span><span class="ident" id="8373707">RemoteAddr</span><span class="op" id="8373717">(</span><span class="op" id="8373718">)</span><span class="op" id="8373719">,</span>&nbsp;<span class="ident" id="8373721">ta</span><span class="op" id="8373723">}</span><span class="op" id="8373724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373732">for</span>&nbsp;<span class="ident" id="8373736">_</span><span class="op" id="8373737">,</span>&nbsp;<span class="ident" id="8373739">ca</span>&nbsp;<span class="op" id="8373742">:=</span>&nbsp;<span class="keyword" id="8373745">range</span>&nbsp;<span class="ident" id="8373751">connAddrs</span>&nbsp;<span class="op" id="8373761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8373766">if</span>&nbsp;<span class="op" id="8373769">!</span><span class="ident" id="8373770">reflect</span><span class="op" id="8373777">.</span><span class="ident" id="8373778">DeepEqual</span><span class="op" id="8373787">(</span><span class="ident" id="8373788">ca</span><span class="op" id="8373790">.</span><span class="ident" id="8373791">got</span><span class="op" id="8373794">,</span>&nbsp;<span class="ident" id="8373796">ca</span><span class="op" id="8373798">.</span><span class="ident" id="8373799">want</span><span class="op" id="8373803">)</span>&nbsp;<span class="op" id="8373805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8373811">t</span><span class="op" id="8373812">.</span><span class="ident" id="8373813">Fatalf</span><span class="op" id="8373819">(</span><span class="string" id="8373820">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8373843">,</span>&nbsp;<span class="ident" id="8373845">ca</span><span class="op" id="8373847">.</span><span class="ident" id="8373848">got</span><span class="op" id="8373851">,</span>&nbsp;<span class="ident" id="8373853">ca</span><span class="op" id="8373855">.</span><span class="ident" id="8373856">want</span><span class="op" id="8373860">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373872">}</span><br>
<span class="lineno"></span><span class="op" id="8373874">}</span>
</div>
</body>
</html>
