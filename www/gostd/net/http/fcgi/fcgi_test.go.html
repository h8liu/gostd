<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7242135">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7242190">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7242244">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7242295">package</span>&nbsp;<span class="ident" id="7242303">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7242309">import</span>&nbsp;<span class="op" id="7242316">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7242319">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7242328">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7242338">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7242344">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7242354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7242357">var</span>&nbsp;<span class="ident" id="7242361">sizeTests</span>&nbsp;<span class="op" id="7242371">=</span>&nbsp;<span class="op" id="7242373">[</span><span class="op" id="7242374">]</span><span class="keyword" id="7242375">struct</span>&nbsp;<span class="op" id="7242382">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242385">size</span>&nbsp;&nbsp;<span class="builtintype" id="7242391">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242399">bytes</span>&nbsp;<span class="op" id="7242405">[</span><span class="op" id="7242406">]</span><span class="builtintype" id="7242407">byte</span><br>
<span class="lineno"></span><span class="op" id="7242412">}</span><span class="op" id="7242413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242416">{</span><span class="num" id="7242417">0</span><span class="op" id="7242418">,</span>&nbsp;<span class="op" id="7242420">[</span><span class="op" id="7242421">]</span><span class="builtintype" id="7242422">byte</span><span class="op" id="7242426">{</span><span class="num" id="7242427">0x00</span><span class="op" id="7242431">}</span><span class="op" id="7242432">}</span><span class="op" id="7242433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242436">{</span><span class="num" id="7242437">127</span><span class="op" id="7242440">,</span>&nbsp;<span class="op" id="7242442">[</span><span class="op" id="7242443">]</span><span class="builtintype" id="7242444">byte</span><span class="op" id="7242448">{</span><span class="num" id="7242449">0x7F</span><span class="op" id="7242453">}</span><span class="op" id="7242454">}</span><span class="op" id="7242455">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242458">{</span><span class="num" id="7242459">128</span><span class="op" id="7242462">,</span>&nbsp;<span class="op" id="7242464">[</span><span class="op" id="7242465">]</span><span class="builtintype" id="7242466">byte</span><span class="op" id="7242470">{</span><span class="num" id="7242471">0x80</span><span class="op" id="7242475">,</span>&nbsp;<span class="num" id="7242477">0x00</span><span class="op" id="7242481">,</span>&nbsp;<span class="num" id="7242483">0x00</span><span class="op" id="7242487">,</span>&nbsp;<span class="num" id="7242489">0x80</span><span class="op" id="7242493">}</span><span class="op" id="7242494">}</span><span class="op" id="7242495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242498">{</span><span class="num" id="7242499">1000</span><span class="op" id="7242503">,</span>&nbsp;<span class="op" id="7242505">[</span><span class="op" id="7242506">]</span><span class="builtintype" id="7242507">byte</span><span class="op" id="7242511">{</span><span class="num" id="7242512">0x80</span><span class="op" id="7242516">,</span>&nbsp;<span class="num" id="7242518">0x00</span><span class="op" id="7242522">,</span>&nbsp;<span class="num" id="7242524">0x03</span><span class="op" id="7242528">,</span>&nbsp;<span class="num" id="7242530">0xE8</span><span class="op" id="7242534">}</span><span class="op" id="7242535">}</span><span class="op" id="7242536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242539">{</span><span class="num" id="7242540">33554431</span><span class="op" id="7242548">,</span>&nbsp;<span class="op" id="7242550">[</span><span class="op" id="7242551">]</span><span class="builtintype" id="7242552">byte</span><span class="op" id="7242556">{</span><span class="num" id="7242557">0x81</span><span class="op" id="7242561">,</span>&nbsp;<span class="num" id="7242563">0xFF</span><span class="op" id="7242567">,</span>&nbsp;<span class="num" id="7242569">0xFF</span><span class="op" id="7242573">,</span>&nbsp;<span class="num" id="7242575">0xFF</span><span class="op" id="7242579">}</span><span class="op" id="7242580">}</span><span class="op" id="7242581">,</span><br>
<span class="lineno"></span><span class="op" id="7242583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7242586">func</span>&nbsp;<span class="ident" id="7242591">TestSize</span><span class="op" id="7242599">(</span><span class="ident" id="7242600">t</span>&nbsp;<span class="op" id="7242602">*</span><span class="ident" id="7242603">testing</span><span class="op" id="7242610">.</span><span class="ident" id="7242611">T</span><span class="op" id="7242612">)</span>&nbsp;<span class="op" id="7242614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242617">b</span>&nbsp;<span class="op" id="7242619">:=</span>&nbsp;<span class="builtinfunc" id="7242622">make</span><span class="op" id="7242626">(</span><span class="op" id="7242627">[</span><span class="op" id="7242628">]</span><span class="builtintype" id="7242629">byte</span><span class="op" id="7242633">,</span>&nbsp;<span class="num" id="7242635">4</span><span class="op" id="7242636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242639">for</span>&nbsp;<span class="ident" id="7242643">i</span><span class="op" id="7242644">,</span>&nbsp;<span class="ident" id="7242646">test</span>&nbsp;<span class="op" id="7242651">:=</span>&nbsp;<span class="keyword" id="7242654">range</span>&nbsp;<span class="ident" id="7242660">sizeTests</span>&nbsp;<span class="op" id="7242670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242674">n</span>&nbsp;<span class="op" id="7242676">:=</span>&nbsp;<span class="ident" id="7242679">encodeSize</span><span class="op" id="7242689">(</span><span class="ident" id="7242690">b</span><span class="op" id="7242691">,</span>&nbsp;<span class="ident" id="7242693">test</span><span class="op" id="7242697">.</span><span class="ident" id="7242698">size</span><span class="op" id="7242702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242706">if</span>&nbsp;<span class="op" id="7242709">!</span><span class="ident" id="7242710">bytes</span><span class="op" id="7242715">.</span><span class="ident" id="7242716">Equal</span><span class="op" id="7242721">(</span><span class="ident" id="7242722">b</span><span class="op" id="7242723">[</span><span class="op" id="7242724">:</span><span class="ident" id="7242725">n</span><span class="op" id="7242726">]</span><span class="op" id="7242727">,</span>&nbsp;<span class="ident" id="7242729">test</span><span class="op" id="7242733">.</span><span class="ident" id="7242734">bytes</span><span class="op" id="7242739">)</span>&nbsp;<span class="op" id="7242741">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242746">t</span><span class="op" id="7242747">.</span><span class="ident" id="7242748">Errorf</span><span class="op" id="7242754">(</span><span class="string" id="7242755">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="7242783">,</span>&nbsp;<span class="ident" id="7242785">i</span><span class="op" id="7242786">,</span>&nbsp;<span class="ident" id="7242788">test</span><span class="op" id="7242792">.</span><span class="ident" id="7242793">bytes</span><span class="op" id="7242798">,</span>&nbsp;<span class="ident" id="7242800">b</span><span class="op" id="7242801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242809">size</span><span class="op" id="7242813">,</span>&nbsp;<span class="ident" id="7242815">n</span>&nbsp;<span class="op" id="7242817">:=</span>&nbsp;<span class="ident" id="7242820">readSize</span><span class="op" id="7242828">(</span><span class="ident" id="7242829">test</span><span class="op" id="7242833">.</span><span class="ident" id="7242834">bytes</span><span class="op" id="7242839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242843">if</span>&nbsp;<span class="ident" id="7242846">size</span>&nbsp;<span class="op" id="7242851">!=</span>&nbsp;<span class="ident" id="7242854">test</span><span class="op" id="7242858">.</span><span class="ident" id="7242859">size</span>&nbsp;<span class="op" id="7242864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242869">t</span><span class="op" id="7242870">.</span><span class="ident" id="7242871">Errorf</span><span class="op" id="7242877">(</span><span class="string" id="7242878">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7242903">,</span>&nbsp;<span class="ident" id="7242905">i</span><span class="op" id="7242906">,</span>&nbsp;<span class="ident" id="7242908">test</span><span class="op" id="7242912">.</span><span class="ident" id="7242913">size</span><span class="op" id="7242917">,</span>&nbsp;<span class="ident" id="7242919">size</span><span class="op" id="7242923">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7242927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7242931">if</span>&nbsp;<span class="builtinfunc" id="7242934">len</span><span class="op" id="7242937">(</span><span class="ident" id="7242938">test</span><span class="op" id="7242942">.</span><span class="ident" id="7242943">bytes</span><span class="op" id="7242948">)</span>&nbsp;<span class="op" id="7242950">!=</span>&nbsp;<span class="ident" id="7242953">n</span>&nbsp;<span class="op" id="7242955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7242960">t</span><span class="op" id="7242961">.</span><span class="ident" id="7242962">Errorf</span><span class="op" id="7242968">(</span><span class="string" id="7242969">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="7243003">,</span>&nbsp;<span class="ident" id="7243005">i</span><span class="op" id="7243006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243013">}</span><br>
<span class="lineno">40</span><span class="op" id="7243015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243018">var</span>&nbsp;<span class="ident" id="7243022">streamTests</span>&nbsp;<span class="op" id="7243034">=</span>&nbsp;<span class="op" id="7243036">[</span><span class="op" id="7243037">]</span><span class="keyword" id="7243038">struct</span>&nbsp;<span class="op" id="7243045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243048">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7243056">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243064">recType</span>&nbsp;<span class="ident" id="7243072">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243081">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7243089">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243097">content</span>&nbsp;<span class="op" id="7243105">[</span><span class="op" id="7243106">]</span><span class="builtintype" id="7243107">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243113">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243121">[</span><span class="op" id="7243122">]</span><span class="builtintype" id="7243123">byte</span><br>
<span class="lineno"></span><span class="op" id="7243128">}</span><span class="op" id="7243129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243132">{</span><span class="string" id="7243133">&#34;single&nbsp;record&#34;</span><span class="op" id="7243148">,</span>&nbsp;<span class="ident" id="7243150">typeStdout</span><span class="op" id="7243160">,</span>&nbsp;<span class="num" id="7243162">1</span><span class="op" id="7243163">,</span>&nbsp;<span class="builtintype" id="7243165">nil</span><span class="op" id="7243168">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243172">[</span><span class="op" id="7243173">]</span><span class="builtintype" id="7243174">byte</span><span class="op" id="7243178">{</span><span class="num" id="7243179">1</span><span class="op" id="7243180">,</span>&nbsp;<span class="builtintype" id="7243182">byte</span><span class="op" id="7243186">(</span><span class="ident" id="7243187">typeStdout</span><span class="op" id="7243197">)</span><span class="op" id="7243198">,</span>&nbsp;<span class="num" id="7243200">0</span><span class="op" id="7243201">,</span>&nbsp;<span class="num" id="7243203">1</span><span class="op" id="7243204">,</span>&nbsp;<span class="num" id="7243206">0</span><span class="op" id="7243207">,</span>&nbsp;<span class="num" id="7243209">0</span><span class="op" id="7243210">,</span>&nbsp;<span class="num" id="7243212">0</span><span class="op" id="7243213">,</span>&nbsp;<span class="num" id="7243215">0</span><span class="op" id="7243216">}</span><span class="op" id="7243217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243220">}</span><span class="op" id="7243221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7243224">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243277">{</span><span class="string" id="7243278">&#34;two&nbsp;records&#34;</span><span class="op" id="7243291">,</span>&nbsp;<span class="ident" id="7243293">typeStdin</span><span class="op" id="7243302">,</span>&nbsp;<span class="num" id="7243304">300</span><span class="op" id="7243307">,</span>&nbsp;<span class="builtinfunc" id="7243309">make</span><span class="op" id="7243313">(</span><span class="op" id="7243314">[</span><span class="op" id="7243315">]</span><span class="builtintype" id="7243316">byte</span><span class="op" id="7243320">,</span>&nbsp;<span class="num" id="7243322">66000</span><span class="op" id="7243327">)</span><span class="op" id="7243328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243332">bytes</span><span class="op" id="7243337">.</span><span class="ident" id="7243338">Join</span><span class="op" id="7243342">(</span><span class="op" id="7243343">[</span><span class="op" id="7243344">]</span><span class="op" id="7243345">[</span><span class="op" id="7243346">]</span><span class="builtintype" id="7243347">byte</span><span class="op" id="7243351">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7243356">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243390">{</span><span class="num" id="7243391">1</span><span class="op" id="7243392">,</span>&nbsp;<span class="builtintype" id="7243394">byte</span><span class="op" id="7243398">(</span><span class="ident" id="7243399">typeStdin</span><span class="op" id="7243408">)</span><span class="op" id="7243409">,</span>&nbsp;<span class="num" id="7243411">0x01</span><span class="op" id="7243415">,</span>&nbsp;<span class="num" id="7243417">0x2C</span><span class="op" id="7243421">,</span>&nbsp;<span class="num" id="7243423">0xFF</span><span class="op" id="7243427">,</span>&nbsp;<span class="num" id="7243429">0xFF</span><span class="op" id="7243433">,</span>&nbsp;<span class="num" id="7243435">1</span><span class="op" id="7243436">,</span>&nbsp;<span class="num" id="7243438">0</span><span class="op" id="7243439">}</span><span class="op" id="7243440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7243445">make</span><span class="op" id="7243449">(</span><span class="op" id="7243450">[</span><span class="op" id="7243451">]</span><span class="builtintype" id="7243452">byte</span><span class="op" id="7243456">,</span>&nbsp;<span class="num" id="7243458">65536</span><span class="op" id="7243463">)</span><span class="op" id="7243464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7243469">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243497">{</span><span class="num" id="7243498">1</span><span class="op" id="7243499">,</span>&nbsp;<span class="builtintype" id="7243501">byte</span><span class="op" id="7243505">(</span><span class="ident" id="7243506">typeStdin</span><span class="op" id="7243515">)</span><span class="op" id="7243516">,</span>&nbsp;<span class="num" id="7243518">0x01</span><span class="op" id="7243522">,</span>&nbsp;<span class="num" id="7243524">0x2C</span><span class="op" id="7243528">,</span>&nbsp;<span class="num" id="7243530">0x01</span><span class="op" id="7243534">,</span>&nbsp;<span class="num" id="7243536">0xD1</span><span class="op" id="7243540">,</span>&nbsp;<span class="num" id="7243542">7</span><span class="op" id="7243543">,</span>&nbsp;<span class="num" id="7243545">0</span><span class="op" id="7243546">}</span><span class="op" id="7243547">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7243552">make</span><span class="op" id="7243556">(</span><span class="op" id="7243557">[</span><span class="op" id="7243558">]</span><span class="builtintype" id="7243559">byte</span><span class="op" id="7243563">,</span>&nbsp;<span class="num" id="7243565">472</span><span class="op" id="7243568">)</span><span class="op" id="7243569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7243574">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243608">{</span><span class="num" id="7243609">1</span><span class="op" id="7243610">,</span>&nbsp;<span class="builtintype" id="7243612">byte</span><span class="op" id="7243616">(</span><span class="ident" id="7243617">typeStdin</span><span class="op" id="7243626">)</span><span class="op" id="7243627">,</span>&nbsp;<span class="num" id="7243629">0x01</span><span class="op" id="7243633">,</span>&nbsp;<span class="num" id="7243635">0x2C</span><span class="op" id="7243639">,</span>&nbsp;<span class="num" id="7243641">0</span><span class="op" id="7243642">,</span>&nbsp;<span class="num" id="7243644">0</span><span class="op" id="7243645">,</span>&nbsp;<span class="num" id="7243647">0</span><span class="op" id="7243648">,</span>&nbsp;<span class="num" id="7243650">0</span><span class="op" id="7243651">}</span><span class="op" id="7243652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243656">}</span><span class="op" id="7243657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7243662">nil</span><span class="op" id="7243665">)</span><span class="op" id="7243666">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7243669">}</span><span class="op" id="7243670">,</span><br>
<span class="lineno"></span><span class="op" id="7243672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243675">type</span>&nbsp;<span class="ident" id="7243680">nilCloser</span>&nbsp;<span class="keyword" id="7243690">struct</span>&nbsp;<span class="op" id="7243697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243700">io</span><span class="op" id="7243702">.</span><span class="ident" id="7243703">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="7243714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243717">func</span>&nbsp;<span class="op" id="7243722">(</span><span class="ident" id="7243723">c</span>&nbsp;<span class="op" id="7243725">*</span><span class="ident" id="7243726">nilCloser</span><span class="op" id="7243735">)</span>&nbsp;<span class="ident" id="7243737">Close</span><span class="op" id="7243742">(</span><span class="op" id="7243743">)</span>&nbsp;<span class="builtintype" id="7243745">error</span>&nbsp;<span class="op" id="7243751">{</span>&nbsp;<span class="keyword" id="7243753">return</span>&nbsp;<span class="builtintype" id="7243760">nil</span>&nbsp;<span class="op" id="7243764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7243767">func</span>&nbsp;<span class="ident" id="7243772">TestStreams</span><span class="op" id="7243783">(</span><span class="ident" id="7243784">t</span>&nbsp;<span class="op" id="7243786">*</span><span class="ident" id="7243787">testing</span><span class="op" id="7243794">.</span><span class="ident" id="7243795">T</span><span class="op" id="7243796">)</span>&nbsp;<span class="op" id="7243798">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7243801">var</span>&nbsp;<span class="ident" id="7243805">rec</span>&nbsp;<span class="ident" id="7243809">record</span><br>
<span class="lineno"></span><span class="ident" id="7243816">outer</span><span class="op" id="7243821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7243824">for</span>&nbsp;<span class="ident" id="7243828">_</span><span class="op" id="7243829">,</span>&nbsp;<span class="ident" id="7243831">test</span>&nbsp;<span class="op" id="7243836">:=</span>&nbsp;<span class="keyword" id="7243839">range</span>&nbsp;<span class="ident" id="7243845">streamTests</span>&nbsp;<span class="op" id="7243857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243861">buf</span>&nbsp;<span class="op" id="7243865">:=</span>&nbsp;<span class="ident" id="7243868">bytes</span><span class="op" id="7243873">.</span><span class="ident" id="7243874">NewBuffer</span><span class="op" id="7243883">(</span><span class="ident" id="7243884">test</span><span class="op" id="7243888">.</span><span class="ident" id="7243889">raw</span><span class="op" id="7243892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7243896">var</span>&nbsp;<span class="ident" id="7243900">content</span>&nbsp;<span class="op" id="7243908">[</span><span class="op" id="7243909">]</span><span class="builtintype" id="7243910">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7243917">for</span>&nbsp;<span class="ident" id="7243921">buf</span><span class="op" id="7243924">.</span><span class="ident" id="7243925">Len</span><span class="op" id="7243928">(</span><span class="op" id="7243929">)</span>&nbsp;<span class="op" id="7243931">&gt;</span>&nbsp;<span class="num" id="7243933">0</span>&nbsp;<span class="op" id="7243935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7243940">if</span>&nbsp;<span class="ident" id="7243943">err</span>&nbsp;<span class="op" id="7243947">:=</span>&nbsp;<span class="ident" id="7243950">rec</span><span class="op" id="7243953">.</span><span class="ident" id="7243954">read</span><span class="op" id="7243958">(</span><span class="ident" id="7243959">buf</span><span class="op" id="7243962">)</span><span class="op" id="7243963">;</span>&nbsp;<span class="ident" id="7243965">err</span>&nbsp;<span class="op" id="7243969">!=</span>&nbsp;<span class="builtintype" id="7243972">nil</span>&nbsp;<span class="op" id="7243976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7243982">t</span><span class="op" id="7243983">.</span><span class="ident" id="7243984">Errorf</span><span class="op" id="7243990">(</span><span class="string" id="7243991">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7244021">,</span>&nbsp;<span class="ident" id="7244023">test</span><span class="op" id="7244027">.</span><span class="ident" id="7244028">desc</span><span class="op" id="7244032">,</span>&nbsp;<span class="ident" id="7244034">err</span><span class="op" id="7244037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244043">continue</span>&nbsp;<span class="ident" id="7244052">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244061">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244066">content</span>&nbsp;<span class="op" id="7244074">=</span>&nbsp;<span class="builtinfunc" id="7244076">append</span><span class="op" id="7244082">(</span><span class="ident" id="7244083">content</span><span class="op" id="7244090">,</span>&nbsp;<span class="ident" id="7244092">rec</span><span class="op" id="7244095">.</span><span class="ident" id="7244096">content</span><span class="op" id="7244103">(</span><span class="op" id="7244104">)</span><span class="op" id="7244105">...</span><span class="op" id="7244108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244116">if</span>&nbsp;<span class="ident" id="7244119">rec</span><span class="op" id="7244122">.</span><span class="ident" id="7244123">h</span><span class="op" id="7244124">.</span><span class="ident" id="7244125">Type</span>&nbsp;<span class="op" id="7244130">!=</span>&nbsp;<span class="ident" id="7244133">test</span><span class="op" id="7244137">.</span><span class="ident" id="7244138">recType</span>&nbsp;<span class="op" id="7244146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244151">t</span><span class="op" id="7244152">.</span><span class="ident" id="7244153">Errorf</span><span class="op" id="7244159">(</span><span class="string" id="7244160">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7244189">,</span>&nbsp;<span class="ident" id="7244191">test</span><span class="op" id="7244195">.</span><span class="ident" id="7244196">desc</span><span class="op" id="7244200">,</span>&nbsp;<span class="ident" id="7244202">rec</span><span class="op" id="7244205">.</span><span class="ident" id="7244206">h</span><span class="op" id="7244207">.</span><span class="ident" id="7244208">Type</span><span class="op" id="7244212">,</span>&nbsp;<span class="ident" id="7244214">test</span><span class="op" id="7244218">.</span><span class="ident" id="7244219">recType</span><span class="op" id="7244226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244231">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244246">if</span>&nbsp;<span class="ident" id="7244249">rec</span><span class="op" id="7244252">.</span><span class="ident" id="7244253">h</span><span class="op" id="7244254">.</span><span class="ident" id="7244255">Id</span>&nbsp;<span class="op" id="7244258">!=</span>&nbsp;<span class="ident" id="7244261">test</span><span class="op" id="7244265">.</span><span class="ident" id="7244266">reqId</span>&nbsp;<span class="op" id="7244272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244277">t</span><span class="op" id="7244278">.</span><span class="ident" id="7244279">Errorf</span><span class="op" id="7244285">(</span><span class="string" id="7244286">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7244321">,</span>&nbsp;<span class="ident" id="7244323">test</span><span class="op" id="7244327">.</span><span class="ident" id="7244328">desc</span><span class="op" id="7244332">,</span>&nbsp;<span class="ident" id="7244334">rec</span><span class="op" id="7244337">.</span><span class="ident" id="7244338">h</span><span class="op" id="7244339">.</span><span class="ident" id="7244340">Id</span><span class="op" id="7244342">,</span>&nbsp;<span class="ident" id="7244344">test</span><span class="op" id="7244348">.</span><span class="ident" id="7244349">reqId</span><span class="op" id="7244354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244359">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244370">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244374">if</span>&nbsp;<span class="op" id="7244377">!</span><span class="ident" id="7244378">bytes</span><span class="op" id="7244383">.</span><span class="ident" id="7244384">Equal</span><span class="op" id="7244389">(</span><span class="ident" id="7244390">content</span><span class="op" id="7244397">,</span>&nbsp;<span class="ident" id="7244399">test</span><span class="op" id="7244403">.</span><span class="ident" id="7244404">content</span><span class="op" id="7244411">)</span>&nbsp;<span class="op" id="7244413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244418">t</span><span class="op" id="7244419">.</span><span class="ident" id="7244420">Errorf</span><span class="op" id="7244426">(</span><span class="string" id="7244427">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7244451">,</span>&nbsp;<span class="ident" id="7244453">test</span><span class="op" id="7244457">.</span><span class="ident" id="7244458">desc</span><span class="op" id="7244462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244467">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244482">buf</span><span class="op" id="7244485">.</span><span class="ident" id="7244486">Reset</span><span class="op" id="7244491">(</span><span class="op" id="7244492">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244496">c</span>&nbsp;<span class="op" id="7244498">:=</span>&nbsp;<span class="ident" id="7244501">newConn</span><span class="op" id="7244508">(</span><span class="op" id="7244509">&amp;</span><span class="ident" id="7244510">nilCloser</span><span class="op" id="7244519">{</span><span class="ident" id="7244520">buf</span><span class="op" id="7244523">}</span><span class="op" id="7244524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244528">w</span>&nbsp;<span class="op" id="7244530">:=</span>&nbsp;<span class="ident" id="7244533">newWriter</span><span class="op" id="7244542">(</span><span class="ident" id="7244543">c</span><span class="op" id="7244544">,</span>&nbsp;<span class="ident" id="7244546">test</span><span class="op" id="7244550">.</span><span class="ident" id="7244551">recType</span><span class="op" id="7244558">,</span>&nbsp;<span class="ident" id="7244560">test</span><span class="op" id="7244564">.</span><span class="ident" id="7244565">reqId</span><span class="op" id="7244570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244574">if</span>&nbsp;<span class="ident" id="7244577">_</span><span class="op" id="7244578">,</span>&nbsp;<span class="ident" id="7244580">err</span>&nbsp;<span class="op" id="7244584">:=</span>&nbsp;<span class="ident" id="7244587">w</span><span class="op" id="7244588">.</span><span class="ident" id="7244589">Write</span><span class="op" id="7244594">(</span><span class="ident" id="7244595">test</span><span class="op" id="7244599">.</span><span class="ident" id="7244600">content</span><span class="op" id="7244607">)</span><span class="op" id="7244608">;</span>&nbsp;<span class="ident" id="7244610">err</span>&nbsp;<span class="op" id="7244614">!=</span>&nbsp;<span class="builtintype" id="7244617">nil</span>&nbsp;<span class="op" id="7244621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244626">t</span><span class="op" id="7244627">.</span><span class="ident" id="7244628">Errorf</span><span class="op" id="7244634">(</span><span class="string" id="7244635">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7244665">,</span>&nbsp;<span class="ident" id="7244667">test</span><span class="op" id="7244671">.</span><span class="ident" id="7244672">desc</span><span class="op" id="7244676">,</span>&nbsp;<span class="ident" id="7244678">err</span><span class="op" id="7244681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244686">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244701">if</span>&nbsp;<span class="ident" id="7244704">err</span>&nbsp;<span class="op" id="7244708">:=</span>&nbsp;<span class="ident" id="7244711">w</span><span class="op" id="7244712">.</span><span class="ident" id="7244713">Close</span><span class="op" id="7244718">(</span><span class="op" id="7244719">)</span><span class="op" id="7244720">;</span>&nbsp;<span class="ident" id="7244722">err</span>&nbsp;<span class="op" id="7244726">!=</span>&nbsp;<span class="builtintype" id="7244729">nil</span>&nbsp;<span class="op" id="7244733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244738">t</span><span class="op" id="7244739">.</span><span class="ident" id="7244740">Errorf</span><span class="op" id="7244746">(</span><span class="string" id="7244747">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="7244777">,</span>&nbsp;<span class="ident" id="7244779">test</span><span class="op" id="7244783">.</span><span class="ident" id="7244784">desc</span><span class="op" id="7244788">,</span>&nbsp;<span class="ident" id="7244790">err</span><span class="op" id="7244793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244798">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244809">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7244813">if</span>&nbsp;<span class="op" id="7244816">!</span><span class="ident" id="7244817">bytes</span><span class="op" id="7244822">.</span><span class="ident" id="7244823">Equal</span><span class="op" id="7244828">(</span><span class="ident" id="7244829">buf</span><span class="op" id="7244832">.</span><span class="ident" id="7244833">Bytes</span><span class="op" id="7244838">(</span><span class="op" id="7244839">)</span><span class="op" id="7244840">,</span>&nbsp;<span class="ident" id="7244842">test</span><span class="op" id="7244846">.</span><span class="ident" id="7244847">raw</span><span class="op" id="7244850">)</span>&nbsp;<span class="op" id="7244852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244857">t</span><span class="op" id="7244858">.</span><span class="ident" id="7244859">Errorf</span><span class="op" id="7244865">(</span><span class="string" id="7244866">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7244891">,</span>&nbsp;<span class="ident" id="7244893">test</span><span class="op" id="7244897">.</span><span class="ident" id="7244898">desc</span><span class="op" id="7244902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7244909">}</span><br>
<span class="lineno"></span><span class="op" id="7244911">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7244914">type</span>&nbsp;<span class="ident" id="7244919">writeOnlyConn</span>&nbsp;<span class="keyword" id="7244933">struct</span>&nbsp;<span class="op" id="7244940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7244943">buf</span>&nbsp;<span class="op" id="7244947">[</span><span class="op" id="7244948">]</span><span class="builtintype" id="7244949">byte</span><br>
<span class="lineno"></span><span class="op" id="7244954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7244957">func</span>&nbsp;<span class="op" id="7244962">(</span><span class="ident" id="7244963">c</span>&nbsp;<span class="op" id="7244965">*</span><span class="ident" id="7244966">writeOnlyConn</span><span class="op" id="7244979">)</span>&nbsp;<span class="ident" id="7244981">Write</span><span class="op" id="7244986">(</span><span class="ident" id="7244987">p</span>&nbsp;<span class="op" id="7244989">[</span><span class="op" id="7244990">]</span><span class="builtintype" id="7244991">byte</span><span class="op" id="7244995">)</span>&nbsp;<span class="op" id="7244997">(</span><span class="builtintype" id="7244998">int</span><span class="op" id="7245001">,</span>&nbsp;<span class="builtintype" id="7245003">error</span><span class="op" id="7245008">)</span>&nbsp;<span class="op" id="7245010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245013">c</span><span class="op" id="7245014">.</span><span class="ident" id="7245015">buf</span>&nbsp;<span class="op" id="7245019">=</span>&nbsp;<span class="builtinfunc" id="7245021">append</span><span class="op" id="7245027">(</span><span class="ident" id="7245028">c</span><span class="op" id="7245029">.</span><span class="ident" id="7245030">buf</span><span class="op" id="7245033">,</span>&nbsp;<span class="ident" id="7245035">p</span><span class="op" id="7245036">...</span><span class="op" id="7245039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245042">return</span>&nbsp;<span class="builtinfunc" id="7245049">len</span><span class="op" id="7245052">(</span><span class="ident" id="7245053">p</span><span class="op" id="7245054">)</span><span class="op" id="7245055">,</span>&nbsp;<span class="builtintype" id="7245057">nil</span><br>
<span class="lineno"></span><span class="op" id="7245061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7245064">func</span>&nbsp;<span class="op" id="7245069">(</span><span class="ident" id="7245070">c</span>&nbsp;<span class="op" id="7245072">*</span><span class="ident" id="7245073">writeOnlyConn</span><span class="op" id="7245086">)</span>&nbsp;<span class="ident" id="7245088">Read</span><span class="op" id="7245092">(</span><span class="ident" id="7245093">p</span>&nbsp;<span class="op" id="7245095">[</span><span class="op" id="7245096">]</span><span class="builtintype" id="7245097">byte</span><span class="op" id="7245101">)</span>&nbsp;<span class="op" id="7245103">(</span><span class="builtintype" id="7245104">int</span><span class="op" id="7245107">,</span>&nbsp;<span class="builtintype" id="7245109">error</span><span class="op" id="7245114">)</span>&nbsp;<span class="op" id="7245116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245119">return</span>&nbsp;<span class="num" id="7245126">0</span><span class="op" id="7245127">,</span>&nbsp;<span class="ident" id="7245129">errors</span><span class="op" id="7245135">.</span><span class="ident" id="7245136">New</span><span class="op" id="7245139">(</span><span class="string" id="7245140">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="7245160">)</span><br>
<span class="lineno"></span><span class="op" id="7245162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7245165">func</span>&nbsp;<span class="op" id="7245170">(</span><span class="ident" id="7245171">c</span>&nbsp;<span class="op" id="7245173">*</span><span class="ident" id="7245174">writeOnlyConn</span><span class="op" id="7245187">)</span>&nbsp;<span class="ident" id="7245189">Close</span><span class="op" id="7245194">(</span><span class="op" id="7245195">)</span>&nbsp;<span class="builtintype" id="7245197">error</span>&nbsp;<span class="op" id="7245203">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245206">return</span>&nbsp;<span class="builtintype" id="7245213">nil</span><br>
<span class="lineno"></span><span class="op" id="7245217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7245220">func</span>&nbsp;<span class="ident" id="7245225">TestGetValues</span><span class="op" id="7245238">(</span><span class="ident" id="7245239">t</span>&nbsp;<span class="op" id="7245241">*</span><span class="ident" id="7245242">testing</span><span class="op" id="7245249">.</span><span class="ident" id="7245250">T</span><span class="op" id="7245251">)</span>&nbsp;<span class="op" id="7245253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245256">var</span>&nbsp;<span class="ident" id="7245260">rec</span>&nbsp;<span class="ident" id="7245264">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245272">rec</span><span class="op" id="7245275">.</span><span class="ident" id="7245276">h</span><span class="op" id="7245277">.</span><span class="ident" id="7245278">Type</span>&nbsp;<span class="op" id="7245283">=</span>&nbsp;<span class="ident" id="7245285">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245301">wc</span>&nbsp;<span class="op" id="7245304">:=</span>&nbsp;<span class="builtinfunc" id="7245307">new</span><span class="op" id="7245310">(</span><span class="ident" id="7245311">writeOnlyConn</span><span class="op" id="7245324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245327">c</span>&nbsp;<span class="op" id="7245329">:=</span>&nbsp;<span class="ident" id="7245332">newChild</span><span class="op" id="7245340">(</span><span class="ident" id="7245341">wc</span><span class="op" id="7245343">,</span>&nbsp;<span class="builtintype" id="7245345">nil</span><span class="op" id="7245348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245351">err</span>&nbsp;<span class="op" id="7245355">:=</span>&nbsp;<span class="ident" id="7245358">c</span><span class="op" id="7245359">.</span><span class="ident" id="7245360">handleRecord</span><span class="op" id="7245372">(</span><span class="op" id="7245373">&amp;</span><span class="ident" id="7245374">rec</span><span class="op" id="7245377">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245380">if</span>&nbsp;<span class="ident" id="7245383">err</span>&nbsp;<span class="op" id="7245387">!=</span>&nbsp;<span class="builtintype" id="7245390">nil</span>&nbsp;<span class="op" id="7245394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245398">t</span><span class="op" id="7245399">.</span><span class="ident" id="7245400">Fatalf</span><span class="op" id="7245406">(</span><span class="string" id="7245407">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="7245425">,</span>&nbsp;<span class="ident" id="7245427">err</span><span class="op" id="7245430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7245433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245437">const</span>&nbsp;<span class="ident" id="7245443">want</span>&nbsp;<span class="op" id="7245448">=</span>&nbsp;<span class="string" id="7245450">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="7245483">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7245487">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="7245514">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7245518">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7245576">if</span>&nbsp;<span class="ident" id="7245579">got</span>&nbsp;<span class="op" id="7245583">:=</span>&nbsp;<span class="builtintype" id="7245586">string</span><span class="op" id="7245592">(</span><span class="ident" id="7245593">wc</span><span class="op" id="7245595">.</span><span class="ident" id="7245596">buf</span><span class="op" id="7245599">)</span><span class="op" id="7245600">;</span>&nbsp;<span class="ident" id="7245602">got</span>&nbsp;<span class="op" id="7245606">!=</span>&nbsp;<span class="ident" id="7245609">want</span>&nbsp;<span class="op" id="7245614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7245618">t</span><span class="op" id="7245619">.</span><span class="ident" id="7245620">Errorf</span><span class="op" id="7245626">(</span><span class="string" id="7245627">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7245649">,</span>&nbsp;<span class="ident" id="7245651">got</span><span class="op" id="7245654">,</span>&nbsp;<span class="ident" id="7245656">want</span><span class="op" id="7245660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7245663">}</span><br>
<span class="lineno">150</span><span class="op" id="7245665">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
