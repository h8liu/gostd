<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6326068">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6326123">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6326177">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6326228">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="6326308">package</span>&nbsp;<span class="ident" id="6326316">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6326327">import</span>&nbsp;<span class="op" id="6326334">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326337">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326347">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326354">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326361">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326373">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326384">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326392">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326403">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6326411">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6326418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6326421">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6326494">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6326549">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6326619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="6326690">//</span><br>
<span class="lineno">25</span><span class="comment" id="6326693">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6326767">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6326791">//</span><br>
<span class="lineno"></span><span class="comment" id="6326794">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6326869">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="6326948">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="6326977">//</span><br>
<span class="lineno"></span><span class="comment" id="6326980">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6327037">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6327071">type</span>&nbsp;<span class="ident" id="6327076">PublicSuffixList</span>&nbsp;<span class="keyword" id="6327093">interface</span>&nbsp;<span class="op" id="6327103">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327106">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327160">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327164">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327235">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327307">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327329">PublicSuffix</span><span class="op" id="6327341">(</span><span class="ident" id="6327342">domain</span>&nbsp;<span class="builtintype" id="6327349">string</span><span class="op" id="6327355">)</span>&nbsp;<span class="builtintype" id="6327357">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327366">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327435">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327506">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327535">String</span><span class="op" id="6327541">(</span><span class="op" id="6327542">)</span>&nbsp;<span class="builtintype" id="6327544">string</span><br>
<span class="lineno"></span><span class="op" id="6327551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6327554">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6327605">type</span>&nbsp;<span class="ident" id="6327610">Options</span>&nbsp;<span class="keyword" id="6327618">struct</span>&nbsp;<span class="op" id="6327625">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327628">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327699">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327749">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327753">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327822">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327895">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327914">PublicSuffixList</span>&nbsp;<span class="ident" id="6327931">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="6327948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6327951">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="6328025">type</span>&nbsp;<span class="ident" id="6328030">Jar</span>&nbsp;<span class="keyword" id="6328034">struct</span>&nbsp;<span class="op" id="6328041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328044">psList</span>&nbsp;<span class="ident" id="6328051">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328070">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328105">mu</span>&nbsp;<span class="ident" id="6328108">sync</span><span class="op" id="6328112">.</span><span class="ident" id="6328113">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328121">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328192">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328220">entries</span>&nbsp;<span class="keyword" id="6328228">map</span><span class="op" id="6328231">[</span><span class="builtintype" id="6328232">string</span><span class="op" id="6328238">]</span><span class="keyword" id="6328239">map</span><span class="op" id="6328242">[</span><span class="builtintype" id="6328243">string</span><span class="op" id="6328249">]</span><span class="ident" id="6328250">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328258">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328326">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328350">nextSeqNum</span>&nbsp;<span class="ident" id="6328361">uint64</span><br>
<span class="lineno"></span><span class="op" id="6328368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6328371">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="6328443">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="6328455">func</span>&nbsp;<span class="ident" id="6328460">New</span><span class="op" id="6328463">(</span><span class="ident" id="6328464">o</span>&nbsp;<span class="op" id="6328466">*</span><span class="ident" id="6328467">Options</span><span class="op" id="6328474">)</span>&nbsp;<span class="op" id="6328476">(</span><span class="op" id="6328477">*</span><span class="ident" id="6328478">Jar</span><span class="op" id="6328481">,</span>&nbsp;<span class="builtintype" id="6328483">error</span><span class="op" id="6328488">)</span>&nbsp;<span class="op" id="6328490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328493">jar</span>&nbsp;<span class="op" id="6328497">:=</span>&nbsp;<span class="op" id="6328500">&amp;</span><span class="ident" id="6328501">Jar</span><span class="op" id="6328504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328508">entries</span><span class="op" id="6328515">:</span>&nbsp;<span class="builtinfunc" id="6328517">make</span><span class="op" id="6328521">(</span><span class="keyword" id="6328522">map</span><span class="op" id="6328525">[</span><span class="builtintype" id="6328526">string</span><span class="op" id="6328532">]</span><span class="keyword" id="6328533">map</span><span class="op" id="6328536">[</span><span class="builtintype" id="6328537">string</span><span class="op" id="6328543">]</span><span class="ident" id="6328544">entry</span><span class="op" id="6328549">)</span><span class="op" id="6328550">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328556">if</span>&nbsp;<span class="ident" id="6328559">o</span>&nbsp;<span class="op" id="6328561">!=</span>&nbsp;<span class="ident" id="6328564">nil</span>&nbsp;<span class="op" id="6328568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328572">jar</span><span class="op" id="6328575">.</span><span class="ident" id="6328576">psList</span>&nbsp;<span class="op" id="6328583">=</span>&nbsp;<span class="ident" id="6328585">o</span><span class="op" id="6328586">.</span><span class="ident" id="6328587">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328608">return</span>&nbsp;<span class="ident" id="6328615">jar</span><span class="op" id="6328618">,</span>&nbsp;<span class="ident" id="6328620">nil</span><br>
<span class="lineno">85</span><span class="op" id="6328624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6328627">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="6328680">//</span><br>
<span class="lineno"></span><span class="comment" id="6328683">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="6328764">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="6328797">type</span>&nbsp;<span class="ident" id="6328802">entry</span>&nbsp;<span class="keyword" id="6328808">struct</span>&nbsp;<span class="op" id="6328815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328818">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328829">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328837">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328848">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328856">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328867">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328875">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328886">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328894">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328905">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328911">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328922">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328928">Persistent</span>&nbsp;<span class="builtintype" id="6328939">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328945">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6328956">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328962">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6328973">time</span><span class="op" id="6328977">.</span><span class="ident" id="6328978">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328984">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6328995">time</span><span class="op" id="6328999">.</span><span class="ident" id="6329000">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329006">LastAccess</span>&nbsp;<span class="ident" id="6329017">time</span><span class="op" id="6329021">.</span><span class="ident" id="6329022">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329029">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329098">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329172">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329222">seqNum</span>&nbsp;<span class="ident" id="6329229">uint64</span><br>
<span class="lineno"></span><span class="op" id="6329236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6329239">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="6329296">func</span>&nbsp;<span class="op" id="6329301">(</span><span class="ident" id="6329302">e</span>&nbsp;<span class="op" id="6329304">*</span><span class="ident" id="6329305">entry</span><span class="op" id="6329310">)</span>&nbsp;<span class="ident" id="6329312">id</span><span class="op" id="6329314">(</span><span class="op" id="6329315">)</span>&nbsp;<span class="builtintype" id="6329317">string</span>&nbsp;<span class="op" id="6329324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329327">return</span>&nbsp;<span class="ident" id="6329334">fmt</span><span class="op" id="6329337">.</span><span class="ident" id="6329338">Sprintf</span><span class="op" id="6329345">(</span><span class="string" id="6329346">&#34;%s;%s;%s&#34;</span><span class="op" id="6329356">,</span>&nbsp;<span class="ident" id="6329358">e</span><span class="op" id="6329359">.</span><span class="ident" id="6329360">Domain</span><span class="op" id="6329366">,</span>&nbsp;<span class="ident" id="6329368">e</span><span class="op" id="6329369">.</span><span class="ident" id="6329370">Path</span><span class="op" id="6329374">,</span>&nbsp;<span class="ident" id="6329376">e</span><span class="op" id="6329377">.</span><span class="ident" id="6329378">Name</span><span class="op" id="6329382">)</span><br>
<span class="lineno"></span><span class="op" id="6329384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6329387">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6329461">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6329536">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="6329558">func</span>&nbsp;<span class="op" id="6329563">(</span><span class="ident" id="6329564">e</span>&nbsp;<span class="op" id="6329566">*</span><span class="ident" id="6329567">entry</span><span class="op" id="6329572">)</span>&nbsp;<span class="ident" id="6329574">shouldSend</span><span class="op" id="6329584">(</span><span class="ident" id="6329585">https</span>&nbsp;<span class="builtintype" id="6329591">bool</span><span class="op" id="6329595">,</span>&nbsp;<span class="ident" id="6329597">host</span><span class="op" id="6329601">,</span>&nbsp;<span class="ident" id="6329603">path</span>&nbsp;<span class="builtintype" id="6329608">string</span><span class="op" id="6329614">)</span>&nbsp;<span class="builtintype" id="6329616">bool</span>&nbsp;<span class="op" id="6329621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329624">return</span>&nbsp;<span class="ident" id="6329631">e</span><span class="op" id="6329632">.</span><span class="ident" id="6329633">domainMatch</span><span class="op" id="6329644">(</span><span class="ident" id="6329645">host</span><span class="op" id="6329649">)</span>&nbsp;<span class="op" id="6329651">&amp;&amp;</span>&nbsp;<span class="ident" id="6329654">e</span><span class="op" id="6329655">.</span><span class="ident" id="6329656">pathMatch</span><span class="op" id="6329665">(</span><span class="ident" id="6329666">path</span><span class="op" id="6329670">)</span>&nbsp;<span class="op" id="6329672">&amp;&amp;</span>&nbsp;<span class="op" id="6329675">(</span><span class="ident" id="6329676">https</span>&nbsp;<span class="op" id="6329682">||</span>&nbsp;<span class="op" id="6329685">!</span><span class="ident" id="6329686">e</span><span class="op" id="6329687">.</span><span class="ident" id="6329688">Secure</span><span class="op" id="6329694">)</span><br>
<span class="lineno">120</span><span class="op" id="6329696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6329699">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6329767">func</span>&nbsp;<span class="op" id="6329772">(</span><span class="ident" id="6329773">e</span>&nbsp;<span class="op" id="6329775">*</span><span class="ident" id="6329776">entry</span><span class="op" id="6329781">)</span>&nbsp;<span class="ident" id="6329783">domainMatch</span><span class="op" id="6329794">(</span><span class="ident" id="6329795">host</span>&nbsp;<span class="builtintype" id="6329800">string</span><span class="op" id="6329806">)</span>&nbsp;<span class="builtintype" id="6329808">bool</span>&nbsp;<span class="op" id="6329813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329816">if</span>&nbsp;<span class="ident" id="6329819">e</span><span class="op" id="6329820">.</span><span class="ident" id="6329821">Domain</span>&nbsp;<span class="op" id="6329828">==</span>&nbsp;<span class="ident" id="6329831">host</span>&nbsp;<span class="op" id="6329836">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329840">return</span>&nbsp;<span class="builtintype" id="6329847">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329856">return</span>&nbsp;<span class="op" id="6329863">!</span><span class="ident" id="6329864">e</span><span class="op" id="6329865">.</span><span class="ident" id="6329866">HostOnly</span>&nbsp;<span class="op" id="6329875">&amp;&amp;</span>&nbsp;<span class="ident" id="6329878">hasDotSuffix</span><span class="op" id="6329890">(</span><span class="ident" id="6329891">host</span><span class="op" id="6329895">,</span>&nbsp;<span class="ident" id="6329897">e</span><span class="op" id="6329898">.</span><span class="ident" id="6329899">Domain</span><span class="op" id="6329905">)</span><br>
<span class="lineno"></span><span class="op" id="6329907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6329910">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6329984">func</span>&nbsp;<span class="op" id="6329989">(</span><span class="ident" id="6329990">e</span>&nbsp;<span class="op" id="6329992">*</span><span class="ident" id="6329993">entry</span><span class="op" id="6329998">)</span>&nbsp;<span class="ident" id="6330000">pathMatch</span><span class="op" id="6330009">(</span><span class="ident" id="6330010">requestPath</span>&nbsp;<span class="builtintype" id="6330022">string</span><span class="op" id="6330028">)</span>&nbsp;<span class="builtintype" id="6330030">bool</span>&nbsp;<span class="op" id="6330035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330038">if</span>&nbsp;<span class="ident" id="6330041">requestPath</span>&nbsp;<span class="op" id="6330053">==</span>&nbsp;<span class="ident" id="6330056">e</span><span class="op" id="6330057">.</span><span class="ident" id="6330058">Path</span>&nbsp;<span class="op" id="6330063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330067">return</span>&nbsp;<span class="builtintype" id="6330074">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330080">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330083">if</span>&nbsp;<span class="ident" id="6330086">strings</span><span class="op" id="6330093">.</span><span class="ident" id="6330094">HasPrefix</span><span class="op" id="6330103">(</span><span class="ident" id="6330104">requestPath</span><span class="op" id="6330115">,</span>&nbsp;<span class="ident" id="6330117">e</span><span class="op" id="6330118">.</span><span class="ident" id="6330119">Path</span><span class="op" id="6330123">)</span>&nbsp;<span class="op" id="6330125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330129">if</span>&nbsp;<span class="ident" id="6330132">e</span><span class="op" id="6330133">.</span><span class="ident" id="6330134">Path</span><span class="op" id="6330138">[</span><span class="builtinfunc" id="6330139">len</span><span class="op" id="6330142">(</span><span class="ident" id="6330143">e</span><span class="op" id="6330144">.</span><span class="ident" id="6330145">Path</span><span class="op" id="6330149">)</span><span class="op" id="6330150">-</span><span class="num" id="6330151">1</span><span class="op" id="6330152">]</span>&nbsp;<span class="op" id="6330154">==</span>&nbsp;<span class="string" id="6330157">&#39;/&#39;</span>&nbsp;<span class="op" id="6330161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330166">return</span>&nbsp;<span class="builtintype" id="6330173">true</span>&nbsp;<span class="comment" id="6330178">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330221">}</span>&nbsp;<span class="keyword" id="6330223">else</span>&nbsp;<span class="keyword" id="6330228">if</span>&nbsp;<span class="ident" id="6330231">requestPath</span><span class="op" id="6330242">[</span><span class="builtinfunc" id="6330243">len</span><span class="op" id="6330246">(</span><span class="ident" id="6330247">e</span><span class="op" id="6330248">.</span><span class="ident" id="6330249">Path</span><span class="op" id="6330253">)</span><span class="op" id="6330254">]</span>&nbsp;<span class="op" id="6330256">==</span>&nbsp;<span class="string" id="6330259">&#39;/&#39;</span>&nbsp;<span class="op" id="6330263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330268">return</span>&nbsp;<span class="builtintype" id="6330275">true</span>&nbsp;<span class="comment" id="6330280">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330328">return</span>&nbsp;<span class="builtintype" id="6330335">false</span><br>
<span class="lineno"></span><span class="op" id="6330341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6330344">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6330398">func</span>&nbsp;<span class="ident" id="6330403">hasDotSuffix</span><span class="op" id="6330415">(</span><span class="ident" id="6330416">s</span><span class="op" id="6330417">,</span>&nbsp;<span class="ident" id="6330419">suffix</span>&nbsp;<span class="builtintype" id="6330426">string</span><span class="op" id="6330432">)</span>&nbsp;<span class="builtintype" id="6330434">bool</span>&nbsp;<span class="op" id="6330439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330442">return</span>&nbsp;<span class="builtinfunc" id="6330449">len</span><span class="op" id="6330452">(</span><span class="ident" id="6330453">s</span><span class="op" id="6330454">)</span>&nbsp;<span class="op" id="6330456">&gt;</span>&nbsp;<span class="builtinfunc" id="6330458">len</span><span class="op" id="6330461">(</span><span class="ident" id="6330462">suffix</span><span class="op" id="6330468">)</span>&nbsp;<span class="op" id="6330470">&amp;&amp;</span>&nbsp;<span class="ident" id="6330473">s</span><span class="op" id="6330474">[</span><span class="builtinfunc" id="6330475">len</span><span class="op" id="6330478">(</span><span class="ident" id="6330479">s</span><span class="op" id="6330480">)</span><span class="op" id="6330481">-</span><span class="builtinfunc" id="6330482">len</span><span class="op" id="6330485">(</span><span class="ident" id="6330486">suffix</span><span class="op" id="6330492">)</span><span class="op" id="6330493">-</span><span class="num" id="6330494">1</span><span class="op" id="6330495">]</span>&nbsp;<span class="op" id="6330497">==</span>&nbsp;<span class="string" id="6330500">&#39;.&#39;</span>&nbsp;<span class="op" id="6330504">&amp;&amp;</span>&nbsp;<span class="ident" id="6330507">s</span><span class="op" id="6330508">[</span><span class="builtinfunc" id="6330509">len</span><span class="op" id="6330512">(</span><span class="ident" id="6330513">s</span><span class="op" id="6330514">)</span><span class="op" id="6330515">-</span><span class="builtinfunc" id="6330516">len</span><span class="op" id="6330519">(</span><span class="ident" id="6330520">suffix</span><span class="op" id="6330526">)</span><span class="op" id="6330527">:</span><span class="op" id="6330528">]</span>&nbsp;<span class="op" id="6330530">==</span>&nbsp;<span class="ident" id="6330533">suffix</span><br>
<span class="lineno"></span><span class="op" id="6330540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6330543">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="6330620">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6330696">type</span>&nbsp;<span class="ident" id="6330701">byPathLength</span>&nbsp;<span class="op" id="6330714">[</span><span class="op" id="6330715">]</span><span class="ident" id="6330716">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6330723">func</span>&nbsp;<span class="op" id="6330728">(</span><span class="ident" id="6330729">s</span>&nbsp;<span class="ident" id="6330731">byPathLength</span><span class="op" id="6330743">)</span>&nbsp;<span class="ident" id="6330745">Len</span><span class="op" id="6330748">(</span><span class="op" id="6330749">)</span>&nbsp;<span class="builtintype" id="6330751">int</span>&nbsp;<span class="op" id="6330755">{</span>&nbsp;<span class="keyword" id="6330757">return</span>&nbsp;<span class="builtinfunc" id="6330764">len</span><span class="op" id="6330767">(</span><span class="ident" id="6330768">s</span><span class="op" id="6330769">)</span>&nbsp;<span class="op" id="6330771">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6330774">func</span>&nbsp;<span class="op" id="6330779">(</span><span class="ident" id="6330780">s</span>&nbsp;<span class="ident" id="6330782">byPathLength</span><span class="op" id="6330794">)</span>&nbsp;<span class="ident" id="6330796">Less</span><span class="op" id="6330800">(</span><span class="ident" id="6330801">i</span><span class="op" id="6330802">,</span>&nbsp;<span class="ident" id="6330804">j</span>&nbsp;<span class="builtintype" id="6330806">int</span><span class="op" id="6330809">)</span>&nbsp;<span class="builtintype" id="6330811">bool</span>&nbsp;<span class="op" id="6330816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330819">if</span>&nbsp;<span class="builtinfunc" id="6330822">len</span><span class="op" id="6330825">(</span><span class="ident" id="6330826">s</span><span class="op" id="6330827">[</span><span class="ident" id="6330828">i</span><span class="op" id="6330829">]</span><span class="op" id="6330830">.</span><span class="ident" id="6330831">Path</span><span class="op" id="6330835">)</span>&nbsp;<span class="op" id="6330837">!=</span>&nbsp;<span class="builtinfunc" id="6330840">len</span><span class="op" id="6330843">(</span><span class="ident" id="6330844">s</span><span class="op" id="6330845">[</span><span class="ident" id="6330846">j</span><span class="op" id="6330847">]</span><span class="op" id="6330848">.</span><span class="ident" id="6330849">Path</span><span class="op" id="6330853">)</span>&nbsp;<span class="op" id="6330855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330859">return</span>&nbsp;<span class="builtinfunc" id="6330866">len</span><span class="op" id="6330869">(</span><span class="ident" id="6330870">s</span><span class="op" id="6330871">[</span><span class="ident" id="6330872">i</span><span class="op" id="6330873">]</span><span class="op" id="6330874">.</span><span class="ident" id="6330875">Path</span><span class="op" id="6330879">)</span>&nbsp;<span class="op" id="6330881">&gt;</span>&nbsp;<span class="builtinfunc" id="6330883">len</span><span class="op" id="6330886">(</span><span class="ident" id="6330887">s</span><span class="op" id="6330888">[</span><span class="ident" id="6330889">j</span><span class="op" id="6330890">]</span><span class="op" id="6330891">.</span><span class="ident" id="6330892">Path</span><span class="op" id="6330896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330899">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330902">if</span>&nbsp;<span class="op" id="6330905">!</span><span class="ident" id="6330906">s</span><span class="op" id="6330907">[</span><span class="ident" id="6330908">i</span><span class="op" id="6330909">]</span><span class="op" id="6330910">.</span><span class="ident" id="6330911">Creation</span><span class="op" id="6330919">.</span><span class="ident" id="6330920">Equal</span><span class="op" id="6330925">(</span><span class="ident" id="6330926">s</span><span class="op" id="6330927">[</span><span class="ident" id="6330928">j</span><span class="op" id="6330929">]</span><span class="op" id="6330930">.</span><span class="ident" id="6330931">Creation</span><span class="op" id="6330939">)</span>&nbsp;<span class="op" id="6330941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330945">return</span>&nbsp;<span class="ident" id="6330952">s</span><span class="op" id="6330953">[</span><span class="ident" id="6330954">i</span><span class="op" id="6330955">]</span><span class="op" id="6330956">.</span><span class="ident" id="6330957">Creation</span><span class="op" id="6330965">.</span><span class="ident" id="6330966">Before</span><span class="op" id="6330972">(</span><span class="ident" id="6330973">s</span><span class="op" id="6330974">[</span><span class="ident" id="6330975">j</span><span class="op" id="6330976">]</span><span class="op" id="6330977">.</span><span class="ident" id="6330978">Creation</span><span class="op" id="6330986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330992">return</span>&nbsp;<span class="ident" id="6330999">s</span><span class="op" id="6331000">[</span><span class="ident" id="6331001">i</span><span class="op" id="6331002">]</span><span class="op" id="6331003">.</span><span class="ident" id="6331004">seqNum</span>&nbsp;<span class="op" id="6331011">&lt;</span>&nbsp;<span class="ident" id="6331013">s</span><span class="op" id="6331014">[</span><span class="ident" id="6331015">j</span><span class="op" id="6331016">]</span><span class="op" id="6331017">.</span><span class="ident" id="6331018">seqNum</span><br>
<span class="lineno"></span><span class="op" id="6331025">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6331028">func</span>&nbsp;<span class="op" id="6331033">(</span><span class="ident" id="6331034">s</span>&nbsp;<span class="ident" id="6331036">byPathLength</span><span class="op" id="6331048">)</span>&nbsp;<span class="ident" id="6331050">Swap</span><span class="op" id="6331054">(</span><span class="ident" id="6331055">i</span><span class="op" id="6331056">,</span>&nbsp;<span class="ident" id="6331058">j</span>&nbsp;<span class="builtintype" id="6331060">int</span><span class="op" id="6331063">)</span>&nbsp;<span class="op" id="6331065">{</span>&nbsp;<span class="ident" id="6331067">s</span><span class="op" id="6331068">[</span><span class="ident" id="6331069">i</span><span class="op" id="6331070">]</span><span class="op" id="6331071">,</span>&nbsp;<span class="ident" id="6331073">s</span><span class="op" id="6331074">[</span><span class="ident" id="6331075">j</span><span class="op" id="6331076">]</span>&nbsp;<span class="op" id="6331078">=</span>&nbsp;<span class="ident" id="6331080">s</span><span class="op" id="6331081">[</span><span class="ident" id="6331082">j</span><span class="op" id="6331083">]</span><span class="op" id="6331084">,</span>&nbsp;<span class="ident" id="6331086">s</span><span class="op" id="6331087">[</span><span class="ident" id="6331088">i</span><span class="op" id="6331089">]</span>&nbsp;<span class="op" id="6331091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6331094">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6331168">//</span><br>
<span class="lineno">170</span><span class="comment" id="6331171">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="6331242">func</span>&nbsp;<span class="op" id="6331247">(</span><span class="ident" id="6331248">j</span>&nbsp;<span class="op" id="6331250">*</span><span class="ident" id="6331251">Jar</span><span class="op" id="6331254">)</span>&nbsp;<span class="ident" id="6331256">Cookies</span><span class="op" id="6331263">(</span><span class="ident" id="6331264">u</span>&nbsp;<span class="op" id="6331266">*</span><span class="ident" id="6331267">url</span><span class="op" id="6331270">.</span><span class="ident" id="6331271">URL</span><span class="op" id="6331274">)</span>&nbsp;<span class="op" id="6331276">(</span><span class="ident" id="6331277">cookies</span>&nbsp;<span class="op" id="6331285">[</span><span class="op" id="6331286">]</span><span class="op" id="6331287">*</span><span class="ident" id="6331288">http</span><span class="op" id="6331292">.</span><span class="ident" id="6331293">Cookie</span><span class="op" id="6331299">)</span>&nbsp;<span class="op" id="6331301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331304">return</span>&nbsp;<span class="ident" id="6331311">j</span><span class="op" id="6331312">.</span><span class="ident" id="6331313">cookies</span><span class="op" id="6331320">(</span><span class="ident" id="6331321">u</span><span class="op" id="6331322">,</span>&nbsp;<span class="ident" id="6331324">time</span><span class="op" id="6331328">.</span><span class="ident" id="6331329">Now</span><span class="op" id="6331332">(</span><span class="op" id="6331333">)</span><span class="op" id="6331334">)</span><br>
<span class="lineno"></span><span class="op" id="6331336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6331339">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6331409">func</span>&nbsp;<span class="op" id="6331414">(</span><span class="ident" id="6331415">j</span>&nbsp;<span class="op" id="6331417">*</span><span class="ident" id="6331418">Jar</span><span class="op" id="6331421">)</span>&nbsp;<span class="ident" id="6331423">cookies</span><span class="op" id="6331430">(</span><span class="ident" id="6331431">u</span>&nbsp;<span class="op" id="6331433">*</span><span class="ident" id="6331434">url</span><span class="op" id="6331437">.</span><span class="ident" id="6331438">URL</span><span class="op" id="6331441">,</span>&nbsp;<span class="ident" id="6331443">now</span>&nbsp;<span class="ident" id="6331447">time</span><span class="op" id="6331451">.</span><span class="ident" id="6331452">Time</span><span class="op" id="6331456">)</span>&nbsp;<span class="op" id="6331458">(</span><span class="ident" id="6331459">cookies</span>&nbsp;<span class="op" id="6331467">[</span><span class="op" id="6331468">]</span><span class="op" id="6331469">*</span><span class="ident" id="6331470">http</span><span class="op" id="6331474">.</span><span class="ident" id="6331475">Cookie</span><span class="op" id="6331481">)</span>&nbsp;<span class="op" id="6331483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331486">if</span>&nbsp;<span class="ident" id="6331489">u</span><span class="op" id="6331490">.</span><span class="ident" id="6331491">Scheme</span>&nbsp;<span class="op" id="6331498">!=</span>&nbsp;<span class="string" id="6331501">&#34;http&#34;</span>&nbsp;<span class="op" id="6331508">&amp;&amp;</span>&nbsp;<span class="ident" id="6331511">u</span><span class="op" id="6331512">.</span><span class="ident" id="6331513">Scheme</span>&nbsp;<span class="op" id="6331520">!=</span>&nbsp;<span class="string" id="6331523">&#34;https&#34;</span>&nbsp;<span class="op" id="6331531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331535">return</span>&nbsp;<span class="ident" id="6331542">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331551">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331554">host</span><span class="op" id="6331558">,</span>&nbsp;<span class="ident" id="6331560">err</span>&nbsp;<span class="op" id="6331564">:=</span>&nbsp;<span class="ident" id="6331567">canonicalHost</span><span class="op" id="6331580">(</span><span class="ident" id="6331581">u</span><span class="op" id="6331582">.</span><span class="ident" id="6331583">Host</span><span class="op" id="6331587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331590">if</span>&nbsp;<span class="ident" id="6331593">err</span>&nbsp;<span class="op" id="6331597">!=</span>&nbsp;<span class="ident" id="6331600">nil</span>&nbsp;<span class="op" id="6331604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331608">return</span>&nbsp;<span class="ident" id="6331615">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331627">key</span>&nbsp;<span class="op" id="6331631">:=</span>&nbsp;<span class="ident" id="6331634">jarKey</span><span class="op" id="6331640">(</span><span class="ident" id="6331641">host</span><span class="op" id="6331645">,</span>&nbsp;<span class="ident" id="6331647">j</span><span class="op" id="6331648">.</span><span class="ident" id="6331649">psList</span><span class="op" id="6331655">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331659">j</span><span class="op" id="6331660">.</span><span class="ident" id="6331661">mu</span><span class="op" id="6331663">.</span><span class="ident" id="6331664">Lock</span><span class="op" id="6331668">(</span><span class="op" id="6331669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331672">defer</span>&nbsp;<span class="ident" id="6331678">j</span><span class="op" id="6331679">.</span><span class="ident" id="6331680">mu</span><span class="op" id="6331682">.</span><span class="ident" id="6331683">Unlock</span><span class="op" id="6331689">(</span><span class="op" id="6331690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331694">submap</span>&nbsp;<span class="op" id="6331701">:=</span>&nbsp;<span class="ident" id="6331704">j</span><span class="op" id="6331705">.</span><span class="ident" id="6331706">entries</span><span class="op" id="6331713">[</span><span class="ident" id="6331714">key</span><span class="op" id="6331717">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331720">if</span>&nbsp;<span class="ident" id="6331723">submap</span>&nbsp;<span class="op" id="6331730">==</span>&nbsp;<span class="ident" id="6331733">nil</span>&nbsp;<span class="op" id="6331737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331741">return</span>&nbsp;<span class="ident" id="6331748">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331761">https</span>&nbsp;<span class="op" id="6331767">:=</span>&nbsp;<span class="ident" id="6331770">u</span><span class="op" id="6331771">.</span><span class="ident" id="6331772">Scheme</span>&nbsp;<span class="op" id="6331779">==</span>&nbsp;<span class="string" id="6331782">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331791">path</span>&nbsp;<span class="op" id="6331796">:=</span>&nbsp;<span class="ident" id="6331799">u</span><span class="op" id="6331800">.</span><span class="ident" id="6331801">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331807">if</span>&nbsp;<span class="ident" id="6331810">path</span>&nbsp;<span class="op" id="6331815">==</span>&nbsp;<span class="string" id="6331818">&#34;&#34;</span>&nbsp;<span class="op" id="6331821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331825">path</span>&nbsp;<span class="op" id="6331830">=</span>&nbsp;<span class="string" id="6331832">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331841">modified</span>&nbsp;<span class="op" id="6331850">:=</span>&nbsp;<span class="builtintype" id="6331853">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331860">var</span>&nbsp;<span class="ident" id="6331864">selected</span>&nbsp;<span class="op" id="6331873">[</span><span class="op" id="6331874">]</span><span class="ident" id="6331875">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331882">for</span>&nbsp;<span class="ident" id="6331886">id</span><span class="op" id="6331888">,</span>&nbsp;<span class="ident" id="6331890">e</span>&nbsp;<span class="op" id="6331892">:=</span>&nbsp;<span class="keyword" id="6331895">range</span>&nbsp;<span class="ident" id="6331901">submap</span>&nbsp;<span class="op" id="6331908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331912">if</span>&nbsp;<span class="ident" id="6331915">e</span><span class="op" id="6331916">.</span><span class="ident" id="6331917">Persistent</span>&nbsp;<span class="op" id="6331928">&amp;&amp;</span>&nbsp;<span class="op" id="6331931">!</span><span class="ident" id="6331932">e</span><span class="op" id="6331933">.</span><span class="ident" id="6331934">Expires</span><span class="op" id="6331941">.</span><span class="ident" id="6331942">After</span><span class="op" id="6331947">(</span><span class="ident" id="6331948">now</span><span class="op" id="6331951">)</span>&nbsp;<span class="op" id="6331953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6331958">delete</span><span class="op" id="6331964">(</span><span class="ident" id="6331965">submap</span><span class="op" id="6331971">,</span>&nbsp;<span class="ident" id="6331973">id</span><span class="op" id="6331975">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331980">modified</span>&nbsp;<span class="op" id="6331989">=</span>&nbsp;<span class="builtintype" id="6331991">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331999">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332014">if</span>&nbsp;<span class="op" id="6332017">!</span><span class="ident" id="6332018">e</span><span class="op" id="6332019">.</span><span class="ident" id="6332020">shouldSend</span><span class="op" id="6332030">(</span><span class="ident" id="6332031">https</span><span class="op" id="6332036">,</span>&nbsp;<span class="ident" id="6332038">host</span><span class="op" id="6332042">,</span>&nbsp;<span class="ident" id="6332044">path</span><span class="op" id="6332048">)</span>&nbsp;<span class="op" id="6332050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332055">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332070">e</span><span class="op" id="6332071">.</span><span class="ident" id="6332072">LastAccess</span>&nbsp;<span class="op" id="6332083">=</span>&nbsp;<span class="ident" id="6332085">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332091">submap</span><span class="op" id="6332097">[</span><span class="ident" id="6332098">id</span><span class="op" id="6332100">]</span>&nbsp;<span class="op" id="6332102">=</span>&nbsp;<span class="ident" id="6332104">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332108">selected</span>&nbsp;<span class="op" id="6332117">=</span>&nbsp;<span class="builtinfunc" id="6332119">append</span><span class="op" id="6332125">(</span><span class="ident" id="6332126">selected</span><span class="op" id="6332134">,</span>&nbsp;<span class="ident" id="6332136">e</span><span class="op" id="6332137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332141">modified</span>&nbsp;<span class="op" id="6332150">=</span>&nbsp;<span class="builtintype" id="6332152">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332161">if</span>&nbsp;<span class="ident" id="6332164">modified</span>&nbsp;<span class="op" id="6332173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332177">if</span>&nbsp;<span class="builtinfunc" id="6332180">len</span><span class="op" id="6332183">(</span><span class="ident" id="6332184">submap</span><span class="op" id="6332190">)</span>&nbsp;<span class="op" id="6332192">==</span>&nbsp;<span class="num" id="6332195">0</span>&nbsp;<span class="op" id="6332197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6332202">delete</span><span class="op" id="6332208">(</span><span class="ident" id="6332209">j</span><span class="op" id="6332210">.</span><span class="ident" id="6332211">entries</span><span class="op" id="6332218">,</span>&nbsp;<span class="ident" id="6332220">key</span><span class="op" id="6332223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332227">}</span>&nbsp;<span class="keyword" id="6332229">else</span>&nbsp;<span class="op" id="6332234">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332239">j</span><span class="op" id="6332240">.</span><span class="ident" id="6332241">entries</span><span class="op" id="6332248">[</span><span class="ident" id="6332249">key</span><span class="op" id="6332252">]</span>&nbsp;<span class="op" id="6332254">=</span>&nbsp;<span class="ident" id="6332256">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332272">sort</span><span class="op" id="6332276">.</span><span class="ident" id="6332277">Sort</span><span class="op" id="6332281">(</span><span class="ident" id="6332282">byPathLength</span><span class="op" id="6332294">(</span><span class="ident" id="6332295">selected</span><span class="op" id="6332303">)</span><span class="op" id="6332304">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332307">for</span>&nbsp;<span class="ident" id="6332311">_</span><span class="op" id="6332312">,</span>&nbsp;<span class="ident" id="6332314">e</span>&nbsp;<span class="op" id="6332316">:=</span>&nbsp;<span class="keyword" id="6332319">range</span>&nbsp;<span class="ident" id="6332325">selected</span>&nbsp;<span class="op" id="6332334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332338">cookies</span>&nbsp;<span class="op" id="6332346">=</span>&nbsp;<span class="builtinfunc" id="6332348">append</span><span class="op" id="6332354">(</span><span class="ident" id="6332355">cookies</span><span class="op" id="6332362">,</span>&nbsp;<span class="op" id="6332364">&amp;</span><span class="ident" id="6332365">http</span><span class="op" id="6332369">.</span><span class="ident" id="6332370">Cookie</span><span class="op" id="6332376">{</span><span class="ident" id="6332377">Name</span><span class="op" id="6332381">:</span>&nbsp;<span class="ident" id="6332383">e</span><span class="op" id="6332384">.</span><span class="ident" id="6332385">Name</span><span class="op" id="6332389">,</span>&nbsp;<span class="ident" id="6332391">Value</span><span class="op" id="6332396">:</span>&nbsp;<span class="ident" id="6332398">e</span><span class="op" id="6332399">.</span><span class="ident" id="6332400">Value</span><span class="op" id="6332405">}</span><span class="op" id="6332406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332413">return</span>&nbsp;<span class="ident" id="6332420">cookies</span><br>
<span class="lineno">230</span><span class="op" id="6332428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6332431">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6332511">//</span><br>
<span class="lineno"></span><span class="comment" id="6332514">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="6332575">func</span>&nbsp;<span class="op" id="6332580">(</span><span class="ident" id="6332581">j</span>&nbsp;<span class="op" id="6332583">*</span><span class="ident" id="6332584">Jar</span><span class="op" id="6332587">)</span>&nbsp;<span class="ident" id="6332589">SetCookies</span><span class="op" id="6332599">(</span><span class="ident" id="6332600">u</span>&nbsp;<span class="op" id="6332602">*</span><span class="ident" id="6332603">url</span><span class="op" id="6332606">.</span><span class="ident" id="6332607">URL</span><span class="op" id="6332610">,</span>&nbsp;<span class="ident" id="6332612">cookies</span>&nbsp;<span class="op" id="6332620">[</span><span class="op" id="6332621">]</span><span class="op" id="6332622">*</span><span class="ident" id="6332623">http</span><span class="op" id="6332627">.</span><span class="ident" id="6332628">Cookie</span><span class="op" id="6332634">)</span>&nbsp;<span class="op" id="6332636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332639">j</span><span class="op" id="6332640">.</span><span class="ident" id="6332641">setCookies</span><span class="op" id="6332651">(</span><span class="ident" id="6332652">u</span><span class="op" id="6332653">,</span>&nbsp;<span class="ident" id="6332655">cookies</span><span class="op" id="6332662">,</span>&nbsp;<span class="ident" id="6332664">time</span><span class="op" id="6332668">.</span><span class="ident" id="6332669">Now</span><span class="op" id="6332672">(</span><span class="op" id="6332673">)</span><span class="op" id="6332674">)</span><br>
<span class="lineno"></span><span class="op" id="6332676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6332679">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="6332753">func</span>&nbsp;<span class="op" id="6332758">(</span><span class="ident" id="6332759">j</span>&nbsp;<span class="op" id="6332761">*</span><span class="ident" id="6332762">Jar</span><span class="op" id="6332765">)</span>&nbsp;<span class="ident" id="6332767">setCookies</span><span class="op" id="6332777">(</span><span class="ident" id="6332778">u</span>&nbsp;<span class="op" id="6332780">*</span><span class="ident" id="6332781">url</span><span class="op" id="6332784">.</span><span class="ident" id="6332785">URL</span><span class="op" id="6332788">,</span>&nbsp;<span class="ident" id="6332790">cookies</span>&nbsp;<span class="op" id="6332798">[</span><span class="op" id="6332799">]</span><span class="op" id="6332800">*</span><span class="ident" id="6332801">http</span><span class="op" id="6332805">.</span><span class="ident" id="6332806">Cookie</span><span class="op" id="6332812">,</span>&nbsp;<span class="ident" id="6332814">now</span>&nbsp;<span class="ident" id="6332818">time</span><span class="op" id="6332822">.</span><span class="ident" id="6332823">Time</span><span class="op" id="6332827">)</span>&nbsp;<span class="op" id="6332829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332832">if</span>&nbsp;<span class="builtinfunc" id="6332835">len</span><span class="op" id="6332838">(</span><span class="ident" id="6332839">cookies</span><span class="op" id="6332846">)</span>&nbsp;<span class="op" id="6332848">==</span>&nbsp;<span class="num" id="6332851">0</span>&nbsp;<span class="op" id="6332853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332868">if</span>&nbsp;<span class="ident" id="6332871">u</span><span class="op" id="6332872">.</span><span class="ident" id="6332873">Scheme</span>&nbsp;<span class="op" id="6332880">!=</span>&nbsp;<span class="string" id="6332883">&#34;http&#34;</span>&nbsp;<span class="op" id="6332890">&amp;&amp;</span>&nbsp;<span class="ident" id="6332893">u</span><span class="op" id="6332894">.</span><span class="ident" id="6332895">Scheme</span>&nbsp;<span class="op" id="6332902">!=</span>&nbsp;<span class="string" id="6332905">&#34;https&#34;</span>&nbsp;<span class="op" id="6332913">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332928">host</span><span class="op" id="6332932">,</span>&nbsp;<span class="ident" id="6332934">err</span>&nbsp;<span class="op" id="6332938">:=</span>&nbsp;<span class="ident" id="6332941">canonicalHost</span><span class="op" id="6332954">(</span><span class="ident" id="6332955">u</span><span class="op" id="6332956">.</span><span class="ident" id="6332957">Host</span><span class="op" id="6332961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332964">if</span>&nbsp;<span class="ident" id="6332967">err</span>&nbsp;<span class="op" id="6332971">!=</span>&nbsp;<span class="ident" id="6332974">nil</span>&nbsp;<span class="op" id="6332978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332982">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332993">key</span>&nbsp;<span class="op" id="6332997">:=</span>&nbsp;<span class="ident" id="6333000">jarKey</span><span class="op" id="6333006">(</span><span class="ident" id="6333007">host</span><span class="op" id="6333011">,</span>&nbsp;<span class="ident" id="6333013">j</span><span class="op" id="6333014">.</span><span class="ident" id="6333015">psList</span><span class="op" id="6333021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333024">defPath</span>&nbsp;<span class="op" id="6333032">:=</span>&nbsp;<span class="ident" id="6333035">defaultPath</span><span class="op" id="6333046">(</span><span class="ident" id="6333047">u</span><span class="op" id="6333048">.</span><span class="ident" id="6333049">Path</span><span class="op" id="6333053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333057">j</span><span class="op" id="6333058">.</span><span class="ident" id="6333059">mu</span><span class="op" id="6333061">.</span><span class="ident" id="6333062">Lock</span><span class="op" id="6333066">(</span><span class="op" id="6333067">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333070">defer</span>&nbsp;<span class="ident" id="6333076">j</span><span class="op" id="6333077">.</span><span class="ident" id="6333078">mu</span><span class="op" id="6333080">.</span><span class="ident" id="6333081">Unlock</span><span class="op" id="6333087">(</span><span class="op" id="6333088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333092">submap</span>&nbsp;<span class="op" id="6333099">:=</span>&nbsp;<span class="ident" id="6333102">j</span><span class="op" id="6333103">.</span><span class="ident" id="6333104">entries</span><span class="op" id="6333111">[</span><span class="ident" id="6333112">key</span><span class="op" id="6333115">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333119">modified</span>&nbsp;<span class="op" id="6333128">:=</span>&nbsp;<span class="builtintype" id="6333131">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333138">for</span>&nbsp;<span class="ident" id="6333142">_</span><span class="op" id="6333143">,</span>&nbsp;<span class="ident" id="6333145">cookie</span>&nbsp;<span class="op" id="6333152">:=</span>&nbsp;<span class="keyword" id="6333155">range</span>&nbsp;<span class="ident" id="6333161">cookies</span>&nbsp;<span class="op" id="6333169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333173">e</span><span class="op" id="6333174">,</span>&nbsp;<span class="ident" id="6333176">remove</span><span class="op" id="6333182">,</span>&nbsp;<span class="ident" id="6333184">err</span>&nbsp;<span class="op" id="6333188">:=</span>&nbsp;<span class="ident" id="6333191">j</span><span class="op" id="6333192">.</span><span class="ident" id="6333193">newEntry</span><span class="op" id="6333201">(</span><span class="ident" id="6333202">cookie</span><span class="op" id="6333208">,</span>&nbsp;<span class="ident" id="6333210">now</span><span class="op" id="6333213">,</span>&nbsp;<span class="ident" id="6333215">defPath</span><span class="op" id="6333222">,</span>&nbsp;<span class="ident" id="6333224">host</span><span class="op" id="6333228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333232">if</span>&nbsp;<span class="ident" id="6333235">err</span>&nbsp;<span class="op" id="6333239">!=</span>&nbsp;<span class="ident" id="6333242">nil</span>&nbsp;<span class="op" id="6333246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333251">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333262">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333266">id</span>&nbsp;<span class="op" id="6333269">:=</span>&nbsp;<span class="ident" id="6333272">e</span><span class="op" id="6333273">.</span><span class="ident" id="6333274">id</span><span class="op" id="6333276">(</span><span class="op" id="6333277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333281">if</span>&nbsp;<span class="ident" id="6333284">remove</span>&nbsp;<span class="op" id="6333291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333296">if</span>&nbsp;<span class="ident" id="6333299">submap</span>&nbsp;<span class="op" id="6333306">!=</span>&nbsp;<span class="ident" id="6333309">nil</span>&nbsp;<span class="op" id="6333313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333319">if</span>&nbsp;<span class="ident" id="6333322">_</span><span class="op" id="6333323">,</span>&nbsp;<span class="ident" id="6333325">ok</span>&nbsp;<span class="op" id="6333328">:=</span>&nbsp;<span class="ident" id="6333331">submap</span><span class="op" id="6333337">[</span><span class="ident" id="6333338">id</span><span class="op" id="6333340">]</span><span class="op" id="6333341">;</span>&nbsp;<span class="ident" id="6333343">ok</span>&nbsp;<span class="op" id="6333346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6333353">delete</span><span class="op" id="6333359">(</span><span class="ident" id="6333360">submap</span><span class="op" id="6333366">,</span>&nbsp;<span class="ident" id="6333368">id</span><span class="op" id="6333370">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333377">modified</span>&nbsp;<span class="op" id="6333386">=</span>&nbsp;<span class="builtintype" id="6333388">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333407">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333418">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333422">if</span>&nbsp;<span class="ident" id="6333425">submap</span>&nbsp;<span class="op" id="6333432">==</span>&nbsp;<span class="ident" id="6333435">nil</span>&nbsp;<span class="op" id="6333439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333444">submap</span>&nbsp;<span class="op" id="6333451">=</span>&nbsp;<span class="builtinfunc" id="6333453">make</span><span class="op" id="6333457">(</span><span class="keyword" id="6333458">map</span><span class="op" id="6333461">[</span><span class="builtintype" id="6333462">string</span><span class="op" id="6333468">]</span><span class="ident" id="6333469">entry</span><span class="op" id="6333474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333483">if</span>&nbsp;<span class="ident" id="6333486">old</span><span class="op" id="6333489">,</span>&nbsp;<span class="ident" id="6333491">ok</span>&nbsp;<span class="op" id="6333494">:=</span>&nbsp;<span class="ident" id="6333497">submap</span><span class="op" id="6333503">[</span><span class="ident" id="6333504">id</span><span class="op" id="6333506">]</span><span class="op" id="6333507">;</span>&nbsp;<span class="ident" id="6333509">ok</span>&nbsp;<span class="op" id="6333512">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333517">e</span><span class="op" id="6333518">.</span><span class="ident" id="6333519">Creation</span>&nbsp;<span class="op" id="6333528">=</span>&nbsp;<span class="ident" id="6333530">old</span><span class="op" id="6333533">.</span><span class="ident" id="6333534">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333546">e</span><span class="op" id="6333547">.</span><span class="ident" id="6333548">seqNum</span>&nbsp;<span class="op" id="6333555">=</span>&nbsp;<span class="ident" id="6333557">old</span><span class="op" id="6333560">.</span><span class="ident" id="6333561">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333570">}</span>&nbsp;<span class="keyword" id="6333572">else</span>&nbsp;<span class="op" id="6333577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333582">e</span><span class="op" id="6333583">.</span><span class="ident" id="6333584">Creation</span>&nbsp;<span class="op" id="6333593">=</span>&nbsp;<span class="ident" id="6333595">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333602">e</span><span class="op" id="6333603">.</span><span class="ident" id="6333604">seqNum</span>&nbsp;<span class="op" id="6333611">=</span>&nbsp;<span class="ident" id="6333613">j</span><span class="op" id="6333614">.</span><span class="ident" id="6333615">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333629">j</span><span class="op" id="6333630">.</span><span class="ident" id="6333631">nextSeqNum</span><span class="op" id="6333641">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333650">e</span><span class="op" id="6333651">.</span><span class="ident" id="6333652">LastAccess</span>&nbsp;<span class="op" id="6333663">=</span>&nbsp;<span class="ident" id="6333665">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333671">submap</span><span class="op" id="6333677">[</span><span class="ident" id="6333678">id</span><span class="op" id="6333680">]</span>&nbsp;<span class="op" id="6333682">=</span>&nbsp;<span class="ident" id="6333684">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333688">modified</span>&nbsp;<span class="op" id="6333697">=</span>&nbsp;<span class="builtintype" id="6333699">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333709">if</span>&nbsp;<span class="ident" id="6333712">modified</span>&nbsp;<span class="op" id="6333721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333725">if</span>&nbsp;<span class="builtinfunc" id="6333728">len</span><span class="op" id="6333731">(</span><span class="ident" id="6333732">submap</span><span class="op" id="6333738">)</span>&nbsp;<span class="op" id="6333740">==</span>&nbsp;<span class="num" id="6333743">0</span>&nbsp;<span class="op" id="6333745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6333750">delete</span><span class="op" id="6333756">(</span><span class="ident" id="6333757">j</span><span class="op" id="6333758">.</span><span class="ident" id="6333759">entries</span><span class="op" id="6333766">,</span>&nbsp;<span class="ident" id="6333768">key</span><span class="op" id="6333771">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333775">}</span>&nbsp;<span class="keyword" id="6333777">else</span>&nbsp;<span class="op" id="6333782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333787">j</span><span class="op" id="6333788">.</span><span class="ident" id="6333789">entries</span><span class="op" id="6333796">[</span><span class="ident" id="6333797">key</span><span class="op" id="6333800">]</span>&nbsp;<span class="op" id="6333802">=</span>&nbsp;<span class="ident" id="6333804">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333816">}</span><br>
<span class="lineno"></span><span class="op" id="6333818">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="6333821">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="6333901">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6333915">func</span>&nbsp;<span class="ident" id="6333920">canonicalHost</span><span class="op" id="6333933">(</span><span class="ident" id="6333934">host</span>&nbsp;<span class="builtintype" id="6333939">string</span><span class="op" id="6333945">)</span>&nbsp;<span class="op" id="6333947">(</span><span class="builtintype" id="6333948">string</span><span class="op" id="6333954">,</span>&nbsp;<span class="builtintype" id="6333956">error</span><span class="op" id="6333961">)</span>&nbsp;<span class="op" id="6333963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333966">var</span>&nbsp;<span class="ident" id="6333970">err</span>&nbsp;<span class="builtintype" id="6333974">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333981">host</span>&nbsp;<span class="op" id="6333986">=</span>&nbsp;<span class="ident" id="6333988">strings</span><span class="op" id="6333995">.</span><span class="ident" id="6333996">ToLower</span><span class="op" id="6334003">(</span><span class="ident" id="6334004">host</span><span class="op" id="6334008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334011">if</span>&nbsp;<span class="ident" id="6334014">hasPort</span><span class="op" id="6334021">(</span><span class="ident" id="6334022">host</span><span class="op" id="6334026">)</span>&nbsp;<span class="op" id="6334028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334032">host</span><span class="op" id="6334036">,</span>&nbsp;<span class="ident" id="6334038">_</span><span class="op" id="6334039">,</span>&nbsp;<span class="ident" id="6334041">err</span>&nbsp;<span class="op" id="6334045">=</span>&nbsp;<span class="ident" id="6334047">net</span><span class="op" id="6334050">.</span><span class="ident" id="6334051">SplitHostPort</span><span class="op" id="6334064">(</span><span class="ident" id="6334065">host</span><span class="op" id="6334069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334073">if</span>&nbsp;<span class="ident" id="6334076">err</span>&nbsp;<span class="op" id="6334080">!=</span>&nbsp;<span class="ident" id="6334083">nil</span>&nbsp;<span class="op" id="6334087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334092">return</span>&nbsp;<span class="string" id="6334099">&#34;&#34;</span><span class="op" id="6334101">,</span>&nbsp;<span class="ident" id="6334103">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334115">if</span>&nbsp;<span class="ident" id="6334118">strings</span><span class="op" id="6334125">.</span><span class="ident" id="6334126">HasSuffix</span><span class="op" id="6334135">(</span><span class="ident" id="6334136">host</span><span class="op" id="6334140">,</span>&nbsp;<span class="string" id="6334142">&#34;.&#34;</span><span class="op" id="6334145">)</span>&nbsp;<span class="op" id="6334147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334151">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334210">host</span>&nbsp;<span class="op" id="6334215">=</span>&nbsp;<span class="ident" id="6334217">host</span><span class="op" id="6334221">[</span><span class="op" id="6334222">:</span><span class="builtinfunc" id="6334223">len</span><span class="op" id="6334226">(</span><span class="ident" id="6334227">host</span><span class="op" id="6334231">)</span><span class="op" id="6334232">-</span><span class="num" id="6334233">1</span><span class="op" id="6334234">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334240">return</span>&nbsp;<span class="ident" id="6334247">toASCII</span><span class="op" id="6334254">(</span><span class="ident" id="6334255">host</span><span class="op" id="6334259">)</span><br>
<span class="lineno"></span><span class="op" id="6334261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334264">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="6334339">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6334376">func</span>&nbsp;<span class="ident" id="6334381">hasPort</span><span class="op" id="6334388">(</span><span class="ident" id="6334389">host</span>&nbsp;<span class="builtintype" id="6334394">string</span><span class="op" id="6334400">)</span>&nbsp;<span class="builtintype" id="6334402">bool</span>&nbsp;<span class="op" id="6334407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334410">colons</span>&nbsp;<span class="op" id="6334417">:=</span>&nbsp;<span class="ident" id="6334420">strings</span><span class="op" id="6334427">.</span><span class="ident" id="6334428">Count</span><span class="op" id="6334433">(</span><span class="ident" id="6334434">host</span><span class="op" id="6334438">,</span>&nbsp;<span class="string" id="6334440">&#34;:&#34;</span><span class="op" id="6334443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334446">if</span>&nbsp;<span class="ident" id="6334449">colons</span>&nbsp;<span class="op" id="6334456">==</span>&nbsp;<span class="num" id="6334459">0</span>&nbsp;<span class="op" id="6334461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334465">return</span>&nbsp;<span class="builtintype" id="6334472">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334482">if</span>&nbsp;<span class="ident" id="6334485">colons</span>&nbsp;<span class="op" id="6334492">==</span>&nbsp;<span class="num" id="6334495">1</span>&nbsp;<span class="op" id="6334497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334501">return</span>&nbsp;<span class="builtintype" id="6334508">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334517">return</span>&nbsp;<span class="ident" id="6334524">host</span><span class="op" id="6334528">[</span><span class="num" id="6334529">0</span><span class="op" id="6334530">]</span>&nbsp;<span class="op" id="6334532">==</span>&nbsp;<span class="string" id="6334535">&#39;[&#39;</span>&nbsp;<span class="op" id="6334539">&amp;&amp;</span>&nbsp;<span class="ident" id="6334542">strings</span><span class="op" id="6334549">.</span><span class="ident" id="6334550">Contains</span><span class="op" id="6334558">(</span><span class="ident" id="6334559">host</span><span class="op" id="6334563">,</span>&nbsp;<span class="string" id="6334565">&#34;]:&#34;</span><span class="op" id="6334569">)</span><br>
<span class="lineno">330</span><span class="op" id="6334571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334574">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6334618">func</span>&nbsp;<span class="ident" id="6334623">jarKey</span><span class="op" id="6334629">(</span><span class="ident" id="6334630">host</span>&nbsp;<span class="builtintype" id="6334635">string</span><span class="op" id="6334641">,</span>&nbsp;<span class="ident" id="6334643">psl</span>&nbsp;<span class="ident" id="6334647">PublicSuffixList</span><span class="op" id="6334663">)</span>&nbsp;<span class="builtintype" id="6334665">string</span>&nbsp;<span class="op" id="6334672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334675">if</span>&nbsp;<span class="ident" id="6334678">isIP</span><span class="op" id="6334682">(</span><span class="ident" id="6334683">host</span><span class="op" id="6334687">)</span>&nbsp;<span class="op" id="6334689">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334693">return</span>&nbsp;<span class="ident" id="6334700">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334710">var</span>&nbsp;<span class="ident" id="6334714">i</span>&nbsp;<span class="builtintype" id="6334716">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334721">if</span>&nbsp;<span class="ident" id="6334724">psl</span>&nbsp;<span class="op" id="6334728">==</span>&nbsp;<span class="ident" id="6334731">nil</span>&nbsp;<span class="op" id="6334735">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334739">i</span>&nbsp;<span class="op" id="6334741">=</span>&nbsp;<span class="ident" id="6334743">strings</span><span class="op" id="6334750">.</span><span class="ident" id="6334751">LastIndex</span><span class="op" id="6334760">(</span><span class="ident" id="6334761">host</span><span class="op" id="6334765">,</span>&nbsp;<span class="string" id="6334767">&#34;.&#34;</span><span class="op" id="6334770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334774">if</span>&nbsp;<span class="ident" id="6334777">i</span>&nbsp;<span class="op" id="6334779">==</span>&nbsp;<span class="op" id="6334782">-</span><span class="num" id="6334783">1</span>&nbsp;<span class="op" id="6334785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334790">return</span>&nbsp;<span class="ident" id="6334797">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334807">}</span>&nbsp;<span class="keyword" id="6334809">else</span>&nbsp;<span class="op" id="6334814">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334818">suffix</span>&nbsp;<span class="op" id="6334825">:=</span>&nbsp;<span class="ident" id="6334828">psl</span><span class="op" id="6334831">.</span><span class="ident" id="6334832">PublicSuffix</span><span class="op" id="6334844">(</span><span class="ident" id="6334845">host</span><span class="op" id="6334849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334853">if</span>&nbsp;<span class="ident" id="6334856">suffix</span>&nbsp;<span class="op" id="6334863">==</span>&nbsp;<span class="ident" id="6334866">host</span>&nbsp;<span class="op" id="6334871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334876">return</span>&nbsp;<span class="ident" id="6334883">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334894">i</span>&nbsp;<span class="op" id="6334896">=</span>&nbsp;<span class="builtinfunc" id="6334898">len</span><span class="op" id="6334901">(</span><span class="ident" id="6334902">host</span><span class="op" id="6334906">)</span>&nbsp;<span class="op" id="6334908">-</span>&nbsp;<span class="builtinfunc" id="6334910">len</span><span class="op" id="6334913">(</span><span class="ident" id="6334914">suffix</span><span class="op" id="6334920">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334924">if</span>&nbsp;<span class="ident" id="6334927">i</span>&nbsp;<span class="op" id="6334929">&lt;=</span>&nbsp;<span class="num" id="6334932">0</span>&nbsp;<span class="op" id="6334934">||</span>&nbsp;<span class="ident" id="6334937">host</span><span class="op" id="6334941">[</span><span class="ident" id="6334942">i</span><span class="op" id="6334943">-</span><span class="num" id="6334944">1</span><span class="op" id="6334945">]</span>&nbsp;<span class="op" id="6334947">!=</span>&nbsp;<span class="string" id="6334950">&#39;.&#39;</span>&nbsp;<span class="op" id="6334954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334959">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6335012">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335064">return</span>&nbsp;<span class="ident" id="6335071">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335078">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335084">prevDot</span>&nbsp;<span class="op" id="6335092">:=</span>&nbsp;<span class="ident" id="6335095">strings</span><span class="op" id="6335102">.</span><span class="ident" id="6335103">LastIndex</span><span class="op" id="6335112">(</span><span class="ident" id="6335113">host</span><span class="op" id="6335117">[</span><span class="op" id="6335118">:</span><span class="ident" id="6335119">i</span><span class="op" id="6335120">-</span><span class="num" id="6335121">1</span><span class="op" id="6335122">]</span><span class="op" id="6335123">,</span>&nbsp;<span class="string" id="6335125">&#34;.&#34;</span><span class="op" id="6335128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335131">return</span>&nbsp;<span class="ident" id="6335138">host</span><span class="op" id="6335142">[</span><span class="ident" id="6335143">prevDot</span><span class="op" id="6335150">+</span><span class="num" id="6335151">1</span><span class="op" id="6335152">:</span><span class="op" id="6335153">]</span><br>
<span class="lineno"></span><span class="op" id="6335155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6335158">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6335205">func</span>&nbsp;<span class="ident" id="6335210">isIP</span><span class="op" id="6335214">(</span><span class="ident" id="6335215">host</span>&nbsp;<span class="builtintype" id="6335220">string</span><span class="op" id="6335226">)</span>&nbsp;<span class="builtintype" id="6335228">bool</span>&nbsp;<span class="op" id="6335233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335236">return</span>&nbsp;<span class="ident" id="6335243">net</span><span class="op" id="6335246">.</span><span class="ident" id="6335247">ParseIP</span><span class="op" id="6335254">(</span><span class="ident" id="6335255">host</span><span class="op" id="6335259">)</span>&nbsp;<span class="op" id="6335261">!=</span>&nbsp;<span class="ident" id="6335264">nil</span><br>
<span class="lineno"></span><span class="op" id="6335268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="6335271">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6335343">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6335370">func</span>&nbsp;<span class="ident" id="6335375">defaultPath</span><span class="op" id="6335386">(</span><span class="ident" id="6335387">path</span>&nbsp;<span class="builtintype" id="6335392">string</span><span class="op" id="6335398">)</span>&nbsp;<span class="builtintype" id="6335400">string</span>&nbsp;<span class="op" id="6335407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335410">if</span>&nbsp;<span class="builtinfunc" id="6335413">len</span><span class="op" id="6335416">(</span><span class="ident" id="6335417">path</span><span class="op" id="6335421">)</span>&nbsp;<span class="op" id="6335423">==</span>&nbsp;<span class="num" id="6335426">0</span>&nbsp;<span class="op" id="6335428">||</span>&nbsp;<span class="ident" id="6335431">path</span><span class="op" id="6335435">[</span><span class="num" id="6335436">0</span><span class="op" id="6335437">]</span>&nbsp;<span class="op" id="6335439">!=</span>&nbsp;<span class="string" id="6335442">&#39;/&#39;</span>&nbsp;<span class="op" id="6335446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335450">return</span>&nbsp;<span class="string" id="6335457">&#34;/&#34;</span>&nbsp;<span class="comment" id="6335461">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335497">i</span>&nbsp;<span class="op" id="6335499">:=</span>&nbsp;<span class="ident" id="6335502">strings</span><span class="op" id="6335509">.</span><span class="ident" id="6335510">LastIndex</span><span class="op" id="6335519">(</span><span class="ident" id="6335520">path</span><span class="op" id="6335524">,</span>&nbsp;<span class="string" id="6335526">&#34;/&#34;</span><span class="op" id="6335529">)</span>&nbsp;<span class="comment" id="6335531">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335569">if</span>&nbsp;<span class="ident" id="6335572">i</span>&nbsp;<span class="op" id="6335574">==</span>&nbsp;<span class="num" id="6335577">0</span>&nbsp;<span class="op" id="6335579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335583">return</span>&nbsp;<span class="string" id="6335590">&#34;/&#34;</span>&nbsp;<span class="comment" id="6335594">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335627">return</span>&nbsp;<span class="ident" id="6335634">path</span><span class="op" id="6335638">[</span><span class="op" id="6335639">:</span><span class="ident" id="6335640">i</span><span class="op" id="6335641">]</span>&nbsp;<span class="comment" id="6335643">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="6335696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6335699">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="6335778">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6335859">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="6335935">//</span><br>
<span class="lineno"></span><span class="comment" id="6335938">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="6336017">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="6336096">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="6336167">//</span><br>
<span class="lineno"></span><span class="comment" id="6336170">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6336219">func</span>&nbsp;<span class="op" id="6336224">(</span><span class="ident" id="6336225">j</span>&nbsp;<span class="op" id="6336227">*</span><span class="ident" id="6336228">Jar</span><span class="op" id="6336231">)</span>&nbsp;<span class="ident" id="6336233">newEntry</span><span class="op" id="6336241">(</span><span class="ident" id="6336242">c</span>&nbsp;<span class="op" id="6336244">*</span><span class="ident" id="6336245">http</span><span class="op" id="6336249">.</span><span class="ident" id="6336250">Cookie</span><span class="op" id="6336256">,</span>&nbsp;<span class="ident" id="6336258">now</span>&nbsp;<span class="ident" id="6336262">time</span><span class="op" id="6336266">.</span><span class="ident" id="6336267">Time</span><span class="op" id="6336271">,</span>&nbsp;<span class="ident" id="6336273">defPath</span><span class="op" id="6336280">,</span>&nbsp;<span class="ident" id="6336282">host</span>&nbsp;<span class="builtintype" id="6336287">string</span><span class="op" id="6336293">)</span>&nbsp;<span class="op" id="6336295">(</span><span class="ident" id="6336296">e</span>&nbsp;<span class="ident" id="6336298">entry</span><span class="op" id="6336303">,</span>&nbsp;<span class="ident" id="6336305">remove</span>&nbsp;<span class="builtintype" id="6336312">bool</span><span class="op" id="6336316">,</span>&nbsp;<span class="ident" id="6336318">err</span>&nbsp;<span class="builtintype" id="6336322">error</span><span class="op" id="6336327">)</span>&nbsp;<span class="op" id="6336329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336332">e</span><span class="op" id="6336333">.</span><span class="ident" id="6336334">Name</span>&nbsp;<span class="op" id="6336339">=</span>&nbsp;<span class="ident" id="6336341">c</span><span class="op" id="6336342">.</span><span class="ident" id="6336343">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336350">if</span>&nbsp;<span class="ident" id="6336353">c</span><span class="op" id="6336354">.</span><span class="ident" id="6336355">Path</span>&nbsp;<span class="op" id="6336360">==</span>&nbsp;<span class="string" id="6336363">&#34;&#34;</span>&nbsp;<span class="op" id="6336366">||</span>&nbsp;<span class="ident" id="6336369">c</span><span class="op" id="6336370">.</span><span class="ident" id="6336371">Path</span><span class="op" id="6336375">[</span><span class="num" id="6336376">0</span><span class="op" id="6336377">]</span>&nbsp;<span class="op" id="6336379">!=</span>&nbsp;<span class="string" id="6336382">&#39;/&#39;</span>&nbsp;<span class="op" id="6336386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336390">e</span><span class="op" id="6336391">.</span><span class="ident" id="6336392">Path</span>&nbsp;<span class="op" id="6336397">=</span>&nbsp;<span class="ident" id="6336399">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336408">}</span>&nbsp;<span class="keyword" id="6336410">else</span>&nbsp;<span class="op" id="6336415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336419">e</span><span class="op" id="6336420">.</span><span class="ident" id="6336421">Path</span>&nbsp;<span class="op" id="6336426">=</span>&nbsp;<span class="ident" id="6336428">c</span><span class="op" id="6336429">.</span><span class="ident" id="6336430">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336440">e</span><span class="op" id="6336441">.</span><span class="ident" id="6336442">Domain</span><span class="op" id="6336448">,</span>&nbsp;<span class="ident" id="6336450">e</span><span class="op" id="6336451">.</span><span class="ident" id="6336452">HostOnly</span><span class="op" id="6336460">,</span>&nbsp;<span class="ident" id="6336462">err</span>&nbsp;<span class="op" id="6336466">=</span>&nbsp;<span class="ident" id="6336468">j</span><span class="op" id="6336469">.</span><span class="ident" id="6336470">domainAndType</span><span class="op" id="6336483">(</span><span class="ident" id="6336484">host</span><span class="op" id="6336488">,</span>&nbsp;<span class="ident" id="6336490">c</span><span class="op" id="6336491">.</span><span class="ident" id="6336492">Domain</span><span class="op" id="6336498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336501">if</span>&nbsp;<span class="ident" id="6336504">err</span>&nbsp;<span class="op" id="6336508">!=</span>&nbsp;<span class="ident" id="6336511">nil</span>&nbsp;<span class="op" id="6336515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336519">return</span>&nbsp;<span class="ident" id="6336526">e</span><span class="op" id="6336527">,</span>&nbsp;<span class="builtintype" id="6336529">false</span><span class="op" id="6336534">,</span>&nbsp;<span class="ident" id="6336536">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336545">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336587">if</span>&nbsp;<span class="ident" id="6336590">c</span><span class="op" id="6336591">.</span><span class="ident" id="6336592">MaxAge</span>&nbsp;<span class="op" id="6336599">&lt;</span>&nbsp;<span class="num" id="6336601">0</span>&nbsp;<span class="op" id="6336603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336607">return</span>&nbsp;<span class="ident" id="6336614">e</span><span class="op" id="6336615">,</span>&nbsp;<span class="builtintype" id="6336617">true</span><span class="op" id="6336621">,</span>&nbsp;<span class="ident" id="6336623">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336628">}</span>&nbsp;<span class="keyword" id="6336630">else</span>&nbsp;<span class="keyword" id="6336635">if</span>&nbsp;<span class="ident" id="6336638">c</span><span class="op" id="6336639">.</span><span class="ident" id="6336640">MaxAge</span>&nbsp;<span class="op" id="6336647">&gt;</span>&nbsp;<span class="num" id="6336649">0</span>&nbsp;<span class="op" id="6336651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336655">e</span><span class="op" id="6336656">.</span><span class="ident" id="6336657">Expires</span>&nbsp;<span class="op" id="6336665">=</span>&nbsp;<span class="ident" id="6336667">now</span><span class="op" id="6336670">.</span><span class="ident" id="6336671">Add</span><span class="op" id="6336674">(</span><span class="ident" id="6336675">time</span><span class="op" id="6336679">.</span><span class="ident" id="6336680">Duration</span><span class="op" id="6336688">(</span><span class="ident" id="6336689">c</span><span class="op" id="6336690">.</span><span class="ident" id="6336691">MaxAge</span><span class="op" id="6336697">)</span>&nbsp;<span class="op" id="6336699">*</span>&nbsp;<span class="ident" id="6336701">time</span><span class="op" id="6336705">.</span><span class="ident" id="6336706">Second</span><span class="op" id="6336712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336716">e</span><span class="op" id="6336717">.</span><span class="ident" id="6336718">Persistent</span>&nbsp;<span class="op" id="6336729">=</span>&nbsp;<span class="builtintype" id="6336731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336737">}</span>&nbsp;<span class="keyword" id="6336739">else</span>&nbsp;<span class="op" id="6336744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336748">if</span>&nbsp;<span class="ident" id="6336751">c</span><span class="op" id="6336752">.</span><span class="ident" id="6336753">Expires</span><span class="op" id="6336760">.</span><span class="ident" id="6336761">IsZero</span><span class="op" id="6336767">(</span><span class="op" id="6336768">)</span>&nbsp;<span class="op" id="6336770">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336775">e</span><span class="op" id="6336776">.</span><span class="ident" id="6336777">Expires</span>&nbsp;<span class="op" id="6336785">=</span>&nbsp;<span class="ident" id="6336787">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336800">e</span><span class="op" id="6336801">.</span><span class="ident" id="6336802">Persistent</span>&nbsp;<span class="op" id="6336813">=</span>&nbsp;<span class="builtintype" id="6336815">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336823">}</span>&nbsp;<span class="keyword" id="6336825">else</span>&nbsp;<span class="op" id="6336830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336835">if</span>&nbsp;<span class="op" id="6336838">!</span><span class="ident" id="6336839">c</span><span class="op" id="6336840">.</span><span class="ident" id="6336841">Expires</span><span class="op" id="6336848">.</span><span class="ident" id="6336849">After</span><span class="op" id="6336854">(</span><span class="ident" id="6336855">now</span><span class="op" id="6336858">)</span>&nbsp;<span class="op" id="6336860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336866">return</span>&nbsp;<span class="ident" id="6336873">e</span><span class="op" id="6336874">,</span>&nbsp;<span class="builtintype" id="6336876">true</span><span class="op" id="6336880">,</span>&nbsp;<span class="ident" id="6336882">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336894">e</span><span class="op" id="6336895">.</span><span class="ident" id="6336896">Expires</span>&nbsp;<span class="op" id="6336904">=</span>&nbsp;<span class="ident" id="6336906">c</span><span class="op" id="6336907">.</span><span class="ident" id="6336908">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336919">e</span><span class="op" id="6336920">.</span><span class="ident" id="6336921">Persistent</span>&nbsp;<span class="op" id="6336932">=</span>&nbsp;<span class="builtintype" id="6336934">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336944">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336948">e</span><span class="op" id="6336949">.</span><span class="ident" id="6336950">Value</span>&nbsp;<span class="op" id="6336956">=</span>&nbsp;<span class="ident" id="6336958">c</span><span class="op" id="6336959">.</span><span class="ident" id="6336960">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336967">e</span><span class="op" id="6336968">.</span><span class="ident" id="6336969">Secure</span>&nbsp;<span class="op" id="6336976">=</span>&nbsp;<span class="ident" id="6336978">c</span><span class="op" id="6336979">.</span><span class="ident" id="6336980">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336988">e</span><span class="op" id="6336989">.</span><span class="ident" id="6336990">HttpOnly</span>&nbsp;<span class="op" id="6336999">=</span>&nbsp;<span class="ident" id="6337001">c</span><span class="op" id="6337002">.</span><span class="ident" id="6337003">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337014">return</span>&nbsp;<span class="ident" id="6337021">e</span><span class="op" id="6337022">,</span>&nbsp;<span class="builtintype" id="6337024">false</span><span class="op" id="6337029">,</span>&nbsp;<span class="ident" id="6337031">nil</span><br>
<span class="lineno"></span><span class="op" id="6337035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6337038">var</span>&nbsp;<span class="op" id="6337042">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337045">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6337064">=</span>&nbsp;<span class="ident" id="6337066">errors</span><span class="op" id="6337072">.</span><span class="ident" id="6337073">New</span><span class="op" id="6337076">(</span><span class="string" id="6337077">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6337121">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337124">errMalformedDomain</span>&nbsp;<span class="op" id="6337143">=</span>&nbsp;<span class="ident" id="6337145">errors</span><span class="op" id="6337151">.</span><span class="ident" id="6337152">New</span><span class="op" id="6337155">(</span><span class="string" id="6337156">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6337202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337205">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337224">=</span>&nbsp;<span class="ident" id="6337226">errors</span><span class="op" id="6337232">.</span><span class="ident" id="6337233">New</span><span class="op" id="6337236">(</span><span class="string" id="6337237">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="6337282">)</span><br>
<span class="lineno"></span><span class="op" id="6337284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337287">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="6337358">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6337427">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="6337486">var</span>&nbsp;<span class="ident" id="6337490">endOfTime</span>&nbsp;<span class="op" id="6337500">=</span>&nbsp;<span class="ident" id="6337502">time</span><span class="op" id="6337506">.</span><span class="ident" id="6337507">Date</span><span class="op" id="6337511">(</span><span class="num" id="6337512">9999</span><span class="op" id="6337516">,</span>&nbsp;<span class="num" id="6337518">12</span><span class="op" id="6337520">,</span>&nbsp;<span class="num" id="6337522">31</span><span class="op" id="6337524">,</span>&nbsp;<span class="num" id="6337526">23</span><span class="op" id="6337528">,</span>&nbsp;<span class="num" id="6337530">59</span><span class="op" id="6337532">,</span>&nbsp;<span class="num" id="6337534">59</span><span class="op" id="6337536">,</span>&nbsp;<span class="num" id="6337538">0</span><span class="op" id="6337539">,</span>&nbsp;<span class="ident" id="6337541">time</span><span class="op" id="6337545">.</span><span class="ident" id="6337546">UTC</span><span class="op" id="6337549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337552">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="6337624">func</span>&nbsp;<span class="op" id="6337629">(</span><span class="ident" id="6337630">j</span>&nbsp;<span class="op" id="6337632">*</span><span class="ident" id="6337633">Jar</span><span class="op" id="6337636">)</span>&nbsp;<span class="ident" id="6337638">domainAndType</span><span class="op" id="6337651">(</span><span class="ident" id="6337652">host</span><span class="op" id="6337656">,</span>&nbsp;<span class="ident" id="6337658">domain</span>&nbsp;<span class="builtintype" id="6337665">string</span><span class="op" id="6337671">)</span>&nbsp;<span class="op" id="6337673">(</span><span class="builtintype" id="6337674">string</span><span class="op" id="6337680">,</span>&nbsp;<span class="builtintype" id="6337682">bool</span><span class="op" id="6337686">,</span>&nbsp;<span class="builtintype" id="6337688">error</span><span class="op" id="6337693">)</span>&nbsp;<span class="op" id="6337695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337698">if</span>&nbsp;<span class="ident" id="6337701">domain</span>&nbsp;<span class="op" id="6337708">==</span>&nbsp;<span class="string" id="6337711">&#34;&#34;</span>&nbsp;<span class="op" id="6337714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337718">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337779">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337797">return</span>&nbsp;<span class="ident" id="6337804">host</span><span class="op" id="6337808">,</span>&nbsp;<span class="builtintype" id="6337810">true</span><span class="op" id="6337814">,</span>&nbsp;<span class="ident" id="6337816">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337825">if</span>&nbsp;<span class="ident" id="6337828">isIP</span><span class="op" id="6337832">(</span><span class="ident" id="6337833">host</span><span class="op" id="6337837">)</span>&nbsp;<span class="op" id="6337839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337843">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337905">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337925">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337981">return</span>&nbsp;<span class="string" id="6337988">&#34;&#34;</span><span class="op" id="6337990">,</span>&nbsp;<span class="builtintype" id="6337992">false</span><span class="op" id="6337997">,</span>&nbsp;<span class="ident" id="6337999">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338018">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338088">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338137">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338169">if</span>&nbsp;<span class="ident" id="6338172">domain</span><span class="op" id="6338178">[</span><span class="num" id="6338179">0</span><span class="op" id="6338180">]</span>&nbsp;<span class="op" id="6338182">==</span>&nbsp;<span class="string" id="6338185">&#39;.&#39;</span>&nbsp;<span class="op" id="6338189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338193">domain</span>&nbsp;<span class="op" id="6338200">=</span>&nbsp;<span class="ident" id="6338202">domain</span><span class="op" id="6338208">[</span><span class="num" id="6338209">1</span><span class="op" id="6338210">:</span><span class="op" id="6338211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338214">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338218">if</span>&nbsp;<span class="builtinfunc" id="6338221">len</span><span class="op" id="6338224">(</span><span class="ident" id="6338225">domain</span><span class="op" id="6338231">)</span>&nbsp;<span class="op" id="6338233">==</span>&nbsp;<span class="num" id="6338236">0</span>&nbsp;<span class="op" id="6338238">||</span>&nbsp;<span class="ident" id="6338241">domain</span><span class="op" id="6338247">[</span><span class="num" id="6338248">0</span><span class="op" id="6338249">]</span>&nbsp;<span class="op" id="6338251">==</span>&nbsp;<span class="string" id="6338254">&#39;.&#39;</span>&nbsp;<span class="op" id="6338258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338262">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338320">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338343">return</span>&nbsp;<span class="string" id="6338350">&#34;&#34;</span><span class="op" id="6338352">,</span>&nbsp;<span class="builtintype" id="6338354">false</span><span class="op" id="6338359">,</span>&nbsp;<span class="ident" id="6338361">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338384">domain</span>&nbsp;<span class="op" id="6338391">=</span>&nbsp;<span class="ident" id="6338393">strings</span><span class="op" id="6338400">.</span><span class="ident" id="6338401">ToLower</span><span class="op" id="6338408">(</span><span class="ident" id="6338409">domain</span><span class="op" id="6338415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338419">if</span>&nbsp;<span class="ident" id="6338422">domain</span><span class="op" id="6338428">[</span><span class="builtinfunc" id="6338429">len</span><span class="op" id="6338432">(</span><span class="ident" id="6338433">domain</span><span class="op" id="6338439">)</span><span class="op" id="6338440">-</span><span class="num" id="6338441">1</span><span class="op" id="6338442">]</span>&nbsp;<span class="op" id="6338444">==</span>&nbsp;<span class="string" id="6338447">&#39;.&#39;</span>&nbsp;<span class="op" id="6338451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338455">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338510">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338572">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338635">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338691">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338753">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338771">return</span>&nbsp;<span class="string" id="6338778">&#34;&#34;</span><span class="op" id="6338780">,</span>&nbsp;<span class="builtintype" id="6338782">false</span><span class="op" id="6338787">,</span>&nbsp;<span class="ident" id="6338789">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338813">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338846">if</span>&nbsp;<span class="ident" id="6338849">j</span><span class="op" id="6338850">.</span><span class="ident" id="6338851">psList</span>&nbsp;<span class="op" id="6338858">!=</span>&nbsp;<span class="ident" id="6338861">nil</span>&nbsp;<span class="op" id="6338865">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338869">if</span>&nbsp;<span class="ident" id="6338872">ps</span>&nbsp;<span class="op" id="6338875">:=</span>&nbsp;<span class="ident" id="6338878">j</span><span class="op" id="6338879">.</span><span class="ident" id="6338880">psList</span><span class="op" id="6338886">.</span><span class="ident" id="6338887">PublicSuffix</span><span class="op" id="6338899">(</span><span class="ident" id="6338900">domain</span><span class="op" id="6338906">)</span><span class="op" id="6338907">;</span>&nbsp;<span class="ident" id="6338909">ps</span>&nbsp;<span class="op" id="6338912">!=</span>&nbsp;<span class="string" id="6338915">&#34;&#34;</span>&nbsp;<span class="op" id="6338918">&amp;&amp;</span>&nbsp;<span class="op" id="6338921">!</span><span class="ident" id="6338922">hasDotSuffix</span><span class="op" id="6338934">(</span><span class="ident" id="6338935">domain</span><span class="op" id="6338941">,</span>&nbsp;<span class="ident" id="6338943">ps</span><span class="op" id="6338945">)</span>&nbsp;<span class="op" id="6338947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338952">if</span>&nbsp;<span class="ident" id="6338955">host</span>&nbsp;<span class="op" id="6338960">==</span>&nbsp;<span class="ident" id="6338963">domain</span>&nbsp;<span class="op" id="6338970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338976">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6339027">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339076">return</span>&nbsp;<span class="ident" id="6339083">host</span><span class="op" id="6339087">,</span>&nbsp;<span class="builtintype" id="6339089">true</span><span class="op" id="6339093">,</span>&nbsp;<span class="ident" id="6339095">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339107">return</span>&nbsp;<span class="string" id="6339114">&#34;&#34;</span><span class="op" id="6339116">,</span>&nbsp;<span class="builtintype" id="6339118">false</span><span class="op" id="6339123">,</span>&nbsp;<span class="ident" id="6339125">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6339151">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6339215">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339256">if</span>&nbsp;<span class="ident" id="6339259">host</span>&nbsp;<span class="op" id="6339264">!=</span>&nbsp;<span class="ident" id="6339267">domain</span>&nbsp;<span class="op" id="6339274">&amp;&amp;</span>&nbsp;<span class="op" id="6339277">!</span><span class="ident" id="6339278">hasDotSuffix</span><span class="op" id="6339290">(</span><span class="ident" id="6339291">host</span><span class="op" id="6339295">,</span>&nbsp;<span class="ident" id="6339297">domain</span><span class="op" id="6339303">)</span>&nbsp;<span class="op" id="6339305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339309">return</span>&nbsp;<span class="string" id="6339316">&#34;&#34;</span><span class="op" id="6339318">,</span>&nbsp;<span class="builtintype" id="6339320">false</span><span class="op" id="6339325">,</span>&nbsp;<span class="ident" id="6339327">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339345">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339349">return</span>&nbsp;<span class="ident" id="6339356">domain</span><span class="op" id="6339362">,</span>&nbsp;<span class="builtintype" id="6339364">false</span><span class="op" id="6339369">,</span>&nbsp;<span class="ident" id="6339371">nil</span><br>
<span class="lineno"></span><span class="op" id="6339375">}</span>
</div>
</body>
</html>
