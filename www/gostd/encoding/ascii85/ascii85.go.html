<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5453546">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5453601">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5453655">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5453706">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5453762">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="5453839">package</span>&nbsp;<span class="ident" id="5453847">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5453856">import</span>&nbsp;<span class="op" id="5453863">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5453866">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5453872">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5453882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453885">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453904">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="5453963">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="5454026">//</span><br>
<span class="lineno"></span><span class="comment" id="5454029">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5454093">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5454159">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5454231">//</span><br>
<span class="lineno">25</span><span class="comment" id="5454234">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5454298">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="5454328">func</span>&nbsp;<span class="ident" id="5454333">Encode</span><span class="op" id="5454339">(</span><span class="ident" id="5454340">dst</span><span class="op" id="5454343">,</span>&nbsp;<span class="ident" id="5454345">src</span>&nbsp;<span class="op" id="5454349">[</span><span class="op" id="5454350">]</span><span class="builtintype" id="5454351">byte</span><span class="op" id="5454355">)</span>&nbsp;<span class="builtintype" id="5454357">int</span>&nbsp;<span class="op" id="5454361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454364">if</span>&nbsp;<span class="builtinfunc" id="5454367">len</span><span class="op" id="5454370">(</span><span class="ident" id="5454371">src</span><span class="op" id="5454374">)</span>&nbsp;<span class="op" id="5454376">==</span>&nbsp;<span class="num" id="5454379">0</span>&nbsp;<span class="op" id="5454381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454385">return</span>&nbsp;<span class="num" id="5454392">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454399">n</span>&nbsp;<span class="op" id="5454401">:=</span>&nbsp;<span class="num" id="5454404">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454407">for</span>&nbsp;<span class="builtinfunc" id="5454411">len</span><span class="op" id="5454414">(</span><span class="ident" id="5454415">src</span><span class="op" id="5454418">)</span>&nbsp;<span class="op" id="5454420">&gt;</span>&nbsp;<span class="num" id="5454422">0</span>&nbsp;<span class="op" id="5454424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454428">dst</span><span class="op" id="5454431">[</span><span class="num" id="5454432">0</span><span class="op" id="5454433">]</span>&nbsp;<span class="op" id="5454435">=</span>&nbsp;<span class="num" id="5454437">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454441">dst</span><span class="op" id="5454444">[</span><span class="num" id="5454445">1</span><span class="op" id="5454446">]</span>&nbsp;<span class="op" id="5454448">=</span>&nbsp;<span class="num" id="5454450">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454454">dst</span><span class="op" id="5454457">[</span><span class="num" id="5454458">2</span><span class="op" id="5454459">]</span>&nbsp;<span class="op" id="5454461">=</span>&nbsp;<span class="num" id="5454463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454467">dst</span><span class="op" id="5454470">[</span><span class="num" id="5454471">3</span><span class="op" id="5454472">]</span>&nbsp;<span class="op" id="5454474">=</span>&nbsp;<span class="num" id="5454476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454480">dst</span><span class="op" id="5454483">[</span><span class="num" id="5454484">4</span><span class="op" id="5454485">]</span>&nbsp;<span class="op" id="5454487">=</span>&nbsp;<span class="num" id="5454489">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454494">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454557">var</span>&nbsp;<span class="ident" id="5454561">v</span>&nbsp;<span class="builtintype" id="5454563">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454572">switch</span>&nbsp;<span class="builtinfunc" id="5454579">len</span><span class="op" id="5454582">(</span><span class="ident" id="5454583">src</span><span class="op" id="5454586">)</span>&nbsp;<span class="op" id="5454588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454592">default</span><span class="op" id="5454599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454604">v</span>&nbsp;<span class="op" id="5454606">|=</span>&nbsp;<span class="builtintype" id="5454609">uint32</span><span class="op" id="5454615">(</span><span class="ident" id="5454616">src</span><span class="op" id="5454619">[</span><span class="num" id="5454620">3</span><span class="op" id="5454621">]</span><span class="op" id="5454622">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454627">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454641">case</span>&nbsp;<span class="num" id="5454646">3</span><span class="op" id="5454647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454652">v</span>&nbsp;<span class="op" id="5454654">|=</span>&nbsp;<span class="builtintype" id="5454657">uint32</span><span class="op" id="5454663">(</span><span class="ident" id="5454664">src</span><span class="op" id="5454667">[</span><span class="num" id="5454668">2</span><span class="op" id="5454669">]</span><span class="op" id="5454670">)</span>&nbsp;<span class="op" id="5454672">&lt;&lt;</span>&nbsp;<span class="num" id="5454675">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454680">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454694">case</span>&nbsp;<span class="num" id="5454699">2</span><span class="op" id="5454700">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454705">v</span>&nbsp;<span class="op" id="5454707">|=</span>&nbsp;<span class="builtintype" id="5454710">uint32</span><span class="op" id="5454716">(</span><span class="ident" id="5454717">src</span><span class="op" id="5454720">[</span><span class="num" id="5454721">1</span><span class="op" id="5454722">]</span><span class="op" id="5454723">)</span>&nbsp;<span class="op" id="5454725">&lt;&lt;</span>&nbsp;<span class="num" id="5454728">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454734">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454748">case</span>&nbsp;<span class="num" id="5454753">1</span><span class="op" id="5454754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454759">v</span>&nbsp;<span class="op" id="5454761">|=</span>&nbsp;<span class="builtintype" id="5454764">uint32</span><span class="op" id="5454770">(</span><span class="ident" id="5454771">src</span><span class="op" id="5454774">[</span><span class="num" id="5454775">0</span><span class="op" id="5454776">]</span><span class="op" id="5454777">)</span>&nbsp;<span class="op" id="5454779">&lt;&lt;</span>&nbsp;<span class="num" id="5454782">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454787">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454792">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454839">if</span>&nbsp;<span class="ident" id="5454842">v</span>&nbsp;<span class="op" id="5454844">==</span>&nbsp;<span class="num" id="5454847">0</span>&nbsp;<span class="op" id="5454849">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5454852">len</span><span class="op" id="5454855">(</span><span class="ident" id="5454856">src</span><span class="op" id="5454859">)</span>&nbsp;<span class="op" id="5454861">&gt;=</span>&nbsp;<span class="num" id="5454864">4</span>&nbsp;<span class="op" id="5454866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454871">dst</span><span class="op" id="5454874">[</span><span class="num" id="5454875">0</span><span class="op" id="5454876">]</span>&nbsp;<span class="op" id="5454878">=</span>&nbsp;<span class="string" id="5454880">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454887">dst</span>&nbsp;<span class="op" id="5454891">=</span>&nbsp;<span class="ident" id="5454893">dst</span><span class="op" id="5454896">[</span><span class="num" id="5454897">1</span><span class="op" id="5454898">:</span><span class="op" id="5454899">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454904">src</span>&nbsp;<span class="op" id="5454908">=</span>&nbsp;<span class="ident" id="5454910">src</span><span class="op" id="5454913">[</span><span class="num" id="5454914">4</span><span class="op" id="5454915">:</span><span class="op" id="5454916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454921">n</span><span class="op" id="5454922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454928">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454944">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454992">for</span>&nbsp;<span class="ident" id="5454996">i</span>&nbsp;<span class="op" id="5454998">:=</span>&nbsp;<span class="num" id="5455001">4</span><span class="op" id="5455002">;</span>&nbsp;<span class="ident" id="5455004">i</span>&nbsp;<span class="op" id="5455006">&gt;=</span>&nbsp;<span class="num" id="5455009">0</span><span class="op" id="5455010">;</span>&nbsp;<span class="ident" id="5455012">i</span><span class="op" id="5455013">--</span>&nbsp;<span class="op" id="5455016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455021">dst</span><span class="op" id="5455024">[</span><span class="ident" id="5455025">i</span><span class="op" id="5455026">]</span>&nbsp;<span class="op" id="5455028">=</span>&nbsp;<span class="string" id="5455030">&#39;!&#39;</span>&nbsp;<span class="op" id="5455034">+</span>&nbsp;<span class="builtintype" id="5455036">byte</span><span class="op" id="5455040">(</span><span class="ident" id="5455041">v</span><span class="op" id="5455042">%</span><span class="num" id="5455043">85</span><span class="op" id="5455045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455050">v</span>&nbsp;<span class="op" id="5455052">/=</span>&nbsp;<span class="num" id="5455055">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455060">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455065">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455123">m</span>&nbsp;<span class="op" id="5455125">:=</span>&nbsp;<span class="num" id="5455128">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455132">if</span>&nbsp;<span class="builtinfunc" id="5455135">len</span><span class="op" id="5455138">(</span><span class="ident" id="5455139">src</span><span class="op" id="5455142">)</span>&nbsp;<span class="op" id="5455144">&lt;</span>&nbsp;<span class="num" id="5455146">4</span>&nbsp;<span class="op" id="5455148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455153">m</span>&nbsp;<span class="op" id="5455155">-=</span>&nbsp;<span class="num" id="5455158">4</span>&nbsp;<span class="op" id="5455160">-</span>&nbsp;<span class="builtinfunc" id="5455162">len</span><span class="op" id="5455165">(</span><span class="ident" id="5455166">src</span><span class="op" id="5455169">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455174">src</span>&nbsp;<span class="op" id="5455178">=</span>&nbsp;<span class="builtintype" id="5455180">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455186">}</span>&nbsp;<span class="keyword" id="5455188">else</span>&nbsp;<span class="op" id="5455193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455198">src</span>&nbsp;<span class="op" id="5455202">=</span>&nbsp;<span class="ident" id="5455204">src</span><span class="op" id="5455207">[</span><span class="num" id="5455208">4</span><span class="op" id="5455209">:</span><span class="op" id="5455210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455218">dst</span>&nbsp;<span class="op" id="5455222">=</span>&nbsp;<span class="ident" id="5455224">dst</span><span class="op" id="5455227">[</span><span class="ident" id="5455228">m</span><span class="op" id="5455229">:</span><span class="op" id="5455230">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455234">n</span>&nbsp;<span class="op" id="5455236">+=</span>&nbsp;<span class="ident" id="5455239">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455245">return</span>&nbsp;<span class="ident" id="5455252">n</span><br>
<span class="lineno"></span><span class="op" id="5455254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5455257">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5455335">func</span>&nbsp;<span class="ident" id="5455340">MaxEncodedLen</span><span class="op" id="5455353">(</span><span class="ident" id="5455354">n</span>&nbsp;<span class="builtintype" id="5455356">int</span><span class="op" id="5455359">)</span>&nbsp;<span class="builtintype" id="5455361">int</span>&nbsp;<span class="op" id="5455365">{</span>&nbsp;<span class="keyword" id="5455367">return</span>&nbsp;<span class="op" id="5455374">(</span><span class="ident" id="5455375">n</span>&nbsp;<span class="op" id="5455377">+</span>&nbsp;<span class="num" id="5455379">3</span><span class="op" id="5455380">)</span>&nbsp;<span class="op" id="5455382">/</span>&nbsp;<span class="num" id="5455384">4</span>&nbsp;<span class="op" id="5455386">*</span>&nbsp;<span class="num" id="5455388">5</span>&nbsp;<span class="op" id="5455390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455393">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5455462">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="5455524">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="5455585">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5455653">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5455680">func</span>&nbsp;<span class="ident" id="5455685">NewEncoder</span><span class="op" id="5455695">(</span><span class="ident" id="5455696">w</span>&nbsp;<span class="ident" id="5455698">io</span><span class="op" id="5455700">.</span><span class="ident" id="5455701">Writer</span><span class="op" id="5455707">)</span>&nbsp;<span class="ident" id="5455709">io</span><span class="op" id="5455711">.</span><span class="ident" id="5455712">WriteCloser</span>&nbsp;<span class="op" id="5455724">{</span>&nbsp;<span class="keyword" id="5455726">return</span>&nbsp;<span class="op" id="5455733">&amp;</span><span class="ident" id="5455734">encoder</span><span class="op" id="5455741">{</span><span class="ident" id="5455742">w</span><span class="op" id="5455743">:</span>&nbsp;<span class="ident" id="5455745">w</span><span class="op" id="5455746">}</span>&nbsp;<span class="op" id="5455748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5455751">type</span>&nbsp;<span class="ident" id="5455756">encoder</span>&nbsp;<span class="keyword" id="5455764">struct</span>&nbsp;<span class="op" id="5455771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455774">err</span>&nbsp;&nbsp;<span class="builtintype" id="5455779">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455786">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455791">io</span><span class="op" id="5455793">.</span><span class="ident" id="5455794">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455802">buf</span>&nbsp;&nbsp;<span class="op" id="5455807">[</span><span class="num" id="5455808">4</span><span class="op" id="5455809">]</span><span class="builtintype" id="5455810">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455818">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455858">nbuf</span>&nbsp;<span class="builtintype" id="5455863">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455874">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455901">out</span>&nbsp;&nbsp;<span class="op" id="5455906">[</span><span class="num" id="5455907">1024</span><span class="op" id="5455911">]</span><span class="builtintype" id="5455912">byte</span>&nbsp;<span class="comment" id="5455917">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="5455934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5455937">func</span>&nbsp;<span class="op" id="5455942">(</span><span class="ident" id="5455943">e</span>&nbsp;<span class="op" id="5455945">*</span><span class="ident" id="5455946">encoder</span><span class="op" id="5455953">)</span>&nbsp;<span class="ident" id="5455955">Write</span><span class="op" id="5455960">(</span><span class="ident" id="5455961">p</span>&nbsp;<span class="op" id="5455963">[</span><span class="op" id="5455964">]</span><span class="builtintype" id="5455965">byte</span><span class="op" id="5455969">)</span>&nbsp;<span class="op" id="5455971">(</span><span class="ident" id="5455972">n</span>&nbsp;<span class="builtintype" id="5455974">int</span><span class="op" id="5455977">,</span>&nbsp;<span class="ident" id="5455979">err</span>&nbsp;<span class="builtintype" id="5455983">error</span><span class="op" id="5455988">)</span>&nbsp;<span class="op" id="5455990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455993">if</span>&nbsp;<span class="ident" id="5455996">e</span><span class="op" id="5455997">.</span><span class="ident" id="5455998">err</span>&nbsp;<span class="op" id="5456002">!=</span>&nbsp;<span class="builtintype" id="5456005">nil</span>&nbsp;<span class="op" id="5456009">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456013">return</span>&nbsp;<span class="num" id="5456020">0</span><span class="op" id="5456021">,</span>&nbsp;<span class="ident" id="5456023">e</span><span class="op" id="5456024">.</span><span class="ident" id="5456025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456034">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456054">if</span>&nbsp;<span class="ident" id="5456057">e</span><span class="op" id="5456058">.</span><span class="ident" id="5456059">nbuf</span>&nbsp;<span class="op" id="5456064">&gt;</span>&nbsp;<span class="num" id="5456066">0</span>&nbsp;<span class="op" id="5456068">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456072">var</span>&nbsp;<span class="ident" id="5456076">i</span>&nbsp;<span class="builtintype" id="5456078">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456084">for</span>&nbsp;<span class="ident" id="5456088">i</span>&nbsp;<span class="op" id="5456090">=</span>&nbsp;<span class="num" id="5456092">0</span><span class="op" id="5456093">;</span>&nbsp;<span class="ident" id="5456095">i</span>&nbsp;<span class="op" id="5456097">&lt;</span>&nbsp;<span class="builtinfunc" id="5456099">len</span><span class="op" id="5456102">(</span><span class="ident" id="5456103">p</span><span class="op" id="5456104">)</span>&nbsp;<span class="op" id="5456106">&amp;&amp;</span>&nbsp;<span class="ident" id="5456109">e</span><span class="op" id="5456110">.</span><span class="ident" id="5456111">nbuf</span>&nbsp;<span class="op" id="5456116">&lt;</span>&nbsp;<span class="num" id="5456118">4</span><span class="op" id="5456119">;</span>&nbsp;<span class="ident" id="5456121">i</span><span class="op" id="5456122">++</span>&nbsp;<span class="op" id="5456125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456130">e</span><span class="op" id="5456131">.</span><span class="ident" id="5456132">buf</span><span class="op" id="5456135">[</span><span class="ident" id="5456136">e</span><span class="op" id="5456137">.</span><span class="ident" id="5456138">nbuf</span><span class="op" id="5456142">]</span>&nbsp;<span class="op" id="5456144">=</span>&nbsp;<span class="ident" id="5456146">p</span><span class="op" id="5456147">[</span><span class="ident" id="5456148">i</span><span class="op" id="5456149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456154">e</span><span class="op" id="5456155">.</span><span class="ident" id="5456156">nbuf</span><span class="op" id="5456160">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456165">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456169">n</span>&nbsp;<span class="op" id="5456171">+=</span>&nbsp;<span class="ident" id="5456174">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456178">p</span>&nbsp;<span class="op" id="5456180">=</span>&nbsp;<span class="ident" id="5456182">p</span><span class="op" id="5456183">[</span><span class="ident" id="5456184">i</span><span class="op" id="5456185">:</span><span class="op" id="5456186">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456190">if</span>&nbsp;<span class="ident" id="5456193">e</span><span class="op" id="5456194">.</span><span class="ident" id="5456195">nbuf</span>&nbsp;<span class="op" id="5456200">&lt;</span>&nbsp;<span class="num" id="5456202">4</span>&nbsp;<span class="op" id="5456204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456218">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456222">nout</span>&nbsp;<span class="op" id="5456227">:=</span>&nbsp;<span class="ident" id="5456230">Encode</span><span class="op" id="5456236">(</span><span class="ident" id="5456237">e</span><span class="op" id="5456238">.</span><span class="ident" id="5456239">out</span><span class="op" id="5456242">[</span><span class="num" id="5456243">0</span><span class="op" id="5456244">:</span><span class="op" id="5456245">]</span><span class="op" id="5456246">,</span>&nbsp;<span class="ident" id="5456248">e</span><span class="op" id="5456249">.</span><span class="ident" id="5456250">buf</span><span class="op" id="5456253">[</span><span class="num" id="5456254">0</span><span class="op" id="5456255">:</span><span class="op" id="5456256">]</span><span class="op" id="5456257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456261">if</span>&nbsp;<span class="ident" id="5456264">_</span><span class="op" id="5456265">,</span>&nbsp;<span class="ident" id="5456267">e</span><span class="op" id="5456268">.</span><span class="ident" id="5456269">err</span>&nbsp;<span class="op" id="5456273">=</span>&nbsp;<span class="ident" id="5456275">e</span><span class="op" id="5456276">.</span><span class="ident" id="5456277">w</span><span class="op" id="5456278">.</span><span class="ident" id="5456279">Write</span><span class="op" id="5456284">(</span><span class="ident" id="5456285">e</span><span class="op" id="5456286">.</span><span class="ident" id="5456287">out</span><span class="op" id="5456290">[</span><span class="num" id="5456291">0</span><span class="op" id="5456292">:</span><span class="ident" id="5456293">nout</span><span class="op" id="5456297">]</span><span class="op" id="5456298">)</span><span class="op" id="5456299">;</span>&nbsp;<span class="ident" id="5456301">e</span><span class="op" id="5456302">.</span><span class="ident" id="5456303">err</span>&nbsp;<span class="op" id="5456307">!=</span>&nbsp;<span class="builtintype" id="5456310">nil</span>&nbsp;<span class="op" id="5456314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456319">return</span>&nbsp;<span class="ident" id="5456326">n</span><span class="op" id="5456327">,</span>&nbsp;<span class="ident" id="5456329">e</span><span class="op" id="5456330">.</span><span class="ident" id="5456331">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456341">e</span><span class="op" id="5456342">.</span><span class="ident" id="5456343">nbuf</span>&nbsp;<span class="op" id="5456348">=</span>&nbsp;<span class="num" id="5456350">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456357">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456384">for</span>&nbsp;<span class="builtinfunc" id="5456388">len</span><span class="op" id="5456391">(</span><span class="ident" id="5456392">p</span><span class="op" id="5456393">)</span>&nbsp;<span class="op" id="5456395">&gt;=</span>&nbsp;<span class="num" id="5456398">4</span>&nbsp;<span class="op" id="5456400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456404">nn</span>&nbsp;<span class="op" id="5456407">:=</span>&nbsp;<span class="builtinfunc" id="5456410">len</span><span class="op" id="5456413">(</span><span class="ident" id="5456414">e</span><span class="op" id="5456415">.</span><span class="ident" id="5456416">out</span><span class="op" id="5456419">)</span>&nbsp;<span class="op" id="5456421">/</span>&nbsp;<span class="num" id="5456423">5</span>&nbsp;<span class="op" id="5456425">*</span>&nbsp;<span class="num" id="5456427">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456431">if</span>&nbsp;<span class="ident" id="5456434">nn</span>&nbsp;<span class="op" id="5456437">&gt;</span>&nbsp;<span class="builtinfunc" id="5456439">len</span><span class="op" id="5456442">(</span><span class="ident" id="5456443">p</span><span class="op" id="5456444">)</span>&nbsp;<span class="op" id="5456446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456451">nn</span>&nbsp;<span class="op" id="5456454">=</span>&nbsp;<span class="builtinfunc" id="5456456">len</span><span class="op" id="5456459">(</span><span class="ident" id="5456460">p</span><span class="op" id="5456461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456469">nn</span>&nbsp;<span class="op" id="5456472">-=</span>&nbsp;<span class="ident" id="5456475">nn</span>&nbsp;<span class="op" id="5456478">%</span>&nbsp;<span class="num" id="5456480">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456484">if</span>&nbsp;<span class="ident" id="5456487">nn</span>&nbsp;<span class="op" id="5456490">&gt;</span>&nbsp;<span class="num" id="5456492">0</span>&nbsp;<span class="op" id="5456494">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456499">nout</span>&nbsp;<span class="op" id="5456504">:=</span>&nbsp;<span class="ident" id="5456507">Encode</span><span class="op" id="5456513">(</span><span class="ident" id="5456514">e</span><span class="op" id="5456515">.</span><span class="ident" id="5456516">out</span><span class="op" id="5456519">[</span><span class="num" id="5456520">0</span><span class="op" id="5456521">:</span><span class="op" id="5456522">]</span><span class="op" id="5456523">,</span>&nbsp;<span class="ident" id="5456525">p</span><span class="op" id="5456526">[</span><span class="num" id="5456527">0</span><span class="op" id="5456528">:</span><span class="ident" id="5456529">nn</span><span class="op" id="5456531">]</span><span class="op" id="5456532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456537">if</span>&nbsp;<span class="ident" id="5456540">_</span><span class="op" id="5456541">,</span>&nbsp;<span class="ident" id="5456543">e</span><span class="op" id="5456544">.</span><span class="ident" id="5456545">err</span>&nbsp;<span class="op" id="5456549">=</span>&nbsp;<span class="ident" id="5456551">e</span><span class="op" id="5456552">.</span><span class="ident" id="5456553">w</span><span class="op" id="5456554">.</span><span class="ident" id="5456555">Write</span><span class="op" id="5456560">(</span><span class="ident" id="5456561">e</span><span class="op" id="5456562">.</span><span class="ident" id="5456563">out</span><span class="op" id="5456566">[</span><span class="num" id="5456567">0</span><span class="op" id="5456568">:</span><span class="ident" id="5456569">nout</span><span class="op" id="5456573">]</span><span class="op" id="5456574">)</span><span class="op" id="5456575">;</span>&nbsp;<span class="ident" id="5456577">e</span><span class="op" id="5456578">.</span><span class="ident" id="5456579">err</span>&nbsp;<span class="op" id="5456583">!=</span>&nbsp;<span class="builtintype" id="5456586">nil</span>&nbsp;<span class="op" id="5456590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456596">return</span>&nbsp;<span class="ident" id="5456603">n</span><span class="op" id="5456604">,</span>&nbsp;<span class="ident" id="5456606">e</span><span class="op" id="5456607">.</span><span class="ident" id="5456608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456619">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456623">n</span>&nbsp;<span class="op" id="5456625">+=</span>&nbsp;<span class="ident" id="5456628">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456633">p</span>&nbsp;<span class="op" id="5456635">=</span>&nbsp;<span class="ident" id="5456637">p</span><span class="op" id="5456638">[</span><span class="ident" id="5456639">nn</span><span class="op" id="5456641">:</span><span class="op" id="5456642">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456649">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456670">for</span>&nbsp;<span class="ident" id="5456674">i</span>&nbsp;<span class="op" id="5456676">:=</span>&nbsp;<span class="num" id="5456679">0</span><span class="op" id="5456680">;</span>&nbsp;<span class="ident" id="5456682">i</span>&nbsp;<span class="op" id="5456684">&lt;</span>&nbsp;<span class="builtinfunc" id="5456686">len</span><span class="op" id="5456689">(</span><span class="ident" id="5456690">p</span><span class="op" id="5456691">)</span><span class="op" id="5456692">;</span>&nbsp;<span class="ident" id="5456694">i</span><span class="op" id="5456695">++</span>&nbsp;<span class="op" id="5456698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456702">e</span><span class="op" id="5456703">.</span><span class="ident" id="5456704">buf</span><span class="op" id="5456707">[</span><span class="ident" id="5456708">i</span><span class="op" id="5456709">]</span>&nbsp;<span class="op" id="5456711">=</span>&nbsp;<span class="ident" id="5456713">p</span><span class="op" id="5456714">[</span><span class="ident" id="5456715">i</span><span class="op" id="5456716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456722">e</span><span class="op" id="5456723">.</span><span class="ident" id="5456724">nbuf</span>&nbsp;<span class="op" id="5456729">=</span>&nbsp;<span class="builtinfunc" id="5456731">len</span><span class="op" id="5456734">(</span><span class="ident" id="5456735">p</span><span class="op" id="5456736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456739">n</span>&nbsp;<span class="op" id="5456741">+=</span>&nbsp;<span class="builtinfunc" id="5456744">len</span><span class="op" id="5456747">(</span><span class="ident" id="5456748">p</span><span class="op" id="5456749">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456752">return</span><br>
<span class="lineno"></span><span class="op" id="5456759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5456762">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5456816">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="5456869">func</span>&nbsp;<span class="op" id="5456874">(</span><span class="ident" id="5456875">e</span>&nbsp;<span class="op" id="5456877">*</span><span class="ident" id="5456878">encoder</span><span class="op" id="5456885">)</span>&nbsp;<span class="ident" id="5456887">Close</span><span class="op" id="5456892">(</span><span class="op" id="5456893">)</span>&nbsp;<span class="builtintype" id="5456895">error</span>&nbsp;<span class="op" id="5456901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456904">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456961">if</span>&nbsp;<span class="ident" id="5456964">e</span><span class="op" id="5456965">.</span><span class="ident" id="5456966">err</span>&nbsp;<span class="op" id="5456970">==</span>&nbsp;<span class="builtintype" id="5456973">nil</span>&nbsp;<span class="op" id="5456977">&amp;&amp;</span>&nbsp;<span class="ident" id="5456980">e</span><span class="op" id="5456981">.</span><span class="ident" id="5456982">nbuf</span>&nbsp;<span class="op" id="5456987">&gt;</span>&nbsp;<span class="num" id="5456989">0</span>&nbsp;<span class="op" id="5456991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456995">nout</span>&nbsp;<span class="op" id="5457000">:=</span>&nbsp;<span class="ident" id="5457003">Encode</span><span class="op" id="5457009">(</span><span class="ident" id="5457010">e</span><span class="op" id="5457011">.</span><span class="ident" id="5457012">out</span><span class="op" id="5457015">[</span><span class="num" id="5457016">0</span><span class="op" id="5457017">:</span><span class="op" id="5457018">]</span><span class="op" id="5457019">,</span>&nbsp;<span class="ident" id="5457021">e</span><span class="op" id="5457022">.</span><span class="ident" id="5457023">buf</span><span class="op" id="5457026">[</span><span class="num" id="5457027">0</span><span class="op" id="5457028">:</span><span class="ident" id="5457029">e</span><span class="op" id="5457030">.</span><span class="ident" id="5457031">nbuf</span><span class="op" id="5457035">]</span><span class="op" id="5457036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457040">e</span><span class="op" id="5457041">.</span><span class="ident" id="5457042">nbuf</span>&nbsp;<span class="op" id="5457047">=</span>&nbsp;<span class="num" id="5457049">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457053">_</span><span class="op" id="5457054">,</span>&nbsp;<span class="ident" id="5457056">e</span><span class="op" id="5457057">.</span><span class="ident" id="5457058">err</span>&nbsp;<span class="op" id="5457062">=</span>&nbsp;<span class="ident" id="5457064">e</span><span class="op" id="5457065">.</span><span class="ident" id="5457066">w</span><span class="op" id="5457067">.</span><span class="ident" id="5457068">Write</span><span class="op" id="5457073">(</span><span class="ident" id="5457074">e</span><span class="op" id="5457075">.</span><span class="ident" id="5457076">out</span><span class="op" id="5457079">[</span><span class="num" id="5457080">0</span><span class="op" id="5457081">:</span><span class="ident" id="5457082">nout</span><span class="op" id="5457086">]</span><span class="op" id="5457087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457093">return</span>&nbsp;<span class="ident" id="5457100">e</span><span class="op" id="5457101">.</span><span class="ident" id="5457102">err</span><br>
<span class="lineno"></span><span class="op" id="5457106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5457109">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5457128">type</span>&nbsp;<span class="ident" id="5457133">CorruptInputError</span>&nbsp;<span class="ident" id="5457151">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5457158">func</span>&nbsp;<span class="op" id="5457163">(</span><span class="ident" id="5457164">e</span>&nbsp;<span class="ident" id="5457166">CorruptInputError</span><span class="op" id="5457183">)</span>&nbsp;<span class="ident" id="5457185">Error</span><span class="op" id="5457190">(</span><span class="op" id="5457191">)</span>&nbsp;<span class="builtintype" id="5457193">string</span>&nbsp;<span class="op" id="5457200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457203">return</span>&nbsp;<span class="string" id="5457210">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="5457248">+</span>&nbsp;<span class="ident" id="5457250">strconv</span><span class="op" id="5457257">.</span><span class="ident" id="5457258">FormatInt</span><span class="op" id="5457267">(</span><span class="ident" id="5457268">int64</span><span class="op" id="5457273">(</span><span class="ident" id="5457274">e</span><span class="op" id="5457275">)</span><span class="op" id="5457276">,</span>&nbsp;<span class="num" id="5457278">10</span><span class="op" id="5457280">)</span><br>
<span class="lineno"></span><span class="op" id="5457282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5457285">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5457343">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5457404">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5457468">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="5457533">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="5457588">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5457652">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="5457713">//</span><br>
<span class="lineno"></span><span class="comment" id="5457716">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5457776">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="5457838">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5457895">//</span><br>
<span class="lineno"></span><span class="comment" id="5457898">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="5457956">//</span><br>
<span class="lineno"></span><span class="keyword" id="5457959">func</span>&nbsp;<span class="ident" id="5457964">Decode</span><span class="op" id="5457970">(</span><span class="ident" id="5457971">dst</span><span class="op" id="5457974">,</span>&nbsp;<span class="ident" id="5457976">src</span>&nbsp;<span class="op" id="5457980">[</span><span class="op" id="5457981">]</span><span class="builtintype" id="5457982">byte</span><span class="op" id="5457986">,</span>&nbsp;<span class="ident" id="5457988">flush</span>&nbsp;<span class="builtintype" id="5457994">bool</span><span class="op" id="5457998">)</span>&nbsp;<span class="op" id="5458000">(</span><span class="ident" id="5458001">ndst</span><span class="op" id="5458005">,</span>&nbsp;<span class="ident" id="5458007">nsrc</span>&nbsp;<span class="builtintype" id="5458012">int</span><span class="op" id="5458015">,</span>&nbsp;<span class="ident" id="5458017">err</span>&nbsp;<span class="builtintype" id="5458021">error</span><span class="op" id="5458026">)</span>&nbsp;<span class="op" id="5458028">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458031">var</span>&nbsp;<span class="ident" id="5458035">v</span>&nbsp;<span class="builtintype" id="5458037">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458045">var</span>&nbsp;<span class="ident" id="5458049">nb</span>&nbsp;<span class="builtintype" id="5458052">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458057">for</span>&nbsp;<span class="ident" id="5458061">i</span><span class="op" id="5458062">,</span>&nbsp;<span class="ident" id="5458064">b</span>&nbsp;<span class="op" id="5458066">:=</span>&nbsp;<span class="keyword" id="5458069">range</span>&nbsp;<span class="ident" id="5458075">src</span>&nbsp;<span class="op" id="5458079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458083">if</span>&nbsp;<span class="builtinfunc" id="5458086">len</span><span class="op" id="5458089">(</span><span class="ident" id="5458090">dst</span><span class="op" id="5458093">)</span><span class="op" id="5458094">-</span><span class="ident" id="5458095">ndst</span>&nbsp;<span class="op" id="5458100">&lt;</span>&nbsp;<span class="num" id="5458102">4</span>&nbsp;<span class="op" id="5458104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458109">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458122">switch</span>&nbsp;<span class="op" id="5458129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458133">case</span>&nbsp;<span class="ident" id="5458138">b</span>&nbsp;<span class="op" id="5458140">&lt;=</span>&nbsp;<span class="string" id="5458143">&#39;&nbsp;&#39;</span><span class="op" id="5458146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458151">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458162">case</span>&nbsp;<span class="ident" id="5458167">b</span>&nbsp;<span class="op" id="5458169">==</span>&nbsp;<span class="string" id="5458172">&#39;z&#39;</span>&nbsp;<span class="op" id="5458176">&amp;&amp;</span>&nbsp;<span class="ident" id="5458179">nb</span>&nbsp;<span class="op" id="5458182">==</span>&nbsp;<span class="num" id="5458185">0</span><span class="op" id="5458186">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458191">nb</span>&nbsp;<span class="op" id="5458194">=</span>&nbsp;<span class="num" id="5458196">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458201">v</span>&nbsp;<span class="op" id="5458203">=</span>&nbsp;<span class="num" id="5458205">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458209">case</span>&nbsp;<span class="string" id="5458214">&#39;!&#39;</span>&nbsp;<span class="op" id="5458218">&lt;=</span>&nbsp;<span class="ident" id="5458221">b</span>&nbsp;<span class="op" id="5458223">&amp;&amp;</span>&nbsp;<span class="ident" id="5458226">b</span>&nbsp;<span class="op" id="5458228">&lt;=</span>&nbsp;<span class="string" id="5458231">&#39;u&#39;</span><span class="op" id="5458234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458239">v</span>&nbsp;<span class="op" id="5458241">=</span>&nbsp;<span class="ident" id="5458243">v</span><span class="op" id="5458244">*</span><span class="num" id="5458245">85</span>&nbsp;<span class="op" id="5458248">+</span>&nbsp;<span class="builtintype" id="5458250">uint32</span><span class="op" id="5458256">(</span><span class="ident" id="5458257">b</span><span class="op" id="5458258">-</span><span class="string" id="5458259">&#39;!&#39;</span><span class="op" id="5458262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458267">nb</span><span class="op" id="5458269">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458274">default</span><span class="op" id="5458281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458286">return</span>&nbsp;<span class="num" id="5458293">0</span><span class="op" id="5458294">,</span>&nbsp;<span class="num" id="5458296">0</span><span class="op" id="5458297">,</span>&nbsp;<span class="ident" id="5458299">CorruptInputError</span><span class="op" id="5458316">(</span><span class="ident" id="5458317">i</span><span class="op" id="5458318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458326">if</span>&nbsp;<span class="ident" id="5458329">nb</span>&nbsp;<span class="op" id="5458332">==</span>&nbsp;<span class="num" id="5458335">5</span>&nbsp;<span class="op" id="5458337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458342">nsrc</span>&nbsp;<span class="op" id="5458347">=</span>&nbsp;<span class="ident" id="5458349">i</span>&nbsp;<span class="op" id="5458351">+</span>&nbsp;<span class="num" id="5458353">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458358">dst</span><span class="op" id="5458361">[</span><span class="ident" id="5458362">ndst</span><span class="op" id="5458366">]</span>&nbsp;<span class="op" id="5458368">=</span>&nbsp;<span class="builtintype" id="5458370">byte</span><span class="op" id="5458374">(</span><span class="ident" id="5458375">v</span>&nbsp;<span class="op" id="5458377">&gt;&gt;</span>&nbsp;<span class="num" id="5458380">24</span><span class="op" id="5458382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458387">dst</span><span class="op" id="5458390">[</span><span class="ident" id="5458391">ndst</span><span class="op" id="5458395">+</span><span class="num" id="5458396">1</span><span class="op" id="5458397">]</span>&nbsp;<span class="op" id="5458399">=</span>&nbsp;<span class="builtintype" id="5458401">byte</span><span class="op" id="5458405">(</span><span class="ident" id="5458406">v</span>&nbsp;<span class="op" id="5458408">&gt;&gt;</span>&nbsp;<span class="num" id="5458411">16</span><span class="op" id="5458413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458418">dst</span><span class="op" id="5458421">[</span><span class="ident" id="5458422">ndst</span><span class="op" id="5458426">+</span><span class="num" id="5458427">2</span><span class="op" id="5458428">]</span>&nbsp;<span class="op" id="5458430">=</span>&nbsp;<span class="builtintype" id="5458432">byte</span><span class="op" id="5458436">(</span><span class="ident" id="5458437">v</span>&nbsp;<span class="op" id="5458439">&gt;&gt;</span>&nbsp;<span class="num" id="5458442">8</span><span class="op" id="5458443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458448">dst</span><span class="op" id="5458451">[</span><span class="ident" id="5458452">ndst</span><span class="op" id="5458456">+</span><span class="num" id="5458457">3</span><span class="op" id="5458458">]</span>&nbsp;<span class="op" id="5458460">=</span>&nbsp;<span class="builtintype" id="5458462">byte</span><span class="op" id="5458466">(</span><span class="ident" id="5458467">v</span><span class="op" id="5458468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458473">ndst</span>&nbsp;<span class="op" id="5458478">+=</span>&nbsp;<span class="num" id="5458481">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458486">nb</span>&nbsp;<span class="op" id="5458489">=</span>&nbsp;<span class="num" id="5458491">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458496">v</span>&nbsp;<span class="op" id="5458498">=</span>&nbsp;<span class="num" id="5458500">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458510">if</span>&nbsp;<span class="ident" id="5458513">flush</span>&nbsp;<span class="op" id="5458519">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458523">nsrc</span>&nbsp;<span class="op" id="5458528">=</span>&nbsp;<span class="builtinfunc" id="5458530">len</span><span class="op" id="5458533">(</span><span class="ident" id="5458534">src</span><span class="op" id="5458537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458541">if</span>&nbsp;<span class="ident" id="5458544">nb</span>&nbsp;<span class="op" id="5458547">&gt;</span>&nbsp;<span class="num" id="5458549">0</span>&nbsp;<span class="op" id="5458551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458556">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458610">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458659">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458710">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458764">if</span>&nbsp;<span class="ident" id="5458767">nb</span>&nbsp;<span class="op" id="5458770">==</span>&nbsp;<span class="num" id="5458773">1</span>&nbsp;<span class="op" id="5458775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458781">return</span>&nbsp;<span class="num" id="5458788">0</span><span class="op" id="5458789">,</span>&nbsp;<span class="num" id="5458791">0</span><span class="op" id="5458792">,</span>&nbsp;<span class="ident" id="5458794">CorruptInputError</span><span class="op" id="5458811">(</span><span class="builtinfunc" id="5458812">len</span><span class="op" id="5458815">(</span><span class="ident" id="5458816">src</span><span class="op" id="5458819">)</span><span class="op" id="5458820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458830">for</span>&nbsp;<span class="ident" id="5458834">i</span>&nbsp;<span class="op" id="5458836">:=</span>&nbsp;<span class="ident" id="5458839">nb</span><span class="op" id="5458841">;</span>&nbsp;<span class="ident" id="5458843">i</span>&nbsp;<span class="op" id="5458845">&lt;</span>&nbsp;<span class="num" id="5458847">5</span><span class="op" id="5458848">;</span>&nbsp;<span class="ident" id="5458850">i</span><span class="op" id="5458851">++</span>&nbsp;<span class="op" id="5458854">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458860">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458914">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458972">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459029">v</span>&nbsp;<span class="op" id="5459031">=</span>&nbsp;<span class="ident" id="5459033">v</span><span class="op" id="5459034">*</span><span class="num" id="5459035">85</span>&nbsp;<span class="op" id="5459038">+</span>&nbsp;<span class="num" id="5459040">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459046">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459051">for</span>&nbsp;<span class="ident" id="5459055">i</span>&nbsp;<span class="op" id="5459057">:=</span>&nbsp;<span class="num" id="5459060">0</span><span class="op" id="5459061">;</span>&nbsp;<span class="ident" id="5459063">i</span>&nbsp;<span class="op" id="5459065">&lt;</span>&nbsp;<span class="ident" id="5459067">nb</span><span class="op" id="5459069">-</span><span class="num" id="5459070">1</span><span class="op" id="5459071">;</span>&nbsp;<span class="ident" id="5459073">i</span><span class="op" id="5459074">++</span>&nbsp;<span class="op" id="5459077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459083">dst</span><span class="op" id="5459086">[</span><span class="ident" id="5459087">ndst</span><span class="op" id="5459091">]</span>&nbsp;<span class="op" id="5459093">=</span>&nbsp;<span class="builtintype" id="5459095">byte</span><span class="op" id="5459099">(</span><span class="ident" id="5459100">v</span>&nbsp;<span class="op" id="5459102">&gt;&gt;</span>&nbsp;<span class="num" id="5459105">24</span><span class="op" id="5459107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459113">v</span>&nbsp;<span class="op" id="5459115">&lt;&lt;=</span>&nbsp;<span class="num" id="5459119">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459125">ndst</span><span class="op" id="5459129">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459135">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459145">return</span><br>
<span class="lineno"></span><span class="op" id="5459152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5459155">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5459210">func</span>&nbsp;<span class="ident" id="5459215">NewDecoder</span><span class="op" id="5459225">(</span><span class="ident" id="5459226">r</span>&nbsp;<span class="ident" id="5459228">io</span><span class="op" id="5459230">.</span><span class="ident" id="5459231">Reader</span><span class="op" id="5459237">)</span>&nbsp;<span class="ident" id="5459239">io</span><span class="op" id="5459241">.</span><span class="ident" id="5459242">Reader</span>&nbsp;<span class="op" id="5459249">{</span>&nbsp;<span class="keyword" id="5459251">return</span>&nbsp;<span class="op" id="5459258">&amp;</span><span class="ident" id="5459259">decoder</span><span class="op" id="5459266">{</span><span class="ident" id="5459267">r</span><span class="op" id="5459268">:</span>&nbsp;<span class="ident" id="5459270">r</span><span class="op" id="5459271">}</span>&nbsp;<span class="op" id="5459273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5459276">type</span>&nbsp;<span class="ident" id="5459281">decoder</span>&nbsp;<span class="keyword" id="5459289">struct</span>&nbsp;<span class="op" id="5459296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459299">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459307">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459314">readErr</span>&nbsp;<span class="builtintype" id="5459322">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459329">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459337">io</span><span class="op" id="5459339">.</span><span class="ident" id="5459340">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459348">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459356">[</span><span class="num" id="5459357">1024</span><span class="op" id="5459361">]</span><span class="builtintype" id="5459362">byte</span>&nbsp;<span class="comment" id="5459367">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459386">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459394">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459399">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459407">[</span><span class="op" id="5459408">]</span><span class="builtintype" id="5459409">byte</span>&nbsp;<span class="comment" id="5459414">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459442">outbuf</span>&nbsp;&nbsp;<span class="op" id="5459450">[</span><span class="num" id="5459451">1024</span><span class="op" id="5459455">]</span><span class="builtintype" id="5459456">byte</span><br>
<span class="lineno"></span><span class="op" id="5459461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5459464">func</span>&nbsp;<span class="op" id="5459469">(</span><span class="ident" id="5459470">d</span>&nbsp;<span class="op" id="5459472">*</span><span class="ident" id="5459473">decoder</span><span class="op" id="5459480">)</span>&nbsp;<span class="ident" id="5459482">Read</span><span class="op" id="5459486">(</span><span class="ident" id="5459487">p</span>&nbsp;<span class="op" id="5459489">[</span><span class="op" id="5459490">]</span><span class="builtintype" id="5459491">byte</span><span class="op" id="5459495">)</span>&nbsp;<span class="op" id="5459497">(</span><span class="ident" id="5459498">n</span>&nbsp;<span class="builtintype" id="5459500">int</span><span class="op" id="5459503">,</span>&nbsp;<span class="ident" id="5459505">err</span>&nbsp;<span class="builtintype" id="5459509">error</span><span class="op" id="5459514">)</span>&nbsp;<span class="op" id="5459516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459519">if</span>&nbsp;<span class="builtinfunc" id="5459522">len</span><span class="op" id="5459525">(</span><span class="ident" id="5459526">p</span><span class="op" id="5459527">)</span>&nbsp;<span class="op" id="5459529">==</span>&nbsp;<span class="num" id="5459532">0</span>&nbsp;<span class="op" id="5459534">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459538">return</span>&nbsp;<span class="num" id="5459545">0</span><span class="op" id="5459546">,</span>&nbsp;<span class="builtintype" id="5459548">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459556">if</span>&nbsp;<span class="ident" id="5459559">d</span><span class="op" id="5459560">.</span><span class="ident" id="5459561">err</span>&nbsp;<span class="op" id="5459565">!=</span>&nbsp;<span class="builtintype" id="5459568">nil</span>&nbsp;<span class="op" id="5459572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459576">return</span>&nbsp;<span class="num" id="5459583">0</span><span class="op" id="5459584">,</span>&nbsp;<span class="ident" id="5459586">d</span><span class="op" id="5459587">.</span><span class="ident" id="5459588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459593">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459597">for</span>&nbsp;<span class="op" id="5459601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459605">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459649">if</span>&nbsp;<span class="builtinfunc" id="5459652">len</span><span class="op" id="5459655">(</span><span class="ident" id="5459656">d</span><span class="op" id="5459657">.</span><span class="ident" id="5459658">out</span><span class="op" id="5459661">)</span>&nbsp;<span class="op" id="5459663">&gt;</span>&nbsp;<span class="num" id="5459665">0</span>&nbsp;<span class="op" id="5459667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459672">n</span>&nbsp;<span class="op" id="5459674">=</span>&nbsp;<span class="builtinfunc" id="5459676">copy</span><span class="op" id="5459680">(</span><span class="ident" id="5459681">p</span><span class="op" id="5459682">,</span>&nbsp;<span class="ident" id="5459684">d</span><span class="op" id="5459685">.</span><span class="ident" id="5459686">out</span><span class="op" id="5459689">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459694">d</span><span class="op" id="5459695">.</span><span class="ident" id="5459696">out</span>&nbsp;<span class="op" id="5459700">=</span>&nbsp;<span class="ident" id="5459702">d</span><span class="op" id="5459703">.</span><span class="ident" id="5459704">out</span><span class="op" id="5459707">[</span><span class="ident" id="5459708">n</span><span class="op" id="5459709">:</span><span class="op" id="5459710">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459715">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459729">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459772">var</span>&nbsp;<span class="ident" id="5459776">nn</span><span class="op" id="5459778">,</span>&nbsp;<span class="ident" id="5459780">nsrc</span><span class="op" id="5459784">,</span>&nbsp;<span class="ident" id="5459786">ndst</span>&nbsp;<span class="builtintype" id="5459791">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459797">if</span>&nbsp;<span class="ident" id="5459800">d</span><span class="op" id="5459801">.</span><span class="ident" id="5459802">nbuf</span>&nbsp;<span class="op" id="5459807">&gt;</span>&nbsp;<span class="num" id="5459809">0</span>&nbsp;<span class="op" id="5459811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459816">ndst</span><span class="op" id="5459820">,</span>&nbsp;<span class="ident" id="5459822">nsrc</span><span class="op" id="5459826">,</span>&nbsp;<span class="ident" id="5459828">d</span><span class="op" id="5459829">.</span><span class="ident" id="5459830">err</span>&nbsp;<span class="op" id="5459834">=</span>&nbsp;<span class="ident" id="5459836">Decode</span><span class="op" id="5459842">(</span><span class="ident" id="5459843">d</span><span class="op" id="5459844">.</span><span class="ident" id="5459845">outbuf</span><span class="op" id="5459851">[</span><span class="num" id="5459852">0</span><span class="op" id="5459853">:</span><span class="op" id="5459854">]</span><span class="op" id="5459855">,</span>&nbsp;<span class="ident" id="5459857">d</span><span class="op" id="5459858">.</span><span class="ident" id="5459859">buf</span><span class="op" id="5459862">[</span><span class="num" id="5459863">0</span><span class="op" id="5459864">:</span><span class="ident" id="5459865">d</span><span class="op" id="5459866">.</span><span class="ident" id="5459867">nbuf</span><span class="op" id="5459871">]</span><span class="op" id="5459872">,</span>&nbsp;<span class="ident" id="5459874">d</span><span class="op" id="5459875">.</span><span class="ident" id="5459876">readErr</span>&nbsp;<span class="op" id="5459884">!=</span>&nbsp;<span class="builtintype" id="5459887">nil</span><span class="op" id="5459890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459895">if</span>&nbsp;<span class="ident" id="5459898">ndst</span>&nbsp;<span class="op" id="5459903">&gt;</span>&nbsp;<span class="num" id="5459905">0</span>&nbsp;<span class="op" id="5459907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459913">d</span><span class="op" id="5459914">.</span><span class="ident" id="5459915">out</span>&nbsp;<span class="op" id="5459919">=</span>&nbsp;<span class="ident" id="5459921">d</span><span class="op" id="5459922">.</span><span class="ident" id="5459923">outbuf</span><span class="op" id="5459929">[</span><span class="num" id="5459930">0</span><span class="op" id="5459931">:</span><span class="ident" id="5459932">ndst</span><span class="op" id="5459936">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459942">d</span><span class="op" id="5459943">.</span><span class="ident" id="5459944">nbuf</span>&nbsp;<span class="op" id="5459949">=</span>&nbsp;<span class="builtinfunc" id="5459951">copy</span><span class="op" id="5459955">(</span><span class="ident" id="5459956">d</span><span class="op" id="5459957">.</span><span class="ident" id="5459958">buf</span><span class="op" id="5459961">[</span><span class="num" id="5459962">0</span><span class="op" id="5459963">:</span><span class="op" id="5459964">]</span><span class="op" id="5459965">,</span>&nbsp;<span class="ident" id="5459967">d</span><span class="op" id="5459968">.</span><span class="ident" id="5459969">buf</span><span class="op" id="5459972">[</span><span class="ident" id="5459973">nsrc</span><span class="op" id="5459977">:</span><span class="ident" id="5459978">d</span><span class="op" id="5459979">.</span><span class="ident" id="5459980">nbuf</span><span class="op" id="5459984">]</span><span class="op" id="5459985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459991">continue</span>&nbsp;<span class="comment" id="5460000">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460031">if</span>&nbsp;<span class="ident" id="5460034">ndst</span>&nbsp;<span class="op" id="5460039">==</span>&nbsp;<span class="num" id="5460042">0</span>&nbsp;<span class="op" id="5460044">&amp;&amp;</span>&nbsp;<span class="ident" id="5460047">d</span><span class="op" id="5460048">.</span><span class="ident" id="5460049">err</span>&nbsp;<span class="op" id="5460053">==</span>&nbsp;<span class="builtintype" id="5460056">nil</span>&nbsp;<span class="op" id="5460060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460066">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460138">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460196">off</span>&nbsp;<span class="op" id="5460200">:=</span>&nbsp;<span class="num" id="5460203">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460209">for</span>&nbsp;<span class="ident" id="5460213">i</span>&nbsp;<span class="op" id="5460215">:=</span>&nbsp;<span class="num" id="5460218">0</span><span class="op" id="5460219">;</span>&nbsp;<span class="ident" id="5460221">i</span>&nbsp;<span class="op" id="5460223">&lt;</span>&nbsp;<span class="ident" id="5460225">d</span><span class="op" id="5460226">.</span><span class="ident" id="5460227">nbuf</span><span class="op" id="5460231">;</span>&nbsp;<span class="ident" id="5460233">i</span><span class="op" id="5460234">++</span>&nbsp;<span class="op" id="5460237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460244">if</span>&nbsp;<span class="ident" id="5460247">d</span><span class="op" id="5460248">.</span><span class="ident" id="5460249">buf</span><span class="op" id="5460252">[</span><span class="ident" id="5460253">i</span><span class="op" id="5460254">]</span>&nbsp;<span class="op" id="5460256">&gt;</span>&nbsp;<span class="string" id="5460258">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5460262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460270">d</span><span class="op" id="5460271">.</span><span class="ident" id="5460272">buf</span><span class="op" id="5460275">[</span><span class="ident" id="5460276">off</span><span class="op" id="5460279">]</span>&nbsp;<span class="op" id="5460281">=</span>&nbsp;<span class="ident" id="5460283">d</span><span class="op" id="5460284">.</span><span class="ident" id="5460285">buf</span><span class="op" id="5460288">[</span><span class="ident" id="5460289">i</span><span class="op" id="5460290">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460298">off</span><span class="op" id="5460301">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460321">d</span><span class="op" id="5460322">.</span><span class="ident" id="5460323">nbuf</span>&nbsp;<span class="op" id="5460328">=</span>&nbsp;<span class="ident" id="5460330">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460337">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460346">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460403">if</span>&nbsp;<span class="ident" id="5460406">d</span><span class="op" id="5460407">.</span><span class="ident" id="5460408">err</span>&nbsp;<span class="op" id="5460412">!=</span>&nbsp;<span class="builtintype" id="5460415">nil</span>&nbsp;<span class="op" id="5460419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460424">return</span>&nbsp;<span class="num" id="5460431">0</span><span class="op" id="5460432">,</span>&nbsp;<span class="ident" id="5460434">d</span><span class="op" id="5460435">.</span><span class="ident" id="5460436">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460446">if</span>&nbsp;<span class="ident" id="5460449">d</span><span class="op" id="5460450">.</span><span class="ident" id="5460451">readErr</span>&nbsp;<span class="op" id="5460459">!=</span>&nbsp;<span class="builtintype" id="5460462">nil</span>&nbsp;<span class="op" id="5460466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460471">d</span><span class="op" id="5460472">.</span><span class="ident" id="5460473">err</span>&nbsp;<span class="op" id="5460477">=</span>&nbsp;<span class="ident" id="5460479">d</span><span class="op" id="5460480">.</span><span class="ident" id="5460481">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460492">return</span>&nbsp;<span class="num" id="5460499">0</span><span class="op" id="5460500">,</span>&nbsp;<span class="ident" id="5460502">d</span><span class="op" id="5460503">.</span><span class="ident" id="5460504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460510">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460515">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460536">nn</span><span class="op" id="5460538">,</span>&nbsp;<span class="ident" id="5460540">d</span><span class="op" id="5460541">.</span><span class="ident" id="5460542">readErr</span>&nbsp;<span class="op" id="5460550">=</span>&nbsp;<span class="ident" id="5460552">d</span><span class="op" id="5460553">.</span><span class="ident" id="5460554">r</span><span class="op" id="5460555">.</span><span class="ident" id="5460556">Read</span><span class="op" id="5460560">(</span><span class="ident" id="5460561">d</span><span class="op" id="5460562">.</span><span class="ident" id="5460563">buf</span><span class="op" id="5460566">[</span><span class="ident" id="5460567">d</span><span class="op" id="5460568">.</span><span class="ident" id="5460569">nbuf</span><span class="op" id="5460573">:</span><span class="op" id="5460574">]</span><span class="op" id="5460575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460579">d</span><span class="op" id="5460580">.</span><span class="ident" id="5460581">nbuf</span>&nbsp;<span class="op" id="5460586">+=</span>&nbsp;<span class="ident" id="5460589">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460593">}</span><br>
<span class="lineno">310</span><span class="op" id="5460595">}</span>
</div>
</body>
</html>
