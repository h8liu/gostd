<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5310613">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5310668">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5310722">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5310773">package</span>&nbsp;<span class="ident" id="5310781">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5310786">import</span>&nbsp;<span class="op" id="5310793">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5310796">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5310808">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5310815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5310818">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5310898">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5310919">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5310991">func</span>&nbsp;<span class="ident" id="5310996">exportFilter</span><span class="op" id="5311008">(</span><span class="ident" id="5311009">name</span>&nbsp;<span class="builtintype" id="5311014">string</span><span class="op" id="5311020">)</span>&nbsp;<span class="builtintype" id="5311022">bool</span>&nbsp;<span class="op" id="5311027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311030">return</span>&nbsp;<span class="ident" id="5311037">IsExported</span><span class="op" id="5311047">(</span><span class="ident" id="5311048">name</span><span class="op" id="5311052">)</span><br>
<span class="lineno"></span><span class="op" id="5311054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5311057">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5311126">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5311206">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="5311284">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5311360">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="5311412">//</span><br>
<span class="lineno"></span><span class="comment" id="5311415">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5311479">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5311510">//</span><br>
<span class="lineno"></span><span class="keyword" id="5311513">func</span>&nbsp;<span class="ident" id="5311518">FileExports</span><span class="op" id="5311529">(</span><span class="ident" id="5311530">src</span>&nbsp;<span class="op" id="5311534">*</span><span class="ident" id="5311535">File</span><span class="op" id="5311539">)</span>&nbsp;<span class="builtintype" id="5311541">bool</span>&nbsp;<span class="op" id="5311546">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311549">return</span>&nbsp;<span class="ident" id="5311556">filterFile</span><span class="op" id="5311566">(</span><span class="ident" id="5311567">src</span><span class="op" id="5311570">,</span>&nbsp;<span class="ident" id="5311572">exportFilter</span><span class="op" id="5311584">,</span>&nbsp;<span class="builtintype" id="5311586">true</span><span class="op" id="5311590">)</span><br>
<span class="lineno"></span><span class="op" id="5311592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5311595">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5311663">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="5311737">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5311798">//</span><br>
<span class="lineno"></span><span class="comment" id="5311801">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5311868">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5311899">//</span><br>
<span class="lineno">40</span><span class="keyword" id="5311902">func</span>&nbsp;<span class="ident" id="5311907">PackageExports</span><span class="op" id="5311921">(</span><span class="ident" id="5311922">pkg</span>&nbsp;<span class="op" id="5311926">*</span><span class="ident" id="5311927">Package</span><span class="op" id="5311934">)</span>&nbsp;<span class="builtintype" id="5311936">bool</span>&nbsp;<span class="op" id="5311941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311944">return</span>&nbsp;<span class="ident" id="5311951">filterPackage</span><span class="op" id="5311964">(</span><span class="ident" id="5311965">pkg</span><span class="op" id="5311968">,</span>&nbsp;<span class="ident" id="5311970">exportFilter</span><span class="op" id="5311982">,</span>&nbsp;<span class="builtintype" id="5311984">true</span><span class="op" id="5311988">)</span><br>
<span class="lineno"></span><span class="op" id="5311990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5311993">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="5312073">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312095">type</span>&nbsp;<span class="ident" id="5312100">Filter</span>&nbsp;<span class="keyword" id="5312107">func</span><span class="op" id="5312111">(</span><span class="builtintype" id="5312112">string</span><span class="op" id="5312118">)</span>&nbsp;<span class="builtintype" id="5312120">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312126">func</span>&nbsp;<span class="ident" id="5312131">filterIdentList</span><span class="op" id="5312146">(</span><span class="ident" id="5312147">list</span>&nbsp;<span class="op" id="5312152">[</span><span class="op" id="5312153">]</span><span class="op" id="5312154">*</span><span class="ident" id="5312155">Ident</span><span class="op" id="5312160">,</span>&nbsp;<span class="ident" id="5312162">f</span>&nbsp;<span class="ident" id="5312164">Filter</span><span class="op" id="5312170">)</span>&nbsp;<span class="op" id="5312172">[</span><span class="op" id="5312173">]</span><span class="op" id="5312174">*</span><span class="ident" id="5312175">Ident</span>&nbsp;<span class="op" id="5312181">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312184">j</span>&nbsp;<span class="op" id="5312186">:=</span>&nbsp;<span class="num" id="5312189">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312192">for</span>&nbsp;<span class="ident" id="5312196">_</span><span class="op" id="5312197">,</span>&nbsp;<span class="ident" id="5312199">x</span>&nbsp;<span class="op" id="5312201">:=</span>&nbsp;<span class="keyword" id="5312204">range</span>&nbsp;<span class="ident" id="5312210">list</span>&nbsp;<span class="op" id="5312215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312219">if</span>&nbsp;<span class="ident" id="5312222">f</span><span class="op" id="5312223">(</span><span class="ident" id="5312224">x</span><span class="op" id="5312225">.</span><span class="ident" id="5312226">Name</span><span class="op" id="5312230">)</span>&nbsp;<span class="op" id="5312232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312237">list</span><span class="op" id="5312241">[</span><span class="ident" id="5312242">j</span><span class="op" id="5312243">]</span>&nbsp;<span class="op" id="5312245">=</span>&nbsp;<span class="ident" id="5312247">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312252">j</span><span class="op" id="5312253">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312264">return</span>&nbsp;<span class="ident" id="5312271">list</span><span class="op" id="5312275">[</span><span class="num" id="5312276">0</span><span class="op" id="5312277">:</span><span class="ident" id="5312278">j</span><span class="op" id="5312279">]</span><br>
<span class="lineno"></span><span class="op" id="5312281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5312284">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5312350">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="5312417">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5312456">//</span><br>
<span class="lineno"></span><span class="keyword" id="5312459">func</span>&nbsp;<span class="ident" id="5312464">fieldName</span><span class="op" id="5312473">(</span><span class="ident" id="5312474">x</span>&nbsp;<span class="ident" id="5312476">Expr</span><span class="op" id="5312480">)</span>&nbsp;<span class="op" id="5312482">*</span><span class="ident" id="5312483">Ident</span>&nbsp;<span class="op" id="5312489">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312492">switch</span>&nbsp;<span class="ident" id="5312499">t</span>&nbsp;<span class="op" id="5312501">:=</span>&nbsp;<span class="ident" id="5312504">x</span><span class="op" id="5312505">.</span><span class="op" id="5312506">(</span><span class="keyword" id="5312507">type</span><span class="op" id="5312511">)</span>&nbsp;<span class="op" id="5312513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312516">case</span>&nbsp;<span class="op" id="5312521">*</span><span class="ident" id="5312522">Ident</span><span class="op" id="5312527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312531">return</span>&nbsp;<span class="ident" id="5312538">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312541">case</span>&nbsp;<span class="op" id="5312546">*</span><span class="ident" id="5312547">SelectorExpr</span><span class="op" id="5312559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312563">if</span>&nbsp;<span class="ident" id="5312566">_</span><span class="op" id="5312567">,</span>&nbsp;<span class="ident" id="5312569">ok</span>&nbsp;<span class="op" id="5312572">:=</span>&nbsp;<span class="ident" id="5312575">t</span><span class="op" id="5312576">.</span><span class="ident" id="5312577">X</span><span class="op" id="5312578">.</span><span class="op" id="5312579">(</span><span class="op" id="5312580">*</span><span class="ident" id="5312581">Ident</span><span class="op" id="5312586">)</span><span class="op" id="5312587">;</span>&nbsp;<span class="ident" id="5312589">ok</span>&nbsp;<span class="op" id="5312592">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312597">return</span>&nbsp;<span class="ident" id="5312604">t</span><span class="op" id="5312605">.</span><span class="ident" id="5312606">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312615">case</span>&nbsp;<span class="op" id="5312620">*</span><span class="ident" id="5312621">StarExpr</span><span class="op" id="5312629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312633">return</span>&nbsp;<span class="ident" id="5312640">fieldName</span><span class="op" id="5312649">(</span><span class="ident" id="5312650">t</span><span class="op" id="5312651">.</span><span class="ident" id="5312652">X</span><span class="op" id="5312653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312656">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312659">return</span>&nbsp;<span class="ident" id="5312666">nil</span><br>
<span class="lineno"></span><span class="op" id="5312670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312673">func</span>&nbsp;<span class="ident" id="5312678">filterFieldList</span><span class="op" id="5312693">(</span><span class="ident" id="5312694">fields</span>&nbsp;<span class="op" id="5312701">*</span><span class="ident" id="5312702">FieldList</span><span class="op" id="5312711">,</span>&nbsp;<span class="ident" id="5312713">filter</span>&nbsp;<span class="ident" id="5312720">Filter</span><span class="op" id="5312726">,</span>&nbsp;<span class="ident" id="5312728">export</span>&nbsp;<span class="builtintype" id="5312735">bool</span><span class="op" id="5312739">)</span>&nbsp;<span class="op" id="5312741">(</span><span class="ident" id="5312742">removedFields</span>&nbsp;<span class="builtintype" id="5312756">bool</span><span class="op" id="5312760">)</span>&nbsp;<span class="op" id="5312762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312765">if</span>&nbsp;<span class="ident" id="5312768">fields</span>&nbsp;<span class="op" id="5312775">==</span>&nbsp;<span class="ident" id="5312778">nil</span>&nbsp;<span class="op" id="5312782">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312786">return</span>&nbsp;<span class="builtintype" id="5312793">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312803">list</span>&nbsp;<span class="op" id="5312808">:=</span>&nbsp;<span class="ident" id="5312811">fields</span><span class="op" id="5312817">.</span><span class="ident" id="5312818">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312824">j</span>&nbsp;<span class="op" id="5312826">:=</span>&nbsp;<span class="num" id="5312829">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312832">for</span>&nbsp;<span class="ident" id="5312836">_</span><span class="op" id="5312837">,</span>&nbsp;<span class="ident" id="5312839">f</span>&nbsp;<span class="op" id="5312841">:=</span>&nbsp;<span class="keyword" id="5312844">range</span>&nbsp;<span class="ident" id="5312850">list</span>&nbsp;<span class="op" id="5312855">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312859">keepField</span>&nbsp;<span class="op" id="5312869">:=</span>&nbsp;<span class="builtintype" id="5312872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312880">if</span>&nbsp;<span class="builtinfunc" id="5312883">len</span><span class="op" id="5312886">(</span><span class="ident" id="5312887">f</span><span class="op" id="5312888">.</span><span class="ident" id="5312889">Names</span><span class="op" id="5312894">)</span>&nbsp;<span class="op" id="5312896">==</span>&nbsp;<span class="num" id="5312899">0</span>&nbsp;<span class="op" id="5312901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312906">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312928">name</span>&nbsp;<span class="op" id="5312933">:=</span>&nbsp;<span class="ident" id="5312936">fieldName</span><span class="op" id="5312945">(</span><span class="ident" id="5312946">f</span><span class="op" id="5312947">.</span><span class="ident" id="5312948">Type</span><span class="op" id="5312952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312957">keepField</span>&nbsp;<span class="op" id="5312967">=</span>&nbsp;<span class="ident" id="5312969">name</span>&nbsp;<span class="op" id="5312974">!=</span>&nbsp;<span class="ident" id="5312977">nil</span>&nbsp;<span class="op" id="5312981">&amp;&amp;</span>&nbsp;<span class="ident" id="5312984">filter</span><span class="op" id="5312990">(</span><span class="ident" id="5312991">name</span><span class="op" id="5312995">.</span><span class="ident" id="5312996">Name</span><span class="op" id="5313000">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313004">}</span>&nbsp;<span class="keyword" id="5313006">else</span>&nbsp;<span class="op" id="5313011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313016">n</span>&nbsp;<span class="op" id="5313018">:=</span>&nbsp;<span class="builtinfunc" id="5313021">len</span><span class="op" id="5313024">(</span><span class="ident" id="5313025">f</span><span class="op" id="5313026">.</span><span class="ident" id="5313027">Names</span><span class="op" id="5313032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313037">f</span><span class="op" id="5313038">.</span><span class="ident" id="5313039">Names</span>&nbsp;<span class="op" id="5313045">=</span>&nbsp;<span class="ident" id="5313047">filterIdentList</span><span class="op" id="5313062">(</span><span class="ident" id="5313063">f</span><span class="op" id="5313064">.</span><span class="ident" id="5313065">Names</span><span class="op" id="5313070">,</span>&nbsp;<span class="ident" id="5313072">filter</span><span class="op" id="5313078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313083">if</span>&nbsp;<span class="builtinfunc" id="5313086">len</span><span class="op" id="5313089">(</span><span class="ident" id="5313090">f</span><span class="op" id="5313091">.</span><span class="ident" id="5313092">Names</span><span class="op" id="5313097">)</span>&nbsp;<span class="op" id="5313099">&lt;</span>&nbsp;<span class="ident" id="5313101">n</span>&nbsp;<span class="op" id="5313103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313109">removedFields</span>&nbsp;<span class="op" id="5313123">=</span>&nbsp;<span class="builtintype" id="5313125">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313138">keepField</span>&nbsp;<span class="op" id="5313148">=</span>&nbsp;<span class="builtinfunc" id="5313150">len</span><span class="op" id="5313153">(</span><span class="ident" id="5313154">f</span><span class="op" id="5313155">.</span><span class="ident" id="5313156">Names</span><span class="op" id="5313161">)</span>&nbsp;<span class="op" id="5313163">&gt;</span>&nbsp;<span class="num" id="5313165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313173">if</span>&nbsp;<span class="ident" id="5313176">keepField</span>&nbsp;<span class="op" id="5313186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313191">if</span>&nbsp;<span class="ident" id="5313194">export</span>&nbsp;<span class="op" id="5313201">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313207">filterType</span><span class="op" id="5313217">(</span><span class="ident" id="5313218">f</span><span class="op" id="5313219">.</span><span class="ident" id="5313220">Type</span><span class="op" id="5313224">,</span>&nbsp;<span class="ident" id="5313226">filter</span><span class="op" id="5313232">,</span>&nbsp;<span class="ident" id="5313234">export</span><span class="op" id="5313240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313250">list</span><span class="op" id="5313254">[</span><span class="ident" id="5313255">j</span><span class="op" id="5313256">]</span>&nbsp;<span class="op" id="5313258">=</span>&nbsp;<span class="ident" id="5313260">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313265">j</span><span class="op" id="5313266">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313271">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313277">if</span>&nbsp;<span class="ident" id="5313280">j</span>&nbsp;<span class="op" id="5313282">&lt;</span>&nbsp;<span class="builtinfunc" id="5313284">len</span><span class="op" id="5313287">(</span><span class="ident" id="5313288">list</span><span class="op" id="5313292">)</span>&nbsp;<span class="op" id="5313294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313298">removedFields</span>&nbsp;<span class="op" id="5313312">=</span>&nbsp;<span class="builtintype" id="5313314">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313323">fields</span><span class="op" id="5313329">.</span><span class="ident" id="5313330">List</span>&nbsp;<span class="op" id="5313335">=</span>&nbsp;<span class="ident" id="5313337">list</span><span class="op" id="5313341">[</span><span class="num" id="5313342">0</span><span class="op" id="5313343">:</span><span class="ident" id="5313344">j</span><span class="op" id="5313345">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313348">return</span><br>
<span class="lineno"></span><span class="op" id="5313355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5313358">func</span>&nbsp;<span class="ident" id="5313363">filterParamList</span><span class="op" id="5313378">(</span><span class="ident" id="5313379">fields</span>&nbsp;<span class="op" id="5313386">*</span><span class="ident" id="5313387">FieldList</span><span class="op" id="5313396">,</span>&nbsp;<span class="ident" id="5313398">filter</span>&nbsp;<span class="ident" id="5313405">Filter</span><span class="op" id="5313411">,</span>&nbsp;<span class="ident" id="5313413">export</span>&nbsp;<span class="builtintype" id="5313420">bool</span><span class="op" id="5313424">)</span>&nbsp;<span class="builtintype" id="5313426">bool</span>&nbsp;<span class="op" id="5313431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313434">if</span>&nbsp;<span class="ident" id="5313437">fields</span>&nbsp;<span class="op" id="5313444">==</span>&nbsp;<span class="ident" id="5313447">nil</span>&nbsp;<span class="op" id="5313451">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313455">return</span>&nbsp;<span class="builtintype" id="5313462">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313472">var</span>&nbsp;<span class="ident" id="5313476">b</span>&nbsp;<span class="builtintype" id="5313478">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313484">for</span>&nbsp;<span class="ident" id="5313488">_</span><span class="op" id="5313489">,</span>&nbsp;<span class="ident" id="5313491">f</span>&nbsp;<span class="op" id="5313493">:=</span>&nbsp;<span class="keyword" id="5313496">range</span>&nbsp;<span class="ident" id="5313502">fields</span><span class="op" id="5313508">.</span><span class="ident" id="5313509">List</span>&nbsp;<span class="op" id="5313514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313518">if</span>&nbsp;<span class="ident" id="5313521">filterType</span><span class="op" id="5313531">(</span><span class="ident" id="5313532">f</span><span class="op" id="5313533">.</span><span class="ident" id="5313534">Type</span><span class="op" id="5313538">,</span>&nbsp;<span class="ident" id="5313540">filter</span><span class="op" id="5313546">,</span>&nbsp;<span class="ident" id="5313548">export</span><span class="op" id="5313554">)</span>&nbsp;<span class="op" id="5313556">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313561">b</span>&nbsp;<span class="op" id="5313563">=</span>&nbsp;<span class="builtintype" id="5313565">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313578">return</span>&nbsp;<span class="ident" id="5313585">b</span><br>
<span class="lineno"></span><span class="op" id="5313587">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="5313590">func</span>&nbsp;<span class="ident" id="5313595">filterType</span><span class="op" id="5313605">(</span><span class="ident" id="5313606">typ</span>&nbsp;<span class="ident" id="5313610">Expr</span><span class="op" id="5313614">,</span>&nbsp;<span class="ident" id="5313616">f</span>&nbsp;<span class="ident" id="5313618">Filter</span><span class="op" id="5313624">,</span>&nbsp;<span class="ident" id="5313626">export</span>&nbsp;<span class="builtintype" id="5313633">bool</span><span class="op" id="5313637">)</span>&nbsp;<span class="builtintype" id="5313639">bool</span>&nbsp;<span class="op" id="5313644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313647">switch</span>&nbsp;<span class="ident" id="5313654">t</span>&nbsp;<span class="op" id="5313656">:=</span>&nbsp;<span class="ident" id="5313659">typ</span><span class="op" id="5313662">.</span><span class="op" id="5313663">(</span><span class="keyword" id="5313664">type</span><span class="op" id="5313668">)</span>&nbsp;<span class="op" id="5313670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313673">case</span>&nbsp;<span class="op" id="5313678">*</span><span class="ident" id="5313679">Ident</span><span class="op" id="5313684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313688">return</span>&nbsp;<span class="ident" id="5313695">f</span><span class="op" id="5313696">(</span><span class="ident" id="5313697">t</span><span class="op" id="5313698">.</span><span class="ident" id="5313699">Name</span><span class="op" id="5313703">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313706">case</span>&nbsp;<span class="op" id="5313711">*</span><span class="ident" id="5313712">ParenExpr</span><span class="op" id="5313721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313725">return</span>&nbsp;<span class="ident" id="5313732">filterType</span><span class="op" id="5313742">(</span><span class="ident" id="5313743">t</span><span class="op" id="5313744">.</span><span class="ident" id="5313745">X</span><span class="op" id="5313746">,</span>&nbsp;<span class="ident" id="5313748">f</span><span class="op" id="5313749">,</span>&nbsp;<span class="ident" id="5313751">export</span><span class="op" id="5313757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313760">case</span>&nbsp;<span class="op" id="5313765">*</span><span class="ident" id="5313766">ArrayType</span><span class="op" id="5313775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313779">return</span>&nbsp;<span class="ident" id="5313786">filterType</span><span class="op" id="5313796">(</span><span class="ident" id="5313797">t</span><span class="op" id="5313798">.</span><span class="ident" id="5313799">Elt</span><span class="op" id="5313802">,</span>&nbsp;<span class="ident" id="5313804">f</span><span class="op" id="5313805">,</span>&nbsp;<span class="ident" id="5313807">export</span><span class="op" id="5313813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313816">case</span>&nbsp;<span class="op" id="5313821">*</span><span class="ident" id="5313822">StructType</span><span class="op" id="5313832">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313836">if</span>&nbsp;<span class="ident" id="5313839">filterFieldList</span><span class="op" id="5313854">(</span><span class="ident" id="5313855">t</span><span class="op" id="5313856">.</span><span class="ident" id="5313857">Fields</span><span class="op" id="5313863">,</span>&nbsp;<span class="ident" id="5313865">f</span><span class="op" id="5313866">,</span>&nbsp;<span class="ident" id="5313868">export</span><span class="op" id="5313874">)</span>&nbsp;<span class="op" id="5313876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313881">t</span><span class="op" id="5313882">.</span><span class="ident" id="5313883">Incomplete</span>&nbsp;<span class="op" id="5313894">=</span>&nbsp;<span class="builtintype" id="5313896">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313907">return</span>&nbsp;<span class="builtinfunc" id="5313914">len</span><span class="op" id="5313917">(</span><span class="ident" id="5313918">t</span><span class="op" id="5313919">.</span><span class="ident" id="5313920">Fields</span><span class="op" id="5313926">.</span><span class="ident" id="5313927">List</span><span class="op" id="5313931">)</span>&nbsp;<span class="op" id="5313933">&gt;</span>&nbsp;<span class="num" id="5313935">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313938">case</span>&nbsp;<span class="op" id="5313943">*</span><span class="ident" id="5313944">FuncType</span><span class="op" id="5313952">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313956">b1</span>&nbsp;<span class="op" id="5313959">:=</span>&nbsp;<span class="ident" id="5313962">filterParamList</span><span class="op" id="5313977">(</span><span class="ident" id="5313978">t</span><span class="op" id="5313979">.</span><span class="ident" id="5313980">Params</span><span class="op" id="5313986">,</span>&nbsp;<span class="ident" id="5313988">f</span><span class="op" id="5313989">,</span>&nbsp;<span class="ident" id="5313991">export</span><span class="op" id="5313997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314001">b2</span>&nbsp;<span class="op" id="5314004">:=</span>&nbsp;<span class="ident" id="5314007">filterParamList</span><span class="op" id="5314022">(</span><span class="ident" id="5314023">t</span><span class="op" id="5314024">.</span><span class="ident" id="5314025">Results</span><span class="op" id="5314032">,</span>&nbsp;<span class="ident" id="5314034">f</span><span class="op" id="5314035">,</span>&nbsp;<span class="ident" id="5314037">export</span><span class="op" id="5314043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314047">return</span>&nbsp;<span class="ident" id="5314054">b1</span>&nbsp;<span class="op" id="5314057">||</span>&nbsp;<span class="ident" id="5314060">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314064">case</span>&nbsp;<span class="op" id="5314069">*</span><span class="ident" id="5314070">InterfaceType</span><span class="op" id="5314083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314087">if</span>&nbsp;<span class="ident" id="5314090">filterFieldList</span><span class="op" id="5314105">(</span><span class="ident" id="5314106">t</span><span class="op" id="5314107">.</span><span class="ident" id="5314108">Methods</span><span class="op" id="5314115">,</span>&nbsp;<span class="ident" id="5314117">f</span><span class="op" id="5314118">,</span>&nbsp;<span class="ident" id="5314120">export</span><span class="op" id="5314126">)</span>&nbsp;<span class="op" id="5314128">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314133">t</span><span class="op" id="5314134">.</span><span class="ident" id="5314135">Incomplete</span>&nbsp;<span class="op" id="5314146">=</span>&nbsp;<span class="builtintype" id="5314148">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314159">return</span>&nbsp;<span class="builtinfunc" id="5314166">len</span><span class="op" id="5314169">(</span><span class="ident" id="5314170">t</span><span class="op" id="5314171">.</span><span class="ident" id="5314172">Methods</span><span class="op" id="5314179">.</span><span class="ident" id="5314180">List</span><span class="op" id="5314184">)</span>&nbsp;<span class="op" id="5314186">&gt;</span>&nbsp;<span class="num" id="5314188">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314191">case</span>&nbsp;<span class="op" id="5314196">*</span><span class="ident" id="5314197">MapType</span><span class="op" id="5314204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314208">b1</span>&nbsp;<span class="op" id="5314211">:=</span>&nbsp;<span class="ident" id="5314214">filterType</span><span class="op" id="5314224">(</span><span class="ident" id="5314225">t</span><span class="op" id="5314226">.</span><span class="ident" id="5314227">Key</span><span class="op" id="5314230">,</span>&nbsp;<span class="ident" id="5314232">f</span><span class="op" id="5314233">,</span>&nbsp;<span class="ident" id="5314235">export</span><span class="op" id="5314241">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314245">b2</span>&nbsp;<span class="op" id="5314248">:=</span>&nbsp;<span class="ident" id="5314251">filterType</span><span class="op" id="5314261">(</span><span class="ident" id="5314262">t</span><span class="op" id="5314263">.</span><span class="ident" id="5314264">Value</span><span class="op" id="5314269">,</span>&nbsp;<span class="ident" id="5314271">f</span><span class="op" id="5314272">,</span>&nbsp;<span class="ident" id="5314274">export</span><span class="op" id="5314280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314284">return</span>&nbsp;<span class="ident" id="5314291">b1</span>&nbsp;<span class="op" id="5314294">||</span>&nbsp;<span class="ident" id="5314297">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314301">case</span>&nbsp;<span class="op" id="5314306">*</span><span class="ident" id="5314307">ChanType</span><span class="op" id="5314315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314319">return</span>&nbsp;<span class="ident" id="5314326">filterType</span><span class="op" id="5314336">(</span><span class="ident" id="5314337">t</span><span class="op" id="5314338">.</span><span class="ident" id="5314339">Value</span><span class="op" id="5314344">,</span>&nbsp;<span class="ident" id="5314346">f</span><span class="op" id="5314347">,</span>&nbsp;<span class="ident" id="5314349">export</span><span class="op" id="5314355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314358">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314361">return</span>&nbsp;<span class="builtintype" id="5314368">false</span><br>
<span class="lineno"></span><span class="op" id="5314374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5314377">func</span>&nbsp;<span class="ident" id="5314382">filterSpec</span><span class="op" id="5314392">(</span><span class="ident" id="5314393">spec</span>&nbsp;<span class="ident" id="5314398">Spec</span><span class="op" id="5314402">,</span>&nbsp;<span class="ident" id="5314404">f</span>&nbsp;<span class="ident" id="5314406">Filter</span><span class="op" id="5314412">,</span>&nbsp;<span class="ident" id="5314414">export</span>&nbsp;<span class="builtintype" id="5314421">bool</span><span class="op" id="5314425">)</span>&nbsp;<span class="builtintype" id="5314427">bool</span>&nbsp;<span class="op" id="5314432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314435">switch</span>&nbsp;<span class="ident" id="5314442">s</span>&nbsp;<span class="op" id="5314444">:=</span>&nbsp;<span class="ident" id="5314447">spec</span><span class="op" id="5314451">.</span><span class="op" id="5314452">(</span><span class="keyword" id="5314453">type</span><span class="op" id="5314457">)</span>&nbsp;<span class="op" id="5314459">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314462">case</span>&nbsp;<span class="op" id="5314467">*</span><span class="ident" id="5314468">ValueSpec</span><span class="op" id="5314477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314481">s</span><span class="op" id="5314482">.</span><span class="ident" id="5314483">Names</span>&nbsp;<span class="op" id="5314489">=</span>&nbsp;<span class="ident" id="5314491">filterIdentList</span><span class="op" id="5314506">(</span><span class="ident" id="5314507">s</span><span class="op" id="5314508">.</span><span class="ident" id="5314509">Names</span><span class="op" id="5314514">,</span>&nbsp;<span class="ident" id="5314516">f</span><span class="op" id="5314517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314521">if</span>&nbsp;<span class="builtinfunc" id="5314524">len</span><span class="op" id="5314527">(</span><span class="ident" id="5314528">s</span><span class="op" id="5314529">.</span><span class="ident" id="5314530">Names</span><span class="op" id="5314535">)</span>&nbsp;<span class="op" id="5314537">&gt;</span>&nbsp;<span class="num" id="5314539">0</span>&nbsp;<span class="op" id="5314541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314546">if</span>&nbsp;<span class="ident" id="5314549">export</span>&nbsp;<span class="op" id="5314556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314562">filterType</span><span class="op" id="5314572">(</span><span class="ident" id="5314573">s</span><span class="op" id="5314574">.</span><span class="ident" id="5314575">Type</span><span class="op" id="5314579">,</span>&nbsp;<span class="ident" id="5314581">f</span><span class="op" id="5314582">,</span>&nbsp;<span class="ident" id="5314584">export</span><span class="op" id="5314590">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314600">return</span>&nbsp;<span class="builtintype" id="5314607">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314617">case</span>&nbsp;<span class="op" id="5314622">*</span><span class="ident" id="5314623">TypeSpec</span><span class="op" id="5314631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314635">if</span>&nbsp;<span class="ident" id="5314638">f</span><span class="op" id="5314639">(</span><span class="ident" id="5314640">s</span><span class="op" id="5314641">.</span><span class="ident" id="5314642">Name</span><span class="op" id="5314646">.</span><span class="ident" id="5314647">Name</span><span class="op" id="5314651">)</span>&nbsp;<span class="op" id="5314653">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314658">if</span>&nbsp;<span class="ident" id="5314661">export</span>&nbsp;<span class="op" id="5314668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314674">filterType</span><span class="op" id="5314684">(</span><span class="ident" id="5314685">s</span><span class="op" id="5314686">.</span><span class="ident" id="5314687">Type</span><span class="op" id="5314691">,</span>&nbsp;<span class="ident" id="5314693">f</span><span class="op" id="5314694">,</span>&nbsp;<span class="ident" id="5314696">export</span><span class="op" id="5314702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314712">return</span>&nbsp;<span class="builtintype" id="5314719">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314726">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314730">if</span>&nbsp;<span class="op" id="5314733">!</span><span class="ident" id="5314734">export</span>&nbsp;<span class="op" id="5314741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314746">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314794">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314841">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314852">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314898">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314926">return</span>&nbsp;<span class="ident" id="5314933">filterType</span><span class="op" id="5314943">(</span><span class="ident" id="5314944">s</span><span class="op" id="5314945">.</span><span class="ident" id="5314946">Type</span><span class="op" id="5314950">,</span>&nbsp;<span class="ident" id="5314952">f</span><span class="op" id="5314953">,</span>&nbsp;<span class="ident" id="5314955">export</span><span class="op" id="5314961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314971">return</span>&nbsp;<span class="builtintype" id="5314978">false</span><br>
<span class="lineno">185</span><span class="op" id="5314984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5314987">func</span>&nbsp;<span class="ident" id="5314992">filterSpecList</span><span class="op" id="5315006">(</span><span class="ident" id="5315007">list</span>&nbsp;<span class="op" id="5315012">[</span><span class="op" id="5315013">]</span><span class="ident" id="5315014">Spec</span><span class="op" id="5315018">,</span>&nbsp;<span class="ident" id="5315020">f</span>&nbsp;<span class="ident" id="5315022">Filter</span><span class="op" id="5315028">,</span>&nbsp;<span class="ident" id="5315030">export</span>&nbsp;<span class="builtintype" id="5315037">bool</span><span class="op" id="5315041">)</span>&nbsp;<span class="op" id="5315043">[</span><span class="op" id="5315044">]</span><span class="ident" id="5315045">Spec</span>&nbsp;<span class="op" id="5315050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315053">j</span>&nbsp;<span class="op" id="5315055">:=</span>&nbsp;<span class="num" id="5315058">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315061">for</span>&nbsp;<span class="ident" id="5315065">_</span><span class="op" id="5315066">,</span>&nbsp;<span class="ident" id="5315068">s</span>&nbsp;<span class="op" id="5315070">:=</span>&nbsp;<span class="keyword" id="5315073">range</span>&nbsp;<span class="ident" id="5315079">list</span>&nbsp;<span class="op" id="5315084">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315088">if</span>&nbsp;<span class="ident" id="5315091">filterSpec</span><span class="op" id="5315101">(</span><span class="ident" id="5315102">s</span><span class="op" id="5315103">,</span>&nbsp;<span class="ident" id="5315105">f</span><span class="op" id="5315106">,</span>&nbsp;<span class="ident" id="5315108">export</span><span class="op" id="5315114">)</span>&nbsp;<span class="op" id="5315116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315121">list</span><span class="op" id="5315125">[</span><span class="ident" id="5315126">j</span><span class="op" id="5315127">]</span>&nbsp;<span class="op" id="5315129">=</span>&nbsp;<span class="ident" id="5315131">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315136">j</span><span class="op" id="5315137">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315145">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315148">return</span>&nbsp;<span class="ident" id="5315155">list</span><span class="op" id="5315159">[</span><span class="num" id="5315160">0</span><span class="op" id="5315161">:</span><span class="ident" id="5315162">j</span><span class="op" id="5315163">]</span><br>
<span class="lineno"></span><span class="op" id="5315165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5315168">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5315238">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="5315307">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="5315374">//</span><br>
<span class="lineno"></span><span class="comment" id="5315377">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5315447">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5315489">//</span><br>
<span class="lineno">205</span><span class="keyword" id="5315492">func</span>&nbsp;<span class="ident" id="5315497">FilterDecl</span><span class="op" id="5315507">(</span><span class="ident" id="5315508">decl</span>&nbsp;<span class="ident" id="5315513">Decl</span><span class="op" id="5315517">,</span>&nbsp;<span class="ident" id="5315519">f</span>&nbsp;<span class="ident" id="5315521">Filter</span><span class="op" id="5315527">)</span>&nbsp;<span class="builtintype" id="5315529">bool</span>&nbsp;<span class="op" id="5315534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315537">return</span>&nbsp;<span class="ident" id="5315544">filterDecl</span><span class="op" id="5315554">(</span><span class="ident" id="5315555">decl</span><span class="op" id="5315559">,</span>&nbsp;<span class="ident" id="5315561">f</span><span class="op" id="5315562">,</span>&nbsp;<span class="builtintype" id="5315564">false</span><span class="op" id="5315569">)</span><br>
<span class="lineno"></span><span class="op" id="5315571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5315574">func</span>&nbsp;<span class="ident" id="5315579">filterDecl</span><span class="op" id="5315589">(</span><span class="ident" id="5315590">decl</span>&nbsp;<span class="ident" id="5315595">Decl</span><span class="op" id="5315599">,</span>&nbsp;<span class="ident" id="5315601">f</span>&nbsp;<span class="ident" id="5315603">Filter</span><span class="op" id="5315609">,</span>&nbsp;<span class="ident" id="5315611">export</span>&nbsp;<span class="builtintype" id="5315618">bool</span><span class="op" id="5315622">)</span>&nbsp;<span class="builtintype" id="5315624">bool</span>&nbsp;<span class="op" id="5315629">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315632">switch</span>&nbsp;<span class="ident" id="5315639">d</span>&nbsp;<span class="op" id="5315641">:=</span>&nbsp;<span class="ident" id="5315644">decl</span><span class="op" id="5315648">.</span><span class="op" id="5315649">(</span><span class="keyword" id="5315650">type</span><span class="op" id="5315654">)</span>&nbsp;<span class="op" id="5315656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315659">case</span>&nbsp;<span class="op" id="5315664">*</span><span class="ident" id="5315665">GenDecl</span><span class="op" id="5315672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315676">d</span><span class="op" id="5315677">.</span><span class="ident" id="5315678">Specs</span>&nbsp;<span class="op" id="5315684">=</span>&nbsp;<span class="ident" id="5315686">filterSpecList</span><span class="op" id="5315700">(</span><span class="ident" id="5315701">d</span><span class="op" id="5315702">.</span><span class="ident" id="5315703">Specs</span><span class="op" id="5315708">,</span>&nbsp;<span class="ident" id="5315710">f</span><span class="op" id="5315711">,</span>&nbsp;<span class="ident" id="5315713">export</span><span class="op" id="5315719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315723">return</span>&nbsp;<span class="builtinfunc" id="5315730">len</span><span class="op" id="5315733">(</span><span class="ident" id="5315734">d</span><span class="op" id="5315735">.</span><span class="ident" id="5315736">Specs</span><span class="op" id="5315741">)</span>&nbsp;<span class="op" id="5315743">&gt;</span>&nbsp;<span class="num" id="5315745">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315748">case</span>&nbsp;<span class="op" id="5315753">*</span><span class="ident" id="5315754">FuncDecl</span><span class="op" id="5315762">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315766">return</span>&nbsp;<span class="ident" id="5315773">f</span><span class="op" id="5315774">(</span><span class="ident" id="5315775">d</span><span class="op" id="5315776">.</span><span class="ident" id="5315777">Name</span><span class="op" id="5315781">.</span><span class="ident" id="5315782">Name</span><span class="op" id="5315786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315792">return</span>&nbsp;<span class="builtintype" id="5315799">false</span><br>
<span class="lineno"></span><span class="op" id="5315805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="5315808">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5315875">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5315940">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5316008">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="5316078">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="5316145">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="5316164">//</span><br>
<span class="lineno"></span><span class="comment" id="5316167">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="5316234">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5316287">//</span><br>
<span class="lineno">230</span><span class="keyword" id="5316290">func</span>&nbsp;<span class="ident" id="5316295">FilterFile</span><span class="op" id="5316305">(</span><span class="ident" id="5316306">src</span>&nbsp;<span class="op" id="5316310">*</span><span class="ident" id="5316311">File</span><span class="op" id="5316315">,</span>&nbsp;<span class="ident" id="5316317">f</span>&nbsp;<span class="ident" id="5316319">Filter</span><span class="op" id="5316325">)</span>&nbsp;<span class="builtintype" id="5316327">bool</span>&nbsp;<span class="op" id="5316332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316335">return</span>&nbsp;<span class="ident" id="5316342">filterFile</span><span class="op" id="5316352">(</span><span class="ident" id="5316353">src</span><span class="op" id="5316356">,</span>&nbsp;<span class="ident" id="5316358">f</span><span class="op" id="5316359">,</span>&nbsp;<span class="builtintype" id="5316361">false</span><span class="op" id="5316366">)</span><br>
<span class="lineno"></span><span class="op" id="5316368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316371">func</span>&nbsp;<span class="ident" id="5316376">filterFile</span><span class="op" id="5316386">(</span><span class="ident" id="5316387">src</span>&nbsp;<span class="op" id="5316391">*</span><span class="ident" id="5316392">File</span><span class="op" id="5316396">,</span>&nbsp;<span class="ident" id="5316398">f</span>&nbsp;<span class="ident" id="5316400">Filter</span><span class="op" id="5316406">,</span>&nbsp;<span class="ident" id="5316408">export</span>&nbsp;<span class="builtintype" id="5316415">bool</span><span class="op" id="5316419">)</span>&nbsp;<span class="builtintype" id="5316421">bool</span>&nbsp;<span class="op" id="5316426">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316429">j</span>&nbsp;<span class="op" id="5316431">:=</span>&nbsp;<span class="num" id="5316434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316437">for</span>&nbsp;<span class="ident" id="5316441">_</span><span class="op" id="5316442">,</span>&nbsp;<span class="ident" id="5316444">d</span>&nbsp;<span class="op" id="5316446">:=</span>&nbsp;<span class="keyword" id="5316449">range</span>&nbsp;<span class="ident" id="5316455">src</span><span class="op" id="5316458">.</span><span class="ident" id="5316459">Decls</span>&nbsp;<span class="op" id="5316465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316469">if</span>&nbsp;<span class="ident" id="5316472">filterDecl</span><span class="op" id="5316482">(</span><span class="ident" id="5316483">d</span><span class="op" id="5316484">,</span>&nbsp;<span class="ident" id="5316486">f</span><span class="op" id="5316487">,</span>&nbsp;<span class="ident" id="5316489">export</span><span class="op" id="5316495">)</span>&nbsp;<span class="op" id="5316497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316502">src</span><span class="op" id="5316505">.</span><span class="ident" id="5316506">Decls</span><span class="op" id="5316511">[</span><span class="ident" id="5316512">j</span><span class="op" id="5316513">]</span>&nbsp;<span class="op" id="5316515">=</span>&nbsp;<span class="ident" id="5316517">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316522">j</span><span class="op" id="5316523">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316534">src</span><span class="op" id="5316537">.</span><span class="ident" id="5316538">Decls</span>&nbsp;<span class="op" id="5316544">=</span>&nbsp;<span class="ident" id="5316546">src</span><span class="op" id="5316549">.</span><span class="ident" id="5316550">Decls</span><span class="op" id="5316555">[</span><span class="num" id="5316556">0</span><span class="op" id="5316557">:</span><span class="ident" id="5316558">j</span><span class="op" id="5316559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316562">return</span>&nbsp;<span class="ident" id="5316569">j</span>&nbsp;<span class="op" id="5316571">&gt;</span>&nbsp;<span class="num" id="5316573">0</span><br>
<span class="lineno"></span><span class="op" id="5316575">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5316578">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5316647">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5316716">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5316784">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="5316854">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5316924">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="5316996">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5317005">//</span><br>
<span class="lineno"></span><span class="comment" id="5317008">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="5317078">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5317131">//</span><br>
<span class="lineno"></span><span class="keyword" id="5317134">func</span>&nbsp;<span class="ident" id="5317139">FilterPackage</span><span class="op" id="5317152">(</span><span class="ident" id="5317153">pkg</span>&nbsp;<span class="op" id="5317157">*</span><span class="ident" id="5317158">Package</span><span class="op" id="5317165">,</span>&nbsp;<span class="ident" id="5317167">f</span>&nbsp;<span class="ident" id="5317169">Filter</span><span class="op" id="5317175">)</span>&nbsp;<span class="builtintype" id="5317177">bool</span>&nbsp;<span class="op" id="5317182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317185">return</span>&nbsp;<span class="ident" id="5317192">filterPackage</span><span class="op" id="5317205">(</span><span class="ident" id="5317206">pkg</span><span class="op" id="5317209">,</span>&nbsp;<span class="ident" id="5317211">f</span><span class="op" id="5317212">,</span>&nbsp;<span class="builtintype" id="5317214">false</span><span class="op" id="5317219">)</span><br>
<span class="lineno"></span><span class="op" id="5317221">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="5317224">func</span>&nbsp;<span class="ident" id="5317229">filterPackage</span><span class="op" id="5317242">(</span><span class="ident" id="5317243">pkg</span>&nbsp;<span class="op" id="5317247">*</span><span class="ident" id="5317248">Package</span><span class="op" id="5317255">,</span>&nbsp;<span class="ident" id="5317257">f</span>&nbsp;<span class="ident" id="5317259">Filter</span><span class="op" id="5317265">,</span>&nbsp;<span class="ident" id="5317267">export</span>&nbsp;<span class="builtintype" id="5317274">bool</span><span class="op" id="5317278">)</span>&nbsp;<span class="builtintype" id="5317280">bool</span>&nbsp;<span class="op" id="5317285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317288">hasDecls</span>&nbsp;<span class="op" id="5317297">:=</span>&nbsp;<span class="builtintype" id="5317300">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317307">for</span>&nbsp;<span class="ident" id="5317311">_</span><span class="op" id="5317312">,</span>&nbsp;<span class="ident" id="5317314">src</span>&nbsp;<span class="op" id="5317318">:=</span>&nbsp;<span class="keyword" id="5317321">range</span>&nbsp;<span class="ident" id="5317327">pkg</span><span class="op" id="5317330">.</span><span class="ident" id="5317331">Files</span>&nbsp;<span class="op" id="5317337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317341">if</span>&nbsp;<span class="ident" id="5317344">filterFile</span><span class="op" id="5317354">(</span><span class="ident" id="5317355">src</span><span class="op" id="5317358">,</span>&nbsp;<span class="ident" id="5317360">f</span><span class="op" id="5317361">,</span>&nbsp;<span class="ident" id="5317363">export</span><span class="op" id="5317369">)</span>&nbsp;<span class="op" id="5317371">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317376">hasDecls</span>&nbsp;<span class="op" id="5317385">=</span>&nbsp;<span class="builtintype" id="5317387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5317400">return</span>&nbsp;<span class="ident" id="5317407">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="5317416">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="5317419">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5317499">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5317528">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="5317594">type</span>&nbsp;<span class="ident" id="5317599">MergeMode</span>&nbsp;<span class="builtintype" id="5317609">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5317615">const</span>&nbsp;<span class="op" id="5317621">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317624">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317682">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="5317703">MergeMode</span>&nbsp;<span class="op" id="5317713">=</span>&nbsp;<span class="num" id="5317715">1</span>&nbsp;<span class="op" id="5317717">&lt;&lt;</span>&nbsp;<span class="ident" id="5317720">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317726">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317787">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317834">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5317862">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5317918">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="5317941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5317944">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5318010">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5318077">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="5318121">//</span><br>
<span class="lineno"></span><span class="keyword" id="5318124">func</span>&nbsp;<span class="ident" id="5318129">nameOf</span><span class="op" id="5318135">(</span><span class="ident" id="5318136">f</span>&nbsp;<span class="op" id="5318138">*</span><span class="ident" id="5318139">FuncDecl</span><span class="op" id="5318147">)</span>&nbsp;<span class="builtintype" id="5318149">string</span>&nbsp;<span class="op" id="5318156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318159">if</span>&nbsp;<span class="ident" id="5318162">r</span>&nbsp;<span class="op" id="5318164">:=</span>&nbsp;<span class="ident" id="5318167">f</span><span class="op" id="5318168">.</span><span class="ident" id="5318169">Recv</span><span class="op" id="5318173">;</span>&nbsp;<span class="ident" id="5318175">r</span>&nbsp;<span class="op" id="5318177">!=</span>&nbsp;<span class="ident" id="5318180">nil</span>&nbsp;<span class="op" id="5318184">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5318187">len</span><span class="op" id="5318190">(</span><span class="ident" id="5318191">r</span><span class="op" id="5318192">.</span><span class="ident" id="5318193">List</span><span class="op" id="5318197">)</span>&nbsp;<span class="op" id="5318199">==</span>&nbsp;<span class="num" id="5318202">1</span>&nbsp;<span class="op" id="5318204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318208">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318255">t</span>&nbsp;<span class="op" id="5318257">:=</span>&nbsp;<span class="ident" id="5318260">r</span><span class="op" id="5318261">.</span><span class="ident" id="5318262">List</span><span class="op" id="5318266">[</span><span class="num" id="5318267">0</span><span class="op" id="5318268">]</span><span class="op" id="5318269">.</span><span class="ident" id="5318270">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318277">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318317">if</span>&nbsp;<span class="ident" id="5318320">p</span><span class="op" id="5318321">,</span>&nbsp;<span class="ident" id="5318323">_</span>&nbsp;<span class="op" id="5318325">:=</span>&nbsp;<span class="ident" id="5318328">t</span><span class="op" id="5318329">.</span><span class="op" id="5318330">(</span><span class="op" id="5318331">*</span><span class="ident" id="5318332">StarExpr</span><span class="op" id="5318340">)</span><span class="op" id="5318341">;</span>&nbsp;<span class="ident" id="5318343">p</span>&nbsp;<span class="op" id="5318345">!=</span>&nbsp;<span class="ident" id="5318348">nil</span>&nbsp;<span class="op" id="5318352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5318357">t</span>&nbsp;<span class="op" id="5318359">=</span>&nbsp;<span class="ident" id="5318361">p</span><span class="op" id="5318362">.</span><span class="ident" id="5318363">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318371">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318414">if</span>&nbsp;<span class="ident" id="5318417">p</span><span class="op" id="5318418">,</span>&nbsp;<span class="ident" id="5318420">_</span>&nbsp;<span class="op" id="5318422">:=</span>&nbsp;<span class="ident" id="5318425">t</span><span class="op" id="5318426">.</span><span class="op" id="5318427">(</span><span class="op" id="5318428">*</span><span class="ident" id="5318429">Ident</span><span class="op" id="5318434">)</span><span class="op" id="5318435">;</span>&nbsp;<span class="ident" id="5318437">p</span>&nbsp;<span class="op" id="5318439">!=</span>&nbsp;<span class="ident" id="5318442">nil</span>&nbsp;<span class="op" id="5318446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318451">return</span>&nbsp;<span class="ident" id="5318458">p</span><span class="op" id="5318459">.</span><span class="ident" id="5318460">Name</span>&nbsp;<span class="op" id="5318465">+</span>&nbsp;<span class="string" id="5318467">&#34;.&#34;</span>&nbsp;<span class="op" id="5318471">+</span>&nbsp;<span class="ident" id="5318473">f</span><span class="op" id="5318474">.</span><span class="ident" id="5318475">Name</span><span class="op" id="5318479">.</span><span class="ident" id="5318480">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318491">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5318531">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5318534">return</span>&nbsp;<span class="ident" id="5318541">f</span><span class="op" id="5318542">.</span><span class="ident" id="5318543">Name</span><span class="op" id="5318547">.</span><span class="ident" id="5318548">Name</span><br>
<span class="lineno"></span><span class="op" id="5318553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5318556">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5318627">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="5318702">//</span><br>
<span class="lineno"></span><span class="keyword" id="5318705">var</span>&nbsp;<span class="ident" id="5318709">separator</span>&nbsp;<span class="op" id="5318719">=</span>&nbsp;<span class="op" id="5318721">&amp;</span><span class="ident" id="5318722">Comment</span><span class="op" id="5318729">{</span><span class="ident" id="5318730">token</span><span class="op" id="5318735">.</span><span class="ident" id="5318736">NoPos</span><span class="op" id="5318741">,</span>&nbsp;<span class="string" id="5318743">&#34;//&#34;</span><span class="op" id="5318747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5318750">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5318817">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="5318891">//</span><br>
<span class="lineno"></span><span class="keyword" id="5318894">func</span>&nbsp;<span class="ident" id="5318899">MergePackageFiles</span><span class="op" id="5318916">(</span><span class="ident" id="5318917">pkg</span>&nbsp;<span class="op" id="5318921">*</span><span class="ident" id="5318922">Package</span><span class="op" id="5318929">,</span>&nbsp;<span class="ident" id="5318931">mode</span>&nbsp;<span class="ident" id="5318936">MergeMode</span><span class="op" id="5318945">)</span>&nbsp;<span class="op" id="5318947">*</span><span class="ident" id="5318948">File</span>&nbsp;<span class="op" id="5318953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5318956">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319027">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319098">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319162">ndocs</span>&nbsp;<span class="op" id="5319168">:=</span>&nbsp;<span class="num" id="5319171">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319174">ncomments</span>&nbsp;<span class="op" id="5319184">:=</span>&nbsp;<span class="num" id="5319187">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319190">ndecls</span>&nbsp;<span class="op" id="5319197">:=</span>&nbsp;<span class="num" id="5319200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319203">filenames</span>&nbsp;<span class="op" id="5319213">:=</span>&nbsp;<span class="builtinfunc" id="5319216">make</span><span class="op" id="5319220">(</span><span class="op" id="5319221">[</span><span class="op" id="5319222">]</span><span class="builtintype" id="5319223">string</span><span class="op" id="5319229">,</span>&nbsp;<span class="builtinfunc" id="5319231">len</span><span class="op" id="5319234">(</span><span class="ident" id="5319235">pkg</span><span class="op" id="5319238">.</span><span class="ident" id="5319239">Files</span><span class="op" id="5319244">)</span><span class="op" id="5319245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319248">i</span>&nbsp;<span class="op" id="5319250">:=</span>&nbsp;<span class="num" id="5319253">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319256">for</span>&nbsp;<span class="ident" id="5319260">filename</span><span class="op" id="5319268">,</span>&nbsp;<span class="ident" id="5319270">f</span>&nbsp;<span class="op" id="5319272">:=</span>&nbsp;<span class="keyword" id="5319275">range</span>&nbsp;<span class="ident" id="5319281">pkg</span><span class="op" id="5319284">.</span><span class="ident" id="5319285">Files</span>&nbsp;<span class="op" id="5319291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319295">filenames</span><span class="op" id="5319304">[</span><span class="ident" id="5319305">i</span><span class="op" id="5319306">]</span>&nbsp;<span class="op" id="5319308">=</span>&nbsp;<span class="ident" id="5319310">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319321">i</span><span class="op" id="5319322">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319327">if</span>&nbsp;<span class="ident" id="5319330">f</span><span class="op" id="5319331">.</span><span class="ident" id="5319332">Doc</span>&nbsp;<span class="op" id="5319336">!=</span>&nbsp;<span class="ident" id="5319339">nil</span>&nbsp;<span class="op" id="5319343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319348">ndocs</span>&nbsp;<span class="op" id="5319354">+=</span>&nbsp;<span class="builtinfunc" id="5319357">len</span><span class="op" id="5319360">(</span><span class="ident" id="5319361">f</span><span class="op" id="5319362">.</span><span class="ident" id="5319363">Doc</span><span class="op" id="5319366">.</span><span class="ident" id="5319367">List</span><span class="op" id="5319371">)</span>&nbsp;<span class="op" id="5319373">+</span>&nbsp;<span class="num" id="5319375">1</span>&nbsp;<span class="comment" id="5319377">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319403">ncomments</span>&nbsp;<span class="op" id="5319413">+=</span>&nbsp;<span class="builtinfunc" id="5319416">len</span><span class="op" id="5319419">(</span><span class="ident" id="5319420">f</span><span class="op" id="5319421">.</span><span class="ident" id="5319422">Comments</span><span class="op" id="5319430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319434">ndecls</span>&nbsp;<span class="op" id="5319441">+=</span>&nbsp;<span class="builtinfunc" id="5319444">len</span><span class="op" id="5319447">(</span><span class="ident" id="5319448">f</span><span class="op" id="5319449">.</span><span class="ident" id="5319450">Decls</span><span class="op" id="5319455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319461">sort</span><span class="op" id="5319465">.</span><span class="ident" id="5319466">Strings</span><span class="op" id="5319473">(</span><span class="ident" id="5319474">filenames</span><span class="op" id="5319483">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319487">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319553">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319620">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5319687">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319753">var</span>&nbsp;<span class="ident" id="5319757">doc</span>&nbsp;<span class="op" id="5319761">*</span><span class="ident" id="5319762">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319776">var</span>&nbsp;<span class="ident" id="5319780">pos</span>&nbsp;<span class="ident" id="5319784">token</span><span class="op" id="5319789">.</span><span class="ident" id="5319790">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319795">if</span>&nbsp;<span class="ident" id="5319798">ndocs</span>&nbsp;<span class="op" id="5319804">&gt;</span>&nbsp;<span class="num" id="5319806">0</span>&nbsp;<span class="op" id="5319808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319812">list</span>&nbsp;<span class="op" id="5319817">:=</span>&nbsp;<span class="builtinfunc" id="5319820">make</span><span class="op" id="5319824">(</span><span class="op" id="5319825">[</span><span class="op" id="5319826">]</span><span class="op" id="5319827">*</span><span class="ident" id="5319828">Comment</span><span class="op" id="5319835">,</span>&nbsp;<span class="ident" id="5319837">ndocs</span><span class="op" id="5319842">-</span><span class="num" id="5319843">1</span><span class="op" id="5319844">)</span>&nbsp;<span class="comment" id="5319846">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319887">i</span>&nbsp;<span class="op" id="5319889">:=</span>&nbsp;<span class="num" id="5319892">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319896">for</span>&nbsp;<span class="ident" id="5319900">_</span><span class="op" id="5319901">,</span>&nbsp;<span class="ident" id="5319903">filename</span>&nbsp;<span class="op" id="5319912">:=</span>&nbsp;<span class="keyword" id="5319915">range</span>&nbsp;<span class="ident" id="5319921">filenames</span>&nbsp;<span class="op" id="5319931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319936">f</span>&nbsp;<span class="op" id="5319938">:=</span>&nbsp;<span class="ident" id="5319941">pkg</span><span class="op" id="5319944">.</span><span class="ident" id="5319945">Files</span><span class="op" id="5319950">[</span><span class="ident" id="5319951">filename</span><span class="op" id="5319959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319964">if</span>&nbsp;<span class="ident" id="5319967">f</span><span class="op" id="5319968">.</span><span class="ident" id="5319969">Doc</span>&nbsp;<span class="op" id="5319973">!=</span>&nbsp;<span class="ident" id="5319976">nil</span>&nbsp;<span class="op" id="5319980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319986">if</span>&nbsp;<span class="ident" id="5319989">i</span>&nbsp;<span class="op" id="5319991">&gt;</span>&nbsp;<span class="num" id="5319993">0</span>&nbsp;<span class="op" id="5319995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320002">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320046">list</span><span class="op" id="5320050">[</span><span class="ident" id="5320051">i</span><span class="op" id="5320052">]</span>&nbsp;<span class="op" id="5320054">=</span>&nbsp;<span class="ident" id="5320056">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320071">i</span><span class="op" id="5320072">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320085">for</span>&nbsp;<span class="ident" id="5320089">_</span><span class="op" id="5320090">,</span>&nbsp;<span class="ident" id="5320092">c</span>&nbsp;<span class="op" id="5320094">:=</span>&nbsp;<span class="keyword" id="5320097">range</span>&nbsp;<span class="ident" id="5320103">f</span><span class="op" id="5320104">.</span><span class="ident" id="5320105">Doc</span><span class="op" id="5320108">.</span><span class="ident" id="5320109">List</span>&nbsp;<span class="op" id="5320114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320121">list</span><span class="op" id="5320125">[</span><span class="ident" id="5320126">i</span><span class="op" id="5320127">]</span>&nbsp;<span class="op" id="5320129">=</span>&nbsp;<span class="ident" id="5320131">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320138">i</span><span class="op" id="5320139">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320152">if</span>&nbsp;<span class="ident" id="5320155">f</span><span class="op" id="5320156">.</span><span class="ident" id="5320157">Package</span>&nbsp;<span class="op" id="5320165">&gt;</span>&nbsp;<span class="ident" id="5320167">pos</span>&nbsp;<span class="op" id="5320171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320178">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320230">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320284">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320299">pos</span>&nbsp;<span class="op" id="5320303">=</span>&nbsp;<span class="ident" id="5320305">f</span><span class="op" id="5320306">.</span><span class="ident" id="5320307">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320328">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320332">doc</span>&nbsp;<span class="op" id="5320336">=</span>&nbsp;<span class="op" id="5320338">&amp;</span><span class="ident" id="5320339">CommentGroup</span><span class="op" id="5320351">{</span><span class="ident" id="5320352">list</span><span class="op" id="5320356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320363">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320412">var</span>&nbsp;<span class="ident" id="5320416">decls</span>&nbsp;<span class="op" id="5320422">[</span><span class="op" id="5320423">]</span><span class="ident" id="5320424">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320430">if</span>&nbsp;<span class="ident" id="5320433">ndecls</span>&nbsp;<span class="op" id="5320440">&gt;</span>&nbsp;<span class="num" id="5320442">0</span>&nbsp;<span class="op" id="5320444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320448">decls</span>&nbsp;<span class="op" id="5320454">=</span>&nbsp;<span class="builtinfunc" id="5320456">make</span><span class="op" id="5320460">(</span><span class="op" id="5320461">[</span><span class="op" id="5320462">]</span><span class="ident" id="5320463">Decl</span><span class="op" id="5320467">,</span>&nbsp;<span class="ident" id="5320469">ndecls</span><span class="op" id="5320475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320479">funcs</span>&nbsp;<span class="op" id="5320485">:=</span>&nbsp;<span class="builtinfunc" id="5320488">make</span><span class="op" id="5320492">(</span><span class="keyword" id="5320493">map</span><span class="op" id="5320496">[</span><span class="builtintype" id="5320497">string</span><span class="op" id="5320503">]</span><span class="builtintype" id="5320504">int</span><span class="op" id="5320507">)</span>&nbsp;<span class="comment" id="5320509">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320546">i</span>&nbsp;<span class="op" id="5320548">:=</span>&nbsp;<span class="num" id="5320551">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320576">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320595">n</span>&nbsp;<span class="op" id="5320597">:=</span>&nbsp;<span class="num" id="5320600">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320625">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320657">for</span>&nbsp;<span class="ident" id="5320661">_</span><span class="op" id="5320662">,</span>&nbsp;<span class="ident" id="5320664">filename</span>&nbsp;<span class="op" id="5320673">:=</span>&nbsp;<span class="keyword" id="5320676">range</span>&nbsp;<span class="ident" id="5320682">filenames</span>&nbsp;<span class="op" id="5320692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320697">f</span>&nbsp;<span class="op" id="5320699">:=</span>&nbsp;<span class="ident" id="5320702">pkg</span><span class="op" id="5320705">.</span><span class="ident" id="5320706">Files</span><span class="op" id="5320711">[</span><span class="ident" id="5320712">filename</span><span class="op" id="5320720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320725">for</span>&nbsp;<span class="ident" id="5320729">_</span><span class="op" id="5320730">,</span>&nbsp;<span class="ident" id="5320732">d</span>&nbsp;<span class="op" id="5320734">:=</span>&nbsp;<span class="keyword" id="5320737">range</span>&nbsp;<span class="ident" id="5320743">f</span><span class="op" id="5320744">.</span><span class="ident" id="5320745">Decls</span>&nbsp;<span class="op" id="5320751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320757">if</span>&nbsp;<span class="ident" id="5320760">mode</span><span class="op" id="5320764">&amp;</span><span class="ident" id="5320765">FilterFuncDuplicates</span>&nbsp;<span class="op" id="5320786">!=</span>&nbsp;<span class="num" id="5320789">0</span>&nbsp;<span class="op" id="5320791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320798">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320849">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320899">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320947">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5320997">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321050">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321058">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321108">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321159">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321212">if</span>&nbsp;<span class="ident" id="5321215">f</span><span class="op" id="5321216">,</span>&nbsp;<span class="ident" id="5321218">isFun</span>&nbsp;<span class="op" id="5321224">:=</span>&nbsp;<span class="ident" id="5321227">d</span><span class="op" id="5321228">.</span><span class="op" id="5321229">(</span><span class="op" id="5321230">*</span><span class="ident" id="5321231">FuncDecl</span><span class="op" id="5321239">)</span><span class="op" id="5321240">;</span>&nbsp;<span class="ident" id="5321242">isFun</span>&nbsp;<span class="op" id="5321248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321256">name</span>&nbsp;<span class="op" id="5321261">:=</span>&nbsp;<span class="ident" id="5321264">nameOf</span><span class="op" id="5321270">(</span><span class="ident" id="5321271">f</span><span class="op" id="5321272">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321280">if</span>&nbsp;<span class="ident" id="5321283">j</span><span class="op" id="5321284">,</span>&nbsp;<span class="ident" id="5321286">exists</span>&nbsp;<span class="op" id="5321293">:=</span>&nbsp;<span class="ident" id="5321296">funcs</span><span class="op" id="5321301">[</span><span class="ident" id="5321302">name</span><span class="op" id="5321306">]</span><span class="op" id="5321307">;</span>&nbsp;<span class="ident" id="5321309">exists</span>&nbsp;<span class="op" id="5321316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321325">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321361">if</span>&nbsp;<span class="ident" id="5321364">decls</span><span class="op" id="5321369">[</span><span class="ident" id="5321370">j</span><span class="op" id="5321371">]</span>&nbsp;<span class="op" id="5321373">!=</span>&nbsp;<span class="ident" id="5321376">nil</span>&nbsp;<span class="op" id="5321380">&amp;&amp;</span>&nbsp;<span class="ident" id="5321383">decls</span><span class="op" id="5321388">[</span><span class="ident" id="5321389">j</span><span class="op" id="5321390">]</span><span class="op" id="5321391">.</span><span class="op" id="5321392">(</span><span class="op" id="5321393">*</span><span class="ident" id="5321394">FuncDecl</span><span class="op" id="5321402">)</span><span class="op" id="5321403">.</span><span class="ident" id="5321404">Doc</span>&nbsp;<span class="op" id="5321408">==</span>&nbsp;<span class="ident" id="5321411">nil</span>&nbsp;<span class="op" id="5321415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321425">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321479">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321522">decls</span><span class="op" id="5321527">[</span><span class="ident" id="5321528">j</span><span class="op" id="5321529">]</span>&nbsp;<span class="op" id="5321531">=</span>&nbsp;<span class="ident" id="5321533">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321544">}</span>&nbsp;<span class="keyword" id="5321546">else</span>&nbsp;<span class="op" id="5321551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321561">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321599">d</span>&nbsp;<span class="op" id="5321601">=</span>&nbsp;<span class="ident" id="5321603">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321614">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321623">n</span><span class="op" id="5321624">++</span>&nbsp;<span class="comment" id="5321627">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321654">}</span>&nbsp;<span class="keyword" id="5321656">else</span>&nbsp;<span class="op" id="5321661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321670">funcs</span><span class="op" id="5321675">[</span><span class="ident" id="5321676">name</span><span class="op" id="5321680">]</span>&nbsp;<span class="op" id="5321682">=</span>&nbsp;<span class="ident" id="5321684">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321699">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321711">decls</span><span class="op" id="5321716">[</span><span class="ident" id="5321717">i</span><span class="op" id="5321718">]</span>&nbsp;<span class="op" id="5321720">=</span>&nbsp;<span class="ident" id="5321722">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321728">i</span><span class="op" id="5321729">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321739">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321744">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321807">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321874">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321941">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322006">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322039">if</span>&nbsp;<span class="ident" id="5322042">n</span>&nbsp;<span class="op" id="5322044">&gt;</span>&nbsp;<span class="num" id="5322046">0</span>&nbsp;<span class="op" id="5322048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322053">i</span>&nbsp;<span class="op" id="5322055">=</span>&nbsp;<span class="num" id="5322057">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322062">for</span>&nbsp;<span class="ident" id="5322066">_</span><span class="op" id="5322067">,</span>&nbsp;<span class="ident" id="5322069">d</span>&nbsp;<span class="op" id="5322071">:=</span>&nbsp;<span class="keyword" id="5322074">range</span>&nbsp;<span class="ident" id="5322080">decls</span>&nbsp;<span class="op" id="5322086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322092">if</span>&nbsp;<span class="ident" id="5322095">d</span>&nbsp;<span class="op" id="5322097">!=</span>&nbsp;<span class="ident" id="5322100">nil</span>&nbsp;<span class="op" id="5322104">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322111">decls</span><span class="op" id="5322116">[</span><span class="ident" id="5322117">i</span><span class="op" id="5322118">]</span>&nbsp;<span class="op" id="5322120">=</span>&nbsp;<span class="ident" id="5322122">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322129">i</span><span class="op" id="5322130">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322147">decls</span>&nbsp;<span class="op" id="5322153">=</span>&nbsp;<span class="ident" id="5322155">decls</span><span class="op" id="5322160">[</span><span class="num" id="5322161">0</span><span class="op" id="5322162">:</span><span class="ident" id="5322163">i</span><span class="op" id="5322164">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322175">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322224">var</span>&nbsp;<span class="ident" id="5322228">imports</span>&nbsp;<span class="op" id="5322236">[</span><span class="op" id="5322237">]</span><span class="op" id="5322238">*</span><span class="ident" id="5322239">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322251">if</span>&nbsp;<span class="ident" id="5322254">mode</span><span class="op" id="5322258">&amp;</span><span class="ident" id="5322259">FilterImportDuplicates</span>&nbsp;<span class="op" id="5322282">!=</span>&nbsp;<span class="num" id="5322285">0</span>&nbsp;<span class="op" id="5322287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322291">seen</span>&nbsp;<span class="op" id="5322296">:=</span>&nbsp;<span class="builtinfunc" id="5322299">make</span><span class="op" id="5322303">(</span><span class="keyword" id="5322304">map</span><span class="op" id="5322307">[</span><span class="builtintype" id="5322308">string</span><span class="op" id="5322314">]</span><span class="builtintype" id="5322315">bool</span><span class="op" id="5322319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322323">for</span>&nbsp;<span class="ident" id="5322327">_</span><span class="op" id="5322328">,</span>&nbsp;<span class="ident" id="5322330">filename</span>&nbsp;<span class="op" id="5322339">:=</span>&nbsp;<span class="keyword" id="5322342">range</span>&nbsp;<span class="ident" id="5322348">filenames</span>&nbsp;<span class="op" id="5322358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322363">f</span>&nbsp;<span class="op" id="5322365">:=</span>&nbsp;<span class="ident" id="5322368">pkg</span><span class="op" id="5322371">.</span><span class="ident" id="5322372">Files</span><span class="op" id="5322377">[</span><span class="ident" id="5322378">filename</span><span class="op" id="5322386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322391">for</span>&nbsp;<span class="ident" id="5322395">_</span><span class="op" id="5322396">,</span>&nbsp;<span class="ident" id="5322398">imp</span>&nbsp;<span class="op" id="5322402">:=</span>&nbsp;<span class="keyword" id="5322405">range</span>&nbsp;<span class="ident" id="5322411">f</span><span class="op" id="5322412">.</span><span class="ident" id="5322413">Imports</span>&nbsp;<span class="op" id="5322421">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322427">if</span>&nbsp;<span class="ident" id="5322430">path</span>&nbsp;<span class="op" id="5322435">:=</span>&nbsp;<span class="ident" id="5322438">imp</span><span class="op" id="5322441">.</span><span class="ident" id="5322442">Path</span><span class="op" id="5322446">.</span><span class="ident" id="5322447">Value</span><span class="op" id="5322452">;</span>&nbsp;<span class="op" id="5322454">!</span><span class="ident" id="5322455">seen</span><span class="op" id="5322459">[</span><span class="ident" id="5322460">path</span><span class="op" id="5322464">]</span>&nbsp;<span class="op" id="5322466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322473">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322518">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322574">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322632">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322661">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322714">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322769">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322799">imports</span>&nbsp;<span class="op" id="5322807">=</span>&nbsp;<span class="builtinfunc" id="5322809">append</span><span class="op" id="5322815">(</span><span class="ident" id="5322816">imports</span><span class="op" id="5322823">,</span>&nbsp;<span class="ident" id="5322825">imp</span><span class="op" id="5322828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322835">seen</span><span class="op" id="5322839">[</span><span class="ident" id="5322840">path</span><span class="op" id="5322844">]</span>&nbsp;<span class="op" id="5322846">=</span>&nbsp;<span class="builtintype" id="5322848">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322869">}</span>&nbsp;<span class="keyword" id="5322871">else</span>&nbsp;<span class="op" id="5322876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322880">for</span>&nbsp;<span class="ident" id="5322884">_</span><span class="op" id="5322885">,</span>&nbsp;<span class="ident" id="5322887">f</span>&nbsp;<span class="op" id="5322889">:=</span>&nbsp;<span class="keyword" id="5322892">range</span>&nbsp;<span class="ident" id="5322898">pkg</span><span class="op" id="5322901">.</span><span class="ident" id="5322902">Files</span>&nbsp;<span class="op" id="5322908">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322913">imports</span>&nbsp;<span class="op" id="5322921">=</span>&nbsp;<span class="builtinfunc" id="5322923">append</span><span class="op" id="5322929">(</span><span class="ident" id="5322930">imports</span><span class="op" id="5322937">,</span>&nbsp;<span class="ident" id="5322939">f</span><span class="op" id="5322940">.</span><span class="ident" id="5322941">Imports</span><span class="op" id="5322948">...</span><span class="op" id="5322951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322962">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323007">var</span>&nbsp;<span class="ident" id="5323011">comments</span>&nbsp;<span class="op" id="5323020">[</span><span class="op" id="5323021">]</span><span class="op" id="5323022">*</span><span class="ident" id="5323023">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323037">if</span>&nbsp;<span class="ident" id="5323040">mode</span><span class="op" id="5323044">&amp;</span><span class="ident" id="5323045">FilterUnassociatedComments</span>&nbsp;<span class="op" id="5323072">==</span>&nbsp;<span class="num" id="5323075">0</span>&nbsp;<span class="op" id="5323077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323081">comments</span>&nbsp;<span class="op" id="5323090">=</span>&nbsp;<span class="builtinfunc" id="5323092">make</span><span class="op" id="5323096">(</span><span class="op" id="5323097">[</span><span class="op" id="5323098">]</span><span class="op" id="5323099">*</span><span class="ident" id="5323100">CommentGroup</span><span class="op" id="5323112">,</span>&nbsp;<span class="ident" id="5323114">ncomments</span><span class="op" id="5323123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323127">i</span>&nbsp;<span class="op" id="5323129">:=</span>&nbsp;<span class="num" id="5323132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323136">for</span>&nbsp;<span class="ident" id="5323140">_</span><span class="op" id="5323141">,</span>&nbsp;<span class="ident" id="5323143">f</span>&nbsp;<span class="op" id="5323145">:=</span>&nbsp;<span class="keyword" id="5323148">range</span>&nbsp;<span class="ident" id="5323154">pkg</span><span class="op" id="5323157">.</span><span class="ident" id="5323158">Files</span>&nbsp;<span class="op" id="5323164">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323169">i</span>&nbsp;<span class="op" id="5323171">+=</span>&nbsp;<span class="builtinfunc" id="5323174">copy</span><span class="op" id="5323178">(</span><span class="ident" id="5323179">comments</span><span class="op" id="5323187">[</span><span class="ident" id="5323188">i</span><span class="op" id="5323189">:</span><span class="op" id="5323190">]</span><span class="op" id="5323191">,</span>&nbsp;<span class="ident" id="5323193">f</span><span class="op" id="5323194">.</span><span class="ident" id="5323195">Comments</span><span class="op" id="5323203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323214">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323268">return</span>&nbsp;<span class="op" id="5323275">&amp;</span><span class="ident" id="5323276">File</span><span class="op" id="5323280">{</span><span class="ident" id="5323281">doc</span><span class="op" id="5323284">,</span>&nbsp;<span class="ident" id="5323286">pos</span><span class="op" id="5323289">,</span>&nbsp;<span class="ident" id="5323291">NewIdent</span><span class="op" id="5323299">(</span><span class="ident" id="5323300">pkg</span><span class="op" id="5323303">.</span><span class="ident" id="5323304">Name</span><span class="op" id="5323308">)</span><span class="op" id="5323309">,</span>&nbsp;<span class="ident" id="5323311">decls</span><span class="op" id="5323316">,</span>&nbsp;<span class="ident" id="5323318">pkg</span><span class="op" id="5323321">.</span><span class="ident" id="5323322">Scope</span><span class="op" id="5323327">,</span>&nbsp;<span class="ident" id="5323329">imports</span><span class="op" id="5323336">,</span>&nbsp;<span class="ident" id="5323338">nil</span><span class="op" id="5323341">,</span>&nbsp;<span class="ident" id="5323343">comments</span><span class="op" id="5323351">}</span><br>
<span class="lineno"></span><span class="op" id="5323353">}</span>
</div>
</body>
</html>
