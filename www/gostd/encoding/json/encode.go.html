<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html" class="current">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1992612">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1992668">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1992722">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1992773">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1992852">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="1992925">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1992990">//</span><br>
<span class="lineno"></span><span class="comment" id="1992993">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="1993051">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="1993102">package</span>&nbsp;<span class="ident" id="1993110">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1993116">import</span>&nbsp;<span class="op" id="1993123">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993126">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993135">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993147">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993166">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993174">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993185">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993196">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993204">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993215">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993226">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993234">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1993245">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1993260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1993263">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="1993306">//</span><br>
<span class="lineno">30</span><span class="comment" id="1993309">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="1993355">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="1993417">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="1993483">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="1993556">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="1993620">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="1993638">//</span><br>
<span class="lineno"></span><span class="comment" id="1993641">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="1993716">//</span><br>
<span class="lineno"></span><span class="comment" id="1993719">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="1993762">//</span><br>
<span class="lineno"></span><span class="comment" id="1993765">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="1993835">//</span><br>
<span class="lineno"></span><span class="comment" id="1993838">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="1993902">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="1993964">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1994035">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="1994102">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="1994168">//</span><br>
<span class="lineno"></span><span class="comment" id="1994171">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="1994232">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="1994294">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="1994330">//</span><br>
<span class="lineno"></span><span class="comment" id="1994333">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="1994401">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="1994442">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1994476">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="1994548">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1994586">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1994661">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="1994734">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1994809">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="1994888">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="1994914">//</span><br>
<span class="lineno"></span><span class="comment" id="1994917">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="1994959">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="1994985">//</span><br>
<span class="lineno"></span><span class="comment" id="1994988">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1995035">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="1995066">//</span><br>
<span class="lineno">70</span><span class="comment" id="1995069">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1995119">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="1995187">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="1995213">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="1995254">//</span><br>
<span class="lineno">75</span><span class="comment" id="1995257">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="1995321">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="1995360">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="1995392">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="1995427">//</span><br>
<span class="lineno">80</span><span class="comment" id="1995430">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1995501">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="1995578">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="1995651">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="1995694">//</span><br>
<span class="lineno">85</span><span class="comment" id="1995697">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="1995738">//</span><br>
<span class="lineno"></span><span class="comment" id="1995741">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1995811">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="1995882">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="1995910">//</span><br>
<span class="lineno"></span><span class="comment" id="1995913">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="1995996">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="1996081">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="1996120">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="1996197">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="1996247">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="1996324">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="1996379">//</span><br>
<span class="lineno"></span><span class="comment" id="1996382">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="1996453">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="1996515">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="1996581">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1996649">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="1996702">//</span><br>
<span class="lineno">105</span><span class="comment" id="1996705">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="1996787">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="1996864">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="1996963">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="1997044">//</span><br>
<span class="lineno">110</span><span class="comment" id="1997047">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="1997104">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1997183">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="1997265">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1997287">//</span><br>
<span class="lineno">115</span><span class="comment" id="1997290">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="1997328">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="1997400">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="1997416">//</span><br>
<span class="lineno"></span><span class="comment" id="1997419">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="1997469">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="1997519">//</span><br>
<span class="lineno"></span><span class="comment" id="1997522">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="1997590">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="1997648">//</span><br>
<span class="lineno">125</span><span class="comment" id="1997651">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="1997719">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="1997781">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="1997809">//</span><br>
<span class="lineno"></span><span class="comment" id="1997812">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="1997881">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1997950">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="1997976">//</span><br>
<span class="lineno"></span><span class="keyword" id="1997979">func</span>&nbsp;<span class="ident" id="1997984">Marshal</span><span class="op" id="1997991">(</span><span class="ident" id="1997992">v</span>&nbsp;<span class="keyword" id="1997994">interface</span><span class="op" id="1998003">{</span><span class="op" id="1998004">}</span><span class="op" id="1998005">)</span>&nbsp;<span class="op" id="1998007">(</span><span class="op" id="1998008">[</span><span class="op" id="1998009">]</span><span class="builtintype" id="1998010">byte</span><span class="op" id="1998014">,</span>&nbsp;<span class="builtintype" id="1998016">error</span><span class="op" id="1998021">)</span>&nbsp;<span class="op" id="1998023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1998026">e</span>&nbsp;<span class="op" id="1998028">:=</span>&nbsp;<span class="op" id="1998031">&amp;</span><span class="ident" id="1998032">encodeState</span><span class="op" id="1998043">{</span><span class="op" id="1998044">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1998047">err</span>&nbsp;<span class="op" id="1998051">:=</span>&nbsp;<span class="ident" id="1998054">e</span><span class="op" id="1998055">.</span><span class="ident" id="1998056">marshal</span><span class="op" id="1998063">(</span><span class="ident" id="1998064">v</span><span class="op" id="1998065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998068">if</span>&nbsp;<span class="ident" id="1998071">err</span>&nbsp;<span class="op" id="1998075">!=</span>&nbsp;<span class="builtintype" id="1998078">nil</span>&nbsp;<span class="op" id="1998082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998086">return</span>&nbsp;<span class="builtintype" id="1998093">nil</span><span class="op" id="1998096">,</span>&nbsp;<span class="ident" id="1998098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1998103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998106">return</span>&nbsp;<span class="ident" id="1998113">e</span><span class="op" id="1998114">.</span><span class="ident" id="1998115">Bytes</span><span class="op" id="1998120">(</span><span class="op" id="1998121">)</span><span class="op" id="1998122">,</span>&nbsp;<span class="builtintype" id="1998124">nil</span><br>
<span class="lineno">140</span><span class="op" id="1998128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1998131">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="1998205">func</span>&nbsp;<span class="ident" id="1998210">MarshalIndent</span><span class="op" id="1998223">(</span><span class="ident" id="1998224">v</span>&nbsp;<span class="keyword" id="1998226">interface</span><span class="op" id="1998235">{</span><span class="op" id="1998236">}</span><span class="op" id="1998237">,</span>&nbsp;<span class="ident" id="1998239">prefix</span><span class="op" id="1998245">,</span>&nbsp;<span class="ident" id="1998247">indent</span>&nbsp;<span class="builtintype" id="1998254">string</span><span class="op" id="1998260">)</span>&nbsp;<span class="op" id="1998262">(</span><span class="op" id="1998263">[</span><span class="op" id="1998264">]</span><span class="builtintype" id="1998265">byte</span><span class="op" id="1998269">,</span>&nbsp;<span class="builtintype" id="1998271">error</span><span class="op" id="1998276">)</span>&nbsp;<span class="op" id="1998278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1998281">b</span><span class="op" id="1998282">,</span>&nbsp;<span class="ident" id="1998284">err</span>&nbsp;<span class="op" id="1998288">:=</span>&nbsp;<span class="ident" id="1998291">Marshal</span><span class="op" id="1998298">(</span><span class="ident" id="1998299">v</span><span class="op" id="1998300">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998303">if</span>&nbsp;<span class="ident" id="1998306">err</span>&nbsp;<span class="op" id="1998310">!=</span>&nbsp;<span class="builtintype" id="1998313">nil</span>&nbsp;<span class="op" id="1998317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998321">return</span>&nbsp;<span class="builtintype" id="1998328">nil</span><span class="op" id="1998331">,</span>&nbsp;<span class="ident" id="1998333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1998338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998341">var</span>&nbsp;<span class="ident" id="1998345">buf</span>&nbsp;<span class="ident" id="1998349">bytes</span><span class="op" id="1998354">.</span><span class="ident" id="1998355">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1998363">err</span>&nbsp;<span class="op" id="1998367">=</span>&nbsp;<span class="ident" id="1998369">Indent</span><span class="op" id="1998375">(</span><span class="op" id="1998376">&amp;</span><span class="ident" id="1998377">buf</span><span class="op" id="1998380">,</span>&nbsp;<span class="ident" id="1998382">b</span><span class="op" id="1998383">,</span>&nbsp;<span class="ident" id="1998385">prefix</span><span class="op" id="1998391">,</span>&nbsp;<span class="ident" id="1998393">indent</span><span class="op" id="1998399">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998402">if</span>&nbsp;<span class="ident" id="1998405">err</span>&nbsp;<span class="op" id="1998409">!=</span>&nbsp;<span class="builtintype" id="1998412">nil</span>&nbsp;<span class="op" id="1998416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998420">return</span>&nbsp;<span class="builtintype" id="1998427">nil</span><span class="op" id="1998430">,</span>&nbsp;<span class="ident" id="1998432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1998437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1998440">return</span>&nbsp;<span class="ident" id="1998447">buf</span><span class="op" id="1998450">.</span><span class="ident" id="1998451">Bytes</span><span class="op" id="1998456">(</span><span class="op" id="1998457">)</span><span class="op" id="1998458">,</span>&nbsp;<span class="builtintype" id="1998460">nil</span><br>
<span class="lineno"></span><span class="op" id="1998464">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1998467">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="1998549">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="1998636">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="1998705">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="1998771">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="1998842">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="1998854">func</span>&nbsp;<span class="ident" id="1998859">HTMLEscape</span><span class="op" id="1998869">(</span><span class="ident" id="1998870">dst</span>&nbsp;<span class="op" id="1998874">*</span><span class="ident" id="1998875">bytes</span><span class="op" id="1998880">.</span><span class="ident" id="1998881">Buffer</span><span class="op" id="1998887">,</span>&nbsp;<span class="ident" id="1998889">src</span>&nbsp;<span class="op" id="1998893">[</span><span class="op" id="1998894">]</span><span class="builtintype" id="1998895">byte</span><span class="op" id="1998899">)</span>&nbsp;<span class="op" id="1998901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1998904">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1998959">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999007">start</span>&nbsp;<span class="op" id="1999013">:=</span>&nbsp;<span class="num" id="1999016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999019">for</span>&nbsp;<span class="ident" id="1999023">i</span><span class="op" id="1999024">,</span>&nbsp;<span class="ident" id="1999026">c</span>&nbsp;<span class="op" id="1999028">:=</span>&nbsp;<span class="keyword" id="1999031">range</span>&nbsp;<span class="ident" id="1999037">src</span>&nbsp;<span class="op" id="1999041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999045">if</span>&nbsp;<span class="ident" id="1999048">c</span>&nbsp;<span class="op" id="1999050">==</span>&nbsp;<span class="string" id="1999053">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="1999057">||</span>&nbsp;<span class="ident" id="1999060">c</span>&nbsp;<span class="op" id="1999062">==</span>&nbsp;<span class="string" id="1999065">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="1999069">||</span>&nbsp;<span class="ident" id="1999072">c</span>&nbsp;<span class="op" id="1999074">==</span>&nbsp;<span class="string" id="1999077">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="1999081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999086">if</span>&nbsp;<span class="ident" id="1999089">start</span>&nbsp;<span class="op" id="1999095">&lt;</span>&nbsp;<span class="ident" id="1999097">i</span>&nbsp;<span class="op" id="1999099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999105">dst</span><span class="op" id="1999108">.</span><span class="ident" id="1999109">Write</span><span class="op" id="1999114">(</span><span class="ident" id="1999115">src</span><span class="op" id="1999118">[</span><span class="ident" id="1999119">start</span><span class="op" id="1999124">:</span><span class="ident" id="1999125">i</span><span class="op" id="1999126">]</span><span class="op" id="1999127">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999137">dst</span><span class="op" id="1999140">.</span><span class="ident" id="1999141">WriteString</span><span class="op" id="1999152">(</span><span class="string" id="1999153">`\u00`</span><span class="op" id="1999159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999164">dst</span><span class="op" id="1999167">.</span><span class="ident" id="1999168">WriteByte</span><span class="op" id="1999177">(</span><span class="ident" id="1999178">hex</span><span class="op" id="1999181">[</span><span class="ident" id="1999182">c</span><span class="op" id="1999183">&gt;&gt;</span><span class="num" id="1999185">4</span><span class="op" id="1999186">]</span><span class="op" id="1999187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999192">dst</span><span class="op" id="1999195">.</span><span class="ident" id="1999196">WriteByte</span><span class="op" id="1999205">(</span><span class="ident" id="1999206">hex</span><span class="op" id="1999209">[</span><span class="ident" id="1999210">c</span><span class="op" id="1999211">&amp;</span><span class="num" id="1999212">0xF</span><span class="op" id="1999215">]</span><span class="op" id="1999216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999221">start</span>&nbsp;<span class="op" id="1999227">=</span>&nbsp;<span class="ident" id="1999229">i</span>&nbsp;<span class="op" id="1999231">+</span>&nbsp;<span class="num" id="1999233">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1999241">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999297">if</span>&nbsp;<span class="ident" id="1999300">c</span>&nbsp;<span class="op" id="1999302">==</span>&nbsp;<span class="num" id="1999305">0xE2</span>&nbsp;<span class="op" id="1999310">&amp;&amp;</span>&nbsp;<span class="ident" id="1999313">i</span><span class="op" id="1999314">+</span><span class="num" id="1999315">2</span>&nbsp;<span class="op" id="1999317">&lt;</span>&nbsp;<span class="builtinfunc" id="1999319">len</span><span class="op" id="1999322">(</span><span class="ident" id="1999323">src</span><span class="op" id="1999326">)</span>&nbsp;<span class="op" id="1999328">&amp;&amp;</span>&nbsp;<span class="ident" id="1999331">src</span><span class="op" id="1999334">[</span><span class="ident" id="1999335">i</span><span class="op" id="1999336">+</span><span class="num" id="1999337">1</span><span class="op" id="1999338">]</span>&nbsp;<span class="op" id="1999340">==</span>&nbsp;<span class="num" id="1999343">0x80</span>&nbsp;<span class="op" id="1999348">&amp;&amp;</span>&nbsp;<span class="ident" id="1999351">src</span><span class="op" id="1999354">[</span><span class="ident" id="1999355">i</span><span class="op" id="1999356">+</span><span class="num" id="1999357">2</span><span class="op" id="1999358">]</span><span class="op" id="1999359">&amp;^</span><span class="num" id="1999361">1</span>&nbsp;<span class="op" id="1999363">==</span>&nbsp;<span class="num" id="1999366">0xA8</span>&nbsp;<span class="op" id="1999371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999376">if</span>&nbsp;<span class="ident" id="1999379">start</span>&nbsp;<span class="op" id="1999385">&lt;</span>&nbsp;<span class="ident" id="1999387">i</span>&nbsp;<span class="op" id="1999389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999395">dst</span><span class="op" id="1999398">.</span><span class="ident" id="1999399">Write</span><span class="op" id="1999404">(</span><span class="ident" id="1999405">src</span><span class="op" id="1999408">[</span><span class="ident" id="1999409">start</span><span class="op" id="1999414">:</span><span class="ident" id="1999415">i</span><span class="op" id="1999416">]</span><span class="op" id="1999417">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999427">dst</span><span class="op" id="1999430">.</span><span class="ident" id="1999431">WriteString</span><span class="op" id="1999442">(</span><span class="string" id="1999443">`\u202`</span><span class="op" id="1999450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999455">dst</span><span class="op" id="1999458">.</span><span class="ident" id="1999459">WriteByte</span><span class="op" id="1999468">(</span><span class="ident" id="1999469">hex</span><span class="op" id="1999472">[</span><span class="ident" id="1999473">src</span><span class="op" id="1999476">[</span><span class="ident" id="1999477">i</span><span class="op" id="1999478">+</span><span class="num" id="1999479">2</span><span class="op" id="1999480">]</span><span class="op" id="1999481">&amp;</span><span class="num" id="1999482">0xF</span><span class="op" id="1999485">]</span><span class="op" id="1999486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999491">start</span>&nbsp;<span class="op" id="1999497">=</span>&nbsp;<span class="ident" id="1999499">i</span>&nbsp;<span class="op" id="1999501">+</span>&nbsp;<span class="num" id="1999503">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999507">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999513">if</span>&nbsp;<span class="ident" id="1999516">start</span>&nbsp;<span class="op" id="1999522">&lt;</span>&nbsp;<span class="builtinfunc" id="1999524">len</span><span class="op" id="1999527">(</span><span class="ident" id="1999528">src</span><span class="op" id="1999531">)</span>&nbsp;<span class="op" id="1999533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999537">dst</span><span class="op" id="1999540">.</span><span class="ident" id="1999541">Write</span><span class="op" id="1999546">(</span><span class="ident" id="1999547">src</span><span class="op" id="1999550">[</span><span class="ident" id="1999551">start</span><span class="op" id="1999556">:</span><span class="op" id="1999557">]</span><span class="op" id="1999558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1999561">}</span><br>
<span class="lineno"></span><span class="op" id="1999563">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1999566">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1999624">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="1999667">type</span>&nbsp;<span class="ident" id="1999672">Marshaler</span>&nbsp;<span class="keyword" id="1999682">interface</span>&nbsp;<span class="op" id="1999692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999695">MarshalJSON</span><span class="op" id="1999706">(</span><span class="op" id="1999707">)</span>&nbsp;<span class="op" id="1999709">(</span><span class="op" id="1999710">[</span><span class="op" id="1999711">]</span><span class="builtintype" id="1999712">byte</span><span class="op" id="1999716">,</span>&nbsp;<span class="builtintype" id="1999718">error</span><span class="op" id="1999723">)</span><br>
<span class="lineno">195</span><span class="op" id="1999725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1999728">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="1999794">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="1999834">type</span>&nbsp;<span class="ident" id="1999839">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="1999860">struct</span>&nbsp;<span class="op" id="1999867">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1999870">Type</span>&nbsp;<span class="ident" id="1999875">reflect</span><span class="op" id="1999882">.</span><span class="ident" id="1999883">Type</span><br>
<span class="lineno"></span><span class="op" id="1999888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1999891">func</span>&nbsp;<span class="op" id="1999896">(</span><span class="ident" id="1999897">e</span>&nbsp;<span class="op" id="1999899">*</span><span class="ident" id="1999900">UnsupportedTypeError</span><span class="op" id="1999920">)</span>&nbsp;<span class="ident" id="1999922">Error</span><span class="op" id="1999927">(</span><span class="op" id="1999928">)</span>&nbsp;<span class="builtintype" id="1999930">string</span>&nbsp;<span class="op" id="1999937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1999940">return</span>&nbsp;<span class="string" id="1999947">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="1999974">+</span>&nbsp;<span class="ident" id="1999976">e</span><span class="op" id="1999977">.</span><span class="ident" id="1999978">Type</span><span class="op" id="1999982">.</span><span class="ident" id="1999983">String</span><span class="op" id="1999989">(</span><span class="op" id="1999990">)</span><br>
<span class="lineno">205</span><span class="op" id="1999992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1999995">type</span>&nbsp;<span class="ident" id="2000000">UnsupportedValueError</span>&nbsp;<span class="keyword" id="2000022">struct</span>&nbsp;<span class="op" id="2000029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2000032">Value</span>&nbsp;<span class="ident" id="2000038">reflect</span><span class="op" id="2000045">.</span><span class="ident" id="2000046">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2000053">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2000059">string</span><br>
<span class="lineno">210</span><span class="op" id="2000066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2000069">func</span>&nbsp;<span class="op" id="2000074">(</span><span class="ident" id="2000075">e</span>&nbsp;<span class="op" id="2000077">*</span><span class="ident" id="2000078">UnsupportedValueError</span><span class="op" id="2000099">)</span>&nbsp;<span class="ident" id="2000101">Error</span><span class="op" id="2000106">(</span><span class="op" id="2000107">)</span>&nbsp;<span class="builtintype" id="2000109">string</span>&nbsp;<span class="op" id="2000116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2000119">return</span>&nbsp;<span class="string" id="2000126">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="2000154">+</span>&nbsp;<span class="ident" id="2000156">e</span><span class="op" id="2000157">.</span><span class="ident" id="2000158">Str</span><br>
<span class="lineno"></span><span class="op" id="2000162">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="2000165">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="2000232">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="2000301">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2000371">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="2000440">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="2000517">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2000557">type</span>&nbsp;<span class="ident" id="2000562">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="2000579">struct</span>&nbsp;<span class="op" id="2000586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2000589">S</span>&nbsp;<span class="builtintype" id="2000591">string</span>&nbsp;<span class="comment" id="2000598">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="2000646">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="2000649">func</span>&nbsp;<span class="op" id="2000654">(</span><span class="ident" id="2000655">e</span>&nbsp;<span class="op" id="2000657">*</span><span class="ident" id="2000658">InvalidUTF8Error</span><span class="op" id="2000674">)</span>&nbsp;<span class="ident" id="2000676">Error</span><span class="op" id="2000681">(</span><span class="op" id="2000682">)</span>&nbsp;<span class="builtintype" id="2000684">string</span>&nbsp;<span class="op" id="2000691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2000694">return</span>&nbsp;<span class="string" id="2000701">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="2000735">+</span>&nbsp;<span class="ident" id="2000737">strconv</span><span class="op" id="2000744">.</span><span class="ident" id="2000745">Quote</span><span class="op" id="2000750">(</span><span class="ident" id="2000751">e</span><span class="op" id="2000752">.</span><span class="ident" id="2000753">S</span><span class="op" id="2000754">)</span><br>
<span class="lineno"></span><span class="op" id="2000756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="2000759">type</span>&nbsp;<span class="ident" id="2000764">MarshalerError</span>&nbsp;<span class="keyword" id="2000779">struct</span>&nbsp;<span class="op" id="2000786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2000789">Type</span>&nbsp;<span class="ident" id="2000794">reflect</span><span class="op" id="2000801">.</span><span class="ident" id="2000802">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2000808">Err</span>&nbsp;&nbsp;<span class="builtintype" id="2000813">error</span><br>
<span class="lineno"></span><span class="op" id="2000819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="2000822">func</span>&nbsp;<span class="op" id="2000827">(</span><span class="ident" id="2000828">e</span>&nbsp;<span class="op" id="2000830">*</span><span class="ident" id="2000831">MarshalerError</span><span class="op" id="2000845">)</span>&nbsp;<span class="ident" id="2000847">Error</span><span class="op" id="2000852">(</span><span class="op" id="2000853">)</span>&nbsp;<span class="builtintype" id="2000855">string</span>&nbsp;<span class="op" id="2000862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2000865">return</span>&nbsp;<span class="string" id="2000872">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="2000916">+</span>&nbsp;<span class="ident" id="2000918">e</span><span class="op" id="2000919">.</span><span class="ident" id="2000920">Type</span><span class="op" id="2000924">.</span><span class="ident" id="2000925">String</span><span class="op" id="2000931">(</span><span class="op" id="2000932">)</span>&nbsp;<span class="op" id="2000934">+</span>&nbsp;<span class="string" id="2000936">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="2000941">+</span>&nbsp;<span class="ident" id="2000943">e</span><span class="op" id="2000944">.</span><span class="ident" id="2000945">Err</span><span class="op" id="2000948">.</span><span class="ident" id="2000949">Error</span><span class="op" id="2000954">(</span><span class="op" id="2000955">)</span><br>
<span class="lineno"></span><span class="op" id="2000957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2000960">var</span>&nbsp;<span class="ident" id="2000964">hex</span>&nbsp;<span class="op" id="2000968">=</span>&nbsp;<span class="string" id="2000970">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2000990">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2001042">type</span>&nbsp;<span class="ident" id="2001047">encodeState</span>&nbsp;<span class="keyword" id="2001059">struct</span>&nbsp;<span class="op" id="2001066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001069">bytes</span><span class="op" id="2001074">.</span><span class="ident" id="2001075">Buffer</span>&nbsp;<span class="comment" id="2001082">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001105">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001118">[</span><span class="num" id="2001119">64</span><span class="op" id="2001121">]</span><span class="builtintype" id="2001122">byte</span><br>
<span class="lineno">245</span><span class="op" id="2001127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2001130">var</span>&nbsp;<span class="ident" id="2001134">encodeStatePool</span>&nbsp;<span class="ident" id="2001150">sync</span><span class="op" id="2001154">.</span><span class="ident" id="2001155">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2001161">func</span>&nbsp;<span class="ident" id="2001166">newEncodeState</span><span class="op" id="2001180">(</span><span class="op" id="2001181">)</span>&nbsp;<span class="op" id="2001183">*</span><span class="ident" id="2001184">encodeState</span>&nbsp;<span class="op" id="2001196">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001199">if</span>&nbsp;<span class="ident" id="2001202">v</span>&nbsp;<span class="op" id="2001204">:=</span>&nbsp;<span class="ident" id="2001207">encodeStatePool</span><span class="op" id="2001222">.</span><span class="ident" id="2001223">Get</span><span class="op" id="2001226">(</span><span class="op" id="2001227">)</span><span class="op" id="2001228">;</span>&nbsp;<span class="ident" id="2001230">v</span>&nbsp;<span class="op" id="2001232">!=</span>&nbsp;<span class="builtintype" id="2001235">nil</span>&nbsp;<span class="op" id="2001239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001243">e</span>&nbsp;<span class="op" id="2001245">:=</span>&nbsp;<span class="ident" id="2001248">v</span><span class="op" id="2001249">.</span><span class="op" id="2001250">(</span><span class="op" id="2001251">*</span><span class="ident" id="2001252">encodeState</span><span class="op" id="2001263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001267">e</span><span class="op" id="2001268">.</span><span class="ident" id="2001269">Reset</span><span class="op" id="2001274">(</span><span class="op" id="2001275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001279">return</span>&nbsp;<span class="ident" id="2001286">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001289">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001292">return</span>&nbsp;<span class="builtinfunc" id="2001299">new</span><span class="op" id="2001302">(</span><span class="ident" id="2001303">encodeState</span><span class="op" id="2001314">)</span><br>
<span class="lineno"></span><span class="op" id="2001316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2001319">func</span>&nbsp;<span class="op" id="2001324">(</span><span class="ident" id="2001325">e</span>&nbsp;<span class="op" id="2001327">*</span><span class="ident" id="2001328">encodeState</span><span class="op" id="2001339">)</span>&nbsp;<span class="ident" id="2001341">marshal</span><span class="op" id="2001348">(</span><span class="ident" id="2001349">v</span>&nbsp;<span class="keyword" id="2001351">interface</span><span class="op" id="2001360">{</span><span class="op" id="2001361">}</span><span class="op" id="2001362">)</span>&nbsp;<span class="op" id="2001364">(</span><span class="ident" id="2001365">err</span>&nbsp;<span class="builtintype" id="2001369">error</span><span class="op" id="2001374">)</span>&nbsp;<span class="op" id="2001376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001379">defer</span>&nbsp;<span class="keyword" id="2001385">func</span><span class="op" id="2001389">(</span><span class="op" id="2001390">)</span>&nbsp;<span class="op" id="2001392">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001396">if</span>&nbsp;<span class="ident" id="2001399">r</span>&nbsp;<span class="op" id="2001401">:=</span>&nbsp;<span class="builtinfunc" id="2001404">recover</span><span class="op" id="2001411">(</span><span class="op" id="2001412">)</span><span class="op" id="2001413">;</span>&nbsp;<span class="ident" id="2001415">r</span>&nbsp;<span class="op" id="2001417">!=</span>&nbsp;<span class="builtintype" id="2001420">nil</span>&nbsp;<span class="op" id="2001424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001429">if</span>&nbsp;<span class="ident" id="2001432">_</span><span class="op" id="2001433">,</span>&nbsp;<span class="ident" id="2001435">ok</span>&nbsp;<span class="op" id="2001438">:=</span>&nbsp;<span class="ident" id="2001441">r</span><span class="op" id="2001442">.</span><span class="op" id="2001443">(</span><span class="ident" id="2001444">runtime</span><span class="op" id="2001451">.</span><span class="ident" id="2001452">Error</span><span class="op" id="2001457">)</span><span class="op" id="2001458">;</span>&nbsp;<span class="ident" id="2001460">ok</span>&nbsp;<span class="op" id="2001463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2001469">panic</span><span class="op" id="2001474">(</span><span class="ident" id="2001475">r</span><span class="op" id="2001476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001486">if</span>&nbsp;<span class="ident" id="2001489">s</span><span class="op" id="2001490">,</span>&nbsp;<span class="ident" id="2001492">ok</span>&nbsp;<span class="op" id="2001495">:=</span>&nbsp;<span class="ident" id="2001498">r</span><span class="op" id="2001499">.</span><span class="op" id="2001500">(</span><span class="builtintype" id="2001501">string</span><span class="op" id="2001507">)</span><span class="op" id="2001508">;</span>&nbsp;<span class="ident" id="2001510">ok</span>&nbsp;<span class="op" id="2001513">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2001519">panic</span><span class="op" id="2001524">(</span><span class="ident" id="2001525">s</span><span class="op" id="2001526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001536">err</span>&nbsp;<span class="op" id="2001540">=</span>&nbsp;<span class="ident" id="2001542">r</span><span class="op" id="2001543">.</span><span class="op" id="2001544">(</span><span class="builtintype" id="2001545">error</span><span class="op" id="2001550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001557">}</span><span class="op" id="2001558">(</span><span class="op" id="2001559">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2001562">e</span><span class="op" id="2001563">.</span><span class="ident" id="2001564">reflectValue</span><span class="op" id="2001576">(</span><span class="ident" id="2001577">reflect</span><span class="op" id="2001584">.</span><span class="ident" id="2001585">ValueOf</span><span class="op" id="2001592">(</span><span class="ident" id="2001593">v</span><span class="op" id="2001594">)</span><span class="op" id="2001595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001598">return</span>&nbsp;<span class="builtintype" id="2001605">nil</span><br>
<span class="lineno"></span><span class="op" id="2001609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2001612">func</span>&nbsp;<span class="op" id="2001617">(</span><span class="ident" id="2001618">e</span>&nbsp;<span class="op" id="2001620">*</span><span class="ident" id="2001621">encodeState</span><span class="op" id="2001632">)</span>&nbsp;<span class="builtintype" id="2001634">error</span><span class="op" id="2001639">(</span><span class="ident" id="2001640">err</span>&nbsp;<span class="builtintype" id="2001644">error</span><span class="op" id="2001649">)</span>&nbsp;<span class="op" id="2001651">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2001654">panic</span><span class="op" id="2001659">(</span><span class="ident" id="2001660">err</span><span class="op" id="2001663">)</span><br>
<span class="lineno"></span><span class="op" id="2001665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2001668">var</span>&nbsp;<span class="ident" id="2001672">byteSliceType</span>&nbsp;<span class="op" id="2001686">=</span>&nbsp;<span class="ident" id="2001688">reflect</span><span class="op" id="2001695">.</span><span class="ident" id="2001696">TypeOf</span><span class="op" id="2001702">(</span><span class="op" id="2001703">[</span><span class="op" id="2001704">]</span><span class="builtintype" id="2001705">byte</span><span class="op" id="2001709">(</span><span class="builtintype" id="2001710">nil</span><span class="op" id="2001713">)</span><span class="op" id="2001714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="2001717">func</span>&nbsp;<span class="ident" id="2001722">isEmptyValue</span><span class="op" id="2001734">(</span><span class="ident" id="2001735">v</span>&nbsp;<span class="ident" id="2001737">reflect</span><span class="op" id="2001744">.</span><span class="ident" id="2001745">Value</span><span class="op" id="2001750">)</span>&nbsp;<span class="builtintype" id="2001752">bool</span>&nbsp;<span class="op" id="2001757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001760">switch</span>&nbsp;<span class="ident" id="2001767">v</span><span class="op" id="2001768">.</span><span class="ident" id="2001769">Kind</span><span class="op" id="2001773">(</span><span class="op" id="2001774">)</span>&nbsp;<span class="op" id="2001776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001779">case</span>&nbsp;<span class="ident" id="2001784">reflect</span><span class="op" id="2001791">.</span><span class="ident" id="2001792">Array</span><span class="op" id="2001797">,</span>&nbsp;<span class="ident" id="2001799">reflect</span><span class="op" id="2001806">.</span><span class="ident" id="2001807">Map</span><span class="op" id="2001810">,</span>&nbsp;<span class="ident" id="2001812">reflect</span><span class="op" id="2001819">.</span><span class="ident" id="2001820">Slice</span><span class="op" id="2001825">,</span>&nbsp;<span class="ident" id="2001827">reflect</span><span class="op" id="2001834">.</span><span class="ident" id="2001835">String</span><span class="op" id="2001841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001845">return</span>&nbsp;<span class="ident" id="2001852">v</span><span class="op" id="2001853">.</span><span class="ident" id="2001854">Len</span><span class="op" id="2001857">(</span><span class="op" id="2001858">)</span>&nbsp;<span class="op" id="2001860">==</span>&nbsp;<span class="num" id="2001863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001866">case</span>&nbsp;<span class="ident" id="2001871">reflect</span><span class="op" id="2001878">.</span><span class="ident" id="2001879">Bool</span><span class="op" id="2001883">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001887">return</span>&nbsp;<span class="op" id="2001894">!</span><span class="ident" id="2001895">v</span><span class="op" id="2001896">.</span><span class="ident" id="2001897">Bool</span><span class="op" id="2001901">(</span><span class="op" id="2001902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001905">case</span>&nbsp;<span class="ident" id="2001910">reflect</span><span class="op" id="2001917">.</span><span class="ident" id="2001918">Int</span><span class="op" id="2001921">,</span>&nbsp;<span class="ident" id="2001923">reflect</span><span class="op" id="2001930">.</span><span class="ident" id="2001931">Int8</span><span class="op" id="2001935">,</span>&nbsp;<span class="ident" id="2001937">reflect</span><span class="op" id="2001944">.</span><span class="ident" id="2001945">Int16</span><span class="op" id="2001950">,</span>&nbsp;<span class="ident" id="2001952">reflect</span><span class="op" id="2001959">.</span><span class="ident" id="2001960">Int32</span><span class="op" id="2001965">,</span>&nbsp;<span class="ident" id="2001967">reflect</span><span class="op" id="2001974">.</span><span class="ident" id="2001975">Int64</span><span class="op" id="2001980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2001984">return</span>&nbsp;<span class="ident" id="2001991">v</span><span class="op" id="2001992">.</span><span class="ident" id="2001993">Int</span><span class="op" id="2001996">(</span><span class="op" id="2001997">)</span>&nbsp;<span class="op" id="2001999">==</span>&nbsp;<span class="num" id="2002002">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002005">case</span>&nbsp;<span class="ident" id="2002010">reflect</span><span class="op" id="2002017">.</span><span class="ident" id="2002018">Uint</span><span class="op" id="2002022">,</span>&nbsp;<span class="ident" id="2002024">reflect</span><span class="op" id="2002031">.</span><span class="ident" id="2002032">Uint8</span><span class="op" id="2002037">,</span>&nbsp;<span class="ident" id="2002039">reflect</span><span class="op" id="2002046">.</span><span class="ident" id="2002047">Uint16</span><span class="op" id="2002053">,</span>&nbsp;<span class="ident" id="2002055">reflect</span><span class="op" id="2002062">.</span><span class="ident" id="2002063">Uint32</span><span class="op" id="2002069">,</span>&nbsp;<span class="ident" id="2002071">reflect</span><span class="op" id="2002078">.</span><span class="ident" id="2002079">Uint64</span><span class="op" id="2002085">,</span>&nbsp;<span class="ident" id="2002087">reflect</span><span class="op" id="2002094">.</span><span class="ident" id="2002095">Uintptr</span><span class="op" id="2002102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002106">return</span>&nbsp;<span class="ident" id="2002113">v</span><span class="op" id="2002114">.</span><span class="ident" id="2002115">Uint</span><span class="op" id="2002119">(</span><span class="op" id="2002120">)</span>&nbsp;<span class="op" id="2002122">==</span>&nbsp;<span class="num" id="2002125">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002128">case</span>&nbsp;<span class="ident" id="2002133">reflect</span><span class="op" id="2002140">.</span><span class="ident" id="2002141">Float32</span><span class="op" id="2002148">,</span>&nbsp;<span class="ident" id="2002150">reflect</span><span class="op" id="2002157">.</span><span class="ident" id="2002158">Float64</span><span class="op" id="2002165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002169">return</span>&nbsp;<span class="ident" id="2002176">v</span><span class="op" id="2002177">.</span><span class="ident" id="2002178">Float</span><span class="op" id="2002183">(</span><span class="op" id="2002184">)</span>&nbsp;<span class="op" id="2002186">==</span>&nbsp;<span class="num" id="2002189">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002192">case</span>&nbsp;<span class="ident" id="2002197">reflect</span><span class="op" id="2002204">.</span><span class="ident" id="2002205">Interface</span><span class="op" id="2002214">,</span>&nbsp;<span class="ident" id="2002216">reflect</span><span class="op" id="2002223">.</span><span class="ident" id="2002224">Ptr</span><span class="op" id="2002227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002231">return</span>&nbsp;<span class="ident" id="2002238">v</span><span class="op" id="2002239">.</span><span class="ident" id="2002240">IsNil</span><span class="op" id="2002245">(</span><span class="op" id="2002246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002249">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002252">return</span>&nbsp;<span class="builtintype" id="2002259">false</span><br>
<span class="lineno"></span><span class="op" id="2002265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002268">func</span>&nbsp;<span class="op" id="2002273">(</span><span class="ident" id="2002274">e</span>&nbsp;<span class="op" id="2002276">*</span><span class="ident" id="2002277">encodeState</span><span class="op" id="2002288">)</span>&nbsp;<span class="ident" id="2002290">reflectValue</span><span class="op" id="2002302">(</span><span class="ident" id="2002303">v</span>&nbsp;<span class="ident" id="2002305">reflect</span><span class="op" id="2002312">.</span><span class="ident" id="2002313">Value</span><span class="op" id="2002318">)</span>&nbsp;<span class="op" id="2002320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002323">valueEncoder</span><span class="op" id="2002335">(</span><span class="ident" id="2002336">v</span><span class="op" id="2002337">)</span><span class="op" id="2002338">(</span><span class="ident" id="2002339">e</span><span class="op" id="2002340">,</span>&nbsp;<span class="ident" id="2002342">v</span><span class="op" id="2002343">,</span>&nbsp;<span class="builtintype" id="2002345">false</span><span class="op" id="2002350">)</span><br>
<span class="lineno">300</span><span class="op" id="2002352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002355">type</span>&nbsp;<span class="ident" id="2002360">encoderFunc</span>&nbsp;<span class="keyword" id="2002372">func</span><span class="op" id="2002376">(</span><span class="ident" id="2002377">e</span>&nbsp;<span class="op" id="2002379">*</span><span class="ident" id="2002380">encodeState</span><span class="op" id="2002391">,</span>&nbsp;<span class="ident" id="2002393">v</span>&nbsp;<span class="ident" id="2002395">reflect</span><span class="op" id="2002402">.</span><span class="ident" id="2002403">Value</span><span class="op" id="2002408">,</span>&nbsp;<span class="ident" id="2002410">quoted</span>&nbsp;<span class="builtintype" id="2002417">bool</span><span class="op" id="2002421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002424">var</span>&nbsp;<span class="ident" id="2002428">encoderCache</span>&nbsp;<span class="keyword" id="2002441">struct</span>&nbsp;<span class="op" id="2002448">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002451">sync</span><span class="op" id="2002455">.</span><span class="ident" id="2002456">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002465">m</span>&nbsp;<span class="keyword" id="2002467">map</span><span class="op" id="2002470">[</span><span class="ident" id="2002471">reflect</span><span class="op" id="2002478">.</span><span class="ident" id="2002479">Type</span><span class="op" id="2002483">]</span><span class="ident" id="2002484">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2002496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002499">func</span>&nbsp;<span class="ident" id="2002504">valueEncoder</span><span class="op" id="2002516">(</span><span class="ident" id="2002517">v</span>&nbsp;<span class="ident" id="2002519">reflect</span><span class="op" id="2002526">.</span><span class="ident" id="2002527">Value</span><span class="op" id="2002532">)</span>&nbsp;<span class="ident" id="2002534">encoderFunc</span>&nbsp;<span class="op" id="2002546">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002549">if</span>&nbsp;<span class="op" id="2002552">!</span><span class="ident" id="2002553">v</span><span class="op" id="2002554">.</span><span class="ident" id="2002555">IsValid</span><span class="op" id="2002562">(</span><span class="op" id="2002563">)</span>&nbsp;<span class="op" id="2002565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002569">return</span>&nbsp;<span class="ident" id="2002576">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002600">return</span>&nbsp;<span class="ident" id="2002607">typeEncoder</span><span class="op" id="2002618">(</span><span class="ident" id="2002619">v</span><span class="op" id="2002620">.</span><span class="ident" id="2002621">Type</span><span class="op" id="2002625">(</span><span class="op" id="2002626">)</span><span class="op" id="2002627">)</span><br>
<span class="lineno"></span><span class="op" id="2002629">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="2002632">func</span>&nbsp;<span class="ident" id="2002637">typeEncoder</span><span class="op" id="2002648">(</span><span class="ident" id="2002649">t</span>&nbsp;<span class="ident" id="2002651">reflect</span><span class="op" id="2002658">.</span><span class="ident" id="2002659">Type</span><span class="op" id="2002663">)</span>&nbsp;<span class="ident" id="2002665">encoderFunc</span>&nbsp;<span class="op" id="2002677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002680">encoderCache</span><span class="op" id="2002692">.</span><span class="ident" id="2002693">RLock</span><span class="op" id="2002698">(</span><span class="op" id="2002699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002702">f</span>&nbsp;<span class="op" id="2002704">:=</span>&nbsp;<span class="ident" id="2002707">encoderCache</span><span class="op" id="2002719">.</span><span class="ident" id="2002720">m</span><span class="op" id="2002721">[</span><span class="ident" id="2002722">t</span><span class="op" id="2002723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2002726">encoderCache</span><span class="op" id="2002738">.</span><span class="ident" id="2002739">RUnlock</span><span class="op" id="2002746">(</span><span class="op" id="2002747">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002750">if</span>&nbsp;<span class="ident" id="2002753">f</span>&nbsp;<span class="op" id="2002755">!=</span>&nbsp;<span class="builtintype" id="2002758">nil</span>&nbsp;<span class="op" id="2002762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2002766">return</span>&nbsp;<span class="ident" id="2002773">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002780">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002839">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002900">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002964">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003007">encoderCache</span><span class="op" id="2003019">.</span><span class="ident" id="2003020">Lock</span><span class="op" id="2003024">(</span><span class="op" id="2003025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003028">if</span>&nbsp;<span class="ident" id="2003031">encoderCache</span><span class="op" id="2003043">.</span><span class="ident" id="2003044">m</span>&nbsp;<span class="op" id="2003046">==</span>&nbsp;<span class="builtintype" id="2003049">nil</span>&nbsp;<span class="op" id="2003053">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003057">encoderCache</span><span class="op" id="2003069">.</span><span class="ident" id="2003070">m</span>&nbsp;<span class="op" id="2003072">=</span>&nbsp;<span class="builtinfunc" id="2003074">make</span><span class="op" id="2003078">(</span><span class="keyword" id="2003079">map</span><span class="op" id="2003082">[</span><span class="ident" id="2003083">reflect</span><span class="op" id="2003090">.</span><span class="ident" id="2003091">Type</span><span class="op" id="2003095">]</span><span class="ident" id="2003096">encoderFunc</span><span class="op" id="2003107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003113">var</span>&nbsp;<span class="ident" id="2003117">wg</span>&nbsp;<span class="ident" id="2003120">sync</span><span class="op" id="2003124">.</span><span class="ident" id="2003125">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003136">wg</span><span class="op" id="2003138">.</span><span class="ident" id="2003139">Add</span><span class="op" id="2003142">(</span><span class="num" id="2003143">1</span><span class="op" id="2003144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003147">encoderCache</span><span class="op" id="2003159">.</span><span class="ident" id="2003160">m</span><span class="op" id="2003161">[</span><span class="ident" id="2003162">t</span><span class="op" id="2003163">]</span>&nbsp;<span class="op" id="2003165">=</span>&nbsp;<span class="keyword" id="2003167">func</span><span class="op" id="2003171">(</span><span class="ident" id="2003172">e</span>&nbsp;<span class="op" id="2003174">*</span><span class="ident" id="2003175">encodeState</span><span class="op" id="2003186">,</span>&nbsp;<span class="ident" id="2003188">v</span>&nbsp;<span class="ident" id="2003190">reflect</span><span class="op" id="2003197">.</span><span class="ident" id="2003198">Value</span><span class="op" id="2003203">,</span>&nbsp;<span class="ident" id="2003205">quoted</span>&nbsp;<span class="builtintype" id="2003212">bool</span><span class="op" id="2003216">)</span>&nbsp;<span class="op" id="2003218">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003222">wg</span><span class="op" id="2003224">.</span><span class="ident" id="2003225">Wait</span><span class="op" id="2003229">(</span><span class="op" id="2003230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003234">f</span><span class="op" id="2003235">(</span><span class="ident" id="2003236">e</span><span class="op" id="2003237">,</span>&nbsp;<span class="ident" id="2003239">v</span><span class="op" id="2003240">,</span>&nbsp;<span class="ident" id="2003242">quoted</span><span class="op" id="2003248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003254">encoderCache</span><span class="op" id="2003266">.</span><span class="ident" id="2003267">Unlock</span><span class="op" id="2003273">(</span><span class="op" id="2003274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003278">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2003311">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003378">f</span>&nbsp;<span class="op" id="2003380">=</span>&nbsp;<span class="ident" id="2003382">newTypeEncoder</span><span class="op" id="2003396">(</span><span class="ident" id="2003397">t</span><span class="op" id="2003398">,</span>&nbsp;<span class="builtintype" id="2003400">true</span><span class="op" id="2003404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003407">wg</span><span class="op" id="2003409">.</span><span class="ident" id="2003410">Done</span><span class="op" id="2003414">(</span><span class="op" id="2003415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003418">encoderCache</span><span class="op" id="2003430">.</span><span class="ident" id="2003431">Lock</span><span class="op" id="2003435">(</span><span class="op" id="2003436">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003439">encoderCache</span><span class="op" id="2003451">.</span><span class="ident" id="2003452">m</span><span class="op" id="2003453">[</span><span class="ident" id="2003454">t</span><span class="op" id="2003455">]</span>&nbsp;<span class="op" id="2003457">=</span>&nbsp;<span class="ident" id="2003459">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003462">encoderCache</span><span class="op" id="2003474">.</span><span class="ident" id="2003475">Unlock</span><span class="op" id="2003481">(</span><span class="op" id="2003482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003485">return</span>&nbsp;<span class="ident" id="2003492">f</span><br>
<span class="lineno"></span><span class="op" id="2003494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="2003497">var</span>&nbsp;<span class="op" id="2003501">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003504">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003522">=</span>&nbsp;<span class="ident" id="2003524">reflect</span><span class="op" id="2003531">.</span><span class="ident" id="2003532">TypeOf</span><span class="op" id="2003538">(</span><span class="builtinfunc" id="2003539">new</span><span class="op" id="2003542">(</span><span class="ident" id="2003543">Marshaler</span><span class="op" id="2003552">)</span><span class="op" id="2003553">)</span><span class="op" id="2003554">.</span><span class="ident" id="2003555">Elem</span><span class="op" id="2003559">(</span><span class="op" id="2003560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003563">textMarshalerType</span>&nbsp;<span class="op" id="2003581">=</span>&nbsp;<span class="ident" id="2003583">reflect</span><span class="op" id="2003590">.</span><span class="ident" id="2003591">TypeOf</span><span class="op" id="2003597">(</span><span class="builtinfunc" id="2003598">new</span><span class="op" id="2003601">(</span><span class="ident" id="2003602">encoding</span><span class="op" id="2003610">.</span><span class="ident" id="2003611">TextMarshaler</span><span class="op" id="2003624">)</span><span class="op" id="2003625">)</span><span class="op" id="2003626">.</span><span class="ident" id="2003627">Elem</span><span class="op" id="2003631">(</span><span class="op" id="2003632">)</span><br>
<span class="lineno"></span><span class="op" id="2003634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="2003637">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="2003693">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="2003761">func</span>&nbsp;<span class="ident" id="2003766">newTypeEncoder</span><span class="op" id="2003780">(</span><span class="ident" id="2003781">t</span>&nbsp;<span class="ident" id="2003783">reflect</span><span class="op" id="2003790">.</span><span class="ident" id="2003791">Type</span><span class="op" id="2003795">,</span>&nbsp;<span class="ident" id="2003797">allowAddr</span>&nbsp;<span class="builtintype" id="2003807">bool</span><span class="op" id="2003811">)</span>&nbsp;<span class="ident" id="2003813">encoderFunc</span>&nbsp;<span class="op" id="2003825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003828">if</span>&nbsp;<span class="ident" id="2003831">t</span><span class="op" id="2003832">.</span><span class="ident" id="2003833">Implements</span><span class="op" id="2003843">(</span><span class="ident" id="2003844">marshalerType</span><span class="op" id="2003857">)</span>&nbsp;<span class="op" id="2003859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003863">return</span>&nbsp;<span class="ident" id="2003870">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2003888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003891">if</span>&nbsp;<span class="ident" id="2003894">t</span><span class="op" id="2003895">.</span><span class="ident" id="2003896">Kind</span><span class="op" id="2003900">(</span><span class="op" id="2003901">)</span>&nbsp;<span class="op" id="2003903">!=</span>&nbsp;<span class="ident" id="2003906">reflect</span><span class="op" id="2003913">.</span><span class="ident" id="2003914">Ptr</span>&nbsp;<span class="op" id="2003918">&amp;&amp;</span>&nbsp;<span class="ident" id="2003921">allowAddr</span>&nbsp;<span class="op" id="2003931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003935">if</span>&nbsp;<span class="ident" id="2003938">reflect</span><span class="op" id="2003945">.</span><span class="ident" id="2003946">PtrTo</span><span class="op" id="2003951">(</span><span class="ident" id="2003952">t</span><span class="op" id="2003953">)</span><span class="op" id="2003954">.</span><span class="ident" id="2003955">Implements</span><span class="op" id="2003965">(</span><span class="ident" id="2003966">marshalerType</span><span class="op" id="2003979">)</span>&nbsp;<span class="op" id="2003981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2003986">return</span>&nbsp;<span class="ident" id="2003993">newCondAddrEncoder</span><span class="op" id="2004011">(</span><span class="ident" id="2004012">addrMarshalerEncoder</span><span class="op" id="2004032">,</span>&nbsp;<span class="ident" id="2004034">newTypeEncoder</span><span class="op" id="2004048">(</span><span class="ident" id="2004049">t</span><span class="op" id="2004050">,</span>&nbsp;<span class="builtintype" id="2004052">false</span><span class="op" id="2004057">)</span><span class="op" id="2004058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004062">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004069">if</span>&nbsp;<span class="ident" id="2004072">t</span><span class="op" id="2004073">.</span><span class="ident" id="2004074">Implements</span><span class="op" id="2004084">(</span><span class="ident" id="2004085">textMarshalerType</span><span class="op" id="2004102">)</span>&nbsp;<span class="op" id="2004104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004108">return</span>&nbsp;<span class="ident" id="2004115">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004137">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004140">if</span>&nbsp;<span class="ident" id="2004143">t</span><span class="op" id="2004144">.</span><span class="ident" id="2004145">Kind</span><span class="op" id="2004149">(</span><span class="op" id="2004150">)</span>&nbsp;<span class="op" id="2004152">!=</span>&nbsp;<span class="ident" id="2004155">reflect</span><span class="op" id="2004162">.</span><span class="ident" id="2004163">Ptr</span>&nbsp;<span class="op" id="2004167">&amp;&amp;</span>&nbsp;<span class="ident" id="2004170">allowAddr</span>&nbsp;<span class="op" id="2004180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004184">if</span>&nbsp;<span class="ident" id="2004187">reflect</span><span class="op" id="2004194">.</span><span class="ident" id="2004195">PtrTo</span><span class="op" id="2004200">(</span><span class="ident" id="2004201">t</span><span class="op" id="2004202">)</span><span class="op" id="2004203">.</span><span class="ident" id="2004204">Implements</span><span class="op" id="2004214">(</span><span class="ident" id="2004215">textMarshalerType</span><span class="op" id="2004232">)</span>&nbsp;<span class="op" id="2004234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004239">return</span>&nbsp;<span class="ident" id="2004246">newCondAddrEncoder</span><span class="op" id="2004264">(</span><span class="ident" id="2004265">addrTextMarshalerEncoder</span><span class="op" id="2004289">,</span>&nbsp;<span class="ident" id="2004291">newTypeEncoder</span><span class="op" id="2004305">(</span><span class="ident" id="2004306">t</span><span class="op" id="2004307">,</span>&nbsp;<span class="builtintype" id="2004309">false</span><span class="op" id="2004314">)</span><span class="op" id="2004315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2004322">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004326">switch</span>&nbsp;<span class="ident" id="2004333">t</span><span class="op" id="2004334">.</span><span class="ident" id="2004335">Kind</span><span class="op" id="2004339">(</span><span class="op" id="2004340">)</span>&nbsp;<span class="op" id="2004342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004345">case</span>&nbsp;<span class="ident" id="2004350">reflect</span><span class="op" id="2004357">.</span><span class="ident" id="2004358">Bool</span><span class="op" id="2004362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004366">return</span>&nbsp;<span class="ident" id="2004373">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004386">case</span>&nbsp;<span class="ident" id="2004391">reflect</span><span class="op" id="2004398">.</span><span class="ident" id="2004399">Int</span><span class="op" id="2004402">,</span>&nbsp;<span class="ident" id="2004404">reflect</span><span class="op" id="2004411">.</span><span class="ident" id="2004412">Int8</span><span class="op" id="2004416">,</span>&nbsp;<span class="ident" id="2004418">reflect</span><span class="op" id="2004425">.</span><span class="ident" id="2004426">Int16</span><span class="op" id="2004431">,</span>&nbsp;<span class="ident" id="2004433">reflect</span><span class="op" id="2004440">.</span><span class="ident" id="2004441">Int32</span><span class="op" id="2004446">,</span>&nbsp;<span class="ident" id="2004448">reflect</span><span class="op" id="2004455">.</span><span class="ident" id="2004456">Int64</span><span class="op" id="2004461">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004465">return</span>&nbsp;<span class="ident" id="2004472">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004484">case</span>&nbsp;<span class="ident" id="2004489">reflect</span><span class="op" id="2004496">.</span><span class="ident" id="2004497">Uint</span><span class="op" id="2004501">,</span>&nbsp;<span class="ident" id="2004503">reflect</span><span class="op" id="2004510">.</span><span class="ident" id="2004511">Uint8</span><span class="op" id="2004516">,</span>&nbsp;<span class="ident" id="2004518">reflect</span><span class="op" id="2004525">.</span><span class="ident" id="2004526">Uint16</span><span class="op" id="2004532">,</span>&nbsp;<span class="ident" id="2004534">reflect</span><span class="op" id="2004541">.</span><span class="ident" id="2004542">Uint32</span><span class="op" id="2004548">,</span>&nbsp;<span class="ident" id="2004550">reflect</span><span class="op" id="2004557">.</span><span class="ident" id="2004558">Uint64</span><span class="op" id="2004564">,</span>&nbsp;<span class="ident" id="2004566">reflect</span><span class="op" id="2004573">.</span><span class="ident" id="2004574">Uintptr</span><span class="op" id="2004581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004585">return</span>&nbsp;<span class="ident" id="2004592">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004605">case</span>&nbsp;<span class="ident" id="2004610">reflect</span><span class="op" id="2004617">.</span><span class="ident" id="2004618">Float32</span><span class="op" id="2004625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004629">return</span>&nbsp;<span class="ident" id="2004636">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004652">case</span>&nbsp;<span class="ident" id="2004657">reflect</span><span class="op" id="2004664">.</span><span class="ident" id="2004665">Float64</span><span class="op" id="2004672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004676">return</span>&nbsp;<span class="ident" id="2004683">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004699">case</span>&nbsp;<span class="ident" id="2004704">reflect</span><span class="op" id="2004711">.</span><span class="ident" id="2004712">String</span><span class="op" id="2004718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004722">return</span>&nbsp;<span class="ident" id="2004729">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004744">case</span>&nbsp;<span class="ident" id="2004749">reflect</span><span class="op" id="2004756">.</span><span class="ident" id="2004757">Interface</span><span class="op" id="2004766">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004770">return</span>&nbsp;<span class="ident" id="2004777">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004795">case</span>&nbsp;<span class="ident" id="2004800">reflect</span><span class="op" id="2004807">.</span><span class="ident" id="2004808">Struct</span><span class="op" id="2004814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004818">return</span>&nbsp;<span class="ident" id="2004825">newStructEncoder</span><span class="op" id="2004841">(</span><span class="ident" id="2004842">t</span><span class="op" id="2004843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004846">case</span>&nbsp;<span class="ident" id="2004851">reflect</span><span class="op" id="2004858">.</span><span class="ident" id="2004859">Map</span><span class="op" id="2004862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004866">return</span>&nbsp;<span class="ident" id="2004873">newMapEncoder</span><span class="op" id="2004886">(</span><span class="ident" id="2004887">t</span><span class="op" id="2004888">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004891">case</span>&nbsp;<span class="ident" id="2004896">reflect</span><span class="op" id="2004903">.</span><span class="ident" id="2004904">Slice</span><span class="op" id="2004909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004913">return</span>&nbsp;<span class="ident" id="2004920">newSliceEncoder</span><span class="op" id="2004935">(</span><span class="ident" id="2004936">t</span><span class="op" id="2004937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004940">case</span>&nbsp;<span class="ident" id="2004945">reflect</span><span class="op" id="2004952">.</span><span class="ident" id="2004953">Array</span><span class="op" id="2004958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004962">return</span>&nbsp;<span class="ident" id="2004969">newArrayEncoder</span><span class="op" id="2004984">(</span><span class="ident" id="2004985">t</span><span class="op" id="2004986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2004989">case</span>&nbsp;<span class="ident" id="2004994">reflect</span><span class="op" id="2005001">.</span><span class="ident" id="2005002">Ptr</span><span class="op" id="2005005">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005009">return</span>&nbsp;<span class="ident" id="2005016">newPtrEncoder</span><span class="op" id="2005029">(</span><span class="ident" id="2005030">t</span><span class="op" id="2005031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005034">default</span><span class="op" id="2005041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005045">return</span>&nbsp;<span class="ident" id="2005052">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005076">}</span><br>
<span class="lineno"></span><span class="op" id="2005078">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="2005081">func</span>&nbsp;<span class="ident" id="2005086">invalidValueEncoder</span><span class="op" id="2005105">(</span><span class="ident" id="2005106">e</span>&nbsp;<span class="op" id="2005108">*</span><span class="ident" id="2005109">encodeState</span><span class="op" id="2005120">,</span>&nbsp;<span class="ident" id="2005122">v</span>&nbsp;<span class="ident" id="2005124">reflect</span><span class="op" id="2005131">.</span><span class="ident" id="2005132">Value</span><span class="op" id="2005137">,</span>&nbsp;<span class="ident" id="2005139">quoted</span>&nbsp;<span class="builtintype" id="2005146">bool</span><span class="op" id="2005150">)</span>&nbsp;<span class="op" id="2005152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005155">e</span><span class="op" id="2005156">.</span><span class="ident" id="2005157">WriteString</span><span class="op" id="2005168">(</span><span class="string" id="2005169">&#34;null&#34;</span><span class="op" id="2005175">)</span><br>
<span class="lineno"></span><span class="op" id="2005177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="2005180">func</span>&nbsp;<span class="ident" id="2005185">marshalerEncoder</span><span class="op" id="2005201">(</span><span class="ident" id="2005202">e</span>&nbsp;<span class="op" id="2005204">*</span><span class="ident" id="2005205">encodeState</span><span class="op" id="2005216">,</span>&nbsp;<span class="ident" id="2005218">v</span>&nbsp;<span class="ident" id="2005220">reflect</span><span class="op" id="2005227">.</span><span class="ident" id="2005228">Value</span><span class="op" id="2005233">,</span>&nbsp;<span class="ident" id="2005235">quoted</span>&nbsp;<span class="builtintype" id="2005242">bool</span><span class="op" id="2005246">)</span>&nbsp;<span class="op" id="2005248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005251">if</span>&nbsp;<span class="ident" id="2005254">v</span><span class="op" id="2005255">.</span><span class="ident" id="2005256">Kind</span><span class="op" id="2005260">(</span><span class="op" id="2005261">)</span>&nbsp;<span class="op" id="2005263">==</span>&nbsp;<span class="ident" id="2005266">reflect</span><span class="op" id="2005273">.</span><span class="ident" id="2005274">Ptr</span>&nbsp;<span class="op" id="2005278">&amp;&amp;</span>&nbsp;<span class="ident" id="2005281">v</span><span class="op" id="2005282">.</span><span class="ident" id="2005283">IsNil</span><span class="op" id="2005288">(</span><span class="op" id="2005289">)</span>&nbsp;<span class="op" id="2005291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005295">e</span><span class="op" id="2005296">.</span><span class="ident" id="2005297">WriteString</span><span class="op" id="2005308">(</span><span class="string" id="2005309">&#34;null&#34;</span><span class="op" id="2005315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005327">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005330">m</span>&nbsp;<span class="op" id="2005332">:=</span>&nbsp;<span class="ident" id="2005335">v</span><span class="op" id="2005336">.</span><span class="ident" id="2005337">Interface</span><span class="op" id="2005346">(</span><span class="op" id="2005347">)</span><span class="op" id="2005348">.</span><span class="op" id="2005349">(</span><span class="ident" id="2005350">Marshaler</span><span class="op" id="2005359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005362">b</span><span class="op" id="2005363">,</span>&nbsp;<span class="ident" id="2005365">err</span>&nbsp;<span class="op" id="2005369">:=</span>&nbsp;<span class="ident" id="2005372">m</span><span class="op" id="2005373">.</span><span class="ident" id="2005374">MarshalJSON</span><span class="op" id="2005385">(</span><span class="op" id="2005386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005389">if</span>&nbsp;<span class="ident" id="2005392">err</span>&nbsp;<span class="op" id="2005396">==</span>&nbsp;<span class="builtintype" id="2005399">nil</span>&nbsp;<span class="op" id="2005403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2005407">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005454">err</span>&nbsp;<span class="op" id="2005458">=</span>&nbsp;<span class="ident" id="2005460">compact</span><span class="op" id="2005467">(</span><span class="op" id="2005468">&amp;</span><span class="ident" id="2005469">e</span><span class="op" id="2005470">.</span><span class="ident" id="2005471">Buffer</span><span class="op" id="2005477">,</span>&nbsp;<span class="ident" id="2005479">b</span><span class="op" id="2005480">,</span>&nbsp;<span class="builtintype" id="2005482">true</span><span class="op" id="2005486">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005492">if</span>&nbsp;<span class="ident" id="2005495">err</span>&nbsp;<span class="op" id="2005499">!=</span>&nbsp;<span class="builtintype" id="2005502">nil</span>&nbsp;<span class="op" id="2005506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005510">e</span><span class="op" id="2005511">.</span><span class="builtintype" id="2005512">error</span><span class="op" id="2005517">(</span><span class="op" id="2005518">&amp;</span><span class="ident" id="2005519">MarshalerError</span><span class="op" id="2005533">{</span><span class="ident" id="2005534">v</span><span class="op" id="2005535">.</span><span class="ident" id="2005536">Type</span><span class="op" id="2005540">(</span><span class="op" id="2005541">)</span><span class="op" id="2005542">,</span>&nbsp;<span class="ident" id="2005544">err</span><span class="op" id="2005547">}</span><span class="op" id="2005548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005551">}</span><br>
<span class="lineno"></span><span class="op" id="2005553">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="2005556">func</span>&nbsp;<span class="ident" id="2005561">addrMarshalerEncoder</span><span class="op" id="2005581">(</span><span class="ident" id="2005582">e</span>&nbsp;<span class="op" id="2005584">*</span><span class="ident" id="2005585">encodeState</span><span class="op" id="2005596">,</span>&nbsp;<span class="ident" id="2005598">v</span>&nbsp;<span class="ident" id="2005600">reflect</span><span class="op" id="2005607">.</span><span class="ident" id="2005608">Value</span><span class="op" id="2005613">,</span>&nbsp;<span class="ident" id="2005615">quoted</span>&nbsp;<span class="builtintype" id="2005622">bool</span><span class="op" id="2005626">)</span>&nbsp;<span class="op" id="2005628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005631">va</span>&nbsp;<span class="op" id="2005634">:=</span>&nbsp;<span class="ident" id="2005637">v</span><span class="op" id="2005638">.</span><span class="ident" id="2005639">Addr</span><span class="op" id="2005643">(</span><span class="op" id="2005644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005647">if</span>&nbsp;<span class="ident" id="2005650">va</span><span class="op" id="2005652">.</span><span class="ident" id="2005653">IsNil</span><span class="op" id="2005658">(</span><span class="op" id="2005659">)</span>&nbsp;<span class="op" id="2005661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005665">e</span><span class="op" id="2005666">.</span><span class="ident" id="2005667">WriteString</span><span class="op" id="2005678">(</span><span class="string" id="2005679">&#34;null&#34;</span><span class="op" id="2005685">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005689">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005700">m</span>&nbsp;<span class="op" id="2005702">:=</span>&nbsp;<span class="ident" id="2005705">va</span><span class="op" id="2005707">.</span><span class="ident" id="2005708">Interface</span><span class="op" id="2005717">(</span><span class="op" id="2005718">)</span><span class="op" id="2005719">.</span><span class="op" id="2005720">(</span><span class="ident" id="2005721">Marshaler</span><span class="op" id="2005730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005733">b</span><span class="op" id="2005734">,</span>&nbsp;<span class="ident" id="2005736">err</span>&nbsp;<span class="op" id="2005740">:=</span>&nbsp;<span class="ident" id="2005743">m</span><span class="op" id="2005744">.</span><span class="ident" id="2005745">MarshalJSON</span><span class="op" id="2005756">(</span><span class="op" id="2005757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005760">if</span>&nbsp;<span class="ident" id="2005763">err</span>&nbsp;<span class="op" id="2005767">==</span>&nbsp;<span class="builtintype" id="2005770">nil</span>&nbsp;<span class="op" id="2005774">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2005778">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005825">err</span>&nbsp;<span class="op" id="2005829">=</span>&nbsp;<span class="ident" id="2005831">compact</span><span class="op" id="2005838">(</span><span class="op" id="2005839">&amp;</span><span class="ident" id="2005840">e</span><span class="op" id="2005841">.</span><span class="ident" id="2005842">Buffer</span><span class="op" id="2005848">,</span>&nbsp;<span class="ident" id="2005850">b</span><span class="op" id="2005851">,</span>&nbsp;<span class="builtintype" id="2005853">true</span><span class="op" id="2005857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2005863">if</span>&nbsp;<span class="ident" id="2005866">err</span>&nbsp;<span class="op" id="2005870">!=</span>&nbsp;<span class="builtintype" id="2005873">nil</span>&nbsp;<span class="op" id="2005877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2005881">e</span><span class="op" id="2005882">.</span><span class="builtintype" id="2005883">error</span><span class="op" id="2005888">(</span><span class="op" id="2005889">&amp;</span><span class="ident" id="2005890">MarshalerError</span><span class="op" id="2005904">{</span><span class="ident" id="2005905">v</span><span class="op" id="2005906">.</span><span class="ident" id="2005907">Type</span><span class="op" id="2005911">(</span><span class="op" id="2005912">)</span><span class="op" id="2005913">,</span>&nbsp;<span class="ident" id="2005915">err</span><span class="op" id="2005918">}</span><span class="op" id="2005919">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005922">}</span><br>
<span class="lineno"></span><span class="op" id="2005924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2005927">func</span>&nbsp;<span class="ident" id="2005932">textMarshalerEncoder</span><span class="op" id="2005952">(</span><span class="ident" id="2005953">e</span>&nbsp;<span class="op" id="2005955">*</span><span class="ident" id="2005956">encodeState</span><span class="op" id="2005967">,</span>&nbsp;<span class="ident" id="2005969">v</span>&nbsp;<span class="ident" id="2005971">reflect</span><span class="op" id="2005978">.</span><span class="ident" id="2005979">Value</span><span class="op" id="2005984">,</span>&nbsp;<span class="ident" id="2005986">quoted</span>&nbsp;<span class="builtintype" id="2005993">bool</span><span class="op" id="2005997">)</span>&nbsp;<span class="op" id="2005999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006002">if</span>&nbsp;<span class="ident" id="2006005">v</span><span class="op" id="2006006">.</span><span class="ident" id="2006007">Kind</span><span class="op" id="2006011">(</span><span class="op" id="2006012">)</span>&nbsp;<span class="op" id="2006014">==</span>&nbsp;<span class="ident" id="2006017">reflect</span><span class="op" id="2006024">.</span><span class="ident" id="2006025">Ptr</span>&nbsp;<span class="op" id="2006029">&amp;&amp;</span>&nbsp;<span class="ident" id="2006032">v</span><span class="op" id="2006033">.</span><span class="ident" id="2006034">IsNil</span><span class="op" id="2006039">(</span><span class="op" id="2006040">)</span>&nbsp;<span class="op" id="2006042">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006046">e</span><span class="op" id="2006047">.</span><span class="ident" id="2006048">WriteString</span><span class="op" id="2006059">(</span><span class="string" id="2006060">&#34;null&#34;</span><span class="op" id="2006066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006070">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006081">m</span>&nbsp;<span class="op" id="2006083">:=</span>&nbsp;<span class="ident" id="2006086">v</span><span class="op" id="2006087">.</span><span class="ident" id="2006088">Interface</span><span class="op" id="2006097">(</span><span class="op" id="2006098">)</span><span class="op" id="2006099">.</span><span class="op" id="2006100">(</span><span class="ident" id="2006101">encoding</span><span class="op" id="2006109">.</span><span class="ident" id="2006110">TextMarshaler</span><span class="op" id="2006123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006126">b</span><span class="op" id="2006127">,</span>&nbsp;<span class="ident" id="2006129">err</span>&nbsp;<span class="op" id="2006133">:=</span>&nbsp;<span class="ident" id="2006136">m</span><span class="op" id="2006137">.</span><span class="ident" id="2006138">MarshalText</span><span class="op" id="2006149">(</span><span class="op" id="2006150">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006153">if</span>&nbsp;<span class="ident" id="2006156">err</span>&nbsp;<span class="op" id="2006160">==</span>&nbsp;<span class="builtintype" id="2006163">nil</span>&nbsp;<span class="op" id="2006167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006171">_</span><span class="op" id="2006172">,</span>&nbsp;<span class="ident" id="2006174">err</span>&nbsp;<span class="op" id="2006178">=</span>&nbsp;<span class="ident" id="2006180">e</span><span class="op" id="2006181">.</span><span class="ident" id="2006182">stringBytes</span><span class="op" id="2006193">(</span><span class="ident" id="2006194">b</span><span class="op" id="2006195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006201">if</span>&nbsp;<span class="ident" id="2006204">err</span>&nbsp;<span class="op" id="2006208">!=</span>&nbsp;<span class="builtintype" id="2006211">nil</span>&nbsp;<span class="op" id="2006215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006219">e</span><span class="op" id="2006220">.</span><span class="builtintype" id="2006221">error</span><span class="op" id="2006226">(</span><span class="op" id="2006227">&amp;</span><span class="ident" id="2006228">MarshalerError</span><span class="op" id="2006242">{</span><span class="ident" id="2006243">v</span><span class="op" id="2006244">.</span><span class="ident" id="2006245">Type</span><span class="op" id="2006249">(</span><span class="op" id="2006250">)</span><span class="op" id="2006251">,</span>&nbsp;<span class="ident" id="2006253">err</span><span class="op" id="2006256">}</span><span class="op" id="2006257">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006260">}</span><br>
<span class="lineno"></span><span class="op" id="2006262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2006265">func</span>&nbsp;<span class="ident" id="2006270">addrTextMarshalerEncoder</span><span class="op" id="2006294">(</span><span class="ident" id="2006295">e</span>&nbsp;<span class="op" id="2006297">*</span><span class="ident" id="2006298">encodeState</span><span class="op" id="2006309">,</span>&nbsp;<span class="ident" id="2006311">v</span>&nbsp;<span class="ident" id="2006313">reflect</span><span class="op" id="2006320">.</span><span class="ident" id="2006321">Value</span><span class="op" id="2006326">,</span>&nbsp;<span class="ident" id="2006328">quoted</span>&nbsp;<span class="builtintype" id="2006335">bool</span><span class="op" id="2006339">)</span>&nbsp;<span class="op" id="2006341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006344">va</span>&nbsp;<span class="op" id="2006347">:=</span>&nbsp;<span class="ident" id="2006350">v</span><span class="op" id="2006351">.</span><span class="ident" id="2006352">Addr</span><span class="op" id="2006356">(</span><span class="op" id="2006357">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006360">if</span>&nbsp;<span class="ident" id="2006363">va</span><span class="op" id="2006365">.</span><span class="ident" id="2006366">IsNil</span><span class="op" id="2006371">(</span><span class="op" id="2006372">)</span>&nbsp;<span class="op" id="2006374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006378">e</span><span class="op" id="2006379">.</span><span class="ident" id="2006380">WriteString</span><span class="op" id="2006391">(</span><span class="string" id="2006392">&#34;null&#34;</span><span class="op" id="2006398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006402">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006413">m</span>&nbsp;<span class="op" id="2006415">:=</span>&nbsp;<span class="ident" id="2006418">va</span><span class="op" id="2006420">.</span><span class="ident" id="2006421">Interface</span><span class="op" id="2006430">(</span><span class="op" id="2006431">)</span><span class="op" id="2006432">.</span><span class="op" id="2006433">(</span><span class="ident" id="2006434">encoding</span><span class="op" id="2006442">.</span><span class="ident" id="2006443">TextMarshaler</span><span class="op" id="2006456">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006459">b</span><span class="op" id="2006460">,</span>&nbsp;<span class="ident" id="2006462">err</span>&nbsp;<span class="op" id="2006466">:=</span>&nbsp;<span class="ident" id="2006469">m</span><span class="op" id="2006470">.</span><span class="ident" id="2006471">MarshalText</span><span class="op" id="2006482">(</span><span class="op" id="2006483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006486">if</span>&nbsp;<span class="ident" id="2006489">err</span>&nbsp;<span class="op" id="2006493">==</span>&nbsp;<span class="builtintype" id="2006496">nil</span>&nbsp;<span class="op" id="2006500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006504">_</span><span class="op" id="2006505">,</span>&nbsp;<span class="ident" id="2006507">err</span>&nbsp;<span class="op" id="2006511">=</span>&nbsp;<span class="ident" id="2006513">e</span><span class="op" id="2006514">.</span><span class="ident" id="2006515">stringBytes</span><span class="op" id="2006526">(</span><span class="ident" id="2006527">b</span><span class="op" id="2006528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006534">if</span>&nbsp;<span class="ident" id="2006537">err</span>&nbsp;<span class="op" id="2006541">!=</span>&nbsp;<span class="builtintype" id="2006544">nil</span>&nbsp;<span class="op" id="2006548">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006552">e</span><span class="op" id="2006553">.</span><span class="builtintype" id="2006554">error</span><span class="op" id="2006559">(</span><span class="op" id="2006560">&amp;</span><span class="ident" id="2006561">MarshalerError</span><span class="op" id="2006575">{</span><span class="ident" id="2006576">v</span><span class="op" id="2006577">.</span><span class="ident" id="2006578">Type</span><span class="op" id="2006582">(</span><span class="op" id="2006583">)</span><span class="op" id="2006584">,</span>&nbsp;<span class="ident" id="2006586">err</span><span class="op" id="2006589">}</span><span class="op" id="2006590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006593">}</span><br>
<span class="lineno"></span><span class="op" id="2006595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2006598">func</span>&nbsp;<span class="ident" id="2006603">boolEncoder</span><span class="op" id="2006614">(</span><span class="ident" id="2006615">e</span>&nbsp;<span class="op" id="2006617">*</span><span class="ident" id="2006618">encodeState</span><span class="op" id="2006629">,</span>&nbsp;<span class="ident" id="2006631">v</span>&nbsp;<span class="ident" id="2006633">reflect</span><span class="op" id="2006640">.</span><span class="ident" id="2006641">Value</span><span class="op" id="2006646">,</span>&nbsp;<span class="ident" id="2006648">quoted</span>&nbsp;<span class="builtintype" id="2006655">bool</span><span class="op" id="2006659">)</span>&nbsp;<span class="op" id="2006661">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006664">if</span>&nbsp;<span class="ident" id="2006667">quoted</span>&nbsp;<span class="op" id="2006674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006678">e</span><span class="op" id="2006679">.</span><span class="ident" id="2006680">WriteByte</span><span class="op" id="2006689">(</span><span class="string" id="2006690">&#39;&#34;&#39;</span><span class="op" id="2006693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006699">if</span>&nbsp;<span class="ident" id="2006702">v</span><span class="op" id="2006703">.</span><span class="ident" id="2006704">Bool</span><span class="op" id="2006708">(</span><span class="op" id="2006709">)</span>&nbsp;<span class="op" id="2006711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006715">e</span><span class="op" id="2006716">.</span><span class="ident" id="2006717">WriteString</span><span class="op" id="2006728">(</span><span class="string" id="2006729">&#34;true&#34;</span><span class="op" id="2006735">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006738">}</span>&nbsp;<span class="keyword" id="2006740">else</span>&nbsp;<span class="op" id="2006745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006749">e</span><span class="op" id="2006750">.</span><span class="ident" id="2006751">WriteString</span><span class="op" id="2006762">(</span><span class="string" id="2006763">&#34;false&#34;</span><span class="op" id="2006770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006776">if</span>&nbsp;<span class="ident" id="2006779">quoted</span>&nbsp;<span class="op" id="2006786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006790">e</span><span class="op" id="2006791">.</span><span class="ident" id="2006792">WriteByte</span><span class="op" id="2006801">(</span><span class="string" id="2006802">&#39;&#34;&#39;</span><span class="op" id="2006805">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006808">}</span><br>
<span class="lineno"></span><span class="op" id="2006810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2006813">func</span>&nbsp;<span class="ident" id="2006818">intEncoder</span><span class="op" id="2006828">(</span><span class="ident" id="2006829">e</span>&nbsp;<span class="op" id="2006831">*</span><span class="ident" id="2006832">encodeState</span><span class="op" id="2006843">,</span>&nbsp;<span class="ident" id="2006845">v</span>&nbsp;<span class="ident" id="2006847">reflect</span><span class="op" id="2006854">.</span><span class="ident" id="2006855">Value</span><span class="op" id="2006860">,</span>&nbsp;<span class="ident" id="2006862">quoted</span>&nbsp;<span class="builtintype" id="2006869">bool</span><span class="op" id="2006873">)</span>&nbsp;<span class="op" id="2006875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006878">b</span>&nbsp;<span class="op" id="2006880">:=</span>&nbsp;<span class="ident" id="2006883">strconv</span><span class="op" id="2006890">.</span><span class="ident" id="2006891">AppendInt</span><span class="op" id="2006900">(</span><span class="ident" id="2006901">e</span><span class="op" id="2006902">.</span><span class="ident" id="2006903">scratch</span><span class="op" id="2006910">[</span><span class="op" id="2006911">:</span><span class="num" id="2006912">0</span><span class="op" id="2006913">]</span><span class="op" id="2006914">,</span>&nbsp;<span class="ident" id="2006916">v</span><span class="op" id="2006917">.</span><span class="ident" id="2006918">Int</span><span class="op" id="2006921">(</span><span class="op" id="2006922">)</span><span class="op" id="2006923">,</span>&nbsp;<span class="num" id="2006925">10</span><span class="op" id="2006927">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006930">if</span>&nbsp;<span class="ident" id="2006933">quoted</span>&nbsp;<span class="op" id="2006940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006944">e</span><span class="op" id="2006945">.</span><span class="ident" id="2006946">WriteByte</span><span class="op" id="2006955">(</span><span class="string" id="2006956">&#39;&#34;&#39;</span><span class="op" id="2006959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2006962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006965">e</span><span class="op" id="2006966">.</span><span class="ident" id="2006967">Write</span><span class="op" id="2006972">(</span><span class="ident" id="2006973">b</span><span class="op" id="2006974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2006977">if</span>&nbsp;<span class="ident" id="2006980">quoted</span>&nbsp;<span class="op" id="2006987">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2006991">e</span><span class="op" id="2006992">.</span><span class="ident" id="2006993">WriteByte</span><span class="op" id="2007002">(</span><span class="string" id="2007003">&#39;&#34;&#39;</span><span class="op" id="2007006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007009">}</span><br>
<span class="lineno"></span><span class="op" id="2007011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2007014">func</span>&nbsp;<span class="ident" id="2007019">uintEncoder</span><span class="op" id="2007030">(</span><span class="ident" id="2007031">e</span>&nbsp;<span class="op" id="2007033">*</span><span class="ident" id="2007034">encodeState</span><span class="op" id="2007045">,</span>&nbsp;<span class="ident" id="2007047">v</span>&nbsp;<span class="ident" id="2007049">reflect</span><span class="op" id="2007056">.</span><span class="ident" id="2007057">Value</span><span class="op" id="2007062">,</span>&nbsp;<span class="ident" id="2007064">quoted</span>&nbsp;<span class="builtintype" id="2007071">bool</span><span class="op" id="2007075">)</span>&nbsp;<span class="op" id="2007077">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007080">b</span>&nbsp;<span class="op" id="2007082">:=</span>&nbsp;<span class="ident" id="2007085">strconv</span><span class="op" id="2007092">.</span><span class="ident" id="2007093">AppendUint</span><span class="op" id="2007103">(</span><span class="ident" id="2007104">e</span><span class="op" id="2007105">.</span><span class="ident" id="2007106">scratch</span><span class="op" id="2007113">[</span><span class="op" id="2007114">:</span><span class="num" id="2007115">0</span><span class="op" id="2007116">]</span><span class="op" id="2007117">,</span>&nbsp;<span class="ident" id="2007119">v</span><span class="op" id="2007120">.</span><span class="ident" id="2007121">Uint</span><span class="op" id="2007125">(</span><span class="op" id="2007126">)</span><span class="op" id="2007127">,</span>&nbsp;<span class="num" id="2007129">10</span><span class="op" id="2007131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007134">if</span>&nbsp;<span class="ident" id="2007137">quoted</span>&nbsp;<span class="op" id="2007144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007148">e</span><span class="op" id="2007149">.</span><span class="ident" id="2007150">WriteByte</span><span class="op" id="2007159">(</span><span class="string" id="2007160">&#39;&#34;&#39;</span><span class="op" id="2007163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007169">e</span><span class="op" id="2007170">.</span><span class="ident" id="2007171">Write</span><span class="op" id="2007176">(</span><span class="ident" id="2007177">b</span><span class="op" id="2007178">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007181">if</span>&nbsp;<span class="ident" id="2007184">quoted</span>&nbsp;<span class="op" id="2007191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007195">e</span><span class="op" id="2007196">.</span><span class="ident" id="2007197">WriteByte</span><span class="op" id="2007206">(</span><span class="string" id="2007207">&#39;&#34;&#39;</span><span class="op" id="2007210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007213">}</span><br>
<span class="lineno"></span><span class="op" id="2007215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="2007218">type</span>&nbsp;<span class="ident" id="2007223">floatEncoder</span>&nbsp;<span class="builtintype" id="2007236">int</span>&nbsp;<span class="comment" id="2007240">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2007259">func</span>&nbsp;<span class="op" id="2007264">(</span><span class="ident" id="2007265">bits</span>&nbsp;<span class="ident" id="2007270">floatEncoder</span><span class="op" id="2007282">)</span>&nbsp;<span class="ident" id="2007284">encode</span><span class="op" id="2007290">(</span><span class="ident" id="2007291">e</span>&nbsp;<span class="op" id="2007293">*</span><span class="ident" id="2007294">encodeState</span><span class="op" id="2007305">,</span>&nbsp;<span class="ident" id="2007307">v</span>&nbsp;<span class="ident" id="2007309">reflect</span><span class="op" id="2007316">.</span><span class="ident" id="2007317">Value</span><span class="op" id="2007322">,</span>&nbsp;<span class="ident" id="2007324">quoted</span>&nbsp;<span class="builtintype" id="2007331">bool</span><span class="op" id="2007335">)</span>&nbsp;<span class="op" id="2007337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007340">f</span>&nbsp;<span class="op" id="2007342">:=</span>&nbsp;<span class="ident" id="2007345">v</span><span class="op" id="2007346">.</span><span class="ident" id="2007347">Float</span><span class="op" id="2007352">(</span><span class="op" id="2007353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007356">if</span>&nbsp;<span class="ident" id="2007359">math</span><span class="op" id="2007363">.</span><span class="ident" id="2007364">IsInf</span><span class="op" id="2007369">(</span><span class="ident" id="2007370">f</span><span class="op" id="2007371">,</span>&nbsp;<span class="num" id="2007373">0</span><span class="op" id="2007374">)</span>&nbsp;<span class="op" id="2007376">||</span>&nbsp;<span class="ident" id="2007379">math</span><span class="op" id="2007383">.</span><span class="ident" id="2007384">IsNaN</span><span class="op" id="2007389">(</span><span class="ident" id="2007390">f</span><span class="op" id="2007391">)</span>&nbsp;<span class="op" id="2007393">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007397">e</span><span class="op" id="2007398">.</span><span class="builtintype" id="2007399">error</span><span class="op" id="2007404">(</span><span class="op" id="2007405">&amp;</span><span class="ident" id="2007406">UnsupportedValueError</span><span class="op" id="2007427">{</span><span class="ident" id="2007428">v</span><span class="op" id="2007429">,</span>&nbsp;<span class="ident" id="2007431">strconv</span><span class="op" id="2007438">.</span><span class="ident" id="2007439">FormatFloat</span><span class="op" id="2007450">(</span><span class="ident" id="2007451">f</span><span class="op" id="2007452">,</span>&nbsp;<span class="string" id="2007454">&#39;g&#39;</span><span class="op" id="2007457">,</span>&nbsp;<span class="op" id="2007459">-</span><span class="num" id="2007460">1</span><span class="op" id="2007461">,</span>&nbsp;<span class="builtintype" id="2007463">int</span><span class="op" id="2007466">(</span><span class="ident" id="2007467">bits</span><span class="op" id="2007471">)</span><span class="op" id="2007472">)</span><span class="op" id="2007473">}</span><span class="op" id="2007474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007480">b</span>&nbsp;<span class="op" id="2007482">:=</span>&nbsp;<span class="ident" id="2007485">strconv</span><span class="op" id="2007492">.</span><span class="ident" id="2007493">AppendFloat</span><span class="op" id="2007504">(</span><span class="ident" id="2007505">e</span><span class="op" id="2007506">.</span><span class="ident" id="2007507">scratch</span><span class="op" id="2007514">[</span><span class="op" id="2007515">:</span><span class="num" id="2007516">0</span><span class="op" id="2007517">]</span><span class="op" id="2007518">,</span>&nbsp;<span class="ident" id="2007520">f</span><span class="op" id="2007521">,</span>&nbsp;<span class="string" id="2007523">&#39;g&#39;</span><span class="op" id="2007526">,</span>&nbsp;<span class="op" id="2007528">-</span><span class="num" id="2007529">1</span><span class="op" id="2007530">,</span>&nbsp;<span class="builtintype" id="2007532">int</span><span class="op" id="2007535">(</span><span class="ident" id="2007536">bits</span><span class="op" id="2007540">)</span><span class="op" id="2007541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007544">if</span>&nbsp;<span class="ident" id="2007547">quoted</span>&nbsp;<span class="op" id="2007554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007558">e</span><span class="op" id="2007559">.</span><span class="ident" id="2007560">WriteByte</span><span class="op" id="2007569">(</span><span class="string" id="2007570">&#39;&#34;&#39;</span><span class="op" id="2007573">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007579">e</span><span class="op" id="2007580">.</span><span class="ident" id="2007581">Write</span><span class="op" id="2007586">(</span><span class="ident" id="2007587">b</span><span class="op" id="2007588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007591">if</span>&nbsp;<span class="ident" id="2007594">quoted</span>&nbsp;<span class="op" id="2007601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007605">e</span><span class="op" id="2007606">.</span><span class="ident" id="2007607">WriteByte</span><span class="op" id="2007616">(</span><span class="string" id="2007617">&#39;&#34;&#39;</span><span class="op" id="2007620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007623">}</span><br>
<span class="lineno">525</span><span class="op" id="2007625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2007628">var</span>&nbsp;<span class="op" id="2007632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007635">float32Encoder</span>&nbsp;<span class="op" id="2007650">=</span>&nbsp;<span class="op" id="2007652">(</span><span class="ident" id="2007653">floatEncoder</span><span class="op" id="2007665">(</span><span class="num" id="2007666">32</span><span class="op" id="2007668">)</span><span class="op" id="2007669">)</span><span class="op" id="2007670">.</span><span class="ident" id="2007671">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007679">float64Encoder</span>&nbsp;<span class="op" id="2007694">=</span>&nbsp;<span class="op" id="2007696">(</span><span class="ident" id="2007697">floatEncoder</span><span class="op" id="2007709">(</span><span class="num" id="2007710">64</span><span class="op" id="2007712">)</span><span class="op" id="2007713">)</span><span class="op" id="2007714">.</span><span class="ident" id="2007715">encode</span><br>
<span class="lineno">530</span><span class="op" id="2007722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2007725">func</span>&nbsp;<span class="ident" id="2007730">stringEncoder</span><span class="op" id="2007743">(</span><span class="ident" id="2007744">e</span>&nbsp;<span class="op" id="2007746">*</span><span class="ident" id="2007747">encodeState</span><span class="op" id="2007758">,</span>&nbsp;<span class="ident" id="2007760">v</span>&nbsp;<span class="ident" id="2007762">reflect</span><span class="op" id="2007769">.</span><span class="ident" id="2007770">Value</span><span class="op" id="2007775">,</span>&nbsp;<span class="ident" id="2007777">quoted</span>&nbsp;<span class="builtintype" id="2007784">bool</span><span class="op" id="2007788">)</span>&nbsp;<span class="op" id="2007790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007793">if</span>&nbsp;<span class="ident" id="2007796">v</span><span class="op" id="2007797">.</span><span class="ident" id="2007798">Type</span><span class="op" id="2007802">(</span><span class="op" id="2007803">)</span>&nbsp;<span class="op" id="2007805">==</span>&nbsp;<span class="ident" id="2007808">numberType</span>&nbsp;<span class="op" id="2007819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007823">numStr</span>&nbsp;<span class="op" id="2007830">:=</span>&nbsp;<span class="ident" id="2007833">v</span><span class="op" id="2007834">.</span><span class="ident" id="2007835">String</span><span class="op" id="2007841">(</span><span class="op" id="2007842">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007846">if</span>&nbsp;<span class="ident" id="2007849">numStr</span>&nbsp;<span class="op" id="2007856">==</span>&nbsp;<span class="string" id="2007859">&#34;&#34;</span>&nbsp;<span class="op" id="2007862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007867">numStr</span>&nbsp;<span class="op" id="2007874">=</span>&nbsp;<span class="string" id="2007876">&#34;0&#34;</span>&nbsp;<span class="comment" id="2007880">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007907">e</span><span class="op" id="2007908">.</span><span class="ident" id="2007909">WriteString</span><span class="op" id="2007920">(</span><span class="ident" id="2007921">numStr</span><span class="op" id="2007927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007931">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2007939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007942">if</span>&nbsp;<span class="ident" id="2007945">quoted</span>&nbsp;<span class="op" id="2007952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2007956">sb</span><span class="op" id="2007958">,</span>&nbsp;<span class="ident" id="2007960">err</span>&nbsp;<span class="op" id="2007964">:=</span>&nbsp;<span class="ident" id="2007967">Marshal</span><span class="op" id="2007974">(</span><span class="ident" id="2007975">v</span><span class="op" id="2007976">.</span><span class="ident" id="2007977">String</span><span class="op" id="2007983">(</span><span class="op" id="2007984">)</span><span class="op" id="2007985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2007989">if</span>&nbsp;<span class="ident" id="2007992">err</span>&nbsp;<span class="op" id="2007996">!=</span>&nbsp;<span class="builtintype" id="2007999">nil</span>&nbsp;<span class="op" id="2008003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008008">e</span><span class="op" id="2008009">.</span><span class="builtintype" id="2008010">error</span><span class="op" id="2008015">(</span><span class="ident" id="2008016">err</span><span class="op" id="2008019">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008027">e</span><span class="op" id="2008028">.</span><span class="builtintype" id="2008029">string</span><span class="op" id="2008035">(</span><span class="builtintype" id="2008036">string</span><span class="op" id="2008042">(</span><span class="ident" id="2008043">sb</span><span class="op" id="2008045">)</span><span class="op" id="2008046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008049">}</span>&nbsp;<span class="keyword" id="2008051">else</span>&nbsp;<span class="op" id="2008056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008060">e</span><span class="op" id="2008061">.</span><span class="builtintype" id="2008062">string</span><span class="op" id="2008068">(</span><span class="ident" id="2008069">v</span><span class="op" id="2008070">.</span><span class="ident" id="2008071">String</span><span class="op" id="2008077">(</span><span class="op" id="2008078">)</span><span class="op" id="2008079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008082">}</span><br>
<span class="lineno">550</span><span class="op" id="2008084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008087">func</span>&nbsp;<span class="ident" id="2008092">interfaceEncoder</span><span class="op" id="2008108">(</span><span class="ident" id="2008109">e</span>&nbsp;<span class="op" id="2008111">*</span><span class="ident" id="2008112">encodeState</span><span class="op" id="2008123">,</span>&nbsp;<span class="ident" id="2008125">v</span>&nbsp;<span class="ident" id="2008127">reflect</span><span class="op" id="2008134">.</span><span class="ident" id="2008135">Value</span><span class="op" id="2008140">,</span>&nbsp;<span class="ident" id="2008142">quoted</span>&nbsp;<span class="builtintype" id="2008149">bool</span><span class="op" id="2008153">)</span>&nbsp;<span class="op" id="2008155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008158">if</span>&nbsp;<span class="ident" id="2008161">v</span><span class="op" id="2008162">.</span><span class="ident" id="2008163">IsNil</span><span class="op" id="2008168">(</span><span class="op" id="2008169">)</span>&nbsp;<span class="op" id="2008171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008175">e</span><span class="op" id="2008176">.</span><span class="ident" id="2008177">WriteString</span><span class="op" id="2008188">(</span><span class="string" id="2008189">&#34;null&#34;</span><span class="op" id="2008195">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008199">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008210">e</span><span class="op" id="2008211">.</span><span class="ident" id="2008212">reflectValue</span><span class="op" id="2008224">(</span><span class="ident" id="2008225">v</span><span class="op" id="2008226">.</span><span class="ident" id="2008227">Elem</span><span class="op" id="2008231">(</span><span class="op" id="2008232">)</span><span class="op" id="2008233">)</span><br>
<span class="lineno"></span><span class="op" id="2008235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="2008238">func</span>&nbsp;<span class="ident" id="2008243">unsupportedTypeEncoder</span><span class="op" id="2008265">(</span><span class="ident" id="2008266">e</span>&nbsp;<span class="op" id="2008268">*</span><span class="ident" id="2008269">encodeState</span><span class="op" id="2008280">,</span>&nbsp;<span class="ident" id="2008282">v</span>&nbsp;<span class="ident" id="2008284">reflect</span><span class="op" id="2008291">.</span><span class="ident" id="2008292">Value</span><span class="op" id="2008297">,</span>&nbsp;<span class="ident" id="2008299">quoted</span>&nbsp;<span class="builtintype" id="2008306">bool</span><span class="op" id="2008310">)</span>&nbsp;<span class="op" id="2008312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008315">e</span><span class="op" id="2008316">.</span><span class="builtintype" id="2008317">error</span><span class="op" id="2008322">(</span><span class="op" id="2008323">&amp;</span><span class="ident" id="2008324">UnsupportedTypeError</span><span class="op" id="2008344">{</span><span class="ident" id="2008345">v</span><span class="op" id="2008346">.</span><span class="ident" id="2008347">Type</span><span class="op" id="2008351">(</span><span class="op" id="2008352">)</span><span class="op" id="2008353">}</span><span class="op" id="2008354">)</span><br>
<span class="lineno"></span><span class="op" id="2008356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008359">type</span>&nbsp;<span class="ident" id="2008364">structEncoder</span>&nbsp;<span class="keyword" id="2008378">struct</span>&nbsp;<span class="op" id="2008385">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008388">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008398">[</span><span class="op" id="2008399">]</span><span class="ident" id="2008400">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008407">fieldEncs</span>&nbsp;<span class="op" id="2008417">[</span><span class="op" id="2008418">]</span><span class="ident" id="2008419">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2008431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008434">func</span>&nbsp;<span class="op" id="2008439">(</span><span class="ident" id="2008440">se</span>&nbsp;<span class="op" id="2008443">*</span><span class="ident" id="2008444">structEncoder</span><span class="op" id="2008457">)</span>&nbsp;<span class="ident" id="2008459">encode</span><span class="op" id="2008465">(</span><span class="ident" id="2008466">e</span>&nbsp;<span class="op" id="2008468">*</span><span class="ident" id="2008469">encodeState</span><span class="op" id="2008480">,</span>&nbsp;<span class="ident" id="2008482">v</span>&nbsp;<span class="ident" id="2008484">reflect</span><span class="op" id="2008491">.</span><span class="ident" id="2008492">Value</span><span class="op" id="2008497">,</span>&nbsp;<span class="ident" id="2008499">quoted</span>&nbsp;<span class="builtintype" id="2008506">bool</span><span class="op" id="2008510">)</span>&nbsp;<span class="op" id="2008512">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008515">e</span><span class="op" id="2008516">.</span><span class="ident" id="2008517">WriteByte</span><span class="op" id="2008526">(</span><span class="string" id="2008527">&#39;{&#39;</span><span class="op" id="2008530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008533">first</span>&nbsp;<span class="op" id="2008539">:=</span>&nbsp;<span class="builtintype" id="2008542">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008548">for</span>&nbsp;<span class="ident" id="2008552">i</span><span class="op" id="2008553">,</span>&nbsp;<span class="ident" id="2008555">f</span>&nbsp;<span class="op" id="2008557">:=</span>&nbsp;<span class="keyword" id="2008560">range</span>&nbsp;<span class="ident" id="2008566">se</span><span class="op" id="2008568">.</span><span class="ident" id="2008569">fields</span>&nbsp;<span class="op" id="2008576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008580">fv</span>&nbsp;<span class="op" id="2008583">:=</span>&nbsp;<span class="ident" id="2008586">fieldByIndex</span><span class="op" id="2008598">(</span><span class="ident" id="2008599">v</span><span class="op" id="2008600">,</span>&nbsp;<span class="ident" id="2008602">f</span><span class="op" id="2008603">.</span><span class="ident" id="2008604">index</span><span class="op" id="2008609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008613">if</span>&nbsp;<span class="op" id="2008616">!</span><span class="ident" id="2008617">fv</span><span class="op" id="2008619">.</span><span class="ident" id="2008620">IsValid</span><span class="op" id="2008627">(</span><span class="op" id="2008628">)</span>&nbsp;<span class="op" id="2008630">||</span>&nbsp;<span class="ident" id="2008633">f</span><span class="op" id="2008634">.</span><span class="ident" id="2008635">omitEmpty</span>&nbsp;<span class="op" id="2008645">&amp;&amp;</span>&nbsp;<span class="ident" id="2008648">isEmptyValue</span><span class="op" id="2008660">(</span><span class="ident" id="2008661">fv</span><span class="op" id="2008663">)</span>&nbsp;<span class="op" id="2008665">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008670">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2008685">if</span>&nbsp;<span class="ident" id="2008688">first</span>&nbsp;<span class="op" id="2008694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008699">first</span>&nbsp;<span class="op" id="2008705">=</span>&nbsp;<span class="builtintype" id="2008707">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008715">}</span>&nbsp;<span class="keyword" id="2008717">else</span>&nbsp;<span class="op" id="2008722">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008727">e</span><span class="op" id="2008728">.</span><span class="ident" id="2008729">WriteByte</span><span class="op" id="2008738">(</span><span class="string" id="2008739">&#39;,&#39;</span><span class="op" id="2008742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008750">e</span><span class="op" id="2008751">.</span><span class="builtintype" id="2008752">string</span><span class="op" id="2008758">(</span><span class="ident" id="2008759">f</span><span class="op" id="2008760">.</span><span class="ident" id="2008761">name</span><span class="op" id="2008765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008769">e</span><span class="op" id="2008770">.</span><span class="ident" id="2008771">WriteByte</span><span class="op" id="2008780">(</span><span class="string" id="2008781">&#39;:&#39;</span><span class="op" id="2008784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008788">se</span><span class="op" id="2008790">.</span><span class="ident" id="2008791">fieldEncs</span><span class="op" id="2008800">[</span><span class="ident" id="2008801">i</span><span class="op" id="2008802">]</span><span class="op" id="2008803">(</span><span class="ident" id="2008804">e</span><span class="op" id="2008805">,</span>&nbsp;<span class="ident" id="2008807">fv</span><span class="op" id="2008809">,</span>&nbsp;<span class="ident" id="2008811">f</span><span class="op" id="2008812">.</span><span class="ident" id="2008813">quoted</span><span class="op" id="2008819">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2008822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008825">e</span><span class="op" id="2008826">.</span><span class="ident" id="2008827">WriteByte</span><span class="op" id="2008836">(</span><span class="string" id="2008837">&#39;}&#39;</span><span class="op" id="2008840">)</span><br>
<span class="lineno"></span><span class="op" id="2008842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008845">func</span>&nbsp;<span class="ident" id="2008850">newStructEncoder</span><span class="op" id="2008866">(</span><span class="ident" id="2008867">t</span>&nbsp;<span class="ident" id="2008869">reflect</span><span class="op" id="2008876">.</span><span class="ident" id="2008877">Type</span><span class="op" id="2008881">)</span>&nbsp;<span class="ident" id="2008883">encoderFunc</span>&nbsp;<span class="op" id="2008895">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008898">fields</span>&nbsp;<span class="op" id="2008905">:=</span>&nbsp;<span class="ident" id="2008908">cachedTypeFields</span><span class="op" id="2008924">(</span><span class="ident" id="2008925">t</span><span class="op" id="2008926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008929">se</span>&nbsp;<span class="op" id="2008932">:=</span>&nbsp;<span class="op" id="2008935">&amp;</span><span class="ident" id="2008936">structEncoder</span><span class="op" id="2008949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008953">fields</span><span class="op" id="2008959">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008964">fields</span><span class="op" id="2008970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2008974">fieldEncs</span><span class="op" id="2008983">:</span>&nbsp;<span class="builtinfunc" id="2008985">make</span><span class="op" id="2008989">(</span><span class="op" id="2008990">[</span><span class="op" id="2008991">]</span><span class="ident" id="2008992">encoderFunc</span><span class="op" id="2009003">,</span>&nbsp;<span class="builtinfunc" id="2009005">len</span><span class="op" id="2009008">(</span><span class="ident" id="2009009">fields</span><span class="op" id="2009015">)</span><span class="op" id="2009016">)</span><span class="op" id="2009017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009020">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009023">for</span>&nbsp;<span class="ident" id="2009027">i</span><span class="op" id="2009028">,</span>&nbsp;<span class="ident" id="2009030">f</span>&nbsp;<span class="op" id="2009032">:=</span>&nbsp;<span class="keyword" id="2009035">range</span>&nbsp;<span class="ident" id="2009041">fields</span>&nbsp;<span class="op" id="2009048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009052">se</span><span class="op" id="2009054">.</span><span class="ident" id="2009055">fieldEncs</span><span class="op" id="2009064">[</span><span class="ident" id="2009065">i</span><span class="op" id="2009066">]</span>&nbsp;<span class="op" id="2009068">=</span>&nbsp;<span class="ident" id="2009070">typeEncoder</span><span class="op" id="2009081">(</span><span class="ident" id="2009082">typeByIndex</span><span class="op" id="2009093">(</span><span class="ident" id="2009094">t</span><span class="op" id="2009095">,</span>&nbsp;<span class="ident" id="2009097">f</span><span class="op" id="2009098">.</span><span class="ident" id="2009099">index</span><span class="op" id="2009104">)</span><span class="op" id="2009105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009111">return</span>&nbsp;<span class="ident" id="2009118">se</span><span class="op" id="2009120">.</span><span class="ident" id="2009121">encode</span><br>
<span class="lineno"></span><span class="op" id="2009128">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="2009131">type</span>&nbsp;<span class="ident" id="2009136">mapEncoder</span>&nbsp;<span class="keyword" id="2009147">struct</span>&nbsp;<span class="op" id="2009154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009157">elemEnc</span>&nbsp;<span class="ident" id="2009165">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2009177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="2009180">func</span>&nbsp;<span class="op" id="2009185">(</span><span class="ident" id="2009186">me</span>&nbsp;<span class="op" id="2009189">*</span><span class="ident" id="2009190">mapEncoder</span><span class="op" id="2009200">)</span>&nbsp;<span class="ident" id="2009202">encode</span><span class="op" id="2009208">(</span><span class="ident" id="2009209">e</span>&nbsp;<span class="op" id="2009211">*</span><span class="ident" id="2009212">encodeState</span><span class="op" id="2009223">,</span>&nbsp;<span class="ident" id="2009225">v</span>&nbsp;<span class="ident" id="2009227">reflect</span><span class="op" id="2009234">.</span><span class="ident" id="2009235">Value</span><span class="op" id="2009240">,</span>&nbsp;<span class="ident" id="2009242">_</span>&nbsp;<span class="builtintype" id="2009244">bool</span><span class="op" id="2009248">)</span>&nbsp;<span class="op" id="2009250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009253">if</span>&nbsp;<span class="ident" id="2009256">v</span><span class="op" id="2009257">.</span><span class="ident" id="2009258">IsNil</span><span class="op" id="2009263">(</span><span class="op" id="2009264">)</span>&nbsp;<span class="op" id="2009266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009270">e</span><span class="op" id="2009271">.</span><span class="ident" id="2009272">WriteString</span><span class="op" id="2009283">(</span><span class="string" id="2009284">&#34;null&#34;</span><span class="op" id="2009290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009294">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009302">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009305">e</span><span class="op" id="2009306">.</span><span class="ident" id="2009307">WriteByte</span><span class="op" id="2009316">(</span><span class="string" id="2009317">&#39;{&#39;</span><span class="op" id="2009320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009323">var</span>&nbsp;<span class="ident" id="2009327">sv</span>&nbsp;<span class="ident" id="2009330">stringValues</span>&nbsp;<span class="op" id="2009343">=</span>&nbsp;<span class="ident" id="2009345">v</span><span class="op" id="2009346">.</span><span class="ident" id="2009347">MapKeys</span><span class="op" id="2009354">(</span><span class="op" id="2009355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009358">sort</span><span class="op" id="2009362">.</span><span class="ident" id="2009363">Sort</span><span class="op" id="2009367">(</span><span class="ident" id="2009368">sv</span><span class="op" id="2009370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009373">for</span>&nbsp;<span class="ident" id="2009377">i</span><span class="op" id="2009378">,</span>&nbsp;<span class="ident" id="2009380">k</span>&nbsp;<span class="op" id="2009382">:=</span>&nbsp;<span class="keyword" id="2009385">range</span>&nbsp;<span class="ident" id="2009391">sv</span>&nbsp;<span class="op" id="2009394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009398">if</span>&nbsp;<span class="ident" id="2009401">i</span>&nbsp;<span class="op" id="2009403">&gt;</span>&nbsp;<span class="num" id="2009405">0</span>&nbsp;<span class="op" id="2009407">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009412">e</span><span class="op" id="2009413">.</span><span class="ident" id="2009414">WriteByte</span><span class="op" id="2009423">(</span><span class="string" id="2009424">&#39;,&#39;</span><span class="op" id="2009427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009435">e</span><span class="op" id="2009436">.</span><span class="builtintype" id="2009437">string</span><span class="op" id="2009443">(</span><span class="ident" id="2009444">k</span><span class="op" id="2009445">.</span><span class="ident" id="2009446">String</span><span class="op" id="2009452">(</span><span class="op" id="2009453">)</span><span class="op" id="2009454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009458">e</span><span class="op" id="2009459">.</span><span class="ident" id="2009460">WriteByte</span><span class="op" id="2009469">(</span><span class="string" id="2009470">&#39;:&#39;</span><span class="op" id="2009473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009477">me</span><span class="op" id="2009479">.</span><span class="ident" id="2009480">elemEnc</span><span class="op" id="2009487">(</span><span class="ident" id="2009488">e</span><span class="op" id="2009489">,</span>&nbsp;<span class="ident" id="2009491">v</span><span class="op" id="2009492">.</span><span class="ident" id="2009493">MapIndex</span><span class="op" id="2009501">(</span><span class="ident" id="2009502">k</span><span class="op" id="2009503">)</span><span class="op" id="2009504">,</span>&nbsp;<span class="builtintype" id="2009506">false</span><span class="op" id="2009511">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009517">e</span><span class="op" id="2009518">.</span><span class="ident" id="2009519">WriteByte</span><span class="op" id="2009528">(</span><span class="string" id="2009529">&#39;}&#39;</span><span class="op" id="2009532">)</span><br>
<span class="lineno"></span><span class="op" id="2009534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2009537">func</span>&nbsp;<span class="ident" id="2009542">newMapEncoder</span><span class="op" id="2009555">(</span><span class="ident" id="2009556">t</span>&nbsp;<span class="ident" id="2009558">reflect</span><span class="op" id="2009565">.</span><span class="ident" id="2009566">Type</span><span class="op" id="2009570">)</span>&nbsp;<span class="ident" id="2009572">encoderFunc</span>&nbsp;<span class="op" id="2009584">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009587">if</span>&nbsp;<span class="ident" id="2009590">t</span><span class="op" id="2009591">.</span><span class="ident" id="2009592">Key</span><span class="op" id="2009595">(</span><span class="op" id="2009596">)</span><span class="op" id="2009597">.</span><span class="ident" id="2009598">Kind</span><span class="op" id="2009602">(</span><span class="op" id="2009603">)</span>&nbsp;<span class="op" id="2009605">!=</span>&nbsp;<span class="ident" id="2009608">reflect</span><span class="op" id="2009615">.</span><span class="ident" id="2009616">String</span>&nbsp;<span class="op" id="2009623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009627">return</span>&nbsp;<span class="ident" id="2009634">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009661">me</span>&nbsp;<span class="op" id="2009664">:=</span>&nbsp;<span class="op" id="2009667">&amp;</span><span class="ident" id="2009668">mapEncoder</span><span class="op" id="2009678">{</span><span class="ident" id="2009679">typeEncoder</span><span class="op" id="2009690">(</span><span class="ident" id="2009691">t</span><span class="op" id="2009692">.</span><span class="ident" id="2009693">Elem</span><span class="op" id="2009697">(</span><span class="op" id="2009698">)</span><span class="op" id="2009699">)</span><span class="op" id="2009700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009703">return</span>&nbsp;<span class="ident" id="2009710">me</span><span class="op" id="2009712">.</span><span class="ident" id="2009713">encode</span><br>
<span class="lineno">630</span><span class="op" id="2009720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2009723">func</span>&nbsp;<span class="ident" id="2009728">encodeByteSlice</span><span class="op" id="2009743">(</span><span class="ident" id="2009744">e</span>&nbsp;<span class="op" id="2009746">*</span><span class="ident" id="2009747">encodeState</span><span class="op" id="2009758">,</span>&nbsp;<span class="ident" id="2009760">v</span>&nbsp;<span class="ident" id="2009762">reflect</span><span class="op" id="2009769">.</span><span class="ident" id="2009770">Value</span><span class="op" id="2009775">,</span>&nbsp;<span class="ident" id="2009777">_</span>&nbsp;<span class="builtintype" id="2009779">bool</span><span class="op" id="2009783">)</span>&nbsp;<span class="op" id="2009785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009788">if</span>&nbsp;<span class="ident" id="2009791">v</span><span class="op" id="2009792">.</span><span class="ident" id="2009793">IsNil</span><span class="op" id="2009798">(</span><span class="op" id="2009799">)</span>&nbsp;<span class="op" id="2009801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009805">e</span><span class="op" id="2009806">.</span><span class="ident" id="2009807">WriteString</span><span class="op" id="2009818">(</span><span class="string" id="2009819">&#34;null&#34;</span><span class="op" id="2009825">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009829">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2009837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009840">s</span>&nbsp;<span class="op" id="2009842">:=</span>&nbsp;<span class="ident" id="2009845">v</span><span class="op" id="2009846">.</span><span class="ident" id="2009847">Bytes</span><span class="op" id="2009852">(</span><span class="op" id="2009853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009856">e</span><span class="op" id="2009857">.</span><span class="ident" id="2009858">WriteByte</span><span class="op" id="2009867">(</span><span class="string" id="2009868">&#39;&#34;&#39;</span><span class="op" id="2009871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2009874">if</span>&nbsp;<span class="builtinfunc" id="2009877">len</span><span class="op" id="2009880">(</span><span class="ident" id="2009881">s</span><span class="op" id="2009882">)</span>&nbsp;<span class="op" id="2009884">&lt;</span>&nbsp;<span class="num" id="2009886">1024</span>&nbsp;<span class="op" id="2009891">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2009895">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2009957">dst</span>&nbsp;<span class="op" id="2009961">:=</span>&nbsp;<span class="builtinfunc" id="2009964">make</span><span class="op" id="2009968">(</span><span class="op" id="2009969">[</span><span class="op" id="2009970">]</span><span class="builtintype" id="2009971">byte</span><span class="op" id="2009975">,</span>&nbsp;<span class="ident" id="2009977">base64</span><span class="op" id="2009983">.</span><span class="ident" id="2009984">StdEncoding</span><span class="op" id="2009995">.</span><span class="ident" id="2009996">EncodedLen</span><span class="op" id="2010006">(</span><span class="builtinfunc" id="2010007">len</span><span class="op" id="2010010">(</span><span class="ident" id="2010011">s</span><span class="op" id="2010012">)</span><span class="op" id="2010013">)</span><span class="op" id="2010014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010018">base64</span><span class="op" id="2010024">.</span><span class="ident" id="2010025">StdEncoding</span><span class="op" id="2010036">.</span><span class="ident" id="2010037">Encode</span><span class="op" id="2010043">(</span><span class="ident" id="2010044">dst</span><span class="op" id="2010047">,</span>&nbsp;<span class="ident" id="2010049">s</span><span class="op" id="2010050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010054">e</span><span class="op" id="2010055">.</span><span class="ident" id="2010056">Write</span><span class="op" id="2010061">(</span><span class="ident" id="2010062">dst</span><span class="op" id="2010065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2010068">}</span>&nbsp;<span class="keyword" id="2010070">else</span>&nbsp;<span class="op" id="2010075">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2010079">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2010137">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010156">enc</span>&nbsp;<span class="op" id="2010160">:=</span>&nbsp;<span class="ident" id="2010163">base64</span><span class="op" id="2010169">.</span><span class="ident" id="2010170">NewEncoder</span><span class="op" id="2010180">(</span><span class="ident" id="2010181">base64</span><span class="op" id="2010187">.</span><span class="ident" id="2010188">StdEncoding</span><span class="op" id="2010199">,</span>&nbsp;<span class="ident" id="2010201">e</span><span class="op" id="2010202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010206">enc</span><span class="op" id="2010209">.</span><span class="ident" id="2010210">Write</span><span class="op" id="2010215">(</span><span class="ident" id="2010216">s</span><span class="op" id="2010217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010221">enc</span><span class="op" id="2010224">.</span><span class="ident" id="2010225">Close</span><span class="op" id="2010230">(</span><span class="op" id="2010231">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2010234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010237">e</span><span class="op" id="2010238">.</span><span class="ident" id="2010239">WriteByte</span><span class="op" id="2010248">(</span><span class="string" id="2010249">&#39;&#34;&#39;</span><span class="op" id="2010252">)</span><br>
<span class="lineno"></span><span class="op" id="2010254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2010257">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="2010344">type</span>&nbsp;<span class="ident" id="2010349">sliceEncoder</span>&nbsp;<span class="keyword" id="2010362">struct</span>&nbsp;<span class="op" id="2010369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010372">arrayEnc</span>&nbsp;<span class="ident" id="2010381">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2010393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2010396">func</span>&nbsp;<span class="op" id="2010401">(</span><span class="ident" id="2010402">se</span>&nbsp;<span class="op" id="2010405">*</span><span class="ident" id="2010406">sliceEncoder</span><span class="op" id="2010418">)</span>&nbsp;<span class="ident" id="2010420">encode</span><span class="op" id="2010426">(</span><span class="ident" id="2010427">e</span>&nbsp;<span class="op" id="2010429">*</span><span class="ident" id="2010430">encodeState</span><span class="op" id="2010441">,</span>&nbsp;<span class="ident" id="2010443">v</span>&nbsp;<span class="ident" id="2010445">reflect</span><span class="op" id="2010452">.</span><span class="ident" id="2010453">Value</span><span class="op" id="2010458">,</span>&nbsp;<span class="ident" id="2010460">_</span>&nbsp;<span class="builtintype" id="2010462">bool</span><span class="op" id="2010466">)</span>&nbsp;<span class="op" id="2010468">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010471">if</span>&nbsp;<span class="ident" id="2010474">v</span><span class="op" id="2010475">.</span><span class="ident" id="2010476">IsNil</span><span class="op" id="2010481">(</span><span class="op" id="2010482">)</span>&nbsp;<span class="op" id="2010484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010488">e</span><span class="op" id="2010489">.</span><span class="ident" id="2010490">WriteString</span><span class="op" id="2010501">(</span><span class="string" id="2010502">&#34;null&#34;</span><span class="op" id="2010508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010512">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2010520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010523">se</span><span class="op" id="2010525">.</span><span class="ident" id="2010526">arrayEnc</span><span class="op" id="2010534">(</span><span class="ident" id="2010535">e</span><span class="op" id="2010536">,</span>&nbsp;<span class="ident" id="2010538">v</span><span class="op" id="2010539">,</span>&nbsp;<span class="builtintype" id="2010541">false</span><span class="op" id="2010546">)</span><br>
<span class="lineno">665</span><span class="op" id="2010548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2010551">func</span>&nbsp;<span class="ident" id="2010556">newSliceEncoder</span><span class="op" id="2010571">(</span><span class="ident" id="2010572">t</span>&nbsp;<span class="ident" id="2010574">reflect</span><span class="op" id="2010581">.</span><span class="ident" id="2010582">Type</span><span class="op" id="2010586">)</span>&nbsp;<span class="ident" id="2010588">encoderFunc</span>&nbsp;<span class="op" id="2010600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2010603">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010656">if</span>&nbsp;<span class="ident" id="2010659">t</span><span class="op" id="2010660">.</span><span class="ident" id="2010661">Elem</span><span class="op" id="2010665">(</span><span class="op" id="2010666">)</span><span class="op" id="2010667">.</span><span class="ident" id="2010668">Kind</span><span class="op" id="2010672">(</span><span class="op" id="2010673">)</span>&nbsp;<span class="op" id="2010675">==</span>&nbsp;<span class="ident" id="2010678">reflect</span><span class="op" id="2010685">.</span><span class="ident" id="2010686">Uint8</span>&nbsp;<span class="op" id="2010692">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010696">return</span>&nbsp;<span class="ident" id="2010703">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2010720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010723">enc</span>&nbsp;<span class="op" id="2010727">:=</span>&nbsp;<span class="op" id="2010730">&amp;</span><span class="ident" id="2010731">sliceEncoder</span><span class="op" id="2010743">{</span><span class="ident" id="2010744">newArrayEncoder</span><span class="op" id="2010759">(</span><span class="ident" id="2010760">t</span><span class="op" id="2010761">)</span><span class="op" id="2010762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010765">return</span>&nbsp;<span class="ident" id="2010772">enc</span><span class="op" id="2010775">.</span><span class="ident" id="2010776">encode</span><br>
<span class="lineno"></span><span class="op" id="2010783">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="2010786">type</span>&nbsp;<span class="ident" id="2010791">arrayEncoder</span>&nbsp;<span class="keyword" id="2010804">struct</span>&nbsp;<span class="op" id="2010811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010814">elemEnc</span>&nbsp;<span class="ident" id="2010822">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2010834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="2010837">func</span>&nbsp;<span class="op" id="2010842">(</span><span class="ident" id="2010843">ae</span>&nbsp;<span class="op" id="2010846">*</span><span class="ident" id="2010847">arrayEncoder</span><span class="op" id="2010859">)</span>&nbsp;<span class="ident" id="2010861">encode</span><span class="op" id="2010867">(</span><span class="ident" id="2010868">e</span>&nbsp;<span class="op" id="2010870">*</span><span class="ident" id="2010871">encodeState</span><span class="op" id="2010882">,</span>&nbsp;<span class="ident" id="2010884">v</span>&nbsp;<span class="ident" id="2010886">reflect</span><span class="op" id="2010893">.</span><span class="ident" id="2010894">Value</span><span class="op" id="2010899">,</span>&nbsp;<span class="ident" id="2010901">_</span>&nbsp;<span class="builtintype" id="2010903">bool</span><span class="op" id="2010907">)</span>&nbsp;<span class="op" id="2010909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010912">e</span><span class="op" id="2010913">.</span><span class="ident" id="2010914">WriteByte</span><span class="op" id="2010923">(</span><span class="string" id="2010924">&#39;[&#39;</span><span class="op" id="2010927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010930">n</span>&nbsp;<span class="op" id="2010932">:=</span>&nbsp;<span class="ident" id="2010935">v</span><span class="op" id="2010936">.</span><span class="ident" id="2010937">Len</span><span class="op" id="2010940">(</span><span class="op" id="2010941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010944">for</span>&nbsp;<span class="ident" id="2010948">i</span>&nbsp;<span class="op" id="2010950">:=</span>&nbsp;<span class="num" id="2010953">0</span><span class="op" id="2010954">;</span>&nbsp;<span class="ident" id="2010956">i</span>&nbsp;<span class="op" id="2010958">&lt;</span>&nbsp;<span class="ident" id="2010960">n</span><span class="op" id="2010961">;</span>&nbsp;<span class="ident" id="2010963">i</span><span class="op" id="2010964">++</span>&nbsp;<span class="op" id="2010967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2010971">if</span>&nbsp;<span class="ident" id="2010974">i</span>&nbsp;<span class="op" id="2010976">&gt;</span>&nbsp;<span class="num" id="2010978">0</span>&nbsp;<span class="op" id="2010980">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2010985">e</span><span class="op" id="2010986">.</span><span class="ident" id="2010987">WriteByte</span><span class="op" id="2010996">(</span><span class="string" id="2010997">&#39;,&#39;</span><span class="op" id="2011000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2011004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011008">ae</span><span class="op" id="2011010">.</span><span class="ident" id="2011011">elemEnc</span><span class="op" id="2011018">(</span><span class="ident" id="2011019">e</span><span class="op" id="2011020">,</span>&nbsp;<span class="ident" id="2011022">v</span><span class="op" id="2011023">.</span><span class="ident" id="2011024">Index</span><span class="op" id="2011029">(</span><span class="ident" id="2011030">i</span><span class="op" id="2011031">)</span><span class="op" id="2011032">,</span>&nbsp;<span class="builtintype" id="2011034">false</span><span class="op" id="2011039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2011042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011045">e</span><span class="op" id="2011046">.</span><span class="ident" id="2011047">WriteByte</span><span class="op" id="2011056">(</span><span class="string" id="2011057">&#39;]&#39;</span><span class="op" id="2011060">)</span><br>
<span class="lineno">690</span><span class="op" id="2011062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2011065">func</span>&nbsp;<span class="ident" id="2011070">newArrayEncoder</span><span class="op" id="2011085">(</span><span class="ident" id="2011086">t</span>&nbsp;<span class="ident" id="2011088">reflect</span><span class="op" id="2011095">.</span><span class="ident" id="2011096">Type</span><span class="op" id="2011100">)</span>&nbsp;<span class="ident" id="2011102">encoderFunc</span>&nbsp;<span class="op" id="2011114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011117">enc</span>&nbsp;<span class="op" id="2011121">:=</span>&nbsp;<span class="op" id="2011124">&amp;</span><span class="ident" id="2011125">arrayEncoder</span><span class="op" id="2011137">{</span><span class="ident" id="2011138">typeEncoder</span><span class="op" id="2011149">(</span><span class="ident" id="2011150">t</span><span class="op" id="2011151">.</span><span class="ident" id="2011152">Elem</span><span class="op" id="2011156">(</span><span class="op" id="2011157">)</span><span class="op" id="2011158">)</span><span class="op" id="2011159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2011162">return</span>&nbsp;<span class="ident" id="2011169">enc</span><span class="op" id="2011172">.</span><span class="ident" id="2011173">encode</span><br>
<span class="lineno">695</span><span class="op" id="2011180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2011183">type</span>&nbsp;<span class="ident" id="2011188">ptrEncoder</span>&nbsp;<span class="keyword" id="2011199">struct</span>&nbsp;<span class="op" id="2011206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011209">elemEnc</span>&nbsp;<span class="ident" id="2011217">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2011229">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="2011232">func</span>&nbsp;<span class="op" id="2011237">(</span><span class="ident" id="2011238">pe</span>&nbsp;<span class="op" id="2011241">*</span><span class="ident" id="2011242">ptrEncoder</span><span class="op" id="2011252">)</span>&nbsp;<span class="ident" id="2011254">encode</span><span class="op" id="2011260">(</span><span class="ident" id="2011261">e</span>&nbsp;<span class="op" id="2011263">*</span><span class="ident" id="2011264">encodeState</span><span class="op" id="2011275">,</span>&nbsp;<span class="ident" id="2011277">v</span>&nbsp;<span class="ident" id="2011279">reflect</span><span class="op" id="2011286">.</span><span class="ident" id="2011287">Value</span><span class="op" id="2011292">,</span>&nbsp;<span class="ident" id="2011294">quoted</span>&nbsp;<span class="builtintype" id="2011301">bool</span><span class="op" id="2011305">)</span>&nbsp;<span class="op" id="2011307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2011310">if</span>&nbsp;<span class="ident" id="2011313">v</span><span class="op" id="2011314">.</span><span class="ident" id="2011315">IsNil</span><span class="op" id="2011320">(</span><span class="op" id="2011321">)</span>&nbsp;<span class="op" id="2011323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011327">e</span><span class="op" id="2011328">.</span><span class="ident" id="2011329">WriteString</span><span class="op" id="2011340">(</span><span class="string" id="2011341">&#34;null&#34;</span><span class="op" id="2011347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2011351">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2011359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011362">pe</span><span class="op" id="2011364">.</span><span class="ident" id="2011365">elemEnc</span><span class="op" id="2011372">(</span><span class="ident" id="2011373">e</span><span class="op" id="2011374">,</span>&nbsp;<span class="ident" id="2011376">v</span><span class="op" id="2011377">.</span><span class="ident" id="2011378">Elem</span><span class="op" id="2011382">(</span><span class="op" id="2011383">)</span><span class="op" id="2011384">,</span>&nbsp;<span class="ident" id="2011386">quoted</span><span class="op" id="2011392">)</span><br>
<span class="lineno"></span><span class="op" id="2011394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2011397">func</span>&nbsp;<span class="ident" id="2011402">newPtrEncoder</span><span class="op" id="2011415">(</span><span class="ident" id="2011416">t</span>&nbsp;<span class="ident" id="2011418">reflect</span><span class="op" id="2011425">.</span><span class="ident" id="2011426">Type</span><span class="op" id="2011430">)</span>&nbsp;<span class="ident" id="2011432">encoderFunc</span>&nbsp;<span class="op" id="2011444">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011447">enc</span>&nbsp;<span class="op" id="2011451">:=</span>&nbsp;<span class="op" id="2011454">&amp;</span><span class="ident" id="2011455">ptrEncoder</span><span class="op" id="2011465">{</span><span class="ident" id="2011466">typeEncoder</span><span class="op" id="2011477">(</span><span class="ident" id="2011478">t</span><span class="op" id="2011479">.</span><span class="ident" id="2011480">Elem</span><span class="op" id="2011484">(</span><span class="op" id="2011485">)</span><span class="op" id="2011486">)</span><span class="op" id="2011487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2011490">return</span>&nbsp;<span class="ident" id="2011497">enc</span><span class="op" id="2011500">.</span><span class="ident" id="2011501">encode</span><br>
<span class="lineno"></span><span class="op" id="2011508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2011511">type</span>&nbsp;<span class="ident" id="2011516">condAddrEncoder</span>&nbsp;<span class="keyword" id="2011532">struct</span>&nbsp;<span class="op" id="2011539">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011542">canAddrEnc</span><span class="op" id="2011552">,</span>&nbsp;<span class="ident" id="2011554">elseEnc</span>&nbsp;<span class="ident" id="2011562">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="2011574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2011577">func</span>&nbsp;<span class="op" id="2011582">(</span><span class="ident" id="2011583">ce</span>&nbsp;<span class="op" id="2011586">*</span><span class="ident" id="2011587">condAddrEncoder</span><span class="op" id="2011602">)</span>&nbsp;<span class="ident" id="2011604">encode</span><span class="op" id="2011610">(</span><span class="ident" id="2011611">e</span>&nbsp;<span class="op" id="2011613">*</span><span class="ident" id="2011614">encodeState</span><span class="op" id="2011625">,</span>&nbsp;<span class="ident" id="2011627">v</span>&nbsp;<span class="ident" id="2011629">reflect</span><span class="op" id="2011636">.</span><span class="ident" id="2011637">Value</span><span class="op" id="2011642">,</span>&nbsp;<span class="ident" id="2011644">quoted</span>&nbsp;<span class="builtintype" id="2011651">bool</span><span class="op" id="2011655">)</span>&nbsp;<span class="op" id="2011657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2011660">if</span>&nbsp;<span class="ident" id="2011663">v</span><span class="op" id="2011664">.</span><span class="ident" id="2011665">CanAddr</span><span class="op" id="2011672">(</span><span class="op" id="2011673">)</span>&nbsp;<span class="op" id="2011675">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011679">ce</span><span class="op" id="2011681">.</span><span class="ident" id="2011682">canAddrEnc</span><span class="op" id="2011692">(</span><span class="ident" id="2011693">e</span><span class="op" id="2011694">,</span>&nbsp;<span class="ident" id="2011696">v</span><span class="op" id="2011697">,</span>&nbsp;<span class="ident" id="2011699">quoted</span><span class="op" id="2011705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2011708">}</span>&nbsp;<span class="keyword" id="2011710">else</span>&nbsp;<span class="op" id="2011715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011719">ce</span><span class="op" id="2011721">.</span><span class="ident" id="2011722">elseEnc</span><span class="op" id="2011729">(</span><span class="ident" id="2011730">e</span><span class="op" id="2011731">,</span>&nbsp;<span class="ident" id="2011733">v</span><span class="op" id="2011734">,</span>&nbsp;<span class="ident" id="2011736">quoted</span><span class="op" id="2011742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2011745">}</span><br>
<span class="lineno"></span><span class="op" id="2011747">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="2011750">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="2011821">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="2011884">func</span>&nbsp;<span class="ident" id="2011889">newCondAddrEncoder</span><span class="op" id="2011907">(</span><span class="ident" id="2011908">canAddrEnc</span><span class="op" id="2011918">,</span>&nbsp;<span class="ident" id="2011920">elseEnc</span>&nbsp;<span class="ident" id="2011928">encoderFunc</span><span class="op" id="2011939">)</span>&nbsp;<span class="ident" id="2011941">encoderFunc</span>&nbsp;<span class="op" id="2011953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2011956">enc</span>&nbsp;<span class="op" id="2011960">:=</span>&nbsp;<span class="op" id="2011963">&amp;</span><span class="ident" id="2011964">condAddrEncoder</span><span class="op" id="2011979">{</span><span class="ident" id="2011980">canAddrEnc</span><span class="op" id="2011990">:</span>&nbsp;<span class="ident" id="2011992">canAddrEnc</span><span class="op" id="2012002">,</span>&nbsp;<span class="ident" id="2012004">elseEnc</span><span class="op" id="2012011">:</span>&nbsp;<span class="ident" id="2012013">elseEnc</span><span class="op" id="2012020">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012023">return</span>&nbsp;<span class="ident" id="2012030">enc</span><span class="op" id="2012033">.</span><span class="ident" id="2012034">encode</span><br>
<span class="lineno"></span><span class="op" id="2012041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2012044">func</span>&nbsp;<span class="ident" id="2012049">isValidTag</span><span class="op" id="2012059">(</span><span class="ident" id="2012060">s</span>&nbsp;<span class="builtintype" id="2012062">string</span><span class="op" id="2012068">)</span>&nbsp;<span class="builtintype" id="2012070">bool</span>&nbsp;<span class="op" id="2012075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012078">if</span>&nbsp;<span class="ident" id="2012081">s</span>&nbsp;<span class="op" id="2012083">==</span>&nbsp;<span class="string" id="2012086">&#34;&#34;</span>&nbsp;<span class="op" id="2012089">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012093">return</span>&nbsp;<span class="builtintype" id="2012100">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012110">for</span>&nbsp;<span class="ident" id="2012114">_</span><span class="op" id="2012115">,</span>&nbsp;<span class="ident" id="2012117">c</span>&nbsp;<span class="op" id="2012119">:=</span>&nbsp;<span class="keyword" id="2012122">range</span>&nbsp;<span class="ident" id="2012128">s</span>&nbsp;<span class="op" id="2012130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012134">switch</span>&nbsp;<span class="op" id="2012141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012145">case</span>&nbsp;<span class="ident" id="2012150">strings</span><span class="op" id="2012157">.</span><span class="ident" id="2012158">ContainsRune</span><span class="op" id="2012170">(</span><span class="string" id="2012171">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="2012200">,</span>&nbsp;<span class="ident" id="2012202">c</span><span class="op" id="2012203">)</span><span class="op" id="2012204">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2012209">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2012259">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2012309">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012329">default</span><span class="op" id="2012336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012341">if</span>&nbsp;<span class="op" id="2012344">!</span><span class="ident" id="2012345">unicode</span><span class="op" id="2012352">.</span><span class="ident" id="2012353">IsLetter</span><span class="op" id="2012361">(</span><span class="ident" id="2012362">c</span><span class="op" id="2012363">)</span>&nbsp;<span class="op" id="2012365">&amp;&amp;</span>&nbsp;<span class="op" id="2012368">!</span><span class="ident" id="2012369">unicode</span><span class="op" id="2012376">.</span><span class="ident" id="2012377">IsDigit</span><span class="op" id="2012384">(</span><span class="ident" id="2012385">c</span><span class="op" id="2012386">)</span>&nbsp;<span class="op" id="2012388">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012394">return</span>&nbsp;<span class="builtintype" id="2012401">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012420">return</span>&nbsp;<span class="builtintype" id="2012427">true</span><br>
<span class="lineno">750</span><span class="op" id="2012432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2012435">func</span>&nbsp;<span class="ident" id="2012440">fieldByIndex</span><span class="op" id="2012452">(</span><span class="ident" id="2012453">v</span>&nbsp;<span class="ident" id="2012455">reflect</span><span class="op" id="2012462">.</span><span class="ident" id="2012463">Value</span><span class="op" id="2012468">,</span>&nbsp;<span class="ident" id="2012470">index</span>&nbsp;<span class="op" id="2012476">[</span><span class="op" id="2012477">]</span><span class="builtintype" id="2012478">int</span><span class="op" id="2012481">)</span>&nbsp;<span class="ident" id="2012483">reflect</span><span class="op" id="2012490">.</span><span class="ident" id="2012491">Value</span>&nbsp;<span class="op" id="2012497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012500">for</span>&nbsp;<span class="ident" id="2012504">_</span><span class="op" id="2012505">,</span>&nbsp;<span class="ident" id="2012507">i</span>&nbsp;<span class="op" id="2012509">:=</span>&nbsp;<span class="keyword" id="2012512">range</span>&nbsp;<span class="ident" id="2012518">index</span>&nbsp;<span class="op" id="2012524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012528">if</span>&nbsp;<span class="ident" id="2012531">v</span><span class="op" id="2012532">.</span><span class="ident" id="2012533">Kind</span><span class="op" id="2012537">(</span><span class="op" id="2012538">)</span>&nbsp;<span class="op" id="2012540">==</span>&nbsp;<span class="ident" id="2012543">reflect</span><span class="op" id="2012550">.</span><span class="ident" id="2012551">Ptr</span>&nbsp;<span class="op" id="2012555">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012560">if</span>&nbsp;<span class="ident" id="2012563">v</span><span class="op" id="2012564">.</span><span class="ident" id="2012565">IsNil</span><span class="op" id="2012570">(</span><span class="op" id="2012571">)</span>&nbsp;<span class="op" id="2012573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012579">return</span>&nbsp;<span class="ident" id="2012586">reflect</span><span class="op" id="2012593">.</span><span class="ident" id="2012594">Value</span><span class="op" id="2012599">{</span><span class="op" id="2012600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2012610">v</span>&nbsp;<span class="op" id="2012612">=</span>&nbsp;<span class="ident" id="2012614">v</span><span class="op" id="2012615">.</span><span class="ident" id="2012616">Elem</span><span class="op" id="2012620">(</span><span class="op" id="2012621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012625">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2012629">v</span>&nbsp;<span class="op" id="2012631">=</span>&nbsp;<span class="ident" id="2012633">v</span><span class="op" id="2012634">.</span><span class="ident" id="2012635">Field</span><span class="op" id="2012640">(</span><span class="ident" id="2012641">i</span><span class="op" id="2012642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012648">return</span>&nbsp;<span class="ident" id="2012655">v</span><br>
<span class="lineno"></span><span class="op" id="2012657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="2012660">func</span>&nbsp;<span class="ident" id="2012665">typeByIndex</span><span class="op" id="2012676">(</span><span class="ident" id="2012677">t</span>&nbsp;<span class="ident" id="2012679">reflect</span><span class="op" id="2012686">.</span><span class="ident" id="2012687">Type</span><span class="op" id="2012691">,</span>&nbsp;<span class="ident" id="2012693">index</span>&nbsp;<span class="op" id="2012699">[</span><span class="op" id="2012700">]</span><span class="builtintype" id="2012701">int</span><span class="op" id="2012704">)</span>&nbsp;<span class="ident" id="2012706">reflect</span><span class="op" id="2012713">.</span><span class="ident" id="2012714">Type</span>&nbsp;<span class="op" id="2012719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012722">for</span>&nbsp;<span class="ident" id="2012726">_</span><span class="op" id="2012727">,</span>&nbsp;<span class="ident" id="2012729">i</span>&nbsp;<span class="op" id="2012731">:=</span>&nbsp;<span class="keyword" id="2012734">range</span>&nbsp;<span class="ident" id="2012740">index</span>&nbsp;<span class="op" id="2012746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012750">if</span>&nbsp;<span class="ident" id="2012753">t</span><span class="op" id="2012754">.</span><span class="ident" id="2012755">Kind</span><span class="op" id="2012759">(</span><span class="op" id="2012760">)</span>&nbsp;<span class="op" id="2012762">==</span>&nbsp;<span class="ident" id="2012765">reflect</span><span class="op" id="2012772">.</span><span class="ident" id="2012773">Ptr</span>&nbsp;<span class="op" id="2012777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2012782">t</span>&nbsp;<span class="op" id="2012784">=</span>&nbsp;<span class="ident" id="2012786">t</span><span class="op" id="2012787">.</span><span class="ident" id="2012788">Elem</span><span class="op" id="2012792">(</span><span class="op" id="2012793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012797">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2012801">t</span>&nbsp;<span class="op" id="2012803">=</span>&nbsp;<span class="ident" id="2012805">t</span><span class="op" id="2012806">.</span><span class="ident" id="2012807">Field</span><span class="op" id="2012812">(</span><span class="ident" id="2012813">i</span><span class="op" id="2012814">)</span><span class="op" id="2012815">.</span><span class="ident" id="2012816">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2012822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2012825">return</span>&nbsp;<span class="ident" id="2012832">t</span><br>
<span class="lineno"></span><span class="op" id="2012834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="2012837">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="2012911">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2012959">type</span>&nbsp;<span class="ident" id="2012964">stringValues</span>&nbsp;<span class="op" id="2012977">[</span><span class="op" id="2012978">]</span><span class="ident" id="2012979">reflect</span><span class="op" id="2012986">.</span><span class="ident" id="2012987">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2012994">func</span>&nbsp;<span class="op" id="2012999">(</span><span class="ident" id="2013000">sv</span>&nbsp;<span class="ident" id="2013003">stringValues</span><span class="op" id="2013015">)</span>&nbsp;<span class="ident" id="2013017">Len</span><span class="op" id="2013020">(</span><span class="op" id="2013021">)</span>&nbsp;<span class="builtintype" id="2013023">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2013037">{</span>&nbsp;<span class="keyword" id="2013039">return</span>&nbsp;<span class="builtinfunc" id="2013046">len</span><span class="op" id="2013049">(</span><span class="ident" id="2013050">sv</span><span class="op" id="2013052">)</span>&nbsp;<span class="op" id="2013054">}</span><br>
<span class="lineno">780</span><span class="keyword" id="2013056">func</span>&nbsp;<span class="op" id="2013061">(</span><span class="ident" id="2013062">sv</span>&nbsp;<span class="ident" id="2013065">stringValues</span><span class="op" id="2013077">)</span>&nbsp;<span class="ident" id="2013079">Swap</span><span class="op" id="2013083">(</span><span class="ident" id="2013084">i</span><span class="op" id="2013085">,</span>&nbsp;<span class="ident" id="2013087">j</span>&nbsp;<span class="builtintype" id="2013089">int</span><span class="op" id="2013092">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2013099">{</span>&nbsp;<span class="ident" id="2013101">sv</span><span class="op" id="2013103">[</span><span class="ident" id="2013104">i</span><span class="op" id="2013105">]</span><span class="op" id="2013106">,</span>&nbsp;<span class="ident" id="2013108">sv</span><span class="op" id="2013110">[</span><span class="ident" id="2013111">j</span><span class="op" id="2013112">]</span>&nbsp;<span class="op" id="2013114">=</span>&nbsp;<span class="ident" id="2013116">sv</span><span class="op" id="2013118">[</span><span class="ident" id="2013119">j</span><span class="op" id="2013120">]</span><span class="op" id="2013121">,</span>&nbsp;<span class="ident" id="2013123">sv</span><span class="op" id="2013125">[</span><span class="ident" id="2013126">i</span><span class="op" id="2013127">]</span>&nbsp;<span class="op" id="2013129">}</span><br>
<span class="lineno"></span><span class="keyword" id="2013131">func</span>&nbsp;<span class="op" id="2013136">(</span><span class="ident" id="2013137">sv</span>&nbsp;<span class="ident" id="2013140">stringValues</span><span class="op" id="2013152">)</span>&nbsp;<span class="ident" id="2013154">Less</span><span class="op" id="2013158">(</span><span class="ident" id="2013159">i</span><span class="op" id="2013160">,</span>&nbsp;<span class="ident" id="2013162">j</span>&nbsp;<span class="builtintype" id="2013164">int</span><span class="op" id="2013167">)</span>&nbsp;<span class="builtintype" id="2013169">bool</span>&nbsp;<span class="op" id="2013174">{</span>&nbsp;<span class="keyword" id="2013176">return</span>&nbsp;<span class="ident" id="2013183">sv</span><span class="op" id="2013185">.</span><span class="ident" id="2013186">get</span><span class="op" id="2013189">(</span><span class="ident" id="2013190">i</span><span class="op" id="2013191">)</span>&nbsp;<span class="op" id="2013193">&lt;</span>&nbsp;<span class="ident" id="2013195">sv</span><span class="op" id="2013197">.</span><span class="ident" id="2013198">get</span><span class="op" id="2013201">(</span><span class="ident" id="2013202">j</span><span class="op" id="2013203">)</span>&nbsp;<span class="op" id="2013205">}</span><br>
<span class="lineno"></span><span class="keyword" id="2013207">func</span>&nbsp;<span class="op" id="2013212">(</span><span class="ident" id="2013213">sv</span>&nbsp;<span class="ident" id="2013216">stringValues</span><span class="op" id="2013228">)</span>&nbsp;<span class="ident" id="2013230">get</span><span class="op" id="2013233">(</span><span class="ident" id="2013234">i</span>&nbsp;<span class="builtintype" id="2013236">int</span><span class="op" id="2013239">)</span>&nbsp;<span class="builtintype" id="2013241">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2013250">{</span>&nbsp;<span class="keyword" id="2013252">return</span>&nbsp;<span class="ident" id="2013259">sv</span><span class="op" id="2013261">[</span><span class="ident" id="2013262">i</span><span class="op" id="2013263">]</span><span class="op" id="2013264">.</span><span class="ident" id="2013265">String</span><span class="op" id="2013271">(</span><span class="op" id="2013272">)</span>&nbsp;<span class="op" id="2013274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2013277">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="2013323">func</span>&nbsp;<span class="op" id="2013328">(</span><span class="ident" id="2013329">e</span>&nbsp;<span class="op" id="2013331">*</span><span class="ident" id="2013332">encodeState</span><span class="op" id="2013343">)</span>&nbsp;<span class="builtintype" id="2013345">string</span><span class="op" id="2013351">(</span><span class="ident" id="2013352">s</span>&nbsp;<span class="builtintype" id="2013354">string</span><span class="op" id="2013360">)</span>&nbsp;<span class="op" id="2013362">(</span><span class="builtintype" id="2013363">int</span><span class="op" id="2013366">,</span>&nbsp;<span class="builtintype" id="2013368">error</span><span class="op" id="2013373">)</span>&nbsp;<span class="op" id="2013375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013378">len0</span>&nbsp;<span class="op" id="2013383">:=</span>&nbsp;<span class="ident" id="2013386">e</span><span class="op" id="2013387">.</span><span class="ident" id="2013388">Len</span><span class="op" id="2013391">(</span><span class="op" id="2013392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013395">e</span><span class="op" id="2013396">.</span><span class="ident" id="2013397">WriteByte</span><span class="op" id="2013406">(</span><span class="string" id="2013407">&#39;&#34;&#39;</span><span class="op" id="2013410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013413">start</span>&nbsp;<span class="op" id="2013419">:=</span>&nbsp;<span class="num" id="2013422">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013425">for</span>&nbsp;<span class="ident" id="2013429">i</span>&nbsp;<span class="op" id="2013431">:=</span>&nbsp;<span class="num" id="2013434">0</span><span class="op" id="2013435">;</span>&nbsp;<span class="ident" id="2013437">i</span>&nbsp;<span class="op" id="2013439">&lt;</span>&nbsp;<span class="builtinfunc" id="2013441">len</span><span class="op" id="2013444">(</span><span class="ident" id="2013445">s</span><span class="op" id="2013446">)</span><span class="op" id="2013447">;</span>&nbsp;<span class="op" id="2013449">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013453">if</span>&nbsp;<span class="ident" id="2013456">b</span>&nbsp;<span class="op" id="2013458">:=</span>&nbsp;<span class="ident" id="2013461">s</span><span class="op" id="2013462">[</span><span class="ident" id="2013463">i</span><span class="op" id="2013464">]</span><span class="op" id="2013465">;</span>&nbsp;<span class="ident" id="2013467">b</span>&nbsp;<span class="op" id="2013469">&lt;</span>&nbsp;<span class="ident" id="2013471">utf8</span><span class="op" id="2013475">.</span><span class="ident" id="2013476">RuneSelf</span>&nbsp;<span class="op" id="2013485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013490">if</span>&nbsp;<span class="num" id="2013493">0x20</span>&nbsp;<span class="op" id="2013498">&lt;=</span>&nbsp;<span class="ident" id="2013501">b</span>&nbsp;<span class="op" id="2013503">&amp;&amp;</span>&nbsp;<span class="ident" id="2013506">b</span>&nbsp;<span class="op" id="2013508">!=</span>&nbsp;<span class="string" id="2013511">&#39;\\&#39;</span>&nbsp;<span class="op" id="2013516">&amp;&amp;</span>&nbsp;<span class="ident" id="2013519">b</span>&nbsp;<span class="op" id="2013521">!=</span>&nbsp;<span class="string" id="2013524">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2013528">&amp;&amp;</span>&nbsp;<span class="ident" id="2013531">b</span>&nbsp;<span class="op" id="2013533">!=</span>&nbsp;<span class="string" id="2013536">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="2013540">&amp;&amp;</span>&nbsp;<span class="ident" id="2013543">b</span>&nbsp;<span class="op" id="2013545">!=</span>&nbsp;<span class="string" id="2013548">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="2013552">&amp;&amp;</span>&nbsp;<span class="ident" id="2013555">b</span>&nbsp;<span class="op" id="2013557">!=</span>&nbsp;<span class="string" id="2013560">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="2013564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013570">i</span><span class="op" id="2013571">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013578">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2013590">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013595">if</span>&nbsp;<span class="ident" id="2013598">start</span>&nbsp;<span class="op" id="2013604">&lt;</span>&nbsp;<span class="ident" id="2013606">i</span>&nbsp;<span class="op" id="2013608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013614">e</span><span class="op" id="2013615">.</span><span class="ident" id="2013616">WriteString</span><span class="op" id="2013627">(</span><span class="ident" id="2013628">s</span><span class="op" id="2013629">[</span><span class="ident" id="2013630">start</span><span class="op" id="2013635">:</span><span class="ident" id="2013636">i</span><span class="op" id="2013637">]</span><span class="op" id="2013638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2013643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013648">switch</span>&nbsp;<span class="ident" id="2013655">b</span>&nbsp;<span class="op" id="2013657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013662">case</span>&nbsp;<span class="string" id="2013667">&#39;\\&#39;</span><span class="op" id="2013671">,</span>&nbsp;<span class="string" id="2013673">&#39;&#34;&#39;</span><span class="op" id="2013676">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013682">e</span><span class="op" id="2013683">.</span><span class="ident" id="2013684">WriteByte</span><span class="op" id="2013693">(</span><span class="string" id="2013694">&#39;\\&#39;</span><span class="op" id="2013698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013704">e</span><span class="op" id="2013705">.</span><span class="ident" id="2013706">WriteByte</span><span class="op" id="2013715">(</span><span class="ident" id="2013716">b</span><span class="op" id="2013717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013722">case</span>&nbsp;<span class="string" id="2013727">&#39;\n&#39;</span><span class="op" id="2013731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013737">e</span><span class="op" id="2013738">.</span><span class="ident" id="2013739">WriteByte</span><span class="op" id="2013748">(</span><span class="string" id="2013749">&#39;\\&#39;</span><span class="op" id="2013753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013759">e</span><span class="op" id="2013760">.</span><span class="ident" id="2013761">WriteByte</span><span class="op" id="2013770">(</span><span class="string" id="2013771">&#39;n&#39;</span><span class="op" id="2013774">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013779">case</span>&nbsp;<span class="string" id="2013784">&#39;\r&#39;</span><span class="op" id="2013788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013794">e</span><span class="op" id="2013795">.</span><span class="ident" id="2013796">WriteByte</span><span class="op" id="2013805">(</span><span class="string" id="2013806">&#39;\\&#39;</span><span class="op" id="2013810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013816">e</span><span class="op" id="2013817">.</span><span class="ident" id="2013818">WriteByte</span><span class="op" id="2013827">(</span><span class="string" id="2013828">&#39;r&#39;</span><span class="op" id="2013831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013836">case</span>&nbsp;<span class="string" id="2013841">&#39;\t&#39;</span><span class="op" id="2013845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013851">e</span><span class="op" id="2013852">.</span><span class="ident" id="2013853">WriteByte</span><span class="op" id="2013862">(</span><span class="string" id="2013863">&#39;\\&#39;</span><span class="op" id="2013867">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2013873">e</span><span class="op" id="2013874">.</span><span class="ident" id="2013875">WriteByte</span><span class="op" id="2013884">(</span><span class="string" id="2013885">&#39;t&#39;</span><span class="op" id="2013888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2013893">default</span><span class="op" id="2013900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2013906">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2013961">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014027">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014090">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014149">e</span><span class="op" id="2014150">.</span><span class="ident" id="2014151">WriteString</span><span class="op" id="2014162">(</span><span class="string" id="2014163">`\u00`</span><span class="op" id="2014169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014175">e</span><span class="op" id="2014176">.</span><span class="ident" id="2014177">WriteByte</span><span class="op" id="2014186">(</span><span class="ident" id="2014187">hex</span><span class="op" id="2014190">[</span><span class="ident" id="2014191">b</span><span class="op" id="2014192">&gt;&gt;</span><span class="num" id="2014194">4</span><span class="op" id="2014195">]</span><span class="op" id="2014196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014202">e</span><span class="op" id="2014203">.</span><span class="ident" id="2014204">WriteByte</span><span class="op" id="2014213">(</span><span class="ident" id="2014214">hex</span><span class="op" id="2014217">[</span><span class="ident" id="2014218">b</span><span class="op" id="2014219">&amp;</span><span class="num" id="2014220">0xF</span><span class="op" id="2014223">]</span><span class="op" id="2014224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2014229">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014234">i</span><span class="op" id="2014235">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014241">start</span>&nbsp;<span class="op" id="2014247">=</span>&nbsp;<span class="ident" id="2014249">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014254">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2014265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014269">c</span><span class="op" id="2014270">,</span>&nbsp;<span class="ident" id="2014272">size</span>&nbsp;<span class="op" id="2014277">:=</span>&nbsp;<span class="ident" id="2014280">utf8</span><span class="op" id="2014284">.</span><span class="ident" id="2014285">DecodeRuneInString</span><span class="op" id="2014303">(</span><span class="ident" id="2014304">s</span><span class="op" id="2014305">[</span><span class="ident" id="2014306">i</span><span class="op" id="2014307">:</span><span class="op" id="2014308">]</span><span class="op" id="2014309">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014313">if</span>&nbsp;<span class="ident" id="2014316">c</span>&nbsp;<span class="op" id="2014318">==</span>&nbsp;<span class="ident" id="2014321">utf8</span><span class="op" id="2014325">.</span><span class="ident" id="2014326">RuneError</span>&nbsp;<span class="op" id="2014336">&amp;&amp;</span>&nbsp;<span class="ident" id="2014339">size</span>&nbsp;<span class="op" id="2014344">==</span>&nbsp;<span class="num" id="2014347">1</span>&nbsp;<span class="op" id="2014349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014354">if</span>&nbsp;<span class="ident" id="2014357">start</span>&nbsp;<span class="op" id="2014363">&lt;</span>&nbsp;<span class="ident" id="2014365">i</span>&nbsp;<span class="op" id="2014367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014373">e</span><span class="op" id="2014374">.</span><span class="ident" id="2014375">WriteString</span><span class="op" id="2014386">(</span><span class="ident" id="2014387">s</span><span class="op" id="2014388">[</span><span class="ident" id="2014389">start</span><span class="op" id="2014394">:</span><span class="ident" id="2014395">i</span><span class="op" id="2014396">]</span><span class="op" id="2014397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2014402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014407">e</span><span class="op" id="2014408">.</span><span class="ident" id="2014409">WriteString</span><span class="op" id="2014420">(</span><span class="string" id="2014421">`\ufffd`</span><span class="op" id="2014429">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014434">i</span>&nbsp;<span class="op" id="2014436">+=</span>&nbsp;<span class="ident" id="2014439">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014447">start</span>&nbsp;<span class="op" id="2014453">=</span>&nbsp;<span class="ident" id="2014455">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014460">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2014471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014475">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014506">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014542">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014607">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014678">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014741">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2014788">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014867">if</span>&nbsp;<span class="ident" id="2014870">c</span>&nbsp;<span class="op" id="2014872">==</span>&nbsp;<span class="string" id="2014875">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="2014884">||</span>&nbsp;<span class="ident" id="2014887">c</span>&nbsp;<span class="op" id="2014889">==</span>&nbsp;<span class="string" id="2014892">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="2014901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2014906">if</span>&nbsp;<span class="ident" id="2014909">start</span>&nbsp;<span class="op" id="2014915">&lt;</span>&nbsp;<span class="ident" id="2014917">i</span>&nbsp;<span class="op" id="2014919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014925">e</span><span class="op" id="2014926">.</span><span class="ident" id="2014927">WriteString</span><span class="op" id="2014938">(</span><span class="ident" id="2014939">s</span><span class="op" id="2014940">[</span><span class="ident" id="2014941">start</span><span class="op" id="2014946">:</span><span class="ident" id="2014947">i</span><span class="op" id="2014948">]</span><span class="op" id="2014949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2014954">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014959">e</span><span class="op" id="2014960">.</span><span class="ident" id="2014961">WriteString</span><span class="op" id="2014972">(</span><span class="string" id="2014973">`\u202`</span><span class="op" id="2014980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2014985">e</span><span class="op" id="2014986">.</span><span class="ident" id="2014987">WriteByte</span><span class="op" id="2014996">(</span><span class="ident" id="2014997">hex</span><span class="op" id="2015000">[</span><span class="ident" id="2015001">c</span><span class="op" id="2015002">&amp;</span><span class="num" id="2015003">0xF</span><span class="op" id="2015006">]</span><span class="op" id="2015007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015012">i</span>&nbsp;<span class="op" id="2015014">+=</span>&nbsp;<span class="ident" id="2015017">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015025">start</span>&nbsp;<span class="op" id="2015031">=</span>&nbsp;<span class="ident" id="2015033">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015038">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2015049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015053">i</span>&nbsp;<span class="op" id="2015055">+=</span>&nbsp;<span class="ident" id="2015058">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2015064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015067">if</span>&nbsp;<span class="ident" id="2015070">start</span>&nbsp;<span class="op" id="2015076">&lt;</span>&nbsp;<span class="builtinfunc" id="2015078">len</span><span class="op" id="2015081">(</span><span class="ident" id="2015082">s</span><span class="op" id="2015083">)</span>&nbsp;<span class="op" id="2015085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015089">e</span><span class="op" id="2015090">.</span><span class="ident" id="2015091">WriteString</span><span class="op" id="2015102">(</span><span class="ident" id="2015103">s</span><span class="op" id="2015104">[</span><span class="ident" id="2015105">start</span><span class="op" id="2015110">:</span><span class="op" id="2015111">]</span><span class="op" id="2015112">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2015115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015118">e</span><span class="op" id="2015119">.</span><span class="ident" id="2015120">WriteByte</span><span class="op" id="2015129">(</span><span class="string" id="2015130">&#39;&#34;&#39;</span><span class="op" id="2015133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015136">return</span>&nbsp;<span class="ident" id="2015143">e</span><span class="op" id="2015144">.</span><span class="ident" id="2015145">Len</span><span class="op" id="2015148">(</span><span class="op" id="2015149">)</span>&nbsp;<span class="op" id="2015151">-</span>&nbsp;<span class="ident" id="2015153">len0</span><span class="op" id="2015157">,</span>&nbsp;<span class="builtintype" id="2015159">nil</span><br>
<span class="lineno"></span><span class="op" id="2015163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="2015166">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="2015207">func</span>&nbsp;<span class="op" id="2015212">(</span><span class="ident" id="2015213">e</span>&nbsp;<span class="op" id="2015215">*</span><span class="ident" id="2015216">encodeState</span><span class="op" id="2015227">)</span>&nbsp;<span class="ident" id="2015229">stringBytes</span><span class="op" id="2015240">(</span><span class="ident" id="2015241">s</span>&nbsp;<span class="op" id="2015243">[</span><span class="op" id="2015244">]</span><span class="builtintype" id="2015245">byte</span><span class="op" id="2015249">)</span>&nbsp;<span class="op" id="2015251">(</span><span class="builtintype" id="2015252">int</span><span class="op" id="2015255">,</span>&nbsp;<span class="builtintype" id="2015257">error</span><span class="op" id="2015262">)</span>&nbsp;<span class="op" id="2015264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015267">len0</span>&nbsp;<span class="op" id="2015272">:=</span>&nbsp;<span class="ident" id="2015275">e</span><span class="op" id="2015276">.</span><span class="ident" id="2015277">Len</span><span class="op" id="2015280">(</span><span class="op" id="2015281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015284">e</span><span class="op" id="2015285">.</span><span class="ident" id="2015286">WriteByte</span><span class="op" id="2015295">(</span><span class="string" id="2015296">&#39;&#34;&#39;</span><span class="op" id="2015299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015302">start</span>&nbsp;<span class="op" id="2015308">:=</span>&nbsp;<span class="num" id="2015311">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015314">for</span>&nbsp;<span class="ident" id="2015318">i</span>&nbsp;<span class="op" id="2015320">:=</span>&nbsp;<span class="num" id="2015323">0</span><span class="op" id="2015324">;</span>&nbsp;<span class="ident" id="2015326">i</span>&nbsp;<span class="op" id="2015328">&lt;</span>&nbsp;<span class="builtinfunc" id="2015330">len</span><span class="op" id="2015333">(</span><span class="ident" id="2015334">s</span><span class="op" id="2015335">)</span><span class="op" id="2015336">;</span>&nbsp;<span class="op" id="2015338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015342">if</span>&nbsp;<span class="ident" id="2015345">b</span>&nbsp;<span class="op" id="2015347">:=</span>&nbsp;<span class="ident" id="2015350">s</span><span class="op" id="2015351">[</span><span class="ident" id="2015352">i</span><span class="op" id="2015353">]</span><span class="op" id="2015354">;</span>&nbsp;<span class="ident" id="2015356">b</span>&nbsp;<span class="op" id="2015358">&lt;</span>&nbsp;<span class="ident" id="2015360">utf8</span><span class="op" id="2015364">.</span><span class="ident" id="2015365">RuneSelf</span>&nbsp;<span class="op" id="2015374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015379">if</span>&nbsp;<span class="num" id="2015382">0x20</span>&nbsp;<span class="op" id="2015387">&lt;=</span>&nbsp;<span class="ident" id="2015390">b</span>&nbsp;<span class="op" id="2015392">&amp;&amp;</span>&nbsp;<span class="ident" id="2015395">b</span>&nbsp;<span class="op" id="2015397">!=</span>&nbsp;<span class="string" id="2015400">&#39;\\&#39;</span>&nbsp;<span class="op" id="2015405">&amp;&amp;</span>&nbsp;<span class="ident" id="2015408">b</span>&nbsp;<span class="op" id="2015410">!=</span>&nbsp;<span class="string" id="2015413">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2015417">&amp;&amp;</span>&nbsp;<span class="ident" id="2015420">b</span>&nbsp;<span class="op" id="2015422">!=</span>&nbsp;<span class="string" id="2015425">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="2015429">&amp;&amp;</span>&nbsp;<span class="ident" id="2015432">b</span>&nbsp;<span class="op" id="2015434">!=</span>&nbsp;<span class="string" id="2015437">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="2015441">&amp;&amp;</span>&nbsp;<span class="ident" id="2015444">b</span>&nbsp;<span class="op" id="2015446">!=</span>&nbsp;<span class="string" id="2015449">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="2015453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015459">i</span><span class="op" id="2015460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015467">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2015479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015484">if</span>&nbsp;<span class="ident" id="2015487">start</span>&nbsp;<span class="op" id="2015493">&lt;</span>&nbsp;<span class="ident" id="2015495">i</span>&nbsp;<span class="op" id="2015497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015503">e</span><span class="op" id="2015504">.</span><span class="ident" id="2015505">Write</span><span class="op" id="2015510">(</span><span class="ident" id="2015511">s</span><span class="op" id="2015512">[</span><span class="ident" id="2015513">start</span><span class="op" id="2015518">:</span><span class="ident" id="2015519">i</span><span class="op" id="2015520">]</span><span class="op" id="2015521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2015526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015531">switch</span>&nbsp;<span class="ident" id="2015538">b</span>&nbsp;<span class="op" id="2015540">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015545">case</span>&nbsp;<span class="string" id="2015550">&#39;\\&#39;</span><span class="op" id="2015554">,</span>&nbsp;<span class="string" id="2015556">&#39;&#34;&#39;</span><span class="op" id="2015559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015565">e</span><span class="op" id="2015566">.</span><span class="ident" id="2015567">WriteByte</span><span class="op" id="2015576">(</span><span class="string" id="2015577">&#39;\\&#39;</span><span class="op" id="2015581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015587">e</span><span class="op" id="2015588">.</span><span class="ident" id="2015589">WriteByte</span><span class="op" id="2015598">(</span><span class="ident" id="2015599">b</span><span class="op" id="2015600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015605">case</span>&nbsp;<span class="string" id="2015610">&#39;\n&#39;</span><span class="op" id="2015614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015620">e</span><span class="op" id="2015621">.</span><span class="ident" id="2015622">WriteByte</span><span class="op" id="2015631">(</span><span class="string" id="2015632">&#39;\\&#39;</span><span class="op" id="2015636">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015642">e</span><span class="op" id="2015643">.</span><span class="ident" id="2015644">WriteByte</span><span class="op" id="2015653">(</span><span class="string" id="2015654">&#39;n&#39;</span><span class="op" id="2015657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015662">case</span>&nbsp;<span class="string" id="2015667">&#39;\r&#39;</span><span class="op" id="2015671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015677">e</span><span class="op" id="2015678">.</span><span class="ident" id="2015679">WriteByte</span><span class="op" id="2015688">(</span><span class="string" id="2015689">&#39;\\&#39;</span><span class="op" id="2015693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015699">e</span><span class="op" id="2015700">.</span><span class="ident" id="2015701">WriteByte</span><span class="op" id="2015710">(</span><span class="string" id="2015711">&#39;r&#39;</span><span class="op" id="2015714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015719">case</span>&nbsp;<span class="string" id="2015724">&#39;\t&#39;</span><span class="op" id="2015728">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015734">e</span><span class="op" id="2015735">.</span><span class="ident" id="2015736">WriteByte</span><span class="op" id="2015745">(</span><span class="string" id="2015746">&#39;\\&#39;</span><span class="op" id="2015750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2015756">e</span><span class="op" id="2015757">.</span><span class="ident" id="2015758">WriteByte</span><span class="op" id="2015767">(</span><span class="string" id="2015768">&#39;t&#39;</span><span class="op" id="2015771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2015776">default</span><span class="op" id="2015783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2015789">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2015844">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2015911">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2015974">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016033">e</span><span class="op" id="2016034">.</span><span class="ident" id="2016035">WriteString</span><span class="op" id="2016046">(</span><span class="string" id="2016047">`\u00`</span><span class="op" id="2016053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016059">e</span><span class="op" id="2016060">.</span><span class="ident" id="2016061">WriteByte</span><span class="op" id="2016070">(</span><span class="ident" id="2016071">hex</span><span class="op" id="2016074">[</span><span class="ident" id="2016075">b</span><span class="op" id="2016076">&gt;&gt;</span><span class="num" id="2016078">4</span><span class="op" id="2016079">]</span><span class="op" id="2016080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016086">e</span><span class="op" id="2016087">.</span><span class="ident" id="2016088">WriteByte</span><span class="op" id="2016097">(</span><span class="ident" id="2016098">hex</span><span class="op" id="2016101">[</span><span class="ident" id="2016102">b</span><span class="op" id="2016103">&amp;</span><span class="num" id="2016104">0xF</span><span class="op" id="2016107">]</span><span class="op" id="2016108">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016118">i</span><span class="op" id="2016119">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016125">start</span>&nbsp;<span class="op" id="2016131">=</span>&nbsp;<span class="ident" id="2016133">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016138">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016149">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016153">c</span><span class="op" id="2016154">,</span>&nbsp;<span class="ident" id="2016156">size</span>&nbsp;<span class="op" id="2016161">:=</span>&nbsp;<span class="ident" id="2016164">utf8</span><span class="op" id="2016168">.</span><span class="ident" id="2016169">DecodeRune</span><span class="op" id="2016179">(</span><span class="ident" id="2016180">s</span><span class="op" id="2016181">[</span><span class="ident" id="2016182">i</span><span class="op" id="2016183">:</span><span class="op" id="2016184">]</span><span class="op" id="2016185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016189">if</span>&nbsp;<span class="ident" id="2016192">c</span>&nbsp;<span class="op" id="2016194">==</span>&nbsp;<span class="ident" id="2016197">utf8</span><span class="op" id="2016201">.</span><span class="ident" id="2016202">RuneError</span>&nbsp;<span class="op" id="2016212">&amp;&amp;</span>&nbsp;<span class="ident" id="2016215">size</span>&nbsp;<span class="op" id="2016220">==</span>&nbsp;<span class="num" id="2016223">1</span>&nbsp;<span class="op" id="2016225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016230">if</span>&nbsp;<span class="ident" id="2016233">start</span>&nbsp;<span class="op" id="2016239">&lt;</span>&nbsp;<span class="ident" id="2016241">i</span>&nbsp;<span class="op" id="2016243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016249">e</span><span class="op" id="2016250">.</span><span class="ident" id="2016251">Write</span><span class="op" id="2016256">(</span><span class="ident" id="2016257">s</span><span class="op" id="2016258">[</span><span class="ident" id="2016259">start</span><span class="op" id="2016264">:</span><span class="ident" id="2016265">i</span><span class="op" id="2016266">]</span><span class="op" id="2016267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016272">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016277">e</span><span class="op" id="2016278">.</span><span class="ident" id="2016279">WriteString</span><span class="op" id="2016290">(</span><span class="string" id="2016291">`\ufffd`</span><span class="op" id="2016299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016304">i</span>&nbsp;<span class="op" id="2016306">+=</span>&nbsp;<span class="ident" id="2016309">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016317">start</span>&nbsp;<span class="op" id="2016323">=</span>&nbsp;<span class="ident" id="2016325">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016330">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016341">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016345">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016376">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016412">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016477">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016548">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016611">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2016658">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016737">if</span>&nbsp;<span class="ident" id="2016740">c</span>&nbsp;<span class="op" id="2016742">==</span>&nbsp;<span class="string" id="2016745">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="2016754">||</span>&nbsp;<span class="ident" id="2016757">c</span>&nbsp;<span class="op" id="2016759">==</span>&nbsp;<span class="string" id="2016762">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="2016771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016776">if</span>&nbsp;<span class="ident" id="2016779">start</span>&nbsp;<span class="op" id="2016785">&lt;</span>&nbsp;<span class="ident" id="2016787">i</span>&nbsp;<span class="op" id="2016789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016795">e</span><span class="op" id="2016796">.</span><span class="ident" id="2016797">Write</span><span class="op" id="2016802">(</span><span class="ident" id="2016803">s</span><span class="op" id="2016804">[</span><span class="ident" id="2016805">start</span><span class="op" id="2016810">:</span><span class="ident" id="2016811">i</span><span class="op" id="2016812">]</span><span class="op" id="2016813">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016823">e</span><span class="op" id="2016824">.</span><span class="ident" id="2016825">WriteString</span><span class="op" id="2016836">(</span><span class="string" id="2016837">`\u202`</span><span class="op" id="2016844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016849">e</span><span class="op" id="2016850">.</span><span class="ident" id="2016851">WriteByte</span><span class="op" id="2016860">(</span><span class="ident" id="2016861">hex</span><span class="op" id="2016864">[</span><span class="ident" id="2016865">c</span><span class="op" id="2016866">&amp;</span><span class="num" id="2016867">0xF</span><span class="op" id="2016870">]</span><span class="op" id="2016871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016876">i</span>&nbsp;<span class="op" id="2016878">+=</span>&nbsp;<span class="ident" id="2016881">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016889">start</span>&nbsp;<span class="op" id="2016895">=</span>&nbsp;<span class="ident" id="2016897">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016902">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016917">i</span>&nbsp;<span class="op" id="2016919">+=</span>&nbsp;<span class="ident" id="2016922">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016931">if</span>&nbsp;<span class="ident" id="2016934">start</span>&nbsp;<span class="op" id="2016940">&lt;</span>&nbsp;<span class="builtinfunc" id="2016942">len</span><span class="op" id="2016945">(</span><span class="ident" id="2016946">s</span><span class="op" id="2016947">)</span>&nbsp;<span class="op" id="2016949">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016953">e</span><span class="op" id="2016954">.</span><span class="ident" id="2016955">Write</span><span class="op" id="2016960">(</span><span class="ident" id="2016961">s</span><span class="op" id="2016962">[</span><span class="ident" id="2016963">start</span><span class="op" id="2016968">:</span><span class="op" id="2016969">]</span><span class="op" id="2016970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2016973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2016976">e</span><span class="op" id="2016977">.</span><span class="ident" id="2016978">WriteByte</span><span class="op" id="2016987">(</span><span class="string" id="2016988">&#39;&#34;&#39;</span><span class="op" id="2016991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2016994">return</span>&nbsp;<span class="ident" id="2017001">e</span><span class="op" id="2017002">.</span><span class="ident" id="2017003">Len</span><span class="op" id="2017006">(</span><span class="op" id="2017007">)</span>&nbsp;<span class="op" id="2017009">-</span>&nbsp;<span class="ident" id="2017011">len0</span><span class="op" id="2017015">,</span>&nbsp;<span class="builtintype" id="2017017">nil</span><br>
<span class="lineno"></span><span class="op" id="2017021">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="2017024">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="2017080">type</span>&nbsp;<span class="ident" id="2017085">field</span>&nbsp;<span class="keyword" id="2017091">struct</span>&nbsp;<span class="op" id="2017098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017101">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2017111">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017119">nameBytes</span>&nbsp;<span class="op" id="2017129">[</span><span class="op" id="2017130">]</span><span class="builtintype" id="2017131">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2017152">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017169">equalFold</span>&nbsp;<span class="keyword" id="2017179">func</span><span class="op" id="2017183">(</span><span class="ident" id="2017184">s</span><span class="op" id="2017185">,</span>&nbsp;<span class="ident" id="2017187">t</span>&nbsp;<span class="op" id="2017189">[</span><span class="op" id="2017190">]</span><span class="builtintype" id="2017191">byte</span><span class="op" id="2017195">)</span>&nbsp;<span class="builtintype" id="2017197">bool</span>&nbsp;<span class="comment" id="2017202">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017237">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2017247">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017253">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2017263">[</span><span class="op" id="2017264">]</span><span class="builtintype" id="2017265">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017270">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017280">reflect</span><span class="op" id="2017287">.</span><span class="ident" id="2017288">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017294">omitEmpty</span>&nbsp;<span class="builtintype" id="2017304">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017310">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2017320">bool</span><br>
<span class="lineno"></span><span class="op" id="2017325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017328">func</span>&nbsp;<span class="ident" id="2017333">fillField</span><span class="op" id="2017342">(</span><span class="ident" id="2017343">f</span>&nbsp;<span class="ident" id="2017345">field</span><span class="op" id="2017350">)</span>&nbsp;<span class="ident" id="2017352">field</span>&nbsp;<span class="op" id="2017358">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017361">f</span><span class="op" id="2017362">.</span><span class="ident" id="2017363">nameBytes</span>&nbsp;<span class="op" id="2017373">=</span>&nbsp;<span class="op" id="2017375">[</span><span class="op" id="2017376">]</span><span class="builtintype" id="2017377">byte</span><span class="op" id="2017381">(</span><span class="ident" id="2017382">f</span><span class="op" id="2017383">.</span><span class="ident" id="2017384">name</span><span class="op" id="2017388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2017391">f</span><span class="op" id="2017392">.</span><span class="ident" id="2017393">equalFold</span>&nbsp;<span class="op" id="2017403">=</span>&nbsp;<span class="ident" id="2017405">foldFunc</span><span class="op" id="2017413">(</span><span class="ident" id="2017414">f</span><span class="op" id="2017415">.</span><span class="ident" id="2017416">nameBytes</span><span class="op" id="2017425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017428">return</span>&nbsp;<span class="ident" id="2017435">f</span><br>
<span class="lineno"></span><span class="op" id="2017437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="2017440">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="2017497">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="2017556">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="2017594">type</span>&nbsp;<span class="ident" id="2017599">byName</span>&nbsp;<span class="op" id="2017606">[</span><span class="op" id="2017607">]</span><span class="ident" id="2017608">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="2017615">func</span>&nbsp;<span class="op" id="2017620">(</span><span class="ident" id="2017621">x</span>&nbsp;<span class="ident" id="2017623">byName</span><span class="op" id="2017629">)</span>&nbsp;<span class="ident" id="2017631">Len</span><span class="op" id="2017634">(</span><span class="op" id="2017635">)</span>&nbsp;<span class="builtintype" id="2017637">int</span>&nbsp;<span class="op" id="2017641">{</span>&nbsp;<span class="keyword" id="2017643">return</span>&nbsp;<span class="builtinfunc" id="2017650">len</span><span class="op" id="2017653">(</span><span class="ident" id="2017654">x</span><span class="op" id="2017655">)</span>&nbsp;<span class="op" id="2017657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017660">func</span>&nbsp;<span class="op" id="2017665">(</span><span class="ident" id="2017666">x</span>&nbsp;<span class="ident" id="2017668">byName</span><span class="op" id="2017674">)</span>&nbsp;<span class="ident" id="2017676">Swap</span><span class="op" id="2017680">(</span><span class="ident" id="2017681">i</span><span class="op" id="2017682">,</span>&nbsp;<span class="ident" id="2017684">j</span>&nbsp;<span class="builtintype" id="2017686">int</span><span class="op" id="2017689">)</span>&nbsp;<span class="op" id="2017691">{</span>&nbsp;<span class="ident" id="2017693">x</span><span class="op" id="2017694">[</span><span class="ident" id="2017695">i</span><span class="op" id="2017696">]</span><span class="op" id="2017697">,</span>&nbsp;<span class="ident" id="2017699">x</span><span class="op" id="2017700">[</span><span class="ident" id="2017701">j</span><span class="op" id="2017702">]</span>&nbsp;<span class="op" id="2017704">=</span>&nbsp;<span class="ident" id="2017706">x</span><span class="op" id="2017707">[</span><span class="ident" id="2017708">j</span><span class="op" id="2017709">]</span><span class="op" id="2017710">,</span>&nbsp;<span class="ident" id="2017712">x</span><span class="op" id="2017713">[</span><span class="ident" id="2017714">i</span><span class="op" id="2017715">]</span>&nbsp;<span class="op" id="2017717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017720">func</span>&nbsp;<span class="op" id="2017725">(</span><span class="ident" id="2017726">x</span>&nbsp;<span class="ident" id="2017728">byName</span><span class="op" id="2017734">)</span>&nbsp;<span class="ident" id="2017736">Less</span><span class="op" id="2017740">(</span><span class="ident" id="2017741">i</span><span class="op" id="2017742">,</span>&nbsp;<span class="ident" id="2017744">j</span>&nbsp;<span class="builtintype" id="2017746">int</span><span class="op" id="2017749">)</span>&nbsp;<span class="builtintype" id="2017751">bool</span>&nbsp;<span class="op" id="2017756">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017759">if</span>&nbsp;<span class="ident" id="2017762">x</span><span class="op" id="2017763">[</span><span class="ident" id="2017764">i</span><span class="op" id="2017765">]</span><span class="op" id="2017766">.</span><span class="ident" id="2017767">name</span>&nbsp;<span class="op" id="2017772">!=</span>&nbsp;<span class="ident" id="2017775">x</span><span class="op" id="2017776">[</span><span class="ident" id="2017777">j</span><span class="op" id="2017778">]</span><span class="op" id="2017779">.</span><span class="ident" id="2017780">name</span>&nbsp;<span class="op" id="2017785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017789">return</span>&nbsp;<span class="ident" id="2017796">x</span><span class="op" id="2017797">[</span><span class="ident" id="2017798">i</span><span class="op" id="2017799">]</span><span class="op" id="2017800">.</span><span class="ident" id="2017801">name</span>&nbsp;<span class="op" id="2017806">&lt;</span>&nbsp;<span class="ident" id="2017808">x</span><span class="op" id="2017809">[</span><span class="ident" id="2017810">j</span><span class="op" id="2017811">]</span><span class="op" id="2017812">.</span><span class="ident" id="2017813">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2017819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017822">if</span>&nbsp;<span class="builtinfunc" id="2017825">len</span><span class="op" id="2017828">(</span><span class="ident" id="2017829">x</span><span class="op" id="2017830">[</span><span class="ident" id="2017831">i</span><span class="op" id="2017832">]</span><span class="op" id="2017833">.</span><span class="ident" id="2017834">index</span><span class="op" id="2017839">)</span>&nbsp;<span class="op" id="2017841">!=</span>&nbsp;<span class="builtinfunc" id="2017844">len</span><span class="op" id="2017847">(</span><span class="ident" id="2017848">x</span><span class="op" id="2017849">[</span><span class="ident" id="2017850">j</span><span class="op" id="2017851">]</span><span class="op" id="2017852">.</span><span class="ident" id="2017853">index</span><span class="op" id="2017858">)</span>&nbsp;<span class="op" id="2017860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017864">return</span>&nbsp;<span class="builtinfunc" id="2017871">len</span><span class="op" id="2017874">(</span><span class="ident" id="2017875">x</span><span class="op" id="2017876">[</span><span class="ident" id="2017877">i</span><span class="op" id="2017878">]</span><span class="op" id="2017879">.</span><span class="ident" id="2017880">index</span><span class="op" id="2017885">)</span>&nbsp;<span class="op" id="2017887">&lt;</span>&nbsp;<span class="builtinfunc" id="2017889">len</span><span class="op" id="2017892">(</span><span class="ident" id="2017893">x</span><span class="op" id="2017894">[</span><span class="ident" id="2017895">j</span><span class="op" id="2017896">]</span><span class="op" id="2017897">.</span><span class="ident" id="2017898">index</span><span class="op" id="2017903">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2017906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017909">if</span>&nbsp;<span class="ident" id="2017912">x</span><span class="op" id="2017913">[</span><span class="ident" id="2017914">i</span><span class="op" id="2017915">]</span><span class="op" id="2017916">.</span><span class="ident" id="2017917">tag</span>&nbsp;<span class="op" id="2017921">!=</span>&nbsp;<span class="ident" id="2017924">x</span><span class="op" id="2017925">[</span><span class="ident" id="2017926">j</span><span class="op" id="2017927">]</span><span class="op" id="2017928">.</span><span class="ident" id="2017929">tag</span>&nbsp;<span class="op" id="2017933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017937">return</span>&nbsp;<span class="ident" id="2017944">x</span><span class="op" id="2017945">[</span><span class="ident" id="2017946">i</span><span class="op" id="2017947">]</span><span class="op" id="2017948">.</span><span class="ident" id="2017949">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2017954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2017957">return</span>&nbsp;<span class="ident" id="2017964">byIndex</span><span class="op" id="2017971">(</span><span class="ident" id="2017972">x</span><span class="op" id="2017973">)</span><span class="op" id="2017974">.</span><span class="ident" id="2017975">Less</span><span class="op" id="2017979">(</span><span class="ident" id="2017980">i</span><span class="op" id="2017981">,</span>&nbsp;<span class="ident" id="2017983">j</span><span class="op" id="2017984">)</span><br>
<span class="lineno">975</span><span class="op" id="2017986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2017989">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="2018031">type</span>&nbsp;<span class="ident" id="2018036">byIndex</span>&nbsp;<span class="op" id="2018044">[</span><span class="op" id="2018045">]</span><span class="ident" id="2018046">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="2018053">func</span>&nbsp;<span class="op" id="2018058">(</span><span class="ident" id="2018059">x</span>&nbsp;<span class="ident" id="2018061">byIndex</span><span class="op" id="2018068">)</span>&nbsp;<span class="ident" id="2018070">Len</span><span class="op" id="2018073">(</span><span class="op" id="2018074">)</span>&nbsp;<span class="builtintype" id="2018076">int</span>&nbsp;<span class="op" id="2018080">{</span>&nbsp;<span class="keyword" id="2018082">return</span>&nbsp;<span class="builtinfunc" id="2018089">len</span><span class="op" id="2018092">(</span><span class="ident" id="2018093">x</span><span class="op" id="2018094">)</span>&nbsp;<span class="op" id="2018096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2018099">func</span>&nbsp;<span class="op" id="2018104">(</span><span class="ident" id="2018105">x</span>&nbsp;<span class="ident" id="2018107">byIndex</span><span class="op" id="2018114">)</span>&nbsp;<span class="ident" id="2018116">Swap</span><span class="op" id="2018120">(</span><span class="ident" id="2018121">i</span><span class="op" id="2018122">,</span>&nbsp;<span class="ident" id="2018124">j</span>&nbsp;<span class="builtintype" id="2018126">int</span><span class="op" id="2018129">)</span>&nbsp;<span class="op" id="2018131">{</span>&nbsp;<span class="ident" id="2018133">x</span><span class="op" id="2018134">[</span><span class="ident" id="2018135">i</span><span class="op" id="2018136">]</span><span class="op" id="2018137">,</span>&nbsp;<span class="ident" id="2018139">x</span><span class="op" id="2018140">[</span><span class="ident" id="2018141">j</span><span class="op" id="2018142">]</span>&nbsp;<span class="op" id="2018144">=</span>&nbsp;<span class="ident" id="2018146">x</span><span class="op" id="2018147">[</span><span class="ident" id="2018148">j</span><span class="op" id="2018149">]</span><span class="op" id="2018150">,</span>&nbsp;<span class="ident" id="2018152">x</span><span class="op" id="2018153">[</span><span class="ident" id="2018154">i</span><span class="op" id="2018155">]</span>&nbsp;<span class="op" id="2018157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2018160">func</span>&nbsp;<span class="op" id="2018165">(</span><span class="ident" id="2018166">x</span>&nbsp;<span class="ident" id="2018168">byIndex</span><span class="op" id="2018175">)</span>&nbsp;<span class="ident" id="2018177">Less</span><span class="op" id="2018181">(</span><span class="ident" id="2018182">i</span><span class="op" id="2018183">,</span>&nbsp;<span class="ident" id="2018185">j</span>&nbsp;<span class="builtintype" id="2018187">int</span><span class="op" id="2018190">)</span>&nbsp;<span class="builtintype" id="2018192">bool</span>&nbsp;<span class="op" id="2018197">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018200">for</span>&nbsp;<span class="ident" id="2018204">k</span><span class="op" id="2018205">,</span>&nbsp;<span class="ident" id="2018207">xik</span>&nbsp;<span class="op" id="2018211">:=</span>&nbsp;<span class="keyword" id="2018214">range</span>&nbsp;<span class="ident" id="2018220">x</span><span class="op" id="2018221">[</span><span class="ident" id="2018222">i</span><span class="op" id="2018223">]</span><span class="op" id="2018224">.</span><span class="ident" id="2018225">index</span>&nbsp;<span class="op" id="2018231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018235">if</span>&nbsp;<span class="ident" id="2018238">k</span>&nbsp;<span class="op" id="2018240">&gt;=</span>&nbsp;<span class="builtinfunc" id="2018243">len</span><span class="op" id="2018246">(</span><span class="ident" id="2018247">x</span><span class="op" id="2018248">[</span><span class="ident" id="2018249">j</span><span class="op" id="2018250">]</span><span class="op" id="2018251">.</span><span class="ident" id="2018252">index</span><span class="op" id="2018257">)</span>&nbsp;<span class="op" id="2018259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018264">return</span>&nbsp;<span class="builtintype" id="2018271">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2018279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018283">if</span>&nbsp;<span class="ident" id="2018286">xik</span>&nbsp;<span class="op" id="2018290">!=</span>&nbsp;<span class="ident" id="2018293">x</span><span class="op" id="2018294">[</span><span class="ident" id="2018295">j</span><span class="op" id="2018296">]</span><span class="op" id="2018297">.</span><span class="ident" id="2018298">index</span><span class="op" id="2018303">[</span><span class="ident" id="2018304">k</span><span class="op" id="2018305">]</span>&nbsp;<span class="op" id="2018307">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018312">return</span>&nbsp;<span class="ident" id="2018319">xik</span>&nbsp;<span class="op" id="2018323">&lt;</span>&nbsp;<span class="ident" id="2018325">x</span><span class="op" id="2018326">[</span><span class="ident" id="2018327">j</span><span class="op" id="2018328">]</span><span class="op" id="2018329">.</span><span class="ident" id="2018330">index</span><span class="op" id="2018335">[</span><span class="ident" id="2018336">k</span><span class="op" id="2018337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2018341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2018344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2018347">return</span>&nbsp;<span class="builtinfunc" id="2018354">len</span><span class="op" id="2018357">(</span><span class="ident" id="2018358">x</span><span class="op" id="2018359">[</span><span class="ident" id="2018360">i</span><span class="op" id="2018361">]</span><span class="op" id="2018362">.</span><span class="ident" id="2018363">index</span><span class="op" id="2018368">)</span>&nbsp;<span class="op" id="2018370">&lt;</span>&nbsp;<span class="builtinfunc" id="2018372">len</span><span class="op" id="2018375">(</span><span class="ident" id="2018376">x</span><span class="op" id="2018377">[</span><span class="ident" id="2018378">j</span><span class="op" id="2018379">]</span><span class="op" id="2018380">.</span><span class="ident" id="2018381">index</span><span class="op" id="2018386">)</span><br>
<span class="lineno"></span><span class="op" id="2018388">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="2018391">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="2018477">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="2018570">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="2018615">func</span>&nbsp;<span class="ident" id="2018620">typeFields</span><span class="op" id="2018630">(</span><span class="ident" id="2018631">t</span>&nbsp;<span class="ident" id="2018633">reflect</span><span class="op" id="2018640">.</span><span class="ident" id="2018641">Type</span><span class="op" id="2018645">)</span>&nbsp;<span class="op" id="2018647">[</span><span class="op" id="2018648">]</span><span class="ident" id="2018649">field</span>&nbsp;<span class="op" id="2018655">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2018658">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2018725">current</span>&nbsp;<span class="op" id="2018733">:=</span>&nbsp;<span class="op" id="2018736">[</span><span class="op" id="2018737">]</span><span class="ident" id="2018738">field</span><span class="op" id="2018743">{</span><span class="op" id="2018744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2018747">next</span>&nbsp;<span class="op" id="2018752">:=</span>&nbsp;<span class="op" id="2018755">[</span><span class="op" id="2018756">]</span><span class="ident" id="2018757">field</span><span class="op" id="2018762">{</span><span class="op" id="2018763">{</span><span class="ident" id="2018764">typ</span><span class="op" id="2018767">:</span>&nbsp;<span class="ident" id="2018769">t</span><span class="op" id="2018770">}</span><span class="op" id="2018771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2018775">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2018833">count</span>&nbsp;<span class="op" id="2018839">:=</span>&nbsp;<span class="keyword" id="2018842">map</span><span class="op" id="2018845">[</span><span class="ident" id="2018846">reflect</span><span class="op" id="2018853">.</span><span class="ident" id="2018854">Type</span><span class="op" id="2018858">]</span><span class="builtintype" id="2018859">int</span><span class="op" id="2018862">{</span><span class="op" id="2018863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2018866">nextCount</span>&nbsp;<span class="op" id="2018876">:=</span>&nbsp;<span class="keyword" id="2018879">map</span><span class="op" id="2018882">[</span><span class="ident" id="2018883">reflect</span><span class="op" id="2018890">.</span><span class="ident" id="2018891">Type</span><span class="op" id="2018895">]</span><span class="builtintype" id="2018896">int</span><span class="op" id="2018899">{</span><span class="op" id="2018900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2018904">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2018951">visited</span>&nbsp;<span class="op" id="2018959">:=</span>&nbsp;<span class="keyword" id="2018962">map</span><span class="op" id="2018965">[</span><span class="ident" id="2018966">reflect</span><span class="op" id="2018973">.</span><span class="ident" id="2018974">Type</span><span class="op" id="2018978">]</span><span class="builtintype" id="2018979">bool</span><span class="op" id="2018983">{</span><span class="op" id="2018984">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2018988">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019006">var</span>&nbsp;<span class="ident" id="2019010">fields</span>&nbsp;<span class="op" id="2019017">[</span><span class="op" id="2019018">]</span><span class="ident" id="2019019">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019027">for</span>&nbsp;<span class="builtinfunc" id="2019031">len</span><span class="op" id="2019034">(</span><span class="ident" id="2019035">next</span><span class="op" id="2019039">)</span>&nbsp;<span class="op" id="2019041">&gt;</span>&nbsp;<span class="num" id="2019043">0</span>&nbsp;<span class="op" id="2019045">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019049">current</span><span class="op" id="2019056">,</span>&nbsp;<span class="ident" id="2019058">next</span>&nbsp;<span class="op" id="2019063">=</span>&nbsp;<span class="ident" id="2019065">next</span><span class="op" id="2019069">,</span>&nbsp;<span class="ident" id="2019071">current</span><span class="op" id="2019078">[</span><span class="op" id="2019079">:</span><span class="num" id="2019080">0</span><span class="op" id="2019081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019085">count</span><span class="op" id="2019090">,</span>&nbsp;<span class="ident" id="2019092">nextCount</span>&nbsp;<span class="op" id="2019102">=</span>&nbsp;<span class="ident" id="2019104">nextCount</span><span class="op" id="2019113">,</span>&nbsp;<span class="keyword" id="2019115">map</span><span class="op" id="2019118">[</span><span class="ident" id="2019119">reflect</span><span class="op" id="2019126">.</span><span class="ident" id="2019127">Type</span><span class="op" id="2019131">]</span><span class="builtintype" id="2019132">int</span><span class="op" id="2019135">{</span><span class="op" id="2019136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019141">for</span>&nbsp;<span class="ident" id="2019145">_</span><span class="op" id="2019146">,</span>&nbsp;<span class="ident" id="2019148">f</span>&nbsp;<span class="op" id="2019150">:=</span>&nbsp;<span class="keyword" id="2019153">range</span>&nbsp;<span class="ident" id="2019159">current</span>&nbsp;<span class="op" id="2019167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019172">if</span>&nbsp;<span class="ident" id="2019175">visited</span><span class="op" id="2019182">[</span><span class="ident" id="2019183">f</span><span class="op" id="2019184">.</span><span class="ident" id="2019185">typ</span><span class="op" id="2019188">]</span>&nbsp;<span class="op" id="2019190">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019196">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019213">visited</span><span class="op" id="2019220">[</span><span class="ident" id="2019221">f</span><span class="op" id="2019222">.</span><span class="ident" id="2019223">typ</span><span class="op" id="2019226">]</span>&nbsp;<span class="op" id="2019228">=</span>&nbsp;<span class="builtintype" id="2019230">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2019239">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019279">for</span>&nbsp;<span class="ident" id="2019283">i</span>&nbsp;<span class="op" id="2019285">:=</span>&nbsp;<span class="num" id="2019288">0</span><span class="op" id="2019289">;</span>&nbsp;<span class="ident" id="2019291">i</span>&nbsp;<span class="op" id="2019293">&lt;</span>&nbsp;<span class="ident" id="2019295">f</span><span class="op" id="2019296">.</span><span class="ident" id="2019297">typ</span><span class="op" id="2019300">.</span><span class="ident" id="2019301">NumField</span><span class="op" id="2019309">(</span><span class="op" id="2019310">)</span><span class="op" id="2019311">;</span>&nbsp;<span class="ident" id="2019313">i</span><span class="op" id="2019314">++</span>&nbsp;<span class="op" id="2019317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019323">sf</span>&nbsp;<span class="op" id="2019326">:=</span>&nbsp;<span class="ident" id="2019329">f</span><span class="op" id="2019330">.</span><span class="ident" id="2019331">typ</span><span class="op" id="2019334">.</span><span class="ident" id="2019335">Field</span><span class="op" id="2019340">(</span><span class="ident" id="2019341">i</span><span class="op" id="2019342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019348">if</span>&nbsp;<span class="ident" id="2019351">sf</span><span class="op" id="2019353">.</span><span class="ident" id="2019354">PkgPath</span>&nbsp;<span class="op" id="2019362">!=</span>&nbsp;<span class="string" id="2019365">&#34;&#34;</span>&nbsp;<span class="op" id="2019368">{</span>&nbsp;<span class="comment" id="2019370">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019389">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019402">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019408">tag</span>&nbsp;<span class="op" id="2019412">:=</span>&nbsp;<span class="ident" id="2019415">sf</span><span class="op" id="2019417">.</span><span class="ident" id="2019418">Tag</span><span class="op" id="2019421">.</span><span class="ident" id="2019422">Get</span><span class="op" id="2019425">(</span><span class="string" id="2019426">&#34;json&#34;</span><span class="op" id="2019432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019438">if</span>&nbsp;<span class="ident" id="2019441">tag</span>&nbsp;<span class="op" id="2019445">==</span>&nbsp;<span class="string" id="2019448">&#34;-&#34;</span>&nbsp;<span class="op" id="2019452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019478">name</span><span class="op" id="2019482">,</span>&nbsp;<span class="ident" id="2019484">opts</span>&nbsp;<span class="op" id="2019489">:=</span>&nbsp;<span class="ident" id="2019492">parseTag</span><span class="op" id="2019500">(</span><span class="ident" id="2019501">tag</span><span class="op" id="2019504">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019510">if</span>&nbsp;<span class="op" id="2019513">!</span><span class="ident" id="2019514">isValidTag</span><span class="op" id="2019524">(</span><span class="ident" id="2019525">name</span><span class="op" id="2019529">)</span>&nbsp;<span class="op" id="2019531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019538">name</span>&nbsp;<span class="op" id="2019543">=</span>&nbsp;<span class="string" id="2019545">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019558">index</span>&nbsp;<span class="op" id="2019564">:=</span>&nbsp;<span class="builtinfunc" id="2019567">make</span><span class="op" id="2019571">(</span><span class="op" id="2019572">[</span><span class="op" id="2019573">]</span><span class="builtintype" id="2019574">int</span><span class="op" id="2019577">,</span>&nbsp;<span class="builtinfunc" id="2019579">len</span><span class="op" id="2019582">(</span><span class="ident" id="2019583">f</span><span class="op" id="2019584">.</span><span class="ident" id="2019585">index</span><span class="op" id="2019590">)</span><span class="op" id="2019591">+</span><span class="num" id="2019592">1</span><span class="op" id="2019593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2019599">copy</span><span class="op" id="2019603">(</span><span class="ident" id="2019604">index</span><span class="op" id="2019609">,</span>&nbsp;<span class="ident" id="2019611">f</span><span class="op" id="2019612">.</span><span class="ident" id="2019613">index</span><span class="op" id="2019618">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019624">index</span><span class="op" id="2019629">[</span><span class="builtinfunc" id="2019630">len</span><span class="op" id="2019633">(</span><span class="ident" id="2019634">f</span><span class="op" id="2019635">.</span><span class="ident" id="2019636">index</span><span class="op" id="2019641">)</span><span class="op" id="2019642">]</span>&nbsp;<span class="op" id="2019644">=</span>&nbsp;<span class="ident" id="2019646">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019653">ft</span>&nbsp;<span class="op" id="2019656">:=</span>&nbsp;<span class="ident" id="2019659">sf</span><span class="op" id="2019661">.</span><span class="ident" id="2019662">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019671">if</span>&nbsp;<span class="ident" id="2019674">ft</span><span class="op" id="2019676">.</span><span class="ident" id="2019677">Name</span><span class="op" id="2019681">(</span><span class="op" id="2019682">)</span>&nbsp;<span class="op" id="2019684">==</span>&nbsp;<span class="string" id="2019687">&#34;&#34;</span>&nbsp;<span class="op" id="2019690">&amp;&amp;</span>&nbsp;<span class="ident" id="2019693">ft</span><span class="op" id="2019695">.</span><span class="ident" id="2019696">Kind</span><span class="op" id="2019700">(</span><span class="op" id="2019701">)</span>&nbsp;<span class="op" id="2019703">==</span>&nbsp;<span class="ident" id="2019706">reflect</span><span class="op" id="2019713">.</span><span class="ident" id="2019714">Ptr</span>&nbsp;<span class="op" id="2019718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2019725">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019749">ft</span>&nbsp;<span class="op" id="2019752">=</span>&nbsp;<span class="ident" id="2019754">ft</span><span class="op" id="2019756">.</span><span class="ident" id="2019757">Elem</span><span class="op" id="2019761">(</span><span class="op" id="2019762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2019775">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019821">if</span>&nbsp;<span class="ident" id="2019824">name</span>&nbsp;<span class="op" id="2019829">!=</span>&nbsp;<span class="string" id="2019832">&#34;&#34;</span>&nbsp;<span class="op" id="2019835">||</span>&nbsp;<span class="op" id="2019838">!</span><span class="ident" id="2019839">sf</span><span class="op" id="2019841">.</span><span class="ident" id="2019842">Anonymous</span>&nbsp;<span class="op" id="2019852">||</span>&nbsp;<span class="ident" id="2019855">ft</span><span class="op" id="2019857">.</span><span class="ident" id="2019858">Kind</span><span class="op" id="2019862">(</span><span class="op" id="2019863">)</span>&nbsp;<span class="op" id="2019865">!=</span>&nbsp;<span class="ident" id="2019868">reflect</span><span class="op" id="2019875">.</span><span class="ident" id="2019876">Struct</span>&nbsp;<span class="op" id="2019883">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019890">tagged</span>&nbsp;<span class="op" id="2019897">:=</span>&nbsp;<span class="ident" id="2019900">name</span>&nbsp;<span class="op" id="2019905">!=</span>&nbsp;<span class="string" id="2019908">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2019916">if</span>&nbsp;<span class="ident" id="2019919">name</span>&nbsp;<span class="op" id="2019924">==</span>&nbsp;<span class="string" id="2019927">&#34;&#34;</span>&nbsp;<span class="op" id="2019930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019938">name</span>&nbsp;<span class="op" id="2019943">=</span>&nbsp;<span class="ident" id="2019945">sf</span><span class="op" id="2019947">.</span><span class="ident" id="2019948">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2019958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2019965">fields</span>&nbsp;<span class="op" id="2019972">=</span>&nbsp;<span class="builtinfunc" id="2019974">append</span><span class="op" id="2019980">(</span><span class="ident" id="2019981">fields</span><span class="op" id="2019987">,</span>&nbsp;<span class="ident" id="2019989">fillField</span><span class="op" id="2019998">(</span><span class="ident" id="2019999">field</span><span class="op" id="2020004">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020012">name</span><span class="op" id="2020016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020023">name</span><span class="op" id="2020027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020035">tag</span><span class="op" id="2020038">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020046">tagged</span><span class="op" id="2020052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020060">index</span><span class="op" id="2020065">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020071">index</span><span class="op" id="2020076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020084">typ</span><span class="op" id="2020087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020095">ft</span><span class="op" id="2020097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020105">omitEmpty</span><span class="op" id="2020114">:</span>&nbsp;<span class="ident" id="2020116">opts</span><span class="op" id="2020120">.</span><span class="ident" id="2020121">Contains</span><span class="op" id="2020129">(</span><span class="string" id="2020130">&#34;omitempty&#34;</span><span class="op" id="2020141">)</span><span class="op" id="2020142">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020150">quoted</span><span class="op" id="2020156">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020161">opts</span><span class="op" id="2020165">.</span><span class="ident" id="2020166">Contains</span><span class="op" id="2020174">(</span><span class="string" id="2020175">&#34;string&#34;</span><span class="op" id="2020183">)</span><span class="op" id="2020184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020191">}</span><span class="op" id="2020192">)</span><span class="op" id="2020193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2020200">if</span>&nbsp;<span class="ident" id="2020203">count</span><span class="op" id="2020208">[</span><span class="ident" id="2020209">f</span><span class="op" id="2020210">.</span><span class="ident" id="2020211">typ</span><span class="op" id="2020214">]</span>&nbsp;<span class="op" id="2020216">&gt;</span>&nbsp;<span class="num" id="2020218">1</span>&nbsp;<span class="op" id="2020220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020228">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020285">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020346">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020407">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020460">fields</span>&nbsp;<span class="op" id="2020467">=</span>&nbsp;<span class="builtinfunc" id="2020469">append</span><span class="op" id="2020475">(</span><span class="ident" id="2020476">fields</span><span class="op" id="2020482">,</span>&nbsp;<span class="ident" id="2020484">fields</span><span class="op" id="2020490">[</span><span class="builtinfunc" id="2020491">len</span><span class="op" id="2020494">(</span><span class="ident" id="2020495">fields</span><span class="op" id="2020501">)</span><span class="op" id="2020502">-</span><span class="num" id="2020503">1</span><span class="op" id="2020504">]</span><span class="op" id="2020505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2020519">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020539">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020600">nextCount</span><span class="op" id="2020609">[</span><span class="ident" id="2020610">ft</span><span class="op" id="2020612">]</span><span class="op" id="2020613">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2020620">if</span>&nbsp;<span class="ident" id="2020623">nextCount</span><span class="op" id="2020632">[</span><span class="ident" id="2020633">ft</span><span class="op" id="2020635">]</span>&nbsp;<span class="op" id="2020637">==</span>&nbsp;<span class="num" id="2020640">1</span>&nbsp;<span class="op" id="2020642">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020649">next</span>&nbsp;<span class="op" id="2020654">=</span>&nbsp;<span class="builtinfunc" id="2020656">append</span><span class="op" id="2020662">(</span><span class="ident" id="2020663">next</span><span class="op" id="2020667">,</span>&nbsp;<span class="ident" id="2020669">fillField</span><span class="op" id="2020678">(</span><span class="ident" id="2020679">field</span><span class="op" id="2020684">{</span><span class="ident" id="2020685">name</span><span class="op" id="2020689">:</span>&nbsp;<span class="ident" id="2020691">ft</span><span class="op" id="2020693">.</span><span class="ident" id="2020694">Name</span><span class="op" id="2020698">(</span><span class="op" id="2020699">)</span><span class="op" id="2020700">,</span>&nbsp;<span class="ident" id="2020702">index</span><span class="op" id="2020707">:</span>&nbsp;<span class="ident" id="2020709">index</span><span class="op" id="2020714">,</span>&nbsp;<span class="ident" id="2020716">typ</span><span class="op" id="2020719">:</span>&nbsp;<span class="ident" id="2020721">ft</span><span class="op" id="2020723">}</span><span class="op" id="2020724">)</span><span class="op" id="2020725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2020743">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2020747">sort</span><span class="op" id="2020751">.</span><span class="ident" id="2020752">Sort</span><span class="op" id="2020756">(</span><span class="ident" id="2020757">byName</span><span class="op" id="2020763">(</span><span class="ident" id="2020764">fields</span><span class="op" id="2020770">)</span><span class="op" id="2020771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020775">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020850">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020903">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2020971">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2021037">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021105">out</span>&nbsp;<span class="op" id="2021109">:=</span>&nbsp;<span class="ident" id="2021112">fields</span><span class="op" id="2021118">[</span><span class="op" id="2021119">:</span><span class="num" id="2021120">0</span><span class="op" id="2021121">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021124">for</span>&nbsp;<span class="ident" id="2021128">advance</span><span class="op" id="2021135">,</span>&nbsp;<span class="ident" id="2021137">i</span>&nbsp;<span class="op" id="2021139">:=</span>&nbsp;<span class="num" id="2021142">0</span><span class="op" id="2021143">,</span>&nbsp;<span class="num" id="2021145">0</span><span class="op" id="2021146">;</span>&nbsp;<span class="ident" id="2021148">i</span>&nbsp;<span class="op" id="2021150">&lt;</span>&nbsp;<span class="builtinfunc" id="2021152">len</span><span class="op" id="2021155">(</span><span class="ident" id="2021156">fields</span><span class="op" id="2021162">)</span><span class="op" id="2021163">;</span>&nbsp;<span class="ident" id="2021165">i</span>&nbsp;<span class="op" id="2021167">+=</span>&nbsp;<span class="ident" id="2021170">advance</span>&nbsp;<span class="op" id="2021178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2021182">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2021211">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021279">fi</span>&nbsp;<span class="op" id="2021282">:=</span>&nbsp;<span class="ident" id="2021285">fields</span><span class="op" id="2021291">[</span><span class="ident" id="2021292">i</span><span class="op" id="2021293">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021297">name</span>&nbsp;<span class="op" id="2021302">:=</span>&nbsp;<span class="ident" id="2021305">fi</span><span class="op" id="2021307">.</span><span class="ident" id="2021308">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021315">for</span>&nbsp;<span class="ident" id="2021319">advance</span>&nbsp;<span class="op" id="2021327">=</span>&nbsp;<span class="num" id="2021329">1</span><span class="op" id="2021330">;</span>&nbsp;<span class="ident" id="2021332">i</span><span class="op" id="2021333">+</span><span class="ident" id="2021334">advance</span>&nbsp;<span class="op" id="2021342">&lt;</span>&nbsp;<span class="builtinfunc" id="2021344">len</span><span class="op" id="2021347">(</span><span class="ident" id="2021348">fields</span><span class="op" id="2021354">)</span><span class="op" id="2021355">;</span>&nbsp;<span class="ident" id="2021357">advance</span><span class="op" id="2021364">++</span>&nbsp;<span class="op" id="2021367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021372">fj</span>&nbsp;<span class="op" id="2021375">:=</span>&nbsp;<span class="ident" id="2021378">fields</span><span class="op" id="2021384">[</span><span class="ident" id="2021385">i</span><span class="op" id="2021386">+</span><span class="ident" id="2021387">advance</span><span class="op" id="2021394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021399">if</span>&nbsp;<span class="ident" id="2021402">fj</span><span class="op" id="2021404">.</span><span class="ident" id="2021405">name</span>&nbsp;<span class="op" id="2021410">!=</span>&nbsp;<span class="ident" id="2021413">name</span>&nbsp;<span class="op" id="2021418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021424">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2021433">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2021437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021441">if</span>&nbsp;<span class="ident" id="2021444">advance</span>&nbsp;<span class="op" id="2021452">==</span>&nbsp;<span class="num" id="2021455">1</span>&nbsp;<span class="op" id="2021457">{</span>&nbsp;<span class="comment" id="2021459">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021495">out</span>&nbsp;<span class="op" id="2021499">=</span>&nbsp;<span class="builtinfunc" id="2021501">append</span><span class="op" id="2021507">(</span><span class="ident" id="2021508">out</span><span class="op" id="2021511">,</span>&nbsp;<span class="ident" id="2021513">fi</span><span class="op" id="2021515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021520">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2021531">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021535">dominant</span><span class="op" id="2021543">,</span>&nbsp;<span class="ident" id="2021545">ok</span>&nbsp;<span class="op" id="2021548">:=</span>&nbsp;<span class="ident" id="2021551">dominantField</span><span class="op" id="2021564">(</span><span class="ident" id="2021565">fields</span><span class="op" id="2021571">[</span><span class="ident" id="2021572">i</span>&nbsp;<span class="op" id="2021574">:</span>&nbsp;<span class="ident" id="2021576">i</span><span class="op" id="2021577">+</span><span class="ident" id="2021578">advance</span><span class="op" id="2021585">]</span><span class="op" id="2021586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021590">if</span>&nbsp;<span class="ident" id="2021593">ok</span>&nbsp;<span class="op" id="2021596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021601">out</span>&nbsp;<span class="op" id="2021605">=</span>&nbsp;<span class="builtinfunc" id="2021607">append</span><span class="op" id="2021613">(</span><span class="ident" id="2021614">out</span><span class="op" id="2021617">,</span>&nbsp;<span class="ident" id="2021619">dominant</span><span class="op" id="2021627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2021631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2021634">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021638">fields</span>&nbsp;<span class="op" id="2021645">=</span>&nbsp;<span class="ident" id="2021647">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2021652">sort</span><span class="op" id="2021656">.</span><span class="ident" id="2021657">Sort</span><span class="op" id="2021661">(</span><span class="ident" id="2021662">byIndex</span><span class="op" id="2021669">(</span><span class="ident" id="2021670">fields</span><span class="op" id="2021676">)</span><span class="op" id="2021677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2021681">return</span>&nbsp;<span class="ident" id="2021688">fields</span><br>
<span class="lineno">1115</span><span class="op" id="2021695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2021698">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2021767">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2021834">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="2021900">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="2021966">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2022033">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="2022048">func</span>&nbsp;<span class="ident" id="2022053">dominantField</span><span class="op" id="2022066">(</span><span class="ident" id="2022067">fields</span>&nbsp;<span class="op" id="2022074">[</span><span class="op" id="2022075">]</span><span class="ident" id="2022076">field</span><span class="op" id="2022081">)</span>&nbsp;<span class="op" id="2022083">(</span><span class="ident" id="2022084">field</span><span class="op" id="2022089">,</span>&nbsp;<span class="builtintype" id="2022091">bool</span><span class="op" id="2022095">)</span>&nbsp;<span class="op" id="2022097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022100">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022171">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022238">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022298">length</span>&nbsp;<span class="op" id="2022305">:=</span>&nbsp;<span class="builtinfunc" id="2022308">len</span><span class="op" id="2022311">(</span><span class="ident" id="2022312">fields</span><span class="op" id="2022318">[</span><span class="num" id="2022319">0</span><span class="op" id="2022320">]</span><span class="op" id="2022321">.</span><span class="ident" id="2022322">index</span><span class="op" id="2022327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022330">tagged</span>&nbsp;<span class="op" id="2022337">:=</span>&nbsp;<span class="op" id="2022340">-</span><span class="num" id="2022341">1</span>&nbsp;<span class="comment" id="2022343">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022376">for</span>&nbsp;<span class="ident" id="2022380">i</span><span class="op" id="2022381">,</span>&nbsp;<span class="ident" id="2022383">f</span>&nbsp;<span class="op" id="2022385">:=</span>&nbsp;<span class="keyword" id="2022388">range</span>&nbsp;<span class="ident" id="2022394">fields</span>&nbsp;<span class="op" id="2022401">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022405">if</span>&nbsp;<span class="builtinfunc" id="2022408">len</span><span class="op" id="2022411">(</span><span class="ident" id="2022412">f</span><span class="op" id="2022413">.</span><span class="ident" id="2022414">index</span><span class="op" id="2022419">)</span>&nbsp;<span class="op" id="2022421">&gt;</span>&nbsp;<span class="ident" id="2022423">length</span>&nbsp;<span class="op" id="2022430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022435">fields</span>&nbsp;<span class="op" id="2022442">=</span>&nbsp;<span class="ident" id="2022444">fields</span><span class="op" id="2022450">[</span><span class="op" id="2022451">:</span><span class="ident" id="2022452">i</span><span class="op" id="2022453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022458">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022470">if</span>&nbsp;<span class="ident" id="2022473">f</span><span class="op" id="2022474">.</span><span class="ident" id="2022475">tag</span>&nbsp;<span class="op" id="2022479">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022484">if</span>&nbsp;<span class="ident" id="2022487">tagged</span>&nbsp;<span class="op" id="2022494">&gt;=</span>&nbsp;<span class="num" id="2022497">0</span>&nbsp;<span class="op" id="2022499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022505">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022564">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022588">return</span>&nbsp;<span class="ident" id="2022595">field</span><span class="op" id="2022600">{</span><span class="op" id="2022601">}</span><span class="op" id="2022602">,</span>&nbsp;<span class="builtintype" id="2022604">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022613">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022618">tagged</span>&nbsp;<span class="op" id="2022625">=</span>&nbsp;<span class="ident" id="2022627">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022637">if</span>&nbsp;<span class="ident" id="2022640">tagged</span>&nbsp;<span class="op" id="2022647">&gt;=</span>&nbsp;<span class="num" id="2022650">0</span>&nbsp;<span class="op" id="2022652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022656">return</span>&nbsp;<span class="ident" id="2022663">fields</span><span class="op" id="2022669">[</span><span class="ident" id="2022670">tagged</span><span class="op" id="2022676">]</span><span class="op" id="2022677">,</span>&nbsp;<span class="builtintype" id="2022679">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022688">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022761">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2022832">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022853">if</span>&nbsp;<span class="builtinfunc" id="2022856">len</span><span class="op" id="2022859">(</span><span class="ident" id="2022860">fields</span><span class="op" id="2022866">)</span>&nbsp;<span class="op" id="2022868">&gt;</span>&nbsp;<span class="num" id="2022870">1</span>&nbsp;<span class="op" id="2022872">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022876">return</span>&nbsp;<span class="ident" id="2022883">field</span><span class="op" id="2022888">{</span><span class="op" id="2022889">}</span><span class="op" id="2022890">,</span>&nbsp;<span class="builtintype" id="2022892">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2022899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2022902">return</span>&nbsp;<span class="ident" id="2022909">fields</span><span class="op" id="2022915">[</span><span class="num" id="2022916">0</span><span class="op" id="2022917">]</span><span class="op" id="2022918">,</span>&nbsp;<span class="builtintype" id="2022920">true</span><br>
<span class="lineno"></span><span class="op" id="2022925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="2022928">var</span>&nbsp;<span class="ident" id="2022932">fieldCache</span>&nbsp;<span class="keyword" id="2022943">struct</span>&nbsp;<span class="op" id="2022950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022953">sync</span><span class="op" id="2022957">.</span><span class="ident" id="2022958">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2022967">m</span>&nbsp;<span class="keyword" id="2022969">map</span><span class="op" id="2022972">[</span><span class="ident" id="2022973">reflect</span><span class="op" id="2022980">.</span><span class="ident" id="2022981">Type</span><span class="op" id="2022985">]</span><span class="op" id="2022986">[</span><span class="op" id="2022987">]</span><span class="ident" id="2022988">field</span><br>
<span class="lineno"></span><span class="op" id="2022994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="2022997">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="2023077">func</span>&nbsp;<span class="ident" id="2023082">cachedTypeFields</span><span class="op" id="2023098">(</span><span class="ident" id="2023099">t</span>&nbsp;<span class="ident" id="2023101">reflect</span><span class="op" id="2023108">.</span><span class="ident" id="2023109">Type</span><span class="op" id="2023113">)</span>&nbsp;<span class="op" id="2023115">[</span><span class="op" id="2023116">]</span><span class="ident" id="2023117">field</span>&nbsp;<span class="op" id="2023123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023126">fieldCache</span><span class="op" id="2023136">.</span><span class="ident" id="2023137">RLock</span><span class="op" id="2023142">(</span><span class="op" id="2023143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023146">f</span>&nbsp;<span class="op" id="2023148">:=</span>&nbsp;<span class="ident" id="2023151">fieldCache</span><span class="op" id="2023161">.</span><span class="ident" id="2023162">m</span><span class="op" id="2023163">[</span><span class="ident" id="2023164">t</span><span class="op" id="2023165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023168">fieldCache</span><span class="op" id="2023178">.</span><span class="ident" id="2023179">RUnlock</span><span class="op" id="2023186">(</span><span class="op" id="2023187">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2023190">if</span>&nbsp;<span class="ident" id="2023193">f</span>&nbsp;<span class="op" id="2023195">!=</span>&nbsp;<span class="builtintype" id="2023198">nil</span>&nbsp;<span class="op" id="2023202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2023206">return</span>&nbsp;<span class="ident" id="2023213">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2023216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2023220">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2023253">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023320">f</span>&nbsp;<span class="op" id="2023322">=</span>&nbsp;<span class="ident" id="2023324">typeFields</span><span class="op" id="2023334">(</span><span class="ident" id="2023335">t</span><span class="op" id="2023336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2023339">if</span>&nbsp;<span class="ident" id="2023342">f</span>&nbsp;<span class="op" id="2023344">==</span>&nbsp;<span class="builtintype" id="2023347">nil</span>&nbsp;<span class="op" id="2023351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023355">f</span>&nbsp;<span class="op" id="2023357">=</span>&nbsp;<span class="op" id="2023359">[</span><span class="op" id="2023360">]</span><span class="ident" id="2023361">field</span><span class="op" id="2023366">{</span><span class="op" id="2023367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2023370">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023374">fieldCache</span><span class="op" id="2023384">.</span><span class="ident" id="2023385">Lock</span><span class="op" id="2023389">(</span><span class="op" id="2023390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2023393">if</span>&nbsp;<span class="ident" id="2023396">fieldCache</span><span class="op" id="2023406">.</span><span class="ident" id="2023407">m</span>&nbsp;<span class="op" id="2023409">==</span>&nbsp;<span class="builtintype" id="2023412">nil</span>&nbsp;<span class="op" id="2023416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023420">fieldCache</span><span class="op" id="2023430">.</span><span class="ident" id="2023431">m</span>&nbsp;<span class="op" id="2023433">=</span>&nbsp;<span class="keyword" id="2023435">map</span><span class="op" id="2023438">[</span><span class="ident" id="2023439">reflect</span><span class="op" id="2023446">.</span><span class="ident" id="2023447">Type</span><span class="op" id="2023451">]</span><span class="op" id="2023452">[</span><span class="op" id="2023453">]</span><span class="ident" id="2023454">field</span><span class="op" id="2023459">{</span><span class="op" id="2023460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2023463">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023466">fieldCache</span><span class="op" id="2023476">.</span><span class="ident" id="2023477">m</span><span class="op" id="2023478">[</span><span class="ident" id="2023479">t</span><span class="op" id="2023480">]</span>&nbsp;<span class="op" id="2023482">=</span>&nbsp;<span class="ident" id="2023484">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2023487">fieldCache</span><span class="op" id="2023497">.</span><span class="ident" id="2023498">Unlock</span><span class="op" id="2023504">(</span><span class="op" id="2023505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2023508">return</span>&nbsp;<span class="ident" id="2023515">f</span><br>
<span class="lineno"></span><span class="op" id="2023517">}</span>
</div>
</body>
</html>
