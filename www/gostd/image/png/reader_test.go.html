<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7045435">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7045490">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7045544">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7045595">package</span>&nbsp;<span class="ident" id="7045603">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7045608">import</span>&nbsp;<span class="op" id="7045615">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045618">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045627">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045634">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045643">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045658">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045664">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045677">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045683">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045694">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7045704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7045707">var</span>&nbsp;<span class="ident" id="7045711">filenames</span>&nbsp;<span class="op" id="7045721">=</span>&nbsp;<span class="op" id="7045723">[</span><span class="op" id="7045724">]</span><span class="builtintype" id="7045725">string</span><span class="op" id="7045731">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045734">&#34;basn0g01&#34;</span><span class="op" id="7045744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045747">&#34;basn0g01-30&#34;</span><span class="op" id="7045760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045763">&#34;basn0g02&#34;</span><span class="op" id="7045773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045776">&#34;basn0g02-29&#34;</span><span class="op" id="7045789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045792">&#34;basn0g04&#34;</span><span class="op" id="7045802">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045805">&#34;basn0g04-31&#34;</span><span class="op" id="7045818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045821">&#34;basn0g08&#34;</span><span class="op" id="7045831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045834">&#34;basn0g16&#34;</span><span class="op" id="7045844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045847">&#34;basn2c08&#34;</span><span class="op" id="7045857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045860">&#34;basn2c16&#34;</span><span class="op" id="7045870">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045873">&#34;basn3p01&#34;</span><span class="op" id="7045883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045886">&#34;basn3p02&#34;</span><span class="op" id="7045896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045899">&#34;basn3p04&#34;</span><span class="op" id="7045909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045912">&#34;basn3p04-31i&#34;</span><span class="op" id="7045926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045929">&#34;basn3p08&#34;</span><span class="op" id="7045939">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045942">&#34;basn3p08-trns&#34;</span><span class="op" id="7045957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045960">&#34;basn4a08&#34;</span><span class="op" id="7045970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045973">&#34;basn4a16&#34;</span><span class="op" id="7045983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045986">&#34;basn6a08&#34;</span><span class="op" id="7045996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7045999">&#34;basn6a16&#34;</span><span class="op" id="7046009">,</span><br>
<span class="lineno">40</span><span class="op" id="7046011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7046014">var</span>&nbsp;<span class="ident" id="7046018">filenamesPaletted</span>&nbsp;<span class="op" id="7046036">=</span>&nbsp;<span class="op" id="7046038">[</span><span class="op" id="7046039">]</span><span class="builtintype" id="7046040">string</span><span class="op" id="7046046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046049">&#34;basn3p01&#34;</span><span class="op" id="7046059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046062">&#34;basn3p02&#34;</span><span class="op" id="7046072">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046075">&#34;basn3p04&#34;</span><span class="op" id="7046085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046088">&#34;basn3p08&#34;</span><span class="op" id="7046098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046101">&#34;basn3p08-trns&#34;</span><span class="op" id="7046116">,</span><br>
<span class="lineno"></span><span class="op" id="7046118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7046121">var</span>&nbsp;<span class="ident" id="7046125">filenamesShort</span>&nbsp;<span class="op" id="7046140">=</span>&nbsp;<span class="op" id="7046142">[</span><span class="op" id="7046143">]</span><span class="builtintype" id="7046144">string</span><span class="op" id="7046150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046153">&#34;basn0g01&#34;</span><span class="op" id="7046163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046166">&#34;basn0g04-31&#34;</span><span class="op" id="7046179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7046182">&#34;basn6a16&#34;</span><span class="op" id="7046192">,</span><br>
<span class="lineno"></span><span class="op" id="7046194">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7046197">func</span>&nbsp;<span class="ident" id="7046202">readPNG</span><span class="op" id="7046209">(</span><span class="ident" id="7046210">filename</span>&nbsp;<span class="builtintype" id="7046219">string</span><span class="op" id="7046225">)</span>&nbsp;<span class="op" id="7046227">(</span><span class="ident" id="7046228">image</span><span class="op" id="7046233">.</span><span class="ident" id="7046234">Image</span><span class="op" id="7046239">,</span>&nbsp;<span class="builtintype" id="7046241">error</span><span class="op" id="7046246">)</span>&nbsp;<span class="op" id="7046248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046251">f</span><span class="op" id="7046252">,</span>&nbsp;<span class="ident" id="7046254">err</span>&nbsp;<span class="op" id="7046258">:=</span>&nbsp;<span class="ident" id="7046261">os</span><span class="op" id="7046263">.</span><span class="ident" id="7046264">Open</span><span class="op" id="7046268">(</span><span class="ident" id="7046269">filename</span><span class="op" id="7046277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046280">if</span>&nbsp;<span class="ident" id="7046283">err</span>&nbsp;<span class="op" id="7046287">!=</span>&nbsp;<span class="ident" id="7046290">nil</span>&nbsp;<span class="op" id="7046294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046298">return</span>&nbsp;<span class="ident" id="7046305">nil</span><span class="op" id="7046308">,</span>&nbsp;<span class="ident" id="7046310">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7046315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046318">defer</span>&nbsp;<span class="ident" id="7046324">f</span><span class="op" id="7046325">.</span><span class="ident" id="7046326">Close</span><span class="op" id="7046331">(</span><span class="op" id="7046332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046335">return</span>&nbsp;<span class="ident" id="7046342">Decode</span><span class="op" id="7046348">(</span><span class="ident" id="7046349">f</span><span class="op" id="7046350">)</span><br>
<span class="lineno"></span><span class="op" id="7046352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="7046355">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="7046405">func</span>&nbsp;<span class="ident" id="7046410">sng</span><span class="op" id="7046413">(</span><span class="ident" id="7046414">w</span>&nbsp;<span class="ident" id="7046416">io</span><span class="op" id="7046418">.</span><span class="ident" id="7046419">WriteCloser</span><span class="op" id="7046430">,</span>&nbsp;<span class="ident" id="7046432">filename</span>&nbsp;<span class="builtintype" id="7046441">string</span><span class="op" id="7046447">,</span>&nbsp;<span class="ident" id="7046449">png</span>&nbsp;<span class="ident" id="7046453">image</span><span class="op" id="7046458">.</span><span class="ident" id="7046459">Image</span><span class="op" id="7046464">)</span>&nbsp;<span class="op" id="7046466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046469">defer</span>&nbsp;<span class="ident" id="7046475">w</span><span class="op" id="7046476">.</span><span class="ident" id="7046477">Close</span><span class="op" id="7046482">(</span><span class="op" id="7046483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046486">bounds</span>&nbsp;<span class="op" id="7046493">:=</span>&nbsp;<span class="ident" id="7046496">png</span><span class="op" id="7046499">.</span><span class="ident" id="7046500">Bounds</span><span class="op" id="7046506">(</span><span class="op" id="7046507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046510">cm</span>&nbsp;<span class="op" id="7046513">:=</span>&nbsp;<span class="ident" id="7046516">png</span><span class="op" id="7046519">.</span><span class="ident" id="7046520">ColorModel</span><span class="op" id="7046530">(</span><span class="op" id="7046531">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046534">var</span>&nbsp;<span class="ident" id="7046538">bitdepth</span>&nbsp;<span class="builtintype" id="7046547">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046552">switch</span>&nbsp;<span class="ident" id="7046559">cm</span>&nbsp;<span class="op" id="7046562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046565">case</span>&nbsp;<span class="ident" id="7046570">color</span><span class="op" id="7046575">.</span><span class="ident" id="7046576">RGBAModel</span><span class="op" id="7046585">,</span>&nbsp;<span class="ident" id="7046587">color</span><span class="op" id="7046592">.</span><span class="ident" id="7046593">NRGBAModel</span><span class="op" id="7046603">,</span>&nbsp;<span class="ident" id="7046605">color</span><span class="op" id="7046610">.</span><span class="ident" id="7046611">AlphaModel</span><span class="op" id="7046621">,</span>&nbsp;<span class="ident" id="7046623">color</span><span class="op" id="7046628">.</span><span class="ident" id="7046629">GrayModel</span><span class="op" id="7046638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046642">bitdepth</span>&nbsp;<span class="op" id="7046651">=</span>&nbsp;<span class="num" id="7046653">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046656">default</span><span class="op" id="7046663">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046667">bitdepth</span>&nbsp;<span class="op" id="7046676">=</span>&nbsp;<span class="num" id="7046678">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7046682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046685">cpm</span><span class="op" id="7046688">,</span>&nbsp;<span class="ident" id="7046690">_</span>&nbsp;<span class="op" id="7046692">:=</span>&nbsp;<span class="ident" id="7046695">cm</span><span class="op" id="7046697">.</span><span class="op" id="7046698">(</span><span class="ident" id="7046699">color</span><span class="op" id="7046704">.</span><span class="ident" id="7046705">Palette</span><span class="op" id="7046712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046715">var</span>&nbsp;<span class="ident" id="7046719">paletted</span>&nbsp;<span class="op" id="7046728">*</span><span class="ident" id="7046729">image</span><span class="op" id="7046734">.</span><span class="ident" id="7046735">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046745">if</span>&nbsp;<span class="ident" id="7046748">cpm</span>&nbsp;<span class="op" id="7046752">!=</span>&nbsp;<span class="ident" id="7046755">nil</span>&nbsp;<span class="op" id="7046759">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046763">switch</span>&nbsp;<span class="op" id="7046770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046774">case</span>&nbsp;<span class="builtinfunc" id="7046779">len</span><span class="op" id="7046782">(</span><span class="ident" id="7046783">cpm</span><span class="op" id="7046786">)</span>&nbsp;<span class="op" id="7046788">&lt;=</span>&nbsp;<span class="num" id="7046791">2</span><span class="op" id="7046792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046797">bitdepth</span>&nbsp;<span class="op" id="7046806">=</span>&nbsp;<span class="num" id="7046808">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046812">case</span>&nbsp;<span class="builtinfunc" id="7046817">len</span><span class="op" id="7046820">(</span><span class="ident" id="7046821">cpm</span><span class="op" id="7046824">)</span>&nbsp;<span class="op" id="7046826">&lt;=</span>&nbsp;<span class="num" id="7046829">4</span><span class="op" id="7046830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046835">bitdepth</span>&nbsp;<span class="op" id="7046844">=</span>&nbsp;<span class="num" id="7046846">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046850">case</span>&nbsp;<span class="builtinfunc" id="7046855">len</span><span class="op" id="7046858">(</span><span class="ident" id="7046859">cpm</span><span class="op" id="7046862">)</span>&nbsp;<span class="op" id="7046864">&lt;=</span>&nbsp;<span class="num" id="7046867">16</span><span class="op" id="7046869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046874">bitdepth</span>&nbsp;<span class="op" id="7046883">=</span>&nbsp;<span class="num" id="7046885">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7046889">default</span><span class="op" id="7046896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046901">bitdepth</span>&nbsp;<span class="op" id="7046910">=</span>&nbsp;<span class="num" id="7046912">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7046916">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046920">paletted</span>&nbsp;<span class="op" id="7046929">=</span>&nbsp;<span class="ident" id="7046931">png</span><span class="op" id="7046934">.</span><span class="op" id="7046935">(</span><span class="op" id="7046936">*</span><span class="ident" id="7046937">image</span><span class="op" id="7046942">.</span><span class="ident" id="7046943">Paletted</span><span class="op" id="7046951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7046954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7046958">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7046991">io</span><span class="op" id="7046993">.</span><span class="ident" id="7046994">WriteString</span><span class="op" id="7047005">(</span><span class="ident" id="7047006">w</span><span class="op" id="7047007">,</span>&nbsp;<span class="string" id="7047009">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="7047022">+</span><span class="ident" id="7047023">filename</span><span class="op" id="7047031">+</span><span class="string" id="7047032">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="7047048">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047051">fmt</span><span class="op" id="7047054">.</span><span class="ident" id="7047055">Fprintf</span><span class="op" id="7047062">(</span><span class="ident" id="7047063">w</span><span class="op" id="7047064">,</span>&nbsp;<span class="string" id="7047066">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="7047110">,</span>&nbsp;<span class="ident" id="7047112">bounds</span><span class="op" id="7047118">.</span><span class="ident" id="7047119">Dx</span><span class="op" id="7047121">(</span><span class="op" id="7047122">)</span><span class="op" id="7047123">,</span>&nbsp;<span class="ident" id="7047125">bounds</span><span class="op" id="7047131">.</span><span class="ident" id="7047132">Dy</span><span class="op" id="7047134">(</span><span class="op" id="7047135">)</span><span class="op" id="7047136">,</span>&nbsp;<span class="ident" id="7047138">bitdepth</span><span class="op" id="7047146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047149">switch</span>&nbsp;<span class="op" id="7047156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047159">case</span>&nbsp;<span class="ident" id="7047164">cm</span>&nbsp;<span class="op" id="7047167">==</span>&nbsp;<span class="ident" id="7047170">color</span><span class="op" id="7047175">.</span><span class="ident" id="7047176">RGBAModel</span><span class="op" id="7047185">,</span>&nbsp;<span class="ident" id="7047187">cm</span>&nbsp;<span class="op" id="7047190">==</span>&nbsp;<span class="ident" id="7047193">color</span><span class="op" id="7047198">.</span><span class="ident" id="7047199">RGBA64Model</span><span class="op" id="7047210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047214">io</span><span class="op" id="7047216">.</span><span class="ident" id="7047217">WriteString</span><span class="op" id="7047228">(</span><span class="ident" id="7047229">w</span><span class="op" id="7047230">,</span>&nbsp;<span class="string" id="7047232">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="7047252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047255">case</span>&nbsp;<span class="ident" id="7047260">cm</span>&nbsp;<span class="op" id="7047263">==</span>&nbsp;<span class="ident" id="7047266">color</span><span class="op" id="7047271">.</span><span class="ident" id="7047272">NRGBAModel</span><span class="op" id="7047282">,</span>&nbsp;<span class="ident" id="7047284">cm</span>&nbsp;<span class="op" id="7047287">==</span>&nbsp;<span class="ident" id="7047290">color</span><span class="op" id="7047295">.</span><span class="ident" id="7047296">NRGBA64Model</span><span class="op" id="7047308">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047312">io</span><span class="op" id="7047314">.</span><span class="ident" id="7047315">WriteString</span><span class="op" id="7047326">(</span><span class="ident" id="7047327">w</span><span class="op" id="7047328">,</span>&nbsp;<span class="string" id="7047330">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="7047356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047359">case</span>&nbsp;<span class="ident" id="7047364">cm</span>&nbsp;<span class="op" id="7047367">==</span>&nbsp;<span class="ident" id="7047370">color</span><span class="op" id="7047375">.</span><span class="ident" id="7047376">GrayModel</span><span class="op" id="7047385">,</span>&nbsp;<span class="ident" id="7047387">cm</span>&nbsp;<span class="op" id="7047390">==</span>&nbsp;<span class="ident" id="7047393">color</span><span class="op" id="7047398">.</span><span class="ident" id="7047399">Gray16Model</span><span class="op" id="7047410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047414">io</span><span class="op" id="7047416">.</span><span class="ident" id="7047417">WriteString</span><span class="op" id="7047428">(</span><span class="ident" id="7047429">w</span><span class="op" id="7047430">,</span>&nbsp;<span class="string" id="7047432">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="7047456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047459">case</span>&nbsp;<span class="ident" id="7047464">cpm</span>&nbsp;<span class="op" id="7047468">!=</span>&nbsp;<span class="ident" id="7047471">nil</span><span class="op" id="7047474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047478">io</span><span class="op" id="7047480">.</span><span class="ident" id="7047481">WriteString</span><span class="op" id="7047492">(</span><span class="ident" id="7047493">w</span><span class="op" id="7047494">,</span>&nbsp;<span class="string" id="7047496">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="7047524">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047527">default</span><span class="op" id="7047534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047538">io</span><span class="op" id="7047540">.</span><span class="ident" id="7047541">WriteString</span><span class="op" id="7047552">(</span><span class="ident" id="7047553">w</span><span class="op" id="7047554">,</span>&nbsp;<span class="string" id="7047556">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="7047591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7047594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047597">io</span><span class="op" id="7047599">.</span><span class="ident" id="7047600">WriteString</span><span class="op" id="7047611">(</span><span class="ident" id="7047612">w</span><span class="op" id="7047613">,</span>&nbsp;<span class="string" id="7047615">&#34;}\n&#34;</span><span class="op" id="7047620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7047624">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7047717">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047802">io</span><span class="op" id="7047804">.</span><span class="ident" id="7047805">WriteString</span><span class="op" id="7047816">(</span><span class="ident" id="7047817">w</span><span class="op" id="7047818">,</span>&nbsp;<span class="string" id="7047820">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="7047837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7047841">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047886">if</span>&nbsp;<span class="ident" id="7047889">cpm</span>&nbsp;<span class="op" id="7047893">!=</span>&nbsp;<span class="ident" id="7047896">nil</span>&nbsp;<span class="op" id="7047900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047904">lastAlpha</span>&nbsp;<span class="op" id="7047914">:=</span>&nbsp;<span class="op" id="7047917">-</span><span class="num" id="7047918">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7047922">io</span><span class="op" id="7047924">.</span><span class="ident" id="7047925">WriteString</span><span class="op" id="7047936">(</span><span class="ident" id="7047937">w</span><span class="op" id="7047938">,</span>&nbsp;<span class="string" id="7047940">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="7047950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047954">for</span>&nbsp;<span class="ident" id="7047958">i</span><span class="op" id="7047959">,</span>&nbsp;<span class="ident" id="7047961">c</span>&nbsp;<span class="op" id="7047963">:=</span>&nbsp;<span class="keyword" id="7047966">range</span>&nbsp;<span class="ident" id="7047972">cpm</span>&nbsp;<span class="op" id="7047976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7047981">var</span>&nbsp;<span class="ident" id="7047985">r</span><span class="op" id="7047986">,</span>&nbsp;<span class="ident" id="7047988">g</span><span class="op" id="7047989">,</span>&nbsp;<span class="ident" id="7047991">b</span><span class="op" id="7047992">,</span>&nbsp;<span class="ident" id="7047994">a</span>&nbsp;<span class="builtintype" id="7047996">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048005">switch</span>&nbsp;<span class="ident" id="7048012">c</span>&nbsp;<span class="op" id="7048014">:=</span>&nbsp;<span class="ident" id="7048017">c</span><span class="op" id="7048018">.</span><span class="op" id="7048019">(</span><span class="keyword" id="7048020">type</span><span class="op" id="7048024">)</span>&nbsp;<span class="op" id="7048026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048031">case</span>&nbsp;<span class="ident" id="7048036">color</span><span class="op" id="7048041">.</span><span class="ident" id="7048042">RGBA</span><span class="op" id="7048046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048052">r</span><span class="op" id="7048053">,</span>&nbsp;<span class="ident" id="7048055">g</span><span class="op" id="7048056">,</span>&nbsp;<span class="ident" id="7048058">b</span><span class="op" id="7048059">,</span>&nbsp;<span class="ident" id="7048061">a</span>&nbsp;<span class="op" id="7048063">=</span>&nbsp;<span class="ident" id="7048065">c</span><span class="op" id="7048066">.</span><span class="ident" id="7048067">R</span><span class="op" id="7048068">,</span>&nbsp;<span class="ident" id="7048070">c</span><span class="op" id="7048071">.</span><span class="ident" id="7048072">G</span><span class="op" id="7048073">,</span>&nbsp;<span class="ident" id="7048075">c</span><span class="op" id="7048076">.</span><span class="ident" id="7048077">B</span><span class="op" id="7048078">,</span>&nbsp;<span class="num" id="7048080">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048088">case</span>&nbsp;<span class="ident" id="7048093">color</span><span class="op" id="7048098">.</span><span class="ident" id="7048099">NRGBA</span><span class="op" id="7048104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048110">r</span><span class="op" id="7048111">,</span>&nbsp;<span class="ident" id="7048113">g</span><span class="op" id="7048114">,</span>&nbsp;<span class="ident" id="7048116">b</span><span class="op" id="7048117">,</span>&nbsp;<span class="ident" id="7048119">a</span>&nbsp;<span class="op" id="7048121">=</span>&nbsp;<span class="ident" id="7048123">c</span><span class="op" id="7048124">.</span><span class="ident" id="7048125">R</span><span class="op" id="7048126">,</span>&nbsp;<span class="ident" id="7048128">c</span><span class="op" id="7048129">.</span><span class="ident" id="7048130">G</span><span class="op" id="7048131">,</span>&nbsp;<span class="ident" id="7048133">c</span><span class="op" id="7048134">.</span><span class="ident" id="7048135">B</span><span class="op" id="7048136">,</span>&nbsp;<span class="ident" id="7048138">c</span><span class="op" id="7048139">.</span><span class="ident" id="7048140">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048145">default</span><span class="op" id="7048152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7048158">panic</span><span class="op" id="7048163">(</span><span class="string" id="7048164">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="7048192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048202">if</span>&nbsp;<span class="ident" id="7048205">a</span>&nbsp;<span class="op" id="7048207">!=</span>&nbsp;<span class="num" id="7048210">0xff</span>&nbsp;<span class="op" id="7048215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048221">lastAlpha</span>&nbsp;<span class="op" id="7048231">=</span>&nbsp;<span class="ident" id="7048233">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048243">fmt</span><span class="op" id="7048246">.</span><span class="ident" id="7048247">Fprintf</span><span class="op" id="7048254">(</span><span class="ident" id="7048255">w</span><span class="op" id="7048256">,</span>&nbsp;<span class="string" id="7048258">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="7048314">,</span>&nbsp;<span class="ident" id="7048316">r</span><span class="op" id="7048317">,</span>&nbsp;<span class="ident" id="7048319">g</span><span class="op" id="7048320">,</span>&nbsp;<span class="ident" id="7048322">b</span><span class="op" id="7048323">,</span>&nbsp;<span class="ident" id="7048325">r</span><span class="op" id="7048326">,</span>&nbsp;<span class="ident" id="7048328">g</span><span class="op" id="7048329">,</span>&nbsp;<span class="ident" id="7048331">b</span><span class="op" id="7048332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048340">io</span><span class="op" id="7048342">.</span><span class="ident" id="7048343">WriteString</span><span class="op" id="7048354">(</span><span class="ident" id="7048355">w</span><span class="op" id="7048356">,</span>&nbsp;<span class="string" id="7048358">&#34;}\n&#34;</span><span class="op" id="7048363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048367">if</span>&nbsp;<span class="ident" id="7048370">lastAlpha</span>&nbsp;<span class="op" id="7048380">!=</span>&nbsp;<span class="op" id="7048383">-</span><span class="num" id="7048384">1</span>&nbsp;<span class="op" id="7048386">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048391">io</span><span class="op" id="7048393">.</span><span class="ident" id="7048394">WriteString</span><span class="op" id="7048405">(</span><span class="ident" id="7048406">w</span><span class="op" id="7048407">,</span>&nbsp;<span class="string" id="7048409">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="7048419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048424">for</span>&nbsp;<span class="ident" id="7048428">i</span>&nbsp;<span class="op" id="7048430">:=</span>&nbsp;<span class="num" id="7048433">0</span><span class="op" id="7048434">;</span>&nbsp;<span class="ident" id="7048436">i</span>&nbsp;<span class="op" id="7048438">&lt;=</span>&nbsp;<span class="ident" id="7048441">lastAlpha</span><span class="op" id="7048450">;</span>&nbsp;<span class="ident" id="7048452">i</span><span class="op" id="7048453">++</span>&nbsp;<span class="op" id="7048456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048462">_</span><span class="op" id="7048463">,</span>&nbsp;<span class="ident" id="7048465">_</span><span class="op" id="7048466">,</span>&nbsp;<span class="ident" id="7048468">_</span><span class="op" id="7048469">,</span>&nbsp;<span class="ident" id="7048471">a</span>&nbsp;<span class="op" id="7048473">:=</span>&nbsp;<span class="ident" id="7048476">cpm</span><span class="op" id="7048479">[</span><span class="ident" id="7048480">i</span><span class="op" id="7048481">]</span><span class="op" id="7048482">.</span><span class="ident" id="7048483">RGBA</span><span class="op" id="7048487">(</span><span class="op" id="7048488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048494">a</span>&nbsp;<span class="op" id="7048496">&gt;&gt;=</span>&nbsp;<span class="num" id="7048500">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048506">fmt</span><span class="op" id="7048509">.</span><span class="ident" id="7048510">Fprintf</span><span class="op" id="7048517">(</span><span class="ident" id="7048518">w</span><span class="op" id="7048519">,</span>&nbsp;<span class="string" id="7048521">&#34;&nbsp;%d&#34;</span><span class="op" id="7048526">,</span>&nbsp;<span class="ident" id="7048528">a</span><span class="op" id="7048529">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048539">io</span><span class="op" id="7048541">.</span><span class="ident" id="7048542">WriteString</span><span class="op" id="7048553">(</span><span class="ident" id="7048554">w</span><span class="op" id="7048555">,</span>&nbsp;<span class="string" id="7048557">&#34;}\n&#34;</span><span class="op" id="7048562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7048573">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048594">io</span><span class="op" id="7048596">.</span><span class="ident" id="7048597">WriteString</span><span class="op" id="7048608">(</span><span class="ident" id="7048609">w</span><span class="op" id="7048610">,</span>&nbsp;<span class="string" id="7048612">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="7048639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048642">for</span>&nbsp;<span class="ident" id="7048646">y</span>&nbsp;<span class="op" id="7048648">:=</span>&nbsp;<span class="ident" id="7048651">bounds</span><span class="op" id="7048657">.</span><span class="ident" id="7048658">Min</span><span class="op" id="7048661">.</span><span class="ident" id="7048662">Y</span><span class="op" id="7048663">;</span>&nbsp;<span class="ident" id="7048665">y</span>&nbsp;<span class="op" id="7048667">&lt;</span>&nbsp;<span class="ident" id="7048669">bounds</span><span class="op" id="7048675">.</span><span class="ident" id="7048676">Max</span><span class="op" id="7048679">.</span><span class="ident" id="7048680">Y</span><span class="op" id="7048681">;</span>&nbsp;<span class="ident" id="7048683">y</span><span class="op" id="7048684">++</span>&nbsp;<span class="op" id="7048687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048691">switch</span>&nbsp;<span class="op" id="7048698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048702">case</span>&nbsp;<span class="ident" id="7048707">cm</span>&nbsp;<span class="op" id="7048710">==</span>&nbsp;<span class="ident" id="7048713">color</span><span class="op" id="7048718">.</span><span class="ident" id="7048719">GrayModel</span><span class="op" id="7048728">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048733">for</span>&nbsp;<span class="ident" id="7048737">x</span>&nbsp;<span class="op" id="7048739">:=</span>&nbsp;<span class="ident" id="7048742">bounds</span><span class="op" id="7048748">.</span><span class="ident" id="7048749">Min</span><span class="op" id="7048752">.</span><span class="ident" id="7048753">X</span><span class="op" id="7048754">;</span>&nbsp;<span class="ident" id="7048756">x</span>&nbsp;<span class="op" id="7048758">&lt;</span>&nbsp;<span class="ident" id="7048760">bounds</span><span class="op" id="7048766">.</span><span class="ident" id="7048767">Max</span><span class="op" id="7048770">.</span><span class="ident" id="7048771">X</span><span class="op" id="7048772">;</span>&nbsp;<span class="ident" id="7048774">x</span><span class="op" id="7048775">++</span>&nbsp;<span class="op" id="7048778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048784">gray</span>&nbsp;<span class="op" id="7048789">:=</span>&nbsp;<span class="ident" id="7048792">png</span><span class="op" id="7048795">.</span><span class="ident" id="7048796">At</span><span class="op" id="7048798">(</span><span class="ident" id="7048799">x</span><span class="op" id="7048800">,</span>&nbsp;<span class="ident" id="7048802">y</span><span class="op" id="7048803">)</span><span class="op" id="7048804">.</span><span class="op" id="7048805">(</span><span class="ident" id="7048806">color</span><span class="op" id="7048811">.</span><span class="ident" id="7048812">Gray</span><span class="op" id="7048816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048822">fmt</span><span class="op" id="7048825">.</span><span class="ident" id="7048826">Fprintf</span><span class="op" id="7048833">(</span><span class="ident" id="7048834">w</span><span class="op" id="7048835">,</span>&nbsp;<span class="string" id="7048837">&#34;%02x&#34;</span><span class="op" id="7048843">,</span>&nbsp;<span class="ident" id="7048845">gray</span><span class="op" id="7048849">.</span><span class="ident" id="7048850">Y</span><span class="op" id="7048851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7048856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048860">case</span>&nbsp;<span class="ident" id="7048865">cm</span>&nbsp;<span class="op" id="7048868">==</span>&nbsp;<span class="ident" id="7048871">color</span><span class="op" id="7048876">.</span><span class="ident" id="7048877">Gray16Model</span><span class="op" id="7048888">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7048893">for</span>&nbsp;<span class="ident" id="7048897">x</span>&nbsp;<span class="op" id="7048899">:=</span>&nbsp;<span class="ident" id="7048902">bounds</span><span class="op" id="7048908">.</span><span class="ident" id="7048909">Min</span><span class="op" id="7048912">.</span><span class="ident" id="7048913">X</span><span class="op" id="7048914">;</span>&nbsp;<span class="ident" id="7048916">x</span>&nbsp;<span class="op" id="7048918">&lt;</span>&nbsp;<span class="ident" id="7048920">bounds</span><span class="op" id="7048926">.</span><span class="ident" id="7048927">Max</span><span class="op" id="7048930">.</span><span class="ident" id="7048931">X</span><span class="op" id="7048932">;</span>&nbsp;<span class="ident" id="7048934">x</span><span class="op" id="7048935">++</span>&nbsp;<span class="op" id="7048938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048944">gray16</span>&nbsp;<span class="op" id="7048951">:=</span>&nbsp;<span class="ident" id="7048954">png</span><span class="op" id="7048957">.</span><span class="ident" id="7048958">At</span><span class="op" id="7048960">(</span><span class="ident" id="7048961">x</span><span class="op" id="7048962">,</span>&nbsp;<span class="ident" id="7048964">y</span><span class="op" id="7048965">)</span><span class="op" id="7048966">.</span><span class="op" id="7048967">(</span><span class="ident" id="7048968">color</span><span class="op" id="7048973">.</span><span class="ident" id="7048974">Gray16</span><span class="op" id="7048980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7048986">fmt</span><span class="op" id="7048989">.</span><span class="ident" id="7048990">Fprintf</span><span class="op" id="7048997">(</span><span class="ident" id="7048998">w</span><span class="op" id="7048999">,</span>&nbsp;<span class="string" id="7049001">&#34;%04x&nbsp;&#34;</span><span class="op" id="7049008">,</span>&nbsp;<span class="ident" id="7049010">gray16</span><span class="op" id="7049016">.</span><span class="ident" id="7049017">Y</span><span class="op" id="7049018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049027">case</span>&nbsp;<span class="ident" id="7049032">cm</span>&nbsp;<span class="op" id="7049035">==</span>&nbsp;<span class="ident" id="7049038">color</span><span class="op" id="7049043">.</span><span class="ident" id="7049044">RGBAModel</span><span class="op" id="7049053">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049058">for</span>&nbsp;<span class="ident" id="7049062">x</span>&nbsp;<span class="op" id="7049064">:=</span>&nbsp;<span class="ident" id="7049067">bounds</span><span class="op" id="7049073">.</span><span class="ident" id="7049074">Min</span><span class="op" id="7049077">.</span><span class="ident" id="7049078">X</span><span class="op" id="7049079">;</span>&nbsp;<span class="ident" id="7049081">x</span>&nbsp;<span class="op" id="7049083">&lt;</span>&nbsp;<span class="ident" id="7049085">bounds</span><span class="op" id="7049091">.</span><span class="ident" id="7049092">Max</span><span class="op" id="7049095">.</span><span class="ident" id="7049096">X</span><span class="op" id="7049097">;</span>&nbsp;<span class="ident" id="7049099">x</span><span class="op" id="7049100">++</span>&nbsp;<span class="op" id="7049103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049109">rgba</span>&nbsp;<span class="op" id="7049114">:=</span>&nbsp;<span class="ident" id="7049117">png</span><span class="op" id="7049120">.</span><span class="ident" id="7049121">At</span><span class="op" id="7049123">(</span><span class="ident" id="7049124">x</span><span class="op" id="7049125">,</span>&nbsp;<span class="ident" id="7049127">y</span><span class="op" id="7049128">)</span><span class="op" id="7049129">.</span><span class="op" id="7049130">(</span><span class="ident" id="7049131">color</span><span class="op" id="7049136">.</span><span class="ident" id="7049137">RGBA</span><span class="op" id="7049141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049147">fmt</span><span class="op" id="7049150">.</span><span class="ident" id="7049151">Fprintf</span><span class="op" id="7049158">(</span><span class="ident" id="7049159">w</span><span class="op" id="7049160">,</span>&nbsp;<span class="string" id="7049162">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7049177">,</span>&nbsp;<span class="ident" id="7049179">rgba</span><span class="op" id="7049183">.</span><span class="ident" id="7049184">R</span><span class="op" id="7049185">,</span>&nbsp;<span class="ident" id="7049187">rgba</span><span class="op" id="7049191">.</span><span class="ident" id="7049192">G</span><span class="op" id="7049193">,</span>&nbsp;<span class="ident" id="7049195">rgba</span><span class="op" id="7049199">.</span><span class="ident" id="7049200">B</span><span class="op" id="7049201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049210">case</span>&nbsp;<span class="ident" id="7049215">cm</span>&nbsp;<span class="op" id="7049218">==</span>&nbsp;<span class="ident" id="7049221">color</span><span class="op" id="7049226">.</span><span class="ident" id="7049227">RGBA64Model</span><span class="op" id="7049238">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049243">for</span>&nbsp;<span class="ident" id="7049247">x</span>&nbsp;<span class="op" id="7049249">:=</span>&nbsp;<span class="ident" id="7049252">bounds</span><span class="op" id="7049258">.</span><span class="ident" id="7049259">Min</span><span class="op" id="7049262">.</span><span class="ident" id="7049263">X</span><span class="op" id="7049264">;</span>&nbsp;<span class="ident" id="7049266">x</span>&nbsp;<span class="op" id="7049268">&lt;</span>&nbsp;<span class="ident" id="7049270">bounds</span><span class="op" id="7049276">.</span><span class="ident" id="7049277">Max</span><span class="op" id="7049280">.</span><span class="ident" id="7049281">X</span><span class="op" id="7049282">;</span>&nbsp;<span class="ident" id="7049284">x</span><span class="op" id="7049285">++</span>&nbsp;<span class="op" id="7049288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049294">rgba64</span>&nbsp;<span class="op" id="7049301">:=</span>&nbsp;<span class="ident" id="7049304">png</span><span class="op" id="7049307">.</span><span class="ident" id="7049308">At</span><span class="op" id="7049310">(</span><span class="ident" id="7049311">x</span><span class="op" id="7049312">,</span>&nbsp;<span class="ident" id="7049314">y</span><span class="op" id="7049315">)</span><span class="op" id="7049316">.</span><span class="op" id="7049317">(</span><span class="ident" id="7049318">color</span><span class="op" id="7049323">.</span><span class="ident" id="7049324">RGBA64</span><span class="op" id="7049330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049336">fmt</span><span class="op" id="7049339">.</span><span class="ident" id="7049340">Fprintf</span><span class="op" id="7049347">(</span><span class="ident" id="7049348">w</span><span class="op" id="7049349">,</span>&nbsp;<span class="string" id="7049351">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7049366">,</span>&nbsp;<span class="ident" id="7049368">rgba64</span><span class="op" id="7049374">.</span><span class="ident" id="7049375">R</span><span class="op" id="7049376">,</span>&nbsp;<span class="ident" id="7049378">rgba64</span><span class="op" id="7049384">.</span><span class="ident" id="7049385">G</span><span class="op" id="7049386">,</span>&nbsp;<span class="ident" id="7049388">rgba64</span><span class="op" id="7049394">.</span><span class="ident" id="7049395">B</span><span class="op" id="7049396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049405">case</span>&nbsp;<span class="ident" id="7049410">cm</span>&nbsp;<span class="op" id="7049413">==</span>&nbsp;<span class="ident" id="7049416">color</span><span class="op" id="7049421">.</span><span class="ident" id="7049422">NRGBAModel</span><span class="op" id="7049432">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049437">for</span>&nbsp;<span class="ident" id="7049441">x</span>&nbsp;<span class="op" id="7049443">:=</span>&nbsp;<span class="ident" id="7049446">bounds</span><span class="op" id="7049452">.</span><span class="ident" id="7049453">Min</span><span class="op" id="7049456">.</span><span class="ident" id="7049457">X</span><span class="op" id="7049458">;</span>&nbsp;<span class="ident" id="7049460">x</span>&nbsp;<span class="op" id="7049462">&lt;</span>&nbsp;<span class="ident" id="7049464">bounds</span><span class="op" id="7049470">.</span><span class="ident" id="7049471">Max</span><span class="op" id="7049474">.</span><span class="ident" id="7049475">X</span><span class="op" id="7049476">;</span>&nbsp;<span class="ident" id="7049478">x</span><span class="op" id="7049479">++</span>&nbsp;<span class="op" id="7049482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049488">nrgba</span>&nbsp;<span class="op" id="7049494">:=</span>&nbsp;<span class="ident" id="7049497">png</span><span class="op" id="7049500">.</span><span class="ident" id="7049501">At</span><span class="op" id="7049503">(</span><span class="ident" id="7049504">x</span><span class="op" id="7049505">,</span>&nbsp;<span class="ident" id="7049507">y</span><span class="op" id="7049508">)</span><span class="op" id="7049509">.</span><span class="op" id="7049510">(</span><span class="ident" id="7049511">color</span><span class="op" id="7049516">.</span><span class="ident" id="7049517">NRGBA</span><span class="op" id="7049522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049528">fmt</span><span class="op" id="7049531">.</span><span class="ident" id="7049532">Fprintf</span><span class="op" id="7049539">(</span><span class="ident" id="7049540">w</span><span class="op" id="7049541">,</span>&nbsp;<span class="string" id="7049543">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7049562">,</span>&nbsp;<span class="ident" id="7049564">nrgba</span><span class="op" id="7049569">.</span><span class="ident" id="7049570">R</span><span class="op" id="7049571">,</span>&nbsp;<span class="ident" id="7049573">nrgba</span><span class="op" id="7049578">.</span><span class="ident" id="7049579">G</span><span class="op" id="7049580">,</span>&nbsp;<span class="ident" id="7049582">nrgba</span><span class="op" id="7049587">.</span><span class="ident" id="7049588">B</span><span class="op" id="7049589">,</span>&nbsp;<span class="ident" id="7049591">nrgba</span><span class="op" id="7049596">.</span><span class="ident" id="7049597">A</span><span class="op" id="7049598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049607">case</span>&nbsp;<span class="ident" id="7049612">cm</span>&nbsp;<span class="op" id="7049615">==</span>&nbsp;<span class="ident" id="7049618">color</span><span class="op" id="7049623">.</span><span class="ident" id="7049624">NRGBA64Model</span><span class="op" id="7049636">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049641">for</span>&nbsp;<span class="ident" id="7049645">x</span>&nbsp;<span class="op" id="7049647">:=</span>&nbsp;<span class="ident" id="7049650">bounds</span><span class="op" id="7049656">.</span><span class="ident" id="7049657">Min</span><span class="op" id="7049660">.</span><span class="ident" id="7049661">X</span><span class="op" id="7049662">;</span>&nbsp;<span class="ident" id="7049664">x</span>&nbsp;<span class="op" id="7049666">&lt;</span>&nbsp;<span class="ident" id="7049668">bounds</span><span class="op" id="7049674">.</span><span class="ident" id="7049675">Max</span><span class="op" id="7049678">.</span><span class="ident" id="7049679">X</span><span class="op" id="7049680">;</span>&nbsp;<span class="ident" id="7049682">x</span><span class="op" id="7049683">++</span>&nbsp;<span class="op" id="7049686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049692">nrgba64</span>&nbsp;<span class="op" id="7049700">:=</span>&nbsp;<span class="ident" id="7049703">png</span><span class="op" id="7049706">.</span><span class="ident" id="7049707">At</span><span class="op" id="7049709">(</span><span class="ident" id="7049710">x</span><span class="op" id="7049711">,</span>&nbsp;<span class="ident" id="7049713">y</span><span class="op" id="7049714">)</span><span class="op" id="7049715">.</span><span class="op" id="7049716">(</span><span class="ident" id="7049717">color</span><span class="op" id="7049722">.</span><span class="ident" id="7049723">NRGBA64</span><span class="op" id="7049730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049736">fmt</span><span class="op" id="7049739">.</span><span class="ident" id="7049740">Fprintf</span><span class="op" id="7049747">(</span><span class="ident" id="7049748">w</span><span class="op" id="7049749">,</span>&nbsp;<span class="string" id="7049751">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7049770">,</span>&nbsp;<span class="ident" id="7049772">nrgba64</span><span class="op" id="7049779">.</span><span class="ident" id="7049780">R</span><span class="op" id="7049781">,</span>&nbsp;<span class="ident" id="7049783">nrgba64</span><span class="op" id="7049790">.</span><span class="ident" id="7049791">G</span><span class="op" id="7049792">,</span>&nbsp;<span class="ident" id="7049794">nrgba64</span><span class="op" id="7049801">.</span><span class="ident" id="7049802">B</span><span class="op" id="7049803">,</span>&nbsp;<span class="ident" id="7049805">nrgba64</span><span class="op" id="7049812">.</span><span class="ident" id="7049813">A</span><span class="op" id="7049814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7049819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049823">case</span>&nbsp;<span class="ident" id="7049828">cpm</span>&nbsp;<span class="op" id="7049832">!=</span>&nbsp;<span class="ident" id="7049835">nil</span><span class="op" id="7049838">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049843">var</span>&nbsp;<span class="ident" id="7049847">b</span><span class="op" id="7049848">,</span>&nbsp;<span class="ident" id="7049850">c</span>&nbsp;<span class="builtintype" id="7049852">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049859">for</span>&nbsp;<span class="ident" id="7049863">x</span>&nbsp;<span class="op" id="7049865">:=</span>&nbsp;<span class="ident" id="7049868">bounds</span><span class="op" id="7049874">.</span><span class="ident" id="7049875">Min</span><span class="op" id="7049878">.</span><span class="ident" id="7049879">X</span><span class="op" id="7049880">;</span>&nbsp;<span class="ident" id="7049882">x</span>&nbsp;<span class="op" id="7049884">&lt;</span>&nbsp;<span class="ident" id="7049886">bounds</span><span class="op" id="7049892">.</span><span class="ident" id="7049893">Max</span><span class="op" id="7049896">.</span><span class="ident" id="7049897">X</span><span class="op" id="7049898">;</span>&nbsp;<span class="ident" id="7049900">x</span><span class="op" id="7049901">++</span>&nbsp;<span class="op" id="7049904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049910">b</span>&nbsp;<span class="op" id="7049912">=</span>&nbsp;<span class="ident" id="7049914">b</span><span class="op" id="7049915">&lt;&lt;</span><span class="builtintype" id="7049917">uint</span><span class="op" id="7049921">(</span><span class="ident" id="7049922">bitdepth</span><span class="op" id="7049930">)</span>&nbsp;<span class="op" id="7049932">|</span>&nbsp;<span class="builtintype" id="7049934">int</span><span class="op" id="7049937">(</span><span class="ident" id="7049938">paletted</span><span class="op" id="7049946">.</span><span class="ident" id="7049947">ColorIndexAt</span><span class="op" id="7049959">(</span><span class="ident" id="7049960">x</span><span class="op" id="7049961">,</span>&nbsp;<span class="ident" id="7049963">y</span><span class="op" id="7049964">)</span><span class="op" id="7049965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7049971">c</span><span class="op" id="7049972">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7049979">if</span>&nbsp;<span class="ident" id="7049982">c</span>&nbsp;<span class="op" id="7049984">==</span>&nbsp;<span class="num" id="7049987">8</span><span class="op" id="7049988">/</span><span class="ident" id="7049989">bitdepth</span>&nbsp;<span class="op" id="7049998">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050005">fmt</span><span class="op" id="7050008">.</span><span class="ident" id="7050009">Fprintf</span><span class="op" id="7050016">(</span><span class="ident" id="7050017">w</span><span class="op" id="7050018">,</span>&nbsp;<span class="string" id="7050020">&#34;%02x&#34;</span><span class="op" id="7050026">,</span>&nbsp;<span class="ident" id="7050028">b</span><span class="op" id="7050029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050036">b</span>&nbsp;<span class="op" id="7050038">=</span>&nbsp;<span class="num" id="7050040">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050047">c</span>&nbsp;<span class="op" id="7050049">=</span>&nbsp;<span class="num" id="7050051">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050062">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050067">if</span>&nbsp;<span class="ident" id="7050070">c</span>&nbsp;<span class="op" id="7050072">!=</span>&nbsp;<span class="num" id="7050075">0</span>&nbsp;<span class="op" id="7050077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050083">for</span>&nbsp;<span class="ident" id="7050087">c</span>&nbsp;<span class="op" id="7050089">!=</span>&nbsp;<span class="num" id="7050092">8</span><span class="op" id="7050093">/</span><span class="ident" id="7050094">bitdepth</span>&nbsp;<span class="op" id="7050103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050110">b</span>&nbsp;<span class="op" id="7050112">=</span>&nbsp;<span class="ident" id="7050114">b</span>&nbsp;<span class="op" id="7050116">&lt;&lt;</span>&nbsp;<span class="builtintype" id="7050119">uint</span><span class="op" id="7050123">(</span><span class="ident" id="7050124">bitdepth</span><span class="op" id="7050132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050139">c</span><span class="op" id="7050140">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050147">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050153">fmt</span><span class="op" id="7050156">.</span><span class="ident" id="7050157">Fprintf</span><span class="op" id="7050164">(</span><span class="ident" id="7050165">w</span><span class="op" id="7050166">,</span>&nbsp;<span class="string" id="7050168">&#34;%02x&#34;</span><span class="op" id="7050174">,</span>&nbsp;<span class="ident" id="7050176">b</span><span class="op" id="7050177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050190">io</span><span class="op" id="7050192">.</span><span class="ident" id="7050193">WriteString</span><span class="op" id="7050204">(</span><span class="ident" id="7050205">w</span><span class="op" id="7050206">,</span>&nbsp;<span class="string" id="7050208">&#34;\n&#34;</span><span class="op" id="7050212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050215">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050218">io</span><span class="op" id="7050220">.</span><span class="ident" id="7050221">WriteString</span><span class="op" id="7050232">(</span><span class="ident" id="7050233">w</span><span class="op" id="7050234">,</span>&nbsp;<span class="string" id="7050236">&#34;}\n&#34;</span><span class="op" id="7050241">)</span><br>
<span class="lineno"></span><span class="op" id="7050243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7050246">func</span>&nbsp;<span class="ident" id="7050251">TestReader</span><span class="op" id="7050261">(</span><span class="ident" id="7050262">t</span>&nbsp;<span class="op" id="7050264">*</span><span class="ident" id="7050265">testing</span><span class="op" id="7050272">.</span><span class="ident" id="7050273">T</span><span class="op" id="7050274">)</span>&nbsp;<span class="op" id="7050276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050279">names</span>&nbsp;<span class="op" id="7050285">:=</span>&nbsp;<span class="ident" id="7050288">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050299">if</span>&nbsp;<span class="ident" id="7050302">testing</span><span class="op" id="7050309">.</span><span class="ident" id="7050310">Short</span><span class="op" id="7050315">(</span><span class="op" id="7050316">)</span>&nbsp;<span class="op" id="7050318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050322">names</span>&nbsp;<span class="op" id="7050328">=</span>&nbsp;<span class="ident" id="7050330">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050349">for</span>&nbsp;<span class="ident" id="7050353">_</span><span class="op" id="7050354">,</span>&nbsp;<span class="ident" id="7050356">fn</span>&nbsp;<span class="op" id="7050359">:=</span>&nbsp;<span class="keyword" id="7050362">range</span>&nbsp;<span class="ident" id="7050368">names</span>&nbsp;<span class="op" id="7050374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050378">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050403">img</span><span class="op" id="7050406">,</span>&nbsp;<span class="ident" id="7050408">err</span>&nbsp;<span class="op" id="7050412">:=</span>&nbsp;<span class="ident" id="7050415">readPNG</span><span class="op" id="7050422">(</span><span class="string" id="7050423">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7050444">+</span>&nbsp;<span class="ident" id="7050446">fn</span>&nbsp;<span class="op" id="7050449">+</span>&nbsp;<span class="string" id="7050451">&#34;.png&#34;</span><span class="op" id="7050457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050461">if</span>&nbsp;<span class="ident" id="7050464">err</span>&nbsp;<span class="op" id="7050468">!=</span>&nbsp;<span class="ident" id="7050471">nil</span>&nbsp;<span class="op" id="7050475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050480">t</span><span class="op" id="7050481">.</span><span class="ident" id="7050482">Error</span><span class="op" id="7050487">(</span><span class="ident" id="7050488">fn</span><span class="op" id="7050490">,</span>&nbsp;<span class="ident" id="7050492">err</span><span class="op" id="7050495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050500">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050511">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050516">if</span>&nbsp;<span class="ident" id="7050519">fn</span>&nbsp;<span class="op" id="7050522">==</span>&nbsp;<span class="string" id="7050525">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="7050536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050541">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050618">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050664">c</span>&nbsp;<span class="op" id="7050666">:=</span>&nbsp;<span class="ident" id="7050669">img</span><span class="op" id="7050672">.</span><span class="ident" id="7050673">At</span><span class="op" id="7050675">(</span><span class="num" id="7050676">2</span><span class="op" id="7050677">,</span>&nbsp;<span class="num" id="7050679">1</span><span class="op" id="7050680">)</span><span class="op" id="7050681">.</span><span class="op" id="7050682">(</span><span class="ident" id="7050683">color</span><span class="op" id="7050688">.</span><span class="ident" id="7050689">NRGBA64</span><span class="op" id="7050696">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050701">if</span>&nbsp;<span class="ident" id="7050704">c</span><span class="op" id="7050705">.</span><span class="ident" id="7050706">R</span>&nbsp;<span class="op" id="7050708">!=</span>&nbsp;<span class="num" id="7050711">0x11a7</span>&nbsp;<span class="op" id="7050718">||</span>&nbsp;<span class="ident" id="7050721">c</span><span class="op" id="7050722">.</span><span class="ident" id="7050723">G</span>&nbsp;<span class="op" id="7050725">!=</span>&nbsp;<span class="num" id="7050728">0x11a7</span>&nbsp;<span class="op" id="7050735">||</span>&nbsp;<span class="ident" id="7050738">c</span><span class="op" id="7050739">.</span><span class="ident" id="7050740">B</span>&nbsp;<span class="op" id="7050742">!=</span>&nbsp;<span class="num" id="7050745">0x11a7</span>&nbsp;<span class="op" id="7050752">||</span>&nbsp;<span class="ident" id="7050755">c</span><span class="op" id="7050756">.</span><span class="ident" id="7050757">A</span>&nbsp;<span class="op" id="7050759">!=</span>&nbsp;<span class="num" id="7050762">0x1085</span>&nbsp;<span class="op" id="7050769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050775">t</span><span class="op" id="7050776">.</span><span class="ident" id="7050777">Error</span><span class="op" id="7050782">(</span><span class="ident" id="7050783">fn</span><span class="op" id="7050785">,</span>&nbsp;<span class="ident" id="7050787">fmt</span><span class="op" id="7050790">.</span><span class="ident" id="7050791">Errorf</span><span class="op" id="7050797">(</span><span class="string" id="7050798">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="7050831">,</span>&nbsp;<span class="ident" id="7050833">c</span><span class="op" id="7050834">)</span><span class="op" id="7050835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050845">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7050856">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050861">piper</span><span class="op" id="7050866">,</span>&nbsp;<span class="ident" id="7050868">pipew</span>&nbsp;<span class="op" id="7050874">:=</span>&nbsp;<span class="ident" id="7050877">io</span><span class="op" id="7050879">.</span><span class="ident" id="7050880">Pipe</span><span class="op" id="7050884">(</span><span class="op" id="7050885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050889">pb</span>&nbsp;<span class="op" id="7050892">:=</span>&nbsp;<span class="ident" id="7050895">bufio</span><span class="op" id="7050900">.</span><span class="ident" id="7050901">NewScanner</span><span class="op" id="7050911">(</span><span class="ident" id="7050912">piper</span><span class="op" id="7050917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050921">go</span>&nbsp;<span class="ident" id="7050924">sng</span><span class="op" id="7050927">(</span><span class="ident" id="7050928">pipew</span><span class="op" id="7050933">,</span>&nbsp;<span class="ident" id="7050935">fn</span><span class="op" id="7050937">,</span>&nbsp;<span class="ident" id="7050939">img</span><span class="op" id="7050942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7050946">defer</span>&nbsp;<span class="ident" id="7050952">piper</span><span class="op" id="7050957">.</span><span class="ident" id="7050958">Close</span><span class="op" id="7050963">(</span><span class="op" id="7050964">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7050969">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7050994">sf</span><span class="op" id="7050996">,</span>&nbsp;<span class="ident" id="7050998">err</span>&nbsp;<span class="op" id="7051002">:=</span>&nbsp;<span class="ident" id="7051005">os</span><span class="op" id="7051007">.</span><span class="ident" id="7051008">Open</span><span class="op" id="7051012">(</span><span class="string" id="7051013">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7051034">+</span>&nbsp;<span class="ident" id="7051036">fn</span>&nbsp;<span class="op" id="7051039">+</span>&nbsp;<span class="string" id="7051041">&#34;.sng&#34;</span><span class="op" id="7051047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051051">if</span>&nbsp;<span class="ident" id="7051054">err</span>&nbsp;<span class="op" id="7051058">!=</span>&nbsp;<span class="ident" id="7051061">nil</span>&nbsp;<span class="op" id="7051065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051070">t</span><span class="op" id="7051071">.</span><span class="ident" id="7051072">Error</span><span class="op" id="7051077">(</span><span class="ident" id="7051078">fn</span><span class="op" id="7051080">,</span>&nbsp;<span class="ident" id="7051082">err</span><span class="op" id="7051085">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051090">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051105">defer</span>&nbsp;<span class="ident" id="7051111">sf</span><span class="op" id="7051113">.</span><span class="ident" id="7051114">Close</span><span class="op" id="7051119">(</span><span class="op" id="7051120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051124">sb</span>&nbsp;<span class="op" id="7051127">:=</span>&nbsp;<span class="ident" id="7051130">bufio</span><span class="op" id="7051135">.</span><span class="ident" id="7051136">NewScanner</span><span class="op" id="7051146">(</span><span class="ident" id="7051147">sf</span><span class="op" id="7051149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051153">if</span>&nbsp;<span class="ident" id="7051156">err</span>&nbsp;<span class="op" id="7051160">!=</span>&nbsp;<span class="ident" id="7051163">nil</span>&nbsp;<span class="op" id="7051167">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051172">t</span><span class="op" id="7051173">.</span><span class="ident" id="7051174">Error</span><span class="op" id="7051179">(</span><span class="ident" id="7051180">fn</span><span class="op" id="7051182">,</span>&nbsp;<span class="ident" id="7051184">err</span><span class="op" id="7051187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7051208">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051259">for</span>&nbsp;<span class="op" id="7051263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051268">pdone</span>&nbsp;<span class="op" id="7051274">:=</span>&nbsp;<span class="op" id="7051277">!</span><span class="ident" id="7051278">pb</span><span class="op" id="7051280">.</span><span class="ident" id="7051281">Scan</span><span class="op" id="7051285">(</span><span class="op" id="7051286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051291">sdone</span>&nbsp;<span class="op" id="7051297">:=</span>&nbsp;<span class="op" id="7051300">!</span><span class="ident" id="7051301">sb</span><span class="op" id="7051303">.</span><span class="ident" id="7051304">Scan</span><span class="op" id="7051308">(</span><span class="op" id="7051309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051314">if</span>&nbsp;<span class="ident" id="7051317">pdone</span>&nbsp;<span class="op" id="7051323">&amp;&amp;</span>&nbsp;<span class="ident" id="7051326">sdone</span>&nbsp;<span class="op" id="7051332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051338">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051352">if</span>&nbsp;<span class="ident" id="7051355">pdone</span>&nbsp;<span class="op" id="7051361">||</span>&nbsp;<span class="ident" id="7051364">sdone</span>&nbsp;<span class="op" id="7051370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051376">t</span><span class="op" id="7051377">.</span><span class="ident" id="7051378">Errorf</span><span class="op" id="7051384">(</span><span class="string" id="7051385">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="7051406">,</span>&nbsp;<span class="ident" id="7051408">fn</span><span class="op" id="7051410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051416">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051425">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051430">ps</span>&nbsp;<span class="op" id="7051433">:=</span>&nbsp;<span class="ident" id="7051436">pb</span><span class="op" id="7051438">.</span><span class="ident" id="7051439">Text</span><span class="op" id="7051443">(</span><span class="op" id="7051444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051449">ss</span>&nbsp;<span class="op" id="7051452">:=</span>&nbsp;<span class="ident" id="7051455">sb</span><span class="op" id="7051457">.</span><span class="ident" id="7051458">Text</span><span class="op" id="7051462">(</span><span class="op" id="7051463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051468">if</span>&nbsp;<span class="ident" id="7051471">ps</span>&nbsp;<span class="op" id="7051474">!=</span>&nbsp;<span class="ident" id="7051477">ss</span>&nbsp;<span class="op" id="7051480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051486">t</span><span class="op" id="7051487">.</span><span class="ident" id="7051488">Errorf</span><span class="op" id="7051494">(</span><span class="string" id="7051495">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="7051525">,</span>&nbsp;<span class="ident" id="7051527">fn</span><span class="op" id="7051529">,</span>&nbsp;<span class="ident" id="7051531">ps</span><span class="op" id="7051533">,</span>&nbsp;<span class="ident" id="7051535">ss</span><span class="op" id="7051537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051543">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051560">if</span>&nbsp;<span class="ident" id="7051563">pb</span><span class="op" id="7051565">.</span><span class="ident" id="7051566">Err</span><span class="op" id="7051569">(</span><span class="op" id="7051570">)</span>&nbsp;<span class="op" id="7051572">!=</span>&nbsp;<span class="ident" id="7051575">nil</span>&nbsp;<span class="op" id="7051579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051584">t</span><span class="op" id="7051585">.</span><span class="ident" id="7051586">Error</span><span class="op" id="7051591">(</span><span class="ident" id="7051592">fn</span><span class="op" id="7051594">,</span>&nbsp;<span class="ident" id="7051596">pb</span><span class="op" id="7051598">.</span><span class="ident" id="7051599">Err</span><span class="op" id="7051602">(</span><span class="op" id="7051603">)</span><span class="op" id="7051604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051608">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051612">if</span>&nbsp;<span class="ident" id="7051615">sb</span><span class="op" id="7051617">.</span><span class="ident" id="7051618">Err</span><span class="op" id="7051621">(</span><span class="op" id="7051622">)</span>&nbsp;<span class="op" id="7051624">!=</span>&nbsp;<span class="ident" id="7051627">nil</span>&nbsp;<span class="op" id="7051631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051636">t</span><span class="op" id="7051637">.</span><span class="ident" id="7051638">Error</span><span class="op" id="7051643">(</span><span class="ident" id="7051644">fn</span><span class="op" id="7051646">,</span>&nbsp;<span class="ident" id="7051648">sb</span><span class="op" id="7051650">.</span><span class="ident" id="7051651">Err</span><span class="op" id="7051654">(</span><span class="op" id="7051655">)</span><span class="op" id="7051656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051663">}</span><br>
<span class="lineno"></span><span class="op" id="7051665">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7051668">var</span>&nbsp;<span class="ident" id="7051672">readerErrors</span>&nbsp;<span class="op" id="7051685">=</span>&nbsp;<span class="op" id="7051687">[</span><span class="op" id="7051688">]</span><span class="keyword" id="7051689">struct</span>&nbsp;<span class="op" id="7051696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051699">file</span>&nbsp;<span class="builtintype" id="7051704">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051712">err</span>&nbsp;&nbsp;<span class="builtintype" id="7051717">string</span><br>
<span class="lineno"></span><span class="op" id="7051724">}</span><span class="op" id="7051725">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051728">{</span><span class="string" id="7051729">&#34;invalid-zlib.png&#34;</span><span class="op" id="7051747">,</span>&nbsp;<span class="string" id="7051749">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="7051773">}</span><span class="op" id="7051774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051777">{</span><span class="string" id="7051778">&#34;invalid-crc32.png&#34;</span><span class="op" id="7051797">,</span>&nbsp;<span class="string" id="7051799">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="7051817">}</span><span class="op" id="7051818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051821">{</span><span class="string" id="7051822">&#34;invalid-noend.png&#34;</span><span class="op" id="7051841">,</span>&nbsp;<span class="string" id="7051843">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7051859">}</span><span class="op" id="7051860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7051863">{</span><span class="string" id="7051864">&#34;invalid-trunc.png&#34;</span><span class="op" id="7051883">,</span>&nbsp;<span class="string" id="7051885">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7051901">}</span><span class="op" id="7051902">,</span><br>
<span class="lineno"></span><span class="op" id="7051904">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7051907">func</span>&nbsp;<span class="ident" id="7051912">TestReaderError</span><span class="op" id="7051927">(</span><span class="ident" id="7051928">t</span>&nbsp;<span class="op" id="7051930">*</span><span class="ident" id="7051931">testing</span><span class="op" id="7051938">.</span><span class="ident" id="7051939">T</span><span class="op" id="7051940">)</span>&nbsp;<span class="op" id="7051942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7051945">for</span>&nbsp;<span class="ident" id="7051949">_</span><span class="op" id="7051950">,</span>&nbsp;<span class="ident" id="7051952">tt</span>&nbsp;<span class="op" id="7051955">:=</span>&nbsp;<span class="keyword" id="7051958">range</span>&nbsp;<span class="ident" id="7051964">readerErrors</span>&nbsp;<span class="op" id="7051977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7051981">img</span><span class="op" id="7051984">,</span>&nbsp;<span class="ident" id="7051986">err</span>&nbsp;<span class="op" id="7051990">:=</span>&nbsp;<span class="ident" id="7051993">readPNG</span><span class="op" id="7052000">(</span><span class="string" id="7052001">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="7052013">+</span>&nbsp;<span class="ident" id="7052015">tt</span><span class="op" id="7052017">.</span><span class="ident" id="7052018">file</span><span class="op" id="7052022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052026">if</span>&nbsp;<span class="ident" id="7052029">err</span>&nbsp;<span class="op" id="7052033">==</span>&nbsp;<span class="ident" id="7052036">nil</span>&nbsp;<span class="op" id="7052040">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052045">t</span><span class="op" id="7052046">.</span><span class="ident" id="7052047">Errorf</span><span class="op" id="7052053">(</span><span class="string" id="7052054">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="7052082">,</span>&nbsp;<span class="ident" id="7052084">tt</span><span class="op" id="7052086">.</span><span class="ident" id="7052087">file</span><span class="op" id="7052091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052096">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052111">if</span>&nbsp;<span class="op" id="7052114">!</span><span class="ident" id="7052115">strings</span><span class="op" id="7052122">.</span><span class="ident" id="7052123">Contains</span><span class="op" id="7052131">(</span><span class="ident" id="7052132">err</span><span class="op" id="7052135">.</span><span class="ident" id="7052136">Error</span><span class="op" id="7052141">(</span><span class="op" id="7052142">)</span><span class="op" id="7052143">,</span>&nbsp;<span class="ident" id="7052145">tt</span><span class="op" id="7052147">.</span><span class="ident" id="7052148">err</span><span class="op" id="7052151">)</span>&nbsp;<span class="op" id="7052153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052158">t</span><span class="op" id="7052159">.</span><span class="ident" id="7052160">Errorf</span><span class="op" id="7052166">(</span><span class="string" id="7052167">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7052193">,</span>&nbsp;<span class="ident" id="7052195">tt</span><span class="op" id="7052197">.</span><span class="ident" id="7052198">file</span><span class="op" id="7052202">,</span>&nbsp;<span class="ident" id="7052204">err</span><span class="op" id="7052207">,</span>&nbsp;<span class="ident" id="7052209">tt</span><span class="op" id="7052211">.</span><span class="ident" id="7052212">err</span><span class="op" id="7052215">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052223">if</span>&nbsp;<span class="ident" id="7052226">img</span>&nbsp;<span class="op" id="7052230">!=</span>&nbsp;<span class="ident" id="7052233">nil</span>&nbsp;<span class="op" id="7052237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052242">t</span><span class="op" id="7052243">.</span><span class="ident" id="7052244">Errorf</span><span class="op" id="7052250">(</span><span class="string" id="7052251">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="7052284">,</span>&nbsp;<span class="ident" id="7052286">tt</span><span class="op" id="7052288">.</span><span class="ident" id="7052289">file</span><span class="op" id="7052293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052300">}</span><br>
<span class="lineno">295</span><span class="op" id="7052302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7052305">func</span>&nbsp;<span class="ident" id="7052310">TestPalettedDecodeConfig</span><span class="op" id="7052334">(</span><span class="ident" id="7052335">t</span>&nbsp;<span class="op" id="7052337">*</span><span class="ident" id="7052338">testing</span><span class="op" id="7052345">.</span><span class="ident" id="7052346">T</span><span class="op" id="7052347">)</span>&nbsp;<span class="op" id="7052349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052352">for</span>&nbsp;<span class="ident" id="7052356">_</span><span class="op" id="7052357">,</span>&nbsp;<span class="ident" id="7052359">fn</span>&nbsp;<span class="op" id="7052362">:=</span>&nbsp;<span class="keyword" id="7052365">range</span>&nbsp;<span class="ident" id="7052371">filenamesPaletted</span>&nbsp;<span class="op" id="7052389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052393">f</span><span class="op" id="7052394">,</span>&nbsp;<span class="ident" id="7052396">err</span>&nbsp;<span class="op" id="7052400">:=</span>&nbsp;<span class="ident" id="7052403">os</span><span class="op" id="7052405">.</span><span class="ident" id="7052406">Open</span><span class="op" id="7052410">(</span><span class="string" id="7052411">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7052432">+</span>&nbsp;<span class="ident" id="7052434">fn</span>&nbsp;<span class="op" id="7052437">+</span>&nbsp;<span class="string" id="7052439">&#34;.png&#34;</span><span class="op" id="7052445">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052449">if</span>&nbsp;<span class="ident" id="7052452">err</span>&nbsp;<span class="op" id="7052456">!=</span>&nbsp;<span class="ident" id="7052459">nil</span>&nbsp;<span class="op" id="7052463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052468">t</span><span class="op" id="7052469">.</span><span class="ident" id="7052470">Errorf</span><span class="op" id="7052476">(</span><span class="string" id="7052477">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7052498">,</span>&nbsp;<span class="ident" id="7052500">fn</span><span class="op" id="7052502">,</span>&nbsp;<span class="ident" id="7052504">err</span><span class="op" id="7052507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052512">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052527">defer</span>&nbsp;<span class="ident" id="7052533">f</span><span class="op" id="7052534">.</span><span class="ident" id="7052535">Close</span><span class="op" id="7052540">(</span><span class="op" id="7052541">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052545">cfg</span><span class="op" id="7052548">,</span>&nbsp;<span class="ident" id="7052550">err</span>&nbsp;<span class="op" id="7052554">:=</span>&nbsp;<span class="ident" id="7052557">DecodeConfig</span><span class="op" id="7052569">(</span><span class="ident" id="7052570">f</span><span class="op" id="7052571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052575">if</span>&nbsp;<span class="ident" id="7052578">err</span>&nbsp;<span class="op" id="7052582">!=</span>&nbsp;<span class="ident" id="7052585">nil</span>&nbsp;<span class="op" id="7052589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052594">t</span><span class="op" id="7052595">.</span><span class="ident" id="7052596">Errorf</span><span class="op" id="7052602">(</span><span class="string" id="7052603">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7052611">,</span>&nbsp;<span class="ident" id="7052613">fn</span><span class="op" id="7052615">,</span>&nbsp;<span class="ident" id="7052617">err</span><span class="op" id="7052620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052625">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052636">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052640">pal</span><span class="op" id="7052643">,</span>&nbsp;<span class="ident" id="7052645">ok</span>&nbsp;<span class="op" id="7052648">:=</span>&nbsp;<span class="ident" id="7052651">cfg</span><span class="op" id="7052654">.</span><span class="ident" id="7052655">ColorModel</span><span class="op" id="7052665">.</span><span class="op" id="7052666">(</span><span class="ident" id="7052667">color</span><span class="op" id="7052672">.</span><span class="ident" id="7052673">Palette</span><span class="op" id="7052680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052684">if</span>&nbsp;<span class="op" id="7052687">!</span><span class="ident" id="7052688">ok</span>&nbsp;<span class="op" id="7052691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052696">t</span><span class="op" id="7052697">.</span><span class="ident" id="7052698">Errorf</span><span class="op" id="7052704">(</span><span class="string" id="7052705">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="7052740">,</span>&nbsp;<span class="ident" id="7052742">fn</span><span class="op" id="7052744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052760">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052764">if</span>&nbsp;<span class="ident" id="7052767">pal</span>&nbsp;<span class="op" id="7052771">==</span>&nbsp;<span class="ident" id="7052774">nil</span>&nbsp;<span class="op" id="7052778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052783">t</span><span class="op" id="7052784">.</span><span class="ident" id="7052785">Errorf</span><span class="op" id="7052791">(</span><span class="string" id="7052792">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="7052821">,</span>&nbsp;<span class="ident" id="7052823">fn</span><span class="op" id="7052825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052830">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7052844">}</span><br>
<span class="lineno">320</span><span class="op" id="7052846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7052849">func</span>&nbsp;<span class="ident" id="7052854">benchmarkDecode</span><span class="op" id="7052869">(</span><span class="ident" id="7052870">b</span>&nbsp;<span class="op" id="7052872">*</span><span class="ident" id="7052873">testing</span><span class="op" id="7052880">.</span><span class="ident" id="7052881">B</span><span class="op" id="7052882">,</span>&nbsp;<span class="ident" id="7052884">filename</span>&nbsp;<span class="builtintype" id="7052893">string</span><span class="op" id="7052899">,</span>&nbsp;<span class="ident" id="7052901">bytesPerPixel</span>&nbsp;<span class="builtintype" id="7052915">int</span><span class="op" id="7052918">)</span>&nbsp;<span class="op" id="7052920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052923">b</span><span class="op" id="7052924">.</span><span class="ident" id="7052925">StopTimer</span><span class="op" id="7052934">(</span><span class="op" id="7052935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052938">data</span><span class="op" id="7052942">,</span>&nbsp;<span class="ident" id="7052944">err</span>&nbsp;<span class="op" id="7052948">:=</span>&nbsp;<span class="ident" id="7052951">ioutil</span><span class="op" id="7052957">.</span><span class="ident" id="7052958">ReadFile</span><span class="op" id="7052966">(</span><span class="ident" id="7052967">filename</span><span class="op" id="7052975">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7052978">if</span>&nbsp;<span class="ident" id="7052981">err</span>&nbsp;<span class="op" id="7052985">!=</span>&nbsp;<span class="ident" id="7052988">nil</span>&nbsp;<span class="op" id="7052992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7052996">b</span><span class="op" id="7052997">.</span><span class="ident" id="7052998">Fatal</span><span class="op" id="7053003">(</span><span class="ident" id="7053004">err</span><span class="op" id="7053007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7053010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053013">s</span>&nbsp;<span class="op" id="7053015">:=</span>&nbsp;<span class="builtintype" id="7053018">string</span><span class="op" id="7053024">(</span><span class="ident" id="7053025">data</span><span class="op" id="7053029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053032">cfg</span><span class="op" id="7053035">,</span>&nbsp;<span class="ident" id="7053037">err</span>&nbsp;<span class="op" id="7053041">:=</span>&nbsp;<span class="ident" id="7053044">DecodeConfig</span><span class="op" id="7053056">(</span><span class="ident" id="7053057">strings</span><span class="op" id="7053064">.</span><span class="ident" id="7053065">NewReader</span><span class="op" id="7053074">(</span><span class="ident" id="7053075">s</span><span class="op" id="7053076">)</span><span class="op" id="7053077">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7053080">if</span>&nbsp;<span class="ident" id="7053083">err</span>&nbsp;<span class="op" id="7053087">!=</span>&nbsp;<span class="ident" id="7053090">nil</span>&nbsp;<span class="op" id="7053094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053098">b</span><span class="op" id="7053099">.</span><span class="ident" id="7053100">Fatal</span><span class="op" id="7053105">(</span><span class="ident" id="7053106">err</span><span class="op" id="7053109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7053112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053115">b</span><span class="op" id="7053116">.</span><span class="ident" id="7053117">SetBytes</span><span class="op" id="7053125">(</span><span class="ident" id="7053126">int64</span><span class="op" id="7053131">(</span><span class="ident" id="7053132">cfg</span><span class="op" id="7053135">.</span><span class="ident" id="7053136">Width</span>&nbsp;<span class="op" id="7053142">*</span>&nbsp;<span class="ident" id="7053144">cfg</span><span class="op" id="7053147">.</span><span class="ident" id="7053148">Height</span>&nbsp;<span class="op" id="7053155">*</span>&nbsp;<span class="ident" id="7053157">bytesPerPixel</span><span class="op" id="7053170">)</span><span class="op" id="7053171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053174">b</span><span class="op" id="7053175">.</span><span class="ident" id="7053176">StartTimer</span><span class="op" id="7053186">(</span><span class="op" id="7053187">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7053190">for</span>&nbsp;<span class="ident" id="7053194">i</span>&nbsp;<span class="op" id="7053196">:=</span>&nbsp;<span class="num" id="7053199">0</span><span class="op" id="7053200">;</span>&nbsp;<span class="ident" id="7053202">i</span>&nbsp;<span class="op" id="7053204">&lt;</span>&nbsp;<span class="ident" id="7053206">b</span><span class="op" id="7053207">.</span><span class="ident" id="7053208">N</span><span class="op" id="7053209">;</span>&nbsp;<span class="ident" id="7053211">i</span><span class="op" id="7053212">++</span>&nbsp;<span class="op" id="7053215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053219">Decode</span><span class="op" id="7053225">(</span><span class="ident" id="7053226">strings</span><span class="op" id="7053233">.</span><span class="ident" id="7053234">NewReader</span><span class="op" id="7053243">(</span><span class="ident" id="7053244">s</span><span class="op" id="7053245">)</span><span class="op" id="7053246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7053249">}</span><br>
<span class="lineno"></span><span class="op" id="7053251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7053254">func</span>&nbsp;<span class="ident" id="7053259">BenchmarkDecodeGray</span><span class="op" id="7053278">(</span><span class="ident" id="7053279">b</span>&nbsp;<span class="op" id="7053281">*</span><span class="ident" id="7053282">testing</span><span class="op" id="7053289">.</span><span class="ident" id="7053290">B</span><span class="op" id="7053291">)</span>&nbsp;<span class="op" id="7053293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053296">benchmarkDecode</span><span class="op" id="7053311">(</span><span class="ident" id="7053312">b</span><span class="op" id="7053313">,</span>&nbsp;<span class="string" id="7053315">&#34;testdata/benchGray.png&#34;</span><span class="op" id="7053339">,</span>&nbsp;<span class="num" id="7053341">1</span><span class="op" id="7053342">)</span><br>
<span class="lineno"></span><span class="op" id="7053344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7053347">func</span>&nbsp;<span class="ident" id="7053352">BenchmarkDecodeNRGBAGradient</span><span class="op" id="7053380">(</span><span class="ident" id="7053381">b</span>&nbsp;<span class="op" id="7053383">*</span><span class="ident" id="7053384">testing</span><span class="op" id="7053391">.</span><span class="ident" id="7053392">B</span><span class="op" id="7053393">)</span>&nbsp;<span class="op" id="7053395">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053398">benchmarkDecode</span><span class="op" id="7053413">(</span><span class="ident" id="7053414">b</span><span class="op" id="7053415">,</span>&nbsp;<span class="string" id="7053417">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="7053451">,</span>&nbsp;<span class="num" id="7053453">4</span><span class="op" id="7053454">)</span><br>
<span class="lineno"></span><span class="op" id="7053456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7053459">func</span>&nbsp;<span class="ident" id="7053464">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="7053490">(</span><span class="ident" id="7053491">b</span>&nbsp;<span class="op" id="7053493">*</span><span class="ident" id="7053494">testing</span><span class="op" id="7053501">.</span><span class="ident" id="7053502">B</span><span class="op" id="7053503">)</span>&nbsp;<span class="op" id="7053505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053508">benchmarkDecode</span><span class="op" id="7053523">(</span><span class="ident" id="7053524">b</span><span class="op" id="7053525">,</span>&nbsp;<span class="string" id="7053527">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="7053559">,</span>&nbsp;<span class="num" id="7053561">4</span><span class="op" id="7053562">)</span><br>
<span class="lineno">350</span><span class="op" id="7053564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7053567">func</span>&nbsp;<span class="ident" id="7053572">BenchmarkDecodePaletted</span><span class="op" id="7053595">(</span><span class="ident" id="7053596">b</span>&nbsp;<span class="op" id="7053598">*</span><span class="ident" id="7053599">testing</span><span class="op" id="7053606">.</span><span class="ident" id="7053607">B</span><span class="op" id="7053608">)</span>&nbsp;<span class="op" id="7053610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053613">benchmarkDecode</span><span class="op" id="7053628">(</span><span class="ident" id="7053629">b</span><span class="op" id="7053630">,</span>&nbsp;<span class="string" id="7053632">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="7053660">,</span>&nbsp;<span class="num" id="7053662">1</span><span class="op" id="7053663">)</span><br>
<span class="lineno"></span><span class="op" id="7053665">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7053668">func</span>&nbsp;<span class="ident" id="7053673">BenchmarkDecodeRGB</span><span class="op" id="7053691">(</span><span class="ident" id="7053692">b</span>&nbsp;<span class="op" id="7053694">*</span><span class="ident" id="7053695">testing</span><span class="op" id="7053702">.</span><span class="ident" id="7053703">B</span><span class="op" id="7053704">)</span>&nbsp;<span class="op" id="7053706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053709">benchmarkDecode</span><span class="op" id="7053724">(</span><span class="ident" id="7053725">b</span><span class="op" id="7053726">,</span>&nbsp;<span class="string" id="7053728">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="7053751">,</span>&nbsp;<span class="num" id="7053753">4</span><span class="op" id="7053754">)</span><br>
<span class="lineno"></span><span class="op" id="7053756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7053759">func</span>&nbsp;<span class="ident" id="7053764">BenchmarkDecodeInterlacing</span><span class="op" id="7053790">(</span><span class="ident" id="7053791">b</span>&nbsp;<span class="op" id="7053793">*</span><span class="ident" id="7053794">testing</span><span class="op" id="7053801">.</span><span class="ident" id="7053802">B</span><span class="op" id="7053803">)</span>&nbsp;<span class="op" id="7053805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7053808">benchmarkDecode</span><span class="op" id="7053823">(</span><span class="ident" id="7053824">b</span><span class="op" id="7053825">,</span>&nbsp;<span class="string" id="7053827">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="7053860">,</span>&nbsp;<span class="num" id="7053862">4</span><span class="op" id="7053863">)</span><br>
<span class="lineno"></span><span class="op" id="7053865">}</span>
</div>
</body>
</html>
