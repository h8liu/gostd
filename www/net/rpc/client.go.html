<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3060628">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3060683">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3060737">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3060788">package</span>&nbsp;<span class="ident" id="3060796">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060801">import</span>&nbsp;<span class="op" id="3060808">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060811">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060820">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060836">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060846">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060852">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060859">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060866">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3060878">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3060885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3060888">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3060951">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="3060993">type</span>&nbsp;<span class="ident" id="3060998">ServerError</span>&nbsp;<span class="builtintype" id="3061010">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061018">func</span>&nbsp;<span class="op" id="3061023">(</span><span class="ident" id="3061024">e</span>&nbsp;<span class="ident" id="3061026">ServerError</span><span class="op" id="3061037">)</span>&nbsp;<span class="ident" id="3061039">Error</span><span class="op" id="3061044">(</span><span class="op" id="3061045">)</span>&nbsp;<span class="builtintype" id="3061047">string</span>&nbsp;<span class="op" id="3061054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061057">return</span>&nbsp;<span class="builtintype" id="3061064">string</span><span class="op" id="3061070">(</span><span class="ident" id="3061071">e</span><span class="op" id="3061072">)</span><br>
<span class="lineno"></span><span class="op" id="3061074">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3061077">var</span>&nbsp;<span class="ident" id="3061081">ErrShutdown</span>&nbsp;<span class="op" id="3061093">=</span>&nbsp;<span class="ident" id="3061095">errors</span><span class="op" id="3061101">.</span><span class="ident" id="3061102">New</span><span class="op" id="3061105">(</span><span class="string" id="3061106">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="3061131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061134">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="3061168">type</span>&nbsp;<span class="ident" id="3061173">Call</span>&nbsp;<span class="keyword" id="3061178">struct</span>&nbsp;<span class="op" id="3061185">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061188">ServiceMethod</span>&nbsp;<span class="builtintype" id="3061202">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3061214">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061262">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061276">interface</span><span class="op" id="3061285">{</span><span class="op" id="3061286">}</span>&nbsp;<span class="comment" id="3061288">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061332">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061346">interface</span><span class="op" id="3061355">{</span><span class="op" id="3061356">}</span>&nbsp;<span class="comment" id="3061358">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061401">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3061415">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3061427">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061467">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061481">chan</span>&nbsp;<span class="op" id="3061486">*</span><span class="ident" id="3061487">Call</span>&nbsp;&nbsp;<span class="comment" id="3061493">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="3061527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061530">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="3061566">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3061620">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="3061673">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="3061712">type</span>&nbsp;<span class="ident" id="3061717">Client</span>&nbsp;<span class="keyword" id="3061724">struct</span>&nbsp;<span class="op" id="3061731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061734">codec</span>&nbsp;<span class="ident" id="3061740">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061754">reqMutex</span>&nbsp;<span class="ident" id="3061763">sync</span><span class="op" id="3061767">.</span><span class="ident" id="3061768">Mutex</span>&nbsp;<span class="comment" id="3061774">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061797">request</span>&nbsp;&nbsp;<span class="ident" id="3061806">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061816">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061825">sync</span><span class="op" id="3061829">.</span><span class="ident" id="3061830">Mutex</span>&nbsp;<span class="comment" id="3061836">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061859">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061868">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061876">pending</span>&nbsp;&nbsp;<span class="keyword" id="3061885">map</span><span class="op" id="3061888">[</span><span class="ident" id="3061889">uint64</span><span class="op" id="3061895">]</span><span class="op" id="3061896">*</span><span class="ident" id="3061897">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061903">closing</span>&nbsp;&nbsp;<span class="builtintype" id="3061912">bool</span>&nbsp;<span class="comment" id="3061917">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061943">shutdown</span>&nbsp;<span class="builtintype" id="3061952">bool</span>&nbsp;<span class="comment" id="3061957">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="3061987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061990">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="3062046">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="3062113">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="3062183">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3062245">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3062314">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="3062371">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="3062437">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3062451">type</span>&nbsp;<span class="ident" id="3062456">ClientCodec</span>&nbsp;<span class="keyword" id="3062468">interface</span>&nbsp;<span class="op" id="3062478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3062481">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062554">WriteRequest</span><span class="op" id="3062566">(</span><span class="op" id="3062567">*</span><span class="ident" id="3062568">Request</span><span class="op" id="3062575">,</span>&nbsp;<span class="keyword" id="3062577">interface</span><span class="op" id="3062586">{</span><span class="op" id="3062587">}</span><span class="op" id="3062588">)</span>&nbsp;<span class="builtintype" id="3062590">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062597">ReadResponseHeader</span><span class="op" id="3062615">(</span><span class="op" id="3062616">*</span><span class="ident" id="3062617">Response</span><span class="op" id="3062625">)</span>&nbsp;<span class="builtintype" id="3062627">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062634">ReadResponseBody</span><span class="op" id="3062650">(</span><span class="keyword" id="3062651">interface</span><span class="op" id="3062660">{</span><span class="op" id="3062661">}</span><span class="op" id="3062662">)</span>&nbsp;<span class="builtintype" id="3062664">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062672">Close</span><span class="op" id="3062677">(</span><span class="op" id="3062678">)</span>&nbsp;<span class="builtintype" id="3062680">error</span><br>
<span class="lineno"></span><span class="op" id="3062686">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3062689">func</span>&nbsp;<span class="op" id="3062694">(</span><span class="ident" id="3062695">client</span>&nbsp;<span class="op" id="3062702">*</span><span class="ident" id="3062703">Client</span><span class="op" id="3062709">)</span>&nbsp;<span class="ident" id="3062711">send</span><span class="op" id="3062715">(</span><span class="ident" id="3062716">call</span>&nbsp;<span class="op" id="3062721">*</span><span class="ident" id="3062722">Call</span><span class="op" id="3062726">)</span>&nbsp;<span class="op" id="3062728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062731">client</span><span class="op" id="3062737">.</span><span class="ident" id="3062738">reqMutex</span><span class="op" id="3062746">.</span><span class="ident" id="3062747">Lock</span><span class="op" id="3062751">(</span><span class="op" id="3062752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062755">defer</span>&nbsp;<span class="ident" id="3062761">client</span><span class="op" id="3062767">.</span><span class="ident" id="3062768">reqMutex</span><span class="op" id="3062776">.</span><span class="ident" id="3062777">Unlock</span><span class="op" id="3062783">(</span><span class="op" id="3062784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3062788">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062812">client</span><span class="op" id="3062818">.</span><span class="ident" id="3062819">mutex</span><span class="op" id="3062824">.</span><span class="ident" id="3062825">Lock</span><span class="op" id="3062829">(</span><span class="op" id="3062830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062833">if</span>&nbsp;<span class="ident" id="3062836">client</span><span class="op" id="3062842">.</span><span class="ident" id="3062843">shutdown</span>&nbsp;<span class="op" id="3062852">||</span>&nbsp;<span class="ident" id="3062855">client</span><span class="op" id="3062861">.</span><span class="ident" id="3062862">closing</span>&nbsp;<span class="op" id="3062870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062874">call</span><span class="op" id="3062878">.</span><span class="ident" id="3062879">Error</span>&nbsp;<span class="op" id="3062885">=</span>&nbsp;<span class="ident" id="3062887">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062901">client</span><span class="op" id="3062907">.</span><span class="ident" id="3062908">mutex</span><span class="op" id="3062913">.</span><span class="ident" id="3062914">Unlock</span><span class="op" id="3062920">(</span><span class="op" id="3062921">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062925">call</span><span class="op" id="3062929">.</span><span class="ident" id="3062930">done</span><span class="op" id="3062934">(</span><span class="op" id="3062935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062939">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062950">seq</span>&nbsp;<span class="op" id="3062954">:=</span>&nbsp;<span class="ident" id="3062957">client</span><span class="op" id="3062963">.</span><span class="ident" id="3062964">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062969">client</span><span class="op" id="3062975">.</span><span class="ident" id="3062976">seq</span><span class="op" id="3062979">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062983">client</span><span class="op" id="3062989">.</span><span class="ident" id="3062990">pending</span><span class="op" id="3062997">[</span><span class="ident" id="3062998">seq</span><span class="op" id="3063001">]</span>&nbsp;<span class="op" id="3063003">=</span>&nbsp;<span class="ident" id="3063005">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063011">client</span><span class="op" id="3063017">.</span><span class="ident" id="3063018">mutex</span><span class="op" id="3063023">.</span><span class="ident" id="3063024">Unlock</span><span class="op" id="3063030">(</span><span class="op" id="3063031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063035">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063068">client</span><span class="op" id="3063074">.</span><span class="ident" id="3063075">request</span><span class="op" id="3063082">.</span><span class="ident" id="3063083">Seq</span>&nbsp;<span class="op" id="3063087">=</span>&nbsp;<span class="ident" id="3063089">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063094">client</span><span class="op" id="3063100">.</span><span class="ident" id="3063101">request</span><span class="op" id="3063108">.</span><span class="ident" id="3063109">ServiceMethod</span>&nbsp;<span class="op" id="3063123">=</span>&nbsp;<span class="ident" id="3063125">call</span><span class="op" id="3063129">.</span><span class="ident" id="3063130">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063145">err</span>&nbsp;<span class="op" id="3063149">:=</span>&nbsp;<span class="ident" id="3063152">client</span><span class="op" id="3063158">.</span><span class="ident" id="3063159">codec</span><span class="op" id="3063164">.</span><span class="ident" id="3063165">WriteRequest</span><span class="op" id="3063177">(</span><span class="op" id="3063178">&amp;</span><span class="ident" id="3063179">client</span><span class="op" id="3063185">.</span><span class="ident" id="3063186">request</span><span class="op" id="3063193">,</span>&nbsp;<span class="ident" id="3063195">call</span><span class="op" id="3063199">.</span><span class="ident" id="3063200">Args</span><span class="op" id="3063204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063207">if</span>&nbsp;<span class="ident" id="3063210">err</span>&nbsp;<span class="op" id="3063214">!=</span>&nbsp;<span class="ident" id="3063217">nil</span>&nbsp;<span class="op" id="3063221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063225">client</span><span class="op" id="3063231">.</span><span class="ident" id="3063232">mutex</span><span class="op" id="3063237">.</span><span class="ident" id="3063238">Lock</span><span class="op" id="3063242">(</span><span class="op" id="3063243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063247">call</span>&nbsp;<span class="op" id="3063252">=</span>&nbsp;<span class="ident" id="3063254">client</span><span class="op" id="3063260">.</span><span class="ident" id="3063261">pending</span><span class="op" id="3063268">[</span><span class="ident" id="3063269">seq</span><span class="op" id="3063272">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063276">delete</span><span class="op" id="3063282">(</span><span class="ident" id="3063283">client</span><span class="op" id="3063289">.</span><span class="ident" id="3063290">pending</span><span class="op" id="3063297">,</span>&nbsp;<span class="ident" id="3063299">seq</span><span class="op" id="3063302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063306">client</span><span class="op" id="3063312">.</span><span class="ident" id="3063313">mutex</span><span class="op" id="3063318">.</span><span class="ident" id="3063319">Unlock</span><span class="op" id="3063325">(</span><span class="op" id="3063326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063330">if</span>&nbsp;<span class="ident" id="3063333">call</span>&nbsp;<span class="op" id="3063338">!=</span>&nbsp;<span class="ident" id="3063341">nil</span>&nbsp;<span class="op" id="3063345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063350">call</span><span class="op" id="3063354">.</span><span class="ident" id="3063355">Error</span>&nbsp;<span class="op" id="3063361">=</span>&nbsp;<span class="ident" id="3063363">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063370">call</span><span class="op" id="3063374">.</span><span class="ident" id="3063375">done</span><span class="op" id="3063379">(</span><span class="op" id="3063380">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063387">}</span><br>
<span class="lineno"></span><span class="op" id="3063389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3063392">func</span>&nbsp;<span class="op" id="3063397">(</span><span class="ident" id="3063398">client</span>&nbsp;<span class="op" id="3063405">*</span><span class="ident" id="3063406">Client</span><span class="op" id="3063412">)</span>&nbsp;<span class="ident" id="3063414">input</span><span class="op" id="3063419">(</span><span class="op" id="3063420">)</span>&nbsp;<span class="op" id="3063422">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063425">var</span>&nbsp;<span class="ident" id="3063429">err</span>&nbsp;<span class="builtintype" id="3063433">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063440">var</span>&nbsp;<span class="ident" id="3063444">response</span>&nbsp;<span class="ident" id="3063453">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063463">for</span>&nbsp;<span class="ident" id="3063467">err</span>&nbsp;<span class="op" id="3063471">==</span>&nbsp;<span class="ident" id="3063474">nil</span>&nbsp;<span class="op" id="3063478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063482">response</span>&nbsp;<span class="op" id="3063491">=</span>&nbsp;<span class="ident" id="3063493">Response</span><span class="op" id="3063501">{</span><span class="op" id="3063502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063506">err</span>&nbsp;<span class="op" id="3063510">=</span>&nbsp;<span class="ident" id="3063512">client</span><span class="op" id="3063518">.</span><span class="ident" id="3063519">codec</span><span class="op" id="3063524">.</span><span class="ident" id="3063525">ReadResponseHeader</span><span class="op" id="3063543">(</span><span class="op" id="3063544">&amp;</span><span class="ident" id="3063545">response</span><span class="op" id="3063553">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063557">if</span>&nbsp;<span class="ident" id="3063560">err</span>&nbsp;<span class="op" id="3063564">!=</span>&nbsp;<span class="ident" id="3063567">nil</span>&nbsp;<span class="op" id="3063571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063576">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3063584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063588">seq</span>&nbsp;<span class="op" id="3063592">:=</span>&nbsp;<span class="ident" id="3063595">response</span><span class="op" id="3063603">.</span><span class="ident" id="3063604">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063610">client</span><span class="op" id="3063616">.</span><span class="ident" id="3063617">mutex</span><span class="op" id="3063622">.</span><span class="ident" id="3063623">Lock</span><span class="op" id="3063627">(</span><span class="op" id="3063628">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063632">call</span>&nbsp;<span class="op" id="3063637">:=</span>&nbsp;<span class="ident" id="3063640">client</span><span class="op" id="3063646">.</span><span class="ident" id="3063647">pending</span><span class="op" id="3063654">[</span><span class="ident" id="3063655">seq</span><span class="op" id="3063658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063662">delete</span><span class="op" id="3063668">(</span><span class="ident" id="3063669">client</span><span class="op" id="3063675">.</span><span class="ident" id="3063676">pending</span><span class="op" id="3063683">,</span>&nbsp;<span class="ident" id="3063685">seq</span><span class="op" id="3063688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063692">client</span><span class="op" id="3063698">.</span><span class="ident" id="3063699">mutex</span><span class="op" id="3063704">.</span><span class="ident" id="3063705">Unlock</span><span class="op" id="3063711">(</span><span class="op" id="3063712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063717">switch</span>&nbsp;<span class="op" id="3063724">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3063728">case</span>&nbsp;<span class="ident" id="3063733">call</span>&nbsp;<span class="op" id="3063738">==</span>&nbsp;<span class="ident" id="3063741">nil</span><span class="op" id="3063744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063749">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063806">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063864">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063920">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3063978">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064038">err</span>&nbsp;<span class="op" id="3064042">=</span>&nbsp;<span class="ident" id="3064044">client</span><span class="op" id="3064050">.</span><span class="ident" id="3064051">codec</span><span class="op" id="3064056">.</span><span class="ident" id="3064057">ReadResponseBody</span><span class="op" id="3064073">(</span><span class="ident" id="3064074">nil</span><span class="op" id="3064077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064082">if</span>&nbsp;<span class="ident" id="3064085">err</span>&nbsp;<span class="op" id="3064089">!=</span>&nbsp;<span class="ident" id="3064092">nil</span>&nbsp;<span class="op" id="3064096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064102">err</span>&nbsp;<span class="op" id="3064106">=</span>&nbsp;<span class="ident" id="3064108">errors</span><span class="op" id="3064114">.</span><span class="ident" id="3064115">New</span><span class="op" id="3064118">(</span><span class="string" id="3064119">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="3064142">+</span>&nbsp;<span class="ident" id="3064144">err</span><span class="op" id="3064147">.</span><span class="ident" id="3064148">Error</span><span class="op" id="3064153">(</span><span class="op" id="3064154">)</span><span class="op" id="3064155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064160">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064164">case</span>&nbsp;<span class="ident" id="3064169">response</span><span class="op" id="3064177">.</span><span class="ident" id="3064178">Error</span>&nbsp;<span class="op" id="3064184">!=</span>&nbsp;<span class="string" id="3064187">&#34;&#34;</span><span class="op" id="3064189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3064194">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3064255">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3064315">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064344">call</span><span class="op" id="3064348">.</span><span class="ident" id="3064349">Error</span>&nbsp;<span class="op" id="3064355">=</span>&nbsp;<span class="ident" id="3064357">ServerError</span><span class="op" id="3064368">(</span><span class="ident" id="3064369">response</span><span class="op" id="3064377">.</span><span class="ident" id="3064378">Error</span><span class="op" id="3064383">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064388">err</span>&nbsp;<span class="op" id="3064392">=</span>&nbsp;<span class="ident" id="3064394">client</span><span class="op" id="3064400">.</span><span class="ident" id="3064401">codec</span><span class="op" id="3064406">.</span><span class="ident" id="3064407">ReadResponseBody</span><span class="op" id="3064423">(</span><span class="ident" id="3064424">nil</span><span class="op" id="3064427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064432">if</span>&nbsp;<span class="ident" id="3064435">err</span>&nbsp;<span class="op" id="3064439">!=</span>&nbsp;<span class="ident" id="3064442">nil</span>&nbsp;<span class="op" id="3064446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064452">err</span>&nbsp;<span class="op" id="3064456">=</span>&nbsp;<span class="ident" id="3064458">errors</span><span class="op" id="3064464">.</span><span class="ident" id="3064465">New</span><span class="op" id="3064468">(</span><span class="string" id="3064469">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="3064492">+</span>&nbsp;<span class="ident" id="3064494">err</span><span class="op" id="3064497">.</span><span class="ident" id="3064498">Error</span><span class="op" id="3064503">(</span><span class="op" id="3064504">)</span><span class="op" id="3064505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064515">call</span><span class="op" id="3064519">.</span><span class="ident" id="3064520">done</span><span class="op" id="3064524">(</span><span class="op" id="3064525">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064529">default</span><span class="op" id="3064536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064541">err</span>&nbsp;<span class="op" id="3064545">=</span>&nbsp;<span class="ident" id="3064547">client</span><span class="op" id="3064553">.</span><span class="ident" id="3064554">codec</span><span class="op" id="3064559">.</span><span class="ident" id="3064560">ReadResponseBody</span><span class="op" id="3064576">(</span><span class="ident" id="3064577">call</span><span class="op" id="3064581">.</span><span class="ident" id="3064582">Reply</span><span class="op" id="3064587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064592">if</span>&nbsp;<span class="ident" id="3064595">err</span>&nbsp;<span class="op" id="3064599">!=</span>&nbsp;<span class="ident" id="3064602">nil</span>&nbsp;<span class="op" id="3064606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064612">call</span><span class="op" id="3064616">.</span><span class="ident" id="3064617">Error</span>&nbsp;<span class="op" id="3064623">=</span>&nbsp;<span class="ident" id="3064625">errors</span><span class="op" id="3064631">.</span><span class="ident" id="3064632">New</span><span class="op" id="3064635">(</span><span class="string" id="3064636">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="3064652">+</span>&nbsp;<span class="ident" id="3064654">err</span><span class="op" id="3064657">.</span><span class="ident" id="3064658">Error</span><span class="op" id="3064663">(</span><span class="op" id="3064664">)</span><span class="op" id="3064665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064670">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064675">call</span><span class="op" id="3064679">.</span><span class="ident" id="3064680">done</span><span class="op" id="3064684">(</span><span class="op" id="3064685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3064695">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064724">client</span><span class="op" id="3064730">.</span><span class="ident" id="3064731">reqMutex</span><span class="op" id="3064739">.</span><span class="ident" id="3064740">Lock</span><span class="op" id="3064744">(</span><span class="op" id="3064745">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064748">client</span><span class="op" id="3064754">.</span><span class="ident" id="3064755">mutex</span><span class="op" id="3064760">.</span><span class="ident" id="3064761">Lock</span><span class="op" id="3064765">(</span><span class="op" id="3064766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064769">client</span><span class="op" id="3064775">.</span><span class="ident" id="3064776">shutdown</span>&nbsp;<span class="op" id="3064785">=</span>&nbsp;<span class="ident" id="3064787">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064793">closing</span>&nbsp;<span class="op" id="3064801">:=</span>&nbsp;<span class="ident" id="3064804">client</span><span class="op" id="3064810">.</span><span class="ident" id="3064811">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064820">if</span>&nbsp;<span class="ident" id="3064823">err</span>&nbsp;<span class="op" id="3064827">==</span>&nbsp;<span class="ident" id="3064830">io</span><span class="op" id="3064832">.</span><span class="ident" id="3064833">EOF</span>&nbsp;<span class="op" id="3064837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064841">if</span>&nbsp;<span class="ident" id="3064844">closing</span>&nbsp;<span class="op" id="3064852">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064857">err</span>&nbsp;<span class="op" id="3064861">=</span>&nbsp;<span class="ident" id="3064863">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064877">}</span>&nbsp;<span class="keyword" id="3064879">else</span>&nbsp;<span class="op" id="3064884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064889">err</span>&nbsp;<span class="op" id="3064893">=</span>&nbsp;<span class="ident" id="3064895">io</span><span class="op" id="3064897">.</span><span class="ident" id="3064898">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064920">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064923">for</span>&nbsp;<span class="ident" id="3064927">_</span><span class="op" id="3064928">,</span>&nbsp;<span class="ident" id="3064930">call</span>&nbsp;<span class="op" id="3064935">:=</span>&nbsp;<span class="keyword" id="3064938">range</span>&nbsp;<span class="ident" id="3064944">client</span><span class="op" id="3064950">.</span><span class="ident" id="3064951">pending</span>&nbsp;<span class="op" id="3064959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064963">call</span><span class="op" id="3064967">.</span><span class="ident" id="3064968">Error</span>&nbsp;<span class="op" id="3064974">=</span>&nbsp;<span class="ident" id="3064976">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064982">call</span><span class="op" id="3064986">.</span><span class="ident" id="3064987">done</span><span class="op" id="3064991">(</span><span class="op" id="3064992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064998">client</span><span class="op" id="3065004">.</span><span class="ident" id="3065005">mutex</span><span class="op" id="3065010">.</span><span class="ident" id="3065011">Unlock</span><span class="op" id="3065017">(</span><span class="op" id="3065018">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065021">client</span><span class="op" id="3065027">.</span><span class="ident" id="3065028">reqMutex</span><span class="op" id="3065036">.</span><span class="ident" id="3065037">Unlock</span><span class="op" id="3065043">(</span><span class="op" id="3065044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065047">if</span>&nbsp;<span class="ident" id="3065050">debugLog</span>&nbsp;<span class="op" id="3065059">&amp;&amp;</span>&nbsp;<span class="ident" id="3065062">err</span>&nbsp;<span class="op" id="3065066">!=</span>&nbsp;<span class="ident" id="3065069">io</span><span class="op" id="3065071">.</span><span class="ident" id="3065072">EOF</span>&nbsp;<span class="op" id="3065076">&amp;&amp;</span>&nbsp;<span class="op" id="3065079">!</span><span class="ident" id="3065080">closing</span>&nbsp;<span class="op" id="3065088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065092">log</span><span class="op" id="3065095">.</span><span class="ident" id="3065096">Println</span><span class="op" id="3065103">(</span><span class="string" id="3065104">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="3065133">,</span>&nbsp;<span class="ident" id="3065135">err</span><span class="op" id="3065138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065141">}</span><br>
<span class="lineno"></span><span class="op" id="3065143">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="3065146">func</span>&nbsp;<span class="op" id="3065151">(</span><span class="ident" id="3065152">call</span>&nbsp;<span class="op" id="3065157">*</span><span class="ident" id="3065158">Call</span><span class="op" id="3065162">)</span>&nbsp;<span class="ident" id="3065164">done</span><span class="op" id="3065168">(</span><span class="op" id="3065169">)</span>&nbsp;<span class="op" id="3065171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065174">select</span>&nbsp;<span class="op" id="3065181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065184">case</span>&nbsp;<span class="ident" id="3065189">call</span><span class="op" id="3065193">.</span><span class="ident" id="3065194">Done</span>&nbsp;<span class="op" id="3065199">&lt;-</span>&nbsp;<span class="ident" id="3065202">call</span><span class="op" id="3065206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065210">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065217">default</span><span class="op" id="3065224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065228">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065305">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065373">if</span>&nbsp;<span class="ident" id="3065376">debugLog</span>&nbsp;<span class="op" id="3065385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065390">log</span><span class="op" id="3065393">.</span><span class="ident" id="3065394">Println</span><span class="op" id="3065401">(</span><span class="string" id="3065402">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="3065469">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065476">}</span><br>
<span class="lineno"></span><span class="op" id="3065478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065481">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="3065541">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3065596">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="3065655">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="3065701">func</span>&nbsp;<span class="ident" id="3065706">NewClient</span><span class="op" id="3065715">(</span><span class="ident" id="3065716">conn</span>&nbsp;<span class="ident" id="3065721">io</span><span class="op" id="3065723">.</span><span class="ident" id="3065724">ReadWriteCloser</span><span class="op" id="3065739">)</span>&nbsp;<span class="op" id="3065741">*</span><span class="ident" id="3065742">Client</span>&nbsp;<span class="op" id="3065749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065752">encBuf</span>&nbsp;<span class="op" id="3065759">:=</span>&nbsp;<span class="ident" id="3065762">bufio</span><span class="op" id="3065767">.</span><span class="ident" id="3065768">NewWriter</span><span class="op" id="3065777">(</span><span class="ident" id="3065778">conn</span><span class="op" id="3065782">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065785">client</span>&nbsp;<span class="op" id="3065792">:=</span>&nbsp;<span class="op" id="3065795">&amp;</span><span class="ident" id="3065796">gobClientCodec</span><span class="op" id="3065810">{</span><span class="ident" id="3065811">conn</span><span class="op" id="3065815">,</span>&nbsp;<span class="ident" id="3065817">gob</span><span class="op" id="3065820">.</span><span class="ident" id="3065821">NewDecoder</span><span class="op" id="3065831">(</span><span class="ident" id="3065832">conn</span><span class="op" id="3065836">)</span><span class="op" id="3065837">,</span>&nbsp;<span class="ident" id="3065839">gob</span><span class="op" id="3065842">.</span><span class="ident" id="3065843">NewEncoder</span><span class="op" id="3065853">(</span><span class="ident" id="3065854">encBuf</span><span class="op" id="3065860">)</span><span class="op" id="3065861">,</span>&nbsp;<span class="ident" id="3065863">encBuf</span><span class="op" id="3065869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065872">return</span>&nbsp;<span class="ident" id="3065879">NewClientWithCodec</span><span class="op" id="3065897">(</span><span class="ident" id="3065898">client</span><span class="op" id="3065904">)</span><br>
<span class="lineno"></span><span class="op" id="3065906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065909">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="3065972">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="3066022">func</span>&nbsp;<span class="ident" id="3066027">NewClientWithCodec</span><span class="op" id="3066045">(</span><span class="ident" id="3066046">codec</span>&nbsp;<span class="ident" id="3066052">ClientCodec</span><span class="op" id="3066063">)</span>&nbsp;<span class="op" id="3066065">*</span><span class="ident" id="3066066">Client</span>&nbsp;<span class="op" id="3066073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066076">client</span>&nbsp;<span class="op" id="3066083">:=</span>&nbsp;<span class="op" id="3066086">&amp;</span><span class="ident" id="3066087">Client</span><span class="op" id="3066093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066097">codec</span><span class="op" id="3066102">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3066106">codec</span><span class="op" id="3066111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066115">pending</span><span class="op" id="3066122">:</span>&nbsp;<span class="builtinfunc" id="3066124">make</span><span class="op" id="3066128">(</span><span class="keyword" id="3066129">map</span><span class="op" id="3066132">[</span><span class="ident" id="3066133">uint64</span><span class="op" id="3066139">]</span><span class="op" id="3066140">*</span><span class="ident" id="3066141">Call</span><span class="op" id="3066145">)</span><span class="op" id="3066146">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066152">go</span>&nbsp;<span class="ident" id="3066155">client</span><span class="op" id="3066161">.</span><span class="ident" id="3066162">input</span><span class="op" id="3066167">(</span><span class="op" id="3066168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066171">return</span>&nbsp;<span class="ident" id="3066178">client</span><br>
<span class="lineno"></span><span class="op" id="3066185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="3066188">type</span>&nbsp;<span class="ident" id="3066193">gobClientCodec</span>&nbsp;<span class="keyword" id="3066208">struct</span>&nbsp;<span class="op" id="3066215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066218">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066225">io</span><span class="op" id="3066227">.</span><span class="ident" id="3066228">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066245">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066252">*</span><span class="ident" id="3066253">gob</span><span class="op" id="3066256">.</span><span class="ident" id="3066257">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066266">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066273">*</span><span class="ident" id="3066274">gob</span><span class="op" id="3066277">.</span><span class="ident" id="3066278">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066287">encBuf</span>&nbsp;<span class="op" id="3066294">*</span><span class="ident" id="3066295">bufio</span><span class="op" id="3066300">.</span><span class="ident" id="3066301">Writer</span><br>
<span class="lineno">210</span><span class="op" id="3066308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3066311">func</span>&nbsp;<span class="op" id="3066316">(</span><span class="ident" id="3066317">c</span>&nbsp;<span class="op" id="3066319">*</span><span class="ident" id="3066320">gobClientCodec</span><span class="op" id="3066334">)</span>&nbsp;<span class="ident" id="3066336">WriteRequest</span><span class="op" id="3066348">(</span><span class="ident" id="3066349">r</span>&nbsp;<span class="op" id="3066351">*</span><span class="ident" id="3066352">Request</span><span class="op" id="3066359">,</span>&nbsp;<span class="ident" id="3066361">body</span>&nbsp;<span class="keyword" id="3066366">interface</span><span class="op" id="3066375">{</span><span class="op" id="3066376">}</span><span class="op" id="3066377">)</span>&nbsp;<span class="op" id="3066379">(</span><span class="ident" id="3066380">err</span>&nbsp;<span class="builtintype" id="3066384">error</span><span class="op" id="3066389">)</span>&nbsp;<span class="op" id="3066391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066394">if</span>&nbsp;<span class="ident" id="3066397">err</span>&nbsp;<span class="op" id="3066401">=</span>&nbsp;<span class="ident" id="3066403">c</span><span class="op" id="3066404">.</span><span class="ident" id="3066405">enc</span><span class="op" id="3066408">.</span><span class="ident" id="3066409">Encode</span><span class="op" id="3066415">(</span><span class="ident" id="3066416">r</span><span class="op" id="3066417">)</span><span class="op" id="3066418">;</span>&nbsp;<span class="ident" id="3066420">err</span>&nbsp;<span class="op" id="3066424">!=</span>&nbsp;<span class="ident" id="3066427">nil</span>&nbsp;<span class="op" id="3066431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066435">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066446">if</span>&nbsp;<span class="ident" id="3066449">err</span>&nbsp;<span class="op" id="3066453">=</span>&nbsp;<span class="ident" id="3066455">c</span><span class="op" id="3066456">.</span><span class="ident" id="3066457">enc</span><span class="op" id="3066460">.</span><span class="ident" id="3066461">Encode</span><span class="op" id="3066467">(</span><span class="ident" id="3066468">body</span><span class="op" id="3066472">)</span><span class="op" id="3066473">;</span>&nbsp;<span class="ident" id="3066475">err</span>&nbsp;<span class="op" id="3066479">!=</span>&nbsp;<span class="ident" id="3066482">nil</span>&nbsp;<span class="op" id="3066486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066490">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066501">return</span>&nbsp;<span class="ident" id="3066508">c</span><span class="op" id="3066509">.</span><span class="ident" id="3066510">encBuf</span><span class="op" id="3066516">.</span><span class="ident" id="3066517">Flush</span><span class="op" id="3066522">(</span><span class="op" id="3066523">)</span><br>
<span class="lineno">220</span><span class="op" id="3066525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3066528">func</span>&nbsp;<span class="op" id="3066533">(</span><span class="ident" id="3066534">c</span>&nbsp;<span class="op" id="3066536">*</span><span class="ident" id="3066537">gobClientCodec</span><span class="op" id="3066551">)</span>&nbsp;<span class="ident" id="3066553">ReadResponseHeader</span><span class="op" id="3066571">(</span><span class="ident" id="3066572">r</span>&nbsp;<span class="op" id="3066574">*</span><span class="ident" id="3066575">Response</span><span class="op" id="3066583">)</span>&nbsp;<span class="builtintype" id="3066585">error</span>&nbsp;<span class="op" id="3066591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066594">return</span>&nbsp;<span class="ident" id="3066601">c</span><span class="op" id="3066602">.</span><span class="ident" id="3066603">dec</span><span class="op" id="3066606">.</span><span class="ident" id="3066607">Decode</span><span class="op" id="3066613">(</span><span class="ident" id="3066614">r</span><span class="op" id="3066615">)</span><br>
<span class="lineno"></span><span class="op" id="3066617">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="3066620">func</span>&nbsp;<span class="op" id="3066625">(</span><span class="ident" id="3066626">c</span>&nbsp;<span class="op" id="3066628">*</span><span class="ident" id="3066629">gobClientCodec</span><span class="op" id="3066643">)</span>&nbsp;<span class="ident" id="3066645">ReadResponseBody</span><span class="op" id="3066661">(</span><span class="ident" id="3066662">body</span>&nbsp;<span class="keyword" id="3066667">interface</span><span class="op" id="3066676">{</span><span class="op" id="3066677">}</span><span class="op" id="3066678">)</span>&nbsp;<span class="builtintype" id="3066680">error</span>&nbsp;<span class="op" id="3066686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066689">return</span>&nbsp;<span class="ident" id="3066696">c</span><span class="op" id="3066697">.</span><span class="ident" id="3066698">dec</span><span class="op" id="3066701">.</span><span class="ident" id="3066702">Decode</span><span class="op" id="3066708">(</span><span class="ident" id="3066709">body</span><span class="op" id="3066713">)</span><br>
<span class="lineno"></span><span class="op" id="3066715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="3066718">func</span>&nbsp;<span class="op" id="3066723">(</span><span class="ident" id="3066724">c</span>&nbsp;<span class="op" id="3066726">*</span><span class="ident" id="3066727">gobClientCodec</span><span class="op" id="3066741">)</span>&nbsp;<span class="ident" id="3066743">Close</span><span class="op" id="3066748">(</span><span class="op" id="3066749">)</span>&nbsp;<span class="builtintype" id="3066751">error</span>&nbsp;<span class="op" id="3066757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066760">return</span>&nbsp;<span class="ident" id="3066767">c</span><span class="op" id="3066768">.</span><span class="ident" id="3066769">rwc</span><span class="op" id="3066772">.</span><span class="ident" id="3066773">Close</span><span class="op" id="3066778">(</span><span class="op" id="3066779">)</span><br>
<span class="lineno"></span><span class="op" id="3066781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3066784">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="3066860">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3066903">func</span>&nbsp;<span class="ident" id="3066908">DialHTTP</span><span class="op" id="3066916">(</span><span class="ident" id="3066917">network</span><span class="op" id="3066924">,</span>&nbsp;<span class="ident" id="3066926">address</span>&nbsp;<span class="builtintype" id="3066934">string</span><span class="op" id="3066940">)</span>&nbsp;<span class="op" id="3066942">(</span><span class="op" id="3066943">*</span><span class="ident" id="3066944">Client</span><span class="op" id="3066950">,</span>&nbsp;<span class="builtintype" id="3066952">error</span><span class="op" id="3066957">)</span>&nbsp;<span class="op" id="3066959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066962">return</span>&nbsp;<span class="ident" id="3066969">DialHTTPPath</span><span class="op" id="3066981">(</span><span class="ident" id="3066982">network</span><span class="op" id="3066989">,</span>&nbsp;<span class="ident" id="3066991">address</span><span class="op" id="3066998">,</span>&nbsp;<span class="ident" id="3067000">DefaultRPCPath</span><span class="op" id="3067014">)</span><br>
<span class="lineno"></span><span class="op" id="3067016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="3067019">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3067066">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3067112">func</span>&nbsp;<span class="ident" id="3067117">DialHTTPPath</span><span class="op" id="3067129">(</span><span class="ident" id="3067130">network</span><span class="op" id="3067137">,</span>&nbsp;<span class="ident" id="3067139">address</span><span class="op" id="3067146">,</span>&nbsp;<span class="ident" id="3067148">path</span>&nbsp;<span class="builtintype" id="3067153">string</span><span class="op" id="3067159">)</span>&nbsp;<span class="op" id="3067161">(</span><span class="op" id="3067162">*</span><span class="ident" id="3067163">Client</span><span class="op" id="3067169">,</span>&nbsp;<span class="builtintype" id="3067171">error</span><span class="op" id="3067176">)</span>&nbsp;<span class="op" id="3067178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067181">var</span>&nbsp;<span class="ident" id="3067185">err</span>&nbsp;<span class="builtintype" id="3067189">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067196">conn</span><span class="op" id="3067200">,</span>&nbsp;<span class="ident" id="3067202">err</span>&nbsp;<span class="op" id="3067206">:=</span>&nbsp;<span class="ident" id="3067209">net</span><span class="op" id="3067212">.</span><span class="ident" id="3067213">Dial</span><span class="op" id="3067217">(</span><span class="ident" id="3067218">network</span><span class="op" id="3067225">,</span>&nbsp;<span class="ident" id="3067227">address</span><span class="op" id="3067234">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067237">if</span>&nbsp;<span class="ident" id="3067240">err</span>&nbsp;<span class="op" id="3067244">!=</span>&nbsp;<span class="ident" id="3067247">nil</span>&nbsp;<span class="op" id="3067251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067255">return</span>&nbsp;<span class="ident" id="3067262">nil</span><span class="op" id="3067265">,</span>&nbsp;<span class="ident" id="3067267">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067275">io</span><span class="op" id="3067277">.</span><span class="ident" id="3067278">WriteString</span><span class="op" id="3067289">(</span><span class="ident" id="3067290">conn</span><span class="op" id="3067294">,</span>&nbsp;<span class="string" id="3067296">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="3067306">+</span><span class="ident" id="3067307">path</span><span class="op" id="3067311">+</span><span class="string" id="3067312">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="3067327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067331">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067368">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067406">resp</span><span class="op" id="3067410">,</span>&nbsp;<span class="ident" id="3067412">err</span>&nbsp;<span class="op" id="3067416">:=</span>&nbsp;<span class="ident" id="3067419">http</span><span class="op" id="3067423">.</span><span class="ident" id="3067424">ReadResponse</span><span class="op" id="3067436">(</span><span class="ident" id="3067437">bufio</span><span class="op" id="3067442">.</span><span class="ident" id="3067443">NewReader</span><span class="op" id="3067452">(</span><span class="ident" id="3067453">conn</span><span class="op" id="3067457">)</span><span class="op" id="3067458">,</span>&nbsp;<span class="op" id="3067460">&amp;</span><span class="ident" id="3067461">http</span><span class="op" id="3067465">.</span><span class="ident" id="3067466">Request</span><span class="op" id="3067473">{</span><span class="ident" id="3067474">Method</span><span class="op" id="3067480">:</span>&nbsp;<span class="string" id="3067482">&#34;CONNECT&#34;</span><span class="op" id="3067491">}</span><span class="op" id="3067492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067495">if</span>&nbsp;<span class="ident" id="3067498">err</span>&nbsp;<span class="op" id="3067502">==</span>&nbsp;<span class="ident" id="3067505">nil</span>&nbsp;<span class="op" id="3067509">&amp;&amp;</span>&nbsp;<span class="ident" id="3067512">resp</span><span class="op" id="3067516">.</span><span class="ident" id="3067517">Status</span>&nbsp;<span class="op" id="3067524">==</span>&nbsp;<span class="ident" id="3067527">connected</span>&nbsp;<span class="op" id="3067537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067541">return</span>&nbsp;<span class="ident" id="3067548">NewClient</span><span class="op" id="3067557">(</span><span class="ident" id="3067558">conn</span><span class="op" id="3067562">)</span><span class="op" id="3067563">,</span>&nbsp;<span class="ident" id="3067565">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067573">if</span>&nbsp;<span class="ident" id="3067576">err</span>&nbsp;<span class="op" id="3067580">==</span>&nbsp;<span class="ident" id="3067583">nil</span>&nbsp;<span class="op" id="3067587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067591">err</span>&nbsp;<span class="op" id="3067595">=</span>&nbsp;<span class="ident" id="3067597">errors</span><span class="op" id="3067603">.</span><span class="ident" id="3067604">New</span><span class="op" id="3067607">(</span><span class="string" id="3067608">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3067637">+</span>&nbsp;<span class="ident" id="3067639">resp</span><span class="op" id="3067643">.</span><span class="ident" id="3067644">Status</span><span class="op" id="3067650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067656">conn</span><span class="op" id="3067660">.</span><span class="ident" id="3067661">Close</span><span class="op" id="3067666">(</span><span class="op" id="3067667">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067670">return</span>&nbsp;<span class="ident" id="3067677">nil</span><span class="op" id="3067680">,</span>&nbsp;<span class="op" id="3067682">&amp;</span><span class="ident" id="3067683">net</span><span class="op" id="3067686">.</span><span class="ident" id="3067687">OpError</span><span class="op" id="3067694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067698">Op</span><span class="op" id="3067700">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3067704">&#34;dial-http&#34;</span><span class="op" id="3067715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067719">Net</span><span class="op" id="3067722">:</span>&nbsp;&nbsp;<span class="ident" id="3067725">network</span>&nbsp;<span class="op" id="3067733">+</span>&nbsp;<span class="string" id="3067735">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3067739">+</span>&nbsp;<span class="ident" id="3067741">address</span><span class="op" id="3067748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067752">Addr</span><span class="op" id="3067756">:</span>&nbsp;<span class="ident" id="3067758">nil</span><span class="op" id="3067761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067765">Err</span><span class="op" id="3067768">:</span>&nbsp;&nbsp;<span class="ident" id="3067771">err</span><span class="op" id="3067774">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067777">}</span><br>
<span class="lineno"></span><span class="op" id="3067779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3067782">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3067850">func</span>&nbsp;<span class="ident" id="3067855">Dial</span><span class="op" id="3067859">(</span><span class="ident" id="3067860">network</span><span class="op" id="3067867">,</span>&nbsp;<span class="ident" id="3067869">address</span>&nbsp;<span class="builtintype" id="3067877">string</span><span class="op" id="3067883">)</span>&nbsp;<span class="op" id="3067885">(</span><span class="op" id="3067886">*</span><span class="ident" id="3067887">Client</span><span class="op" id="3067893">,</span>&nbsp;<span class="builtintype" id="3067895">error</span><span class="op" id="3067900">)</span>&nbsp;<span class="op" id="3067902">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067905">conn</span><span class="op" id="3067909">,</span>&nbsp;<span class="ident" id="3067911">err</span>&nbsp;<span class="op" id="3067915">:=</span>&nbsp;<span class="ident" id="3067918">net</span><span class="op" id="3067921">.</span><span class="ident" id="3067922">Dial</span><span class="op" id="3067926">(</span><span class="ident" id="3067927">network</span><span class="op" id="3067934">,</span>&nbsp;<span class="ident" id="3067936">address</span><span class="op" id="3067943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067946">if</span>&nbsp;<span class="ident" id="3067949">err</span>&nbsp;<span class="op" id="3067953">!=</span>&nbsp;<span class="ident" id="3067956">nil</span>&nbsp;<span class="op" id="3067960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067964">return</span>&nbsp;<span class="ident" id="3067971">nil</span><span class="op" id="3067974">,</span>&nbsp;<span class="ident" id="3067976">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067984">return</span>&nbsp;<span class="ident" id="3067991">NewClient</span><span class="op" id="3068000">(</span><span class="ident" id="3068001">conn</span><span class="op" id="3068005">)</span><span class="op" id="3068006">,</span>&nbsp;<span class="ident" id="3068008">nil</span><br>
<span class="lineno">275</span><span class="op" id="3068012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3068015">func</span>&nbsp;<span class="op" id="3068020">(</span><span class="ident" id="3068021">client</span>&nbsp;<span class="op" id="3068028">*</span><span class="ident" id="3068029">Client</span><span class="op" id="3068035">)</span>&nbsp;<span class="ident" id="3068037">Close</span><span class="op" id="3068042">(</span><span class="op" id="3068043">)</span>&nbsp;<span class="builtintype" id="3068045">error</span>&nbsp;<span class="op" id="3068051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068054">client</span><span class="op" id="3068060">.</span><span class="ident" id="3068061">mutex</span><span class="op" id="3068066">.</span><span class="ident" id="3068067">Lock</span><span class="op" id="3068071">(</span><span class="op" id="3068072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068075">if</span>&nbsp;<span class="ident" id="3068078">client</span><span class="op" id="3068084">.</span><span class="ident" id="3068085">closing</span>&nbsp;<span class="op" id="3068093">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068097">client</span><span class="op" id="3068103">.</span><span class="ident" id="3068104">mutex</span><span class="op" id="3068109">.</span><span class="ident" id="3068110">Unlock</span><span class="op" id="3068116">(</span><span class="op" id="3068117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068121">return</span>&nbsp;<span class="ident" id="3068128">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068144">client</span><span class="op" id="3068150">.</span><span class="ident" id="3068151">closing</span>&nbsp;<span class="op" id="3068159">=</span>&nbsp;<span class="ident" id="3068161">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068167">client</span><span class="op" id="3068173">.</span><span class="ident" id="3068174">mutex</span><span class="op" id="3068179">.</span><span class="ident" id="3068180">Unlock</span><span class="op" id="3068186">(</span><span class="op" id="3068187">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068190">return</span>&nbsp;<span class="ident" id="3068197">client</span><span class="op" id="3068203">.</span><span class="ident" id="3068204">codec</span><span class="op" id="3068209">.</span><span class="ident" id="3068210">Close</span><span class="op" id="3068215">(</span><span class="op" id="3068216">)</span><br>
<span class="lineno"></span><span class="op" id="3068218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3068221">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="3068308">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="3068396">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="3068470">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="3068538">func</span>&nbsp;<span class="op" id="3068543">(</span><span class="ident" id="3068544">client</span>&nbsp;<span class="op" id="3068551">*</span><span class="ident" id="3068552">Client</span><span class="op" id="3068558">)</span>&nbsp;<span class="ident" id="3068560">Go</span><span class="op" id="3068562">(</span><span class="ident" id="3068563">serviceMethod</span>&nbsp;<span class="builtintype" id="3068577">string</span><span class="op" id="3068583">,</span>&nbsp;<span class="ident" id="3068585">args</span>&nbsp;<span class="keyword" id="3068590">interface</span><span class="op" id="3068599">{</span><span class="op" id="3068600">}</span><span class="op" id="3068601">,</span>&nbsp;<span class="ident" id="3068603">reply</span>&nbsp;<span class="keyword" id="3068609">interface</span><span class="op" id="3068618">{</span><span class="op" id="3068619">}</span><span class="op" id="3068620">,</span>&nbsp;<span class="ident" id="3068622">done</span>&nbsp;<span class="keyword" id="3068627">chan</span>&nbsp;<span class="op" id="3068632">*</span><span class="ident" id="3068633">Call</span><span class="op" id="3068637">)</span>&nbsp;<span class="op" id="3068639">*</span><span class="ident" id="3068640">Call</span>&nbsp;<span class="op" id="3068645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068648">call</span>&nbsp;<span class="op" id="3068653">:=</span>&nbsp;<span class="builtinfunc" id="3068656">new</span><span class="op" id="3068659">(</span><span class="ident" id="3068660">Call</span><span class="op" id="3068664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068667">call</span><span class="op" id="3068671">.</span><span class="ident" id="3068672">ServiceMethod</span>&nbsp;<span class="op" id="3068686">=</span>&nbsp;<span class="ident" id="3068688">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068703">call</span><span class="op" id="3068707">.</span><span class="ident" id="3068708">Args</span>&nbsp;<span class="op" id="3068713">=</span>&nbsp;<span class="ident" id="3068715">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068721">call</span><span class="op" id="3068725">.</span><span class="ident" id="3068726">Reply</span>&nbsp;<span class="op" id="3068732">=</span>&nbsp;<span class="ident" id="3068734">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068741">if</span>&nbsp;<span class="ident" id="3068744">done</span>&nbsp;<span class="op" id="3068749">==</span>&nbsp;<span class="ident" id="3068752">nil</span>&nbsp;<span class="op" id="3068756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068760">done</span>&nbsp;<span class="op" id="3068765">=</span>&nbsp;<span class="builtinfunc" id="3068767">make</span><span class="op" id="3068771">(</span><span class="keyword" id="3068772">chan</span>&nbsp;<span class="op" id="3068777">*</span><span class="ident" id="3068778">Call</span><span class="op" id="3068782">,</span>&nbsp;<span class="num" id="3068784">10</span><span class="op" id="3068786">)</span>&nbsp;<span class="comment" id="3068788">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068802">}</span>&nbsp;<span class="keyword" id="3068804">else</span>&nbsp;<span class="op" id="3068809">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068813">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068869">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068928">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3068987">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069044">if</span>&nbsp;<span class="builtinfunc" id="3069047">cap</span><span class="op" id="3069050">(</span><span class="ident" id="3069051">done</span><span class="op" id="3069055">)</span>&nbsp;<span class="op" id="3069057">==</span>&nbsp;<span class="num" id="3069060">0</span>&nbsp;<span class="op" id="3069062">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069067">log</span><span class="op" id="3069070">.</span><span class="ident" id="3069071">Panic</span><span class="op" id="3069076">(</span><span class="string" id="3069077">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="3069110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069120">call</span><span class="op" id="3069124">.</span><span class="ident" id="3069125">Done</span>&nbsp;<span class="op" id="3069130">=</span>&nbsp;<span class="ident" id="3069132">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069138">client</span><span class="op" id="3069144">.</span><span class="ident" id="3069145">send</span><span class="op" id="3069149">(</span><span class="ident" id="3069150">call</span><span class="op" id="3069154">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069157">return</span>&nbsp;<span class="ident" id="3069164">call</span><br>
<span class="lineno"></span><span class="op" id="3069169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3069172">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="3069264">func</span>&nbsp;<span class="op" id="3069269">(</span><span class="ident" id="3069270">client</span>&nbsp;<span class="op" id="3069277">*</span><span class="ident" id="3069278">Client</span><span class="op" id="3069284">)</span>&nbsp;<span class="ident" id="3069286">Call</span><span class="op" id="3069290">(</span><span class="ident" id="3069291">serviceMethod</span>&nbsp;<span class="builtintype" id="3069305">string</span><span class="op" id="3069311">,</span>&nbsp;<span class="ident" id="3069313">args</span>&nbsp;<span class="keyword" id="3069318">interface</span><span class="op" id="3069327">{</span><span class="op" id="3069328">}</span><span class="op" id="3069329">,</span>&nbsp;<span class="ident" id="3069331">reply</span>&nbsp;<span class="keyword" id="3069337">interface</span><span class="op" id="3069346">{</span><span class="op" id="3069347">}</span><span class="op" id="3069348">)</span>&nbsp;<span class="builtintype" id="3069350">error</span>&nbsp;<span class="op" id="3069356">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069359">call</span>&nbsp;<span class="op" id="3069364">:=</span>&nbsp;<span class="op" id="3069367">&lt;-</span><span class="ident" id="3069369">client</span><span class="op" id="3069375">.</span><span class="ident" id="3069376">Go</span><span class="op" id="3069378">(</span><span class="ident" id="3069379">serviceMethod</span><span class="op" id="3069392">,</span>&nbsp;<span class="ident" id="3069394">args</span><span class="op" id="3069398">,</span>&nbsp;<span class="ident" id="3069400">reply</span><span class="op" id="3069405">,</span>&nbsp;<span class="builtinfunc" id="3069407">make</span><span class="op" id="3069411">(</span><span class="keyword" id="3069412">chan</span>&nbsp;<span class="op" id="3069417">*</span><span class="ident" id="3069418">Call</span><span class="op" id="3069422">,</span>&nbsp;<span class="num" id="3069424">1</span><span class="op" id="3069425">)</span><span class="op" id="3069426">)</span><span class="op" id="3069427">.</span><span class="ident" id="3069428">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069434">return</span>&nbsp;<span class="ident" id="3069441">call</span><span class="op" id="3069445">.</span><span class="ident" id="3069446">Error</span><br>
<span class="lineno"></span><span class="op" id="3069452">}</span>
</div>
</body>
</html>
