<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2388807">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2388863">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2388917">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2388968">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2388996">package</span>&nbsp;<span class="ident" id="2389004">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389013">import</span>&nbsp;<span class="string" id="2389020">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2389030">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2389099">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2389155">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2389174">func</span>&nbsp;<span class="ident" id="2389179">UnixCredentials</span><span class="op" id="2389194">(</span><span class="ident" id="2389195">ucred</span>&nbsp;<span class="op" id="2389201">*</span><span class="ident" id="2389202">Ucred</span><span class="op" id="2389207">)</span>&nbsp;<span class="op" id="2389209">[</span><span class="op" id="2389210">]</span><span class="builtintype" id="2389211">byte</span>&nbsp;<span class="op" id="2389216">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389219">b</span>&nbsp;<span class="op" id="2389221">:=</span>&nbsp;<span class="builtinfunc" id="2389224">make</span><span class="op" id="2389228">(</span><span class="op" id="2389229">[</span><span class="op" id="2389230">]</span><span class="builtintype" id="2389231">byte</span><span class="op" id="2389235">,</span>&nbsp;<span class="ident" id="2389237">CmsgSpace</span><span class="op" id="2389246">(</span><span class="ident" id="2389247">SizeofUcred</span><span class="op" id="2389258">)</span><span class="op" id="2389259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389262">h</span>&nbsp;<span class="op" id="2389264">:=</span>&nbsp;<span class="op" id="2389267">(</span><span class="op" id="2389268">*</span><span class="ident" id="2389269">Cmsghdr</span><span class="op" id="2389276">)</span><span class="op" id="2389277">(</span><span class="ident" id="2389278">unsafe</span><span class="op" id="2389284">.</span><span class="ident" id="2389285">Pointer</span><span class="op" id="2389292">(</span><span class="op" id="2389293">&amp;</span><span class="ident" id="2389294">b</span><span class="op" id="2389295">[</span><span class="num" id="2389296">0</span><span class="op" id="2389297">]</span><span class="op" id="2389298">)</span><span class="op" id="2389299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389302">h</span><span class="op" id="2389303">.</span><span class="ident" id="2389304">Level</span>&nbsp;<span class="op" id="2389310">=</span>&nbsp;<span class="ident" id="2389312">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389324">h</span><span class="op" id="2389325">.</span><span class="ident" id="2389326">Type</span>&nbsp;<span class="op" id="2389331">=</span>&nbsp;<span class="ident" id="2389333">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389350">h</span><span class="op" id="2389351">.</span><span class="ident" id="2389352">SetLen</span><span class="op" id="2389358">(</span><span class="ident" id="2389359">CmsgLen</span><span class="op" id="2389366">(</span><span class="ident" id="2389367">SizeofUcred</span><span class="op" id="2389378">)</span><span class="op" id="2389379">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389382">*</span><span class="op" id="2389383">(</span><span class="op" id="2389384">(</span><span class="op" id="2389385">*</span><span class="ident" id="2389386">Ucred</span><span class="op" id="2389391">)</span><span class="op" id="2389392">(</span><span class="ident" id="2389393">cmsgData</span><span class="op" id="2389401">(</span><span class="ident" id="2389402">h</span><span class="op" id="2389403">)</span><span class="op" id="2389404">)</span><span class="op" id="2389405">)</span>&nbsp;<span class="op" id="2389407">=</span>&nbsp;<span class="op" id="2389409">*</span><span class="ident" id="2389410">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389417">return</span>&nbsp;<span class="ident" id="2389424">b</span><br>
<span class="lineno"></span><span class="op" id="2389426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2389429">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2389500">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2389568">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2389621">func</span>&nbsp;<span class="ident" id="2389626">ParseUnixCredentials</span><span class="op" id="2389646">(</span><span class="ident" id="2389647">m</span>&nbsp;<span class="op" id="2389649">*</span><span class="ident" id="2389650">SocketControlMessage</span><span class="op" id="2389670">)</span>&nbsp;<span class="op" id="2389672">(</span><span class="op" id="2389673">*</span><span class="ident" id="2389674">Ucred</span><span class="op" id="2389679">,</span>&nbsp;<span class="builtintype" id="2389681">error</span><span class="op" id="2389686">)</span>&nbsp;<span class="op" id="2389688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389691">if</span>&nbsp;<span class="ident" id="2389694">m</span><span class="op" id="2389695">.</span><span class="ident" id="2389696">Header</span><span class="op" id="2389702">.</span><span class="ident" id="2389703">Level</span>&nbsp;<span class="op" id="2389709">!=</span>&nbsp;<span class="ident" id="2389712">SOL_SOCKET</span>&nbsp;<span class="op" id="2389723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389727">return</span>&nbsp;<span class="ident" id="2389734">nil</span><span class="op" id="2389737">,</span>&nbsp;<span class="ident" id="2389739">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389750">if</span>&nbsp;<span class="ident" id="2389753">m</span><span class="op" id="2389754">.</span><span class="ident" id="2389755">Header</span><span class="op" id="2389761">.</span><span class="ident" id="2389762">Type</span>&nbsp;<span class="op" id="2389767">!=</span>&nbsp;<span class="ident" id="2389770">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2389786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389790">return</span>&nbsp;<span class="ident" id="2389797">nil</span><span class="op" id="2389800">,</span>&nbsp;<span class="ident" id="2389802">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389813">ucred</span>&nbsp;<span class="op" id="2389819">:=</span>&nbsp;<span class="op" id="2389822">*</span><span class="op" id="2389823">(</span><span class="op" id="2389824">*</span><span class="ident" id="2389825">Ucred</span><span class="op" id="2389830">)</span><span class="op" id="2389831">(</span><span class="ident" id="2389832">unsafe</span><span class="op" id="2389838">.</span><span class="ident" id="2389839">Pointer</span><span class="op" id="2389846">(</span><span class="op" id="2389847">&amp;</span><span class="ident" id="2389848">m</span><span class="op" id="2389849">.</span><span class="ident" id="2389850">Data</span><span class="op" id="2389854">[</span><span class="num" id="2389855">0</span><span class="op" id="2389856">]</span><span class="op" id="2389857">)</span><span class="op" id="2389858">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389861">return</span>&nbsp;<span class="op" id="2389868">&amp;</span><span class="ident" id="2389869">ucred</span><span class="op" id="2389874">,</span>&nbsp;<span class="ident" id="2389876">nil</span><br>
<span class="lineno"></span><span class="op" id="2389880">}</span>
</div>
</body>
</html>
