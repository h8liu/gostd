<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7769235">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7769290">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7769344">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7769395">package</span>&nbsp;<span class="ident" id="7769403">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7769410">import</span>&nbsp;<span class="op" id="7769417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7769420">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7769433">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7769439">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7769450">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7769460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7769463">func</span>&nbsp;<span class="ident" id="7769468">TestWriteHeapDumpNonempty</span><span class="op" id="7769493">(</span><span class="ident" id="7769494">t</span>&nbsp;<span class="op" id="7769496">*</span><span class="ident" id="7769497">testing</span><span class="op" id="7769504">.</span><span class="ident" id="7769505">T</span><span class="op" id="7769506">)</span>&nbsp;<span class="op" id="7769508">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769511">if</span>&nbsp;<span class="ident" id="7769514">runtime</span><span class="op" id="7769521">.</span><span class="ident" id="7769522">GOOS</span>&nbsp;<span class="op" id="7769527">==</span>&nbsp;<span class="string" id="7769530">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7769537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769541">t</span><span class="op" id="7769542">.</span><span class="ident" id="7769543">Skip</span><span class="op" id="7769547">(</span><span class="string" id="7769548">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="7769589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769595">f</span><span class="op" id="7769596">,</span>&nbsp;<span class="ident" id="7769598">err</span>&nbsp;<span class="op" id="7769602">:=</span>&nbsp;<span class="ident" id="7769605">ioutil</span><span class="op" id="7769611">.</span><span class="ident" id="7769612">TempFile</span><span class="op" id="7769620">(</span><span class="string" id="7769621">&#34;&#34;</span><span class="op" id="7769623">,</span>&nbsp;<span class="string" id="7769625">&#34;heapdumptest&#34;</span><span class="op" id="7769639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769642">if</span>&nbsp;<span class="ident" id="7769645">err</span>&nbsp;<span class="op" id="7769649">!=</span>&nbsp;<span class="ident" id="7769652">nil</span>&nbsp;<span class="op" id="7769656">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769660">t</span><span class="op" id="7769661">.</span><span class="ident" id="7769662">Fatalf</span><span class="op" id="7769668">(</span><span class="string" id="7769669">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7769690">,</span>&nbsp;<span class="ident" id="7769692">err</span><span class="op" id="7769695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769701">defer</span>&nbsp;<span class="ident" id="7769707">os</span><span class="op" id="7769709">.</span><span class="ident" id="7769710">Remove</span><span class="op" id="7769716">(</span><span class="ident" id="7769717">f</span><span class="op" id="7769718">.</span><span class="ident" id="7769719">Name</span><span class="op" id="7769723">(</span><span class="op" id="7769724">)</span><span class="op" id="7769725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769728">defer</span>&nbsp;<span class="ident" id="7769734">f</span><span class="op" id="7769735">.</span><span class="ident" id="7769736">Close</span><span class="op" id="7769741">(</span><span class="op" id="7769742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769745">WriteHeapDump</span><span class="op" id="7769758">(</span><span class="ident" id="7769759">f</span><span class="op" id="7769760">.</span><span class="ident" id="7769761">Fd</span><span class="op" id="7769763">(</span><span class="op" id="7769764">)</span><span class="op" id="7769765">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769768">fi</span><span class="op" id="7769770">,</span>&nbsp;<span class="ident" id="7769772">err</span>&nbsp;<span class="op" id="7769776">:=</span>&nbsp;<span class="ident" id="7769779">f</span><span class="op" id="7769780">.</span><span class="ident" id="7769781">Stat</span><span class="op" id="7769785">(</span><span class="op" id="7769786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769789">if</span>&nbsp;<span class="ident" id="7769792">err</span>&nbsp;<span class="op" id="7769796">!=</span>&nbsp;<span class="ident" id="7769799">nil</span>&nbsp;<span class="op" id="7769803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769807">t</span><span class="op" id="7769808">.</span><span class="ident" id="7769809">Fatalf</span><span class="op" id="7769815">(</span><span class="string" id="7769816">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7769833">,</span>&nbsp;<span class="ident" id="7769835">err</span><span class="op" id="7769838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769844">const</span>&nbsp;<span class="ident" id="7769850">minSize</span>&nbsp;<span class="op" id="7769858">=</span>&nbsp;<span class="num" id="7769860">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7769863">if</span>&nbsp;<span class="ident" id="7769866">size</span>&nbsp;<span class="op" id="7769871">:=</span>&nbsp;<span class="ident" id="7769874">fi</span><span class="op" id="7769876">.</span><span class="ident" id="7769877">Size</span><span class="op" id="7769881">(</span><span class="op" id="7769882">)</span><span class="op" id="7769883">;</span>&nbsp;<span class="ident" id="7769885">size</span>&nbsp;<span class="op" id="7769890">&lt;</span>&nbsp;<span class="ident" id="7769892">minSize</span>&nbsp;<span class="op" id="7769900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7769904">t</span><span class="op" id="7769905">.</span><span class="ident" id="7769906">Fatalf</span><span class="op" id="7769912">(</span><span class="string" id="7769913">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7769966">,</span>&nbsp;<span class="ident" id="7769968">size</span><span class="op" id="7769972">,</span>&nbsp;<span class="ident" id="7769974">minSize</span><span class="op" id="7769981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7769984">}</span><br>
<span class="lineno"></span><span class="op" id="7769986">}</span>
</div>
</body>
</html>
