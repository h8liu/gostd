<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html" class="current">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8060625">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8060680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8060734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8060785">package</span>&nbsp;<span class="ident" id="8060793">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8060798">import</span>&nbsp;<span class="string" id="8060805">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8060813">type</span>&nbsp;<span class="ident" id="8060818">streamListener</span>&nbsp;<span class="keyword" id="8060833">struct</span>&nbsp;<span class="op" id="8060840">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060843">net</span><span class="op" id="8060846">,</span>&nbsp;<span class="ident" id="8060848">addr</span>&nbsp;<span class="builtintype" id="8060853">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060861">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060871">Listener</span><br>
<span class="lineno"></span><span class="op" id="8060880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8060883">type</span>&nbsp;<span class="ident" id="8060888">dualStackServer</span>&nbsp;<span class="keyword" id="8060904">struct</span>&nbsp;<span class="op" id="8060911">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060914">lnmu</span>&nbsp;<span class="ident" id="8060919">sync</span><span class="op" id="8060923">.</span><span class="ident" id="8060924">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060933">lns</span>&nbsp;&nbsp;<span class="op" id="8060938">[</span><span class="op" id="8060939">]</span><span class="ident" id="8060940">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060956">port</span>&nbsp;<span class="builtintype" id="8060961">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060970">cmu</span>&nbsp;<span class="ident" id="8060974">sync</span><span class="op" id="8060978">.</span><span class="ident" id="8060979">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060988">cs</span>&nbsp;&nbsp;<span class="op" id="8060992">[</span><span class="op" id="8060993">]</span><span class="ident" id="8060994">Conn</span>&nbsp;<span class="comment" id="8060999">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="8061051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061054">func</span>&nbsp;<span class="op" id="8061059">(</span><span class="ident" id="8061060">dss</span>&nbsp;<span class="op" id="8061064">*</span><span class="ident" id="8061065">dualStackServer</span><span class="op" id="8061080">)</span>&nbsp;<span class="ident" id="8061082">buildup</span><span class="op" id="8061089">(</span><span class="ident" id="8061090">server</span>&nbsp;<span class="keyword" id="8061097">func</span><span class="op" id="8061101">(</span><span class="op" id="8061102">*</span><span class="ident" id="8061103">dualStackServer</span><span class="op" id="8061118">,</span>&nbsp;<span class="ident" id="8061120">Listener</span><span class="op" id="8061128">)</span><span class="op" id="8061129">)</span>&nbsp;<span class="builtintype" id="8061131">error</span>&nbsp;<span class="op" id="8061137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061140">for</span>&nbsp;<span class="ident" id="8061144">i</span>&nbsp;<span class="op" id="8061146">:=</span>&nbsp;<span class="keyword" id="8061149">range</span>&nbsp;<span class="ident" id="8061155">dss</span><span class="op" id="8061158">.</span><span class="ident" id="8061159">lns</span>&nbsp;<span class="op" id="8061163">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061167">go</span>&nbsp;<span class="ident" id="8061170">server</span><span class="op" id="8061176">(</span><span class="ident" id="8061177">dss</span><span class="op" id="8061180">,</span>&nbsp;<span class="ident" id="8061182">dss</span><span class="op" id="8061185">.</span><span class="ident" id="8061186">lns</span><span class="op" id="8061189">[</span><span class="ident" id="8061190">i</span><span class="op" id="8061191">]</span><span class="op" id="8061192">.</span><span class="ident" id="8061193">ln</span><span class="op" id="8061195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061201">return</span>&nbsp;<span class="ident" id="8061208">nil</span><br>
<span class="lineno"></span><span class="op" id="8061212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8061215">func</span>&nbsp;<span class="op" id="8061220">(</span><span class="ident" id="8061221">dss</span>&nbsp;<span class="op" id="8061225">*</span><span class="ident" id="8061226">dualStackServer</span><span class="op" id="8061241">)</span>&nbsp;<span class="ident" id="8061243">putConn</span><span class="op" id="8061250">(</span><span class="ident" id="8061251">c</span>&nbsp;<span class="ident" id="8061253">Conn</span><span class="op" id="8061257">)</span>&nbsp;<span class="builtintype" id="8061259">error</span>&nbsp;<span class="op" id="8061265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061268">dss</span><span class="op" id="8061271">.</span><span class="ident" id="8061272">cmu</span><span class="op" id="8061275">.</span><span class="ident" id="8061276">Lock</span><span class="op" id="8061280">(</span><span class="op" id="8061281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061284">dss</span><span class="op" id="8061287">.</span><span class="ident" id="8061288">cs</span>&nbsp;<span class="op" id="8061291">=</span>&nbsp;<span class="builtinfunc" id="8061293">append</span><span class="op" id="8061299">(</span><span class="ident" id="8061300">dss</span><span class="op" id="8061303">.</span><span class="ident" id="8061304">cs</span><span class="op" id="8061306">,</span>&nbsp;<span class="ident" id="8061308">c</span><span class="op" id="8061309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061312">dss</span><span class="op" id="8061315">.</span><span class="ident" id="8061316">cmu</span><span class="op" id="8061319">.</span><span class="ident" id="8061320">Unlock</span><span class="op" id="8061326">(</span><span class="op" id="8061327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061330">return</span>&nbsp;<span class="ident" id="8061337">nil</span><br>
<span class="lineno">35</span><span class="op" id="8061341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061344">func</span>&nbsp;<span class="op" id="8061349">(</span><span class="ident" id="8061350">dss</span>&nbsp;<span class="op" id="8061354">*</span><span class="ident" id="8061355">dualStackServer</span><span class="op" id="8061370">)</span>&nbsp;<span class="ident" id="8061372">teardownNetwork</span><span class="op" id="8061387">(</span><span class="ident" id="8061388">net</span>&nbsp;<span class="builtintype" id="8061392">string</span><span class="op" id="8061398">)</span>&nbsp;<span class="builtintype" id="8061400">error</span>&nbsp;<span class="op" id="8061406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061409">dss</span><span class="op" id="8061412">.</span><span class="ident" id="8061413">lnmu</span><span class="op" id="8061417">.</span><span class="ident" id="8061418">Lock</span><span class="op" id="8061422">(</span><span class="op" id="8061423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061426">for</span>&nbsp;<span class="ident" id="8061430">i</span>&nbsp;<span class="op" id="8061432">:=</span>&nbsp;<span class="keyword" id="8061435">range</span>&nbsp;<span class="ident" id="8061441">dss</span><span class="op" id="8061444">.</span><span class="ident" id="8061445">lns</span>&nbsp;<span class="op" id="8061449">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061453">if</span>&nbsp;<span class="ident" id="8061456">net</span>&nbsp;<span class="op" id="8061460">==</span>&nbsp;<span class="ident" id="8061463">dss</span><span class="op" id="8061466">.</span><span class="ident" id="8061467">lns</span><span class="op" id="8061470">[</span><span class="ident" id="8061471">i</span><span class="op" id="8061472">]</span><span class="op" id="8061473">.</span><span class="ident" id="8061474">net</span>&nbsp;<span class="op" id="8061478">&amp;&amp;</span>&nbsp;<span class="ident" id="8061481">dss</span><span class="op" id="8061484">.</span><span class="ident" id="8061485">lns</span><span class="op" id="8061488">[</span><span class="ident" id="8061489">i</span><span class="op" id="8061490">]</span><span class="op" id="8061491">.</span><span class="ident" id="8061492">ln</span>&nbsp;<span class="op" id="8061495">!=</span>&nbsp;<span class="ident" id="8061498">nil</span>&nbsp;<span class="op" id="8061502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061507">dss</span><span class="op" id="8061510">.</span><span class="ident" id="8061511">lns</span><span class="op" id="8061514">[</span><span class="ident" id="8061515">i</span><span class="op" id="8061516">]</span><span class="op" id="8061517">.</span><span class="ident" id="8061518">ln</span><span class="op" id="8061520">.</span><span class="ident" id="8061521">Close</span><span class="op" id="8061526">(</span><span class="op" id="8061527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061532">dss</span><span class="op" id="8061535">.</span><span class="ident" id="8061536">lns</span><span class="op" id="8061539">[</span><span class="ident" id="8061540">i</span><span class="op" id="8061541">]</span><span class="op" id="8061542">.</span><span class="ident" id="8061543">ln</span>&nbsp;<span class="op" id="8061546">=</span>&nbsp;<span class="ident" id="8061548">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061557">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061560">dss</span><span class="op" id="8061563">.</span><span class="ident" id="8061564">lnmu</span><span class="op" id="8061568">.</span><span class="ident" id="8061569">Unlock</span><span class="op" id="8061575">(</span><span class="op" id="8061576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061579">return</span>&nbsp;<span class="ident" id="8061586">nil</span><br>
<span class="lineno"></span><span class="op" id="8061590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061593">func</span>&nbsp;<span class="op" id="8061598">(</span><span class="ident" id="8061599">dss</span>&nbsp;<span class="op" id="8061603">*</span><span class="ident" id="8061604">dualStackServer</span><span class="op" id="8061619">)</span>&nbsp;<span class="ident" id="8061621">teardown</span><span class="op" id="8061629">(</span><span class="op" id="8061630">)</span>&nbsp;<span class="builtintype" id="8061632">error</span>&nbsp;<span class="op" id="8061638">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061641">dss</span><span class="op" id="8061644">.</span><span class="ident" id="8061645">lnmu</span><span class="op" id="8061649">.</span><span class="ident" id="8061650">Lock</span><span class="op" id="8061654">(</span><span class="op" id="8061655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061658">for</span>&nbsp;<span class="ident" id="8061662">i</span>&nbsp;<span class="op" id="8061664">:=</span>&nbsp;<span class="keyword" id="8061667">range</span>&nbsp;<span class="ident" id="8061673">dss</span><span class="op" id="8061676">.</span><span class="ident" id="8061677">lns</span>&nbsp;<span class="op" id="8061681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061685">if</span>&nbsp;<span class="ident" id="8061688">dss</span><span class="op" id="8061691">.</span><span class="ident" id="8061692">lns</span><span class="op" id="8061695">[</span><span class="ident" id="8061696">i</span><span class="op" id="8061697">]</span><span class="op" id="8061698">.</span><span class="ident" id="8061699">ln</span>&nbsp;<span class="op" id="8061702">!=</span>&nbsp;<span class="ident" id="8061705">nil</span>&nbsp;<span class="op" id="8061709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061714">dss</span><span class="op" id="8061717">.</span><span class="ident" id="8061718">lns</span><span class="op" id="8061721">[</span><span class="ident" id="8061722">i</span><span class="op" id="8061723">]</span><span class="op" id="8061724">.</span><span class="ident" id="8061725">ln</span><span class="op" id="8061727">.</span><span class="ident" id="8061728">Close</span><span class="op" id="8061733">(</span><span class="op" id="8061734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061738">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061744">dss</span><span class="op" id="8061747">.</span><span class="ident" id="8061748">lnmu</span><span class="op" id="8061752">.</span><span class="ident" id="8061753">Unlock</span><span class="op" id="8061759">(</span><span class="op" id="8061760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061763">dss</span><span class="op" id="8061766">.</span><span class="ident" id="8061767">cmu</span><span class="op" id="8061770">.</span><span class="ident" id="8061771">Lock</span><span class="op" id="8061775">(</span><span class="op" id="8061776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061779">for</span>&nbsp;<span class="ident" id="8061783">_</span><span class="op" id="8061784">,</span>&nbsp;<span class="ident" id="8061786">c</span>&nbsp;<span class="op" id="8061788">:=</span>&nbsp;<span class="keyword" id="8061791">range</span>&nbsp;<span class="ident" id="8061797">dss</span><span class="op" id="8061800">.</span><span class="ident" id="8061801">cs</span>&nbsp;<span class="op" id="8061804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061808">c</span><span class="op" id="8061809">.</span><span class="ident" id="8061810">Close</span><span class="op" id="8061815">(</span><span class="op" id="8061816">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061822">dss</span><span class="op" id="8061825">.</span><span class="ident" id="8061826">cmu</span><span class="op" id="8061829">.</span><span class="ident" id="8061830">Unlock</span><span class="op" id="8061836">(</span><span class="op" id="8061837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061840">return</span>&nbsp;<span class="ident" id="8061847">nil</span><br>
<span class="lineno"></span><span class="op" id="8061851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8061854">func</span>&nbsp;<span class="ident" id="8061859">newDualStackServer</span><span class="op" id="8061877">(</span><span class="ident" id="8061878">lns</span>&nbsp;<span class="op" id="8061882">[</span><span class="op" id="8061883">]</span><span class="ident" id="8061884">streamListener</span><span class="op" id="8061898">)</span>&nbsp;<span class="op" id="8061900">(</span><span class="op" id="8061901">*</span><span class="ident" id="8061902">dualStackServer</span><span class="op" id="8061917">,</span>&nbsp;<span class="builtintype" id="8061919">error</span><span class="op" id="8061924">)</span>&nbsp;<span class="op" id="8061926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061929">dss</span>&nbsp;<span class="op" id="8061933">:=</span>&nbsp;<span class="op" id="8061936">&amp;</span><span class="ident" id="8061937">dualStackServer</span><span class="op" id="8061952">{</span><span class="ident" id="8061953">lns</span><span class="op" id="8061956">:</span>&nbsp;<span class="ident" id="8061958">lns</span><span class="op" id="8061961">,</span>&nbsp;<span class="ident" id="8061963">port</span><span class="op" id="8061967">:</span>&nbsp;<span class="string" id="8061969">&#34;0&#34;</span><span class="op" id="8061972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061975">for</span>&nbsp;<span class="ident" id="8061979">i</span>&nbsp;<span class="op" id="8061981">:=</span>&nbsp;<span class="keyword" id="8061984">range</span>&nbsp;<span class="ident" id="8061990">dss</span><span class="op" id="8061993">.</span><span class="ident" id="8061994">lns</span>&nbsp;<span class="op" id="8061998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8062002">ln</span><span class="op" id="8062004">,</span>&nbsp;<span class="ident" id="8062006">err</span>&nbsp;<span class="op" id="8062010">:=</span>&nbsp;<span class="ident" id="8062013">Listen</span><span class="op" id="8062019">(</span><span class="ident" id="8062020">dss</span><span class="op" id="8062023">.</span><span class="ident" id="8062024">lns</span><span class="op" id="8062027">[</span><span class="ident" id="8062028">i</span><span class="op" id="8062029">]</span><span class="op" id="8062030">.</span><span class="ident" id="8062031">net</span><span class="op" id="8062034">,</span>&nbsp;<span class="ident" id="8062036">dss</span><span class="op" id="8062039">.</span><span class="ident" id="8062040">lns</span><span class="op" id="8062043">[</span><span class="ident" id="8062044">i</span><span class="op" id="8062045">]</span><span class="op" id="8062046">.</span><span class="ident" id="8062047">addr</span><span class="op" id="8062051">+</span><span class="string" id="8062052">&#34;:&#34;</span><span class="op" id="8062055">+</span><span class="ident" id="8062056">dss</span><span class="op" id="8062059">.</span><span class="ident" id="8062060">port</span><span class="op" id="8062064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062068">if</span>&nbsp;<span class="ident" id="8062071">err</span>&nbsp;<span class="op" id="8062075">!=</span>&nbsp;<span class="ident" id="8062078">nil</span>&nbsp;<span class="op" id="8062082">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8062087">dss</span><span class="op" id="8062090">.</span><span class="ident" id="8062091">teardown</span><span class="op" id="8062099">(</span><span class="op" id="8062100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062105">return</span>&nbsp;<span class="ident" id="8062112">nil</span><span class="op" id="8062115">,</span>&nbsp;<span class="ident" id="8062117">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8062123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8062127">dss</span><span class="op" id="8062130">.</span><span class="ident" id="8062131">lns</span><span class="op" id="8062134">[</span><span class="ident" id="8062135">i</span><span class="op" id="8062136">]</span><span class="op" id="8062137">.</span><span class="ident" id="8062138">ln</span>&nbsp;<span class="op" id="8062141">=</span>&nbsp;<span class="ident" id="8062143">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062148">if</span>&nbsp;<span class="ident" id="8062151">dss</span><span class="op" id="8062154">.</span><span class="ident" id="8062155">port</span>&nbsp;<span class="op" id="8062160">==</span>&nbsp;<span class="string" id="8062163">&#34;0&#34;</span>&nbsp;<span class="op" id="8062167">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062172">if</span>&nbsp;<span class="ident" id="8062175">_</span><span class="op" id="8062176">,</span>&nbsp;<span class="ident" id="8062178">dss</span><span class="op" id="8062181">.</span><span class="ident" id="8062182">port</span><span class="op" id="8062186">,</span>&nbsp;<span class="ident" id="8062188">err</span>&nbsp;<span class="op" id="8062192">=</span>&nbsp;<span class="ident" id="8062194">SplitHostPort</span><span class="op" id="8062207">(</span><span class="ident" id="8062208">ln</span><span class="op" id="8062210">.</span><span class="ident" id="8062211">Addr</span><span class="op" id="8062215">(</span><span class="op" id="8062216">)</span><span class="op" id="8062217">.</span><span class="ident" id="8062218">String</span><span class="op" id="8062224">(</span><span class="op" id="8062225">)</span><span class="op" id="8062226">)</span><span class="op" id="8062227">;</span>&nbsp;<span class="ident" id="8062229">err</span>&nbsp;<span class="op" id="8062233">!=</span>&nbsp;<span class="ident" id="8062236">nil</span>&nbsp;<span class="op" id="8062240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8062246">dss</span><span class="op" id="8062249">.</span><span class="ident" id="8062250">teardown</span><span class="op" id="8062258">(</span><span class="op" id="8062259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062265">return</span>&nbsp;<span class="ident" id="8062272">nil</span><span class="op" id="8062275">,</span>&nbsp;<span class="ident" id="8062277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8062284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8062288">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8062291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8062294">return</span>&nbsp;<span class="ident" id="8062301">dss</span><span class="op" id="8062304">,</span>&nbsp;<span class="ident" id="8062306">nil</span><br>
<span class="lineno"></span><span class="op" id="8062310">}</span>
</div>
</body>
</html>
