<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1695852">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1695907">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1695961">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1696012">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;runtime&nbsp;support&nbsp;for&nbsp;signal&nbsp;handling.</span><br>
<span class="lineno"></span><span class="comment" id="1696073">//</span><br>
<span class="lineno"></span><span class="comment" id="1696076">//&nbsp;Most&nbsp;synchronization&nbsp;primitives&nbsp;are&nbsp;not&nbsp;available&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="1696134">//&nbsp;the&nbsp;signal&nbsp;handler&nbsp;(it&nbsp;cannot&nbsp;block,&nbsp;allocate&nbsp;memory,&nbsp;or&nbsp;use&nbsp;locks)</span><br>
<span class="lineno"></span><span class="comment" id="1696205">//&nbsp;so&nbsp;the&nbsp;handler&nbsp;communicates&nbsp;with&nbsp;a&nbsp;processing&nbsp;goroutine</span><br>
<span class="lineno">10</span><span class="comment" id="1696264">//&nbsp;via&nbsp;struct&nbsp;sig,&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="1696290">//</span><br>
<span class="lineno"></span><span class="comment" id="1696293">//&nbsp;sigsend&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;signal&nbsp;handler&nbsp;to&nbsp;queue&nbsp;a&nbsp;new&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1696359">//&nbsp;signal_recv&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;Go&nbsp;program&nbsp;to&nbsp;receive&nbsp;a&nbsp;newly&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno"></span><span class="comment" id="1696436">//&nbsp;Synchronization&nbsp;between&nbsp;sigsend&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;sig.state</span><br>
<span class="lineno">15</span><span class="comment" id="1696513">//&nbsp;variable.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;3&nbsp;states:&nbsp;sigIdle,&nbsp;sigReceiving&nbsp;and&nbsp;sigSending.</span><br>
<span class="lineno"></span><span class="comment" id="1696588">//&nbsp;sigReceiving&nbsp;means&nbsp;that&nbsp;signal_recv&nbsp;is&nbsp;blocked&nbsp;on&nbsp;sig.Note&nbsp;and&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="1696667">//&nbsp;new&nbsp;pending&nbsp;signals.</span><br>
<span class="lineno"></span><span class="comment" id="1696691">//&nbsp;sigSending&nbsp;means&nbsp;that&nbsp;sig.mask&nbsp;*may*&nbsp;contain&nbsp;new&nbsp;pending&nbsp;signals,</span><br>
<span class="lineno"></span><span class="comment" id="1696760">//&nbsp;signal_recv&nbsp;can&#39;t&nbsp;be&nbsp;blocked&nbsp;in&nbsp;this&nbsp;state.</span><br>
<span class="lineno">20</span><span class="comment" id="1696807">//&nbsp;sigIdle&nbsp;means&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;new&nbsp;pending&nbsp;signals&nbsp;and&nbsp;signal_recv&nbsp;is&nbsp;not&nbsp;blocked.</span><br>
<span class="lineno"></span><span class="comment" id="1696894">//&nbsp;Transitions&nbsp;between&nbsp;states&nbsp;are&nbsp;done&nbsp;atomically&nbsp;with&nbsp;CAS.</span><br>
<span class="lineno"></span><span class="comment" id="1696954">//&nbsp;When&nbsp;signal_recv&nbsp;is&nbsp;unblocked,&nbsp;it&nbsp;resets&nbsp;sig.Note&nbsp;and&nbsp;rechecks&nbsp;sig.mask.</span><br>
<span class="lineno"></span><span class="comment" id="1697030">//&nbsp;If&nbsp;several&nbsp;sigsends&nbsp;and&nbsp;signal_recv&nbsp;execute&nbsp;concurrently,&nbsp;it&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1697106">//&nbsp;unnecessary&nbsp;rechecks&nbsp;of&nbsp;sig.mask,&nbsp;but&nbsp;it&nbsp;cannot&nbsp;lead&nbsp;to&nbsp;missed&nbsp;signals</span><br>
<span class="lineno">25</span><span class="comment" id="1697180">//&nbsp;nor&nbsp;deadlocks.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1697199">package</span>&nbsp;<span class="ident" id="1697207">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1697216">import</span>&nbsp;<span class="string" id="1697223">&#34;unsafe&#34;</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1697233">var</span>&nbsp;<span class="ident" id="1697237">sig</span>&nbsp;<span class="keyword" id="1697241">struct</span>&nbsp;<span class="op" id="1697248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697251">note</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1697258">note</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697264">mask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1697271">[</span><span class="op" id="1697272">(</span><span class="ident" id="1697273">_NSIG</span>&nbsp;<span class="op" id="1697279">+</span>&nbsp;<span class="num" id="1697281">31</span><span class="op" id="1697283">)</span>&nbsp;<span class="op" id="1697285">/</span>&nbsp;<span class="num" id="1697287">32</span><span class="op" id="1697289">]</span><span class="builtintype" id="1697290">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697298">wanted</span>&nbsp;<span class="op" id="1697305">[</span><span class="op" id="1697306">(</span><span class="ident" id="1697307">_NSIG</span>&nbsp;<span class="op" id="1697313">+</span>&nbsp;<span class="num" id="1697315">31</span><span class="op" id="1697317">)</span>&nbsp;<span class="op" id="1697319">/</span>&nbsp;<span class="num" id="1697321">32</span><span class="op" id="1697323">]</span><span class="builtintype" id="1697324">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697332">recv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1697339">[</span><span class="op" id="1697340">(</span><span class="ident" id="1697341">_NSIG</span>&nbsp;<span class="op" id="1697347">+</span>&nbsp;<span class="num" id="1697349">31</span><span class="op" id="1697351">)</span>&nbsp;<span class="op" id="1697353">/</span>&nbsp;<span class="num" id="1697355">32</span><span class="op" id="1697357">]</span><span class="builtintype" id="1697358">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697366">state</span>&nbsp;&nbsp;<span class="builtintype" id="1697373">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697381">inuse</span>&nbsp;&nbsp;<span class="builtintype" id="1697388">bool</span><br>
<span class="lineno"></span><span class="op" id="1697393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1697396">const</span>&nbsp;<span class="op" id="1697402">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697405">sigIdle</span>&nbsp;<span class="op" id="1697413">=</span>&nbsp;<span class="ident" id="1697415">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697421">sigReceiving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697435">sigSending</span><br>
<span class="lineno"></span><span class="op" id="1697446">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1697449">//&nbsp;Called&nbsp;from&nbsp;sighandler&nbsp;to&nbsp;send&nbsp;a&nbsp;signal&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;signal&nbsp;handling&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1697532">//&nbsp;Reports&nbsp;whether&nbsp;the&nbsp;signal&nbsp;was&nbsp;sent.&nbsp;If&nbsp;not,&nbsp;the&nbsp;caller&nbsp;typically&nbsp;crashes&nbsp;the&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="1697622">func</span>&nbsp;<span class="ident" id="1697627">sigsend</span><span class="op" id="1697634">(</span><span class="ident" id="1697635">s</span>&nbsp;<span class="builtintype" id="1697637">int32</span><span class="op" id="1697642">)</span>&nbsp;<span class="builtintype" id="1697644">bool</span>&nbsp;<span class="op" id="1697649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697652">bit</span>&nbsp;<span class="op" id="1697656">:=</span>&nbsp;<span class="builtintype" id="1697659">uint32</span><span class="op" id="1697665">(</span><span class="num" id="1697666">1</span><span class="op" id="1697667">)</span>&nbsp;<span class="op" id="1697669">&lt;&lt;</span>&nbsp;<span class="builtintype" id="1697672">uint</span><span class="op" id="1697676">(</span><span class="ident" id="1697677">s</span><span class="op" id="1697678">&amp;</span><span class="num" id="1697679">31</span><span class="op" id="1697681">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697684">if</span>&nbsp;<span class="op" id="1697687">!</span><span class="ident" id="1697688">sig</span><span class="op" id="1697691">.</span><span class="ident" id="1697692">inuse</span>&nbsp;<span class="op" id="1697698">||</span>&nbsp;<span class="ident" id="1697701">s</span>&nbsp;<span class="op" id="1697703">&lt;</span>&nbsp;<span class="num" id="1697705">0</span>&nbsp;<span class="op" id="1697707">||</span>&nbsp;<span class="builtintype" id="1697710">int</span><span class="op" id="1697713">(</span><span class="ident" id="1697714">s</span><span class="op" id="1697715">)</span>&nbsp;<span class="op" id="1697717">&gt;=</span>&nbsp;<span class="num" id="1697720">32</span><span class="op" id="1697722">*</span><span class="builtinfunc" id="1697723">len</span><span class="op" id="1697726">(</span><span class="ident" id="1697727">sig</span><span class="op" id="1697730">.</span><span class="ident" id="1697731">wanted</span><span class="op" id="1697737">)</span>&nbsp;<span class="op" id="1697739">||</span>&nbsp;<span class="ident" id="1697742">sig</span><span class="op" id="1697745">.</span><span class="ident" id="1697746">wanted</span><span class="op" id="1697752">[</span><span class="ident" id="1697753">s</span><span class="op" id="1697754">/</span><span class="num" id="1697755">32</span><span class="op" id="1697757">]</span><span class="op" id="1697758">&amp;</span><span class="ident" id="1697759">bit</span>&nbsp;<span class="op" id="1697763">==</span>&nbsp;<span class="num" id="1697766">0</span>&nbsp;<span class="op" id="1697768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697772">return</span>&nbsp;<span class="ident" id="1697779">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1697786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697790">//&nbsp;Add&nbsp;signal&nbsp;to&nbsp;outgoing&nbsp;queue.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697824">for</span>&nbsp;<span class="op" id="1697828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1697832">mask</span>&nbsp;<span class="op" id="1697837">:=</span>&nbsp;<span class="ident" id="1697840">sig</span><span class="op" id="1697843">.</span><span class="ident" id="1697844">mask</span><span class="op" id="1697848">[</span><span class="ident" id="1697849">s</span><span class="op" id="1697850">/</span><span class="num" id="1697851">32</span><span class="op" id="1697853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697857">if</span>&nbsp;<span class="ident" id="1697860">mask</span><span class="op" id="1697864">&amp;</span><span class="ident" id="1697865">bit</span>&nbsp;<span class="op" id="1697869">!=</span>&nbsp;<span class="num" id="1697872">0</span>&nbsp;<span class="op" id="1697874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697879">return</span>&nbsp;<span class="ident" id="1697886">true</span>&nbsp;<span class="comment" id="1697891">//&nbsp;signal&nbsp;already&nbsp;in&nbsp;queue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1697920">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697924">if</span>&nbsp;<span class="ident" id="1697927">cas</span><span class="op" id="1697930">(</span><span class="op" id="1697931">&amp;</span><span class="ident" id="1697932">sig</span><span class="op" id="1697935">.</span><span class="ident" id="1697936">mask</span><span class="op" id="1697940">[</span><span class="ident" id="1697941">s</span><span class="op" id="1697942">/</span><span class="num" id="1697943">32</span><span class="op" id="1697945">]</span><span class="op" id="1697946">,</span>&nbsp;<span class="ident" id="1697948">mask</span><span class="op" id="1697952">,</span>&nbsp;<span class="ident" id="1697954">mask</span><span class="op" id="1697958">|</span><span class="ident" id="1697959">bit</span><span class="op" id="1697962">)</span>&nbsp;<span class="op" id="1697964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1697969">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1697977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1697980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1697984">//&nbsp;Notify&nbsp;receiver&nbsp;that&nbsp;queue&nbsp;has&nbsp;new&nbsp;bit.</span><br>
<span class="lineno"></span><span class="ident" id="1698027">Send</span><span class="op" id="1698031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698034">for</span>&nbsp;<span class="op" id="1698038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698042">switch</span>&nbsp;<span class="ident" id="1698049">atomicload</span><span class="op" id="1698059">(</span><span class="op" id="1698060">&amp;</span><span class="ident" id="1698061">sig</span><span class="op" id="1698064">.</span><span class="ident" id="1698065">state</span><span class="op" id="1698070">)</span>&nbsp;<span class="op" id="1698072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698076">default</span><span class="op" id="1698083">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698088">gothrow</span><span class="op" id="1698095">(</span><span class="string" id="1698096">&#34;sigsend:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1698125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698129">case</span>&nbsp;<span class="ident" id="1698134">sigIdle</span><span class="op" id="1698141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698146">if</span>&nbsp;<span class="ident" id="1698149">cas</span><span class="op" id="1698152">(</span><span class="op" id="1698153">&amp;</span><span class="ident" id="1698154">sig</span><span class="op" id="1698157">.</span><span class="ident" id="1698158">state</span><span class="op" id="1698163">,</span>&nbsp;<span class="ident" id="1698165">sigIdle</span><span class="op" id="1698172">,</span>&nbsp;<span class="ident" id="1698174">sigSending</span><span class="op" id="1698184">)</span>&nbsp;<span class="op" id="1698186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698192">break</span>&nbsp;<span class="ident" id="1698198">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698206">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698210">case</span>&nbsp;<span class="ident" id="1698215">sigSending</span><span class="op" id="1698225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698230">//&nbsp;notification&nbsp;already&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698265">break</span>&nbsp;<span class="ident" id="1698271">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698278">case</span>&nbsp;<span class="ident" id="1698283">sigReceiving</span><span class="op" id="1698295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698300">if</span>&nbsp;<span class="ident" id="1698303">cas</span><span class="op" id="1698306">(</span><span class="op" id="1698307">&amp;</span><span class="ident" id="1698308">sig</span><span class="op" id="1698311">.</span><span class="ident" id="1698312">state</span><span class="op" id="1698317">,</span>&nbsp;<span class="ident" id="1698319">sigReceiving</span><span class="op" id="1698331">,</span>&nbsp;<span class="ident" id="1698333">sigIdle</span><span class="op" id="1698340">)</span>&nbsp;<span class="op" id="1698342">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698348">notewakeup</span><span class="op" id="1698358">(</span><span class="op" id="1698359">&amp;</span><span class="ident" id="1698360">sig</span><span class="op" id="1698363">.</span><span class="ident" id="1698364">note</span><span class="op" id="1698368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698374">break</span>&nbsp;<span class="ident" id="1698380">Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698395">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698399">return</span>&nbsp;<span class="ident" id="1698406">true</span><br>
<span class="lineno"></span><span class="op" id="1698411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1698414">//&nbsp;Called&nbsp;to&nbsp;receive&nbsp;the&nbsp;next&nbsp;queued&nbsp;signal.</span><br>
<span class="lineno">90</span><span class="comment" id="1698459">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1698517">func</span>&nbsp;<span class="ident" id="1698522">signal_recv</span><span class="op" id="1698533">(</span><span class="op" id="1698534">)</span>&nbsp;<span class="builtintype" id="1698536">uint32</span>&nbsp;<span class="op" id="1698543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698546">for</span>&nbsp;<span class="op" id="1698550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698554">//&nbsp;Serve&nbsp;any&nbsp;signals&nbsp;from&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698594">for</span>&nbsp;<span class="ident" id="1698598">i</span>&nbsp;<span class="op" id="1698600">:=</span>&nbsp;<span class="builtintype" id="1698603">uint32</span><span class="op" id="1698609">(</span><span class="num" id="1698610">0</span><span class="op" id="1698611">)</span><span class="op" id="1698612">;</span>&nbsp;<span class="ident" id="1698614">i</span>&nbsp;<span class="op" id="1698616">&lt;</span>&nbsp;<span class="ident" id="1698618">_NSIG</span><span class="op" id="1698623">;</span>&nbsp;<span class="ident" id="1698625">i</span><span class="op" id="1698626">++</span>&nbsp;<span class="op" id="1698629">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698634">if</span>&nbsp;<span class="ident" id="1698637">sig</span><span class="op" id="1698640">.</span><span class="ident" id="1698641">recv</span><span class="op" id="1698645">[</span><span class="ident" id="1698646">i</span><span class="op" id="1698647">/</span><span class="num" id="1698648">32</span><span class="op" id="1698650">]</span><span class="op" id="1698651">&amp;</span><span class="op" id="1698652">(</span><span class="num" id="1698653">1</span><span class="op" id="1698654">&lt;&lt;</span><span class="op" id="1698656">(</span><span class="ident" id="1698657">i</span><span class="op" id="1698658">&amp;</span><span class="num" id="1698659">31</span><span class="op" id="1698661">)</span><span class="op" id="1698662">)</span>&nbsp;<span class="op" id="1698664">!=</span>&nbsp;<span class="num" id="1698667">0</span>&nbsp;<span class="op" id="1698669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698675">sig</span><span class="op" id="1698678">.</span><span class="ident" id="1698679">recv</span><span class="op" id="1698683">[</span><span class="ident" id="1698684">i</span><span class="op" id="1698685">/</span><span class="num" id="1698686">32</span><span class="op" id="1698688">]</span>&nbsp;<span class="op" id="1698690">&amp;^=</span>&nbsp;<span class="num" id="1698694">1</span>&nbsp;<span class="op" id="1698696">&lt;&lt;</span>&nbsp;<span class="op" id="1698699">(</span><span class="ident" id="1698700">i</span>&nbsp;<span class="op" id="1698702">&amp;</span>&nbsp;<span class="num" id="1698704">31</span><span class="op" id="1698706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698712">return</span>&nbsp;<span class="ident" id="1698719">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1698728">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1698733">//&nbsp;Wait&nbsp;for&nbsp;updates&nbsp;to&nbsp;be&nbsp;available&nbsp;from&nbsp;signal&nbsp;sender.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698790">Receive</span><span class="op" id="1698797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698801">for</span>&nbsp;<span class="op" id="1698805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698810">switch</span>&nbsp;<span class="ident" id="1698817">atomicload</span><span class="op" id="1698827">(</span><span class="op" id="1698828">&amp;</span><span class="ident" id="1698829">sig</span><span class="op" id="1698832">.</span><span class="ident" id="1698833">state</span><span class="op" id="1698838">)</span>&nbsp;<span class="op" id="1698840">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698845">default</span><span class="op" id="1698852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698858">gothrow</span><span class="op" id="1698865">(</span><span class="string" id="1698866">&#34;signal_recv:&nbsp;inconsistent&nbsp;state&#34;</span><span class="op" id="1698899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698904">case</span>&nbsp;<span class="ident" id="1698909">sigIdle</span><span class="op" id="1698916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1698922">if</span>&nbsp;<span class="ident" id="1698925">cas</span><span class="op" id="1698928">(</span><span class="op" id="1698929">&amp;</span><span class="ident" id="1698930">sig</span><span class="op" id="1698933">.</span><span class="ident" id="1698934">state</span><span class="op" id="1698939">,</span>&nbsp;<span class="ident" id="1698941">sigIdle</span><span class="op" id="1698948">,</span>&nbsp;<span class="ident" id="1698950">sigReceiving</span><span class="op" id="1698962">)</span>&nbsp;<span class="op" id="1698964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1698971">notetsleepg</span><span class="op" id="1698982">(</span><span class="op" id="1698983">&amp;</span><span class="ident" id="1698984">sig</span><span class="op" id="1698987">.</span><span class="ident" id="1698988">note</span><span class="op" id="1698992">,</span>&nbsp;<span class="op" id="1698994">-</span><span class="num" id="1698995">1</span><span class="op" id="1698996">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699003">noteclear</span><span class="op" id="1699012">(</span><span class="op" id="1699013">&amp;</span><span class="ident" id="1699014">sig</span><span class="op" id="1699017">.</span><span class="ident" id="1699018">note</span><span class="op" id="1699022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699029">break</span>&nbsp;<span class="ident" id="1699035">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699052">case</span>&nbsp;<span class="ident" id="1699057">sigSending</span><span class="op" id="1699067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699073">if</span>&nbsp;<span class="ident" id="1699076">cas</span><span class="op" id="1699079">(</span><span class="op" id="1699080">&amp;</span><span class="ident" id="1699081">sig</span><span class="op" id="1699084">.</span><span class="ident" id="1699085">state</span><span class="op" id="1699090">,</span>&nbsp;<span class="ident" id="1699092">sigSending</span><span class="op" id="1699102">,</span>&nbsp;<span class="ident" id="1699104">sigIdle</span><span class="op" id="1699111">)</span>&nbsp;<span class="op" id="1699113">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699120">break</span>&nbsp;<span class="ident" id="1699126">Receive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699152">//&nbsp;Incorporate&nbsp;updates&nbsp;from&nbsp;sender&nbsp;into&nbsp;local&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699206">for</span>&nbsp;<span class="ident" id="1699210">i</span>&nbsp;<span class="op" id="1699212">:=</span>&nbsp;<span class="keyword" id="1699215">range</span>&nbsp;<span class="ident" id="1699221">sig</span><span class="op" id="1699224">.</span><span class="ident" id="1699225">mask</span>&nbsp;<span class="op" id="1699230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699235">sig</span><span class="op" id="1699238">.</span><span class="ident" id="1699239">recv</span><span class="op" id="1699243">[</span><span class="ident" id="1699244">i</span><span class="op" id="1699245">]</span>&nbsp;<span class="op" id="1699247">=</span>&nbsp;<span class="ident" id="1699249">xchg</span><span class="op" id="1699253">(</span><span class="op" id="1699254">&amp;</span><span class="ident" id="1699255">sig</span><span class="op" id="1699258">.</span><span class="ident" id="1699259">mask</span><span class="op" id="1699263">[</span><span class="ident" id="1699264">i</span><span class="op" id="1699265">]</span><span class="op" id="1699266">,</span>&nbsp;<span class="num" id="1699268">0</span><span class="op" id="1699269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699276">}</span><br>
<span class="lineno">125</span><span class="op" id="1699278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1699281">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1699339">func</span>&nbsp;<span class="ident" id="1699344">signal_enable</span><span class="op" id="1699357">(</span><span class="ident" id="1699358">s</span>&nbsp;<span class="builtintype" id="1699360">uint32</span><span class="op" id="1699366">)</span>&nbsp;<span class="op" id="1699368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699371">if</span>&nbsp;<span class="op" id="1699374">!</span><span class="ident" id="1699375">sig</span><span class="op" id="1699378">.</span><span class="ident" id="1699379">inuse</span>&nbsp;<span class="op" id="1699385">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699389">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;signal_enable&nbsp;is&nbsp;for&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699436">//&nbsp;to&nbsp;use&nbsp;for&nbsp;initialization.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;pass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1699486">//&nbsp;signal&nbsp;information&nbsp;in&nbsp;m.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699516">sig</span><span class="op" id="1699519">.</span><span class="ident" id="1699520">inuse</span>&nbsp;<span class="op" id="1699526">=</span>&nbsp;<span class="ident" id="1699528">true</span>&nbsp;<span class="comment" id="1699533">//&nbsp;enable&nbsp;reception&nbsp;of&nbsp;signals;&nbsp;cannot&nbsp;disable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699582">noteclear</span><span class="op" id="1699591">(</span><span class="op" id="1699592">&amp;</span><span class="ident" id="1699593">sig</span><span class="op" id="1699596">.</span><span class="ident" id="1699597">note</span><span class="op" id="1699601">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699617">if</span>&nbsp;<span class="builtintype" id="1699620">int</span><span class="op" id="1699623">(</span><span class="ident" id="1699624">s</span><span class="op" id="1699625">)</span>&nbsp;<span class="op" id="1699627">&gt;=</span>&nbsp;<span class="builtinfunc" id="1699630">len</span><span class="op" id="1699633">(</span><span class="ident" id="1699634">sig</span><span class="op" id="1699637">.</span><span class="ident" id="1699638">wanted</span><span class="op" id="1699644">)</span><span class="op" id="1699645">*</span><span class="num" id="1699646">32</span>&nbsp;<span class="op" id="1699649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699653">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699664">sig</span><span class="op" id="1699667">.</span><span class="ident" id="1699668">wanted</span><span class="op" id="1699674">[</span><span class="ident" id="1699675">s</span><span class="op" id="1699676">/</span><span class="num" id="1699677">32</span><span class="op" id="1699679">]</span>&nbsp;<span class="op" id="1699681">|=</span>&nbsp;<span class="num" id="1699684">1</span>&nbsp;<span class="op" id="1699686">&lt;&lt;</span>&nbsp;<span class="op" id="1699689">(</span><span class="ident" id="1699690">s</span>&nbsp;<span class="op" id="1699692">&amp;</span>&nbsp;<span class="num" id="1699694">31</span><span class="op" id="1699696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699699">sigenable_go</span><span class="op" id="1699711">(</span><span class="ident" id="1699712">s</span><span class="op" id="1699713">)</span><br>
<span class="lineno"></span><span class="op" id="1699715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1699718">//&nbsp;Must&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="1699776">func</span>&nbsp;<span class="ident" id="1699781">signal_disable</span><span class="op" id="1699795">(</span><span class="ident" id="1699796">s</span>&nbsp;<span class="builtintype" id="1699798">uint32</span><span class="op" id="1699804">)</span>&nbsp;<span class="op" id="1699806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699809">if</span>&nbsp;<span class="builtintype" id="1699812">int</span><span class="op" id="1699815">(</span><span class="ident" id="1699816">s</span><span class="op" id="1699817">)</span>&nbsp;<span class="op" id="1699819">&gt;=</span>&nbsp;<span class="builtinfunc" id="1699822">len</span><span class="op" id="1699825">(</span><span class="ident" id="1699826">sig</span><span class="op" id="1699829">.</span><span class="ident" id="1699830">wanted</span><span class="op" id="1699836">)</span><span class="op" id="1699837">*</span><span class="num" id="1699838">32</span>&nbsp;<span class="op" id="1699841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1699845">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1699853">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699856">sig</span><span class="op" id="1699859">.</span><span class="ident" id="1699860">wanted</span><span class="op" id="1699866">[</span><span class="ident" id="1699867">s</span><span class="op" id="1699868">/</span><span class="num" id="1699869">32</span><span class="op" id="1699871">]</span>&nbsp;<span class="op" id="1699873">&amp;^=</span>&nbsp;<span class="num" id="1699877">1</span>&nbsp;<span class="op" id="1699879">&lt;&lt;</span>&nbsp;<span class="op" id="1699882">(</span><span class="ident" id="1699883">s</span>&nbsp;<span class="op" id="1699885">&amp;</span>&nbsp;<span class="num" id="1699887">31</span><span class="op" id="1699889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1699892">sigdisable_go</span><span class="op" id="1699905">(</span><span class="ident" id="1699906">s</span><span class="op" id="1699907">)</span><br>
<span class="lineno"></span><span class="op" id="1699909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1699912">//&nbsp;This&nbsp;runs&nbsp;on&nbsp;a&nbsp;foreign&nbsp;stack,&nbsp;without&nbsp;an&nbsp;m&nbsp;or&nbsp;a&nbsp;g.&nbsp;&nbsp;No&nbsp;stack&nbsp;split.</span><br>
<span class="lineno">155</span><span class="comment" id="1699983">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1699996">func</span>&nbsp;<span class="ident" id="1700001">badsignal</span><span class="op" id="1700010">(</span><span class="ident" id="1700011">sig</span>&nbsp;<span class="builtintype" id="1700015">uintptr</span><span class="op" id="1700022">)</span>&nbsp;<span class="op" id="1700024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700027">cgocallback</span><span class="op" id="1700038">(</span><span class="ident" id="1700039">unsafe</span><span class="op" id="1700045">.</span><span class="ident" id="1700046">Pointer</span><span class="op" id="1700053">(</span><span class="ident" id="1700054">funcPC</span><span class="op" id="1700060">(</span><span class="ident" id="1700061">sigsend</span><span class="op" id="1700068">)</span><span class="op" id="1700069">)</span><span class="op" id="1700070">,</span>&nbsp;<span class="ident" id="1700072">noescape</span><span class="op" id="1700080">(</span><span class="ident" id="1700081">unsafe</span><span class="op" id="1700087">.</span><span class="ident" id="1700088">Pointer</span><span class="op" id="1700095">(</span><span class="op" id="1700096">&amp;</span><span class="ident" id="1700097">sig</span><span class="op" id="1700100">)</span><span class="op" id="1700101">)</span><span class="op" id="1700102">,</span>&nbsp;<span class="ident" id="1700104">unsafe</span><span class="op" id="1700110">.</span><span class="ident" id="1700111">Sizeof</span><span class="op" id="1700117">(</span><span class="ident" id="1700118">sig</span><span class="op" id="1700121">)</span><span class="op" id="1700122">)</span><br>
<span class="lineno"></span><span class="op" id="1700124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1700127">func</span>&nbsp;<span class="ident" id="1700132">sigenable_m</span><span class="op" id="1700143">(</span><span class="op" id="1700144">)</span><br>
<span class="lineno"></span><span class="keyword" id="1700146">func</span>&nbsp;<span class="ident" id="1700151">sigdisable_m</span><span class="op" id="1700163">(</span><span class="op" id="1700164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1700167">func</span>&nbsp;<span class="ident" id="1700172">sigenable_go</span><span class="op" id="1700184">(</span><span class="ident" id="1700185">s</span>&nbsp;<span class="builtintype" id="1700187">uint32</span><span class="op" id="1700193">)</span>&nbsp;<span class="op" id="1700195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700198">g</span>&nbsp;<span class="op" id="1700200">:=</span>&nbsp;<span class="ident" id="1700203">getg</span><span class="op" id="1700207">(</span><span class="op" id="1700208">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700211">g</span><span class="op" id="1700212">.</span><span class="ident" id="1700213">m</span><span class="op" id="1700214">.</span><span class="ident" id="1700215">scalararg</span><span class="op" id="1700224">[</span><span class="num" id="1700225">0</span><span class="op" id="1700226">]</span>&nbsp;<span class="op" id="1700228">=</span>&nbsp;<span class="builtintype" id="1700230">uintptr</span><span class="op" id="1700237">(</span><span class="ident" id="1700238">s</span><span class="op" id="1700239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700242">onM</span><span class="op" id="1700245">(</span><span class="ident" id="1700246">sigenable_m</span><span class="op" id="1700257">)</span><br>
<span class="lineno"></span><span class="op" id="1700259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1700262">func</span>&nbsp;<span class="ident" id="1700267">sigdisable_go</span><span class="op" id="1700280">(</span><span class="ident" id="1700281">s</span>&nbsp;<span class="builtintype" id="1700283">uint32</span><span class="op" id="1700289">)</span>&nbsp;<span class="op" id="1700291">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700294">g</span>&nbsp;<span class="op" id="1700296">:=</span>&nbsp;<span class="ident" id="1700299">getg</span><span class="op" id="1700303">(</span><span class="op" id="1700304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700307">g</span><span class="op" id="1700308">.</span><span class="ident" id="1700309">m</span><span class="op" id="1700310">.</span><span class="ident" id="1700311">scalararg</span><span class="op" id="1700320">[</span><span class="num" id="1700321">0</span><span class="op" id="1700322">]</span>&nbsp;<span class="op" id="1700324">=</span>&nbsp;<span class="builtintype" id="1700326">uintptr</span><span class="op" id="1700333">(</span><span class="ident" id="1700334">s</span><span class="op" id="1700335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700338">onM</span><span class="op" id="1700341">(</span><span class="ident" id="1700342">sigdisable_m</span><span class="op" id="1700354">)</span><br>
<span class="lineno"></span><span class="op" id="1700356">}</span>
</div>
</body>
</html>
