<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5346452">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5346507">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5346561">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5346612">package</span>&nbsp;<span class="ident" id="5346620">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5346628">import</span>&nbsp;<span class="op" id="5346635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5346638">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5346647">&#34;strconv&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5346658">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5346668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5346671">//&nbsp;Compiled&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="5346692">//&nbsp;May&nbsp;not&nbsp;belong&nbsp;in&nbsp;this&nbsp;package,&nbsp;but&nbsp;convenient&nbsp;for&nbsp;now.</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5346752">//&nbsp;A&nbsp;Prog&nbsp;is&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="5346804">type</span>&nbsp;<span class="ident" id="5346809">Prog</span>&nbsp;<span class="keyword" id="5346814">struct</span>&nbsp;<span class="op" id="5346821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5346824">Inst</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5346831">[</span><span class="op" id="5346832">]</span><span class="ident" id="5346833">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5346839">Start</span>&nbsp;&nbsp;<span class="builtintype" id="5346846">int</span>&nbsp;<span class="comment" id="5346850">//&nbsp;index&nbsp;of&nbsp;start&nbsp;instruction</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5346881">NumCap</span>&nbsp;<span class="builtintype" id="5346888">int</span>&nbsp;<span class="comment" id="5346892">//&nbsp;number&nbsp;of&nbsp;InstCapture&nbsp;insts&nbsp;in&nbsp;re</span><br>
<span class="lineno"></span><span class="op" id="5346929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5346932">//&nbsp;An&nbsp;InstOp&nbsp;is&nbsp;an&nbsp;instruction&nbsp;opcode.</span><br>
<span class="lineno"></span><span class="keyword" id="5346971">type</span>&nbsp;<span class="ident" id="5346976">InstOp</span>&nbsp;<span class="builtintype" id="5346983">uint8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5346990">const</span>&nbsp;<span class="op" id="5346996">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5346999">InstAlt</span>&nbsp;<span class="ident" id="5347007">InstOp</span>&nbsp;<span class="op" id="5347014">=</span>&nbsp;<span class="ident" id="5347016">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347022">InstAltMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347036">InstCapture</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347049">InstEmptyWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347065">InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347076">InstFail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347086">InstNop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347095">InstRune</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347105">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347116">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347129">InstRuneAnyNotNL</span><br>
<span class="lineno"></span><span class="op" id="5347146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5347149">var</span>&nbsp;<span class="ident" id="5347153">instOpNames</span>&nbsp;<span class="op" id="5347165">=</span>&nbsp;<span class="op" id="5347167">[</span><span class="op" id="5347168">]</span><span class="builtintype" id="5347169">string</span><span class="op" id="5347175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347178">&#34;InstAlt&#34;</span><span class="op" id="5347187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347190">&#34;InstAltMatch&#34;</span><span class="op" id="5347204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347207">&#34;InstCapture&#34;</span><span class="op" id="5347220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347223">&#34;InstEmptyWidth&#34;</span><span class="op" id="5347239">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347242">&#34;InstMatch&#34;</span><span class="op" id="5347253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347256">&#34;InstFail&#34;</span><span class="op" id="5347266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347269">&#34;InstNop&#34;</span><span class="op" id="5347278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347281">&#34;InstRune&#34;</span><span class="op" id="5347291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347294">&#34;InstRune1&#34;</span><span class="op" id="5347305">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347308">&#34;InstRuneAny&#34;</span><span class="op" id="5347321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5347324">&#34;InstRuneAnyNotNL&#34;</span><span class="op" id="5347342">,</span><br>
<span class="lineno"></span><span class="op" id="5347344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5347347">func</span>&nbsp;<span class="op" id="5347352">(</span><span class="ident" id="5347353">i</span>&nbsp;<span class="ident" id="5347355">InstOp</span><span class="op" id="5347361">)</span>&nbsp;<span class="ident" id="5347363">String</span><span class="op" id="5347369">(</span><span class="op" id="5347370">)</span>&nbsp;<span class="builtintype" id="5347372">string</span>&nbsp;<span class="op" id="5347379">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5347382">if</span>&nbsp;<span class="builtintype" id="5347385">uint</span><span class="op" id="5347389">(</span><span class="ident" id="5347390">i</span><span class="op" id="5347391">)</span>&nbsp;<span class="op" id="5347393">&gt;=</span>&nbsp;<span class="builtintype" id="5347396">uint</span><span class="op" id="5347400">(</span><span class="builtinfunc" id="5347401">len</span><span class="op" id="5347404">(</span><span class="ident" id="5347405">instOpNames</span><span class="op" id="5347416">)</span><span class="op" id="5347417">)</span>&nbsp;<span class="op" id="5347419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5347423">return</span>&nbsp;<span class="string" id="5347430">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5347434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5347437">return</span>&nbsp;<span class="ident" id="5347444">instOpNames</span><span class="op" id="5347455">[</span><span class="ident" id="5347456">i</span><span class="op" id="5347457">]</span><br>
<span class="lineno"></span><span class="op" id="5347459">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5347462">//&nbsp;An&nbsp;EmptyOp&nbsp;specifies&nbsp;a&nbsp;kind&nbsp;or&nbsp;mixture&nbsp;of&nbsp;zero-width&nbsp;assertions.</span><br>
<span class="lineno"></span><span class="keyword" id="5347530">type</span>&nbsp;<span class="ident" id="5347535">EmptyOp</span>&nbsp;<span class="builtintype" id="5347543">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5347550">const</span>&nbsp;<span class="op" id="5347556">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347559">EmptyBeginLine</span>&nbsp;<span class="ident" id="5347574">EmptyOp</span>&nbsp;<span class="op" id="5347582">=</span>&nbsp;<span class="num" id="5347584">1</span>&nbsp;<span class="op" id="5347586">&lt;&lt;</span>&nbsp;<span class="ident" id="5347589">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347595">EmptyEndLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347609">EmptyBeginText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347625">EmptyEndText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347639">EmptyWordBoundary</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5347658">EmptyNoWordBoundary</span><br>
<span class="lineno"></span><span class="op" id="5347678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5347681">//&nbsp;EmptyOpContext&nbsp;returns&nbsp;the&nbsp;zero-width&nbsp;assertions</span><br>
<span class="lineno"></span><span class="comment" id="5347733">//&nbsp;satisfied&nbsp;at&nbsp;the&nbsp;position&nbsp;between&nbsp;the&nbsp;runes&nbsp;r1&nbsp;and&nbsp;r2.</span><br>
<span class="lineno">75</span><span class="comment" id="5347791">//&nbsp;Passing&nbsp;r1&nbsp;==&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;position&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5347842">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5347875">//&nbsp;Passing&nbsp;r2&nbsp;==&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;position&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5347926">//&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5347953">func</span>&nbsp;<span class="ident" id="5347958">EmptyOpContext</span><span class="op" id="5347972">(</span><span class="ident" id="5347973">r1</span><span class="op" id="5347975">,</span>&nbsp;<span class="ident" id="5347977">r2</span>&nbsp;<span class="builtintype" id="5347980">rune</span><span class="op" id="5347984">)</span>&nbsp;<span class="ident" id="5347986">EmptyOp</span>&nbsp;<span class="op" id="5347994">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5347997">var</span>&nbsp;<span class="ident" id="5348001">op</span>&nbsp;<span class="ident" id="5348004">EmptyOp</span>&nbsp;<span class="op" id="5348012">=</span>&nbsp;<span class="ident" id="5348014">EmptyNoWordBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348035">var</span>&nbsp;<span class="ident" id="5348039">boundary</span>&nbsp;<span class="builtintype" id="5348048">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348054">switch</span>&nbsp;<span class="op" id="5348061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348064">case</span>&nbsp;<span class="ident" id="5348069">IsWordChar</span><span class="op" id="5348079">(</span><span class="ident" id="5348080">r1</span><span class="op" id="5348082">)</span><span class="op" id="5348083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348087">boundary</span>&nbsp;<span class="op" id="5348096">=</span>&nbsp;<span class="num" id="5348098">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348101">case</span>&nbsp;<span class="ident" id="5348106">r1</span>&nbsp;<span class="op" id="5348109">==</span>&nbsp;<span class="string" id="5348112">&#39;\n&#39;</span><span class="op" id="5348116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348120">op</span>&nbsp;<span class="op" id="5348123">|=</span>&nbsp;<span class="ident" id="5348126">EmptyBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348142">case</span>&nbsp;<span class="ident" id="5348147">r1</span>&nbsp;<span class="op" id="5348150">&lt;</span>&nbsp;<span class="num" id="5348152">0</span><span class="op" id="5348153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348157">op</span>&nbsp;<span class="op" id="5348160">|=</span>&nbsp;<span class="ident" id="5348163">EmptyBeginText</span>&nbsp;<span class="op" id="5348178">|</span>&nbsp;<span class="ident" id="5348180">EmptyBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5348196">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348199">switch</span>&nbsp;<span class="op" id="5348206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348209">case</span>&nbsp;<span class="ident" id="5348214">IsWordChar</span><span class="op" id="5348224">(</span><span class="ident" id="5348225">r2</span><span class="op" id="5348227">)</span><span class="op" id="5348228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348232">boundary</span>&nbsp;<span class="op" id="5348241">^=</span>&nbsp;<span class="num" id="5348244">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348247">case</span>&nbsp;<span class="ident" id="5348252">r2</span>&nbsp;<span class="op" id="5348255">==</span>&nbsp;<span class="string" id="5348258">&#39;\n&#39;</span><span class="op" id="5348262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348266">op</span>&nbsp;<span class="op" id="5348269">|=</span>&nbsp;<span class="ident" id="5348272">EmptyEndLine</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348286">case</span>&nbsp;<span class="ident" id="5348291">r2</span>&nbsp;<span class="op" id="5348294">&lt;</span>&nbsp;<span class="num" id="5348296">0</span><span class="op" id="5348297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348301">op</span>&nbsp;<span class="op" id="5348304">|=</span>&nbsp;<span class="ident" id="5348307">EmptyEndText</span>&nbsp;<span class="op" id="5348320">|</span>&nbsp;<span class="ident" id="5348322">EmptyEndLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5348336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348339">if</span>&nbsp;<span class="ident" id="5348342">boundary</span>&nbsp;<span class="op" id="5348351">!=</span>&nbsp;<span class="num" id="5348354">0</span>&nbsp;<span class="op" id="5348356">{</span>&nbsp;<span class="comment" id="5348358">//&nbsp;IsWordChar(r1)&nbsp;!=&nbsp;IsWordChar(r2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348396">op</span>&nbsp;<span class="op" id="5348399">^=</span>&nbsp;<span class="op" id="5348402">(</span><span class="ident" id="5348403">EmptyWordBoundary</span>&nbsp;<span class="op" id="5348421">|</span>&nbsp;<span class="ident" id="5348423">EmptyNoWordBoundary</span><span class="op" id="5348442">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5348445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348448">return</span>&nbsp;<span class="ident" id="5348455">op</span><br>
<span class="lineno"></span><span class="op" id="5348458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5348461">//&nbsp;IsWordChar&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;consider&nbsp;a&nbsp;``word&nbsp;character&#39;&#39;</span><br>
<span class="lineno">105</span><span class="comment" id="5348526">//&nbsp;during&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;the&nbsp;\b&nbsp;and&nbsp;\B&nbsp;zero-width&nbsp;assertions.</span><br>
<span class="lineno"></span><span class="comment" id="5348591">//&nbsp;These&nbsp;assertions&nbsp;are&nbsp;ASCII-only:&nbsp;the&nbsp;word&nbsp;characters&nbsp;are&nbsp;[A-Za-z0-9_].</span><br>
<span class="lineno"></span><span class="keyword" id="5348665">func</span>&nbsp;<span class="ident" id="5348670">IsWordChar</span><span class="op" id="5348680">(</span><span class="ident" id="5348681">r</span>&nbsp;<span class="builtintype" id="5348683">rune</span><span class="op" id="5348687">)</span>&nbsp;<span class="builtintype" id="5348689">bool</span>&nbsp;<span class="op" id="5348694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5348697">return</span>&nbsp;<span class="string" id="5348704">&#39;A&#39;</span>&nbsp;<span class="op" id="5348708">&lt;=</span>&nbsp;<span class="ident" id="5348711">r</span>&nbsp;<span class="op" id="5348713">&amp;&amp;</span>&nbsp;<span class="ident" id="5348716">r</span>&nbsp;<span class="op" id="5348718">&lt;=</span>&nbsp;<span class="string" id="5348721">&#39;Z&#39;</span>&nbsp;<span class="op" id="5348725">||</span>&nbsp;<span class="string" id="5348728">&#39;a&#39;</span>&nbsp;<span class="op" id="5348732">&lt;=</span>&nbsp;<span class="ident" id="5348735">r</span>&nbsp;<span class="op" id="5348737">&amp;&amp;</span>&nbsp;<span class="ident" id="5348740">r</span>&nbsp;<span class="op" id="5348742">&lt;=</span>&nbsp;<span class="string" id="5348745">&#39;z&#39;</span>&nbsp;<span class="op" id="5348749">||</span>&nbsp;<span class="string" id="5348752">&#39;0&#39;</span>&nbsp;<span class="op" id="5348756">&lt;=</span>&nbsp;<span class="ident" id="5348759">r</span>&nbsp;<span class="op" id="5348761">&amp;&amp;</span>&nbsp;<span class="ident" id="5348764">r</span>&nbsp;<span class="op" id="5348766">&lt;=</span>&nbsp;<span class="string" id="5348769">&#39;9&#39;</span>&nbsp;<span class="op" id="5348773">||</span>&nbsp;<span class="ident" id="5348776">r</span>&nbsp;<span class="op" id="5348778">==</span>&nbsp;<span class="string" id="5348781">&#39;_&#39;</span><br>
<span class="lineno"></span><span class="op" id="5348785">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5348788">//&nbsp;An&nbsp;Inst&nbsp;is&nbsp;a&nbsp;single&nbsp;instruction&nbsp;in&nbsp;a&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="5348856">type</span>&nbsp;<span class="ident" id="5348861">Inst</span>&nbsp;<span class="keyword" id="5348866">struct</span>&nbsp;<span class="op" id="5348873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348876">Op</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5348881">InstOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348889">Out</span>&nbsp;&nbsp;<span class="builtintype" id="5348894">uint32</span>&nbsp;<span class="comment" id="5348901">//&nbsp;all&nbsp;but&nbsp;InstMatch,&nbsp;InstFail</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5348933">Arg</span>&nbsp;&nbsp;<span class="builtintype" id="5348938">uint32</span>&nbsp;<span class="comment" id="5348945">//&nbsp;InstAlt,&nbsp;InstAltMatch,&nbsp;InstCapture,&nbsp;InstEmptyWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349000">Rune</span>&nbsp;<span class="op" id="5349005">[</span><span class="op" id="5349006">]</span><span class="builtintype" id="5349007">rune</span><br>
<span class="lineno"></span><span class="op" id="5349012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5349015">func</span>&nbsp;<span class="op" id="5349020">(</span><span class="ident" id="5349021">p</span>&nbsp;<span class="op" id="5349023">*</span><span class="ident" id="5349024">Prog</span><span class="op" id="5349028">)</span>&nbsp;<span class="ident" id="5349030">String</span><span class="op" id="5349036">(</span><span class="op" id="5349037">)</span>&nbsp;<span class="builtintype" id="5349039">string</span>&nbsp;<span class="op" id="5349046">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349049">var</span>&nbsp;<span class="ident" id="5349053">b</span>&nbsp;<span class="ident" id="5349055">bytes</span><span class="op" id="5349060">.</span><span class="ident" id="5349061">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349069">dumpProg</span><span class="op" id="5349077">(</span><span class="op" id="5349078">&amp;</span><span class="ident" id="5349079">b</span><span class="op" id="5349080">,</span>&nbsp;<span class="ident" id="5349082">p</span><span class="op" id="5349083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349086">return</span>&nbsp;<span class="ident" id="5349093">b</span><span class="op" id="5349094">.</span><span class="ident" id="5349095">String</span><span class="op" id="5349101">(</span><span class="op" id="5349102">)</span><br>
<span class="lineno"></span><span class="op" id="5349104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5349107">//&nbsp;skipNop&nbsp;follows&nbsp;any&nbsp;no-op&nbsp;or&nbsp;capturing&nbsp;instructions</span><br>
<span class="lineno"></span><span class="comment" id="5349162">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;pc.</span><br>
<span class="lineno"></span><span class="keyword" id="5349195">func</span>&nbsp;<span class="op" id="5349200">(</span><span class="ident" id="5349201">p</span>&nbsp;<span class="op" id="5349203">*</span><span class="ident" id="5349204">Prog</span><span class="op" id="5349208">)</span>&nbsp;<span class="ident" id="5349210">skipNop</span><span class="op" id="5349217">(</span><span class="ident" id="5349218">pc</span>&nbsp;<span class="builtintype" id="5349221">uint32</span><span class="op" id="5349227">)</span>&nbsp;<span class="op" id="5349229">(</span><span class="op" id="5349230">*</span><span class="ident" id="5349231">Inst</span><span class="op" id="5349235">,</span>&nbsp;<span class="builtintype" id="5349237">uint32</span><span class="op" id="5349243">)</span>&nbsp;<span class="op" id="5349245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349248">i</span>&nbsp;<span class="op" id="5349250">:=</span>&nbsp;<span class="op" id="5349253">&amp;</span><span class="ident" id="5349254">p</span><span class="op" id="5349255">.</span><span class="ident" id="5349256">Inst</span><span class="op" id="5349260">[</span><span class="ident" id="5349261">pc</span><span class="op" id="5349263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349266">for</span>&nbsp;<span class="ident" id="5349270">i</span><span class="op" id="5349271">.</span><span class="ident" id="5349272">Op</span>&nbsp;<span class="op" id="5349275">==</span>&nbsp;<span class="ident" id="5349278">InstNop</span>&nbsp;<span class="op" id="5349286">||</span>&nbsp;<span class="ident" id="5349289">i</span><span class="op" id="5349290">.</span><span class="ident" id="5349291">Op</span>&nbsp;<span class="op" id="5349294">==</span>&nbsp;<span class="ident" id="5349297">InstCapture</span>&nbsp;<span class="op" id="5349309">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349313">pc</span>&nbsp;<span class="op" id="5349316">=</span>&nbsp;<span class="ident" id="5349318">i</span><span class="op" id="5349319">.</span><span class="ident" id="5349320">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349326">i</span>&nbsp;<span class="op" id="5349328">=</span>&nbsp;<span class="op" id="5349330">&amp;</span><span class="ident" id="5349331">p</span><span class="op" id="5349332">.</span><span class="ident" id="5349333">Inst</span><span class="op" id="5349337">[</span><span class="ident" id="5349338">pc</span><span class="op" id="5349340">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5349343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349346">return</span>&nbsp;<span class="ident" id="5349353">i</span><span class="op" id="5349354">,</span>&nbsp;<span class="ident" id="5349356">pc</span><br>
<span class="lineno"></span><span class="op" id="5349359">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5349362">//&nbsp;op&nbsp;returns&nbsp;i.Op&nbsp;but&nbsp;merges&nbsp;all&nbsp;the&nbsp;Rune&nbsp;special&nbsp;cases&nbsp;into&nbsp;InstRune</span><br>
<span class="lineno"></span><span class="keyword" id="5349433">func</span>&nbsp;<span class="op" id="5349438">(</span><span class="ident" id="5349439">i</span>&nbsp;<span class="op" id="5349441">*</span><span class="ident" id="5349442">Inst</span><span class="op" id="5349446">)</span>&nbsp;<span class="ident" id="5349448">op</span><span class="op" id="5349450">(</span><span class="op" id="5349451">)</span>&nbsp;<span class="ident" id="5349453">InstOp</span>&nbsp;<span class="op" id="5349460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349463">op</span>&nbsp;<span class="op" id="5349466">:=</span>&nbsp;<span class="ident" id="5349469">i</span><span class="op" id="5349470">.</span><span class="ident" id="5349471">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349475">switch</span>&nbsp;<span class="ident" id="5349482">op</span>&nbsp;<span class="op" id="5349485">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349488">case</span>&nbsp;<span class="ident" id="5349493">InstRune1</span><span class="op" id="5349502">,</span>&nbsp;<span class="ident" id="5349504">InstRuneAny</span><span class="op" id="5349515">,</span>&nbsp;<span class="ident" id="5349517">InstRuneAnyNotNL</span><span class="op" id="5349533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349537">op</span>&nbsp;<span class="op" id="5349540">=</span>&nbsp;<span class="ident" id="5349542">InstRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5349552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349555">return</span>&nbsp;<span class="ident" id="5349562">op</span><br>
<span class="lineno"></span><span class="op" id="5349565">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="5349568">//&nbsp;Prefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;all&nbsp;matches&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5349628">//&nbsp;regexp&nbsp;must&nbsp;start&nbsp;with.&nbsp;&nbsp;Complete&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="5349687">//&nbsp;is&nbsp;the&nbsp;entire&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5349711">func</span>&nbsp;<span class="op" id="5349716">(</span><span class="ident" id="5349717">p</span>&nbsp;<span class="op" id="5349719">*</span><span class="ident" id="5349720">Prog</span><span class="op" id="5349724">)</span>&nbsp;<span class="ident" id="5349726">Prefix</span><span class="op" id="5349732">(</span><span class="op" id="5349733">)</span>&nbsp;<span class="op" id="5349735">(</span><span class="ident" id="5349736">prefix</span>&nbsp;<span class="builtintype" id="5349743">string</span><span class="op" id="5349749">,</span>&nbsp;<span class="ident" id="5349751">complete</span>&nbsp;<span class="builtintype" id="5349760">bool</span><span class="op" id="5349764">)</span>&nbsp;<span class="op" id="5349766">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5349769">i</span><span class="op" id="5349770">,</span>&nbsp;<span class="ident" id="5349772">_</span>&nbsp;<span class="op" id="5349774">:=</span>&nbsp;<span class="ident" id="5349777">p</span><span class="op" id="5349778">.</span><span class="ident" id="5349779">skipNop</span><span class="op" id="5349786">(</span><span class="builtintype" id="5349787">uint32</span><span class="op" id="5349793">(</span><span class="ident" id="5349794">p</span><span class="op" id="5349795">.</span><span class="ident" id="5349796">Start</span><span class="op" id="5349801">)</span><span class="op" id="5349802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5349806">//&nbsp;Avoid&nbsp;allocation&nbsp;of&nbsp;buffer&nbsp;if&nbsp;prefix&nbsp;is&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349857">if</span>&nbsp;<span class="ident" id="5349860">i</span><span class="op" id="5349861">.</span><span class="ident" id="5349862">op</span><span class="op" id="5349864">(</span><span class="op" id="5349865">)</span>&nbsp;<span class="op" id="5349867">!=</span>&nbsp;<span class="ident" id="5349870">InstRune</span>&nbsp;<span class="op" id="5349879">||</span>&nbsp;<span class="builtinfunc" id="5349882">len</span><span class="op" id="5349885">(</span><span class="ident" id="5349886">i</span><span class="op" id="5349887">.</span><span class="ident" id="5349888">Rune</span><span class="op" id="5349892">)</span>&nbsp;<span class="op" id="5349894">!=</span>&nbsp;<span class="num" id="5349897">1</span>&nbsp;<span class="op" id="5349899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349903">return</span>&nbsp;<span class="string" id="5349910">&#34;&#34;</span><span class="op" id="5349912">,</span>&nbsp;<span class="ident" id="5349914">i</span><span class="op" id="5349915">.</span><span class="ident" id="5349916">Op</span>&nbsp;<span class="op" id="5349919">==</span>&nbsp;<span class="ident" id="5349922">InstMatch</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5349933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5349937">//&nbsp;Have&nbsp;prefix;&nbsp;gather&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349973">var</span>&nbsp;<span class="ident" id="5349977">buf</span>&nbsp;<span class="ident" id="5349981">bytes</span><span class="op" id="5349986">.</span><span class="ident" id="5349987">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5349995">for</span>&nbsp;<span class="ident" id="5349999">i</span><span class="op" id="5350000">.</span><span class="ident" id="5350001">op</span><span class="op" id="5350003">(</span><span class="op" id="5350004">)</span>&nbsp;<span class="op" id="5350006">==</span>&nbsp;<span class="ident" id="5350009">InstRune</span>&nbsp;<span class="op" id="5350018">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5350021">len</span><span class="op" id="5350024">(</span><span class="ident" id="5350025">i</span><span class="op" id="5350026">.</span><span class="ident" id="5350027">Rune</span><span class="op" id="5350031">)</span>&nbsp;<span class="op" id="5350033">==</span>&nbsp;<span class="num" id="5350036">1</span>&nbsp;<span class="op" id="5350038">&amp;&amp;</span>&nbsp;<span class="ident" id="5350041">Flags</span><span class="op" id="5350046">(</span><span class="ident" id="5350047">i</span><span class="op" id="5350048">.</span><span class="ident" id="5350049">Arg</span><span class="op" id="5350052">)</span><span class="op" id="5350053">&amp;</span><span class="ident" id="5350054">FoldCase</span>&nbsp;<span class="op" id="5350063">==</span>&nbsp;<span class="num" id="5350066">0</span>&nbsp;<span class="op" id="5350068">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350072">buf</span><span class="op" id="5350075">.</span><span class="ident" id="5350076">WriteRune</span><span class="op" id="5350085">(</span><span class="ident" id="5350086">i</span><span class="op" id="5350087">.</span><span class="ident" id="5350088">Rune</span><span class="op" id="5350092">[</span><span class="num" id="5350093">0</span><span class="op" id="5350094">]</span><span class="op" id="5350095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350099">i</span><span class="op" id="5350100">,</span>&nbsp;<span class="ident" id="5350102">_</span>&nbsp;<span class="op" id="5350104">=</span>&nbsp;<span class="ident" id="5350106">p</span><span class="op" id="5350107">.</span><span class="ident" id="5350108">skipNop</span><span class="op" id="5350115">(</span><span class="ident" id="5350116">i</span><span class="op" id="5350117">.</span><span class="ident" id="5350118">Out</span><span class="op" id="5350121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5350124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350127">return</span>&nbsp;<span class="ident" id="5350134">buf</span><span class="op" id="5350137">.</span><span class="ident" id="5350138">String</span><span class="op" id="5350144">(</span><span class="op" id="5350145">)</span><span class="op" id="5350146">,</span>&nbsp;<span class="ident" id="5350148">i</span><span class="op" id="5350149">.</span><span class="ident" id="5350150">Op</span>&nbsp;<span class="op" id="5350153">==</span>&nbsp;<span class="ident" id="5350156">InstMatch</span><br>
<span class="lineno"></span><span class="op" id="5350166">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5350169">//&nbsp;StartCond&nbsp;returns&nbsp;the&nbsp;leading&nbsp;empty-width&nbsp;conditions&nbsp;that&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5350235">//&nbsp;be&nbsp;true&nbsp;in&nbsp;any&nbsp;match.&nbsp;&nbsp;It&nbsp;returns&nbsp;^EmptyOp(0)&nbsp;if&nbsp;no&nbsp;matches&nbsp;are&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5350312">func</span>&nbsp;<span class="op" id="5350317">(</span><span class="ident" id="5350318">p</span>&nbsp;<span class="op" id="5350320">*</span><span class="ident" id="5350321">Prog</span><span class="op" id="5350325">)</span>&nbsp;<span class="ident" id="5350327">StartCond</span><span class="op" id="5350336">(</span><span class="op" id="5350337">)</span>&nbsp;<span class="ident" id="5350339">EmptyOp</span>&nbsp;<span class="op" id="5350347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350350">var</span>&nbsp;<span class="ident" id="5350354">flag</span>&nbsp;<span class="ident" id="5350359">EmptyOp</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350368">pc</span>&nbsp;<span class="op" id="5350371">:=</span>&nbsp;<span class="builtintype" id="5350374">uint32</span><span class="op" id="5350380">(</span><span class="ident" id="5350381">p</span><span class="op" id="5350382">.</span><span class="ident" id="5350383">Start</span><span class="op" id="5350388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350391">i</span>&nbsp;<span class="op" id="5350393">:=</span>&nbsp;<span class="op" id="5350396">&amp;</span><span class="ident" id="5350397">p</span><span class="op" id="5350398">.</span><span class="ident" id="5350399">Inst</span><span class="op" id="5350403">[</span><span class="ident" id="5350404">pc</span><span class="op" id="5350406">]</span><br>
<span class="lineno"></span><span class="ident" id="5350408">Loop</span><span class="op" id="5350412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350415">for</span>&nbsp;<span class="op" id="5350419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350423">switch</span>&nbsp;<span class="ident" id="5350430">i</span><span class="op" id="5350431">.</span><span class="ident" id="5350432">Op</span>&nbsp;<span class="op" id="5350435">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350439">case</span>&nbsp;<span class="ident" id="5350444">InstEmptyWidth</span><span class="op" id="5350458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350463">flag</span>&nbsp;<span class="op" id="5350468">|=</span>&nbsp;<span class="ident" id="5350471">EmptyOp</span><span class="op" id="5350478">(</span><span class="ident" id="5350479">i</span><span class="op" id="5350480">.</span><span class="ident" id="5350481">Arg</span><span class="op" id="5350484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350488">case</span>&nbsp;<span class="ident" id="5350493">InstFail</span><span class="op" id="5350501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350506">return</span>&nbsp;<span class="op" id="5350513">^</span><span class="ident" id="5350514">EmptyOp</span><span class="op" id="5350521">(</span><span class="num" id="5350522">0</span><span class="op" id="5350523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350527">case</span>&nbsp;<span class="ident" id="5350532">InstCapture</span><span class="op" id="5350543">,</span>&nbsp;<span class="ident" id="5350545">InstNop</span><span class="op" id="5350552">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5350557">//&nbsp;skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350567">default</span><span class="op" id="5350574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350579">break</span>&nbsp;<span class="ident" id="5350585">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5350592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350596">pc</span>&nbsp;<span class="op" id="5350599">=</span>&nbsp;<span class="ident" id="5350601">i</span><span class="op" id="5350602">.</span><span class="ident" id="5350603">Out</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5350609">i</span>&nbsp;<span class="op" id="5350611">=</span>&nbsp;<span class="op" id="5350613">&amp;</span><span class="ident" id="5350614">p</span><span class="op" id="5350615">.</span><span class="ident" id="5350616">Inst</span><span class="op" id="5350620">[</span><span class="ident" id="5350621">pc</span><span class="op" id="5350623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5350626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350629">return</span>&nbsp;<span class="ident" id="5350636">flag</span><br>
<span class="lineno"></span><span class="op" id="5350641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5350644">const</span>&nbsp;<span class="ident" id="5350650">noMatch</span>&nbsp;<span class="op" id="5350658">=</span>&nbsp;<span class="op" id="5350660">-</span><span class="num" id="5350661">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5350664">//&nbsp;MatchRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;instruction&nbsp;matches&nbsp;(and&nbsp;consumes)&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5350735">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstRune.</span><br>
<span class="lineno"></span><span class="keyword" id="5350786">func</span>&nbsp;<span class="op" id="5350791">(</span><span class="ident" id="5350792">i</span>&nbsp;<span class="op" id="5350794">*</span><span class="ident" id="5350795">Inst</span><span class="op" id="5350799">)</span>&nbsp;<span class="ident" id="5350801">MatchRune</span><span class="op" id="5350810">(</span><span class="ident" id="5350811">r</span>&nbsp;<span class="builtintype" id="5350813">rune</span><span class="op" id="5350817">)</span>&nbsp;<span class="builtintype" id="5350819">bool</span>&nbsp;<span class="op" id="5350824">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5350827">return</span>&nbsp;<span class="ident" id="5350834">i</span><span class="op" id="5350835">.</span><span class="ident" id="5350836">MatchRunePos</span><span class="op" id="5350848">(</span><span class="ident" id="5350849">r</span><span class="op" id="5350850">)</span>&nbsp;<span class="op" id="5350852">!=</span>&nbsp;<span class="ident" id="5350855">noMatch</span><br>
<span class="lineno"></span><span class="op" id="5350863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5350866">//&nbsp;MatchRunePos&nbsp;checks&nbsp;whether&nbsp;the&nbsp;instruction&nbsp;matches&nbsp;(and&nbsp;consumes)&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5350939">//&nbsp;If&nbsp;so,&nbsp;MatchRunePos&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;matching&nbsp;rune&nbsp;pair</span><br>
<span class="lineno">200</span><span class="comment" id="5351006">//&nbsp;(or,&nbsp;when&nbsp;len(i.Rune)&nbsp;==&nbsp;1,&nbsp;rune&nbsp;singleton).</span><br>
<span class="lineno"></span><span class="comment" id="5351054">//&nbsp;If&nbsp;not,&nbsp;MatchRunePos&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="comment" id="5351090">//&nbsp;MatchRunePos&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstRune.</span><br>
<span class="lineno"></span><span class="keyword" id="5351151">func</span>&nbsp;<span class="op" id="5351156">(</span><span class="ident" id="5351157">i</span>&nbsp;<span class="op" id="5351159">*</span><span class="ident" id="5351160">Inst</span><span class="op" id="5351164">)</span>&nbsp;<span class="ident" id="5351166">MatchRunePos</span><span class="op" id="5351178">(</span><span class="ident" id="5351179">r</span>&nbsp;<span class="builtintype" id="5351181">rune</span><span class="op" id="5351185">)</span>&nbsp;<span class="builtintype" id="5351187">int</span>&nbsp;<span class="op" id="5351191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5351194">rune</span>&nbsp;<span class="op" id="5351199">:=</span>&nbsp;<span class="ident" id="5351202">i</span><span class="op" id="5351203">.</span><span class="ident" id="5351204">Rune</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5351211">//&nbsp;Special&nbsp;case:&nbsp;single-rune&nbsp;slice&nbsp;is&nbsp;from&nbsp;literal&nbsp;string,&nbsp;not&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351287">if</span>&nbsp;<span class="builtinfunc" id="5351290">len</span><span class="op" id="5351293">(</span><span class="builtintype" id="5351294">rune</span><span class="op" id="5351298">)</span>&nbsp;<span class="op" id="5351300">==</span>&nbsp;<span class="num" id="5351303">1</span>&nbsp;<span class="op" id="5351305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351309">r0</span>&nbsp;<span class="op" id="5351312">:=</span>&nbsp;<span class="builtintype" id="5351315">rune</span><span class="op" id="5351319">[</span><span class="num" id="5351320">0</span><span class="op" id="5351321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351325">if</span>&nbsp;<span class="ident" id="5351328">r</span>&nbsp;<span class="op" id="5351330">==</span>&nbsp;<span class="ident" id="5351333">r0</span>&nbsp;<span class="op" id="5351336">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351341">return</span>&nbsp;<span class="num" id="5351348">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351356">if</span>&nbsp;<span class="ident" id="5351359">Flags</span><span class="op" id="5351364">(</span><span class="ident" id="5351365">i</span><span class="op" id="5351366">.</span><span class="ident" id="5351367">Arg</span><span class="op" id="5351370">)</span><span class="op" id="5351371">&amp;</span><span class="ident" id="5351372">FoldCase</span>&nbsp;<span class="op" id="5351381">!=</span>&nbsp;<span class="num" id="5351384">0</span>&nbsp;<span class="op" id="5351386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351391">for</span>&nbsp;<span class="ident" id="5351395">r1</span>&nbsp;<span class="op" id="5351398">:=</span>&nbsp;<span class="ident" id="5351401">unicode</span><span class="op" id="5351408">.</span><span class="ident" id="5351409">SimpleFold</span><span class="op" id="5351419">(</span><span class="ident" id="5351420">r0</span><span class="op" id="5351422">)</span><span class="op" id="5351423">;</span>&nbsp;<span class="ident" id="5351425">r1</span>&nbsp;<span class="op" id="5351428">!=</span>&nbsp;<span class="ident" id="5351431">r0</span><span class="op" id="5351433">;</span>&nbsp;<span class="ident" id="5351435">r1</span>&nbsp;<span class="op" id="5351438">=</span>&nbsp;<span class="ident" id="5351440">unicode</span><span class="op" id="5351447">.</span><span class="ident" id="5351448">SimpleFold</span><span class="op" id="5351458">(</span><span class="ident" id="5351459">r1</span><span class="op" id="5351461">)</span>&nbsp;<span class="op" id="5351463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351469">if</span>&nbsp;<span class="ident" id="5351472">r</span>&nbsp;<span class="op" id="5351474">==</span>&nbsp;<span class="ident" id="5351477">r1</span>&nbsp;<span class="op" id="5351480">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351487">return</span>&nbsp;<span class="num" id="5351494">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351513">return</span>&nbsp;<span class="ident" id="5351520">noMatch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5351533">//&nbsp;Peek&nbsp;at&nbsp;the&nbsp;first&nbsp;few&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5351566">//&nbsp;Should&nbsp;handle&nbsp;ASCII&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351596">for</span>&nbsp;<span class="ident" id="5351600">j</span>&nbsp;<span class="op" id="5351602">:=</span>&nbsp;<span class="num" id="5351605">0</span><span class="op" id="5351606">;</span>&nbsp;<span class="ident" id="5351608">j</span>&nbsp;<span class="op" id="5351610">&lt;</span>&nbsp;<span class="builtinfunc" id="5351612">len</span><span class="op" id="5351615">(</span><span class="builtintype" id="5351616">rune</span><span class="op" id="5351620">)</span>&nbsp;<span class="op" id="5351622">&amp;&amp;</span>&nbsp;<span class="ident" id="5351625">j</span>&nbsp;<span class="op" id="5351627">&lt;=</span>&nbsp;<span class="num" id="5351630">8</span><span class="op" id="5351631">;</span>&nbsp;<span class="ident" id="5351633">j</span>&nbsp;<span class="op" id="5351635">+=</span>&nbsp;<span class="num" id="5351638">2</span>&nbsp;<span class="op" id="5351640">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351644">if</span>&nbsp;<span class="ident" id="5351647">r</span>&nbsp;<span class="op" id="5351649">&lt;</span>&nbsp;<span class="builtintype" id="5351651">rune</span><span class="op" id="5351655">[</span><span class="ident" id="5351656">j</span><span class="op" id="5351657">]</span>&nbsp;<span class="op" id="5351659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351664">return</span>&nbsp;<span class="ident" id="5351671">noMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351685">if</span>&nbsp;<span class="ident" id="5351688">r</span>&nbsp;<span class="op" id="5351690">&lt;=</span>&nbsp;<span class="builtintype" id="5351693">rune</span><span class="op" id="5351697">[</span><span class="ident" id="5351698">j</span><span class="op" id="5351699">+</span><span class="num" id="5351700">1</span><span class="op" id="5351701">]</span>&nbsp;<span class="op" id="5351703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351708">return</span>&nbsp;<span class="ident" id="5351715">j</span>&nbsp;<span class="op" id="5351717">/</span>&nbsp;<span class="num" id="5351719">2</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5351730">//&nbsp;Otherwise&nbsp;binary&nbsp;search.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351759">lo</span>&nbsp;<span class="op" id="5351762">:=</span>&nbsp;<span class="num" id="5351765">0</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351768">hi</span>&nbsp;<span class="op" id="5351771">:=</span>&nbsp;<span class="builtinfunc" id="5351774">len</span><span class="op" id="5351777">(</span><span class="builtintype" id="5351778">rune</span><span class="op" id="5351782">)</span>&nbsp;<span class="op" id="5351784">/</span>&nbsp;<span class="num" id="5351786">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351789">for</span>&nbsp;<span class="ident" id="5351793">lo</span>&nbsp;<span class="op" id="5351796">&lt;</span>&nbsp;<span class="ident" id="5351798">hi</span>&nbsp;<span class="op" id="5351801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351805">m</span>&nbsp;<span class="op" id="5351807">:=</span>&nbsp;<span class="ident" id="5351810">lo</span>&nbsp;<span class="op" id="5351813">+</span>&nbsp;<span class="op" id="5351815">(</span><span class="ident" id="5351816">hi</span><span class="op" id="5351818">-</span><span class="ident" id="5351819">lo</span><span class="op" id="5351821">)</span><span class="op" id="5351822">/</span><span class="num" id="5351823">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351827">if</span>&nbsp;<span class="ident" id="5351830">c</span>&nbsp;<span class="op" id="5351832">:=</span>&nbsp;<span class="builtintype" id="5351835">rune</span><span class="op" id="5351839">[</span><span class="num" id="5351840">2</span><span class="op" id="5351841">*</span><span class="ident" id="5351842">m</span><span class="op" id="5351843">]</span><span class="op" id="5351844">;</span>&nbsp;<span class="ident" id="5351846">c</span>&nbsp;<span class="op" id="5351848">&lt;=</span>&nbsp;<span class="ident" id="5351851">r</span>&nbsp;<span class="op" id="5351853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351858">if</span>&nbsp;<span class="ident" id="5351861">r</span>&nbsp;<span class="op" id="5351863">&lt;=</span>&nbsp;<span class="builtintype" id="5351866">rune</span><span class="op" id="5351870">[</span><span class="num" id="5351871">2</span><span class="op" id="5351872">*</span><span class="ident" id="5351873">m</span><span class="op" id="5351874">+</span><span class="num" id="5351875">1</span><span class="op" id="5351876">]</span>&nbsp;<span class="op" id="5351878">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351884">return</span>&nbsp;<span class="ident" id="5351891">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351901">lo</span>&nbsp;<span class="op" id="5351904">=</span>&nbsp;<span class="ident" id="5351906">m</span>&nbsp;<span class="op" id="5351908">+</span>&nbsp;<span class="num" id="5351910">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351914">}</span>&nbsp;<span class="keyword" id="5351916">else</span>&nbsp;<span class="op" id="5351921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5351926">hi</span>&nbsp;<span class="op" id="5351929">=</span>&nbsp;<span class="ident" id="5351931">m</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5351938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5351941">return</span>&nbsp;<span class="ident" id="5351948">noMatch</span><br>
<span class="lineno"></span><span class="op" id="5351956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="5351959">//&nbsp;As&nbsp;per&nbsp;re2&#39;s&nbsp;Prog::IsWordChar.&nbsp;Determines&nbsp;whether&nbsp;rune&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;word&nbsp;char.</span><br>
<span class="lineno"></span><span class="comment" id="5352040">//&nbsp;Since&nbsp;we&nbsp;act&nbsp;on&nbsp;runes,&nbsp;it&nbsp;would&nbsp;be&nbsp;easy&nbsp;to&nbsp;support&nbsp;Unicode&nbsp;here.</span><br>
<span class="lineno"></span><span class="keyword" id="5352108">func</span>&nbsp;<span class="ident" id="5352113">wordRune</span><span class="op" id="5352121">(</span><span class="ident" id="5352122">r</span>&nbsp;<span class="builtintype" id="5352124">rune</span><span class="op" id="5352128">)</span>&nbsp;<span class="builtintype" id="5352130">bool</span>&nbsp;<span class="op" id="5352135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352138">return</span>&nbsp;<span class="ident" id="5352145">r</span>&nbsp;<span class="op" id="5352147">==</span>&nbsp;<span class="string" id="5352150">&#39;_&#39;</span>&nbsp;<span class="op" id="5352154">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5352159">(</span><span class="string" id="5352160">&#39;A&#39;</span>&nbsp;<span class="op" id="5352164">&lt;=</span>&nbsp;<span class="ident" id="5352167">r</span>&nbsp;<span class="op" id="5352169">&amp;&amp;</span>&nbsp;<span class="ident" id="5352172">r</span>&nbsp;<span class="op" id="5352174">&lt;=</span>&nbsp;<span class="string" id="5352177">&#39;Z&#39;</span><span class="op" id="5352180">)</span>&nbsp;<span class="op" id="5352182">||</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5352187">(</span><span class="string" id="5352188">&#39;a&#39;</span>&nbsp;<span class="op" id="5352192">&lt;=</span>&nbsp;<span class="ident" id="5352195">r</span>&nbsp;<span class="op" id="5352197">&amp;&amp;</span>&nbsp;<span class="ident" id="5352200">r</span>&nbsp;<span class="op" id="5352202">&lt;=</span>&nbsp;<span class="string" id="5352205">&#39;z&#39;</span><span class="op" id="5352208">)</span>&nbsp;<span class="op" id="5352210">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5352215">(</span><span class="string" id="5352216">&#39;0&#39;</span>&nbsp;<span class="op" id="5352220">&lt;=</span>&nbsp;<span class="ident" id="5352223">r</span>&nbsp;<span class="op" id="5352225">&amp;&amp;</span>&nbsp;<span class="ident" id="5352228">r</span>&nbsp;<span class="op" id="5352230">&lt;=</span>&nbsp;<span class="string" id="5352233">&#39;9&#39;</span><span class="op" id="5352236">)</span><br>
<span class="lineno"></span><span class="op" id="5352238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5352241">//&nbsp;MatchEmptyWidth&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;instruction&nbsp;matches</span><br>
<span class="lineno">260</span><span class="comment" id="5352300">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;between&nbsp;the&nbsp;runes&nbsp;before&nbsp;and&nbsp;after.</span><br>
<span class="lineno"></span><span class="comment" id="5352355">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstEmptyWidth.</span><br>
<span class="lineno"></span><span class="keyword" id="5352412">func</span>&nbsp;<span class="op" id="5352417">(</span><span class="ident" id="5352418">i</span>&nbsp;<span class="op" id="5352420">*</span><span class="ident" id="5352421">Inst</span><span class="op" id="5352425">)</span>&nbsp;<span class="ident" id="5352427">MatchEmptyWidth</span><span class="op" id="5352442">(</span><span class="ident" id="5352443">before</span>&nbsp;<span class="builtintype" id="5352450">rune</span><span class="op" id="5352454">,</span>&nbsp;<span class="ident" id="5352456">after</span>&nbsp;<span class="builtintype" id="5352462">rune</span><span class="op" id="5352466">)</span>&nbsp;<span class="builtintype" id="5352468">bool</span>&nbsp;<span class="op" id="5352473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352476">switch</span>&nbsp;<span class="ident" id="5352483">EmptyOp</span><span class="op" id="5352490">(</span><span class="ident" id="5352491">i</span><span class="op" id="5352492">.</span><span class="ident" id="5352493">Arg</span><span class="op" id="5352496">)</span>&nbsp;<span class="op" id="5352498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352501">case</span>&nbsp;<span class="ident" id="5352506">EmptyBeginLine</span><span class="op" id="5352520">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352524">return</span>&nbsp;<span class="ident" id="5352531">before</span>&nbsp;<span class="op" id="5352538">==</span>&nbsp;<span class="string" id="5352541">&#39;\n&#39;</span>&nbsp;<span class="op" id="5352546">||</span>&nbsp;<span class="ident" id="5352549">before</span>&nbsp;<span class="op" id="5352556">==</span>&nbsp;<span class="op" id="5352559">-</span><span class="num" id="5352560">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352563">case</span>&nbsp;<span class="ident" id="5352568">EmptyEndLine</span><span class="op" id="5352580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352584">return</span>&nbsp;<span class="ident" id="5352591">after</span>&nbsp;<span class="op" id="5352597">==</span>&nbsp;<span class="string" id="5352600">&#39;\n&#39;</span>&nbsp;<span class="op" id="5352605">||</span>&nbsp;<span class="ident" id="5352608">after</span>&nbsp;<span class="op" id="5352614">==</span>&nbsp;<span class="op" id="5352617">-</span><span class="num" id="5352618">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352621">case</span>&nbsp;<span class="ident" id="5352626">EmptyBeginText</span><span class="op" id="5352640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352644">return</span>&nbsp;<span class="ident" id="5352651">before</span>&nbsp;<span class="op" id="5352658">==</span>&nbsp;<span class="op" id="5352661">-</span><span class="num" id="5352662">1</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352665">case</span>&nbsp;<span class="ident" id="5352670">EmptyEndText</span><span class="op" id="5352682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352686">return</span>&nbsp;<span class="ident" id="5352693">after</span>&nbsp;<span class="op" id="5352699">==</span>&nbsp;<span class="op" id="5352702">-</span><span class="num" id="5352703">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352706">case</span>&nbsp;<span class="ident" id="5352711">EmptyWordBoundary</span><span class="op" id="5352728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352732">return</span>&nbsp;<span class="ident" id="5352739">wordRune</span><span class="op" id="5352747">(</span><span class="ident" id="5352748">before</span><span class="op" id="5352754">)</span>&nbsp;<span class="op" id="5352756">!=</span>&nbsp;<span class="ident" id="5352759">wordRune</span><span class="op" id="5352767">(</span><span class="ident" id="5352768">after</span><span class="op" id="5352773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352776">case</span>&nbsp;<span class="ident" id="5352781">EmptyNoWordBoundary</span><span class="op" id="5352800">:</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352804">return</span>&nbsp;<span class="ident" id="5352811">wordRune</span><span class="op" id="5352819">(</span><span class="ident" id="5352820">before</span><span class="op" id="5352826">)</span>&nbsp;<span class="op" id="5352828">==</span>&nbsp;<span class="ident" id="5352831">wordRune</span><span class="op" id="5352839">(</span><span class="ident" id="5352840">after</span><span class="op" id="5352845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5352848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5352851">panic</span><span class="op" id="5352856">(</span><span class="string" id="5352857">&#34;unknown&nbsp;empty&nbsp;width&nbsp;arg&#34;</span><span class="op" id="5352882">)</span><br>
<span class="lineno"></span><span class="op" id="5352884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="5352887">func</span>&nbsp;<span class="op" id="5352892">(</span><span class="ident" id="5352893">i</span>&nbsp;<span class="op" id="5352895">*</span><span class="ident" id="5352896">Inst</span><span class="op" id="5352900">)</span>&nbsp;<span class="ident" id="5352902">String</span><span class="op" id="5352908">(</span><span class="op" id="5352909">)</span>&nbsp;<span class="builtintype" id="5352911">string</span>&nbsp;<span class="op" id="5352918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352921">var</span>&nbsp;<span class="ident" id="5352925">b</span>&nbsp;<span class="ident" id="5352927">bytes</span><span class="op" id="5352932">.</span><span class="ident" id="5352933">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5352941">dumpInst</span><span class="op" id="5352949">(</span><span class="op" id="5352950">&amp;</span><span class="ident" id="5352951">b</span><span class="op" id="5352952">,</span>&nbsp;<span class="ident" id="5352954">i</span><span class="op" id="5352955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5352958">return</span>&nbsp;<span class="ident" id="5352965">b</span><span class="op" id="5352966">.</span><span class="ident" id="5352967">String</span><span class="op" id="5352973">(</span><span class="op" id="5352974">)</span><br>
<span class="lineno"></span><span class="op" id="5352976">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5352979">func</span>&nbsp;<span class="ident" id="5352984">bw</span><span class="op" id="5352986">(</span><span class="ident" id="5352987">b</span>&nbsp;<span class="op" id="5352989">*</span><span class="ident" id="5352990">bytes</span><span class="op" id="5352995">.</span><span class="ident" id="5352996">Buffer</span><span class="op" id="5353002">,</span>&nbsp;<span class="ident" id="5353004">args</span>&nbsp;<span class="op" id="5353009">...</span><span class="builtintype" id="5353012">string</span><span class="op" id="5353018">)</span>&nbsp;<span class="op" id="5353020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353023">for</span>&nbsp;<span class="ident" id="5353027">_</span><span class="op" id="5353028">,</span>&nbsp;<span class="ident" id="5353030">s</span>&nbsp;<span class="op" id="5353032">:=</span>&nbsp;<span class="keyword" id="5353035">range</span>&nbsp;<span class="ident" id="5353041">args</span>&nbsp;<span class="op" id="5353046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353050">b</span><span class="op" id="5353051">.</span><span class="ident" id="5353052">WriteString</span><span class="op" id="5353063">(</span><span class="ident" id="5353064">s</span><span class="op" id="5353065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5353068">}</span><br>
<span class="lineno">290</span><span class="op" id="5353070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5353073">func</span>&nbsp;<span class="ident" id="5353078">dumpProg</span><span class="op" id="5353086">(</span><span class="ident" id="5353087">b</span>&nbsp;<span class="op" id="5353089">*</span><span class="ident" id="5353090">bytes</span><span class="op" id="5353095">.</span><span class="ident" id="5353096">Buffer</span><span class="op" id="5353102">,</span>&nbsp;<span class="ident" id="5353104">p</span>&nbsp;<span class="op" id="5353106">*</span><span class="ident" id="5353107">Prog</span><span class="op" id="5353111">)</span>&nbsp;<span class="op" id="5353113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353116">for</span>&nbsp;<span class="ident" id="5353120">j</span>&nbsp;<span class="op" id="5353122">:=</span>&nbsp;<span class="keyword" id="5353125">range</span>&nbsp;<span class="ident" id="5353131">p</span><span class="op" id="5353132">.</span><span class="ident" id="5353133">Inst</span>&nbsp;<span class="op" id="5353138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353142">i</span>&nbsp;<span class="op" id="5353144">:=</span>&nbsp;<span class="op" id="5353147">&amp;</span><span class="ident" id="5353148">p</span><span class="op" id="5353149">.</span><span class="ident" id="5353150">Inst</span><span class="op" id="5353154">[</span><span class="ident" id="5353155">j</span><span class="op" id="5353156">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353160">pc</span>&nbsp;<span class="op" id="5353163">:=</span>&nbsp;<span class="ident" id="5353166">strconv</span><span class="op" id="5353173">.</span><span class="ident" id="5353174">Itoa</span><span class="op" id="5353178">(</span><span class="ident" id="5353179">j</span><span class="op" id="5353180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353184">if</span>&nbsp;<span class="builtinfunc" id="5353187">len</span><span class="op" id="5353190">(</span><span class="ident" id="5353191">pc</span><span class="op" id="5353193">)</span>&nbsp;<span class="op" id="5353195">&lt;</span>&nbsp;<span class="num" id="5353197">3</span>&nbsp;<span class="op" id="5353199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353204">b</span><span class="op" id="5353205">.</span><span class="ident" id="5353206">WriteString</span><span class="op" id="5353217">(</span><span class="string" id="5353218">&#34;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="5353223">[</span><span class="builtinfunc" id="5353224">len</span><span class="op" id="5353227">(</span><span class="ident" id="5353228">pc</span><span class="op" id="5353230">)</span><span class="op" id="5353231">:</span><span class="op" id="5353232">]</span><span class="op" id="5353233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5353237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353241">if</span>&nbsp;<span class="ident" id="5353244">j</span>&nbsp;<span class="op" id="5353246">==</span>&nbsp;<span class="ident" id="5353249">p</span><span class="op" id="5353250">.</span><span class="ident" id="5353251">Start</span>&nbsp;<span class="op" id="5353257">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353262">pc</span>&nbsp;<span class="op" id="5353265">+=</span>&nbsp;<span class="string" id="5353268">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5353274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353278">bw</span><span class="op" id="5353280">(</span><span class="ident" id="5353281">b</span><span class="op" id="5353282">,</span>&nbsp;<span class="ident" id="5353284">pc</span><span class="op" id="5353286">,</span>&nbsp;<span class="string" id="5353288">&#34;\t&#34;</span><span class="op" id="5353292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353296">dumpInst</span><span class="op" id="5353304">(</span><span class="ident" id="5353305">b</span><span class="op" id="5353306">,</span>&nbsp;<span class="ident" id="5353308">i</span><span class="op" id="5353309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353313">bw</span><span class="op" id="5353315">(</span><span class="ident" id="5353316">b</span><span class="op" id="5353317">,</span>&nbsp;<span class="string" id="5353319">&#34;\n&#34;</span><span class="op" id="5353323">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5353326">}</span><br>
<span class="lineno"></span><span class="op" id="5353328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5353331">func</span>&nbsp;<span class="ident" id="5353336">u32</span><span class="op" id="5353339">(</span><span class="ident" id="5353340">i</span>&nbsp;<span class="builtintype" id="5353342">uint32</span><span class="op" id="5353348">)</span>&nbsp;<span class="builtintype" id="5353350">string</span>&nbsp;<span class="op" id="5353357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353360">return</span>&nbsp;<span class="ident" id="5353367">strconv</span><span class="op" id="5353374">.</span><span class="ident" id="5353375">FormatUint</span><span class="op" id="5353385">(</span><span class="ident" id="5353386">uint64</span><span class="op" id="5353392">(</span><span class="ident" id="5353393">i</span><span class="op" id="5353394">)</span><span class="op" id="5353395">,</span>&nbsp;<span class="num" id="5353397">10</span><span class="op" id="5353399">)</span><br>
<span class="lineno">310</span><span class="op" id="5353401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5353404">func</span>&nbsp;<span class="ident" id="5353409">dumpInst</span><span class="op" id="5353417">(</span><span class="ident" id="5353418">b</span>&nbsp;<span class="op" id="5353420">*</span><span class="ident" id="5353421">bytes</span><span class="op" id="5353426">.</span><span class="ident" id="5353427">Buffer</span><span class="op" id="5353433">,</span>&nbsp;<span class="ident" id="5353435">i</span>&nbsp;<span class="op" id="5353437">*</span><span class="ident" id="5353438">Inst</span><span class="op" id="5353442">)</span>&nbsp;<span class="op" id="5353444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353447">switch</span>&nbsp;<span class="ident" id="5353454">i</span><span class="op" id="5353455">.</span><span class="ident" id="5353456">Op</span>&nbsp;<span class="op" id="5353459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353462">case</span>&nbsp;<span class="ident" id="5353467">InstAlt</span><span class="op" id="5353474">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353478">bw</span><span class="op" id="5353480">(</span><span class="ident" id="5353481">b</span><span class="op" id="5353482">,</span>&nbsp;<span class="string" id="5353484">&#34;alt&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5353493">,</span>&nbsp;<span class="ident" id="5353495">u32</span><span class="op" id="5353498">(</span><span class="ident" id="5353499">i</span><span class="op" id="5353500">.</span><span class="ident" id="5353501">Out</span><span class="op" id="5353504">)</span><span class="op" id="5353505">,</span>&nbsp;<span class="string" id="5353507">&#34;,&nbsp;&#34;</span><span class="op" id="5353511">,</span>&nbsp;<span class="ident" id="5353513">u32</span><span class="op" id="5353516">(</span><span class="ident" id="5353517">i</span><span class="op" id="5353518">.</span><span class="ident" id="5353519">Arg</span><span class="op" id="5353522">)</span><span class="op" id="5353523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353526">case</span>&nbsp;<span class="ident" id="5353531">InstAltMatch</span><span class="op" id="5353543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353547">bw</span><span class="op" id="5353549">(</span><span class="ident" id="5353550">b</span><span class="op" id="5353551">,</span>&nbsp;<span class="string" id="5353553">&#34;altmatch&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5353567">,</span>&nbsp;<span class="ident" id="5353569">u32</span><span class="op" id="5353572">(</span><span class="ident" id="5353573">i</span><span class="op" id="5353574">.</span><span class="ident" id="5353575">Out</span><span class="op" id="5353578">)</span><span class="op" id="5353579">,</span>&nbsp;<span class="string" id="5353581">&#34;,&nbsp;&#34;</span><span class="op" id="5353585">,</span>&nbsp;<span class="ident" id="5353587">u32</span><span class="op" id="5353590">(</span><span class="ident" id="5353591">i</span><span class="op" id="5353592">.</span><span class="ident" id="5353593">Arg</span><span class="op" id="5353596">)</span><span class="op" id="5353597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353600">case</span>&nbsp;<span class="ident" id="5353605">InstCapture</span><span class="op" id="5353616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353620">bw</span><span class="op" id="5353622">(</span><span class="ident" id="5353623">b</span><span class="op" id="5353624">,</span>&nbsp;<span class="string" id="5353626">&#34;cap&nbsp;&#34;</span><span class="op" id="5353632">,</span>&nbsp;<span class="ident" id="5353634">u32</span><span class="op" id="5353637">(</span><span class="ident" id="5353638">i</span><span class="op" id="5353639">.</span><span class="ident" id="5353640">Arg</span><span class="op" id="5353643">)</span><span class="op" id="5353644">,</span>&nbsp;<span class="string" id="5353646">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5353652">,</span>&nbsp;<span class="ident" id="5353654">u32</span><span class="op" id="5353657">(</span><span class="ident" id="5353658">i</span><span class="op" id="5353659">.</span><span class="ident" id="5353660">Out</span><span class="op" id="5353663">)</span><span class="op" id="5353664">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353667">case</span>&nbsp;<span class="ident" id="5353672">InstEmptyWidth</span><span class="op" id="5353686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353690">bw</span><span class="op" id="5353692">(</span><span class="ident" id="5353693">b</span><span class="op" id="5353694">,</span>&nbsp;<span class="string" id="5353696">&#34;empty&nbsp;&#34;</span><span class="op" id="5353704">,</span>&nbsp;<span class="ident" id="5353706">u32</span><span class="op" id="5353709">(</span><span class="ident" id="5353710">i</span><span class="op" id="5353711">.</span><span class="ident" id="5353712">Arg</span><span class="op" id="5353715">)</span><span class="op" id="5353716">,</span>&nbsp;<span class="string" id="5353718">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5353724">,</span>&nbsp;<span class="ident" id="5353726">u32</span><span class="op" id="5353729">(</span><span class="ident" id="5353730">i</span><span class="op" id="5353731">.</span><span class="ident" id="5353732">Out</span><span class="op" id="5353735">)</span><span class="op" id="5353736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353739">case</span>&nbsp;<span class="ident" id="5353744">InstMatch</span><span class="op" id="5353753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353757">bw</span><span class="op" id="5353759">(</span><span class="ident" id="5353760">b</span><span class="op" id="5353761">,</span>&nbsp;<span class="string" id="5353763">&#34;match&#34;</span><span class="op" id="5353770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353773">case</span>&nbsp;<span class="ident" id="5353778">InstFail</span><span class="op" id="5353786">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353790">bw</span><span class="op" id="5353792">(</span><span class="ident" id="5353793">b</span><span class="op" id="5353794">,</span>&nbsp;<span class="string" id="5353796">&#34;fail&#34;</span><span class="op" id="5353802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353805">case</span>&nbsp;<span class="ident" id="5353810">InstNop</span><span class="op" id="5353817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353821">bw</span><span class="op" id="5353823">(</span><span class="ident" id="5353824">b</span><span class="op" id="5353825">,</span>&nbsp;<span class="string" id="5353827">&#34;nop&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5353836">,</span>&nbsp;<span class="ident" id="5353838">u32</span><span class="op" id="5353841">(</span><span class="ident" id="5353842">i</span><span class="op" id="5353843">.</span><span class="ident" id="5353844">Out</span><span class="op" id="5353847">)</span><span class="op" id="5353848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353851">case</span>&nbsp;<span class="ident" id="5353856">InstRune</span><span class="op" id="5353864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353868">if</span>&nbsp;<span class="ident" id="5353871">i</span><span class="op" id="5353872">.</span><span class="ident" id="5353873">Rune</span>&nbsp;<span class="op" id="5353878">==</span>&nbsp;<span class="ident" id="5353881">nil</span>&nbsp;<span class="op" id="5353885">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5353890">//&nbsp;shouldn&#39;t&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353913">bw</span><span class="op" id="5353915">(</span><span class="ident" id="5353916">b</span><span class="op" id="5353917">,</span>&nbsp;<span class="string" id="5353919">&#34;rune&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="5353931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5353935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5353939">bw</span><span class="op" id="5353941">(</span><span class="ident" id="5353942">b</span><span class="op" id="5353943">,</span>&nbsp;<span class="string" id="5353945">&#34;rune&nbsp;&#34;</span><span class="op" id="5353952">,</span>&nbsp;<span class="ident" id="5353954">strconv</span><span class="op" id="5353961">.</span><span class="ident" id="5353962">QuoteToASCII</span><span class="op" id="5353974">(</span><span class="builtintype" id="5353975">string</span><span class="op" id="5353981">(</span><span class="ident" id="5353982">i</span><span class="op" id="5353983">.</span><span class="ident" id="5353984">Rune</span><span class="op" id="5353988">)</span><span class="op" id="5353989">)</span><span class="op" id="5353990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5353994">if</span>&nbsp;<span class="ident" id="5353997">Flags</span><span class="op" id="5354002">(</span><span class="ident" id="5354003">i</span><span class="op" id="5354004">.</span><span class="ident" id="5354005">Arg</span><span class="op" id="5354008">)</span><span class="op" id="5354009">&amp;</span><span class="ident" id="5354010">FoldCase</span>&nbsp;<span class="op" id="5354019">!=</span>&nbsp;<span class="num" id="5354022">0</span>&nbsp;<span class="op" id="5354024">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5354029">bw</span><span class="op" id="5354031">(</span><span class="ident" id="5354032">b</span><span class="op" id="5354033">,</span>&nbsp;<span class="string" id="5354035">&#34;/i&#34;</span><span class="op" id="5354039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5354043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5354047">bw</span><span class="op" id="5354049">(</span><span class="ident" id="5354050">b</span><span class="op" id="5354051">,</span>&nbsp;<span class="string" id="5354053">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5354059">,</span>&nbsp;<span class="ident" id="5354061">u32</span><span class="op" id="5354064">(</span><span class="ident" id="5354065">i</span><span class="op" id="5354066">.</span><span class="ident" id="5354067">Out</span><span class="op" id="5354070">)</span><span class="op" id="5354071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5354074">case</span>&nbsp;<span class="ident" id="5354079">InstRune1</span><span class="op" id="5354088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5354092">bw</span><span class="op" id="5354094">(</span><span class="ident" id="5354095">b</span><span class="op" id="5354096">,</span>&nbsp;<span class="string" id="5354098">&#34;rune1&nbsp;&#34;</span><span class="op" id="5354106">,</span>&nbsp;<span class="ident" id="5354108">strconv</span><span class="op" id="5354115">.</span><span class="ident" id="5354116">QuoteToASCII</span><span class="op" id="5354128">(</span><span class="builtintype" id="5354129">string</span><span class="op" id="5354135">(</span><span class="ident" id="5354136">i</span><span class="op" id="5354137">.</span><span class="ident" id="5354138">Rune</span><span class="op" id="5354142">)</span><span class="op" id="5354143">)</span><span class="op" id="5354144">,</span>&nbsp;<span class="string" id="5354146">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5354152">,</span>&nbsp;<span class="ident" id="5354154">u32</span><span class="op" id="5354157">(</span><span class="ident" id="5354158">i</span><span class="op" id="5354159">.</span><span class="ident" id="5354160">Out</span><span class="op" id="5354163">)</span><span class="op" id="5354164">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5354167">case</span>&nbsp;<span class="ident" id="5354172">InstRuneAny</span><span class="op" id="5354183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5354187">bw</span><span class="op" id="5354189">(</span><span class="ident" id="5354190">b</span><span class="op" id="5354191">,</span>&nbsp;<span class="string" id="5354193">&#34;any&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5354202">,</span>&nbsp;<span class="ident" id="5354204">u32</span><span class="op" id="5354207">(</span><span class="ident" id="5354208">i</span><span class="op" id="5354209">.</span><span class="ident" id="5354210">Out</span><span class="op" id="5354213">)</span><span class="op" id="5354214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5354217">case</span>&nbsp;<span class="ident" id="5354222">InstRuneAnyNotNL</span><span class="op" id="5354238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5354242">bw</span><span class="op" id="5354244">(</span><span class="ident" id="5354245">b</span><span class="op" id="5354246">,</span>&nbsp;<span class="string" id="5354248">&#34;anynotnl&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5354262">,</span>&nbsp;<span class="ident" id="5354264">u32</span><span class="op" id="5354267">(</span><span class="ident" id="5354268">i</span><span class="op" id="5354269">.</span><span class="ident" id="5354270">Out</span><span class="op" id="5354273">)</span><span class="op" id="5354274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5354277">}</span><br>
<span class="lineno">345</span><span class="op" id="5354279">}</span>
</div>
</body>
</html>
