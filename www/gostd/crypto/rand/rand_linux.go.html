<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3422768">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3422824">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3422878">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3422929">package</span>&nbsp;<span class="ident" id="3422937">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422943">import</span>&nbsp;<span class="op" id="3422950">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3422953">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3422973">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3422980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3422983">func</span>&nbsp;<span class="ident" id="3422988">init</span><span class="op" id="3422992">(</span><span class="op" id="3422993">)</span>&nbsp;<span class="op" id="3422995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422998">altGetRandom</span>&nbsp;<span class="op" id="3423011">=</span>&nbsp;<span class="ident" id="3423013">getRandomLinux</span><br>
<span class="lineno"></span><span class="op" id="3423028">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3423031">var</span>&nbsp;<span class="op" id="3423035">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423038">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3423049">sync</span><span class="op" id="3423053">.</span><span class="ident" id="3423054">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423060">useSyscall</span>&nbsp;<span class="builtintype" id="3423071">bool</span><br>
<span class="lineno"></span><span class="op" id="3423076">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3423079">func</span>&nbsp;<span class="ident" id="3423084">pickStrategy</span><span class="op" id="3423096">(</span><span class="op" id="3423097">)</span>&nbsp;<span class="op" id="3423099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3423102">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3423166">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3423201">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3423243">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3423312">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423372">var</span>&nbsp;<span class="ident" id="3423376">buf</span>&nbsp;<span class="op" id="3423380">[</span><span class="num" id="3423381">1</span><span class="op" id="3423382">]</span><span class="builtintype" id="3423383">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423389">n</span><span class="op" id="3423390">,</span>&nbsp;<span class="ident" id="3423392">err</span>&nbsp;<span class="op" id="3423396">:=</span>&nbsp;<span class="ident" id="3423399">syscall</span><span class="op" id="3423406">.</span><span class="ident" id="3423407">GetRandom</span><span class="op" id="3423416">(</span><span class="ident" id="3423417">buf</span><span class="op" id="3423420">[</span><span class="op" id="3423421">:</span><span class="op" id="3423422">]</span><span class="op" id="3423423">,</span>&nbsp;<span class="ident" id="3423425">syscall</span><span class="op" id="3423432">.</span><span class="ident" id="3423433">GRND_NONBLOCK</span><span class="op" id="3423446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423449">useSyscall</span>&nbsp;<span class="op" id="3423460">=</span>&nbsp;<span class="ident" id="3423462">n</span>&nbsp;<span class="op" id="3423464">==</span>&nbsp;<span class="num" id="3423467">1</span>&nbsp;<span class="op" id="3423469">&amp;&amp;</span>&nbsp;<span class="ident" id="3423472">err</span>&nbsp;<span class="op" id="3423476">==</span>&nbsp;<span class="ident" id="3423479">nil</span><br>
<span class="lineno">30</span><span class="op" id="3423483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3423486">func</span>&nbsp;<span class="ident" id="3423491">getRandomLinux</span><span class="op" id="3423505">(</span><span class="ident" id="3423506">p</span>&nbsp;<span class="op" id="3423508">[</span><span class="op" id="3423509">]</span><span class="builtintype" id="3423510">byte</span><span class="op" id="3423514">)</span>&nbsp;<span class="op" id="3423516">(</span><span class="ident" id="3423517">ok</span>&nbsp;<span class="builtintype" id="3423520">bool</span><span class="op" id="3423524">)</span>&nbsp;<span class="op" id="3423526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423529">once</span><span class="op" id="3423533">.</span><span class="ident" id="3423534">Do</span><span class="op" id="3423536">(</span><span class="ident" id="3423537">pickStrategy</span><span class="op" id="3423549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423552">if</span>&nbsp;<span class="op" id="3423555">!</span><span class="ident" id="3423556">useSyscall</span>&nbsp;<span class="op" id="3423567">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423571">return</span>&nbsp;<span class="builtintype" id="3423578">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423588">n</span><span class="op" id="3423589">,</span>&nbsp;<span class="ident" id="3423591">err</span>&nbsp;<span class="op" id="3423595">:=</span>&nbsp;<span class="ident" id="3423598">syscall</span><span class="op" id="3423605">.</span><span class="ident" id="3423606">GetRandom</span><span class="op" id="3423615">(</span><span class="ident" id="3423616">p</span><span class="op" id="3423617">,</span>&nbsp;<span class="num" id="3423619">0</span><span class="op" id="3423620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423623">return</span>&nbsp;<span class="ident" id="3423630">n</span>&nbsp;<span class="op" id="3423632">==</span>&nbsp;<span class="builtinfunc" id="3423635">len</span><span class="op" id="3423638">(</span><span class="ident" id="3423639">p</span><span class="op" id="3423640">)</span>&nbsp;<span class="op" id="3423642">&amp;&amp;</span>&nbsp;<span class="ident" id="3423645">err</span>&nbsp;<span class="op" id="3423649">==</span>&nbsp;<span class="ident" id="3423652">nil</span><br>
<span class="lineno"></span><span class="op" id="3423656">}</span>
</div>
</body>
</html>
