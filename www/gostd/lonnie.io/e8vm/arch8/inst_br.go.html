<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4784113">package</span>&nbsp;<span class="ident" id="4784121">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4784128">//&nbsp;InstBr&nbsp;exectues&nbsp;branch&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="4784166">type</span>&nbsp;<span class="ident" id="4784171">instBr</span>&nbsp;<span class="keyword" id="4784178">struct</span><span class="op" id="4784184">{</span><span class="op" id="4784185">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="4784188">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="4784219">//&nbsp;Might&nbsp;return&nbsp;invalid&nbsp;instruction&nbsp;exception.</span><br>
<span class="lineno"></span><span class="keyword" id="4784266">func</span>&nbsp;<span class="op" id="4784271">(</span><span class="ident" id="4784272">i</span>&nbsp;<span class="op" id="4784274">*</span><span class="ident" id="4784275">instBr</span><span class="op" id="4784281">)</span>&nbsp;<span class="ident" id="4784283">I</span><span class="op" id="4784284">(</span><span class="ident" id="4784285">cpu</span>&nbsp;<span class="op" id="4784289">*</span><span class="ident" id="4784290">cpu</span><span class="op" id="4784293">,</span>&nbsp;<span class="ident" id="4784295">in</span>&nbsp;<span class="builtintype" id="4784298">uint32</span><span class="op" id="4784304">)</span>&nbsp;<span class="op" id="4784306">*</span><span class="ident" id="4784307">Excep</span>&nbsp;<span class="op" id="4784313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784316">op</span>&nbsp;<span class="op" id="4784319">:=</span>&nbsp;<span class="op" id="4784322">(</span><span class="ident" id="4784323">in</span>&nbsp;<span class="op" id="4784326">&gt;&gt;</span>&nbsp;<span class="num" id="4784329">24</span><span class="op" id="4784331">)</span>&nbsp;<span class="op" id="4784333">&amp;</span>&nbsp;<span class="num" id="4784335">0xff</span>&nbsp;&nbsp;<span class="comment" id="4784341">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784353">src1</span>&nbsp;<span class="op" id="4784358">:=</span>&nbsp;<span class="op" id="4784361">(</span><span class="ident" id="4784362">in</span>&nbsp;<span class="op" id="4784365">&gt;&gt;</span>&nbsp;<span class="num" id="4784368">21</span><span class="op" id="4784370">)</span>&nbsp;<span class="op" id="4784372">&amp;</span>&nbsp;<span class="num" id="4784374">0x7</span>&nbsp;<span class="comment" id="4784378">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784390">src2</span>&nbsp;<span class="op" id="4784395">:=</span>&nbsp;<span class="op" id="4784398">(</span><span class="ident" id="4784399">in</span>&nbsp;<span class="op" id="4784402">&gt;&gt;</span>&nbsp;<span class="num" id="4784405">18</span><span class="op" id="4784407">)</span>&nbsp;<span class="op" id="4784409">&amp;</span>&nbsp;<span class="num" id="4784411">0x7</span>&nbsp;<span class="comment" id="4784415">//&nbsp;(21:18]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784427">im</span>&nbsp;<span class="op" id="4784430">:=</span>&nbsp;<span class="ident" id="4784433">in</span>&nbsp;<span class="op" id="4784436">&amp;</span>&nbsp;<span class="num" id="4784438">0x3ffff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4784452">//&nbsp;(18:0]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784464">s1</span>&nbsp;<span class="op" id="4784467">:=</span>&nbsp;<span class="ident" id="4784470">cpu</span><span class="op" id="4784473">.</span><span class="ident" id="4784474">regs</span><span class="op" id="4784478">[</span><span class="ident" id="4784479">src1</span><span class="op" id="4784483">]</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784486">s2</span>&nbsp;<span class="op" id="4784489">:=</span>&nbsp;<span class="ident" id="4784492">cpu</span><span class="op" id="4784495">.</span><span class="ident" id="4784496">regs</span><span class="op" id="4784500">[</span><span class="ident" id="4784501">src2</span><span class="op" id="4784505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784508">pc</span>&nbsp;<span class="op" id="4784511">:=</span>&nbsp;<span class="ident" id="4784514">cpu</span><span class="op" id="4784517">.</span><span class="ident" id="4784518">regs</span><span class="op" id="4784522">[</span><span class="ident" id="4784523">PC</span><span class="op" id="4784525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784528">br</span>&nbsp;<span class="op" id="4784531">:=</span>&nbsp;<span class="ident" id="4784534">pc</span>&nbsp;<span class="op" id="4784537">+</span>&nbsp;<span class="builtintype" id="4784539">uint32</span><span class="op" id="4784545">(</span><span class="builtintype" id="4784546">int32</span><span class="op" id="4784551">(</span><span class="ident" id="4784552">im</span><span class="op" id="4784554">&lt;&lt;</span><span class="num" id="4784556">14</span><span class="op" id="4784558">)</span><span class="op" id="4784559">&gt;&gt;</span><span class="num" id="4784561">12</span><span class="op" id="4784563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784567">switch</span>&nbsp;<span class="ident" id="4784574">op</span>&nbsp;<span class="op" id="4784577">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784580">case</span>&nbsp;<span class="num" id="4784585">32</span><span class="op" id="4784587">:</span>&nbsp;<span class="comment" id="4784589">//&nbsp;bne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784598">if</span>&nbsp;<span class="ident" id="4784601">s1</span>&nbsp;<span class="op" id="4784604">!=</span>&nbsp;<span class="ident" id="4784607">s2</span>&nbsp;<span class="op" id="4784610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784615">pc</span>&nbsp;<span class="op" id="4784618">=</span>&nbsp;<span class="ident" id="4784620">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784628">case</span>&nbsp;<span class="num" id="4784633">33</span><span class="op" id="4784635">:</span>&nbsp;<span class="comment" id="4784637">//&nbsp;beq</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784646">if</span>&nbsp;<span class="ident" id="4784649">s1</span>&nbsp;<span class="op" id="4784652">==</span>&nbsp;<span class="ident" id="4784655">s2</span>&nbsp;<span class="op" id="4784658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784663">pc</span>&nbsp;<span class="op" id="4784666">=</span>&nbsp;<span class="ident" id="4784668">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784676">default</span><span class="op" id="4784683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784687">return</span>&nbsp;<span class="ident" id="4784694">errInvalidInst</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4784710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4784714">cpu</span><span class="op" id="4784717">.</span><span class="ident" id="4784718">regs</span><span class="op" id="4784722">[</span><span class="ident" id="4784723">PC</span><span class="op" id="4784725">]</span>&nbsp;<span class="op" id="4784727">=</span>&nbsp;<span class="ident" id="4784729">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4784733">return</span>&nbsp;<span class="ident" id="4784740">nil</span><br>
<span class="lineno"></span><span class="op" id="4784744">}</span>
</div>
</body>
</html>
