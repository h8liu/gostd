<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="909533">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="909588">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="909642">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="909693">package</span>&nbsp;<span class="ident" id="909701">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="909715">import</span>&nbsp;<span class="op" id="909722">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909725">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909732">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909740">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909751">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909762">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909770">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909781">&#34;sync&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="909789">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="909799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="909802">//&nbsp;negative&nbsp;zero&nbsp;is&nbsp;a&nbsp;good&nbsp;test&nbsp;because:</span><br>
<span class="lineno"></span><span class="comment" id="909843">//&nbsp;&nbsp;1)&nbsp;0&nbsp;and&nbsp;-0&nbsp;are&nbsp;equal,&nbsp;yet&nbsp;have&nbsp;distinct&nbsp;representations.</span><br>
<span class="lineno">20</span><span class="comment" id="909905">//&nbsp;&nbsp;2)&nbsp;0&nbsp;is&nbsp;represented&nbsp;as&nbsp;all&nbsp;zeros,&nbsp;-0&nbsp;isn&#39;t.</span><br>
<span class="lineno"></span><span class="comment" id="909953">//&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;the&nbsp;language&nbsp;spec&nbsp;actually&nbsp;requires&nbsp;this&nbsp;behavior,</span><br>
<span class="lineno"></span><span class="comment" id="910020">//&nbsp;but&nbsp;it&#39;s&nbsp;what&nbsp;the&nbsp;current&nbsp;map&nbsp;implementation&nbsp;does.</span><br>
<span class="lineno"></span><span class="keyword" id="910074">func</span>&nbsp;<span class="ident" id="910079">TestNegativeZero</span><span class="op" id="910095">(</span><span class="ident" id="910096">t</span>&nbsp;<span class="op" id="910098">*</span><span class="ident" id="910099">testing</span><span class="op" id="910106">.</span><span class="ident" id="910107">T</span><span class="op" id="910108">)</span>&nbsp;<span class="op" id="910110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910113">m</span>&nbsp;<span class="op" id="910115">:=</span>&nbsp;<span class="builtinfunc" id="910118">make</span><span class="op" id="910122">(</span><span class="keyword" id="910123">map</span><span class="op" id="910126">[</span><span class="builtintype" id="910127">float64</span><span class="op" id="910134">]</span><span class="builtintype" id="910135">bool</span><span class="op" id="910139">,</span>&nbsp;<span class="num" id="910141">0</span><span class="op" id="910142">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910146">m</span><span class="op" id="910147">[</span><span class="op" id="910148">+</span><span class="num" id="910149">0.0</span><span class="op" id="910152">]</span>&nbsp;<span class="op" id="910154">=</span>&nbsp;<span class="builtintype" id="910156">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910162">m</span><span class="op" id="910163">[</span><span class="ident" id="910164">math</span><span class="op" id="910168">.</span><span class="ident" id="910169">Copysign</span><span class="op" id="910177">(</span><span class="num" id="910178">0.0</span><span class="op" id="910181">,</span>&nbsp;<span class="op" id="910183">-</span><span class="num" id="910184">1.0</span><span class="op" id="910187">)</span><span class="op" id="910188">]</span>&nbsp;<span class="op" id="910190">=</span>&nbsp;<span class="builtintype" id="910192">true</span>&nbsp;<span class="comment" id="910197">//&nbsp;should&nbsp;overwrite&nbsp;+0&nbsp;entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910228">if</span>&nbsp;<span class="builtinfunc" id="910231">len</span><span class="op" id="910234">(</span><span class="ident" id="910235">m</span><span class="op" id="910236">)</span>&nbsp;<span class="op" id="910238">!=</span>&nbsp;<span class="num" id="910241">1</span>&nbsp;<span class="op" id="910243">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910247">t</span><span class="op" id="910248">.</span><span class="ident" id="910249">Error</span><span class="op" id="910254">(</span><span class="string" id="910255">&#34;length&nbsp;wrong&#34;</span><span class="op" id="910269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910276">for</span>&nbsp;<span class="ident" id="910280">k</span>&nbsp;<span class="op" id="910282">:=</span>&nbsp;<span class="keyword" id="910285">range</span>&nbsp;<span class="ident" id="910291">m</span>&nbsp;<span class="op" id="910293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910297">if</span>&nbsp;<span class="ident" id="910300">math</span><span class="op" id="910304">.</span><span class="ident" id="910305">Copysign</span><span class="op" id="910313">(</span><span class="num" id="910314">1.0</span><span class="op" id="910317">,</span>&nbsp;<span class="ident" id="910319">k</span><span class="op" id="910320">)</span>&nbsp;<span class="op" id="910322">&gt;</span>&nbsp;<span class="num" id="910324">0</span>&nbsp;<span class="op" id="910326">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910331">t</span><span class="op" id="910332">.</span><span class="ident" id="910333">Error</span><span class="op" id="910338">(</span><span class="string" id="910339">&#34;wrong&nbsp;sign&#34;</span><span class="op" id="910351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910362">m</span>&nbsp;<span class="op" id="910364">=</span>&nbsp;<span class="builtinfunc" id="910366">make</span><span class="op" id="910370">(</span><span class="keyword" id="910371">map</span><span class="op" id="910374">[</span><span class="builtintype" id="910375">float64</span><span class="op" id="910382">]</span><span class="builtintype" id="910383">bool</span><span class="op" id="910387">,</span>&nbsp;<span class="num" id="910389">0</span><span class="op" id="910390">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910393">m</span><span class="op" id="910394">[</span><span class="ident" id="910395">math</span><span class="op" id="910399">.</span><span class="ident" id="910400">Copysign</span><span class="op" id="910408">(</span><span class="num" id="910409">0.0</span><span class="op" id="910412">,</span>&nbsp;<span class="op" id="910414">-</span><span class="num" id="910415">1.0</span><span class="op" id="910418">)</span><span class="op" id="910419">]</span>&nbsp;<span class="op" id="910421">=</span>&nbsp;<span class="builtintype" id="910423">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910429">m</span><span class="op" id="910430">[</span><span class="op" id="910431">+</span><span class="num" id="910432">0.0</span><span class="op" id="910435">]</span>&nbsp;<span class="op" id="910437">=</span>&nbsp;<span class="builtintype" id="910439">true</span>&nbsp;<span class="comment" id="910444">//&nbsp;should&nbsp;overwrite&nbsp;-0.0&nbsp;entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910477">if</span>&nbsp;<span class="builtinfunc" id="910480">len</span><span class="op" id="910483">(</span><span class="ident" id="910484">m</span><span class="op" id="910485">)</span>&nbsp;<span class="op" id="910487">!=</span>&nbsp;<span class="num" id="910490">1</span>&nbsp;<span class="op" id="910492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910496">t</span><span class="op" id="910497">.</span><span class="ident" id="910498">Error</span><span class="op" id="910503">(</span><span class="string" id="910504">&#34;length&nbsp;wrong&#34;</span><span class="op" id="910518">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910525">for</span>&nbsp;<span class="ident" id="910529">k</span>&nbsp;<span class="op" id="910531">:=</span>&nbsp;<span class="keyword" id="910534">range</span>&nbsp;<span class="ident" id="910540">m</span>&nbsp;<span class="op" id="910542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910546">if</span>&nbsp;<span class="ident" id="910549">math</span><span class="op" id="910553">.</span><span class="ident" id="910554">Copysign</span><span class="op" id="910562">(</span><span class="num" id="910563">1.0</span><span class="op" id="910566">,</span>&nbsp;<span class="ident" id="910568">k</span><span class="op" id="910569">)</span>&nbsp;<span class="op" id="910571">&lt;</span>&nbsp;<span class="num" id="910573">0</span>&nbsp;<span class="op" id="910575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910580">t</span><span class="op" id="910581">.</span><span class="ident" id="910582">Error</span><span class="op" id="910587">(</span><span class="string" id="910588">&#34;wrong&nbsp;sign&#34;</span><span class="op" id="910600">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910607">}</span><br>
<span class="lineno"></span><span class="op" id="910609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="910612">//&nbsp;nan&nbsp;is&nbsp;a&nbsp;good&nbsp;test&nbsp;because&nbsp;nan&nbsp;!=&nbsp;nan,&nbsp;and&nbsp;nan&nbsp;has</span><br>
<span class="lineno">55</span><span class="comment" id="910666">//&nbsp;a&nbsp;randomized&nbsp;hash&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="910694">func</span>&nbsp;<span class="ident" id="910699">TestNan</span><span class="op" id="910706">(</span><span class="ident" id="910707">t</span>&nbsp;<span class="op" id="910709">*</span><span class="ident" id="910710">testing</span><span class="op" id="910717">.</span><span class="ident" id="910718">T</span><span class="op" id="910719">)</span>&nbsp;<span class="op" id="910721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910724">m</span>&nbsp;<span class="op" id="910726">:=</span>&nbsp;<span class="builtinfunc" id="910729">make</span><span class="op" id="910733">(</span><span class="keyword" id="910734">map</span><span class="op" id="910737">[</span><span class="builtintype" id="910738">float64</span><span class="op" id="910745">]</span><span class="builtintype" id="910746">int</span><span class="op" id="910749">,</span>&nbsp;<span class="num" id="910751">0</span><span class="op" id="910752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910755">nan</span>&nbsp;<span class="op" id="910759">:=</span>&nbsp;<span class="ident" id="910762">math</span><span class="op" id="910766">.</span><span class="ident" id="910767">NaN</span><span class="op" id="910770">(</span><span class="op" id="910771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910774">m</span><span class="op" id="910775">[</span><span class="ident" id="910776">nan</span><span class="op" id="910779">]</span>&nbsp;<span class="op" id="910781">=</span>&nbsp;<span class="num" id="910783">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910786">m</span><span class="op" id="910787">[</span><span class="ident" id="910788">nan</span><span class="op" id="910791">]</span>&nbsp;<span class="op" id="910793">=</span>&nbsp;<span class="num" id="910795">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910798">m</span><span class="op" id="910799">[</span><span class="ident" id="910800">nan</span><span class="op" id="910803">]</span>&nbsp;<span class="op" id="910805">=</span>&nbsp;<span class="num" id="910807">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910810">if</span>&nbsp;<span class="builtinfunc" id="910813">len</span><span class="op" id="910816">(</span><span class="ident" id="910817">m</span><span class="op" id="910818">)</span>&nbsp;<span class="op" id="910820">!=</span>&nbsp;<span class="num" id="910823">3</span>&nbsp;<span class="op" id="910825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910829">t</span><span class="op" id="910830">.</span><span class="ident" id="910831">Error</span><span class="op" id="910836">(</span><span class="string" id="910837">&#34;length&nbsp;wrong&#34;</span><span class="op" id="910851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910854">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910857">s</span>&nbsp;<span class="op" id="910859">:=</span>&nbsp;<span class="num" id="910862">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910865">for</span>&nbsp;<span class="ident" id="910869">k</span><span class="op" id="910870">,</span>&nbsp;<span class="ident" id="910872">v</span>&nbsp;<span class="op" id="910874">:=</span>&nbsp;<span class="keyword" id="910877">range</span>&nbsp;<span class="ident" id="910883">m</span>&nbsp;<span class="op" id="910885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910889">if</span>&nbsp;<span class="ident" id="910892">k</span>&nbsp;<span class="op" id="910894">==</span>&nbsp;<span class="ident" id="910897">k</span>&nbsp;<span class="op" id="910899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910904">t</span><span class="op" id="910905">.</span><span class="ident" id="910906">Error</span><span class="op" id="910911">(</span><span class="string" id="910912">&#34;nan&nbsp;disappeared&#34;</span><span class="op" id="910929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910933">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="910937">if</span>&nbsp;<span class="op" id="910940">(</span><span class="ident" id="910941">v</span>&nbsp;<span class="op" id="910943">&amp;</span>&nbsp;<span class="op" id="910945">(</span><span class="ident" id="910946">v</span>&nbsp;<span class="op" id="910948">-</span>&nbsp;<span class="num" id="910950">1</span><span class="op" id="910951">)</span><span class="op" id="910952">)</span>&nbsp;<span class="op" id="910954">!=</span>&nbsp;<span class="num" id="910957">0</span>&nbsp;<span class="op" id="910959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910964">t</span><span class="op" id="910965">.</span><span class="ident" id="910966">Error</span><span class="op" id="910971">(</span><span class="string" id="910972">&#34;value&nbsp;wrong&#34;</span><span class="op" id="910985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="910989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="910993">s</span>&nbsp;<span class="op" id="910995">|=</span>&nbsp;<span class="ident" id="910998">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911001">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911004">if</span>&nbsp;<span class="ident" id="911007">s</span>&nbsp;<span class="op" id="911009">!=</span>&nbsp;<span class="num" id="911012">7</span>&nbsp;<span class="op" id="911014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911018">t</span><span class="op" id="911019">.</span><span class="ident" id="911020">Error</span><span class="op" id="911025">(</span><span class="string" id="911026">&#34;values&nbsp;wrong&#34;</span><span class="op" id="911040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911043">}</span><br>
<span class="lineno"></span><span class="op" id="911045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="911048">//&nbsp;Maps&nbsp;aren&#39;t&nbsp;actually&nbsp;copied&nbsp;on&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="keyword" id="911094">func</span>&nbsp;<span class="ident" id="911099">TestAlias</span><span class="op" id="911108">(</span><span class="ident" id="911109">t</span>&nbsp;<span class="op" id="911111">*</span><span class="ident" id="911112">testing</span><span class="op" id="911119">.</span><span class="ident" id="911120">T</span><span class="op" id="911121">)</span>&nbsp;<span class="op" id="911123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911126">m</span>&nbsp;<span class="op" id="911128">:=</span>&nbsp;<span class="builtinfunc" id="911131">make</span><span class="op" id="911135">(</span><span class="keyword" id="911136">map</span><span class="op" id="911139">[</span><span class="builtintype" id="911140">int</span><span class="op" id="911143">]</span><span class="builtintype" id="911144">int</span><span class="op" id="911147">,</span>&nbsp;<span class="num" id="911149">0</span><span class="op" id="911150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911153">m</span><span class="op" id="911154">[</span><span class="num" id="911155">0</span><span class="op" id="911156">]</span>&nbsp;<span class="op" id="911158">=</span>&nbsp;<span class="num" id="911160">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911163">n</span>&nbsp;<span class="op" id="911165">:=</span>&nbsp;<span class="ident" id="911168">m</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911171">n</span><span class="op" id="911172">[</span><span class="num" id="911173">0</span><span class="op" id="911174">]</span>&nbsp;<span class="op" id="911176">=</span>&nbsp;<span class="num" id="911178">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911181">if</span>&nbsp;<span class="ident" id="911184">m</span><span class="op" id="911185">[</span><span class="num" id="911186">0</span><span class="op" id="911187">]</span>&nbsp;<span class="op" id="911189">!=</span>&nbsp;<span class="num" id="911192">6</span>&nbsp;<span class="op" id="911194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911198">t</span><span class="op" id="911199">.</span><span class="ident" id="911200">Error</span><span class="op" id="911205">(</span><span class="string" id="911206">&#34;alias&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="911225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911228">}</span><br>
<span class="lineno"></span><span class="op" id="911230">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="911233">func</span>&nbsp;<span class="ident" id="911238">TestGrowWithNaN</span><span class="op" id="911253">(</span><span class="ident" id="911254">t</span>&nbsp;<span class="op" id="911256">*</span><span class="ident" id="911257">testing</span><span class="op" id="911264">.</span><span class="ident" id="911265">T</span><span class="op" id="911266">)</span>&nbsp;<span class="op" id="911268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911271">m</span>&nbsp;<span class="op" id="911273">:=</span>&nbsp;<span class="builtinfunc" id="911276">make</span><span class="op" id="911280">(</span><span class="keyword" id="911281">map</span><span class="op" id="911284">[</span><span class="builtintype" id="911285">float64</span><span class="op" id="911292">]</span><span class="builtintype" id="911293">int</span><span class="op" id="911296">,</span>&nbsp;<span class="num" id="911298">4</span><span class="op" id="911299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911302">nan</span>&nbsp;<span class="op" id="911306">:=</span>&nbsp;<span class="ident" id="911309">math</span><span class="op" id="911313">.</span><span class="ident" id="911314">NaN</span><span class="op" id="911317">(</span><span class="op" id="911318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911321">m</span><span class="op" id="911322">[</span><span class="ident" id="911323">nan</span><span class="op" id="911326">]</span>&nbsp;<span class="op" id="911328">=</span>&nbsp;<span class="num" id="911330">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911333">m</span><span class="op" id="911334">[</span><span class="ident" id="911335">nan</span><span class="op" id="911338">]</span>&nbsp;<span class="op" id="911340">=</span>&nbsp;<span class="num" id="911342">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911345">m</span><span class="op" id="911346">[</span><span class="ident" id="911347">nan</span><span class="op" id="911350">]</span>&nbsp;<span class="op" id="911352">=</span>&nbsp;<span class="num" id="911354">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911357">cnt</span>&nbsp;<span class="op" id="911361">:=</span>&nbsp;<span class="num" id="911364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911367">s</span>&nbsp;<span class="op" id="911369">:=</span>&nbsp;<span class="num" id="911372">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911375">growflag</span>&nbsp;<span class="op" id="911384">:=</span>&nbsp;<span class="builtintype" id="911387">true</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911393">for</span>&nbsp;<span class="ident" id="911397">k</span><span class="op" id="911398">,</span>&nbsp;<span class="ident" id="911400">v</span>&nbsp;<span class="op" id="911402">:=</span>&nbsp;<span class="keyword" id="911405">range</span>&nbsp;<span class="ident" id="911411">m</span>&nbsp;<span class="op" id="911413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911417">if</span>&nbsp;<span class="ident" id="911420">growflag</span>&nbsp;<span class="op" id="911429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="911434">//&nbsp;force&nbsp;a&nbsp;hashtable&nbsp;resize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911465">for</span>&nbsp;<span class="ident" id="911469">i</span>&nbsp;<span class="op" id="911471">:=</span>&nbsp;<span class="num" id="911474">0</span><span class="op" id="911475">;</span>&nbsp;<span class="ident" id="911477">i</span>&nbsp;<span class="op" id="911479">&lt;</span>&nbsp;<span class="num" id="911481">100</span><span class="op" id="911484">;</span>&nbsp;<span class="ident" id="911486">i</span><span class="op" id="911487">++</span>&nbsp;<span class="op" id="911490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911496">m</span><span class="op" id="911497">[</span><span class="builtintype" id="911498">float64</span><span class="op" id="911505">(</span><span class="ident" id="911506">i</span><span class="op" id="911507">)</span><span class="op" id="911508">]</span>&nbsp;<span class="op" id="911510">=</span>&nbsp;<span class="ident" id="911512">i</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911522">growflag</span>&nbsp;<span class="op" id="911531">=</span>&nbsp;<span class="builtintype" id="911533">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911545">if</span>&nbsp;<span class="ident" id="911548">k</span>&nbsp;<span class="op" id="911550">!=</span>&nbsp;<span class="ident" id="911553">k</span>&nbsp;<span class="op" id="911555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911560">cnt</span><span class="op" id="911563">++</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911569">s</span>&nbsp;<span class="op" id="911571">|=</span>&nbsp;<span class="ident" id="911574">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911584">if</span>&nbsp;<span class="ident" id="911587">cnt</span>&nbsp;<span class="op" id="911591">!=</span>&nbsp;<span class="num" id="911594">3</span>&nbsp;<span class="op" id="911596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911600">t</span><span class="op" id="911601">.</span><span class="ident" id="911602">Error</span><span class="op" id="911607">(</span><span class="string" id="911608">&#34;NaN&nbsp;keys&nbsp;lost&nbsp;during&nbsp;grow&#34;</span><span class="op" id="911635">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="911641">if</span>&nbsp;<span class="ident" id="911644">s</span>&nbsp;<span class="op" id="911646">!=</span>&nbsp;<span class="num" id="911649">7</span>&nbsp;<span class="op" id="911651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911655">t</span><span class="op" id="911656">.</span><span class="ident" id="911657">Error</span><span class="op" id="911662">(</span><span class="string" id="911663">&#34;NaN&nbsp;values&nbsp;lost&nbsp;during&nbsp;grow&#34;</span><span class="op" id="911692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="911695">}</span><br>
<span class="lineno"></span><span class="op" id="911697">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="911700">type</span>&nbsp;<span class="ident" id="911705">FloatInt</span>&nbsp;<span class="keyword" id="911714">struct</span>&nbsp;<span class="op" id="911721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911724">x</span>&nbsp;<span class="builtintype" id="911726">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911735">y</span>&nbsp;<span class="builtintype" id="911737">int</span><br>
<span class="lineno"></span><span class="op" id="911741">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="911744">func</span>&nbsp;<span class="ident" id="911749">TestGrowWithNegativeZero</span><span class="op" id="911773">(</span><span class="ident" id="911774">t</span>&nbsp;<span class="op" id="911776">*</span><span class="ident" id="911777">testing</span><span class="op" id="911784">.</span><span class="ident" id="911785">T</span><span class="op" id="911786">)</span>&nbsp;<span class="op" id="911788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911791">negzero</span>&nbsp;<span class="op" id="911799">:=</span>&nbsp;<span class="ident" id="911802">math</span><span class="op" id="911806">.</span><span class="ident" id="911807">Copysign</span><span class="op" id="911815">(</span><span class="num" id="911816">0.0</span><span class="op" id="911819">,</span>&nbsp;<span class="op" id="911821">-</span><span class="num" id="911822">1.0</span><span class="op" id="911825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911828">m</span>&nbsp;<span class="op" id="911830">:=</span>&nbsp;<span class="builtinfunc" id="911833">make</span><span class="op" id="911837">(</span><span class="keyword" id="911838">map</span><span class="op" id="911841">[</span><span class="ident" id="911842">FloatInt</span><span class="op" id="911850">]</span><span class="builtintype" id="911851">int</span><span class="op" id="911854">,</span>&nbsp;<span class="num" id="911856">4</span><span class="op" id="911857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911860">m</span><span class="op" id="911861">[</span><span class="ident" id="911862">FloatInt</span><span class="op" id="911870">{</span><span class="num" id="911871">0.0</span><span class="op" id="911874">,</span>&nbsp;<span class="num" id="911876">0</span><span class="op" id="911877">}</span><span class="op" id="911878">]</span>&nbsp;<span class="op" id="911880">=</span>&nbsp;<span class="num" id="911882">1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911885">m</span><span class="op" id="911886">[</span><span class="ident" id="911887">FloatInt</span><span class="op" id="911895">{</span><span class="num" id="911896">0.0</span><span class="op" id="911899">,</span>&nbsp;<span class="num" id="911901">1</span><span class="op" id="911902">}</span><span class="op" id="911903">]</span>&nbsp;<span class="op" id="911905">=</span>&nbsp;<span class="num" id="911907">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911910">m</span><span class="op" id="911911">[</span><span class="ident" id="911912">FloatInt</span><span class="op" id="911920">{</span><span class="num" id="911921">0.0</span><span class="op" id="911924">,</span>&nbsp;<span class="num" id="911926">2</span><span class="op" id="911927">}</span><span class="op" id="911928">]</span>&nbsp;<span class="op" id="911930">=</span>&nbsp;<span class="num" id="911932">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911935">m</span><span class="op" id="911936">[</span><span class="ident" id="911937">FloatInt</span><span class="op" id="911945">{</span><span class="num" id="911946">0.0</span><span class="op" id="911949">,</span>&nbsp;<span class="num" id="911951">3</span><span class="op" id="911952">}</span><span class="op" id="911953">]</span>&nbsp;<span class="op" id="911955">=</span>&nbsp;<span class="num" id="911957">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911960">growflag</span>&nbsp;<span class="op" id="911969">:=</span>&nbsp;<span class="builtintype" id="911972">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911978">s</span>&nbsp;<span class="op" id="911980">:=</span>&nbsp;<span class="num" id="911983">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911986">cnt</span>&nbsp;<span class="op" id="911990">:=</span>&nbsp;<span class="num" id="911993">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="911996">negcnt</span>&nbsp;<span class="op" id="912003">:=</span>&nbsp;<span class="num" id="912006">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912009">//&nbsp;The&nbsp;first&nbsp;iteration&nbsp;should&nbsp;return&nbsp;the&nbsp;+0&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912059">//&nbsp;The&nbsp;subsequent&nbsp;iterations&nbsp;should&nbsp;return&nbsp;the&nbsp;-0&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912115">//&nbsp;I&#39;m&nbsp;not&nbsp;really&nbsp;sure&nbsp;this&nbsp;is&nbsp;required&nbsp;by&nbsp;the&nbsp;spec,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912169">//&nbsp;but&nbsp;it&nbsp;makes&nbsp;sense.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912193">//&nbsp;TODO:&nbsp;are&nbsp;we&nbsp;allowed&nbsp;to&nbsp;get&nbsp;the&nbsp;first&nbsp;entry&nbsp;returned&nbsp;again???</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912259">for</span>&nbsp;<span class="ident" id="912263">k</span><span class="op" id="912264">,</span>&nbsp;<span class="ident" id="912266">v</span>&nbsp;<span class="op" id="912268">:=</span>&nbsp;<span class="keyword" id="912271">range</span>&nbsp;<span class="ident" id="912277">m</span>&nbsp;<span class="op" id="912279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912283">if</span>&nbsp;<span class="ident" id="912286">v</span>&nbsp;<span class="op" id="912288">==</span>&nbsp;<span class="num" id="912291">0</span>&nbsp;<span class="op" id="912293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912298">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912309">}</span>&nbsp;<span class="comment" id="912311">//&nbsp;ignore&nbsp;entries&nbsp;added&nbsp;to&nbsp;grow&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912351">cnt</span><span class="op" id="912354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912359">if</span>&nbsp;<span class="ident" id="912362">math</span><span class="op" id="912366">.</span><span class="ident" id="912367">Copysign</span><span class="op" id="912375">(</span><span class="num" id="912376">1.0</span><span class="op" id="912379">,</span>&nbsp;<span class="ident" id="912381">k</span><span class="op" id="912382">.</span><span class="ident" id="912383">x</span><span class="op" id="912384">)</span>&nbsp;<span class="op" id="912386">&lt;</span>&nbsp;<span class="num" id="912388">0</span>&nbsp;<span class="op" id="912390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912395">if</span>&nbsp;<span class="ident" id="912398">v</span><span class="op" id="912399">&amp;</span><span class="num" id="912400">16</span>&nbsp;<span class="op" id="912403">==</span>&nbsp;<span class="num" id="912406">0</span>&nbsp;<span class="op" id="912408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912414">t</span><span class="op" id="912415">.</span><span class="ident" id="912416">Error</span><span class="op" id="912421">(</span><span class="string" id="912422">&#34;key/value&nbsp;not&nbsp;updated&nbsp;together&nbsp;1&#34;</span><span class="op" id="912456">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912466">negcnt</span><span class="op" id="912472">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912478">s</span>&nbsp;<span class="op" id="912480">|=</span>&nbsp;<span class="ident" id="912483">v</span>&nbsp;<span class="op" id="912485">&amp;</span>&nbsp;<span class="num" id="912487">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912492">}</span>&nbsp;<span class="keyword" id="912494">else</span>&nbsp;<span class="op" id="912499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912504">if</span>&nbsp;<span class="ident" id="912507">v</span><span class="op" id="912508">&amp;</span><span class="num" id="912509">16</span>&nbsp;<span class="op" id="912512">==</span>&nbsp;<span class="num" id="912515">16</span>&nbsp;<span class="op" id="912518">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912524">t</span><span class="op" id="912525">.</span><span class="ident" id="912526">Error</span><span class="op" id="912531">(</span><span class="string" id="912532">&#34;key/value&nbsp;not&nbsp;updated&nbsp;together&nbsp;2&#34;</span><span class="op" id="912566">,</span>&nbsp;<span class="ident" id="912568">k</span><span class="op" id="912569">,</span>&nbsp;<span class="ident" id="912571">v</span><span class="op" id="912572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912582">s</span>&nbsp;<span class="op" id="912584">|=</span>&nbsp;<span class="ident" id="912587">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912595">if</span>&nbsp;<span class="ident" id="912598">growflag</span>&nbsp;<span class="op" id="912607">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912612">//&nbsp;force&nbsp;a&nbsp;hashtable&nbsp;resize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912643">for</span>&nbsp;<span class="ident" id="912647">i</span>&nbsp;<span class="op" id="912649">:=</span>&nbsp;<span class="num" id="912652">0</span><span class="op" id="912653">;</span>&nbsp;<span class="ident" id="912655">i</span>&nbsp;<span class="op" id="912657">&lt;</span>&nbsp;<span class="num" id="912659">100</span><span class="op" id="912662">;</span>&nbsp;<span class="ident" id="912664">i</span><span class="op" id="912665">++</span>&nbsp;<span class="op" id="912668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912674">m</span><span class="op" id="912675">[</span><span class="ident" id="912676">FloatInt</span><span class="op" id="912684">{</span><span class="num" id="912685">3.0</span><span class="op" id="912688">,</span>&nbsp;<span class="ident" id="912690">i</span><span class="op" id="912691">}</span><span class="op" id="912692">]</span>&nbsp;<span class="op" id="912694">=</span>&nbsp;<span class="num" id="912696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912706">//&nbsp;then&nbsp;change&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="912740">//&nbsp;to&nbsp;negative&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912763">m</span><span class="op" id="912764">[</span><span class="ident" id="912765">FloatInt</span><span class="op" id="912773">{</span><span class="ident" id="912774">negzero</span><span class="op" id="912781">,</span>&nbsp;<span class="num" id="912783">0</span><span class="op" id="912784">}</span><span class="op" id="912785">]</span>&nbsp;<span class="op" id="912787">=</span>&nbsp;<span class="num" id="912789">1</span>&nbsp;<span class="op" id="912791">|</span>&nbsp;<span class="num" id="912793">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912799">m</span><span class="op" id="912800">[</span><span class="ident" id="912801">FloatInt</span><span class="op" id="912809">{</span><span class="ident" id="912810">negzero</span><span class="op" id="912817">,</span>&nbsp;<span class="num" id="912819">1</span><span class="op" id="912820">}</span><span class="op" id="912821">]</span>&nbsp;<span class="op" id="912823">=</span>&nbsp;<span class="num" id="912825">2</span>&nbsp;<span class="op" id="912827">|</span>&nbsp;<span class="num" id="912829">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912835">m</span><span class="op" id="912836">[</span><span class="ident" id="912837">FloatInt</span><span class="op" id="912845">{</span><span class="ident" id="912846">negzero</span><span class="op" id="912853">,</span>&nbsp;<span class="num" id="912855">2</span><span class="op" id="912856">}</span><span class="op" id="912857">]</span>&nbsp;<span class="op" id="912859">=</span>&nbsp;<span class="num" id="912861">4</span>&nbsp;<span class="op" id="912863">|</span>&nbsp;<span class="num" id="912865">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912871">m</span><span class="op" id="912872">[</span><span class="ident" id="912873">FloatInt</span><span class="op" id="912881">{</span><span class="ident" id="912882">negzero</span><span class="op" id="912889">,</span>&nbsp;<span class="num" id="912891">3</span><span class="op" id="912892">}</span><span class="op" id="912893">]</span>&nbsp;<span class="op" id="912895">=</span>&nbsp;<span class="num" id="912897">8</span>&nbsp;<span class="op" id="912899">|</span>&nbsp;<span class="num" id="912901">16</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912907">growflag</span>&nbsp;<span class="op" id="912916">=</span>&nbsp;<span class="builtintype" id="912918">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912932">if</span>&nbsp;<span class="ident" id="912935">s</span>&nbsp;<span class="op" id="912937">!=</span>&nbsp;<span class="num" id="912940">15</span>&nbsp;<span class="op" id="912943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912947">t</span><span class="op" id="912948">.</span><span class="ident" id="912949">Error</span><span class="op" id="912954">(</span><span class="string" id="912955">&#34;entry&nbsp;missing&#34;</span><span class="op" id="912970">,</span>&nbsp;<span class="ident" id="912972">s</span><span class="op" id="912973">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="912976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="912979">if</span>&nbsp;<span class="ident" id="912982">cnt</span>&nbsp;<span class="op" id="912986">!=</span>&nbsp;<span class="num" id="912989">4</span>&nbsp;<span class="op" id="912991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="912995">t</span><span class="op" id="912996">.</span><span class="ident" id="912997">Error</span><span class="op" id="913002">(</span><span class="string" id="913003">&#34;wrong&nbsp;number&nbsp;of&nbsp;entries&nbsp;returned&nbsp;by&nbsp;iterator&#34;</span><span class="op" id="913049">,</span>&nbsp;<span class="ident" id="913051">cnt</span><span class="op" id="913054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913060">if</span>&nbsp;<span class="ident" id="913063">negcnt</span>&nbsp;<span class="op" id="913070">!=</span>&nbsp;<span class="num" id="913073">3</span>&nbsp;<span class="op" id="913075">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913079">t</span><span class="op" id="913080">.</span><span class="ident" id="913081">Error</span><span class="op" id="913086">(</span><span class="string" id="913087">&#34;update&nbsp;to&nbsp;negzero&nbsp;missed&nbsp;by&nbsp;iteration&#34;</span><span class="op" id="913126">,</span>&nbsp;<span class="ident" id="913128">negcnt</span><span class="op" id="913134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913137">}</span><br>
<span class="lineno"></span><span class="op" id="913139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="913142">func</span>&nbsp;<span class="ident" id="913147">TestIterGrowAndDelete</span><span class="op" id="913168">(</span><span class="ident" id="913169">t</span>&nbsp;<span class="op" id="913171">*</span><span class="ident" id="913172">testing</span><span class="op" id="913179">.</span><span class="ident" id="913180">T</span><span class="op" id="913181">)</span>&nbsp;<span class="op" id="913183">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913186">m</span>&nbsp;<span class="op" id="913188">:=</span>&nbsp;<span class="builtinfunc" id="913191">make</span><span class="op" id="913195">(</span><span class="keyword" id="913196">map</span><span class="op" id="913199">[</span><span class="builtintype" id="913200">int</span><span class="op" id="913203">]</span><span class="builtintype" id="913204">int</span><span class="op" id="913207">,</span>&nbsp;<span class="num" id="913209">4</span><span class="op" id="913210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913213">for</span>&nbsp;<span class="ident" id="913217">i</span>&nbsp;<span class="op" id="913219">:=</span>&nbsp;<span class="num" id="913222">0</span><span class="op" id="913223">;</span>&nbsp;<span class="ident" id="913225">i</span>&nbsp;<span class="op" id="913227">&lt;</span>&nbsp;<span class="num" id="913229">100</span><span class="op" id="913232">;</span>&nbsp;<span class="ident" id="913234">i</span><span class="op" id="913235">++</span>&nbsp;<span class="op" id="913238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913242">m</span><span class="op" id="913243">[</span><span class="ident" id="913244">i</span><span class="op" id="913245">]</span>&nbsp;<span class="op" id="913247">=</span>&nbsp;<span class="ident" id="913249">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913255">growflag</span>&nbsp;<span class="op" id="913264">:=</span>&nbsp;<span class="builtintype" id="913267">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913273">for</span>&nbsp;<span class="ident" id="913277">k</span>&nbsp;<span class="op" id="913279">:=</span>&nbsp;<span class="keyword" id="913282">range</span>&nbsp;<span class="ident" id="913288">m</span>&nbsp;<span class="op" id="913290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913294">if</span>&nbsp;<span class="ident" id="913297">growflag</span>&nbsp;<span class="op" id="913306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="913311">//&nbsp;grow&nbsp;the&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913332">for</span>&nbsp;<span class="ident" id="913336">i</span>&nbsp;<span class="op" id="913338">:=</span>&nbsp;<span class="num" id="913341">100</span><span class="op" id="913344">;</span>&nbsp;<span class="ident" id="913346">i</span>&nbsp;<span class="op" id="913348">&lt;</span>&nbsp;<span class="num" id="913350">1000</span><span class="op" id="913354">;</span>&nbsp;<span class="ident" id="913356">i</span><span class="op" id="913357">++</span>&nbsp;<span class="op" id="913360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913366">m</span><span class="op" id="913367">[</span><span class="ident" id="913368">i</span><span class="op" id="913369">]</span>&nbsp;<span class="op" id="913371">=</span>&nbsp;<span class="ident" id="913373">i</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="913383">//&nbsp;delete&nbsp;all&nbsp;odd&nbsp;keys</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913409">for</span>&nbsp;<span class="ident" id="913413">i</span>&nbsp;<span class="op" id="913415">:=</span>&nbsp;<span class="num" id="913418">1</span><span class="op" id="913419">;</span>&nbsp;<span class="ident" id="913421">i</span>&nbsp;<span class="op" id="913423">&lt;</span>&nbsp;<span class="num" id="913425">1000</span><span class="op" id="913429">;</span>&nbsp;<span class="ident" id="913431">i</span>&nbsp;<span class="op" id="913433">+=</span>&nbsp;<span class="num" id="913436">2</span>&nbsp;<span class="op" id="913438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="913444">delete</span><span class="op" id="913450">(</span><span class="ident" id="913451">m</span><span class="op" id="913452">,</span>&nbsp;<span class="ident" id="913454">i</span><span class="op" id="913455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913460">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913465">growflag</span>&nbsp;<span class="op" id="913474">=</span>&nbsp;<span class="builtintype" id="913476">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913484">}</span>&nbsp;<span class="keyword" id="913486">else</span>&nbsp;<span class="op" id="913491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913496">if</span>&nbsp;<span class="ident" id="913499">k</span><span class="op" id="913500">&amp;</span><span class="num" id="913501">1</span>&nbsp;<span class="op" id="913503">==</span>&nbsp;<span class="num" id="913506">1</span>&nbsp;<span class="op" id="913508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913514">t</span><span class="op" id="913515">.</span><span class="ident" id="913516">Error</span><span class="op" id="913521">(</span><span class="string" id="913522">&#34;odd&nbsp;value&nbsp;returned&#34;</span><span class="op" id="913542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913547">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913554">}</span><br>
<span class="lineno"></span><span class="op" id="913556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="913559">//&nbsp;make&nbsp;sure&nbsp;old&nbsp;bucket&nbsp;arrays&nbsp;don&#39;t&nbsp;get&nbsp;GCd&nbsp;while</span><br>
<span class="lineno">210</span><span class="comment" id="913610">//&nbsp;an&nbsp;iterator&nbsp;is&nbsp;still&nbsp;using&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="913646">func</span>&nbsp;<span class="ident" id="913651">TestIterGrowWithGC</span><span class="op" id="913669">(</span><span class="ident" id="913670">t</span>&nbsp;<span class="op" id="913672">*</span><span class="ident" id="913673">testing</span><span class="op" id="913680">.</span><span class="ident" id="913681">T</span><span class="op" id="913682">)</span>&nbsp;<span class="op" id="913684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913687">m</span>&nbsp;<span class="op" id="913689">:=</span>&nbsp;<span class="builtinfunc" id="913692">make</span><span class="op" id="913696">(</span><span class="keyword" id="913697">map</span><span class="op" id="913700">[</span><span class="builtintype" id="913701">int</span><span class="op" id="913704">]</span><span class="builtintype" id="913705">int</span><span class="op" id="913708">,</span>&nbsp;<span class="num" id="913710">4</span><span class="op" id="913711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913714">for</span>&nbsp;<span class="ident" id="913718">i</span>&nbsp;<span class="op" id="913720">:=</span>&nbsp;<span class="num" id="913723">0</span><span class="op" id="913724">;</span>&nbsp;<span class="ident" id="913726">i</span>&nbsp;<span class="op" id="913728">&lt;</span>&nbsp;<span class="num" id="913730">16</span><span class="op" id="913732">;</span>&nbsp;<span class="ident" id="913734">i</span><span class="op" id="913735">++</span>&nbsp;<span class="op" id="913738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913742">m</span><span class="op" id="913743">[</span><span class="ident" id="913744">i</span><span class="op" id="913745">]</span>&nbsp;<span class="op" id="913747">=</span>&nbsp;<span class="ident" id="913749">i</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913755">growflag</span>&nbsp;<span class="op" id="913764">:=</span>&nbsp;<span class="builtintype" id="913767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913773">bitmask</span>&nbsp;<span class="op" id="913781">:=</span>&nbsp;<span class="num" id="913784">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913787">for</span>&nbsp;<span class="ident" id="913791">k</span>&nbsp;<span class="op" id="913793">:=</span>&nbsp;<span class="keyword" id="913796">range</span>&nbsp;<span class="ident" id="913802">m</span>&nbsp;<span class="op" id="913804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913808">if</span>&nbsp;<span class="ident" id="913811">k</span>&nbsp;<span class="op" id="913813">&lt;</span>&nbsp;<span class="num" id="913815">16</span>&nbsp;<span class="op" id="913818">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913823">bitmask</span>&nbsp;<span class="op" id="913831">|=</span>&nbsp;<span class="num" id="913834">1</span>&nbsp;<span class="op" id="913836">&lt;&lt;</span>&nbsp;<span class="builtintype" id="913839">uint</span><span class="op" id="913843">(</span><span class="ident" id="913844">k</span><span class="op" id="913845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913853">if</span>&nbsp;<span class="ident" id="913856">growflag</span>&nbsp;<span class="op" id="913865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="913870">//&nbsp;grow&nbsp;the&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="913891">for</span>&nbsp;<span class="ident" id="913895">i</span>&nbsp;<span class="op" id="913897">:=</span>&nbsp;<span class="num" id="913900">100</span><span class="op" id="913903">;</span>&nbsp;<span class="ident" id="913905">i</span>&nbsp;<span class="op" id="913907">&lt;</span>&nbsp;<span class="num" id="913909">1000</span><span class="op" id="913913">;</span>&nbsp;<span class="ident" id="913915">i</span><span class="op" id="913916">++</span>&nbsp;<span class="op" id="913919">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913925">m</span><span class="op" id="913926">[</span><span class="ident" id="913927">i</span><span class="op" id="913928">]</span>&nbsp;<span class="op" id="913930">=</span>&nbsp;<span class="ident" id="913932">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="913942">//&nbsp;trigger&nbsp;a&nbsp;gc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913961">runtime</span><span class="op" id="913968">.</span><span class="ident" id="913969">GC</span><span class="op" id="913971">(</span><span class="op" id="913972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="913977">growflag</span>&nbsp;<span class="op" id="913986">=</span>&nbsp;<span class="builtintype" id="913988">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="913999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914002">if</span>&nbsp;<span class="ident" id="914005">bitmask</span>&nbsp;<span class="op" id="914013">!=</span>&nbsp;<span class="num" id="914016">1</span><span class="op" id="914017">&lt;&lt;</span><span class="num" id="914019">16</span><span class="op" id="914021">-</span><span class="num" id="914022">1</span>&nbsp;<span class="op" id="914024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914028">t</span><span class="op" id="914029">.</span><span class="ident" id="914030">Error</span><span class="op" id="914035">(</span><span class="string" id="914036">&#34;missing&nbsp;key&#34;</span><span class="op" id="914049">,</span>&nbsp;<span class="ident" id="914051">bitmask</span><span class="op" id="914058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914061">}</span><br>
<span class="lineno">235</span><span class="op" id="914063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="914066">func</span>&nbsp;<span class="ident" id="914071">testConcurrentReadsAfterGrowth</span><span class="op" id="914101">(</span><span class="ident" id="914102">t</span>&nbsp;<span class="op" id="914104">*</span><span class="ident" id="914105">testing</span><span class="op" id="914112">.</span><span class="ident" id="914113">T</span><span class="op" id="914114">,</span>&nbsp;<span class="ident" id="914116">useReflect</span>&nbsp;<span class="builtintype" id="914127">bool</span><span class="op" id="914131">)</span>&nbsp;<span class="op" id="914133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914136">if</span>&nbsp;<span class="ident" id="914139">runtime</span><span class="op" id="914146">.</span><span class="ident" id="914147">GOMAXPROCS</span><span class="op" id="914157">(</span><span class="op" id="914158">-</span><span class="num" id="914159">1</span><span class="op" id="914160">)</span>&nbsp;<span class="op" id="914162">==</span>&nbsp;<span class="num" id="914165">1</span>&nbsp;<span class="op" id="914167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914171">defer</span>&nbsp;<span class="ident" id="914177">runtime</span><span class="op" id="914184">.</span><span class="ident" id="914185">GOMAXPROCS</span><span class="op" id="914195">(</span><span class="ident" id="914196">runtime</span><span class="op" id="914203">.</span><span class="ident" id="914204">GOMAXPROCS</span><span class="op" id="914214">(</span><span class="num" id="914215">16</span><span class="op" id="914217">)</span><span class="op" id="914218">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914224">numLoop</span>&nbsp;<span class="op" id="914232">:=</span>&nbsp;<span class="num" id="914235">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914239">numGrowStep</span>&nbsp;<span class="op" id="914251">:=</span>&nbsp;<span class="num" id="914254">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914259">numReader</span>&nbsp;<span class="op" id="914269">:=</span>&nbsp;<span class="num" id="914272">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914276">if</span>&nbsp;<span class="ident" id="914279">testing</span><span class="op" id="914286">.</span><span class="ident" id="914287">Short</span><span class="op" id="914292">(</span><span class="op" id="914293">)</span>&nbsp;<span class="op" id="914295">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914299">numLoop</span><span class="op" id="914306">,</span>&nbsp;<span class="ident" id="914308">numGrowStep</span>&nbsp;<span class="op" id="914320">=</span>&nbsp;<span class="num" id="914322">2</span><span class="op" id="914323">,</span>&nbsp;<span class="num" id="914325">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914333">for</span>&nbsp;<span class="ident" id="914337">i</span>&nbsp;<span class="op" id="914339">:=</span>&nbsp;<span class="num" id="914342">0</span><span class="op" id="914343">;</span>&nbsp;<span class="ident" id="914345">i</span>&nbsp;<span class="op" id="914347">&lt;</span>&nbsp;<span class="ident" id="914349">numLoop</span><span class="op" id="914356">;</span>&nbsp;<span class="ident" id="914358">i</span><span class="op" id="914359">++</span>&nbsp;<span class="op" id="914362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914366">m</span>&nbsp;<span class="op" id="914368">:=</span>&nbsp;<span class="builtinfunc" id="914371">make</span><span class="op" id="914375">(</span><span class="keyword" id="914376">map</span><span class="op" id="914379">[</span><span class="builtintype" id="914380">int</span><span class="op" id="914383">]</span><span class="builtintype" id="914384">int</span><span class="op" id="914387">,</span>&nbsp;<span class="num" id="914389">0</span><span class="op" id="914390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914394">for</span>&nbsp;<span class="ident" id="914398">gs</span>&nbsp;<span class="op" id="914401">:=</span>&nbsp;<span class="num" id="914404">0</span><span class="op" id="914405">;</span>&nbsp;<span class="ident" id="914407">gs</span>&nbsp;<span class="op" id="914410">&lt;</span>&nbsp;<span class="ident" id="914412">numGrowStep</span><span class="op" id="914423">;</span>&nbsp;<span class="ident" id="914425">gs</span><span class="op" id="914427">++</span>&nbsp;<span class="op" id="914430">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914435">m</span><span class="op" id="914436">[</span><span class="ident" id="914437">gs</span><span class="op" id="914439">]</span>&nbsp;<span class="op" id="914441">=</span>&nbsp;<span class="ident" id="914443">gs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914449">var</span>&nbsp;<span class="ident" id="914453">wg</span>&nbsp;<span class="ident" id="914456">sync</span><span class="op" id="914460">.</span><span class="ident" id="914461">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914474">wg</span><span class="op" id="914476">.</span><span class="ident" id="914477">Add</span><span class="op" id="914480">(</span><span class="ident" id="914481">numReader</span>&nbsp;<span class="op" id="914491">*</span>&nbsp;<span class="num" id="914493">2</span><span class="op" id="914494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914499">for</span>&nbsp;<span class="ident" id="914503">nr</span>&nbsp;<span class="op" id="914506">:=</span>&nbsp;<span class="num" id="914509">0</span><span class="op" id="914510">;</span>&nbsp;<span class="ident" id="914512">nr</span>&nbsp;<span class="op" id="914515">&lt;</span>&nbsp;<span class="ident" id="914517">numReader</span><span class="op" id="914526">;</span>&nbsp;<span class="ident" id="914528">nr</span><span class="op" id="914530">++</span>&nbsp;<span class="op" id="914533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914539">go</span>&nbsp;<span class="keyword" id="914542">func</span><span class="op" id="914546">(</span><span class="op" id="914547">)</span>&nbsp;<span class="op" id="914549">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914556">defer</span>&nbsp;<span class="ident" id="914562">wg</span><span class="op" id="914564">.</span><span class="ident" id="914565">Done</span><span class="op" id="914569">(</span><span class="op" id="914570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914577">for</span>&nbsp;<span class="keyword" id="914581">range</span>&nbsp;<span class="ident" id="914587">m</span>&nbsp;<span class="op" id="914589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914602">}</span><span class="op" id="914603">(</span><span class="op" id="914604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914610">go</span>&nbsp;<span class="keyword" id="914613">func</span><span class="op" id="914617">(</span><span class="op" id="914618">)</span>&nbsp;<span class="op" id="914620">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914627">defer</span>&nbsp;<span class="ident" id="914633">wg</span><span class="op" id="914635">.</span><span class="ident" id="914636">Done</span><span class="op" id="914640">(</span><span class="op" id="914641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914648">for</span>&nbsp;<span class="ident" id="914652">key</span>&nbsp;<span class="op" id="914656">:=</span>&nbsp;<span class="num" id="914659">0</span><span class="op" id="914660">;</span>&nbsp;<span class="ident" id="914662">key</span>&nbsp;<span class="op" id="914666">&lt;</span>&nbsp;<span class="ident" id="914668">gs</span><span class="op" id="914670">;</span>&nbsp;<span class="ident" id="914672">key</span><span class="op" id="914675">++</span>&nbsp;<span class="op" id="914678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914686">_</span>&nbsp;<span class="op" id="914688">=</span>&nbsp;<span class="ident" id="914690">m</span><span class="op" id="914691">[</span><span class="ident" id="914692">key</span><span class="op" id="914695">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914708">}</span><span class="op" id="914709">(</span><span class="op" id="914710">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914716">if</span>&nbsp;<span class="ident" id="914719">useReflect</span>&nbsp;<span class="op" id="914730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914737">wg</span><span class="op" id="914739">.</span><span class="ident" id="914740">Add</span><span class="op" id="914743">(</span><span class="num" id="914744">1</span><span class="op" id="914745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914752">go</span>&nbsp;<span class="keyword" id="914755">func</span><span class="op" id="914759">(</span><span class="op" id="914760">)</span>&nbsp;<span class="op" id="914762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914770">defer</span>&nbsp;<span class="ident" id="914776">wg</span><span class="op" id="914778">.</span><span class="ident" id="914779">Done</span><span class="op" id="914783">(</span><span class="op" id="914784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914792">mv</span>&nbsp;<span class="op" id="914795">:=</span>&nbsp;<span class="ident" id="914798">reflect</span><span class="op" id="914805">.</span><span class="ident" id="914806">ValueOf</span><span class="op" id="914813">(</span><span class="ident" id="914814">m</span><span class="op" id="914815">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914823">keys</span>&nbsp;<span class="op" id="914828">:=</span>&nbsp;<span class="ident" id="914831">mv</span><span class="op" id="914833">.</span><span class="ident" id="914834">MapKeys</span><span class="op" id="914841">(</span><span class="op" id="914842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="914850">for</span>&nbsp;<span class="ident" id="914854">_</span><span class="op" id="914855">,</span>&nbsp;<span class="ident" id="914857">k</span>&nbsp;<span class="op" id="914859">:=</span>&nbsp;<span class="keyword" id="914862">range</span>&nbsp;<span class="ident" id="914868">keys</span>&nbsp;<span class="op" id="914873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914882">mv</span><span class="op" id="914884">.</span><span class="ident" id="914885">MapIndex</span><span class="op" id="914893">(</span><span class="ident" id="914894">k</span><span class="op" id="914895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914910">}</span><span class="op" id="914911">(</span><span class="op" id="914912">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="914928">wg</span><span class="op" id="914930">.</span><span class="ident" id="914931">Wait</span><span class="op" id="914935">(</span><span class="op" id="914936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="914943">}</span><br>
<span class="lineno">280</span><span class="op" id="914945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="914948">func</span>&nbsp;<span class="ident" id="914953">TestConcurrentReadsAfterGrowth</span><span class="op" id="914983">(</span><span class="ident" id="914984">t</span>&nbsp;<span class="op" id="914986">*</span><span class="ident" id="914987">testing</span><span class="op" id="914994">.</span><span class="ident" id="914995">T</span><span class="op" id="914996">)</span>&nbsp;<span class="op" id="914998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915001">testConcurrentReadsAfterGrowth</span><span class="op" id="915031">(</span><span class="ident" id="915032">t</span><span class="op" id="915033">,</span>&nbsp;<span class="builtintype" id="915035">false</span><span class="op" id="915040">)</span><br>
<span class="lineno"></span><span class="op" id="915042">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="915045">func</span>&nbsp;<span class="ident" id="915050">TestConcurrentReadsAfterGrowthReflect</span><span class="op" id="915087">(</span><span class="ident" id="915088">t</span>&nbsp;<span class="op" id="915090">*</span><span class="ident" id="915091">testing</span><span class="op" id="915098">.</span><span class="ident" id="915099">T</span><span class="op" id="915100">)</span>&nbsp;<span class="op" id="915102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915105">testConcurrentReadsAfterGrowth</span><span class="op" id="915135">(</span><span class="ident" id="915136">t</span><span class="op" id="915137">,</span>&nbsp;<span class="builtintype" id="915139">true</span><span class="op" id="915143">)</span><br>
<span class="lineno"></span><span class="op" id="915145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="915148">func</span>&nbsp;<span class="ident" id="915153">TestBigItems</span><span class="op" id="915165">(</span><span class="ident" id="915166">t</span>&nbsp;<span class="op" id="915168">*</span><span class="ident" id="915169">testing</span><span class="op" id="915176">.</span><span class="ident" id="915177">T</span><span class="op" id="915178">)</span>&nbsp;<span class="op" id="915180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915183">var</span>&nbsp;<span class="ident" id="915187">key</span>&nbsp;<span class="op" id="915191">[</span><span class="num" id="915192">256</span><span class="op" id="915195">]</span><span class="builtintype" id="915196">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915204">for</span>&nbsp;<span class="ident" id="915208">i</span>&nbsp;<span class="op" id="915210">:=</span>&nbsp;<span class="num" id="915213">0</span><span class="op" id="915214">;</span>&nbsp;<span class="ident" id="915216">i</span>&nbsp;<span class="op" id="915218">&lt;</span>&nbsp;<span class="num" id="915220">256</span><span class="op" id="915223">;</span>&nbsp;<span class="ident" id="915225">i</span><span class="op" id="915226">++</span>&nbsp;<span class="op" id="915229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915233">key</span><span class="op" id="915236">[</span><span class="ident" id="915237">i</span><span class="op" id="915238">]</span>&nbsp;<span class="op" id="915240">=</span>&nbsp;<span class="string" id="915242">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915249">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915252">m</span>&nbsp;<span class="op" id="915254">:=</span>&nbsp;<span class="builtinfunc" id="915257">make</span><span class="op" id="915261">(</span><span class="keyword" id="915262">map</span><span class="op" id="915265">[</span><span class="op" id="915266">[</span><span class="num" id="915267">256</span><span class="op" id="915270">]</span><span class="builtintype" id="915271">string</span><span class="op" id="915277">]</span><span class="op" id="915278">[</span><span class="num" id="915279">256</span><span class="op" id="915282">]</span><span class="builtintype" id="915283">string</span><span class="op" id="915289">,</span>&nbsp;<span class="num" id="915291">4</span><span class="op" id="915292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915295">for</span>&nbsp;<span class="ident" id="915299">i</span>&nbsp;<span class="op" id="915301">:=</span>&nbsp;<span class="num" id="915304">0</span><span class="op" id="915305">;</span>&nbsp;<span class="ident" id="915307">i</span>&nbsp;<span class="op" id="915309">&lt;</span>&nbsp;<span class="num" id="915311">100</span><span class="op" id="915314">;</span>&nbsp;<span class="ident" id="915316">i</span><span class="op" id="915317">++</span>&nbsp;<span class="op" id="915320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915324">key</span><span class="op" id="915327">[</span><span class="num" id="915328">37</span><span class="op" id="915330">]</span>&nbsp;<span class="op" id="915332">=</span>&nbsp;<span class="ident" id="915334">fmt</span><span class="op" id="915337">.</span><span class="ident" id="915338">Sprintf</span><span class="op" id="915345">(</span><span class="string" id="915346">&#34;string%02d&#34;</span><span class="op" id="915358">,</span>&nbsp;<span class="ident" id="915360">i</span><span class="op" id="915361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915365">m</span><span class="op" id="915366">[</span><span class="ident" id="915367">key</span><span class="op" id="915370">]</span>&nbsp;<span class="op" id="915372">=</span>&nbsp;<span class="ident" id="915374">key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915379">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915382">var</span>&nbsp;<span class="ident" id="915386">keys</span>&nbsp;<span class="op" id="915391">[</span><span class="num" id="915392">100</span><span class="op" id="915395">]</span><span class="builtintype" id="915396">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915404">var</span>&nbsp;<span class="ident" id="915408">values</span>&nbsp;<span class="op" id="915415">[</span><span class="num" id="915416">100</span><span class="op" id="915419">]</span><span class="builtintype" id="915420">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915428">i</span>&nbsp;<span class="op" id="915430">:=</span>&nbsp;<span class="num" id="915433">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915436">for</span>&nbsp;<span class="ident" id="915440">k</span><span class="op" id="915441">,</span>&nbsp;<span class="ident" id="915443">v</span>&nbsp;<span class="op" id="915445">:=</span>&nbsp;<span class="keyword" id="915448">range</span>&nbsp;<span class="ident" id="915454">m</span>&nbsp;<span class="op" id="915456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915460">keys</span><span class="op" id="915464">[</span><span class="ident" id="915465">i</span><span class="op" id="915466">]</span>&nbsp;<span class="op" id="915468">=</span>&nbsp;<span class="ident" id="915470">k</span><span class="op" id="915471">[</span><span class="num" id="915472">37</span><span class="op" id="915474">]</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915478">values</span><span class="op" id="915484">[</span><span class="ident" id="915485">i</span><span class="op" id="915486">]</span>&nbsp;<span class="op" id="915488">=</span>&nbsp;<span class="ident" id="915490">v</span><span class="op" id="915491">[</span><span class="num" id="915492">37</span><span class="op" id="915494">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915498">i</span><span class="op" id="915499">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915506">sort</span><span class="op" id="915510">.</span><span class="ident" id="915511">Strings</span><span class="op" id="915518">(</span><span class="ident" id="915519">keys</span><span class="op" id="915523">[</span><span class="op" id="915524">:</span><span class="op" id="915525">]</span><span class="op" id="915526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915529">sort</span><span class="op" id="915533">.</span><span class="ident" id="915534">Strings</span><span class="op" id="915541">(</span><span class="ident" id="915542">values</span><span class="op" id="915548">[</span><span class="op" id="915549">:</span><span class="op" id="915550">]</span><span class="op" id="915551">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915554">for</span>&nbsp;<span class="ident" id="915558">i</span>&nbsp;<span class="op" id="915560">:=</span>&nbsp;<span class="num" id="915563">0</span><span class="op" id="915564">;</span>&nbsp;<span class="ident" id="915566">i</span>&nbsp;<span class="op" id="915568">&lt;</span>&nbsp;<span class="num" id="915570">100</span><span class="op" id="915573">;</span>&nbsp;<span class="ident" id="915575">i</span><span class="op" id="915576">++</span>&nbsp;<span class="op" id="915579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915583">if</span>&nbsp;<span class="ident" id="915586">keys</span><span class="op" id="915590">[</span><span class="ident" id="915591">i</span><span class="op" id="915592">]</span>&nbsp;<span class="op" id="915594">!=</span>&nbsp;<span class="ident" id="915597">fmt</span><span class="op" id="915600">.</span><span class="ident" id="915601">Sprintf</span><span class="op" id="915608">(</span><span class="string" id="915609">&#34;string%02d&#34;</span><span class="op" id="915621">,</span>&nbsp;<span class="ident" id="915623">i</span><span class="op" id="915624">)</span>&nbsp;<span class="op" id="915626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915631">t</span><span class="op" id="915632">.</span><span class="ident" id="915633">Errorf</span><span class="op" id="915639">(</span><span class="string" id="915640">&#34;#%d:&nbsp;missing&nbsp;key:&nbsp;%v&#34;</span><span class="op" id="915662">,</span>&nbsp;<span class="ident" id="915664">i</span><span class="op" id="915665">,</span>&nbsp;<span class="ident" id="915667">keys</span><span class="op" id="915671">[</span><span class="ident" id="915672">i</span><span class="op" id="915673">]</span><span class="op" id="915674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="915682">if</span>&nbsp;<span class="ident" id="915685">values</span><span class="op" id="915691">[</span><span class="ident" id="915692">i</span><span class="op" id="915693">]</span>&nbsp;<span class="op" id="915695">!=</span>&nbsp;<span class="ident" id="915698">fmt</span><span class="op" id="915701">.</span><span class="ident" id="915702">Sprintf</span><span class="op" id="915709">(</span><span class="string" id="915710">&#34;string%02d&#34;</span><span class="op" id="915722">,</span>&nbsp;<span class="ident" id="915724">i</span><span class="op" id="915725">)</span>&nbsp;<span class="op" id="915727">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915732">t</span><span class="op" id="915733">.</span><span class="ident" id="915734">Errorf</span><span class="op" id="915740">(</span><span class="string" id="915741">&#34;#%d:&nbsp;missing&nbsp;value:&nbsp;%v&#34;</span><span class="op" id="915765">,</span>&nbsp;<span class="ident" id="915767">i</span><span class="op" id="915768">,</span>&nbsp;<span class="ident" id="915770">values</span><span class="op" id="915776">[</span><span class="ident" id="915777">i</span><span class="op" id="915778">]</span><span class="op" id="915779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="915786">}</span><br>
<span class="lineno"></span><span class="op" id="915788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="915791">type</span>&nbsp;<span class="ident" id="915796">empty</span>&nbsp;<span class="keyword" id="915802">struct</span>&nbsp;<span class="op" id="915809">{</span><br>
<span class="lineno"></span><span class="op" id="915811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="915814">func</span>&nbsp;<span class="ident" id="915819">TestEmptyKeyAndValue</span><span class="op" id="915839">(</span><span class="ident" id="915840">t</span>&nbsp;<span class="op" id="915842">*</span><span class="ident" id="915843">testing</span><span class="op" id="915850">.</span><span class="ident" id="915851">T</span><span class="op" id="915852">)</span>&nbsp;<span class="op" id="915854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915857">a</span>&nbsp;<span class="op" id="915859">:=</span>&nbsp;<span class="builtinfunc" id="915862">make</span><span class="op" id="915866">(</span><span class="keyword" id="915867">map</span><span class="op" id="915870">[</span><span class="builtintype" id="915871">int</span><span class="op" id="915874">]</span><span class="ident" id="915875">empty</span><span class="op" id="915880">,</span>&nbsp;<span class="num" id="915882">4</span><span class="op" id="915883">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915886">b</span>&nbsp;<span class="op" id="915888">:=</span>&nbsp;<span class="builtinfunc" id="915891">make</span><span class="op" id="915895">(</span><span class="keyword" id="915896">map</span><span class="op" id="915899">[</span><span class="ident" id="915900">empty</span><span class="op" id="915905">]</span><span class="builtintype" id="915906">int</span><span class="op" id="915909">,</span>&nbsp;<span class="num" id="915911">4</span><span class="op" id="915912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915915">c</span>&nbsp;<span class="op" id="915917">:=</span>&nbsp;<span class="builtinfunc" id="915920">make</span><span class="op" id="915924">(</span><span class="keyword" id="915925">map</span><span class="op" id="915928">[</span><span class="ident" id="915929">empty</span><span class="op" id="915934">]</span><span class="ident" id="915935">empty</span><span class="op" id="915940">,</span>&nbsp;<span class="num" id="915942">4</span><span class="op" id="915943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915946">a</span><span class="op" id="915947">[</span><span class="num" id="915948">0</span><span class="op" id="915949">]</span>&nbsp;<span class="op" id="915951">=</span>&nbsp;<span class="ident" id="915953">empty</span><span class="op" id="915958">{</span><span class="op" id="915959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915962">b</span><span class="op" id="915963">[</span><span class="ident" id="915964">empty</span><span class="op" id="915969">{</span><span class="op" id="915970">}</span><span class="op" id="915971">]</span>&nbsp;<span class="op" id="915973">=</span>&nbsp;<span class="num" id="915975">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915978">b</span><span class="op" id="915979">[</span><span class="ident" id="915980">empty</span><span class="op" id="915985">{</span><span class="op" id="915986">}</span><span class="op" id="915987">]</span>&nbsp;<span class="op" id="915989">=</span>&nbsp;<span class="num" id="915991">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="915994">c</span><span class="op" id="915995">[</span><span class="ident" id="915996">empty</span><span class="op" id="916001">{</span><span class="op" id="916002">}</span><span class="op" id="916003">]</span>&nbsp;<span class="op" id="916005">=</span>&nbsp;<span class="ident" id="916007">empty</span><span class="op" id="916012">{</span><span class="op" id="916013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="916017">if</span>&nbsp;<span class="builtinfunc" id="916020">len</span><span class="op" id="916023">(</span><span class="ident" id="916024">a</span><span class="op" id="916025">)</span>&nbsp;<span class="op" id="916027">!=</span>&nbsp;<span class="num" id="916030">1</span>&nbsp;<span class="op" id="916032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916036">t</span><span class="op" id="916037">.</span><span class="ident" id="916038">Errorf</span><span class="op" id="916044">(</span><span class="string" id="916045">&#34;empty&nbsp;value&nbsp;insert&nbsp;problem&#34;</span><span class="op" id="916073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="916076">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="916079">if</span>&nbsp;<span class="ident" id="916082">b</span><span class="op" id="916083">[</span><span class="ident" id="916084">empty</span><span class="op" id="916089">{</span><span class="op" id="916090">}</span><span class="op" id="916091">]</span>&nbsp;<span class="op" id="916093">!=</span>&nbsp;<span class="num" id="916096">1</span>&nbsp;<span class="op" id="916098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916102">t</span><span class="op" id="916103">.</span><span class="ident" id="916104">Errorf</span><span class="op" id="916110">(</span><span class="string" id="916111">&#34;empty&nbsp;key&nbsp;returned&nbsp;wrong&nbsp;value&#34;</span><span class="op" id="916143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="916146">}</span><br>
<span class="lineno"></span><span class="op" id="916148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="916151">//&nbsp;Tests&nbsp;a&nbsp;map&nbsp;with&nbsp;a&nbsp;single&nbsp;bucket,&nbsp;with&nbsp;same-lengthed&nbsp;short&nbsp;keys</span><br>
<span class="lineno"></span><span class="comment" id="916218">//&nbsp;(&#34;quick&nbsp;keys&#34;)&nbsp;as&nbsp;well&nbsp;as&nbsp;long&nbsp;keys.</span><br>
<span class="lineno"></span><span class="keyword" id="916258">func</span>&nbsp;<span class="ident" id="916263">TestSingleBucketMapStringKeys_DupLen</span><span class="op" id="916299">(</span><span class="ident" id="916300">t</span>&nbsp;<span class="op" id="916302">*</span><span class="ident" id="916303">testing</span><span class="op" id="916310">.</span><span class="ident" id="916311">T</span><span class="op" id="916312">)</span>&nbsp;<span class="op" id="916314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916317">testMapLookups</span><span class="op" id="916331">(</span><span class="ident" id="916332">t</span><span class="op" id="916333">,</span>&nbsp;<span class="keyword" id="916335">map</span><span class="op" id="916338">[</span><span class="builtintype" id="916339">string</span><span class="op" id="916345">]</span><span class="builtintype" id="916346">string</span><span class="op" id="916352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916356">&#34;x&#34;</span><span class="op" id="916359">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916364">&#34;x1val&#34;</span><span class="op" id="916371">,</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916375">&#34;xx&#34;</span><span class="op" id="916379">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="916383">&#34;x2val&#34;</span><span class="op" id="916390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916394">&#34;foo&#34;</span><span class="op" id="916399">:</span>&nbsp;&nbsp;<span class="string" id="916402">&#34;fooval&#34;</span><span class="op" id="916410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916414">&#34;bar&#34;</span><span class="op" id="916419">:</span>&nbsp;&nbsp;<span class="string" id="916422">&#34;barval&#34;</span><span class="op" id="916430">,</span>&nbsp;<span class="comment" id="916432">//&nbsp;same&nbsp;key&nbsp;length&nbsp;as&nbsp;&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916462">&#34;xxxx&#34;</span><span class="op" id="916468">:</span>&nbsp;<span class="string" id="916470">&#34;x4val&#34;</span><span class="op" id="916477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916481">strings</span><span class="op" id="916488">.</span><span class="ident" id="916489">Repeat</span><span class="op" id="916495">(</span><span class="string" id="916496">&#34;x&#34;</span><span class="op" id="916499">,</span>&nbsp;<span class="num" id="916501">128</span><span class="op" id="916504">)</span><span class="op" id="916505">:</span>&nbsp;<span class="string" id="916507">&#34;longval1&#34;</span><span class="op" id="916517">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916521">strings</span><span class="op" id="916528">.</span><span class="ident" id="916529">Repeat</span><span class="op" id="916535">(</span><span class="string" id="916536">&#34;y&#34;</span><span class="op" id="916539">,</span>&nbsp;<span class="num" id="916541">128</span><span class="op" id="916544">)</span><span class="op" id="916545">:</span>&nbsp;<span class="string" id="916547">&#34;longval2&#34;</span><span class="op" id="916557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="916560">}</span><span class="op" id="916561">)</span><br>
<span class="lineno"></span><span class="op" id="916563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="916566">//&nbsp;Tests&nbsp;a&nbsp;map&nbsp;with&nbsp;a&nbsp;single&nbsp;bucket,&nbsp;with&nbsp;all&nbsp;keys&nbsp;having&nbsp;different&nbsp;lengths.</span><br>
<span class="lineno">355</span><span class="keyword" id="916643">func</span>&nbsp;<span class="ident" id="916648">TestSingleBucketMapStringKeys_NoDupLen</span><span class="op" id="916686">(</span><span class="ident" id="916687">t</span>&nbsp;<span class="op" id="916689">*</span><span class="ident" id="916690">testing</span><span class="op" id="916697">.</span><span class="ident" id="916698">T</span><span class="op" id="916699">)</span>&nbsp;<span class="op" id="916701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916704">testMapLookups</span><span class="op" id="916718">(</span><span class="ident" id="916719">t</span><span class="op" id="916720">,</span>&nbsp;<span class="keyword" id="916722">map</span><span class="op" id="916725">[</span><span class="builtintype" id="916726">string</span><span class="op" id="916732">]</span><span class="builtintype" id="916733">string</span><span class="op" id="916739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916743">&#34;x&#34;</span><span class="op" id="916746">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916769">&#34;x1val&#34;</span><span class="op" id="916776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916780">&#34;xx&#34;</span><span class="op" id="916784">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916806">&#34;x2val&#34;</span><span class="op" id="916813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916817">&#34;foo&#34;</span><span class="op" id="916822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916843">&#34;fooval&#34;</span><span class="op" id="916851">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916855">&#34;xxxx&#34;</span><span class="op" id="916861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916881">&#34;x4val&#34;</span><span class="op" id="916888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916892">&#34;xxxxx&#34;</span><span class="op" id="916899">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916918">&#34;x5val&#34;</span><span class="op" id="916925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="916929">&#34;xxxxxx&#34;</span><span class="op" id="916937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="916955">&#34;x6val&#34;</span><span class="op" id="916962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="916966">strings</span><span class="op" id="916973">.</span><span class="ident" id="916974">Repeat</span><span class="op" id="916980">(</span><span class="string" id="916981">&#34;x&#34;</span><span class="op" id="916984">,</span>&nbsp;<span class="num" id="916986">128</span><span class="op" id="916989">)</span><span class="op" id="916990">:</span>&nbsp;<span class="string" id="916992">&#34;longval&#34;</span><span class="op" id="917001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917004">}</span><span class="op" id="917005">)</span><br>
<span class="lineno">365</span><span class="op" id="917007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="917010">func</span>&nbsp;<span class="ident" id="917015">testMapLookups</span><span class="op" id="917029">(</span><span class="ident" id="917030">t</span>&nbsp;<span class="op" id="917032">*</span><span class="ident" id="917033">testing</span><span class="op" id="917040">.</span><span class="ident" id="917041">T</span><span class="op" id="917042">,</span>&nbsp;<span class="ident" id="917044">m</span>&nbsp;<span class="keyword" id="917046">map</span><span class="op" id="917049">[</span><span class="builtintype" id="917050">string</span><span class="op" id="917056">]</span><span class="builtintype" id="917057">string</span><span class="op" id="917063">)</span>&nbsp;<span class="op" id="917065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917068">for</span>&nbsp;<span class="ident" id="917072">k</span><span class="op" id="917073">,</span>&nbsp;<span class="ident" id="917075">v</span>&nbsp;<span class="op" id="917077">:=</span>&nbsp;<span class="keyword" id="917080">range</span>&nbsp;<span class="ident" id="917086">m</span>&nbsp;<span class="op" id="917088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917092">if</span>&nbsp;<span class="ident" id="917095">m</span><span class="op" id="917096">[</span><span class="ident" id="917097">k</span><span class="op" id="917098">]</span>&nbsp;<span class="op" id="917100">!=</span>&nbsp;<span class="ident" id="917103">v</span>&nbsp;<span class="op" id="917105">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917110">t</span><span class="op" id="917111">.</span><span class="ident" id="917112">Fatalf</span><span class="op" id="917118">(</span><span class="string" id="917119">&#34;m[%q]&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="917140">,</span>&nbsp;<span class="ident" id="917142">k</span><span class="op" id="917143">,</span>&nbsp;<span class="ident" id="917145">m</span><span class="op" id="917146">[</span><span class="ident" id="917147">k</span><span class="op" id="917148">]</span><span class="op" id="917149">,</span>&nbsp;<span class="ident" id="917151">v</span><span class="op" id="917152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917159">}</span><br>
<span class="lineno"></span><span class="op" id="917161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="917164">//&nbsp;Tests&nbsp;whether&nbsp;the&nbsp;iterator&nbsp;returns&nbsp;the&nbsp;right&nbsp;elements&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="917226">//&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;grow,&nbsp;when&nbsp;the&nbsp;keys&nbsp;are&nbsp;NaNs.</span><br>
<span class="lineno"></span><span class="keyword" id="917286">func</span>&nbsp;<span class="ident" id="917291">TestMapNanGrowIterator</span><span class="op" id="917313">(</span><span class="ident" id="917314">t</span>&nbsp;<span class="op" id="917316">*</span><span class="ident" id="917317">testing</span><span class="op" id="917324">.</span><span class="ident" id="917325">T</span><span class="op" id="917326">)</span>&nbsp;<span class="op" id="917328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917331">m</span>&nbsp;<span class="op" id="917333">:=</span>&nbsp;<span class="builtinfunc" id="917336">make</span><span class="op" id="917340">(</span><span class="keyword" id="917341">map</span><span class="op" id="917344">[</span><span class="builtintype" id="917345">float64</span><span class="op" id="917352">]</span><span class="builtintype" id="917353">int</span><span class="op" id="917356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917359">nan</span>&nbsp;<span class="op" id="917363">:=</span>&nbsp;<span class="ident" id="917366">math</span><span class="op" id="917370">.</span><span class="ident" id="917371">NaN</span><span class="op" id="917374">(</span><span class="op" id="917375">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917378">const</span>&nbsp;<span class="ident" id="917384">nBuckets</span>&nbsp;<span class="op" id="917393">=</span>&nbsp;<span class="num" id="917395">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="917399">//&nbsp;To&nbsp;fill&nbsp;nBuckets&nbsp;buckets&nbsp;takes&nbsp;LOAD&nbsp;*&nbsp;nBuckets&nbsp;keys.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917456">nKeys</span>&nbsp;<span class="op" id="917462">:=</span>&nbsp;<span class="builtintype" id="917465">int</span><span class="op" id="917468">(</span><span class="ident" id="917469">nBuckets</span>&nbsp;<span class="op" id="917478">*</span>&nbsp;<span class="op" id="917480">*</span><span class="ident" id="917481">runtime</span><span class="op" id="917488">.</span><span class="ident" id="917489">HashLoad</span><span class="op" id="917497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="917501">//&nbsp;Get&nbsp;map&nbsp;to&nbsp;full&nbsp;point&nbsp;with&nbsp;nan&nbsp;keys.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917542">for</span>&nbsp;<span class="ident" id="917546">i</span>&nbsp;<span class="op" id="917548">:=</span>&nbsp;<span class="num" id="917551">0</span><span class="op" id="917552">;</span>&nbsp;<span class="ident" id="917554">i</span>&nbsp;<span class="op" id="917556">&lt;</span>&nbsp;<span class="ident" id="917558">nKeys</span><span class="op" id="917563">;</span>&nbsp;<span class="ident" id="917565">i</span><span class="op" id="917566">++</span>&nbsp;<span class="op" id="917569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917573">m</span><span class="op" id="917574">[</span><span class="ident" id="917575">nan</span><span class="op" id="917578">]</span>&nbsp;<span class="op" id="917580">=</span>&nbsp;<span class="ident" id="917582">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="917588">//&nbsp;Trigger&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917605">m</span><span class="op" id="917606">[</span><span class="num" id="917607">1.0</span><span class="op" id="917610">]</span>&nbsp;<span class="op" id="917612">=</span>&nbsp;<span class="num" id="917614">1</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="917617">delete</span><span class="op" id="917623">(</span><span class="ident" id="917624">m</span><span class="op" id="917625">,</span>&nbsp;<span class="num" id="917627">1.0</span><span class="op" id="917630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="917634">//&nbsp;Run&nbsp;iterator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917651">found</span>&nbsp;<span class="op" id="917657">:=</span>&nbsp;<span class="builtinfunc" id="917660">make</span><span class="op" id="917664">(</span><span class="keyword" id="917665">map</span><span class="op" id="917668">[</span><span class="builtintype" id="917669">int</span><span class="op" id="917672">]</span><span class="keyword" id="917673">struct</span><span class="op" id="917679">{</span><span class="op" id="917680">}</span><span class="op" id="917681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917684">for</span>&nbsp;<span class="ident" id="917688">_</span><span class="op" id="917689">,</span>&nbsp;<span class="ident" id="917691">v</span>&nbsp;<span class="op" id="917693">:=</span>&nbsp;<span class="keyword" id="917696">range</span>&nbsp;<span class="ident" id="917702">m</span>&nbsp;<span class="op" id="917704">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917708">if</span>&nbsp;<span class="ident" id="917711">v</span>&nbsp;<span class="op" id="917713">!=</span>&nbsp;<span class="op" id="917716">-</span><span class="num" id="917717">1</span>&nbsp;<span class="op" id="917719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917724">if</span>&nbsp;<span class="ident" id="917727">_</span><span class="op" id="917728">,</span>&nbsp;<span class="ident" id="917730">repeat</span>&nbsp;<span class="op" id="917737">:=</span>&nbsp;<span class="ident" id="917740">found</span><span class="op" id="917745">[</span><span class="ident" id="917746">v</span><span class="op" id="917747">]</span><span class="op" id="917748">;</span>&nbsp;<span class="ident" id="917750">repeat</span>&nbsp;<span class="op" id="917757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917763">t</span><span class="op" id="917764">.</span><span class="ident" id="917765">Fatalf</span><span class="op" id="917771">(</span><span class="string" id="917772">&#34;repeat&nbsp;of&nbsp;value&nbsp;%d&#34;</span><span class="op" id="917792">,</span>&nbsp;<span class="ident" id="917794">v</span><span class="op" id="917795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="917805">found</span><span class="op" id="917810">[</span><span class="ident" id="917811">v</span><span class="op" id="917812">]</span>&nbsp;<span class="op" id="917814">=</span>&nbsp;<span class="keyword" id="917816">struct</span><span class="op" id="917822">{</span><span class="op" id="917823">}</span><span class="op" id="917824">{</span><span class="op" id="917825">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917833">if</span>&nbsp;<span class="builtinfunc" id="917836">len</span><span class="op" id="917839">(</span><span class="ident" id="917840">found</span><span class="op" id="917845">)</span>&nbsp;<span class="op" id="917847">==</span>&nbsp;<span class="ident" id="917850">nKeys</span><span class="op" id="917855">/</span><span class="num" id="917856">2</span>&nbsp;<span class="op" id="917858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="917863">//&nbsp;Halfway&nbsp;through&nbsp;iteration,&nbsp;finish&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917909">for</span>&nbsp;<span class="ident" id="917913">i</span>&nbsp;<span class="op" id="917915">:=</span>&nbsp;<span class="num" id="917918">0</span><span class="op" id="917919">;</span>&nbsp;<span class="ident" id="917921">i</span>&nbsp;<span class="op" id="917923">&lt;</span>&nbsp;<span class="ident" id="917925">nBuckets</span><span class="op" id="917933">;</span>&nbsp;<span class="ident" id="917935">i</span><span class="op" id="917936">++</span>&nbsp;<span class="op" id="917939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="917945">delete</span><span class="op" id="917951">(</span><span class="ident" id="917952">m</span><span class="op" id="917953">,</span>&nbsp;<span class="num" id="917955">1.0</span><span class="op" id="917958">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="917970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="917973">if</span>&nbsp;<span class="builtinfunc" id="917976">len</span><span class="op" id="917979">(</span><span class="ident" id="917980">found</span><span class="op" id="917985">)</span>&nbsp;<span class="op" id="917987">!=</span>&nbsp;<span class="ident" id="917990">nKeys</span>&nbsp;<span class="op" id="917996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918000">t</span><span class="op" id="918001">.</span><span class="ident" id="918002">Fatalf</span><span class="op" id="918008">(</span><span class="string" id="918009">&#34;missing&nbsp;value&#34;</span><span class="op" id="918024">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918027">}</span><br>
<span class="lineno"></span><span class="op" id="918029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="918032">func</span>&nbsp;<span class="ident" id="918037">TestMapIterOrder</span><span class="op" id="918053">(</span><span class="ident" id="918054">t</span>&nbsp;<span class="op" id="918056">*</span><span class="ident" id="918057">testing</span><span class="op" id="918064">.</span><span class="ident" id="918065">T</span><span class="op" id="918066">)</span>&nbsp;<span class="op" id="918068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918071">for</span>&nbsp;<span class="ident" id="918075">_</span><span class="op" id="918076">,</span>&nbsp;<span class="ident" id="918078">n</span>&nbsp;<span class="op" id="918080">:=</span>&nbsp;<span class="keyword" id="918083">range</span>&nbsp;<span class="op" id="918089">[</span><span class="op" id="918090">...</span><span class="op" id="918093">]</span><span class="builtintype" id="918094">int</span><span class="op" id="918097">{</span><span class="num" id="918098">3</span><span class="op" id="918099">,</span>&nbsp;<span class="num" id="918101">7</span><span class="op" id="918102">,</span>&nbsp;<span class="num" id="918104">9</span><span class="op" id="918105">,</span>&nbsp;<span class="num" id="918107">15</span><span class="op" id="918109">}</span>&nbsp;<span class="op" id="918111">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918115">for</span>&nbsp;<span class="ident" id="918119">i</span>&nbsp;<span class="op" id="918121">:=</span>&nbsp;<span class="num" id="918124">0</span><span class="op" id="918125">;</span>&nbsp;<span class="ident" id="918127">i</span>&nbsp;<span class="op" id="918129">&lt;</span>&nbsp;<span class="num" id="918131">1000</span><span class="op" id="918135">;</span>&nbsp;<span class="ident" id="918137">i</span><span class="op" id="918138">++</span>&nbsp;<span class="op" id="918141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="918146">//&nbsp;Make&nbsp;m&nbsp;be&nbsp;{0:&nbsp;true,&nbsp;1:&nbsp;true,&nbsp;...,&nbsp;n-1:&nbsp;true}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918198">m</span>&nbsp;<span class="op" id="918200">:=</span>&nbsp;<span class="builtinfunc" id="918203">make</span><span class="op" id="918207">(</span><span class="keyword" id="918208">map</span><span class="op" id="918211">[</span><span class="builtintype" id="918212">int</span><span class="op" id="918215">]</span><span class="builtintype" id="918216">bool</span><span class="op" id="918220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918225">for</span>&nbsp;<span class="ident" id="918229">i</span>&nbsp;<span class="op" id="918231">:=</span>&nbsp;<span class="num" id="918234">0</span><span class="op" id="918235">;</span>&nbsp;<span class="ident" id="918237">i</span>&nbsp;<span class="op" id="918239">&lt;</span>&nbsp;<span class="ident" id="918241">n</span><span class="op" id="918242">;</span>&nbsp;<span class="ident" id="918244">i</span><span class="op" id="918245">++</span>&nbsp;<span class="op" id="918248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918254">m</span><span class="op" id="918255">[</span><span class="ident" id="918256">i</span><span class="op" id="918257">]</span>&nbsp;<span class="op" id="918259">=</span>&nbsp;<span class="builtintype" id="918261">true</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="918274">//&nbsp;Check&nbsp;that&nbsp;iterating&nbsp;over&nbsp;the&nbsp;map&nbsp;produces&nbsp;at&nbsp;least&nbsp;two&nbsp;different&nbsp;orderings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918357">ord</span>&nbsp;<span class="op" id="918361">:=</span>&nbsp;<span class="keyword" id="918364">func</span><span class="op" id="918368">(</span><span class="op" id="918369">)</span>&nbsp;<span class="op" id="918371">[</span><span class="op" id="918372">]</span><span class="builtintype" id="918373">int</span>&nbsp;<span class="op" id="918377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918383">var</span>&nbsp;<span class="ident" id="918387">s</span>&nbsp;<span class="op" id="918389">[</span><span class="op" id="918390">]</span><span class="builtintype" id="918391">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918399">for</span>&nbsp;<span class="ident" id="918403">key</span>&nbsp;<span class="op" id="918407">:=</span>&nbsp;<span class="keyword" id="918410">range</span>&nbsp;<span class="ident" id="918416">m</span>&nbsp;<span class="op" id="918418">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918425">s</span>&nbsp;<span class="op" id="918427">=</span>&nbsp;<span class="builtinfunc" id="918429">append</span><span class="op" id="918435">(</span><span class="ident" id="918436">s</span><span class="op" id="918437">,</span>&nbsp;<span class="ident" id="918439">key</span><span class="op" id="918442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918454">return</span>&nbsp;<span class="ident" id="918461">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918471">first</span>&nbsp;<span class="op" id="918477">:=</span>&nbsp;<span class="ident" id="918480">ord</span><span class="op" id="918483">(</span><span class="op" id="918484">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918489">ok</span>&nbsp;<span class="op" id="918492">:=</span>&nbsp;<span class="builtintype" id="918495">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918504">for</span>&nbsp;<span class="ident" id="918508">try</span>&nbsp;<span class="op" id="918512">:=</span>&nbsp;<span class="num" id="918515">0</span><span class="op" id="918516">;</span>&nbsp;<span class="ident" id="918518">try</span>&nbsp;<span class="op" id="918522">&lt;</span>&nbsp;<span class="num" id="918524">100</span><span class="op" id="918527">;</span>&nbsp;<span class="ident" id="918529">try</span><span class="op" id="918532">++</span>&nbsp;<span class="op" id="918535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918541">if</span>&nbsp;<span class="op" id="918544">!</span><span class="ident" id="918545">reflect</span><span class="op" id="918552">.</span><span class="ident" id="918553">DeepEqual</span><span class="op" id="918562">(</span><span class="ident" id="918563">first</span><span class="op" id="918568">,</span>&nbsp;<span class="ident" id="918570">ord</span><span class="op" id="918573">(</span><span class="op" id="918574">)</span><span class="op" id="918575">)</span>&nbsp;<span class="op" id="918577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918584">ok</span>&nbsp;<span class="op" id="918587">=</span>&nbsp;<span class="builtintype" id="918589">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918599">break</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918619">if</span>&nbsp;<span class="op" id="918622">!</span><span class="ident" id="918623">ok</span>&nbsp;<span class="op" id="918626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918632">t</span><span class="op" id="918633">.</span><span class="ident" id="918634">Errorf</span><span class="op" id="918640">(</span><span class="string" id="918641">&#34;Map&nbsp;with&nbsp;n=%d&nbsp;elements&nbsp;had&nbsp;consistent&nbsp;iteration&nbsp;order:&nbsp;%v&#34;</span><span class="op" id="918700">,</span>&nbsp;<span class="ident" id="918702">n</span><span class="op" id="918703">,</span>&nbsp;<span class="ident" id="918705">first</span><span class="op" id="918710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918716">break</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="918732">}</span><br>
<span class="lineno"></span><span class="op" id="918734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="comment" id="918737">//&nbsp;Issue&nbsp;8410</span><br>
<span class="lineno"></span><span class="keyword" id="918751">func</span>&nbsp;<span class="ident" id="918756">TestMapSparseIterOrder</span><span class="op" id="918778">(</span><span class="ident" id="918779">t</span>&nbsp;<span class="op" id="918781">*</span><span class="ident" id="918782">testing</span><span class="op" id="918789">.</span><span class="ident" id="918790">T</span><span class="op" id="918791">)</span>&nbsp;<span class="op" id="918793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="918796">//&nbsp;Run&nbsp;several&nbsp;rounds&nbsp;to&nbsp;increase&nbsp;the&nbsp;probability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="918847">//&nbsp;of&nbsp;failure.&nbsp;One&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span><span class="ident" id="918881">NextRound</span><span class="op" id="918890">:</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918893">for</span>&nbsp;<span class="ident" id="918897">round</span>&nbsp;<span class="op" id="918903">:=</span>&nbsp;<span class="num" id="918906">0</span><span class="op" id="918907">;</span>&nbsp;<span class="ident" id="918909">round</span>&nbsp;<span class="op" id="918915">&lt;</span>&nbsp;<span class="num" id="918917">10</span><span class="op" id="918919">;</span>&nbsp;<span class="ident" id="918921">round</span><span class="op" id="918926">++</span>&nbsp;<span class="op" id="918929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="918933">m</span>&nbsp;<span class="op" id="918935">:=</span>&nbsp;<span class="builtinfunc" id="918938">make</span><span class="op" id="918942">(</span><span class="keyword" id="918943">map</span><span class="op" id="918946">[</span><span class="builtintype" id="918947">int</span><span class="op" id="918950">]</span><span class="builtintype" id="918951">bool</span><span class="op" id="918955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="918959">//&nbsp;Add&nbsp;1000&nbsp;items,&nbsp;remove&nbsp;980.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="918992">for</span>&nbsp;<span class="ident" id="918996">i</span>&nbsp;<span class="op" id="918998">:=</span>&nbsp;<span class="num" id="919001">0</span><span class="op" id="919002">;</span>&nbsp;<span class="ident" id="919004">i</span>&nbsp;<span class="op" id="919006">&lt;</span>&nbsp;<span class="num" id="919008">1000</span><span class="op" id="919012">;</span>&nbsp;<span class="ident" id="919014">i</span><span class="op" id="919015">++</span>&nbsp;<span class="op" id="919018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919023">m</span><span class="op" id="919024">[</span><span class="ident" id="919025">i</span><span class="op" id="919026">]</span>&nbsp;<span class="op" id="919028">=</span>&nbsp;<span class="builtintype" id="919030">true</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919041">for</span>&nbsp;<span class="ident" id="919045">i</span>&nbsp;<span class="op" id="919047">:=</span>&nbsp;<span class="num" id="919050">20</span><span class="op" id="919052">;</span>&nbsp;<span class="ident" id="919054">i</span>&nbsp;<span class="op" id="919056">&lt;</span>&nbsp;<span class="num" id="919058">1000</span><span class="op" id="919062">;</span>&nbsp;<span class="ident" id="919064">i</span><span class="op" id="919065">++</span>&nbsp;<span class="op" id="919068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="919073">delete</span><span class="op" id="919079">(</span><span class="ident" id="919080">m</span><span class="op" id="919081">,</span>&nbsp;<span class="ident" id="919083">i</span><span class="op" id="919084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919093">var</span>&nbsp;<span class="ident" id="919097">first</span>&nbsp;<span class="op" id="919103">[</span><span class="op" id="919104">]</span><span class="builtintype" id="919105">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919111">for</span>&nbsp;<span class="ident" id="919115">i</span>&nbsp;<span class="op" id="919117">:=</span>&nbsp;<span class="keyword" id="919120">range</span>&nbsp;<span class="ident" id="919126">m</span>&nbsp;<span class="op" id="919128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919133">first</span>&nbsp;<span class="op" id="919139">=</span>&nbsp;<span class="builtinfunc" id="919141">append</span><span class="op" id="919147">(</span><span class="ident" id="919148">first</span><span class="op" id="919153">,</span>&nbsp;<span class="ident" id="919155">i</span><span class="op" id="919156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="919165">//&nbsp;800&nbsp;chances&nbsp;to&nbsp;get&nbsp;a&nbsp;different&nbsp;iteration&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="919218">//&nbsp;See&nbsp;bug&nbsp;8736&nbsp;for&nbsp;why&nbsp;we&nbsp;need&nbsp;so&nbsp;many&nbsp;tries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919267">for</span>&nbsp;<span class="ident" id="919271">n</span>&nbsp;<span class="op" id="919273">:=</span>&nbsp;<span class="num" id="919276">0</span><span class="op" id="919277">;</span>&nbsp;<span class="ident" id="919279">n</span>&nbsp;<span class="op" id="919281">&lt;</span>&nbsp;<span class="num" id="919283">800</span><span class="op" id="919286">;</span>&nbsp;<span class="ident" id="919288">n</span><span class="op" id="919289">++</span>&nbsp;<span class="op" id="919292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919297">idx</span>&nbsp;<span class="op" id="919301">:=</span>&nbsp;<span class="num" id="919304">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919309">for</span>&nbsp;<span class="ident" id="919313">i</span>&nbsp;<span class="op" id="919315">:=</span>&nbsp;<span class="keyword" id="919318">range</span>&nbsp;<span class="ident" id="919324">m</span>&nbsp;<span class="op" id="919326">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919332">if</span>&nbsp;<span class="ident" id="919335">i</span>&nbsp;<span class="op" id="919337">!=</span>&nbsp;<span class="ident" id="919340">first</span><span class="op" id="919345">[</span><span class="ident" id="919346">idx</span><span class="op" id="919349">]</span>&nbsp;<span class="op" id="919351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="919358">//&nbsp;iteration&nbsp;order&nbsp;changed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919391">continue</span>&nbsp;<span class="ident" id="919400">NextRound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919420">idx</span><span class="op" id="919423">++</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919437">t</span><span class="op" id="919438">.</span><span class="ident" id="919439">Fatalf</span><span class="op" id="919445">(</span><span class="string" id="919446">&#34;constant&nbsp;iteration&nbsp;order&nbsp;on&nbsp;round&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="919488">,</span>&nbsp;<span class="ident" id="919490">round</span><span class="op" id="919495">,</span>&nbsp;<span class="ident" id="919497">first</span><span class="op" id="919502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919505">}</span><br>
<span class="lineno"></span><span class="op" id="919507">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="keyword" id="919510">func</span>&nbsp;<span class="ident" id="919515">TestMapStringBytesLookup</span><span class="op" id="919539">(</span><span class="ident" id="919540">t</span>&nbsp;<span class="op" id="919542">*</span><span class="ident" id="919543">testing</span><span class="op" id="919550">.</span><span class="ident" id="919551">T</span><span class="op" id="919552">)</span>&nbsp;<span class="op" id="919554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="919557">//&nbsp;Use&nbsp;large&nbsp;string&nbsp;keys&nbsp;to&nbsp;avoid&nbsp;small-allocation&nbsp;coalescing,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="919621">//&nbsp;which&nbsp;can&nbsp;cause&nbsp;AllocsPerRun&nbsp;to&nbsp;report&nbsp;lower&nbsp;counts&nbsp;than&nbsp;it&nbsp;should.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919693">m</span>&nbsp;<span class="op" id="919695">:=</span>&nbsp;<span class="keyword" id="919698">map</span><span class="op" id="919701">[</span><span class="builtintype" id="919702">string</span><span class="op" id="919708">]</span><span class="builtintype" id="919709">int</span><span class="op" id="919712">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="919716">&#34;1000000000000000000000000000000000000000000000000&#34;</span><span class="op" id="919767">:</span>&nbsp;<span class="num" id="919769">1</span><span class="op" id="919770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="919774">&#34;2000000000000000000000000000000000000000000000000&#34;</span><span class="op" id="919825">:</span>&nbsp;<span class="num" id="919827">2</span><span class="op" id="919828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919834">buf</span>&nbsp;<span class="op" id="919838">:=</span>&nbsp;<span class="op" id="919841">[</span><span class="op" id="919842">]</span><span class="builtintype" id="919843">byte</span><span class="op" id="919847">(</span><span class="string" id="919848">&#34;1000000000000000000000000000000000000000000000000&#34;</span><span class="op" id="919899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="919902">if</span>&nbsp;<span class="ident" id="919905">x</span>&nbsp;<span class="op" id="919907">:=</span>&nbsp;<span class="ident" id="919910">m</span><span class="op" id="919911">[</span><span class="builtintype" id="919912">string</span><span class="op" id="919918">(</span><span class="ident" id="919919">buf</span><span class="op" id="919922">)</span><span class="op" id="919923">]</span><span class="op" id="919924">;</span>&nbsp;<span class="ident" id="919926">x</span>&nbsp;<span class="op" id="919928">!=</span>&nbsp;<span class="num" id="919931">1</span>&nbsp;<span class="op" id="919933">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919937">t</span><span class="op" id="919938">.</span><span class="ident" id="919939">Errorf</span><span class="op" id="919945">(</span><span class="string" id="919946">`m[string([]byte(&#34;1&#34;))]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;1`</span><span class="op" id="919983">,</span>&nbsp;<span class="ident" id="919985">x</span><span class="op" id="919986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="919989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="919992">buf</span><span class="op" id="919995">[</span><span class="num" id="919996">0</span><span class="op" id="919997">]</span>&nbsp;<span class="op" id="919999">=</span>&nbsp;<span class="string" id="920001">&#39;2&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920006">if</span>&nbsp;<span class="ident" id="920009">x</span>&nbsp;<span class="op" id="920011">:=</span>&nbsp;<span class="ident" id="920014">m</span><span class="op" id="920015">[</span><span class="builtintype" id="920016">string</span><span class="op" id="920022">(</span><span class="ident" id="920023">buf</span><span class="op" id="920026">)</span><span class="op" id="920027">]</span><span class="op" id="920028">;</span>&nbsp;<span class="ident" id="920030">x</span>&nbsp;<span class="op" id="920032">!=</span>&nbsp;<span class="num" id="920035">2</span>&nbsp;<span class="op" id="920037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920041">t</span><span class="op" id="920042">.</span><span class="ident" id="920043">Errorf</span><span class="op" id="920049">(</span><span class="string" id="920050">`m[string([]byte(&#34;2&#34;))]&nbsp;=&nbsp;%d,&nbsp;want&nbsp;2`</span><span class="op" id="920087">,</span>&nbsp;<span class="ident" id="920089">x</span><span class="op" id="920090">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920097">var</span>&nbsp;<span class="ident" id="920101">x</span>&nbsp;<span class="builtintype" id="920103">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920108">n</span>&nbsp;<span class="op" id="920110">:=</span>&nbsp;<span class="ident" id="920113">testing</span><span class="op" id="920120">.</span><span class="ident" id="920121">AllocsPerRun</span><span class="op" id="920133">(</span><span class="num" id="920134">100</span><span class="op" id="920137">,</span>&nbsp;<span class="keyword" id="920139">func</span><span class="op" id="920143">(</span><span class="op" id="920144">)</span>&nbsp;<span class="op" id="920146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920150">x</span>&nbsp;<span class="op" id="920152">+=</span>&nbsp;<span class="ident" id="920155">m</span><span class="op" id="920156">[</span><span class="builtintype" id="920157">string</span><span class="op" id="920163">(</span><span class="ident" id="920164">buf</span><span class="op" id="920167">)</span><span class="op" id="920168">]</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920171">}</span><span class="op" id="920172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920175">if</span>&nbsp;<span class="ident" id="920178">n</span>&nbsp;<span class="op" id="920180">!=</span>&nbsp;<span class="num" id="920183">0</span>&nbsp;<span class="op" id="920185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920189">t</span><span class="op" id="920190">.</span><span class="ident" id="920191">Errorf</span><span class="op" id="920197">(</span><span class="string" id="920198">&#34;AllocsPerRun&nbsp;for&nbsp;m[string(buf)]&nbsp;=&nbsp;%v,&nbsp;want&nbsp;0&#34;</span><span class="op" id="920244">,</span>&nbsp;<span class="ident" id="920246">n</span><span class="op" id="920247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920254">x</span>&nbsp;<span class="op" id="920256">=</span>&nbsp;<span class="num" id="920258">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920261">n</span>&nbsp;<span class="op" id="920263">=</span>&nbsp;<span class="ident" id="920265">testing</span><span class="op" id="920272">.</span><span class="ident" id="920273">AllocsPerRun</span><span class="op" id="920285">(</span><span class="num" id="920286">100</span><span class="op" id="920289">,</span>&nbsp;<span class="keyword" id="920291">func</span><span class="op" id="920295">(</span><span class="op" id="920296">)</span>&nbsp;<span class="op" id="920298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920302">y</span><span class="op" id="920303">,</span>&nbsp;<span class="ident" id="920305">ok</span>&nbsp;<span class="op" id="920308">:=</span>&nbsp;<span class="ident" id="920311">m</span><span class="op" id="920312">[</span><span class="builtintype" id="920313">string</span><span class="op" id="920319">(</span><span class="ident" id="920320">buf</span><span class="op" id="920323">)</span><span class="op" id="920324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920328">if</span>&nbsp;<span class="op" id="920331">!</span><span class="ident" id="920332">ok</span>&nbsp;<span class="op" id="920335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="920340">panic</span><span class="op" id="920345">(</span><span class="string" id="920346">&#34;!ok&#34;</span><span class="op" id="920351">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920359">x</span>&nbsp;<span class="op" id="920361">+=</span>&nbsp;<span class="ident" id="920364">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920367">}</span><span class="op" id="920368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920371">if</span>&nbsp;<span class="ident" id="920374">n</span>&nbsp;<span class="op" id="920376">!=</span>&nbsp;<span class="num" id="920379">0</span>&nbsp;<span class="op" id="920381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920385">t</span><span class="op" id="920386">.</span><span class="ident" id="920387">Errorf</span><span class="op" id="920393">(</span><span class="string" id="920394">&#34;AllocsPerRun&nbsp;for&nbsp;x,ok&nbsp;=&nbsp;m[string(buf)]&nbsp;=&nbsp;%v,&nbsp;want&nbsp;0&#34;</span><span class="op" id="920447">,</span>&nbsp;<span class="ident" id="920449">n</span><span class="op" id="920450">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920453">}</span><br>
<span class="lineno"></span><span class="op" id="920455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="920458">func</span>&nbsp;<span class="ident" id="920463">benchmarkMapPop</span><span class="op" id="920478">(</span><span class="ident" id="920479">b</span>&nbsp;<span class="op" id="920481">*</span><span class="ident" id="920482">testing</span><span class="op" id="920489">.</span><span class="ident" id="920490">B</span><span class="op" id="920491">,</span>&nbsp;<span class="ident" id="920493">n</span>&nbsp;<span class="builtintype" id="920495">int</span><span class="op" id="920498">)</span>&nbsp;<span class="op" id="920500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920503">m</span>&nbsp;<span class="op" id="920505">:=</span>&nbsp;<span class="keyword" id="920508">map</span><span class="op" id="920511">[</span><span class="builtintype" id="920512">int</span><span class="op" id="920515">]</span><span class="builtintype" id="920516">int</span><span class="op" id="920519">{</span><span class="op" id="920520">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920523">for</span>&nbsp;<span class="ident" id="920527">i</span>&nbsp;<span class="op" id="920529">:=</span>&nbsp;<span class="num" id="920532">0</span><span class="op" id="920533">;</span>&nbsp;<span class="ident" id="920535">i</span>&nbsp;<span class="op" id="920537">&lt;</span>&nbsp;<span class="ident" id="920539">b</span><span class="op" id="920540">.</span><span class="ident" id="920541">N</span><span class="op" id="920542">;</span>&nbsp;<span class="ident" id="920544">i</span><span class="op" id="920545">++</span>&nbsp;<span class="op" id="920548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920552">for</span>&nbsp;<span class="ident" id="920556">j</span>&nbsp;<span class="op" id="920558">:=</span>&nbsp;<span class="num" id="920561">0</span><span class="op" id="920562">;</span>&nbsp;<span class="ident" id="920564">j</span>&nbsp;<span class="op" id="920566">&lt;</span>&nbsp;<span class="ident" id="920568">n</span><span class="op" id="920569">;</span>&nbsp;<span class="ident" id="920571">j</span><span class="op" id="920572">++</span>&nbsp;<span class="op" id="920575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="920580">m</span><span class="op" id="920581">[</span><span class="ident" id="920582">j</span><span class="op" id="920583">]</span>&nbsp;<span class="op" id="920585">=</span>&nbsp;<span class="ident" id="920587">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920595">for</span>&nbsp;<span class="ident" id="920599">j</span>&nbsp;<span class="op" id="920601">:=</span>&nbsp;<span class="num" id="920604">0</span><span class="op" id="920605">;</span>&nbsp;<span class="ident" id="920607">j</span>&nbsp;<span class="op" id="920609">&lt;</span>&nbsp;<span class="ident" id="920611">n</span><span class="op" id="920612">;</span>&nbsp;<span class="ident" id="920614">j</span><span class="op" id="920615">++</span>&nbsp;<span class="op" id="920618">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="920623">//&nbsp;Use&nbsp;iterator&nbsp;to&nbsp;pop&nbsp;an&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="920661">//&nbsp;We&nbsp;want&nbsp;this&nbsp;to&nbsp;be&nbsp;fast,&nbsp;see&nbsp;issue&nbsp;8412.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920708">for</span>&nbsp;<span class="ident" id="920712">k</span>&nbsp;<span class="op" id="920714">:=</span>&nbsp;<span class="keyword" id="920717">range</span>&nbsp;<span class="ident" id="920723">m</span>&nbsp;<span class="op" id="920725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="920731">delete</span><span class="op" id="920737">(</span><span class="ident" id="920738">m</span><span class="op" id="920739">,</span>&nbsp;<span class="ident" id="920741">k</span><span class="op" id="920742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="920748">break</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="920764">}</span><br>
<span class="lineno"></span><span class="op" id="920766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="920769">func</span>&nbsp;<span class="ident" id="920774">BenchmarkMapPop100</span><span class="op" id="920792">(</span><span class="ident" id="920793">b</span>&nbsp;<span class="op" id="920795">*</span><span class="ident" id="920796">testing</span><span class="op" id="920803">.</span><span class="ident" id="920804">B</span><span class="op" id="920805">)</span>&nbsp;&nbsp;&nbsp;<span class="op" id="920809">{</span>&nbsp;<span class="ident" id="920811">benchmarkMapPop</span><span class="op" id="920826">(</span><span class="ident" id="920827">b</span><span class="op" id="920828">,</span>&nbsp;<span class="num" id="920830">100</span><span class="op" id="920833">)</span>&nbsp;<span class="op" id="920835">}</span><br>
<span class="lineno"></span><span class="keyword" id="920837">func</span>&nbsp;<span class="ident" id="920842">BenchmarkMapPop1000</span><span class="op" id="920861">(</span><span class="ident" id="920862">b</span>&nbsp;<span class="op" id="920864">*</span><span class="ident" id="920865">testing</span><span class="op" id="920872">.</span><span class="ident" id="920873">B</span><span class="op" id="920874">)</span>&nbsp;&nbsp;<span class="op" id="920877">{</span>&nbsp;<span class="ident" id="920879">benchmarkMapPop</span><span class="op" id="920894">(</span><span class="ident" id="920895">b</span><span class="op" id="920896">,</span>&nbsp;<span class="num" id="920898">1000</span><span class="op" id="920902">)</span>&nbsp;<span class="op" id="920904">}</span><br>
<span class="lineno"></span><span class="keyword" id="920906">func</span>&nbsp;<span class="ident" id="920911">BenchmarkMapPop10000</span><span class="op" id="920931">(</span><span class="ident" id="920932">b</span>&nbsp;<span class="op" id="920934">*</span><span class="ident" id="920935">testing</span><span class="op" id="920942">.</span><span class="ident" id="920943">B</span><span class="op" id="920944">)</span>&nbsp;<span class="op" id="920946">{</span>&nbsp;<span class="ident" id="920948">benchmarkMapPop</span><span class="op" id="920963">(</span><span class="ident" id="920964">b</span><span class="op" id="920965">,</span>&nbsp;<span class="num" id="920967">10000</span><span class="op" id="920972">)</span>&nbsp;<span class="op" id="920974">}</span>
</div>
</body>
</html>
