<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3233238">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3233293">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3233347">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3233398">package</span>&nbsp;<span class="ident" id="3233406">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3233411">import</span>&nbsp;<span class="op" id="3233418">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3233421">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3233434">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3233441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3233444">//&nbsp;DNSError&nbsp;represents&nbsp;a&nbsp;DNS&nbsp;lookup&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3233487">type</span>&nbsp;<span class="ident" id="3233492">DNSError</span>&nbsp;<span class="keyword" id="3233501">struct</span>&nbsp;<span class="op" id="3233508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233511">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3233521">string</span>&nbsp;<span class="comment" id="3233528">//&nbsp;description&nbsp;of&nbsp;the&nbsp;error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233557">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3233567">string</span>&nbsp;<span class="comment" id="3233574">//&nbsp;name&nbsp;looked&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233594">Server</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3233604">string</span>&nbsp;<span class="comment" id="3233611">//&nbsp;server&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233627">IsTimeout</span>&nbsp;<span class="builtintype" id="3233637">bool</span><br>
<span class="lineno"></span><span class="op" id="3233642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3233645">func</span>&nbsp;<span class="op" id="3233650">(</span><span class="ident" id="3233651">e</span>&nbsp;<span class="op" id="3233653">*</span><span class="ident" id="3233654">DNSError</span><span class="op" id="3233662">)</span>&nbsp;<span class="ident" id="3233664">Error</span><span class="op" id="3233669">(</span><span class="op" id="3233670">)</span>&nbsp;<span class="builtintype" id="3233672">string</span>&nbsp;<span class="op" id="3233679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233682">if</span>&nbsp;<span class="ident" id="3233685">e</span>&nbsp;<span class="op" id="3233687">==</span>&nbsp;<span class="ident" id="3233690">nil</span>&nbsp;<span class="op" id="3233694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233698">return</span>&nbsp;<span class="string" id="3233705">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233717">s</span>&nbsp;<span class="op" id="3233719">:=</span>&nbsp;<span class="string" id="3233722">&#34;lookup&nbsp;&#34;</span>&nbsp;<span class="op" id="3233732">+</span>&nbsp;<span class="ident" id="3233734">e</span><span class="op" id="3233735">.</span><span class="ident" id="3233736">Name</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233742">if</span>&nbsp;<span class="ident" id="3233745">e</span><span class="op" id="3233746">.</span><span class="ident" id="3233747">Server</span>&nbsp;<span class="op" id="3233754">!=</span>&nbsp;<span class="string" id="3233757">&#34;&#34;</span>&nbsp;<span class="op" id="3233760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233764">s</span>&nbsp;<span class="op" id="3233766">+=</span>&nbsp;<span class="string" id="3233769">&#34;&nbsp;on&nbsp;&#34;</span>&nbsp;<span class="op" id="3233776">+</span>&nbsp;<span class="ident" id="3233778">e</span><span class="op" id="3233779">.</span><span class="ident" id="3233780">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233791">s</span>&nbsp;<span class="op" id="3233793">+=</span>&nbsp;<span class="string" id="3233796">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3233801">+</span>&nbsp;<span class="ident" id="3233803">e</span><span class="op" id="3233804">.</span><span class="ident" id="3233805">Err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233810">return</span>&nbsp;<span class="ident" id="3233817">s</span><br>
<span class="lineno">30</span><span class="op" id="3233819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3233822">func</span>&nbsp;<span class="op" id="3233827">(</span><span class="ident" id="3233828">e</span>&nbsp;<span class="op" id="3233830">*</span><span class="ident" id="3233831">DNSError</span><span class="op" id="3233839">)</span>&nbsp;<span class="ident" id="3233841">Timeout</span><span class="op" id="3233848">(</span><span class="op" id="3233849">)</span>&nbsp;<span class="builtintype" id="3233851">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3233858">{</span>&nbsp;<span class="keyword" id="3233860">return</span>&nbsp;<span class="ident" id="3233867">e</span><span class="op" id="3233868">.</span><span class="ident" id="3233869">IsTimeout</span>&nbsp;<span class="op" id="3233879">}</span><br>
<span class="lineno"></span><span class="keyword" id="3233881">func</span>&nbsp;<span class="op" id="3233886">(</span><span class="ident" id="3233887">e</span>&nbsp;<span class="op" id="3233889">*</span><span class="ident" id="3233890">DNSError</span><span class="op" id="3233898">)</span>&nbsp;<span class="ident" id="3233900">Temporary</span><span class="op" id="3233909">(</span><span class="op" id="3233910">)</span>&nbsp;<span class="builtintype" id="3233912">bool</span>&nbsp;<span class="op" id="3233917">{</span>&nbsp;<span class="keyword" id="3233919">return</span>&nbsp;<span class="ident" id="3233926">e</span><span class="op" id="3233927">.</span><span class="ident" id="3233928">IsTimeout</span>&nbsp;<span class="op" id="3233938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3233941">const</span>&nbsp;<span class="ident" id="3233947">noSuchHost</span>&nbsp;<span class="op" id="3233958">=</span>&nbsp;<span class="string" id="3233960">&#34;no&nbsp;such&nbsp;host&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3233976">//&nbsp;reverseaddr&nbsp;returns&nbsp;the&nbsp;in-addr.arpa.&nbsp;or&nbsp;ip6.arpa.&nbsp;hostname&nbsp;of&nbsp;the&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3234049">//&nbsp;address&nbsp;addr&nbsp;suitable&nbsp;for&nbsp;rDNS&nbsp;(PTR)&nbsp;record&nbsp;lookup&nbsp;or&nbsp;an&nbsp;error&nbsp;if&nbsp;it&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3234127">//&nbsp;to&nbsp;parse&nbsp;the&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">40</span><span class="keyword" id="3234155">func</span>&nbsp;<span class="ident" id="3234160">reverseaddr</span><span class="op" id="3234171">(</span><span class="ident" id="3234172">addr</span>&nbsp;<span class="builtintype" id="3234177">string</span><span class="op" id="3234183">)</span>&nbsp;<span class="op" id="3234185">(</span><span class="ident" id="3234186">arpa</span>&nbsp;<span class="builtintype" id="3234191">string</span><span class="op" id="3234197">,</span>&nbsp;<span class="ident" id="3234199">err</span>&nbsp;<span class="builtintype" id="3234203">error</span><span class="op" id="3234208">)</span>&nbsp;<span class="op" id="3234210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234213">ip</span>&nbsp;<span class="op" id="3234216">:=</span>&nbsp;<span class="ident" id="3234219">ParseIP</span><span class="op" id="3234226">(</span><span class="ident" id="3234227">addr</span><span class="op" id="3234231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234234">if</span>&nbsp;<span class="ident" id="3234237">ip</span>&nbsp;<span class="op" id="3234240">==</span>&nbsp;<span class="ident" id="3234243">nil</span>&nbsp;<span class="op" id="3234247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234251">return</span>&nbsp;<span class="string" id="3234258">&#34;&#34;</span><span class="op" id="3234260">,</span>&nbsp;<span class="op" id="3234262">&amp;</span><span class="ident" id="3234263">DNSError</span><span class="op" id="3234271">{</span><span class="ident" id="3234272">Err</span><span class="op" id="3234275">:</span>&nbsp;<span class="string" id="3234277">&#34;unrecognized&nbsp;address&#34;</span><span class="op" id="3234299">,</span>&nbsp;<span class="ident" id="3234301">Name</span><span class="op" id="3234305">:</span>&nbsp;<span class="ident" id="3234307">addr</span><span class="op" id="3234311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3234314">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234317">if</span>&nbsp;<span class="ident" id="3234320">ip</span><span class="op" id="3234322">.</span><span class="ident" id="3234323">To4</span><span class="op" id="3234326">(</span><span class="op" id="3234327">)</span>&nbsp;<span class="op" id="3234329">!=</span>&nbsp;<span class="ident" id="3234332">nil</span>&nbsp;<span class="op" id="3234336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234340">return</span>&nbsp;<span class="ident" id="3234347">itoa</span><span class="op" id="3234351">(</span><span class="builtintype" id="3234352">int</span><span class="op" id="3234355">(</span><span class="ident" id="3234356">ip</span><span class="op" id="3234358">[</span><span class="num" id="3234359">15</span><span class="op" id="3234361">]</span><span class="op" id="3234362">)</span><span class="op" id="3234363">)</span>&nbsp;<span class="op" id="3234365">+</span>&nbsp;<span class="string" id="3234367">&#34;.&#34;</span>&nbsp;<span class="op" id="3234371">+</span>&nbsp;<span class="ident" id="3234373">itoa</span><span class="op" id="3234377">(</span><span class="builtintype" id="3234378">int</span><span class="op" id="3234381">(</span><span class="ident" id="3234382">ip</span><span class="op" id="3234384">[</span><span class="num" id="3234385">14</span><span class="op" id="3234387">]</span><span class="op" id="3234388">)</span><span class="op" id="3234389">)</span>&nbsp;<span class="op" id="3234391">+</span>&nbsp;<span class="string" id="3234393">&#34;.&#34;</span>&nbsp;<span class="op" id="3234397">+</span>&nbsp;<span class="ident" id="3234399">itoa</span><span class="op" id="3234403">(</span><span class="builtintype" id="3234404">int</span><span class="op" id="3234407">(</span><span class="ident" id="3234408">ip</span><span class="op" id="3234410">[</span><span class="num" id="3234411">13</span><span class="op" id="3234413">]</span><span class="op" id="3234414">)</span><span class="op" id="3234415">)</span>&nbsp;<span class="op" id="3234417">+</span>&nbsp;<span class="string" id="3234419">&#34;.&#34;</span>&nbsp;<span class="op" id="3234423">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234428">itoa</span><span class="op" id="3234432">(</span><span class="builtintype" id="3234433">int</span><span class="op" id="3234436">(</span><span class="ident" id="3234437">ip</span><span class="op" id="3234439">[</span><span class="num" id="3234440">12</span><span class="op" id="3234442">]</span><span class="op" id="3234443">)</span><span class="op" id="3234444">)</span>&nbsp;<span class="op" id="3234446">+</span>&nbsp;<span class="string" id="3234448">&#34;.in-addr.arpa.&#34;</span><span class="op" id="3234464">,</span>&nbsp;<span class="ident" id="3234466">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3234471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3234474">//&nbsp;Must&nbsp;be&nbsp;IPv6</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234491">buf</span>&nbsp;<span class="op" id="3234495">:=</span>&nbsp;<span class="builtinfunc" id="3234498">make</span><span class="op" id="3234502">(</span><span class="op" id="3234503">[</span><span class="op" id="3234504">]</span><span class="builtintype" id="3234505">byte</span><span class="op" id="3234509">,</span>&nbsp;<span class="num" id="3234511">0</span><span class="op" id="3234512">,</span>&nbsp;<span class="builtinfunc" id="3234514">len</span><span class="op" id="3234517">(</span><span class="ident" id="3234518">ip</span><span class="op" id="3234520">)</span><span class="op" id="3234521">*</span><span class="num" id="3234522">4</span><span class="op" id="3234523">+</span><span class="builtinfunc" id="3234524">len</span><span class="op" id="3234527">(</span><span class="string" id="3234528">&#34;ip6.arpa.&#34;</span><span class="op" id="3234539">)</span><span class="op" id="3234540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3234543">//&nbsp;Add&nbsp;it,&nbsp;in&nbsp;reverse,&nbsp;to&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234581">for</span>&nbsp;<span class="ident" id="3234585">i</span>&nbsp;<span class="op" id="3234587">:=</span>&nbsp;<span class="builtinfunc" id="3234590">len</span><span class="op" id="3234593">(</span><span class="ident" id="3234594">ip</span><span class="op" id="3234596">)</span>&nbsp;<span class="op" id="3234598">-</span>&nbsp;<span class="num" id="3234600">1</span><span class="op" id="3234601">;</span>&nbsp;<span class="ident" id="3234603">i</span>&nbsp;<span class="op" id="3234605">&gt;=</span>&nbsp;<span class="num" id="3234608">0</span><span class="op" id="3234609">;</span>&nbsp;<span class="ident" id="3234611">i</span><span class="op" id="3234612">--</span>&nbsp;<span class="op" id="3234615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234619">v</span>&nbsp;<span class="op" id="3234621">:=</span>&nbsp;<span class="ident" id="3234624">ip</span><span class="op" id="3234626">[</span><span class="ident" id="3234627">i</span><span class="op" id="3234628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234632">buf</span>&nbsp;<span class="op" id="3234636">=</span>&nbsp;<span class="builtinfunc" id="3234638">append</span><span class="op" id="3234644">(</span><span class="ident" id="3234645">buf</span><span class="op" id="3234648">,</span>&nbsp;<span class="ident" id="3234650">hexDigit</span><span class="op" id="3234658">[</span><span class="ident" id="3234659">v</span><span class="op" id="3234660">&amp;</span><span class="num" id="3234661">0xF</span><span class="op" id="3234664">]</span><span class="op" id="3234665">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234669">buf</span>&nbsp;<span class="op" id="3234673">=</span>&nbsp;<span class="builtinfunc" id="3234675">append</span><span class="op" id="3234681">(</span><span class="ident" id="3234682">buf</span><span class="op" id="3234685">,</span>&nbsp;<span class="string" id="3234687">&#39;.&#39;</span><span class="op" id="3234690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234694">buf</span>&nbsp;<span class="op" id="3234698">=</span>&nbsp;<span class="builtinfunc" id="3234700">append</span><span class="op" id="3234706">(</span><span class="ident" id="3234707">buf</span><span class="op" id="3234710">,</span>&nbsp;<span class="ident" id="3234712">hexDigit</span><span class="op" id="3234720">[</span><span class="ident" id="3234721">v</span><span class="op" id="3234722">&gt;&gt;</span><span class="num" id="3234724">4</span><span class="op" id="3234725">]</span><span class="op" id="3234726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234730">buf</span>&nbsp;<span class="op" id="3234734">=</span>&nbsp;<span class="builtinfunc" id="3234736">append</span><span class="op" id="3234742">(</span><span class="ident" id="3234743">buf</span><span class="op" id="3234746">,</span>&nbsp;<span class="string" id="3234748">&#39;.&#39;</span><span class="op" id="3234751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3234754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3234757">//&nbsp;Append&nbsp;&#34;ip6.arpa.&#34;&nbsp;and&nbsp;return&nbsp;(buf&nbsp;already&nbsp;has&nbsp;the&nbsp;final&nbsp;.)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3234821">buf</span>&nbsp;<span class="op" id="3234825">=</span>&nbsp;<span class="builtinfunc" id="3234827">append</span><span class="op" id="3234833">(</span><span class="ident" id="3234834">buf</span><span class="op" id="3234837">,</span>&nbsp;<span class="string" id="3234839">&#34;ip6.arpa.&#34;</span><span class="op" id="3234850">...</span><span class="op" id="3234853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3234856">return</span>&nbsp;<span class="builtintype" id="3234863">string</span><span class="op" id="3234869">(</span><span class="ident" id="3234870">buf</span><span class="op" id="3234873">)</span><span class="op" id="3234874">,</span>&nbsp;<span class="ident" id="3234876">nil</span><br>
<span class="lineno"></span><span class="op" id="3234880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3234883">//&nbsp;Find&nbsp;answer&nbsp;for&nbsp;name&nbsp;in&nbsp;dns&nbsp;message.</span><br>
<span class="lineno">65</span><span class="comment" id="3234923">//&nbsp;On&nbsp;return,&nbsp;if&nbsp;err&nbsp;==&nbsp;nil,&nbsp;addrs&nbsp;!=&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3234966">func</span>&nbsp;<span class="ident" id="3234971">answer</span><span class="op" id="3234977">(</span><span class="ident" id="3234978">name</span><span class="op" id="3234982">,</span>&nbsp;<span class="ident" id="3234984">server</span>&nbsp;<span class="builtintype" id="3234991">string</span><span class="op" id="3234997">,</span>&nbsp;<span class="ident" id="3234999">dns</span>&nbsp;<span class="op" id="3235003">*</span><span class="ident" id="3235004">dnsMsg</span><span class="op" id="3235010">,</span>&nbsp;<span class="ident" id="3235012">qtype</span>&nbsp;<span class="builtintype" id="3235018">uint16</span><span class="op" id="3235024">)</span>&nbsp;<span class="op" id="3235026">(</span><span class="ident" id="3235027">cname</span>&nbsp;<span class="builtintype" id="3235033">string</span><span class="op" id="3235039">,</span>&nbsp;<span class="ident" id="3235041">addrs</span>&nbsp;<span class="op" id="3235047">[</span><span class="op" id="3235048">]</span><span class="ident" id="3235049">dnsRR</span><span class="op" id="3235054">,</span>&nbsp;<span class="ident" id="3235056">err</span>&nbsp;<span class="builtintype" id="3235060">error</span><span class="op" id="3235065">)</span>&nbsp;<span class="op" id="3235067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3235070">addrs</span>&nbsp;<span class="op" id="3235076">=</span>&nbsp;<span class="builtinfunc" id="3235078">make</span><span class="op" id="3235082">(</span><span class="op" id="3235083">[</span><span class="op" id="3235084">]</span><span class="ident" id="3235085">dnsRR</span><span class="op" id="3235090">,</span>&nbsp;<span class="num" id="3235092">0</span><span class="op" id="3235093">,</span>&nbsp;<span class="builtinfunc" id="3235095">len</span><span class="op" id="3235098">(</span><span class="ident" id="3235099">dns</span><span class="op" id="3235102">.</span><span class="ident" id="3235103">answer</span><span class="op" id="3235109">)</span><span class="op" id="3235110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235114">if</span>&nbsp;<span class="ident" id="3235117">dns</span><span class="op" id="3235120">.</span><span class="ident" id="3235121">rcode</span>&nbsp;<span class="op" id="3235127">==</span>&nbsp;<span class="ident" id="3235130">dnsRcodeNameError</span>&nbsp;<span class="op" id="3235148">&amp;&amp;</span>&nbsp;<span class="ident" id="3235151">dns</span><span class="op" id="3235154">.</span><span class="ident" id="3235155">recursion_available</span>&nbsp;<span class="op" id="3235175">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235179">return</span>&nbsp;<span class="string" id="3235186">&#34;&#34;</span><span class="op" id="3235188">,</span>&nbsp;<span class="ident" id="3235190">nil</span><span class="op" id="3235193">,</span>&nbsp;<span class="op" id="3235195">&amp;</span><span class="ident" id="3235196">DNSError</span><span class="op" id="3235204">{</span><span class="ident" id="3235205">Err</span><span class="op" id="3235208">:</span>&nbsp;<span class="ident" id="3235210">noSuchHost</span><span class="op" id="3235220">,</span>&nbsp;<span class="ident" id="3235222">Name</span><span class="op" id="3235226">:</span>&nbsp;<span class="ident" id="3235228">name</span><span class="op" id="3235232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3235235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235238">if</span>&nbsp;<span class="ident" id="3235241">dns</span><span class="op" id="3235244">.</span><span class="ident" id="3235245">rcode</span>&nbsp;<span class="op" id="3235251">!=</span>&nbsp;<span class="ident" id="3235254">dnsRcodeSuccess</span>&nbsp;<span class="op" id="3235270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235274">//&nbsp;None&nbsp;of&nbsp;the&nbsp;error&nbsp;codes&nbsp;make&nbsp;sense</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235314">//&nbsp;for&nbsp;the&nbsp;query&nbsp;we&nbsp;sent.&nbsp;&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;get</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235360">//&nbsp;a&nbsp;name&nbsp;error&nbsp;and&nbsp;we&nbsp;didn&#39;t&nbsp;get&nbsp;success,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235405">//&nbsp;the&nbsp;server&nbsp;is&nbsp;behaving&nbsp;incorrectly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235446">return</span>&nbsp;<span class="string" id="3235453">&#34;&#34;</span><span class="op" id="3235455">,</span>&nbsp;<span class="ident" id="3235457">nil</span><span class="op" id="3235460">,</span>&nbsp;<span class="op" id="3235462">&amp;</span><span class="ident" id="3235463">DNSError</span><span class="op" id="3235471">{</span><span class="ident" id="3235472">Err</span><span class="op" id="3235475">:</span>&nbsp;<span class="string" id="3235477">&#34;server&nbsp;misbehaving&#34;</span><span class="op" id="3235497">,</span>&nbsp;<span class="ident" id="3235499">Name</span><span class="op" id="3235503">:</span>&nbsp;<span class="ident" id="3235505">name</span><span class="op" id="3235509">,</span>&nbsp;<span class="ident" id="3235511">Server</span><span class="op" id="3235517">:</span>&nbsp;<span class="ident" id="3235519">server</span><span class="op" id="3235525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3235528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235532">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235555">//&nbsp;Presotto&nbsp;says&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;assume&nbsp;that&nbsp;servers&nbsp;listed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235616">//&nbsp;/etc/resolv.conf&nbsp;are&nbsp;recursive&nbsp;resolvers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235662">//&nbsp;We&nbsp;asked&nbsp;for&nbsp;recursion,&nbsp;so&nbsp;it&nbsp;should&nbsp;have&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235717">//&nbsp;all&nbsp;the&nbsp;answers&nbsp;we&nbsp;need&nbsp;in&nbsp;this&nbsp;one&nbsp;packet.</span><br>
<span class="lineno">85</span><span class="ident" id="3235764">Cname</span><span class="op" id="3235769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235772">for</span>&nbsp;<span class="ident" id="3235776">cnameloop</span>&nbsp;<span class="op" id="3235786">:=</span>&nbsp;<span class="num" id="3235789">0</span><span class="op" id="3235790">;</span>&nbsp;<span class="ident" id="3235792">cnameloop</span>&nbsp;<span class="op" id="3235802">&lt;</span>&nbsp;<span class="num" id="3235804">10</span><span class="op" id="3235806">;</span>&nbsp;<span class="ident" id="3235808">cnameloop</span><span class="op" id="3235817">++</span>&nbsp;<span class="op" id="3235820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3235824">addrs</span>&nbsp;<span class="op" id="3235830">=</span>&nbsp;<span class="ident" id="3235832">addrs</span><span class="op" id="3235837">[</span><span class="num" id="3235838">0</span><span class="op" id="3235839">:</span><span class="num" id="3235840">0</span><span class="op" id="3235841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235845">for</span>&nbsp;<span class="ident" id="3235849">_</span><span class="op" id="3235850">,</span>&nbsp;<span class="ident" id="3235852">rr</span>&nbsp;<span class="op" id="3235855">:=</span>&nbsp;<span class="keyword" id="3235858">range</span>&nbsp;<span class="ident" id="3235864">dns</span><span class="op" id="3235867">.</span><span class="ident" id="3235868">answer</span>&nbsp;<span class="op" id="3235875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3235880">if</span>&nbsp;<span class="ident" id="3235883">_</span><span class="op" id="3235884">,</span>&nbsp;<span class="ident" id="3235886">justHeader</span>&nbsp;<span class="op" id="3235897">:=</span>&nbsp;<span class="ident" id="3235900">rr</span><span class="op" id="3235902">.</span><span class="op" id="3235903">(</span><span class="op" id="3235904">*</span><span class="ident" id="3235905">dnsRR_Header</span><span class="op" id="3235917">)</span><span class="op" id="3235918">;</span>&nbsp;<span class="ident" id="3235920">justHeader</span>&nbsp;<span class="op" id="3235931">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235937">//&nbsp;Corrupt&nbsp;record:&nbsp;we&nbsp;only&nbsp;have&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3235975">//&nbsp;header.&nbsp;That&nbsp;header&nbsp;might&nbsp;say&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236017">//&nbsp;of&nbsp;type&nbsp;qtype,&nbsp;but&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236052">//&nbsp;actually&nbsp;have&nbsp;it.&nbsp;Skip.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236083">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236100">h</span>&nbsp;<span class="op" id="3236102">:=</span>&nbsp;<span class="ident" id="3236105">rr</span><span class="op" id="3236107">.</span><span class="ident" id="3236108">Header</span><span class="op" id="3236114">(</span><span class="op" id="3236115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236120">if</span>&nbsp;<span class="ident" id="3236123">h</span><span class="op" id="3236124">.</span><span class="ident" id="3236125">Class</span>&nbsp;<span class="op" id="3236131">==</span>&nbsp;<span class="ident" id="3236134">dnsClassINET</span>&nbsp;<span class="op" id="3236147">&amp;&amp;</span>&nbsp;<span class="ident" id="3236150">h</span><span class="op" id="3236151">.</span><span class="ident" id="3236152">Name</span>&nbsp;<span class="op" id="3236157">==</span>&nbsp;<span class="ident" id="3236160">name</span>&nbsp;<span class="op" id="3236165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236171">switch</span>&nbsp;<span class="ident" id="3236178">h</span><span class="op" id="3236179">.</span><span class="ident" id="3236180">Rrtype</span>&nbsp;<span class="op" id="3236187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236193">case</span>&nbsp;<span class="ident" id="3236198">qtype</span><span class="op" id="3236203">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236210">addrs</span>&nbsp;<span class="op" id="3236216">=</span>&nbsp;<span class="builtinfunc" id="3236218">append</span><span class="op" id="3236224">(</span><span class="ident" id="3236225">addrs</span><span class="op" id="3236230">,</span>&nbsp;<span class="ident" id="3236232">rr</span><span class="op" id="3236234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236240">case</span>&nbsp;<span class="ident" id="3236245">dnsTypeCNAME</span><span class="op" id="3236257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236264">//&nbsp;redirect&nbsp;to&nbsp;cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236290">name</span>&nbsp;<span class="op" id="3236295">=</span>&nbsp;<span class="ident" id="3236297">rr</span><span class="op" id="3236299">.</span><span class="op" id="3236300">(</span><span class="op" id="3236301">*</span><span class="ident" id="3236302">dnsRR_CNAME</span><span class="op" id="3236313">)</span><span class="op" id="3236314">.</span><span class="ident" id="3236315">Cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236326">continue</span>&nbsp;<span class="ident" id="3236335">Cname</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236358">if</span>&nbsp;<span class="builtinfunc" id="3236361">len</span><span class="op" id="3236364">(</span><span class="ident" id="3236365">addrs</span><span class="op" id="3236370">)</span>&nbsp;<span class="op" id="3236372">==</span>&nbsp;<span class="num" id="3236375">0</span>&nbsp;<span class="op" id="3236377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236382">return</span>&nbsp;<span class="string" id="3236389">&#34;&#34;</span><span class="op" id="3236391">,</span>&nbsp;<span class="ident" id="3236393">nil</span><span class="op" id="3236396">,</span>&nbsp;<span class="op" id="3236398">&amp;</span><span class="ident" id="3236399">DNSError</span><span class="op" id="3236407">{</span><span class="ident" id="3236408">Err</span><span class="op" id="3236411">:</span>&nbsp;<span class="ident" id="3236413">noSuchHost</span><span class="op" id="3236423">,</span>&nbsp;<span class="ident" id="3236425">Name</span><span class="op" id="3236429">:</span>&nbsp;<span class="ident" id="3236431">name</span><span class="op" id="3236435">,</span>&nbsp;<span class="ident" id="3236437">Server</span><span class="op" id="3236443">:</span>&nbsp;<span class="ident" id="3236445">server</span><span class="op" id="3236451">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236459">return</span>&nbsp;<span class="ident" id="3236466">name</span><span class="op" id="3236470">,</span>&nbsp;<span class="ident" id="3236472">addrs</span><span class="op" id="3236477">,</span>&nbsp;<span class="ident" id="3236479">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236488">return</span>&nbsp;<span class="string" id="3236495">&#34;&#34;</span><span class="op" id="3236497">,</span>&nbsp;<span class="ident" id="3236499">nil</span><span class="op" id="3236502">,</span>&nbsp;<span class="op" id="3236504">&amp;</span><span class="ident" id="3236505">DNSError</span><span class="op" id="3236513">{</span><span class="ident" id="3236514">Err</span><span class="op" id="3236517">:</span>&nbsp;<span class="string" id="3236519">&#34;too&nbsp;many&nbsp;redirects&#34;</span><span class="op" id="3236539">,</span>&nbsp;<span class="ident" id="3236541">Name</span><span class="op" id="3236545">:</span>&nbsp;<span class="ident" id="3236547">name</span><span class="op" id="3236551">,</span>&nbsp;<span class="ident" id="3236553">Server</span><span class="op" id="3236559">:</span>&nbsp;<span class="ident" id="3236561">server</span><span class="op" id="3236567">}</span><br>
<span class="lineno">115</span><span class="op" id="3236569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3236572">func</span>&nbsp;<span class="ident" id="3236577">isDomainName</span><span class="op" id="3236589">(</span><span class="ident" id="3236590">s</span>&nbsp;<span class="builtintype" id="3236592">string</span><span class="op" id="3236598">)</span>&nbsp;<span class="builtintype" id="3236600">bool</span>&nbsp;<span class="op" id="3236605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236608">//&nbsp;See&nbsp;RFC&nbsp;1035,&nbsp;RFC&nbsp;3696.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236636">if</span>&nbsp;<span class="builtinfunc" id="3236639">len</span><span class="op" id="3236642">(</span><span class="ident" id="3236643">s</span><span class="op" id="3236644">)</span>&nbsp;<span class="op" id="3236646">==</span>&nbsp;<span class="num" id="3236649">0</span>&nbsp;<span class="op" id="3236651">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236655">return</span>&nbsp;<span class="builtintype" id="3236662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236672">if</span>&nbsp;<span class="builtinfunc" id="3236675">len</span><span class="op" id="3236678">(</span><span class="ident" id="3236679">s</span><span class="op" id="3236680">)</span>&nbsp;<span class="op" id="3236682">&gt;</span>&nbsp;<span class="num" id="3236684">255</span>&nbsp;<span class="op" id="3236688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236692">return</span>&nbsp;<span class="builtintype" id="3236699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3236706">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236710">last</span>&nbsp;<span class="op" id="3236715">:=</span>&nbsp;<span class="builtintype" id="3236718">byte</span><span class="op" id="3236722">(</span><span class="string" id="3236723">&#39;.&#39;</span><span class="op" id="3236726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236729">ok</span>&nbsp;<span class="op" id="3236732">:=</span>&nbsp;<span class="builtintype" id="3236735">false</span>&nbsp;<span class="comment" id="3236741">//&nbsp;Ok&nbsp;once&nbsp;we&#39;ve&nbsp;seen&nbsp;a&nbsp;letter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236774">partlen</span>&nbsp;<span class="op" id="3236782">:=</span>&nbsp;<span class="num" id="3236785">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236788">for</span>&nbsp;<span class="ident" id="3236792">i</span>&nbsp;<span class="op" id="3236794">:=</span>&nbsp;<span class="num" id="3236797">0</span><span class="op" id="3236798">;</span>&nbsp;<span class="ident" id="3236800">i</span>&nbsp;<span class="op" id="3236802">&lt;</span>&nbsp;<span class="builtinfunc" id="3236804">len</span><span class="op" id="3236807">(</span><span class="ident" id="3236808">s</span><span class="op" id="3236809">)</span><span class="op" id="3236810">;</span>&nbsp;<span class="ident" id="3236812">i</span><span class="op" id="3236813">++</span>&nbsp;<span class="op" id="3236816">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236820">c</span>&nbsp;<span class="op" id="3236822">:=</span>&nbsp;<span class="ident" id="3236825">s</span><span class="op" id="3236826">[</span><span class="ident" id="3236827">i</span><span class="op" id="3236828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236832">switch</span>&nbsp;<span class="op" id="3236839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236843">default</span><span class="op" id="3236850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236855">return</span>&nbsp;<span class="builtintype" id="3236862">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236870">case</span>&nbsp;<span class="string" id="3236875">&#39;a&#39;</span>&nbsp;<span class="op" id="3236879">&lt;=</span>&nbsp;<span class="ident" id="3236882">c</span>&nbsp;<span class="op" id="3236884">&amp;&amp;</span>&nbsp;<span class="ident" id="3236887">c</span>&nbsp;<span class="op" id="3236889">&lt;=</span>&nbsp;<span class="string" id="3236892">&#39;z&#39;</span>&nbsp;<span class="op" id="3236896">||</span>&nbsp;<span class="string" id="3236899">&#39;A&#39;</span>&nbsp;<span class="op" id="3236903">&lt;=</span>&nbsp;<span class="ident" id="3236906">c</span>&nbsp;<span class="op" id="3236908">&amp;&amp;</span>&nbsp;<span class="ident" id="3236911">c</span>&nbsp;<span class="op" id="3236913">&lt;=</span>&nbsp;<span class="string" id="3236916">&#39;Z&#39;</span>&nbsp;<span class="op" id="3236920">||</span>&nbsp;<span class="ident" id="3236923">c</span>&nbsp;<span class="op" id="3236925">==</span>&nbsp;<span class="string" id="3236928">&#39;_&#39;</span><span class="op" id="3236931">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236936">ok</span>&nbsp;<span class="op" id="3236939">=</span>&nbsp;<span class="builtintype" id="3236941">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236949">partlen</span><span class="op" id="3236956">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236961">case</span>&nbsp;<span class="string" id="3236966">&#39;0&#39;</span>&nbsp;<span class="op" id="3236970">&lt;=</span>&nbsp;<span class="ident" id="3236973">c</span>&nbsp;<span class="op" id="3236975">&amp;&amp;</span>&nbsp;<span class="ident" id="3236978">c</span>&nbsp;<span class="op" id="3236980">&lt;=</span>&nbsp;<span class="string" id="3236983">&#39;9&#39;</span><span class="op" id="3236986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3236991">//&nbsp;fine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237002">partlen</span><span class="op" id="3237009">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237014">case</span>&nbsp;<span class="ident" id="3237019">c</span>&nbsp;<span class="op" id="3237021">==</span>&nbsp;<span class="string" id="3237024">&#39;-&#39;</span><span class="op" id="3237027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237032">//&nbsp;Byte&nbsp;before&nbsp;dash&nbsp;cannot&nbsp;be&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237070">if</span>&nbsp;<span class="ident" id="3237073">last</span>&nbsp;<span class="op" id="3237078">==</span>&nbsp;<span class="string" id="3237081">&#39;.&#39;</span>&nbsp;<span class="op" id="3237085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237091">return</span>&nbsp;<span class="builtintype" id="3237098">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237107">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237112">partlen</span><span class="op" id="3237119">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237124">case</span>&nbsp;<span class="ident" id="3237129">c</span>&nbsp;<span class="op" id="3237131">==</span>&nbsp;<span class="string" id="3237134">&#39;.&#39;</span><span class="op" id="3237137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237142">//&nbsp;Byte&nbsp;before&nbsp;dot&nbsp;cannot&nbsp;be&nbsp;dot,&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237185">if</span>&nbsp;<span class="ident" id="3237188">last</span>&nbsp;<span class="op" id="3237193">==</span>&nbsp;<span class="string" id="3237196">&#39;.&#39;</span>&nbsp;<span class="op" id="3237200">||</span>&nbsp;<span class="ident" id="3237203">last</span>&nbsp;<span class="op" id="3237208">==</span>&nbsp;<span class="string" id="3237211">&#39;-&#39;</span>&nbsp;<span class="op" id="3237215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237221">return</span>&nbsp;<span class="builtintype" id="3237228">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237242">if</span>&nbsp;<span class="ident" id="3237245">partlen</span>&nbsp;<span class="op" id="3237253">&gt;</span>&nbsp;<span class="num" id="3237255">63</span>&nbsp;<span class="op" id="3237258">||</span>&nbsp;<span class="ident" id="3237261">partlen</span>&nbsp;<span class="op" id="3237269">==</span>&nbsp;<span class="num" id="3237272">0</span>&nbsp;<span class="op" id="3237274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237280">return</span>&nbsp;<span class="builtintype" id="3237287">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237301">partlen</span>&nbsp;<span class="op" id="3237309">=</span>&nbsp;<span class="num" id="3237311">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237319">last</span>&nbsp;<span class="op" id="3237324">=</span>&nbsp;<span class="ident" id="3237326">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237332">if</span>&nbsp;<span class="ident" id="3237335">last</span>&nbsp;<span class="op" id="3237340">==</span>&nbsp;<span class="string" id="3237343">&#39;-&#39;</span>&nbsp;<span class="op" id="3237347">||</span>&nbsp;<span class="ident" id="3237350">partlen</span>&nbsp;<span class="op" id="3237358">&gt;</span>&nbsp;<span class="num" id="3237360">63</span>&nbsp;<span class="op" id="3237363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237367">return</span>&nbsp;<span class="builtintype" id="3237374">false</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237385">return</span>&nbsp;<span class="ident" id="3237392">ok</span><br>
<span class="lineno"></span><span class="op" id="3237395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3237398">//&nbsp;An&nbsp;SRV&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;SRV&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3237444">type</span>&nbsp;<span class="ident" id="3237449">SRV</span>&nbsp;<span class="keyword" id="3237453">struct</span>&nbsp;<span class="op" id="3237460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237463">Target</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3237472">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237480">Port</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3237489">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237497">Priority</span>&nbsp;<span class="builtintype" id="3237506">uint16</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237514">Weight</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3237523">uint16</span><br>
<span class="lineno"></span><span class="op" id="3237530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3237533">//&nbsp;byPriorityWeight&nbsp;sorts&nbsp;SRV&nbsp;records&nbsp;by&nbsp;ascending&nbsp;priority&nbsp;and&nbsp;weight.</span><br>
<span class="lineno"></span><span class="keyword" id="3237605">type</span>&nbsp;<span class="ident" id="3237610">byPriorityWeight</span>&nbsp;<span class="op" id="3237627">[</span><span class="op" id="3237628">]</span><span class="op" id="3237629">*</span><span class="ident" id="3237630">SRV</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3237635">func</span>&nbsp;<span class="op" id="3237640">(</span><span class="ident" id="3237641">s</span>&nbsp;<span class="ident" id="3237643">byPriorityWeight</span><span class="op" id="3237659">)</span>&nbsp;<span class="ident" id="3237661">Len</span><span class="op" id="3237664">(</span><span class="op" id="3237665">)</span>&nbsp;<span class="builtintype" id="3237667">int</span>&nbsp;<span class="op" id="3237671">{</span>&nbsp;<span class="keyword" id="3237673">return</span>&nbsp;<span class="builtinfunc" id="3237680">len</span><span class="op" id="3237683">(</span><span class="ident" id="3237684">s</span><span class="op" id="3237685">)</span>&nbsp;<span class="op" id="3237687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3237690">func</span>&nbsp;<span class="op" id="3237695">(</span><span class="ident" id="3237696">s</span>&nbsp;<span class="ident" id="3237698">byPriorityWeight</span><span class="op" id="3237714">)</span>&nbsp;<span class="ident" id="3237716">Swap</span><span class="op" id="3237720">(</span><span class="ident" id="3237721">i</span><span class="op" id="3237722">,</span>&nbsp;<span class="ident" id="3237724">j</span>&nbsp;<span class="builtintype" id="3237726">int</span><span class="op" id="3237729">)</span>&nbsp;<span class="op" id="3237731">{</span>&nbsp;<span class="ident" id="3237733">s</span><span class="op" id="3237734">[</span><span class="ident" id="3237735">i</span><span class="op" id="3237736">]</span><span class="op" id="3237737">,</span>&nbsp;<span class="ident" id="3237739">s</span><span class="op" id="3237740">[</span><span class="ident" id="3237741">j</span><span class="op" id="3237742">]</span>&nbsp;<span class="op" id="3237744">=</span>&nbsp;<span class="ident" id="3237746">s</span><span class="op" id="3237747">[</span><span class="ident" id="3237748">j</span><span class="op" id="3237749">]</span><span class="op" id="3237750">,</span>&nbsp;<span class="ident" id="3237752">s</span><span class="op" id="3237753">[</span><span class="ident" id="3237754">i</span><span class="op" id="3237755">]</span>&nbsp;<span class="op" id="3237757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3237760">func</span>&nbsp;<span class="op" id="3237765">(</span><span class="ident" id="3237766">s</span>&nbsp;<span class="ident" id="3237768">byPriorityWeight</span><span class="op" id="3237784">)</span>&nbsp;<span class="ident" id="3237786">Less</span><span class="op" id="3237790">(</span><span class="ident" id="3237791">i</span><span class="op" id="3237792">,</span>&nbsp;<span class="ident" id="3237794">j</span>&nbsp;<span class="builtintype" id="3237796">int</span><span class="op" id="3237799">)</span>&nbsp;<span class="builtintype" id="3237801">bool</span>&nbsp;<span class="op" id="3237806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237809">return</span>&nbsp;<span class="ident" id="3237816">s</span><span class="op" id="3237817">[</span><span class="ident" id="3237818">i</span><span class="op" id="3237819">]</span><span class="op" id="3237820">.</span><span class="ident" id="3237821">Priority</span>&nbsp;<span class="op" id="3237830">&lt;</span>&nbsp;<span class="ident" id="3237832">s</span><span class="op" id="3237833">[</span><span class="ident" id="3237834">j</span><span class="op" id="3237835">]</span><span class="op" id="3237836">.</span><span class="ident" id="3237837">Priority</span>&nbsp;<span class="op" id="3237846">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237851">(</span><span class="ident" id="3237852">s</span><span class="op" id="3237853">[</span><span class="ident" id="3237854">i</span><span class="op" id="3237855">]</span><span class="op" id="3237856">.</span><span class="ident" id="3237857">Priority</span>&nbsp;<span class="op" id="3237866">==</span>&nbsp;<span class="ident" id="3237869">s</span><span class="op" id="3237870">[</span><span class="ident" id="3237871">j</span><span class="op" id="3237872">]</span><span class="op" id="3237873">.</span><span class="ident" id="3237874">Priority</span>&nbsp;<span class="op" id="3237883">&amp;&amp;</span>&nbsp;<span class="ident" id="3237886">s</span><span class="op" id="3237887">[</span><span class="ident" id="3237888">i</span><span class="op" id="3237889">]</span><span class="op" id="3237890">.</span><span class="ident" id="3237891">Weight</span>&nbsp;<span class="op" id="3237898">&lt;</span>&nbsp;<span class="ident" id="3237900">s</span><span class="op" id="3237901">[</span><span class="ident" id="3237902">j</span><span class="op" id="3237903">]</span><span class="op" id="3237904">.</span><span class="ident" id="3237905">Weight</span><span class="op" id="3237911">)</span><br>
<span class="lineno"></span><span class="op" id="3237913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3237916">//&nbsp;shuffleByWeight&nbsp;shuffles&nbsp;SRV&nbsp;records&nbsp;by&nbsp;weight&nbsp;using&nbsp;the&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3237986">//&nbsp;described&nbsp;in&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="keyword" id="3238012">func</span>&nbsp;<span class="op" id="3238017">(</span><span class="ident" id="3238018">addrs</span>&nbsp;<span class="ident" id="3238024">byPriorityWeight</span><span class="op" id="3238040">)</span>&nbsp;<span class="ident" id="3238042">shuffleByWeight</span><span class="op" id="3238057">(</span><span class="op" id="3238058">)</span>&nbsp;<span class="op" id="3238060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238063">sum</span>&nbsp;<span class="op" id="3238067">:=</span>&nbsp;<span class="num" id="3238070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238073">for</span>&nbsp;<span class="ident" id="3238077">_</span><span class="op" id="3238078">,</span>&nbsp;<span class="ident" id="3238080">addr</span>&nbsp;<span class="op" id="3238085">:=</span>&nbsp;<span class="keyword" id="3238088">range</span>&nbsp;<span class="ident" id="3238094">addrs</span>&nbsp;<span class="op" id="3238100">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238104">sum</span>&nbsp;<span class="op" id="3238108">+=</span>&nbsp;<span class="builtintype" id="3238111">int</span><span class="op" id="3238114">(</span><span class="ident" id="3238115">addr</span><span class="op" id="3238119">.</span><span class="ident" id="3238120">Weight</span><span class="op" id="3238126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238132">for</span>&nbsp;<span class="ident" id="3238136">sum</span>&nbsp;<span class="op" id="3238140">&gt;</span>&nbsp;<span class="num" id="3238142">0</span>&nbsp;<span class="op" id="3238144">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3238147">len</span><span class="op" id="3238150">(</span><span class="ident" id="3238151">addrs</span><span class="op" id="3238156">)</span>&nbsp;<span class="op" id="3238158">&gt;</span>&nbsp;<span class="num" id="3238160">1</span>&nbsp;<span class="op" id="3238162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238166">s</span>&nbsp;<span class="op" id="3238168">:=</span>&nbsp;<span class="num" id="3238171">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238175">n</span>&nbsp;<span class="op" id="3238177">:=</span>&nbsp;<span class="ident" id="3238180">rand</span><span class="op" id="3238184">.</span><span class="ident" id="3238185">Intn</span><span class="op" id="3238189">(</span><span class="ident" id="3238190">sum</span><span class="op" id="3238193">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238197">for</span>&nbsp;<span class="ident" id="3238201">i</span>&nbsp;<span class="op" id="3238203">:=</span>&nbsp;<span class="keyword" id="3238206">range</span>&nbsp;<span class="ident" id="3238212">addrs</span>&nbsp;<span class="op" id="3238218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238223">s</span>&nbsp;<span class="op" id="3238225">+=</span>&nbsp;<span class="builtintype" id="3238228">int</span><span class="op" id="3238231">(</span><span class="ident" id="3238232">addrs</span><span class="op" id="3238237">[</span><span class="ident" id="3238238">i</span><span class="op" id="3238239">]</span><span class="op" id="3238240">.</span><span class="ident" id="3238241">Weight</span><span class="op" id="3238247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238252">if</span>&nbsp;<span class="ident" id="3238255">s</span>&nbsp;<span class="op" id="3238257">&gt;</span>&nbsp;<span class="ident" id="3238259">n</span>&nbsp;<span class="op" id="3238261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238267">if</span>&nbsp;<span class="ident" id="3238270">i</span>&nbsp;<span class="op" id="3238272">&gt;</span>&nbsp;<span class="num" id="3238274">0</span>&nbsp;<span class="op" id="3238276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238283">addrs</span><span class="op" id="3238288">[</span><span class="num" id="3238289">0</span><span class="op" id="3238290">]</span><span class="op" id="3238291">,</span>&nbsp;<span class="ident" id="3238293">addrs</span><span class="op" id="3238298">[</span><span class="ident" id="3238299">i</span><span class="op" id="3238300">]</span>&nbsp;<span class="op" id="3238302">=</span>&nbsp;<span class="ident" id="3238304">addrs</span><span class="op" id="3238309">[</span><span class="ident" id="3238310">i</span><span class="op" id="3238311">]</span><span class="op" id="3238312">,</span>&nbsp;<span class="ident" id="3238314">addrs</span><span class="op" id="3238319">[</span><span class="num" id="3238320">0</span><span class="op" id="3238321">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238333">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238350">sum</span>&nbsp;<span class="op" id="3238354">-=</span>&nbsp;<span class="builtintype" id="3238357">int</span><span class="op" id="3238360">(</span><span class="ident" id="3238361">addrs</span><span class="op" id="3238366">[</span><span class="num" id="3238367">0</span><span class="op" id="3238368">]</span><span class="op" id="3238369">.</span><span class="ident" id="3238370">Weight</span><span class="op" id="3238376">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238380">addrs</span>&nbsp;<span class="op" id="3238386">=</span>&nbsp;<span class="ident" id="3238388">addrs</span><span class="op" id="3238393">[</span><span class="num" id="3238394">1</span><span class="op" id="3238395">:</span><span class="op" id="3238396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238399">}</span><br>
<span class="lineno"></span><span class="op" id="3238401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3238404">//&nbsp;sort&nbsp;reorders&nbsp;SRV&nbsp;records&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno">210</span><span class="keyword" id="3238459">func</span>&nbsp;<span class="op" id="3238464">(</span><span class="ident" id="3238465">addrs</span>&nbsp;<span class="ident" id="3238471">byPriorityWeight</span><span class="op" id="3238487">)</span>&nbsp;<span class="ident" id="3238489">sort</span><span class="op" id="3238493">(</span><span class="op" id="3238494">)</span>&nbsp;<span class="op" id="3238496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238499">sort</span><span class="op" id="3238503">.</span><span class="ident" id="3238504">Sort</span><span class="op" id="3238508">(</span><span class="ident" id="3238509">addrs</span><span class="op" id="3238514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238517">i</span>&nbsp;<span class="op" id="3238519">:=</span>&nbsp;<span class="num" id="3238522">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238525">for</span>&nbsp;<span class="ident" id="3238529">j</span>&nbsp;<span class="op" id="3238531">:=</span>&nbsp;<span class="num" id="3238534">1</span><span class="op" id="3238535">;</span>&nbsp;<span class="ident" id="3238537">j</span>&nbsp;<span class="op" id="3238539">&lt;</span>&nbsp;<span class="builtinfunc" id="3238541">len</span><span class="op" id="3238544">(</span><span class="ident" id="3238545">addrs</span><span class="op" id="3238550">)</span><span class="op" id="3238551">;</span>&nbsp;<span class="ident" id="3238553">j</span><span class="op" id="3238554">++</span>&nbsp;<span class="op" id="3238557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3238561">if</span>&nbsp;<span class="ident" id="3238564">addrs</span><span class="op" id="3238569">[</span><span class="ident" id="3238570">i</span><span class="op" id="3238571">]</span><span class="op" id="3238572">.</span><span class="ident" id="3238573">Priority</span>&nbsp;<span class="op" id="3238582">!=</span>&nbsp;<span class="ident" id="3238585">addrs</span><span class="op" id="3238590">[</span><span class="ident" id="3238591">j</span><span class="op" id="3238592">]</span><span class="op" id="3238593">.</span><span class="ident" id="3238594">Priority</span>&nbsp;<span class="op" id="3238603">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238608">addrs</span><span class="op" id="3238613">[</span><span class="ident" id="3238614">i</span><span class="op" id="3238615">:</span><span class="ident" id="3238616">j</span><span class="op" id="3238617">]</span><span class="op" id="3238618">.</span><span class="ident" id="3238619">shuffleByWeight</span><span class="op" id="3238634">(</span><span class="op" id="3238635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238640">i</span>&nbsp;<span class="op" id="3238642">=</span>&nbsp;<span class="ident" id="3238644">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3238651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238654">addrs</span><span class="op" id="3238659">[</span><span class="ident" id="3238660">i</span><span class="op" id="3238661">:</span><span class="op" id="3238662">]</span><span class="op" id="3238663">.</span><span class="ident" id="3238664">shuffleByWeight</span><span class="op" id="3238679">(</span><span class="op" id="3238680">)</span><br>
<span class="lineno">220</span><span class="op" id="3238682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3238685">//&nbsp;An&nbsp;MX&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;MX&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3238729">type</span>&nbsp;<span class="ident" id="3238734">MX</span>&nbsp;<span class="keyword" id="3238737">struct</span>&nbsp;<span class="op" id="3238744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238747">Host</span>&nbsp;<span class="builtintype" id="3238752">string</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3238760">Pref</span>&nbsp;<span class="builtintype" id="3238765">uint16</span><br>
<span class="lineno"></span><span class="op" id="3238772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3238775">//&nbsp;byPref&nbsp;implements&nbsp;sort.Interface&nbsp;to&nbsp;sort&nbsp;MX&nbsp;records&nbsp;by&nbsp;preference</span><br>
<span class="lineno"></span><span class="keyword" id="3238844">type</span>&nbsp;<span class="ident" id="3238849">byPref</span>&nbsp;<span class="op" id="3238856">[</span><span class="op" id="3238857">]</span><span class="op" id="3238858">*</span><span class="ident" id="3238859">MX</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="3238863">func</span>&nbsp;<span class="op" id="3238868">(</span><span class="ident" id="3238869">s</span>&nbsp;<span class="ident" id="3238871">byPref</span><span class="op" id="3238877">)</span>&nbsp;<span class="ident" id="3238879">Len</span><span class="op" id="3238882">(</span><span class="op" id="3238883">)</span>&nbsp;<span class="builtintype" id="3238885">int</span>&nbsp;<span class="op" id="3238889">{</span>&nbsp;<span class="keyword" id="3238891">return</span>&nbsp;<span class="builtinfunc" id="3238898">len</span><span class="op" id="3238901">(</span><span class="ident" id="3238902">s</span><span class="op" id="3238903">)</span>&nbsp;<span class="op" id="3238905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3238908">func</span>&nbsp;<span class="op" id="3238913">(</span><span class="ident" id="3238914">s</span>&nbsp;<span class="ident" id="3238916">byPref</span><span class="op" id="3238922">)</span>&nbsp;<span class="ident" id="3238924">Less</span><span class="op" id="3238928">(</span><span class="ident" id="3238929">i</span><span class="op" id="3238930">,</span>&nbsp;<span class="ident" id="3238932">j</span>&nbsp;<span class="builtintype" id="3238934">int</span><span class="op" id="3238937">)</span>&nbsp;<span class="builtintype" id="3238939">bool</span>&nbsp;<span class="op" id="3238944">{</span>&nbsp;<span class="keyword" id="3238946">return</span>&nbsp;<span class="ident" id="3238953">s</span><span class="op" id="3238954">[</span><span class="ident" id="3238955">i</span><span class="op" id="3238956">]</span><span class="op" id="3238957">.</span><span class="ident" id="3238958">Pref</span>&nbsp;<span class="op" id="3238963">&lt;</span>&nbsp;<span class="ident" id="3238965">s</span><span class="op" id="3238966">[</span><span class="ident" id="3238967">j</span><span class="op" id="3238968">]</span><span class="op" id="3238969">.</span><span class="ident" id="3238970">Pref</span>&nbsp;<span class="op" id="3238975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="3238978">func</span>&nbsp;<span class="op" id="3238983">(</span><span class="ident" id="3238984">s</span>&nbsp;<span class="ident" id="3238986">byPref</span><span class="op" id="3238992">)</span>&nbsp;<span class="ident" id="3238994">Swap</span><span class="op" id="3238998">(</span><span class="ident" id="3238999">i</span><span class="op" id="3239000">,</span>&nbsp;<span class="ident" id="3239002">j</span>&nbsp;<span class="builtintype" id="3239004">int</span><span class="op" id="3239007">)</span>&nbsp;<span class="op" id="3239009">{</span>&nbsp;<span class="ident" id="3239011">s</span><span class="op" id="3239012">[</span><span class="ident" id="3239013">i</span><span class="op" id="3239014">]</span><span class="op" id="3239015">,</span>&nbsp;<span class="ident" id="3239017">s</span><span class="op" id="3239018">[</span><span class="ident" id="3239019">j</span><span class="op" id="3239020">]</span>&nbsp;<span class="op" id="3239022">=</span>&nbsp;<span class="ident" id="3239024">s</span><span class="op" id="3239025">[</span><span class="ident" id="3239026">j</span><span class="op" id="3239027">]</span><span class="op" id="3239028">,</span>&nbsp;<span class="ident" id="3239030">s</span><span class="op" id="3239031">[</span><span class="ident" id="3239032">i</span><span class="op" id="3239033">]</span>&nbsp;<span class="op" id="3239035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3239038">//&nbsp;sort&nbsp;reorders&nbsp;MX&nbsp;records&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="keyword" id="3239092">func</span>&nbsp;<span class="op" id="3239097">(</span><span class="ident" id="3239098">s</span>&nbsp;<span class="ident" id="3239100">byPref</span><span class="op" id="3239106">)</span>&nbsp;<span class="ident" id="3239108">sort</span><span class="op" id="3239112">(</span><span class="op" id="3239113">)</span>&nbsp;<span class="op" id="3239115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3239118">for</span>&nbsp;<span class="ident" id="3239122">i</span>&nbsp;<span class="op" id="3239124">:=</span>&nbsp;<span class="keyword" id="3239127">range</span>&nbsp;<span class="ident" id="3239133">s</span>&nbsp;<span class="op" id="3239135">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239139">j</span>&nbsp;<span class="op" id="3239141">:=</span>&nbsp;<span class="ident" id="3239144">rand</span><span class="op" id="3239148">.</span><span class="ident" id="3239149">Intn</span><span class="op" id="3239153">(</span><span class="ident" id="3239154">i</span>&nbsp;<span class="op" id="3239156">+</span>&nbsp;<span class="num" id="3239158">1</span><span class="op" id="3239159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239163">s</span><span class="op" id="3239164">[</span><span class="ident" id="3239165">i</span><span class="op" id="3239166">]</span><span class="op" id="3239167">,</span>&nbsp;<span class="ident" id="3239169">s</span><span class="op" id="3239170">[</span><span class="ident" id="3239171">j</span><span class="op" id="3239172">]</span>&nbsp;<span class="op" id="3239174">=</span>&nbsp;<span class="ident" id="3239176">s</span><span class="op" id="3239177">[</span><span class="ident" id="3239178">j</span><span class="op" id="3239179">]</span><span class="op" id="3239180">,</span>&nbsp;<span class="ident" id="3239182">s</span><span class="op" id="3239183">[</span><span class="ident" id="3239184">i</span><span class="op" id="3239185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3239188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239191">sort</span><span class="op" id="3239195">.</span><span class="ident" id="3239196">Sort</span><span class="op" id="3239200">(</span><span class="ident" id="3239201">s</span><span class="op" id="3239202">)</span><br>
<span class="lineno"></span><span class="op" id="3239204">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="3239207">//&nbsp;An&nbsp;NS&nbsp;represents&nbsp;a&nbsp;single&nbsp;DNS&nbsp;NS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3239251">type</span>&nbsp;<span class="ident" id="3239256">NS</span>&nbsp;<span class="keyword" id="3239259">struct</span>&nbsp;<span class="op" id="3239266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3239269">Host</span>&nbsp;<span class="builtintype" id="3239274">string</span><br>
<span class="lineno"></span><span class="op" id="3239281">}</span>
</div>
</body>
</html>
