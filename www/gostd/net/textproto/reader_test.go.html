<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8443785">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8443841">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8443895">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8443946">package</span>&nbsp;<span class="ident" id="8443954">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8443965">import</span>&nbsp;<span class="op" id="8443972">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8443975">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8443984">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8443993">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8443999">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8444010">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8444021">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8444031">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8444034">type</span>&nbsp;<span class="ident" id="8444039">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="8444062">struct</span>&nbsp;<span class="op" id="8444069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8444072">in</span><span class="op" id="8444074">,</span>&nbsp;<span class="ident" id="8444076">out</span>&nbsp;<span class="builtintype" id="8444080">string</span><br>
<span class="lineno"></span><span class="op" id="8444087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8444090">var</span>&nbsp;<span class="ident" id="8444094">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8444118">=</span>&nbsp;<span class="op" id="8444120">[</span><span class="op" id="8444121">]</span><span class="ident" id="8444122">canonicalHeaderKeyTest</span><span class="op" id="8444144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444147">{</span><span class="string" id="8444148">&#34;a-b-c&#34;</span><span class="op" id="8444155">,</span>&nbsp;<span class="string" id="8444157">&#34;A-B-C&#34;</span><span class="op" id="8444164">}</span><span class="op" id="8444165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444168">{</span><span class="string" id="8444169">&#34;a-1-c&#34;</span><span class="op" id="8444176">,</span>&nbsp;<span class="string" id="8444178">&#34;A-1-C&#34;</span><span class="op" id="8444185">}</span><span class="op" id="8444186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444189">{</span><span class="string" id="8444190">&#34;User-Agent&#34;</span><span class="op" id="8444202">,</span>&nbsp;<span class="string" id="8444204">&#34;User-Agent&#34;</span><span class="op" id="8444216">}</span><span class="op" id="8444217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444220">{</span><span class="string" id="8444221">&#34;uSER-aGENT&#34;</span><span class="op" id="8444233">,</span>&nbsp;<span class="string" id="8444235">&#34;User-Agent&#34;</span><span class="op" id="8444247">}</span><span class="op" id="8444248">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444251">{</span><span class="string" id="8444252">&#34;user-agent&#34;</span><span class="op" id="8444264">,</span>&nbsp;<span class="string" id="8444266">&#34;User-Agent&#34;</span><span class="op" id="8444278">}</span><span class="op" id="8444279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444282">{</span><span class="string" id="8444283">&#34;USER-AGENT&#34;</span><span class="op" id="8444295">,</span>&nbsp;<span class="string" id="8444297">&#34;User-Agent&#34;</span><span class="op" id="8444309">}</span><span class="op" id="8444310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444313">{</span><span class="string" id="8444314">&#34;üser-agenT&#34;</span><span class="op" id="8444327">,</span>&nbsp;<span class="string" id="8444329">&#34;üser-Agent&#34;</span><span class="op" id="8444342">}</span><span class="op" id="8444343">,</span>&nbsp;<span class="comment" id="8444345">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8444370">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444425">{</span><span class="string" id="8444426">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="8444454">,</span>&nbsp;<span class="string" id="8444456">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="8444484">}</span><span class="op" id="8444485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444488">{</span><span class="string" id="8444489">&#34;foo&nbsp;bar&#34;</span><span class="op" id="8444498">,</span>&nbsp;<span class="string" id="8444500">&#34;Foo-Bar&#34;</span><span class="op" id="8444509">}</span><span class="op" id="8444510">,</span><br>
<span class="lineno"></span><span class="op" id="8444512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8444515">func</span>&nbsp;<span class="ident" id="8444520">TestCanonicalMIMEHeaderKey</span><span class="op" id="8444546">(</span><span class="ident" id="8444547">t</span>&nbsp;<span class="op" id="8444549">*</span><span class="ident" id="8444550">testing</span><span class="op" id="8444557">.</span><span class="ident" id="8444558">T</span><span class="op" id="8444559">)</span>&nbsp;<span class="op" id="8444561">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8444564">for</span>&nbsp;<span class="ident" id="8444568">_</span><span class="op" id="8444569">,</span>&nbsp;<span class="ident" id="8444571">tt</span>&nbsp;<span class="op" id="8444574">:=</span>&nbsp;<span class="keyword" id="8444577">range</span>&nbsp;<span class="ident" id="8444583">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8444607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8444611">if</span>&nbsp;<span class="ident" id="8444614">s</span>&nbsp;<span class="op" id="8444616">:=</span>&nbsp;<span class="ident" id="8444619">CanonicalMIMEHeaderKey</span><span class="op" id="8444641">(</span><span class="ident" id="8444642">tt</span><span class="op" id="8444644">.</span><span class="ident" id="8444645">in</span><span class="op" id="8444647">)</span><span class="op" id="8444648">;</span>&nbsp;<span class="ident" id="8444650">s</span>&nbsp;<span class="op" id="8444652">!=</span>&nbsp;<span class="ident" id="8444655">tt</span><span class="op" id="8444657">.</span><span class="ident" id="8444658">out</span>&nbsp;<span class="op" id="8444662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8444667">t</span><span class="op" id="8444668">.</span><span class="ident" id="8444669">Errorf</span><span class="op" id="8444675">(</span><span class="string" id="8444676">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8444718">,</span>&nbsp;<span class="ident" id="8444720">tt</span><span class="op" id="8444722">.</span><span class="ident" id="8444723">in</span><span class="op" id="8444725">,</span>&nbsp;<span class="ident" id="8444727">s</span><span class="op" id="8444728">,</span>&nbsp;<span class="ident" id="8444730">tt</span><span class="op" id="8444732">.</span><span class="ident" id="8444733">out</span><span class="op" id="8444736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8444743">}</span><br>
<span class="lineno">40</span><span class="op" id="8444745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8444748">func</span>&nbsp;<span class="ident" id="8444753">reader</span><span class="op" id="8444759">(</span><span class="ident" id="8444760">s</span>&nbsp;<span class="builtintype" id="8444762">string</span><span class="op" id="8444768">)</span>&nbsp;<span class="op" id="8444770">*</span><span class="ident" id="8444771">Reader</span>&nbsp;<span class="op" id="8444778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8444781">return</span>&nbsp;<span class="ident" id="8444788">NewReader</span><span class="op" id="8444797">(</span><span class="ident" id="8444798">bufio</span><span class="op" id="8444803">.</span><span class="ident" id="8444804">NewReader</span><span class="op" id="8444813">(</span><span class="ident" id="8444814">strings</span><span class="op" id="8444821">.</span><span class="ident" id="8444822">NewReader</span><span class="op" id="8444831">(</span><span class="ident" id="8444832">s</span><span class="op" id="8444833">)</span><span class="op" id="8444834">)</span><span class="op" id="8444835">)</span><br>
<span class="lineno"></span><span class="op" id="8444837">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8444840">func</span>&nbsp;<span class="ident" id="8444845">TestReadLine</span><span class="op" id="8444857">(</span><span class="ident" id="8444858">t</span>&nbsp;<span class="op" id="8444860">*</span><span class="ident" id="8444861">testing</span><span class="op" id="8444868">.</span><span class="ident" id="8444869">T</span><span class="op" id="8444870">)</span>&nbsp;<span class="op" id="8444872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8444875">r</span>&nbsp;<span class="op" id="8444877">:=</span>&nbsp;<span class="ident" id="8444880">reader</span><span class="op" id="8444886">(</span><span class="string" id="8444887">&#34;line1\nline2\n&#34;</span><span class="op" id="8444903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8444906">s</span><span class="op" id="8444907">,</span>&nbsp;<span class="ident" id="8444909">err</span>&nbsp;<span class="op" id="8444913">:=</span>&nbsp;<span class="ident" id="8444916">r</span><span class="op" id="8444917">.</span><span class="ident" id="8444918">ReadLine</span><span class="op" id="8444926">(</span><span class="op" id="8444927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8444930">if</span>&nbsp;<span class="ident" id="8444933">s</span>&nbsp;<span class="op" id="8444935">!=</span>&nbsp;<span class="string" id="8444938">&#34;line1&#34;</span>&nbsp;<span class="op" id="8444946">||</span>&nbsp;<span class="ident" id="8444949">err</span>&nbsp;<span class="op" id="8444953">!=</span>&nbsp;<span class="ident" id="8444956">nil</span>&nbsp;<span class="op" id="8444960">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8444964">t</span><span class="op" id="8444965">.</span><span class="ident" id="8444966">Fatalf</span><span class="op" id="8444972">(</span><span class="string" id="8444973">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8444989">,</span>&nbsp;<span class="ident" id="8444991">s</span><span class="op" id="8444992">,</span>&nbsp;<span class="ident" id="8444994">err</span><span class="op" id="8444997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445003">s</span><span class="op" id="8445004">,</span>&nbsp;<span class="ident" id="8445006">err</span>&nbsp;<span class="op" id="8445010">=</span>&nbsp;<span class="ident" id="8445012">r</span><span class="op" id="8445013">.</span><span class="ident" id="8445014">ReadLine</span><span class="op" id="8445022">(</span><span class="op" id="8445023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445026">if</span>&nbsp;<span class="ident" id="8445029">s</span>&nbsp;<span class="op" id="8445031">!=</span>&nbsp;<span class="string" id="8445034">&#34;line2&#34;</span>&nbsp;<span class="op" id="8445042">||</span>&nbsp;<span class="ident" id="8445045">err</span>&nbsp;<span class="op" id="8445049">!=</span>&nbsp;<span class="ident" id="8445052">nil</span>&nbsp;<span class="op" id="8445056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445060">t</span><span class="op" id="8445061">.</span><span class="ident" id="8445062">Fatalf</span><span class="op" id="8445068">(</span><span class="string" id="8445069">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445085">,</span>&nbsp;<span class="ident" id="8445087">s</span><span class="op" id="8445088">,</span>&nbsp;<span class="ident" id="8445090">err</span><span class="op" id="8445093">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445099">s</span><span class="op" id="8445100">,</span>&nbsp;<span class="ident" id="8445102">err</span>&nbsp;<span class="op" id="8445106">=</span>&nbsp;<span class="ident" id="8445108">r</span><span class="op" id="8445109">.</span><span class="ident" id="8445110">ReadLine</span><span class="op" id="8445118">(</span><span class="op" id="8445119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445122">if</span>&nbsp;<span class="ident" id="8445125">s</span>&nbsp;<span class="op" id="8445127">!=</span>&nbsp;<span class="string" id="8445130">&#34;&#34;</span>&nbsp;<span class="op" id="8445133">||</span>&nbsp;<span class="ident" id="8445136">err</span>&nbsp;<span class="op" id="8445140">!=</span>&nbsp;<span class="ident" id="8445143">io</span><span class="op" id="8445145">.</span><span class="ident" id="8445146">EOF</span>&nbsp;<span class="op" id="8445150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445154">t</span><span class="op" id="8445155">.</span><span class="ident" id="8445156">Fatalf</span><span class="op" id="8445162">(</span><span class="string" id="8445163">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445176">,</span>&nbsp;<span class="ident" id="8445178">s</span><span class="op" id="8445179">,</span>&nbsp;<span class="ident" id="8445181">err</span><span class="op" id="8445184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445187">}</span><br>
<span class="lineno">60</span><span class="op" id="8445189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8445192">func</span>&nbsp;<span class="ident" id="8445197">TestReadContinuedLine</span><span class="op" id="8445218">(</span><span class="ident" id="8445219">t</span>&nbsp;<span class="op" id="8445221">*</span><span class="ident" id="8445222">testing</span><span class="op" id="8445229">.</span><span class="ident" id="8445230">T</span><span class="op" id="8445231">)</span>&nbsp;<span class="op" id="8445233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445236">r</span>&nbsp;<span class="op" id="8445238">:=</span>&nbsp;<span class="ident" id="8445241">reader</span><span class="op" id="8445247">(</span><span class="string" id="8445248">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="8445274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445277">s</span><span class="op" id="8445278">,</span>&nbsp;<span class="ident" id="8445280">err</span>&nbsp;<span class="op" id="8445284">:=</span>&nbsp;<span class="ident" id="8445287">r</span><span class="op" id="8445288">.</span><span class="ident" id="8445289">ReadContinuedLine</span><span class="op" id="8445306">(</span><span class="op" id="8445307">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445310">if</span>&nbsp;<span class="ident" id="8445313">s</span>&nbsp;<span class="op" id="8445315">!=</span>&nbsp;<span class="string" id="8445318">&#34;line1&#34;</span>&nbsp;<span class="op" id="8445326">||</span>&nbsp;<span class="ident" id="8445329">err</span>&nbsp;<span class="op" id="8445333">!=</span>&nbsp;<span class="ident" id="8445336">nil</span>&nbsp;<span class="op" id="8445340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445344">t</span><span class="op" id="8445345">.</span><span class="ident" id="8445346">Fatalf</span><span class="op" id="8445352">(</span><span class="string" id="8445353">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445369">,</span>&nbsp;<span class="ident" id="8445371">s</span><span class="op" id="8445372">,</span>&nbsp;<span class="ident" id="8445374">err</span><span class="op" id="8445377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445383">s</span><span class="op" id="8445384">,</span>&nbsp;<span class="ident" id="8445386">err</span>&nbsp;<span class="op" id="8445390">=</span>&nbsp;<span class="ident" id="8445392">r</span><span class="op" id="8445393">.</span><span class="ident" id="8445394">ReadContinuedLine</span><span class="op" id="8445411">(</span><span class="op" id="8445412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445415">if</span>&nbsp;<span class="ident" id="8445418">s</span>&nbsp;<span class="op" id="8445420">!=</span>&nbsp;<span class="string" id="8445423">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="8445432">||</span>&nbsp;<span class="ident" id="8445435">err</span>&nbsp;<span class="op" id="8445439">!=</span>&nbsp;<span class="ident" id="8445442">nil</span>&nbsp;<span class="op" id="8445446">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445450">t</span><span class="op" id="8445451">.</span><span class="ident" id="8445452">Fatalf</span><span class="op" id="8445458">(</span><span class="string" id="8445459">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445475">,</span>&nbsp;<span class="ident" id="8445477">s</span><span class="op" id="8445478">,</span>&nbsp;<span class="ident" id="8445480">err</span><span class="op" id="8445483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445489">s</span><span class="op" id="8445490">,</span>&nbsp;<span class="ident" id="8445492">err</span>&nbsp;<span class="op" id="8445496">=</span>&nbsp;<span class="ident" id="8445498">r</span><span class="op" id="8445499">.</span><span class="ident" id="8445500">ReadContinuedLine</span><span class="op" id="8445517">(</span><span class="op" id="8445518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445521">if</span>&nbsp;<span class="ident" id="8445524">s</span>&nbsp;<span class="op" id="8445526">!=</span>&nbsp;<span class="string" id="8445529">&#34;line3&#34;</span>&nbsp;<span class="op" id="8445537">||</span>&nbsp;<span class="ident" id="8445540">err</span>&nbsp;<span class="op" id="8445544">!=</span>&nbsp;<span class="ident" id="8445547">nil</span>&nbsp;<span class="op" id="8445551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445555">t</span><span class="op" id="8445556">.</span><span class="ident" id="8445557">Fatalf</span><span class="op" id="8445563">(</span><span class="string" id="8445564">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445580">,</span>&nbsp;<span class="ident" id="8445582">s</span><span class="op" id="8445583">,</span>&nbsp;<span class="ident" id="8445585">err</span><span class="op" id="8445588">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445594">s</span><span class="op" id="8445595">,</span>&nbsp;<span class="ident" id="8445597">err</span>&nbsp;<span class="op" id="8445601">=</span>&nbsp;<span class="ident" id="8445603">r</span><span class="op" id="8445604">.</span><span class="ident" id="8445605">ReadContinuedLine</span><span class="op" id="8445622">(</span><span class="op" id="8445623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445626">if</span>&nbsp;<span class="ident" id="8445629">s</span>&nbsp;<span class="op" id="8445631">!=</span>&nbsp;<span class="string" id="8445634">&#34;&#34;</span>&nbsp;<span class="op" id="8445637">||</span>&nbsp;<span class="ident" id="8445640">err</span>&nbsp;<span class="op" id="8445644">!=</span>&nbsp;<span class="ident" id="8445647">io</span><span class="op" id="8445649">.</span><span class="ident" id="8445650">EOF</span>&nbsp;<span class="op" id="8445654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445658">t</span><span class="op" id="8445659">.</span><span class="ident" id="8445660">Fatalf</span><span class="op" id="8445666">(</span><span class="string" id="8445667">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445680">,</span>&nbsp;<span class="ident" id="8445682">s</span><span class="op" id="8445683">,</span>&nbsp;<span class="ident" id="8445685">err</span><span class="op" id="8445688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445691">}</span><br>
<span class="lineno">80</span><span class="op" id="8445693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8445696">func</span>&nbsp;<span class="ident" id="8445701">TestReadCodeLine</span><span class="op" id="8445717">(</span><span class="ident" id="8445718">t</span>&nbsp;<span class="op" id="8445720">*</span><span class="ident" id="8445721">testing</span><span class="op" id="8445728">.</span><span class="ident" id="8445729">T</span><span class="op" id="8445730">)</span>&nbsp;<span class="op" id="8445732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445735">r</span>&nbsp;<span class="op" id="8445737">:=</span>&nbsp;<span class="ident" id="8445740">reader</span><span class="op" id="8445746">(</span><span class="string" id="8445747">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="8445778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445781">code</span><span class="op" id="8445785">,</span>&nbsp;<span class="ident" id="8445787">msg</span><span class="op" id="8445790">,</span>&nbsp;<span class="ident" id="8445792">err</span>&nbsp;<span class="op" id="8445796">:=</span>&nbsp;<span class="ident" id="8445799">r</span><span class="op" id="8445800">.</span><span class="ident" id="8445801">ReadCodeLine</span><span class="op" id="8445813">(</span><span class="num" id="8445814">0</span><span class="op" id="8445815">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445818">if</span>&nbsp;<span class="ident" id="8445821">code</span>&nbsp;<span class="op" id="8445826">!=</span>&nbsp;<span class="num" id="8445829">123</span>&nbsp;<span class="op" id="8445833">||</span>&nbsp;<span class="ident" id="8445836">msg</span>&nbsp;<span class="op" id="8445840">!=</span>&nbsp;<span class="string" id="8445843">&#34;hi&#34;</span>&nbsp;<span class="op" id="8445848">||</span>&nbsp;<span class="ident" id="8445851">err</span>&nbsp;<span class="op" id="8445855">!=</span>&nbsp;<span class="ident" id="8445858">nil</span>&nbsp;<span class="op" id="8445862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445866">t</span><span class="op" id="8445867">.</span><span class="ident" id="8445868">Fatalf</span><span class="op" id="8445874">(</span><span class="string" id="8445875">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8445895">,</span>&nbsp;<span class="ident" id="8445897">code</span><span class="op" id="8445901">,</span>&nbsp;<span class="ident" id="8445903">msg</span><span class="op" id="8445906">,</span>&nbsp;<span class="ident" id="8445908">err</span><span class="op" id="8445911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8445914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8445917">code</span><span class="op" id="8445921">,</span>&nbsp;<span class="ident" id="8445923">msg</span><span class="op" id="8445926">,</span>&nbsp;<span class="ident" id="8445928">err</span>&nbsp;<span class="op" id="8445932">=</span>&nbsp;<span class="ident" id="8445934">r</span><span class="op" id="8445935">.</span><span class="ident" id="8445936">ReadCodeLine</span><span class="op" id="8445948">(</span><span class="num" id="8445949">23</span><span class="op" id="8445951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8445954">if</span>&nbsp;<span class="ident" id="8445957">code</span>&nbsp;<span class="op" id="8445962">!=</span>&nbsp;<span class="num" id="8445965">234</span>&nbsp;<span class="op" id="8445969">||</span>&nbsp;<span class="ident" id="8445972">msg</span>&nbsp;<span class="op" id="8445976">!=</span>&nbsp;<span class="string" id="8445979">&#34;bye&#34;</span>&nbsp;<span class="op" id="8445985">||</span>&nbsp;<span class="ident" id="8445988">err</span>&nbsp;<span class="op" id="8445992">!=</span>&nbsp;<span class="ident" id="8445995">nil</span>&nbsp;<span class="op" id="8445999">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446003">t</span><span class="op" id="8446004">.</span><span class="ident" id="8446005">Fatalf</span><span class="op" id="8446011">(</span><span class="string" id="8446012">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8446032">,</span>&nbsp;<span class="ident" id="8446034">code</span><span class="op" id="8446038">,</span>&nbsp;<span class="ident" id="8446040">msg</span><span class="op" id="8446043">,</span>&nbsp;<span class="ident" id="8446045">err</span><span class="op" id="8446048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446054">code</span><span class="op" id="8446058">,</span>&nbsp;<span class="ident" id="8446060">msg</span><span class="op" id="8446063">,</span>&nbsp;<span class="ident" id="8446065">err</span>&nbsp;<span class="op" id="8446069">=</span>&nbsp;<span class="ident" id="8446071">r</span><span class="op" id="8446072">.</span><span class="ident" id="8446073">ReadCodeLine</span><span class="op" id="8446085">(</span><span class="num" id="8446086">346</span><span class="op" id="8446089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8446092">if</span>&nbsp;<span class="ident" id="8446095">code</span>&nbsp;<span class="op" id="8446100">!=</span>&nbsp;<span class="num" id="8446103">345</span>&nbsp;<span class="op" id="8446107">||</span>&nbsp;<span class="ident" id="8446110">msg</span>&nbsp;<span class="op" id="8446114">!=</span>&nbsp;<span class="string" id="8446117">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="8446126">||</span>&nbsp;<span class="ident" id="8446129">err</span>&nbsp;<span class="op" id="8446133">==</span>&nbsp;<span class="ident" id="8446136">nil</span>&nbsp;<span class="op" id="8446140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446144">t</span><span class="op" id="8446145">.</span><span class="ident" id="8446146">Fatalf</span><span class="op" id="8446152">(</span><span class="string" id="8446153">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8446173">,</span>&nbsp;<span class="ident" id="8446175">code</span><span class="op" id="8446179">,</span>&nbsp;<span class="ident" id="8446181">msg</span><span class="op" id="8446184">,</span>&nbsp;<span class="ident" id="8446186">err</span><span class="op" id="8446189">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8446195">if</span>&nbsp;<span class="ident" id="8446198">e</span><span class="op" id="8446199">,</span>&nbsp;<span class="ident" id="8446201">ok</span>&nbsp;<span class="op" id="8446204">:=</span>&nbsp;<span class="ident" id="8446207">err</span><span class="op" id="8446210">.</span><span class="op" id="8446211">(</span><span class="op" id="8446212">*</span><span class="ident" id="8446213">Error</span><span class="op" id="8446218">)</span><span class="op" id="8446219">;</span>&nbsp;<span class="op" id="8446221">!</span><span class="ident" id="8446222">ok</span>&nbsp;<span class="op" id="8446225">||</span>&nbsp;<span class="ident" id="8446228">e</span><span class="op" id="8446229">.</span><span class="ident" id="8446230">Code</span>&nbsp;<span class="op" id="8446235">!=</span>&nbsp;<span class="ident" id="8446238">code</span>&nbsp;<span class="op" id="8446243">||</span>&nbsp;<span class="ident" id="8446246">e</span><span class="op" id="8446247">.</span><span class="ident" id="8446248">Msg</span>&nbsp;<span class="op" id="8446252">!=</span>&nbsp;<span class="ident" id="8446255">msg</span>&nbsp;<span class="op" id="8446259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446263">t</span><span class="op" id="8446264">.</span><span class="ident" id="8446265">Fatalf</span><span class="op" id="8446271">(</span><span class="string" id="8446272">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="8446298">,</span>&nbsp;<span class="ident" id="8446300">err</span><span class="op" id="8446303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446309">code</span><span class="op" id="8446313">,</span>&nbsp;<span class="ident" id="8446315">msg</span><span class="op" id="8446318">,</span>&nbsp;<span class="ident" id="8446320">err</span>&nbsp;<span class="op" id="8446324">=</span>&nbsp;<span class="ident" id="8446326">r</span><span class="op" id="8446327">.</span><span class="ident" id="8446328">ReadCodeLine</span><span class="op" id="8446340">(</span><span class="num" id="8446341">1</span><span class="op" id="8446342">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8446345">if</span>&nbsp;<span class="ident" id="8446348">code</span>&nbsp;<span class="op" id="8446353">!=</span>&nbsp;<span class="num" id="8446356">0</span>&nbsp;<span class="op" id="8446358">||</span>&nbsp;<span class="ident" id="8446361">msg</span>&nbsp;<span class="op" id="8446365">!=</span>&nbsp;<span class="string" id="8446368">&#34;&#34;</span>&nbsp;<span class="op" id="8446371">||</span>&nbsp;<span class="ident" id="8446374">err</span>&nbsp;<span class="op" id="8446378">!=</span>&nbsp;<span class="ident" id="8446381">io</span><span class="op" id="8446383">.</span><span class="ident" id="8446384">EOF</span>&nbsp;<span class="op" id="8446388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446392">t</span><span class="op" id="8446393">.</span><span class="ident" id="8446394">Fatalf</span><span class="op" id="8446400">(</span><span class="string" id="8446401">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8446418">,</span>&nbsp;<span class="ident" id="8446420">code</span><span class="op" id="8446424">,</span>&nbsp;<span class="ident" id="8446426">msg</span><span class="op" id="8446429">,</span>&nbsp;<span class="ident" id="8446431">err</span><span class="op" id="8446434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446437">}</span><br>
<span class="lineno"></span><span class="op" id="8446439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8446442">func</span>&nbsp;<span class="ident" id="8446447">TestReadDotLines</span><span class="op" id="8446463">(</span><span class="ident" id="8446464">t</span>&nbsp;<span class="op" id="8446466">*</span><span class="ident" id="8446467">testing</span><span class="op" id="8446474">.</span><span class="ident" id="8446475">T</span><span class="op" id="8446476">)</span>&nbsp;<span class="op" id="8446478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446481">r</span>&nbsp;<span class="op" id="8446483">:=</span>&nbsp;<span class="ident" id="8446486">reader</span><span class="op" id="8446492">(</span><span class="string" id="8446493">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="8446556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446559">s</span><span class="op" id="8446560">,</span>&nbsp;<span class="ident" id="8446562">err</span>&nbsp;<span class="op" id="8446566">:=</span>&nbsp;<span class="ident" id="8446569">r</span><span class="op" id="8446570">.</span><span class="ident" id="8446571">ReadDotLines</span><span class="op" id="8446583">(</span><span class="op" id="8446584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446587">want</span>&nbsp;<span class="op" id="8446592">:=</span>&nbsp;<span class="op" id="8446595">[</span><span class="op" id="8446596">]</span><span class="builtintype" id="8446597">string</span><span class="op" id="8446603">{</span><span class="string" id="8446604">&#34;dotlines&#34;</span><span class="op" id="8446614">,</span>&nbsp;<span class="string" id="8446616">&#34;foo&#34;</span><span class="op" id="8446621">,</span>&nbsp;<span class="string" id="8446623">&#34;.bar&#34;</span><span class="op" id="8446629">,</span>&nbsp;<span class="string" id="8446631">&#34;..baz&#34;</span><span class="op" id="8446638">,</span>&nbsp;<span class="string" id="8446640">&#34;quux&#34;</span><span class="op" id="8446646">,</span>&nbsp;<span class="string" id="8446648">&#34;&#34;</span><span class="op" id="8446650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8446653">if</span>&nbsp;<span class="op" id="8446656">!</span><span class="ident" id="8446657">reflect</span><span class="op" id="8446664">.</span><span class="ident" id="8446665">DeepEqual</span><span class="op" id="8446674">(</span><span class="ident" id="8446675">s</span><span class="op" id="8446676">,</span>&nbsp;<span class="ident" id="8446678">want</span><span class="op" id="8446682">)</span>&nbsp;<span class="op" id="8446684">||</span>&nbsp;<span class="ident" id="8446687">err</span>&nbsp;<span class="op" id="8446691">!=</span>&nbsp;<span class="ident" id="8446694">nil</span>&nbsp;<span class="op" id="8446698">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446702">t</span><span class="op" id="8446703">.</span><span class="ident" id="8446704">Fatalf</span><span class="op" id="8446710">(</span><span class="string" id="8446711">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8446733">,</span>&nbsp;<span class="ident" id="8446735">s</span><span class="op" id="8446736">,</span>&nbsp;<span class="ident" id="8446738">err</span><span class="op" id="8446741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446748">s</span><span class="op" id="8446749">,</span>&nbsp;<span class="ident" id="8446751">err</span>&nbsp;<span class="op" id="8446755">=</span>&nbsp;<span class="ident" id="8446757">r</span><span class="op" id="8446758">.</span><span class="ident" id="8446759">ReadDotLines</span><span class="op" id="8446771">(</span><span class="op" id="8446772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446775">want</span>&nbsp;<span class="op" id="8446780">=</span>&nbsp;<span class="op" id="8446782">[</span><span class="op" id="8446783">]</span><span class="builtintype" id="8446784">string</span><span class="op" id="8446790">{</span><span class="string" id="8446791">&#34;another&#34;</span><span class="op" id="8446800">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8446803">if</span>&nbsp;<span class="op" id="8446806">!</span><span class="ident" id="8446807">reflect</span><span class="op" id="8446814">.</span><span class="ident" id="8446815">DeepEqual</span><span class="op" id="8446824">(</span><span class="ident" id="8446825">s</span><span class="op" id="8446826">,</span>&nbsp;<span class="ident" id="8446828">want</span><span class="op" id="8446832">)</span>&nbsp;<span class="op" id="8446834">||</span>&nbsp;<span class="ident" id="8446837">err</span>&nbsp;<span class="op" id="8446841">!=</span>&nbsp;<span class="ident" id="8446844">io</span><span class="op" id="8446846">.</span><span class="ident" id="8446847">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8446864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446868">t</span><span class="op" id="8446869">.</span><span class="ident" id="8446870">Fatalf</span><span class="op" id="8446876">(</span><span class="string" id="8446877">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8446900">,</span>&nbsp;<span class="ident" id="8446902">s</span><span class="op" id="8446903">,</span>&nbsp;<span class="ident" id="8446905">err</span><span class="op" id="8446908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8446911">}</span><br>
<span class="lineno"></span><span class="op" id="8446913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8446916">func</span>&nbsp;<span class="ident" id="8446921">TestReadDotBytes</span><span class="op" id="8446937">(</span><span class="ident" id="8446938">t</span>&nbsp;<span class="op" id="8446940">*</span><span class="ident" id="8446941">testing</span><span class="op" id="8446948">.</span><span class="ident" id="8446949">T</span><span class="op" id="8446950">)</span>&nbsp;<span class="op" id="8446952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8446955">r</span>&nbsp;<span class="op" id="8446957">:=</span>&nbsp;<span class="ident" id="8446960">reader</span><span class="op" id="8446966">(</span><span class="string" id="8446967">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="8447033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447036">b</span><span class="op" id="8447037">,</span>&nbsp;<span class="ident" id="8447039">err</span>&nbsp;<span class="op" id="8447043">:=</span>&nbsp;<span class="ident" id="8447046">r</span><span class="op" id="8447047">.</span><span class="ident" id="8447048">ReadDotBytes</span><span class="op" id="8447060">(</span><span class="op" id="8447061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447064">want</span>&nbsp;<span class="op" id="8447069">:=</span>&nbsp;<span class="op" id="8447072">[</span><span class="op" id="8447073">]</span><span class="builtintype" id="8447074">byte</span><span class="op" id="8447078">(</span><span class="string" id="8447079">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="8447117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8447120">if</span>&nbsp;<span class="op" id="8447123">!</span><span class="ident" id="8447124">reflect</span><span class="op" id="8447131">.</span><span class="ident" id="8447132">DeepEqual</span><span class="op" id="8447141">(</span><span class="ident" id="8447142">b</span><span class="op" id="8447143">,</span>&nbsp;<span class="ident" id="8447145">want</span><span class="op" id="8447149">)</span>&nbsp;<span class="op" id="8447151">||</span>&nbsp;<span class="ident" id="8447154">err</span>&nbsp;<span class="op" id="8447158">!=</span>&nbsp;<span class="ident" id="8447161">nil</span>&nbsp;<span class="op" id="8447165">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447169">t</span><span class="op" id="8447170">.</span><span class="ident" id="8447171">Fatalf</span><span class="op" id="8447177">(</span><span class="string" id="8447178">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8447200">,</span>&nbsp;<span class="ident" id="8447202">b</span><span class="op" id="8447203">,</span>&nbsp;<span class="ident" id="8447205">err</span><span class="op" id="8447208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8447211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447215">b</span><span class="op" id="8447216">,</span>&nbsp;<span class="ident" id="8447218">err</span>&nbsp;<span class="op" id="8447222">=</span>&nbsp;<span class="ident" id="8447224">r</span><span class="op" id="8447225">.</span><span class="ident" id="8447226">ReadDotBytes</span><span class="op" id="8447238">(</span><span class="op" id="8447239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447242">want</span>&nbsp;<span class="op" id="8447247">=</span>&nbsp;<span class="op" id="8447249">[</span><span class="op" id="8447250">]</span><span class="builtintype" id="8447251">byte</span><span class="op" id="8447255">(</span><span class="string" id="8447256">&#34;anot.her\n&#34;</span><span class="op" id="8447268">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8447271">if</span>&nbsp;<span class="op" id="8447274">!</span><span class="ident" id="8447275">reflect</span><span class="op" id="8447282">.</span><span class="ident" id="8447283">DeepEqual</span><span class="op" id="8447292">(</span><span class="ident" id="8447293">b</span><span class="op" id="8447294">,</span>&nbsp;<span class="ident" id="8447296">want</span><span class="op" id="8447300">)</span>&nbsp;<span class="op" id="8447302">||</span>&nbsp;<span class="ident" id="8447305">err</span>&nbsp;<span class="op" id="8447309">!=</span>&nbsp;<span class="ident" id="8447312">io</span><span class="op" id="8447314">.</span><span class="ident" id="8447315">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8447332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447336">t</span><span class="op" id="8447337">.</span><span class="ident" id="8447338">Fatalf</span><span class="op" id="8447344">(</span><span class="string" id="8447345">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8447368">,</span>&nbsp;<span class="ident" id="8447370">b</span><span class="op" id="8447371">,</span>&nbsp;<span class="ident" id="8447373">err</span><span class="op" id="8447376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8447379">}</span><br>
<span class="lineno"></span><span class="op" id="8447381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="8447384">func</span>&nbsp;<span class="ident" id="8447389">TestReadMIMEHeader</span><span class="op" id="8447407">(</span><span class="ident" id="8447408">t</span>&nbsp;<span class="op" id="8447410">*</span><span class="ident" id="8447411">testing</span><span class="op" id="8447418">.</span><span class="ident" id="8447419">T</span><span class="op" id="8447420">)</span>&nbsp;<span class="op" id="8447422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447425">r</span>&nbsp;<span class="op" id="8447427">:=</span>&nbsp;<span class="ident" id="8447430">reader</span><span class="op" id="8447436">(</span><span class="string" id="8447437">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="8447515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447518">m</span><span class="op" id="8447519">,</span>&nbsp;<span class="ident" id="8447521">err</span>&nbsp;<span class="op" id="8447525">:=</span>&nbsp;<span class="ident" id="8447528">r</span><span class="op" id="8447529">.</span><span class="ident" id="8447530">ReadMIMEHeader</span><span class="op" id="8447544">(</span><span class="op" id="8447545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447548">want</span>&nbsp;<span class="op" id="8447553">:=</span>&nbsp;<span class="ident" id="8447556">MIMEHeader</span><span class="op" id="8447566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8447570">&#34;My-Key&#34;</span><span class="op" id="8447578">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8447582">{</span><span class="string" id="8447583">&#34;Value&nbsp;1&#34;</span><span class="op" id="8447592">,</span>&nbsp;<span class="string" id="8447594">&#34;Value&nbsp;2&#34;</span><span class="op" id="8447603">}</span><span class="op" id="8447604">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8447608">&#34;Long-Key&#34;</span><span class="op" id="8447618">:</span>&nbsp;<span class="op" id="8447620">{</span><span class="string" id="8447621">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="8447640">}</span><span class="op" id="8447641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8447644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8447647">if</span>&nbsp;<span class="op" id="8447650">!</span><span class="ident" id="8447651">reflect</span><span class="op" id="8447658">.</span><span class="ident" id="8447659">DeepEqual</span><span class="op" id="8447668">(</span><span class="ident" id="8447669">m</span><span class="op" id="8447670">,</span>&nbsp;<span class="ident" id="8447672">want</span><span class="op" id="8447676">)</span>&nbsp;<span class="op" id="8447678">||</span>&nbsp;<span class="ident" id="8447681">err</span>&nbsp;<span class="op" id="8447685">!=</span>&nbsp;<span class="ident" id="8447688">nil</span>&nbsp;<span class="op" id="8447692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447696">t</span><span class="op" id="8447697">.</span><span class="ident" id="8447698">Fatalf</span><span class="op" id="8447704">(</span><span class="string" id="8447705">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8447738">,</span>&nbsp;<span class="ident" id="8447740">m</span><span class="op" id="8447741">,</span>&nbsp;<span class="ident" id="8447743">err</span><span class="op" id="8447746">,</span>&nbsp;<span class="ident" id="8447748">want</span><span class="op" id="8447752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8447755">}</span><br>
<span class="lineno">145</span><span class="op" id="8447757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8447760">func</span>&nbsp;<span class="ident" id="8447765">TestReadMIMEHeaderSingle</span><span class="op" id="8447789">(</span><span class="ident" id="8447790">t</span>&nbsp;<span class="op" id="8447792">*</span><span class="ident" id="8447793">testing</span><span class="op" id="8447800">.</span><span class="ident" id="8447801">T</span><span class="op" id="8447802">)</span>&nbsp;<span class="op" id="8447804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447807">r</span>&nbsp;<span class="op" id="8447809">:=</span>&nbsp;<span class="ident" id="8447812">reader</span><span class="op" id="8447818">(</span><span class="string" id="8447819">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="8447833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447836">m</span><span class="op" id="8447837">,</span>&nbsp;<span class="ident" id="8447839">err</span>&nbsp;<span class="op" id="8447843">:=</span>&nbsp;<span class="ident" id="8447846">r</span><span class="op" id="8447847">.</span><span class="ident" id="8447848">ReadMIMEHeader</span><span class="op" id="8447862">(</span><span class="op" id="8447863">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447866">want</span>&nbsp;<span class="op" id="8447871">:=</span>&nbsp;<span class="ident" id="8447874">MIMEHeader</span><span class="op" id="8447884">{</span><span class="string" id="8447885">&#34;Foo&#34;</span><span class="op" id="8447890">:</span>&nbsp;<span class="op" id="8447892">{</span><span class="string" id="8447893">&#34;bar&#34;</span><span class="op" id="8447898">}</span><span class="op" id="8447899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8447902">if</span>&nbsp;<span class="op" id="8447905">!</span><span class="ident" id="8447906">reflect</span><span class="op" id="8447913">.</span><span class="ident" id="8447914">DeepEqual</span><span class="op" id="8447923">(</span><span class="ident" id="8447924">m</span><span class="op" id="8447925">,</span>&nbsp;<span class="ident" id="8447927">want</span><span class="op" id="8447931">)</span>&nbsp;<span class="op" id="8447933">||</span>&nbsp;<span class="ident" id="8447936">err</span>&nbsp;<span class="op" id="8447940">!=</span>&nbsp;<span class="ident" id="8447943">nil</span>&nbsp;<span class="op" id="8447947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8447951">t</span><span class="op" id="8447952">.</span><span class="ident" id="8447953">Fatalf</span><span class="op" id="8447959">(</span><span class="string" id="8447960">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8447993">,</span>&nbsp;<span class="ident" id="8447995">m</span><span class="op" id="8447996">,</span>&nbsp;<span class="ident" id="8447998">err</span><span class="op" id="8448001">,</span>&nbsp;<span class="ident" id="8448003">want</span><span class="op" id="8448007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8448010">}</span><br>
<span class="lineno"></span><span class="op" id="8448012">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8448015">func</span>&nbsp;<span class="ident" id="8448020">TestLargeReadMIMEHeader</span><span class="op" id="8448043">(</span><span class="ident" id="8448044">t</span>&nbsp;<span class="op" id="8448046">*</span><span class="ident" id="8448047">testing</span><span class="op" id="8448054">.</span><span class="ident" id="8448055">T</span><span class="op" id="8448056">)</span>&nbsp;<span class="op" id="8448058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448061">data</span>&nbsp;<span class="op" id="8448066">:=</span>&nbsp;<span class="builtinfunc" id="8448069">make</span><span class="op" id="8448073">(</span><span class="op" id="8448074">[</span><span class="op" id="8448075">]</span><span class="builtintype" id="8448076">byte</span><span class="op" id="8448080">,</span>&nbsp;<span class="num" id="8448082">16</span><span class="op" id="8448084">*</span><span class="num" id="8448085">1024</span><span class="op" id="8448089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8448092">for</span>&nbsp;<span class="ident" id="8448096">i</span>&nbsp;<span class="op" id="8448098">:=</span>&nbsp;<span class="num" id="8448101">0</span><span class="op" id="8448102">;</span>&nbsp;<span class="ident" id="8448104">i</span>&nbsp;<span class="op" id="8448106">&lt;</span>&nbsp;<span class="builtinfunc" id="8448108">len</span><span class="op" id="8448111">(</span><span class="ident" id="8448112">data</span><span class="op" id="8448116">)</span><span class="op" id="8448117">;</span>&nbsp;<span class="ident" id="8448119">i</span><span class="op" id="8448120">++</span>&nbsp;<span class="op" id="8448123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448127">data</span><span class="op" id="8448131">[</span><span class="ident" id="8448132">i</span><span class="op" id="8448133">]</span>&nbsp;<span class="op" id="8448135">=</span>&nbsp;<span class="string" id="8448137">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8448142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448145">sdata</span>&nbsp;<span class="op" id="8448151">:=</span>&nbsp;<span class="builtintype" id="8448154">string</span><span class="op" id="8448160">(</span><span class="ident" id="8448161">data</span><span class="op" id="8448165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448168">r</span>&nbsp;<span class="op" id="8448170">:=</span>&nbsp;<span class="ident" id="8448173">reader</span><span class="op" id="8448179">(</span><span class="string" id="8448180">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="8448191">+</span>&nbsp;<span class="ident" id="8448193">sdata</span>&nbsp;<span class="op" id="8448199">+</span>&nbsp;<span class="string" id="8448201">&#34;\r\n\n&#34;</span><span class="op" id="8448209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448212">m</span><span class="op" id="8448213">,</span>&nbsp;<span class="ident" id="8448215">err</span>&nbsp;<span class="op" id="8448219">:=</span>&nbsp;<span class="ident" id="8448222">r</span><span class="op" id="8448223">.</span><span class="ident" id="8448224">ReadMIMEHeader</span><span class="op" id="8448238">(</span><span class="op" id="8448239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8448242">if</span>&nbsp;<span class="ident" id="8448245">err</span>&nbsp;<span class="op" id="8448249">!=</span>&nbsp;<span class="ident" id="8448252">nil</span>&nbsp;<span class="op" id="8448256">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448260">t</span><span class="op" id="8448261">.</span><span class="ident" id="8448262">Fatalf</span><span class="op" id="8448268">(</span><span class="string" id="8448269">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="8448289">,</span>&nbsp;<span class="ident" id="8448291">err</span><span class="op" id="8448294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8448297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448300">cookie</span>&nbsp;<span class="op" id="8448307">:=</span>&nbsp;<span class="ident" id="8448310">m</span><span class="op" id="8448311">.</span><span class="ident" id="8448312">Get</span><span class="op" id="8448315">(</span><span class="string" id="8448316">&#34;Cookie&#34;</span><span class="op" id="8448324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8448327">if</span>&nbsp;<span class="ident" id="8448330">cookie</span>&nbsp;<span class="op" id="8448337">!=</span>&nbsp;<span class="ident" id="8448340">sdata</span>&nbsp;<span class="op" id="8448346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448350">t</span><span class="op" id="8448351">.</span><span class="ident" id="8448352">Fatalf</span><span class="op" id="8448358">(</span><span class="string" id="8448359">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="8448400">,</span>&nbsp;<span class="builtinfunc" id="8448402">len</span><span class="op" id="8448405">(</span><span class="ident" id="8448406">cookie</span><span class="op" id="8448412">)</span><span class="op" id="8448413">,</span>&nbsp;<span class="builtinfunc" id="8448415">len</span><span class="op" id="8448418">(</span><span class="ident" id="8448419">sdata</span><span class="op" id="8448424">)</span><span class="op" id="8448425">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8448428">}</span><br>
<span class="lineno"></span><span class="op" id="8448430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8448433">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="8448500">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="8448550">func</span>&nbsp;<span class="ident" id="8448555">TestReadMIMEHeaderNonCompliant</span><span class="op" id="8448585">(</span><span class="ident" id="8448586">t</span>&nbsp;<span class="op" id="8448588">*</span><span class="ident" id="8448589">testing</span><span class="op" id="8448596">.</span><span class="ident" id="8448597">T</span><span class="op" id="8448598">)</span>&nbsp;<span class="op" id="8448600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8448603">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8448664">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448729">r</span>&nbsp;<span class="op" id="8448731">:=</span>&nbsp;<span class="ident" id="8448734">reader</span><span class="op" id="8448740">(</span><span class="string" id="8448741">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="8448756">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448760">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="8448787">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448791">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8448805">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448809">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="8448833">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448837">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="8448862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448865">m</span><span class="op" id="8448866">,</span>&nbsp;<span class="ident" id="8448868">err</span>&nbsp;<span class="op" id="8448872">:=</span>&nbsp;<span class="ident" id="8448875">r</span><span class="op" id="8448876">.</span><span class="ident" id="8448877">ReadMIMEHeader</span><span class="op" id="8448891">(</span><span class="op" id="8448892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8448895">want</span>&nbsp;<span class="op" id="8448900">:=</span>&nbsp;<span class="ident" id="8448903">MIMEHeader</span><span class="op" id="8448913">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448917">&#34;Foo&#34;</span><span class="op" id="8448922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448937">{</span><span class="string" id="8448938">&#34;bar&#34;</span><span class="op" id="8448943">}</span><span class="op" id="8448944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448948">&#34;Content-Language&#34;</span><span class="op" id="8448966">:</span>&nbsp;<span class="op" id="8448968">{</span><span class="string" id="8448969">&#34;en&#34;</span><span class="op" id="8448973">}</span><span class="op" id="8448974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8448978">&#34;Sid&#34;</span><span class="op" id="8448983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8448998">{</span><span class="string" id="8448999">&#34;0&#34;</span><span class="op" id="8449002">}</span><span class="op" id="8449003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449007">&#34;Audio-Mode&#34;</span><span class="op" id="8449019">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449027">{</span><span class="string" id="8449028">&#34;None&#34;</span><span class="op" id="8449034">}</span><span class="op" id="8449035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449039">&#34;Privilege&#34;</span><span class="op" id="8449050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8449059">{</span><span class="string" id="8449060">&#34;127&#34;</span><span class="op" id="8449065">}</span><span class="op" id="8449066">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8449072">if</span>&nbsp;<span class="op" id="8449075">!</span><span class="ident" id="8449076">reflect</span><span class="op" id="8449083">.</span><span class="ident" id="8449084">DeepEqual</span><span class="op" id="8449093">(</span><span class="ident" id="8449094">m</span><span class="op" id="8449095">,</span>&nbsp;<span class="ident" id="8449097">want</span><span class="op" id="8449101">)</span>&nbsp;<span class="op" id="8449103">||</span>&nbsp;<span class="ident" id="8449106">err</span>&nbsp;<span class="op" id="8449110">!=</span>&nbsp;<span class="ident" id="8449113">nil</span>&nbsp;<span class="op" id="8449117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449121">t</span><span class="op" id="8449122">.</span><span class="ident" id="8449123">Fatalf</span><span class="op" id="8449129">(</span><span class="string" id="8449130">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="8449167">,</span>&nbsp;<span class="ident" id="8449169">m</span><span class="op" id="8449170">,</span>&nbsp;<span class="ident" id="8449172">err</span><span class="op" id="8449175">,</span>&nbsp;<span class="ident" id="8449177">want</span><span class="op" id="8449181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449184">}</span><br>
<span class="lineno"></span><span class="op" id="8449186">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="8449189">type</span>&nbsp;<span class="ident" id="8449194">readResponseTest</span>&nbsp;<span class="keyword" id="8449211">struct</span>&nbsp;<span class="op" id="8449218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449221">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8449230">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449238">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8449247">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449252">wantCode</span>&nbsp;<span class="builtintype" id="8449261">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449266">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="8449275">string</span><br>
<span class="lineno"></span><span class="op" id="8449282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8449285">var</span>&nbsp;<span class="ident" id="8449289">readResponseTests</span>&nbsp;<span class="op" id="8449307">=</span>&nbsp;<span class="op" id="8449309">[</span><span class="op" id="8449310">]</span><span class="ident" id="8449311">readResponseTest</span><span class="op" id="8449327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449330">{</span><span class="string" id="8449331">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="8449384">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449388">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="8449418">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449422">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="8449435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449439">23</span><span class="op" id="8449441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449445">230</span><span class="op" id="8449448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449452">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="8449534">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449537">}</span><span class="op" id="8449538">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449542">{</span><span class="string" id="8449543">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="8449595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449599">23</span><span class="op" id="8449601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449605">230</span><span class="op" id="8449608">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449612">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="8449658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449661">}</span><span class="op" id="8449662">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449666">{</span><span class="string" id="8449667">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="8449688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449692">4</span><span class="op" id="8449693">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449697">400</span><span class="op" id="8449700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449704">&#34;A\nB\nC&#34;</span><span class="op" id="8449713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449716">}</span><span class="op" id="8449717">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449721">{</span><span class="string" id="8449722">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="8449751">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449755">4</span><span class="op" id="8449756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8449760">400</span><span class="op" id="8449763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8449767">&#34;A\nB\nC&#34;</span><span class="op" id="8449776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8449779">}</span><span class="op" id="8449780">,</span><br>
<span class="lineno"></span><span class="op" id="8449782">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="8449785">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="8449836">func</span>&nbsp;<span class="ident" id="8449841">TestRFC959Lines</span><span class="op" id="8449856">(</span><span class="ident" id="8449857">t</span>&nbsp;<span class="op" id="8449859">*</span><span class="ident" id="8449860">testing</span><span class="op" id="8449867">.</span><span class="ident" id="8449868">T</span><span class="op" id="8449869">)</span>&nbsp;<span class="op" id="8449871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8449874">for</span>&nbsp;<span class="ident" id="8449878">i</span><span class="op" id="8449879">,</span>&nbsp;<span class="ident" id="8449881">tt</span>&nbsp;<span class="op" id="8449884">:=</span>&nbsp;<span class="keyword" id="8449887">range</span>&nbsp;<span class="ident" id="8449893">readResponseTests</span>&nbsp;<span class="op" id="8449911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449915">r</span>&nbsp;<span class="op" id="8449917">:=</span>&nbsp;<span class="ident" id="8449920">reader</span><span class="op" id="8449926">(</span><span class="ident" id="8449927">tt</span><span class="op" id="8449929">.</span><span class="ident" id="8449930">in</span>&nbsp;<span class="op" id="8449933">+</span>&nbsp;<span class="string" id="8449935">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="8449953">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8449957">code</span><span class="op" id="8449961">,</span>&nbsp;<span class="ident" id="8449963">msg</span><span class="op" id="8449966">,</span>&nbsp;<span class="ident" id="8449968">err</span>&nbsp;<span class="op" id="8449972">:=</span>&nbsp;<span class="ident" id="8449975">r</span><span class="op" id="8449976">.</span><span class="ident" id="8449977">ReadResponse</span><span class="op" id="8449989">(</span><span class="ident" id="8449990">tt</span><span class="op" id="8449992">.</span><span class="ident" id="8449993">inCode</span><span class="op" id="8449999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450003">if</span>&nbsp;<span class="ident" id="8450006">err</span>&nbsp;<span class="op" id="8450010">!=</span>&nbsp;<span class="ident" id="8450013">nil</span>&nbsp;<span class="op" id="8450017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450022">t</span><span class="op" id="8450023">.</span><span class="ident" id="8450024">Errorf</span><span class="op" id="8450030">(</span><span class="string" id="8450031">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="8450054">,</span>&nbsp;<span class="ident" id="8450056">i</span><span class="op" id="8450057">,</span>&nbsp;<span class="ident" id="8450059">err</span><span class="op" id="8450062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450067">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450078">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450082">if</span>&nbsp;<span class="ident" id="8450085">code</span>&nbsp;<span class="op" id="8450090">!=</span>&nbsp;<span class="ident" id="8450093">tt</span><span class="op" id="8450095">.</span><span class="ident" id="8450096">wantCode</span>&nbsp;<span class="op" id="8450105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450110">t</span><span class="op" id="8450111">.</span><span class="ident" id="8450112">Errorf</span><span class="op" id="8450118">(</span><span class="string" id="8450119">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8450142">,</span>&nbsp;<span class="ident" id="8450144">i</span><span class="op" id="8450145">,</span>&nbsp;<span class="ident" id="8450147">code</span><span class="op" id="8450151">,</span>&nbsp;<span class="ident" id="8450153">tt</span><span class="op" id="8450155">.</span><span class="ident" id="8450156">wantCode</span><span class="op" id="8450164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450172">if</span>&nbsp;<span class="ident" id="8450175">msg</span>&nbsp;<span class="op" id="8450179">!=</span>&nbsp;<span class="ident" id="8450182">tt</span><span class="op" id="8450184">.</span><span class="ident" id="8450185">wantMsg</span>&nbsp;<span class="op" id="8450193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450198">t</span><span class="op" id="8450199">.</span><span class="ident" id="8450200">Errorf</span><span class="op" id="8450206">(</span><span class="string" id="8450207">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8450229">,</span>&nbsp;<span class="ident" id="8450231">i</span><span class="op" id="8450232">,</span>&nbsp;<span class="ident" id="8450234">msg</span><span class="op" id="8450237">,</span>&nbsp;<span class="ident" id="8450239">tt</span><span class="op" id="8450241">.</span><span class="ident" id="8450242">wantMsg</span><span class="op" id="8450249">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450256">}</span><br>
<span class="lineno"></span><span class="op" id="8450258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8450261">func</span>&nbsp;<span class="ident" id="8450266">TestCommonHeaders</span><span class="op" id="8450283">(</span><span class="ident" id="8450284">t</span>&nbsp;<span class="op" id="8450286">*</span><span class="ident" id="8450287">testing</span><span class="op" id="8450294">.</span><span class="ident" id="8450295">T</span><span class="op" id="8450296">)</span>&nbsp;<span class="op" id="8450298">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450301">for</span>&nbsp;<span class="ident" id="8450305">h</span>&nbsp;<span class="op" id="8450307">:=</span>&nbsp;<span class="keyword" id="8450310">range</span>&nbsp;<span class="ident" id="8450316">commonHeader</span>&nbsp;<span class="op" id="8450329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450333">if</span>&nbsp;<span class="ident" id="8450336">h</span>&nbsp;<span class="op" id="8450338">!=</span>&nbsp;<span class="ident" id="8450341">CanonicalMIMEHeaderKey</span><span class="op" id="8450363">(</span><span class="ident" id="8450364">h</span><span class="op" id="8450365">)</span>&nbsp;<span class="op" id="8450367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450372">t</span><span class="op" id="8450373">.</span><span class="ident" id="8450374">Errorf</span><span class="op" id="8450380">(</span><span class="string" id="8450381">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="8450422">,</span>&nbsp;<span class="ident" id="8450424">h</span><span class="op" id="8450425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450432">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450435">b</span>&nbsp;<span class="op" id="8450437">:=</span>&nbsp;<span class="op" id="8450440">[</span><span class="op" id="8450441">]</span><span class="builtintype" id="8450442">byte</span><span class="op" id="8450446">(</span><span class="string" id="8450447">&#34;content-Length&#34;</span><span class="op" id="8450463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450466">want</span>&nbsp;<span class="op" id="8450471">:=</span>&nbsp;<span class="string" id="8450474">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450492">n</span>&nbsp;<span class="op" id="8450494">:=</span>&nbsp;<span class="ident" id="8450497">testing</span><span class="op" id="8450504">.</span><span class="ident" id="8450505">AllocsPerRun</span><span class="op" id="8450517">(</span><span class="num" id="8450518">200</span><span class="op" id="8450521">,</span>&nbsp;<span class="keyword" id="8450523">func</span><span class="op" id="8450527">(</span><span class="op" id="8450528">)</span>&nbsp;<span class="op" id="8450530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450534">if</span>&nbsp;<span class="ident" id="8450537">x</span>&nbsp;<span class="op" id="8450539">:=</span>&nbsp;<span class="ident" id="8450542">canonicalMIMEHeaderKey</span><span class="op" id="8450564">(</span><span class="ident" id="8450565">b</span><span class="op" id="8450566">)</span><span class="op" id="8450567">;</span>&nbsp;<span class="ident" id="8450569">x</span>&nbsp;<span class="op" id="8450571">!=</span>&nbsp;<span class="ident" id="8450574">want</span>&nbsp;<span class="op" id="8450579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450584">t</span><span class="op" id="8450585">.</span><span class="ident" id="8450586">Fatalf</span><span class="op" id="8450592">(</span><span class="string" id="8450593">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8450635">,</span>&nbsp;<span class="ident" id="8450637">b</span><span class="op" id="8450638">,</span>&nbsp;<span class="ident" id="8450640">x</span><span class="op" id="8450641">,</span>&nbsp;<span class="ident" id="8450643">want</span><span class="op" id="8450647">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450654">}</span><span class="op" id="8450655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8450658">if</span>&nbsp;<span class="ident" id="8450661">n</span>&nbsp;<span class="op" id="8450663">&gt;</span>&nbsp;<span class="num" id="8450665">0</span>&nbsp;<span class="op" id="8450667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8450671">t</span><span class="op" id="8450672">.</span><span class="ident" id="8450673">Errorf</span><span class="op" id="8450679">(</span><span class="string" id="8450680">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8450724">,</span>&nbsp;<span class="ident" id="8450726">n</span><span class="op" id="8450727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8450730">}</span><br>
<span class="lineno">265</span><span class="op" id="8450732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8450735">var</span>&nbsp;<span class="ident" id="8450739">clientHeaders</span>&nbsp;<span class="op" id="8450753">=</span>&nbsp;<span class="ident" id="8450755">strings</span><span class="op" id="8450762">.</span><span class="ident" id="8450763">Replace</span><span class="op" id="8450770">(</span><span class="string" id="8450771">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="8451448">,</span>&nbsp;<span class="string" id="8451450">&#34;\n&#34;</span><span class="op" id="8451454">,</span>&nbsp;<span class="string" id="8451456">&#34;\r\n&#34;</span><span class="op" id="8451462">,</span>&nbsp;<span class="op" id="8451464">-</span><span class="num" id="8451465">1</span><span class="op" id="8451466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8451469">var</span>&nbsp;<span class="ident" id="8451473">serverHeaders</span>&nbsp;<span class="op" id="8451487">=</span>&nbsp;<span class="ident" id="8451489">strings</span><span class="op" id="8451496">.</span><span class="ident" id="8451497">Replace</span><span class="op" id="8451504">(</span><span class="string" id="8451505">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="8451757">,</span>&nbsp;<span class="string" id="8451759">&#34;\n&#34;</span><span class="op" id="8451763">,</span>&nbsp;<span class="string" id="8451765">&#34;\r\n&#34;</span><span class="op" id="8451771">,</span>&nbsp;<span class="op" id="8451773">-</span><span class="num" id="8451774">1</span><span class="op" id="8451775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8451778">func</span>&nbsp;<span class="ident" id="8451783">BenchmarkReadMIMEHeader</span><span class="op" id="8451806">(</span><span class="ident" id="8451807">b</span>&nbsp;<span class="op" id="8451809">*</span><span class="ident" id="8451810">testing</span><span class="op" id="8451817">.</span><span class="ident" id="8451818">B</span><span class="op" id="8451819">)</span>&nbsp;<span class="op" id="8451821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8451824">b</span><span class="op" id="8451825">.</span><span class="ident" id="8451826">ReportAllocs</span><span class="op" id="8451838">(</span><span class="op" id="8451839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8451842">var</span>&nbsp;<span class="ident" id="8451846">buf</span>&nbsp;<span class="ident" id="8451850">bytes</span><span class="op" id="8451855">.</span><span class="ident" id="8451856">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8451864">br</span>&nbsp;<span class="op" id="8451867">:=</span>&nbsp;<span class="ident" id="8451870">bufio</span><span class="op" id="8451875">.</span><span class="ident" id="8451876">NewReader</span><span class="op" id="8451885">(</span><span class="op" id="8451886">&amp;</span><span class="ident" id="8451887">buf</span><span class="op" id="8451890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8451893">r</span>&nbsp;<span class="op" id="8451895">:=</span>&nbsp;<span class="ident" id="8451898">NewReader</span><span class="op" id="8451907">(</span><span class="ident" id="8451908">br</span><span class="op" id="8451910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8451913">for</span>&nbsp;<span class="ident" id="8451917">i</span>&nbsp;<span class="op" id="8451919">:=</span>&nbsp;<span class="num" id="8451922">0</span><span class="op" id="8451923">;</span>&nbsp;<span class="ident" id="8451925">i</span>&nbsp;<span class="op" id="8451927">&lt;</span>&nbsp;<span class="ident" id="8451929">b</span><span class="op" id="8451930">.</span><span class="ident" id="8451931">N</span><span class="op" id="8451932">;</span>&nbsp;<span class="ident" id="8451934">i</span><span class="op" id="8451935">++</span>&nbsp;<span class="op" id="8451938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8451942">var</span>&nbsp;<span class="ident" id="8451946">want</span>&nbsp;<span class="builtintype" id="8451951">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8451957">var</span>&nbsp;<span class="ident" id="8451961">find</span>&nbsp;<span class="builtintype" id="8451966">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8451975">if</span>&nbsp;<span class="op" id="8451978">(</span><span class="ident" id="8451979">i</span>&nbsp;<span class="op" id="8451981">&amp;</span>&nbsp;<span class="num" id="8451983">1</span><span class="op" id="8451984">)</span>&nbsp;<span class="op" id="8451986">==</span>&nbsp;<span class="num" id="8451989">1</span>&nbsp;<span class="op" id="8451991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8451996">buf</span><span class="op" id="8451999">.</span><span class="ident" id="8452000">WriteString</span><span class="op" id="8452011">(</span><span class="ident" id="8452012">clientHeaders</span><span class="op" id="8452025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452030">want</span>&nbsp;<span class="op" id="8452035">=</span>&nbsp;<span class="num" id="8452037">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452043">find</span>&nbsp;<span class="op" id="8452048">=</span>&nbsp;<span class="string" id="8452050">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452061">}</span>&nbsp;<span class="keyword" id="8452063">else</span>&nbsp;<span class="op" id="8452068">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452073">buf</span><span class="op" id="8452076">.</span><span class="ident" id="8452077">WriteString</span><span class="op" id="8452088">(</span><span class="ident" id="8452089">serverHeaders</span><span class="op" id="8452102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452107">want</span>&nbsp;<span class="op" id="8452112">=</span>&nbsp;<span class="num" id="8452114">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452119">find</span>&nbsp;<span class="op" id="8452124">=</span>&nbsp;<span class="string" id="8452126">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452138">h</span><span class="op" id="8452139">,</span>&nbsp;<span class="ident" id="8452141">err</span>&nbsp;<span class="op" id="8452145">:=</span>&nbsp;<span class="ident" id="8452148">r</span><span class="op" id="8452149">.</span><span class="ident" id="8452150">ReadMIMEHeader</span><span class="op" id="8452164">(</span><span class="op" id="8452165">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452169">if</span>&nbsp;<span class="ident" id="8452172">err</span>&nbsp;<span class="op" id="8452176">!=</span>&nbsp;<span class="ident" id="8452179">nil</span>&nbsp;<span class="op" id="8452183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452188">b</span><span class="op" id="8452189">.</span><span class="ident" id="8452190">Fatal</span><span class="op" id="8452195">(</span><span class="ident" id="8452196">err</span><span class="op" id="8452199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452207">if</span>&nbsp;<span class="builtinfunc" id="8452210">len</span><span class="op" id="8452213">(</span><span class="ident" id="8452214">h</span><span class="op" id="8452215">)</span>&nbsp;<span class="op" id="8452217">!=</span>&nbsp;<span class="ident" id="8452220">want</span>&nbsp;<span class="op" id="8452225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452230">b</span><span class="op" id="8452231">.</span><span class="ident" id="8452232">Fatalf</span><span class="op" id="8452238">(</span><span class="string" id="8452239">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8452281">,</span>&nbsp;<span class="builtinfunc" id="8452283">len</span><span class="op" id="8452286">(</span><span class="ident" id="8452287">h</span><span class="op" id="8452288">)</span><span class="op" id="8452289">,</span>&nbsp;<span class="ident" id="8452291">want</span><span class="op" id="8452295">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452303">if</span>&nbsp;<span class="ident" id="8452306">_</span><span class="op" id="8452307">,</span>&nbsp;<span class="ident" id="8452309">ok</span>&nbsp;<span class="op" id="8452312">:=</span>&nbsp;<span class="ident" id="8452315">h</span><span class="op" id="8452316">[</span><span class="ident" id="8452317">find</span><span class="op" id="8452321">]</span><span class="op" id="8452322">;</span>&nbsp;<span class="op" id="8452324">!</span><span class="ident" id="8452325">ok</span>&nbsp;<span class="op" id="8452328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452333">b</span><span class="op" id="8452334">.</span><span class="ident" id="8452335">Fatalf</span><span class="op" id="8452341">(</span><span class="string" id="8452342">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="8452363">,</span>&nbsp;<span class="ident" id="8452365">find</span><span class="op" id="8452369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452376">}</span><br>
<span class="lineno">320</span><span class="op" id="8452378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8452381">func</span>&nbsp;<span class="ident" id="8452386">BenchmarkUncommon</span><span class="op" id="8452403">(</span><span class="ident" id="8452404">b</span>&nbsp;<span class="op" id="8452406">*</span><span class="ident" id="8452407">testing</span><span class="op" id="8452414">.</span><span class="ident" id="8452415">B</span><span class="op" id="8452416">)</span>&nbsp;<span class="op" id="8452418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452421">b</span><span class="op" id="8452422">.</span><span class="ident" id="8452423">ReportAllocs</span><span class="op" id="8452435">(</span><span class="op" id="8452436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452439">var</span>&nbsp;<span class="ident" id="8452443">buf</span>&nbsp;<span class="ident" id="8452447">bytes</span><span class="op" id="8452452">.</span><span class="ident" id="8452453">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452461">br</span>&nbsp;<span class="op" id="8452464">:=</span>&nbsp;<span class="ident" id="8452467">bufio</span><span class="op" id="8452472">.</span><span class="ident" id="8452473">NewReader</span><span class="op" id="8452482">(</span><span class="op" id="8452483">&amp;</span><span class="ident" id="8452484">buf</span><span class="op" id="8452487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452490">r</span>&nbsp;<span class="op" id="8452492">:=</span>&nbsp;<span class="ident" id="8452495">NewReader</span><span class="op" id="8452504">(</span><span class="ident" id="8452505">br</span><span class="op" id="8452507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452510">for</span>&nbsp;<span class="ident" id="8452514">i</span>&nbsp;<span class="op" id="8452516">:=</span>&nbsp;<span class="num" id="8452519">0</span><span class="op" id="8452520">;</span>&nbsp;<span class="ident" id="8452522">i</span>&nbsp;<span class="op" id="8452524">&lt;</span>&nbsp;<span class="ident" id="8452526">b</span><span class="op" id="8452527">.</span><span class="ident" id="8452528">N</span><span class="op" id="8452529">;</span>&nbsp;<span class="ident" id="8452531">i</span><span class="op" id="8452532">++</span>&nbsp;<span class="op" id="8452535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452539">buf</span><span class="op" id="8452542">.</span><span class="ident" id="8452543">WriteString</span><span class="op" id="8452554">(</span><span class="string" id="8452555">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="8452599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452603">h</span><span class="op" id="8452604">,</span>&nbsp;<span class="ident" id="8452606">err</span>&nbsp;<span class="op" id="8452610">:=</span>&nbsp;<span class="ident" id="8452613">r</span><span class="op" id="8452614">.</span><span class="ident" id="8452615">ReadMIMEHeader</span><span class="op" id="8452629">(</span><span class="op" id="8452630">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452634">if</span>&nbsp;<span class="ident" id="8452637">err</span>&nbsp;<span class="op" id="8452641">!=</span>&nbsp;<span class="ident" id="8452644">nil</span>&nbsp;<span class="op" id="8452648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452653">b</span><span class="op" id="8452654">.</span><span class="ident" id="8452655">Fatal</span><span class="op" id="8452660">(</span><span class="ident" id="8452661">err</span><span class="op" id="8452664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8452672">if</span>&nbsp;<span class="ident" id="8452675">_</span><span class="op" id="8452676">,</span>&nbsp;<span class="ident" id="8452678">ok</span>&nbsp;<span class="op" id="8452681">:=</span>&nbsp;<span class="ident" id="8452684">h</span><span class="op" id="8452685">[</span><span class="string" id="8452686">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="8452717">]</span><span class="op" id="8452718">;</span>&nbsp;<span class="op" id="8452720">!</span><span class="ident" id="8452721">ok</span>&nbsp;<span class="op" id="8452724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8452729">b</span><span class="op" id="8452730">.</span><span class="ident" id="8452731">Fatal</span><span class="op" id="8452736">(</span><span class="string" id="8452737">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="8452761">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8452768">}</span><br>
<span class="lineno"></span><span class="op" id="8452770">}</span>
</div>
</body>
</html>
