<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2185152">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2185207">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2185261">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2185312">package</span>&nbsp;<span class="ident" id="2185320">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2185327">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2185371">import</span>&nbsp;<span class="op" id="2185378">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2185381">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2185391">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2185397">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2185412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2185415">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="2185492">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="2185554">type</span>&nbsp;<span class="ident" id="2185559">Buffer</span>&nbsp;<span class="keyword" id="2185566">struct</span>&nbsp;<span class="op" id="2185573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185576">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2185586">[</span><span class="op" id="2185587">]</span><span class="builtintype" id="2185588">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2185604">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185651">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2185661">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2185679">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185726">runeBytes</span>&nbsp;<span class="op" id="2185736">[</span><span class="ident" id="2185737">utf8</span><span class="op" id="2185741">.</span><span class="ident" id="2185742">UTFMax</span><span class="op" id="2185748">]</span><span class="builtintype" id="2185749">byte</span>&nbsp;<span class="comment" id="2185754">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185810">bootstrap</span>&nbsp;<span class="op" id="2185820">[</span><span class="num" id="2185821">64</span><span class="op" id="2185823">]</span><span class="builtintype" id="2185824">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2185838">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2185917">lastRead</span>&nbsp;&nbsp;<span class="ident" id="2185927">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2185945">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="2186005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2186008">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2186070">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2186123">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="2186151">type</span>&nbsp;<span class="ident" id="2186156">readOp</span>&nbsp;<span class="builtintype" id="2186163">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="2186168">const</span>&nbsp;<span class="op" id="2186174">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186177">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="2186188">readOp</span>&nbsp;<span class="op" id="2186195">=</span>&nbsp;<span class="ident" id="2186197">iota</span>&nbsp;<span class="comment" id="2186202">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186226">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2186251">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186266">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2186291">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="2186320">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2186323">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2186414">var</span>&nbsp;<span class="ident" id="2186418">ErrTooLarge</span>&nbsp;<span class="op" id="2186430">=</span>&nbsp;<span class="ident" id="2186432">errors</span><span class="op" id="2186438">.</span><span class="ident" id="2186439">New</span><span class="op" id="2186442">(</span><span class="string" id="2186443">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="2186468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2186471">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="2186549">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2186622">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2186695">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2186745">func</span>&nbsp;<span class="op" id="2186750">(</span><span class="ident" id="2186751">b</span>&nbsp;<span class="op" id="2186753">*</span><span class="ident" id="2186754">Buffer</span><span class="op" id="2186760">)</span>&nbsp;<span class="ident" id="2186762">Bytes</span><span class="op" id="2186767">(</span><span class="op" id="2186768">)</span>&nbsp;<span class="op" id="2186770">[</span><span class="op" id="2186771">]</span><span class="builtintype" id="2186772">byte</span>&nbsp;<span class="op" id="2186777">{</span>&nbsp;<span class="keyword" id="2186779">return</span>&nbsp;<span class="ident" id="2186786">b</span><span class="op" id="2186787">.</span><span class="ident" id="2186788">buf</span><span class="op" id="2186791">[</span><span class="ident" id="2186792">b</span><span class="op" id="2186793">.</span><span class="ident" id="2186794">off</span><span class="op" id="2186797">:</span><span class="op" id="2186798">]</span>&nbsp;<span class="op" id="2186800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2186803">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2186870">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2186939">func</span>&nbsp;<span class="op" id="2186944">(</span><span class="ident" id="2186945">b</span>&nbsp;<span class="op" id="2186947">*</span><span class="ident" id="2186948">Buffer</span><span class="op" id="2186954">)</span>&nbsp;<span class="ident" id="2186956">String</span><span class="op" id="2186962">(</span><span class="op" id="2186963">)</span>&nbsp;<span class="builtintype" id="2186965">string</span>&nbsp;<span class="op" id="2186972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186975">if</span>&nbsp;<span class="ident" id="2186978">b</span>&nbsp;<span class="op" id="2186980">==</span>&nbsp;<span class="ident" id="2186983">nil</span>&nbsp;<span class="op" id="2186987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186991">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187031">return</span>&nbsp;<span class="string" id="2187038">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187050">return</span>&nbsp;<span class="builtintype" id="2187057">string</span><span class="op" id="2187063">(</span><span class="ident" id="2187064">b</span><span class="op" id="2187065">.</span><span class="ident" id="2187066">buf</span><span class="op" id="2187069">[</span><span class="ident" id="2187070">b</span><span class="op" id="2187071">.</span><span class="ident" id="2187072">off</span><span class="op" id="2187075">:</span><span class="op" id="2187076">]</span><span class="op" id="2187077">)</span><br>
<span class="lineno"></span><span class="op" id="2187079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2187082">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="2187154">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="2187184">func</span>&nbsp;<span class="op" id="2187189">(</span><span class="ident" id="2187190">b</span>&nbsp;<span class="op" id="2187192">*</span><span class="ident" id="2187193">Buffer</span><span class="op" id="2187199">)</span>&nbsp;<span class="ident" id="2187201">Len</span><span class="op" id="2187204">(</span><span class="op" id="2187205">)</span>&nbsp;<span class="builtintype" id="2187207">int</span>&nbsp;<span class="op" id="2187211">{</span>&nbsp;<span class="keyword" id="2187213">return</span>&nbsp;<span class="builtinfunc" id="2187220">len</span><span class="op" id="2187223">(</span><span class="ident" id="2187224">b</span><span class="op" id="2187225">.</span><span class="ident" id="2187226">buf</span><span class="op" id="2187229">)</span>&nbsp;<span class="op" id="2187231">-</span>&nbsp;<span class="ident" id="2187233">b</span><span class="op" id="2187234">.</span><span class="ident" id="2187235">off</span>&nbsp;<span class="op" id="2187239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187242">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="2187313">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2187385">func</span>&nbsp;<span class="op" id="2187390">(</span><span class="ident" id="2187391">b</span>&nbsp;<span class="op" id="2187393">*</span><span class="ident" id="2187394">Buffer</span><span class="op" id="2187400">)</span>&nbsp;<span class="ident" id="2187402">Truncate</span><span class="op" id="2187410">(</span><span class="ident" id="2187411">n</span>&nbsp;<span class="builtintype" id="2187413">int</span><span class="op" id="2187416">)</span>&nbsp;<span class="op" id="2187418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187421">b</span><span class="op" id="2187422">.</span><span class="ident" id="2187423">lastRead</span>&nbsp;<span class="op" id="2187432">=</span>&nbsp;<span class="ident" id="2187434">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187445">switch</span>&nbsp;<span class="op" id="2187452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187455">case</span>&nbsp;<span class="ident" id="2187460">n</span>&nbsp;<span class="op" id="2187462">&lt;</span>&nbsp;<span class="num" id="2187464">0</span>&nbsp;<span class="op" id="2187466">||</span>&nbsp;<span class="ident" id="2187469">n</span>&nbsp;<span class="op" id="2187471">&gt;</span>&nbsp;<span class="ident" id="2187473">b</span><span class="op" id="2187474">.</span><span class="ident" id="2187475">Len</span><span class="op" id="2187478">(</span><span class="op" id="2187479">)</span><span class="op" id="2187480">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2187484">panic</span><span class="op" id="2187489">(</span><span class="string" id="2187490">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2187529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187532">case</span>&nbsp;<span class="ident" id="2187537">n</span>&nbsp;<span class="op" id="2187539">==</span>&nbsp;<span class="num" id="2187542">0</span><span class="op" id="2187543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2187547">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187572">b</span><span class="op" id="2187573">.</span><span class="ident" id="2187574">off</span>&nbsp;<span class="op" id="2187578">=</span>&nbsp;<span class="num" id="2187580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187583">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187586">b</span><span class="op" id="2187587">.</span><span class="ident" id="2187588">buf</span>&nbsp;<span class="op" id="2187592">=</span>&nbsp;<span class="ident" id="2187594">b</span><span class="op" id="2187595">.</span><span class="ident" id="2187596">buf</span><span class="op" id="2187599">[</span><span class="num" id="2187600">0</span>&nbsp;<span class="op" id="2187602">:</span>&nbsp;<span class="ident" id="2187604">b</span><span class="op" id="2187605">.</span><span class="ident" id="2187606">off</span><span class="op" id="2187609">+</span><span class="ident" id="2187610">n</span><span class="op" id="2187611">]</span><br>
<span class="lineno"></span><span class="op" id="2187613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187616">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="2187665">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="2187708">func</span>&nbsp;<span class="op" id="2187713">(</span><span class="ident" id="2187714">b</span>&nbsp;<span class="op" id="2187716">*</span><span class="ident" id="2187717">Buffer</span><span class="op" id="2187723">)</span>&nbsp;<span class="ident" id="2187725">Reset</span><span class="op" id="2187730">(</span><span class="op" id="2187731">)</span>&nbsp;<span class="op" id="2187733">{</span>&nbsp;<span class="ident" id="2187735">b</span><span class="op" id="2187736">.</span><span class="ident" id="2187737">Truncate</span><span class="op" id="2187745">(</span><span class="num" id="2187746">0</span><span class="op" id="2187747">)</span>&nbsp;<span class="op" id="2187749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187752">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2187814">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2187869">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="2187929">func</span>&nbsp;<span class="op" id="2187934">(</span><span class="ident" id="2187935">b</span>&nbsp;<span class="op" id="2187937">*</span><span class="ident" id="2187938">Buffer</span><span class="op" id="2187944">)</span>&nbsp;<span class="ident" id="2187946">grow</span><span class="op" id="2187950">(</span><span class="ident" id="2187951">n</span>&nbsp;<span class="builtintype" id="2187953">int</span><span class="op" id="2187956">)</span>&nbsp;<span class="builtintype" id="2187958">int</span>&nbsp;<span class="op" id="2187962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187965">m</span>&nbsp;<span class="op" id="2187967">:=</span>&nbsp;<span class="ident" id="2187970">b</span><span class="op" id="2187971">.</span><span class="ident" id="2187972">Len</span><span class="op" id="2187975">(</span><span class="op" id="2187976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2187979">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188027">if</span>&nbsp;<span class="ident" id="2188030">m</span>&nbsp;<span class="op" id="2188032">==</span>&nbsp;<span class="num" id="2188035">0</span>&nbsp;<span class="op" id="2188037">&amp;&amp;</span>&nbsp;<span class="ident" id="2188040">b</span><span class="op" id="2188041">.</span><span class="ident" id="2188042">off</span>&nbsp;<span class="op" id="2188046">!=</span>&nbsp;<span class="num" id="2188049">0</span>&nbsp;<span class="op" id="2188051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188055">b</span><span class="op" id="2188056">.</span><span class="ident" id="2188057">Truncate</span><span class="op" id="2188065">(</span><span class="num" id="2188066">0</span><span class="op" id="2188067">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2188070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188073">if</span>&nbsp;<span class="builtinfunc" id="2188076">len</span><span class="op" id="2188079">(</span><span class="ident" id="2188080">b</span><span class="op" id="2188081">.</span><span class="ident" id="2188082">buf</span><span class="op" id="2188085">)</span><span class="op" id="2188086">+</span><span class="ident" id="2188087">n</span>&nbsp;<span class="op" id="2188089">&gt;</span>&nbsp;<span class="builtinfunc" id="2188091">cap</span><span class="op" id="2188094">(</span><span class="ident" id="2188095">b</span><span class="op" id="2188096">.</span><span class="ident" id="2188097">buf</span><span class="op" id="2188100">)</span>&nbsp;<span class="op" id="2188102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188106">var</span>&nbsp;<span class="ident" id="2188110">buf</span>&nbsp;<span class="op" id="2188114">[</span><span class="op" id="2188115">]</span><span class="builtintype" id="2188116">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188123">if</span>&nbsp;<span class="ident" id="2188126">b</span><span class="op" id="2188127">.</span><span class="ident" id="2188128">buf</span>&nbsp;<span class="op" id="2188132">==</span>&nbsp;<span class="ident" id="2188135">nil</span>&nbsp;<span class="op" id="2188139">&amp;&amp;</span>&nbsp;<span class="ident" id="2188142">n</span>&nbsp;<span class="op" id="2188144">&lt;=</span>&nbsp;<span class="builtinfunc" id="2188147">len</span><span class="op" id="2188150">(</span><span class="ident" id="2188151">b</span><span class="op" id="2188152">.</span><span class="ident" id="2188153">bootstrap</span><span class="op" id="2188162">)</span>&nbsp;<span class="op" id="2188164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188169">buf</span>&nbsp;<span class="op" id="2188173">=</span>&nbsp;<span class="ident" id="2188175">b</span><span class="op" id="2188176">.</span><span class="ident" id="2188177">bootstrap</span><span class="op" id="2188186">[</span><span class="num" id="2188187">0</span><span class="op" id="2188188">:</span><span class="op" id="2188189">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2188193">}</span>&nbsp;<span class="keyword" id="2188195">else</span>&nbsp;<span class="keyword" id="2188200">if</span>&nbsp;<span class="ident" id="2188203">m</span><span class="op" id="2188204">+</span><span class="ident" id="2188205">n</span>&nbsp;<span class="op" id="2188207">&lt;=</span>&nbsp;<span class="builtinfunc" id="2188210">cap</span><span class="op" id="2188213">(</span><span class="ident" id="2188214">b</span><span class="op" id="2188215">.</span><span class="ident" id="2188216">buf</span><span class="op" id="2188219">)</span><span class="op" id="2188220">/</span><span class="num" id="2188221">2</span>&nbsp;<span class="op" id="2188223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2188228">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2188287">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2188345">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2188400">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2188440">copy</span><span class="op" id="2188444">(</span><span class="ident" id="2188445">b</span><span class="op" id="2188446">.</span><span class="ident" id="2188447">buf</span><span class="op" id="2188450">[</span><span class="op" id="2188451">:</span><span class="op" id="2188452">]</span><span class="op" id="2188453">,</span>&nbsp;<span class="ident" id="2188455">b</span><span class="op" id="2188456">.</span><span class="ident" id="2188457">buf</span><span class="op" id="2188460">[</span><span class="ident" id="2188461">b</span><span class="op" id="2188462">.</span><span class="ident" id="2188463">off</span><span class="op" id="2188466">:</span><span class="op" id="2188467">]</span><span class="op" id="2188468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188473">buf</span>&nbsp;<span class="op" id="2188477">=</span>&nbsp;<span class="ident" id="2188479">b</span><span class="op" id="2188480">.</span><span class="ident" id="2188481">buf</span><span class="op" id="2188484">[</span><span class="op" id="2188485">:</span><span class="ident" id="2188486">m</span><span class="op" id="2188487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2188491">}</span>&nbsp;<span class="keyword" id="2188493">else</span>&nbsp;<span class="op" id="2188498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2188503">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188535">buf</span>&nbsp;<span class="op" id="2188539">=</span>&nbsp;<span class="ident" id="2188541">makeSlice</span><span class="op" id="2188550">(</span><span class="num" id="2188551">2</span><span class="op" id="2188552">*</span><span class="builtinfunc" id="2188553">cap</span><span class="op" id="2188556">(</span><span class="ident" id="2188557">b</span><span class="op" id="2188558">.</span><span class="ident" id="2188559">buf</span><span class="op" id="2188562">)</span>&nbsp;<span class="op" id="2188564">+</span>&nbsp;<span class="ident" id="2188566">n</span><span class="op" id="2188567">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2188572">copy</span><span class="op" id="2188576">(</span><span class="ident" id="2188577">buf</span><span class="op" id="2188580">,</span>&nbsp;<span class="ident" id="2188582">b</span><span class="op" id="2188583">.</span><span class="ident" id="2188584">buf</span><span class="op" id="2188587">[</span><span class="ident" id="2188588">b</span><span class="op" id="2188589">.</span><span class="ident" id="2188590">off</span><span class="op" id="2188593">:</span><span class="op" id="2188594">]</span><span class="op" id="2188595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2188599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188603">b</span><span class="op" id="2188604">.</span><span class="ident" id="2188605">buf</span>&nbsp;<span class="op" id="2188609">=</span>&nbsp;<span class="ident" id="2188611">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188617">b</span><span class="op" id="2188618">.</span><span class="ident" id="2188619">off</span>&nbsp;<span class="op" id="2188623">=</span>&nbsp;<span class="num" id="2188625">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2188628">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2188631">b</span><span class="op" id="2188632">.</span><span class="ident" id="2188633">buf</span>&nbsp;<span class="op" id="2188637">=</span>&nbsp;<span class="ident" id="2188639">b</span><span class="op" id="2188640">.</span><span class="ident" id="2188641">buf</span><span class="op" id="2188644">[</span><span class="num" id="2188645">0</span>&nbsp;<span class="op" id="2188647">:</span>&nbsp;<span class="ident" id="2188649">b</span><span class="op" id="2188650">.</span><span class="ident" id="2188651">off</span><span class="op" id="2188654">+</span><span class="ident" id="2188655">m</span><span class="op" id="2188656">+</span><span class="ident" id="2188657">n</span><span class="op" id="2188658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188661">return</span>&nbsp;<span class="ident" id="2188668">b</span><span class="op" id="2188669">.</span><span class="ident" id="2188670">off</span>&nbsp;<span class="op" id="2188674">+</span>&nbsp;<span class="ident" id="2188676">m</span><br>
<span class="lineno"></span><span class="op" id="2188678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2188681">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="2188755">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2188829">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="2188867">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="2188905">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2188965">func</span>&nbsp;<span class="op" id="2188970">(</span><span class="ident" id="2188971">b</span>&nbsp;<span class="op" id="2188973">*</span><span class="ident" id="2188974">Buffer</span><span class="op" id="2188980">)</span>&nbsp;<span class="ident" id="2188982">Grow</span><span class="op" id="2188986">(</span><span class="ident" id="2188987">n</span>&nbsp;<span class="builtintype" id="2188989">int</span><span class="op" id="2188992">)</span>&nbsp;<span class="op" id="2188994">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2188997">if</span>&nbsp;<span class="ident" id="2189000">n</span>&nbsp;<span class="op" id="2189002">&lt;</span>&nbsp;<span class="num" id="2189004">0</span>&nbsp;<span class="op" id="2189006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2189010">panic</span><span class="op" id="2189015">(</span><span class="string" id="2189016">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2189051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2189054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189057">m</span>&nbsp;<span class="op" id="2189059">:=</span>&nbsp;<span class="ident" id="2189062">b</span><span class="op" id="2189063">.</span><span class="ident" id="2189064">grow</span><span class="op" id="2189068">(</span><span class="ident" id="2189069">n</span><span class="op" id="2189070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189073">b</span><span class="op" id="2189074">.</span><span class="ident" id="2189075">buf</span>&nbsp;<span class="op" id="2189079">=</span>&nbsp;<span class="ident" id="2189081">b</span><span class="op" id="2189082">.</span><span class="ident" id="2189083">buf</span><span class="op" id="2189086">[</span><span class="num" id="2189087">0</span><span class="op" id="2189088">:</span><span class="ident" id="2189089">m</span><span class="op" id="2189090">]</span><br>
<span class="lineno">120</span><span class="op" id="2189092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2189095">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2189167">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2189243">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="2189307">func</span>&nbsp;<span class="op" id="2189312">(</span><span class="ident" id="2189313">b</span>&nbsp;<span class="op" id="2189315">*</span><span class="ident" id="2189316">Buffer</span><span class="op" id="2189322">)</span>&nbsp;<span class="ident" id="2189324">Write</span><span class="op" id="2189329">(</span><span class="ident" id="2189330">p</span>&nbsp;<span class="op" id="2189332">[</span><span class="op" id="2189333">]</span><span class="builtintype" id="2189334">byte</span><span class="op" id="2189338">)</span>&nbsp;<span class="op" id="2189340">(</span><span class="ident" id="2189341">n</span>&nbsp;<span class="builtintype" id="2189343">int</span><span class="op" id="2189346">,</span>&nbsp;<span class="ident" id="2189348">err</span>&nbsp;<span class="builtintype" id="2189352">error</span><span class="op" id="2189357">)</span>&nbsp;<span class="op" id="2189359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189362">b</span><span class="op" id="2189363">.</span><span class="ident" id="2189364">lastRead</span>&nbsp;<span class="op" id="2189373">=</span>&nbsp;<span class="ident" id="2189375">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189386">m</span>&nbsp;<span class="op" id="2189388">:=</span>&nbsp;<span class="ident" id="2189391">b</span><span class="op" id="2189392">.</span><span class="ident" id="2189393">grow</span><span class="op" id="2189397">(</span><span class="builtinfunc" id="2189398">len</span><span class="op" id="2189401">(</span><span class="ident" id="2189402">p</span><span class="op" id="2189403">)</span><span class="op" id="2189404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189407">return</span>&nbsp;<span class="builtinfunc" id="2189414">copy</span><span class="op" id="2189418">(</span><span class="ident" id="2189419">b</span><span class="op" id="2189420">.</span><span class="ident" id="2189421">buf</span><span class="op" id="2189424">[</span><span class="ident" id="2189425">m</span><span class="op" id="2189426">:</span><span class="op" id="2189427">]</span><span class="op" id="2189428">,</span>&nbsp;<span class="ident" id="2189430">p</span><span class="op" id="2189431">)</span><span class="op" id="2189432">,</span>&nbsp;<span class="ident" id="2189434">nil</span><br>
<span class="lineno"></span><span class="op" id="2189438">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="2189441">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2189519">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2189595">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2189665">func</span>&nbsp;<span class="op" id="2189670">(</span><span class="ident" id="2189671">b</span>&nbsp;<span class="op" id="2189673">*</span><span class="ident" id="2189674">Buffer</span><span class="op" id="2189680">)</span>&nbsp;<span class="ident" id="2189682">WriteString</span><span class="op" id="2189693">(</span><span class="ident" id="2189694">s</span>&nbsp;<span class="builtintype" id="2189696">string</span><span class="op" id="2189702">)</span>&nbsp;<span class="op" id="2189704">(</span><span class="ident" id="2189705">n</span>&nbsp;<span class="builtintype" id="2189707">int</span><span class="op" id="2189710">,</span>&nbsp;<span class="ident" id="2189712">err</span>&nbsp;<span class="builtintype" id="2189716">error</span><span class="op" id="2189721">)</span>&nbsp;<span class="op" id="2189723">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189726">b</span><span class="op" id="2189727">.</span><span class="ident" id="2189728">lastRead</span>&nbsp;<span class="op" id="2189737">=</span>&nbsp;<span class="ident" id="2189739">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2189750">m</span>&nbsp;<span class="op" id="2189752">:=</span>&nbsp;<span class="ident" id="2189755">b</span><span class="op" id="2189756">.</span><span class="ident" id="2189757">grow</span><span class="op" id="2189761">(</span><span class="builtinfunc" id="2189762">len</span><span class="op" id="2189765">(</span><span class="ident" id="2189766">s</span><span class="op" id="2189767">)</span><span class="op" id="2189768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2189771">return</span>&nbsp;<span class="builtinfunc" id="2189778">copy</span><span class="op" id="2189782">(</span><span class="ident" id="2189783">b</span><span class="op" id="2189784">.</span><span class="ident" id="2189785">buf</span><span class="op" id="2189788">[</span><span class="ident" id="2189789">m</span><span class="op" id="2189790">:</span><span class="op" id="2189791">]</span><span class="op" id="2189792">,</span>&nbsp;<span class="ident" id="2189794">s</span><span class="op" id="2189795">)</span><span class="op" id="2189796">,</span>&nbsp;<span class="ident" id="2189798">nil</span><br>
<span class="lineno"></span><span class="op" id="2189802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2189805">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2189867">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="2189944">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2190018">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2190040">const</span>&nbsp;<span class="ident" id="2190046">MinRead</span>&nbsp;<span class="op" id="2190054">=</span>&nbsp;<span class="num" id="2190056">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2190061">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="2190139">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="2190216">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2190292">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="2190359">func</span>&nbsp;<span class="op" id="2190364">(</span><span class="ident" id="2190365">b</span>&nbsp;<span class="op" id="2190367">*</span><span class="ident" id="2190368">Buffer</span><span class="op" id="2190374">)</span>&nbsp;<span class="ident" id="2190376">ReadFrom</span><span class="op" id="2190384">(</span><span class="ident" id="2190385">r</span>&nbsp;<span class="ident" id="2190387">io</span><span class="op" id="2190389">.</span><span class="ident" id="2190390">Reader</span><span class="op" id="2190396">)</span>&nbsp;<span class="op" id="2190398">(</span><span class="ident" id="2190399">n</span>&nbsp;<span class="ident" id="2190401">int64</span><span class="op" id="2190406">,</span>&nbsp;<span class="ident" id="2190408">err</span>&nbsp;<span class="builtintype" id="2190412">error</span><span class="op" id="2190417">)</span>&nbsp;<span class="op" id="2190419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190422">b</span><span class="op" id="2190423">.</span><span class="ident" id="2190424">lastRead</span>&nbsp;<span class="op" id="2190433">=</span>&nbsp;<span class="ident" id="2190435">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190446">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190494">if</span>&nbsp;<span class="ident" id="2190497">b</span><span class="op" id="2190498">.</span><span class="ident" id="2190499">off</span>&nbsp;<span class="op" id="2190503">&gt;=</span>&nbsp;<span class="builtinfunc" id="2190506">len</span><span class="op" id="2190509">(</span><span class="ident" id="2190510">b</span><span class="op" id="2190511">.</span><span class="ident" id="2190512">buf</span><span class="op" id="2190515">)</span>&nbsp;<span class="op" id="2190517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190521">b</span><span class="op" id="2190522">.</span><span class="ident" id="2190523">Truncate</span><span class="op" id="2190531">(</span><span class="num" id="2190532">0</span><span class="op" id="2190533">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190539">for</span>&nbsp;<span class="op" id="2190543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190547">if</span>&nbsp;<span class="ident" id="2190550">free</span>&nbsp;<span class="op" id="2190555">:=</span>&nbsp;<span class="builtinfunc" id="2190558">cap</span><span class="op" id="2190561">(</span><span class="ident" id="2190562">b</span><span class="op" id="2190563">.</span><span class="ident" id="2190564">buf</span><span class="op" id="2190567">)</span>&nbsp;<span class="op" id="2190569">-</span>&nbsp;<span class="builtinfunc" id="2190571">len</span><span class="op" id="2190574">(</span><span class="ident" id="2190575">b</span><span class="op" id="2190576">.</span><span class="ident" id="2190577">buf</span><span class="op" id="2190580">)</span><span class="op" id="2190581">;</span>&nbsp;<span class="ident" id="2190583">free</span>&nbsp;<span class="op" id="2190588">&lt;</span>&nbsp;<span class="ident" id="2190590">MinRead</span>&nbsp;<span class="op" id="2190598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190603">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190633">newBuf</span>&nbsp;<span class="op" id="2190640">:=</span>&nbsp;<span class="ident" id="2190643">b</span><span class="op" id="2190644">.</span><span class="ident" id="2190645">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190652">if</span>&nbsp;<span class="ident" id="2190655">b</span><span class="op" id="2190656">.</span><span class="ident" id="2190657">off</span><span class="op" id="2190660">+</span><span class="ident" id="2190661">free</span>&nbsp;<span class="op" id="2190666">&lt;</span>&nbsp;<span class="ident" id="2190668">MinRead</span>&nbsp;<span class="op" id="2190676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190682">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2190733">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190763">newBuf</span>&nbsp;<span class="op" id="2190770">=</span>&nbsp;<span class="ident" id="2190772">makeSlice</span><span class="op" id="2190781">(</span><span class="num" id="2190782">2</span><span class="op" id="2190783">*</span><span class="builtinfunc" id="2190784">cap</span><span class="op" id="2190787">(</span><span class="ident" id="2190788">b</span><span class="op" id="2190789">.</span><span class="ident" id="2190790">buf</span><span class="op" id="2190793">)</span>&nbsp;<span class="op" id="2190795">+</span>&nbsp;<span class="ident" id="2190797">MinRead</span><span class="op" id="2190804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190809">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2190814">copy</span><span class="op" id="2190818">(</span><span class="ident" id="2190819">newBuf</span><span class="op" id="2190825">,</span>&nbsp;<span class="ident" id="2190827">b</span><span class="op" id="2190828">.</span><span class="ident" id="2190829">buf</span><span class="op" id="2190832">[</span><span class="ident" id="2190833">b</span><span class="op" id="2190834">.</span><span class="ident" id="2190835">off</span><span class="op" id="2190838">:</span><span class="op" id="2190839">]</span><span class="op" id="2190840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190845">b</span><span class="op" id="2190846">.</span><span class="ident" id="2190847">buf</span>&nbsp;<span class="op" id="2190851">=</span>&nbsp;<span class="ident" id="2190853">newBuf</span><span class="op" id="2190859">[</span><span class="op" id="2190860">:</span><span class="builtinfunc" id="2190861">len</span><span class="op" id="2190864">(</span><span class="ident" id="2190865">b</span><span class="op" id="2190866">.</span><span class="ident" id="2190867">buf</span><span class="op" id="2190870">)</span><span class="op" id="2190871">-</span><span class="ident" id="2190872">b</span><span class="op" id="2190873">.</span><span class="ident" id="2190874">off</span><span class="op" id="2190877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190882">b</span><span class="op" id="2190883">.</span><span class="ident" id="2190884">off</span>&nbsp;<span class="op" id="2190888">=</span>&nbsp;<span class="num" id="2190890">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2190894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190898">m</span><span class="op" id="2190899">,</span>&nbsp;<span class="ident" id="2190901">e</span>&nbsp;<span class="op" id="2190903">:=</span>&nbsp;<span class="ident" id="2190906">r</span><span class="op" id="2190907">.</span><span class="ident" id="2190908">Read</span><span class="op" id="2190912">(</span><span class="ident" id="2190913">b</span><span class="op" id="2190914">.</span><span class="ident" id="2190915">buf</span><span class="op" id="2190918">[</span><span class="builtinfunc" id="2190919">len</span><span class="op" id="2190922">(</span><span class="ident" id="2190923">b</span><span class="op" id="2190924">.</span><span class="ident" id="2190925">buf</span><span class="op" id="2190928">)</span><span class="op" id="2190929">:</span><span class="builtinfunc" id="2190930">cap</span><span class="op" id="2190933">(</span><span class="ident" id="2190934">b</span><span class="op" id="2190935">.</span><span class="ident" id="2190936">buf</span><span class="op" id="2190939">)</span><span class="op" id="2190940">]</span><span class="op" id="2190941">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190945">b</span><span class="op" id="2190946">.</span><span class="ident" id="2190947">buf</span>&nbsp;<span class="op" id="2190951">=</span>&nbsp;<span class="ident" id="2190953">b</span><span class="op" id="2190954">.</span><span class="ident" id="2190955">buf</span><span class="op" id="2190958">[</span><span class="num" id="2190959">0</span>&nbsp;<span class="op" id="2190961">:</span>&nbsp;<span class="builtinfunc" id="2190963">len</span><span class="op" id="2190966">(</span><span class="ident" id="2190967">b</span><span class="op" id="2190968">.</span><span class="ident" id="2190969">buf</span><span class="op" id="2190972">)</span><span class="op" id="2190973">+</span><span class="ident" id="2190974">m</span><span class="op" id="2190975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2190979">n</span>&nbsp;<span class="op" id="2190981">+=</span>&nbsp;<span class="ident" id="2190984">int64</span><span class="op" id="2190989">(</span><span class="ident" id="2190990">m</span><span class="op" id="2190991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2190995">if</span>&nbsp;<span class="ident" id="2190998">e</span>&nbsp;<span class="op" id="2191000">==</span>&nbsp;<span class="ident" id="2191003">io</span><span class="op" id="2191005">.</span><span class="ident" id="2191006">EOF</span>&nbsp;<span class="op" id="2191010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191015">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191023">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191027">if</span>&nbsp;<span class="ident" id="2191030">e</span>&nbsp;<span class="op" id="2191032">!=</span>&nbsp;<span class="ident" id="2191035">nil</span>&nbsp;<span class="op" id="2191039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191044">return</span>&nbsp;<span class="ident" id="2191051">n</span><span class="op" id="2191052">,</span>&nbsp;<span class="ident" id="2191054">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191064">return</span>&nbsp;<span class="ident" id="2191071">n</span><span class="op" id="2191072">,</span>&nbsp;<span class="ident" id="2191074">nil</span>&nbsp;<span class="comment" id="2191078">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="2191118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2191121">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="2191198">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2191219">func</span>&nbsp;<span class="ident" id="2191224">makeSlice</span><span class="op" id="2191233">(</span><span class="ident" id="2191234">n</span>&nbsp;<span class="builtintype" id="2191236">int</span><span class="op" id="2191239">)</span>&nbsp;<span class="op" id="2191241">[</span><span class="op" id="2191242">]</span><span class="builtintype" id="2191243">byte</span>&nbsp;<span class="op" id="2191248">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2191251">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191294">defer</span>&nbsp;<span class="keyword" id="2191300">func</span><span class="op" id="2191304">(</span><span class="op" id="2191305">)</span>&nbsp;<span class="op" id="2191307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191311">if</span>&nbsp;<span class="builtinfunc" id="2191314">recover</span><span class="op" id="2191321">(</span><span class="op" id="2191322">)</span>&nbsp;<span class="op" id="2191324">!=</span>&nbsp;<span class="ident" id="2191327">nil</span>&nbsp;<span class="op" id="2191331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2191336">panic</span><span class="op" id="2191341">(</span><span class="ident" id="2191342">ErrTooLarge</span><span class="op" id="2191353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191357">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191360">}</span><span class="op" id="2191361">(</span><span class="op" id="2191362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191365">return</span>&nbsp;<span class="builtinfunc" id="2191372">make</span><span class="op" id="2191376">(</span><span class="op" id="2191377">[</span><span class="op" id="2191378">]</span><span class="builtintype" id="2191379">byte</span><span class="op" id="2191383">,</span>&nbsp;<span class="ident" id="2191385">n</span><span class="op" id="2191386">)</span><br>
<span class="lineno"></span><span class="op" id="2191388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2191391">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="2191467">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2191544">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2191614">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2191664">func</span>&nbsp;<span class="op" id="2191669">(</span><span class="ident" id="2191670">b</span>&nbsp;<span class="op" id="2191672">*</span><span class="ident" id="2191673">Buffer</span><span class="op" id="2191679">)</span>&nbsp;<span class="ident" id="2191681">WriteTo</span><span class="op" id="2191688">(</span><span class="ident" id="2191689">w</span>&nbsp;<span class="ident" id="2191691">io</span><span class="op" id="2191693">.</span><span class="ident" id="2191694">Writer</span><span class="op" id="2191700">)</span>&nbsp;<span class="op" id="2191702">(</span><span class="ident" id="2191703">n</span>&nbsp;<span class="ident" id="2191705">int64</span><span class="op" id="2191710">,</span>&nbsp;<span class="ident" id="2191712">err</span>&nbsp;<span class="builtintype" id="2191716">error</span><span class="op" id="2191721">)</span>&nbsp;<span class="op" id="2191723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191726">b</span><span class="op" id="2191727">.</span><span class="ident" id="2191728">lastRead</span>&nbsp;<span class="op" id="2191737">=</span>&nbsp;<span class="ident" id="2191739">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191750">if</span>&nbsp;<span class="ident" id="2191753">b</span><span class="op" id="2191754">.</span><span class="ident" id="2191755">off</span>&nbsp;<span class="op" id="2191759">&lt;</span>&nbsp;<span class="builtinfunc" id="2191761">len</span><span class="op" id="2191764">(</span><span class="ident" id="2191765">b</span><span class="op" id="2191766">.</span><span class="ident" id="2191767">buf</span><span class="op" id="2191770">)</span>&nbsp;<span class="op" id="2191772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191776">nBytes</span>&nbsp;<span class="op" id="2191783">:=</span>&nbsp;<span class="ident" id="2191786">b</span><span class="op" id="2191787">.</span><span class="ident" id="2191788">Len</span><span class="op" id="2191791">(</span><span class="op" id="2191792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191796">m</span><span class="op" id="2191797">,</span>&nbsp;<span class="ident" id="2191799">e</span>&nbsp;<span class="op" id="2191801">:=</span>&nbsp;<span class="ident" id="2191804">w</span><span class="op" id="2191805">.</span><span class="ident" id="2191806">Write</span><span class="op" id="2191811">(</span><span class="ident" id="2191812">b</span><span class="op" id="2191813">.</span><span class="ident" id="2191814">buf</span><span class="op" id="2191817">[</span><span class="ident" id="2191818">b</span><span class="op" id="2191819">.</span><span class="ident" id="2191820">off</span><span class="op" id="2191823">:</span><span class="op" id="2191824">]</span><span class="op" id="2191825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191829">if</span>&nbsp;<span class="ident" id="2191832">m</span>&nbsp;<span class="op" id="2191834">&gt;</span>&nbsp;<span class="ident" id="2191836">nBytes</span>&nbsp;<span class="op" id="2191843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2191848">panic</span><span class="op" id="2191853">(</span><span class="string" id="2191854">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="2191897">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191905">b</span><span class="op" id="2191906">.</span><span class="ident" id="2191907">off</span>&nbsp;<span class="op" id="2191911">+=</span>&nbsp;<span class="ident" id="2191914">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2191918">n</span>&nbsp;<span class="op" id="2191920">=</span>&nbsp;<span class="ident" id="2191922">int64</span><span class="op" id="2191927">(</span><span class="ident" id="2191928">m</span><span class="op" id="2191929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191933">if</span>&nbsp;<span class="ident" id="2191936">e</span>&nbsp;<span class="op" id="2191938">!=</span>&nbsp;<span class="ident" id="2191941">nil</span>&nbsp;<span class="op" id="2191945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2191950">return</span>&nbsp;<span class="ident" id="2191957">n</span><span class="op" id="2191958">,</span>&nbsp;<span class="ident" id="2191960">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2191964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2191968">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2192026">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192057">if</span>&nbsp;<span class="ident" id="2192060">m</span>&nbsp;<span class="op" id="2192062">!=</span>&nbsp;<span class="ident" id="2192065">nBytes</span>&nbsp;<span class="op" id="2192072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192077">return</span>&nbsp;<span class="ident" id="2192084">n</span><span class="op" id="2192085">,</span>&nbsp;<span class="ident" id="2192087">io</span><span class="op" id="2192089">.</span><span class="ident" id="2192090">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2192112">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192144">b</span><span class="op" id="2192145">.</span><span class="ident" id="2192146">Truncate</span><span class="op" id="2192154">(</span><span class="num" id="2192155">0</span><span class="op" id="2192156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192159">return</span><br>
<span class="lineno">220</span><span class="op" id="2192166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2192169">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="2192246">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2192323">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="2192396">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2192412">func</span>&nbsp;<span class="op" id="2192417">(</span><span class="ident" id="2192418">b</span>&nbsp;<span class="op" id="2192420">*</span><span class="ident" id="2192421">Buffer</span><span class="op" id="2192427">)</span>&nbsp;<span class="ident" id="2192429">WriteByte</span><span class="op" id="2192438">(</span><span class="ident" id="2192439">c</span>&nbsp;<span class="builtintype" id="2192441">byte</span><span class="op" id="2192445">)</span>&nbsp;<span class="builtintype" id="2192447">error</span>&nbsp;<span class="op" id="2192453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192456">b</span><span class="op" id="2192457">.</span><span class="ident" id="2192458">lastRead</span>&nbsp;<span class="op" id="2192467">=</span>&nbsp;<span class="ident" id="2192469">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192480">m</span>&nbsp;<span class="op" id="2192482">:=</span>&nbsp;<span class="ident" id="2192485">b</span><span class="op" id="2192486">.</span><span class="ident" id="2192487">grow</span><span class="op" id="2192491">(</span><span class="num" id="2192492">1</span><span class="op" id="2192493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192496">b</span><span class="op" id="2192497">.</span><span class="ident" id="2192498">buf</span><span class="op" id="2192501">[</span><span class="ident" id="2192502">m</span><span class="op" id="2192503">]</span>&nbsp;<span class="op" id="2192505">=</span>&nbsp;<span class="ident" id="2192507">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192510">return</span>&nbsp;<span class="ident" id="2192517">nil</span><br>
<span class="lineno"></span><span class="op" id="2192521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2192524">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2192595">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="2192668">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="2192746">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2192813">func</span>&nbsp;<span class="op" id="2192818">(</span><span class="ident" id="2192819">b</span>&nbsp;<span class="op" id="2192821">*</span><span class="ident" id="2192822">Buffer</span><span class="op" id="2192828">)</span>&nbsp;<span class="ident" id="2192830">WriteRune</span><span class="op" id="2192839">(</span><span class="ident" id="2192840">r</span>&nbsp;<span class="builtintype" id="2192842">rune</span><span class="op" id="2192846">)</span>&nbsp;<span class="op" id="2192848">(</span><span class="ident" id="2192849">n</span>&nbsp;<span class="builtintype" id="2192851">int</span><span class="op" id="2192854">,</span>&nbsp;<span class="ident" id="2192856">err</span>&nbsp;<span class="builtintype" id="2192860">error</span><span class="op" id="2192865">)</span>&nbsp;<span class="op" id="2192867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192870">if</span>&nbsp;<span class="ident" id="2192873">r</span>&nbsp;<span class="op" id="2192875">&lt;</span>&nbsp;<span class="ident" id="2192877">utf8</span><span class="op" id="2192881">.</span><span class="ident" id="2192882">RuneSelf</span>&nbsp;<span class="op" id="2192891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192895">b</span><span class="op" id="2192896">.</span><span class="ident" id="2192897">WriteByte</span><span class="op" id="2192906">(</span><span class="builtintype" id="2192907">byte</span><span class="op" id="2192911">(</span><span class="ident" id="2192912">r</span><span class="op" id="2192913">)</span><span class="op" id="2192914">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2192918">return</span>&nbsp;<span class="num" id="2192925">1</span><span class="op" id="2192926">,</span>&nbsp;<span class="ident" id="2192928">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2192933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192936">n</span>&nbsp;<span class="op" id="2192938">=</span>&nbsp;<span class="ident" id="2192940">utf8</span><span class="op" id="2192944">.</span><span class="ident" id="2192945">EncodeRune</span><span class="op" id="2192955">(</span><span class="ident" id="2192956">b</span><span class="op" id="2192957">.</span><span class="ident" id="2192958">runeBytes</span><span class="op" id="2192967">[</span><span class="num" id="2192968">0</span><span class="op" id="2192969">:</span><span class="op" id="2192970">]</span><span class="op" id="2192971">,</span>&nbsp;<span class="ident" id="2192973">r</span><span class="op" id="2192974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2192977">b</span><span class="op" id="2192978">.</span><span class="ident" id="2192979">Write</span><span class="op" id="2192984">(</span><span class="ident" id="2192985">b</span><span class="op" id="2192986">.</span><span class="ident" id="2192987">runeBytes</span><span class="op" id="2192996">[</span><span class="num" id="2192997">0</span><span class="op" id="2192998">:</span><span class="ident" id="2192999">n</span><span class="op" id="2193000">]</span><span class="op" id="2193001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193004">return</span>&nbsp;<span class="ident" id="2193011">n</span><span class="op" id="2193012">,</span>&nbsp;<span class="ident" id="2193014">nil</span><br>
<span class="lineno">245</span><span class="op" id="2193018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2193021">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2193093">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2193165">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="2193237">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2193261">func</span>&nbsp;<span class="op" id="2193266">(</span><span class="ident" id="2193267">b</span>&nbsp;<span class="op" id="2193269">*</span><span class="ident" id="2193270">Buffer</span><span class="op" id="2193276">)</span>&nbsp;<span class="ident" id="2193278">Read</span><span class="op" id="2193282">(</span><span class="ident" id="2193283">p</span>&nbsp;<span class="op" id="2193285">[</span><span class="op" id="2193286">]</span><span class="builtintype" id="2193287">byte</span><span class="op" id="2193291">)</span>&nbsp;<span class="op" id="2193293">(</span><span class="ident" id="2193294">n</span>&nbsp;<span class="builtintype" id="2193296">int</span><span class="op" id="2193299">,</span>&nbsp;<span class="ident" id="2193301">err</span>&nbsp;<span class="builtintype" id="2193305">error</span><span class="op" id="2193310">)</span>&nbsp;<span class="op" id="2193312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193315">b</span><span class="op" id="2193316">.</span><span class="ident" id="2193317">lastRead</span>&nbsp;<span class="op" id="2193326">=</span>&nbsp;<span class="ident" id="2193328">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193339">if</span>&nbsp;<span class="ident" id="2193342">b</span><span class="op" id="2193343">.</span><span class="ident" id="2193344">off</span>&nbsp;<span class="op" id="2193348">&gt;=</span>&nbsp;<span class="builtinfunc" id="2193351">len</span><span class="op" id="2193354">(</span><span class="ident" id="2193355">b</span><span class="op" id="2193356">.</span><span class="ident" id="2193357">buf</span><span class="op" id="2193360">)</span>&nbsp;<span class="op" id="2193362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193366">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193412">b</span><span class="op" id="2193413">.</span><span class="ident" id="2193414">Truncate</span><span class="op" id="2193422">(</span><span class="num" id="2193423">0</span><span class="op" id="2193424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193428">if</span>&nbsp;<span class="builtinfunc" id="2193431">len</span><span class="op" id="2193434">(</span><span class="ident" id="2193435">p</span><span class="op" id="2193436">)</span>&nbsp;<span class="op" id="2193438">==</span>&nbsp;<span class="num" id="2193441">0</span>&nbsp;<span class="op" id="2193443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193448">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193461">return</span>&nbsp;<span class="num" id="2193468">0</span><span class="op" id="2193469">,</span>&nbsp;<span class="ident" id="2193471">io</span><span class="op" id="2193473">.</span><span class="ident" id="2193474">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193482">n</span>&nbsp;<span class="op" id="2193484">=</span>&nbsp;<span class="builtinfunc" id="2193486">copy</span><span class="op" id="2193490">(</span><span class="ident" id="2193491">p</span><span class="op" id="2193492">,</span>&nbsp;<span class="ident" id="2193494">b</span><span class="op" id="2193495">.</span><span class="ident" id="2193496">buf</span><span class="op" id="2193499">[</span><span class="ident" id="2193500">b</span><span class="op" id="2193501">.</span><span class="ident" id="2193502">off</span><span class="op" id="2193505">:</span><span class="op" id="2193506">]</span><span class="op" id="2193507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193510">b</span><span class="op" id="2193511">.</span><span class="ident" id="2193512">off</span>&nbsp;<span class="op" id="2193516">+=</span>&nbsp;<span class="ident" id="2193519">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193522">if</span>&nbsp;<span class="ident" id="2193525">n</span>&nbsp;<span class="op" id="2193527">&gt;</span>&nbsp;<span class="num" id="2193529">0</span>&nbsp;<span class="op" id="2193531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193535">b</span><span class="op" id="2193536">.</span><span class="ident" id="2193537">lastRead</span>&nbsp;<span class="op" id="2193546">=</span>&nbsp;<span class="ident" id="2193548">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193559">return</span><br>
<span class="lineno"></span><span class="op" id="2193566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2193569">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="2193638">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="2193705">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2193787">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2193861">func</span>&nbsp;<span class="op" id="2193866">(</span><span class="ident" id="2193867">b</span>&nbsp;<span class="op" id="2193869">*</span><span class="ident" id="2193870">Buffer</span><span class="op" id="2193876">)</span>&nbsp;<span class="ident" id="2193878">Next</span><span class="op" id="2193882">(</span><span class="ident" id="2193883">n</span>&nbsp;<span class="builtintype" id="2193885">int</span><span class="op" id="2193888">)</span>&nbsp;<span class="op" id="2193890">[</span><span class="op" id="2193891">]</span><span class="builtintype" id="2193892">byte</span>&nbsp;<span class="op" id="2193897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193900">b</span><span class="op" id="2193901">.</span><span class="ident" id="2193902">lastRead</span>&nbsp;<span class="op" id="2193911">=</span>&nbsp;<span class="ident" id="2193913">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193924">m</span>&nbsp;<span class="op" id="2193926">:=</span>&nbsp;<span class="ident" id="2193929">b</span><span class="op" id="2193930">.</span><span class="ident" id="2193931">Len</span><span class="op" id="2193934">(</span><span class="op" id="2193935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193938">if</span>&nbsp;<span class="ident" id="2193941">n</span>&nbsp;<span class="op" id="2193943">&gt;</span>&nbsp;<span class="ident" id="2193945">m</span>&nbsp;<span class="op" id="2193947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193951">n</span>&nbsp;<span class="op" id="2193953">=</span>&nbsp;<span class="ident" id="2193955">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2193958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193961">data</span>&nbsp;<span class="op" id="2193966">:=</span>&nbsp;<span class="ident" id="2193969">b</span><span class="op" id="2193970">.</span><span class="ident" id="2193971">buf</span><span class="op" id="2193974">[</span><span class="ident" id="2193975">b</span><span class="op" id="2193976">.</span><span class="ident" id="2193977">off</span>&nbsp;<span class="op" id="2193981">:</span>&nbsp;<span class="ident" id="2193983">b</span><span class="op" id="2193984">.</span><span class="ident" id="2193985">off</span><span class="op" id="2193988">+</span><span class="ident" id="2193989">n</span><span class="op" id="2193990">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193993">b</span><span class="op" id="2193994">.</span><span class="ident" id="2193995">off</span>&nbsp;<span class="op" id="2193999">+=</span>&nbsp;<span class="ident" id="2194002">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194005">if</span>&nbsp;<span class="ident" id="2194008">n</span>&nbsp;<span class="op" id="2194010">&gt;</span>&nbsp;<span class="num" id="2194012">0</span>&nbsp;<span class="op" id="2194014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194018">b</span><span class="op" id="2194019">.</span><span class="ident" id="2194020">lastRead</span>&nbsp;<span class="op" id="2194029">=</span>&nbsp;<span class="ident" id="2194031">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194042">return</span>&nbsp;<span class="ident" id="2194049">data</span><br>
<span class="lineno">285</span><span class="op" id="2194054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2194057">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2194118">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2194171">func</span>&nbsp;<span class="op" id="2194176">(</span><span class="ident" id="2194177">b</span>&nbsp;<span class="op" id="2194179">*</span><span class="ident" id="2194180">Buffer</span><span class="op" id="2194186">)</span>&nbsp;<span class="ident" id="2194188">ReadByte</span><span class="op" id="2194196">(</span><span class="op" id="2194197">)</span>&nbsp;<span class="op" id="2194199">(</span><span class="ident" id="2194200">c</span>&nbsp;<span class="builtintype" id="2194202">byte</span><span class="op" id="2194206">,</span>&nbsp;<span class="ident" id="2194208">err</span>&nbsp;<span class="builtintype" id="2194212">error</span><span class="op" id="2194217">)</span>&nbsp;<span class="op" id="2194219">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194222">b</span><span class="op" id="2194223">.</span><span class="ident" id="2194224">lastRead</span>&nbsp;<span class="op" id="2194233">=</span>&nbsp;<span class="ident" id="2194235">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194246">if</span>&nbsp;<span class="ident" id="2194249">b</span><span class="op" id="2194250">.</span><span class="ident" id="2194251">off</span>&nbsp;<span class="op" id="2194255">&gt;=</span>&nbsp;<span class="builtinfunc" id="2194258">len</span><span class="op" id="2194261">(</span><span class="ident" id="2194262">b</span><span class="op" id="2194263">.</span><span class="ident" id="2194264">buf</span><span class="op" id="2194267">)</span>&nbsp;<span class="op" id="2194269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194273">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194319">b</span><span class="op" id="2194320">.</span><span class="ident" id="2194321">Truncate</span><span class="op" id="2194329">(</span><span class="num" id="2194330">0</span><span class="op" id="2194331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194335">return</span>&nbsp;<span class="num" id="2194342">0</span><span class="op" id="2194343">,</span>&nbsp;<span class="ident" id="2194345">io</span><span class="op" id="2194347">.</span><span class="ident" id="2194348">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194356">c</span>&nbsp;<span class="op" id="2194358">=</span>&nbsp;<span class="ident" id="2194360">b</span><span class="op" id="2194361">.</span><span class="ident" id="2194362">buf</span><span class="op" id="2194365">[</span><span class="ident" id="2194366">b</span><span class="op" id="2194367">.</span><span class="ident" id="2194368">off</span><span class="op" id="2194371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194374">b</span><span class="op" id="2194375">.</span><span class="ident" id="2194376">off</span><span class="op" id="2194379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194383">b</span><span class="op" id="2194384">.</span><span class="ident" id="2194385">lastRead</span>&nbsp;<span class="op" id="2194394">=</span>&nbsp;<span class="ident" id="2194396">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194404">return</span>&nbsp;<span class="ident" id="2194411">c</span><span class="op" id="2194412">,</span>&nbsp;<span class="ident" id="2194414">nil</span><br>
<span class="lineno">300</span><span class="op" id="2194418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2194421">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="2194474">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2194513">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="2194573">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2194625">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="2194669">func</span>&nbsp;<span class="op" id="2194674">(</span><span class="ident" id="2194675">b</span>&nbsp;<span class="op" id="2194677">*</span><span class="ident" id="2194678">Buffer</span><span class="op" id="2194684">)</span>&nbsp;<span class="ident" id="2194686">ReadRune</span><span class="op" id="2194694">(</span><span class="op" id="2194695">)</span>&nbsp;<span class="op" id="2194697">(</span><span class="ident" id="2194698">r</span>&nbsp;<span class="builtintype" id="2194700">rune</span><span class="op" id="2194704">,</span>&nbsp;<span class="ident" id="2194706">size</span>&nbsp;<span class="builtintype" id="2194711">int</span><span class="op" id="2194714">,</span>&nbsp;<span class="ident" id="2194716">err</span>&nbsp;<span class="builtintype" id="2194720">error</span><span class="op" id="2194725">)</span>&nbsp;<span class="op" id="2194727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194730">b</span><span class="op" id="2194731">.</span><span class="ident" id="2194732">lastRead</span>&nbsp;<span class="op" id="2194741">=</span>&nbsp;<span class="ident" id="2194743">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194754">if</span>&nbsp;<span class="ident" id="2194757">b</span><span class="op" id="2194758">.</span><span class="ident" id="2194759">off</span>&nbsp;<span class="op" id="2194763">&gt;=</span>&nbsp;<span class="builtinfunc" id="2194766">len</span><span class="op" id="2194769">(</span><span class="ident" id="2194770">b</span><span class="op" id="2194771">.</span><span class="ident" id="2194772">buf</span><span class="op" id="2194775">)</span>&nbsp;<span class="op" id="2194777">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194781">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194827">b</span><span class="op" id="2194828">.</span><span class="ident" id="2194829">Truncate</span><span class="op" id="2194837">(</span><span class="num" id="2194838">0</span><span class="op" id="2194839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194843">return</span>&nbsp;<span class="num" id="2194850">0</span><span class="op" id="2194851">,</span>&nbsp;<span class="num" id="2194853">0</span><span class="op" id="2194854">,</span>&nbsp;<span class="ident" id="2194856">io</span><span class="op" id="2194858">.</span><span class="ident" id="2194859">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194867">b</span><span class="op" id="2194868">.</span><span class="ident" id="2194869">lastRead</span>&nbsp;<span class="op" id="2194878">=</span>&nbsp;<span class="ident" id="2194880">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194892">c</span>&nbsp;<span class="op" id="2194894">:=</span>&nbsp;<span class="ident" id="2194897">b</span><span class="op" id="2194898">.</span><span class="ident" id="2194899">buf</span><span class="op" id="2194902">[</span><span class="ident" id="2194903">b</span><span class="op" id="2194904">.</span><span class="ident" id="2194905">off</span><span class="op" id="2194908">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194911">if</span>&nbsp;<span class="ident" id="2194914">c</span>&nbsp;<span class="op" id="2194916">&lt;</span>&nbsp;<span class="ident" id="2194918">utf8</span><span class="op" id="2194922">.</span><span class="ident" id="2194923">RuneSelf</span>&nbsp;<span class="op" id="2194932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194936">b</span><span class="op" id="2194937">.</span><span class="ident" id="2194938">off</span><span class="op" id="2194941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194946">return</span>&nbsp;<span class="builtintype" id="2194953">rune</span><span class="op" id="2194957">(</span><span class="ident" id="2194958">c</span><span class="op" id="2194959">)</span><span class="op" id="2194960">,</span>&nbsp;<span class="num" id="2194962">1</span><span class="op" id="2194963">,</span>&nbsp;<span class="ident" id="2194965">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194970">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194973">r</span><span class="op" id="2194974">,</span>&nbsp;<span class="ident" id="2194976">n</span>&nbsp;<span class="op" id="2194978">:=</span>&nbsp;<span class="ident" id="2194981">utf8</span><span class="op" id="2194985">.</span><span class="ident" id="2194986">DecodeRune</span><span class="op" id="2194996">(</span><span class="ident" id="2194997">b</span><span class="op" id="2194998">.</span><span class="ident" id="2194999">buf</span><span class="op" id="2195002">[</span><span class="ident" id="2195003">b</span><span class="op" id="2195004">.</span><span class="ident" id="2195005">off</span><span class="op" id="2195008">:</span><span class="op" id="2195009">]</span><span class="op" id="2195010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195013">b</span><span class="op" id="2195014">.</span><span class="ident" id="2195015">off</span>&nbsp;<span class="op" id="2195019">+=</span>&nbsp;<span class="ident" id="2195022">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195025">return</span>&nbsp;<span class="ident" id="2195032">r</span><span class="op" id="2195033">,</span>&nbsp;<span class="ident" id="2195035">n</span><span class="op" id="2195036">,</span>&nbsp;<span class="ident" id="2195038">nil</span><br>
<span class="lineno"></span><span class="op" id="2195042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="2195045">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="2195103">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="2195167">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="2195232">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2195299">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="2195328">func</span>&nbsp;<span class="op" id="2195333">(</span><span class="ident" id="2195334">b</span>&nbsp;<span class="op" id="2195336">*</span><span class="ident" id="2195337">Buffer</span><span class="op" id="2195343">)</span>&nbsp;<span class="ident" id="2195345">UnreadRune</span><span class="op" id="2195355">(</span><span class="op" id="2195356">)</span>&nbsp;<span class="builtintype" id="2195358">error</span>&nbsp;<span class="op" id="2195364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195367">if</span>&nbsp;<span class="ident" id="2195370">b</span><span class="op" id="2195371">.</span><span class="ident" id="2195372">lastRead</span>&nbsp;<span class="op" id="2195381">!=</span>&nbsp;<span class="ident" id="2195384">opReadRune</span>&nbsp;<span class="op" id="2195395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195399">return</span>&nbsp;<span class="ident" id="2195406">errors</span><span class="op" id="2195412">.</span><span class="ident" id="2195413">New</span><span class="op" id="2195416">(</span><span class="string" id="2195417">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="2195480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195486">b</span><span class="op" id="2195487">.</span><span class="ident" id="2195488">lastRead</span>&nbsp;<span class="op" id="2195497">=</span>&nbsp;<span class="ident" id="2195499">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195510">if</span>&nbsp;<span class="ident" id="2195513">b</span><span class="op" id="2195514">.</span><span class="ident" id="2195515">off</span>&nbsp;<span class="op" id="2195519">&gt;</span>&nbsp;<span class="num" id="2195521">0</span>&nbsp;<span class="op" id="2195523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195527">_</span><span class="op" id="2195528">,</span>&nbsp;<span class="ident" id="2195530">n</span>&nbsp;<span class="op" id="2195532">:=</span>&nbsp;<span class="ident" id="2195535">utf8</span><span class="op" id="2195539">.</span><span class="ident" id="2195540">DecodeLastRune</span><span class="op" id="2195554">(</span><span class="ident" id="2195555">b</span><span class="op" id="2195556">.</span><span class="ident" id="2195557">buf</span><span class="op" id="2195560">[</span><span class="num" id="2195561">0</span><span class="op" id="2195562">:</span><span class="ident" id="2195563">b</span><span class="op" id="2195564">.</span><span class="ident" id="2195565">off</span><span class="op" id="2195568">]</span><span class="op" id="2195569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195573">b</span><span class="op" id="2195574">.</span><span class="ident" id="2195575">off</span>&nbsp;<span class="op" id="2195579">-=</span>&nbsp;<span class="ident" id="2195582">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195588">return</span>&nbsp;<span class="ident" id="2195595">nil</span><br>
<span class="lineno">340</span><span class="op" id="2195599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2195602">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="2195666">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="2195740">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="2195761">func</span>&nbsp;<span class="op" id="2195766">(</span><span class="ident" id="2195767">b</span>&nbsp;<span class="op" id="2195769">*</span><span class="ident" id="2195770">Buffer</span><span class="op" id="2195776">)</span>&nbsp;<span class="ident" id="2195778">UnreadByte</span><span class="op" id="2195788">(</span><span class="op" id="2195789">)</span>&nbsp;<span class="builtintype" id="2195791">error</span>&nbsp;<span class="op" id="2195797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195800">if</span>&nbsp;<span class="ident" id="2195803">b</span><span class="op" id="2195804">.</span><span class="ident" id="2195805">lastRead</span>&nbsp;<span class="op" id="2195814">!=</span>&nbsp;<span class="ident" id="2195817">opReadRune</span>&nbsp;<span class="op" id="2195828">&amp;&amp;</span>&nbsp;<span class="ident" id="2195831">b</span><span class="op" id="2195832">.</span><span class="ident" id="2195833">lastRead</span>&nbsp;<span class="op" id="2195842">!=</span>&nbsp;<span class="ident" id="2195845">opRead</span>&nbsp;<span class="op" id="2195852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195856">return</span>&nbsp;<span class="ident" id="2195863">errors</span><span class="op" id="2195869">.</span><span class="ident" id="2195870">New</span><span class="op" id="2195873">(</span><span class="string" id="2195874">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="2195935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195941">b</span><span class="op" id="2195942">.</span><span class="ident" id="2195943">lastRead</span>&nbsp;<span class="op" id="2195952">=</span>&nbsp;<span class="ident" id="2195954">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195965">if</span>&nbsp;<span class="ident" id="2195968">b</span><span class="op" id="2195969">.</span><span class="ident" id="2195970">off</span>&nbsp;<span class="op" id="2195974">&gt;</span>&nbsp;<span class="num" id="2195976">0</span>&nbsp;<span class="op" id="2195978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195982">b</span><span class="op" id="2195983">.</span><span class="ident" id="2195984">off</span><span class="op" id="2195987">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195994">return</span>&nbsp;<span class="ident" id="2196001">nil</span><br>
<span class="lineno"></span><span class="op" id="2196005">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="2196008">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2196077">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2196153">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2196217">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="2196299">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2196380">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="2196390">func</span>&nbsp;<span class="op" id="2196395">(</span><span class="ident" id="2196396">b</span>&nbsp;<span class="op" id="2196398">*</span><span class="ident" id="2196399">Buffer</span><span class="op" id="2196405">)</span>&nbsp;<span class="ident" id="2196407">ReadBytes</span><span class="op" id="2196416">(</span><span class="ident" id="2196417">delim</span>&nbsp;<span class="builtintype" id="2196423">byte</span><span class="op" id="2196427">)</span>&nbsp;<span class="op" id="2196429">(</span><span class="ident" id="2196430">line</span>&nbsp;<span class="op" id="2196435">[</span><span class="op" id="2196436">]</span><span class="builtintype" id="2196437">byte</span><span class="op" id="2196441">,</span>&nbsp;<span class="ident" id="2196443">err</span>&nbsp;<span class="builtintype" id="2196447">error</span><span class="op" id="2196452">)</span>&nbsp;<span class="op" id="2196454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196457">slice</span><span class="op" id="2196462">,</span>&nbsp;<span class="ident" id="2196464">err</span>&nbsp;<span class="op" id="2196468">:=</span>&nbsp;<span class="ident" id="2196471">b</span><span class="op" id="2196472">.</span><span class="ident" id="2196473">readSlice</span><span class="op" id="2196482">(</span><span class="ident" id="2196483">delim</span><span class="op" id="2196488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2196491">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2196550">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196585">line</span>&nbsp;<span class="op" id="2196590">=</span>&nbsp;<span class="builtinfunc" id="2196592">append</span><span class="op" id="2196598">(</span><span class="ident" id="2196599">line</span><span class="op" id="2196603">,</span>&nbsp;<span class="ident" id="2196605">slice</span><span class="op" id="2196610">...</span><span class="op" id="2196613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2196616">return</span><br>
<span class="lineno"></span><span class="op" id="2196623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="2196626">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2196706">func</span>&nbsp;<span class="op" id="2196711">(</span><span class="ident" id="2196712">b</span>&nbsp;<span class="op" id="2196714">*</span><span class="ident" id="2196715">Buffer</span><span class="op" id="2196721">)</span>&nbsp;<span class="ident" id="2196723">readSlice</span><span class="op" id="2196732">(</span><span class="ident" id="2196733">delim</span>&nbsp;<span class="builtintype" id="2196739">byte</span><span class="op" id="2196743">)</span>&nbsp;<span class="op" id="2196745">(</span><span class="ident" id="2196746">line</span>&nbsp;<span class="op" id="2196751">[</span><span class="op" id="2196752">]</span><span class="builtintype" id="2196753">byte</span><span class="op" id="2196757">,</span>&nbsp;<span class="ident" id="2196759">err</span>&nbsp;<span class="builtintype" id="2196763">error</span><span class="op" id="2196768">)</span>&nbsp;<span class="op" id="2196770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196773">i</span>&nbsp;<span class="op" id="2196775">:=</span>&nbsp;<span class="ident" id="2196778">IndexByte</span><span class="op" id="2196787">(</span><span class="ident" id="2196788">b</span><span class="op" id="2196789">.</span><span class="ident" id="2196790">buf</span><span class="op" id="2196793">[</span><span class="ident" id="2196794">b</span><span class="op" id="2196795">.</span><span class="ident" id="2196796">off</span><span class="op" id="2196799">:</span><span class="op" id="2196800">]</span><span class="op" id="2196801">,</span>&nbsp;<span class="ident" id="2196803">delim</span><span class="op" id="2196808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196811">end</span>&nbsp;<span class="op" id="2196815">:=</span>&nbsp;<span class="ident" id="2196818">b</span><span class="op" id="2196819">.</span><span class="ident" id="2196820">off</span>&nbsp;<span class="op" id="2196824">+</span>&nbsp;<span class="ident" id="2196826">i</span>&nbsp;<span class="op" id="2196828">+</span>&nbsp;<span class="num" id="2196830">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2196833">if</span>&nbsp;<span class="ident" id="2196836">i</span>&nbsp;<span class="op" id="2196838">&lt;</span>&nbsp;<span class="num" id="2196840">0</span>&nbsp;<span class="op" id="2196842">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196846">end</span>&nbsp;<span class="op" id="2196850">=</span>&nbsp;<span class="builtinfunc" id="2196852">len</span><span class="op" id="2196855">(</span><span class="ident" id="2196856">b</span><span class="op" id="2196857">.</span><span class="ident" id="2196858">buf</span><span class="op" id="2196861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196865">err</span>&nbsp;<span class="op" id="2196869">=</span>&nbsp;<span class="ident" id="2196871">io</span><span class="op" id="2196873">.</span><span class="ident" id="2196874">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2196879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196882">line</span>&nbsp;<span class="op" id="2196887">=</span>&nbsp;<span class="ident" id="2196889">b</span><span class="op" id="2196890">.</span><span class="ident" id="2196891">buf</span><span class="op" id="2196894">[</span><span class="ident" id="2196895">b</span><span class="op" id="2196896">.</span><span class="ident" id="2196897">off</span><span class="op" id="2196900">:</span><span class="ident" id="2196901">end</span><span class="op" id="2196904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196907">b</span><span class="op" id="2196908">.</span><span class="ident" id="2196909">off</span>&nbsp;<span class="op" id="2196913">=</span>&nbsp;<span class="ident" id="2196915">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2196920">b</span><span class="op" id="2196921">.</span><span class="ident" id="2196922">lastRead</span>&nbsp;<span class="op" id="2196931">=</span>&nbsp;<span class="ident" id="2196933">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2196941">return</span>&nbsp;<span class="ident" id="2196948">line</span><span class="op" id="2196952">,</span>&nbsp;<span class="ident" id="2196954">err</span><br>
<span class="lineno"></span><span class="op" id="2196958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2196961">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="2197031">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2197108">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2197173">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="2197255">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="2197334">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="2197347">func</span>&nbsp;<span class="op" id="2197352">(</span><span class="ident" id="2197353">b</span>&nbsp;<span class="op" id="2197355">*</span><span class="ident" id="2197356">Buffer</span><span class="op" id="2197362">)</span>&nbsp;<span class="ident" id="2197364">ReadString</span><span class="op" id="2197374">(</span><span class="ident" id="2197375">delim</span>&nbsp;<span class="builtintype" id="2197381">byte</span><span class="op" id="2197385">)</span>&nbsp;<span class="op" id="2197387">(</span><span class="ident" id="2197388">line</span>&nbsp;<span class="builtintype" id="2197393">string</span><span class="op" id="2197399">,</span>&nbsp;<span class="ident" id="2197401">err</span>&nbsp;<span class="builtintype" id="2197405">error</span><span class="op" id="2197410">)</span>&nbsp;<span class="op" id="2197412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2197415">slice</span><span class="op" id="2197420">,</span>&nbsp;<span class="ident" id="2197422">err</span>&nbsp;<span class="op" id="2197426">:=</span>&nbsp;<span class="ident" id="2197429">b</span><span class="op" id="2197430">.</span><span class="ident" id="2197431">readSlice</span><span class="op" id="2197440">(</span><span class="ident" id="2197441">delim</span><span class="op" id="2197446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2197449">return</span>&nbsp;<span class="builtintype" id="2197456">string</span><span class="op" id="2197462">(</span><span class="ident" id="2197463">slice</span><span class="op" id="2197468">)</span><span class="op" id="2197469">,</span>&nbsp;<span class="ident" id="2197471">err</span><br>
<span class="lineno"></span><span class="op" id="2197475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="2197478">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="2197553">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="2197629">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="2197702">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2197764">//</span><br>
<span class="lineno">400</span><span class="comment" id="2197767">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2197838">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2197876">func</span>&nbsp;<span class="ident" id="2197881">NewBuffer</span><span class="op" id="2197890">(</span><span class="ident" id="2197891">buf</span>&nbsp;<span class="op" id="2197895">[</span><span class="op" id="2197896">]</span><span class="builtintype" id="2197897">byte</span><span class="op" id="2197901">)</span>&nbsp;<span class="op" id="2197903">*</span><span class="ident" id="2197904">Buffer</span>&nbsp;<span class="op" id="2197911">{</span>&nbsp;<span class="keyword" id="2197913">return</span>&nbsp;<span class="op" id="2197920">&amp;</span><span class="ident" id="2197921">Buffer</span><span class="op" id="2197927">{</span><span class="ident" id="2197928">buf</span><span class="op" id="2197931">:</span>&nbsp;<span class="ident" id="2197933">buf</span><span class="op" id="2197936">}</span>&nbsp;<span class="op" id="2197938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2197941">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="2198019">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="2198095">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2198106">//</span><br>
<span class="lineno"></span><span class="comment" id="2198109">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2198180">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="2198218">func</span>&nbsp;<span class="ident" id="2198223">NewBufferString</span><span class="op" id="2198238">(</span><span class="ident" id="2198239">s</span>&nbsp;<span class="builtintype" id="2198241">string</span><span class="op" id="2198247">)</span>&nbsp;<span class="op" id="2198249">*</span><span class="ident" id="2198250">Buffer</span>&nbsp;<span class="op" id="2198257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198260">return</span>&nbsp;<span class="op" id="2198267">&amp;</span><span class="ident" id="2198268">Buffer</span><span class="op" id="2198274">{</span><span class="ident" id="2198275">buf</span><span class="op" id="2198278">:</span>&nbsp;<span class="op" id="2198280">[</span><span class="op" id="2198281">]</span><span class="builtintype" id="2198282">byte</span><span class="op" id="2198286">(</span><span class="ident" id="2198287">s</span><span class="op" id="2198288">)</span><span class="op" id="2198289">}</span><br>
<span class="lineno"></span><span class="op" id="2198291">}</span>
</div>
</body>
</html>
