<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6431374">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6431429">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6431483">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6431534">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="6431598">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431632">package</span>&nbsp;<span class="ident" id="6431640">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6431649">import</span>&nbsp;<span class="op" id="6431656">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431659">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431668">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431678">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431691">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431697">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431710">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431717">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6431727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6431730">var</span>&nbsp;<span class="ident" id="6431734">testfile</span>&nbsp;<span class="op" id="6431743">*</span><span class="ident" id="6431744">ast</span><span class="op" id="6431747">.</span><span class="ident" id="6431748">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431754">func</span>&nbsp;<span class="ident" id="6431759">testprint</span><span class="op" id="6431768">(</span><span class="ident" id="6431769">out</span>&nbsp;<span class="ident" id="6431773">io</span><span class="op" id="6431775">.</span><span class="ident" id="6431776">Writer</span><span class="op" id="6431782">,</span>&nbsp;<span class="ident" id="6431784">file</span>&nbsp;<span class="op" id="6431789">*</span><span class="ident" id="6431790">ast</span><span class="op" id="6431793">.</span><span class="ident" id="6431794">File</span><span class="op" id="6431798">)</span>&nbsp;<span class="op" id="6431800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431803">if</span>&nbsp;<span class="ident" id="6431806">err</span>&nbsp;<span class="op" id="6431810">:=</span>&nbsp;<span class="op" id="6431813">(</span><span class="op" id="6431814">&amp;</span><span class="ident" id="6431815">Config</span><span class="op" id="6431821">{</span><span class="ident" id="6431822">TabIndent</span>&nbsp;<span class="op" id="6431832">|</span>&nbsp;<span class="ident" id="6431834">UseSpaces</span><span class="op" id="6431843">,</span>&nbsp;<span class="num" id="6431845">8</span><span class="op" id="6431846">,</span>&nbsp;<span class="num" id="6431848">0</span><span class="op" id="6431849">}</span><span class="op" id="6431850">)</span><span class="op" id="6431851">.</span><span class="ident" id="6431852">Fprint</span><span class="op" id="6431858">(</span><span class="ident" id="6431859">out</span><span class="op" id="6431862">,</span>&nbsp;<span class="ident" id="6431864">fset</span><span class="op" id="6431868">,</span>&nbsp;<span class="ident" id="6431870">file</span><span class="op" id="6431874">)</span><span class="op" id="6431875">;</span>&nbsp;<span class="ident" id="6431877">err</span>&nbsp;<span class="op" id="6431881">!=</span>&nbsp;<span class="ident" id="6431884">nil</span>&nbsp;<span class="op" id="6431888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431892">log</span><span class="op" id="6431895">.</span><span class="ident" id="6431896">Fatalf</span><span class="op" id="6431902">(</span><span class="string" id="6431903">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6431920">,</span>&nbsp;<span class="ident" id="6431922">err</span><span class="op" id="6431925">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431928">}</span><br>
<span class="lineno"></span><span class="op" id="6431930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6431933">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6432008">func</span>&nbsp;<span class="ident" id="6432013">initialize</span><span class="op" id="6432023">(</span><span class="op" id="6432024">)</span>&nbsp;<span class="op" id="6432026">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432029">const</span>&nbsp;<span class="ident" id="6432035">filename</span>&nbsp;<span class="op" id="6432044">=</span>&nbsp;<span class="string" id="6432046">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432069">src</span><span class="op" id="6432072">,</span>&nbsp;<span class="ident" id="6432074">err</span>&nbsp;<span class="op" id="6432078">:=</span>&nbsp;<span class="ident" id="6432081">ioutil</span><span class="op" id="6432087">.</span><span class="ident" id="6432088">ReadFile</span><span class="op" id="6432096">(</span><span class="ident" id="6432097">filename</span><span class="op" id="6432105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432108">if</span>&nbsp;<span class="ident" id="6432111">err</span>&nbsp;<span class="op" id="6432115">!=</span>&nbsp;<span class="ident" id="6432118">nil</span>&nbsp;<span class="op" id="6432122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432126">log</span><span class="op" id="6432129">.</span><span class="ident" id="6432130">Fatalf</span><span class="op" id="6432136">(</span><span class="string" id="6432137">&#34;%s&#34;</span><span class="op" id="6432141">,</span>&nbsp;<span class="ident" id="6432143">err</span><span class="op" id="6432146">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432153">file</span><span class="op" id="6432157">,</span>&nbsp;<span class="ident" id="6432159">err</span>&nbsp;<span class="op" id="6432163">:=</span>&nbsp;<span class="ident" id="6432166">parser</span><span class="op" id="6432172">.</span><span class="ident" id="6432173">ParseFile</span><span class="op" id="6432182">(</span><span class="ident" id="6432183">fset</span><span class="op" id="6432187">,</span>&nbsp;<span class="ident" id="6432189">filename</span><span class="op" id="6432197">,</span>&nbsp;<span class="ident" id="6432199">src</span><span class="op" id="6432202">,</span>&nbsp;<span class="ident" id="6432204">parser</span><span class="op" id="6432210">.</span><span class="ident" id="6432211">ParseComments</span><span class="op" id="6432224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432227">if</span>&nbsp;<span class="ident" id="6432230">err</span>&nbsp;<span class="op" id="6432234">!=</span>&nbsp;<span class="ident" id="6432237">nil</span>&nbsp;<span class="op" id="6432241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432245">log</span><span class="op" id="6432248">.</span><span class="ident" id="6432249">Fatalf</span><span class="op" id="6432255">(</span><span class="string" id="6432256">&#34;%s&#34;</span><span class="op" id="6432260">,</span>&nbsp;<span class="ident" id="6432262">err</span><span class="op" id="6432265">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432272">var</span>&nbsp;<span class="ident" id="6432276">buf</span>&nbsp;<span class="ident" id="6432280">bytes</span><span class="op" id="6432285">.</span><span class="ident" id="6432286">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432294">testprint</span><span class="op" id="6432303">(</span><span class="op" id="6432304">&amp;</span><span class="ident" id="6432305">buf</span><span class="op" id="6432308">,</span>&nbsp;<span class="ident" id="6432310">file</span><span class="op" id="6432314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432317">if</span>&nbsp;<span class="op" id="6432320">!</span><span class="ident" id="6432321">bytes</span><span class="op" id="6432326">.</span><span class="ident" id="6432327">Equal</span><span class="op" id="6432332">(</span><span class="ident" id="6432333">buf</span><span class="op" id="6432336">.</span><span class="ident" id="6432337">Bytes</span><span class="op" id="6432342">(</span><span class="op" id="6432343">)</span><span class="op" id="6432344">,</span>&nbsp;<span class="ident" id="6432346">src</span><span class="op" id="6432349">)</span>&nbsp;<span class="op" id="6432351">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432355">log</span><span class="op" id="6432358">.</span><span class="ident" id="6432359">Fatalf</span><span class="op" id="6432365">(</span><span class="string" id="6432366">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="6432398">,</span>&nbsp;<span class="ident" id="6432400">filename</span><span class="op" id="6432408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432415">testfile</span>&nbsp;<span class="op" id="6432424">=</span>&nbsp;<span class="ident" id="6432426">file</span><br>
<span class="lineno"></span><span class="op" id="6432431">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6432434">func</span>&nbsp;<span class="ident" id="6432439">BenchmarkPrint</span><span class="op" id="6432453">(</span><span class="ident" id="6432454">b</span>&nbsp;<span class="op" id="6432456">*</span><span class="ident" id="6432457">testing</span><span class="op" id="6432464">.</span><span class="ident" id="6432465">B</span><span class="op" id="6432466">)</span>&nbsp;<span class="op" id="6432468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432471">if</span>&nbsp;<span class="ident" id="6432474">testfile</span>&nbsp;<span class="op" id="6432483">==</span>&nbsp;<span class="ident" id="6432486">nil</span>&nbsp;<span class="op" id="6432490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432494">initialize</span><span class="op" id="6432504">(</span><span class="op" id="6432505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432508">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432511">for</span>&nbsp;<span class="ident" id="6432515">i</span>&nbsp;<span class="op" id="6432517">:=</span>&nbsp;<span class="num" id="6432520">0</span><span class="op" id="6432521">;</span>&nbsp;<span class="ident" id="6432523">i</span>&nbsp;<span class="op" id="6432525">&lt;</span>&nbsp;<span class="ident" id="6432527">b</span><span class="op" id="6432528">.</span><span class="ident" id="6432529">N</span><span class="op" id="6432530">;</span>&nbsp;<span class="ident" id="6432532">i</span><span class="op" id="6432533">++</span>&nbsp;<span class="op" id="6432536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432540">testprint</span><span class="op" id="6432549">(</span><span class="ident" id="6432550">ioutil</span><span class="op" id="6432556">.</span><span class="ident" id="6432557">Discard</span><span class="op" id="6432564">,</span>&nbsp;<span class="ident" id="6432566">testfile</span><span class="op" id="6432574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432577">}</span><br>
<span class="lineno"></span><span class="op" id="6432579">}</span>
</div>
</body>
</html>
