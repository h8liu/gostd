<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html" class="current">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6504919">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6504974">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6505028">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6505079">package</span>&nbsp;<span class="ident" id="6505087">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505092">import</span>&nbsp;<span class="string" id="6505099">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505107">type</span>&nbsp;<span class="ident" id="6505112">streamListener</span>&nbsp;<span class="keyword" id="6505127">struct</span>&nbsp;<span class="op" id="6505134">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505137">net</span><span class="op" id="6505140">,</span>&nbsp;<span class="ident" id="6505142">addr</span>&nbsp;<span class="builtintype" id="6505147">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505155">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505165">Listener</span><br>
<span class="lineno"></span><span class="op" id="6505174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505177">type</span>&nbsp;<span class="ident" id="6505182">dualStackServer</span>&nbsp;<span class="keyword" id="6505198">struct</span>&nbsp;<span class="op" id="6505205">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505208">lnmu</span>&nbsp;<span class="ident" id="6505213">sync</span><span class="op" id="6505217">.</span><span class="ident" id="6505218">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505227">lns</span>&nbsp;&nbsp;<span class="op" id="6505232">[</span><span class="op" id="6505233">]</span><span class="ident" id="6505234">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505250">port</span>&nbsp;<span class="builtintype" id="6505255">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505264">cmu</span>&nbsp;<span class="ident" id="6505268">sync</span><span class="op" id="6505272">.</span><span class="ident" id="6505273">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505282">cs</span>&nbsp;&nbsp;<span class="op" id="6505286">[</span><span class="op" id="6505287">]</span><span class="ident" id="6505288">Conn</span>&nbsp;<span class="comment" id="6505293">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="6505345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505348">func</span>&nbsp;<span class="op" id="6505353">(</span><span class="ident" id="6505354">dss</span>&nbsp;<span class="op" id="6505358">*</span><span class="ident" id="6505359">dualStackServer</span><span class="op" id="6505374">)</span>&nbsp;<span class="ident" id="6505376">buildup</span><span class="op" id="6505383">(</span><span class="ident" id="6505384">server</span>&nbsp;<span class="keyword" id="6505391">func</span><span class="op" id="6505395">(</span><span class="op" id="6505396">*</span><span class="ident" id="6505397">dualStackServer</span><span class="op" id="6505412">,</span>&nbsp;<span class="ident" id="6505414">Listener</span><span class="op" id="6505422">)</span><span class="op" id="6505423">)</span>&nbsp;<span class="builtintype" id="6505425">error</span>&nbsp;<span class="op" id="6505431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505434">for</span>&nbsp;<span class="ident" id="6505438">i</span>&nbsp;<span class="op" id="6505440">:=</span>&nbsp;<span class="keyword" id="6505443">range</span>&nbsp;<span class="ident" id="6505449">dss</span><span class="op" id="6505452">.</span><span class="ident" id="6505453">lns</span>&nbsp;<span class="op" id="6505457">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505461">go</span>&nbsp;<span class="ident" id="6505464">server</span><span class="op" id="6505470">(</span><span class="ident" id="6505471">dss</span><span class="op" id="6505474">,</span>&nbsp;<span class="ident" id="6505476">dss</span><span class="op" id="6505479">.</span><span class="ident" id="6505480">lns</span><span class="op" id="6505483">[</span><span class="ident" id="6505484">i</span><span class="op" id="6505485">]</span><span class="op" id="6505486">.</span><span class="ident" id="6505487">ln</span><span class="op" id="6505489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505495">return</span>&nbsp;<span class="builtintype" id="6505502">nil</span><br>
<span class="lineno"></span><span class="op" id="6505506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6505509">func</span>&nbsp;<span class="op" id="6505514">(</span><span class="ident" id="6505515">dss</span>&nbsp;<span class="op" id="6505519">*</span><span class="ident" id="6505520">dualStackServer</span><span class="op" id="6505535">)</span>&nbsp;<span class="ident" id="6505537">putConn</span><span class="op" id="6505544">(</span><span class="ident" id="6505545">c</span>&nbsp;<span class="ident" id="6505547">Conn</span><span class="op" id="6505551">)</span>&nbsp;<span class="builtintype" id="6505553">error</span>&nbsp;<span class="op" id="6505559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505562">dss</span><span class="op" id="6505565">.</span><span class="ident" id="6505566">cmu</span><span class="op" id="6505569">.</span><span class="ident" id="6505570">Lock</span><span class="op" id="6505574">(</span><span class="op" id="6505575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505578">dss</span><span class="op" id="6505581">.</span><span class="ident" id="6505582">cs</span>&nbsp;<span class="op" id="6505585">=</span>&nbsp;<span class="builtinfunc" id="6505587">append</span><span class="op" id="6505593">(</span><span class="ident" id="6505594">dss</span><span class="op" id="6505597">.</span><span class="ident" id="6505598">cs</span><span class="op" id="6505600">,</span>&nbsp;<span class="ident" id="6505602">c</span><span class="op" id="6505603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505606">dss</span><span class="op" id="6505609">.</span><span class="ident" id="6505610">cmu</span><span class="op" id="6505613">.</span><span class="ident" id="6505614">Unlock</span><span class="op" id="6505620">(</span><span class="op" id="6505621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505624">return</span>&nbsp;<span class="builtintype" id="6505631">nil</span><br>
<span class="lineno">35</span><span class="op" id="6505635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505638">func</span>&nbsp;<span class="op" id="6505643">(</span><span class="ident" id="6505644">dss</span>&nbsp;<span class="op" id="6505648">*</span><span class="ident" id="6505649">dualStackServer</span><span class="op" id="6505664">)</span>&nbsp;<span class="ident" id="6505666">teardownNetwork</span><span class="op" id="6505681">(</span><span class="ident" id="6505682">net</span>&nbsp;<span class="builtintype" id="6505686">string</span><span class="op" id="6505692">)</span>&nbsp;<span class="builtintype" id="6505694">error</span>&nbsp;<span class="op" id="6505700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505703">dss</span><span class="op" id="6505706">.</span><span class="ident" id="6505707">lnmu</span><span class="op" id="6505711">.</span><span class="ident" id="6505712">Lock</span><span class="op" id="6505716">(</span><span class="op" id="6505717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505720">for</span>&nbsp;<span class="ident" id="6505724">i</span>&nbsp;<span class="op" id="6505726">:=</span>&nbsp;<span class="keyword" id="6505729">range</span>&nbsp;<span class="ident" id="6505735">dss</span><span class="op" id="6505738">.</span><span class="ident" id="6505739">lns</span>&nbsp;<span class="op" id="6505743">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505747">if</span>&nbsp;<span class="ident" id="6505750">net</span>&nbsp;<span class="op" id="6505754">==</span>&nbsp;<span class="ident" id="6505757">dss</span><span class="op" id="6505760">.</span><span class="ident" id="6505761">lns</span><span class="op" id="6505764">[</span><span class="ident" id="6505765">i</span><span class="op" id="6505766">]</span><span class="op" id="6505767">.</span><span class="ident" id="6505768">net</span>&nbsp;<span class="op" id="6505772">&amp;&amp;</span>&nbsp;<span class="ident" id="6505775">dss</span><span class="op" id="6505778">.</span><span class="ident" id="6505779">lns</span><span class="op" id="6505782">[</span><span class="ident" id="6505783">i</span><span class="op" id="6505784">]</span><span class="op" id="6505785">.</span><span class="ident" id="6505786">ln</span>&nbsp;<span class="op" id="6505789">!=</span>&nbsp;<span class="builtintype" id="6505792">nil</span>&nbsp;<span class="op" id="6505796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505801">dss</span><span class="op" id="6505804">.</span><span class="ident" id="6505805">lns</span><span class="op" id="6505808">[</span><span class="ident" id="6505809">i</span><span class="op" id="6505810">]</span><span class="op" id="6505811">.</span><span class="ident" id="6505812">ln</span><span class="op" id="6505814">.</span><span class="ident" id="6505815">Close</span><span class="op" id="6505820">(</span><span class="op" id="6505821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505826">dss</span><span class="op" id="6505829">.</span><span class="ident" id="6505830">lns</span><span class="op" id="6505833">[</span><span class="ident" id="6505834">i</span><span class="op" id="6505835">]</span><span class="op" id="6505836">.</span><span class="ident" id="6505837">ln</span>&nbsp;<span class="op" id="6505840">=</span>&nbsp;<span class="builtintype" id="6505842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505851">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505854">dss</span><span class="op" id="6505857">.</span><span class="ident" id="6505858">lnmu</span><span class="op" id="6505862">.</span><span class="ident" id="6505863">Unlock</span><span class="op" id="6505869">(</span><span class="op" id="6505870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505873">return</span>&nbsp;<span class="builtintype" id="6505880">nil</span><br>
<span class="lineno"></span><span class="op" id="6505884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505887">func</span>&nbsp;<span class="op" id="6505892">(</span><span class="ident" id="6505893">dss</span>&nbsp;<span class="op" id="6505897">*</span><span class="ident" id="6505898">dualStackServer</span><span class="op" id="6505913">)</span>&nbsp;<span class="ident" id="6505915">teardown</span><span class="op" id="6505923">(</span><span class="op" id="6505924">)</span>&nbsp;<span class="builtintype" id="6505926">error</span>&nbsp;<span class="op" id="6505932">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505935">dss</span><span class="op" id="6505938">.</span><span class="ident" id="6505939">lnmu</span><span class="op" id="6505943">.</span><span class="ident" id="6505944">Lock</span><span class="op" id="6505948">(</span><span class="op" id="6505949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505952">for</span>&nbsp;<span class="ident" id="6505956">i</span>&nbsp;<span class="op" id="6505958">:=</span>&nbsp;<span class="keyword" id="6505961">range</span>&nbsp;<span class="ident" id="6505967">dss</span><span class="op" id="6505970">.</span><span class="ident" id="6505971">lns</span>&nbsp;<span class="op" id="6505975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505979">if</span>&nbsp;<span class="ident" id="6505982">dss</span><span class="op" id="6505985">.</span><span class="ident" id="6505986">lns</span><span class="op" id="6505989">[</span><span class="ident" id="6505990">i</span><span class="op" id="6505991">]</span><span class="op" id="6505992">.</span><span class="ident" id="6505993">ln</span>&nbsp;<span class="op" id="6505996">!=</span>&nbsp;<span class="builtintype" id="6505999">nil</span>&nbsp;<span class="op" id="6506003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506008">dss</span><span class="op" id="6506011">.</span><span class="ident" id="6506012">lns</span><span class="op" id="6506015">[</span><span class="ident" id="6506016">i</span><span class="op" id="6506017">]</span><span class="op" id="6506018">.</span><span class="ident" id="6506019">ln</span><span class="op" id="6506021">.</span><span class="ident" id="6506022">Close</span><span class="op" id="6506027">(</span><span class="op" id="6506028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506032">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506038">dss</span><span class="op" id="6506041">.</span><span class="ident" id="6506042">lnmu</span><span class="op" id="6506046">.</span><span class="ident" id="6506047">Unlock</span><span class="op" id="6506053">(</span><span class="op" id="6506054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506057">dss</span><span class="op" id="6506060">.</span><span class="ident" id="6506061">cmu</span><span class="op" id="6506064">.</span><span class="ident" id="6506065">Lock</span><span class="op" id="6506069">(</span><span class="op" id="6506070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506073">for</span>&nbsp;<span class="ident" id="6506077">_</span><span class="op" id="6506078">,</span>&nbsp;<span class="ident" id="6506080">c</span>&nbsp;<span class="op" id="6506082">:=</span>&nbsp;<span class="keyword" id="6506085">range</span>&nbsp;<span class="ident" id="6506091">dss</span><span class="op" id="6506094">.</span><span class="ident" id="6506095">cs</span>&nbsp;<span class="op" id="6506098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506102">c</span><span class="op" id="6506103">.</span><span class="ident" id="6506104">Close</span><span class="op" id="6506109">(</span><span class="op" id="6506110">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506116">dss</span><span class="op" id="6506119">.</span><span class="ident" id="6506120">cmu</span><span class="op" id="6506123">.</span><span class="ident" id="6506124">Unlock</span><span class="op" id="6506130">(</span><span class="op" id="6506131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506134">return</span>&nbsp;<span class="builtintype" id="6506141">nil</span><br>
<span class="lineno"></span><span class="op" id="6506145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6506148">func</span>&nbsp;<span class="ident" id="6506153">newDualStackServer</span><span class="op" id="6506171">(</span><span class="ident" id="6506172">lns</span>&nbsp;<span class="op" id="6506176">[</span><span class="op" id="6506177">]</span><span class="ident" id="6506178">streamListener</span><span class="op" id="6506192">)</span>&nbsp;<span class="op" id="6506194">(</span><span class="op" id="6506195">*</span><span class="ident" id="6506196">dualStackServer</span><span class="op" id="6506211">,</span>&nbsp;<span class="builtintype" id="6506213">error</span><span class="op" id="6506218">)</span>&nbsp;<span class="op" id="6506220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506223">dss</span>&nbsp;<span class="op" id="6506227">:=</span>&nbsp;<span class="op" id="6506230">&amp;</span><span class="ident" id="6506231">dualStackServer</span><span class="op" id="6506246">{</span><span class="ident" id="6506247">lns</span><span class="op" id="6506250">:</span>&nbsp;<span class="ident" id="6506252">lns</span><span class="op" id="6506255">,</span>&nbsp;<span class="ident" id="6506257">port</span><span class="op" id="6506261">:</span>&nbsp;<span class="string" id="6506263">&#34;0&#34;</span><span class="op" id="6506266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506269">for</span>&nbsp;<span class="ident" id="6506273">i</span>&nbsp;<span class="op" id="6506275">:=</span>&nbsp;<span class="keyword" id="6506278">range</span>&nbsp;<span class="ident" id="6506284">dss</span><span class="op" id="6506287">.</span><span class="ident" id="6506288">lns</span>&nbsp;<span class="op" id="6506292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506296">ln</span><span class="op" id="6506298">,</span>&nbsp;<span class="ident" id="6506300">err</span>&nbsp;<span class="op" id="6506304">:=</span>&nbsp;<span class="ident" id="6506307">Listen</span><span class="op" id="6506313">(</span><span class="ident" id="6506314">dss</span><span class="op" id="6506317">.</span><span class="ident" id="6506318">lns</span><span class="op" id="6506321">[</span><span class="ident" id="6506322">i</span><span class="op" id="6506323">]</span><span class="op" id="6506324">.</span><span class="ident" id="6506325">net</span><span class="op" id="6506328">,</span>&nbsp;<span class="ident" id="6506330">dss</span><span class="op" id="6506333">.</span><span class="ident" id="6506334">lns</span><span class="op" id="6506337">[</span><span class="ident" id="6506338">i</span><span class="op" id="6506339">]</span><span class="op" id="6506340">.</span><span class="ident" id="6506341">addr</span><span class="op" id="6506345">+</span><span class="string" id="6506346">&#34;:&#34;</span><span class="op" id="6506349">+</span><span class="ident" id="6506350">dss</span><span class="op" id="6506353">.</span><span class="ident" id="6506354">port</span><span class="op" id="6506358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506362">if</span>&nbsp;<span class="ident" id="6506365">err</span>&nbsp;<span class="op" id="6506369">!=</span>&nbsp;<span class="builtintype" id="6506372">nil</span>&nbsp;<span class="op" id="6506376">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506381">dss</span><span class="op" id="6506384">.</span><span class="ident" id="6506385">teardown</span><span class="op" id="6506393">(</span><span class="op" id="6506394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506399">return</span>&nbsp;<span class="builtintype" id="6506406">nil</span><span class="op" id="6506409">,</span>&nbsp;<span class="ident" id="6506411">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506421">dss</span><span class="op" id="6506424">.</span><span class="ident" id="6506425">lns</span><span class="op" id="6506428">[</span><span class="ident" id="6506429">i</span><span class="op" id="6506430">]</span><span class="op" id="6506431">.</span><span class="ident" id="6506432">ln</span>&nbsp;<span class="op" id="6506435">=</span>&nbsp;<span class="ident" id="6506437">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506442">if</span>&nbsp;<span class="ident" id="6506445">dss</span><span class="op" id="6506448">.</span><span class="ident" id="6506449">port</span>&nbsp;<span class="op" id="6506454">==</span>&nbsp;<span class="string" id="6506457">&#34;0&#34;</span>&nbsp;<span class="op" id="6506461">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506466">if</span>&nbsp;<span class="ident" id="6506469">_</span><span class="op" id="6506470">,</span>&nbsp;<span class="ident" id="6506472">dss</span><span class="op" id="6506475">.</span><span class="ident" id="6506476">port</span><span class="op" id="6506480">,</span>&nbsp;<span class="ident" id="6506482">err</span>&nbsp;<span class="op" id="6506486">=</span>&nbsp;<span class="ident" id="6506488">SplitHostPort</span><span class="op" id="6506501">(</span><span class="ident" id="6506502">ln</span><span class="op" id="6506504">.</span><span class="ident" id="6506505">Addr</span><span class="op" id="6506509">(</span><span class="op" id="6506510">)</span><span class="op" id="6506511">.</span><span class="ident" id="6506512">String</span><span class="op" id="6506518">(</span><span class="op" id="6506519">)</span><span class="op" id="6506520">)</span><span class="op" id="6506521">;</span>&nbsp;<span class="ident" id="6506523">err</span>&nbsp;<span class="op" id="6506527">!=</span>&nbsp;<span class="builtintype" id="6506530">nil</span>&nbsp;<span class="op" id="6506534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506540">dss</span><span class="op" id="6506543">.</span><span class="ident" id="6506544">teardown</span><span class="op" id="6506552">(</span><span class="op" id="6506553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506559">return</span>&nbsp;<span class="builtintype" id="6506566">nil</span><span class="op" id="6506569">,</span>&nbsp;<span class="ident" id="6506571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506582">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506588">return</span>&nbsp;<span class="ident" id="6506595">dss</span><span class="op" id="6506598">,</span>&nbsp;<span class="builtintype" id="6506600">nil</span><br>
<span class="lineno"></span><span class="op" id="6506604">}</span>
</div>
</body>
</html>
