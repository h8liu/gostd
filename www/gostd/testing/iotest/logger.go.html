<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html" class="current">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6119633">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6119688">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6119742">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6119793">package</span>&nbsp;<span class="ident" id="6119801">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6119809">import</span>&nbsp;<span class="op" id="6119816">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6119819">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6119825">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6119831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6119834">type</span>&nbsp;<span class="ident" id="6119839">writeLogger</span>&nbsp;<span class="keyword" id="6119851">struct</span>&nbsp;<span class="op" id="6119858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119861">prefix</span>&nbsp;<span class="builtintype" id="6119868">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119876">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6119883">io</span><span class="op" id="6119885">.</span><span class="ident" id="6119886">Writer</span><br>
<span class="lineno">15</span><span class="op" id="6119893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6119896">func</span>&nbsp;<span class="op" id="6119901">(</span><span class="ident" id="6119902">l</span>&nbsp;<span class="op" id="6119904">*</span><span class="ident" id="6119905">writeLogger</span><span class="op" id="6119916">)</span>&nbsp;<span class="ident" id="6119918">Write</span><span class="op" id="6119923">(</span><span class="ident" id="6119924">p</span>&nbsp;<span class="op" id="6119926">[</span><span class="op" id="6119927">]</span><span class="builtintype" id="6119928">byte</span><span class="op" id="6119932">)</span>&nbsp;<span class="op" id="6119934">(</span><span class="ident" id="6119935">n</span>&nbsp;<span class="builtintype" id="6119937">int</span><span class="op" id="6119940">,</span>&nbsp;<span class="ident" id="6119942">err</span>&nbsp;<span class="builtintype" id="6119946">error</span><span class="op" id="6119951">)</span>&nbsp;<span class="op" id="6119953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119956">n</span><span class="op" id="6119957">,</span>&nbsp;<span class="ident" id="6119959">err</span>&nbsp;<span class="op" id="6119963">=</span>&nbsp;<span class="ident" id="6119965">l</span><span class="op" id="6119966">.</span><span class="ident" id="6119967">w</span><span class="op" id="6119968">.</span><span class="ident" id="6119969">Write</span><span class="op" id="6119974">(</span><span class="ident" id="6119975">p</span><span class="op" id="6119976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6119979">if</span>&nbsp;<span class="ident" id="6119982">err</span>&nbsp;<span class="op" id="6119986">!=</span>&nbsp;<span class="ident" id="6119989">nil</span>&nbsp;<span class="op" id="6119993">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6119997">log</span><span class="op" id="6120000">.</span><span class="ident" id="6120001">Printf</span><span class="op" id="6120007">(</span><span class="string" id="6120008">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6120019">,</span>&nbsp;<span class="ident" id="6120021">l</span><span class="op" id="6120022">.</span><span class="ident" id="6120023">prefix</span><span class="op" id="6120029">,</span>&nbsp;<span class="ident" id="6120031">p</span><span class="op" id="6120032">[</span><span class="num" id="6120033">0</span><span class="op" id="6120034">:</span><span class="ident" id="6120035">n</span><span class="op" id="6120036">]</span><span class="op" id="6120037">,</span>&nbsp;<span class="ident" id="6120039">err</span><span class="op" id="6120042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6120045">}</span>&nbsp;<span class="keyword" id="6120047">else</span>&nbsp;<span class="op" id="6120052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120056">log</span><span class="op" id="6120059">.</span><span class="ident" id="6120060">Printf</span><span class="op" id="6120066">(</span><span class="string" id="6120067">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6120074">,</span>&nbsp;<span class="ident" id="6120076">l</span><span class="op" id="6120077">.</span><span class="ident" id="6120078">prefix</span><span class="op" id="6120084">,</span>&nbsp;<span class="ident" id="6120086">p</span><span class="op" id="6120087">[</span><span class="num" id="6120088">0</span><span class="op" id="6120089">:</span><span class="ident" id="6120090">n</span><span class="op" id="6120091">]</span><span class="op" id="6120092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6120095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6120098">return</span><br>
<span class="lineno">25</span><span class="op" id="6120105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6120108">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="6120170">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6120235">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="6120292">func</span>&nbsp;<span class="ident" id="6120297">NewWriteLogger</span><span class="op" id="6120311">(</span><span class="ident" id="6120312">prefix</span>&nbsp;<span class="builtintype" id="6120319">string</span><span class="op" id="6120325">,</span>&nbsp;<span class="ident" id="6120327">w</span>&nbsp;<span class="ident" id="6120329">io</span><span class="op" id="6120331">.</span><span class="ident" id="6120332">Writer</span><span class="op" id="6120338">)</span>&nbsp;<span class="ident" id="6120340">io</span><span class="op" id="6120342">.</span><span class="ident" id="6120343">Writer</span>&nbsp;<span class="op" id="6120350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6120353">return</span>&nbsp;<span class="op" id="6120360">&amp;</span><span class="ident" id="6120361">writeLogger</span><span class="op" id="6120372">{</span><span class="ident" id="6120373">prefix</span><span class="op" id="6120379">,</span>&nbsp;<span class="ident" id="6120381">w</span><span class="op" id="6120382">}</span><br>
<span class="lineno"></span><span class="op" id="6120384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6120387">type</span>&nbsp;<span class="ident" id="6120392">readLogger</span>&nbsp;<span class="keyword" id="6120403">struct</span>&nbsp;<span class="op" id="6120410">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120413">prefix</span>&nbsp;<span class="builtintype" id="6120420">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120428">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6120435">io</span><span class="op" id="6120437">.</span><span class="ident" id="6120438">Reader</span><br>
<span class="lineno"></span><span class="op" id="6120445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6120448">func</span>&nbsp;<span class="op" id="6120453">(</span><span class="ident" id="6120454">l</span>&nbsp;<span class="op" id="6120456">*</span><span class="ident" id="6120457">readLogger</span><span class="op" id="6120467">)</span>&nbsp;<span class="ident" id="6120469">Read</span><span class="op" id="6120473">(</span><span class="ident" id="6120474">p</span>&nbsp;<span class="op" id="6120476">[</span><span class="op" id="6120477">]</span><span class="builtintype" id="6120478">byte</span><span class="op" id="6120482">)</span>&nbsp;<span class="op" id="6120484">(</span><span class="ident" id="6120485">n</span>&nbsp;<span class="builtintype" id="6120487">int</span><span class="op" id="6120490">,</span>&nbsp;<span class="ident" id="6120492">err</span>&nbsp;<span class="builtintype" id="6120496">error</span><span class="op" id="6120501">)</span>&nbsp;<span class="op" id="6120503">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120506">n</span><span class="op" id="6120507">,</span>&nbsp;<span class="ident" id="6120509">err</span>&nbsp;<span class="op" id="6120513">=</span>&nbsp;<span class="ident" id="6120515">l</span><span class="op" id="6120516">.</span><span class="ident" id="6120517">r</span><span class="op" id="6120518">.</span><span class="ident" id="6120519">Read</span><span class="op" id="6120523">(</span><span class="ident" id="6120524">p</span><span class="op" id="6120525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6120528">if</span>&nbsp;<span class="ident" id="6120531">err</span>&nbsp;<span class="op" id="6120535">!=</span>&nbsp;<span class="ident" id="6120538">nil</span>&nbsp;<span class="op" id="6120542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120546">log</span><span class="op" id="6120549">.</span><span class="ident" id="6120550">Printf</span><span class="op" id="6120556">(</span><span class="string" id="6120557">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6120568">,</span>&nbsp;<span class="ident" id="6120570">l</span><span class="op" id="6120571">.</span><span class="ident" id="6120572">prefix</span><span class="op" id="6120578">,</span>&nbsp;<span class="ident" id="6120580">p</span><span class="op" id="6120581">[</span><span class="num" id="6120582">0</span><span class="op" id="6120583">:</span><span class="ident" id="6120584">n</span><span class="op" id="6120585">]</span><span class="op" id="6120586">,</span>&nbsp;<span class="ident" id="6120588">err</span><span class="op" id="6120591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6120594">}</span>&nbsp;<span class="keyword" id="6120596">else</span>&nbsp;<span class="op" id="6120601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6120605">log</span><span class="op" id="6120608">.</span><span class="ident" id="6120609">Printf</span><span class="op" id="6120615">(</span><span class="string" id="6120616">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6120623">,</span>&nbsp;<span class="ident" id="6120625">l</span><span class="op" id="6120626">.</span><span class="ident" id="6120627">prefix</span><span class="op" id="6120633">,</span>&nbsp;<span class="ident" id="6120635">p</span><span class="op" id="6120636">[</span><span class="num" id="6120637">0</span><span class="op" id="6120638">:</span><span class="ident" id="6120639">n</span><span class="op" id="6120640">]</span><span class="op" id="6120641">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6120644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6120647">return</span><br>
<span class="lineno"></span><span class="op" id="6120654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6120657">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="6120718">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6120781">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="6120838">func</span>&nbsp;<span class="ident" id="6120843">NewReadLogger</span><span class="op" id="6120856">(</span><span class="ident" id="6120857">prefix</span>&nbsp;<span class="builtintype" id="6120864">string</span><span class="op" id="6120870">,</span>&nbsp;<span class="ident" id="6120872">r</span>&nbsp;<span class="ident" id="6120874">io</span><span class="op" id="6120876">.</span><span class="ident" id="6120877">Reader</span><span class="op" id="6120883">)</span>&nbsp;<span class="ident" id="6120885">io</span><span class="op" id="6120887">.</span><span class="ident" id="6120888">Reader</span>&nbsp;<span class="op" id="6120895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6120898">return</span>&nbsp;<span class="op" id="6120905">&amp;</span><span class="ident" id="6120906">readLogger</span><span class="op" id="6120916">{</span><span class="ident" id="6120917">prefix</span><span class="op" id="6120923">,</span>&nbsp;<span class="ident" id="6120925">r</span><span class="op" id="6120926">}</span><br>
<span class="lineno"></span><span class="op" id="6120928">}</span>
</div>
</body>
</html>
