<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1981727">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1981782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1981836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1981887">package</span>&nbsp;<span class="ident" id="1981895">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1981904">import</span>&nbsp;<span class="op" id="1981911">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1981914">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1981923">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1981926">const</span>&nbsp;<span class="op" id="1981932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981935">debugMalloc</span>&nbsp;<span class="op" id="1981947">=</span>&nbsp;<span class="builtintype" id="1981949">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981957">flagNoScan</span>&nbsp;<span class="op" id="1981968">=</span>&nbsp;<span class="ident" id="1981970"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188191">_FlagNoScan</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981983">flagNoZero</span>&nbsp;<span class="op" id="1981994">=</span>&nbsp;<span class="ident" id="1981996"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188213">_FlagNoZero</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982010">maxTinySize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1982024">=</span>&nbsp;<span class="ident" id="1982026"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2185084">_TinySize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982037">tinySizeClass</span>&nbsp;<span class="op" id="1982051">=</span>&nbsp;<span class="ident" id="1982053"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2185105">_TinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982069">maxSmallSize</span>&nbsp;&nbsp;<span class="op" id="1982083">=</span>&nbsp;<span class="ident" id="1982085"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2185056">_MaxSmallSize</a></span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982101">pageShift</span>&nbsp;<span class="op" id="1982111">=</span>&nbsp;<span class="ident" id="1982113"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184961">_PageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982125">pageSize</span>&nbsp;&nbsp;<span class="op" id="1982135">=</span>&nbsp;<span class="ident" id="1982137"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184983">_PageSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982148">pageMask</span>&nbsp;&nbsp;<span class="op" id="1982158">=</span>&nbsp;<span class="ident" id="1982160"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2185006">_PageMask</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982172">bitsPerPointer</span>&nbsp;&nbsp;<span class="op" id="1982188">=</span>&nbsp;<span class="ident" id="1982190"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195289">_BitsPerPointer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982207">bitsMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982223">=</span>&nbsp;<span class="ident" id="1982225"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195315">_BitsMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982236">pointersPerByte</span>&nbsp;<span class="op" id="1982252">=</span>&nbsp;<span class="ident" id="1982254"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195335">_PointersPerByte</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982272">maxGCMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982288">=</span>&nbsp;<span class="ident" id="1982290"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195494">_MaxGCMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982302">bitsDead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982318">=</span>&nbsp;<span class="ident" id="1982320"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195362">_BitsDead</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982331">bitsPointer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982347">=</span>&nbsp;<span class="ident" id="1982349"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195404">_BitsPointer</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982364">mSpanInUse</span>&nbsp;<span class="op" id="1982375">=</span>&nbsp;<span class="ident" id="1982377"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2187042">_MSpanInUse</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982391">concurrentSweep</span>&nbsp;<span class="op" id="1982407">=</span>&nbsp;<span class="ident" id="1982409"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195650">_ConcurrentSweep</a></span>&nbsp;<span class="op" id="1982426">!=</span>&nbsp;<span class="num" id="1982429">0</span><br>
<span class="lineno">35</span><span class="op" id="1982431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1982434">//&nbsp;Page&nbsp;number&nbsp;(address&gt;&gt;pageShift)</span><br>
<span class="lineno"></span><span class="keyword" id="1982470">type</span>&nbsp;<span class="ident" id="1982475">pageID</span>&nbsp;<span class="builtintype" id="1982482">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="1982491">//&nbsp;base&nbsp;address&nbsp;for&nbsp;all&nbsp;0-byte&nbsp;allocations</span><br>
<span class="lineno"></span><span class="keyword" id="1982534">var</span>&nbsp;<span class="ident" id="1982538">zerobase</span>&nbsp;<span class="builtintype" id="1982547">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1982556">//&nbsp;Allocate&nbsp;an&nbsp;object&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1982593">//&nbsp;Small&nbsp;objects&nbsp;are&nbsp;allocated&nbsp;from&nbsp;the&nbsp;per-P&nbsp;cache&#39;s&nbsp;free&nbsp;lists.</span><br>
<span class="lineno">45</span><span class="comment" id="1982659">//&nbsp;Large&nbsp;objects&nbsp;(&gt;&nbsp;32&nbsp;kB)&nbsp;are&nbsp;allocated&nbsp;straight&nbsp;from&nbsp;the&nbsp;heap.</span><br>
<span class="lineno"></span><span class="keyword" id="1982724">func</span>&nbsp;<span class="ident" id="1982729">mallocgc</span><span class="op" id="1982737">(</span><span class="ident" id="1982738">size</span>&nbsp;<span class="builtintype" id="1982743">uintptr</span><span class="op" id="1982750">,</span>&nbsp;<span class="ident" id="1982752">typ</span>&nbsp;<span class="op" id="1982756">*</span><span class="ident" id="1982757"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="1982762">,</span>&nbsp;<span class="ident" id="1982764">flags</span>&nbsp;<span class="builtintype" id="1982770">uint32</span><span class="op" id="1982776">)</span>&nbsp;<span class="ident" id="1982778"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1982784">.</span><span class="ident" id="1982785">Pointer</span>&nbsp;<span class="op" id="1982793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982796">if</span>&nbsp;<span class="ident" id="1982799"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1982804">==</span>&nbsp;<span class="num" id="1982807">0</span>&nbsp;<span class="op" id="1982809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982813">return</span>&nbsp;<span class="ident" id="1982820"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1982826">.</span><span class="ident" id="1982827">Pointer</span><span class="op" id="1982834">(</span><span class="op" id="1982835">&amp;</span><span class="ident" id="1982836"><a href="/runtime/malloc.go.html#1982538">zerobase</a></span><span class="op" id="1982844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982847">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982850">size0</span>&nbsp;<span class="op" id="1982856">:=</span>&nbsp;<span class="ident" id="1982859"><a href="/runtime/malloc.go.html#1982738">size</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982866">if</span>&nbsp;<span class="ident" id="1982869"><a href="/runtime/malloc.go.html#1982764">flags</a></span><span class="op" id="1982874">&amp;</span><span class="ident" id="1982875"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span>&nbsp;<span class="op" id="1982886">==</span>&nbsp;<span class="num" id="1982889">0</span>&nbsp;<span class="op" id="1982891">&amp;&amp;</span>&nbsp;<span class="ident" id="1982894"><a href="/runtime/malloc.go.html#1982752">typ</a></span>&nbsp;<span class="op" id="1982898">==</span>&nbsp;<span class="ident" id="1982901">nil</span>&nbsp;<span class="op" id="1982905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982909"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1982916">(</span><span class="string" id="1982917">&#34;malloc&nbsp;missing&nbsp;type&#34;</span><span class="op" id="1982938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982941">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1982945">//&nbsp;This&nbsp;function&nbsp;must&nbsp;be&nbsp;atomic&nbsp;wrt&nbsp;GC,&nbsp;but&nbsp;for&nbsp;performance&nbsp;reasons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983014">//&nbsp;we&nbsp;don&#39;t&nbsp;acquirem/releasem&nbsp;on&nbsp;fast&nbsp;path.&nbsp;The&nbsp;code&nbsp;below&nbsp;does&nbsp;not&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983088">//&nbsp;split&nbsp;stack&nbsp;checks,&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;preempted&nbsp;by&nbsp;GC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983144">//&nbsp;Functions&nbsp;like&nbsp;roundup/add&nbsp;are&nbsp;inlined.&nbsp;And&nbsp;onM/racemalloc&nbsp;are&nbsp;nosplit.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983220">//&nbsp;If&nbsp;debugMalloc&nbsp;=&nbsp;true,&nbsp;these&nbsp;assumptions&nbsp;are&nbsp;checked&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983284">if</span>&nbsp;<span class="ident" id="1983287"><a href="/runtime/malloc.go.html#1981935">debugMalloc</a></span>&nbsp;<span class="op" id="1983299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983303">mp</span>&nbsp;<span class="op" id="1983306">:=</span>&nbsp;<span class="ident" id="1983309"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1983317">(</span><span class="op" id="1983318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983322">if</span>&nbsp;<span class="ident" id="1983325"><a href="/runtime/malloc.go.html#1983303">mp</a></span><span class="op" id="1983327">.</span><span class="ident" id="1983328">mallocing</span>&nbsp;<span class="op" id="1983338">!=</span>&nbsp;<span class="num" id="1983341">0</span>&nbsp;<span class="op" id="1983343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983348"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1983355">(</span><span class="string" id="1983356">&#34;malloc&nbsp;deadlock&#34;</span><span class="op" id="1983373">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983381"><a href="/runtime/malloc.go.html#1983303">mp</a></span><span class="op" id="1983383">.</span><span class="ident" id="1983384">mallocing</span>&nbsp;<span class="op" id="1983394">=</span>&nbsp;<span class="num" id="1983396">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983400">if</span>&nbsp;<span class="ident" id="1983403"><a href="/runtime/malloc.go.html#1983303">mp</a></span><span class="op" id="1983405">.</span><span class="ident" id="1983406">curg</span>&nbsp;<span class="op" id="1983411">!=</span>&nbsp;<span class="ident" id="1983414">nil</span>&nbsp;<span class="op" id="1983418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983423"><a href="/runtime/malloc.go.html#1983303">mp</a></span><span class="op" id="1983425">.</span><span class="ident" id="1983426">curg</span><span class="op" id="1983430">.</span><span class="ident" id="1983431">stackguard0</span>&nbsp;<span class="op" id="1983443">=</span>&nbsp;<span class="op" id="1983445">^</span><span class="builtintype" id="1983446">uintptr</span><span class="op" id="1983453">(</span><span class="num" id="1983454">0xfff</span><span class="op" id="1983459">)</span>&nbsp;<span class="op" id="1983461">|</span>&nbsp;<span class="num" id="1983463">0xbad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983471">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983478">c</span>&nbsp;<span class="op" id="1983480">:=</span>&nbsp;<span class="ident" id="1983483"><a href="/runtime/stubs.go.html#2132076">gomcache</a></span><span class="op" id="1983491">(</span><span class="op" id="1983492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983495">var</span>&nbsp;<span class="ident" id="1983499">s</span>&nbsp;<span class="op" id="1983501">*</span><span class="ident" id="1983502"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2187152">mspan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983509">var</span>&nbsp;<span class="ident" id="1983513">x</span>&nbsp;<span class="ident" id="1983515"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1983521">.</span><span class="ident" id="1983522">Pointer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983531">if</span>&nbsp;<span class="ident" id="1983534"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1983539">&lt;=</span>&nbsp;<span class="ident" id="1983542"><a href="/runtime/malloc.go.html#1982069">maxSmallSize</a></span>&nbsp;<span class="op" id="1983555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983559">if</span>&nbsp;<span class="ident" id="1983562"><a href="/runtime/malloc.go.html#1982764">flags</a></span><span class="op" id="1983567">&amp;</span><span class="ident" id="1983568"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span>&nbsp;<span class="op" id="1983579">!=</span>&nbsp;<span class="num" id="1983582">0</span>&nbsp;<span class="op" id="1983584">&amp;&amp;</span>&nbsp;<span class="ident" id="1983587"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1983592">&lt;</span>&nbsp;<span class="ident" id="1983594"><a href="/runtime/malloc.go.html#1982010">maxTinySize</a></span>&nbsp;<span class="op" id="1983606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983611">//&nbsp;Tiny&nbsp;allocator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983633">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983639">//&nbsp;Tiny&nbsp;allocator&nbsp;combines&nbsp;several&nbsp;tiny&nbsp;allocation&nbsp;requests</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983702">//&nbsp;into&nbsp;a&nbsp;single&nbsp;memory&nbsp;block.&nbsp;The&nbsp;resulting&nbsp;memory&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983763">//&nbsp;is&nbsp;freed&nbsp;when&nbsp;all&nbsp;subobjects&nbsp;are&nbsp;unreachable.&nbsp;The&nbsp;subobjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983830">//&nbsp;must&nbsp;be&nbsp;FlagNoScan&nbsp;(don&#39;t&nbsp;have&nbsp;pointers),&nbsp;this&nbsp;ensures&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983896">//&nbsp;the&nbsp;amount&nbsp;of&nbsp;potentially&nbsp;wasted&nbsp;memory&nbsp;is&nbsp;bounded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983954">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983960">//&nbsp;Size&nbsp;of&nbsp;the&nbsp;memory&nbsp;block&nbsp;used&nbsp;for&nbsp;combining&nbsp;(maxTinySize)&nbsp;is&nbsp;tunable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984036">//&nbsp;Current&nbsp;setting&nbsp;is&nbsp;16&nbsp;bytes,&nbsp;which&nbsp;relates&nbsp;to&nbsp;2x&nbsp;worst&nbsp;case&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984109">//&nbsp;wastage&nbsp;(when&nbsp;all&nbsp;but&nbsp;one&nbsp;subobjects&nbsp;are&nbsp;unreachable).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984170">//&nbsp;8&nbsp;bytes&nbsp;would&nbsp;result&nbsp;in&nbsp;no&nbsp;wastage&nbsp;at&nbsp;all,&nbsp;but&nbsp;provides&nbsp;less</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984237">//&nbsp;opportunities&nbsp;for&nbsp;combining.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984272">//&nbsp;32&nbsp;bytes&nbsp;provides&nbsp;more&nbsp;opportunities&nbsp;for&nbsp;combining,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984330">//&nbsp;but&nbsp;can&nbsp;lead&nbsp;to&nbsp;4x&nbsp;worst&nbsp;case&nbsp;wastage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984375">//&nbsp;The&nbsp;best&nbsp;case&nbsp;winning&nbsp;is&nbsp;8x&nbsp;regardless&nbsp;of&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984435">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984441">//&nbsp;Objects&nbsp;obtained&nbsp;from&nbsp;tiny&nbsp;allocator&nbsp;must&nbsp;not&nbsp;be&nbsp;freed&nbsp;explicitly.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984514">//&nbsp;So&nbsp;when&nbsp;an&nbsp;object&nbsp;will&nbsp;be&nbsp;freed&nbsp;explicitly,&nbsp;we&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984579">//&nbsp;its&nbsp;size&nbsp;&gt;=&nbsp;maxTinySize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984610">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984616">//&nbsp;SetFinalizer&nbsp;has&nbsp;a&nbsp;special&nbsp;case&nbsp;for&nbsp;objects&nbsp;potentially&nbsp;coming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984685">//&nbsp;from&nbsp;tiny&nbsp;allocator,&nbsp;it&nbsp;such&nbsp;case&nbsp;it&nbsp;allows&nbsp;to&nbsp;set&nbsp;finalizers</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984753">//&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte&nbsp;of&nbsp;a&nbsp;memory&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984796">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984802">//&nbsp;The&nbsp;main&nbsp;targets&nbsp;of&nbsp;tiny&nbsp;allocator&nbsp;are&nbsp;small&nbsp;strings&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984865">//&nbsp;standalone&nbsp;escaping&nbsp;variables.&nbsp;On&nbsp;a&nbsp;json&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984922">//&nbsp;the&nbsp;allocator&nbsp;reduces&nbsp;number&nbsp;of&nbsp;allocations&nbsp;by&nbsp;~12%&nbsp;and</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984984">//&nbsp;reduces&nbsp;heap&nbsp;size&nbsp;by&nbsp;~20%.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985017">tinysize</span>&nbsp;<span class="op" id="1985026">:=</span>&nbsp;<span class="builtintype" id="1985029">uintptr</span><span class="op" id="1985036">(</span><span class="ident" id="1985037"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985038">.</span><span class="ident" id="1985039">tinysize</span><span class="op" id="1985047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985052">if</span>&nbsp;<span class="ident" id="1985055"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1985060">&lt;=</span>&nbsp;<span class="ident" id="1985063"><a href="/runtime/malloc.go.html#1985017">tinysize</a></span>&nbsp;<span class="op" id="1985072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985078">tiny</span>&nbsp;<span class="op" id="1985083">:=</span>&nbsp;<span class="ident" id="1985086"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1985092">.</span><span class="ident" id="1985093">Pointer</span><span class="op" id="1985100">(</span><span class="ident" id="1985101"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985102">.</span><span class="ident" id="1985103">tiny</span><span class="op" id="1985107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1985113">//&nbsp;Align&nbsp;tiny&nbsp;pointer&nbsp;for&nbsp;required&nbsp;(conservative)&nbsp;alignment.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985178">if</span>&nbsp;<span class="ident" id="1985181"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1985185">&amp;</span><span class="num" id="1985186">7</span>&nbsp;<span class="op" id="1985188">==</span>&nbsp;<span class="num" id="1985191">0</span>&nbsp;<span class="op" id="1985193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985200"><a href="/runtime/malloc.go.html#1985078">tiny</a></span>&nbsp;<span class="op" id="1985205">=</span>&nbsp;<span class="ident" id="1985207"><a href="/runtime/stubs.go.html#2131868">roundup</a></span><span class="op" id="1985214">(</span><span class="ident" id="1985215"><a href="/runtime/malloc.go.html#1985078">tiny</a></span><span class="op" id="1985219">,</span>&nbsp;<span class="num" id="1985221">8</span><span class="op" id="1985222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985228">}</span>&nbsp;<span class="keyword" id="1985230">else</span>&nbsp;<span class="keyword" id="1985235">if</span>&nbsp;<span class="ident" id="1985238"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1985242">&amp;</span><span class="num" id="1985243">3</span>&nbsp;<span class="op" id="1985245">==</span>&nbsp;<span class="num" id="1985248">0</span>&nbsp;<span class="op" id="1985250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985257"><a href="/runtime/malloc.go.html#1985078">tiny</a></span>&nbsp;<span class="op" id="1985262">=</span>&nbsp;<span class="ident" id="1985264"><a href="/runtime/stubs.go.html#2131868">roundup</a></span><span class="op" id="1985271">(</span><span class="ident" id="1985272"><a href="/runtime/malloc.go.html#1985078">tiny</a></span><span class="op" id="1985276">,</span>&nbsp;<span class="num" id="1985278">4</span><span class="op" id="1985279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985285">}</span>&nbsp;<span class="keyword" id="1985287">else</span>&nbsp;<span class="keyword" id="1985292">if</span>&nbsp;<span class="ident" id="1985295"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1985299">&amp;</span><span class="num" id="1985300">1</span>&nbsp;<span class="op" id="1985302">==</span>&nbsp;<span class="num" id="1985305">0</span>&nbsp;<span class="op" id="1985307">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985314"><a href="/runtime/malloc.go.html#1985078">tiny</a></span>&nbsp;<span class="op" id="1985319">=</span>&nbsp;<span class="ident" id="1985321"><a href="/runtime/stubs.go.html#2131868">roundup</a></span><span class="op" id="1985328">(</span><span class="ident" id="1985329"><a href="/runtime/malloc.go.html#1985078">tiny</a></span><span class="op" id="1985333">,</span>&nbsp;<span class="num" id="1985335">2</span><span class="op" id="1985336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985348">size1</span>&nbsp;<span class="op" id="1985354">:=</span>&nbsp;<span class="ident" id="1985357"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1985362">+</span>&nbsp;<span class="op" id="1985364">(</span><span class="builtintype" id="1985365">uintptr</span><span class="op" id="1985372">(</span><span class="ident" id="1985373"><a href="/runtime/malloc.go.html#1985078">tiny</a></span><span class="op" id="1985377">)</span>&nbsp;<span class="op" id="1985379">-</span>&nbsp;<span class="builtintype" id="1985381">uintptr</span><span class="op" id="1985388">(</span><span class="ident" id="1985389"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1985395">.</span><span class="ident" id="1985396">Pointer</span><span class="op" id="1985403">(</span><span class="ident" id="1985404"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985405">.</span><span class="ident" id="1985406">tiny</span><span class="op" id="1985410">)</span><span class="op" id="1985411">)</span><span class="op" id="1985412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985418">if</span>&nbsp;<span class="ident" id="1985421"><a href="/runtime/malloc.go.html#1985348">size1</a></span>&nbsp;<span class="op" id="1985427">&lt;=</span>&nbsp;<span class="ident" id="1985430"><a href="/runtime/malloc.go.html#1985017">tinysize</a></span>&nbsp;<span class="op" id="1985439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1985446">//&nbsp;The&nbsp;object&nbsp;fits&nbsp;into&nbsp;existing&nbsp;tiny&nbsp;block.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985496"><a href="/runtime/malloc.go.html#1983513">x</a></span>&nbsp;<span class="op" id="1985498">=</span>&nbsp;<span class="ident" id="1985500"><a href="/runtime/malloc.go.html#1985078">tiny</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985510"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985511">.</span><span class="ident" id="1985512">tiny</span>&nbsp;<span class="op" id="1985517">=</span>&nbsp;<span class="op" id="1985519">(</span><span class="op" id="1985520">*</span><span class="builtintype" id="1985521">byte</span><span class="op" id="1985525">)</span><span class="op" id="1985526">(</span><span class="ident" id="1985527"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1985530">(</span><span class="ident" id="1985531"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1985532">,</span>&nbsp;<span class="ident" id="1985534"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1985538">)</span><span class="op" id="1985539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985546"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985547">.</span><span class="ident" id="1985548">tinysize</span>&nbsp;<span class="op" id="1985557">-=</span>&nbsp;<span class="builtintype" id="1985560">uintptr</span><span class="op" id="1985567">(</span><span class="ident" id="1985568"><a href="/runtime/malloc.go.html#1985348">size1</a></span><span class="op" id="1985573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985580"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1985581">.</span><span class="ident" id="1985582">local_tinyallocs</span><span class="op" id="1985598">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985606">if</span>&nbsp;<span class="ident" id="1985609"><a href="/runtime/malloc.go.html#1981935">debugMalloc</a></span>&nbsp;<span class="op" id="1985621">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985629">mp</span>&nbsp;<span class="op" id="1985632">:=</span>&nbsp;<span class="ident" id="1985635"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1985643">(</span><span class="op" id="1985644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985652">if</span>&nbsp;<span class="ident" id="1985655"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985657">.</span><span class="ident" id="1985658">mallocing</span>&nbsp;<span class="op" id="1985668">==</span>&nbsp;<span class="num" id="1985671">0</span>&nbsp;<span class="op" id="1985673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985682"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1985689">(</span><span class="string" id="1985690">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1985702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985718"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985720">.</span><span class="ident" id="1985721">mallocing</span>&nbsp;<span class="op" id="1985731">=</span>&nbsp;<span class="num" id="1985733">0</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985741">if</span>&nbsp;<span class="ident" id="1985744"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985746">.</span><span class="ident" id="1985747">curg</span>&nbsp;<span class="op" id="1985752">!=</span>&nbsp;<span class="ident" id="1985755">nil</span>&nbsp;<span class="op" id="1985759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985768"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985770">.</span><span class="ident" id="1985771">curg</span><span class="op" id="1985775">.</span><span class="ident" id="1985776">stackguard0</span>&nbsp;<span class="op" id="1985788">=</span>&nbsp;<span class="ident" id="1985790"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985792">.</span><span class="ident" id="1985793">curg</span><span class="op" id="1985797">.</span><span class="ident" id="1985798">stack</span><span class="op" id="1985803">.</span><span class="ident" id="1985804">lo</span>&nbsp;<span class="op" id="1985807">+</span>&nbsp;<span class="ident" id="1985809"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2194892">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1985835">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1985892">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985948"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1985956">(</span><span class="ident" id="1985957"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985967"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1985975">(</span><span class="ident" id="1985976"><a href="/runtime/malloc.go.html#1985629">mp</a></span><span class="op" id="1985978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985992">return</span>&nbsp;<span class="ident" id="1985999"><a href="/runtime/malloc.go.html#1983513">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986005">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1986015">//&nbsp;Allocate&nbsp;a&nbsp;new&nbsp;maxTinySize&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986055"><a href="/runtime/malloc.go.html#1983499">s</a></span>&nbsp;<span class="op" id="1986057">=</span>&nbsp;<span class="ident" id="1986059"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1986060">.</span><span class="ident" id="1986061">alloc</span><span class="op" id="1986066">[</span><span class="ident" id="1986067"><a href="/runtime/malloc.go.html#1982037">tinySizeClass</a></span><span class="op" id="1986080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986085">v</span>&nbsp;<span class="op" id="1986087">:=</span>&nbsp;<span class="ident" id="1986090"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1986091">.</span><span class="ident" id="1986092">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1986104">if</span>&nbsp;<span class="ident" id="1986107"><a href="/runtime/malloc.go.html#1986085">v</a></span>&nbsp;<span class="op" id="1986109">==</span>&nbsp;<span class="ident" id="1986112">nil</span>&nbsp;<span class="op" id="1986116">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986122">mp</span>&nbsp;<span class="op" id="1986125">:=</span>&nbsp;<span class="ident" id="1986128"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1986136">(</span><span class="op" id="1986137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986143"><a href="/runtime/malloc.go.html#1986122">mp</a></span><span class="op" id="1986145">.</span><span class="ident" id="1986146">scalararg</span><span class="op" id="1986155">[</span><span class="num" id="1986156">0</span><span class="op" id="1986157">]</span>&nbsp;<span class="op" id="1986159">=</span>&nbsp;<span class="ident" id="1986161"><a href="/runtime/malloc.go.html#1982037">tinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986179"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1986182">(</span><span class="ident" id="1986183"><a href="/runtime/stubs.go.html#2135243">mcacheRefill_m</a></span><span class="op" id="1986197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986203"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1986211">(</span><span class="ident" id="1986212"><a href="/runtime/malloc.go.html#1986122">mp</a></span><span class="op" id="1986214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986220"><a href="/runtime/malloc.go.html#1983499">s</a></span>&nbsp;<span class="op" id="1986222">=</span>&nbsp;<span class="ident" id="1986224"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1986225">.</span><span class="ident" id="1986226">alloc</span><span class="op" id="1986231">[</span><span class="ident" id="1986232"><a href="/runtime/malloc.go.html#1982037">tinySizeClass</a></span><span class="op" id="1986245">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986251"><a href="/runtime/malloc.go.html#1986085">v</a></span>&nbsp;<span class="op" id="1986253">=</span>&nbsp;<span class="ident" id="1986255"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1986256">.</span><span class="ident" id="1986257">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986274"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1986275">.</span><span class="ident" id="1986276">freelist</span>&nbsp;<span class="op" id="1986285">=</span>&nbsp;<span class="ident" id="1986287"><a href="/runtime/malloc.go.html#1986085">v</a></span><span class="op" id="1986288">.</span><span class="ident" id="1986289">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986297"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1986298">.</span><span class="ident" id="1986299">ref</span><span class="op" id="1986302">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1986308">//TODO:&nbsp;prefetch&nbsp;v.next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986335"><a href="/runtime/malloc.go.html#1983513">x</a></span>&nbsp;<span class="op" id="1986337">=</span>&nbsp;<span class="ident" id="1986339"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1986345">.</span><span class="ident" id="1986346">Pointer</span><span class="op" id="1986353">(</span><span class="ident" id="1986354"><a href="/runtime/malloc.go.html#1986085">v</a></span><span class="op" id="1986355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986360">(</span><span class="op" id="1986361">*</span><span class="op" id="1986362">[</span><span class="num" id="1986363">2</span><span class="op" id="1986364">]</span><span class="ident" id="1986365">uint64</span><span class="op" id="1986371">)</span><span class="op" id="1986372">(</span><span class="ident" id="1986373"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1986374">)</span><span class="op" id="1986375">[</span><span class="num" id="1986376">0</span><span class="op" id="1986377">]</span>&nbsp;<span class="op" id="1986379">=</span>&nbsp;<span class="num" id="1986381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986386">(</span><span class="op" id="1986387">*</span><span class="op" id="1986388">[</span><span class="num" id="1986389">2</span><span class="op" id="1986390">]</span><span class="ident" id="1986391">uint64</span><span class="op" id="1986397">)</span><span class="op" id="1986398">(</span><span class="ident" id="1986399"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1986400">)</span><span class="op" id="1986401">[</span><span class="num" id="1986402">1</span><span class="op" id="1986403">]</span>&nbsp;<span class="op" id="1986405">=</span>&nbsp;<span class="num" id="1986407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1986412">//&nbsp;See&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;replace&nbsp;the&nbsp;existing&nbsp;tiny&nbsp;block&nbsp;with&nbsp;the&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1986485">//&nbsp;based&nbsp;on&nbsp;amount&nbsp;of&nbsp;remaining&nbsp;free&nbsp;space.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1986532">if</span>&nbsp;<span class="ident" id="1986535"><a href="/runtime/malloc.go.html#1982010">maxTinySize</a></span><span class="op" id="1986546">-</span><span class="ident" id="1986547"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1986552">&gt;</span>&nbsp;<span class="ident" id="1986554"><a href="/runtime/malloc.go.html#1985017">tinysize</a></span>&nbsp;<span class="op" id="1986563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986569"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1986570">.</span><span class="ident" id="1986571">tiny</span>&nbsp;<span class="op" id="1986576">=</span>&nbsp;<span class="op" id="1986578">(</span><span class="op" id="1986579">*</span><span class="builtintype" id="1986580">byte</span><span class="op" id="1986584">)</span><span class="op" id="1986585">(</span><span class="ident" id="1986586"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1986589">(</span><span class="ident" id="1986590"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1986591">,</span>&nbsp;<span class="ident" id="1986593"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1986597">)</span><span class="op" id="1986598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986604"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1986605">.</span><span class="ident" id="1986606">tinysize</span>&nbsp;<span class="op" id="1986615">=</span>&nbsp;<span class="builtintype" id="1986617">uintptr</span><span class="op" id="1986624">(</span><span class="ident" id="1986625"><a href="/runtime/malloc.go.html#1982010">maxTinySize</a></span>&nbsp;<span class="op" id="1986637">-</span>&nbsp;<span class="ident" id="1986639"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1986643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986653"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1986658">=</span>&nbsp;<span class="ident" id="1986660"><a href="/runtime/malloc.go.html#1982010">maxTinySize</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986674">}</span>&nbsp;<span class="keyword" id="1986676">else</span>&nbsp;<span class="op" id="1986681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1986686">var</span>&nbsp;<span class="ident" id="1986690">sizeclass</span>&nbsp;<span class="builtintype" id="1986700">int8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1986708">if</span>&nbsp;<span class="ident" id="1986711"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1986716">&lt;=</span>&nbsp;<span class="num" id="1986719">1024</span><span class="op" id="1986723">-</span><span class="num" id="1986724">8</span>&nbsp;<span class="op" id="1986726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986732"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span>&nbsp;<span class="op" id="1986742">=</span>&nbsp;<span class="ident" id="1986744"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186255">size_to_class8</a></span><span class="op" id="1986758">[</span><span class="op" id="1986759">(</span><span class="ident" id="1986760"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1986764">+</span><span class="num" id="1986765">7</span><span class="op" id="1986766">)</span><span class="op" id="1986767">&gt;&gt;</span><span class="num" id="1986769">3</span><span class="op" id="1986770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986775">}</span>&nbsp;<span class="keyword" id="1986777">else</span>&nbsp;<span class="op" id="1986782">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986788"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span>&nbsp;<span class="op" id="1986798">=</span>&nbsp;<span class="ident" id="1986800"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186284">size_to_class128</a></span><span class="op" id="1986816">[</span><span class="op" id="1986817">(</span><span class="ident" id="1986818"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1986822">-</span><span class="num" id="1986823">1024</span><span class="op" id="1986827">+</span><span class="num" id="1986828">127</span><span class="op" id="1986831">)</span><span class="op" id="1986832">&gt;&gt;</span><span class="num" id="1986834">7</span><span class="op" id="1986835">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1986840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986845"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1986850">=</span>&nbsp;<span class="builtintype" id="1986852">uintptr</span><span class="op" id="1986859">(</span><span class="ident" id="1986860"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186192">class_to_size</a></span><span class="op" id="1986873">[</span><span class="ident" id="1986874"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span><span class="op" id="1986883">]</span><span class="op" id="1986884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986889"><a href="/runtime/malloc.go.html#1983499">s</a></span>&nbsp;<span class="op" id="1986891">=</span>&nbsp;<span class="ident" id="1986893"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1986894">.</span><span class="ident" id="1986895">alloc</span><span class="op" id="1986900">[</span><span class="ident" id="1986901"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span><span class="op" id="1986910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986915">v</span>&nbsp;<span class="op" id="1986917">:=</span>&nbsp;<span class="ident" id="1986920"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1986921">.</span><span class="ident" id="1986922">freelist</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1986934">if</span>&nbsp;<span class="ident" id="1986937"><a href="/runtime/malloc.go.html#1986915">v</a></span>&nbsp;<span class="op" id="1986939">==</span>&nbsp;<span class="ident" id="1986942">nil</span>&nbsp;<span class="op" id="1986946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986952">mp</span>&nbsp;<span class="op" id="1986955">:=</span>&nbsp;<span class="ident" id="1986958"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1986966">(</span><span class="op" id="1986967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1986973"><a href="/runtime/malloc.go.html#1986952">mp</a></span><span class="op" id="1986975">.</span><span class="ident" id="1986976">scalararg</span><span class="op" id="1986985">[</span><span class="num" id="1986986">0</span><span class="op" id="1986987">]</span>&nbsp;<span class="op" id="1986989">=</span>&nbsp;<span class="builtintype" id="1986991">uintptr</span><span class="op" id="1986998">(</span><span class="ident" id="1986999"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span><span class="op" id="1987008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987014"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1987017">(</span><span class="ident" id="1987018"><a href="/runtime/stubs.go.html#2135243">mcacheRefill_m</a></span><span class="op" id="1987032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987038"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1987046">(</span><span class="ident" id="1987047"><a href="/runtime/malloc.go.html#1986952">mp</a></span><span class="op" id="1987049">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987055"><a href="/runtime/malloc.go.html#1983499">s</a></span>&nbsp;<span class="op" id="1987057">=</span>&nbsp;<span class="ident" id="1987059"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1987060">.</span><span class="ident" id="1987061">alloc</span><span class="op" id="1987066">[</span><span class="ident" id="1987067"><a href="/runtime/malloc.go.html#1986690">sizeclass</a></span><span class="op" id="1987076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987082"><a href="/runtime/malloc.go.html#1986915">v</a></span>&nbsp;<span class="op" id="1987084">=</span>&nbsp;<span class="ident" id="1987086"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1987087">.</span><span class="ident" id="1987088">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987105"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1987106">.</span><span class="ident" id="1987107">freelist</span>&nbsp;<span class="op" id="1987116">=</span>&nbsp;<span class="ident" id="1987118"><a href="/runtime/malloc.go.html#1986915">v</a></span><span class="op" id="1987119">.</span><span class="ident" id="1987120">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987128"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1987129">.</span><span class="ident" id="1987130">ref</span><span class="op" id="1987133">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987139">//TODO:&nbsp;prefetch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987159"><a href="/runtime/malloc.go.html#1983513">x</a></span>&nbsp;<span class="op" id="1987161">=</span>&nbsp;<span class="ident" id="1987163"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1987169">.</span><span class="ident" id="1987170">Pointer</span><span class="op" id="1987177">(</span><span class="ident" id="1987178"><a href="/runtime/malloc.go.html#1986915">v</a></span><span class="op" id="1987179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1987184">if</span>&nbsp;<span class="ident" id="1987187"><a href="/runtime/malloc.go.html#1982764">flags</a></span><span class="op" id="1987192">&amp;</span><span class="ident" id="1987193"><a href="/runtime/malloc.go.html#1981983">flagNoZero</a></span>&nbsp;<span class="op" id="1987204">==</span>&nbsp;<span class="num" id="1987207">0</span>&nbsp;<span class="op" id="1987209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987215"><a href="/runtime/malloc.go.html#1986915">v</a></span><span class="op" id="1987216">.</span><span class="ident" id="1987217">next</span>&nbsp;<span class="op" id="1987222">=</span>&nbsp;<span class="ident" id="1987224">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1987232">if</span>&nbsp;<span class="ident" id="1987235"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1987240">&gt;</span>&nbsp;<span class="num" id="1987242">2</span><span class="op" id="1987243">*</span><span class="ident" id="1987244"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1987252">&amp;&amp;</span>&nbsp;<span class="op" id="1987255">(</span><span class="op" id="1987256">(</span><span class="op" id="1987257">*</span><span class="op" id="1987258">[</span><span class="num" id="1987259">2</span><span class="op" id="1987260">]</span><span class="builtintype" id="1987261">uintptr</span><span class="op" id="1987268">)</span><span class="op" id="1987269">(</span><span class="ident" id="1987270"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1987271">)</span><span class="op" id="1987272">)</span><span class="op" id="1987273">[</span><span class="num" id="1987274">1</span><span class="op" id="1987275">]</span>&nbsp;<span class="op" id="1987277">!=</span>&nbsp;<span class="num" id="1987280">0</span>&nbsp;<span class="op" id="1987282">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987289"><a href="/runtime/stubs.go.html#2135687">memclr</a></span><span class="op" id="1987295">(</span><span class="ident" id="1987296"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1987302">.</span><span class="ident" id="1987303">Pointer</span><span class="op" id="1987310">(</span><span class="ident" id="1987311"><a href="/runtime/malloc.go.html#1986915">v</a></span><span class="op" id="1987312">)</span><span class="op" id="1987313">,</span>&nbsp;<span class="ident" id="1987315"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1987319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987338"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1987339">.</span><span class="ident" id="1987340">local_cachealloc</span>&nbsp;<span class="op" id="1987357">+=</span>&nbsp;<span class="ident" id="1987360"><a href="/runtime/arch_amd64.go.html#1873785">intptr</a></span><span class="op" id="1987366">(</span><span class="ident" id="1987367"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1987371">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987374">}</span>&nbsp;<span class="keyword" id="1987376">else</span>&nbsp;<span class="op" id="1987381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987385">mp</span>&nbsp;<span class="op" id="1987388">:=</span>&nbsp;<span class="ident" id="1987391"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1987399">(</span><span class="op" id="1987400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987404"><a href="/runtime/malloc.go.html#1987385">mp</a></span><span class="op" id="1987406">.</span><span class="ident" id="1987407">scalararg</span><span class="op" id="1987416">[</span><span class="num" id="1987417">0</span><span class="op" id="1987418">]</span>&nbsp;<span class="op" id="1987420">=</span>&nbsp;<span class="builtintype" id="1987422">uintptr</span><span class="op" id="1987429">(</span><span class="ident" id="1987430"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1987434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987438"><a href="/runtime/malloc.go.html#1987385">mp</a></span><span class="op" id="1987440">.</span><span class="ident" id="1987441">scalararg</span><span class="op" id="1987450">[</span><span class="num" id="1987451">1</span><span class="op" id="1987452">]</span>&nbsp;<span class="op" id="1987454">=</span>&nbsp;<span class="builtintype" id="1987456">uintptr</span><span class="op" id="1987463">(</span><span class="ident" id="1987464"><a href="/runtime/malloc.go.html#1982764">flags</a></span><span class="op" id="1987469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987473"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1987476">(</span><span class="ident" id="1987477"><a href="/runtime/stubs.go.html#2135265">largeAlloc_m</a></span><span class="op" id="1987489">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987493"><a href="/runtime/malloc.go.html#1983499">s</a></span>&nbsp;<span class="op" id="1987495">=</span>&nbsp;<span class="op" id="1987497">(</span><span class="op" id="1987498">*</span><span class="ident" id="1987499"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2187152">mspan</a></span><span class="op" id="1987504">)</span><span class="op" id="1987505">(</span><span class="ident" id="1987506"><a href="/runtime/malloc.go.html#1987385">mp</a></span><span class="op" id="1987508">.</span><span class="ident" id="1987509">ptrarg</span><span class="op" id="1987515">[</span><span class="num" id="1987516">0</span><span class="op" id="1987517">]</span><span class="op" id="1987518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987522"><a href="/runtime/malloc.go.html#1987385">mp</a></span><span class="op" id="1987524">.</span><span class="ident" id="1987525">ptrarg</span><span class="op" id="1987531">[</span><span class="num" id="1987532">0</span><span class="op" id="1987533">]</span>&nbsp;<span class="op" id="1987535">=</span>&nbsp;<span class="ident" id="1987537">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987543"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1987551">(</span><span class="ident" id="1987552"><a href="/runtime/malloc.go.html#1987385">mp</a></span><span class="op" id="1987554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987558"><a href="/runtime/malloc.go.html#1983513">x</a></span>&nbsp;<span class="op" id="1987560">=</span>&nbsp;<span class="ident" id="1987562"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1987568">.</span><span class="ident" id="1987569">Pointer</span><span class="op" id="1987576">(</span><span class="builtintype" id="1987577">uintptr</span><span class="op" id="1987584">(</span><span class="ident" id="1987585"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1987586">.</span><span class="ident" id="1987587">start</span>&nbsp;<span class="op" id="1987593">&lt;&lt;</span>&nbsp;<span class="ident" id="1987596"><a href="/runtime/malloc.go.html#1982101">pageShift</a></span><span class="op" id="1987605">)</span><span class="op" id="1987606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1987610"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1987615">=</span>&nbsp;<span class="builtintype" id="1987617">uintptr</span><span class="op" id="1987624">(</span><span class="ident" id="1987625"><a href="/runtime/malloc.go.html#1983499">s</a></span><span class="op" id="1987626">.</span><span class="ident" id="1987627">elemsize</span><span class="op" id="1987635">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1987642">if</span>&nbsp;<span class="ident" id="1987645"><a href="/runtime/malloc.go.html#1982764">flags</a></span><span class="op" id="1987650">&amp;</span><span class="ident" id="1987651"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span>&nbsp;<span class="op" id="1987662">!=</span>&nbsp;<span class="num" id="1987665">0</span>&nbsp;<span class="op" id="1987667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987671">//&nbsp;All&nbsp;objects&nbsp;are&nbsp;pre-marked&nbsp;as&nbsp;noscan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1987714">goto</span>&nbsp;<span class="ident" id="1987719">marked</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1987727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987731">//&nbsp;If&nbsp;allocating&nbsp;a&nbsp;defer+arg&nbsp;block,&nbsp;now&nbsp;that&nbsp;we&#39;ve&nbsp;picked&nbsp;a&nbsp;malloc&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987804">//&nbsp;large&nbsp;enough&nbsp;to&nbsp;hold&nbsp;everything,&nbsp;cut&nbsp;the&nbsp;&#34;asked&nbsp;for&#34;&nbsp;size&nbsp;down&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987874">//&nbsp;just&nbsp;the&nbsp;defer&nbsp;header,&nbsp;so&nbsp;that&nbsp;the&nbsp;GC&nbsp;bitmap&nbsp;will&nbsp;record&nbsp;the&nbsp;arg&nbsp;block</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1987949">//&nbsp;as&nbsp;containing&nbsp;nothing&nbsp;at&nbsp;all&nbsp;(as&nbsp;if&nbsp;it&nbsp;were&nbsp;unused&nbsp;space&nbsp;at&nbsp;the&nbsp;end&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1988024">//&nbsp;a&nbsp;malloc&nbsp;block&nbsp;caused&nbsp;by&nbsp;size&nbsp;rounding).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1988069">//&nbsp;The&nbsp;defer&nbsp;arg&nbsp;areas&nbsp;are&nbsp;scanned&nbsp;as&nbsp;part&nbsp;of&nbsp;scanstack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988127">if</span>&nbsp;<span class="ident" id="1988130"><a href="/runtime/malloc.go.html#1982752">typ</a></span>&nbsp;<span class="op" id="1988134">==</span>&nbsp;<span class="ident" id="1988137"><a href="/runtime/panic.go.html#2048436">deferType</a></span>&nbsp;<span class="op" id="1988147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988151"><a href="/runtime/malloc.go.html#1982850">size0</a></span>&nbsp;<span class="op" id="1988157">=</span>&nbsp;<span class="ident" id="1988159"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1988165">.</span><span class="ident" id="1988166">Sizeof</span><span class="op" id="1988172">(</span><span class="ident" id="1988173"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2183803">_defer</a></span><span class="op" id="1988179">{</span><span class="op" id="1988180">}</span><span class="op" id="1988181">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1988184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1988188">//&nbsp;From&nbsp;here&nbsp;till&nbsp;marked&nbsp;label&nbsp;marking&nbsp;the&nbsp;object&nbsp;as&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1988252">//&nbsp;and&nbsp;storing&nbsp;type&nbsp;info&nbsp;in&nbsp;the&nbsp;GC&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1988296">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988300">arena_start</span>&nbsp;<span class="op" id="1988312">:=</span>&nbsp;<span class="builtintype" id="1988315">uintptr</span><span class="op" id="1988322">(</span><span class="ident" id="1988323"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1988329">.</span><span class="ident" id="1988330">Pointer</span><span class="op" id="1988337">(</span><span class="ident" id="1988338"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="1988344">.</span><span class="ident" id="1988345">arena_start</span><span class="op" id="1988356">)</span><span class="op" id="1988357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988361">off</span>&nbsp;<span class="op" id="1988365">:=</span>&nbsp;<span class="op" id="1988368">(</span><span class="builtintype" id="1988369">uintptr</span><span class="op" id="1988376">(</span><span class="ident" id="1988377"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1988378">)</span>&nbsp;<span class="op" id="1988380">-</span>&nbsp;<span class="ident" id="1988382"><a href="/runtime/malloc.go.html#1988300">arena_start</a></span><span class="op" id="1988393">)</span>&nbsp;<span class="op" id="1988395">/</span>&nbsp;<span class="ident" id="1988397"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988407">xbits</span>&nbsp;<span class="op" id="1988413">:=</span>&nbsp;<span class="op" id="1988416">(</span><span class="op" id="1988417">*</span><span class="builtintype" id="1988418">uint8</span><span class="op" id="1988423">)</span><span class="op" id="1988424">(</span><span class="ident" id="1988425"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1988431">.</span><span class="ident" id="1988432">Pointer</span><span class="op" id="1988439">(</span><span class="ident" id="1988440"><a href="/runtime/malloc.go.html#1988300">arena_start</a></span>&nbsp;<span class="op" id="1988452">-</span>&nbsp;<span class="ident" id="1988454"><a href="/runtime/malloc.go.html#1988361">off</a></span><span class="op" id="1988457">/</span><span class="ident" id="1988458"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195184">wordsPerBitmapByte</a></span>&nbsp;<span class="op" id="1988477">-</span>&nbsp;<span class="num" id="1988479">1</span><span class="op" id="1988480">)</span><span class="op" id="1988481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988485">shift</span>&nbsp;<span class="op" id="1988491">:=</span>&nbsp;<span class="op" id="1988494">(</span><span class="ident" id="1988495"><a href="/runtime/malloc.go.html#1988361">off</a></span>&nbsp;<span class="op" id="1988499">%</span>&nbsp;<span class="ident" id="1988501"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195184">wordsPerBitmapByte</a></span><span class="op" id="1988519">)</span>&nbsp;<span class="op" id="1988521">*</span>&nbsp;<span class="ident" id="1988523"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195167">gcBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988532">if</span>&nbsp;<span class="ident" id="1988535"><a href="/runtime/malloc.go.html#1981935">debugMalloc</a></span>&nbsp;<span class="op" id="1988547">&amp;&amp;</span>&nbsp;<span class="op" id="1988550">(</span><span class="op" id="1988551">(</span><span class="op" id="1988552">*</span><span class="ident" id="1988553"><a href="/runtime/malloc.go.html#1988407">xbits</a></span><span class="op" id="1988558">&gt;&gt;</span><span class="ident" id="1988560"><a href="/runtime/malloc.go.html#1988485">shift</a></span><span class="op" id="1988565">)</span><span class="op" id="1988566">&amp;</span><span class="op" id="1988567">(</span><span class="ident" id="1988568"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195558">bitMask</a></span><span class="op" id="1988575">|</span><span class="ident" id="1988576"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195576">bitPtrMask</a></span><span class="op" id="1988586">)</span><span class="op" id="1988587">)</span>&nbsp;<span class="op" id="1988589">!=</span>&nbsp;<span class="ident" id="1988592"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195516">bitBoundary</a></span>&nbsp;<span class="op" id="1988604">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1988609">println</span><span class="op" id="1988616">(</span><span class="string" id="1988617">&#34;runtime:&nbsp;bits&nbsp;=&#34;</span><span class="op" id="1988634">,</span>&nbsp;<span class="op" id="1988636">(</span><span class="op" id="1988637">*</span><span class="ident" id="1988638"><a href="/runtime/malloc.go.html#1988407">xbits</a></span><span class="op" id="1988643">&gt;&gt;</span><span class="ident" id="1988645"><a href="/runtime/malloc.go.html#1988485">shift</a></span><span class="op" id="1988650">)</span><span class="op" id="1988651">&amp;</span><span class="op" id="1988652">(</span><span class="ident" id="1988653"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195558">bitMask</a></span><span class="op" id="1988660">|</span><span class="ident" id="1988661"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195576">bitPtrMask</a></span><span class="op" id="1988671">)</span><span class="op" id="1988672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988677"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1988684">(</span><span class="string" id="1988685">&#34;bad&nbsp;bits&nbsp;in&nbsp;markallocated&#34;</span><span class="op" id="1988712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1988716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988721">var</span>&nbsp;<span class="ident" id="1988725">ti</span><span class="op" id="1988727">,</span>&nbsp;<span class="ident" id="1988729">te</span>&nbsp;<span class="builtintype" id="1988732">uintptr</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988742">var</span>&nbsp;<span class="ident" id="1988746">ptrmask</span>&nbsp;<span class="op" id="1988754">*</span><span class="builtintype" id="1988755">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988763">if</span>&nbsp;<span class="ident" id="1988766"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1988771">==</span>&nbsp;<span class="ident" id="1988774"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1988782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1988787">//&nbsp;It&#39;s&nbsp;one&nbsp;word&nbsp;and&nbsp;it&nbsp;has&nbsp;pointers,&nbsp;it&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1988850">*</span><span class="ident" id="1988851"><a href="/runtime/malloc.go.html#1988407">xbits</a></span>&nbsp;<span class="op" id="1988857">|=</span>&nbsp;<span class="op" id="1988860">(</span><span class="ident" id="1988861"><a href="/runtime/malloc.go.html#1982331">bitsPointer</a></span>&nbsp;<span class="op" id="1988873">&lt;&lt;</span>&nbsp;<span class="num" id="1988876">2</span><span class="op" id="1988877">)</span>&nbsp;<span class="op" id="1988879">&lt;&lt;</span>&nbsp;<span class="ident" id="1988882"><a href="/runtime/malloc.go.html#1988485">shift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988891">goto</span>&nbsp;<span class="ident" id="1988896">marked</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1988905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1988909">if</span>&nbsp;<span class="ident" id="1988912"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1988915">.</span><span class="ident" id="1988916">kind</span><span class="op" id="1988920">&amp;</span><span class="ident" id="1988921"><a href="/runtime/typekind.go.html#2178318">kindGCProg</a></span>&nbsp;<span class="op" id="1988932">!=</span>&nbsp;<span class="num" id="1988935">0</span>&nbsp;<span class="op" id="1988937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988942">nptr</span>&nbsp;<span class="op" id="1988947">:=</span>&nbsp;<span class="op" id="1988950">(</span><span class="builtintype" id="1988951">uintptr</span><span class="op" id="1988958">(</span><span class="ident" id="1988959"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1988962">.</span><span class="ident" id="1988963">size</span><span class="op" id="1988967">)</span>&nbsp;<span class="op" id="1988969">+</span>&nbsp;<span class="ident" id="1988971"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1988979">-</span>&nbsp;<span class="num" id="1988981">1</span><span class="op" id="1988982">)</span>&nbsp;<span class="op" id="1988984">/</span>&nbsp;<span class="ident" id="1988986"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1988997">masksize</span>&nbsp;<span class="op" id="1989006">:=</span>&nbsp;<span class="ident" id="1989009"><a href="/runtime/malloc.go.html#1988942">nptr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1989017">if</span>&nbsp;<span class="ident" id="1989020"><a href="/runtime/malloc.go.html#1988997">masksize</a></span><span class="op" id="1989028">%</span><span class="num" id="1989029">2</span>&nbsp;<span class="op" id="1989031">!=</span>&nbsp;<span class="num" id="1989034">0</span>&nbsp;<span class="op" id="1989036">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989042"><a href="/runtime/malloc.go.html#1988997">masksize</a></span>&nbsp;<span class="op" id="1989051">*=</span>&nbsp;<span class="num" id="1989054">2</span>&nbsp;<span class="comment" id="1989056">//&nbsp;repeated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1989071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989076"><a href="/runtime/malloc.go.html#1988997">masksize</a></span>&nbsp;<span class="op" id="1989085">=</span>&nbsp;<span class="ident" id="1989087"><a href="/runtime/malloc.go.html#1988997">masksize</a></span>&nbsp;<span class="op" id="1989096">*</span>&nbsp;<span class="ident" id="1989098"><a href="/runtime/malloc.go.html#1982236">pointersPerByte</a></span>&nbsp;<span class="op" id="1989114">/</span>&nbsp;<span class="num" id="1989116">8</span>&nbsp;<span class="comment" id="1989118">//&nbsp;4&nbsp;bits&nbsp;per&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989140"><a href="/runtime/malloc.go.html#1988997">masksize</a></span><span class="op" id="1989148">++</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1989182">//&nbsp;unroll&nbsp;flag&nbsp;in&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1989217">if</span>&nbsp;<span class="ident" id="1989220"><a href="/runtime/malloc.go.html#1988997">masksize</a></span>&nbsp;<span class="op" id="1989229">&gt;</span>&nbsp;<span class="ident" id="1989231"><a href="/runtime/malloc.go.html#1982272">maxGCMask</a></span>&nbsp;<span class="op" id="1989241">&amp;&amp;</span>&nbsp;<span class="ident" id="1989244"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1989247">.</span><span class="ident" id="1989248">gc</span><span class="op" id="1989250">[</span><span class="num" id="1989251">1</span><span class="op" id="1989252">]</span>&nbsp;<span class="op" id="1989254">!=</span>&nbsp;<span class="num" id="1989257">0</span>&nbsp;<span class="op" id="1989259">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1989265">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;too&nbsp;large,&nbsp;unroll&nbsp;the&nbsp;program&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1989326">//&nbsp;into&nbsp;the&nbsp;GC&nbsp;bitmap.&nbsp;It&#39;s&nbsp;7&nbsp;times&nbsp;slower&nbsp;than&nbsp;copying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1989386">//&nbsp;from&nbsp;the&nbsp;pre-unrolled&nbsp;mask,&nbsp;but&nbsp;saves&nbsp;1/16&nbsp;of&nbsp;type&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1989449">//&nbsp;memory&nbsp;for&nbsp;the&nbsp;mask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989477">mp</span>&nbsp;<span class="op" id="1989480">:=</span>&nbsp;<span class="ident" id="1989483"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1989491">(</span><span class="op" id="1989492">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989498"><a href="/runtime/malloc.go.html#1989477">mp</a></span><span class="op" id="1989500">.</span><span class="ident" id="1989501">ptrarg</span><span class="op" id="1989507">[</span><span class="num" id="1989508">0</span><span class="op" id="1989509">]</span>&nbsp;<span class="op" id="1989511">=</span>&nbsp;<span class="ident" id="1989513"><a href="/runtime/malloc.go.html#1983513">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989519"><a href="/runtime/malloc.go.html#1989477">mp</a></span><span class="op" id="1989521">.</span><span class="ident" id="1989522">ptrarg</span><span class="op" id="1989528">[</span><span class="num" id="1989529">1</span><span class="op" id="1989530">]</span>&nbsp;<span class="op" id="1989532">=</span>&nbsp;<span class="ident" id="1989534"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1989540">.</span><span class="ident" id="1989541">Pointer</span><span class="op" id="1989548">(</span><span class="ident" id="1989549"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1989552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989558"><a href="/runtime/malloc.go.html#1989477">mp</a></span><span class="op" id="1989560">.</span><span class="ident" id="1989561">scalararg</span><span class="op" id="1989570">[</span><span class="num" id="1989571">0</span><span class="op" id="1989572">]</span>&nbsp;<span class="op" id="1989574">=</span>&nbsp;<span class="builtintype" id="1989576">uintptr</span><span class="op" id="1989583">(</span><span class="ident" id="1989584"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1989588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989594"><a href="/runtime/malloc.go.html#1989477">mp</a></span><span class="op" id="1989596">.</span><span class="ident" id="1989597">scalararg</span><span class="op" id="1989606">[</span><span class="num" id="1989607">1</span><span class="op" id="1989608">]</span>&nbsp;<span class="op" id="1989610">=</span>&nbsp;<span class="builtintype" id="1989612">uintptr</span><span class="op" id="1989619">(</span><span class="ident" id="1989620"><a href="/runtime/malloc.go.html#1982850">size0</a></span><span class="op" id="1989625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989631"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1989634">(</span><span class="ident" id="1989635"><a href="/runtime/stubs.go.html#2135407">unrollgcproginplace_m</a></span><span class="op" id="1989656">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989662"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1989670">(</span><span class="ident" id="1989671"><a href="/runtime/malloc.go.html#1989477">mp</a></span><span class="op" id="1989673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1989679">goto</span>&nbsp;<span class="ident" id="1989684">marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1989694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989699"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span>&nbsp;<span class="op" id="1989707">=</span>&nbsp;<span class="op" id="1989709">(</span><span class="op" id="1989710">*</span><span class="builtintype" id="1989711">uint8</span><span class="op" id="1989716">)</span><span class="op" id="1989717">(</span><span class="ident" id="1989718"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1989724">.</span><span class="ident" id="1989725">Pointer</span><span class="op" id="1989732">(</span><span class="builtintype" id="1989733">uintptr</span><span class="op" id="1989740">(</span><span class="ident" id="1989741"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1989744">.</span><span class="ident" id="1989745">gc</span><span class="op" id="1989747">[</span><span class="num" id="1989748">0</span><span class="op" id="1989749">]</span><span class="op" id="1989750">)</span><span class="op" id="1989751">)</span><span class="op" id="1989752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1989757">//&nbsp;Check&nbsp;whether&nbsp;the&nbsp;program&nbsp;is&nbsp;already&nbsp;unrolled.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1989810">if</span>&nbsp;<span class="builtintype" id="1989813">uintptr</span><span class="op" id="1989820">(</span><span class="ident" id="1989821"><a href="/runtime/atomic.go.html#1874536">atomicloadp</a></span><span class="op" id="1989832">(</span><span class="ident" id="1989833"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1989839">.</span><span class="ident" id="1989840">Pointer</span><span class="op" id="1989847">(</span><span class="ident" id="1989848"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span><span class="op" id="1989855">)</span><span class="op" id="1989856">)</span><span class="op" id="1989857">)</span><span class="op" id="1989858">&amp;</span><span class="num" id="1989859">0xff</span>&nbsp;<span class="op" id="1989864">==</span>&nbsp;<span class="num" id="1989867">0</span>&nbsp;<span class="op" id="1989869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989875">mp</span>&nbsp;<span class="op" id="1989878">:=</span>&nbsp;<span class="ident" id="1989881"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1989889">(</span><span class="op" id="1989890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989896"><a href="/runtime/malloc.go.html#1989875">mp</a></span><span class="op" id="1989898">.</span><span class="ident" id="1989899">ptrarg</span><span class="op" id="1989905">[</span><span class="num" id="1989906">0</span><span class="op" id="1989907">]</span>&nbsp;<span class="op" id="1989909">=</span>&nbsp;<span class="ident" id="1989911"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1989917">.</span><span class="ident" id="1989918">Pointer</span><span class="op" id="1989925">(</span><span class="ident" id="1989926"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1989929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989935"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1989938">(</span><span class="ident" id="1989939"><a href="/runtime/stubs.go.html#2135385">unrollgcprog_m</a></span><span class="op" id="1989953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989959"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1989967">(</span><span class="ident" id="1989968"><a href="/runtime/malloc.go.html#1989875">mp</a></span><span class="op" id="1989970">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1989975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1989980"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span>&nbsp;<span class="op" id="1989988">=</span>&nbsp;<span class="op" id="1989990">(</span><span class="op" id="1989991">*</span><span class="builtintype" id="1989992">uint8</span><span class="op" id="1989997">)</span><span class="op" id="1989998">(</span><span class="ident" id="1989999"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1990002">(</span><span class="ident" id="1990003"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1990009">.</span><span class="ident" id="1990010">Pointer</span><span class="op" id="1990017">(</span><span class="ident" id="1990018"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span><span class="op" id="1990025">)</span><span class="op" id="1990026">,</span>&nbsp;<span class="num" id="1990028">1</span><span class="op" id="1990029">)</span><span class="op" id="1990030">)</span>&nbsp;<span class="comment" id="1990032">//&nbsp;skip&nbsp;the&nbsp;unroll&nbsp;flag&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990063">}</span>&nbsp;<span class="keyword" id="1990065">else</span>&nbsp;<span class="op" id="1990070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990075"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span>&nbsp;<span class="op" id="1990083">=</span>&nbsp;<span class="op" id="1990085">(</span><span class="op" id="1990086">*</span><span class="builtintype" id="1990087">uint8</span><span class="op" id="1990092">)</span><span class="op" id="1990093">(</span><span class="ident" id="1990094"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1990100">.</span><span class="ident" id="1990101">Pointer</span><span class="op" id="1990108">(</span><span class="ident" id="1990109"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1990112">.</span><span class="ident" id="1990113">gc</span><span class="op" id="1990115">[</span><span class="num" id="1990116">0</span><span class="op" id="1990117">]</span><span class="op" id="1990118">)</span><span class="op" id="1990119">)</span>&nbsp;<span class="comment" id="1990121">//&nbsp;pointer&nbsp;to&nbsp;unrolled&nbsp;mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990151">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990155">if</span>&nbsp;<span class="ident" id="1990158"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1990163">==</span>&nbsp;<span class="num" id="1990166">2</span><span class="op" id="1990167">*</span><span class="ident" id="1990168"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1990176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990181">*</span><span class="ident" id="1990182"><a href="/runtime/malloc.go.html#1988407">xbits</a></span>&nbsp;<span class="op" id="1990188">=</span>&nbsp;<span class="op" id="1990190">*</span><span class="ident" id="1990191"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span>&nbsp;<span class="op" id="1990199">|</span>&nbsp;<span class="ident" id="1990201"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195516">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990216">goto</span>&nbsp;<span class="ident" id="1990221">marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990234"><a href="/runtime/malloc.go.html#1988729">te</a></span>&nbsp;<span class="op" id="1990237">=</span>&nbsp;<span class="builtintype" id="1990239">uintptr</span><span class="op" id="1990246">(</span><span class="ident" id="1990247"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1990250">.</span><span class="ident" id="1990251">size</span><span class="op" id="1990255">)</span>&nbsp;<span class="op" id="1990257">/</span>&nbsp;<span class="ident" id="1990259"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1990269">//&nbsp;If&nbsp;the&nbsp;type&nbsp;occupies&nbsp;odd&nbsp;number&nbsp;of&nbsp;words,&nbsp;its&nbsp;mask&nbsp;is&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990338">if</span>&nbsp;<span class="ident" id="1990341"><a href="/runtime/malloc.go.html#1988729">te</a></span><span class="op" id="1990343">%</span><span class="num" id="1990344">2</span>&nbsp;<span class="op" id="1990346">==</span>&nbsp;<span class="num" id="1990349">0</span>&nbsp;<span class="op" id="1990351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990356"><a href="/runtime/malloc.go.html#1988729">te</a></span>&nbsp;<span class="op" id="1990359">/=</span>&nbsp;<span class="num" id="1990362">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1990370">//&nbsp;Copy&nbsp;pointer&nbsp;bitmask&nbsp;into&nbsp;the&nbsp;bitmap.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990413">for</span>&nbsp;<span class="ident" id="1990417">i</span>&nbsp;<span class="op" id="1990419">:=</span>&nbsp;<span class="builtintype" id="1990422">uintptr</span><span class="op" id="1990429">(</span><span class="num" id="1990430">0</span><span class="op" id="1990431">)</span><span class="op" id="1990432">;</span>&nbsp;<span class="ident" id="1990434"><a href="/runtime/malloc.go.html#1990417">i</a></span>&nbsp;<span class="op" id="1990436">&lt;</span>&nbsp;<span class="ident" id="1990438"><a href="/runtime/malloc.go.html#1982850">size0</a></span><span class="op" id="1990443">;</span>&nbsp;<span class="ident" id="1990445"><a href="/runtime/malloc.go.html#1990417">i</a></span>&nbsp;<span class="op" id="1990447">+=</span>&nbsp;<span class="num" id="1990450">2</span>&nbsp;<span class="op" id="1990452">*</span>&nbsp;<span class="ident" id="1990454"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1990462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990467">v</span>&nbsp;<span class="op" id="1990469">:=</span>&nbsp;<span class="op" id="1990472">*</span><span class="op" id="1990473">(</span><span class="op" id="1990474">*</span><span class="builtintype" id="1990475">uint8</span><span class="op" id="1990480">)</span><span class="op" id="1990481">(</span><span class="ident" id="1990482"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1990485">(</span><span class="ident" id="1990486"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1990492">.</span><span class="ident" id="1990493">Pointer</span><span class="op" id="1990500">(</span><span class="ident" id="1990501"><a href="/runtime/malloc.go.html#1988746">ptrmask</a></span><span class="op" id="1990508">)</span><span class="op" id="1990509">,</span>&nbsp;<span class="ident" id="1990511"><a href="/runtime/malloc.go.html#1988725">ti</a></span><span class="op" id="1990513">)</span><span class="op" id="1990514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990519"><a href="/runtime/malloc.go.html#1988725">ti</a></span><span class="op" id="1990521">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990527">if</span>&nbsp;<span class="ident" id="1990530"><a href="/runtime/malloc.go.html#1988725">ti</a></span>&nbsp;<span class="op" id="1990533">==</span>&nbsp;<span class="ident" id="1990536"><a href="/runtime/malloc.go.html#1988729">te</a></span>&nbsp;<span class="op" id="1990539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990545"><a href="/runtime/malloc.go.html#1988725">ti</a></span>&nbsp;<span class="op" id="1990548">=</span>&nbsp;<span class="num" id="1990550">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990560">if</span>&nbsp;<span class="ident" id="1990563"><a href="/runtime/malloc.go.html#1990417">i</a></span>&nbsp;<span class="op" id="1990565">==</span>&nbsp;<span class="num" id="1990568">0</span>&nbsp;<span class="op" id="1990570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990576"><a href="/runtime/malloc.go.html#1990467">v</a></span>&nbsp;<span class="op" id="1990578">|=</span>&nbsp;<span class="ident" id="1990581"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195516">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990601">if</span>&nbsp;<span class="ident" id="1990604"><a href="/runtime/malloc.go.html#1990417">i</a></span><span class="op" id="1990605">+</span><span class="ident" id="1990606"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="1990614">==</span>&nbsp;<span class="ident" id="1990617"><a href="/runtime/malloc.go.html#1982850">size0</a></span>&nbsp;<span class="op" id="1990623">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990629"><a href="/runtime/malloc.go.html#1990467">v</a></span>&nbsp;<span class="op" id="1990631">&amp;^=</span>&nbsp;<span class="builtintype" id="1990635">uint8</span><span class="op" id="1990640">(</span><span class="ident" id="1990641"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195576">bitPtrMask</a></span>&nbsp;<span class="op" id="1990652">&lt;&lt;</span>&nbsp;<span class="num" id="1990655">4</span><span class="op" id="1990656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990667">*</span><span class="ident" id="1990668"><a href="/runtime/malloc.go.html#1988407">xbits</a></span>&nbsp;<span class="op" id="1990674">=</span>&nbsp;<span class="ident" id="1990676"><a href="/runtime/malloc.go.html#1990467">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990681"><a href="/runtime/malloc.go.html#1988407">xbits</a></span>&nbsp;<span class="op" id="1990687">=</span>&nbsp;<span class="op" id="1990689">(</span><span class="op" id="1990690">*</span><span class="builtintype" id="1990691">byte</span><span class="op" id="1990695">)</span><span class="op" id="1990696">(</span><span class="ident" id="1990697"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="1990700">(</span><span class="ident" id="1990701"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1990707">.</span><span class="ident" id="1990708">Pointer</span><span class="op" id="1990715">(</span><span class="ident" id="1990716"><a href="/runtime/malloc.go.html#1988407">xbits</a></span><span class="op" id="1990721">)</span><span class="op" id="1990722">,</span>&nbsp;<span class="op" id="1990724">^</span><span class="builtintype" id="1990725">uintptr</span><span class="op" id="1990732">(</span><span class="num" id="1990733">0</span><span class="op" id="1990734">)</span><span class="op" id="1990735">)</span><span class="op" id="1990736">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990744">if</span>&nbsp;<span class="ident" id="1990747"><a href="/runtime/malloc.go.html#1982850">size0</a></span><span class="op" id="1990752">%</span><span class="op" id="1990753">(</span><span class="num" id="1990754">2</span><span class="op" id="1990755">*</span><span class="ident" id="1990756"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1990763">)</span>&nbsp;<span class="op" id="1990765">==</span>&nbsp;<span class="num" id="1990768">0</span>&nbsp;<span class="op" id="1990770">&amp;&amp;</span>&nbsp;<span class="ident" id="1990773"><a href="/runtime/malloc.go.html#1982850">size0</a></span>&nbsp;<span class="op" id="1990779">&lt;</span>&nbsp;<span class="ident" id="1990781"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1990786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1990791">//&nbsp;Mark&nbsp;the&nbsp;word&nbsp;after&nbsp;last&nbsp;object&#39;s&nbsp;word&nbsp;as&nbsp;bitsDead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990849">*</span><span class="ident" id="1990850"><a href="/runtime/malloc.go.html#1988407">xbits</a></span>&nbsp;<span class="op" id="1990856">=</span>&nbsp;<span class="ident" id="1990858"><a href="/runtime/malloc.go.html#1982302">bitsDead</a></span>&nbsp;<span class="op" id="1990867">&lt;&lt;</span>&nbsp;<span class="num" id="1990870">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990874">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990877">}</span><br>
<span class="lineno"></span><span class="ident" id="1990879">marked</span><span class="op" id="1990885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990888">if</span>&nbsp;<span class="ident" id="1990891"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1990903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990907"><a href="/runtime/race0.go.html#2071254">racemalloc</a></span><span class="op" id="1990917">(</span><span class="ident" id="1990918"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1990919">,</span>&nbsp;<span class="ident" id="1990921"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1990925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1990928">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990932">if</span>&nbsp;<span class="ident" id="1990935"><a href="/runtime/malloc.go.html#1981935">debugMalloc</a></span>&nbsp;<span class="op" id="1990947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990951">mp</span>&nbsp;<span class="op" id="1990954">:=</span>&nbsp;<span class="ident" id="1990957"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1990965">(</span><span class="op" id="1990966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1990970">if</span>&nbsp;<span class="ident" id="1990973"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1990975">.</span><span class="ident" id="1990976">mallocing</span>&nbsp;<span class="op" id="1990986">==</span>&nbsp;<span class="num" id="1990989">0</span>&nbsp;<span class="op" id="1990991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1990996"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1991003">(</span><span class="string" id="1991004">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1991016">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991024"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991026">.</span><span class="ident" id="1991027">mallocing</span>&nbsp;<span class="op" id="1991037">=</span>&nbsp;<span class="num" id="1991039">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991043">if</span>&nbsp;<span class="ident" id="1991046"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991048">.</span><span class="ident" id="1991049">curg</span>&nbsp;<span class="op" id="1991054">!=</span>&nbsp;<span class="ident" id="1991057">nil</span>&nbsp;<span class="op" id="1991061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991066"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991068">.</span><span class="ident" id="1991069">curg</span><span class="op" id="1991073">.</span><span class="ident" id="1991074">stackguard0</span>&nbsp;<span class="op" id="1991086">=</span>&nbsp;<span class="ident" id="1991088"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991090">.</span><span class="ident" id="1991091">curg</span><span class="op" id="1991095">.</span><span class="ident" id="1991096">stack</span><span class="op" id="1991101">.</span><span class="ident" id="1991102">lo</span>&nbsp;<span class="op" id="1991105">+</span>&nbsp;<span class="ident" id="1991107"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2194892">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991121">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1991125">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1991178">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991230"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1991238">(</span><span class="ident" id="1991239"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991245"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1991253">(</span><span class="ident" id="1991254"><a href="/runtime/malloc.go.html#1990951">mp</a></span><span class="op" id="1991256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991259">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991263">if</span>&nbsp;<span class="ident" id="1991266"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184573">debug</a></span><span class="op" id="1991271">.</span><span class="ident" id="1991272">allocfreetrace</span>&nbsp;<span class="op" id="1991287">!=</span>&nbsp;<span class="num" id="1991290">0</span>&nbsp;<span class="op" id="1991292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991296"><a href="/runtime/mprof.go.html#2028785">tracealloc</a></span><span class="op" id="1991306">(</span><span class="ident" id="1991307"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1991308">,</span>&nbsp;<span class="ident" id="1991310"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1991314">,</span>&nbsp;<span class="ident" id="1991316"><a href="/runtime/malloc.go.html#1982752">typ</a></span><span class="op" id="1991319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991326">if</span>&nbsp;<span class="ident" id="1991329">rate</span>&nbsp;<span class="op" id="1991334">:=</span>&nbsp;<span class="ident" id="1991337"><a href="/runtime/mprof.go.html#2021752">MemProfileRate</a></span><span class="op" id="1991351">;</span>&nbsp;<span class="ident" id="1991353"><a href="/runtime/malloc.go.html#1991329">rate</a></span>&nbsp;<span class="op" id="1991358">&gt;</span>&nbsp;<span class="num" id="1991360">0</span>&nbsp;<span class="op" id="1991362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991366">if</span>&nbsp;<span class="ident" id="1991369"><a href="/runtime/malloc.go.html#1982738">size</a></span>&nbsp;<span class="op" id="1991374">&lt;</span>&nbsp;<span class="builtintype" id="1991376">uintptr</span><span class="op" id="1991383">(</span><span class="ident" id="1991384"><a href="/runtime/malloc.go.html#1991329">rate</a></span><span class="op" id="1991388">)</span>&nbsp;<span class="op" id="1991390">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1991393">int32</span><span class="op" id="1991398">(</span><span class="ident" id="1991399"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1991403">)</span>&nbsp;<span class="op" id="1991405">&lt;</span>&nbsp;<span class="ident" id="1991407"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1991408">.</span><span class="ident" id="1991409">next_sample</span>&nbsp;<span class="op" id="1991421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991426"><a href="/runtime/malloc.go.html#1983478">c</a></span><span class="op" id="1991427">.</span><span class="ident" id="1991428">next_sample</span>&nbsp;<span class="op" id="1991440">-=</span>&nbsp;<span class="builtintype" id="1991443">int32</span><span class="op" id="1991448">(</span><span class="ident" id="1991449"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1991453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991457">}</span>&nbsp;<span class="keyword" id="1991459">else</span>&nbsp;<span class="op" id="1991464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991469">mp</span>&nbsp;<span class="op" id="1991472">:=</span>&nbsp;<span class="ident" id="1991475"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1991483">(</span><span class="op" id="1991484">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991489"><a href="/runtime/malloc.go.html#1992699">profilealloc</a></span><span class="op" id="1991501">(</span><span class="ident" id="1991502"><a href="/runtime/malloc.go.html#1991469">mp</a></span><span class="op" id="1991504">,</span>&nbsp;<span class="ident" id="1991506"><a href="/runtime/malloc.go.html#1983513">x</a></span><span class="op" id="1991507">,</span>&nbsp;<span class="ident" id="1991509"><a href="/runtime/malloc.go.html#1982738">size</a></span><span class="op" id="1991513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991518"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1991526">(</span><span class="ident" id="1991527"><a href="/runtime/malloc.go.html#1991469">mp</a></span><span class="op" id="1991529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991540">if</span>&nbsp;<span class="ident" id="1991543"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="1991551">.</span><span class="ident" id="1991552">heap_alloc</span>&nbsp;<span class="op" id="1991563">&gt;=</span>&nbsp;<span class="ident" id="1991566"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="1991574">.</span><span class="ident" id="1991575">next_gc</span>&nbsp;<span class="op" id="1991583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991587"><a href="/runtime/malloc.go.html#1993442">gogc</a></span><span class="op" id="1991591">(</span><span class="num" id="1991592">0</span><span class="op" id="1991593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991600">return</span>&nbsp;<span class="ident" id="1991607"><a href="/runtime/malloc.go.html#1983513">x</a></span><br>
<span class="lineno">345</span><span class="op" id="1991609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1991612">//&nbsp;implementation&nbsp;of&nbsp;new&nbsp;builtin</span><br>
<span class="lineno"></span><span class="keyword" id="1991645">func</span>&nbsp;<span class="ident" id="1991650">newobject</span><span class="op" id="1991659">(</span><span class="ident" id="1991660">typ</span>&nbsp;<span class="op" id="1991664">*</span><span class="ident" id="1991665"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="1991670">)</span>&nbsp;<span class="ident" id="1991672"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1991678">.</span><span class="ident" id="1991679">Pointer</span>&nbsp;<span class="op" id="1991687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991690">flags</span>&nbsp;<span class="op" id="1991696">:=</span>&nbsp;<span class="builtintype" id="1991699">uint32</span><span class="op" id="1991705">(</span><span class="num" id="1991706">0</span><span class="op" id="1991707">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991710">if</span>&nbsp;<span class="ident" id="1991713"><a href="/runtime/malloc.go.html#1991660">typ</a></span><span class="op" id="1991716">.</span><span class="ident" id="1991717">kind</span><span class="op" id="1991721">&amp;</span><span class="ident" id="1991722"><a href="/runtime/typekind.go.html#2178349">kindNoPointers</a></span>&nbsp;<span class="op" id="1991737">!=</span>&nbsp;<span class="num" id="1991740">0</span>&nbsp;<span class="op" id="1991742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991746"><a href="/runtime/malloc.go.html#1991690">flags</a></span>&nbsp;<span class="op" id="1991752">|=</span>&nbsp;<span class="ident" id="1991755"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991770">return</span>&nbsp;<span class="ident" id="1991777"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="1991785">(</span><span class="builtintype" id="1991786">uintptr</span><span class="op" id="1991793">(</span><span class="ident" id="1991794"><a href="/runtime/malloc.go.html#1991660">typ</a></span><span class="op" id="1991797">.</span><span class="ident" id="1991798">size</span><span class="op" id="1991802">)</span><span class="op" id="1991803">,</span>&nbsp;<span class="ident" id="1991805"><a href="/runtime/malloc.go.html#1991660">typ</a></span><span class="op" id="1991808">,</span>&nbsp;<span class="ident" id="1991810"><a href="/runtime/malloc.go.html#1991690">flags</a></span><span class="op" id="1991815">)</span><br>
<span class="lineno"></span><span class="op" id="1991817">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1991820">//&nbsp;implementation&nbsp;of&nbsp;make&nbsp;builtin&nbsp;for&nbsp;slices</span><br>
<span class="lineno"></span><span class="keyword" id="1991865">func</span>&nbsp;<span class="ident" id="1991870">newarray</span><span class="op" id="1991878">(</span><span class="ident" id="1991879">typ</span>&nbsp;<span class="op" id="1991883">*</span><span class="ident" id="1991884"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="1991889">,</span>&nbsp;<span class="ident" id="1991891">n</span>&nbsp;<span class="builtintype" id="1991893">uintptr</span><span class="op" id="1991900">)</span>&nbsp;<span class="ident" id="1991902"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1991908">.</span><span class="ident" id="1991909">Pointer</span>&nbsp;<span class="op" id="1991917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991920">flags</span>&nbsp;<span class="op" id="1991926">:=</span>&nbsp;<span class="builtintype" id="1991929">uint32</span><span class="op" id="1991935">(</span><span class="num" id="1991936">0</span><span class="op" id="1991937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1991940">if</span>&nbsp;<span class="ident" id="1991943"><a href="/runtime/malloc.go.html#1991879">typ</a></span><span class="op" id="1991946">.</span><span class="ident" id="1991947">kind</span><span class="op" id="1991951">&amp;</span><span class="ident" id="1991952"><a href="/runtime/typekind.go.html#2178349">kindNoPointers</a></span>&nbsp;<span class="op" id="1991967">!=</span>&nbsp;<span class="num" id="1991970">0</span>&nbsp;<span class="op" id="1991972">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1991976"><a href="/runtime/malloc.go.html#1991920">flags</a></span>&nbsp;<span class="op" id="1991982">|=</span>&nbsp;<span class="ident" id="1991985"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1991997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992000">if</span>&nbsp;<span class="builtintype" id="1992003">int</span><span class="op" id="1992006">(</span><span class="ident" id="1992007"><a href="/runtime/malloc.go.html#1991891">n</a></span><span class="op" id="1992008">)</span>&nbsp;<span class="op" id="1992010">&lt;</span>&nbsp;<span class="num" id="1992012">0</span>&nbsp;<span class="op" id="1992014">||</span>&nbsp;<span class="op" id="1992017">(</span><span class="ident" id="1992018"><a href="/runtime/malloc.go.html#1991879">typ</a></span><span class="op" id="1992021">.</span><span class="ident" id="1992022">size</span>&nbsp;<span class="op" id="1992027">&gt;</span>&nbsp;<span class="num" id="1992029">0</span>&nbsp;<span class="op" id="1992031">&amp;&amp;</span>&nbsp;<span class="ident" id="1992034"><a href="/runtime/malloc.go.html#1991891">n</a></span>&nbsp;<span class="op" id="1992036">&gt;</span>&nbsp;<span class="ident" id="1992038"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2194990">maxmem</a></span><span class="op" id="1992044">/</span><span class="builtintype" id="1992045">uintptr</span><span class="op" id="1992052">(</span><span class="ident" id="1992053"><a href="/runtime/malloc.go.html#1991879">typ</a></span><span class="op" id="1992056">.</span><span class="ident" id="1992057">size</span><span class="op" id="1992061">)</span><span class="op" id="1992062">)</span>&nbsp;<span class="op" id="1992064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1992068">panic</span><span class="op" id="1992073">(</span><span class="string" id="1992074">&#34;runtime:&nbsp;allocation&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1992113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1992116">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992119">return</span>&nbsp;<span class="ident" id="1992126"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="1992134">(</span><span class="builtintype" id="1992135">uintptr</span><span class="op" id="1992142">(</span><span class="ident" id="1992143"><a href="/runtime/malloc.go.html#1991879">typ</a></span><span class="op" id="1992146">.</span><span class="ident" id="1992147">size</span><span class="op" id="1992151">)</span><span class="op" id="1992152">*</span><span class="ident" id="1992153"><a href="/runtime/malloc.go.html#1991891">n</a></span><span class="op" id="1992154">,</span>&nbsp;<span class="ident" id="1992156"><a href="/runtime/malloc.go.html#1991879">typ</a></span><span class="op" id="1992159">,</span>&nbsp;<span class="ident" id="1992161"><a href="/runtime/malloc.go.html#1991920">flags</a></span><span class="op" id="1992166">)</span><br>
<span class="lineno"></span><span class="op" id="1992168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1992171">//&nbsp;rawmem&nbsp;returns&nbsp;a&nbsp;chunk&nbsp;of&nbsp;pointerless&nbsp;memory.&nbsp;&nbsp;It&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1992227">//&nbsp;not&nbsp;zeroed.</span><br>
<span class="lineno">370</span><span class="keyword" id="1992242">func</span>&nbsp;<span class="ident" id="1992247">rawmem</span><span class="op" id="1992253">(</span><span class="ident" id="1992254">size</span>&nbsp;<span class="builtintype" id="1992259">uintptr</span><span class="op" id="1992266">)</span>&nbsp;<span class="ident" id="1992268"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1992274">.</span><span class="ident" id="1992275">Pointer</span>&nbsp;<span class="op" id="1992283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992286">return</span>&nbsp;<span class="ident" id="1992293"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="1992301">(</span><span class="ident" id="1992302"><a href="/runtime/malloc.go.html#1992254">size</a></span><span class="op" id="1992306">,</span>&nbsp;<span class="ident" id="1992308">nil</span><span class="op" id="1992311">,</span>&nbsp;<span class="ident" id="1992313"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><span class="op" id="1992323">|</span><span class="ident" id="1992324"><a href="/runtime/malloc.go.html#1981983">flagNoZero</a></span><span class="op" id="1992334">)</span><br>
<span class="lineno"></span><span class="op" id="1992336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1992339">//&nbsp;round&nbsp;size&nbsp;up&nbsp;to&nbsp;next&nbsp;size&nbsp;class</span><br>
<span class="lineno">375</span><span class="keyword" id="1992375">func</span>&nbsp;<span class="ident" id="1992380">goroundupsize</span><span class="op" id="1992393">(</span><span class="ident" id="1992394">size</span>&nbsp;<span class="builtintype" id="1992399">uintptr</span><span class="op" id="1992406">)</span>&nbsp;<span class="builtintype" id="1992408">uintptr</span>&nbsp;<span class="op" id="1992416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992419">if</span>&nbsp;<span class="ident" id="1992422"><a href="/runtime/malloc.go.html#1992394">size</a></span>&nbsp;<span class="op" id="1992427">&lt;</span>&nbsp;<span class="ident" id="1992429"><a href="/runtime/malloc.go.html#1982069">maxSmallSize</a></span>&nbsp;<span class="op" id="1992442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992446">if</span>&nbsp;<span class="ident" id="1992449"><a href="/runtime/malloc.go.html#1992394">size</a></span>&nbsp;<span class="op" id="1992454">&lt;=</span>&nbsp;<span class="num" id="1992457">1024</span><span class="op" id="1992461">-</span><span class="num" id="1992462">8</span>&nbsp;<span class="op" id="1992464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992469">return</span>&nbsp;<span class="builtintype" id="1992476">uintptr</span><span class="op" id="1992483">(</span><span class="ident" id="1992484"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186192">class_to_size</a></span><span class="op" id="1992497">[</span><span class="ident" id="1992498"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186255">size_to_class8</a></span><span class="op" id="1992512">[</span><span class="op" id="1992513">(</span><span class="ident" id="1992514"><a href="/runtime/malloc.go.html#1992394">size</a></span><span class="op" id="1992518">+</span><span class="num" id="1992519">7</span><span class="op" id="1992520">)</span><span class="op" id="1992521">&gt;&gt;</span><span class="num" id="1992523">3</span><span class="op" id="1992524">]</span><span class="op" id="1992525">]</span><span class="op" id="1992526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1992530">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992534">return</span>&nbsp;<span class="builtintype" id="1992541">uintptr</span><span class="op" id="1992548">(</span><span class="ident" id="1992549"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186192">class_to_size</a></span><span class="op" id="1992562">[</span><span class="ident" id="1992563"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186284">size_to_class128</a></span><span class="op" id="1992579">[</span><span class="op" id="1992580">(</span><span class="ident" id="1992581"><a href="/runtime/malloc.go.html#1992394">size</a></span><span class="op" id="1992585">-</span><span class="num" id="1992586">1024</span><span class="op" id="1992590">+</span><span class="num" id="1992591">127</span><span class="op" id="1992594">)</span><span class="op" id="1992595">&gt;&gt;</span><span class="num" id="1992597">7</span><span class="op" id="1992598">]</span><span class="op" id="1992599">]</span><span class="op" id="1992600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1992603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992606">if</span>&nbsp;<span class="ident" id="1992609"><a href="/runtime/malloc.go.html#1992394">size</a></span><span class="op" id="1992613">+</span><span class="ident" id="1992614"><a href="/runtime/malloc.go.html#1982125">pageSize</a></span>&nbsp;<span class="op" id="1992623">&lt;</span>&nbsp;<span class="ident" id="1992625"><a href="/runtime/malloc.go.html#1992394">size</a></span>&nbsp;<span class="op" id="1992630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992634">return</span>&nbsp;<span class="ident" id="1992641"><a href="/runtime/malloc.go.html#1992394">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1992647">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992650">return</span>&nbsp;<span class="op" id="1992657">(</span><span class="ident" id="1992658"><a href="/runtime/malloc.go.html#1992394">size</a></span>&nbsp;<span class="op" id="1992663">+</span>&nbsp;<span class="ident" id="1992665"><a href="/runtime/malloc.go.html#1982125">pageSize</a></span>&nbsp;<span class="op" id="1992674">-</span>&nbsp;<span class="num" id="1992676">1</span><span class="op" id="1992677">)</span>&nbsp;<span class="op" id="1992679">&amp;^</span>&nbsp;<span class="ident" id="1992682"><a href="/runtime/malloc.go.html#1982148">pageMask</a></span><br>
<span class="lineno"></span><span class="op" id="1992691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1992694">func</span>&nbsp;<span class="ident" id="1992699">profilealloc</span><span class="op" id="1992711">(</span><span class="ident" id="1992712">mp</span>&nbsp;<span class="op" id="1992715">*</span><span class="ident" id="1992716"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180912">m</a></span><span class="op" id="1992717">,</span>&nbsp;<span class="ident" id="1992719">x</span>&nbsp;<span class="ident" id="1992721"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1992727">.</span><span class="ident" id="1992728">Pointer</span><span class="op" id="1992735">,</span>&nbsp;<span class="ident" id="1992737">size</span>&nbsp;<span class="builtintype" id="1992742">uintptr</span><span class="op" id="1992749">)</span>&nbsp;<span class="op" id="1992751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992754">c</span>&nbsp;<span class="op" id="1992756">:=</span>&nbsp;<span class="ident" id="1992759"><a href="/runtime/malloc.go.html#1992712">mp</a></span><span class="op" id="1992761">.</span><span class="ident" id="1992762">mcache</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992770">rate</span>&nbsp;<span class="op" id="1992775">:=</span>&nbsp;<span class="ident" id="1992778"><a href="/runtime/mprof.go.html#2021752">MemProfileRate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992794">if</span>&nbsp;<span class="ident" id="1992797"><a href="/runtime/malloc.go.html#1992737">size</a></span>&nbsp;<span class="op" id="1992802">&lt;</span>&nbsp;<span class="builtintype" id="1992804">uintptr</span><span class="op" id="1992811">(</span><span class="ident" id="1992812"><a href="/runtime/malloc.go.html#1992770">rate</a></span><span class="op" id="1992816">)</span>&nbsp;<span class="op" id="1992818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1992822">//&nbsp;pick&nbsp;next&nbsp;profile&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1992850">//&nbsp;If&nbsp;you&nbsp;change&nbsp;this,&nbsp;also&nbsp;change&nbsp;allocmcache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1992900">if</span>&nbsp;<span class="ident" id="1992903"><a href="/runtime/malloc.go.html#1992770">rate</a></span>&nbsp;<span class="op" id="1992908">&gt;</span>&nbsp;<span class="num" id="1992910">0x3fffffff</span>&nbsp;<span class="op" id="1992921">{</span>&nbsp;<span class="comment" id="1992923">//&nbsp;make&nbsp;2*rate&nbsp;not&nbsp;overflow</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992954"><a href="/runtime/malloc.go.html#1992770">rate</a></span>&nbsp;<span class="op" id="1992959">=</span>&nbsp;<span class="num" id="1992961">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1992974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1992978">next</span>&nbsp;<span class="op" id="1992983">:=</span>&nbsp;<span class="builtintype" id="1992986">int32</span><span class="op" id="1992991">(</span><span class="ident" id="1992992"><a href="/runtime/stubs.go.html#2136047">fastrand1</a></span><span class="op" id="1993001">(</span><span class="op" id="1993002">)</span><span class="op" id="1993003">)</span>&nbsp;<span class="op" id="1993005">%</span>&nbsp;<span class="op" id="1993007">(</span><span class="num" id="1993008">2</span>&nbsp;<span class="op" id="1993010">*</span>&nbsp;<span class="builtintype" id="1993012">int32</span><span class="op" id="1993017">(</span><span class="ident" id="1993018"><a href="/runtime/malloc.go.html#1992770">rate</a></span><span class="op" id="1993022">)</span><span class="op" id="1993023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993027">//&nbsp;Subtract&nbsp;the&nbsp;&#34;remainder&#34;&nbsp;of&nbsp;the&nbsp;current&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993084">//&nbsp;Otherwise&nbsp;objects&nbsp;that&nbsp;are&nbsp;close&nbsp;in&nbsp;size&nbsp;to&nbsp;sampling&nbsp;rate</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993147">//&nbsp;will&nbsp;be&nbsp;under-sampled,&nbsp;because&nbsp;we&nbsp;consistently&nbsp;discard&nbsp;this&nbsp;remainder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993223"><a href="/runtime/malloc.go.html#1992978">next</a></span>&nbsp;<span class="op" id="1993228">-=</span>&nbsp;<span class="op" id="1993231">(</span><span class="builtintype" id="1993232">int32</span><span class="op" id="1993237">(</span><span class="ident" id="1993238"><a href="/runtime/malloc.go.html#1992737">size</a></span><span class="op" id="1993242">)</span>&nbsp;<span class="op" id="1993244">-</span>&nbsp;<span class="ident" id="1993246"><a href="/runtime/malloc.go.html#1992754">c</a></span><span class="op" id="1993247">.</span><span class="ident" id="1993248">next_sample</span><span class="op" id="1993259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1993263">if</span>&nbsp;<span class="ident" id="1993266"><a href="/runtime/malloc.go.html#1992978">next</a></span>&nbsp;<span class="op" id="1993271">&lt;</span>&nbsp;<span class="num" id="1993273">0</span>&nbsp;<span class="op" id="1993275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993280"><a href="/runtime/malloc.go.html#1992978">next</a></span>&nbsp;<span class="op" id="1993285">=</span>&nbsp;<span class="num" id="1993287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1993291">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993295"><a href="/runtime/malloc.go.html#1992754">c</a></span><span class="op" id="1993296">.</span><span class="ident" id="1993297">next_sample</span>&nbsp;<span class="op" id="1993309">=</span>&nbsp;<span class="ident" id="1993311"><a href="/runtime/malloc.go.html#1992978">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1993317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993321"><a href="/runtime/mprof.go.html#2018300">mProf_Malloc</a></span><span class="op" id="1993333">(</span><span class="ident" id="1993334"><a href="/runtime/malloc.go.html#1992719">x</a></span><span class="op" id="1993335">,</span>&nbsp;<span class="ident" id="1993337"><a href="/runtime/malloc.go.html#1992737">size</a></span><span class="op" id="1993341">)</span><br>
<span class="lineno"></span><span class="op" id="1993343">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="1993346">//&nbsp;force&nbsp;=&nbsp;1&nbsp;-&nbsp;do&nbsp;GC&nbsp;regardless&nbsp;of&nbsp;current&nbsp;heap&nbsp;usage</span><br>
<span class="lineno"></span><span class="comment" id="1993400">//&nbsp;force&nbsp;=&nbsp;2&nbsp;-&nbsp;go&nbsp;GC&nbsp;and&nbsp;eager&nbsp;sweep</span><br>
<span class="lineno"></span><span class="keyword" id="1993437">func</span>&nbsp;<span class="ident" id="1993442">gogc</span><span class="op" id="1993446">(</span><span class="ident" id="1993447">force</span>&nbsp;<span class="builtintype" id="1993453">int32</span><span class="op" id="1993458">)</span>&nbsp;<span class="op" id="1993460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993463">//&nbsp;The&nbsp;gc&nbsp;is&nbsp;turned&nbsp;off&nbsp;(via&nbsp;enablegc)&nbsp;until&nbsp;the&nbsp;bootstrap&nbsp;has&nbsp;completed.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993538">//&nbsp;Also,&nbsp;malloc&nbsp;gets&nbsp;called&nbsp;in&nbsp;the&nbsp;guts&nbsp;of&nbsp;a&nbsp;number&nbsp;of&nbsp;libraries&nbsp;that&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993618">//&nbsp;holding&nbsp;locks.&nbsp;To&nbsp;avoid&nbsp;deadlocks&nbsp;during&nbsp;stoptheworld,&nbsp;don&#39;t&nbsp;bother</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993690">//&nbsp;trying&nbsp;to&nbsp;run&nbsp;gc&nbsp;while&nbsp;holding&nbsp;a&nbsp;lock.&nbsp;The&nbsp;next&nbsp;mallocgc&nbsp;without&nbsp;a&nbsp;lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1993766">//&nbsp;will&nbsp;do&nbsp;the&nbsp;gc&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993794">mp</span>&nbsp;<span class="op" id="1993797">:=</span>&nbsp;<span class="ident" id="1993800"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1993808">(</span><span class="op" id="1993809">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1993812">if</span>&nbsp;<span class="ident" id="1993815">gp</span>&nbsp;<span class="op" id="1993818">:=</span>&nbsp;<span class="ident" id="1993821"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1993825">(</span><span class="op" id="1993826">)</span><span class="op" id="1993827">;</span>&nbsp;<span class="ident" id="1993829"><a href="/runtime/malloc.go.html#1993815">gp</a></span>&nbsp;<span class="op" id="1993832">==</span>&nbsp;<span class="ident" id="1993835"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1993837">.</span><span class="ident" id="1993838">g0</span>&nbsp;<span class="op" id="1993841">||</span>&nbsp;<span class="ident" id="1993844"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1993846">.</span><span class="ident" id="1993847">locks</span>&nbsp;<span class="op" id="1993853">&gt;</span>&nbsp;<span class="num" id="1993855">1</span>&nbsp;<span class="op" id="1993857">||</span>&nbsp;<span class="op" id="1993860">!</span><span class="ident" id="1993861"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="1993869">.</span><span class="ident" id="1993870">enablegc</span>&nbsp;<span class="op" id="1993879">||</span>&nbsp;<span class="ident" id="1993882"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184416">panicking</a></span>&nbsp;<span class="op" id="1993892">!=</span>&nbsp;<span class="num" id="1993895">0</span>&nbsp;<span class="op" id="1993897">||</span>&nbsp;<span class="ident" id="1993900"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188169">gcpercent</a></span>&nbsp;<span class="op" id="1993910">&lt;</span>&nbsp;<span class="num" id="1993912">0</span>&nbsp;<span class="op" id="1993914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993918"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1993926">(</span><span class="ident" id="1993927"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1993929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1993933">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1993941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993944"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1993952">(</span><span class="ident" id="1993953"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1993955">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993958"><a href="/runtime/malloc.go.html#1993794">mp</a></span>&nbsp;<span class="op" id="1993961">=</span>&nbsp;<span class="ident" id="1993963">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1993969"><a href="/runtime/sema.go.html#2096000">semacquire</a></span><span class="op" id="1993979">(</span><span class="op" id="1993980">&amp;</span><span class="ident" id="1993981"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="1993990">,</span>&nbsp;<span class="builtintype" id="1993992">false</span><span class="op" id="1993997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994001">if</span>&nbsp;<span class="ident" id="1994004"><a href="/runtime/malloc.go.html#1993447">force</a></span>&nbsp;<span class="op" id="1994010">==</span>&nbsp;<span class="num" id="1994013">0</span>&nbsp;<span class="op" id="1994015">&amp;&amp;</span>&nbsp;<span class="ident" id="1994018"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="1994026">.</span><span class="ident" id="1994027">heap_alloc</span>&nbsp;<span class="op" id="1994038">&lt;</span>&nbsp;<span class="ident" id="1994040"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="1994048">.</span><span class="ident" id="1994049">next_gc</span>&nbsp;<span class="op" id="1994057">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994061">//&nbsp;typically&nbsp;threads&nbsp;which&nbsp;lost&nbsp;the&nbsp;race&nbsp;to&nbsp;grab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994112">//&nbsp;worldsema&nbsp;exit&nbsp;here&nbsp;when&nbsp;gc&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994154"><a href="/runtime/sema.go.html#2097084">semrelease</a></span><span class="op" id="1994164">(</span><span class="op" id="1994165">&amp;</span><span class="ident" id="1994166"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="1994175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994179">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994187">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994191">//&nbsp;Ok,&nbsp;we&#39;re&nbsp;doing&nbsp;it!&nbsp;&nbsp;Stop&nbsp;everybody&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994236">startTime</span>&nbsp;<span class="op" id="1994246">:=</span>&nbsp;<span class="ident" id="1994249"><a href="/runtime/stubs.go.html#2137038">nanotime</a></span><span class="op" id="1994257">(</span><span class="op" id="1994258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994261"><a href="/runtime/malloc.go.html#1993794">mp</a></span>&nbsp;<span class="op" id="1994264">=</span>&nbsp;<span class="ident" id="1994266"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1994274">(</span><span class="op" id="1994275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994278"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1994280">.</span><span class="ident" id="1994281">gcing</span>&nbsp;<span class="op" id="1994287">=</span>&nbsp;<span class="num" id="1994289">1</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994292"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1994300">(</span><span class="ident" id="1994301"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1994303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994306"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1994309">(</span><span class="ident" id="1994310"><a href="/runtime/stubs.go.html#2135896">stoptheworld</a></span><span class="op" id="1994322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994325">if</span>&nbsp;<span class="ident" id="1994328"><a href="/runtime/malloc.go.html#1993794">mp</a></span>&nbsp;<span class="op" id="1994331">!=</span>&nbsp;<span class="ident" id="1994334"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1994342">(</span><span class="op" id="1994343">)</span>&nbsp;<span class="op" id="1994345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994349"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1994356">(</span><span class="string" id="1994357">&#34;gogc:&nbsp;rescheduled&#34;</span><span class="op" id="1994376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994379">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994383"><a href="/runtime/mgc0.go.html#2010126">clearpools</a></span><span class="op" id="1994393">(</span><span class="op" id="1994394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994398">//&nbsp;Run&nbsp;gc&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.&nbsp;&nbsp;We&nbsp;do&nbsp;this&nbsp;so&nbsp;that&nbsp;the&nbsp;g&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994458">//&nbsp;we&#39;re&nbsp;currently&nbsp;running&nbsp;on&nbsp;will&nbsp;no&nbsp;longer&nbsp;change.&nbsp;&nbsp;Cuts</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994518">//&nbsp;the&nbsp;root&nbsp;set&nbsp;down&nbsp;a&nbsp;bit&nbsp;(g0&nbsp;stacks&nbsp;are&nbsp;not&nbsp;scanned,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994578">//&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;scan&nbsp;gc&#39;s&nbsp;internal&nbsp;state).&nbsp;&nbsp;We&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994635">//&nbsp;need&nbsp;to&nbsp;switch&nbsp;to&nbsp;g0&nbsp;so&nbsp;we&nbsp;can&nbsp;shrink&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994688">n</span>&nbsp;<span class="op" id="1994690">:=</span>&nbsp;<span class="num" id="1994693">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994696">if</span>&nbsp;<span class="ident" id="1994699"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184573">debug</a></span><span class="op" id="1994704">.</span><span class="ident" id="1994705">gctrace</span>&nbsp;<span class="op" id="1994713">&gt;</span>&nbsp;<span class="num" id="1994715">1</span>&nbsp;<span class="op" id="1994717">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994721"><a href="/runtime/malloc.go.html#1994688">n</a></span>&nbsp;<span class="op" id="1994723">=</span>&nbsp;<span class="num" id="1994725">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994731">for</span>&nbsp;<span class="ident" id="1994735">i</span>&nbsp;<span class="op" id="1994737">:=</span>&nbsp;<span class="num" id="1994740">0</span><span class="op" id="1994741">;</span>&nbsp;<span class="ident" id="1994743"><a href="/runtime/malloc.go.html#1994735">i</a></span>&nbsp;<span class="op" id="1994745">&lt;</span>&nbsp;<span class="ident" id="1994747"><a href="/runtime/malloc.go.html#1994688">n</a></span><span class="op" id="1994748">;</span>&nbsp;<span class="ident" id="1994750"><a href="/runtime/malloc.go.html#1994735">i</a></span><span class="op" id="1994751">++</span>&nbsp;<span class="op" id="1994754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994758">if</span>&nbsp;<span class="ident" id="1994761"><a href="/runtime/malloc.go.html#1994735">i</a></span>&nbsp;<span class="op" id="1994763">&gt;</span>&nbsp;<span class="num" id="1994765">0</span>&nbsp;<span class="op" id="1994767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994772"><a href="/runtime/malloc.go.html#1994236">startTime</a></span>&nbsp;<span class="op" id="1994782">=</span>&nbsp;<span class="ident" id="1994784"><a href="/runtime/stubs.go.html#2137038">nanotime</a></span><span class="op" id="1994792">(</span><span class="op" id="1994793">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1994797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1994801">//&nbsp;switch&nbsp;to&nbsp;g0,&nbsp;call&nbsp;gc,&nbsp;then&nbsp;switch&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994846"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1994848">.</span><span class="ident" id="1994849">scalararg</span><span class="op" id="1994858">[</span><span class="num" id="1994859">0</span><span class="op" id="1994860">]</span>&nbsp;<span class="op" id="1994862">=</span>&nbsp;<span class="builtintype" id="1994864">uintptr</span><span class="op" id="1994871">(</span><span class="builtintype" id="1994872">uint32</span><span class="op" id="1994878">(</span><span class="ident" id="1994879"><a href="/runtime/malloc.go.html#1994236">startTime</a></span><span class="op" id="1994888">)</span><span class="op" id="1994889">)</span>&nbsp;<span class="comment" id="1994891">//&nbsp;low&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994908"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1994910">.</span><span class="ident" id="1994911">scalararg</span><span class="op" id="1994920">[</span><span class="num" id="1994921">1</span><span class="op" id="1994922">]</span>&nbsp;<span class="op" id="1994924">=</span>&nbsp;<span class="builtintype" id="1994926">uintptr</span><span class="op" id="1994933">(</span><span class="ident" id="1994934"><a href="/runtime/malloc.go.html#1994236">startTime</a></span>&nbsp;<span class="op" id="1994944">&gt;&gt;</span>&nbsp;<span class="num" id="1994947">32</span><span class="op" id="1994949">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1994953">//&nbsp;high&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1994971">if</span>&nbsp;<span class="ident" id="1994974"><a href="/runtime/malloc.go.html#1993447">force</a></span>&nbsp;<span class="op" id="1994980">&gt;=</span>&nbsp;<span class="num" id="1994983">2</span>&nbsp;<span class="op" id="1994985">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1994990"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1994992">.</span><span class="ident" id="1994993">scalararg</span><span class="op" id="1995002">[</span><span class="num" id="1995003">2</span><span class="op" id="1995004">]</span>&nbsp;<span class="op" id="1995006">=</span>&nbsp;<span class="num" id="1995008">1</span>&nbsp;<span class="comment" id="1995010">//&nbsp;eagersweep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995026">}</span>&nbsp;<span class="keyword" id="1995028">else</span>&nbsp;<span class="op" id="1995033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995038"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1995040">.</span><span class="ident" id="1995041">scalararg</span><span class="op" id="1995050">[</span><span class="num" id="1995051">2</span><span class="op" id="1995052">]</span>&nbsp;<span class="op" id="1995054">=</span>&nbsp;<span class="num" id="1995056">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995064"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1995067">(</span><span class="ident" id="1995068"><a href="/runtime/stubs.go.html#2135285">gc_m</a></span><span class="op" id="1995072">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1995079">//&nbsp;all&nbsp;done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995092"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1995094">.</span><span class="ident" id="1995095">gcing</span>&nbsp;<span class="op" id="1995101">=</span>&nbsp;<span class="num" id="1995103">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995106"><a href="/runtime/sema.go.html#2097084">semrelease</a></span><span class="op" id="1995116">(</span><span class="op" id="1995117">&amp;</span><span class="ident" id="1995118"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184696">worldsema</a></span><span class="op" id="1995127">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995130"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1995133">(</span><span class="ident" id="1995134"><a href="/runtime/stubs.go.html#2135875">starttheworld</a></span><span class="op" id="1995147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995150"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1995158">(</span><span class="ident" id="1995159"><a href="/runtime/malloc.go.html#1993794">mp</a></span><span class="op" id="1995161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995164"><a href="/runtime/malloc.go.html#1993794">mp</a></span>&nbsp;<span class="op" id="1995167">=</span>&nbsp;<span class="ident" id="1995169">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1995175">//&nbsp;now&nbsp;that&nbsp;gc&nbsp;is&nbsp;done,&nbsp;kick&nbsp;off&nbsp;finalizer&nbsp;thread&nbsp;if&nbsp;needed</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1995236">if</span>&nbsp;<span class="op" id="1995239">!</span><span class="ident" id="1995240"><a href="/runtime/malloc.go.html#1982391">concurrentSweep</a></span>&nbsp;<span class="op" id="1995256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1995260">//&nbsp;give&nbsp;the&nbsp;queued&nbsp;finalizers,&nbsp;if&nbsp;any,&nbsp;a&nbsp;chance&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995317"><a href="/runtime/proc.go.html#2066210">Gosched</a></span><span class="op" id="1995324">(</span><span class="op" id="1995325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1995328">}</span><br>
<span class="lineno"></span><span class="op" id="1995330">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1995333">//&nbsp;GC&nbsp;runs&nbsp;a&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="1995366">func</span>&nbsp;<span class="ident" id="1995371">GC</span><span class="op" id="1995373">(</span><span class="op" id="1995374">)</span>&nbsp;<span class="op" id="1995376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1995379"><a href="/runtime/malloc.go.html#1993442">gogc</a></span><span class="op" id="1995383">(</span><span class="num" id="1995384">2</span><span class="op" id="1995385">)</span><br>
<span class="lineno"></span><span class="op" id="1995387">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="comment" id="1995390">//&nbsp;linker-provided</span><br>
<span class="lineno"></span><span class="keyword" id="1995409">var</span>&nbsp;<span class="ident" id="1995413">noptrdata</span>&nbsp;<span class="keyword" id="1995423">struct</span><span class="op" id="1995429">{</span><span class="op" id="1995430">}</span><br>
<span class="lineno"></span><span class="keyword" id="1995432">var</span>&nbsp;<span class="ident" id="1995436">enoptrdata</span>&nbsp;<span class="keyword" id="1995447">struct</span><span class="op" id="1995453">{</span><span class="op" id="1995454">}</span><br>
<span class="lineno"></span><span class="keyword" id="1995456">var</span>&nbsp;<span class="ident" id="1995460">noptrbss</span>&nbsp;<span class="keyword" id="1995469">struct</span><span class="op" id="1995475">{</span><span class="op" id="1995476">}</span><br>
<span class="lineno">495</span><span class="keyword" id="1995478">var</span>&nbsp;<span class="ident" id="1995482">enoptrbss</span>&nbsp;<span class="keyword" id="1995492">struct</span><span class="op" id="1995498">{</span><span class="op" id="1995499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1995502">//&nbsp;SetFinalizer&nbsp;sets&nbsp;the&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1995561">//&nbsp;When&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;finds&nbsp;an&nbsp;unreachable&nbsp;block</span><br>
<span class="lineno"></span><span class="comment" id="1995618">//&nbsp;with&nbsp;an&nbsp;associated&nbsp;finalizer,&nbsp;it&nbsp;clears&nbsp;the&nbsp;association&nbsp;and&nbsp;runs</span><br>
<span class="lineno">500</span><span class="comment" id="1995686">//&nbsp;f(x)&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.&nbsp;&nbsp;This&nbsp;makes&nbsp;x&nbsp;reachable&nbsp;again,&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="1995754">//&nbsp;now&nbsp;without&nbsp;an&nbsp;associated&nbsp;finalizer.&nbsp;&nbsp;Assuming&nbsp;that&nbsp;SetFinalizer</span><br>
<span class="lineno"></span><span class="comment" id="1995822">//&nbsp;is&nbsp;not&nbsp;called&nbsp;again,&nbsp;the&nbsp;next&nbsp;time&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;sees</span><br>
<span class="lineno"></span><span class="comment" id="1995887">//&nbsp;that&nbsp;x&nbsp;is&nbsp;unreachable,&nbsp;it&nbsp;will&nbsp;free&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1995929">//</span><br>
<span class="lineno">505</span><span class="comment" id="1995932">//&nbsp;SetFinalizer(x,&nbsp;nil)&nbsp;clears&nbsp;any&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1995996">//</span><br>
<span class="lineno"></span><span class="comment" id="1995999">//&nbsp;The&nbsp;argument&nbsp;x&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;object&nbsp;allocated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1996061">//&nbsp;calling&nbsp;new&nbsp;or&nbsp;by&nbsp;taking&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;composite&nbsp;literal.</span><br>
<span class="lineno"></span><span class="comment" id="1996125">//&nbsp;The&nbsp;argument&nbsp;f&nbsp;must&nbsp;be&nbsp;a&nbsp;function&nbsp;that&nbsp;takes&nbsp;a&nbsp;single&nbsp;argument</span><br>
<span class="lineno">510</span><span class="comment" id="1996191">//&nbsp;to&nbsp;which&nbsp;x&#39;s&nbsp;type&nbsp;can&nbsp;be&nbsp;assigned,&nbsp;and&nbsp;can&nbsp;have&nbsp;arbitrary&nbsp;ignored&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="1996267">//&nbsp;values.&nbsp;If&nbsp;either&nbsp;of&nbsp;these&nbsp;is&nbsp;not&nbsp;true,&nbsp;SetFinalizer&nbsp;aborts&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1996334">//&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1996346">//</span><br>
<span class="lineno"></span><span class="comment" id="1996349">//&nbsp;Finalizers&nbsp;are&nbsp;run&nbsp;in&nbsp;dependency&nbsp;order:&nbsp;if&nbsp;A&nbsp;points&nbsp;at&nbsp;B,&nbsp;both&nbsp;have</span><br>
<span class="lineno">515</span><span class="comment" id="1996420">//&nbsp;finalizers,&nbsp;and&nbsp;they&nbsp;are&nbsp;otherwise&nbsp;unreachable,&nbsp;only&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1996490">//&nbsp;for&nbsp;A&nbsp;runs;&nbsp;once&nbsp;A&nbsp;is&nbsp;freed,&nbsp;the&nbsp;finalizer&nbsp;for&nbsp;B&nbsp;can&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="1996551">//&nbsp;If&nbsp;a&nbsp;cyclic&nbsp;structure&nbsp;includes&nbsp;a&nbsp;block&nbsp;with&nbsp;a&nbsp;finalizer,&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1996616">//&nbsp;cycle&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;and&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1996685">//&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;run,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;ordering&nbsp;that</span><br>
<span class="lineno">520</span><span class="comment" id="1996748">//&nbsp;respects&nbsp;the&nbsp;dependencies.</span><br>
<span class="lineno"></span><span class="comment" id="1996778">//</span><br>
<span class="lineno"></span><span class="comment" id="1996781">//&nbsp;The&nbsp;finalizer&nbsp;for&nbsp;x&nbsp;is&nbsp;scheduled&nbsp;to&nbsp;run&nbsp;at&nbsp;some&nbsp;arbitrary&nbsp;time&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="1996853">//&nbsp;x&nbsp;becomes&nbsp;unreachable.</span><br>
<span class="lineno"></span><span class="comment" id="1996879">//&nbsp;There&nbsp;is&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;finalizers&nbsp;will&nbsp;run&nbsp;before&nbsp;a&nbsp;program&nbsp;exits,</span><br>
<span class="lineno">525</span><span class="comment" id="1996953">//&nbsp;so&nbsp;typically&nbsp;they&nbsp;are&nbsp;useful&nbsp;only&nbsp;for&nbsp;releasing&nbsp;non-memory&nbsp;resources</span><br>
<span class="lineno"></span><span class="comment" id="1997025">//&nbsp;associated&nbsp;with&nbsp;an&nbsp;object&nbsp;during&nbsp;a&nbsp;long-running&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1997085">//&nbsp;For&nbsp;example,&nbsp;an&nbsp;os.File&nbsp;object&nbsp;could&nbsp;use&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;close&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1997154">//&nbsp;associated&nbsp;operating&nbsp;system&nbsp;file&nbsp;descriptor&nbsp;when&nbsp;a&nbsp;program&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="1997225">//&nbsp;an&nbsp;os.File&nbsp;without&nbsp;calling&nbsp;Close,&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;mistake</span><br>
<span class="lineno">530</span><span class="comment" id="1997288">//&nbsp;to&nbsp;depend&nbsp;on&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;flush&nbsp;an&nbsp;in-memory&nbsp;I/O&nbsp;buffer&nbsp;such&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1997359">//&nbsp;bufio.Writer,&nbsp;because&nbsp;the&nbsp;buffer&nbsp;would&nbsp;not&nbsp;be&nbsp;flushed&nbsp;at&nbsp;program&nbsp;exit.</span><br>
<span class="lineno"></span><span class="comment" id="1997433">//</span><br>
<span class="lineno"></span><span class="comment" id="1997436">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;if&nbsp;the&nbsp;size&nbsp;of&nbsp;*x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1997507">//&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno">535</span><span class="comment" id="1997522">//</span><br>
<span class="lineno"></span><span class="comment" id="1997525">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;for&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="1997597">//&nbsp;in&nbsp;initializers&nbsp;for&nbsp;package-level&nbsp;variables.&nbsp;Such&nbsp;objects&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1997665">//&nbsp;linker-allocated,&nbsp;not&nbsp;heap-allocated.</span><br>
<span class="lineno"></span><span class="comment" id="1997706">//</span><br>
<span class="lineno">540</span><span class="comment" id="1997709">//&nbsp;A&nbsp;single&nbsp;goroutine&nbsp;runs&nbsp;all&nbsp;finalizers&nbsp;for&nbsp;a&nbsp;program,&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="comment" id="1997780">//&nbsp;If&nbsp;a&nbsp;finalizer&nbsp;must&nbsp;run&nbsp;for&nbsp;a&nbsp;long&nbsp;time,&nbsp;it&nbsp;should&nbsp;do&nbsp;so&nbsp;by&nbsp;starting</span><br>
<span class="lineno"></span><span class="comment" id="1997852">//&nbsp;a&nbsp;new&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1997872">func</span>&nbsp;<span class="ident" id="1997877">SetFinalizer</span><span class="op" id="1997889">(</span><span class="ident" id="1997890">obj</span>&nbsp;<span class="keyword" id="1997894">interface</span><span class="op" id="1997903">{</span><span class="op" id="1997904">}</span><span class="op" id="1997905">,</span>&nbsp;<span class="ident" id="1997907">finalizer</span>&nbsp;<span class="keyword" id="1997917">interface</span><span class="op" id="1997926">{</span><span class="op" id="1997927">}</span><span class="op" id="1997928">)</span>&nbsp;<span class="op" id="1997930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997933">e</span>&nbsp;<span class="op" id="1997935">:=</span>&nbsp;<span class="op" id="1997938">(</span><span class="op" id="1997939">*</span><span class="ident" id="1997940"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179525">eface</a></span><span class="op" id="1997945">)</span><span class="op" id="1997946">(</span><span class="ident" id="1997947"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1997953">.</span><span class="ident" id="1997954">Pointer</span><span class="op" id="1997961">(</span><span class="op" id="1997962">&amp;</span><span class="ident" id="1997963"><a href="/runtime/malloc.go.html#1997890">obj</a></span><span class="op" id="1997966">)</span><span class="op" id="1997967">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1997970">etyp</span>&nbsp;<span class="op" id="1997975">:=</span>&nbsp;<span class="ident" id="1997978"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1997979">.</span><span class="ident" id="1997980">_type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1997987">if</span>&nbsp;<span class="ident" id="1997990"><a href="/runtime/malloc.go.html#1997970">etyp</a></span>&nbsp;<span class="op" id="1997995">==</span>&nbsp;<span class="ident" id="1997998">nil</span>&nbsp;<span class="op" id="1998002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998006"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1998013">(</span><span class="string" id="1998014">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;nil&#34;</span><span class="op" id="1998059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998065">if</span>&nbsp;<span class="ident" id="1998068"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="1998072">.</span><span class="ident" id="1998073">kind</span><span class="op" id="1998077">&amp;</span><span class="ident" id="1998078"><a href="/runtime/typekind.go.html#2178384">kindMask</a></span>&nbsp;<span class="op" id="1998087">!=</span>&nbsp;<span class="ident" id="1998090"><a href="/runtime/typekind.go.html#2178113">kindPtr</a></span>&nbsp;<span class="op" id="1998098">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998102"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1998109">(</span><span class="string" id="1998110">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1998153">+</span>&nbsp;<span class="op" id="1998155">*</span><span class="ident" id="1998156"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="1998160">.</span><span class="ident" id="1998161">_string</span>&nbsp;<span class="op" id="1998169">+</span>&nbsp;<span class="string" id="1998171">&#34;,&nbsp;not&nbsp;pointer&#34;</span><span class="op" id="1998186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998192">ot</span>&nbsp;<span class="op" id="1998195">:=</span>&nbsp;<span class="op" id="1998198">(</span><span class="op" id="1998199">*</span><span class="ident" id="1998200"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189624">ptrtype</a></span><span class="op" id="1998207">)</span><span class="op" id="1998208">(</span><span class="ident" id="1998209"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998215">.</span><span class="ident" id="1998216">Pointer</span><span class="op" id="1998223">(</span><span class="ident" id="1998224"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="1998228">)</span><span class="op" id="1998229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998232">if</span>&nbsp;<span class="ident" id="1998235"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="1998237">.</span><span class="ident" id="1998238">elem</span>&nbsp;<span class="op" id="1998243">==</span>&nbsp;<span class="ident" id="1998246">nil</span>&nbsp;<span class="op" id="1998250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998254"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1998261">(</span><span class="string" id="1998262">&#34;nil&nbsp;elem&nbsp;type!&#34;</span><span class="op" id="1998278">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998285">//&nbsp;find&nbsp;the&nbsp;containing&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1998316">_</span><span class="op" id="1998317">,</span>&nbsp;<span class="ident" id="1998319">base</span><span class="op" id="1998323">,</span>&nbsp;<span class="ident" id="1998325">_</span>&nbsp;<span class="op" id="1998327">:=</span>&nbsp;<span class="ident" id="1998330"><a href="/runtime/malloc.go.html#2001870">findObject</a></span><span class="op" id="1998340">(</span><span class="ident" id="1998341"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998342">.</span><span class="ident" id="1998343">data</span><span class="op" id="1998347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998351">if</span>&nbsp;<span class="ident" id="1998354"><a href="/runtime/malloc.go.html#1998319">base</a></span>&nbsp;<span class="op" id="1998359">==</span>&nbsp;<span class="ident" id="1998362">nil</span>&nbsp;<span class="op" id="1998366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998370">//&nbsp;0-length&nbsp;objects&nbsp;are&nbsp;okay.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998402">if</span>&nbsp;<span class="ident" id="1998405"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998406">.</span><span class="ident" id="1998407">data</span>&nbsp;<span class="op" id="1998412">==</span>&nbsp;<span class="ident" id="1998415"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998421">.</span><span class="ident" id="1998422">Pointer</span><span class="op" id="1998429">(</span><span class="op" id="1998430">&amp;</span><span class="ident" id="1998431"><a href="/runtime/malloc.go.html#1982538">zerobase</a></span><span class="op" id="1998439">)</span>&nbsp;<span class="op" id="1998441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1998455">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998460">//&nbsp;Global&nbsp;initializers&nbsp;might&nbsp;be&nbsp;linker-allocated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998512">//&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;Foo&nbsp;=&nbsp;&amp;Object{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998537">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;main()&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998556">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.SetFinalizer(Foo,&nbsp;nil)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998593">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998600">//&nbsp;The&nbsp;relevant&nbsp;segments&nbsp;are:&nbsp;noptrdata,&nbsp;data,&nbsp;bss,&nbsp;noptrbss.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998664">//&nbsp;We&nbsp;cannot&nbsp;assume&nbsp;they&nbsp;are&nbsp;in&nbsp;any&nbsp;order&nbsp;or&nbsp;even&nbsp;contiguous,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1998728">//&nbsp;due&nbsp;to&nbsp;external&nbsp;linking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1998758">if</span>&nbsp;<span class="builtintype" id="1998761">uintptr</span><span class="op" id="1998768">(</span><span class="ident" id="1998769"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998775">.</span><span class="ident" id="1998776">Pointer</span><span class="op" id="1998783">(</span><span class="op" id="1998784">&amp;</span><span class="ident" id="1998785"><a href="/runtime/malloc.go.html#1995413">noptrdata</a></span><span class="op" id="1998794">)</span><span class="op" id="1998795">)</span>&nbsp;<span class="op" id="1998797">&lt;=</span>&nbsp;<span class="builtintype" id="1998800">uintptr</span><span class="op" id="1998807">(</span><span class="ident" id="1998808"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998809">.</span><span class="ident" id="1998810">data</span><span class="op" id="1998814">)</span>&nbsp;<span class="op" id="1998816">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1998819">uintptr</span><span class="op" id="1998826">(</span><span class="ident" id="1998827"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998828">.</span><span class="ident" id="1998829">data</span><span class="op" id="1998833">)</span>&nbsp;<span class="op" id="1998835">&lt;</span>&nbsp;<span class="builtintype" id="1998837">uintptr</span><span class="op" id="1998844">(</span><span class="ident" id="1998845"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998851">.</span><span class="ident" id="1998852">Pointer</span><span class="op" id="1998859">(</span><span class="op" id="1998860">&amp;</span><span class="ident" id="1998861"><a href="/runtime/malloc.go.html#1995436">enoptrdata</a></span><span class="op" id="1998871">)</span><span class="op" id="1998872">)</span>&nbsp;<span class="op" id="1998874">||</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1998880">uintptr</span><span class="op" id="1998887">(</span><span class="ident" id="1998888"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998894">.</span><span class="ident" id="1998895">Pointer</span><span class="op" id="1998902">(</span><span class="op" id="1998903">&amp;</span><span class="ident" id="1998904"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195949">data</a></span><span class="op" id="1998908">)</span><span class="op" id="1998909">)</span>&nbsp;<span class="op" id="1998911">&lt;=</span>&nbsp;<span class="builtintype" id="1998914">uintptr</span><span class="op" id="1998921">(</span><span class="ident" id="1998922"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998923">.</span><span class="ident" id="1998924">data</span><span class="op" id="1998928">)</span>&nbsp;<span class="op" id="1998930">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1998933">uintptr</span><span class="op" id="1998940">(</span><span class="ident" id="1998941"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1998942">.</span><span class="ident" id="1998943">data</span><span class="op" id="1998947">)</span>&nbsp;<span class="op" id="1998949">&lt;</span>&nbsp;<span class="builtintype" id="1998951">uintptr</span><span class="op" id="1998958">(</span><span class="ident" id="1998959"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1998965">.</span><span class="ident" id="1998966">Pointer</span><span class="op" id="1998973">(</span><span class="op" id="1998974">&amp;</span><span class="ident" id="1998975"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195966">edata</a></span><span class="op" id="1998980">)</span><span class="op" id="1998981">)</span>&nbsp;<span class="op" id="1998983">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1998989">uintptr</span><span class="op" id="1998996">(</span><span class="ident" id="1998997"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1999003">.</span><span class="ident" id="1999004">Pointer</span><span class="op" id="1999011">(</span><span class="op" id="1999012">&amp;</span><span class="ident" id="1999013"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2195984">bss</a></span><span class="op" id="1999016">)</span><span class="op" id="1999017">)</span>&nbsp;<span class="op" id="1999019">&lt;=</span>&nbsp;<span class="builtintype" id="1999022">uintptr</span><span class="op" id="1999029">(</span><span class="ident" id="1999030"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999031">.</span><span class="ident" id="1999032">data</span><span class="op" id="1999036">)</span>&nbsp;<span class="op" id="1999038">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1999041">uintptr</span><span class="op" id="1999048">(</span><span class="ident" id="1999049"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999050">.</span><span class="ident" id="1999051">data</span><span class="op" id="1999055">)</span>&nbsp;<span class="op" id="1999057">&lt;</span>&nbsp;<span class="builtintype" id="1999059">uintptr</span><span class="op" id="1999066">(</span><span class="ident" id="1999067"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1999073">.</span><span class="ident" id="1999074">Pointer</span><span class="op" id="1999081">(</span><span class="op" id="1999082">&amp;</span><span class="ident" id="1999083"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2196000">ebss</a></span><span class="op" id="1999087">)</span><span class="op" id="1999088">)</span>&nbsp;<span class="op" id="1999090">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1999096">uintptr</span><span class="op" id="1999103">(</span><span class="ident" id="1999104"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1999110">.</span><span class="ident" id="1999111">Pointer</span><span class="op" id="1999118">(</span><span class="op" id="1999119">&amp;</span><span class="ident" id="1999120"><a href="/runtime/malloc.go.html#1995460">noptrbss</a></span><span class="op" id="1999128">)</span><span class="op" id="1999129">)</span>&nbsp;<span class="op" id="1999131">&lt;=</span>&nbsp;<span class="builtintype" id="1999134">uintptr</span><span class="op" id="1999141">(</span><span class="ident" id="1999142"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999143">.</span><span class="ident" id="1999144">data</span><span class="op" id="1999148">)</span>&nbsp;<span class="op" id="1999150">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1999153">uintptr</span><span class="op" id="1999160">(</span><span class="ident" id="1999161"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999162">.</span><span class="ident" id="1999163">data</span><span class="op" id="1999167">)</span>&nbsp;<span class="op" id="1999169">&lt;</span>&nbsp;<span class="builtintype" id="1999171">uintptr</span><span class="op" id="1999178">(</span><span class="ident" id="1999179"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1999185">.</span><span class="ident" id="1999186">Pointer</span><span class="op" id="1999193">(</span><span class="op" id="1999194">&amp;</span><span class="ident" id="1999195"><a href="/runtime/malloc.go.html#1995482">enoptrbss</a></span><span class="op" id="1999204">)</span><span class="op" id="1999205">)</span>&nbsp;<span class="op" id="1999207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999212">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999221">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999225"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1999232">(</span><span class="string" id="1999233">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;in&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1999287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999294">if</span>&nbsp;<span class="ident" id="1999297"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999298">.</span><span class="ident" id="1999299">data</span>&nbsp;<span class="op" id="1999304">!=</span>&nbsp;<span class="ident" id="1999307"><a href="/runtime/malloc.go.html#1998319">base</a></span>&nbsp;<span class="op" id="1999312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1999316">//&nbsp;As&nbsp;an&nbsp;implementation&nbsp;detail&nbsp;we&nbsp;allow&nbsp;to&nbsp;set&nbsp;finalizers&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1999394">//&nbsp;of&nbsp;an&nbsp;object&nbsp;if&nbsp;it&nbsp;could&nbsp;come&nbsp;from&nbsp;tiny&nbsp;alloc&nbsp;(see&nbsp;mallocgc&nbsp;for&nbsp;details).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999473">if</span>&nbsp;<span class="ident" id="1999476"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="1999478">.</span><span class="ident" id="1999479">elem</span>&nbsp;<span class="op" id="1999484">==</span>&nbsp;<span class="ident" id="1999487">nil</span>&nbsp;<span class="op" id="1999491">||</span>&nbsp;<span class="ident" id="1999494"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="1999496">.</span><span class="ident" id="1999497">elem</span><span class="op" id="1999501">.</span><span class="ident" id="1999502">kind</span><span class="op" id="1999506">&amp;</span><span class="ident" id="1999507"><a href="/runtime/typekind.go.html#2178349">kindNoPointers</a></span>&nbsp;<span class="op" id="1999522">==</span>&nbsp;<span class="num" id="1999525">0</span>&nbsp;<span class="op" id="1999527">||</span>&nbsp;<span class="ident" id="1999530"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="1999532">.</span><span class="ident" id="1999533">elem</span><span class="op" id="1999537">.</span><span class="ident" id="1999538">size</span>&nbsp;<span class="op" id="1999543">&gt;=</span>&nbsp;<span class="ident" id="1999546"><a href="/runtime/malloc.go.html#1982010">maxTinySize</a></span>&nbsp;<span class="op" id="1999558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999563"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1999570">(</span><span class="string" id="1999571">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;at&nbsp;beginning&nbsp;of&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1999638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999645">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999649">f</span>&nbsp;<span class="op" id="1999651">:=</span>&nbsp;<span class="op" id="1999654">(</span><span class="op" id="1999655">*</span><span class="ident" id="1999656"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179525">eface</a></span><span class="op" id="1999661">)</span><span class="op" id="1999662">(</span><span class="ident" id="1999663"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="1999669">.</span><span class="ident" id="1999670">Pointer</span><span class="op" id="1999677">(</span><span class="op" id="1999678">&amp;</span><span class="ident" id="1999679"><a href="/runtime/malloc.go.html#1997907">finalizer</a></span><span class="op" id="1999688">)</span><span class="op" id="1999689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999692">ftyp</span>&nbsp;<span class="op" id="1999697">:=</span>&nbsp;<span class="ident" id="1999700"><a href="/runtime/malloc.go.html#1999649">f</a></span><span class="op" id="1999701">.</span><span class="ident" id="1999702">_type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999709">if</span>&nbsp;<span class="ident" id="1999712"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span>&nbsp;<span class="op" id="1999717">==</span>&nbsp;<span class="ident" id="1999720">nil</span>&nbsp;<span class="op" id="1999724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1999728">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;and&nbsp;remove&nbsp;finalizer</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999772">mp</span>&nbsp;<span class="op" id="1999775">:=</span>&nbsp;<span class="ident" id="1999778"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1999786">(</span><span class="op" id="1999787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999791"><a href="/runtime/malloc.go.html#1999772">mp</a></span><span class="op" id="1999793">.</span><span class="ident" id="1999794">ptrarg</span><span class="op" id="1999800">[</span><span class="num" id="1999801">0</span><span class="op" id="1999802">]</span>&nbsp;<span class="op" id="1999804">=</span>&nbsp;<span class="ident" id="1999806"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="1999807">.</span><span class="ident" id="1999808">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999815"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1999818">(</span><span class="ident" id="1999819"><a href="/runtime/stubs.go.html#2135337">removeFinalizer_m</a></span><span class="op" id="1999836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999840"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1999848">(</span><span class="ident" id="1999849"><a href="/runtime/malloc.go.html#1999772">mp</a></span><span class="op" id="1999851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999855">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1999867">if</span>&nbsp;<span class="ident" id="1999870"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span><span class="op" id="1999874">.</span><span class="ident" id="1999875">kind</span><span class="op" id="1999879">&amp;</span><span class="ident" id="1999880"><a href="/runtime/typekind.go.html#2178384">kindMask</a></span>&nbsp;<span class="op" id="1999889">!=</span>&nbsp;<span class="ident" id="1999892"><a href="/runtime/typekind.go.html#2178016">kindFunc</a></span>&nbsp;<span class="op" id="1999901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999905"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1999912">(</span><span class="string" id="1999913">&#34;runtime.SetFinalizer:&nbsp;second&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1999957">+</span>&nbsp;<span class="op" id="1999959">*</span><span class="ident" id="1999960"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span><span class="op" id="1999964">.</span><span class="ident" id="1999965">_string</span>&nbsp;<span class="op" id="1999973">+</span>&nbsp;<span class="string" id="1999975">&#34;,&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="1999993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1999996">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1999999">ft</span>&nbsp;<span class="op" id="2000002">:=</span>&nbsp;<span class="op" id="2000005">(</span><span class="op" id="2000006">*</span><span class="ident" id="2000007"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189548">functype</a></span><span class="op" id="2000015">)</span><span class="op" id="2000016">(</span><span class="ident" id="2000017"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2000023">.</span><span class="ident" id="2000024">Pointer</span><span class="op" id="2000031">(</span><span class="ident" id="2000032"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span><span class="op" id="2000036">)</span><span class="op" id="2000037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000040">ins</span>&nbsp;<span class="op" id="2000044">:=</span>&nbsp;<span class="op" id="2000047">*</span><span class="op" id="2000048">(</span><span class="op" id="2000049">*</span><span class="op" id="2000050">[</span><span class="op" id="2000051">]</span><span class="op" id="2000052">*</span><span class="ident" id="2000053"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="2000058">)</span><span class="op" id="2000059">(</span><span class="ident" id="2000060"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2000066">.</span><span class="ident" id="2000067">Pointer</span><span class="op" id="2000074">(</span><span class="op" id="2000075">&amp;</span><span class="ident" id="2000076"><a href="/runtime/malloc.go.html#1999999">ft</a></span><span class="op" id="2000078">.</span><span class="ident" id="2000079">in</span><span class="op" id="2000081">)</span><span class="op" id="2000082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000085">if</span>&nbsp;<span class="ident" id="2000088"><a href="/runtime/malloc.go.html#1999999">ft</a></span><span class="op" id="2000090">.</span><span class="ident" id="2000091">dotdotdot</span>&nbsp;<span class="op" id="2000101">||</span>&nbsp;<span class="builtinfunc" id="2000104">len</span><span class="op" id="2000107">(</span><span class="ident" id="2000108"><a href="/runtime/malloc.go.html#2000040">ins</a></span><span class="op" id="2000111">)</span>&nbsp;<span class="op" id="2000113">!=</span>&nbsp;<span class="num" id="2000116">1</span>&nbsp;<span class="op" id="2000118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000122"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2000129">(</span><span class="string" id="2000130">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="2000167">+</span>&nbsp;<span class="op" id="2000169">*</span><span class="ident" id="2000170"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="2000174">.</span><span class="ident" id="2000175">_string</span>&nbsp;<span class="op" id="2000183">+</span>&nbsp;<span class="string" id="2000185">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="2000202">+</span>&nbsp;<span class="op" id="2000204">*</span><span class="ident" id="2000205"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span><span class="op" id="2000209">.</span><span class="ident" id="2000210">_string</span><span class="op" id="2000217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000220">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000223">fint</span>&nbsp;<span class="op" id="2000228">:=</span>&nbsp;<span class="ident" id="2000231"><a href="/runtime/malloc.go.html#2000040">ins</a></span><span class="op" id="2000234">[</span><span class="num" id="2000235">0</span><span class="op" id="2000236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000239">switch</span>&nbsp;<span class="op" id="2000246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000249">case</span>&nbsp;<span class="ident" id="2000254"><a href="/runtime/malloc.go.html#2000223">fint</a></span>&nbsp;<span class="op" id="2000259">==</span>&nbsp;<span class="ident" id="2000262"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="2000266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000270">//&nbsp;ok&nbsp;-&nbsp;same&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000290">goto</span>&nbsp;<span class="ident" id="2000295">okarg</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000302">case</span>&nbsp;<span class="ident" id="2000307"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000311">.</span><span class="ident" id="2000312">kind</span><span class="op" id="2000316">&amp;</span><span class="ident" id="2000317"><a href="/runtime/typekind.go.html#2178384">kindMask</a></span>&nbsp;<span class="op" id="2000326">==</span>&nbsp;<span class="ident" id="2000329"><a href="/runtime/typekind.go.html#2178113">kindPtr</a></span><span class="op" id="2000336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000340">if</span>&nbsp;<span class="op" id="2000343">(</span><span class="ident" id="2000344"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000348">.</span><span class="ident" id="2000349">x</span>&nbsp;<span class="op" id="2000351">==</span>&nbsp;<span class="ident" id="2000354">nil</span>&nbsp;<span class="op" id="2000358">||</span>&nbsp;<span class="ident" id="2000361"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000365">.</span><span class="ident" id="2000366">x</span><span class="op" id="2000367">.</span><span class="ident" id="2000368">name</span>&nbsp;<span class="op" id="2000373">==</span>&nbsp;<span class="ident" id="2000376">nil</span>&nbsp;<span class="op" id="2000380">||</span>&nbsp;<span class="ident" id="2000383"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="2000387">.</span><span class="ident" id="2000388">x</span>&nbsp;<span class="op" id="2000390">==</span>&nbsp;<span class="ident" id="2000393">nil</span>&nbsp;<span class="op" id="2000397">||</span>&nbsp;<span class="ident" id="2000400"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="2000404">.</span><span class="ident" id="2000405">x</span><span class="op" id="2000406">.</span><span class="ident" id="2000407">name</span>&nbsp;<span class="op" id="2000412">==</span>&nbsp;<span class="ident" id="2000415">nil</span><span class="op" id="2000418">)</span>&nbsp;<span class="op" id="2000420">&amp;&amp;</span>&nbsp;<span class="op" id="2000423">(</span><span class="op" id="2000424">*</span><span class="ident" id="2000425"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189624">ptrtype</a></span><span class="op" id="2000432">)</span><span class="op" id="2000433">(</span><span class="ident" id="2000434"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2000440">.</span><span class="ident" id="2000441">Pointer</span><span class="op" id="2000448">(</span><span class="ident" id="2000449"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000453">)</span><span class="op" id="2000454">)</span><span class="op" id="2000455">.</span><span class="ident" id="2000456">elem</span>&nbsp;<span class="op" id="2000461">==</span>&nbsp;<span class="ident" id="2000464"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="2000466">.</span><span class="ident" id="2000467">elem</span>&nbsp;<span class="op" id="2000472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000477">//&nbsp;ok&nbsp;-&nbsp;not&nbsp;same&nbsp;type,&nbsp;but&nbsp;both&nbsp;pointers,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000522">//&nbsp;one&nbsp;or&nbsp;the&nbsp;other&nbsp;is&nbsp;unnamed,&nbsp;and&nbsp;same&nbsp;element&nbsp;type,&nbsp;so&nbsp;assignable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000595">goto</span>&nbsp;<span class="ident" id="2000600">okarg</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000611">case</span>&nbsp;<span class="ident" id="2000616"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000620">.</span><span class="ident" id="2000621">kind</span><span class="op" id="2000625">&amp;</span><span class="ident" id="2000626"><a href="/runtime/typekind.go.html#2178384">kindMask</a></span>&nbsp;<span class="op" id="2000635">==</span>&nbsp;<span class="ident" id="2000638"><a href="/runtime/typekind.go.html#2178047">kindInterface</a></span><span class="op" id="2000651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000655">ityp</span>&nbsp;<span class="op" id="2000660">:=</span>&nbsp;<span class="op" id="2000663">(</span><span class="op" id="2000664">*</span><span class="ident" id="2000665"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189187">interfacetype</a></span><span class="op" id="2000678">)</span><span class="op" id="2000679">(</span><span class="ident" id="2000680"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2000686">.</span><span class="ident" id="2000687">Pointer</span><span class="op" id="2000694">(</span><span class="ident" id="2000695"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2000699">)</span><span class="op" id="2000700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000704">if</span>&nbsp;<span class="builtinfunc" id="2000707">len</span><span class="op" id="2000710">(</span><span class="ident" id="2000711"><a href="/runtime/malloc.go.html#2000655">ityp</a></span><span class="op" id="2000715">.</span><span class="ident" id="2000716">mhdr</span><span class="op" id="2000720">)</span>&nbsp;<span class="op" id="2000722">==</span>&nbsp;<span class="num" id="2000725">0</span>&nbsp;<span class="op" id="2000727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000732">//&nbsp;ok&nbsp;-&nbsp;satisfies&nbsp;empty&nbsp;interface</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000769">goto</span>&nbsp;<span class="ident" id="2000774">okarg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000786">if</span>&nbsp;<span class="ident" id="2000789">_</span><span class="op" id="2000790">,</span>&nbsp;<span class="ident" id="2000792">ok</span>&nbsp;<span class="op" id="2000795">:=</span>&nbsp;<span class="ident" id="2000798"><a href="/runtime/iface.go.html#1975828">assertE2I2</a></span><span class="op" id="2000808">(</span><span class="ident" id="2000809"><a href="/runtime/malloc.go.html#2000655">ityp</a></span><span class="op" id="2000813">,</span>&nbsp;<span class="ident" id="2000815"><a href="/runtime/malloc.go.html#1997890">obj</a></span><span class="op" id="2000818">)</span><span class="op" id="2000819">;</span>&nbsp;<span class="ident" id="2000821"><a href="/runtime/malloc.go.html#2000792">ok</a></span>&nbsp;<span class="op" id="2000824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2000829">goto</span>&nbsp;<span class="ident" id="2000834">okarg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000842">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2000845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000848"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2000855">(</span><span class="string" id="2000856">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="2000893">+</span>&nbsp;<span class="op" id="2000895">*</span><span class="ident" id="2000896"><a href="/runtime/malloc.go.html#1997970">etyp</a></span><span class="op" id="2000900">.</span><span class="ident" id="2000901">_string</span>&nbsp;<span class="op" id="2000909">+</span>&nbsp;<span class="string" id="2000911">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="2000928">+</span>&nbsp;<span class="op" id="2000930">*</span><span class="ident" id="2000931"><a href="/runtime/malloc.go.html#1999692">ftyp</a></span><span class="op" id="2000935">.</span><span class="ident" id="2000936">_string</span><span class="op" id="2000943">)</span><br>
<span class="lineno"></span><span class="ident" id="2000945">okarg</span><span class="op" id="2000950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2000953">//&nbsp;compute&nbsp;size&nbsp;needed&nbsp;for&nbsp;return&nbsp;parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2000999">nret</span>&nbsp;<span class="op" id="2001004">:=</span>&nbsp;<span class="builtintype" id="2001007">uintptr</span><span class="op" id="2001014">(</span><span class="num" id="2001015">0</span><span class="op" id="2001016">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2001019">for</span>&nbsp;<span class="ident" id="2001023">_</span><span class="op" id="2001024">,</span>&nbsp;<span class="ident" id="2001026">t</span>&nbsp;<span class="op" id="2001028">:=</span>&nbsp;<span class="keyword" id="2001031">range</span>&nbsp;<span class="op" id="2001037">*</span><span class="op" id="2001038">(</span><span class="op" id="2001039">*</span><span class="op" id="2001040">[</span><span class="op" id="2001041">]</span><span class="op" id="2001042">*</span><span class="ident" id="2001043"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188707">_type</a></span><span class="op" id="2001048">)</span><span class="op" id="2001049">(</span><span class="ident" id="2001050"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2001056">.</span><span class="ident" id="2001057">Pointer</span><span class="op" id="2001064">(</span><span class="op" id="2001065">&amp;</span><span class="ident" id="2001066"><a href="/runtime/malloc.go.html#1999999">ft</a></span><span class="op" id="2001068">.</span><span class="ident" id="2001069">out</span><span class="op" id="2001072">)</span><span class="op" id="2001073">)</span>&nbsp;<span class="op" id="2001075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001079"><a href="/runtime/malloc.go.html#2000999">nret</a></span>&nbsp;<span class="op" id="2001084">=</span>&nbsp;<span class="ident" id="2001086"><a href="/runtime/malloc.go.html#2001621">round</a></span><span class="op" id="2001091">(</span><span class="ident" id="2001092"><a href="/runtime/malloc.go.html#2000999">nret</a></span><span class="op" id="2001096">,</span>&nbsp;<span class="builtintype" id="2001098">uintptr</span><span class="op" id="2001105">(</span><span class="ident" id="2001106"><a href="/runtime/malloc.go.html#2001026">t</a></span><span class="op" id="2001107">.</span><span class="ident" id="2001108">align</span><span class="op" id="2001113">)</span><span class="op" id="2001114">)</span>&nbsp;<span class="op" id="2001116">+</span>&nbsp;<span class="builtintype" id="2001118">uintptr</span><span class="op" id="2001125">(</span><span class="ident" id="2001126"><a href="/runtime/malloc.go.html#2001026">t</a></span><span class="op" id="2001127">.</span><span class="ident" id="2001128">size</span><span class="op" id="2001132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2001135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001138"><a href="/runtime/malloc.go.html#2000999">nret</a></span>&nbsp;<span class="op" id="2001143">=</span>&nbsp;<span class="ident" id="2001145"><a href="/runtime/malloc.go.html#2001621">round</a></span><span class="op" id="2001150">(</span><span class="ident" id="2001151"><a href="/runtime/malloc.go.html#2000999">nret</a></span><span class="op" id="2001155">,</span>&nbsp;<span class="ident" id="2001157"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="2001164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2001168">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;finalizer&nbsp;goroutine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001212"><a href="/runtime/malloc.go.html#2002814">createfing</a></span><span class="op" id="2001222">(</span><span class="op" id="2001223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2001227">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;to&nbsp;add&nbsp;finalizer&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001273">mp</span>&nbsp;<span class="op" id="2001276">:=</span>&nbsp;<span class="ident" id="2001279"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2001287">(</span><span class="op" id="2001288">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001291"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001293">.</span><span class="ident" id="2001294">ptrarg</span><span class="op" id="2001300">[</span><span class="num" id="2001301">0</span><span class="op" id="2001302">]</span>&nbsp;<span class="op" id="2001304">=</span>&nbsp;<span class="ident" id="2001306"><a href="/runtime/malloc.go.html#1999649">f</a></span><span class="op" id="2001307">.</span><span class="ident" id="2001308">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001314"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001316">.</span><span class="ident" id="2001317">ptrarg</span><span class="op" id="2001323">[</span><span class="num" id="2001324">1</span><span class="op" id="2001325">]</span>&nbsp;<span class="op" id="2001327">=</span>&nbsp;<span class="ident" id="2001329"><a href="/runtime/malloc.go.html#1997933">e</a></span><span class="op" id="2001330">.</span><span class="ident" id="2001331">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001337"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001339">.</span><span class="ident" id="2001340">scalararg</span><span class="op" id="2001349">[</span><span class="num" id="2001350">0</span><span class="op" id="2001351">]</span>&nbsp;<span class="op" id="2001353">=</span>&nbsp;<span class="ident" id="2001355"><a href="/runtime/malloc.go.html#2000999">nret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001361"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001363">.</span><span class="ident" id="2001364">ptrarg</span><span class="op" id="2001370">[</span><span class="num" id="2001371">2</span><span class="op" id="2001372">]</span>&nbsp;<span class="op" id="2001374">=</span>&nbsp;<span class="ident" id="2001376"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2001382">.</span><span class="ident" id="2001383">Pointer</span><span class="op" id="2001390">(</span><span class="ident" id="2001391"><a href="/runtime/malloc.go.html#2000223">fint</a></span><span class="op" id="2001395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001398"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001400">.</span><span class="ident" id="2001401">ptrarg</span><span class="op" id="2001407">[</span><span class="num" id="2001408">3</span><span class="op" id="2001409">]</span>&nbsp;<span class="op" id="2001411">=</span>&nbsp;<span class="ident" id="2001413"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2001419">.</span><span class="ident" id="2001420">Pointer</span><span class="op" id="2001427">(</span><span class="ident" id="2001428"><a href="/runtime/malloc.go.html#1998192">ot</a></span><span class="op" id="2001430">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001433"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2001436">(</span><span class="ident" id="2001437"><a href="/runtime/stubs.go.html#2135315">setFinalizer_m</a></span><span class="op" id="2001451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2001454">if</span>&nbsp;<span class="ident" id="2001457"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001459">.</span><span class="ident" id="2001460">scalararg</span><span class="op" id="2001469">[</span><span class="num" id="2001470">0</span><span class="op" id="2001471">]</span>&nbsp;<span class="op" id="2001473">!=</span>&nbsp;<span class="num" id="2001476">1</span>&nbsp;<span class="op" id="2001478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001482"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2001489">(</span><span class="string" id="2001490">&#34;runtime.SetFinalizer:&nbsp;finalizer&nbsp;already&nbsp;set&#34;</span><span class="op" id="2001535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2001538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001541"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2001549">(</span><span class="ident" id="2001550"><a href="/runtime/malloc.go.html#2001273">mp</a></span><span class="op" id="2001552">)</span><br>
<span class="lineno">655</span><span class="op" id="2001554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2001557">//&nbsp;round&nbsp;n&nbsp;up&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;a.&nbsp;&nbsp;a&nbsp;must&nbsp;be&nbsp;a&nbsp;power&nbsp;of&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="2001616">func</span>&nbsp;<span class="ident" id="2001621">round</span><span class="op" id="2001626">(</span><span class="ident" id="2001627">n</span><span class="op" id="2001628">,</span>&nbsp;<span class="ident" id="2001630">a</span>&nbsp;<span class="builtintype" id="2001632">uintptr</span><span class="op" id="2001639">)</span>&nbsp;<span class="builtintype" id="2001641">uintptr</span>&nbsp;<span class="op" id="2001649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2001652">return</span>&nbsp;<span class="op" id="2001659">(</span><span class="ident" id="2001660"><a href="/runtime/malloc.go.html#2001627">n</a></span>&nbsp;<span class="op" id="2001662">+</span>&nbsp;<span class="ident" id="2001664"><a href="/runtime/malloc.go.html#2001630">a</a></span>&nbsp;<span class="op" id="2001666">-</span>&nbsp;<span class="num" id="2001668">1</span><span class="op" id="2001669">)</span>&nbsp;<span class="op" id="2001671">&amp;^</span>&nbsp;<span class="op" id="2001674">(</span><span class="ident" id="2001675"><a href="/runtime/malloc.go.html#2001630">a</a></span>&nbsp;<span class="op" id="2001677">-</span>&nbsp;<span class="num" id="2001679">1</span><span class="op" id="2001680">)</span><br>
<span class="lineno">660</span><span class="op" id="2001682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2001685">//&nbsp;Look&nbsp;up&nbsp;pointer&nbsp;v&nbsp;in&nbsp;heap.&nbsp;&nbsp;Return&nbsp;the&nbsp;span&nbsp;containing&nbsp;the&nbsp;object,</span><br>
<span class="lineno"></span><span class="comment" id="2001755">//&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;If&nbsp;the&nbsp;object</span><br>
<span class="lineno"></span><span class="comment" id="2001826">//&nbsp;does&nbsp;not&nbsp;exist,&nbsp;return&nbsp;nil,&nbsp;nil,&nbsp;0.</span><br>
<span class="lineno">665</span><span class="keyword" id="2001865">func</span>&nbsp;<span class="ident" id="2001870">findObject</span><span class="op" id="2001880">(</span><span class="ident" id="2001881">v</span>&nbsp;<span class="ident" id="2001883"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2001889">.</span><span class="ident" id="2001890">Pointer</span><span class="op" id="2001897">)</span>&nbsp;<span class="op" id="2001899">(</span><span class="ident" id="2001900">s</span>&nbsp;<span class="op" id="2001902">*</span><span class="ident" id="2001903"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2187152">mspan</a></span><span class="op" id="2001908">,</span>&nbsp;<span class="ident" id="2001910">x</span>&nbsp;<span class="ident" id="2001912"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2001918">.</span><span class="ident" id="2001919">Pointer</span><span class="op" id="2001926">,</span>&nbsp;<span class="ident" id="2001928">n</span>&nbsp;<span class="builtintype" id="2001930">uintptr</span><span class="op" id="2001937">)</span>&nbsp;<span class="op" id="2001939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001942">c</span>&nbsp;<span class="op" id="2001944">:=</span>&nbsp;<span class="ident" id="2001947"><a href="/runtime/stubs.go.html#2132076">gomcache</a></span><span class="op" id="2001955">(</span><span class="op" id="2001956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001959"><a href="/runtime/malloc.go.html#2001942">c</a></span><span class="op" id="2001960">.</span><span class="ident" id="2001961">local_nlookup</span><span class="op" id="2001974">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2001978">if</span>&nbsp;<span class="ident" id="2001981"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="2001989">==</span>&nbsp;<span class="num" id="2001992">4</span>&nbsp;<span class="op" id="2001994">&amp;&amp;</span>&nbsp;<span class="ident" id="2001997"><a href="/runtime/malloc.go.html#2001942">c</a></span><span class="op" id="2001998">.</span><span class="ident" id="2001999">local_nlookup</span>&nbsp;<span class="op" id="2002013">&gt;=</span>&nbsp;<span class="num" id="2002016">1</span><span class="op" id="2002017">&lt;&lt;</span><span class="num" id="2002019">30</span>&nbsp;<span class="op" id="2002022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002026">//&nbsp;purge&nbsp;cache&nbsp;stats&nbsp;to&nbsp;prevent&nbsp;overflow</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002069"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2002073">(</span><span class="op" id="2002074">&amp;</span><span class="ident" id="2002075"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="2002081">.</span><span class="ident" id="2002082">lock</span><span class="op" id="2002086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002090"><a href="/runtime/stubs.go.html#2137677">purgecachedstats</a></span><span class="op" id="2002106">(</span><span class="ident" id="2002107"><a href="/runtime/malloc.go.html#2001942">c</a></span><span class="op" id="2002108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002112"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2002118">(</span><span class="op" id="2002119">&amp;</span><span class="ident" id="2002120"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="2002126">.</span><span class="ident" id="2002127">lock</span><span class="op" id="2002131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002138">//&nbsp;find&nbsp;span</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002152">arena_start</span>&nbsp;<span class="op" id="2002164">:=</span>&nbsp;<span class="builtintype" id="2002167">uintptr</span><span class="op" id="2002174">(</span><span class="ident" id="2002175"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2002181">.</span><span class="ident" id="2002182">Pointer</span><span class="op" id="2002189">(</span><span class="ident" id="2002190"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="2002196">.</span><span class="ident" id="2002197">arena_start</span><span class="op" id="2002208">)</span><span class="op" id="2002209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002212">arena_used</span>&nbsp;<span class="op" id="2002223">:=</span>&nbsp;<span class="builtintype" id="2002226">uintptr</span><span class="op" id="2002233">(</span><span class="ident" id="2002234"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2002240">.</span><span class="ident" id="2002241">Pointer</span><span class="op" id="2002248">(</span><span class="ident" id="2002249"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="2002255">.</span><span class="ident" id="2002256">arena_used</span><span class="op" id="2002266">)</span><span class="op" id="2002267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002270">if</span>&nbsp;<span class="builtintype" id="2002273">uintptr</span><span class="op" id="2002280">(</span><span class="ident" id="2002281"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002282">)</span>&nbsp;<span class="op" id="2002284">&lt;</span>&nbsp;<span class="ident" id="2002286"><a href="/runtime/malloc.go.html#2002152">arena_start</a></span>&nbsp;<span class="op" id="2002298">||</span>&nbsp;<span class="builtintype" id="2002301">uintptr</span><span class="op" id="2002308">(</span><span class="ident" id="2002309"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002310">)</span>&nbsp;<span class="op" id="2002312">&gt;=</span>&nbsp;<span class="ident" id="2002315"><a href="/runtime/malloc.go.html#2002212">arena_used</a></span>&nbsp;<span class="op" id="2002326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002330">return</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002341">p</span>&nbsp;<span class="op" id="2002343">:=</span>&nbsp;<span class="builtintype" id="2002346">uintptr</span><span class="op" id="2002353">(</span><span class="ident" id="2002354"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002355">)</span>&nbsp;<span class="op" id="2002357">&gt;&gt;</span>&nbsp;<span class="ident" id="2002360"><a href="/runtime/malloc.go.html#1982101">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002371">q</span>&nbsp;<span class="op" id="2002373">:=</span>&nbsp;<span class="ident" id="2002376"><a href="/runtime/malloc.go.html#2002341">p</a></span>&nbsp;<span class="op" id="2002378">-</span>&nbsp;<span class="ident" id="2002380"><a href="/runtime/malloc.go.html#2002152">arena_start</a></span><span class="op" id="2002391">&gt;&gt;</span><span class="ident" id="2002393"><a href="/runtime/malloc.go.html#1982101">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002404"><a href="/runtime/malloc.go.html#2001900">s</a></span>&nbsp;<span class="op" id="2002406">=</span>&nbsp;<span class="op" id="2002408">*</span><span class="op" id="2002409">(</span><span class="op" id="2002410">*</span><span class="op" id="2002411">*</span><span class="ident" id="2002412"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2187152">mspan</a></span><span class="op" id="2002417">)</span><span class="op" id="2002418">(</span><span class="ident" id="2002419"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2002422">(</span><span class="ident" id="2002423"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2002429">.</span><span class="ident" id="2002430">Pointer</span><span class="op" id="2002437">(</span><span class="ident" id="2002438"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188152">mheap_</a></span><span class="op" id="2002444">.</span><span class="ident" id="2002445">spans</span><span class="op" id="2002450">)</span><span class="op" id="2002451">,</span>&nbsp;<span class="ident" id="2002453"><a href="/runtime/malloc.go.html#2002371">q</a></span><span class="op" id="2002454">*</span><span class="ident" id="2002455"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="2002462">)</span><span class="op" id="2002463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002466">if</span>&nbsp;<span class="ident" id="2002469"><a href="/runtime/malloc.go.html#2001900">s</a></span>&nbsp;<span class="op" id="2002471">==</span>&nbsp;<span class="ident" id="2002474">nil</span>&nbsp;<span class="op" id="2002478">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002493"><a href="/runtime/malloc.go.html#2001910">x</a></span>&nbsp;<span class="op" id="2002495">=</span>&nbsp;<span class="ident" id="2002497"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2002503">.</span><span class="ident" id="2002504">Pointer</span><span class="op" id="2002511">(</span><span class="builtintype" id="2002512">uintptr</span><span class="op" id="2002519">(</span><span class="ident" id="2002520"><a href="/runtime/malloc.go.html#2001900">s</a></span><span class="op" id="2002521">.</span><span class="ident" id="2002522">start</span><span class="op" id="2002527">)</span>&nbsp;<span class="op" id="2002529">&lt;&lt;</span>&nbsp;<span class="ident" id="2002532"><a href="/runtime/malloc.go.html#1982101">pageShift</a></span><span class="op" id="2002541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002545">if</span>&nbsp;<span class="builtintype" id="2002548">uintptr</span><span class="op" id="2002555">(</span><span class="ident" id="2002556"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002557">)</span>&nbsp;<span class="op" id="2002559">&lt;</span>&nbsp;<span class="builtintype" id="2002561">uintptr</span><span class="op" id="2002568">(</span><span class="ident" id="2002569"><a href="/runtime/malloc.go.html#2001910">x</a></span><span class="op" id="2002570">)</span>&nbsp;<span class="op" id="2002572">||</span>&nbsp;<span class="builtintype" id="2002575">uintptr</span><span class="op" id="2002582">(</span><span class="ident" id="2002583"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002584">)</span>&nbsp;<span class="op" id="2002586">&gt;=</span>&nbsp;<span class="builtintype" id="2002589">uintptr</span><span class="op" id="2002596">(</span><span class="ident" id="2002597"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2002603">.</span><span class="ident" id="2002604">Pointer</span><span class="op" id="2002611">(</span><span class="ident" id="2002612"><a href="/runtime/malloc.go.html#2001900">s</a></span><span class="op" id="2002613">.</span><span class="ident" id="2002614">limit</span><span class="op" id="2002619">)</span><span class="op" id="2002620">)</span>&nbsp;<span class="op" id="2002622">||</span>&nbsp;<span class="ident" id="2002625"><a href="/runtime/malloc.go.html#2001900">s</a></span><span class="op" id="2002626">.</span><span class="ident" id="2002627">state</span>&nbsp;<span class="op" id="2002633">!=</span>&nbsp;<span class="ident" id="2002636"><a href="/runtime/malloc.go.html#1982364">mSpanInUse</a></span>&nbsp;<span class="op" id="2002647">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002651"><a href="/runtime/malloc.go.html#2001900">s</a></span>&nbsp;<span class="op" id="2002653">=</span>&nbsp;<span class="ident" id="2002655">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002661"><a href="/runtime/malloc.go.html#2001910">x</a></span>&nbsp;<span class="op" id="2002663">=</span>&nbsp;<span class="ident" id="2002665">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002671">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002683"><a href="/runtime/malloc.go.html#2001928">n</a></span>&nbsp;<span class="op" id="2002685">=</span>&nbsp;<span class="builtintype" id="2002687">uintptr</span><span class="op" id="2002694">(</span><span class="ident" id="2002695"><a href="/runtime/malloc.go.html#2001900">s</a></span><span class="op" id="2002696">.</span><span class="ident" id="2002697">elemsize</span><span class="op" id="2002705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002708">if</span>&nbsp;<span class="ident" id="2002711"><a href="/runtime/malloc.go.html#2001900">s</a></span><span class="op" id="2002712">.</span><span class="ident" id="2002713">sizeclass</span>&nbsp;<span class="op" id="2002723">!=</span>&nbsp;<span class="num" id="2002726">0</span>&nbsp;<span class="op" id="2002728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002732"><a href="/runtime/malloc.go.html#2001910">x</a></span>&nbsp;<span class="op" id="2002734">=</span>&nbsp;<span class="ident" id="2002736"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2002739">(</span><span class="ident" id="2002740"><a href="/runtime/malloc.go.html#2001910">x</a></span><span class="op" id="2002741">,</span>&nbsp;<span class="op" id="2002743">(</span><span class="builtintype" id="2002744">uintptr</span><span class="op" id="2002751">(</span><span class="ident" id="2002752"><a href="/runtime/malloc.go.html#2001881">v</a></span><span class="op" id="2002753">)</span><span class="op" id="2002754">-</span><span class="builtintype" id="2002755">uintptr</span><span class="op" id="2002762">(</span><span class="ident" id="2002763"><a href="/runtime/malloc.go.html#2001910">x</a></span><span class="op" id="2002764">)</span><span class="op" id="2002765">)</span><span class="op" id="2002766">/</span><span class="ident" id="2002767"><a href="/runtime/malloc.go.html#2001928">n</a></span><span class="op" id="2002768">*</span><span class="ident" id="2002769"><a href="/runtime/malloc.go.html#2001928">n</a></span><span class="op" id="2002770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002776">return</span><br>
<span class="lineno">700</span><span class="op" id="2002783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002786">var</span>&nbsp;<span class="ident" id="2002790">fingCreate</span>&nbsp;<span class="builtintype" id="2002801">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2002809">func</span>&nbsp;<span class="ident" id="2002814">createfing</span><span class="op" id="2002824">(</span><span class="op" id="2002825">)</span>&nbsp;<span class="op" id="2002827">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002830">//&nbsp;start&nbsp;the&nbsp;finalizer&nbsp;goroutine&nbsp;exactly&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002877">if</span>&nbsp;<span class="ident" id="2002880"><a href="/runtime/malloc.go.html#2002790">fingCreate</a></span>&nbsp;<span class="op" id="2002891">==</span>&nbsp;<span class="num" id="2002894">0</span>&nbsp;<span class="op" id="2002896">&amp;&amp;</span>&nbsp;<span class="ident" id="2002899"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="2002902">(</span><span class="op" id="2002903">&amp;</span><span class="ident" id="2002904"><a href="/runtime/malloc.go.html#2002790">fingCreate</a></span><span class="op" id="2002914">,</span>&nbsp;<span class="num" id="2002916">0</span><span class="op" id="2002917">,</span>&nbsp;<span class="num" id="2002919">1</span><span class="op" id="2002920">)</span>&nbsp;<span class="op" id="2002922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002926">go</span>&nbsp;<span class="ident" id="2002929"><a href="/runtime/malloc.go.html#2003007">runfinq</a></span><span class="op" id="2002936">(</span><span class="op" id="2002937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002940">}</span><br>
<span class="lineno"></span><span class="op" id="2002942">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="2002945">//&nbsp;This&nbsp;is&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;runs&nbsp;all&nbsp;of&nbsp;the&nbsp;finalizers</span><br>
<span class="lineno"></span><span class="keyword" id="2003002">func</span>&nbsp;<span class="ident" id="2003007">runfinq</span><span class="op" id="2003014">(</span><span class="op" id="2003015">)</span>&nbsp;<span class="op" id="2003017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003020">var</span>&nbsp;<span class="op" id="2003024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003028">frame</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2003037"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2003043">.</span><span class="ident" id="2003044">Pointer</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003054">framecap</span>&nbsp;<span class="builtintype" id="2003063">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003076">for</span>&nbsp;<span class="op" id="2003080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003084"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2003088">(</span><span class="op" id="2003089">&amp;</span><span class="ident" id="2003090"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188434">finlock</a></span><span class="op" id="2003097">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003101">fb</span>&nbsp;<span class="op" id="2003104">:=</span>&nbsp;<span class="ident" id="2003107"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188500">finq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003114"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188500">finq</a></span>&nbsp;<span class="op" id="2003119">=</span>&nbsp;<span class="ident" id="2003121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003127">if</span>&nbsp;<span class="ident" id="2003130"><a href="/runtime/malloc.go.html#2003101">fb</a></span>&nbsp;<span class="op" id="2003133">==</span>&nbsp;<span class="ident" id="2003136">nil</span>&nbsp;<span class="op" id="2003140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003145">gp</span>&nbsp;<span class="op" id="2003148">:=</span>&nbsp;<span class="ident" id="2003151"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2003155">(</span><span class="op" id="2003156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003161"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188452">fing</a></span>&nbsp;<span class="op" id="2003166">=</span>&nbsp;<span class="ident" id="2003168"><a href="/runtime/malloc.go.html#2003145">gp</a></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003174"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188464">fingwait</a></span>&nbsp;<span class="op" id="2003183">=</span>&nbsp;<span class="builtintype" id="2003185">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003193"><a href="/runtime/malloc.go.html#2003145">gp</a></span><span class="op" id="2003195">.</span><span class="ident" id="2003196">issystem</span>&nbsp;<span class="op" id="2003205">=</span>&nbsp;<span class="builtintype" id="2003207">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003215"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="2003227">(</span><span class="op" id="2003228">&amp;</span><span class="ident" id="2003229"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188434">finlock</a></span><span class="op" id="2003236">,</span>&nbsp;<span class="string" id="2003238">&#34;finalizer&nbsp;wait&#34;</span><span class="op" id="2003254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003259"><a href="/runtime/malloc.go.html#2003145">gp</a></span><span class="op" id="2003261">.</span><span class="ident" id="2003262">issystem</span>&nbsp;<span class="op" id="2003271">=</span>&nbsp;<span class="builtintype" id="2003273">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003282">continue</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003297"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2003303">(</span><span class="op" id="2003304">&amp;</span><span class="ident" id="2003305"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188434">finlock</a></span><span class="op" id="2003312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003316">if</span>&nbsp;<span class="ident" id="2003319"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2003331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003336"><a href="/runtime/race0.go.html#2071158">racefingo</a></span><span class="op" id="2003345">(</span><span class="op" id="2003346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003350">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003354">for</span>&nbsp;<span class="ident" id="2003358"><a href="/runtime/malloc.go.html#2003101">fb</a></span>&nbsp;<span class="op" id="2003361">!=</span>&nbsp;<span class="ident" id="2003364">nil</span>&nbsp;<span class="op" id="2003368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003373">for</span>&nbsp;<span class="ident" id="2003377">i</span>&nbsp;<span class="op" id="2003379">:=</span>&nbsp;<span class="builtintype" id="2003382">int32</span><span class="op" id="2003387">(</span><span class="num" id="2003388">0</span><span class="op" id="2003389">)</span><span class="op" id="2003390">;</span>&nbsp;<span class="ident" id="2003392"><a href="/runtime/malloc.go.html#2003377">i</a></span>&nbsp;<span class="op" id="2003394">&lt;</span>&nbsp;<span class="ident" id="2003396"><a href="/runtime/malloc.go.html#2003101">fb</a></span><span class="op" id="2003398">.</span><span class="ident" id="2003399">cnt</span><span class="op" id="2003402">;</span>&nbsp;<span class="ident" id="2003404"><a href="/runtime/malloc.go.html#2003377">i</a></span><span class="op" id="2003405">++</span>&nbsp;<span class="op" id="2003408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003414">f</span>&nbsp;<span class="op" id="2003416">:=</span>&nbsp;<span class="op" id="2003419">(</span><span class="op" id="2003420">*</span><span class="ident" id="2003421"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188234">finalizer</a></span><span class="op" id="2003430">)</span><span class="op" id="2003431">(</span><span class="ident" id="2003432"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2003435">(</span><span class="ident" id="2003436"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2003442">.</span><span class="ident" id="2003443">Pointer</span><span class="op" id="2003450">(</span><span class="op" id="2003451">&amp;</span><span class="ident" id="2003452"><a href="/runtime/malloc.go.html#2003101">fb</a></span><span class="op" id="2003454">.</span><span class="ident" id="2003455">fin</span><span class="op" id="2003458">)</span><span class="op" id="2003459">,</span>&nbsp;<span class="builtintype" id="2003461">uintptr</span><span class="op" id="2003468">(</span><span class="ident" id="2003469"><a href="/runtime/malloc.go.html#2003377">i</a></span><span class="op" id="2003470">)</span><span class="op" id="2003471">*</span><span class="ident" id="2003472"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2003478">.</span><span class="ident" id="2003479">Sizeof</span><span class="op" id="2003485">(</span><span class="ident" id="2003486"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188234">finalizer</a></span><span class="op" id="2003495">{</span><span class="op" id="2003496">}</span><span class="op" id="2003497">)</span><span class="op" id="2003498">)</span><span class="op" id="2003499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003506">framesz</span>&nbsp;<span class="op" id="2003514">:=</span>&nbsp;<span class="ident" id="2003517"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2003523">.</span><span class="ident" id="2003524">Sizeof</span><span class="op" id="2003530">(</span><span class="op" id="2003531">(</span><span class="keyword" id="2003532">interface</span><span class="op" id="2003541">{</span><span class="op" id="2003542">}</span><span class="op" id="2003543">)</span><span class="op" id="2003544">(</span><span class="ident" id="2003545">nil</span><span class="op" id="2003548">)</span><span class="op" id="2003549">)</span>&nbsp;<span class="op" id="2003551">+</span>&nbsp;<span class="builtintype" id="2003553">uintptr</span><span class="op" id="2003560">(</span><span class="ident" id="2003561"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2003562">.</span><span class="ident" id="2003563">nret</span><span class="op" id="2003567">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003573">if</span>&nbsp;<span class="ident" id="2003576"><a href="/runtime/malloc.go.html#2003054">framecap</a></span>&nbsp;<span class="op" id="2003585">&lt;</span>&nbsp;<span class="ident" id="2003587"><a href="/runtime/malloc.go.html#2003506">framesz</a></span>&nbsp;<span class="op" id="2003595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003602">//&nbsp;The&nbsp;frame&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003666">//&nbsp;all&nbsp;not&nbsp;yet&nbsp;finalized&nbsp;objects&nbsp;are&nbsp;stored&nbsp;in&nbsp;finq.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003724">//&nbsp;If&nbsp;we&nbsp;do&nbsp;not&nbsp;mark&nbsp;it&nbsp;as&nbsp;FlagNoScan,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003768">//&nbsp;the&nbsp;last&nbsp;finalized&nbsp;object&nbsp;is&nbsp;not&nbsp;collected.</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003820"><a href="/runtime/malloc.go.html#2003028">frame</a></span>&nbsp;<span class="op" id="2003826">=</span>&nbsp;<span class="ident" id="2003828"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="2003836">(</span><span class="ident" id="2003837"><a href="/runtime/malloc.go.html#2003506">framesz</a></span><span class="op" id="2003844">,</span>&nbsp;<span class="ident" id="2003846">nil</span><span class="op" id="2003849">,</span>&nbsp;<span class="ident" id="2003851"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><span class="op" id="2003861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003868"><a href="/runtime/malloc.go.html#2003054">framecap</a></span>&nbsp;<span class="op" id="2003877">=</span>&nbsp;<span class="ident" id="2003879"><a href="/runtime/malloc.go.html#2003506">framesz</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003898">if</span>&nbsp;<span class="ident" id="2003901"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2003902">.</span><span class="ident" id="2003903">fint</span>&nbsp;<span class="op" id="2003908">==</span>&nbsp;<span class="ident" id="2003911">nil</span>&nbsp;<span class="op" id="2003915">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003922"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2003929">(</span><span class="string" id="2003930">&#34;missing&nbsp;type&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="2003955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003967">switch</span>&nbsp;<span class="ident" id="2003974"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2003975">.</span><span class="ident" id="2003976">fint</span><span class="op" id="2003980">.</span><span class="ident" id="2003981">kind</span>&nbsp;<span class="op" id="2003986">&amp;</span>&nbsp;<span class="ident" id="2003988"><a href="/runtime/typekind.go.html#2178384">kindMask</a></span>&nbsp;<span class="op" id="2003997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004003">case</span>&nbsp;<span class="ident" id="2004008"><a href="/runtime/typekind.go.html#2178113">kindPtr</a></span><span class="op" id="2004015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004022">//&nbsp;direct&nbsp;use&nbsp;of&nbsp;pointer</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004052">*</span><span class="op" id="2004053">(</span><span class="op" id="2004054">*</span><span class="ident" id="2004055"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2004061">.</span><span class="ident" id="2004062">Pointer</span><span class="op" id="2004069">)</span><span class="op" id="2004070">(</span><span class="ident" id="2004071"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004076">)</span>&nbsp;<span class="op" id="2004078">=</span>&nbsp;<span class="ident" id="2004080"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004081">.</span><span class="ident" id="2004082">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004090">case</span>&nbsp;<span class="ident" id="2004095"><a href="/runtime/typekind.go.html#2178047">kindInterface</a></span><span class="op" id="2004108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004115">ityp</span>&nbsp;<span class="op" id="2004120">:=</span>&nbsp;<span class="op" id="2004123">(</span><span class="op" id="2004124">*</span><span class="ident" id="2004125"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189187">interfacetype</a></span><span class="op" id="2004138">)</span><span class="op" id="2004139">(</span><span class="ident" id="2004140"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2004146">.</span><span class="ident" id="2004147">Pointer</span><span class="op" id="2004154">(</span><span class="ident" id="2004155"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004156">.</span><span class="ident" id="2004157">fint</span><span class="op" id="2004161">)</span><span class="op" id="2004162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004169">//&nbsp;set&nbsp;up&nbsp;with&nbsp;empty&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004205">(</span><span class="op" id="2004206">*</span><span class="ident" id="2004207"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179525">eface</a></span><span class="op" id="2004212">)</span><span class="op" id="2004213">(</span><span class="ident" id="2004214"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004219">)</span><span class="op" id="2004220">.</span><span class="ident" id="2004221">_type</span>&nbsp;<span class="op" id="2004227">=</span>&nbsp;<span class="op" id="2004229">&amp;</span><span class="ident" id="2004230"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004231">.</span><span class="ident" id="2004232">ot</span><span class="op" id="2004234">.</span><span class="ident" id="2004235">typ</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004244">(</span><span class="op" id="2004245">*</span><span class="ident" id="2004246"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179525">eface</a></span><span class="op" id="2004251">)</span><span class="op" id="2004252">(</span><span class="ident" id="2004253"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004258">)</span><span class="op" id="2004259">.</span><span class="ident" id="2004260">data</span>&nbsp;<span class="op" id="2004265">=</span>&nbsp;<span class="ident" id="2004267"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004268">.</span><span class="ident" id="2004269">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004278">if</span>&nbsp;<span class="builtinfunc" id="2004281">len</span><span class="op" id="2004284">(</span><span class="ident" id="2004285"><a href="/runtime/malloc.go.html#2004115">ityp</a></span><span class="op" id="2004289">.</span><span class="ident" id="2004290">mhdr</span><span class="op" id="2004294">)</span>&nbsp;<span class="op" id="2004296">!=</span>&nbsp;<span class="num" id="2004299">0</span>&nbsp;<span class="op" id="2004301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004309">//&nbsp;convert&nbsp;to&nbsp;interface&nbsp;with&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004352">//&nbsp;this&nbsp;conversion&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;succeed&nbsp;-&nbsp;we&nbsp;checked&nbsp;in&nbsp;SetFinalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004431">*</span><span class="op" id="2004432">(</span><span class="op" id="2004433">*</span><span class="ident" id="2004434"><a href="/runtime/iface.go.html#1967397">fInterface</a></span><span class="op" id="2004444">)</span><span class="op" id="2004445">(</span><span class="ident" id="2004446"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004451">)</span>&nbsp;<span class="op" id="2004453">=</span>&nbsp;<span class="ident" id="2004455"><a href="/runtime/iface.go.html#1975469">assertE2I</a></span><span class="op" id="2004464">(</span><span class="ident" id="2004465"><a href="/runtime/malloc.go.html#2004115">ityp</a></span><span class="op" id="2004469">,</span>&nbsp;<span class="op" id="2004471">*</span><span class="op" id="2004472">(</span><span class="op" id="2004473">*</span><span class="keyword" id="2004474">interface</span><span class="op" id="2004483">{</span><span class="op" id="2004484">}</span><span class="op" id="2004485">)</span><span class="op" id="2004486">(</span><span class="ident" id="2004487"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004492">)</span><span class="op" id="2004493">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004506">default</span><span class="op" id="2004513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004520"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2004527">(</span><span class="string" id="2004528">&#34;bad&nbsp;kind&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="2004549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004561"><a href="/runtime/stubs.go.html#2137463">reflectcall</a></span><span class="op" id="2004572">(</span><span class="ident" id="2004573"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2004579">.</span><span class="ident" id="2004580">Pointer</span><span class="op" id="2004587">(</span><span class="ident" id="2004588"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004589">.</span><span class="ident" id="2004590">fn</span><span class="op" id="2004592">)</span><span class="op" id="2004593">,</span>&nbsp;<span class="ident" id="2004595"><a href="/runtime/malloc.go.html#2003028">frame</a></span><span class="op" id="2004600">,</span>&nbsp;<span class="builtintype" id="2004602">uint32</span><span class="op" id="2004608">(</span><span class="ident" id="2004609"><a href="/runtime/malloc.go.html#2003506">framesz</a></span><span class="op" id="2004616">)</span><span class="op" id="2004617">,</span>&nbsp;<span class="builtintype" id="2004619">uint32</span><span class="op" id="2004625">(</span><span class="ident" id="2004626"><a href="/runtime/malloc.go.html#2003506">framesz</a></span><span class="op" id="2004633">)</span><span class="op" id="2004634">)</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2004641">//&nbsp;drop&nbsp;finalizer&nbsp;queue&nbsp;references&nbsp;to&nbsp;finalized&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004700"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004701">.</span><span class="ident" id="2004702">fn</span>&nbsp;<span class="op" id="2004705">=</span>&nbsp;<span class="ident" id="2004707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004715"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004716">.</span><span class="ident" id="2004717">arg</span>&nbsp;<span class="op" id="2004721">=</span>&nbsp;<span class="ident" id="2004723">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004731"><a href="/runtime/malloc.go.html#2003414">f</a></span><span class="op" id="2004732">.</span><span class="ident" id="2004733">ot</span>&nbsp;<span class="op" id="2004736">=</span>&nbsp;<span class="ident" id="2004738">nil</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004750"><a href="/runtime/malloc.go.html#2003101">fb</a></span><span class="op" id="2004752">.</span><span class="ident" id="2004753">cnt</span>&nbsp;<span class="op" id="2004757">=</span>&nbsp;<span class="num" id="2004759">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004764">next</span>&nbsp;<span class="op" id="2004769">:=</span>&nbsp;<span class="ident" id="2004772"><a href="/runtime/malloc.go.html#2003101">fb</a></span><span class="op" id="2004774">.</span><span class="ident" id="2004775">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004783"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2004787">(</span><span class="op" id="2004788">&amp;</span><span class="ident" id="2004789"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188434">finlock</a></span><span class="op" id="2004796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004801"><a href="/runtime/malloc.go.html#2003101">fb</a></span><span class="op" id="2004803">.</span><span class="ident" id="2004804">next</span>&nbsp;<span class="op" id="2004809">=</span>&nbsp;<span class="ident" id="2004811"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188519">finc</a></span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004819"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188519">finc</a></span>&nbsp;<span class="op" id="2004824">=</span>&nbsp;<span class="ident" id="2004826"><a href="/runtime/malloc.go.html#2003101">fb</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004832"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2004838">(</span><span class="op" id="2004839">&amp;</span><span class="ident" id="2004840"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2188434">finlock</a></span><span class="op" id="2004847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004852"><a href="/runtime/malloc.go.html#2003101">fb</a></span>&nbsp;<span class="op" id="2004855">=</span>&nbsp;<span class="ident" id="2004857"><a href="/runtime/malloc.go.html#2004764">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004867">}</span><br>
<span class="lineno">785</span><span class="op" id="2004869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2004872">var</span>&nbsp;<span class="ident" id="2004876">persistent</span>&nbsp;<span class="keyword" id="2004887">struct</span>&nbsp;<span class="op" id="2004894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004897">lock</span>&nbsp;<span class="ident" id="2004902"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004909">pos</span>&nbsp;&nbsp;<span class="ident" id="2004914"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2004920">.</span><span class="ident" id="2004921">Pointer</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004930">end</span>&nbsp;&nbsp;<span class="ident" id="2004935"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2004941">.</span><span class="ident" id="2004942">Pointer</span><br>
<span class="lineno"></span><span class="op" id="2004950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2004953">//&nbsp;Wrapper&nbsp;around&nbsp;sysAlloc&nbsp;that&nbsp;can&nbsp;allocate&nbsp;small&nbsp;chunks.</span><br>
<span class="lineno"></span><span class="comment" id="2005012">//&nbsp;There&nbsp;is&nbsp;no&nbsp;associated&nbsp;free&nbsp;operation.</span><br>
<span class="lineno">795</span><span class="comment" id="2005054">//&nbsp;Intended&nbsp;for&nbsp;things&nbsp;like&nbsp;function/type/debug-related&nbsp;persistent&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="2005127">//&nbsp;If&nbsp;align&nbsp;is&nbsp;0,&nbsp;uses&nbsp;default&nbsp;align&nbsp;(currently&nbsp;8).</span><br>
<span class="lineno"></span><span class="keyword" id="2005179">func</span>&nbsp;<span class="ident" id="2005184">persistentalloc</span><span class="op" id="2005199">(</span><span class="ident" id="2005200">size</span><span class="op" id="2005204">,</span>&nbsp;<span class="ident" id="2005206">align</span>&nbsp;<span class="builtintype" id="2005212">uintptr</span><span class="op" id="2005219">,</span>&nbsp;<span class="ident" id="2005221">stat</span>&nbsp;<span class="op" id="2005226">*</span><span class="ident" id="2005227">uint64</span><span class="op" id="2005233">)</span>&nbsp;<span class="ident" id="2005235"><a href="/runtime/malloc.go.html#1981914">unsafe</a></span><span class="op" id="2005241">.</span><span class="ident" id="2005242">Pointer</span>&nbsp;<span class="op" id="2005250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005253">const</span>&nbsp;<span class="op" id="2005259">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005263">chunk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2005272">=</span>&nbsp;<span class="num" id="2005274">256</span>&nbsp;<span class="op" id="2005278">&lt;&lt;</span>&nbsp;<span class="num" id="2005281">10</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005286">maxBlock</span>&nbsp;<span class="op" id="2005295">=</span>&nbsp;<span class="num" id="2005297">64</span>&nbsp;<span class="op" id="2005300">&lt;&lt;</span>&nbsp;<span class="num" id="2005303">10</span>&nbsp;<span class="comment" id="2005306">//&nbsp;VM&nbsp;reservation&nbsp;granularity&nbsp;is&nbsp;64K&nbsp;on&nbsp;windows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005359">if</span>&nbsp;<span class="ident" id="2005362"><a href="/runtime/malloc.go.html#2005206">align</a></span>&nbsp;<span class="op" id="2005368">!=</span>&nbsp;<span class="num" id="2005371">0</span>&nbsp;<span class="op" id="2005373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005377">if</span>&nbsp;<span class="ident" id="2005380"><a href="/runtime/malloc.go.html#2005206">align</a></span><span class="op" id="2005385">&amp;</span><span class="op" id="2005386">(</span><span class="ident" id="2005387"><a href="/runtime/malloc.go.html#2005206">align</a></span><span class="op" id="2005392">-</span><span class="num" id="2005393">1</span><span class="op" id="2005394">)</span>&nbsp;<span class="op" id="2005396">!=</span>&nbsp;<span class="num" id="2005399">0</span>&nbsp;<span class="op" id="2005401">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005406"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2005413">(</span><span class="string" id="2005414">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;not&nbsp;a&nbsp;power&nbsp;of&nbsp;2&#34;</span><span class="op" id="2005458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005466">if</span>&nbsp;<span class="ident" id="2005469"><a href="/runtime/malloc.go.html#2005206">align</a></span>&nbsp;<span class="op" id="2005475">&gt;</span>&nbsp;<span class="ident" id="2005477"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184983">_PageSize</a></span>&nbsp;<span class="op" id="2005487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005492"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2005499">(</span><span class="string" id="2005500">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="2005537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005541">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005544">}</span>&nbsp;<span class="keyword" id="2005546">else</span>&nbsp;<span class="op" id="2005551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005555"><a href="/runtime/malloc.go.html#2005206">align</a></span>&nbsp;<span class="op" id="2005561">=</span>&nbsp;<span class="num" id="2005563">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005570">if</span>&nbsp;<span class="ident" id="2005573"><a href="/runtime/malloc.go.html#2005200">size</a></span>&nbsp;<span class="op" id="2005578">&gt;=</span>&nbsp;<span class="ident" id="2005581"><a href="/runtime/malloc.go.html#2005286">maxBlock</a></span>&nbsp;<span class="op" id="2005590">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005594">return</span>&nbsp;<span class="ident" id="2005601"><a href="/runtime/mprof.go.html#2017410">sysAlloc</a></span><span class="op" id="2005609">(</span><span class="ident" id="2005610"><a href="/runtime/malloc.go.html#2005200">size</a></span><span class="op" id="2005614">,</span>&nbsp;<span class="ident" id="2005616"><a href="/runtime/malloc.go.html#2005221">stat</a></span><span class="op" id="2005620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005627"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2005631">(</span><span class="op" id="2005632">&amp;</span><span class="ident" id="2005633"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005643">.</span><span class="ident" id="2005644">lock</span><span class="op" id="2005648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005651"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005661">.</span><span class="ident" id="2005662">pos</span>&nbsp;<span class="op" id="2005666">=</span>&nbsp;<span class="ident" id="2005668"><a href="/runtime/stubs.go.html#2131868">roundup</a></span><span class="op" id="2005675">(</span><span class="ident" id="2005676"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005686">.</span><span class="ident" id="2005687">pos</span><span class="op" id="2005690">,</span>&nbsp;<span class="ident" id="2005692"><a href="/runtime/malloc.go.html#2005206">align</a></span><span class="op" id="2005697">)</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005700">if</span>&nbsp;<span class="builtintype" id="2005703">uintptr</span><span class="op" id="2005710">(</span><span class="ident" id="2005711"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005721">.</span><span class="ident" id="2005722">pos</span><span class="op" id="2005725">)</span><span class="op" id="2005726">+</span><span class="ident" id="2005727"><a href="/runtime/malloc.go.html#2005200">size</a></span>&nbsp;<span class="op" id="2005732">&gt;</span>&nbsp;<span class="builtintype" id="2005734">uintptr</span><span class="op" id="2005741">(</span><span class="ident" id="2005742"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005752">.</span><span class="ident" id="2005753">end</span><span class="op" id="2005756">)</span>&nbsp;<span class="op" id="2005758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005762"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005772">.</span><span class="ident" id="2005773">pos</span>&nbsp;<span class="op" id="2005777">=</span>&nbsp;<span class="ident" id="2005779"><a href="/runtime/mprof.go.html#2017410">sysAlloc</a></span><span class="op" id="2005787">(</span><span class="ident" id="2005788"><a href="/runtime/malloc.go.html#2005263">chunk</a></span><span class="op" id="2005793">,</span>&nbsp;<span class="op" id="2005795">&amp;</span><span class="ident" id="2005796"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2005804">.</span><span class="ident" id="2005805">other_sys</span><span class="op" id="2005814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2005818">if</span>&nbsp;<span class="ident" id="2005821"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005831">.</span><span class="ident" id="2005832">pos</span>&nbsp;<span class="op" id="2005836">==</span>&nbsp;<span class="ident" id="2005839">nil</span>&nbsp;<span class="op" id="2005843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005848"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2005854">(</span><span class="op" id="2005855">&amp;</span><span class="ident" id="2005856"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005866">.</span><span class="ident" id="2005867">lock</span><span class="op" id="2005871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005876"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2005883">(</span><span class="string" id="2005884">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="2005917">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005925"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005935">.</span><span class="ident" id="2005936">end</span>&nbsp;<span class="op" id="2005940">=</span>&nbsp;<span class="ident" id="2005942"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2005945">(</span><span class="ident" id="2005946"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005956">.</span><span class="ident" id="2005957">pos</span><span class="op" id="2005960">,</span>&nbsp;<span class="ident" id="2005962"><a href="/runtime/malloc.go.html#2005263">chunk</a></span><span class="op" id="2005967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2005970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005973">p</span>&nbsp;<span class="op" id="2005975">:=</span>&nbsp;<span class="ident" id="2005978"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2005988">.</span><span class="ident" id="2005989">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2005994"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2006004">.</span><span class="ident" id="2006005">pos</span>&nbsp;<span class="op" id="2006009">=</span>&nbsp;<span class="ident" id="2006011"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2006014">(</span><span class="ident" id="2006015"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2006025">.</span><span class="ident" id="2006026">pos</span><span class="op" id="2006029">,</span>&nbsp;<span class="ident" id="2006031"><a href="/runtime/malloc.go.html#2005200">size</a></span><span class="op" id="2006035">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006038"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2006044">(</span><span class="op" id="2006045">&amp;</span><span class="ident" id="2006046"><a href="/runtime/malloc.go.html#2004876">persistent</a></span><span class="op" id="2006056">.</span><span class="ident" id="2006057">lock</span><span class="op" id="2006061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006065">if</span>&nbsp;<span class="ident" id="2006068"><a href="/runtime/malloc.go.html#2005221">stat</a></span>&nbsp;<span class="op" id="2006073">!=</span>&nbsp;<span class="op" id="2006076">&amp;</span><span class="ident" id="2006077"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2006085">.</span><span class="ident" id="2006086">other_sys</span>&nbsp;<span class="op" id="2006096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006100"><a href="/runtime/atomic.go.html#1874108">xadd64</a></span><span class="op" id="2006106">(</span><span class="ident" id="2006107"><a href="/runtime/malloc.go.html#2005221">stat</a></span><span class="op" id="2006111">,</span>&nbsp;<span class="ident" id="2006113">int64</span><span class="op" id="2006118">(</span><span class="ident" id="2006119"><a href="/runtime/malloc.go.html#2005200">size</a></span><span class="op" id="2006123">)</span><span class="op" id="2006124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2006128"><a href="/runtime/atomic.go.html#1874108">xadd64</a></span><span class="op" id="2006134">(</span><span class="op" id="2006135">&amp;</span><span class="ident" id="2006136"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2006144">.</span><span class="ident" id="2006145">other_sys</span><span class="op" id="2006154">,</span>&nbsp;<span class="op" id="2006156">-</span><span class="ident" id="2006157">int64</span><span class="op" id="2006162">(</span><span class="ident" id="2006163"><a href="/runtime/malloc.go.html#2005200">size</a></span><span class="op" id="2006167">)</span><span class="op" id="2006168">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2006171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2006174">return</span>&nbsp;<span class="ident" id="2006181"><a href="/runtime/malloc.go.html#2005973">p</a></span><br>
<span class="lineno"></span><span class="op" id="2006183">}</span>
</div>
</body>
</html>
