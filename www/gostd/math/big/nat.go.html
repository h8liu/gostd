<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3668372">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3668427">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3668481">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3668532">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3668600">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3668646">//</span><br>
<span class="lineno"></span><span class="comment" id="3668649">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3668674">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3668700">//</span><br>
<span class="lineno"></span><span class="comment" id="3668703">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3668741">//</span><br>
<span class="lineno"></span><span class="comment" id="3668744">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3668799">//</span><br>
<span class="lineno">15</span><span class="comment" id="3668802">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3668876">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3668949">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3669023">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3669097">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3669114">//</span><br>
<span class="lineno"></span><span class="keyword" id="3669117">package</span>&nbsp;<span class="ident" id="3669125">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3669130">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3669201">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3669272">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3669291">import</span>&nbsp;<span class="op" id="3669298">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669301">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669311">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669317">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669325">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669338">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3669345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3669348">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3669385">//</span><br>
<span class="lineno"></span><span class="comment" id="3669388">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3669454">//</span><br>
<span class="lineno"></span><span class="comment" id="3669457">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3669529">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3669576">//</span><br>
<span class="lineno"></span><span class="comment" id="3669579">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3669648">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3669719">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3669790">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3669853">//</span><br>
<span class="lineno"></span><span class="keyword" id="3669856">type</span>&nbsp;<span class="ident" id="3669861">nat</span>&nbsp;<span class="op" id="3669865">[</span><span class="op" id="3669866">]</span><span class="ident" id="3669867">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3669873">var</span>&nbsp;<span class="op" id="3669877">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669880">natOne</span>&nbsp;<span class="op" id="3669887">=</span>&nbsp;<span class="ident" id="3669889">nat</span><span class="op" id="3669892">{</span><span class="num" id="3669893">1</span><span class="op" id="3669894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669897">natTwo</span>&nbsp;<span class="op" id="3669904">=</span>&nbsp;<span class="ident" id="3669906">nat</span><span class="op" id="3669909">{</span><span class="num" id="3669910">2</span><span class="op" id="3669911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669914">natTen</span>&nbsp;<span class="op" id="3669921">=</span>&nbsp;<span class="ident" id="3669923">nat</span><span class="op" id="3669926">{</span><span class="num" id="3669927">10</span><span class="op" id="3669929">}</span><br>
<span class="lineno"></span><span class="op" id="3669931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3669934">func</span>&nbsp;<span class="op" id="3669939">(</span><span class="ident" id="3669940">z</span>&nbsp;<span class="ident" id="3669942">nat</span><span class="op" id="3669945">)</span>&nbsp;<span class="ident" id="3669947">clear</span><span class="op" id="3669952">(</span><span class="op" id="3669953">)</span>&nbsp;<span class="op" id="3669955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669958">for</span>&nbsp;<span class="ident" id="3669962">i</span>&nbsp;<span class="op" id="3669964">:=</span>&nbsp;<span class="keyword" id="3669967">range</span>&nbsp;<span class="ident" id="3669973">z</span>&nbsp;<span class="op" id="3669975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669979">z</span><span class="op" id="3669980">[</span><span class="ident" id="3669981">i</span><span class="op" id="3669982">]</span>&nbsp;<span class="op" id="3669984">=</span>&nbsp;<span class="num" id="3669986">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3669989">}</span><br>
<span class="lineno"></span><span class="op" id="3669991">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3669994">func</span>&nbsp;<span class="op" id="3669999">(</span><span class="ident" id="3670000">z</span>&nbsp;<span class="ident" id="3670002">nat</span><span class="op" id="3670005">)</span>&nbsp;<span class="ident" id="3670007">norm</span><span class="op" id="3670011">(</span><span class="op" id="3670012">)</span>&nbsp;<span class="ident" id="3670014">nat</span>&nbsp;<span class="op" id="3670018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670021">i</span>&nbsp;<span class="op" id="3670023">:=</span>&nbsp;<span class="builtinfunc" id="3670026">len</span><span class="op" id="3670029">(</span><span class="ident" id="3670030">z</span><span class="op" id="3670031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670034">for</span>&nbsp;<span class="ident" id="3670038">i</span>&nbsp;<span class="op" id="3670040">&gt;</span>&nbsp;<span class="num" id="3670042">0</span>&nbsp;<span class="op" id="3670044">&amp;&amp;</span>&nbsp;<span class="ident" id="3670047">z</span><span class="op" id="3670048">[</span><span class="ident" id="3670049">i</span><span class="op" id="3670050">-</span><span class="num" id="3670051">1</span><span class="op" id="3670052">]</span>&nbsp;<span class="op" id="3670054">==</span>&nbsp;<span class="num" id="3670057">0</span>&nbsp;<span class="op" id="3670059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670063">i</span><span class="op" id="3670064">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670071">return</span>&nbsp;<span class="ident" id="3670078">z</span><span class="op" id="3670079">[</span><span class="num" id="3670080">0</span><span class="op" id="3670081">:</span><span class="ident" id="3670082">i</span><span class="op" id="3670083">]</span><br>
<span class="lineno"></span><span class="op" id="3670085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670088">func</span>&nbsp;<span class="op" id="3670093">(</span><span class="ident" id="3670094">z</span>&nbsp;<span class="ident" id="3670096">nat</span><span class="op" id="3670099">)</span>&nbsp;<span class="builtinfunc" id="3670101">make</span><span class="op" id="3670105">(</span><span class="ident" id="3670106">n</span>&nbsp;<span class="builtintype" id="3670108">int</span><span class="op" id="3670111">)</span>&nbsp;<span class="ident" id="3670113">nat</span>&nbsp;<span class="op" id="3670117">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670120">if</span>&nbsp;<span class="ident" id="3670123">n</span>&nbsp;<span class="op" id="3670125">&lt;=</span>&nbsp;<span class="builtinfunc" id="3670128">cap</span><span class="op" id="3670131">(</span><span class="ident" id="3670132">z</span><span class="op" id="3670133">)</span>&nbsp;<span class="op" id="3670135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670139">return</span>&nbsp;<span class="ident" id="3670146">z</span><span class="op" id="3670147">[</span><span class="num" id="3670148">0</span><span class="op" id="3670149">:</span><span class="ident" id="3670150">n</span><span class="op" id="3670151">]</span>&nbsp;<span class="comment" id="3670153">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670168">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670235">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670299">const</span>&nbsp;<span class="ident" id="3670305">e</span>&nbsp;<span class="op" id="3670307">=</span>&nbsp;<span class="num" id="3670309">4</span>&nbsp;<span class="comment" id="3670311">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670330">return</span>&nbsp;<span class="builtinfunc" id="3670337">make</span><span class="op" id="3670341">(</span><span class="ident" id="3670342">nat</span><span class="op" id="3670345">,</span>&nbsp;<span class="ident" id="3670347">n</span><span class="op" id="3670348">,</span>&nbsp;<span class="ident" id="3670350">n</span><span class="op" id="3670351">+</span><span class="ident" id="3670352">e</span><span class="op" id="3670353">)</span><br>
<span class="lineno"></span><span class="op" id="3670355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670358">func</span>&nbsp;<span class="op" id="3670363">(</span><span class="ident" id="3670364">z</span>&nbsp;<span class="ident" id="3670366">nat</span><span class="op" id="3670369">)</span>&nbsp;<span class="ident" id="3670371">setWord</span><span class="op" id="3670378">(</span><span class="ident" id="3670379">x</span>&nbsp;<span class="ident" id="3670381">Word</span><span class="op" id="3670385">)</span>&nbsp;<span class="ident" id="3670387">nat</span>&nbsp;<span class="op" id="3670391">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670394">if</span>&nbsp;<span class="ident" id="3670397">x</span>&nbsp;<span class="op" id="3670399">==</span>&nbsp;<span class="num" id="3670402">0</span>&nbsp;<span class="op" id="3670404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670408">return</span>&nbsp;<span class="ident" id="3670415">z</span><span class="op" id="3670416">.</span><span class="builtinfunc" id="3670417">make</span><span class="op" id="3670421">(</span><span class="num" id="3670422">0</span><span class="op" id="3670423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670429">z</span>&nbsp;<span class="op" id="3670431">=</span>&nbsp;<span class="ident" id="3670433">z</span><span class="op" id="3670434">.</span><span class="builtinfunc" id="3670435">make</span><span class="op" id="3670439">(</span><span class="num" id="3670440">1</span><span class="op" id="3670441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670444">z</span><span class="op" id="3670445">[</span><span class="num" id="3670446">0</span><span class="op" id="3670447">]</span>&nbsp;<span class="op" id="3670449">=</span>&nbsp;<span class="ident" id="3670451">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670454">return</span>&nbsp;<span class="ident" id="3670461">z</span><br>
<span class="lineno"></span><span class="op" id="3670463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670466">func</span>&nbsp;<span class="op" id="3670471">(</span><span class="ident" id="3670472">z</span>&nbsp;<span class="ident" id="3670474">nat</span><span class="op" id="3670477">)</span>&nbsp;<span class="ident" id="3670479">setUint64</span><span class="op" id="3670488">(</span><span class="ident" id="3670489">x</span>&nbsp;<span class="ident" id="3670491">uint64</span><span class="op" id="3670497">)</span>&nbsp;<span class="ident" id="3670499">nat</span>&nbsp;<span class="op" id="3670503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670506">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670530">if</span>&nbsp;<span class="ident" id="3670533">w</span>&nbsp;<span class="op" id="3670535">:=</span>&nbsp;<span class="ident" id="3670538">Word</span><span class="op" id="3670542">(</span><span class="ident" id="3670543">x</span><span class="op" id="3670544">)</span><span class="op" id="3670545">;</span>&nbsp;<span class="ident" id="3670547">uint64</span><span class="op" id="3670553">(</span><span class="ident" id="3670554">w</span><span class="op" id="3670555">)</span>&nbsp;<span class="op" id="3670557">==</span>&nbsp;<span class="ident" id="3670560">x</span>&nbsp;<span class="op" id="3670562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670566">return</span>&nbsp;<span class="ident" id="3670573">z</span><span class="op" id="3670574">.</span><span class="ident" id="3670575">setWord</span><span class="op" id="3670582">(</span><span class="ident" id="3670583">w</span><span class="op" id="3670584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670591">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670645">n</span>&nbsp;<span class="op" id="3670647">:=</span>&nbsp;<span class="num" id="3670650">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670653">for</span>&nbsp;<span class="ident" id="3670657">t</span>&nbsp;<span class="op" id="3670659">:=</span>&nbsp;<span class="ident" id="3670662">x</span><span class="op" id="3670663">;</span>&nbsp;<span class="ident" id="3670665">t</span>&nbsp;<span class="op" id="3670667">&gt;</span>&nbsp;<span class="num" id="3670669">0</span><span class="op" id="3670670">;</span>&nbsp;<span class="ident" id="3670672">t</span>&nbsp;<span class="op" id="3670674">&gt;&gt;=</span>&nbsp;<span class="ident" id="3670678">_W</span>&nbsp;<span class="op" id="3670681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670685">n</span><span class="op" id="3670686">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670694">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670719">z</span>&nbsp;<span class="op" id="3670721">=</span>&nbsp;<span class="ident" id="3670723">z</span><span class="op" id="3670724">.</span><span class="builtinfunc" id="3670725">make</span><span class="op" id="3670729">(</span><span class="ident" id="3670730">n</span><span class="op" id="3670731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670734">for</span>&nbsp;<span class="ident" id="3670738">i</span>&nbsp;<span class="op" id="3670740">:=</span>&nbsp;<span class="keyword" id="3670743">range</span>&nbsp;<span class="ident" id="3670749">z</span>&nbsp;<span class="op" id="3670751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670755">z</span><span class="op" id="3670756">[</span><span class="ident" id="3670757">i</span><span class="op" id="3670758">]</span>&nbsp;<span class="op" id="3670760">=</span>&nbsp;<span class="ident" id="3670762">Word</span><span class="op" id="3670766">(</span><span class="ident" id="3670767">x</span>&nbsp;<span class="op" id="3670769">&amp;</span>&nbsp;<span class="ident" id="3670771">_M</span><span class="op" id="3670773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670777">x</span>&nbsp;<span class="op" id="3670779">&gt;&gt;=</span>&nbsp;<span class="ident" id="3670783">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670791">return</span>&nbsp;<span class="ident" id="3670798">z</span><br>
<span class="lineno"></span><span class="op" id="3670800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3670803">func</span>&nbsp;<span class="op" id="3670808">(</span><span class="ident" id="3670809">z</span>&nbsp;<span class="ident" id="3670811">nat</span><span class="op" id="3670814">)</span>&nbsp;<span class="ident" id="3670816">set</span><span class="op" id="3670819">(</span><span class="ident" id="3670820">x</span>&nbsp;<span class="ident" id="3670822">nat</span><span class="op" id="3670825">)</span>&nbsp;<span class="ident" id="3670827">nat</span>&nbsp;<span class="op" id="3670831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670834">z</span>&nbsp;<span class="op" id="3670836">=</span>&nbsp;<span class="ident" id="3670838">z</span><span class="op" id="3670839">.</span><span class="builtinfunc" id="3670840">make</span><span class="op" id="3670844">(</span><span class="builtinfunc" id="3670845">len</span><span class="op" id="3670848">(</span><span class="ident" id="3670849">x</span><span class="op" id="3670850">)</span><span class="op" id="3670851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3670854">copy</span><span class="op" id="3670858">(</span><span class="ident" id="3670859">z</span><span class="op" id="3670860">,</span>&nbsp;<span class="ident" id="3670862">x</span><span class="op" id="3670863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670866">return</span>&nbsp;<span class="ident" id="3670873">z</span><br>
<span class="lineno"></span><span class="op" id="3670875">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3670878">func</span>&nbsp;<span class="op" id="3670883">(</span><span class="ident" id="3670884">z</span>&nbsp;<span class="ident" id="3670886">nat</span><span class="op" id="3670889">)</span>&nbsp;<span class="ident" id="3670891">add</span><span class="op" id="3670894">(</span><span class="ident" id="3670895">x</span><span class="op" id="3670896">,</span>&nbsp;<span class="ident" id="3670898">y</span>&nbsp;<span class="ident" id="3670900">nat</span><span class="op" id="3670903">)</span>&nbsp;<span class="ident" id="3670905">nat</span>&nbsp;<span class="op" id="3670909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670912">m</span>&nbsp;<span class="op" id="3670914">:=</span>&nbsp;<span class="builtinfunc" id="3670917">len</span><span class="op" id="3670920">(</span><span class="ident" id="3670921">x</span><span class="op" id="3670922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670925">n</span>&nbsp;<span class="op" id="3670927">:=</span>&nbsp;<span class="builtinfunc" id="3670930">len</span><span class="op" id="3670933">(</span><span class="ident" id="3670934">y</span><span class="op" id="3670935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670939">switch</span>&nbsp;<span class="op" id="3670946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670949">case</span>&nbsp;<span class="ident" id="3670954">m</span>&nbsp;<span class="op" id="3670956">&lt;</span>&nbsp;<span class="ident" id="3670958">n</span><span class="op" id="3670959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670963">return</span>&nbsp;<span class="ident" id="3670970">z</span><span class="op" id="3670971">.</span><span class="ident" id="3670972">add</span><span class="op" id="3670975">(</span><span class="ident" id="3670976">y</span><span class="op" id="3670977">,</span>&nbsp;<span class="ident" id="3670979">x</span><span class="op" id="3670980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670983">case</span>&nbsp;<span class="ident" id="3670988">m</span>&nbsp;<span class="op" id="3670990">==</span>&nbsp;<span class="num" id="3670993">0</span><span class="op" id="3670994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670998">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671038">return</span>&nbsp;<span class="ident" id="3671045">z</span><span class="op" id="3671046">.</span><span class="builtinfunc" id="3671047">make</span><span class="op" id="3671051">(</span><span class="num" id="3671052">0</span><span class="op" id="3671053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671056">case</span>&nbsp;<span class="ident" id="3671061">n</span>&nbsp;<span class="op" id="3671063">==</span>&nbsp;<span class="num" id="3671066">0</span><span class="op" id="3671067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671071">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671088">return</span>&nbsp;<span class="ident" id="3671095">z</span><span class="op" id="3671096">.</span><span class="ident" id="3671097">set</span><span class="op" id="3671100">(</span><span class="ident" id="3671101">x</span><span class="op" id="3671102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671105">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671108">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671119">z</span>&nbsp;<span class="op" id="3671121">=</span>&nbsp;<span class="ident" id="3671123">z</span><span class="op" id="3671124">.</span><span class="builtinfunc" id="3671125">make</span><span class="op" id="3671129">(</span><span class="ident" id="3671130">m</span>&nbsp;<span class="op" id="3671132">+</span>&nbsp;<span class="num" id="3671134">1</span><span class="op" id="3671135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671138">c</span>&nbsp;<span class="op" id="3671140">:=</span>&nbsp;<span class="ident" id="3671143">addVV</span><span class="op" id="3671148">(</span><span class="ident" id="3671149">z</span><span class="op" id="3671150">[</span><span class="num" id="3671151">0</span><span class="op" id="3671152">:</span><span class="ident" id="3671153">n</span><span class="op" id="3671154">]</span><span class="op" id="3671155">,</span>&nbsp;<span class="ident" id="3671157">x</span><span class="op" id="3671158">,</span>&nbsp;<span class="ident" id="3671160">y</span><span class="op" id="3671161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671164">if</span>&nbsp;<span class="ident" id="3671167">m</span>&nbsp;<span class="op" id="3671169">&gt;</span>&nbsp;<span class="ident" id="3671171">n</span>&nbsp;<span class="op" id="3671173">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671177">c</span>&nbsp;<span class="op" id="3671179">=</span>&nbsp;<span class="ident" id="3671181">addVW</span><span class="op" id="3671186">(</span><span class="ident" id="3671187">z</span><span class="op" id="3671188">[</span><span class="ident" id="3671189">n</span><span class="op" id="3671190">:</span><span class="ident" id="3671191">m</span><span class="op" id="3671192">]</span><span class="op" id="3671193">,</span>&nbsp;<span class="ident" id="3671195">x</span><span class="op" id="3671196">[</span><span class="ident" id="3671197">n</span><span class="op" id="3671198">:</span><span class="op" id="3671199">]</span><span class="op" id="3671200">,</span>&nbsp;<span class="ident" id="3671202">c</span><span class="op" id="3671203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671209">z</span><span class="op" id="3671210">[</span><span class="ident" id="3671211">m</span><span class="op" id="3671212">]</span>&nbsp;<span class="op" id="3671214">=</span>&nbsp;<span class="ident" id="3671216">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671220">return</span>&nbsp;<span class="ident" id="3671227">z</span><span class="op" id="3671228">.</span><span class="ident" id="3671229">norm</span><span class="op" id="3671233">(</span><span class="op" id="3671234">)</span><br>
<span class="lineno">140</span><span class="op" id="3671236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3671239">func</span>&nbsp;<span class="op" id="3671244">(</span><span class="ident" id="3671245">z</span>&nbsp;<span class="ident" id="3671247">nat</span><span class="op" id="3671250">)</span>&nbsp;<span class="ident" id="3671252">sub</span><span class="op" id="3671255">(</span><span class="ident" id="3671256">x</span><span class="op" id="3671257">,</span>&nbsp;<span class="ident" id="3671259">y</span>&nbsp;<span class="ident" id="3671261">nat</span><span class="op" id="3671264">)</span>&nbsp;<span class="ident" id="3671266">nat</span>&nbsp;<span class="op" id="3671270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671273">m</span>&nbsp;<span class="op" id="3671275">:=</span>&nbsp;<span class="builtinfunc" id="3671278">len</span><span class="op" id="3671281">(</span><span class="ident" id="3671282">x</span><span class="op" id="3671283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671286">n</span>&nbsp;<span class="op" id="3671288">:=</span>&nbsp;<span class="builtinfunc" id="3671291">len</span><span class="op" id="3671294">(</span><span class="ident" id="3671295">y</span><span class="op" id="3671296">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671300">switch</span>&nbsp;<span class="op" id="3671307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671310">case</span>&nbsp;<span class="ident" id="3671315">m</span>&nbsp;<span class="op" id="3671317">&lt;</span>&nbsp;<span class="ident" id="3671319">n</span><span class="op" id="3671320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3671324">panic</span><span class="op" id="3671329">(</span><span class="string" id="3671330">&#34;underflow&#34;</span><span class="op" id="3671341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671344">case</span>&nbsp;<span class="ident" id="3671349">m</span>&nbsp;<span class="op" id="3671351">==</span>&nbsp;<span class="num" id="3671354">0</span><span class="op" id="3671355">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671359">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671399">return</span>&nbsp;<span class="ident" id="3671406">z</span><span class="op" id="3671407">.</span><span class="builtinfunc" id="3671408">make</span><span class="op" id="3671412">(</span><span class="num" id="3671413">0</span><span class="op" id="3671414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671417">case</span>&nbsp;<span class="ident" id="3671422">n</span>&nbsp;<span class="op" id="3671424">==</span>&nbsp;<span class="num" id="3671427">0</span><span class="op" id="3671428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671432">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671449">return</span>&nbsp;<span class="ident" id="3671456">z</span><span class="op" id="3671457">.</span><span class="ident" id="3671458">set</span><span class="op" id="3671461">(</span><span class="ident" id="3671462">x</span><span class="op" id="3671463">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671469">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671480">z</span>&nbsp;<span class="op" id="3671482">=</span>&nbsp;<span class="ident" id="3671484">z</span><span class="op" id="3671485">.</span><span class="builtinfunc" id="3671486">make</span><span class="op" id="3671490">(</span><span class="ident" id="3671491">m</span><span class="op" id="3671492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671495">c</span>&nbsp;<span class="op" id="3671497">:=</span>&nbsp;<span class="ident" id="3671500">subVV</span><span class="op" id="3671505">(</span><span class="ident" id="3671506">z</span><span class="op" id="3671507">[</span><span class="num" id="3671508">0</span><span class="op" id="3671509">:</span><span class="ident" id="3671510">n</span><span class="op" id="3671511">]</span><span class="op" id="3671512">,</span>&nbsp;<span class="ident" id="3671514">x</span><span class="op" id="3671515">,</span>&nbsp;<span class="ident" id="3671517">y</span><span class="op" id="3671518">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671521">if</span>&nbsp;<span class="ident" id="3671524">m</span>&nbsp;<span class="op" id="3671526">&gt;</span>&nbsp;<span class="ident" id="3671528">n</span>&nbsp;<span class="op" id="3671530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671534">c</span>&nbsp;<span class="op" id="3671536">=</span>&nbsp;<span class="ident" id="3671538">subVW</span><span class="op" id="3671543">(</span><span class="ident" id="3671544">z</span><span class="op" id="3671545">[</span><span class="ident" id="3671546">n</span><span class="op" id="3671547">:</span><span class="op" id="3671548">]</span><span class="op" id="3671549">,</span>&nbsp;<span class="ident" id="3671551">x</span><span class="op" id="3671552">[</span><span class="ident" id="3671553">n</span><span class="op" id="3671554">:</span><span class="op" id="3671555">]</span><span class="op" id="3671556">,</span>&nbsp;<span class="ident" id="3671558">c</span><span class="op" id="3671559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671565">if</span>&nbsp;<span class="ident" id="3671568">c</span>&nbsp;<span class="op" id="3671570">!=</span>&nbsp;<span class="num" id="3671573">0</span>&nbsp;<span class="op" id="3671575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3671579">panic</span><span class="op" id="3671584">(</span><span class="string" id="3671585">&#34;underflow&#34;</span><span class="op" id="3671596">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671603">return</span>&nbsp;<span class="ident" id="3671610">z</span><span class="op" id="3671611">.</span><span class="ident" id="3671612">norm</span><span class="op" id="3671616">(</span><span class="op" id="3671617">)</span><br>
<span class="lineno"></span><span class="op" id="3671619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3671622">func</span>&nbsp;<span class="op" id="3671627">(</span><span class="ident" id="3671628">x</span>&nbsp;<span class="ident" id="3671630">nat</span><span class="op" id="3671633">)</span>&nbsp;<span class="ident" id="3671635">cmp</span><span class="op" id="3671638">(</span><span class="ident" id="3671639">y</span>&nbsp;<span class="ident" id="3671641">nat</span><span class="op" id="3671644">)</span>&nbsp;<span class="op" id="3671646">(</span><span class="ident" id="3671647">r</span>&nbsp;<span class="builtintype" id="3671649">int</span><span class="op" id="3671652">)</span>&nbsp;<span class="op" id="3671654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671657">m</span>&nbsp;<span class="op" id="3671659">:=</span>&nbsp;<span class="builtinfunc" id="3671662">len</span><span class="op" id="3671665">(</span><span class="ident" id="3671666">x</span><span class="op" id="3671667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671670">n</span>&nbsp;<span class="op" id="3671672">:=</span>&nbsp;<span class="builtinfunc" id="3671675">len</span><span class="op" id="3671678">(</span><span class="ident" id="3671679">y</span><span class="op" id="3671680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671683">if</span>&nbsp;<span class="ident" id="3671686">m</span>&nbsp;<span class="op" id="3671688">!=</span>&nbsp;<span class="ident" id="3671691">n</span>&nbsp;<span class="op" id="3671693">||</span>&nbsp;<span class="ident" id="3671696">m</span>&nbsp;<span class="op" id="3671698">==</span>&nbsp;<span class="num" id="3671701">0</span>&nbsp;<span class="op" id="3671703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671707">switch</span>&nbsp;<span class="op" id="3671714">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671718">case</span>&nbsp;<span class="ident" id="3671723">m</span>&nbsp;<span class="op" id="3671725">&lt;</span>&nbsp;<span class="ident" id="3671727">n</span><span class="op" id="3671728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671733">r</span>&nbsp;<span class="op" id="3671735">=</span>&nbsp;<span class="op" id="3671737">-</span><span class="num" id="3671738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671742">case</span>&nbsp;<span class="ident" id="3671747">m</span>&nbsp;<span class="op" id="3671749">&gt;</span>&nbsp;<span class="ident" id="3671751">n</span><span class="op" id="3671752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671757">r</span>&nbsp;<span class="op" id="3671759">=</span>&nbsp;<span class="num" id="3671761">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671765">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671781">i</span>&nbsp;<span class="op" id="3671783">:=</span>&nbsp;<span class="ident" id="3671786">m</span>&nbsp;<span class="op" id="3671788">-</span>&nbsp;<span class="num" id="3671790">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671793">for</span>&nbsp;<span class="ident" id="3671797">i</span>&nbsp;<span class="op" id="3671799">&gt;</span>&nbsp;<span class="num" id="3671801">0</span>&nbsp;<span class="op" id="3671803">&amp;&amp;</span>&nbsp;<span class="ident" id="3671806">x</span><span class="op" id="3671807">[</span><span class="ident" id="3671808">i</span><span class="op" id="3671809">]</span>&nbsp;<span class="op" id="3671811">==</span>&nbsp;<span class="ident" id="3671814">y</span><span class="op" id="3671815">[</span><span class="ident" id="3671816">i</span><span class="op" id="3671817">]</span>&nbsp;<span class="op" id="3671819">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671823">i</span><span class="op" id="3671824">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671832">switch</span>&nbsp;<span class="op" id="3671839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671842">case</span>&nbsp;<span class="ident" id="3671847">x</span><span class="op" id="3671848">[</span><span class="ident" id="3671849">i</span><span class="op" id="3671850">]</span>&nbsp;<span class="op" id="3671852">&lt;</span>&nbsp;<span class="ident" id="3671854">y</span><span class="op" id="3671855">[</span><span class="ident" id="3671856">i</span><span class="op" id="3671857">]</span><span class="op" id="3671858">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671862">r</span>&nbsp;<span class="op" id="3671864">=</span>&nbsp;<span class="op" id="3671866">-</span><span class="num" id="3671867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671870">case</span>&nbsp;<span class="ident" id="3671875">x</span><span class="op" id="3671876">[</span><span class="ident" id="3671877">i</span><span class="op" id="3671878">]</span>&nbsp;<span class="op" id="3671880">&gt;</span>&nbsp;<span class="ident" id="3671882">y</span><span class="op" id="3671883">[</span><span class="ident" id="3671884">i</span><span class="op" id="3671885">]</span><span class="op" id="3671886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671890">r</span>&nbsp;<span class="op" id="3671892">=</span>&nbsp;<span class="num" id="3671894">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671900">return</span><br>
<span class="lineno">195</span><span class="op" id="3671907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3671910">func</span>&nbsp;<span class="op" id="3671915">(</span><span class="ident" id="3671916">z</span>&nbsp;<span class="ident" id="3671918">nat</span><span class="op" id="3671921">)</span>&nbsp;<span class="ident" id="3671923">mulAddWW</span><span class="op" id="3671931">(</span><span class="ident" id="3671932">x</span>&nbsp;<span class="ident" id="3671934">nat</span><span class="op" id="3671937">,</span>&nbsp;<span class="ident" id="3671939">y</span><span class="op" id="3671940">,</span>&nbsp;<span class="ident" id="3671942">r</span>&nbsp;<span class="ident" id="3671944">Word</span><span class="op" id="3671948">)</span>&nbsp;<span class="ident" id="3671950">nat</span>&nbsp;<span class="op" id="3671954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671957">m</span>&nbsp;<span class="op" id="3671959">:=</span>&nbsp;<span class="builtinfunc" id="3671962">len</span><span class="op" id="3671965">(</span><span class="ident" id="3671966">x</span><span class="op" id="3671967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671970">if</span>&nbsp;<span class="ident" id="3671973">m</span>&nbsp;<span class="op" id="3671975">==</span>&nbsp;<span class="num" id="3671978">0</span>&nbsp;<span class="op" id="3671980">||</span>&nbsp;<span class="ident" id="3671983">y</span>&nbsp;<span class="op" id="3671985">==</span>&nbsp;<span class="num" id="3671988">0</span>&nbsp;<span class="op" id="3671990">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671994">return</span>&nbsp;<span class="ident" id="3672001">z</span><span class="op" id="3672002">.</span><span class="ident" id="3672003">setWord</span><span class="op" id="3672010">(</span><span class="ident" id="3672011">r</span><span class="op" id="3672012">)</span>&nbsp;<span class="comment" id="3672014">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3672033">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672044">z</span>&nbsp;<span class="op" id="3672046">=</span>&nbsp;<span class="ident" id="3672048">z</span><span class="op" id="3672049">.</span><span class="builtinfunc" id="3672050">make</span><span class="op" id="3672054">(</span><span class="ident" id="3672055">m</span>&nbsp;<span class="op" id="3672057">+</span>&nbsp;<span class="num" id="3672059">1</span><span class="op" id="3672060">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672063">z</span><span class="op" id="3672064">[</span><span class="ident" id="3672065">m</span><span class="op" id="3672066">]</span>&nbsp;<span class="op" id="3672068">=</span>&nbsp;<span class="ident" id="3672070">mulAddVWW</span><span class="op" id="3672079">(</span><span class="ident" id="3672080">z</span><span class="op" id="3672081">[</span><span class="num" id="3672082">0</span><span class="op" id="3672083">:</span><span class="ident" id="3672084">m</span><span class="op" id="3672085">]</span><span class="op" id="3672086">,</span>&nbsp;<span class="ident" id="3672088">x</span><span class="op" id="3672089">,</span>&nbsp;<span class="ident" id="3672091">y</span><span class="op" id="3672092">,</span>&nbsp;<span class="ident" id="3672094">r</span><span class="op" id="3672095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672099">return</span>&nbsp;<span class="ident" id="3672106">z</span><span class="op" id="3672107">.</span><span class="ident" id="3672108">norm</span><span class="op" id="3672112">(</span><span class="op" id="3672113">)</span><br>
<span class="lineno"></span><span class="op" id="3672115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3672118">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3672177">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3672245">func</span>&nbsp;<span class="ident" id="3672250">basicMul</span><span class="op" id="3672258">(</span><span class="ident" id="3672259">z</span><span class="op" id="3672260">,</span>&nbsp;<span class="ident" id="3672262">x</span><span class="op" id="3672263">,</span>&nbsp;<span class="ident" id="3672265">y</span>&nbsp;<span class="ident" id="3672267">nat</span><span class="op" id="3672270">)</span>&nbsp;<span class="op" id="3672272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672275">z</span><span class="op" id="3672276">[</span><span class="num" id="3672277">0</span>&nbsp;<span class="op" id="3672279">:</span>&nbsp;<span class="builtinfunc" id="3672281">len</span><span class="op" id="3672284">(</span><span class="ident" id="3672285">x</span><span class="op" id="3672286">)</span><span class="op" id="3672287">+</span><span class="builtinfunc" id="3672288">len</span><span class="op" id="3672291">(</span><span class="ident" id="3672292">y</span><span class="op" id="3672293">)</span><span class="op" id="3672294">]</span><span class="op" id="3672295">.</span><span class="ident" id="3672296">clear</span><span class="op" id="3672301">(</span><span class="op" id="3672302">)</span>&nbsp;<span class="comment" id="3672304">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672321">for</span>&nbsp;<span class="ident" id="3672325">i</span><span class="op" id="3672326">,</span>&nbsp;<span class="ident" id="3672328">d</span>&nbsp;<span class="op" id="3672330">:=</span>&nbsp;<span class="keyword" id="3672333">range</span>&nbsp;<span class="ident" id="3672339">y</span>&nbsp;<span class="op" id="3672341">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672345">if</span>&nbsp;<span class="ident" id="3672348">d</span>&nbsp;<span class="op" id="3672350">!=</span>&nbsp;<span class="num" id="3672353">0</span>&nbsp;<span class="op" id="3672355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672360">z</span><span class="op" id="3672361">[</span><span class="builtinfunc" id="3672362">len</span><span class="op" id="3672365">(</span><span class="ident" id="3672366">x</span><span class="op" id="3672367">)</span><span class="op" id="3672368">+</span><span class="ident" id="3672369">i</span><span class="op" id="3672370">]</span>&nbsp;<span class="op" id="3672372">=</span>&nbsp;<span class="ident" id="3672374">addMulVVW</span><span class="op" id="3672383">(</span><span class="ident" id="3672384">z</span><span class="op" id="3672385">[</span><span class="ident" id="3672386">i</span><span class="op" id="3672387">:</span><span class="ident" id="3672388">i</span><span class="op" id="3672389">+</span><span class="builtinfunc" id="3672390">len</span><span class="op" id="3672393">(</span><span class="ident" id="3672394">x</span><span class="op" id="3672395">)</span><span class="op" id="3672396">]</span><span class="op" id="3672397">,</span>&nbsp;<span class="ident" id="3672399">x</span><span class="op" id="3672400">,</span>&nbsp;<span class="ident" id="3672402">d</span><span class="op" id="3672403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672410">}</span><br>
<span class="lineno"></span><span class="op" id="3672412">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3672415">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3672490">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3672554">func</span>&nbsp;<span class="ident" id="3672559">karatsubaAdd</span><span class="op" id="3672571">(</span><span class="ident" id="3672572">z</span><span class="op" id="3672573">,</span>&nbsp;<span class="ident" id="3672575">x</span>&nbsp;<span class="ident" id="3672577">nat</span><span class="op" id="3672580">,</span>&nbsp;<span class="ident" id="3672582">n</span>&nbsp;<span class="builtintype" id="3672584">int</span><span class="op" id="3672587">)</span>&nbsp;<span class="op" id="3672589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672592">if</span>&nbsp;<span class="ident" id="3672595">c</span>&nbsp;<span class="op" id="3672597">:=</span>&nbsp;<span class="ident" id="3672600">addVV</span><span class="op" id="3672605">(</span><span class="ident" id="3672606">z</span><span class="op" id="3672607">[</span><span class="num" id="3672608">0</span><span class="op" id="3672609">:</span><span class="ident" id="3672610">n</span><span class="op" id="3672611">]</span><span class="op" id="3672612">,</span>&nbsp;<span class="ident" id="3672614">z</span><span class="op" id="3672615">,</span>&nbsp;<span class="ident" id="3672617">x</span><span class="op" id="3672618">)</span><span class="op" id="3672619">;</span>&nbsp;<span class="ident" id="3672621">c</span>&nbsp;<span class="op" id="3672623">!=</span>&nbsp;<span class="num" id="3672626">0</span>&nbsp;<span class="op" id="3672628">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672632">addVW</span><span class="op" id="3672637">(</span><span class="ident" id="3672638">z</span><span class="op" id="3672639">[</span><span class="ident" id="3672640">n</span><span class="op" id="3672641">:</span><span class="ident" id="3672642">n</span><span class="op" id="3672643">+</span><span class="ident" id="3672644">n</span><span class="op" id="3672645">&gt;&gt;</span><span class="num" id="3672647">1</span><span class="op" id="3672648">]</span><span class="op" id="3672649">,</span>&nbsp;<span class="ident" id="3672651">z</span><span class="op" id="3672652">[</span><span class="ident" id="3672653">n</span><span class="op" id="3672654">:</span><span class="op" id="3672655">]</span><span class="op" id="3672656">,</span>&nbsp;<span class="ident" id="3672658">c</span><span class="op" id="3672659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672662">}</span><br>
<span class="lineno"></span><span class="op" id="3672664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3672667">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3672708">func</span>&nbsp;<span class="ident" id="3672713">karatsubaSub</span><span class="op" id="3672725">(</span><span class="ident" id="3672726">z</span><span class="op" id="3672727">,</span>&nbsp;<span class="ident" id="3672729">x</span>&nbsp;<span class="ident" id="3672731">nat</span><span class="op" id="3672734">,</span>&nbsp;<span class="ident" id="3672736">n</span>&nbsp;<span class="builtintype" id="3672738">int</span><span class="op" id="3672741">)</span>&nbsp;<span class="op" id="3672743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672746">if</span>&nbsp;<span class="ident" id="3672749">c</span>&nbsp;<span class="op" id="3672751">:=</span>&nbsp;<span class="ident" id="3672754">subVV</span><span class="op" id="3672759">(</span><span class="ident" id="3672760">z</span><span class="op" id="3672761">[</span><span class="num" id="3672762">0</span><span class="op" id="3672763">:</span><span class="ident" id="3672764">n</span><span class="op" id="3672765">]</span><span class="op" id="3672766">,</span>&nbsp;<span class="ident" id="3672768">z</span><span class="op" id="3672769">,</span>&nbsp;<span class="ident" id="3672771">x</span><span class="op" id="3672772">)</span><span class="op" id="3672773">;</span>&nbsp;<span class="ident" id="3672775">c</span>&nbsp;<span class="op" id="3672777">!=</span>&nbsp;<span class="num" id="3672780">0</span>&nbsp;<span class="op" id="3672782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672786">subVW</span><span class="op" id="3672791">(</span><span class="ident" id="3672792">z</span><span class="op" id="3672793">[</span><span class="ident" id="3672794">n</span><span class="op" id="3672795">:</span><span class="ident" id="3672796">n</span><span class="op" id="3672797">+</span><span class="ident" id="3672798">n</span><span class="op" id="3672799">&gt;&gt;</span><span class="num" id="3672801">1</span><span class="op" id="3672802">]</span><span class="op" id="3672803">,</span>&nbsp;<span class="ident" id="3672805">z</span><span class="op" id="3672806">[</span><span class="ident" id="3672807">n</span><span class="op" id="3672808">:</span><span class="op" id="3672809">]</span><span class="op" id="3672810">,</span>&nbsp;<span class="ident" id="3672812">c</span><span class="op" id="3672813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672816">}</span><br>
<span class="lineno"></span><span class="op" id="3672818">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3672821">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3672895">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3672973">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3672985">var</span>&nbsp;<span class="ident" id="3672989">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3673008">int</span>&nbsp;<span class="op" id="3673012">=</span>&nbsp;<span class="num" id="3673014">40</span>&nbsp;<span class="comment" id="3673017">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3673046">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3673106">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3673166">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3673226">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3673282">func</span>&nbsp;<span class="ident" id="3673287">karatsuba</span><span class="op" id="3673296">(</span><span class="ident" id="3673297">z</span><span class="op" id="3673298">,</span>&nbsp;<span class="ident" id="3673300">x</span><span class="op" id="3673301">,</span>&nbsp;<span class="ident" id="3673303">y</span>&nbsp;<span class="ident" id="3673305">nat</span><span class="op" id="3673308">)</span>&nbsp;<span class="op" id="3673310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673313">n</span>&nbsp;<span class="op" id="3673315">:=</span>&nbsp;<span class="builtinfunc" id="3673318">len</span><span class="op" id="3673321">(</span><span class="ident" id="3673322">y</span><span class="op" id="3673323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673327">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673391">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673451">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673469">if</span>&nbsp;<span class="ident" id="3673472">n</span><span class="op" id="3673473">&amp;</span><span class="num" id="3673474">1</span>&nbsp;<span class="op" id="3673476">!=</span>&nbsp;<span class="num" id="3673479">0</span>&nbsp;<span class="op" id="3673481">||</span>&nbsp;<span class="ident" id="3673484">n</span>&nbsp;<span class="op" id="3673486">&lt;</span>&nbsp;<span class="ident" id="3673488">karatsubaThreshold</span>&nbsp;<span class="op" id="3673507">||</span>&nbsp;<span class="ident" id="3673510">n</span>&nbsp;<span class="op" id="3673512">&lt;</span>&nbsp;<span class="num" id="3673514">2</span>&nbsp;<span class="op" id="3673516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673520">basicMul</span><span class="op" id="3673528">(</span><span class="ident" id="3673529">z</span><span class="op" id="3673530">,</span>&nbsp;<span class="ident" id="3673532">x</span><span class="op" id="3673533">,</span>&nbsp;<span class="ident" id="3673535">y</span><span class="op" id="3673536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673540">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673548">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673551">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673602">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673664">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673698">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673702">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673722">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673742">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673746">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673809">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673827">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673831">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673881">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673931">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673935">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673945">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673949">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673968">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673987">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673991">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674042">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674093">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674144">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674195">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674237">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674266">n2</span>&nbsp;<span class="op" id="3674269">:=</span>&nbsp;<span class="ident" id="3674272">n</span>&nbsp;<span class="op" id="3674274">&gt;&gt;</span>&nbsp;<span class="num" id="3674277">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3674292">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674304">x1</span><span class="op" id="3674306">,</span>&nbsp;<span class="ident" id="3674308">x0</span>&nbsp;<span class="op" id="3674311">:=</span>&nbsp;<span class="ident" id="3674314">x</span><span class="op" id="3674315">[</span><span class="ident" id="3674316">n2</span><span class="op" id="3674318">:</span><span class="op" id="3674319">]</span><span class="op" id="3674320">,</span>&nbsp;<span class="ident" id="3674322">x</span><span class="op" id="3674323">[</span><span class="num" id="3674324">0</span><span class="op" id="3674325">:</span><span class="ident" id="3674326">n2</span><span class="op" id="3674328">]</span>&nbsp;<span class="comment" id="3674330">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674348">y1</span><span class="op" id="3674350">,</span>&nbsp;<span class="ident" id="3674352">y0</span>&nbsp;<span class="op" id="3674355">:=</span>&nbsp;<span class="ident" id="3674358">y</span><span class="op" id="3674359">[</span><span class="ident" id="3674360">n2</span><span class="op" id="3674362">:</span><span class="op" id="3674363">]</span><span class="op" id="3674364">,</span>&nbsp;<span class="ident" id="3674366">y</span><span class="op" id="3674367">[</span><span class="num" id="3674368">0</span><span class="op" id="3674369">:</span><span class="ident" id="3674370">n2</span><span class="op" id="3674372">]</span>&nbsp;<span class="comment" id="3674374">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674393">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674445">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674449">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674507">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674565">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674569">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674630">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674692">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674709">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674763">karatsuba</span><span class="op" id="3674772">(</span><span class="ident" id="3674773">z</span><span class="op" id="3674774">,</span>&nbsp;<span class="ident" id="3674776">x0</span><span class="op" id="3674778">,</span>&nbsp;<span class="ident" id="3674780">y0</span><span class="op" id="3674782">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3674788">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674803">karatsuba</span><span class="op" id="3674812">(</span><span class="ident" id="3674813">z</span><span class="op" id="3674814">[</span><span class="ident" id="3674815">n</span><span class="op" id="3674816">:</span><span class="op" id="3674817">]</span><span class="op" id="3674818">,</span>&nbsp;<span class="ident" id="3674820">x1</span><span class="op" id="3674822">,</span>&nbsp;<span class="ident" id="3674824">y1</span><span class="op" id="3674826">)</span>&nbsp;<span class="comment" id="3674828">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674844">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674903">s</span>&nbsp;<span class="op" id="3674905">:=</span>&nbsp;<span class="num" id="3674908">1</span>&nbsp;<span class="comment" id="3674910">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674936">xd</span>&nbsp;<span class="op" id="3674939">:=</span>&nbsp;<span class="ident" id="3674942">z</span><span class="op" id="3674943">[</span><span class="num" id="3674944">2</span><span class="op" id="3674945">*</span><span class="ident" id="3674946">n</span>&nbsp;<span class="op" id="3674948">:</span>&nbsp;<span class="num" id="3674950">2</span><span class="op" id="3674951">*</span><span class="ident" id="3674952">n</span><span class="op" id="3674953">+</span><span class="ident" id="3674954">n2</span><span class="op" id="3674956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674959">if</span>&nbsp;<span class="ident" id="3674962">subVV</span><span class="op" id="3674967">(</span><span class="ident" id="3674968">xd</span><span class="op" id="3674970">,</span>&nbsp;<span class="ident" id="3674972">x1</span><span class="op" id="3674974">,</span>&nbsp;<span class="ident" id="3674976">x0</span><span class="op" id="3674978">)</span>&nbsp;<span class="op" id="3674980">!=</span>&nbsp;<span class="num" id="3674983">0</span>&nbsp;<span class="op" id="3674985">{</span>&nbsp;<span class="comment" id="3674987">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674998">s</span>&nbsp;<span class="op" id="3675000">=</span>&nbsp;<span class="op" id="3675002">-</span><span class="ident" id="3675003">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675007">subVV</span><span class="op" id="3675012">(</span><span class="ident" id="3675013">xd</span><span class="op" id="3675015">,</span>&nbsp;<span class="ident" id="3675017">x0</span><span class="op" id="3675019">,</span>&nbsp;<span class="ident" id="3675021">x1</span><span class="op" id="3675023">)</span>&nbsp;<span class="comment" id="3675025">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675035">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675039">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675098">yd</span>&nbsp;<span class="op" id="3675101">:=</span>&nbsp;<span class="ident" id="3675104">z</span><span class="op" id="3675105">[</span><span class="num" id="3675106">2</span><span class="op" id="3675107">*</span><span class="ident" id="3675108">n</span><span class="op" id="3675109">+</span><span class="ident" id="3675110">n2</span>&nbsp;<span class="op" id="3675113">:</span>&nbsp;<span class="num" id="3675115">3</span><span class="op" id="3675116">*</span><span class="ident" id="3675117">n</span><span class="op" id="3675118">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675121">if</span>&nbsp;<span class="ident" id="3675124">subVV</span><span class="op" id="3675129">(</span><span class="ident" id="3675130">yd</span><span class="op" id="3675132">,</span>&nbsp;<span class="ident" id="3675134">y0</span><span class="op" id="3675136">,</span>&nbsp;<span class="ident" id="3675138">y1</span><span class="op" id="3675140">)</span>&nbsp;<span class="op" id="3675142">!=</span>&nbsp;<span class="num" id="3675145">0</span>&nbsp;<span class="op" id="3675147">{</span>&nbsp;<span class="comment" id="3675149">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675160">s</span>&nbsp;<span class="op" id="3675162">=</span>&nbsp;<span class="op" id="3675164">-</span><span class="ident" id="3675165">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675169">subVV</span><span class="op" id="3675174">(</span><span class="ident" id="3675175">yd</span><span class="op" id="3675177">,</span>&nbsp;<span class="ident" id="3675179">y1</span><span class="op" id="3675181">,</span>&nbsp;<span class="ident" id="3675183">y0</span><span class="op" id="3675185">)</span>&nbsp;<span class="comment" id="3675187">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675201">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675268">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675335">p</span>&nbsp;<span class="op" id="3675337">:=</span>&nbsp;<span class="ident" id="3675340">z</span><span class="op" id="3675341">[</span><span class="ident" id="3675342">n</span><span class="op" id="3675343">*</span><span class="num" id="3675344">3</span><span class="op" id="3675345">:</span><span class="op" id="3675346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675349">karatsuba</span><span class="op" id="3675358">(</span><span class="ident" id="3675359">p</span><span class="op" id="3675360">,</span>&nbsp;<span class="ident" id="3675362">xd</span><span class="op" id="3675364">,</span>&nbsp;<span class="ident" id="3675366">yd</span><span class="op" id="3675368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675372">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675396">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675455">r</span>&nbsp;<span class="op" id="3675457">:=</span>&nbsp;<span class="ident" id="3675460">z</span><span class="op" id="3675461">[</span><span class="ident" id="3675462">n</span><span class="op" id="3675463">*</span><span class="num" id="3675464">4</span><span class="op" id="3675465">:</span><span class="op" id="3675466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3675469">copy</span><span class="op" id="3675473">(</span><span class="ident" id="3675474">r</span><span class="op" id="3675475">,</span>&nbsp;<span class="ident" id="3675477">z</span><span class="op" id="3675478">[</span><span class="op" id="3675479">:</span><span class="ident" id="3675480">n</span><span class="op" id="3675481">*</span><span class="num" id="3675482">2</span><span class="op" id="3675483">]</span><span class="op" id="3675484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675488">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675520">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675524">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675546">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675568">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675587">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675606">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675625">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675629">karatsubaAdd</span><span class="op" id="3675641">(</span><span class="ident" id="3675642">z</span><span class="op" id="3675643">[</span><span class="ident" id="3675644">n2</span><span class="op" id="3675646">:</span><span class="op" id="3675647">]</span><span class="op" id="3675648">,</span>&nbsp;<span class="ident" id="3675650">r</span><span class="op" id="3675651">,</span>&nbsp;<span class="ident" id="3675653">n</span><span class="op" id="3675654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675657">karatsubaAdd</span><span class="op" id="3675669">(</span><span class="ident" id="3675670">z</span><span class="op" id="3675671">[</span><span class="ident" id="3675672">n2</span><span class="op" id="3675674">:</span><span class="op" id="3675675">]</span><span class="op" id="3675676">,</span>&nbsp;<span class="ident" id="3675678">r</span><span class="op" id="3675679">[</span><span class="ident" id="3675680">n</span><span class="op" id="3675681">:</span><span class="op" id="3675682">]</span><span class="op" id="3675683">,</span>&nbsp;<span class="ident" id="3675685">n</span><span class="op" id="3675686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675689">if</span>&nbsp;<span class="ident" id="3675692">s</span>&nbsp;<span class="op" id="3675694">&gt;</span>&nbsp;<span class="num" id="3675696">0</span>&nbsp;<span class="op" id="3675698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675702">karatsubaAdd</span><span class="op" id="3675714">(</span><span class="ident" id="3675715">z</span><span class="op" id="3675716">[</span><span class="ident" id="3675717">n2</span><span class="op" id="3675719">:</span><span class="op" id="3675720">]</span><span class="op" id="3675721">,</span>&nbsp;<span class="ident" id="3675723">p</span><span class="op" id="3675724">,</span>&nbsp;<span class="ident" id="3675726">n</span><span class="op" id="3675727">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675730">}</span>&nbsp;<span class="keyword" id="3675732">else</span>&nbsp;<span class="op" id="3675737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675741">karatsubaSub</span><span class="op" id="3675753">(</span><span class="ident" id="3675754">z</span><span class="op" id="3675755">[</span><span class="ident" id="3675756">n2</span><span class="op" id="3675758">:</span><span class="op" id="3675759">]</span><span class="op" id="3675760">,</span>&nbsp;<span class="ident" id="3675762">p</span><span class="op" id="3675763">,</span>&nbsp;<span class="ident" id="3675765">n</span><span class="op" id="3675766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675769">}</span><br>
<span class="lineno"></span><span class="op" id="3675771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3675774">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3675834">func</span>&nbsp;<span class="ident" id="3675839">alias</span><span class="op" id="3675844">(</span><span class="ident" id="3675845">x</span><span class="op" id="3675846">,</span>&nbsp;<span class="ident" id="3675848">y</span>&nbsp;<span class="ident" id="3675850">nat</span><span class="op" id="3675853">)</span>&nbsp;<span class="builtintype" id="3675855">bool</span>&nbsp;<span class="op" id="3675860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675863">return</span>&nbsp;<span class="builtinfunc" id="3675870">cap</span><span class="op" id="3675873">(</span><span class="ident" id="3675874">x</span><span class="op" id="3675875">)</span>&nbsp;<span class="op" id="3675877">&gt;</span>&nbsp;<span class="num" id="3675879">0</span>&nbsp;<span class="op" id="3675881">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3675884">cap</span><span class="op" id="3675887">(</span><span class="ident" id="3675888">y</span><span class="op" id="3675889">)</span>&nbsp;<span class="op" id="3675891">&gt;</span>&nbsp;<span class="num" id="3675893">0</span>&nbsp;<span class="op" id="3675895">&amp;&amp;</span>&nbsp;<span class="op" id="3675898">&amp;</span><span class="ident" id="3675899">x</span><span class="op" id="3675900">[</span><span class="num" id="3675901">0</span><span class="op" id="3675902">:</span><span class="builtinfunc" id="3675903">cap</span><span class="op" id="3675906">(</span><span class="ident" id="3675907">x</span><span class="op" id="3675908">)</span><span class="op" id="3675909">]</span><span class="op" id="3675910">[</span><span class="builtinfunc" id="3675911">cap</span><span class="op" id="3675914">(</span><span class="ident" id="3675915">x</span><span class="op" id="3675916">)</span><span class="op" id="3675917">-</span><span class="num" id="3675918">1</span><span class="op" id="3675919">]</span>&nbsp;<span class="op" id="3675921">==</span>&nbsp;<span class="op" id="3675924">&amp;</span><span class="ident" id="3675925">y</span><span class="op" id="3675926">[</span><span class="num" id="3675927">0</span><span class="op" id="3675928">:</span><span class="builtinfunc" id="3675929">cap</span><span class="op" id="3675932">(</span><span class="ident" id="3675933">y</span><span class="op" id="3675934">)</span><span class="op" id="3675935">]</span><span class="op" id="3675936">[</span><span class="builtinfunc" id="3675937">cap</span><span class="op" id="3675940">(</span><span class="ident" id="3675941">y</span><span class="op" id="3675942">)</span><span class="op" id="3675943">-</span><span class="num" id="3675944">1</span><span class="op" id="3675945">]</span><br>
<span class="lineno"></span><span class="op" id="3675947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3675950">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3676009">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3676069">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3676133">func</span>&nbsp;<span class="ident" id="3676138">addAt</span><span class="op" id="3676143">(</span><span class="ident" id="3676144">z</span><span class="op" id="3676145">,</span>&nbsp;<span class="ident" id="3676147">x</span>&nbsp;<span class="ident" id="3676149">nat</span><span class="op" id="3676152">,</span>&nbsp;<span class="ident" id="3676154">i</span>&nbsp;<span class="builtintype" id="3676156">int</span><span class="op" id="3676159">)</span>&nbsp;<span class="op" id="3676161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676164">if</span>&nbsp;<span class="ident" id="3676167">n</span>&nbsp;<span class="op" id="3676169">:=</span>&nbsp;<span class="builtinfunc" id="3676172">len</span><span class="op" id="3676175">(</span><span class="ident" id="3676176">x</span><span class="op" id="3676177">)</span><span class="op" id="3676178">;</span>&nbsp;<span class="ident" id="3676180">n</span>&nbsp;<span class="op" id="3676182">&gt;</span>&nbsp;<span class="num" id="3676184">0</span>&nbsp;<span class="op" id="3676186">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676190">if</span>&nbsp;<span class="ident" id="3676193">c</span>&nbsp;<span class="op" id="3676195">:=</span>&nbsp;<span class="ident" id="3676198">addVV</span><span class="op" id="3676203">(</span><span class="ident" id="3676204">z</span><span class="op" id="3676205">[</span><span class="ident" id="3676206">i</span><span class="op" id="3676207">:</span><span class="ident" id="3676208">i</span><span class="op" id="3676209">+</span><span class="ident" id="3676210">n</span><span class="op" id="3676211">]</span><span class="op" id="3676212">,</span>&nbsp;<span class="ident" id="3676214">z</span><span class="op" id="3676215">[</span><span class="ident" id="3676216">i</span><span class="op" id="3676217">:</span><span class="op" id="3676218">]</span><span class="op" id="3676219">,</span>&nbsp;<span class="ident" id="3676221">x</span><span class="op" id="3676222">)</span><span class="op" id="3676223">;</span>&nbsp;<span class="ident" id="3676225">c</span>&nbsp;<span class="op" id="3676227">!=</span>&nbsp;<span class="num" id="3676230">0</span>&nbsp;<span class="op" id="3676232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676237">j</span>&nbsp;<span class="op" id="3676239">:=</span>&nbsp;<span class="ident" id="3676242">i</span>&nbsp;<span class="op" id="3676244">+</span>&nbsp;<span class="ident" id="3676246">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676251">if</span>&nbsp;<span class="ident" id="3676254">j</span>&nbsp;<span class="op" id="3676256">&lt;</span>&nbsp;<span class="builtinfunc" id="3676258">len</span><span class="op" id="3676261">(</span><span class="ident" id="3676262">z</span><span class="op" id="3676263">)</span>&nbsp;<span class="op" id="3676265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676271">addVW</span><span class="op" id="3676276">(</span><span class="ident" id="3676277">z</span><span class="op" id="3676278">[</span><span class="ident" id="3676279">j</span><span class="op" id="3676280">:</span><span class="op" id="3676281">]</span><span class="op" id="3676282">,</span>&nbsp;<span class="ident" id="3676284">z</span><span class="op" id="3676285">[</span><span class="ident" id="3676286">j</span><span class="op" id="3676287">:</span><span class="op" id="3676288">]</span><span class="op" id="3676289">,</span>&nbsp;<span class="ident" id="3676291">c</span><span class="op" id="3676292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676297">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676304">}</span><br>
<span class="lineno"></span><span class="op" id="3676306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3676309">func</span>&nbsp;<span class="ident" id="3676314">max</span><span class="op" id="3676317">(</span><span class="ident" id="3676318">x</span><span class="op" id="3676319">,</span>&nbsp;<span class="ident" id="3676321">y</span>&nbsp;<span class="builtintype" id="3676323">int</span><span class="op" id="3676326">)</span>&nbsp;<span class="builtintype" id="3676328">int</span>&nbsp;<span class="op" id="3676332">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676335">if</span>&nbsp;<span class="ident" id="3676338">x</span>&nbsp;<span class="op" id="3676340">&gt;</span>&nbsp;<span class="ident" id="3676342">y</span>&nbsp;<span class="op" id="3676344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676348">return</span>&nbsp;<span class="ident" id="3676355">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676361">return</span>&nbsp;<span class="ident" id="3676368">y</span><br>
<span class="lineno"></span><span class="op" id="3676370">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3676373">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3676447">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3676521">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3676596">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3676647">func</span>&nbsp;<span class="ident" id="3676652">karatsubaLen</span><span class="op" id="3676664">(</span><span class="ident" id="3676665">n</span>&nbsp;<span class="builtintype" id="3676667">int</span><span class="op" id="3676670">)</span>&nbsp;<span class="builtintype" id="3676672">int</span>&nbsp;<span class="op" id="3676676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676679">i</span>&nbsp;<span class="op" id="3676681">:=</span>&nbsp;<span class="builtintype" id="3676684">uint</span><span class="op" id="3676688">(</span><span class="num" id="3676689">0</span><span class="op" id="3676690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676693">for</span>&nbsp;<span class="ident" id="3676697">n</span>&nbsp;<span class="op" id="3676699">&gt;</span>&nbsp;<span class="ident" id="3676701">karatsubaThreshold</span>&nbsp;<span class="op" id="3676720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676724">n</span>&nbsp;<span class="op" id="3676726">&gt;&gt;=</span>&nbsp;<span class="num" id="3676730">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676734">i</span><span class="op" id="3676735">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676742">return</span>&nbsp;<span class="ident" id="3676749">n</span>&nbsp;<span class="op" id="3676751">&lt;&lt;</span>&nbsp;<span class="ident" id="3676754">i</span><br>
<span class="lineno"></span><span class="op" id="3676756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3676759">func</span>&nbsp;<span class="op" id="3676764">(</span><span class="ident" id="3676765">z</span>&nbsp;<span class="ident" id="3676767">nat</span><span class="op" id="3676770">)</span>&nbsp;<span class="ident" id="3676772">mul</span><span class="op" id="3676775">(</span><span class="ident" id="3676776">x</span><span class="op" id="3676777">,</span>&nbsp;<span class="ident" id="3676779">y</span>&nbsp;<span class="ident" id="3676781">nat</span><span class="op" id="3676784">)</span>&nbsp;<span class="ident" id="3676786">nat</span>&nbsp;<span class="op" id="3676790">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676793">m</span>&nbsp;<span class="op" id="3676795">:=</span>&nbsp;<span class="builtinfunc" id="3676798">len</span><span class="op" id="3676801">(</span><span class="ident" id="3676802">x</span><span class="op" id="3676803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676806">n</span>&nbsp;<span class="op" id="3676808">:=</span>&nbsp;<span class="builtinfunc" id="3676811">len</span><span class="op" id="3676814">(</span><span class="ident" id="3676815">y</span><span class="op" id="3676816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676820">switch</span>&nbsp;<span class="op" id="3676827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676830">case</span>&nbsp;<span class="ident" id="3676835">m</span>&nbsp;<span class="op" id="3676837">&lt;</span>&nbsp;<span class="ident" id="3676839">n</span><span class="op" id="3676840">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676844">return</span>&nbsp;<span class="ident" id="3676851">z</span><span class="op" id="3676852">.</span><span class="ident" id="3676853">mul</span><span class="op" id="3676856">(</span><span class="ident" id="3676857">y</span><span class="op" id="3676858">,</span>&nbsp;<span class="ident" id="3676860">x</span><span class="op" id="3676861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676864">case</span>&nbsp;<span class="ident" id="3676869">m</span>&nbsp;<span class="op" id="3676871">==</span>&nbsp;<span class="num" id="3676874">0</span>&nbsp;<span class="op" id="3676876">||</span>&nbsp;<span class="ident" id="3676879">n</span>&nbsp;<span class="op" id="3676881">==</span>&nbsp;<span class="num" id="3676884">0</span><span class="op" id="3676885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676889">return</span>&nbsp;<span class="ident" id="3676896">z</span><span class="op" id="3676897">.</span><span class="builtinfunc" id="3676898">make</span><span class="op" id="3676902">(</span><span class="num" id="3676903">0</span><span class="op" id="3676904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676907">case</span>&nbsp;<span class="ident" id="3676912">n</span>&nbsp;<span class="op" id="3676914">==</span>&nbsp;<span class="num" id="3676917">1</span><span class="op" id="3676918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676922">return</span>&nbsp;<span class="ident" id="3676929">z</span><span class="op" id="3676930">.</span><span class="ident" id="3676931">mulAddWW</span><span class="op" id="3676939">(</span><span class="ident" id="3676940">x</span><span class="op" id="3676941">,</span>&nbsp;<span class="ident" id="3676943">y</span><span class="op" id="3676944">[</span><span class="num" id="3676945">0</span><span class="op" id="3676946">]</span><span class="op" id="3676947">,</span>&nbsp;<span class="num" id="3676949">0</span><span class="op" id="3676950">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676956">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676972">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677005">if</span>&nbsp;<span class="ident" id="3677008">alias</span><span class="op" id="3677013">(</span><span class="ident" id="3677014">z</span><span class="op" id="3677015">,</span>&nbsp;<span class="ident" id="3677017">x</span><span class="op" id="3677018">)</span>&nbsp;<span class="op" id="3677020">||</span>&nbsp;<span class="ident" id="3677023">alias</span><span class="op" id="3677028">(</span><span class="ident" id="3677029">z</span><span class="op" id="3677030">,</span>&nbsp;<span class="ident" id="3677032">y</span><span class="op" id="3677033">)</span>&nbsp;<span class="op" id="3677035">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677039">z</span>&nbsp;<span class="op" id="3677041">=</span>&nbsp;<span class="ident" id="3677043">nil</span>&nbsp;<span class="comment" id="3677047">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677095">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677149">if</span>&nbsp;<span class="ident" id="3677152">n</span>&nbsp;<span class="op" id="3677154">&lt;</span>&nbsp;<span class="ident" id="3677156">karatsubaThreshold</span>&nbsp;<span class="op" id="3677175">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677179">z</span>&nbsp;<span class="op" id="3677181">=</span>&nbsp;<span class="ident" id="3677183">z</span><span class="op" id="3677184">.</span><span class="builtinfunc" id="3677185">make</span><span class="op" id="3677189">(</span><span class="ident" id="3677190">m</span>&nbsp;<span class="op" id="3677192">+</span>&nbsp;<span class="ident" id="3677194">n</span><span class="op" id="3677195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677199">basicMul</span><span class="op" id="3677207">(</span><span class="ident" id="3677208">z</span><span class="op" id="3677209">,</span>&nbsp;<span class="ident" id="3677211">x</span><span class="op" id="3677212">,</span>&nbsp;<span class="ident" id="3677214">y</span><span class="op" id="3677215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677219">return</span>&nbsp;<span class="ident" id="3677226">z</span><span class="op" id="3677227">.</span><span class="ident" id="3677228">norm</span><span class="op" id="3677232">(</span><span class="op" id="3677233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677239">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677288">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677331">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677335">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677370">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677405">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677452">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677456">k</span>&nbsp;<span class="op" id="3677458">:=</span>&nbsp;<span class="ident" id="3677461">karatsubaLen</span><span class="op" id="3677473">(</span><span class="ident" id="3677474">n</span><span class="op" id="3677475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677478">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677490">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677527">x0</span>&nbsp;<span class="op" id="3677530">:=</span>&nbsp;<span class="ident" id="3677533">x</span><span class="op" id="3677534">[</span><span class="num" id="3677535">0</span><span class="op" id="3677536">:</span><span class="ident" id="3677537">k</span><span class="op" id="3677538">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677553">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677578">y0</span>&nbsp;<span class="op" id="3677581">:=</span>&nbsp;<span class="ident" id="3677584">y</span><span class="op" id="3677585">[</span><span class="num" id="3677586">0</span><span class="op" id="3677587">:</span><span class="ident" id="3677588">k</span><span class="op" id="3677589">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677604">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677629">z</span>&nbsp;<span class="op" id="3677631">=</span>&nbsp;<span class="ident" id="3677633">z</span><span class="op" id="3677634">.</span><span class="builtinfunc" id="3677635">make</span><span class="op" id="3677639">(</span><span class="ident" id="3677640">max</span><span class="op" id="3677643">(</span><span class="num" id="3677644">6</span><span class="op" id="3677645">*</span><span class="ident" id="3677646">k</span><span class="op" id="3677647">,</span>&nbsp;<span class="ident" id="3677649">m</span><span class="op" id="3677650">+</span><span class="ident" id="3677651">n</span><span class="op" id="3677652">)</span><span class="op" id="3677653">)</span>&nbsp;<span class="comment" id="3677655">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677718">karatsuba</span><span class="op" id="3677727">(</span><span class="ident" id="3677728">z</span><span class="op" id="3677729">,</span>&nbsp;<span class="ident" id="3677731">x0</span><span class="op" id="3677733">,</span>&nbsp;<span class="ident" id="3677735">y0</span><span class="op" id="3677737">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677740">z</span>&nbsp;<span class="op" id="3677742">=</span>&nbsp;<span class="ident" id="3677744">z</span><span class="op" id="3677745">[</span><span class="num" id="3677746">0</span>&nbsp;<span class="op" id="3677748">:</span>&nbsp;<span class="ident" id="3677750">m</span><span class="op" id="3677751">+</span><span class="ident" id="3677752">n</span><span class="op" id="3677753">]</span>&nbsp;&nbsp;<span class="comment" id="3677756">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677801">z</span><span class="op" id="3677802">[</span><span class="num" id="3677803">2</span><span class="op" id="3677804">*</span><span class="ident" id="3677805">k</span><span class="op" id="3677806">:</span><span class="op" id="3677807">]</span><span class="op" id="3677808">.</span><span class="ident" id="3677809">clear</span><span class="op" id="3677814">(</span><span class="op" id="3677815">)</span>&nbsp;<span class="comment" id="3677817">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677887">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677946">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677950">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678004">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678058">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678062">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678088">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678092">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678145">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678149">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678217">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678285">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678355">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678359">if</span>&nbsp;<span class="ident" id="3678362">k</span>&nbsp;<span class="op" id="3678364">&lt;</span>&nbsp;<span class="ident" id="3678366">n</span>&nbsp;<span class="op" id="3678368">||</span>&nbsp;<span class="ident" id="3678371">m</span>&nbsp;<span class="op" id="3678373">!=</span>&nbsp;<span class="ident" id="3678376">n</span>&nbsp;<span class="op" id="3678378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678382">var</span>&nbsp;<span class="ident" id="3678386">t</span>&nbsp;<span class="ident" id="3678388">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678395">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678412">x0</span>&nbsp;<span class="op" id="3678415">:=</span>&nbsp;<span class="ident" id="3678418">x0</span><span class="op" id="3678420">.</span><span class="ident" id="3678421">norm</span><span class="op" id="3678425">(</span><span class="op" id="3678426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678430">y1</span>&nbsp;<span class="op" id="3678433">:=</span>&nbsp;<span class="ident" id="3678436">y</span><span class="op" id="3678437">[</span><span class="ident" id="3678438">k</span><span class="op" id="3678439">:</span><span class="op" id="3678440">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3678448">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678483">t</span>&nbsp;<span class="op" id="3678485">=</span>&nbsp;<span class="ident" id="3678487">t</span><span class="op" id="3678488">.</span><span class="ident" id="3678489">mul</span><span class="op" id="3678492">(</span><span class="ident" id="3678493">x0</span><span class="op" id="3678495">,</span>&nbsp;<span class="ident" id="3678497">y1</span><span class="op" id="3678499">)</span>&nbsp;<span class="comment" id="3678501">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678553">addAt</span><span class="op" id="3678558">(</span><span class="ident" id="3678559">z</span><span class="op" id="3678560">,</span>&nbsp;<span class="ident" id="3678562">t</span><span class="op" id="3678563">,</span>&nbsp;<span class="ident" id="3678565">k</span><span class="op" id="3678566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678571">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678605">y0</span>&nbsp;<span class="op" id="3678608">:=</span>&nbsp;<span class="ident" id="3678611">y0</span><span class="op" id="3678613">.</span><span class="ident" id="3678614">norm</span><span class="op" id="3678618">(</span><span class="op" id="3678619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678623">for</span>&nbsp;<span class="ident" id="3678627">i</span>&nbsp;<span class="op" id="3678629">:=</span>&nbsp;<span class="ident" id="3678632">k</span><span class="op" id="3678633">;</span>&nbsp;<span class="ident" id="3678635">i</span>&nbsp;<span class="op" id="3678637">&lt;</span>&nbsp;<span class="builtinfunc" id="3678639">len</span><span class="op" id="3678642">(</span><span class="ident" id="3678643">x</span><span class="op" id="3678644">)</span><span class="op" id="3678645">;</span>&nbsp;<span class="ident" id="3678647">i</span>&nbsp;<span class="op" id="3678649">+=</span>&nbsp;<span class="ident" id="3678652">k</span>&nbsp;<span class="op" id="3678654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678659">xi</span>&nbsp;<span class="op" id="3678662">:=</span>&nbsp;<span class="ident" id="3678665">x</span><span class="op" id="3678666">[</span><span class="ident" id="3678667">i</span><span class="op" id="3678668">:</span><span class="op" id="3678669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678674">if</span>&nbsp;<span class="builtinfunc" id="3678677">len</span><span class="op" id="3678680">(</span><span class="ident" id="3678681">xi</span><span class="op" id="3678683">)</span>&nbsp;<span class="op" id="3678685">&gt;</span>&nbsp;<span class="ident" id="3678687">k</span>&nbsp;<span class="op" id="3678689">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678695">xi</span>&nbsp;<span class="op" id="3678698">=</span>&nbsp;<span class="ident" id="3678700">xi</span><span class="op" id="3678702">[</span><span class="op" id="3678703">:</span><span class="ident" id="3678704">k</span><span class="op" id="3678705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678715">xi</span>&nbsp;<span class="op" id="3678718">=</span>&nbsp;<span class="ident" id="3678720">xi</span><span class="op" id="3678722">.</span><span class="ident" id="3678723">norm</span><span class="op" id="3678727">(</span><span class="op" id="3678728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678733">t</span>&nbsp;<span class="op" id="3678735">=</span>&nbsp;<span class="ident" id="3678737">t</span><span class="op" id="3678738">.</span><span class="ident" id="3678739">mul</span><span class="op" id="3678742">(</span><span class="ident" id="3678743">xi</span><span class="op" id="3678745">,</span>&nbsp;<span class="ident" id="3678747">y0</span><span class="op" id="3678749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678754">addAt</span><span class="op" id="3678759">(</span><span class="ident" id="3678760">z</span><span class="op" id="3678761">,</span>&nbsp;<span class="ident" id="3678763">t</span><span class="op" id="3678764">,</span>&nbsp;<span class="ident" id="3678766">i</span><span class="op" id="3678767">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678772">t</span>&nbsp;<span class="op" id="3678774">=</span>&nbsp;<span class="ident" id="3678776">t</span><span class="op" id="3678777">.</span><span class="ident" id="3678778">mul</span><span class="op" id="3678781">(</span><span class="ident" id="3678782">xi</span><span class="op" id="3678784">,</span>&nbsp;<span class="ident" id="3678786">y1</span><span class="op" id="3678788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678793">addAt</span><span class="op" id="3678798">(</span><span class="ident" id="3678799">z</span><span class="op" id="3678800">,</span>&nbsp;<span class="ident" id="3678802">t</span><span class="op" id="3678803">,</span>&nbsp;<span class="ident" id="3678805">i</span><span class="op" id="3678806">+</span><span class="ident" id="3678807">k</span><span class="op" id="3678808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678819">return</span>&nbsp;<span class="ident" id="3678826">z</span><span class="op" id="3678827">.</span><span class="ident" id="3678828">norm</span><span class="op" id="3678832">(</span><span class="op" id="3678833">)</span><br>
<span class="lineno"></span><span class="op" id="3678835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678838">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3678907">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3678977">func</span>&nbsp;<span class="op" id="3678982">(</span><span class="ident" id="3678983">z</span>&nbsp;<span class="ident" id="3678985">nat</span><span class="op" id="3678988">)</span>&nbsp;<span class="ident" id="3678990">mulRange</span><span class="op" id="3678998">(</span><span class="ident" id="3678999">a</span><span class="op" id="3679000">,</span>&nbsp;<span class="ident" id="3679002">b</span>&nbsp;<span class="ident" id="3679004">uint64</span><span class="op" id="3679010">)</span>&nbsp;<span class="ident" id="3679012">nat</span>&nbsp;<span class="op" id="3679016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679019">switch</span>&nbsp;<span class="op" id="3679026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679029">case</span>&nbsp;<span class="ident" id="3679034">a</span>&nbsp;<span class="op" id="3679036">==</span>&nbsp;<span class="num" id="3679039">0</span><span class="op" id="3679040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3679044">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679086">return</span>&nbsp;<span class="ident" id="3679093">z</span><span class="op" id="3679094">.</span><span class="ident" id="3679095">setUint64</span><span class="op" id="3679104">(</span><span class="num" id="3679105">0</span><span class="op" id="3679106">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679109">case</span>&nbsp;<span class="ident" id="3679114">a</span>&nbsp;<span class="op" id="3679116">&gt;</span>&nbsp;<span class="ident" id="3679118">b</span><span class="op" id="3679119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679123">return</span>&nbsp;<span class="ident" id="3679130">z</span><span class="op" id="3679131">.</span><span class="ident" id="3679132">setUint64</span><span class="op" id="3679141">(</span><span class="num" id="3679142">1</span><span class="op" id="3679143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679146">case</span>&nbsp;<span class="ident" id="3679151">a</span>&nbsp;<span class="op" id="3679153">==</span>&nbsp;<span class="ident" id="3679156">b</span><span class="op" id="3679157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679161">return</span>&nbsp;<span class="ident" id="3679168">z</span><span class="op" id="3679169">.</span><span class="ident" id="3679170">setUint64</span><span class="op" id="3679179">(</span><span class="ident" id="3679180">a</span><span class="op" id="3679181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679184">case</span>&nbsp;<span class="ident" id="3679189">a</span><span class="op" id="3679190">+</span><span class="num" id="3679191">1</span>&nbsp;<span class="op" id="3679193">==</span>&nbsp;<span class="ident" id="3679196">b</span><span class="op" id="3679197">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679201">return</span>&nbsp;<span class="ident" id="3679208">z</span><span class="op" id="3679209">.</span><span class="ident" id="3679210">mul</span><span class="op" id="3679213">(</span><span class="ident" id="3679214">nat</span><span class="op" id="3679217">(</span><span class="ident" id="3679218">nil</span><span class="op" id="3679221">)</span><span class="op" id="3679222">.</span><span class="ident" id="3679223">setUint64</span><span class="op" id="3679232">(</span><span class="ident" id="3679233">a</span><span class="op" id="3679234">)</span><span class="op" id="3679235">,</span>&nbsp;<span class="ident" id="3679237">nat</span><span class="op" id="3679240">(</span><span class="ident" id="3679241">nil</span><span class="op" id="3679244">)</span><span class="op" id="3679245">.</span><span class="ident" id="3679246">setUint64</span><span class="op" id="3679255">(</span><span class="ident" id="3679256">b</span><span class="op" id="3679257">)</span><span class="op" id="3679258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679264">m</span>&nbsp;<span class="op" id="3679266">:=</span>&nbsp;<span class="op" id="3679269">(</span><span class="ident" id="3679270">a</span>&nbsp;<span class="op" id="3679272">+</span>&nbsp;<span class="ident" id="3679274">b</span><span class="op" id="3679275">)</span>&nbsp;<span class="op" id="3679277">/</span>&nbsp;<span class="num" id="3679279">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679282">return</span>&nbsp;<span class="ident" id="3679289">z</span><span class="op" id="3679290">.</span><span class="ident" id="3679291">mul</span><span class="op" id="3679294">(</span><span class="ident" id="3679295">nat</span><span class="op" id="3679298">(</span><span class="ident" id="3679299">nil</span><span class="op" id="3679302">)</span><span class="op" id="3679303">.</span><span class="ident" id="3679304">mulRange</span><span class="op" id="3679312">(</span><span class="ident" id="3679313">a</span><span class="op" id="3679314">,</span>&nbsp;<span class="ident" id="3679316">m</span><span class="op" id="3679317">)</span><span class="op" id="3679318">,</span>&nbsp;<span class="ident" id="3679320">nat</span><span class="op" id="3679323">(</span><span class="ident" id="3679324">nil</span><span class="op" id="3679327">)</span><span class="op" id="3679328">.</span><span class="ident" id="3679329">mulRange</span><span class="op" id="3679337">(</span><span class="ident" id="3679338">m</span><span class="op" id="3679339">+</span><span class="num" id="3679340">1</span><span class="op" id="3679341">,</span>&nbsp;<span class="ident" id="3679343">b</span><span class="op" id="3679344">)</span><span class="op" id="3679345">)</span><br>
<span class="lineno"></span><span class="op" id="3679347">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3679350">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3679382">func</span>&nbsp;<span class="op" id="3679387">(</span><span class="ident" id="3679388">z</span>&nbsp;<span class="ident" id="3679390">nat</span><span class="op" id="3679393">)</span>&nbsp;<span class="ident" id="3679395">divW</span><span class="op" id="3679399">(</span><span class="ident" id="3679400">x</span>&nbsp;<span class="ident" id="3679402">nat</span><span class="op" id="3679405">,</span>&nbsp;<span class="ident" id="3679407">y</span>&nbsp;<span class="ident" id="3679409">Word</span><span class="op" id="3679413">)</span>&nbsp;<span class="op" id="3679415">(</span><span class="ident" id="3679416">q</span>&nbsp;<span class="ident" id="3679418">nat</span><span class="op" id="3679421">,</span>&nbsp;<span class="ident" id="3679423">r</span>&nbsp;<span class="ident" id="3679425">Word</span><span class="op" id="3679429">)</span>&nbsp;<span class="op" id="3679431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679434">m</span>&nbsp;<span class="op" id="3679436">:=</span>&nbsp;<span class="builtinfunc" id="3679439">len</span><span class="op" id="3679442">(</span><span class="ident" id="3679443">x</span><span class="op" id="3679444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679447">switch</span>&nbsp;<span class="op" id="3679454">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679457">case</span>&nbsp;<span class="ident" id="3679462">y</span>&nbsp;<span class="op" id="3679464">==</span>&nbsp;<span class="num" id="3679467">0</span><span class="op" id="3679468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3679472">panic</span><span class="op" id="3679477">(</span><span class="string" id="3679478">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3679496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679499">case</span>&nbsp;<span class="ident" id="3679504">y</span>&nbsp;<span class="op" id="3679506">==</span>&nbsp;<span class="num" id="3679509">1</span><span class="op" id="3679510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679514">q</span>&nbsp;<span class="op" id="3679516">=</span>&nbsp;<span class="ident" id="3679518">z</span><span class="op" id="3679519">.</span><span class="ident" id="3679520">set</span><span class="op" id="3679523">(</span><span class="ident" id="3679524">x</span><span class="op" id="3679525">)</span>&nbsp;<span class="comment" id="3679527">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679544">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679552">case</span>&nbsp;<span class="ident" id="3679557">m</span>&nbsp;<span class="op" id="3679559">==</span>&nbsp;<span class="num" id="3679562">0</span><span class="op" id="3679563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679567">q</span>&nbsp;<span class="op" id="3679569">=</span>&nbsp;<span class="ident" id="3679571">z</span><span class="op" id="3679572">.</span><span class="builtinfunc" id="3679573">make</span><span class="op" id="3679577">(</span><span class="num" id="3679578">0</span><span class="op" id="3679579">)</span>&nbsp;<span class="comment" id="3679581">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679598">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3679609">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679619">z</span>&nbsp;<span class="op" id="3679621">=</span>&nbsp;<span class="ident" id="3679623">z</span><span class="op" id="3679624">.</span><span class="builtinfunc" id="3679625">make</span><span class="op" id="3679629">(</span><span class="ident" id="3679630">m</span><span class="op" id="3679631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679634">r</span>&nbsp;<span class="op" id="3679636">=</span>&nbsp;<span class="ident" id="3679638">divWVW</span><span class="op" id="3679644">(</span><span class="ident" id="3679645">z</span><span class="op" id="3679646">,</span>&nbsp;<span class="num" id="3679648">0</span><span class="op" id="3679649">,</span>&nbsp;<span class="ident" id="3679651">x</span><span class="op" id="3679652">,</span>&nbsp;<span class="ident" id="3679654">y</span><span class="op" id="3679655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679658">q</span>&nbsp;<span class="op" id="3679660">=</span>&nbsp;<span class="ident" id="3679662">z</span><span class="op" id="3679663">.</span><span class="ident" id="3679664">norm</span><span class="op" id="3679668">(</span><span class="op" id="3679669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679672">return</span><br>
<span class="lineno"></span><span class="op" id="3679679">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3679682">func</span>&nbsp;<span class="op" id="3679687">(</span><span class="ident" id="3679688">z</span>&nbsp;<span class="ident" id="3679690">nat</span><span class="op" id="3679693">)</span>&nbsp;<span class="ident" id="3679695">div</span><span class="op" id="3679698">(</span><span class="ident" id="3679699">z2</span><span class="op" id="3679701">,</span>&nbsp;<span class="ident" id="3679703">u</span><span class="op" id="3679704">,</span>&nbsp;<span class="ident" id="3679706">v</span>&nbsp;<span class="ident" id="3679708">nat</span><span class="op" id="3679711">)</span>&nbsp;<span class="op" id="3679713">(</span><span class="ident" id="3679714">q</span><span class="op" id="3679715">,</span>&nbsp;<span class="ident" id="3679717">r</span>&nbsp;<span class="ident" id="3679719">nat</span><span class="op" id="3679722">)</span>&nbsp;<span class="op" id="3679724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679727">if</span>&nbsp;<span class="builtinfunc" id="3679730">len</span><span class="op" id="3679733">(</span><span class="ident" id="3679734">v</span><span class="op" id="3679735">)</span>&nbsp;<span class="op" id="3679737">==</span>&nbsp;<span class="num" id="3679740">0</span>&nbsp;<span class="op" id="3679742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3679746">panic</span><span class="op" id="3679751">(</span><span class="string" id="3679752">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3679770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679773">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679777">if</span>&nbsp;<span class="ident" id="3679780">u</span><span class="op" id="3679781">.</span><span class="ident" id="3679782">cmp</span><span class="op" id="3679785">(</span><span class="ident" id="3679786">v</span><span class="op" id="3679787">)</span>&nbsp;<span class="op" id="3679789">&lt;</span>&nbsp;<span class="num" id="3679791">0</span>&nbsp;<span class="op" id="3679793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679797">q</span>&nbsp;<span class="op" id="3679799">=</span>&nbsp;<span class="ident" id="3679801">z</span><span class="op" id="3679802">.</span><span class="builtinfunc" id="3679803">make</span><span class="op" id="3679807">(</span><span class="num" id="3679808">0</span><span class="op" id="3679809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679813">r</span>&nbsp;<span class="op" id="3679815">=</span>&nbsp;<span class="ident" id="3679817">z2</span><span class="op" id="3679819">.</span><span class="ident" id="3679820">set</span><span class="op" id="3679823">(</span><span class="ident" id="3679824">u</span><span class="op" id="3679825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679829">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679841">if</span>&nbsp;<span class="builtinfunc" id="3679844">len</span><span class="op" id="3679847">(</span><span class="ident" id="3679848">v</span><span class="op" id="3679849">)</span>&nbsp;<span class="op" id="3679851">==</span>&nbsp;<span class="num" id="3679854">1</span>&nbsp;<span class="op" id="3679856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679860">var</span>&nbsp;<span class="ident" id="3679864">r2</span>&nbsp;<span class="ident" id="3679867">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679874">q</span><span class="op" id="3679875">,</span>&nbsp;<span class="ident" id="3679877">r2</span>&nbsp;<span class="op" id="3679880">=</span>&nbsp;<span class="ident" id="3679882">z</span><span class="op" id="3679883">.</span><span class="ident" id="3679884">divW</span><span class="op" id="3679888">(</span><span class="ident" id="3679889">u</span><span class="op" id="3679890">,</span>&nbsp;<span class="ident" id="3679892">v</span><span class="op" id="3679893">[</span><span class="num" id="3679894">0</span><span class="op" id="3679895">]</span><span class="op" id="3679896">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679900">r</span>&nbsp;<span class="op" id="3679902">=</span>&nbsp;<span class="ident" id="3679904">z2</span><span class="op" id="3679906">.</span><span class="ident" id="3679907">setWord</span><span class="op" id="3679914">(</span><span class="ident" id="3679915">r2</span><span class="op" id="3679917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679921">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679933">q</span><span class="op" id="3679934">,</span>&nbsp;<span class="ident" id="3679936">r</span>&nbsp;<span class="op" id="3679938">=</span>&nbsp;<span class="ident" id="3679940">z</span><span class="op" id="3679941">.</span><span class="ident" id="3679942">divLarge</span><span class="op" id="3679950">(</span><span class="ident" id="3679951">z2</span><span class="op" id="3679953">,</span>&nbsp;<span class="ident" id="3679955">u</span><span class="op" id="3679956">,</span>&nbsp;<span class="ident" id="3679958">v</span><span class="op" id="3679959">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679962">return</span><br>
<span class="lineno"></span><span class="op" id="3679969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679972">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3680006">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3680070">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3680122">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3680140">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3680158">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3680183">func</span>&nbsp;<span class="op" id="3680188">(</span><span class="ident" id="3680189">z</span>&nbsp;<span class="ident" id="3680191">nat</span><span class="op" id="3680194">)</span>&nbsp;<span class="ident" id="3680196">divLarge</span><span class="op" id="3680204">(</span><span class="ident" id="3680205">u</span><span class="op" id="3680206">,</span>&nbsp;<span class="ident" id="3680208">uIn</span><span class="op" id="3680211">,</span>&nbsp;<span class="ident" id="3680213">v</span>&nbsp;<span class="ident" id="3680215">nat</span><span class="op" id="3680218">)</span>&nbsp;<span class="op" id="3680220">(</span><span class="ident" id="3680221">q</span><span class="op" id="3680222">,</span>&nbsp;<span class="ident" id="3680224">r</span>&nbsp;<span class="ident" id="3680226">nat</span><span class="op" id="3680229">)</span>&nbsp;<span class="op" id="3680231">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680234">n</span>&nbsp;<span class="op" id="3680236">:=</span>&nbsp;<span class="builtinfunc" id="3680239">len</span><span class="op" id="3680242">(</span><span class="ident" id="3680243">v</span><span class="op" id="3680244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680247">m</span>&nbsp;<span class="op" id="3680249">:=</span>&nbsp;<span class="builtinfunc" id="3680252">len</span><span class="op" id="3680255">(</span><span class="ident" id="3680256">uIn</span><span class="op" id="3680259">)</span>&nbsp;<span class="op" id="3680261">-</span>&nbsp;<span class="ident" id="3680263">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680267">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680300">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680364">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680430">if</span>&nbsp;<span class="ident" id="3680433">alias</span><span class="op" id="3680438">(</span><span class="ident" id="3680439">z</span><span class="op" id="3680440">,</span>&nbsp;<span class="ident" id="3680442">uIn</span><span class="op" id="3680445">)</span>&nbsp;<span class="op" id="3680447">||</span>&nbsp;<span class="ident" id="3680450">alias</span><span class="op" id="3680455">(</span><span class="ident" id="3680456">z</span><span class="op" id="3680457">,</span>&nbsp;<span class="ident" id="3680459">v</span><span class="op" id="3680460">)</span>&nbsp;<span class="op" id="3680462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680466">z</span>&nbsp;<span class="op" id="3680468">=</span>&nbsp;<span class="ident" id="3680470">nil</span>&nbsp;<span class="comment" id="3680474">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680523">q</span>&nbsp;<span class="op" id="3680525">=</span>&nbsp;<span class="ident" id="3680527">z</span><span class="op" id="3680528">.</span><span class="builtinfunc" id="3680529">make</span><span class="op" id="3680533">(</span><span class="ident" id="3680534">m</span>&nbsp;<span class="op" id="3680536">+</span>&nbsp;<span class="num" id="3680538">1</span><span class="op" id="3680539">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680543">qhatv</span>&nbsp;<span class="op" id="3680549">:=</span>&nbsp;<span class="builtinfunc" id="3680552">make</span><span class="op" id="3680556">(</span><span class="ident" id="3680557">nat</span><span class="op" id="3680560">,</span>&nbsp;<span class="ident" id="3680562">n</span><span class="op" id="3680563">+</span><span class="num" id="3680564">1</span><span class="op" id="3680565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680568">if</span>&nbsp;<span class="ident" id="3680571">alias</span><span class="op" id="3680576">(</span><span class="ident" id="3680577">u</span><span class="op" id="3680578">,</span>&nbsp;<span class="ident" id="3680580">uIn</span><span class="op" id="3680583">)</span>&nbsp;<span class="op" id="3680585">||</span>&nbsp;<span class="ident" id="3680588">alias</span><span class="op" id="3680593">(</span><span class="ident" id="3680594">u</span><span class="op" id="3680595">,</span>&nbsp;<span class="ident" id="3680597">v</span><span class="op" id="3680598">)</span>&nbsp;<span class="op" id="3680600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680604">u</span>&nbsp;<span class="op" id="3680606">=</span>&nbsp;<span class="ident" id="3680608">nil</span>&nbsp;<span class="comment" id="3680612">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680658">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680661">u</span>&nbsp;<span class="op" id="3680663">=</span>&nbsp;<span class="ident" id="3680665">u</span><span class="op" id="3680666">.</span><span class="builtinfunc" id="3680667">make</span><span class="op" id="3680671">(</span><span class="builtinfunc" id="3680672">len</span><span class="op" id="3680675">(</span><span class="ident" id="3680676">uIn</span><span class="op" id="3680679">)</span>&nbsp;<span class="op" id="3680681">+</span>&nbsp;<span class="num" id="3680683">1</span><span class="op" id="3680684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680687">u</span><span class="op" id="3680688">.</span><span class="ident" id="3680689">clear</span><span class="op" id="3680694">(</span><span class="op" id="3680695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680699">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680707">shift</span>&nbsp;<span class="op" id="3680713">:=</span>&nbsp;<span class="ident" id="3680716">leadingZeros</span><span class="op" id="3680728">(</span><span class="ident" id="3680729">v</span><span class="op" id="3680730">[</span><span class="ident" id="3680731">n</span><span class="op" id="3680732">-</span><span class="num" id="3680733">1</span><span class="op" id="3680734">]</span><span class="op" id="3680735">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680738">if</span>&nbsp;<span class="ident" id="3680741">shift</span>&nbsp;<span class="op" id="3680747">&gt;</span>&nbsp;<span class="num" id="3680749">0</span>&nbsp;<span class="op" id="3680751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680755">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680828">v1</span>&nbsp;<span class="op" id="3680831">:=</span>&nbsp;<span class="builtinfunc" id="3680834">make</span><span class="op" id="3680838">(</span><span class="ident" id="3680839">nat</span><span class="op" id="3680842">,</span>&nbsp;<span class="ident" id="3680844">n</span><span class="op" id="3680845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680849">shlVU</span><span class="op" id="3680854">(</span><span class="ident" id="3680855">v1</span><span class="op" id="3680857">,</span>&nbsp;<span class="ident" id="3680859">v</span><span class="op" id="3680860">,</span>&nbsp;<span class="ident" id="3680862">shift</span><span class="op" id="3680867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680871">v</span>&nbsp;<span class="op" id="3680873">=</span>&nbsp;<span class="ident" id="3680875">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680882">u</span><span class="op" id="3680883">[</span><span class="builtinfunc" id="3680884">len</span><span class="op" id="3680887">(</span><span class="ident" id="3680888">uIn</span><span class="op" id="3680891">)</span><span class="op" id="3680892">]</span>&nbsp;<span class="op" id="3680894">=</span>&nbsp;<span class="ident" id="3680896">shlVU</span><span class="op" id="3680901">(</span><span class="ident" id="3680902">u</span><span class="op" id="3680903">[</span><span class="num" id="3680904">0</span><span class="op" id="3680905">:</span><span class="builtinfunc" id="3680906">len</span><span class="op" id="3680909">(</span><span class="ident" id="3680910">uIn</span><span class="op" id="3680913">)</span><span class="op" id="3680914">]</span><span class="op" id="3680915">,</span>&nbsp;<span class="ident" id="3680917">uIn</span><span class="op" id="3680920">,</span>&nbsp;<span class="ident" id="3680922">shift</span><span class="op" id="3680927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680931">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680939">for</span>&nbsp;<span class="ident" id="3680943">j</span>&nbsp;<span class="op" id="3680945">:=</span>&nbsp;<span class="ident" id="3680948">m</span><span class="op" id="3680949">;</span>&nbsp;<span class="ident" id="3680951">j</span>&nbsp;<span class="op" id="3680953">&gt;=</span>&nbsp;<span class="num" id="3680956">0</span><span class="op" id="3680957">;</span>&nbsp;<span class="ident" id="3680959">j</span><span class="op" id="3680960">--</span>&nbsp;<span class="op" id="3680963">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680967">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680976">qhat</span>&nbsp;<span class="op" id="3680981">:=</span>&nbsp;<span class="ident" id="3680984">Word</span><span class="op" id="3680988">(</span><span class="ident" id="3680989">_M</span><span class="op" id="3680991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680995">if</span>&nbsp;<span class="ident" id="3680998">u</span><span class="op" id="3680999">[</span><span class="ident" id="3681000">j</span><span class="op" id="3681001">+</span><span class="ident" id="3681002">n</span><span class="op" id="3681003">]</span>&nbsp;<span class="op" id="3681005">!=</span>&nbsp;<span class="ident" id="3681008">v</span><span class="op" id="3681009">[</span><span class="ident" id="3681010">n</span><span class="op" id="3681011">-</span><span class="num" id="3681012">1</span><span class="op" id="3681013">]</span>&nbsp;<span class="op" id="3681015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681020">var</span>&nbsp;<span class="ident" id="3681024">rhat</span>&nbsp;<span class="ident" id="3681029">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681037">qhat</span><span class="op" id="3681041">,</span>&nbsp;<span class="ident" id="3681043">rhat</span>&nbsp;<span class="op" id="3681048">=</span>&nbsp;<span class="ident" id="3681050">divWW</span><span class="op" id="3681055">(</span><span class="ident" id="3681056">u</span><span class="op" id="3681057">[</span><span class="ident" id="3681058">j</span><span class="op" id="3681059">+</span><span class="ident" id="3681060">n</span><span class="op" id="3681061">]</span><span class="op" id="3681062">,</span>&nbsp;<span class="ident" id="3681064">u</span><span class="op" id="3681065">[</span><span class="ident" id="3681066">j</span><span class="op" id="3681067">+</span><span class="ident" id="3681068">n</span><span class="op" id="3681069">-</span><span class="num" id="3681070">1</span><span class="op" id="3681071">]</span><span class="op" id="3681072">,</span>&nbsp;<span class="ident" id="3681074">v</span><span class="op" id="3681075">[</span><span class="ident" id="3681076">n</span><span class="op" id="3681077">-</span><span class="num" id="3681078">1</span><span class="op" id="3681079">]</span><span class="op" id="3681080">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681086">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681113">x1</span><span class="op" id="3681115">,</span>&nbsp;<span class="ident" id="3681117">x2</span>&nbsp;<span class="op" id="3681120">:=</span>&nbsp;<span class="ident" id="3681123">mulWW</span><span class="op" id="3681128">(</span><span class="ident" id="3681129">qhat</span><span class="op" id="3681133">,</span>&nbsp;<span class="ident" id="3681135">v</span><span class="op" id="3681136">[</span><span class="ident" id="3681137">n</span><span class="op" id="3681138">-</span><span class="num" id="3681139">2</span><span class="op" id="3681140">]</span><span class="op" id="3681141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681146">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681190">for</span>&nbsp;<span class="ident" id="3681194">greaterThan</span><span class="op" id="3681205">(</span><span class="ident" id="3681206">x1</span><span class="op" id="3681208">,</span>&nbsp;<span class="ident" id="3681210">x2</span><span class="op" id="3681212">,</span>&nbsp;<span class="ident" id="3681214">rhat</span><span class="op" id="3681218">,</span>&nbsp;<span class="ident" id="3681220">u</span><span class="op" id="3681221">[</span><span class="ident" id="3681222">j</span><span class="op" id="3681223">+</span><span class="ident" id="3681224">n</span><span class="op" id="3681225">-</span><span class="num" id="3681226">2</span><span class="op" id="3681227">]</span><span class="op" id="3681228">)</span>&nbsp;<span class="op" id="3681230">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681236">qhat</span><span class="op" id="3681240">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681247">prevRhat</span>&nbsp;<span class="op" id="3681256">:=</span>&nbsp;<span class="ident" id="3681259">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681268">rhat</span>&nbsp;<span class="op" id="3681273">+=</span>&nbsp;<span class="ident" id="3681276">v</span><span class="op" id="3681277">[</span><span class="ident" id="3681278">n</span><span class="op" id="3681279">-</span><span class="num" id="3681280">1</span><span class="op" id="3681281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681287">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681335">if</span>&nbsp;<span class="ident" id="3681338">rhat</span>&nbsp;<span class="op" id="3681343">&lt;</span>&nbsp;<span class="ident" id="3681345">prevRhat</span>&nbsp;<span class="op" id="3681354">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681361">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681377">x1</span><span class="op" id="3681379">,</span>&nbsp;<span class="ident" id="3681381">x2</span>&nbsp;<span class="op" id="3681384">=</span>&nbsp;<span class="ident" id="3681386">mulWW</span><span class="op" id="3681391">(</span><span class="ident" id="3681392">qhat</span><span class="op" id="3681396">,</span>&nbsp;<span class="ident" id="3681398">v</span><span class="op" id="3681399">[</span><span class="ident" id="3681400">n</span><span class="op" id="3681401">-</span><span class="num" id="3681402">2</span><span class="op" id="3681403">]</span><span class="op" id="3681404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681413">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681418">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681427">qhatv</span><span class="op" id="3681432">[</span><span class="ident" id="3681433">n</span><span class="op" id="3681434">]</span>&nbsp;<span class="op" id="3681436">=</span>&nbsp;<span class="ident" id="3681438">mulAddVWW</span><span class="op" id="3681447">(</span><span class="ident" id="3681448">qhatv</span><span class="op" id="3681453">[</span><span class="num" id="3681454">0</span><span class="op" id="3681455">:</span><span class="ident" id="3681456">n</span><span class="op" id="3681457">]</span><span class="op" id="3681458">,</span>&nbsp;<span class="ident" id="3681460">v</span><span class="op" id="3681461">,</span>&nbsp;<span class="ident" id="3681463">qhat</span><span class="op" id="3681467">,</span>&nbsp;<span class="num" id="3681469">0</span><span class="op" id="3681470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681475">c</span>&nbsp;<span class="op" id="3681477">:=</span>&nbsp;<span class="ident" id="3681480">subVV</span><span class="op" id="3681485">(</span><span class="ident" id="3681486">u</span><span class="op" id="3681487">[</span><span class="ident" id="3681488">j</span><span class="op" id="3681489">:</span><span class="ident" id="3681490">j</span><span class="op" id="3681491">+</span><span class="builtinfunc" id="3681492">len</span><span class="op" id="3681495">(</span><span class="ident" id="3681496">qhatv</span><span class="op" id="3681501">)</span><span class="op" id="3681502">]</span><span class="op" id="3681503">,</span>&nbsp;<span class="ident" id="3681505">u</span><span class="op" id="3681506">[</span><span class="ident" id="3681507">j</span><span class="op" id="3681508">:</span><span class="op" id="3681509">]</span><span class="op" id="3681510">,</span>&nbsp;<span class="ident" id="3681512">qhatv</span><span class="op" id="3681517">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681521">if</span>&nbsp;<span class="ident" id="3681524">c</span>&nbsp;<span class="op" id="3681526">!=</span>&nbsp;<span class="num" id="3681529">0</span>&nbsp;<span class="op" id="3681531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681536">c</span>&nbsp;<span class="op" id="3681538">:=</span>&nbsp;<span class="ident" id="3681541">addVV</span><span class="op" id="3681546">(</span><span class="ident" id="3681547">u</span><span class="op" id="3681548">[</span><span class="ident" id="3681549">j</span><span class="op" id="3681550">:</span><span class="ident" id="3681551">j</span><span class="op" id="3681552">+</span><span class="ident" id="3681553">n</span><span class="op" id="3681554">]</span><span class="op" id="3681555">,</span>&nbsp;<span class="ident" id="3681557">u</span><span class="op" id="3681558">[</span><span class="ident" id="3681559">j</span><span class="op" id="3681560">:</span><span class="op" id="3681561">]</span><span class="op" id="3681562">,</span>&nbsp;<span class="ident" id="3681564">v</span><span class="op" id="3681565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681570">u</span><span class="op" id="3681571">[</span><span class="ident" id="3681572">j</span><span class="op" id="3681573">+</span><span class="ident" id="3681574">n</span><span class="op" id="3681575">]</span>&nbsp;<span class="op" id="3681577">+=</span>&nbsp;<span class="ident" id="3681580">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681585">qhat</span><span class="op" id="3681589">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681594">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681599">q</span><span class="op" id="3681600">[</span><span class="ident" id="3681601">j</span><span class="op" id="3681602">]</span>&nbsp;<span class="op" id="3681604">=</span>&nbsp;<span class="ident" id="3681606">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681616">q</span>&nbsp;<span class="op" id="3681618">=</span>&nbsp;<span class="ident" id="3681620">q</span><span class="op" id="3681621">.</span><span class="ident" id="3681622">norm</span><span class="op" id="3681626">(</span><span class="op" id="3681627">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681630">shrVU</span><span class="op" id="3681635">(</span><span class="ident" id="3681636">u</span><span class="op" id="3681637">,</span>&nbsp;<span class="ident" id="3681639">u</span><span class="op" id="3681640">,</span>&nbsp;<span class="ident" id="3681642">shift</span><span class="op" id="3681647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681650">r</span>&nbsp;<span class="op" id="3681652">=</span>&nbsp;<span class="ident" id="3681654">u</span><span class="op" id="3681655">.</span><span class="ident" id="3681656">norm</span><span class="op" id="3681660">(</span><span class="op" id="3681661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681665">return</span>&nbsp;<span class="ident" id="3681672">q</span><span class="op" id="3681673">,</span>&nbsp;<span class="ident" id="3681675">r</span><br>
<span class="lineno"></span><span class="op" id="3681677">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3681680">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3681726">func</span>&nbsp;<span class="op" id="3681731">(</span><span class="ident" id="3681732">x</span>&nbsp;<span class="ident" id="3681734">nat</span><span class="op" id="3681737">)</span>&nbsp;<span class="ident" id="3681739">bitLen</span><span class="op" id="3681745">(</span><span class="op" id="3681746">)</span>&nbsp;<span class="builtintype" id="3681748">int</span>&nbsp;<span class="op" id="3681752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681755">if</span>&nbsp;<span class="ident" id="3681758">i</span>&nbsp;<span class="op" id="3681760">:=</span>&nbsp;<span class="builtinfunc" id="3681763">len</span><span class="op" id="3681766">(</span><span class="ident" id="3681767">x</span><span class="op" id="3681768">)</span>&nbsp;<span class="op" id="3681770">-</span>&nbsp;<span class="num" id="3681772">1</span><span class="op" id="3681773">;</span>&nbsp;<span class="ident" id="3681775">i</span>&nbsp;<span class="op" id="3681777">&gt;=</span>&nbsp;<span class="num" id="3681780">0</span>&nbsp;<span class="op" id="3681782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681786">return</span>&nbsp;<span class="ident" id="3681793">i</span><span class="op" id="3681794">*</span><span class="ident" id="3681795">_W</span>&nbsp;<span class="op" id="3681798">+</span>&nbsp;<span class="ident" id="3681800">bitLen</span><span class="op" id="3681806">(</span><span class="ident" id="3681807">x</span><span class="op" id="3681808">[</span><span class="ident" id="3681809">i</span><span class="op" id="3681810">]</span><span class="op" id="3681811">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681817">return</span>&nbsp;<span class="num" id="3681824">0</span><br>
<span class="lineno"></span><span class="op" id="3681826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3681829">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3681900">const</span>&nbsp;<span class="ident" id="3681906">MaxBase</span>&nbsp;<span class="op" id="3681914">=</span>&nbsp;<span class="string" id="3681916">&#39;z&#39;</span>&nbsp;<span class="op" id="3681920">-</span>&nbsp;<span class="string" id="3681922">&#39;a&#39;</span>&nbsp;<span class="op" id="3681926">+</span>&nbsp;<span class="num" id="3681928">10</span>&nbsp;<span class="op" id="3681931">+</span>&nbsp;<span class="num" id="3681933">1</span>&nbsp;<span class="comment" id="3681935">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3681959">func</span>&nbsp;<span class="ident" id="3681964">hexValue</span><span class="op" id="3681972">(</span><span class="ident" id="3681973">ch</span>&nbsp;<span class="builtintype" id="3681976">rune</span><span class="op" id="3681980">)</span>&nbsp;<span class="ident" id="3681982">Word</span>&nbsp;<span class="op" id="3681987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681990">d</span>&nbsp;<span class="op" id="3681992">:=</span>&nbsp;<span class="builtintype" id="3681995">int</span><span class="op" id="3681998">(</span><span class="ident" id="3681999">MaxBase</span>&nbsp;<span class="op" id="3682007">+</span>&nbsp;<span class="num" id="3682009">1</span><span class="op" id="3682010">)</span>&nbsp;<span class="comment" id="3682012">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682029">switch</span>&nbsp;<span class="op" id="3682036">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682039">case</span>&nbsp;<span class="string" id="3682044">&#39;0&#39;</span>&nbsp;<span class="op" id="3682048">&lt;=</span>&nbsp;<span class="ident" id="3682051">ch</span>&nbsp;<span class="op" id="3682054">&amp;&amp;</span>&nbsp;<span class="ident" id="3682057">ch</span>&nbsp;<span class="op" id="3682060">&lt;=</span>&nbsp;<span class="string" id="3682063">&#39;9&#39;</span><span class="op" id="3682066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682070">d</span>&nbsp;<span class="op" id="3682072">=</span>&nbsp;<span class="builtintype" id="3682074">int</span><span class="op" id="3682077">(</span><span class="ident" id="3682078">ch</span>&nbsp;<span class="op" id="3682081">-</span>&nbsp;<span class="string" id="3682083">&#39;0&#39;</span><span class="op" id="3682086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682089">case</span>&nbsp;<span class="string" id="3682094">&#39;a&#39;</span>&nbsp;<span class="op" id="3682098">&lt;=</span>&nbsp;<span class="ident" id="3682101">ch</span>&nbsp;<span class="op" id="3682104">&amp;&amp;</span>&nbsp;<span class="ident" id="3682107">ch</span>&nbsp;<span class="op" id="3682110">&lt;=</span>&nbsp;<span class="string" id="3682113">&#39;z&#39;</span><span class="op" id="3682116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682120">d</span>&nbsp;<span class="op" id="3682122">=</span>&nbsp;<span class="builtintype" id="3682124">int</span><span class="op" id="3682127">(</span><span class="ident" id="3682128">ch</span>&nbsp;<span class="op" id="3682131">-</span>&nbsp;<span class="string" id="3682133">&#39;a&#39;</span>&nbsp;<span class="op" id="3682137">+</span>&nbsp;<span class="num" id="3682139">10</span><span class="op" id="3682141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682144">case</span>&nbsp;<span class="string" id="3682149">&#39;A&#39;</span>&nbsp;<span class="op" id="3682153">&lt;=</span>&nbsp;<span class="ident" id="3682156">ch</span>&nbsp;<span class="op" id="3682159">&amp;&amp;</span>&nbsp;<span class="ident" id="3682162">ch</span>&nbsp;<span class="op" id="3682165">&lt;=</span>&nbsp;<span class="string" id="3682168">&#39;Z&#39;</span><span class="op" id="3682171">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682175">d</span>&nbsp;<span class="op" id="3682177">=</span>&nbsp;<span class="builtintype" id="3682179">int</span><span class="op" id="3682182">(</span><span class="ident" id="3682183">ch</span>&nbsp;<span class="op" id="3682186">-</span>&nbsp;<span class="string" id="3682188">&#39;A&#39;</span>&nbsp;<span class="op" id="3682192">+</span>&nbsp;<span class="num" id="3682194">10</span><span class="op" id="3682196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3682199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682202">return</span>&nbsp;<span class="ident" id="3682209">Word</span><span class="op" id="3682213">(</span><span class="ident" id="3682214">d</span><span class="op" id="3682215">)</span><br>
<span class="lineno"></span><span class="op" id="3682217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3682220">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3682302">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3682378">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3682457">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3682534">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3682570">//</span><br>
<span class="lineno"></span><span class="comment" id="3682573">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3682651">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3682729">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3682805">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3682883">//</span><br>
<span class="lineno"></span><span class="keyword" id="3682886">func</span>&nbsp;<span class="op" id="3682891">(</span><span class="ident" id="3682892">z</span>&nbsp;<span class="ident" id="3682894">nat</span><span class="op" id="3682897">)</span>&nbsp;<span class="ident" id="3682899">scan</span><span class="op" id="3682903">(</span><span class="ident" id="3682904">r</span>&nbsp;<span class="ident" id="3682906">io</span><span class="op" id="3682908">.</span><span class="ident" id="3682909">RuneScanner</span><span class="op" id="3682920">,</span>&nbsp;<span class="ident" id="3682922">base</span>&nbsp;<span class="builtintype" id="3682927">int</span><span class="op" id="3682930">)</span>&nbsp;<span class="op" id="3682932">(</span><span class="ident" id="3682933">nat</span><span class="op" id="3682936">,</span>&nbsp;<span class="builtintype" id="3682938">int</span><span class="op" id="3682941">,</span>&nbsp;<span class="builtintype" id="3682943">error</span><span class="op" id="3682948">)</span>&nbsp;<span class="op" id="3682950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3682953">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682978">if</span>&nbsp;<span class="ident" id="3682981">base</span>&nbsp;<span class="op" id="3682986">&lt;</span>&nbsp;<span class="num" id="3682988">0</span>&nbsp;<span class="op" id="3682990">||</span>&nbsp;<span class="ident" id="3682993">base</span>&nbsp;<span class="op" id="3682998">==</span>&nbsp;<span class="num" id="3683001">1</span>&nbsp;<span class="op" id="3683003">||</span>&nbsp;<span class="ident" id="3683006">MaxBase</span>&nbsp;<span class="op" id="3683014">&lt;</span>&nbsp;<span class="ident" id="3683016">base</span>&nbsp;<span class="op" id="3683021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683025">return</span>&nbsp;<span class="ident" id="3683032">z</span><span class="op" id="3683033">,</span>&nbsp;<span class="num" id="3683035">0</span><span class="op" id="3683036">,</span>&nbsp;<span class="ident" id="3683038">errors</span><span class="op" id="3683044">.</span><span class="ident" id="3683045">New</span><span class="op" id="3683048">(</span><span class="string" id="3683049">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3683070">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3683077">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683101">ch</span><span class="op" id="3683103">,</span>&nbsp;<span class="ident" id="3683105">_</span><span class="op" id="3683106">,</span>&nbsp;<span class="ident" id="3683108">err</span>&nbsp;<span class="op" id="3683112">:=</span>&nbsp;<span class="ident" id="3683115">r</span><span class="op" id="3683116">.</span><span class="ident" id="3683117">ReadRune</span><span class="op" id="3683125">(</span><span class="op" id="3683126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683129">if</span>&nbsp;<span class="ident" id="3683132">err</span>&nbsp;<span class="op" id="3683136">!=</span>&nbsp;<span class="ident" id="3683139">nil</span>&nbsp;<span class="op" id="3683143">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683147">return</span>&nbsp;<span class="ident" id="3683154">z</span><span class="op" id="3683155">,</span>&nbsp;<span class="num" id="3683157">0</span><span class="op" id="3683158">,</span>&nbsp;<span class="ident" id="3683160">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3683169">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683201">b</span>&nbsp;<span class="op" id="3683203">:=</span>&nbsp;<span class="ident" id="3683206">Word</span><span class="op" id="3683210">(</span><span class="ident" id="3683211">base</span><span class="op" id="3683215">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683218">if</span>&nbsp;<span class="ident" id="3683221">base</span>&nbsp;<span class="op" id="3683226">==</span>&nbsp;<span class="num" id="3683229">0</span>&nbsp;<span class="op" id="3683231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683235">b</span>&nbsp;<span class="op" id="3683237">=</span>&nbsp;<span class="num" id="3683239">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683244">if</span>&nbsp;<span class="ident" id="3683247">ch</span>&nbsp;<span class="op" id="3683250">==</span>&nbsp;<span class="string" id="3683253">&#39;0&#39;</span>&nbsp;<span class="op" id="3683257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683262">switch</span>&nbsp;<span class="ident" id="3683269">ch</span><span class="op" id="3683271">,</span>&nbsp;<span class="ident" id="3683273">_</span><span class="op" id="3683274">,</span>&nbsp;<span class="ident" id="3683276">err</span>&nbsp;<span class="op" id="3683280">=</span>&nbsp;<span class="ident" id="3683282">r</span><span class="op" id="3683283">.</span><span class="ident" id="3683284">ReadRune</span><span class="op" id="3683292">(</span><span class="op" id="3683293">)</span><span class="op" id="3683294">;</span>&nbsp;<span class="ident" id="3683296">err</span>&nbsp;<span class="op" id="3683300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683305">case</span>&nbsp;<span class="ident" id="3683310">nil</span><span class="op" id="3683313">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683319">b</span>&nbsp;<span class="op" id="3683321">=</span>&nbsp;<span class="num" id="3683323">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683329">switch</span>&nbsp;<span class="ident" id="3683336">ch</span>&nbsp;<span class="op" id="3683339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683345">case</span>&nbsp;<span class="string" id="3683350">&#39;x&#39;</span><span class="op" id="3683353">,</span>&nbsp;<span class="string" id="3683355">&#39;X&#39;</span><span class="op" id="3683358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683365">b</span>&nbsp;<span class="op" id="3683367">=</span>&nbsp;<span class="num" id="3683369">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683376">case</span>&nbsp;<span class="string" id="3683381">&#39;b&#39;</span><span class="op" id="3683384">,</span>&nbsp;<span class="string" id="3683386">&#39;B&#39;</span><span class="op" id="3683389">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683396">b</span>&nbsp;<span class="op" id="3683398">=</span>&nbsp;<span class="num" id="3683400">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683412">if</span>&nbsp;<span class="ident" id="3683415">b</span>&nbsp;<span class="op" id="3683417">==</span>&nbsp;<span class="num" id="3683420">2</span>&nbsp;<span class="op" id="3683422">||</span>&nbsp;<span class="ident" id="3683425">b</span>&nbsp;<span class="op" id="3683427">==</span>&nbsp;<span class="num" id="3683430">16</span>&nbsp;<span class="op" id="3683433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683440">if</span>&nbsp;<span class="ident" id="3683443">ch</span><span class="op" id="3683445">,</span>&nbsp;<span class="ident" id="3683447">_</span><span class="op" id="3683448">,</span>&nbsp;<span class="ident" id="3683450">err</span>&nbsp;<span class="op" id="3683454">=</span>&nbsp;<span class="ident" id="3683456">r</span><span class="op" id="3683457">.</span><span class="ident" id="3683458">ReadRune</span><span class="op" id="3683466">(</span><span class="op" id="3683467">)</span><span class="op" id="3683468">;</span>&nbsp;<span class="ident" id="3683470">err</span>&nbsp;<span class="op" id="3683474">!=</span>&nbsp;<span class="ident" id="3683477">nil</span>&nbsp;<span class="op" id="3683481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683489">return</span>&nbsp;<span class="ident" id="3683496">z</span><span class="op" id="3683497">,</span>&nbsp;<span class="num" id="3683499">0</span><span class="op" id="3683500">,</span>&nbsp;<span class="ident" id="3683502">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683522">case</span>&nbsp;<span class="ident" id="3683527">io</span><span class="op" id="3683529">.</span><span class="ident" id="3683530">EOF</span><span class="op" id="3683533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683539">return</span>&nbsp;<span class="ident" id="3683546">z</span><span class="op" id="3683547">.</span><span class="builtinfunc" id="3683548">make</span><span class="op" id="3683552">(</span><span class="num" id="3683553">0</span><span class="op" id="3683554">)</span><span class="op" id="3683555">,</span>&nbsp;<span class="num" id="3683557">10</span><span class="op" id="3683559">,</span>&nbsp;<span class="ident" id="3683561">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683568">default</span><span class="op" id="3683575">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683581">return</span>&nbsp;<span class="ident" id="3683588">z</span><span class="op" id="3683589">,</span>&nbsp;<span class="num" id="3683591">10</span><span class="op" id="3683593">,</span>&nbsp;<span class="ident" id="3683595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3683613">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3683632">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3683727">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683822">z</span>&nbsp;<span class="op" id="3683824">=</span>&nbsp;<span class="ident" id="3683826">z</span><span class="op" id="3683827">.</span><span class="builtinfunc" id="3683828">make</span><span class="op" id="3683832">(</span><span class="num" id="3683833">0</span><span class="op" id="3683834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683837">bb</span>&nbsp;<span class="op" id="3683840">:=</span>&nbsp;<span class="ident" id="3683843">Word</span><span class="op" id="3683847">(</span><span class="num" id="3683848">1</span><span class="op" id="3683849">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683852">dd</span>&nbsp;<span class="op" id="3683855">:=</span>&nbsp;<span class="ident" id="3683858">Word</span><span class="op" id="3683862">(</span><span class="num" id="3683863">0</span><span class="op" id="3683864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683867">for</span>&nbsp;<span class="ident" id="3683871">max</span>&nbsp;<span class="op" id="3683875">:=</span>&nbsp;<span class="ident" id="3683878">_M</span>&nbsp;<span class="op" id="3683881">/</span>&nbsp;<span class="ident" id="3683883">b</span><span class="op" id="3683884">;</span>&nbsp;<span class="op" id="3683886">;</span>&nbsp;<span class="op" id="3683888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683892">d</span>&nbsp;<span class="op" id="3683894">:=</span>&nbsp;<span class="ident" id="3683897">hexValue</span><span class="op" id="3683905">(</span><span class="ident" id="3683906">ch</span><span class="op" id="3683908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683912">if</span>&nbsp;<span class="ident" id="3683915">d</span>&nbsp;<span class="op" id="3683917">&gt;=</span>&nbsp;<span class="ident" id="3683920">b</span>&nbsp;<span class="op" id="3683922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683927">r</span><span class="op" id="3683928">.</span><span class="ident" id="3683929">UnreadRune</span><span class="op" id="3683939">(</span><span class="op" id="3683940">)</span>&nbsp;<span class="comment" id="3683942">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683985">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683998">if</span>&nbsp;<span class="ident" id="3684001">bb</span>&nbsp;<span class="op" id="3684004">&lt;=</span>&nbsp;<span class="ident" id="3684007">max</span>&nbsp;<span class="op" id="3684011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684016">bb</span>&nbsp;<span class="op" id="3684019">*=</span>&nbsp;<span class="ident" id="3684022">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684027">dd</span>&nbsp;<span class="op" id="3684030">=</span>&nbsp;<span class="ident" id="3684032">dd</span><span class="op" id="3684034">*</span><span class="ident" id="3684035">b</span>&nbsp;<span class="op" id="3684037">+</span>&nbsp;<span class="ident" id="3684039">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684043">}</span>&nbsp;<span class="keyword" id="3684045">else</span>&nbsp;<span class="op" id="3684050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684055">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684083">z</span>&nbsp;<span class="op" id="3684085">=</span>&nbsp;<span class="ident" id="3684087">z</span><span class="op" id="3684088">.</span><span class="ident" id="3684089">mulAddWW</span><span class="op" id="3684097">(</span><span class="ident" id="3684098">z</span><span class="op" id="3684099">,</span>&nbsp;<span class="ident" id="3684101">bb</span><span class="op" id="3684103">,</span>&nbsp;<span class="ident" id="3684105">dd</span><span class="op" id="3684107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684112">bb</span>&nbsp;<span class="op" id="3684115">=</span>&nbsp;<span class="ident" id="3684117">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684122">dd</span>&nbsp;<span class="op" id="3684125">=</span>&nbsp;<span class="ident" id="3684127">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684136">if</span>&nbsp;<span class="ident" id="3684139">ch</span><span class="op" id="3684141">,</span>&nbsp;<span class="ident" id="3684143">_</span><span class="op" id="3684144">,</span>&nbsp;<span class="ident" id="3684146">err</span>&nbsp;<span class="op" id="3684150">=</span>&nbsp;<span class="ident" id="3684152">r</span><span class="op" id="3684153">.</span><span class="ident" id="3684154">ReadRune</span><span class="op" id="3684162">(</span><span class="op" id="3684163">)</span><span class="op" id="3684164">;</span>&nbsp;<span class="ident" id="3684166">err</span>&nbsp;<span class="op" id="3684170">!=</span>&nbsp;<span class="ident" id="3684173">nil</span>&nbsp;<span class="op" id="3684177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684182">if</span>&nbsp;<span class="ident" id="3684185">err</span>&nbsp;<span class="op" id="3684189">!=</span>&nbsp;<span class="ident" id="3684192">io</span><span class="op" id="3684194">.</span><span class="ident" id="3684195">EOF</span>&nbsp;<span class="op" id="3684199">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684205">return</span>&nbsp;<span class="ident" id="3684212">z</span><span class="op" id="3684213">,</span>&nbsp;<span class="builtintype" id="3684215">int</span><span class="op" id="3684218">(</span><span class="ident" id="3684219">b</span><span class="op" id="3684220">)</span><span class="op" id="3684221">,</span>&nbsp;<span class="ident" id="3684223">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684235">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684246">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684250">switch</span>&nbsp;<span class="op" id="3684257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684260">case</span>&nbsp;<span class="ident" id="3684265">bb</span>&nbsp;<span class="op" id="3684268">&gt;</span>&nbsp;<span class="num" id="3684270">1</span><span class="op" id="3684271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684275">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684318">z</span>&nbsp;<span class="op" id="3684320">=</span>&nbsp;<span class="ident" id="3684322">z</span><span class="op" id="3684323">.</span><span class="ident" id="3684324">mulAddWW</span><span class="op" id="3684332">(</span><span class="ident" id="3684333">z</span><span class="op" id="3684334">,</span>&nbsp;<span class="ident" id="3684336">bb</span><span class="op" id="3684338">,</span>&nbsp;<span class="ident" id="3684340">dd</span><span class="op" id="3684342">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684345">case</span>&nbsp;<span class="ident" id="3684350">base</span>&nbsp;<span class="op" id="3684355">==</span>&nbsp;<span class="num" id="3684358">0</span>&nbsp;<span class="op" id="3684360">&amp;&amp;</span>&nbsp;<span class="ident" id="3684363">b</span>&nbsp;<span class="op" id="3684365">==</span>&nbsp;<span class="num" id="3684368">8</span><span class="op" id="3684369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684373">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684447">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684474">return</span>&nbsp;<span class="ident" id="3684481">z</span><span class="op" id="3684482">,</span>&nbsp;<span class="num" id="3684484">10</span><span class="op" id="3684486">,</span>&nbsp;<span class="ident" id="3684488">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684493">case</span>&nbsp;<span class="ident" id="3684498">base</span>&nbsp;<span class="op" id="3684503">!=</span>&nbsp;<span class="num" id="3684506">0</span>&nbsp;<span class="op" id="3684508">||</span>&nbsp;<span class="ident" id="3684511">b</span>&nbsp;<span class="op" id="3684513">!=</span>&nbsp;<span class="num" id="3684516">8</span><span class="op" id="3684517">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684521">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684584">return</span>&nbsp;<span class="ident" id="3684591">z</span><span class="op" id="3684592">,</span>&nbsp;<span class="builtintype" id="3684594">int</span><span class="op" id="3684597">(</span><span class="ident" id="3684598">b</span><span class="op" id="3684599">)</span><span class="op" id="3684600">,</span>&nbsp;<span class="ident" id="3684602">errors</span><span class="op" id="3684608">.</span><span class="ident" id="3684609">New</span><span class="op" id="3684612">(</span><span class="string" id="3684613">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3684643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684650">return</span>&nbsp;<span class="ident" id="3684657">z</span><span class="op" id="3684658">.</span><span class="ident" id="3684659">norm</span><span class="op" id="3684663">(</span><span class="op" id="3684664">)</span><span class="op" id="3684665">,</span>&nbsp;<span class="builtintype" id="3684667">int</span><span class="op" id="3684670">(</span><span class="ident" id="3684671">b</span><span class="op" id="3684672">)</span><span class="op" id="3684673">,</span>&nbsp;<span class="ident" id="3684675">nil</span><br>
<span class="lineno">720</span><span class="op" id="3684679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3684682">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3684723">const</span>&nbsp;<span class="op" id="3684729">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684732">lowercaseDigits</span>&nbsp;<span class="op" id="3684748">=</span>&nbsp;<span class="string" id="3684750">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684790">uppercaseDigits</span>&nbsp;<span class="op" id="3684806">=</span>&nbsp;<span class="string" id="3684808">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3684847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3684850">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3684906">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3684958">func</span>&nbsp;<span class="op" id="3684963">(</span><span class="ident" id="3684964">x</span>&nbsp;<span class="ident" id="3684966">nat</span><span class="op" id="3684969">)</span>&nbsp;<span class="ident" id="3684971">decimalString</span><span class="op" id="3684984">(</span><span class="op" id="3684985">)</span>&nbsp;<span class="builtintype" id="3684987">string</span>&nbsp;<span class="op" id="3684994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684997">return</span>&nbsp;<span class="ident" id="3685004">x</span><span class="op" id="3685005">.</span><span class="builtintype" id="3685006">string</span><span class="op" id="3685012">(</span><span class="ident" id="3685013">lowercaseDigits</span><span class="op" id="3685028">[</span><span class="num" id="3685029">0</span><span class="op" id="3685030">:</span><span class="num" id="3685031">10</span><span class="op" id="3685033">]</span><span class="op" id="3685034">)</span><br>
<span class="lineno"></span><span class="op" id="3685036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3685039">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3685114">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3685189">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3685240">func</span>&nbsp;<span class="op" id="3685245">(</span><span class="ident" id="3685246">x</span>&nbsp;<span class="ident" id="3685248">nat</span><span class="op" id="3685251">)</span>&nbsp;<span class="builtintype" id="3685253">string</span><span class="op" id="3685259">(</span><span class="ident" id="3685260">charset</span>&nbsp;<span class="builtintype" id="3685268">string</span><span class="op" id="3685274">)</span>&nbsp;<span class="builtintype" id="3685276">string</span>&nbsp;<span class="op" id="3685283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685286">b</span>&nbsp;<span class="op" id="3685288">:=</span>&nbsp;<span class="ident" id="3685291">Word</span><span class="op" id="3685295">(</span><span class="builtinfunc" id="3685296">len</span><span class="op" id="3685299">(</span><span class="ident" id="3685300">charset</span><span class="op" id="3685307">)</span><span class="op" id="3685308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685312">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685330">switch</span>&nbsp;<span class="op" id="3685337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685340">case</span>&nbsp;<span class="ident" id="3685345">b</span>&nbsp;<span class="op" id="3685347">&lt;</span>&nbsp;<span class="num" id="3685349">2</span>&nbsp;<span class="op" id="3685351">||</span>&nbsp;<span class="ident" id="3685354">MaxBase</span>&nbsp;<span class="op" id="3685362">&gt;</span>&nbsp;<span class="num" id="3685364">256</span><span class="op" id="3685367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3685371">panic</span><span class="op" id="3685376">(</span><span class="string" id="3685377">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3685391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685394">case</span>&nbsp;<span class="builtinfunc" id="3685399">len</span><span class="op" id="3685402">(</span><span class="ident" id="3685403">x</span><span class="op" id="3685404">)</span>&nbsp;<span class="op" id="3685406">==</span>&nbsp;<span class="num" id="3685409">0</span><span class="op" id="3685410">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685414">return</span>&nbsp;<span class="builtintype" id="3685421">string</span><span class="op" id="3685427">(</span><span class="ident" id="3685428">charset</span><span class="op" id="3685435">[</span><span class="num" id="3685436">0</span><span class="op" id="3685437">]</span><span class="op" id="3685438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685445">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685480">i</span>&nbsp;<span class="op" id="3685482">:=</span>&nbsp;<span class="builtintype" id="3685485">int</span><span class="op" id="3685488">(</span><span class="builtintype" id="3685489">float64</span><span class="op" id="3685496">(</span><span class="ident" id="3685497">x</span><span class="op" id="3685498">.</span><span class="ident" id="3685499">bitLen</span><span class="op" id="3685505">(</span><span class="op" id="3685506">)</span><span class="op" id="3685507">)</span><span class="op" id="3685508">/</span><span class="ident" id="3685509">math</span><span class="op" id="3685513">.</span><span class="ident" id="3685514">Log2</span><span class="op" id="3685518">(</span><span class="builtintype" id="3685519">float64</span><span class="op" id="3685526">(</span><span class="ident" id="3685527">b</span><span class="op" id="3685528">)</span><span class="op" id="3685529">)</span><span class="op" id="3685530">)</span>&nbsp;<span class="op" id="3685532">+</span>&nbsp;<span class="num" id="3685534">1</span>&nbsp;<span class="comment" id="3685536">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685559">s</span>&nbsp;<span class="op" id="3685561">:=</span>&nbsp;<span class="builtinfunc" id="3685564">make</span><span class="op" id="3685568">(</span><span class="op" id="3685569">[</span><span class="op" id="3685570">]</span><span class="builtintype" id="3685571">byte</span><span class="op" id="3685575">,</span>&nbsp;<span class="ident" id="3685577">i</span><span class="op" id="3685578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685582">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685645">if</span>&nbsp;<span class="ident" id="3685648">b</span>&nbsp;<span class="op" id="3685650">==</span>&nbsp;<span class="ident" id="3685653">b</span><span class="op" id="3685654">&amp;</span><span class="op" id="3685655">-</span><span class="ident" id="3685656">b</span>&nbsp;<span class="op" id="3685658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685662">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685702">shift</span>&nbsp;<span class="op" id="3685708">:=</span>&nbsp;<span class="ident" id="3685711">trailingZeroBits</span><span class="op" id="3685727">(</span><span class="ident" id="3685728">b</span><span class="op" id="3685729">)</span>&nbsp;<span class="comment" id="3685731">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685761">mask</span>&nbsp;<span class="op" id="3685766">:=</span>&nbsp;<span class="ident" id="3685769">Word</span><span class="op" id="3685773">(</span><span class="num" id="3685774">1</span><span class="op" id="3685775">)</span><span class="op" id="3685776">&lt;&lt;</span><span class="ident" id="3685778">shift</span>&nbsp;<span class="op" id="3685784">-</span>&nbsp;<span class="num" id="3685786">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685790">w</span>&nbsp;<span class="op" id="3685792">:=</span>&nbsp;<span class="ident" id="3685795">x</span><span class="op" id="3685796">[</span><span class="num" id="3685797">0</span><span class="op" id="3685798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685802">nbits</span>&nbsp;<span class="op" id="3685808">:=</span>&nbsp;<span class="builtintype" id="3685811">uint</span><span class="op" id="3685815">(</span><span class="ident" id="3685816">_W</span><span class="op" id="3685818">)</span>&nbsp;<span class="comment" id="3685820">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685858">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685894">for</span>&nbsp;<span class="ident" id="3685898">k</span>&nbsp;<span class="op" id="3685900">:=</span>&nbsp;<span class="num" id="3685903">1</span><span class="op" id="3685904">;</span>&nbsp;<span class="ident" id="3685906">k</span>&nbsp;<span class="op" id="3685908">&lt;</span>&nbsp;<span class="builtinfunc" id="3685910">len</span><span class="op" id="3685913">(</span><span class="ident" id="3685914">x</span><span class="op" id="3685915">)</span><span class="op" id="3685916">;</span>&nbsp;<span class="ident" id="3685918">k</span><span class="op" id="3685919">++</span>&nbsp;<span class="op" id="3685922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685927">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685953">for</span>&nbsp;<span class="ident" id="3685957">nbits</span>&nbsp;<span class="op" id="3685963">&gt;=</span>&nbsp;<span class="ident" id="3685966">shift</span>&nbsp;<span class="op" id="3685972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685978">i</span><span class="op" id="3685979">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685986">s</span><span class="op" id="3685987">[</span><span class="ident" id="3685988">i</span><span class="op" id="3685989">]</span>&nbsp;<span class="op" id="3685991">=</span>&nbsp;<span class="ident" id="3685993">charset</span><span class="op" id="3686000">[</span><span class="ident" id="3686001">w</span><span class="op" id="3686002">&amp;</span><span class="ident" id="3686003">mask</span><span class="op" id="3686007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686013">w</span>&nbsp;<span class="op" id="3686015">&gt;&gt;=</span>&nbsp;<span class="ident" id="3686019">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686029">nbits</span>&nbsp;<span class="op" id="3686035">-=</span>&nbsp;<span class="ident" id="3686038">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686053">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686118">if</span>&nbsp;<span class="ident" id="3686121">nbits</span>&nbsp;<span class="op" id="3686127">==</span>&nbsp;<span class="num" id="3686130">0</span>&nbsp;<span class="op" id="3686132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686138">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686186">w</span>&nbsp;<span class="op" id="3686188">=</span>&nbsp;<span class="ident" id="3686190">x</span><span class="op" id="3686191">[</span><span class="ident" id="3686192">k</span><span class="op" id="3686193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686199">nbits</span>&nbsp;<span class="op" id="3686205">=</span>&nbsp;<span class="ident" id="3686207">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686213">}</span>&nbsp;<span class="keyword" id="3686215">else</span>&nbsp;<span class="op" id="3686220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686226">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686282">w</span>&nbsp;<span class="op" id="3686284">|=</span>&nbsp;<span class="ident" id="3686287">x</span><span class="op" id="3686288">[</span><span class="ident" id="3686289">k</span><span class="op" id="3686290">]</span>&nbsp;<span class="op" id="3686292">&lt;&lt;</span>&nbsp;<span class="ident" id="3686295">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686305">i</span><span class="op" id="3686306">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686313">s</span><span class="op" id="3686314">[</span><span class="ident" id="3686315">i</span><span class="op" id="3686316">]</span>&nbsp;<span class="op" id="3686318">=</span>&nbsp;<span class="ident" id="3686320">charset</span><span class="op" id="3686327">[</span><span class="ident" id="3686328">w</span><span class="op" id="3686329">&amp;</span><span class="ident" id="3686330">mask</span><span class="op" id="3686334">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686341">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686356">w</span>&nbsp;<span class="op" id="3686358">=</span>&nbsp;<span class="ident" id="3686360">x</span><span class="op" id="3686361">[</span><span class="ident" id="3686362">k</span><span class="op" id="3686363">]</span>&nbsp;<span class="op" id="3686365">&gt;&gt;</span>&nbsp;<span class="op" id="3686368">(</span><span class="ident" id="3686369">shift</span>&nbsp;<span class="op" id="3686375">-</span>&nbsp;<span class="ident" id="3686377">nbits</span><span class="op" id="3686382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686388">nbits</span>&nbsp;<span class="op" id="3686394">=</span>&nbsp;<span class="ident" id="3686396">_W</span>&nbsp;<span class="op" id="3686399">-</span>&nbsp;<span class="op" id="3686401">(</span><span class="ident" id="3686402">shift</span>&nbsp;<span class="op" id="3686408">-</span>&nbsp;<span class="ident" id="3686410">nbits</span><span class="op" id="3686415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686420">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686429">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686495">for</span>&nbsp;<span class="ident" id="3686499">nbits</span>&nbsp;<span class="op" id="3686505">&gt;=</span>&nbsp;<span class="num" id="3686508">0</span>&nbsp;<span class="op" id="3686510">&amp;&amp;</span>&nbsp;<span class="ident" id="3686513">w</span>&nbsp;<span class="op" id="3686515">!=</span>&nbsp;<span class="num" id="3686518">0</span>&nbsp;<span class="op" id="3686520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686525">i</span><span class="op" id="3686526">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686532">s</span><span class="op" id="3686533">[</span><span class="ident" id="3686534">i</span><span class="op" id="3686535">]</span>&nbsp;<span class="op" id="3686537">=</span>&nbsp;<span class="ident" id="3686539">charset</span><span class="op" id="3686546">[</span><span class="ident" id="3686547">w</span><span class="op" id="3686548">&amp;</span><span class="ident" id="3686549">mask</span><span class="op" id="3686553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686558">w</span>&nbsp;<span class="op" id="3686560">&gt;&gt;=</span>&nbsp;<span class="ident" id="3686564">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686573">nbits</span>&nbsp;<span class="op" id="3686579">-=</span>&nbsp;<span class="ident" id="3686582">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686594">}</span>&nbsp;<span class="keyword" id="3686596">else</span>&nbsp;<span class="op" id="3686601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686605">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686668">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686726">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686783">bb</span>&nbsp;<span class="op" id="3686786">:=</span>&nbsp;<span class="ident" id="3686789">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3686796">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686824">ndigits</span>&nbsp;<span class="op" id="3686832">:=</span>&nbsp;<span class="num" id="3686835">1</span>&nbsp;<span class="comment" id="3686837">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686866">for</span>&nbsp;<span class="ident" id="3686870">max</span>&nbsp;<span class="op" id="3686874">:=</span>&nbsp;<span class="ident" id="3686877">Word</span><span class="op" id="3686881">(</span><span class="ident" id="3686882">_M</span>&nbsp;<span class="op" id="3686885">/</span>&nbsp;<span class="ident" id="3686887">b</span><span class="op" id="3686888">)</span><span class="op" id="3686889">;</span>&nbsp;<span class="ident" id="3686891">bb</span>&nbsp;<span class="op" id="3686894">&lt;=</span>&nbsp;<span class="ident" id="3686897">max</span><span class="op" id="3686900">;</span>&nbsp;<span class="ident" id="3686902">bb</span>&nbsp;<span class="op" id="3686905">*=</span>&nbsp;<span class="ident" id="3686908">b</span>&nbsp;<span class="op" id="3686910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686915">ndigits</span><span class="op" id="3686922">++</span>&nbsp;<span class="comment" id="3686925">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686984">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687065">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687120">table</span>&nbsp;<span class="op" id="3687126">:=</span>&nbsp;<span class="ident" id="3687129">divisors</span><span class="op" id="3687137">(</span><span class="builtinfunc" id="3687138">len</span><span class="op" id="3687141">(</span><span class="ident" id="3687142">x</span><span class="op" id="3687143">)</span><span class="op" id="3687144">,</span>&nbsp;<span class="ident" id="3687146">b</span><span class="op" id="3687147">,</span>&nbsp;<span class="ident" id="3687149">ndigits</span><span class="op" id="3687156">,</span>&nbsp;<span class="ident" id="3687158">bb</span><span class="op" id="3687160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687165">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687224">q</span>&nbsp;<span class="op" id="3687226">:=</span>&nbsp;<span class="ident" id="3687229">nat</span><span class="op" id="3687232">(</span><span class="ident" id="3687233">nil</span><span class="op" id="3687236">)</span><span class="op" id="3687237">.</span><span class="ident" id="3687238">set</span><span class="op" id="3687241">(</span><span class="ident" id="3687242">x</span><span class="op" id="3687243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687248">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687285">q</span><span class="op" id="3687286">.</span><span class="ident" id="3687287">convertWords</span><span class="op" id="3687299">(</span><span class="ident" id="3687300">s</span><span class="op" id="3687301">,</span>&nbsp;<span class="ident" id="3687303">charset</span><span class="op" id="3687310">,</span>&nbsp;<span class="ident" id="3687312">b</span><span class="op" id="3687313">,</span>&nbsp;<span class="ident" id="3687315">ndigits</span><span class="op" id="3687322">,</span>&nbsp;<span class="ident" id="3687324">bb</span><span class="op" id="3687326">,</span>&nbsp;<span class="ident" id="3687328">table</span><span class="op" id="3687333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687338">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687363">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687425">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687459">i</span>&nbsp;<span class="op" id="3687461">=</span>&nbsp;<span class="num" id="3687463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687467">for</span>&nbsp;<span class="ident" id="3687471">zero</span>&nbsp;<span class="op" id="3687476">:=</span>&nbsp;<span class="ident" id="3687479">charset</span><span class="op" id="3687486">[</span><span class="num" id="3687487">0</span><span class="op" id="3687488">]</span><span class="op" id="3687489">;</span>&nbsp;<span class="ident" id="3687491">s</span><span class="op" id="3687492">[</span><span class="ident" id="3687493">i</span><span class="op" id="3687494">]</span>&nbsp;<span class="op" id="3687496">==</span>&nbsp;<span class="ident" id="3687499">zero</span><span class="op" id="3687503">;</span>&nbsp;<span class="op" id="3687505">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687510">i</span><span class="op" id="3687511">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687523">return</span>&nbsp;<span class="builtintype" id="3687530">string</span><span class="op" id="3687536">(</span><span class="ident" id="3687537">s</span><span class="op" id="3687538">[</span><span class="ident" id="3687539">i</span><span class="op" id="3687540">:</span><span class="op" id="3687541">]</span><span class="op" id="3687542">)</span><br>
<span class="lineno">825</span><span class="op" id="3687544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3687547">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3687641">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3687735">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3687766">//</span><br>
<span class="lineno"></span><span class="comment" id="3687769">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3687869">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3687966">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3688062">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3688158">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3688256">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3688353">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3688450">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3688548">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3688644">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3688737">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3688759">//</span><br>
<span class="lineno"></span><span class="keyword" id="3688762">func</span>&nbsp;<span class="op" id="3688767">(</span><span class="ident" id="3688768">q</span>&nbsp;<span class="ident" id="3688770">nat</span><span class="op" id="3688773">)</span>&nbsp;<span class="ident" id="3688775">convertWords</span><span class="op" id="3688787">(</span><span class="ident" id="3688788">s</span>&nbsp;<span class="op" id="3688790">[</span><span class="op" id="3688791">]</span><span class="builtintype" id="3688792">byte</span><span class="op" id="3688796">,</span>&nbsp;<span class="ident" id="3688798">charset</span>&nbsp;<span class="builtintype" id="3688806">string</span><span class="op" id="3688812">,</span>&nbsp;<span class="ident" id="3688814">b</span>&nbsp;<span class="ident" id="3688816">Word</span><span class="op" id="3688820">,</span>&nbsp;<span class="ident" id="3688822">ndigits</span>&nbsp;<span class="builtintype" id="3688830">int</span><span class="op" id="3688833">,</span>&nbsp;<span class="ident" id="3688835">bb</span>&nbsp;<span class="ident" id="3688838">Word</span><span class="op" id="3688842">,</span>&nbsp;<span class="ident" id="3688844">table</span>&nbsp;<span class="op" id="3688850">[</span><span class="op" id="3688851">]</span><span class="ident" id="3688852">divisor</span><span class="op" id="3688859">)</span>&nbsp;<span class="op" id="3688861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3688864">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688900">if</span>&nbsp;<span class="ident" id="3688903">table</span>&nbsp;<span class="op" id="3688909">!=</span>&nbsp;<span class="ident" id="3688912">nil</span>&nbsp;<span class="op" id="3688916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3688920">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688947">var</span>&nbsp;<span class="ident" id="3688951">r</span>&nbsp;<span class="ident" id="3688953">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3688959">index</span>&nbsp;<span class="op" id="3688965">:=</span>&nbsp;<span class="builtinfunc" id="3688968">len</span><span class="op" id="3688971">(</span><span class="ident" id="3688972">table</span><span class="op" id="3688977">)</span>&nbsp;<span class="op" id="3688979">-</span>&nbsp;<span class="num" id="3688981">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688985">for</span>&nbsp;<span class="builtinfunc" id="3688989">len</span><span class="op" id="3688992">(</span><span class="ident" id="3688993">q</span><span class="op" id="3688994">)</span>&nbsp;<span class="op" id="3688996">&gt;</span>&nbsp;<span class="ident" id="3688998">leafSize</span>&nbsp;<span class="op" id="3689007">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3689012">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689081">maxLength</span>&nbsp;<span class="op" id="3689091">:=</span>&nbsp;<span class="ident" id="3689094">q</span><span class="op" id="3689095">.</span><span class="ident" id="3689096">bitLen</span><span class="op" id="3689102">(</span><span class="op" id="3689103">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3689109">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689179">minLength</span>&nbsp;<span class="op" id="3689189">:=</span>&nbsp;<span class="ident" id="3689192">maxLength</span>&nbsp;<span class="op" id="3689202">&gt;&gt;</span>&nbsp;<span class="num" id="3689205">1</span>&nbsp;<span class="comment" id="3689207">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3689229">for</span>&nbsp;<span class="ident" id="3689233">index</span>&nbsp;<span class="op" id="3689239">&gt;</span>&nbsp;<span class="num" id="3689241">0</span>&nbsp;<span class="op" id="3689243">&amp;&amp;</span>&nbsp;<span class="ident" id="3689246">table</span><span class="op" id="3689251">[</span><span class="ident" id="3689252">index</span><span class="op" id="3689257">-</span><span class="num" id="3689258">1</span><span class="op" id="3689259">]</span><span class="op" id="3689260">.</span><span class="ident" id="3689261">nbits</span>&nbsp;<span class="op" id="3689267">&gt;</span>&nbsp;<span class="ident" id="3689269">minLength</span>&nbsp;<span class="op" id="3689279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689285">index</span><span class="op" id="3689290">--</span>&nbsp;<span class="comment" id="3689293">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3689307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3689312">if</span>&nbsp;<span class="ident" id="3689315">table</span><span class="op" id="3689320">[</span><span class="ident" id="3689321">index</span><span class="op" id="3689326">]</span><span class="op" id="3689327">.</span><span class="ident" id="3689328">nbits</span>&nbsp;<span class="op" id="3689334">&gt;=</span>&nbsp;<span class="ident" id="3689337">maxLength</span>&nbsp;<span class="op" id="3689347">&amp;&amp;</span>&nbsp;<span class="ident" id="3689350">table</span><span class="op" id="3689355">[</span><span class="ident" id="3689356">index</span><span class="op" id="3689361">]</span><span class="op" id="3689362">.</span><span class="ident" id="3689363">bbb</span><span class="op" id="3689366">.</span><span class="ident" id="3689367">cmp</span><span class="op" id="3689370">(</span><span class="ident" id="3689371">q</span><span class="op" id="3689372">)</span>&nbsp;<span class="op" id="3689374">&gt;=</span>&nbsp;<span class="num" id="3689377">0</span>&nbsp;<span class="op" id="3689379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689385">index</span><span class="op" id="3689390">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3689397">if</span>&nbsp;<span class="ident" id="3689400">index</span>&nbsp;<span class="op" id="3689406">&lt;</span>&nbsp;<span class="num" id="3689408">0</span>&nbsp;<span class="op" id="3689410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3689417">panic</span><span class="op" id="3689422">(</span><span class="string" id="3689423">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3689447">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3689453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3689458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3689464">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689547">q</span><span class="op" id="3689548">,</span>&nbsp;<span class="ident" id="3689550">r</span>&nbsp;<span class="op" id="3689552">=</span>&nbsp;<span class="ident" id="3689554">q</span><span class="op" id="3689555">.</span><span class="ident" id="3689556">div</span><span class="op" id="3689559">(</span><span class="ident" id="3689560">r</span><span class="op" id="3689561">,</span>&nbsp;<span class="ident" id="3689563">q</span><span class="op" id="3689564">,</span>&nbsp;<span class="ident" id="3689566">table</span><span class="op" id="3689571">[</span><span class="ident" id="3689572">index</span><span class="op" id="3689577">]</span><span class="op" id="3689578">.</span><span class="ident" id="3689579">bbb</span><span class="op" id="3689582">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3689588">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689651">h</span>&nbsp;<span class="op" id="3689653">:=</span>&nbsp;<span class="builtinfunc" id="3689656">len</span><span class="op" id="3689659">(</span><span class="ident" id="3689660">s</span><span class="op" id="3689661">)</span>&nbsp;<span class="op" id="3689663">-</span>&nbsp;<span class="ident" id="3689665">table</span><span class="op" id="3689670">[</span><span class="ident" id="3689671">index</span><span class="op" id="3689676">]</span><span class="op" id="3689677">.</span><span class="ident" id="3689678">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689689">r</span><span class="op" id="3689690">.</span><span class="ident" id="3689691">convertWords</span><span class="op" id="3689703">(</span><span class="ident" id="3689704">s</span><span class="op" id="3689705">[</span><span class="ident" id="3689706">h</span><span class="op" id="3689707">:</span><span class="op" id="3689708">]</span><span class="op" id="3689709">,</span>&nbsp;<span class="ident" id="3689711">charset</span><span class="op" id="3689718">,</span>&nbsp;<span class="ident" id="3689720">b</span><span class="op" id="3689721">,</span>&nbsp;<span class="ident" id="3689723">ndigits</span><span class="op" id="3689730">,</span>&nbsp;<span class="ident" id="3689732">bb</span><span class="op" id="3689734">,</span>&nbsp;<span class="ident" id="3689736">table</span><span class="op" id="3689741">[</span><span class="num" id="3689742">0</span><span class="op" id="3689743">:</span><span class="ident" id="3689744">index</span><span class="op" id="3689749">]</span><span class="op" id="3689750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689755">s</span>&nbsp;<span class="op" id="3689757">=</span>&nbsp;<span class="ident" id="3689759">s</span><span class="op" id="3689760">[</span><span class="op" id="3689761">:</span><span class="ident" id="3689762">h</span><span class="op" id="3689763">]</span>&nbsp;<span class="comment" id="3689765">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3689834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3689837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3689841">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3689927">i</span>&nbsp;<span class="op" id="3689929">:=</span>&nbsp;<span class="builtinfunc" id="3689932">len</span><span class="op" id="3689935">(</span><span class="ident" id="3689936">s</span><span class="op" id="3689937">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3689940">var</span>&nbsp;<span class="ident" id="3689944">r</span>&nbsp;<span class="ident" id="3689946">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3689952">if</span>&nbsp;<span class="ident" id="3689955">b</span>&nbsp;<span class="op" id="3689957">==</span>&nbsp;<span class="num" id="3689960">10</span>&nbsp;<span class="op" id="3689963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3689967">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3690054">for</span>&nbsp;<span class="builtinfunc" id="3690058">len</span><span class="op" id="3690061">(</span><span class="ident" id="3690062">q</span><span class="op" id="3690063">)</span>&nbsp;<span class="op" id="3690065">&gt;</span>&nbsp;<span class="num" id="3690067">0</span>&nbsp;<span class="op" id="3690069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690074">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690123">q</span><span class="op" id="3690124">,</span>&nbsp;<span class="ident" id="3690126">r</span>&nbsp;<span class="op" id="3690128">=</span>&nbsp;<span class="ident" id="3690130">q</span><span class="op" id="3690131">.</span><span class="ident" id="3690132">divW</span><span class="op" id="3690136">(</span><span class="ident" id="3690137">q</span><span class="op" id="3690138">,</span>&nbsp;<span class="ident" id="3690140">bb</span><span class="op" id="3690142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3690147">for</span>&nbsp;<span class="ident" id="3690151">j</span>&nbsp;<span class="op" id="3690153">:=</span>&nbsp;<span class="num" id="3690156">0</span><span class="op" id="3690157">;</span>&nbsp;<span class="ident" id="3690159">j</span>&nbsp;<span class="op" id="3690161">&lt;</span>&nbsp;<span class="ident" id="3690163">ndigits</span>&nbsp;<span class="op" id="3690171">&amp;&amp;</span>&nbsp;<span class="ident" id="3690174">i</span>&nbsp;<span class="op" id="3690176">&gt;</span>&nbsp;<span class="num" id="3690178">0</span><span class="op" id="3690179">;</span>&nbsp;<span class="ident" id="3690181">j</span><span class="op" id="3690182">++</span>&nbsp;<span class="op" id="3690185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690191">i</span><span class="op" id="3690192">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690199">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690258">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690322">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690384">t</span>&nbsp;<span class="op" id="3690386">:=</span>&nbsp;<span class="ident" id="3690389">r</span>&nbsp;<span class="op" id="3690391">/</span>&nbsp;<span class="num" id="3690393">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690400">s</span><span class="op" id="3690401">[</span><span class="ident" id="3690402">i</span><span class="op" id="3690403">]</span>&nbsp;<span class="op" id="3690405">=</span>&nbsp;<span class="ident" id="3690407">charset</span><span class="op" id="3690414">[</span><span class="ident" id="3690415">r</span><span class="op" id="3690416">-</span><span class="ident" id="3690417">t</span><span class="op" id="3690418">&lt;&lt;</span><span class="num" id="3690420">3</span><span class="op" id="3690421">-</span><span class="ident" id="3690422">t</span><span class="op" id="3690423">-</span><span class="ident" id="3690424">t</span><span class="op" id="3690425">]</span>&nbsp;<span class="comment" id="3690427">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690495">r</span>&nbsp;<span class="op" id="3690497">=</span>&nbsp;<span class="ident" id="3690499">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690504">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690511">}</span>&nbsp;<span class="keyword" id="3690513">else</span>&nbsp;<span class="op" id="3690518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3690522">for</span>&nbsp;<span class="builtinfunc" id="3690526">len</span><span class="op" id="3690529">(</span><span class="ident" id="3690530">q</span><span class="op" id="3690531">)</span>&nbsp;<span class="op" id="3690533">&gt;</span>&nbsp;<span class="num" id="3690535">0</span>&nbsp;<span class="op" id="3690537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690542">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690591">q</span><span class="op" id="3690592">,</span>&nbsp;<span class="ident" id="3690594">r</span>&nbsp;<span class="op" id="3690596">=</span>&nbsp;<span class="ident" id="3690598">q</span><span class="op" id="3690599">.</span><span class="ident" id="3690600">divW</span><span class="op" id="3690604">(</span><span class="ident" id="3690605">q</span><span class="op" id="3690606">,</span>&nbsp;<span class="ident" id="3690608">bb</span><span class="op" id="3690610">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3690615">for</span>&nbsp;<span class="ident" id="3690619">j</span>&nbsp;<span class="op" id="3690621">:=</span>&nbsp;<span class="num" id="3690624">0</span><span class="op" id="3690625">;</span>&nbsp;<span class="ident" id="3690627">j</span>&nbsp;<span class="op" id="3690629">&lt;</span>&nbsp;<span class="ident" id="3690631">ndigits</span>&nbsp;<span class="op" id="3690639">&amp;&amp;</span>&nbsp;<span class="ident" id="3690642">i</span>&nbsp;<span class="op" id="3690644">&gt;</span>&nbsp;<span class="num" id="3690646">0</span><span class="op" id="3690647">;</span>&nbsp;<span class="ident" id="3690649">j</span><span class="op" id="3690650">++</span>&nbsp;<span class="op" id="3690653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690659">i</span><span class="op" id="3690660">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690667">s</span><span class="op" id="3690668">[</span><span class="ident" id="3690669">i</span><span class="op" id="3690670">]</span>&nbsp;<span class="op" id="3690672">=</span>&nbsp;<span class="ident" id="3690674">charset</span><span class="op" id="3690681">[</span><span class="ident" id="3690682">r</span><span class="op" id="3690683">%</span><span class="ident" id="3690684">b</span><span class="op" id="3690685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690691">r</span>&nbsp;<span class="op" id="3690693">/=</span>&nbsp;<span class="ident" id="3690696">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690701">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3690712">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690742">zero</span>&nbsp;<span class="op" id="3690747">:=</span>&nbsp;<span class="ident" id="3690750">charset</span><span class="op" id="3690757">[</span><span class="num" id="3690758">0</span><span class="op" id="3690759">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3690762">for</span>&nbsp;<span class="ident" id="3690766">i</span>&nbsp;<span class="op" id="3690768">&gt;</span>&nbsp;<span class="num" id="3690770">0</span>&nbsp;<span class="op" id="3690772">{</span>&nbsp;<span class="comment" id="3690774">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690810">i</span><span class="op" id="3690811">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3690816">s</span><span class="op" id="3690817">[</span><span class="ident" id="3690818">i</span><span class="op" id="3690819">]</span>&nbsp;<span class="op" id="3690821">=</span>&nbsp;<span class="ident" id="3690823">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3690829">}</span><br>
<span class="lineno"></span><span class="op" id="3690831">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3690834">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3690924">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3690989">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3691069">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3691129">var</span>&nbsp;<span class="ident" id="3691133">leafSize</span>&nbsp;<span class="builtintype" id="3691142">int</span>&nbsp;<span class="op" id="3691146">=</span>&nbsp;<span class="num" id="3691148">8</span>&nbsp;<span class="comment" id="3691150">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3691216">type</span>&nbsp;<span class="ident" id="3691221">divisor</span>&nbsp;<span class="keyword" id="3691229">struct</span>&nbsp;<span class="op" id="3691236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691239">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691247">nat</span>&nbsp;<span class="comment" id="3691251">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691263">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3691271">int</span>&nbsp;<span class="comment" id="3691275">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691343">ndigits</span>&nbsp;<span class="builtintype" id="3691351">int</span>&nbsp;<span class="comment" id="3691355">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3691413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3691416">var</span>&nbsp;<span class="ident" id="3691420">cacheBase10</span>&nbsp;<span class="keyword" id="3691432">struct</span>&nbsp;<span class="op" id="3691439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691442">sync</span><span class="op" id="3691446">.</span><span class="ident" id="3691447">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691454">table</span>&nbsp;<span class="op" id="3691460">[</span><span class="num" id="3691461">64</span><span class="op" id="3691463">]</span><span class="ident" id="3691464">divisor</span>&nbsp;<span class="comment" id="3691472">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3691503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3691506">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3691529">func</span>&nbsp;<span class="op" id="3691534">(</span><span class="ident" id="3691535">z</span>&nbsp;<span class="ident" id="3691537">nat</span><span class="op" id="3691540">)</span>&nbsp;<span class="ident" id="3691542">expWW</span><span class="op" id="3691547">(</span><span class="ident" id="3691548">x</span><span class="op" id="3691549">,</span>&nbsp;<span class="ident" id="3691551">y</span>&nbsp;<span class="ident" id="3691553">Word</span><span class="op" id="3691557">)</span>&nbsp;<span class="ident" id="3691559">nat</span>&nbsp;<span class="op" id="3691563">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3691566">return</span>&nbsp;<span class="ident" id="3691573">z</span><span class="op" id="3691574">.</span><span class="ident" id="3691575">expNN</span><span class="op" id="3691580">(</span><span class="ident" id="3691581">nat</span><span class="op" id="3691584">(</span><span class="ident" id="3691585">nil</span><span class="op" id="3691588">)</span><span class="op" id="3691589">.</span><span class="ident" id="3691590">setWord</span><span class="op" id="3691597">(</span><span class="ident" id="3691598">x</span><span class="op" id="3691599">)</span><span class="op" id="3691600">,</span>&nbsp;<span class="ident" id="3691602">nat</span><span class="op" id="3691605">(</span><span class="ident" id="3691606">nil</span><span class="op" id="3691609">)</span><span class="op" id="3691610">.</span><span class="ident" id="3691611">setWord</span><span class="op" id="3691618">(</span><span class="ident" id="3691619">y</span><span class="op" id="3691620">)</span><span class="op" id="3691621">,</span>&nbsp;<span class="ident" id="3691623">nil</span><span class="op" id="3691626">)</span><br>
<span class="lineno"></span><span class="op" id="3691628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3691631">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3691698">func</span>&nbsp;<span class="ident" id="3691703">divisors</span><span class="op" id="3691711">(</span><span class="ident" id="3691712">m</span>&nbsp;<span class="builtintype" id="3691714">int</span><span class="op" id="3691717">,</span>&nbsp;<span class="ident" id="3691719">b</span>&nbsp;<span class="ident" id="3691721">Word</span><span class="op" id="3691725">,</span>&nbsp;<span class="ident" id="3691727">ndigits</span>&nbsp;<span class="builtintype" id="3691735">int</span><span class="op" id="3691738">,</span>&nbsp;<span class="ident" id="3691740">bb</span>&nbsp;<span class="ident" id="3691743">Word</span><span class="op" id="3691747">)</span>&nbsp;<span class="op" id="3691749">[</span><span class="op" id="3691750">]</span><span class="ident" id="3691751">divisor</span>&nbsp;<span class="op" id="3691759">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3691762">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3691837">if</span>&nbsp;<span class="ident" id="3691840">leafSize</span>&nbsp;<span class="op" id="3691849">==</span>&nbsp;<span class="num" id="3691852">0</span>&nbsp;<span class="op" id="3691854">||</span>&nbsp;<span class="ident" id="3691857">m</span>&nbsp;<span class="op" id="3691859">&lt;=</span>&nbsp;<span class="ident" id="3691862">leafSize</span>&nbsp;<span class="op" id="3691871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3691875">return</span>&nbsp;<span class="ident" id="3691882">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3691887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3691891">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3691947">k</span>&nbsp;<span class="op" id="3691949">:=</span>&nbsp;<span class="num" id="3691952">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3691955">for</span>&nbsp;<span class="ident" id="3691959">words</span>&nbsp;<span class="op" id="3691965">:=</span>&nbsp;<span class="ident" id="3691968">leafSize</span><span class="op" id="3691976">;</span>&nbsp;<span class="ident" id="3691978">words</span>&nbsp;<span class="op" id="3691984">&lt;</span>&nbsp;<span class="ident" id="3691986">m</span><span class="op" id="3691987">&gt;&gt;</span><span class="num" id="3691989">1</span>&nbsp;<span class="op" id="3691991">&amp;&amp;</span>&nbsp;<span class="ident" id="3691994">k</span>&nbsp;<span class="op" id="3691996">&lt;</span>&nbsp;<span class="builtinfunc" id="3691998">len</span><span class="op" id="3692001">(</span><span class="ident" id="3692002">cacheBase10</span><span class="op" id="3692013">.</span><span class="ident" id="3692014">table</span><span class="op" id="3692019">)</span><span class="op" id="3692020">;</span>&nbsp;<span class="ident" id="3692022">words</span>&nbsp;<span class="op" id="3692028">&lt;&lt;=</span>&nbsp;<span class="num" id="3692032">1</span>&nbsp;<span class="op" id="3692034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692038">k</span><span class="op" id="3692039">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3692043">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3692047">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692130">var</span>&nbsp;<span class="ident" id="3692134">table</span>&nbsp;<span class="op" id="3692140">[</span><span class="op" id="3692141">]</span><span class="ident" id="3692142">divisor</span>&nbsp;<span class="comment" id="3692150">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692205">if</span>&nbsp;<span class="ident" id="3692208">b</span>&nbsp;<span class="op" id="3692210">==</span>&nbsp;<span class="num" id="3692213">10</span>&nbsp;<span class="op" id="3692216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692220">cacheBase10</span><span class="op" id="3692231">.</span><span class="ident" id="3692232">Lock</span><span class="op" id="3692236">(</span><span class="op" id="3692237">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692241">table</span>&nbsp;<span class="op" id="3692247">=</span>&nbsp;<span class="ident" id="3692249">cacheBase10</span><span class="op" id="3692260">.</span><span class="ident" id="3692261">table</span><span class="op" id="3692266">[</span><span class="num" id="3692267">0</span><span class="op" id="3692268">:</span><span class="ident" id="3692269">k</span><span class="op" id="3692270">]</span>&nbsp;<span class="comment" id="3692272">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3692312">}</span>&nbsp;<span class="keyword" id="3692314">else</span>&nbsp;<span class="op" id="3692319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692323">table</span>&nbsp;<span class="op" id="3692329">=</span>&nbsp;<span class="builtinfunc" id="3692331">make</span><span class="op" id="3692335">(</span><span class="op" id="3692336">[</span><span class="op" id="3692337">]</span><span class="ident" id="3692338">divisor</span><span class="op" id="3692345">,</span>&nbsp;<span class="ident" id="3692347">k</span><span class="op" id="3692348">)</span>&nbsp;<span class="comment" id="3692350">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3692391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3692395">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692412">if</span>&nbsp;<span class="ident" id="3692415">table</span><span class="op" id="3692420">[</span><span class="ident" id="3692421">k</span><span class="op" id="3692422">-</span><span class="num" id="3692423">1</span><span class="op" id="3692424">]</span><span class="op" id="3692425">.</span><span class="ident" id="3692426">ndigits</span>&nbsp;<span class="op" id="3692434">==</span>&nbsp;<span class="num" id="3692437">0</span>&nbsp;<span class="op" id="3692439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3692443">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692474">var</span>&nbsp;<span class="ident" id="3692478">larger</span>&nbsp;<span class="ident" id="3692485">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692491">for</span>&nbsp;<span class="ident" id="3692495">i</span>&nbsp;<span class="op" id="3692497">:=</span>&nbsp;<span class="num" id="3692500">0</span><span class="op" id="3692501">;</span>&nbsp;<span class="ident" id="3692503">i</span>&nbsp;<span class="op" id="3692505">&lt;</span>&nbsp;<span class="ident" id="3692507">k</span><span class="op" id="3692508">;</span>&nbsp;<span class="ident" id="3692510">i</span><span class="op" id="3692511">++</span>&nbsp;<span class="op" id="3692514">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692519">if</span>&nbsp;<span class="ident" id="3692522">table</span><span class="op" id="3692527">[</span><span class="ident" id="3692528">i</span><span class="op" id="3692529">]</span><span class="op" id="3692530">.</span><span class="ident" id="3692531">ndigits</span>&nbsp;<span class="op" id="3692539">==</span>&nbsp;<span class="num" id="3692542">0</span>&nbsp;<span class="op" id="3692544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692550">if</span>&nbsp;<span class="ident" id="3692553">i</span>&nbsp;<span class="op" id="3692555">==</span>&nbsp;<span class="num" id="3692558">0</span>&nbsp;<span class="op" id="3692560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692567">table</span><span class="op" id="3692572">[</span><span class="num" id="3692573">0</span><span class="op" id="3692574">]</span><span class="op" id="3692575">.</span><span class="ident" id="3692576">bbb</span>&nbsp;<span class="op" id="3692580">=</span>&nbsp;<span class="ident" id="3692582">nat</span><span class="op" id="3692585">(</span><span class="ident" id="3692586">nil</span><span class="op" id="3692589">)</span><span class="op" id="3692590">.</span><span class="ident" id="3692591">expWW</span><span class="op" id="3692596">(</span><span class="ident" id="3692597">bb</span><span class="op" id="3692599">,</span>&nbsp;<span class="ident" id="3692601">Word</span><span class="op" id="3692605">(</span><span class="ident" id="3692606">leafSize</span><span class="op" id="3692614">)</span><span class="op" id="3692615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692622">table</span><span class="op" id="3692627">[</span><span class="num" id="3692628">0</span><span class="op" id="3692629">]</span><span class="op" id="3692630">.</span><span class="ident" id="3692631">ndigits</span>&nbsp;<span class="op" id="3692639">=</span>&nbsp;<span class="ident" id="3692641">ndigits</span>&nbsp;<span class="op" id="3692649">*</span>&nbsp;<span class="ident" id="3692651">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3692664">}</span>&nbsp;<span class="keyword" id="3692666">else</span>&nbsp;<span class="op" id="3692671">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692678">table</span><span class="op" id="3692683">[</span><span class="ident" id="3692684">i</span><span class="op" id="3692685">]</span><span class="op" id="3692686">.</span><span class="ident" id="3692687">bbb</span>&nbsp;<span class="op" id="3692691">=</span>&nbsp;<span class="ident" id="3692693">nat</span><span class="op" id="3692696">(</span><span class="ident" id="3692697">nil</span><span class="op" id="3692700">)</span><span class="op" id="3692701">.</span><span class="ident" id="3692702">mul</span><span class="op" id="3692705">(</span><span class="ident" id="3692706">table</span><span class="op" id="3692711">[</span><span class="ident" id="3692712">i</span><span class="op" id="3692713">-</span><span class="num" id="3692714">1</span><span class="op" id="3692715">]</span><span class="op" id="3692716">.</span><span class="ident" id="3692717">bbb</span><span class="op" id="3692720">,</span>&nbsp;<span class="ident" id="3692722">table</span><span class="op" id="3692727">[</span><span class="ident" id="3692728">i</span><span class="op" id="3692729">-</span><span class="num" id="3692730">1</span><span class="op" id="3692731">]</span><span class="op" id="3692732">.</span><span class="ident" id="3692733">bbb</span><span class="op" id="3692736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692743">table</span><span class="op" id="3692748">[</span><span class="ident" id="3692749">i</span><span class="op" id="3692750">]</span><span class="op" id="3692751">.</span><span class="ident" id="3692752">ndigits</span>&nbsp;<span class="op" id="3692760">=</span>&nbsp;<span class="num" id="3692762">2</span>&nbsp;<span class="op" id="3692764">*</span>&nbsp;<span class="ident" id="3692766">table</span><span class="op" id="3692771">[</span><span class="ident" id="3692772">i</span><span class="op" id="3692773">-</span><span class="num" id="3692774">1</span><span class="op" id="3692775">]</span><span class="op" id="3692776">.</span><span class="ident" id="3692777">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3692789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3692796">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692863">larger</span>&nbsp;<span class="op" id="3692870">=</span>&nbsp;<span class="ident" id="3692872">nat</span><span class="op" id="3692875">(</span><span class="ident" id="3692876">nil</span><span class="op" id="3692879">)</span><span class="op" id="3692880">.</span><span class="ident" id="3692881">set</span><span class="op" id="3692884">(</span><span class="ident" id="3692885">table</span><span class="op" id="3692890">[</span><span class="ident" id="3692891">i</span><span class="op" id="3692892">]</span><span class="op" id="3692893">.</span><span class="ident" id="3692894">bbb</span><span class="op" id="3692897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3692903">for</span>&nbsp;<span class="ident" id="3692907">mulAddVWW</span><span class="op" id="3692916">(</span><span class="ident" id="3692917">larger</span><span class="op" id="3692923">,</span>&nbsp;<span class="ident" id="3692925">larger</span><span class="op" id="3692931">,</span>&nbsp;<span class="ident" id="3692933">b</span><span class="op" id="3692934">,</span>&nbsp;<span class="num" id="3692936">0</span><span class="op" id="3692937">)</span>&nbsp;<span class="op" id="3692939">==</span>&nbsp;<span class="num" id="3692942">0</span>&nbsp;<span class="op" id="3692944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692951">table</span><span class="op" id="3692956">[</span><span class="ident" id="3692957">i</span><span class="op" id="3692958">]</span><span class="op" id="3692959">.</span><span class="ident" id="3692960">bbb</span>&nbsp;<span class="op" id="3692964">=</span>&nbsp;<span class="ident" id="3692966">table</span><span class="op" id="3692971">[</span><span class="ident" id="3692972">i</span><span class="op" id="3692973">]</span><span class="op" id="3692974">.</span><span class="ident" id="3692975">bbb</span><span class="op" id="3692978">.</span><span class="ident" id="3692979">set</span><span class="op" id="3692982">(</span><span class="ident" id="3692983">larger</span><span class="op" id="3692989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3692996">table</span><span class="op" id="3693001">[</span><span class="ident" id="3693002">i</span><span class="op" id="3693003">]</span><span class="op" id="3693004">.</span><span class="ident" id="3693005">ndigits</span><span class="op" id="3693012">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3693019">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3693026">table</span><span class="op" id="3693031">[</span><span class="ident" id="3693032">i</span><span class="op" id="3693033">]</span><span class="op" id="3693034">.</span><span class="ident" id="3693035">nbits</span>&nbsp;<span class="op" id="3693041">=</span>&nbsp;<span class="ident" id="3693043">table</span><span class="op" id="3693048">[</span><span class="ident" id="3693049">i</span><span class="op" id="3693050">]</span><span class="op" id="3693051">.</span><span class="ident" id="3693052">bbb</span><span class="op" id="3693055">.</span><span class="ident" id="3693056">bitLen</span><span class="op" id="3693062">(</span><span class="op" id="3693063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3693068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3693072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3693075">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3693079">if</span>&nbsp;<span class="ident" id="3693082">b</span>&nbsp;<span class="op" id="3693084">==</span>&nbsp;<span class="num" id="3693087">10</span>&nbsp;<span class="op" id="3693090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3693094">cacheBase10</span><span class="op" id="3693105">.</span><span class="ident" id="3693106">Unlock</span><span class="op" id="3693112">(</span><span class="op" id="3693113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3693116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3693120">return</span>&nbsp;<span class="ident" id="3693127">table</span><br>
<span class="lineno"></span><span class="op" id="3693133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3693136">const</span>&nbsp;<span class="ident" id="3693142">deBruijn32</span>&nbsp;<span class="op" id="3693153">=</span>&nbsp;<span class="num" id="3693155">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3693167">var</span>&nbsp;<span class="ident" id="3693171">deBruijn32Lookup</span>&nbsp;<span class="op" id="3693188">=</span>&nbsp;<span class="op" id="3693190">[</span><span class="op" id="3693191">]</span><span class="builtintype" id="3693192">byte</span><span class="op" id="3693196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693199">0</span><span class="op" id="3693200">,</span>&nbsp;<span class="num" id="3693202">1</span><span class="op" id="3693203">,</span>&nbsp;<span class="num" id="3693205">28</span><span class="op" id="3693207">,</span>&nbsp;<span class="num" id="3693209">2</span><span class="op" id="3693210">,</span>&nbsp;<span class="num" id="3693212">29</span><span class="op" id="3693214">,</span>&nbsp;<span class="num" id="3693216">14</span><span class="op" id="3693218">,</span>&nbsp;<span class="num" id="3693220">24</span><span class="op" id="3693222">,</span>&nbsp;<span class="num" id="3693224">3</span><span class="op" id="3693225">,</span>&nbsp;<span class="num" id="3693227">30</span><span class="op" id="3693229">,</span>&nbsp;<span class="num" id="3693231">22</span><span class="op" id="3693233">,</span>&nbsp;<span class="num" id="3693235">20</span><span class="op" id="3693237">,</span>&nbsp;<span class="num" id="3693239">15</span><span class="op" id="3693241">,</span>&nbsp;<span class="num" id="3693243">25</span><span class="op" id="3693245">,</span>&nbsp;<span class="num" id="3693247">17</span><span class="op" id="3693249">,</span>&nbsp;<span class="num" id="3693251">4</span><span class="op" id="3693252">,</span>&nbsp;<span class="num" id="3693254">8</span><span class="op" id="3693255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693258">31</span><span class="op" id="3693260">,</span>&nbsp;<span class="num" id="3693262">27</span><span class="op" id="3693264">,</span>&nbsp;<span class="num" id="3693266">13</span><span class="op" id="3693268">,</span>&nbsp;<span class="num" id="3693270">23</span><span class="op" id="3693272">,</span>&nbsp;<span class="num" id="3693274">21</span><span class="op" id="3693276">,</span>&nbsp;<span class="num" id="3693278">19</span><span class="op" id="3693280">,</span>&nbsp;<span class="num" id="3693282">16</span><span class="op" id="3693284">,</span>&nbsp;<span class="num" id="3693286">7</span><span class="op" id="3693287">,</span>&nbsp;<span class="num" id="3693289">26</span><span class="op" id="3693291">,</span>&nbsp;<span class="num" id="3693293">12</span><span class="op" id="3693295">,</span>&nbsp;<span class="num" id="3693297">18</span><span class="op" id="3693299">,</span>&nbsp;<span class="num" id="3693301">6</span><span class="op" id="3693302">,</span>&nbsp;<span class="num" id="3693304">11</span><span class="op" id="3693306">,</span>&nbsp;<span class="num" id="3693308">5</span><span class="op" id="3693309">,</span>&nbsp;<span class="num" id="3693311">10</span><span class="op" id="3693313">,</span>&nbsp;<span class="num" id="3693315">9</span><span class="op" id="3693316">,</span><br>
<span class="lineno"></span><span class="op" id="3693318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3693321">const</span>&nbsp;<span class="ident" id="3693327">deBruijn64</span>&nbsp;<span class="op" id="3693338">=</span>&nbsp;<span class="num" id="3693340">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3693360">var</span>&nbsp;<span class="ident" id="3693364">deBruijn64Lookup</span>&nbsp;<span class="op" id="3693381">=</span>&nbsp;<span class="op" id="3693383">[</span><span class="op" id="3693384">]</span><span class="builtintype" id="3693385">byte</span><span class="op" id="3693389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693392">0</span><span class="op" id="3693393">,</span>&nbsp;<span class="num" id="3693395">1</span><span class="op" id="3693396">,</span>&nbsp;<span class="num" id="3693398">56</span><span class="op" id="3693400">,</span>&nbsp;<span class="num" id="3693402">2</span><span class="op" id="3693403">,</span>&nbsp;<span class="num" id="3693405">57</span><span class="op" id="3693407">,</span>&nbsp;<span class="num" id="3693409">49</span><span class="op" id="3693411">,</span>&nbsp;<span class="num" id="3693413">28</span><span class="op" id="3693415">,</span>&nbsp;<span class="num" id="3693417">3</span><span class="op" id="3693418">,</span>&nbsp;<span class="num" id="3693420">61</span><span class="op" id="3693422">,</span>&nbsp;<span class="num" id="3693424">58</span><span class="op" id="3693426">,</span>&nbsp;<span class="num" id="3693428">42</span><span class="op" id="3693430">,</span>&nbsp;<span class="num" id="3693432">50</span><span class="op" id="3693434">,</span>&nbsp;<span class="num" id="3693436">38</span><span class="op" id="3693438">,</span>&nbsp;<span class="num" id="3693440">29</span><span class="op" id="3693442">,</span>&nbsp;<span class="num" id="3693444">17</span><span class="op" id="3693446">,</span>&nbsp;<span class="num" id="3693448">4</span><span class="op" id="3693449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693452">62</span><span class="op" id="3693454">,</span>&nbsp;<span class="num" id="3693456">47</span><span class="op" id="3693458">,</span>&nbsp;<span class="num" id="3693460">59</span><span class="op" id="3693462">,</span>&nbsp;<span class="num" id="3693464">36</span><span class="op" id="3693466">,</span>&nbsp;<span class="num" id="3693468">45</span><span class="op" id="3693470">,</span>&nbsp;<span class="num" id="3693472">43</span><span class="op" id="3693474">,</span>&nbsp;<span class="num" id="3693476">51</span><span class="op" id="3693478">,</span>&nbsp;<span class="num" id="3693480">22</span><span class="op" id="3693482">,</span>&nbsp;<span class="num" id="3693484">53</span><span class="op" id="3693486">,</span>&nbsp;<span class="num" id="3693488">39</span><span class="op" id="3693490">,</span>&nbsp;<span class="num" id="3693492">33</span><span class="op" id="3693494">,</span>&nbsp;<span class="num" id="3693496">30</span><span class="op" id="3693498">,</span>&nbsp;<span class="num" id="3693500">24</span><span class="op" id="3693502">,</span>&nbsp;<span class="num" id="3693504">18</span><span class="op" id="3693506">,</span>&nbsp;<span class="num" id="3693508">12</span><span class="op" id="3693510">,</span>&nbsp;<span class="num" id="3693512">5</span><span class="op" id="3693513">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693516">63</span><span class="op" id="3693518">,</span>&nbsp;<span class="num" id="3693520">55</span><span class="op" id="3693522">,</span>&nbsp;<span class="num" id="3693524">48</span><span class="op" id="3693526">,</span>&nbsp;<span class="num" id="3693528">27</span><span class="op" id="3693530">,</span>&nbsp;<span class="num" id="3693532">60</span><span class="op" id="3693534">,</span>&nbsp;<span class="num" id="3693536">41</span><span class="op" id="3693538">,</span>&nbsp;<span class="num" id="3693540">37</span><span class="op" id="3693542">,</span>&nbsp;<span class="num" id="3693544">16</span><span class="op" id="3693546">,</span>&nbsp;<span class="num" id="3693548">46</span><span class="op" id="3693550">,</span>&nbsp;<span class="num" id="3693552">35</span><span class="op" id="3693554">,</span>&nbsp;<span class="num" id="3693556">44</span><span class="op" id="3693558">,</span>&nbsp;<span class="num" id="3693560">21</span><span class="op" id="3693562">,</span>&nbsp;<span class="num" id="3693564">52</span><span class="op" id="3693566">,</span>&nbsp;<span class="num" id="3693568">32</span><span class="op" id="3693570">,</span>&nbsp;<span class="num" id="3693572">23</span><span class="op" id="3693574">,</span>&nbsp;<span class="num" id="3693576">11</span><span class="op" id="3693578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3693581">54</span><span class="op" id="3693583">,</span>&nbsp;<span class="num" id="3693585">26</span><span class="op" id="3693587">,</span>&nbsp;<span class="num" id="3693589">40</span><span class="op" id="3693591">,</span>&nbsp;<span class="num" id="3693593">15</span><span class="op" id="3693595">,</span>&nbsp;<span class="num" id="3693597">34</span><span class="op" id="3693599">,</span>&nbsp;<span class="num" id="3693601">20</span><span class="op" id="3693603">,</span>&nbsp;<span class="num" id="3693605">31</span><span class="op" id="3693607">,</span>&nbsp;<span class="num" id="3693609">10</span><span class="op" id="3693611">,</span>&nbsp;<span class="num" id="3693613">25</span><span class="op" id="3693615">,</span>&nbsp;<span class="num" id="3693617">14</span><span class="op" id="3693619">,</span>&nbsp;<span class="num" id="3693621">19</span><span class="op" id="3693623">,</span>&nbsp;<span class="num" id="3693625">9</span><span class="op" id="3693626">,</span>&nbsp;<span class="num" id="3693628">13</span><span class="op" id="3693630">,</span>&nbsp;<span class="num" id="3693632">8</span><span class="op" id="3693633">,</span>&nbsp;<span class="num" id="3693635">7</span><span class="op" id="3693636">,</span>&nbsp;<span class="num" id="3693638">6</span><span class="op" id="3693639">,</span><br>
<span class="lineno"></span><span class="op" id="3693641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3693644">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3693721">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3693735">func</span>&nbsp;<span class="ident" id="3693740">trailingZeroBits</span><span class="op" id="3693756">(</span><span class="ident" id="3693757">x</span>&nbsp;<span class="ident" id="3693759">Word</span><span class="op" id="3693763">)</span>&nbsp;<span class="builtintype" id="3693765">uint</span>&nbsp;<span class="op" id="3693770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3693773">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3693845">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3693917">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3693987">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694057">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694121">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694194">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694263">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694310">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694347">switch</span>&nbsp;<span class="ident" id="3694354">_W</span>&nbsp;<span class="op" id="3694357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694360">case</span>&nbsp;<span class="num" id="3694365">32</span><span class="op" id="3694367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694371">return</span>&nbsp;<span class="builtintype" id="3694378">uint</span><span class="op" id="3694382">(</span><span class="ident" id="3694383">deBruijn32Lookup</span><span class="op" id="3694399">[</span><span class="op" id="3694400">(</span><span class="op" id="3694401">(</span><span class="ident" id="3694402">x</span><span class="op" id="3694403">&amp;</span><span class="op" id="3694404">-</span><span class="ident" id="3694405">x</span><span class="op" id="3694406">)</span><span class="op" id="3694407">*</span><span class="ident" id="3694408">deBruijn32</span><span class="op" id="3694418">)</span><span class="op" id="3694419">&gt;&gt;</span><span class="num" id="3694421">27</span><span class="op" id="3694423">]</span><span class="op" id="3694424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694427">case</span>&nbsp;<span class="num" id="3694432">64</span><span class="op" id="3694434">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694438">return</span>&nbsp;<span class="builtintype" id="3694445">uint</span><span class="op" id="3694449">(</span><span class="ident" id="3694450">deBruijn64Lookup</span><span class="op" id="3694466">[</span><span class="op" id="3694467">(</span><span class="op" id="3694468">(</span><span class="ident" id="3694469">x</span><span class="op" id="3694470">&amp;</span><span class="op" id="3694471">-</span><span class="ident" id="3694472">x</span><span class="op" id="3694473">)</span><span class="op" id="3694474">*</span><span class="op" id="3694475">(</span><span class="ident" id="3694476">deBruijn64</span><span class="op" id="3694486">&amp;</span><span class="ident" id="3694487">_M</span><span class="op" id="3694489">)</span><span class="op" id="3694490">)</span><span class="op" id="3694491">&gt;&gt;</span><span class="num" id="3694493">58</span><span class="op" id="3694495">]</span><span class="op" id="3694496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694499">default</span><span class="op" id="3694506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3694510">panic</span><span class="op" id="3694515">(</span><span class="string" id="3694516">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3694535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3694538">}</span><br>
<span class="lineno"></span><span class="op" id="3694540">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3694543">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3694620">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3694634">func</span>&nbsp;<span class="op" id="3694639">(</span><span class="ident" id="3694640">x</span>&nbsp;<span class="ident" id="3694642">nat</span><span class="op" id="3694645">)</span>&nbsp;<span class="ident" id="3694647">trailingZeroBits</span><span class="op" id="3694663">(</span><span class="op" id="3694664">)</span>&nbsp;<span class="builtintype" id="3694666">uint</span>&nbsp;<span class="op" id="3694671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694674">if</span>&nbsp;<span class="builtinfunc" id="3694677">len</span><span class="op" id="3694680">(</span><span class="ident" id="3694681">x</span><span class="op" id="3694682">)</span>&nbsp;<span class="op" id="3694684">==</span>&nbsp;<span class="num" id="3694687">0</span>&nbsp;<span class="op" id="3694689">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694693">return</span>&nbsp;<span class="num" id="3694700">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3694703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694706">var</span>&nbsp;<span class="ident" id="3694710">i</span>&nbsp;<span class="builtintype" id="3694712">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694718">for</span>&nbsp;<span class="ident" id="3694722">x</span><span class="op" id="3694723">[</span><span class="ident" id="3694724">i</span><span class="op" id="3694725">]</span>&nbsp;<span class="op" id="3694727">==</span>&nbsp;<span class="num" id="3694730">0</span>&nbsp;<span class="op" id="3694732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694736">i</span><span class="op" id="3694737">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3694741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694744">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694758">return</span>&nbsp;<span class="ident" id="3694765">i</span><span class="op" id="3694766">*</span><span class="ident" id="3694767">_W</span>&nbsp;<span class="op" id="3694770">+</span>&nbsp;<span class="ident" id="3694772">trailingZeroBits</span><span class="op" id="3694788">(</span><span class="ident" id="3694789">x</span><span class="op" id="3694790">[</span><span class="ident" id="3694791">i</span><span class="op" id="3694792">]</span><span class="op" id="3694793">)</span><br>
<span class="lineno"></span><span class="op" id="3694795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3694798">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3694812">func</span>&nbsp;<span class="op" id="3694817">(</span><span class="ident" id="3694818">z</span>&nbsp;<span class="ident" id="3694820">nat</span><span class="op" id="3694823">)</span>&nbsp;<span class="ident" id="3694825">shl</span><span class="op" id="3694828">(</span><span class="ident" id="3694829">x</span>&nbsp;<span class="ident" id="3694831">nat</span><span class="op" id="3694834">,</span>&nbsp;<span class="ident" id="3694836">s</span>&nbsp;<span class="builtintype" id="3694838">uint</span><span class="op" id="3694842">)</span>&nbsp;<span class="ident" id="3694844">nat</span>&nbsp;<span class="op" id="3694848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694851">m</span>&nbsp;<span class="op" id="3694853">:=</span>&nbsp;<span class="builtinfunc" id="3694856">len</span><span class="op" id="3694859">(</span><span class="ident" id="3694860">x</span><span class="op" id="3694861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694864">if</span>&nbsp;<span class="ident" id="3694867">m</span>&nbsp;<span class="op" id="3694869">==</span>&nbsp;<span class="num" id="3694872">0</span>&nbsp;<span class="op" id="3694874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694878">return</span>&nbsp;<span class="ident" id="3694885">z</span><span class="op" id="3694886">.</span><span class="builtinfunc" id="3694887">make</span><span class="op" id="3694891">(</span><span class="num" id="3694892">0</span><span class="op" id="3694893">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3694896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3694899">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694910">n</span>&nbsp;<span class="op" id="3694912">:=</span>&nbsp;<span class="ident" id="3694915">m</span>&nbsp;<span class="op" id="3694917">+</span>&nbsp;<span class="builtintype" id="3694919">int</span><span class="op" id="3694922">(</span><span class="ident" id="3694923">s</span><span class="op" id="3694924">/</span><span class="ident" id="3694925">_W</span><span class="op" id="3694927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694930">z</span>&nbsp;<span class="op" id="3694932">=</span>&nbsp;<span class="ident" id="3694934">z</span><span class="op" id="3694935">.</span><span class="builtinfunc" id="3694936">make</span><span class="op" id="3694940">(</span><span class="ident" id="3694941">n</span>&nbsp;<span class="op" id="3694943">+</span>&nbsp;<span class="num" id="3694945">1</span><span class="op" id="3694946">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694949">z</span><span class="op" id="3694950">[</span><span class="ident" id="3694951">n</span><span class="op" id="3694952">]</span>&nbsp;<span class="op" id="3694954">=</span>&nbsp;<span class="ident" id="3694956">shlVU</span><span class="op" id="3694961">(</span><span class="ident" id="3694962">z</span><span class="op" id="3694963">[</span><span class="ident" id="3694964">n</span><span class="op" id="3694965">-</span><span class="ident" id="3694966">m</span><span class="op" id="3694967">:</span><span class="ident" id="3694968">n</span><span class="op" id="3694969">]</span><span class="op" id="3694970">,</span>&nbsp;<span class="ident" id="3694972">x</span><span class="op" id="3694973">,</span>&nbsp;<span class="ident" id="3694975">s</span><span class="op" id="3694976">%</span><span class="ident" id="3694977">_W</span><span class="op" id="3694979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694982">z</span><span class="op" id="3694983">[</span><span class="num" id="3694984">0</span>&nbsp;<span class="op" id="3694986">:</span>&nbsp;<span class="ident" id="3694988">n</span><span class="op" id="3694989">-</span><span class="ident" id="3694990">m</span><span class="op" id="3694991">]</span><span class="op" id="3694992">.</span><span class="ident" id="3694993">clear</span><span class="op" id="3694998">(</span><span class="op" id="3694999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695003">return</span>&nbsp;<span class="ident" id="3695010">z</span><span class="op" id="3695011">.</span><span class="ident" id="3695012">norm</span><span class="op" id="3695016">(</span><span class="op" id="3695017">)</span><br>
<span class="lineno"></span><span class="op" id="3695019">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3695022">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3695036">func</span>&nbsp;<span class="op" id="3695041">(</span><span class="ident" id="3695042">z</span>&nbsp;<span class="ident" id="3695044">nat</span><span class="op" id="3695047">)</span>&nbsp;<span class="ident" id="3695049">shr</span><span class="op" id="3695052">(</span><span class="ident" id="3695053">x</span>&nbsp;<span class="ident" id="3695055">nat</span><span class="op" id="3695058">,</span>&nbsp;<span class="ident" id="3695060">s</span>&nbsp;<span class="builtintype" id="3695062">uint</span><span class="op" id="3695066">)</span>&nbsp;<span class="ident" id="3695068">nat</span>&nbsp;<span class="op" id="3695072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695075">m</span>&nbsp;<span class="op" id="3695077">:=</span>&nbsp;<span class="builtinfunc" id="3695080">len</span><span class="op" id="3695083">(</span><span class="ident" id="3695084">x</span><span class="op" id="3695085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695088">n</span>&nbsp;<span class="op" id="3695090">:=</span>&nbsp;<span class="ident" id="3695093">m</span>&nbsp;<span class="op" id="3695095">-</span>&nbsp;<span class="builtintype" id="3695097">int</span><span class="op" id="3695100">(</span><span class="ident" id="3695101">s</span><span class="op" id="3695102">/</span><span class="ident" id="3695103">_W</span><span class="op" id="3695105">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695108">if</span>&nbsp;<span class="ident" id="3695111">n</span>&nbsp;<span class="op" id="3695113">&lt;=</span>&nbsp;<span class="num" id="3695116">0</span>&nbsp;<span class="op" id="3695118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695122">return</span>&nbsp;<span class="ident" id="3695129">z</span><span class="op" id="3695130">.</span><span class="builtinfunc" id="3695131">make</span><span class="op" id="3695135">(</span><span class="num" id="3695136">0</span><span class="op" id="3695137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695143">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695154">z</span>&nbsp;<span class="op" id="3695156">=</span>&nbsp;<span class="ident" id="3695158">z</span><span class="op" id="3695159">.</span><span class="builtinfunc" id="3695160">make</span><span class="op" id="3695164">(</span><span class="ident" id="3695165">n</span><span class="op" id="3695166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695169">shrVU</span><span class="op" id="3695174">(</span><span class="ident" id="3695175">z</span><span class="op" id="3695176">,</span>&nbsp;<span class="ident" id="3695178">x</span><span class="op" id="3695179">[</span><span class="ident" id="3695180">m</span><span class="op" id="3695181">-</span><span class="ident" id="3695182">n</span><span class="op" id="3695183">:</span><span class="op" id="3695184">]</span><span class="op" id="3695185">,</span>&nbsp;<span class="ident" id="3695187">s</span><span class="op" id="3695188">%</span><span class="ident" id="3695189">_W</span><span class="op" id="3695191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695195">return</span>&nbsp;<span class="ident" id="3695202">z</span><span class="op" id="3695203">.</span><span class="ident" id="3695204">norm</span><span class="op" id="3695208">(</span><span class="op" id="3695209">)</span><br>
<span class="lineno"></span><span class="op" id="3695211">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3695214">func</span>&nbsp;<span class="op" id="3695219">(</span><span class="ident" id="3695220">z</span>&nbsp;<span class="ident" id="3695222">nat</span><span class="op" id="3695225">)</span>&nbsp;<span class="ident" id="3695227">setBit</span><span class="op" id="3695233">(</span><span class="ident" id="3695234">x</span>&nbsp;<span class="ident" id="3695236">nat</span><span class="op" id="3695239">,</span>&nbsp;<span class="ident" id="3695241">i</span>&nbsp;<span class="builtintype" id="3695243">uint</span><span class="op" id="3695247">,</span>&nbsp;<span class="ident" id="3695249">b</span>&nbsp;<span class="builtintype" id="3695251">uint</span><span class="op" id="3695255">)</span>&nbsp;<span class="ident" id="3695257">nat</span>&nbsp;<span class="op" id="3695261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695264">j</span>&nbsp;<span class="op" id="3695266">:=</span>&nbsp;<span class="builtintype" id="3695269">int</span><span class="op" id="3695272">(</span><span class="ident" id="3695273">i</span>&nbsp;<span class="op" id="3695275">/</span>&nbsp;<span class="ident" id="3695277">_W</span><span class="op" id="3695279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695282">m</span>&nbsp;<span class="op" id="3695284">:=</span>&nbsp;<span class="ident" id="3695287">Word</span><span class="op" id="3695291">(</span><span class="num" id="3695292">1</span><span class="op" id="3695293">)</span>&nbsp;<span class="op" id="3695295">&lt;&lt;</span>&nbsp;<span class="op" id="3695298">(</span><span class="ident" id="3695299">i</span>&nbsp;<span class="op" id="3695301">%</span>&nbsp;<span class="ident" id="3695303">_W</span><span class="op" id="3695305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695308">n</span>&nbsp;<span class="op" id="3695310">:=</span>&nbsp;<span class="builtinfunc" id="3695313">len</span><span class="op" id="3695316">(</span><span class="ident" id="3695317">x</span><span class="op" id="3695318">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695321">switch</span>&nbsp;<span class="ident" id="3695328">b</span>&nbsp;<span class="op" id="3695330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695333">case</span>&nbsp;<span class="num" id="3695338">0</span><span class="op" id="3695339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695343">z</span>&nbsp;<span class="op" id="3695345">=</span>&nbsp;<span class="ident" id="3695347">z</span><span class="op" id="3695348">.</span><span class="builtinfunc" id="3695349">make</span><span class="op" id="3695353">(</span><span class="ident" id="3695354">n</span><span class="op" id="3695355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3695359">copy</span><span class="op" id="3695363">(</span><span class="ident" id="3695364">z</span><span class="op" id="3695365">,</span>&nbsp;<span class="ident" id="3695367">x</span><span class="op" id="3695368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695372">if</span>&nbsp;<span class="ident" id="3695375">j</span>&nbsp;<span class="op" id="3695377">&gt;=</span>&nbsp;<span class="ident" id="3695380">n</span>&nbsp;<span class="op" id="3695382">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695387">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695409">return</span>&nbsp;<span class="ident" id="3695416">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695424">z</span><span class="op" id="3695425">[</span><span class="ident" id="3695426">j</span><span class="op" id="3695427">]</span>&nbsp;<span class="op" id="3695429">&amp;^=</span>&nbsp;<span class="ident" id="3695433">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695437">return</span>&nbsp;<span class="ident" id="3695444">z</span><span class="op" id="3695445">.</span><span class="ident" id="3695446">norm</span><span class="op" id="3695450">(</span><span class="op" id="3695451">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695454">case</span>&nbsp;<span class="num" id="3695459">1</span><span class="op" id="3695460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695464">if</span>&nbsp;<span class="ident" id="3695467">j</span>&nbsp;<span class="op" id="3695469">&gt;=</span>&nbsp;<span class="ident" id="3695472">n</span>&nbsp;<span class="op" id="3695474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695479">z</span>&nbsp;<span class="op" id="3695481">=</span>&nbsp;<span class="ident" id="3695483">z</span><span class="op" id="3695484">.</span><span class="builtinfunc" id="3695485">make</span><span class="op" id="3695489">(</span><span class="ident" id="3695490">j</span>&nbsp;<span class="op" id="3695492">+</span>&nbsp;<span class="num" id="3695494">1</span><span class="op" id="3695495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695500">z</span><span class="op" id="3695501">[</span><span class="ident" id="3695502">n</span><span class="op" id="3695503">:</span><span class="op" id="3695504">]</span><span class="op" id="3695505">.</span><span class="ident" id="3695506">clear</span><span class="op" id="3695511">(</span><span class="op" id="3695512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695516">}</span>&nbsp;<span class="keyword" id="3695518">else</span>&nbsp;<span class="op" id="3695523">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695528">z</span>&nbsp;<span class="op" id="3695530">=</span>&nbsp;<span class="ident" id="3695532">z</span><span class="op" id="3695533">.</span><span class="builtinfunc" id="3695534">make</span><span class="op" id="3695538">(</span><span class="ident" id="3695539">n</span><span class="op" id="3695540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3695548">copy</span><span class="op" id="3695552">(</span><span class="ident" id="3695553">z</span><span class="op" id="3695554">,</span>&nbsp;<span class="ident" id="3695556">x</span><span class="op" id="3695557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695561">z</span><span class="op" id="3695562">[</span><span class="ident" id="3695563">j</span><span class="op" id="3695564">]</span>&nbsp;<span class="op" id="3695566">|=</span>&nbsp;<span class="ident" id="3695569">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695573">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695599">return</span>&nbsp;<span class="ident" id="3695606">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3695612">panic</span><span class="op" id="3695617">(</span><span class="string" id="3695618">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3695641">)</span><br>
<span class="lineno"></span><span class="op" id="3695643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3695646">func</span>&nbsp;<span class="op" id="3695651">(</span><span class="ident" id="3695652">z</span>&nbsp;<span class="ident" id="3695654">nat</span><span class="op" id="3695657">)</span>&nbsp;<span class="ident" id="3695659">bit</span><span class="op" id="3695662">(</span><span class="ident" id="3695663">i</span>&nbsp;<span class="builtintype" id="3695665">uint</span><span class="op" id="3695669">)</span>&nbsp;<span class="builtintype" id="3695671">uint</span>&nbsp;<span class="op" id="3695676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695679">j</span>&nbsp;<span class="op" id="3695681">:=</span>&nbsp;<span class="builtintype" id="3695684">int</span><span class="op" id="3695687">(</span><span class="ident" id="3695688">i</span>&nbsp;<span class="op" id="3695690">/</span>&nbsp;<span class="ident" id="3695692">_W</span><span class="op" id="3695694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695697">if</span>&nbsp;<span class="ident" id="3695700">j</span>&nbsp;<span class="op" id="3695702">&gt;=</span>&nbsp;<span class="builtinfunc" id="3695705">len</span><span class="op" id="3695708">(</span><span class="ident" id="3695709">z</span><span class="op" id="3695710">)</span>&nbsp;<span class="op" id="3695712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695716">return</span>&nbsp;<span class="num" id="3695723">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695726">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695729">return</span>&nbsp;<span class="builtintype" id="3695736">uint</span><span class="op" id="3695740">(</span><span class="ident" id="3695741">z</span><span class="op" id="3695742">[</span><span class="ident" id="3695743">j</span><span class="op" id="3695744">]</span>&nbsp;<span class="op" id="3695746">&gt;&gt;</span>&nbsp;<span class="op" id="3695749">(</span><span class="ident" id="3695750">i</span>&nbsp;<span class="op" id="3695752">%</span>&nbsp;<span class="ident" id="3695754">_W</span><span class="op" id="3695756">)</span>&nbsp;<span class="op" id="3695758">&amp;</span>&nbsp;<span class="num" id="3695760">1</span><span class="op" id="3695761">)</span><br>
<span class="lineno"></span><span class="op" id="3695763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3695766">func</span>&nbsp;<span class="op" id="3695771">(</span><span class="ident" id="3695772">z</span>&nbsp;<span class="ident" id="3695774">nat</span><span class="op" id="3695777">)</span>&nbsp;<span class="ident" id="3695779">and</span><span class="op" id="3695782">(</span><span class="ident" id="3695783">x</span><span class="op" id="3695784">,</span>&nbsp;<span class="ident" id="3695786">y</span>&nbsp;<span class="ident" id="3695788">nat</span><span class="op" id="3695791">)</span>&nbsp;<span class="ident" id="3695793">nat</span>&nbsp;<span class="op" id="3695797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695800">m</span>&nbsp;<span class="op" id="3695802">:=</span>&nbsp;<span class="builtinfunc" id="3695805">len</span><span class="op" id="3695808">(</span><span class="ident" id="3695809">x</span><span class="op" id="3695810">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695813">n</span>&nbsp;<span class="op" id="3695815">:=</span>&nbsp;<span class="builtinfunc" id="3695818">len</span><span class="op" id="3695821">(</span><span class="ident" id="3695822">y</span><span class="op" id="3695823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695826">if</span>&nbsp;<span class="ident" id="3695829">m</span>&nbsp;<span class="op" id="3695831">&gt;</span>&nbsp;<span class="ident" id="3695833">n</span>&nbsp;<span class="op" id="3695835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695839">m</span>&nbsp;<span class="op" id="3695841">=</span>&nbsp;<span class="ident" id="3695843">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695849">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695861">z</span>&nbsp;<span class="op" id="3695863">=</span>&nbsp;<span class="ident" id="3695865">z</span><span class="op" id="3695866">.</span><span class="builtinfunc" id="3695867">make</span><span class="op" id="3695871">(</span><span class="ident" id="3695872">m</span><span class="op" id="3695873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695876">for</span>&nbsp;<span class="ident" id="3695880">i</span>&nbsp;<span class="op" id="3695882">:=</span>&nbsp;<span class="num" id="3695885">0</span><span class="op" id="3695886">;</span>&nbsp;<span class="ident" id="3695888">i</span>&nbsp;<span class="op" id="3695890">&lt;</span>&nbsp;<span class="ident" id="3695892">m</span><span class="op" id="3695893">;</span>&nbsp;<span class="ident" id="3695895">i</span><span class="op" id="3695896">++</span>&nbsp;<span class="op" id="3695899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695903">z</span><span class="op" id="3695904">[</span><span class="ident" id="3695905">i</span><span class="op" id="3695906">]</span>&nbsp;<span class="op" id="3695908">=</span>&nbsp;<span class="ident" id="3695910">x</span><span class="op" id="3695911">[</span><span class="ident" id="3695912">i</span><span class="op" id="3695913">]</span>&nbsp;<span class="op" id="3695915">&amp;</span>&nbsp;<span class="ident" id="3695917">y</span><span class="op" id="3695918">[</span><span class="ident" id="3695919">i</span><span class="op" id="3695920">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695923">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695927">return</span>&nbsp;<span class="ident" id="3695934">z</span><span class="op" id="3695935">.</span><span class="ident" id="3695936">norm</span><span class="op" id="3695940">(</span><span class="op" id="3695941">)</span><br>
<span class="lineno"></span><span class="op" id="3695943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3695946">func</span>&nbsp;<span class="op" id="3695951">(</span><span class="ident" id="3695952">z</span>&nbsp;<span class="ident" id="3695954">nat</span><span class="op" id="3695957">)</span>&nbsp;<span class="ident" id="3695959">andNot</span><span class="op" id="3695965">(</span><span class="ident" id="3695966">x</span><span class="op" id="3695967">,</span>&nbsp;<span class="ident" id="3695969">y</span>&nbsp;<span class="ident" id="3695971">nat</span><span class="op" id="3695974">)</span>&nbsp;<span class="ident" id="3695976">nat</span>&nbsp;<span class="op" id="3695980">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695983">m</span>&nbsp;<span class="op" id="3695985">:=</span>&nbsp;<span class="builtinfunc" id="3695988">len</span><span class="op" id="3695991">(</span><span class="ident" id="3695992">x</span><span class="op" id="3695993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695996">n</span>&nbsp;<span class="op" id="3695998">:=</span>&nbsp;<span class="builtinfunc" id="3696001">len</span><span class="op" id="3696004">(</span><span class="ident" id="3696005">y</span><span class="op" id="3696006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696009">if</span>&nbsp;<span class="ident" id="3696012">n</span>&nbsp;<span class="op" id="3696014">&gt;</span>&nbsp;<span class="ident" id="3696016">m</span>&nbsp;<span class="op" id="3696018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696022">n</span>&nbsp;<span class="op" id="3696024">=</span>&nbsp;<span class="ident" id="3696026">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696029">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3696032">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696044">z</span>&nbsp;<span class="op" id="3696046">=</span>&nbsp;<span class="ident" id="3696048">z</span><span class="op" id="3696049">.</span><span class="builtinfunc" id="3696050">make</span><span class="op" id="3696054">(</span><span class="ident" id="3696055">m</span><span class="op" id="3696056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696059">for</span>&nbsp;<span class="ident" id="3696063">i</span>&nbsp;<span class="op" id="3696065">:=</span>&nbsp;<span class="num" id="3696068">0</span><span class="op" id="3696069">;</span>&nbsp;<span class="ident" id="3696071">i</span>&nbsp;<span class="op" id="3696073">&lt;</span>&nbsp;<span class="ident" id="3696075">n</span><span class="op" id="3696076">;</span>&nbsp;<span class="ident" id="3696078">i</span><span class="op" id="3696079">++</span>&nbsp;<span class="op" id="3696082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696086">z</span><span class="op" id="3696087">[</span><span class="ident" id="3696088">i</span><span class="op" id="3696089">]</span>&nbsp;<span class="op" id="3696091">=</span>&nbsp;<span class="ident" id="3696093">x</span><span class="op" id="3696094">[</span><span class="ident" id="3696095">i</span><span class="op" id="3696096">]</span>&nbsp;<span class="op" id="3696098">&amp;^</span>&nbsp;<span class="ident" id="3696101">y</span><span class="op" id="3696102">[</span><span class="ident" id="3696103">i</span><span class="op" id="3696104">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3696110">copy</span><span class="op" id="3696114">(</span><span class="ident" id="3696115">z</span><span class="op" id="3696116">[</span><span class="ident" id="3696117">n</span><span class="op" id="3696118">:</span><span class="ident" id="3696119">m</span><span class="op" id="3696120">]</span><span class="op" id="3696121">,</span>&nbsp;<span class="ident" id="3696123">x</span><span class="op" id="3696124">[</span><span class="ident" id="3696125">n</span><span class="op" id="3696126">:</span><span class="ident" id="3696127">m</span><span class="op" id="3696128">]</span><span class="op" id="3696129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696133">return</span>&nbsp;<span class="ident" id="3696140">z</span><span class="op" id="3696141">.</span><span class="ident" id="3696142">norm</span><span class="op" id="3696146">(</span><span class="op" id="3696147">)</span><br>
<span class="lineno"></span><span class="op" id="3696149">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3696152">func</span>&nbsp;<span class="op" id="3696157">(</span><span class="ident" id="3696158">z</span>&nbsp;<span class="ident" id="3696160">nat</span><span class="op" id="3696163">)</span>&nbsp;<span class="ident" id="3696165">or</span><span class="op" id="3696167">(</span><span class="ident" id="3696168">x</span><span class="op" id="3696169">,</span>&nbsp;<span class="ident" id="3696171">y</span>&nbsp;<span class="ident" id="3696173">nat</span><span class="op" id="3696176">)</span>&nbsp;<span class="ident" id="3696178">nat</span>&nbsp;<span class="op" id="3696182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696185">m</span>&nbsp;<span class="op" id="3696187">:=</span>&nbsp;<span class="builtinfunc" id="3696190">len</span><span class="op" id="3696193">(</span><span class="ident" id="3696194">x</span><span class="op" id="3696195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696198">n</span>&nbsp;<span class="op" id="3696200">:=</span>&nbsp;<span class="builtinfunc" id="3696203">len</span><span class="op" id="3696206">(</span><span class="ident" id="3696207">y</span><span class="op" id="3696208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696211">s</span>&nbsp;<span class="op" id="3696213">:=</span>&nbsp;<span class="ident" id="3696216">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696219">if</span>&nbsp;<span class="ident" id="3696222">m</span>&nbsp;<span class="op" id="3696224">&lt;</span>&nbsp;<span class="ident" id="3696226">n</span>&nbsp;<span class="op" id="3696228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696232">n</span><span class="op" id="3696233">,</span>&nbsp;<span class="ident" id="3696235">m</span>&nbsp;<span class="op" id="3696237">=</span>&nbsp;<span class="ident" id="3696239">m</span><span class="op" id="3696240">,</span>&nbsp;<span class="ident" id="3696242">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696246">s</span>&nbsp;<span class="op" id="3696248">=</span>&nbsp;<span class="ident" id="3696250">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3696256">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696268">z</span>&nbsp;<span class="op" id="3696270">=</span>&nbsp;<span class="ident" id="3696272">z</span><span class="op" id="3696273">.</span><span class="builtinfunc" id="3696274">make</span><span class="op" id="3696278">(</span><span class="ident" id="3696279">m</span><span class="op" id="3696280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696283">for</span>&nbsp;<span class="ident" id="3696287">i</span>&nbsp;<span class="op" id="3696289">:=</span>&nbsp;<span class="num" id="3696292">0</span><span class="op" id="3696293">;</span>&nbsp;<span class="ident" id="3696295">i</span>&nbsp;<span class="op" id="3696297">&lt;</span>&nbsp;<span class="ident" id="3696299">n</span><span class="op" id="3696300">;</span>&nbsp;<span class="ident" id="3696302">i</span><span class="op" id="3696303">++</span>&nbsp;<span class="op" id="3696306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696310">z</span><span class="op" id="3696311">[</span><span class="ident" id="3696312">i</span><span class="op" id="3696313">]</span>&nbsp;<span class="op" id="3696315">=</span>&nbsp;<span class="ident" id="3696317">x</span><span class="op" id="3696318">[</span><span class="ident" id="3696319">i</span><span class="op" id="3696320">]</span>&nbsp;<span class="op" id="3696322">|</span>&nbsp;<span class="ident" id="3696324">y</span><span class="op" id="3696325">[</span><span class="ident" id="3696326">i</span><span class="op" id="3696327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696330">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3696333">copy</span><span class="op" id="3696337">(</span><span class="ident" id="3696338">z</span><span class="op" id="3696339">[</span><span class="ident" id="3696340">n</span><span class="op" id="3696341">:</span><span class="ident" id="3696342">m</span><span class="op" id="3696343">]</span><span class="op" id="3696344">,</span>&nbsp;<span class="ident" id="3696346">s</span><span class="op" id="3696347">[</span><span class="ident" id="3696348">n</span><span class="op" id="3696349">:</span><span class="ident" id="3696350">m</span><span class="op" id="3696351">]</span><span class="op" id="3696352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696356">return</span>&nbsp;<span class="ident" id="3696363">z</span><span class="op" id="3696364">.</span><span class="ident" id="3696365">norm</span><span class="op" id="3696369">(</span><span class="op" id="3696370">)</span><br>
<span class="lineno"></span><span class="op" id="3696372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3696375">func</span>&nbsp;<span class="op" id="3696380">(</span><span class="ident" id="3696381">z</span>&nbsp;<span class="ident" id="3696383">nat</span><span class="op" id="3696386">)</span>&nbsp;<span class="ident" id="3696388">xor</span><span class="op" id="3696391">(</span><span class="ident" id="3696392">x</span><span class="op" id="3696393">,</span>&nbsp;<span class="ident" id="3696395">y</span>&nbsp;<span class="ident" id="3696397">nat</span><span class="op" id="3696400">)</span>&nbsp;<span class="ident" id="3696402">nat</span>&nbsp;<span class="op" id="3696406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696409">m</span>&nbsp;<span class="op" id="3696411">:=</span>&nbsp;<span class="builtinfunc" id="3696414">len</span><span class="op" id="3696417">(</span><span class="ident" id="3696418">x</span><span class="op" id="3696419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696422">n</span>&nbsp;<span class="op" id="3696424">:=</span>&nbsp;<span class="builtinfunc" id="3696427">len</span><span class="op" id="3696430">(</span><span class="ident" id="3696431">y</span><span class="op" id="3696432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696435">s</span>&nbsp;<span class="op" id="3696437">:=</span>&nbsp;<span class="ident" id="3696440">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696443">if</span>&nbsp;<span class="ident" id="3696446">m</span>&nbsp;<span class="op" id="3696448">&lt;</span>&nbsp;<span class="ident" id="3696450">n</span>&nbsp;<span class="op" id="3696452">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696456">n</span><span class="op" id="3696457">,</span>&nbsp;<span class="ident" id="3696459">m</span>&nbsp;<span class="op" id="3696461">=</span>&nbsp;<span class="ident" id="3696463">m</span><span class="op" id="3696464">,</span>&nbsp;<span class="ident" id="3696466">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696470">s</span>&nbsp;<span class="op" id="3696472">=</span>&nbsp;<span class="ident" id="3696474">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3696480">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696492">z</span>&nbsp;<span class="op" id="3696494">=</span>&nbsp;<span class="ident" id="3696496">z</span><span class="op" id="3696497">.</span><span class="builtinfunc" id="3696498">make</span><span class="op" id="3696502">(</span><span class="ident" id="3696503">m</span><span class="op" id="3696504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696507">for</span>&nbsp;<span class="ident" id="3696511">i</span>&nbsp;<span class="op" id="3696513">:=</span>&nbsp;<span class="num" id="3696516">0</span><span class="op" id="3696517">;</span>&nbsp;<span class="ident" id="3696519">i</span>&nbsp;<span class="op" id="3696521">&lt;</span>&nbsp;<span class="ident" id="3696523">n</span><span class="op" id="3696524">;</span>&nbsp;<span class="ident" id="3696526">i</span><span class="op" id="3696527">++</span>&nbsp;<span class="op" id="3696530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696534">z</span><span class="op" id="3696535">[</span><span class="ident" id="3696536">i</span><span class="op" id="3696537">]</span>&nbsp;<span class="op" id="3696539">=</span>&nbsp;<span class="ident" id="3696541">x</span><span class="op" id="3696542">[</span><span class="ident" id="3696543">i</span><span class="op" id="3696544">]</span>&nbsp;<span class="op" id="3696546">^</span>&nbsp;<span class="ident" id="3696548">y</span><span class="op" id="3696549">[</span><span class="ident" id="3696550">i</span><span class="op" id="3696551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3696554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3696557">copy</span><span class="op" id="3696561">(</span><span class="ident" id="3696562">z</span><span class="op" id="3696563">[</span><span class="ident" id="3696564">n</span><span class="op" id="3696565">:</span><span class="ident" id="3696566">m</span><span class="op" id="3696567">]</span><span class="op" id="3696568">,</span>&nbsp;<span class="ident" id="3696570">s</span><span class="op" id="3696571">[</span><span class="ident" id="3696572">n</span><span class="op" id="3696573">:</span><span class="ident" id="3696574">m</span><span class="op" id="3696575">]</span><span class="op" id="3696576">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696580">return</span>&nbsp;<span class="ident" id="3696587">z</span><span class="op" id="3696588">.</span><span class="ident" id="3696589">norm</span><span class="op" id="3696593">(</span><span class="op" id="3696594">)</span><br>
<span class="lineno"></span><span class="op" id="3696596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3696599">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3696661">func</span>&nbsp;<span class="ident" id="3696666">greaterThan</span><span class="op" id="3696677">(</span><span class="ident" id="3696678">x1</span><span class="op" id="3696680">,</span>&nbsp;<span class="ident" id="3696682">x2</span><span class="op" id="3696684">,</span>&nbsp;<span class="ident" id="3696686">y1</span><span class="op" id="3696688">,</span>&nbsp;<span class="ident" id="3696690">y2</span>&nbsp;<span class="ident" id="3696693">Word</span><span class="op" id="3696697">)</span>&nbsp;<span class="builtintype" id="3696699">bool</span>&nbsp;<span class="op" id="3696704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696707">return</span>&nbsp;<span class="ident" id="3696714">x1</span>&nbsp;<span class="op" id="3696717">&gt;</span>&nbsp;<span class="ident" id="3696719">y1</span>&nbsp;<span class="op" id="3696722">||</span>&nbsp;<span class="ident" id="3696725">x1</span>&nbsp;<span class="op" id="3696728">==</span>&nbsp;<span class="ident" id="3696731">y1</span>&nbsp;<span class="op" id="3696734">&amp;&amp;</span>&nbsp;<span class="ident" id="3696737">x2</span>&nbsp;<span class="op" id="3696740">&gt;</span>&nbsp;<span class="ident" id="3696742">y2</span><br>
<span class="lineno"></span><span class="op" id="3696745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3696748">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3696771">func</span>&nbsp;<span class="op" id="3696776">(</span><span class="ident" id="3696777">x</span>&nbsp;<span class="ident" id="3696779">nat</span><span class="op" id="3696782">)</span>&nbsp;<span class="ident" id="3696784">modW</span><span class="op" id="3696788">(</span><span class="ident" id="3696789">d</span>&nbsp;<span class="ident" id="3696791">Word</span><span class="op" id="3696795">)</span>&nbsp;<span class="op" id="3696797">(</span><span class="ident" id="3696798">r</span>&nbsp;<span class="ident" id="3696800">Word</span><span class="op" id="3696804">)</span>&nbsp;<span class="op" id="3696806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3696809">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696869">var</span>&nbsp;<span class="ident" id="3696873">q</span>&nbsp;<span class="ident" id="3696875">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3696880">q</span>&nbsp;<span class="op" id="3696882">=</span>&nbsp;<span class="ident" id="3696884">q</span><span class="op" id="3696885">.</span><span class="builtinfunc" id="3696886">make</span><span class="op" id="3696890">(</span><span class="builtinfunc" id="3696891">len</span><span class="op" id="3696894">(</span><span class="ident" id="3696895">x</span><span class="op" id="3696896">)</span><span class="op" id="3696897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3696900">return</span>&nbsp;<span class="ident" id="3696907">divWVW</span><span class="op" id="3696913">(</span><span class="ident" id="3696914">q</span><span class="op" id="3696915">,</span>&nbsp;<span class="num" id="3696917">0</span><span class="op" id="3696918">,</span>&nbsp;<span class="ident" id="3696920">x</span><span class="op" id="3696921">,</span>&nbsp;<span class="ident" id="3696923">d</span><span class="op" id="3696924">)</span><br>
<span class="lineno">1190</span><span class="op" id="3696926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3696929">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3697003">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3697046">func</span>&nbsp;<span class="op" id="3697051">(</span><span class="ident" id="3697052">z</span>&nbsp;<span class="ident" id="3697054">nat</span><span class="op" id="3697057">)</span>&nbsp;<span class="ident" id="3697059">random</span><span class="op" id="3697065">(</span><span class="ident" id="3697066">rand</span>&nbsp;<span class="op" id="3697071">*</span><span class="ident" id="3697072">rand</span><span class="op" id="3697076">.</span><span class="ident" id="3697077">Rand</span><span class="op" id="3697081">,</span>&nbsp;<span class="ident" id="3697083">limit</span>&nbsp;<span class="ident" id="3697089">nat</span><span class="op" id="3697092">,</span>&nbsp;<span class="ident" id="3697094">n</span>&nbsp;<span class="builtintype" id="3697096">int</span><span class="op" id="3697099">)</span>&nbsp;<span class="ident" id="3697101">nat</span>&nbsp;<span class="op" id="3697105">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697108">if</span>&nbsp;<span class="ident" id="3697111">alias</span><span class="op" id="3697116">(</span><span class="ident" id="3697117">z</span><span class="op" id="3697118">,</span>&nbsp;<span class="ident" id="3697120">limit</span><span class="op" id="3697125">)</span>&nbsp;<span class="op" id="3697127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697131">z</span>&nbsp;<span class="op" id="3697133">=</span>&nbsp;<span class="ident" id="3697135">nil</span>&nbsp;<span class="comment" id="3697139">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697185">z</span>&nbsp;<span class="op" id="3697187">=</span>&nbsp;<span class="ident" id="3697189">z</span><span class="op" id="3697190">.</span><span class="builtinfunc" id="3697191">make</span><span class="op" id="3697195">(</span><span class="builtinfunc" id="3697196">len</span><span class="op" id="3697199">(</span><span class="ident" id="3697200">limit</span><span class="op" id="3697205">)</span><span class="op" id="3697206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697210">bitLengthOfMSW</span>&nbsp;<span class="op" id="3697225">:=</span>&nbsp;<span class="builtintype" id="3697228">uint</span><span class="op" id="3697232">(</span><span class="ident" id="3697233">n</span>&nbsp;<span class="op" id="3697235">%</span>&nbsp;<span class="ident" id="3697237">_W</span><span class="op" id="3697239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697242">if</span>&nbsp;<span class="ident" id="3697245">bitLengthOfMSW</span>&nbsp;<span class="op" id="3697260">==</span>&nbsp;<span class="num" id="3697263">0</span>&nbsp;<span class="op" id="3697265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697269">bitLengthOfMSW</span>&nbsp;<span class="op" id="3697284">=</span>&nbsp;<span class="ident" id="3697286">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697293">mask</span>&nbsp;<span class="op" id="3697298">:=</span>&nbsp;<span class="ident" id="3697301">Word</span><span class="op" id="3697305">(</span><span class="op" id="3697306">(</span><span class="num" id="3697307">1</span>&nbsp;<span class="op" id="3697309">&lt;&lt;</span>&nbsp;<span class="ident" id="3697312">bitLengthOfMSW</span><span class="op" id="3697326">)</span>&nbsp;<span class="op" id="3697328">-</span>&nbsp;<span class="num" id="3697330">1</span><span class="op" id="3697331">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697335">for</span>&nbsp;<span class="op" id="3697339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697343">switch</span>&nbsp;<span class="ident" id="3697350">_W</span>&nbsp;<span class="op" id="3697353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697357">case</span>&nbsp;<span class="num" id="3697362">32</span><span class="op" id="3697364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697369">for</span>&nbsp;<span class="ident" id="3697373">i</span>&nbsp;<span class="op" id="3697375">:=</span>&nbsp;<span class="keyword" id="3697378">range</span>&nbsp;<span class="ident" id="3697384">z</span>&nbsp;<span class="op" id="3697386">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697392">z</span><span class="op" id="3697393">[</span><span class="ident" id="3697394">i</span><span class="op" id="3697395">]</span>&nbsp;<span class="op" id="3697397">=</span>&nbsp;<span class="ident" id="3697399">Word</span><span class="op" id="3697403">(</span><span class="ident" id="3697404">rand</span><span class="op" id="3697408">.</span><span class="ident" id="3697409">Uint32</span><span class="op" id="3697415">(</span><span class="op" id="3697416">)</span><span class="op" id="3697417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697426">case</span>&nbsp;<span class="num" id="3697431">64</span><span class="op" id="3697433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697438">for</span>&nbsp;<span class="ident" id="3697442">i</span>&nbsp;<span class="op" id="3697444">:=</span>&nbsp;<span class="keyword" id="3697447">range</span>&nbsp;<span class="ident" id="3697453">z</span>&nbsp;<span class="op" id="3697455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697461">z</span><span class="op" id="3697462">[</span><span class="ident" id="3697463">i</span><span class="op" id="3697464">]</span>&nbsp;<span class="op" id="3697466">=</span>&nbsp;<span class="ident" id="3697468">Word</span><span class="op" id="3697472">(</span><span class="ident" id="3697473">rand</span><span class="op" id="3697477">.</span><span class="ident" id="3697478">Uint32</span><span class="op" id="3697484">(</span><span class="op" id="3697485">)</span><span class="op" id="3697486">)</span>&nbsp;<span class="op" id="3697488">|</span>&nbsp;<span class="ident" id="3697490">Word</span><span class="op" id="3697494">(</span><span class="ident" id="3697495">rand</span><span class="op" id="3697499">.</span><span class="ident" id="3697500">Uint32</span><span class="op" id="3697506">(</span><span class="op" id="3697507">)</span><span class="op" id="3697508">)</span><span class="op" id="3697509">&lt;&lt;</span><span class="num" id="3697511">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697521">default</span><span class="op" id="3697528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3697533">panic</span><span class="op" id="3697538">(</span><span class="string" id="3697539">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3697558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697566">z</span><span class="op" id="3697567">[</span><span class="builtinfunc" id="3697568">len</span><span class="op" id="3697571">(</span><span class="ident" id="3697572">limit</span><span class="op" id="3697577">)</span><span class="op" id="3697578">-</span><span class="num" id="3697579">1</span><span class="op" id="3697580">]</span>&nbsp;<span class="op" id="3697582">&amp;=</span>&nbsp;<span class="ident" id="3697585">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697592">if</span>&nbsp;<span class="ident" id="3697595">z</span><span class="op" id="3697596">.</span><span class="ident" id="3697597">cmp</span><span class="op" id="3697600">(</span><span class="ident" id="3697601">limit</span><span class="op" id="3697606">)</span>&nbsp;<span class="op" id="3697608">&lt;</span>&nbsp;<span class="num" id="3697610">0</span>&nbsp;<span class="op" id="3697612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697617">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697632">return</span>&nbsp;<span class="ident" id="3697639">z</span><span class="op" id="3697640">.</span><span class="ident" id="3697641">norm</span><span class="op" id="3697645">(</span><span class="op" id="3697646">)</span><br>
<span class="lineno"></span><span class="op" id="3697648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3697651">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3697713">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3697775">func</span>&nbsp;<span class="op" id="3697780">(</span><span class="ident" id="3697781">z</span>&nbsp;<span class="ident" id="3697783">nat</span><span class="op" id="3697786">)</span>&nbsp;<span class="ident" id="3697788">expNN</span><span class="op" id="3697793">(</span><span class="ident" id="3697794">x</span><span class="op" id="3697795">,</span>&nbsp;<span class="ident" id="3697797">y</span><span class="op" id="3697798">,</span>&nbsp;<span class="ident" id="3697800">m</span>&nbsp;<span class="ident" id="3697802">nat</span><span class="op" id="3697805">)</span>&nbsp;<span class="ident" id="3697807">nat</span>&nbsp;<span class="op" id="3697811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697814">if</span>&nbsp;<span class="ident" id="3697817">alias</span><span class="op" id="3697822">(</span><span class="ident" id="3697823">z</span><span class="op" id="3697824">,</span>&nbsp;<span class="ident" id="3697826">x</span><span class="op" id="3697827">)</span>&nbsp;<span class="op" id="3697829">||</span>&nbsp;<span class="ident" id="3697832">alias</span><span class="op" id="3697837">(</span><span class="ident" id="3697838">z</span><span class="op" id="3697839">,</span>&nbsp;<span class="ident" id="3697841">y</span><span class="op" id="3697842">)</span>&nbsp;<span class="op" id="3697844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3697848">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3697902">z</span>&nbsp;<span class="op" id="3697904">=</span>&nbsp;<span class="ident" id="3697906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697911">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3697915">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697935">if</span>&nbsp;<span class="builtinfunc" id="3697938">len</span><span class="op" id="3697941">(</span><span class="ident" id="3697942">m</span><span class="op" id="3697943">)</span>&nbsp;<span class="op" id="3697945">==</span>&nbsp;<span class="num" id="3697948">1</span>&nbsp;<span class="op" id="3697950">&amp;&amp;</span>&nbsp;<span class="ident" id="3697953">m</span><span class="op" id="3697954">[</span><span class="num" id="3697955">0</span><span class="op" id="3697956">]</span>&nbsp;<span class="op" id="3697958">==</span>&nbsp;<span class="num" id="3697961">1</span>&nbsp;<span class="op" id="3697963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3697967">return</span>&nbsp;<span class="ident" id="3697974">z</span><span class="op" id="3697975">.</span><span class="ident" id="3697976">setWord</span><span class="op" id="3697983">(</span><span class="num" id="3697984">0</span><span class="op" id="3697985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3697988">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3697991">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698012">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698026">if</span>&nbsp;<span class="builtinfunc" id="3698029">len</span><span class="op" id="3698032">(</span><span class="ident" id="3698033">y</span><span class="op" id="3698034">)</span>&nbsp;<span class="op" id="3698036">==</span>&nbsp;<span class="num" id="3698039">0</span>&nbsp;<span class="op" id="3698041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698045">return</span>&nbsp;<span class="ident" id="3698052">z</span><span class="op" id="3698053">.</span><span class="ident" id="3698054">setWord</span><span class="op" id="3698061">(</span><span class="num" id="3698062">1</span><span class="op" id="3698063">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698069">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698080">if</span>&nbsp;<span class="builtinfunc" id="3698083">len</span><span class="op" id="3698086">(</span><span class="ident" id="3698087">m</span><span class="op" id="3698088">)</span>&nbsp;<span class="op" id="3698090">!=</span>&nbsp;<span class="num" id="3698093">0</span>&nbsp;<span class="op" id="3698095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698099">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698151">z</span>&nbsp;<span class="op" id="3698153">=</span>&nbsp;<span class="ident" id="3698155">z</span><span class="op" id="3698156">.</span><span class="builtinfunc" id="3698157">make</span><span class="op" id="3698161">(</span><span class="builtinfunc" id="3698162">len</span><span class="op" id="3698165">(</span><span class="ident" id="3698166">m</span><span class="op" id="3698167">)</span><span class="op" id="3698168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698174">z</span>&nbsp;<span class="op" id="3698176">=</span>&nbsp;<span class="ident" id="3698178">z</span><span class="op" id="3698179">.</span><span class="ident" id="3698180">set</span><span class="op" id="3698183">(</span><span class="ident" id="3698184">x</span><span class="op" id="3698185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698189">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698254">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698327">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698397">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698463">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698479">if</span>&nbsp;<span class="builtinfunc" id="3698482">len</span><span class="op" id="3698485">(</span><span class="ident" id="3698486">x</span><span class="op" id="3698487">)</span>&nbsp;<span class="op" id="3698489">&gt;</span>&nbsp;<span class="num" id="3698491">1</span>&nbsp;<span class="op" id="3698493">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3698496">len</span><span class="op" id="3698499">(</span><span class="ident" id="3698500">y</span><span class="op" id="3698501">)</span>&nbsp;<span class="op" id="3698503">&gt;</span>&nbsp;<span class="num" id="3698505">1</span>&nbsp;<span class="op" id="3698507">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3698510">len</span><span class="op" id="3698513">(</span><span class="ident" id="3698514">m</span><span class="op" id="3698515">)</span>&nbsp;<span class="op" id="3698517">&gt;</span>&nbsp;<span class="num" id="3698519">0</span>&nbsp;<span class="op" id="3698521">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698525">return</span>&nbsp;<span class="ident" id="3698532">z</span><span class="op" id="3698533">.</span><span class="ident" id="3698534">expNNWindowed</span><span class="op" id="3698547">(</span><span class="ident" id="3698548">x</span><span class="op" id="3698549">,</span>&nbsp;<span class="ident" id="3698551">y</span><span class="op" id="3698552">,</span>&nbsp;<span class="ident" id="3698554">m</span><span class="op" id="3698555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3698558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698562">v</span>&nbsp;<span class="op" id="3698564">:=</span>&nbsp;<span class="ident" id="3698567">y</span><span class="op" id="3698568">[</span><span class="builtinfunc" id="3698569">len</span><span class="op" id="3698572">(</span><span class="ident" id="3698573">y</span><span class="op" id="3698574">)</span><span class="op" id="3698575">-</span><span class="num" id="3698576">1</span><span class="op" id="3698577">]</span>&nbsp;<span class="comment" id="3698579">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698623">shift</span>&nbsp;<span class="op" id="3698629">:=</span>&nbsp;<span class="ident" id="3698632">leadingZeros</span><span class="op" id="3698644">(</span><span class="ident" id="3698645">v</span><span class="op" id="3698646">)</span>&nbsp;<span class="op" id="3698648">+</span>&nbsp;<span class="num" id="3698650">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698653">v</span>&nbsp;<span class="op" id="3698655">&lt;&lt;=</span>&nbsp;<span class="ident" id="3698659">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698666">var</span>&nbsp;<span class="ident" id="3698670">q</span>&nbsp;<span class="ident" id="3698672">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3698678">const</span>&nbsp;<span class="ident" id="3698684">mask</span>&nbsp;<span class="op" id="3698689">=</span>&nbsp;<span class="num" id="3698691">1</span>&nbsp;<span class="op" id="3698693">&lt;&lt;</span>&nbsp;<span class="op" id="3698696">(</span><span class="ident" id="3698697">_W</span>&nbsp;<span class="op" id="3698700">-</span>&nbsp;<span class="num" id="3698702">1</span><span class="op" id="3698703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698707">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698777">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698849">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3698907">w</span>&nbsp;<span class="op" id="3698909">:=</span>&nbsp;<span class="ident" id="3698912">_W</span>&nbsp;<span class="op" id="3698915">-</span>&nbsp;<span class="builtintype" id="3698917">int</span><span class="op" id="3698920">(</span><span class="ident" id="3698921">shift</span><span class="op" id="3698926">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698929">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3698989">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699030">var</span>&nbsp;<span class="ident" id="3699034">zz</span><span class="op" id="3699036">,</span>&nbsp;<span class="ident" id="3699038">r</span>&nbsp;<span class="ident" id="3699040">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699045">for</span>&nbsp;<span class="ident" id="3699049">j</span>&nbsp;<span class="op" id="3699051">:=</span>&nbsp;<span class="num" id="3699054">0</span><span class="op" id="3699055">;</span>&nbsp;<span class="ident" id="3699057">j</span>&nbsp;<span class="op" id="3699059">&lt;</span>&nbsp;<span class="ident" id="3699061">w</span><span class="op" id="3699062">;</span>&nbsp;<span class="ident" id="3699064">j</span><span class="op" id="3699065">++</span>&nbsp;<span class="op" id="3699068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699072">zz</span>&nbsp;<span class="op" id="3699075">=</span>&nbsp;<span class="ident" id="3699077">zz</span><span class="op" id="3699079">.</span><span class="ident" id="3699080">mul</span><span class="op" id="3699083">(</span><span class="ident" id="3699084">z</span><span class="op" id="3699085">,</span>&nbsp;<span class="ident" id="3699087">z</span><span class="op" id="3699088">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699092">zz</span><span class="op" id="3699094">,</span>&nbsp;<span class="ident" id="3699096">z</span>&nbsp;<span class="op" id="3699098">=</span>&nbsp;<span class="ident" id="3699100">z</span><span class="op" id="3699101">,</span>&nbsp;<span class="ident" id="3699103">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699109">if</span>&nbsp;<span class="ident" id="3699112">v</span><span class="op" id="3699113">&amp;</span><span class="ident" id="3699114">mask</span>&nbsp;<span class="op" id="3699119">!=</span>&nbsp;<span class="num" id="3699122">0</span>&nbsp;<span class="op" id="3699124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699129">zz</span>&nbsp;<span class="op" id="3699132">=</span>&nbsp;<span class="ident" id="3699134">zz</span><span class="op" id="3699136">.</span><span class="ident" id="3699137">mul</span><span class="op" id="3699140">(</span><span class="ident" id="3699141">z</span><span class="op" id="3699142">,</span>&nbsp;<span class="ident" id="3699144">x</span><span class="op" id="3699145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699150">zz</span><span class="op" id="3699152">,</span>&nbsp;<span class="ident" id="3699154">z</span>&nbsp;<span class="op" id="3699156">=</span>&nbsp;<span class="ident" id="3699158">z</span><span class="op" id="3699159">,</span>&nbsp;<span class="ident" id="3699161">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699171">if</span>&nbsp;<span class="builtinfunc" id="3699174">len</span><span class="op" id="3699177">(</span><span class="ident" id="3699178">m</span><span class="op" id="3699179">)</span>&nbsp;<span class="op" id="3699181">!=</span>&nbsp;<span class="num" id="3699184">0</span>&nbsp;<span class="op" id="3699186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699191">zz</span><span class="op" id="3699193">,</span>&nbsp;<span class="ident" id="3699195">r</span>&nbsp;<span class="op" id="3699197">=</span>&nbsp;<span class="ident" id="3699199">zz</span><span class="op" id="3699201">.</span><span class="ident" id="3699202">div</span><span class="op" id="3699205">(</span><span class="ident" id="3699206">r</span><span class="op" id="3699207">,</span>&nbsp;<span class="ident" id="3699209">z</span><span class="op" id="3699210">,</span>&nbsp;<span class="ident" id="3699212">m</span><span class="op" id="3699213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699218">zz</span><span class="op" id="3699220">,</span>&nbsp;<span class="ident" id="3699222">r</span><span class="op" id="3699223">,</span>&nbsp;<span class="ident" id="3699225">q</span><span class="op" id="3699226">,</span>&nbsp;<span class="ident" id="3699228">z</span>&nbsp;<span class="op" id="3699230">=</span>&nbsp;<span class="ident" id="3699232">q</span><span class="op" id="3699233">,</span>&nbsp;<span class="ident" id="3699235">z</span><span class="op" id="3699236">,</span>&nbsp;<span class="ident" id="3699238">zz</span><span class="op" id="3699240">,</span>&nbsp;<span class="ident" id="3699242">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699251">v</span>&nbsp;<span class="op" id="3699253">&lt;&lt;=</span>&nbsp;<span class="num" id="3699257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699264">for</span>&nbsp;<span class="ident" id="3699268">i</span>&nbsp;<span class="op" id="3699270">:=</span>&nbsp;<span class="builtinfunc" id="3699273">len</span><span class="op" id="3699276">(</span><span class="ident" id="3699277">y</span><span class="op" id="3699278">)</span>&nbsp;<span class="op" id="3699280">-</span>&nbsp;<span class="num" id="3699282">2</span><span class="op" id="3699283">;</span>&nbsp;<span class="ident" id="3699285">i</span>&nbsp;<span class="op" id="3699287">&gt;=</span>&nbsp;<span class="num" id="3699290">0</span><span class="op" id="3699291">;</span>&nbsp;<span class="ident" id="3699293">i</span><span class="op" id="3699294">--</span>&nbsp;<span class="op" id="3699297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699301">v</span>&nbsp;<span class="op" id="3699303">=</span>&nbsp;<span class="ident" id="3699305">y</span><span class="op" id="3699306">[</span><span class="ident" id="3699307">i</span><span class="op" id="3699308">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699313">for</span>&nbsp;<span class="ident" id="3699317">j</span>&nbsp;<span class="op" id="3699319">:=</span>&nbsp;<span class="num" id="3699322">0</span><span class="op" id="3699323">;</span>&nbsp;<span class="ident" id="3699325">j</span>&nbsp;<span class="op" id="3699327">&lt;</span>&nbsp;<span class="ident" id="3699329">_W</span><span class="op" id="3699331">;</span>&nbsp;<span class="ident" id="3699333">j</span><span class="op" id="3699334">++</span>&nbsp;<span class="op" id="3699337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699342">zz</span>&nbsp;<span class="op" id="3699345">=</span>&nbsp;<span class="ident" id="3699347">zz</span><span class="op" id="3699349">.</span><span class="ident" id="3699350">mul</span><span class="op" id="3699353">(</span><span class="ident" id="3699354">z</span><span class="op" id="3699355">,</span>&nbsp;<span class="ident" id="3699357">z</span><span class="op" id="3699358">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699363">zz</span><span class="op" id="3699365">,</span>&nbsp;<span class="ident" id="3699367">z</span>&nbsp;<span class="op" id="3699369">=</span>&nbsp;<span class="ident" id="3699371">z</span><span class="op" id="3699372">,</span>&nbsp;<span class="ident" id="3699374">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699381">if</span>&nbsp;<span class="ident" id="3699384">v</span><span class="op" id="3699385">&amp;</span><span class="ident" id="3699386">mask</span>&nbsp;<span class="op" id="3699391">!=</span>&nbsp;<span class="num" id="3699394">0</span>&nbsp;<span class="op" id="3699396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699402">zz</span>&nbsp;<span class="op" id="3699405">=</span>&nbsp;<span class="ident" id="3699407">zz</span><span class="op" id="3699409">.</span><span class="ident" id="3699410">mul</span><span class="op" id="3699413">(</span><span class="ident" id="3699414">z</span><span class="op" id="3699415">,</span>&nbsp;<span class="ident" id="3699417">x</span><span class="op" id="3699418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699424">zz</span><span class="op" id="3699426">,</span>&nbsp;<span class="ident" id="3699428">z</span>&nbsp;<span class="op" id="3699430">=</span>&nbsp;<span class="ident" id="3699432">z</span><span class="op" id="3699433">,</span>&nbsp;<span class="ident" id="3699435">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699447">if</span>&nbsp;<span class="builtinfunc" id="3699450">len</span><span class="op" id="3699453">(</span><span class="ident" id="3699454">m</span><span class="op" id="3699455">)</span>&nbsp;<span class="op" id="3699457">!=</span>&nbsp;<span class="num" id="3699460">0</span>&nbsp;<span class="op" id="3699462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699468">zz</span><span class="op" id="3699470">,</span>&nbsp;<span class="ident" id="3699472">r</span>&nbsp;<span class="op" id="3699474">=</span>&nbsp;<span class="ident" id="3699476">zz</span><span class="op" id="3699478">.</span><span class="ident" id="3699479">div</span><span class="op" id="3699482">(</span><span class="ident" id="3699483">r</span><span class="op" id="3699484">,</span>&nbsp;<span class="ident" id="3699486">z</span><span class="op" id="3699487">,</span>&nbsp;<span class="ident" id="3699489">m</span><span class="op" id="3699490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699496">zz</span><span class="op" id="3699498">,</span>&nbsp;<span class="ident" id="3699500">r</span><span class="op" id="3699501">,</span>&nbsp;<span class="ident" id="3699503">q</span><span class="op" id="3699504">,</span>&nbsp;<span class="ident" id="3699506">z</span>&nbsp;<span class="op" id="3699508">=</span>&nbsp;<span class="ident" id="3699510">q</span><span class="op" id="3699511">,</span>&nbsp;<span class="ident" id="3699513">z</span><span class="op" id="3699514">,</span>&nbsp;<span class="ident" id="3699516">zz</span><span class="op" id="3699518">,</span>&nbsp;<span class="ident" id="3699520">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699531">v</span>&nbsp;<span class="op" id="3699533">&lt;&lt;=</span>&nbsp;<span class="num" id="3699537">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699544">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699548">return</span>&nbsp;<span class="ident" id="3699555">z</span><span class="op" id="3699556">.</span><span class="ident" id="3699557">norm</span><span class="op" id="3699561">(</span><span class="op" id="3699562">)</span><br>
<span class="lineno"></span><span class="op" id="3699564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3699567">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3699635">func</span>&nbsp;<span class="op" id="3699640">(</span><span class="ident" id="3699641">z</span>&nbsp;<span class="ident" id="3699643">nat</span><span class="op" id="3699646">)</span>&nbsp;<span class="ident" id="3699648">expNNWindowed</span><span class="op" id="3699661">(</span><span class="ident" id="3699662">x</span><span class="op" id="3699663">,</span>&nbsp;<span class="ident" id="3699665">y</span><span class="op" id="3699666">,</span>&nbsp;<span class="ident" id="3699668">m</span>&nbsp;<span class="ident" id="3699670">nat</span><span class="op" id="3699673">)</span>&nbsp;<span class="ident" id="3699675">nat</span>&nbsp;<span class="op" id="3699679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3699682">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3699752">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699783">var</span>&nbsp;<span class="ident" id="3699787">zz</span><span class="op" id="3699789">,</span>&nbsp;<span class="ident" id="3699791">r</span>&nbsp;<span class="ident" id="3699793">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699799">const</span>&nbsp;<span class="ident" id="3699805">n</span>&nbsp;<span class="op" id="3699807">=</span>&nbsp;<span class="num" id="3699809">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3699812">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699840">var</span>&nbsp;<span class="ident" id="3699844">powers</span>&nbsp;<span class="op" id="3699851">[</span><span class="num" id="3699852">1</span>&nbsp;<span class="op" id="3699854">&lt;&lt;</span>&nbsp;<span class="ident" id="3699857">n</span><span class="op" id="3699858">]</span><span class="ident" id="3699859">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699864">powers</span><span class="op" id="3699870">[</span><span class="num" id="3699871">0</span><span class="op" id="3699872">]</span>&nbsp;<span class="op" id="3699874">=</span>&nbsp;<span class="ident" id="3699876">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699884">powers</span><span class="op" id="3699890">[</span><span class="num" id="3699891">1</span><span class="op" id="3699892">]</span>&nbsp;<span class="op" id="3699894">=</span>&nbsp;<span class="ident" id="3699896">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3699899">for</span>&nbsp;<span class="ident" id="3699903">i</span>&nbsp;<span class="op" id="3699905">:=</span>&nbsp;<span class="num" id="3699908">2</span><span class="op" id="3699909">;</span>&nbsp;<span class="ident" id="3699911">i</span>&nbsp;<span class="op" id="3699913">&lt;</span>&nbsp;<span class="num" id="3699915">1</span><span class="op" id="3699916">&lt;&lt;</span><span class="ident" id="3699918">n</span><span class="op" id="3699919">;</span>&nbsp;<span class="ident" id="3699921">i</span>&nbsp;<span class="op" id="3699923">+=</span>&nbsp;<span class="num" id="3699926">2</span>&nbsp;<span class="op" id="3699928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3699932">p2</span><span class="op" id="3699934">,</span>&nbsp;<span class="ident" id="3699936">p</span><span class="op" id="3699937">,</span>&nbsp;<span class="ident" id="3699939">p1</span>&nbsp;<span class="op" id="3699942">:=</span>&nbsp;<span class="op" id="3699945">&amp;</span><span class="ident" id="3699946">powers</span><span class="op" id="3699952">[</span><span class="ident" id="3699953">i</span><span class="op" id="3699954">/</span><span class="num" id="3699955">2</span><span class="op" id="3699956">]</span><span class="op" id="3699957">,</span>&nbsp;<span class="op" id="3699959">&amp;</span><span class="ident" id="3699960">powers</span><span class="op" id="3699966">[</span><span class="ident" id="3699967">i</span><span class="op" id="3699968">]</span><span class="op" id="3699969">,</span>&nbsp;<span class="op" id="3699971">&amp;</span><span class="ident" id="3699972">powers</span><span class="op" id="3699978">[</span><span class="ident" id="3699979">i</span><span class="op" id="3699980">+</span><span class="num" id="3699981">1</span><span class="op" id="3699982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3699986">*</span><span class="ident" id="3699987">p</span>&nbsp;<span class="op" id="3699989">=</span>&nbsp;<span class="ident" id="3699991">p</span><span class="op" id="3699992">.</span><span class="ident" id="3699993">mul</span><span class="op" id="3699996">(</span><span class="op" id="3699997">*</span><span class="ident" id="3699998">p2</span><span class="op" id="3700000">,</span>&nbsp;<span class="op" id="3700002">*</span><span class="ident" id="3700003">p2</span><span class="op" id="3700005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700009">zz</span><span class="op" id="3700011">,</span>&nbsp;<span class="ident" id="3700013">r</span>&nbsp;<span class="op" id="3700015">=</span>&nbsp;<span class="ident" id="3700017">zz</span><span class="op" id="3700019">.</span><span class="ident" id="3700020">div</span><span class="op" id="3700023">(</span><span class="ident" id="3700024">r</span><span class="op" id="3700025">,</span>&nbsp;<span class="op" id="3700027">*</span><span class="ident" id="3700028">p</span><span class="op" id="3700029">,</span>&nbsp;<span class="ident" id="3700031">m</span><span class="op" id="3700032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700036">*</span><span class="ident" id="3700037">p</span><span class="op" id="3700038">,</span>&nbsp;<span class="ident" id="3700040">r</span>&nbsp;<span class="op" id="3700042">=</span>&nbsp;<span class="ident" id="3700044">r</span><span class="op" id="3700045">,</span>&nbsp;<span class="op" id="3700047">*</span><span class="ident" id="3700048">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700052">*</span><span class="ident" id="3700053">p1</span>&nbsp;<span class="op" id="3700056">=</span>&nbsp;<span class="ident" id="3700058">p1</span><span class="op" id="3700060">.</span><span class="ident" id="3700061">mul</span><span class="op" id="3700064">(</span><span class="op" id="3700065">*</span><span class="ident" id="3700066">p</span><span class="op" id="3700067">,</span>&nbsp;<span class="ident" id="3700069">x</span><span class="op" id="3700070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700074">zz</span><span class="op" id="3700076">,</span>&nbsp;<span class="ident" id="3700078">r</span>&nbsp;<span class="op" id="3700080">=</span>&nbsp;<span class="ident" id="3700082">zz</span><span class="op" id="3700084">.</span><span class="ident" id="3700085">div</span><span class="op" id="3700088">(</span><span class="ident" id="3700089">r</span><span class="op" id="3700090">,</span>&nbsp;<span class="op" id="3700092">*</span><span class="ident" id="3700093">p1</span><span class="op" id="3700095">,</span>&nbsp;<span class="ident" id="3700097">m</span><span class="op" id="3700098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700102">*</span><span class="ident" id="3700103">p1</span><span class="op" id="3700105">,</span>&nbsp;<span class="ident" id="3700107">r</span>&nbsp;<span class="op" id="3700109">=</span>&nbsp;<span class="ident" id="3700111">r</span><span class="op" id="3700112">,</span>&nbsp;<span class="op" id="3700114">*</span><span class="ident" id="3700115">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700123">z</span>&nbsp;<span class="op" id="3700125">=</span>&nbsp;<span class="ident" id="3700127">z</span><span class="op" id="3700128">.</span><span class="ident" id="3700129">setWord</span><span class="op" id="3700136">(</span><span class="num" id="3700137">1</span><span class="op" id="3700138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700142">for</span>&nbsp;<span class="ident" id="3700146">i</span>&nbsp;<span class="op" id="3700148">:=</span>&nbsp;<span class="builtinfunc" id="3700151">len</span><span class="op" id="3700154">(</span><span class="ident" id="3700155">y</span><span class="op" id="3700156">)</span>&nbsp;<span class="op" id="3700158">-</span>&nbsp;<span class="num" id="3700160">1</span><span class="op" id="3700161">;</span>&nbsp;<span class="ident" id="3700163">i</span>&nbsp;<span class="op" id="3700165">&gt;=</span>&nbsp;<span class="num" id="3700168">0</span><span class="op" id="3700169">;</span>&nbsp;<span class="ident" id="3700171">i</span><span class="op" id="3700172">--</span>&nbsp;<span class="op" id="3700175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700179">yi</span>&nbsp;<span class="op" id="3700182">:=</span>&nbsp;<span class="ident" id="3700185">y</span><span class="op" id="3700186">[</span><span class="ident" id="3700187">i</span><span class="op" id="3700188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700192">for</span>&nbsp;<span class="ident" id="3700196">j</span>&nbsp;<span class="op" id="3700198">:=</span>&nbsp;<span class="num" id="3700201">0</span><span class="op" id="3700202">;</span>&nbsp;<span class="ident" id="3700204">j</span>&nbsp;<span class="op" id="3700206">&lt;</span>&nbsp;<span class="ident" id="3700208">_W</span><span class="op" id="3700210">;</span>&nbsp;<span class="ident" id="3700212">j</span>&nbsp;<span class="op" id="3700214">+=</span>&nbsp;<span class="ident" id="3700217">n</span>&nbsp;<span class="op" id="3700219">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700224">if</span>&nbsp;<span class="ident" id="3700227">i</span>&nbsp;<span class="op" id="3700229">!=</span>&nbsp;<span class="builtinfunc" id="3700232">len</span><span class="op" id="3700235">(</span><span class="ident" id="3700236">y</span><span class="op" id="3700237">)</span><span class="op" id="3700238">-</span><span class="num" id="3700239">1</span>&nbsp;<span class="op" id="3700241">||</span>&nbsp;<span class="ident" id="3700244">j</span>&nbsp;<span class="op" id="3700246">!=</span>&nbsp;<span class="num" id="3700249">0</span>&nbsp;<span class="op" id="3700251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700257">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700306">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3700358">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700409">zz</span>&nbsp;<span class="op" id="3700412">=</span>&nbsp;<span class="ident" id="3700414">zz</span><span class="op" id="3700416">.</span><span class="ident" id="3700417">mul</span><span class="op" id="3700420">(</span><span class="ident" id="3700421">z</span><span class="op" id="3700422">,</span>&nbsp;<span class="ident" id="3700424">z</span><span class="op" id="3700425">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700431">zz</span><span class="op" id="3700433">,</span>&nbsp;<span class="ident" id="3700435">z</span>&nbsp;<span class="op" id="3700437">=</span>&nbsp;<span class="ident" id="3700439">z</span><span class="op" id="3700440">,</span>&nbsp;<span class="ident" id="3700442">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700449">zz</span><span class="op" id="3700451">,</span>&nbsp;<span class="ident" id="3700453">r</span>&nbsp;<span class="op" id="3700455">=</span>&nbsp;<span class="ident" id="3700457">zz</span><span class="op" id="3700459">.</span><span class="ident" id="3700460">div</span><span class="op" id="3700463">(</span><span class="ident" id="3700464">r</span><span class="op" id="3700465">,</span>&nbsp;<span class="ident" id="3700467">z</span><span class="op" id="3700468">,</span>&nbsp;<span class="ident" id="3700470">m</span><span class="op" id="3700471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700477">z</span><span class="op" id="3700478">,</span>&nbsp;<span class="ident" id="3700480">r</span>&nbsp;<span class="op" id="3700482">=</span>&nbsp;<span class="ident" id="3700484">r</span><span class="op" id="3700485">,</span>&nbsp;<span class="ident" id="3700487">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700494">zz</span>&nbsp;<span class="op" id="3700497">=</span>&nbsp;<span class="ident" id="3700499">zz</span><span class="op" id="3700501">.</span><span class="ident" id="3700502">mul</span><span class="op" id="3700505">(</span><span class="ident" id="3700506">z</span><span class="op" id="3700507">,</span>&nbsp;<span class="ident" id="3700509">z</span><span class="op" id="3700510">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700516">zz</span><span class="op" id="3700518">,</span>&nbsp;<span class="ident" id="3700520">z</span>&nbsp;<span class="op" id="3700522">=</span>&nbsp;<span class="ident" id="3700524">z</span><span class="op" id="3700525">,</span>&nbsp;<span class="ident" id="3700527">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700534">zz</span><span class="op" id="3700536">,</span>&nbsp;<span class="ident" id="3700538">r</span>&nbsp;<span class="op" id="3700540">=</span>&nbsp;<span class="ident" id="3700542">zz</span><span class="op" id="3700544">.</span><span class="ident" id="3700545">div</span><span class="op" id="3700548">(</span><span class="ident" id="3700549">r</span><span class="op" id="3700550">,</span>&nbsp;<span class="ident" id="3700552">z</span><span class="op" id="3700553">,</span>&nbsp;<span class="ident" id="3700555">m</span><span class="op" id="3700556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700562">z</span><span class="op" id="3700563">,</span>&nbsp;<span class="ident" id="3700565">r</span>&nbsp;<span class="op" id="3700567">=</span>&nbsp;<span class="ident" id="3700569">r</span><span class="op" id="3700570">,</span>&nbsp;<span class="ident" id="3700572">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700579">zz</span>&nbsp;<span class="op" id="3700582">=</span>&nbsp;<span class="ident" id="3700584">zz</span><span class="op" id="3700586">.</span><span class="ident" id="3700587">mul</span><span class="op" id="3700590">(</span><span class="ident" id="3700591">z</span><span class="op" id="3700592">,</span>&nbsp;<span class="ident" id="3700594">z</span><span class="op" id="3700595">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700601">zz</span><span class="op" id="3700603">,</span>&nbsp;<span class="ident" id="3700605">z</span>&nbsp;<span class="op" id="3700607">=</span>&nbsp;<span class="ident" id="3700609">z</span><span class="op" id="3700610">,</span>&nbsp;<span class="ident" id="3700612">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700619">zz</span><span class="op" id="3700621">,</span>&nbsp;<span class="ident" id="3700623">r</span>&nbsp;<span class="op" id="3700625">=</span>&nbsp;<span class="ident" id="3700627">zz</span><span class="op" id="3700629">.</span><span class="ident" id="3700630">div</span><span class="op" id="3700633">(</span><span class="ident" id="3700634">r</span><span class="op" id="3700635">,</span>&nbsp;<span class="ident" id="3700637">z</span><span class="op" id="3700638">,</span>&nbsp;<span class="ident" id="3700640">m</span><span class="op" id="3700641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700647">z</span><span class="op" id="3700648">,</span>&nbsp;<span class="ident" id="3700650">r</span>&nbsp;<span class="op" id="3700652">=</span>&nbsp;<span class="ident" id="3700654">r</span><span class="op" id="3700655">,</span>&nbsp;<span class="ident" id="3700657">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700664">zz</span>&nbsp;<span class="op" id="3700667">=</span>&nbsp;<span class="ident" id="3700669">zz</span><span class="op" id="3700671">.</span><span class="ident" id="3700672">mul</span><span class="op" id="3700675">(</span><span class="ident" id="3700676">z</span><span class="op" id="3700677">,</span>&nbsp;<span class="ident" id="3700679">z</span><span class="op" id="3700680">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700686">zz</span><span class="op" id="3700688">,</span>&nbsp;<span class="ident" id="3700690">z</span>&nbsp;<span class="op" id="3700692">=</span>&nbsp;<span class="ident" id="3700694">z</span><span class="op" id="3700695">,</span>&nbsp;<span class="ident" id="3700697">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700704">zz</span><span class="op" id="3700706">,</span>&nbsp;<span class="ident" id="3700708">r</span>&nbsp;<span class="op" id="3700710">=</span>&nbsp;<span class="ident" id="3700712">zz</span><span class="op" id="3700714">.</span><span class="ident" id="3700715">div</span><span class="op" id="3700718">(</span><span class="ident" id="3700719">r</span><span class="op" id="3700720">,</span>&nbsp;<span class="ident" id="3700722">z</span><span class="op" id="3700723">,</span>&nbsp;<span class="ident" id="3700725">m</span><span class="op" id="3700726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700732">z</span><span class="op" id="3700733">,</span>&nbsp;<span class="ident" id="3700735">r</span>&nbsp;<span class="op" id="3700737">=</span>&nbsp;<span class="ident" id="3700739">r</span><span class="op" id="3700740">,</span>&nbsp;<span class="ident" id="3700742">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700753">zz</span>&nbsp;<span class="op" id="3700756">=</span>&nbsp;<span class="ident" id="3700758">zz</span><span class="op" id="3700760">.</span><span class="ident" id="3700761">mul</span><span class="op" id="3700764">(</span><span class="ident" id="3700765">z</span><span class="op" id="3700766">,</span>&nbsp;<span class="ident" id="3700768">powers</span><span class="op" id="3700774">[</span><span class="ident" id="3700775">yi</span><span class="op" id="3700777">&gt;&gt;</span><span class="op" id="3700779">(</span><span class="ident" id="3700780">_W</span><span class="op" id="3700782">-</span><span class="ident" id="3700783">n</span><span class="op" id="3700784">)</span><span class="op" id="3700785">]</span><span class="op" id="3700786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700791">zz</span><span class="op" id="3700793">,</span>&nbsp;<span class="ident" id="3700795">z</span>&nbsp;<span class="op" id="3700797">=</span>&nbsp;<span class="ident" id="3700799">z</span><span class="op" id="3700800">,</span>&nbsp;<span class="ident" id="3700802">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700808">zz</span><span class="op" id="3700810">,</span>&nbsp;<span class="ident" id="3700812">r</span>&nbsp;<span class="op" id="3700814">=</span>&nbsp;<span class="ident" id="3700816">zz</span><span class="op" id="3700818">.</span><span class="ident" id="3700819">div</span><span class="op" id="3700822">(</span><span class="ident" id="3700823">r</span><span class="op" id="3700824">,</span>&nbsp;<span class="ident" id="3700826">z</span><span class="op" id="3700827">,</span>&nbsp;<span class="ident" id="3700829">m</span><span class="op" id="3700830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700835">z</span><span class="op" id="3700836">,</span>&nbsp;<span class="ident" id="3700838">r</span>&nbsp;<span class="op" id="3700840">=</span>&nbsp;<span class="ident" id="3700842">r</span><span class="op" id="3700843">,</span>&nbsp;<span class="ident" id="3700845">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3700851">yi</span>&nbsp;<span class="op" id="3700854">&lt;&lt;=</span>&nbsp;<span class="ident" id="3700858">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3700865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3700869">return</span>&nbsp;<span class="ident" id="3700876">z</span><span class="op" id="3700877">.</span><span class="ident" id="3700878">norm</span><span class="op" id="3700882">(</span><span class="op" id="3700883">)</span><br>
<span class="lineno">1380</span><span class="op" id="3700885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700888">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3700967">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3701032">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3701072">func</span>&nbsp;<span class="op" id="3701077">(</span><span class="ident" id="3701078">n</span>&nbsp;<span class="ident" id="3701080">nat</span><span class="op" id="3701083">)</span>&nbsp;<span class="ident" id="3701085">probablyPrime</span><span class="op" id="3701098">(</span><span class="ident" id="3701099">reps</span>&nbsp;<span class="builtintype" id="3701104">int</span><span class="op" id="3701107">)</span>&nbsp;<span class="builtintype" id="3701109">bool</span>&nbsp;<span class="op" id="3701114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701117">if</span>&nbsp;<span class="builtinfunc" id="3701120">len</span><span class="op" id="3701123">(</span><span class="ident" id="3701124">n</span><span class="op" id="3701125">)</span>&nbsp;<span class="op" id="3701127">==</span>&nbsp;<span class="num" id="3701130">0</span>&nbsp;<span class="op" id="3701132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701136">return</span>&nbsp;<span class="builtintype" id="3701143">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701154">if</span>&nbsp;<span class="builtinfunc" id="3701157">len</span><span class="op" id="3701160">(</span><span class="ident" id="3701161">n</span><span class="op" id="3701162">)</span>&nbsp;<span class="op" id="3701164">==</span>&nbsp;<span class="num" id="3701167">1</span>&nbsp;<span class="op" id="3701169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701173">if</span>&nbsp;<span class="ident" id="3701176">n</span><span class="op" id="3701177">[</span><span class="num" id="3701178">0</span><span class="op" id="3701179">]</span>&nbsp;<span class="op" id="3701181">&lt;</span>&nbsp;<span class="num" id="3701183">2</span>&nbsp;<span class="op" id="3701185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701190">return</span>&nbsp;<span class="builtintype" id="3701197">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701210">if</span>&nbsp;<span class="ident" id="3701213">n</span><span class="op" id="3701214">[</span><span class="num" id="3701215">0</span><span class="op" id="3701216">]</span><span class="op" id="3701217">%</span><span class="num" id="3701218">2</span>&nbsp;<span class="op" id="3701220">==</span>&nbsp;<span class="num" id="3701223">0</span>&nbsp;<span class="op" id="3701225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701230">return</span>&nbsp;<span class="ident" id="3701237">n</span><span class="op" id="3701238">[</span><span class="num" id="3701239">0</span><span class="op" id="3701240">]</span>&nbsp;<span class="op" id="3701242">==</span>&nbsp;<span class="num" id="3701245">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701254">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701312">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701351">switch</span>&nbsp;<span class="ident" id="3701358">n</span><span class="op" id="3701359">[</span><span class="num" id="3701360">0</span><span class="op" id="3701361">]</span>&nbsp;<span class="op" id="3701363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701367">case</span>&nbsp;<span class="num" id="3701372">3</span><span class="op" id="3701373">,</span>&nbsp;<span class="num" id="3701375">5</span><span class="op" id="3701376">,</span>&nbsp;<span class="num" id="3701378">7</span><span class="op" id="3701379">,</span>&nbsp;<span class="num" id="3701381">11</span><span class="op" id="3701383">,</span>&nbsp;<span class="num" id="3701385">13</span><span class="op" id="3701387">,</span>&nbsp;<span class="num" id="3701389">17</span><span class="op" id="3701391">,</span>&nbsp;<span class="num" id="3701393">19</span><span class="op" id="3701395">,</span>&nbsp;<span class="num" id="3701397">23</span><span class="op" id="3701399">,</span>&nbsp;<span class="num" id="3701401">29</span><span class="op" id="3701403">,</span>&nbsp;<span class="num" id="3701405">31</span><span class="op" id="3701407">,</span>&nbsp;<span class="num" id="3701409">37</span><span class="op" id="3701411">,</span>&nbsp;<span class="num" id="3701413">41</span><span class="op" id="3701415">,</span>&nbsp;<span class="num" id="3701417">43</span><span class="op" id="3701419">,</span>&nbsp;<span class="num" id="3701421">47</span><span class="op" id="3701423">,</span>&nbsp;<span class="num" id="3701425">53</span><span class="op" id="3701427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701432">return</span>&nbsp;<span class="builtintype" id="3701439">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701446">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701453">const</span>&nbsp;<span class="ident" id="3701459">primesProduct32</span>&nbsp;<span class="op" id="3701475">=</span>&nbsp;<span class="num" id="3701477">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3701496">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701531">const</span>&nbsp;<span class="ident" id="3701537">primesProduct64</span>&nbsp;<span class="op" id="3701553">=</span>&nbsp;<span class="num" id="3701555">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3701574">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701610">var</span>&nbsp;<span class="ident" id="3701614">r</span>&nbsp;<span class="ident" id="3701616">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701622">switch</span>&nbsp;<span class="ident" id="3701629">_W</span>&nbsp;<span class="op" id="3701632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701635">case</span>&nbsp;<span class="num" id="3701640">32</span><span class="op" id="3701642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701646">r</span>&nbsp;<span class="op" id="3701648">=</span>&nbsp;<span class="ident" id="3701650">n</span><span class="op" id="3701651">.</span><span class="ident" id="3701652">modW</span><span class="op" id="3701656">(</span><span class="ident" id="3701657">primesProduct32</span><span class="op" id="3701672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701675">case</span>&nbsp;<span class="num" id="3701680">64</span><span class="op" id="3701682">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701686">r</span>&nbsp;<span class="op" id="3701688">=</span>&nbsp;<span class="ident" id="3701690">n</span><span class="op" id="3701691">.</span><span class="ident" id="3701692">modW</span><span class="op" id="3701696">(</span><span class="ident" id="3701697">primesProduct64</span>&nbsp;<span class="op" id="3701713">&amp;</span>&nbsp;<span class="ident" id="3701715">_M</span><span class="op" id="3701717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701720">default</span><span class="op" id="3701727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3701731">panic</span><span class="op" id="3701736">(</span><span class="string" id="3701737">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3701756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701763">if</span>&nbsp;<span class="ident" id="3701766">r</span><span class="op" id="3701767">%</span><span class="num" id="3701768">3</span>&nbsp;<span class="op" id="3701770">==</span>&nbsp;<span class="num" id="3701773">0</span>&nbsp;<span class="op" id="3701775">||</span>&nbsp;<span class="ident" id="3701778">r</span><span class="op" id="3701779">%</span><span class="num" id="3701780">5</span>&nbsp;<span class="op" id="3701782">==</span>&nbsp;<span class="num" id="3701785">0</span>&nbsp;<span class="op" id="3701787">||</span>&nbsp;<span class="ident" id="3701790">r</span><span class="op" id="3701791">%</span><span class="num" id="3701792">7</span>&nbsp;<span class="op" id="3701794">==</span>&nbsp;<span class="num" id="3701797">0</span>&nbsp;<span class="op" id="3701799">||</span>&nbsp;<span class="ident" id="3701802">r</span><span class="op" id="3701803">%</span><span class="num" id="3701804">11</span>&nbsp;<span class="op" id="3701807">==</span>&nbsp;<span class="num" id="3701810">0</span>&nbsp;<span class="op" id="3701812">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701817">r</span><span class="op" id="3701818">%</span><span class="num" id="3701819">13</span>&nbsp;<span class="op" id="3701822">==</span>&nbsp;<span class="num" id="3701825">0</span>&nbsp;<span class="op" id="3701827">||</span>&nbsp;<span class="ident" id="3701830">r</span><span class="op" id="3701831">%</span><span class="num" id="3701832">17</span>&nbsp;<span class="op" id="3701835">==</span>&nbsp;<span class="num" id="3701838">0</span>&nbsp;<span class="op" id="3701840">||</span>&nbsp;<span class="ident" id="3701843">r</span><span class="op" id="3701844">%</span><span class="num" id="3701845">19</span>&nbsp;<span class="op" id="3701848">==</span>&nbsp;<span class="num" id="3701851">0</span>&nbsp;<span class="op" id="3701853">||</span>&nbsp;<span class="ident" id="3701856">r</span><span class="op" id="3701857">%</span><span class="num" id="3701858">23</span>&nbsp;<span class="op" id="3701861">==</span>&nbsp;<span class="num" id="3701864">0</span>&nbsp;<span class="op" id="3701866">||</span>&nbsp;<span class="ident" id="3701869">r</span><span class="op" id="3701870">%</span><span class="num" id="3701871">29</span>&nbsp;<span class="op" id="3701874">==</span>&nbsp;<span class="num" id="3701877">0</span>&nbsp;<span class="op" id="3701879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701883">return</span>&nbsp;<span class="builtintype" id="3701890">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3701897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701901">if</span>&nbsp;<span class="ident" id="3701904">_W</span>&nbsp;<span class="op" id="3701907">==</span>&nbsp;<span class="num" id="3701910">64</span>&nbsp;<span class="op" id="3701913">&amp;&amp;</span>&nbsp;<span class="op" id="3701916">(</span><span class="ident" id="3701917">r</span><span class="op" id="3701918">%</span><span class="num" id="3701919">31</span>&nbsp;<span class="op" id="3701922">==</span>&nbsp;<span class="num" id="3701925">0</span>&nbsp;<span class="op" id="3701927">||</span>&nbsp;<span class="ident" id="3701930">r</span><span class="op" id="3701931">%</span><span class="num" id="3701932">37</span>&nbsp;<span class="op" id="3701935">==</span>&nbsp;<span class="num" id="3701938">0</span>&nbsp;<span class="op" id="3701940">||</span>&nbsp;<span class="ident" id="3701943">r</span><span class="op" id="3701944">%</span><span class="num" id="3701945">41</span>&nbsp;<span class="op" id="3701948">==</span>&nbsp;<span class="num" id="3701951">0</span>&nbsp;<span class="op" id="3701953">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701958">r</span><span class="op" id="3701959">%</span><span class="num" id="3701960">43</span>&nbsp;<span class="op" id="3701963">==</span>&nbsp;<span class="num" id="3701966">0</span>&nbsp;<span class="op" id="3701968">||</span>&nbsp;<span class="ident" id="3701971">r</span><span class="op" id="3701972">%</span><span class="num" id="3701973">47</span>&nbsp;<span class="op" id="3701976">==</span>&nbsp;<span class="num" id="3701979">0</span>&nbsp;<span class="op" id="3701981">||</span>&nbsp;<span class="ident" id="3701984">r</span><span class="op" id="3701985">%</span><span class="num" id="3701986">53</span>&nbsp;<span class="op" id="3701989">==</span>&nbsp;<span class="num" id="3701992">0</span><span class="op" id="3701993">)</span>&nbsp;<span class="op" id="3701995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3701999">return</span>&nbsp;<span class="builtintype" id="3702006">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702017">nm1</span>&nbsp;<span class="op" id="3702021">:=</span>&nbsp;<span class="ident" id="3702024">nat</span><span class="op" id="3702027">(</span><span class="ident" id="3702028">nil</span><span class="op" id="3702031">)</span><span class="op" id="3702032">.</span><span class="ident" id="3702033">sub</span><span class="op" id="3702036">(</span><span class="ident" id="3702037">n</span><span class="op" id="3702038">,</span>&nbsp;<span class="ident" id="3702040">natOne</span><span class="op" id="3702046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702049">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702091">k</span>&nbsp;<span class="op" id="3702093">:=</span>&nbsp;<span class="ident" id="3702096">nm1</span><span class="op" id="3702099">.</span><span class="ident" id="3702100">trailingZeroBits</span><span class="op" id="3702116">(</span><span class="op" id="3702117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702120">q</span>&nbsp;<span class="op" id="3702122">:=</span>&nbsp;<span class="ident" id="3702125">nat</span><span class="op" id="3702128">(</span><span class="ident" id="3702129">nil</span><span class="op" id="3702132">)</span><span class="op" id="3702133">.</span><span class="ident" id="3702134">shr</span><span class="op" id="3702137">(</span><span class="ident" id="3702138">nm1</span><span class="op" id="3702141">,</span>&nbsp;<span class="ident" id="3702143">k</span><span class="op" id="3702144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702148">nm3</span>&nbsp;<span class="op" id="3702152">:=</span>&nbsp;<span class="ident" id="3702155">nat</span><span class="op" id="3702158">(</span><span class="ident" id="3702159">nil</span><span class="op" id="3702162">)</span><span class="op" id="3702163">.</span><span class="ident" id="3702164">sub</span><span class="op" id="3702167">(</span><span class="ident" id="3702168">nm1</span><span class="op" id="3702171">,</span>&nbsp;<span class="ident" id="3702173">natTwo</span><span class="op" id="3702179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702182">rand</span>&nbsp;<span class="op" id="3702187">:=</span>&nbsp;<span class="ident" id="3702190">rand</span><span class="op" id="3702194">.</span><span class="ident" id="3702195">New</span><span class="op" id="3702198">(</span><span class="ident" id="3702199">rand</span><span class="op" id="3702203">.</span><span class="ident" id="3702204">NewSource</span><span class="op" id="3702213">(</span><span class="ident" id="3702214">int64</span><span class="op" id="3702219">(</span><span class="ident" id="3702220">n</span><span class="op" id="3702221">[</span><span class="num" id="3702222">0</span><span class="op" id="3702223">]</span><span class="op" id="3702224">)</span><span class="op" id="3702225">)</span><span class="op" id="3702226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702230">var</span>&nbsp;<span class="ident" id="3702234">x</span><span class="op" id="3702235">,</span>&nbsp;<span class="ident" id="3702237">y</span><span class="op" id="3702238">,</span>&nbsp;<span class="ident" id="3702240">quotient</span>&nbsp;<span class="ident" id="3702249">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702254">nm3Len</span>&nbsp;<span class="op" id="3702261">:=</span>&nbsp;<span class="ident" id="3702264">nm3</span><span class="op" id="3702267">.</span><span class="ident" id="3702268">bitLen</span><span class="op" id="3702274">(</span><span class="op" id="3702275">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3702278">NextRandom</span><span class="op" id="3702288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702291">for</span>&nbsp;<span class="ident" id="3702295">i</span>&nbsp;<span class="op" id="3702297">:=</span>&nbsp;<span class="num" id="3702300">0</span><span class="op" id="3702301">;</span>&nbsp;<span class="ident" id="3702303">i</span>&nbsp;<span class="op" id="3702305">&lt;</span>&nbsp;<span class="ident" id="3702307">reps</span><span class="op" id="3702311">;</span>&nbsp;<span class="ident" id="3702313">i</span><span class="op" id="3702314">++</span>&nbsp;<span class="op" id="3702317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702321">x</span>&nbsp;<span class="op" id="3702323">=</span>&nbsp;<span class="ident" id="3702325">x</span><span class="op" id="3702326">.</span><span class="ident" id="3702327">random</span><span class="op" id="3702333">(</span><span class="ident" id="3702334">rand</span><span class="op" id="3702338">,</span>&nbsp;<span class="ident" id="3702340">nm3</span><span class="op" id="3702343">,</span>&nbsp;<span class="ident" id="3702345">nm3Len</span><span class="op" id="3702351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702355">x</span>&nbsp;<span class="op" id="3702357">=</span>&nbsp;<span class="ident" id="3702359">x</span><span class="op" id="3702360">.</span><span class="ident" id="3702361">add</span><span class="op" id="3702364">(</span><span class="ident" id="3702365">x</span><span class="op" id="3702366">,</span>&nbsp;<span class="ident" id="3702368">natTwo</span><span class="op" id="3702374">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702378">y</span>&nbsp;<span class="op" id="3702380">=</span>&nbsp;<span class="ident" id="3702382">y</span><span class="op" id="3702383">.</span><span class="ident" id="3702384">expNN</span><span class="op" id="3702389">(</span><span class="ident" id="3702390">x</span><span class="op" id="3702391">,</span>&nbsp;<span class="ident" id="3702393">q</span><span class="op" id="3702394">,</span>&nbsp;<span class="ident" id="3702396">n</span><span class="op" id="3702397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702401">if</span>&nbsp;<span class="ident" id="3702404">y</span><span class="op" id="3702405">.</span><span class="ident" id="3702406">cmp</span><span class="op" id="3702409">(</span><span class="ident" id="3702410">natOne</span><span class="op" id="3702416">)</span>&nbsp;<span class="op" id="3702418">==</span>&nbsp;<span class="num" id="3702421">0</span>&nbsp;<span class="op" id="3702423">||</span>&nbsp;<span class="ident" id="3702426">y</span><span class="op" id="3702427">.</span><span class="ident" id="3702428">cmp</span><span class="op" id="3702431">(</span><span class="ident" id="3702432">nm1</span><span class="op" id="3702435">)</span>&nbsp;<span class="op" id="3702437">==</span>&nbsp;<span class="num" id="3702440">0</span>&nbsp;<span class="op" id="3702442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702447">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702462">for</span>&nbsp;<span class="ident" id="3702466">j</span>&nbsp;<span class="op" id="3702468">:=</span>&nbsp;<span class="builtintype" id="3702471">uint</span><span class="op" id="3702475">(</span><span class="num" id="3702476">1</span><span class="op" id="3702477">)</span><span class="op" id="3702478">;</span>&nbsp;<span class="ident" id="3702480">j</span>&nbsp;<span class="op" id="3702482">&lt;</span>&nbsp;<span class="ident" id="3702484">k</span><span class="op" id="3702485">;</span>&nbsp;<span class="ident" id="3702487">j</span><span class="op" id="3702488">++</span>&nbsp;<span class="op" id="3702491">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702496">y</span>&nbsp;<span class="op" id="3702498">=</span>&nbsp;<span class="ident" id="3702500">y</span><span class="op" id="3702501">.</span><span class="ident" id="3702502">mul</span><span class="op" id="3702505">(</span><span class="ident" id="3702506">y</span><span class="op" id="3702507">,</span>&nbsp;<span class="ident" id="3702509">y</span><span class="op" id="3702510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702515">quotient</span><span class="op" id="3702523">,</span>&nbsp;<span class="ident" id="3702525">y</span>&nbsp;<span class="op" id="3702527">=</span>&nbsp;<span class="ident" id="3702529">quotient</span><span class="op" id="3702537">.</span><span class="ident" id="3702538">div</span><span class="op" id="3702541">(</span><span class="ident" id="3702542">y</span><span class="op" id="3702543">,</span>&nbsp;<span class="ident" id="3702545">y</span><span class="op" id="3702546">,</span>&nbsp;<span class="ident" id="3702548">n</span><span class="op" id="3702549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702554">if</span>&nbsp;<span class="ident" id="3702557">y</span><span class="op" id="3702558">.</span><span class="ident" id="3702559">cmp</span><span class="op" id="3702562">(</span><span class="ident" id="3702563">nm1</span><span class="op" id="3702566">)</span>&nbsp;<span class="op" id="3702568">==</span>&nbsp;<span class="num" id="3702571">0</span>&nbsp;<span class="op" id="3702573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702579">continue</span>&nbsp;<span class="ident" id="3702588">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702602">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702607">if</span>&nbsp;<span class="ident" id="3702610">y</span><span class="op" id="3702611">.</span><span class="ident" id="3702612">cmp</span><span class="op" id="3702615">(</span><span class="ident" id="3702616">natOne</span><span class="op" id="3702622">)</span>&nbsp;<span class="op" id="3702624">==</span>&nbsp;<span class="num" id="3702627">0</span>&nbsp;<span class="op" id="3702629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702635">return</span>&nbsp;<span class="builtintype" id="3702642">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702659">return</span>&nbsp;<span class="builtintype" id="3702666">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702677">return</span>&nbsp;<span class="builtintype" id="3702684">true</span><br>
<span class="lineno"></span><span class="op" id="3702689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3702692">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3702759">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3702826">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3702893">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3702923">func</span>&nbsp;<span class="op" id="3702928">(</span><span class="ident" id="3702929">z</span>&nbsp;<span class="ident" id="3702931">nat</span><span class="op" id="3702934">)</span>&nbsp;<span class="ident" id="3702936">bytes</span><span class="op" id="3702941">(</span><span class="ident" id="3702942">buf</span>&nbsp;<span class="op" id="3702946">[</span><span class="op" id="3702947">]</span><span class="builtintype" id="3702948">byte</span><span class="op" id="3702952">)</span>&nbsp;<span class="op" id="3702954">(</span><span class="ident" id="3702955">i</span>&nbsp;<span class="builtintype" id="3702957">int</span><span class="op" id="3702960">)</span>&nbsp;<span class="op" id="3702962">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702965">i</span>&nbsp;<span class="op" id="3702967">=</span>&nbsp;<span class="builtinfunc" id="3702969">len</span><span class="op" id="3702972">(</span><span class="ident" id="3702973">buf</span><span class="op" id="3702976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702979">for</span>&nbsp;<span class="ident" id="3702983">_</span><span class="op" id="3702984">,</span>&nbsp;<span class="ident" id="3702986">d</span>&nbsp;<span class="op" id="3702988">:=</span>&nbsp;<span class="keyword" id="3702991">range</span>&nbsp;<span class="ident" id="3702997">z</span>&nbsp;<span class="op" id="3702999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703003">for</span>&nbsp;<span class="ident" id="3703007">j</span>&nbsp;<span class="op" id="3703009">:=</span>&nbsp;<span class="num" id="3703012">0</span><span class="op" id="3703013">;</span>&nbsp;<span class="ident" id="3703015">j</span>&nbsp;<span class="op" id="3703017">&lt;</span>&nbsp;<span class="ident" id="3703019">_S</span><span class="op" id="3703021">;</span>&nbsp;<span class="ident" id="3703023">j</span><span class="op" id="3703024">++</span>&nbsp;<span class="op" id="3703027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703032">i</span><span class="op" id="3703033">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703039">buf</span><span class="op" id="3703042">[</span><span class="ident" id="3703043">i</span><span class="op" id="3703044">]</span>&nbsp;<span class="op" id="3703046">=</span>&nbsp;<span class="builtintype" id="3703048">byte</span><span class="op" id="3703052">(</span><span class="ident" id="3703053">d</span><span class="op" id="3703054">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703059">d</span>&nbsp;<span class="op" id="3703061">&gt;&gt;=</span>&nbsp;<span class="num" id="3703065">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703076">for</span>&nbsp;<span class="ident" id="3703080">i</span>&nbsp;<span class="op" id="3703082">&lt;</span>&nbsp;<span class="builtinfunc" id="3703084">len</span><span class="op" id="3703087">(</span><span class="ident" id="3703088">buf</span><span class="op" id="3703091">)</span>&nbsp;<span class="op" id="3703093">&amp;&amp;</span>&nbsp;<span class="ident" id="3703096">buf</span><span class="op" id="3703099">[</span><span class="ident" id="3703100">i</span><span class="op" id="3703101">]</span>&nbsp;<span class="op" id="3703103">==</span>&nbsp;<span class="num" id="3703106">0</span>&nbsp;<span class="op" id="3703108">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703112">i</span><span class="op" id="3703113">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703121">return</span><br>
<span class="lineno"></span><span class="op" id="3703128">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3703131">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3703196">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3703245">func</span>&nbsp;<span class="op" id="3703250">(</span><span class="ident" id="3703251">z</span>&nbsp;<span class="ident" id="3703253">nat</span><span class="op" id="3703256">)</span>&nbsp;<span class="ident" id="3703258">setBytes</span><span class="op" id="3703266">(</span><span class="ident" id="3703267">buf</span>&nbsp;<span class="op" id="3703271">[</span><span class="op" id="3703272">]</span><span class="builtintype" id="3703273">byte</span><span class="op" id="3703277">)</span>&nbsp;<span class="ident" id="3703279">nat</span>&nbsp;<span class="op" id="3703283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703286">z</span>&nbsp;<span class="op" id="3703288">=</span>&nbsp;<span class="ident" id="3703290">z</span><span class="op" id="3703291">.</span><span class="builtinfunc" id="3703292">make</span><span class="op" id="3703296">(</span><span class="op" id="3703297">(</span><span class="builtinfunc" id="3703298">len</span><span class="op" id="3703301">(</span><span class="ident" id="3703302">buf</span><span class="op" id="3703305">)</span>&nbsp;<span class="op" id="3703307">+</span>&nbsp;<span class="ident" id="3703309">_S</span>&nbsp;<span class="op" id="3703312">-</span>&nbsp;<span class="num" id="3703314">1</span><span class="op" id="3703315">)</span>&nbsp;<span class="op" id="3703317">/</span>&nbsp;<span class="ident" id="3703319">_S</span><span class="op" id="3703321">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703325">k</span>&nbsp;<span class="op" id="3703327">:=</span>&nbsp;<span class="num" id="3703330">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703333">s</span>&nbsp;<span class="op" id="3703335">:=</span>&nbsp;<span class="builtintype" id="3703338">uint</span><span class="op" id="3703342">(</span><span class="num" id="3703343">0</span><span class="op" id="3703344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703347">var</span>&nbsp;<span class="ident" id="3703351">d</span>&nbsp;<span class="ident" id="3703353">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703359">for</span>&nbsp;<span class="ident" id="3703363">i</span>&nbsp;<span class="op" id="3703365">:=</span>&nbsp;<span class="builtinfunc" id="3703368">len</span><span class="op" id="3703371">(</span><span class="ident" id="3703372">buf</span><span class="op" id="3703375">)</span><span class="op" id="3703376">;</span>&nbsp;<span class="ident" id="3703378">i</span>&nbsp;<span class="op" id="3703380">&gt;</span>&nbsp;<span class="num" id="3703382">0</span><span class="op" id="3703383">;</span>&nbsp;<span class="ident" id="3703385">i</span><span class="op" id="3703386">--</span>&nbsp;<span class="op" id="3703389">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703393">d</span>&nbsp;<span class="op" id="3703395">|=</span>&nbsp;<span class="ident" id="3703398">Word</span><span class="op" id="3703402">(</span><span class="ident" id="3703403">buf</span><span class="op" id="3703406">[</span><span class="ident" id="3703407">i</span><span class="op" id="3703408">-</span><span class="num" id="3703409">1</span><span class="op" id="3703410">]</span><span class="op" id="3703411">)</span>&nbsp;<span class="op" id="3703413">&lt;&lt;</span>&nbsp;<span class="ident" id="3703416">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703420">if</span>&nbsp;<span class="ident" id="3703423">s</span>&nbsp;<span class="op" id="3703425">+=</span>&nbsp;<span class="num" id="3703428">8</span><span class="op" id="3703429">;</span>&nbsp;<span class="ident" id="3703431">s</span>&nbsp;<span class="op" id="3703433">==</span>&nbsp;<span class="ident" id="3703436">_S</span><span class="op" id="3703438">*</span><span class="num" id="3703439">8</span>&nbsp;<span class="op" id="3703441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703446">z</span><span class="op" id="3703447">[</span><span class="ident" id="3703448">k</span><span class="op" id="3703449">]</span>&nbsp;<span class="op" id="3703451">=</span>&nbsp;<span class="ident" id="3703453">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703458">k</span><span class="op" id="3703459">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703465">s</span>&nbsp;<span class="op" id="3703467">=</span>&nbsp;<span class="num" id="3703469">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703474">d</span>&nbsp;<span class="op" id="3703476">=</span>&nbsp;<span class="num" id="3703478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703488">if</span>&nbsp;<span class="ident" id="3703491">k</span>&nbsp;<span class="op" id="3703493">&lt;</span>&nbsp;<span class="builtinfunc" id="3703495">len</span><span class="op" id="3703498">(</span><span class="ident" id="3703499">z</span><span class="op" id="3703500">)</span>&nbsp;<span class="op" id="3703502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703506">z</span><span class="op" id="3703507">[</span><span class="ident" id="3703508">k</span><span class="op" id="3703509">]</span>&nbsp;<span class="op" id="3703511">=</span>&nbsp;<span class="ident" id="3703513">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703520">return</span>&nbsp;<span class="ident" id="3703527">z</span><span class="op" id="3703528">.</span><span class="ident" id="3703529">norm</span><span class="op" id="3703533">(</span><span class="op" id="3703534">)</span><br>
<span class="lineno"></span><span class="op" id="3703536">}</span>
</div>
</body>
</html>
