<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5896420">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5896475">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5896529">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5896580">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="5896651">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="5896720">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="5896776">//</span><br>
<span class="lineno"></span><span class="comment" id="5896779">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="5896847">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5896920">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5896979">//</span><br>
<span class="lineno"></span><span class="comment" id="5896982">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="5897057">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="5897122">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5897141">package</span>&nbsp;<span class="ident" id="5897149">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5897154">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="5897221">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5897255">import</span>&nbsp;<span class="op" id="5897262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5897265">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5897274">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5897284">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5897291">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5897296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5897299">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5897358">type</span>&nbsp;<span class="ident" id="5897363">Order</span>&nbsp;<span class="builtintype" id="5897369">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5897374">const</span>&nbsp;<span class="op" id="5897380">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897383">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897459">LSB</span>&nbsp;<span class="ident" id="5897463">Order</span>&nbsp;<span class="op" id="5897469">=</span>&nbsp;<span class="ident" id="5897471">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897477">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897548">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897566">MSB</span><br>
<span class="lineno"></span><span class="op" id="5897570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5897573">const</span>&nbsp;<span class="op" id="5897579">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897582">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897601">=</span>&nbsp;<span class="num" id="5897603">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897607">decoderInvalidCode</span>&nbsp;<span class="op" id="5897626">=</span>&nbsp;<span class="num" id="5897628">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897636">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5897655">=</span>&nbsp;<span class="num" id="5897657">1</span>&nbsp;<span class="op" id="5897659">&lt;&lt;</span>&nbsp;<span class="ident" id="5897662">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="5897671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5897674">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5897744">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5897774">type</span>&nbsp;<span class="ident" id="5897779">decoder</span>&nbsp;<span class="keyword" id="5897787">struct</span>&nbsp;<span class="op" id="5897794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897797">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897806">io</span><span class="op" id="5897808">.</span><span class="ident" id="5897809">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897821">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5897830">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897838">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5897847">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897853">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5897862">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897868">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5897877">func</span><span class="op" id="5897881">(</span><span class="op" id="5897882">*</span><span class="ident" id="5897883">decoder</span><span class="op" id="5897890">)</span>&nbsp;<span class="op" id="5897892">(</span><span class="builtintype" id="5897893">uint16</span><span class="op" id="5897899">,</span>&nbsp;<span class="builtintype" id="5897901">error</span><span class="op" id="5897906">)</span>&nbsp;<span class="comment" id="5897908">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5897931">litWidth</span>&nbsp;<span class="builtintype" id="5897940">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5897971">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898006">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5898015">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898023">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898074">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898117">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898188">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898245">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898308">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898372">clear</span><span class="op" id="5898377">,</span>&nbsp;<span class="ident" id="5898379">eof</span><span class="op" id="5898382">,</span>&nbsp;<span class="ident" id="5898384">hi</span><span class="op" id="5898386">,</span>&nbsp;<span class="ident" id="5898388">overflow</span><span class="op" id="5898396">,</span>&nbsp;<span class="ident" id="5898398">last</span>&nbsp;<span class="builtintype" id="5898403">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898412">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898483">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898527">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898582">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898655">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898695">suffix</span>&nbsp;<span class="op" id="5898702">[</span><span class="num" id="5898703">1</span>&nbsp;<span class="op" id="5898705">&lt;&lt;</span>&nbsp;<span class="ident" id="5898708">maxWidth</span><span class="op" id="5898716">]</span><span class="builtintype" id="5898717">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5898724">prefix</span>&nbsp;<span class="op" id="5898731">[</span><span class="num" id="5898732">1</span>&nbsp;<span class="op" id="5898734">&lt;&lt;</span>&nbsp;<span class="ident" id="5898737">maxWidth</span><span class="op" id="5898745">]</span><span class="builtintype" id="5898746">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898755">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898798">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898862">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5898932">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899005">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899037">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899094">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899153">output</span>&nbsp;<span class="op" id="5899160">[</span><span class="num" id="5899161">2</span>&nbsp;<span class="op" id="5899163">*</span>&nbsp;<span class="num" id="5899165">1</span>&nbsp;<span class="op" id="5899167">&lt;&lt;</span>&nbsp;<span class="ident" id="5899170">maxWidth</span><span class="op" id="5899178">]</span><span class="builtintype" id="5899179">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899185">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5899192">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5899199">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899227">toRead</span>&nbsp;<span class="op" id="5899234">[</span><span class="op" id="5899235">]</span><span class="builtintype" id="5899236">byte</span>&nbsp;<span class="comment" id="5899241">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="5899270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5899273">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="5899347">func</span>&nbsp;<span class="op" id="5899352">(</span><span class="ident" id="5899353">d</span>&nbsp;<span class="op" id="5899355">*</span><span class="ident" id="5899356">decoder</span><span class="op" id="5899363">)</span>&nbsp;<span class="ident" id="5899365">readLSB</span><span class="op" id="5899372">(</span><span class="op" id="5899373">)</span>&nbsp;<span class="op" id="5899375">(</span><span class="builtintype" id="5899376">uint16</span><span class="op" id="5899382">,</span>&nbsp;<span class="builtintype" id="5899384">error</span><span class="op" id="5899389">)</span>&nbsp;<span class="op" id="5899391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899394">for</span>&nbsp;<span class="ident" id="5899398">d</span><span class="op" id="5899399">.</span><span class="ident" id="5899400">nBits</span>&nbsp;<span class="op" id="5899406">&lt;</span>&nbsp;<span class="ident" id="5899408">d</span><span class="op" id="5899409">.</span><span class="ident" id="5899410">width</span>&nbsp;<span class="op" id="5899416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899420">x</span><span class="op" id="5899421">,</span>&nbsp;<span class="ident" id="5899423">err</span>&nbsp;<span class="op" id="5899427">:=</span>&nbsp;<span class="ident" id="5899430">d</span><span class="op" id="5899431">.</span><span class="ident" id="5899432">r</span><span class="op" id="5899433">.</span><span class="ident" id="5899434">ReadByte</span><span class="op" id="5899442">(</span><span class="op" id="5899443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899447">if</span>&nbsp;<span class="ident" id="5899450">err</span>&nbsp;<span class="op" id="5899454">!=</span>&nbsp;<span class="builtintype" id="5899457">nil</span>&nbsp;<span class="op" id="5899461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899466">return</span>&nbsp;<span class="num" id="5899473">0</span><span class="op" id="5899474">,</span>&nbsp;<span class="ident" id="5899476">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899486">d</span><span class="op" id="5899487">.</span><span class="ident" id="5899488">bits</span>&nbsp;<span class="op" id="5899493">|=</span>&nbsp;<span class="builtintype" id="5899496">uint32</span><span class="op" id="5899502">(</span><span class="ident" id="5899503">x</span><span class="op" id="5899504">)</span>&nbsp;<span class="op" id="5899506">&lt;&lt;</span>&nbsp;<span class="ident" id="5899509">d</span><span class="op" id="5899510">.</span><span class="ident" id="5899511">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899519">d</span><span class="op" id="5899520">.</span><span class="ident" id="5899521">nBits</span>&nbsp;<span class="op" id="5899527">+=</span>&nbsp;<span class="num" id="5899530">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899536">code</span>&nbsp;<span class="op" id="5899541">:=</span>&nbsp;<span class="builtintype" id="5899544">uint16</span><span class="op" id="5899550">(</span><span class="ident" id="5899551">d</span><span class="op" id="5899552">.</span><span class="ident" id="5899553">bits</span>&nbsp;<span class="op" id="5899558">&amp;</span>&nbsp;<span class="op" id="5899560">(</span><span class="num" id="5899561">1</span><span class="op" id="5899562">&lt;&lt;</span><span class="ident" id="5899564">d</span><span class="op" id="5899565">.</span><span class="ident" id="5899566">width</span>&nbsp;<span class="op" id="5899572">-</span>&nbsp;<span class="num" id="5899574">1</span><span class="op" id="5899575">)</span><span class="op" id="5899576">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899579">d</span><span class="op" id="5899580">.</span><span class="ident" id="5899581">bits</span>&nbsp;<span class="op" id="5899586">&gt;&gt;=</span>&nbsp;<span class="ident" id="5899590">d</span><span class="op" id="5899591">.</span><span class="ident" id="5899592">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899599">d</span><span class="op" id="5899600">.</span><span class="ident" id="5899601">nBits</span>&nbsp;<span class="op" id="5899607">-=</span>&nbsp;<span class="ident" id="5899610">d</span><span class="op" id="5899611">.</span><span class="ident" id="5899612">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899619">return</span>&nbsp;<span class="ident" id="5899626">code</span><span class="op" id="5899630">,</span>&nbsp;<span class="builtintype" id="5899632">nil</span><br>
<span class="lineno"></span><span class="op" id="5899636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5899639">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5899712">func</span>&nbsp;<span class="op" id="5899717">(</span><span class="ident" id="5899718">d</span>&nbsp;<span class="op" id="5899720">*</span><span class="ident" id="5899721">decoder</span><span class="op" id="5899728">)</span>&nbsp;<span class="ident" id="5899730">readMSB</span><span class="op" id="5899737">(</span><span class="op" id="5899738">)</span>&nbsp;<span class="op" id="5899740">(</span><span class="builtintype" id="5899741">uint16</span><span class="op" id="5899747">,</span>&nbsp;<span class="builtintype" id="5899749">error</span><span class="op" id="5899754">)</span>&nbsp;<span class="op" id="5899756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899759">for</span>&nbsp;<span class="ident" id="5899763">d</span><span class="op" id="5899764">.</span><span class="ident" id="5899765">nBits</span>&nbsp;<span class="op" id="5899771">&lt;</span>&nbsp;<span class="ident" id="5899773">d</span><span class="op" id="5899774">.</span><span class="ident" id="5899775">width</span>&nbsp;<span class="op" id="5899781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899785">x</span><span class="op" id="5899786">,</span>&nbsp;<span class="ident" id="5899788">err</span>&nbsp;<span class="op" id="5899792">:=</span>&nbsp;<span class="ident" id="5899795">d</span><span class="op" id="5899796">.</span><span class="ident" id="5899797">r</span><span class="op" id="5899798">.</span><span class="ident" id="5899799">ReadByte</span><span class="op" id="5899807">(</span><span class="op" id="5899808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899812">if</span>&nbsp;<span class="ident" id="5899815">err</span>&nbsp;<span class="op" id="5899819">!=</span>&nbsp;<span class="builtintype" id="5899822">nil</span>&nbsp;<span class="op" id="5899826">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899831">return</span>&nbsp;<span class="num" id="5899838">0</span><span class="op" id="5899839">,</span>&nbsp;<span class="ident" id="5899841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899851">d</span><span class="op" id="5899852">.</span><span class="ident" id="5899853">bits</span>&nbsp;<span class="op" id="5899858">|=</span>&nbsp;<span class="builtintype" id="5899861">uint32</span><span class="op" id="5899867">(</span><span class="ident" id="5899868">x</span><span class="op" id="5899869">)</span>&nbsp;<span class="op" id="5899871">&lt;&lt;</span>&nbsp;<span class="op" id="5899874">(</span><span class="num" id="5899875">24</span>&nbsp;<span class="op" id="5899878">-</span>&nbsp;<span class="ident" id="5899880">d</span><span class="op" id="5899881">.</span><span class="ident" id="5899882">nBits</span><span class="op" id="5899887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899891">d</span><span class="op" id="5899892">.</span><span class="ident" id="5899893">nBits</span>&nbsp;<span class="op" id="5899899">+=</span>&nbsp;<span class="num" id="5899902">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899905">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899908">code</span>&nbsp;<span class="op" id="5899913">:=</span>&nbsp;<span class="builtintype" id="5899916">uint16</span><span class="op" id="5899922">(</span><span class="ident" id="5899923">d</span><span class="op" id="5899924">.</span><span class="ident" id="5899925">bits</span>&nbsp;<span class="op" id="5899930">&gt;&gt;</span>&nbsp;<span class="op" id="5899933">(</span><span class="num" id="5899934">32</span>&nbsp;<span class="op" id="5899937">-</span>&nbsp;<span class="ident" id="5899939">d</span><span class="op" id="5899940">.</span><span class="ident" id="5899941">width</span><span class="op" id="5899946">)</span><span class="op" id="5899947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899950">d</span><span class="op" id="5899951">.</span><span class="ident" id="5899952">bits</span>&nbsp;<span class="op" id="5899957">&lt;&lt;=</span>&nbsp;<span class="ident" id="5899961">d</span><span class="op" id="5899962">.</span><span class="ident" id="5899963">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5899970">d</span><span class="op" id="5899971">.</span><span class="ident" id="5899972">nBits</span>&nbsp;<span class="op" id="5899978">-=</span>&nbsp;<span class="ident" id="5899981">d</span><span class="op" id="5899982">.</span><span class="ident" id="5899983">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5899990">return</span>&nbsp;<span class="ident" id="5899997">code</span><span class="op" id="5900001">,</span>&nbsp;<span class="builtintype" id="5900003">nil</span><br>
<span class="lineno"></span><span class="op" id="5900007">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5900010">func</span>&nbsp;<span class="op" id="5900015">(</span><span class="ident" id="5900016">d</span>&nbsp;<span class="op" id="5900018">*</span><span class="ident" id="5900019">decoder</span><span class="op" id="5900026">)</span>&nbsp;<span class="ident" id="5900028">Read</span><span class="op" id="5900032">(</span><span class="ident" id="5900033">b</span>&nbsp;<span class="op" id="5900035">[</span><span class="op" id="5900036">]</span><span class="builtintype" id="5900037">byte</span><span class="op" id="5900041">)</span>&nbsp;<span class="op" id="5900043">(</span><span class="builtintype" id="5900044">int</span><span class="op" id="5900047">,</span>&nbsp;<span class="builtintype" id="5900049">error</span><span class="op" id="5900054">)</span>&nbsp;<span class="op" id="5900056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900059">for</span>&nbsp;<span class="op" id="5900063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900067">if</span>&nbsp;<span class="builtinfunc" id="5900070">len</span><span class="op" id="5900073">(</span><span class="ident" id="5900074">d</span><span class="op" id="5900075">.</span><span class="ident" id="5900076">toRead</span><span class="op" id="5900082">)</span>&nbsp;<span class="op" id="5900084">&gt;</span>&nbsp;<span class="num" id="5900086">0</span>&nbsp;<span class="op" id="5900088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900093">n</span>&nbsp;<span class="op" id="5900095">:=</span>&nbsp;<span class="builtinfunc" id="5900098">copy</span><span class="op" id="5900102">(</span><span class="ident" id="5900103">b</span><span class="op" id="5900104">,</span>&nbsp;<span class="ident" id="5900106">d</span><span class="op" id="5900107">.</span><span class="ident" id="5900108">toRead</span><span class="op" id="5900114">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900119">d</span><span class="op" id="5900120">.</span><span class="ident" id="5900121">toRead</span>&nbsp;<span class="op" id="5900128">=</span>&nbsp;<span class="ident" id="5900130">d</span><span class="op" id="5900131">.</span><span class="ident" id="5900132">toRead</span><span class="op" id="5900138">[</span><span class="ident" id="5900139">n</span><span class="op" id="5900140">:</span><span class="op" id="5900141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900146">return</span>&nbsp;<span class="ident" id="5900153">n</span><span class="op" id="5900154">,</span>&nbsp;<span class="builtintype" id="5900156">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900166">if</span>&nbsp;<span class="ident" id="5900169">d</span><span class="op" id="5900170">.</span><span class="ident" id="5900171">err</span>&nbsp;<span class="op" id="5900175">!=</span>&nbsp;<span class="builtintype" id="5900178">nil</span>&nbsp;<span class="op" id="5900182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900187">return</span>&nbsp;<span class="num" id="5900194">0</span><span class="op" id="5900195">,</span>&nbsp;<span class="ident" id="5900197">d</span><span class="op" id="5900198">.</span><span class="ident" id="5900199">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900209">d</span><span class="op" id="5900210">.</span><span class="ident" id="5900211">decode</span><span class="op" id="5900217">(</span><span class="op" id="5900218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900221">}</span><br>
<span class="lineno"></span><span class="op" id="5900223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5900226">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="5900291">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="5900341">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="5900392">func</span>&nbsp;<span class="op" id="5900397">(</span><span class="ident" id="5900398">d</span>&nbsp;<span class="op" id="5900400">*</span><span class="ident" id="5900401">decoder</span><span class="op" id="5900408">)</span>&nbsp;<span class="ident" id="5900410">decode</span><span class="op" id="5900416">(</span><span class="op" id="5900417">)</span>&nbsp;<span class="op" id="5900419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900422">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900495">for</span>&nbsp;<span class="op" id="5900499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900503">code</span><span class="op" id="5900507">,</span>&nbsp;<span class="ident" id="5900509">err</span>&nbsp;<span class="op" id="5900513">:=</span>&nbsp;<span class="ident" id="5900516">d</span><span class="op" id="5900517">.</span><span class="ident" id="5900518">read</span><span class="op" id="5900522">(</span><span class="ident" id="5900523">d</span><span class="op" id="5900524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900528">if</span>&nbsp;<span class="ident" id="5900531">err</span>&nbsp;<span class="op" id="5900535">!=</span>&nbsp;<span class="builtintype" id="5900538">nil</span>&nbsp;<span class="op" id="5900542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900547">if</span>&nbsp;<span class="ident" id="5900550">err</span>&nbsp;<span class="op" id="5900554">==</span>&nbsp;<span class="ident" id="5900557">io</span><span class="op" id="5900559">.</span><span class="ident" id="5900560">EOF</span>&nbsp;<span class="op" id="5900564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900570">err</span>&nbsp;<span class="op" id="5900574">=</span>&nbsp;<span class="ident" id="5900576">io</span><span class="op" id="5900578">.</span><span class="ident" id="5900579">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900604">d</span><span class="op" id="5900605">.</span><span class="ident" id="5900606">err</span>&nbsp;<span class="op" id="5900610">=</span>&nbsp;<span class="ident" id="5900612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900619">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900632">switch</span>&nbsp;<span class="op" id="5900639">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900643">case</span>&nbsp;<span class="ident" id="5900648">code</span>&nbsp;<span class="op" id="5900653">&lt;</span>&nbsp;<span class="ident" id="5900655">d</span><span class="op" id="5900656">.</span><span class="ident" id="5900657">clear</span><span class="op" id="5900662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900667">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900697">d</span><span class="op" id="5900698">.</span><span class="ident" id="5900699">output</span><span class="op" id="5900705">[</span><span class="ident" id="5900706">d</span><span class="op" id="5900707">.</span><span class="ident" id="5900708">o</span><span class="op" id="5900709">]</span>&nbsp;<span class="op" id="5900711">=</span>&nbsp;<span class="builtintype" id="5900713">uint8</span><span class="op" id="5900718">(</span><span class="ident" id="5900719">code</span><span class="op" id="5900723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900728">d</span><span class="op" id="5900729">.</span><span class="ident" id="5900730">o</span><span class="op" id="5900731">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900737">if</span>&nbsp;<span class="ident" id="5900740">d</span><span class="op" id="5900741">.</span><span class="ident" id="5900742">last</span>&nbsp;<span class="op" id="5900747">!=</span>&nbsp;<span class="ident" id="5900750">decoderInvalidCode</span>&nbsp;<span class="op" id="5900769">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900775">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900816">d</span><span class="op" id="5900817">.</span><span class="ident" id="5900818">suffix</span><span class="op" id="5900824">[</span><span class="ident" id="5900825">d</span><span class="op" id="5900826">.</span><span class="ident" id="5900827">hi</span><span class="op" id="5900829">]</span>&nbsp;<span class="op" id="5900831">=</span>&nbsp;<span class="builtintype" id="5900833">uint8</span><span class="op" id="5900838">(</span><span class="ident" id="5900839">code</span><span class="op" id="5900843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900849">d</span><span class="op" id="5900850">.</span><span class="ident" id="5900851">prefix</span><span class="op" id="5900857">[</span><span class="ident" id="5900858">d</span><span class="op" id="5900859">.</span><span class="ident" id="5900860">hi</span><span class="op" id="5900862">]</span>&nbsp;<span class="op" id="5900864">=</span>&nbsp;<span class="ident" id="5900866">d</span><span class="op" id="5900867">.</span><span class="ident" id="5900868">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5900880">case</span>&nbsp;<span class="ident" id="5900885">code</span>&nbsp;<span class="op" id="5900890">==</span>&nbsp;<span class="ident" id="5900893">d</span><span class="op" id="5900894">.</span><span class="ident" id="5900895">clear</span><span class="op" id="5900900">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900905">d</span><span class="op" id="5900906">.</span><span class="ident" id="5900907">width</span>&nbsp;<span class="op" id="5900913">=</span>&nbsp;<span class="num" id="5900915">1</span>&nbsp;<span class="op" id="5900917">+</span>&nbsp;<span class="builtintype" id="5900919">uint</span><span class="op" id="5900923">(</span><span class="ident" id="5900924">d</span><span class="op" id="5900925">.</span><span class="ident" id="5900926">litWidth</span><span class="op" id="5900934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900939">d</span><span class="op" id="5900940">.</span><span class="ident" id="5900941">hi</span>&nbsp;<span class="op" id="5900944">=</span>&nbsp;<span class="ident" id="5900946">d</span><span class="op" id="5900947">.</span><span class="ident" id="5900948">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900955">d</span><span class="op" id="5900956">.</span><span class="ident" id="5900957">overflow</span>&nbsp;<span class="op" id="5900966">=</span>&nbsp;<span class="num" id="5900968">1</span>&nbsp;<span class="op" id="5900970">&lt;&lt;</span>&nbsp;<span class="ident" id="5900973">d</span><span class="op" id="5900974">.</span><span class="ident" id="5900975">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5900984">d</span><span class="op" id="5900985">.</span><span class="ident" id="5900986">last</span>&nbsp;<span class="op" id="5900991">=</span>&nbsp;<span class="ident" id="5900993">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901015">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901026">case</span>&nbsp;<span class="ident" id="5901031">code</span>&nbsp;<span class="op" id="5901036">==</span>&nbsp;<span class="ident" id="5901039">d</span><span class="op" id="5901040">.</span><span class="ident" id="5901041">eof</span><span class="op" id="5901044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901049">d</span><span class="op" id="5901050">.</span><span class="ident" id="5901051">flush</span><span class="op" id="5901056">(</span><span class="op" id="5901057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901062">d</span><span class="op" id="5901063">.</span><span class="ident" id="5901064">err</span>&nbsp;<span class="op" id="5901068">=</span>&nbsp;<span class="ident" id="5901070">io</span><span class="op" id="5901072">.</span><span class="ident" id="5901073">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901089">case</span>&nbsp;<span class="ident" id="5901094">code</span>&nbsp;<span class="op" id="5901099">&lt;=</span>&nbsp;<span class="ident" id="5901102">d</span><span class="op" id="5901103">.</span><span class="ident" id="5901104">hi</span><span class="op" id="5901106">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901111">c</span><span class="op" id="5901112">,</span>&nbsp;<span class="ident" id="5901114">i</span>&nbsp;<span class="op" id="5901116">:=</span>&nbsp;<span class="ident" id="5901119">code</span><span class="op" id="5901123">,</span>&nbsp;<span class="builtinfunc" id="5901125">len</span><span class="op" id="5901128">(</span><span class="ident" id="5901129">d</span><span class="op" id="5901130">.</span><span class="ident" id="5901131">output</span><span class="op" id="5901137">)</span><span class="op" id="5901138">-</span><span class="num" id="5901139">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901144">if</span>&nbsp;<span class="ident" id="5901147">code</span>&nbsp;<span class="op" id="5901152">==</span>&nbsp;<span class="ident" id="5901155">d</span><span class="op" id="5901156">.</span><span class="ident" id="5901157">hi</span>&nbsp;<span class="op" id="5901160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901166">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901238">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901315">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901369">c</span>&nbsp;<span class="op" id="5901371">=</span>&nbsp;<span class="ident" id="5901373">d</span><span class="op" id="5901374">.</span><span class="ident" id="5901375">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901384">for</span>&nbsp;<span class="ident" id="5901388">c</span>&nbsp;<span class="op" id="5901390">&gt;=</span>&nbsp;<span class="ident" id="5901393">d</span><span class="op" id="5901394">.</span><span class="ident" id="5901395">clear</span>&nbsp;<span class="op" id="5901401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901408">c</span>&nbsp;<span class="op" id="5901410">=</span>&nbsp;<span class="ident" id="5901412">d</span><span class="op" id="5901413">.</span><span class="ident" id="5901414">prefix</span><span class="op" id="5901420">[</span><span class="ident" id="5901421">c</span><span class="op" id="5901422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901434">d</span><span class="op" id="5901435">.</span><span class="ident" id="5901436">output</span><span class="op" id="5901442">[</span><span class="ident" id="5901443">i</span><span class="op" id="5901444">]</span>&nbsp;<span class="op" id="5901446">=</span>&nbsp;<span class="builtintype" id="5901448">uint8</span><span class="op" id="5901453">(</span><span class="ident" id="5901454">c</span><span class="op" id="5901455">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901461">i</span><span class="op" id="5901462">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901469">c</span>&nbsp;<span class="op" id="5901471">=</span>&nbsp;<span class="ident" id="5901473">d</span><span class="op" id="5901474">.</span><span class="ident" id="5901475">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901488">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901554">for</span>&nbsp;<span class="ident" id="5901558">c</span>&nbsp;<span class="op" id="5901560">&gt;=</span>&nbsp;<span class="ident" id="5901563">d</span><span class="op" id="5901564">.</span><span class="ident" id="5901565">clear</span>&nbsp;<span class="op" id="5901571">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901577">d</span><span class="op" id="5901578">.</span><span class="ident" id="5901579">output</span><span class="op" id="5901585">[</span><span class="ident" id="5901586">i</span><span class="op" id="5901587">]</span>&nbsp;<span class="op" id="5901589">=</span>&nbsp;<span class="ident" id="5901591">d</span><span class="op" id="5901592">.</span><span class="ident" id="5901593">suffix</span><span class="op" id="5901599">[</span><span class="ident" id="5901600">c</span><span class="op" id="5901601">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901607">i</span><span class="op" id="5901608">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901615">c</span>&nbsp;<span class="op" id="5901617">=</span>&nbsp;<span class="ident" id="5901619">d</span><span class="op" id="5901620">.</span><span class="ident" id="5901621">prefix</span><span class="op" id="5901627">[</span><span class="ident" id="5901628">c</span><span class="op" id="5901629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901639">d</span><span class="op" id="5901640">.</span><span class="ident" id="5901641">output</span><span class="op" id="5901647">[</span><span class="ident" id="5901648">i</span><span class="op" id="5901649">]</span>&nbsp;<span class="op" id="5901651">=</span>&nbsp;<span class="builtintype" id="5901653">uint8</span><span class="op" id="5901658">(</span><span class="ident" id="5901659">c</span><span class="op" id="5901660">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901665">d</span><span class="op" id="5901666">.</span><span class="ident" id="5901667">o</span>&nbsp;<span class="op" id="5901669">+=</span>&nbsp;<span class="builtinfunc" id="5901672">copy</span><span class="op" id="5901676">(</span><span class="ident" id="5901677">d</span><span class="op" id="5901678">.</span><span class="ident" id="5901679">output</span><span class="op" id="5901685">[</span><span class="ident" id="5901686">d</span><span class="op" id="5901687">.</span><span class="ident" id="5901688">o</span><span class="op" id="5901689">:</span><span class="op" id="5901690">]</span><span class="op" id="5901691">,</span>&nbsp;<span class="ident" id="5901693">d</span><span class="op" id="5901694">.</span><span class="ident" id="5901695">output</span><span class="op" id="5901701">[</span><span class="ident" id="5901702">i</span><span class="op" id="5901703">:</span><span class="op" id="5901704">]</span><span class="op" id="5901705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901710">if</span>&nbsp;<span class="ident" id="5901713">d</span><span class="op" id="5901714">.</span><span class="ident" id="5901715">last</span>&nbsp;<span class="op" id="5901720">!=</span>&nbsp;<span class="ident" id="5901723">decoderInvalidCode</span>&nbsp;<span class="op" id="5901742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5901748">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901789">d</span><span class="op" id="5901790">.</span><span class="ident" id="5901791">suffix</span><span class="op" id="5901797">[</span><span class="ident" id="5901798">d</span><span class="op" id="5901799">.</span><span class="ident" id="5901800">hi</span><span class="op" id="5901802">]</span>&nbsp;<span class="op" id="5901804">=</span>&nbsp;<span class="builtintype" id="5901806">uint8</span><span class="op" id="5901811">(</span><span class="ident" id="5901812">c</span><span class="op" id="5901813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901819">d</span><span class="op" id="5901820">.</span><span class="ident" id="5901821">prefix</span><span class="op" id="5901827">[</span><span class="ident" id="5901828">d</span><span class="op" id="5901829">.</span><span class="ident" id="5901830">hi</span><span class="op" id="5901832">]</span>&nbsp;<span class="op" id="5901834">=</span>&nbsp;<span class="ident" id="5901836">d</span><span class="op" id="5901837">.</span><span class="ident" id="5901838">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901850">default</span><span class="op" id="5901857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901862">d</span><span class="op" id="5901863">.</span><span class="ident" id="5901864">err</span>&nbsp;<span class="op" id="5901868">=</span>&nbsp;<span class="ident" id="5901870">errors</span><span class="op" id="5901876">.</span><span class="ident" id="5901877">New</span><span class="op" id="5901880">(</span><span class="string" id="5901881">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="5901900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901905">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901914">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5901918">d</span><span class="op" id="5901919">.</span><span class="ident" id="5901920">last</span><span class="op" id="5901924">,</span>&nbsp;<span class="ident" id="5901926">d</span><span class="op" id="5901927">.</span><span class="ident" id="5901928">hi</span>&nbsp;<span class="op" id="5901931">=</span>&nbsp;<span class="ident" id="5901933">code</span><span class="op" id="5901937">,</span>&nbsp;<span class="ident" id="5901939">d</span><span class="op" id="5901940">.</span><span class="ident" id="5901941">hi</span><span class="op" id="5901943">+</span><span class="num" id="5901944">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901948">if</span>&nbsp;<span class="ident" id="5901951">d</span><span class="op" id="5901952">.</span><span class="ident" id="5901953">hi</span>&nbsp;<span class="op" id="5901956">&gt;=</span>&nbsp;<span class="ident" id="5901959">d</span><span class="op" id="5901960">.</span><span class="ident" id="5901961">overflow</span>&nbsp;<span class="op" id="5901970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5901975">if</span>&nbsp;<span class="ident" id="5901978">d</span><span class="op" id="5901979">.</span><span class="ident" id="5901980">width</span>&nbsp;<span class="op" id="5901986">==</span>&nbsp;<span class="ident" id="5901989">maxWidth</span>&nbsp;<span class="op" id="5901998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902004">d</span><span class="op" id="5902005">.</span><span class="ident" id="5902006">last</span>&nbsp;<span class="op" id="5902011">=</span>&nbsp;<span class="ident" id="5902013">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902035">}</span>&nbsp;<span class="keyword" id="5902037">else</span>&nbsp;<span class="op" id="5902042">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902048">d</span><span class="op" id="5902049">.</span><span class="ident" id="5902050">width</span><span class="op" id="5902055">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902062">d</span><span class="op" id="5902063">.</span><span class="ident" id="5902064">overflow</span>&nbsp;<span class="op" id="5902073">&lt;&lt;=</span>&nbsp;<span class="num" id="5902077">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902090">if</span>&nbsp;<span class="ident" id="5902093">d</span><span class="op" id="5902094">.</span><span class="ident" id="5902095">o</span>&nbsp;<span class="op" id="5902097">&gt;=</span>&nbsp;<span class="ident" id="5902100">flushBuffer</span>&nbsp;<span class="op" id="5902112">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902117">d</span><span class="op" id="5902118">.</span><span class="ident" id="5902119">flush</span><span class="op" id="5902124">(</span><span class="op" id="5902125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902142">}</span><br>
<span class="lineno"></span><span class="op" id="5902144">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="5902147">func</span>&nbsp;<span class="op" id="5902152">(</span><span class="ident" id="5902153">d</span>&nbsp;<span class="op" id="5902155">*</span><span class="ident" id="5902156">decoder</span><span class="op" id="5902163">)</span>&nbsp;<span class="ident" id="5902165">flush</span><span class="op" id="5902170">(</span><span class="op" id="5902171">)</span>&nbsp;<span class="op" id="5902173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902176">d</span><span class="op" id="5902177">.</span><span class="ident" id="5902178">toRead</span>&nbsp;<span class="op" id="5902185">=</span>&nbsp;<span class="ident" id="5902187">d</span><span class="op" id="5902188">.</span><span class="ident" id="5902189">output</span><span class="op" id="5902195">[</span><span class="op" id="5902196">:</span><span class="ident" id="5902197">d</span><span class="op" id="5902198">.</span><span class="ident" id="5902199">o</span><span class="op" id="5902200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902203">d</span><span class="op" id="5902204">.</span><span class="ident" id="5902205">o</span>&nbsp;<span class="op" id="5902207">=</span>&nbsp;<span class="num" id="5902209">0</span><br>
<span class="lineno"></span><span class="op" id="5902211">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="5902214">var</span>&nbsp;<span class="ident" id="5902218">errClosed</span>&nbsp;<span class="op" id="5902228">=</span>&nbsp;<span class="ident" id="5902230">errors</span><span class="op" id="5902236">.</span><span class="ident" id="5902237">New</span><span class="op" id="5902240">(</span><span class="string" id="5902241">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5902280">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5902283">func</span>&nbsp;<span class="op" id="5902288">(</span><span class="ident" id="5902289">d</span>&nbsp;<span class="op" id="5902291">*</span><span class="ident" id="5902292">decoder</span><span class="op" id="5902299">)</span>&nbsp;<span class="ident" id="5902301">Close</span><span class="op" id="5902306">(</span><span class="op" id="5902307">)</span>&nbsp;<span class="builtintype" id="5902309">error</span>&nbsp;<span class="op" id="5902315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902318">d</span><span class="op" id="5902319">.</span><span class="ident" id="5902320">err</span>&nbsp;<span class="op" id="5902324">=</span>&nbsp;<span class="ident" id="5902326">errClosed</span>&nbsp;<span class="comment" id="5902336">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902369">return</span>&nbsp;<span class="builtintype" id="5902376">nil</span><br>
<span class="lineno"></span><span class="op" id="5902380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5902383">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5902425">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="5902499">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5902546">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5902608">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5902682">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="5902703">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="5902776">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="5902811">func</span>&nbsp;<span class="ident" id="5902816">NewReader</span><span class="op" id="5902825">(</span><span class="ident" id="5902826">r</span>&nbsp;<span class="ident" id="5902828">io</span><span class="op" id="5902830">.</span><span class="ident" id="5902831">Reader</span><span class="op" id="5902837">,</span>&nbsp;<span class="ident" id="5902839">order</span>&nbsp;<span class="ident" id="5902845">Order</span><span class="op" id="5902850">,</span>&nbsp;<span class="ident" id="5902852">litWidth</span>&nbsp;<span class="builtintype" id="5902861">int</span><span class="op" id="5902864">)</span>&nbsp;<span class="ident" id="5902866">io</span><span class="op" id="5902868">.</span><span class="ident" id="5902869">ReadCloser</span>&nbsp;<span class="op" id="5902880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902883">d</span>&nbsp;<span class="op" id="5902885">:=</span>&nbsp;<span class="builtinfunc" id="5902888">new</span><span class="op" id="5902891">(</span><span class="ident" id="5902892">decoder</span><span class="op" id="5902899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902902">switch</span>&nbsp;<span class="ident" id="5902909">order</span>&nbsp;<span class="op" id="5902915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902918">case</span>&nbsp;<span class="ident" id="5902923">LSB</span><span class="op" id="5902926">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902930">d</span><span class="op" id="5902931">.</span><span class="ident" id="5902932">read</span>&nbsp;<span class="op" id="5902937">=</span>&nbsp;<span class="op" id="5902939">(</span><span class="op" id="5902940">*</span><span class="ident" id="5902941">decoder</span><span class="op" id="5902948">)</span><span class="op" id="5902949">.</span><span class="ident" id="5902950">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5902959">case</span>&nbsp;<span class="ident" id="5902964">MSB</span><span class="op" id="5902967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902971">d</span><span class="op" id="5902972">.</span><span class="ident" id="5902973">read</span>&nbsp;<span class="op" id="5902978">=</span>&nbsp;<span class="op" id="5902980">(</span><span class="op" id="5902981">*</span><span class="ident" id="5902982">decoder</span><span class="op" id="5902989">)</span><span class="op" id="5902990">.</span><span class="ident" id="5902991">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903000">default</span><span class="op" id="5903007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903011">d</span><span class="op" id="5903012">.</span><span class="ident" id="5903013">err</span>&nbsp;<span class="op" id="5903017">=</span>&nbsp;<span class="ident" id="5903019">errors</span><span class="op" id="5903025">.</span><span class="ident" id="5903026">New</span><span class="op" id="5903029">(</span><span class="string" id="5903030">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="5903050">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903054">return</span>&nbsp;<span class="ident" id="5903061">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903067">if</span>&nbsp;<span class="ident" id="5903070">litWidth</span>&nbsp;<span class="op" id="5903079">&lt;</span>&nbsp;<span class="num" id="5903081">2</span>&nbsp;<span class="op" id="5903083">||</span>&nbsp;<span class="num" id="5903086">8</span>&nbsp;<span class="op" id="5903088">&lt;</span>&nbsp;<span class="ident" id="5903090">litWidth</span>&nbsp;<span class="op" id="5903099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903103">d</span><span class="op" id="5903104">.</span><span class="ident" id="5903105">err</span>&nbsp;<span class="op" id="5903109">=</span>&nbsp;<span class="ident" id="5903111">fmt</span><span class="op" id="5903114">.</span><span class="ident" id="5903115">Errorf</span><span class="op" id="5903121">(</span><span class="string" id="5903122">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5903153">,</span>&nbsp;<span class="ident" id="5903155">litWidth</span><span class="op" id="5903163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903167">return</span>&nbsp;<span class="ident" id="5903174">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903180">if</span>&nbsp;<span class="ident" id="5903183">br</span><span class="op" id="5903185">,</span>&nbsp;<span class="ident" id="5903187">ok</span>&nbsp;<span class="op" id="5903190">:=</span>&nbsp;<span class="ident" id="5903193">r</span><span class="op" id="5903194">.</span><span class="op" id="5903195">(</span><span class="ident" id="5903196">io</span><span class="op" id="5903198">.</span><span class="ident" id="5903199">ByteReader</span><span class="op" id="5903209">)</span><span class="op" id="5903210">;</span>&nbsp;<span class="ident" id="5903212">ok</span>&nbsp;<span class="op" id="5903215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903219">d</span><span class="op" id="5903220">.</span><span class="ident" id="5903221">r</span>&nbsp;<span class="op" id="5903223">=</span>&nbsp;<span class="ident" id="5903225">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903229">}</span>&nbsp;<span class="keyword" id="5903231">else</span>&nbsp;<span class="op" id="5903236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903240">d</span><span class="op" id="5903241">.</span><span class="ident" id="5903242">r</span>&nbsp;<span class="op" id="5903244">=</span>&nbsp;<span class="ident" id="5903246">bufio</span><span class="op" id="5903251">.</span><span class="ident" id="5903252">NewReader</span><span class="op" id="5903261">(</span><span class="ident" id="5903262">r</span><span class="op" id="5903263">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5903266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903269">d</span><span class="op" id="5903270">.</span><span class="ident" id="5903271">litWidth</span>&nbsp;<span class="op" id="5903280">=</span>&nbsp;<span class="ident" id="5903282">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903292">d</span><span class="op" id="5903293">.</span><span class="ident" id="5903294">width</span>&nbsp;<span class="op" id="5903300">=</span>&nbsp;<span class="num" id="5903302">1</span>&nbsp;<span class="op" id="5903304">+</span>&nbsp;<span class="builtintype" id="5903306">uint</span><span class="op" id="5903310">(</span><span class="ident" id="5903311">litWidth</span><span class="op" id="5903319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903322">d</span><span class="op" id="5903323">.</span><span class="ident" id="5903324">clear</span>&nbsp;<span class="op" id="5903330">=</span>&nbsp;<span class="builtintype" id="5903332">uint16</span><span class="op" id="5903338">(</span><span class="num" id="5903339">1</span><span class="op" id="5903340">)</span>&nbsp;<span class="op" id="5903342">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5903345">uint</span><span class="op" id="5903349">(</span><span class="ident" id="5903350">litWidth</span><span class="op" id="5903358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903361">d</span><span class="op" id="5903362">.</span><span class="ident" id="5903363">eof</span><span class="op" id="5903366">,</span>&nbsp;<span class="ident" id="5903368">d</span><span class="op" id="5903369">.</span><span class="ident" id="5903370">hi</span>&nbsp;<span class="op" id="5903373">=</span>&nbsp;<span class="ident" id="5903375">d</span><span class="op" id="5903376">.</span><span class="ident" id="5903377">clear</span><span class="op" id="5903382">+</span><span class="num" id="5903383">1</span><span class="op" id="5903384">,</span>&nbsp;<span class="ident" id="5903386">d</span><span class="op" id="5903387">.</span><span class="ident" id="5903388">clear</span><span class="op" id="5903393">+</span><span class="num" id="5903394">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903397">d</span><span class="op" id="5903398">.</span><span class="ident" id="5903399">overflow</span>&nbsp;<span class="op" id="5903408">=</span>&nbsp;<span class="builtintype" id="5903410">uint16</span><span class="op" id="5903416">(</span><span class="num" id="5903417">1</span><span class="op" id="5903418">)</span>&nbsp;<span class="op" id="5903420">&lt;&lt;</span>&nbsp;<span class="ident" id="5903423">d</span><span class="op" id="5903424">.</span><span class="ident" id="5903425">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903432">d</span><span class="op" id="5903433">.</span><span class="ident" id="5903434">last</span>&nbsp;<span class="op" id="5903439">=</span>&nbsp;<span class="ident" id="5903441">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5903462">return</span>&nbsp;<span class="ident" id="5903469">d</span><br>
<span class="lineno"></span><span class="op" id="5903471">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
