<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html" class="current">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4228054">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4228109">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4228163">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4228214">package</span>&nbsp;<span class="ident" id="4228222">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4228229">import</span>&nbsp;<span class="op" id="4228236">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4228239">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4228245">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4228252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4228255">const</span>&nbsp;<span class="op" id="4228261">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228264">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4228293">offsetCodeCount</span>&nbsp;<span class="op" id="4228309">=</span>&nbsp;<span class="num" id="4228311">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228316">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4228370">endBlockMarker</span>&nbsp;<span class="op" id="4228385">=</span>&nbsp;<span class="num" id="4228387">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228393">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4228420">lengthCodesStart</span>&nbsp;<span class="op" id="4228437">=</span>&nbsp;<span class="num" id="4228439">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228445">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4228478">codegenCodeCount</span>&nbsp;<span class="op" id="4228495">=</span>&nbsp;<span class="num" id="4228497">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4228501">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4228518">=</span>&nbsp;<span class="num" id="4228520">255</span><br>
<span class="lineno">25</span><span class="op" id="4228524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4228527">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4228601">var</span>&nbsp;<span class="ident" id="4228605">lengthExtraBits</span>&nbsp;<span class="op" id="4228621">=</span>&nbsp;<span class="op" id="4228623">[</span><span class="op" id="4228624">]</span><span class="builtintype" id="4228625">int8</span><span class="op" id="4228629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228632">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4228642">0</span><span class="op" id="4228643">,</span>&nbsp;<span class="num" id="4228645">0</span><span class="op" id="4228646">,</span>&nbsp;<span class="num" id="4228648">0</span><span class="op" id="4228649">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228652">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4228662">0</span><span class="op" id="4228663">,</span>&nbsp;<span class="num" id="4228665">0</span><span class="op" id="4228666">,</span>&nbsp;<span class="num" id="4228668">0</span><span class="op" id="4228669">,</span>&nbsp;<span class="num" id="4228671">0</span><span class="op" id="4228672">,</span>&nbsp;<span class="num" id="4228674">0</span><span class="op" id="4228675">,</span>&nbsp;<span class="num" id="4228677">1</span><span class="op" id="4228678">,</span>&nbsp;<span class="num" id="4228680">1</span><span class="op" id="4228681">,</span>&nbsp;<span class="num" id="4228683">1</span><span class="op" id="4228684">,</span>&nbsp;<span class="num" id="4228686">1</span><span class="op" id="4228687">,</span>&nbsp;<span class="num" id="4228689">2</span><span class="op" id="4228690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228693">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4228703">2</span><span class="op" id="4228704">,</span>&nbsp;<span class="num" id="4228706">2</span><span class="op" id="4228707">,</span>&nbsp;<span class="num" id="4228709">2</span><span class="op" id="4228710">,</span>&nbsp;<span class="num" id="4228712">3</span><span class="op" id="4228713">,</span>&nbsp;<span class="num" id="4228715">3</span><span class="op" id="4228716">,</span>&nbsp;<span class="num" id="4228718">3</span><span class="op" id="4228719">,</span>&nbsp;<span class="num" id="4228721">3</span><span class="op" id="4228722">,</span>&nbsp;<span class="num" id="4228724">4</span><span class="op" id="4228725">,</span>&nbsp;<span class="num" id="4228727">4</span><span class="op" id="4228728">,</span>&nbsp;<span class="num" id="4228730">4</span><span class="op" id="4228731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4228734">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4228744">4</span><span class="op" id="4228745">,</span>&nbsp;<span class="num" id="4228747">5</span><span class="op" id="4228748">,</span>&nbsp;<span class="num" id="4228750">5</span><span class="op" id="4228751">,</span>&nbsp;<span class="num" id="4228753">5</span><span class="op" id="4228754">,</span>&nbsp;<span class="num" id="4228756">5</span><span class="op" id="4228757">,</span>&nbsp;<span class="num" id="4228759">0</span><span class="op" id="4228760">,</span><br>
<span class="lineno"></span><span class="op" id="4228762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4228765">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4228828">var</span>&nbsp;<span class="ident" id="4228832">lengthBase</span>&nbsp;<span class="op" id="4228843">=</span>&nbsp;<span class="op" id="4228845">[</span><span class="op" id="4228846">]</span><span class="builtintype" id="4228847">uint32</span><span class="op" id="4228853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4228856">0</span><span class="op" id="4228857">,</span>&nbsp;<span class="num" id="4228859">1</span><span class="op" id="4228860">,</span>&nbsp;<span class="num" id="4228862">2</span><span class="op" id="4228863">,</span>&nbsp;<span class="num" id="4228865">3</span><span class="op" id="4228866">,</span>&nbsp;<span class="num" id="4228868">4</span><span class="op" id="4228869">,</span>&nbsp;<span class="num" id="4228871">5</span><span class="op" id="4228872">,</span>&nbsp;<span class="num" id="4228874">6</span><span class="op" id="4228875">,</span>&nbsp;<span class="num" id="4228877">7</span><span class="op" id="4228878">,</span>&nbsp;<span class="num" id="4228880">8</span><span class="op" id="4228881">,</span>&nbsp;<span class="num" id="4228883">10</span><span class="op" id="4228885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4228888">12</span><span class="op" id="4228890">,</span>&nbsp;<span class="num" id="4228892">14</span><span class="op" id="4228894">,</span>&nbsp;<span class="num" id="4228896">16</span><span class="op" id="4228898">,</span>&nbsp;<span class="num" id="4228900">20</span><span class="op" id="4228902">,</span>&nbsp;<span class="num" id="4228904">24</span><span class="op" id="4228906">,</span>&nbsp;<span class="num" id="4228908">28</span><span class="op" id="4228910">,</span>&nbsp;<span class="num" id="4228912">32</span><span class="op" id="4228914">,</span>&nbsp;<span class="num" id="4228916">40</span><span class="op" id="4228918">,</span>&nbsp;<span class="num" id="4228920">48</span><span class="op" id="4228922">,</span>&nbsp;<span class="num" id="4228924">56</span><span class="op" id="4228926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4228929">64</span><span class="op" id="4228931">,</span>&nbsp;<span class="num" id="4228933">80</span><span class="op" id="4228935">,</span>&nbsp;<span class="num" id="4228937">96</span><span class="op" id="4228939">,</span>&nbsp;<span class="num" id="4228941">112</span><span class="op" id="4228944">,</span>&nbsp;<span class="num" id="4228946">128</span><span class="op" id="4228949">,</span>&nbsp;<span class="num" id="4228951">160</span><span class="op" id="4228954">,</span>&nbsp;<span class="num" id="4228956">192</span><span class="op" id="4228959">,</span>&nbsp;<span class="num" id="4228961">224</span><span class="op" id="4228964">,</span>&nbsp;<span class="num" id="4228966">255</span><span class="op" id="4228969">,</span><br>
<span class="lineno">40</span><span class="op" id="4228971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4228974">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4229006">var</span>&nbsp;<span class="ident" id="4229010">offsetExtraBits</span>&nbsp;<span class="op" id="4229026">=</span>&nbsp;<span class="op" id="4229028">[</span><span class="op" id="4229029">]</span><span class="builtintype" id="4229030">int8</span><span class="op" id="4229034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229037">0</span><span class="op" id="4229038">,</span>&nbsp;<span class="num" id="4229040">0</span><span class="op" id="4229041">,</span>&nbsp;<span class="num" id="4229043">0</span><span class="op" id="4229044">,</span>&nbsp;<span class="num" id="4229046">0</span><span class="op" id="4229047">,</span>&nbsp;<span class="num" id="4229049">1</span><span class="op" id="4229050">,</span>&nbsp;<span class="num" id="4229052">1</span><span class="op" id="4229053">,</span>&nbsp;<span class="num" id="4229055">2</span><span class="op" id="4229056">,</span>&nbsp;<span class="num" id="4229058">2</span><span class="op" id="4229059">,</span>&nbsp;<span class="num" id="4229061">3</span><span class="op" id="4229062">,</span>&nbsp;<span class="num" id="4229064">3</span><span class="op" id="4229065">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229068">4</span><span class="op" id="4229069">,</span>&nbsp;<span class="num" id="4229071">4</span><span class="op" id="4229072">,</span>&nbsp;<span class="num" id="4229074">5</span><span class="op" id="4229075">,</span>&nbsp;<span class="num" id="4229077">5</span><span class="op" id="4229078">,</span>&nbsp;<span class="num" id="4229080">6</span><span class="op" id="4229081">,</span>&nbsp;<span class="num" id="4229083">6</span><span class="op" id="4229084">,</span>&nbsp;<span class="num" id="4229086">7</span><span class="op" id="4229087">,</span>&nbsp;<span class="num" id="4229089">7</span><span class="op" id="4229090">,</span>&nbsp;<span class="num" id="4229092">8</span><span class="op" id="4229093">,</span>&nbsp;<span class="num" id="4229095">8</span><span class="op" id="4229096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229099">9</span><span class="op" id="4229100">,</span>&nbsp;<span class="num" id="4229102">9</span><span class="op" id="4229103">,</span>&nbsp;<span class="num" id="4229105">10</span><span class="op" id="4229107">,</span>&nbsp;<span class="num" id="4229109">10</span><span class="op" id="4229111">,</span>&nbsp;<span class="num" id="4229113">11</span><span class="op" id="4229115">,</span>&nbsp;<span class="num" id="4229117">11</span><span class="op" id="4229119">,</span>&nbsp;<span class="num" id="4229121">12</span><span class="op" id="4229123">,</span>&nbsp;<span class="num" id="4229125">12</span><span class="op" id="4229127">,</span>&nbsp;<span class="num" id="4229129">13</span><span class="op" id="4229131">,</span>&nbsp;<span class="num" id="4229133">13</span><span class="op" id="4229135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4229138">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229161">14</span><span class="op" id="4229163">,</span>&nbsp;<span class="num" id="4229165">14</span><span class="op" id="4229167">,</span>&nbsp;<span class="num" id="4229169">15</span><span class="op" id="4229171">,</span>&nbsp;<span class="num" id="4229173">15</span><span class="op" id="4229175">,</span>&nbsp;<span class="num" id="4229177">16</span><span class="op" id="4229179">,</span>&nbsp;<span class="num" id="4229181">16</span><span class="op" id="4229183">,</span>&nbsp;<span class="num" id="4229185">17</span><span class="op" id="4229187">,</span>&nbsp;<span class="num" id="4229189">17</span><span class="op" id="4229191">,</span>&nbsp;<span class="num" id="4229193">18</span><span class="op" id="4229195">,</span>&nbsp;<span class="num" id="4229197">18</span><span class="op" id="4229199">,</span>&nbsp;<span class="num" id="4229201">19</span><span class="op" id="4229203">,</span>&nbsp;<span class="num" id="4229205">19</span><span class="op" id="4229207">,</span>&nbsp;<span class="num" id="4229209">20</span><span class="op" id="4229211">,</span>&nbsp;<span class="num" id="4229213">20</span><span class="op" id="4229215">,</span><br>
<span class="lineno"></span><span class="op" id="4229217">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4229220">var</span>&nbsp;<span class="ident" id="4229224">offsetBase</span>&nbsp;<span class="op" id="4229235">=</span>&nbsp;<span class="op" id="4229237">[</span><span class="op" id="4229238">]</span><span class="builtintype" id="4229239">uint32</span><span class="op" id="4229245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4229248">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229270">0x000000</span><span class="op" id="4229278">,</span>&nbsp;<span class="num" id="4229280">0x000001</span><span class="op" id="4229288">,</span>&nbsp;<span class="num" id="4229290">0x000002</span><span class="op" id="4229298">,</span>&nbsp;<span class="num" id="4229300">0x000003</span><span class="op" id="4229308">,</span>&nbsp;<span class="num" id="4229310">0x000004</span><span class="op" id="4229318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229321">0x000006</span><span class="op" id="4229329">,</span>&nbsp;<span class="num" id="4229331">0x000008</span><span class="op" id="4229339">,</span>&nbsp;<span class="num" id="4229341">0x00000c</span><span class="op" id="4229349">,</span>&nbsp;<span class="num" id="4229351">0x000010</span><span class="op" id="4229359">,</span>&nbsp;<span class="num" id="4229361">0x000018</span><span class="op" id="4229369">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229372">0x000020</span><span class="op" id="4229380">,</span>&nbsp;<span class="num" id="4229382">0x000030</span><span class="op" id="4229390">,</span>&nbsp;<span class="num" id="4229392">0x000040</span><span class="op" id="4229400">,</span>&nbsp;<span class="num" id="4229402">0x000060</span><span class="op" id="4229410">,</span>&nbsp;<span class="num" id="4229412">0x000080</span><span class="op" id="4229420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229423">0x0000c0</span><span class="op" id="4229431">,</span>&nbsp;<span class="num" id="4229433">0x000100</span><span class="op" id="4229441">,</span>&nbsp;<span class="num" id="4229443">0x000180</span><span class="op" id="4229451">,</span>&nbsp;<span class="num" id="4229453">0x000200</span><span class="op" id="4229461">,</span>&nbsp;<span class="num" id="4229463">0x000300</span><span class="op" id="4229471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229474">0x000400</span><span class="op" id="4229482">,</span>&nbsp;<span class="num" id="4229484">0x000600</span><span class="op" id="4229492">,</span>&nbsp;<span class="num" id="4229494">0x000800</span><span class="op" id="4229502">,</span>&nbsp;<span class="num" id="4229504">0x000c00</span><span class="op" id="4229512">,</span>&nbsp;<span class="num" id="4229514">0x001000</span><span class="op" id="4229522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229525">0x001800</span><span class="op" id="4229533">,</span>&nbsp;<span class="num" id="4229535">0x002000</span><span class="op" id="4229543">,</span>&nbsp;<span class="num" id="4229545">0x003000</span><span class="op" id="4229553">,</span>&nbsp;<span class="num" id="4229555">0x004000</span><span class="op" id="4229563">,</span>&nbsp;<span class="num" id="4229565">0x006000</span><span class="op" id="4229573">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4229577">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229600">0x008000</span><span class="op" id="4229608">,</span>&nbsp;<span class="num" id="4229610">0x00c000</span><span class="op" id="4229618">,</span>&nbsp;<span class="num" id="4229620">0x010000</span><span class="op" id="4229628">,</span>&nbsp;<span class="num" id="4229630">0x018000</span><span class="op" id="4229638">,</span>&nbsp;<span class="num" id="4229640">0x020000</span><span class="op" id="4229648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229651">0x030000</span><span class="op" id="4229659">,</span>&nbsp;<span class="num" id="4229661">0x040000</span><span class="op" id="4229669">,</span>&nbsp;<span class="num" id="4229671">0x060000</span><span class="op" id="4229679">,</span>&nbsp;<span class="num" id="4229681">0x080000</span><span class="op" id="4229689">,</span>&nbsp;<span class="num" id="4229691">0x0c0000</span><span class="op" id="4229699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4229702">0x100000</span><span class="op" id="4229710">,</span>&nbsp;<span class="num" id="4229712">0x180000</span><span class="op" id="4229720">,</span>&nbsp;<span class="num" id="4229722">0x200000</span><span class="op" id="4229730">,</span>&nbsp;<span class="num" id="4229732">0x300000</span><span class="op" id="4229740">,</span><br>
<span class="lineno"></span><span class="op" id="4229742">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4229745">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4229807">var</span>&nbsp;<span class="ident" id="4229811">codegenOrder</span>&nbsp;<span class="op" id="4229824">=</span>&nbsp;<span class="op" id="4229826">[</span><span class="op" id="4229827">]</span><span class="builtintype" id="4229828">uint32</span><span class="op" id="4229834">{</span><span class="num" id="4229835">16</span><span class="op" id="4229837">,</span>&nbsp;<span class="num" id="4229839">17</span><span class="op" id="4229841">,</span>&nbsp;<span class="num" id="4229843">18</span><span class="op" id="4229845">,</span>&nbsp;<span class="num" id="4229847">0</span><span class="op" id="4229848">,</span>&nbsp;<span class="num" id="4229850">8</span><span class="op" id="4229851">,</span>&nbsp;<span class="num" id="4229853">7</span><span class="op" id="4229854">,</span>&nbsp;<span class="num" id="4229856">9</span><span class="op" id="4229857">,</span>&nbsp;<span class="num" id="4229859">6</span><span class="op" id="4229860">,</span>&nbsp;<span class="num" id="4229862">10</span><span class="op" id="4229864">,</span>&nbsp;<span class="num" id="4229866">5</span><span class="op" id="4229867">,</span>&nbsp;<span class="num" id="4229869">11</span><span class="op" id="4229871">,</span>&nbsp;<span class="num" id="4229873">4</span><span class="op" id="4229874">,</span>&nbsp;<span class="num" id="4229876">12</span><span class="op" id="4229878">,</span>&nbsp;<span class="num" id="4229880">3</span><span class="op" id="4229881">,</span>&nbsp;<span class="num" id="4229883">13</span><span class="op" id="4229885">,</span>&nbsp;<span class="num" id="4229887">2</span><span class="op" id="4229888">,</span>&nbsp;<span class="num" id="4229890">14</span><span class="op" id="4229892">,</span>&nbsp;<span class="num" id="4229894">1</span><span class="op" id="4229895">,</span>&nbsp;<span class="num" id="4229897">15</span><span class="op" id="4229899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4229902">type</span>&nbsp;<span class="ident" id="4229907">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4229924">struct</span>&nbsp;<span class="op" id="4229931">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4229934">w</span>&nbsp;<span class="ident" id="4229936">io</span><span class="op" id="4229938">.</span><span class="ident" id="4229939">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4229947">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4229997">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230033">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4230049">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230057">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4230073">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230081">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230097">[</span><span class="num" id="4230098">64</span><span class="op" id="4230100">]</span><span class="builtintype" id="4230101">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230107">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4230123">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230128">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230144">[</span><span class="op" id="4230145">]</span><span class="builtintype" id="4230146">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230153">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230169">[</span><span class="op" id="4230170">]</span><span class="builtintype" id="4230171">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230178">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230194">[</span><span class="op" id="4230195">]</span><span class="builtintype" id="4230196">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230203">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230219">[</span><span class="op" id="4230220">]</span><span class="builtintype" id="4230221">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230228">literalEncoding</span>&nbsp;<span class="op" id="4230244">*</span><span class="ident" id="4230245">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230261">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4230277">*</span><span class="ident" id="4230278">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230294">codegenEncoding</span>&nbsp;<span class="op" id="4230310">*</span><span class="ident" id="4230311">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230327">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4230343">error</span><br>
<span class="lineno">85</span><span class="op" id="4230349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4230352">func</span>&nbsp;<span class="ident" id="4230357">newHuffmanBitWriter</span><span class="op" id="4230376">(</span><span class="ident" id="4230377">w</span>&nbsp;<span class="ident" id="4230379">io</span><span class="op" id="4230381">.</span><span class="ident" id="4230382">Writer</span><span class="op" id="4230388">)</span>&nbsp;<span class="op" id="4230390">*</span><span class="ident" id="4230391">huffmanBitWriter</span>&nbsp;<span class="op" id="4230408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4230411">return</span>&nbsp;<span class="op" id="4230418">&amp;</span><span class="ident" id="4230419">huffmanBitWriter</span><span class="op" id="4230435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230439">w</span><span class="op" id="4230440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230456">w</span><span class="op" id="4230457">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230461">literalFreq</span><span class="op" id="4230472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4230478">make</span><span class="op" id="4230482">(</span><span class="op" id="4230483">[</span><span class="op" id="4230484">]</span><span class="builtintype" id="4230485">int32</span><span class="op" id="4230490">,</span>&nbsp;<span class="ident" id="4230492">maxLit</span><span class="op" id="4230498">)</span><span class="op" id="4230499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230503">offsetFreq</span><span class="op" id="4230513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4230520">make</span><span class="op" id="4230524">(</span><span class="op" id="4230525">[</span><span class="op" id="4230526">]</span><span class="builtintype" id="4230527">int32</span><span class="op" id="4230532">,</span>&nbsp;<span class="ident" id="4230534">offsetCodeCount</span><span class="op" id="4230549">)</span><span class="op" id="4230550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230554">codegen</span><span class="op" id="4230561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4230571">make</span><span class="op" id="4230575">(</span><span class="op" id="4230576">[</span><span class="op" id="4230577">]</span><span class="builtintype" id="4230578">uint8</span><span class="op" id="4230583">,</span>&nbsp;<span class="ident" id="4230585">maxLit</span><span class="op" id="4230591">+</span><span class="ident" id="4230592">offsetCodeCount</span><span class="op" id="4230607">+</span><span class="num" id="4230608">1</span><span class="op" id="4230609">)</span><span class="op" id="4230610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230614">codegenFreq</span><span class="op" id="4230625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4230631">make</span><span class="op" id="4230635">(</span><span class="op" id="4230636">[</span><span class="op" id="4230637">]</span><span class="builtintype" id="4230638">int32</span><span class="op" id="4230643">,</span>&nbsp;<span class="ident" id="4230645">codegenCodeCount</span><span class="op" id="4230661">)</span><span class="op" id="4230662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230666">literalEncoding</span><span class="op" id="4230681">:</span>&nbsp;<span class="ident" id="4230683">newHuffmanEncoder</span><span class="op" id="4230700">(</span><span class="ident" id="4230701">maxLit</span><span class="op" id="4230707">)</span><span class="op" id="4230708">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230712">offsetEncoding</span><span class="op" id="4230726">:</span>&nbsp;&nbsp;<span class="ident" id="4230729">newHuffmanEncoder</span><span class="op" id="4230746">(</span><span class="ident" id="4230747">offsetCodeCount</span><span class="op" id="4230762">)</span><span class="op" id="4230763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230767">codegenEncoding</span><span class="op" id="4230782">:</span>&nbsp;<span class="ident" id="4230784">newHuffmanEncoder</span><span class="op" id="4230801">(</span><span class="ident" id="4230802">codegenCodeCount</span><span class="op" id="4230818">)</span><span class="op" id="4230819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4230822">}</span><br>
<span class="lineno"></span><span class="op" id="4230824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4230827">func</span>&nbsp;<span class="op" id="4230832">(</span><span class="ident" id="4230833">w</span>&nbsp;<span class="op" id="4230835">*</span><span class="ident" id="4230836">huffmanBitWriter</span><span class="op" id="4230852">)</span>&nbsp;<span class="ident" id="4230854">reset</span><span class="op" id="4230859">(</span><span class="ident" id="4230860">writer</span>&nbsp;<span class="ident" id="4230867">io</span><span class="op" id="4230869">.</span><span class="ident" id="4230870">Writer</span><span class="op" id="4230876">)</span>&nbsp;<span class="op" id="4230878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230881">w</span><span class="op" id="4230882">.</span><span class="ident" id="4230883">w</span>&nbsp;<span class="op" id="4230885">=</span>&nbsp;<span class="ident" id="4230887">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230895">w</span><span class="op" id="4230896">.</span><span class="ident" id="4230897">bits</span><span class="op" id="4230901">,</span>&nbsp;<span class="ident" id="4230903">w</span><span class="op" id="4230904">.</span><span class="ident" id="4230905">nbits</span><span class="op" id="4230910">,</span>&nbsp;<span class="ident" id="4230912">w</span><span class="op" id="4230913">.</span><span class="ident" id="4230914">nbytes</span><span class="op" id="4230920">,</span>&nbsp;<span class="ident" id="4230922">w</span><span class="op" id="4230923">.</span><span class="ident" id="4230924">err</span>&nbsp;<span class="op" id="4230928">=</span>&nbsp;<span class="num" id="4230930">0</span><span class="op" id="4230931">,</span>&nbsp;<span class="num" id="4230933">0</span><span class="op" id="4230934">,</span>&nbsp;<span class="num" id="4230936">0</span><span class="op" id="4230937">,</span>&nbsp;<span class="builtintype" id="4230939">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230944">w</span><span class="op" id="4230945">.</span><span class="ident" id="4230946">bytes</span>&nbsp;<span class="op" id="4230952">=</span>&nbsp;<span class="op" id="4230954">[</span><span class="num" id="4230955">64</span><span class="op" id="4230957">]</span><span class="builtintype" id="4230958">byte</span><span class="op" id="4230962">{</span><span class="op" id="4230963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4230966">for</span>&nbsp;<span class="ident" id="4230970">i</span>&nbsp;<span class="op" id="4230972">:=</span>&nbsp;<span class="keyword" id="4230975">range</span>&nbsp;<span class="ident" id="4230981">w</span><span class="op" id="4230982">.</span><span class="ident" id="4230983">codegen</span>&nbsp;<span class="op" id="4230991">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4230995">w</span><span class="op" id="4230996">.</span><span class="ident" id="4230997">codegen</span><span class="op" id="4231004">[</span><span class="ident" id="4231005">i</span><span class="op" id="4231006">]</span>&nbsp;<span class="op" id="4231008">=</span>&nbsp;<span class="num" id="4231010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231016">for</span>&nbsp;<span class="ident" id="4231020">_</span><span class="op" id="4231021">,</span>&nbsp;<span class="ident" id="4231023">s</span>&nbsp;<span class="op" id="4231025">:=</span>&nbsp;<span class="keyword" id="4231028">range</span>&nbsp;<span class="op" id="4231034">[</span><span class="op" id="4231035">...</span><span class="op" id="4231038">]</span><span class="op" id="4231039">[</span><span class="op" id="4231040">]</span><span class="builtintype" id="4231041">int32</span><span class="op" id="4231046">{</span><span class="ident" id="4231047">w</span><span class="op" id="4231048">.</span><span class="ident" id="4231049">literalFreq</span><span class="op" id="4231060">,</span>&nbsp;<span class="ident" id="4231062">w</span><span class="op" id="4231063">.</span><span class="ident" id="4231064">offsetFreq</span><span class="op" id="4231074">,</span>&nbsp;<span class="ident" id="4231076">w</span><span class="op" id="4231077">.</span><span class="ident" id="4231078">codegenFreq</span><span class="op" id="4231089">}</span>&nbsp;<span class="op" id="4231091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231095">for</span>&nbsp;<span class="ident" id="4231099">i</span>&nbsp;<span class="op" id="4231101">:=</span>&nbsp;<span class="keyword" id="4231104">range</span>&nbsp;<span class="ident" id="4231110">s</span>&nbsp;<span class="op" id="4231112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231117">s</span><span class="op" id="4231118">[</span><span class="ident" id="4231119">i</span><span class="op" id="4231120">]</span>&nbsp;<span class="op" id="4231122">=</span>&nbsp;<span class="num" id="4231124">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231134">for</span>&nbsp;<span class="ident" id="4231138">_</span><span class="op" id="4231139">,</span>&nbsp;<span class="ident" id="4231141">enc</span>&nbsp;<span class="op" id="4231145">:=</span>&nbsp;<span class="keyword" id="4231148">range</span>&nbsp;<span class="op" id="4231154">[</span><span class="op" id="4231155">...</span><span class="op" id="4231158">]</span><span class="op" id="4231159">*</span><span class="ident" id="4231160">huffmanEncoder</span><span class="op" id="4231174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231178">w</span><span class="op" id="4231179">.</span><span class="ident" id="4231180">literalEncoding</span><span class="op" id="4231195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231199">w</span><span class="op" id="4231200">.</span><span class="ident" id="4231201">offsetEncoding</span><span class="op" id="4231215">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231219">w</span><span class="op" id="4231220">.</span><span class="ident" id="4231221">codegenEncoding</span><span class="op" id="4231236">}</span>&nbsp;<span class="op" id="4231238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231242">for</span>&nbsp;<span class="ident" id="4231246">i</span>&nbsp;<span class="op" id="4231248">:=</span>&nbsp;<span class="keyword" id="4231251">range</span>&nbsp;<span class="ident" id="4231257">enc</span><span class="op" id="4231260">.</span><span class="ident" id="4231261">code</span>&nbsp;<span class="op" id="4231266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231271">enc</span><span class="op" id="4231274">.</span><span class="ident" id="4231275">code</span><span class="op" id="4231279">[</span><span class="ident" id="4231280">i</span><span class="op" id="4231281">]</span>&nbsp;<span class="op" id="4231283">=</span>&nbsp;<span class="num" id="4231285">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231293">for</span>&nbsp;<span class="ident" id="4231297">i</span>&nbsp;<span class="op" id="4231299">:=</span>&nbsp;<span class="keyword" id="4231302">range</span>&nbsp;<span class="ident" id="4231308">enc</span><span class="op" id="4231311">.</span><span class="ident" id="4231312">codeBits</span>&nbsp;<span class="op" id="4231321">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231326">enc</span><span class="op" id="4231329">.</span><span class="ident" id="4231330">codeBits</span><span class="op" id="4231338">[</span><span class="ident" id="4231339">i</span><span class="op" id="4231340">]</span>&nbsp;<span class="op" id="4231342">=</span>&nbsp;<span class="num" id="4231344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231351">}</span><br>
<span class="lineno"></span><span class="op" id="4231353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4231356">func</span>&nbsp;<span class="op" id="4231361">(</span><span class="ident" id="4231362">w</span>&nbsp;<span class="op" id="4231364">*</span><span class="ident" id="4231365">huffmanBitWriter</span><span class="op" id="4231381">)</span>&nbsp;<span class="ident" id="4231383">flushBits</span><span class="op" id="4231392">(</span><span class="op" id="4231393">)</span>&nbsp;<span class="op" id="4231395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231398">if</span>&nbsp;<span class="ident" id="4231401">w</span><span class="op" id="4231402">.</span><span class="ident" id="4231403">err</span>&nbsp;<span class="op" id="4231407">!=</span>&nbsp;<span class="builtintype" id="4231410">nil</span>&nbsp;<span class="op" id="4231414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231418">w</span><span class="op" id="4231419">.</span><span class="ident" id="4231420">nbits</span>&nbsp;<span class="op" id="4231426">=</span>&nbsp;<span class="num" id="4231428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231440">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231443">bits</span>&nbsp;<span class="op" id="4231448">:=</span>&nbsp;<span class="ident" id="4231451">w</span><span class="op" id="4231452">.</span><span class="ident" id="4231453">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231459">w</span><span class="op" id="4231460">.</span><span class="ident" id="4231461">bits</span>&nbsp;<span class="op" id="4231466">&gt;&gt;=</span>&nbsp;<span class="num" id="4231470">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231474">w</span><span class="op" id="4231475">.</span><span class="ident" id="4231476">nbits</span>&nbsp;<span class="op" id="4231482">-=</span>&nbsp;<span class="num" id="4231485">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231489">n</span>&nbsp;<span class="op" id="4231491">:=</span>&nbsp;<span class="ident" id="4231494">w</span><span class="op" id="4231495">.</span><span class="ident" id="4231496">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231504">w</span><span class="op" id="4231505">.</span><span class="ident" id="4231506">bytes</span><span class="op" id="4231511">[</span><span class="ident" id="4231512">n</span><span class="op" id="4231513">]</span>&nbsp;<span class="op" id="4231515">=</span>&nbsp;<span class="builtintype" id="4231517">byte</span><span class="op" id="4231521">(</span><span class="ident" id="4231522">bits</span><span class="op" id="4231526">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231529">w</span><span class="op" id="4231530">.</span><span class="ident" id="4231531">bytes</span><span class="op" id="4231536">[</span><span class="ident" id="4231537">n</span><span class="op" id="4231538">+</span><span class="num" id="4231539">1</span><span class="op" id="4231540">]</span>&nbsp;<span class="op" id="4231542">=</span>&nbsp;<span class="builtintype" id="4231544">byte</span><span class="op" id="4231548">(</span><span class="ident" id="4231549">bits</span>&nbsp;<span class="op" id="4231554">&gt;&gt;</span>&nbsp;<span class="num" id="4231557">8</span><span class="op" id="4231558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231561">if</span>&nbsp;<span class="ident" id="4231564">n</span>&nbsp;<span class="op" id="4231566">+=</span>&nbsp;<span class="num" id="4231569">2</span><span class="op" id="4231570">;</span>&nbsp;<span class="ident" id="4231572">n</span>&nbsp;<span class="op" id="4231574">&gt;=</span>&nbsp;<span class="builtinfunc" id="4231577">len</span><span class="op" id="4231580">(</span><span class="ident" id="4231581">w</span><span class="op" id="4231582">.</span><span class="ident" id="4231583">bytes</span><span class="op" id="4231588">)</span>&nbsp;<span class="op" id="4231590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231594">_</span><span class="op" id="4231595">,</span>&nbsp;<span class="ident" id="4231597">w</span><span class="op" id="4231598">.</span><span class="ident" id="4231599">err</span>&nbsp;<span class="op" id="4231603">=</span>&nbsp;<span class="ident" id="4231605">w</span><span class="op" id="4231606">.</span><span class="ident" id="4231607">w</span><span class="op" id="4231608">.</span><span class="ident" id="4231609">Write</span><span class="op" id="4231614">(</span><span class="ident" id="4231615">w</span><span class="op" id="4231616">.</span><span class="ident" id="4231617">bytes</span><span class="op" id="4231622">[</span><span class="num" id="4231623">0</span><span class="op" id="4231624">:</span><span class="op" id="4231625">]</span><span class="op" id="4231626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231630">n</span>&nbsp;<span class="op" id="4231632">=</span>&nbsp;<span class="num" id="4231634">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231637">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231640">w</span><span class="op" id="4231641">.</span><span class="ident" id="4231642">nbytes</span>&nbsp;<span class="op" id="4231649">=</span>&nbsp;<span class="ident" id="4231651">n</span><br>
<span class="lineno"></span><span class="op" id="4231653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231656">func</span>&nbsp;<span class="op" id="4231661">(</span><span class="ident" id="4231662">w</span>&nbsp;<span class="op" id="4231664">*</span><span class="ident" id="4231665">huffmanBitWriter</span><span class="op" id="4231681">)</span>&nbsp;<span class="ident" id="4231683">flush</span><span class="op" id="4231688">(</span><span class="op" id="4231689">)</span>&nbsp;<span class="op" id="4231691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231694">if</span>&nbsp;<span class="ident" id="4231697">w</span><span class="op" id="4231698">.</span><span class="ident" id="4231699">err</span>&nbsp;<span class="op" id="4231703">!=</span>&nbsp;<span class="builtintype" id="4231706">nil</span>&nbsp;<span class="op" id="4231710">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231714">w</span><span class="op" id="4231715">.</span><span class="ident" id="4231716">nbits</span>&nbsp;<span class="op" id="4231722">=</span>&nbsp;<span class="num" id="4231724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231728">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231739">n</span>&nbsp;<span class="op" id="4231741">:=</span>&nbsp;<span class="ident" id="4231744">w</span><span class="op" id="4231745">.</span><span class="ident" id="4231746">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231754">if</span>&nbsp;<span class="ident" id="4231757">w</span><span class="op" id="4231758">.</span><span class="ident" id="4231759">nbits</span>&nbsp;<span class="op" id="4231765">&gt;</span>&nbsp;<span class="num" id="4231767">8</span>&nbsp;<span class="op" id="4231769">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231773">w</span><span class="op" id="4231774">.</span><span class="ident" id="4231775">bytes</span><span class="op" id="4231780">[</span><span class="ident" id="4231781">n</span><span class="op" id="4231782">]</span>&nbsp;<span class="op" id="4231784">=</span>&nbsp;<span class="builtintype" id="4231786">byte</span><span class="op" id="4231790">(</span><span class="ident" id="4231791">w</span><span class="op" id="4231792">.</span><span class="ident" id="4231793">bits</span><span class="op" id="4231797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231801">w</span><span class="op" id="4231802">.</span><span class="ident" id="4231803">bits</span>&nbsp;<span class="op" id="4231808">&gt;&gt;=</span>&nbsp;<span class="num" id="4231812">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231816">w</span><span class="op" id="4231817">.</span><span class="ident" id="4231818">nbits</span>&nbsp;<span class="op" id="4231824">-=</span>&nbsp;<span class="num" id="4231827">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231831">n</span><span class="op" id="4231832">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231836">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4231839">if</span>&nbsp;<span class="ident" id="4231842">w</span><span class="op" id="4231843">.</span><span class="ident" id="4231844">nbits</span>&nbsp;<span class="op" id="4231850">&gt;</span>&nbsp;<span class="num" id="4231852">0</span>&nbsp;<span class="op" id="4231854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231858">w</span><span class="op" id="4231859">.</span><span class="ident" id="4231860">bytes</span><span class="op" id="4231865">[</span><span class="ident" id="4231866">n</span><span class="op" id="4231867">]</span>&nbsp;<span class="op" id="4231869">=</span>&nbsp;<span class="builtintype" id="4231871">byte</span><span class="op" id="4231875">(</span><span class="ident" id="4231876">w</span><span class="op" id="4231877">.</span><span class="ident" id="4231878">bits</span><span class="op" id="4231882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231886">w</span><span class="op" id="4231887">.</span><span class="ident" id="4231888">nbits</span>&nbsp;<span class="op" id="4231894">=</span>&nbsp;<span class="num" id="4231896">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231900">n</span><span class="op" id="4231901">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231905">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231908">w</span><span class="op" id="4231909">.</span><span class="ident" id="4231910">bits</span>&nbsp;<span class="op" id="4231915">=</span>&nbsp;<span class="num" id="4231917">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231920">_</span><span class="op" id="4231921">,</span>&nbsp;<span class="ident" id="4231923">w</span><span class="op" id="4231924">.</span><span class="ident" id="4231925">err</span>&nbsp;<span class="op" id="4231929">=</span>&nbsp;<span class="ident" id="4231931">w</span><span class="op" id="4231932">.</span><span class="ident" id="4231933">w</span><span class="op" id="4231934">.</span><span class="ident" id="4231935">Write</span><span class="op" id="4231940">(</span><span class="ident" id="4231941">w</span><span class="op" id="4231942">.</span><span class="ident" id="4231943">bytes</span><span class="op" id="4231948">[</span><span class="num" id="4231949">0</span><span class="op" id="4231950">:</span><span class="ident" id="4231951">n</span><span class="op" id="4231952">]</span><span class="op" id="4231953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4231956">w</span><span class="op" id="4231957">.</span><span class="ident" id="4231958">nbytes</span>&nbsp;<span class="op" id="4231965">=</span>&nbsp;<span class="num" id="4231967">0</span><br>
<span class="lineno"></span><span class="op" id="4231969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4231972">func</span>&nbsp;<span class="op" id="4231977">(</span><span class="ident" id="4231978">w</span>&nbsp;<span class="op" id="4231980">*</span><span class="ident" id="4231981">huffmanBitWriter</span><span class="op" id="4231997">)</span>&nbsp;<span class="ident" id="4231999">writeBits</span><span class="op" id="4232008">(</span><span class="ident" id="4232009">b</span><span class="op" id="4232010">,</span>&nbsp;<span class="ident" id="4232012">nb</span>&nbsp;<span class="builtintype" id="4232015">int32</span><span class="op" id="4232020">)</span>&nbsp;<span class="op" id="4232022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232025">w</span><span class="op" id="4232026">.</span><span class="ident" id="4232027">bits</span>&nbsp;<span class="op" id="4232032">|=</span>&nbsp;<span class="builtintype" id="4232035">uint32</span><span class="op" id="4232041">(</span><span class="ident" id="4232042">b</span><span class="op" id="4232043">)</span>&nbsp;<span class="op" id="4232045">&lt;&lt;</span>&nbsp;<span class="ident" id="4232048">w</span><span class="op" id="4232049">.</span><span class="ident" id="4232050">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232057">if</span>&nbsp;<span class="ident" id="4232060">w</span><span class="op" id="4232061">.</span><span class="ident" id="4232062">nbits</span>&nbsp;<span class="op" id="4232068">+=</span>&nbsp;<span class="builtintype" id="4232071">uint32</span><span class="op" id="4232077">(</span><span class="ident" id="4232078">nb</span><span class="op" id="4232080">)</span><span class="op" id="4232081">;</span>&nbsp;<span class="ident" id="4232083">w</span><span class="op" id="4232084">.</span><span class="ident" id="4232085">nbits</span>&nbsp;<span class="op" id="4232091">&gt;=</span>&nbsp;<span class="num" id="4232094">16</span>&nbsp;<span class="op" id="4232097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232101">w</span><span class="op" id="4232102">.</span><span class="ident" id="4232103">flushBits</span><span class="op" id="4232112">(</span><span class="op" id="4232113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232116">}</span><br>
<span class="lineno">170</span><span class="op" id="4232118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4232121">func</span>&nbsp;<span class="op" id="4232126">(</span><span class="ident" id="4232127">w</span>&nbsp;<span class="op" id="4232129">*</span><span class="ident" id="4232130">huffmanBitWriter</span><span class="op" id="4232146">)</span>&nbsp;<span class="ident" id="4232148">writeBytes</span><span class="op" id="4232158">(</span><span class="ident" id="4232159">bytes</span>&nbsp;<span class="op" id="4232165">[</span><span class="op" id="4232166">]</span><span class="builtintype" id="4232167">byte</span><span class="op" id="4232171">)</span>&nbsp;<span class="op" id="4232173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232176">if</span>&nbsp;<span class="ident" id="4232179">w</span><span class="op" id="4232180">.</span><span class="ident" id="4232181">err</span>&nbsp;<span class="op" id="4232185">!=</span>&nbsp;<span class="builtintype" id="4232188">nil</span>&nbsp;<span class="op" id="4232192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232196">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232207">n</span>&nbsp;<span class="op" id="4232209">:=</span>&nbsp;<span class="ident" id="4232212">w</span><span class="op" id="4232213">.</span><span class="ident" id="4232214">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232222">if</span>&nbsp;<span class="ident" id="4232225">w</span><span class="op" id="4232226">.</span><span class="ident" id="4232227">nbits</span>&nbsp;<span class="op" id="4232233">==</span>&nbsp;<span class="num" id="4232236">8</span>&nbsp;<span class="op" id="4232238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232242">w</span><span class="op" id="4232243">.</span><span class="ident" id="4232244">bytes</span><span class="op" id="4232249">[</span><span class="ident" id="4232250">n</span><span class="op" id="4232251">]</span>&nbsp;<span class="op" id="4232253">=</span>&nbsp;<span class="builtintype" id="4232255">byte</span><span class="op" id="4232259">(</span><span class="ident" id="4232260">w</span><span class="op" id="4232261">.</span><span class="ident" id="4232262">bits</span><span class="op" id="4232266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232270">w</span><span class="op" id="4232271">.</span><span class="ident" id="4232272">nbits</span>&nbsp;<span class="op" id="4232278">=</span>&nbsp;<span class="num" id="4232280">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232284">n</span><span class="op" id="4232285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232292">if</span>&nbsp;<span class="ident" id="4232295">w</span><span class="op" id="4232296">.</span><span class="ident" id="4232297">nbits</span>&nbsp;<span class="op" id="4232303">!=</span>&nbsp;<span class="num" id="4232306">0</span>&nbsp;<span class="op" id="4232308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232312">w</span><span class="op" id="4232313">.</span><span class="ident" id="4232314">err</span>&nbsp;<span class="op" id="4232318">=</span>&nbsp;<span class="ident" id="4232320">InternalError</span><span class="op" id="4232333">(</span><span class="string" id="4232334">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4232367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232371">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232382">if</span>&nbsp;<span class="ident" id="4232385">n</span>&nbsp;<span class="op" id="4232387">!=</span>&nbsp;<span class="num" id="4232390">0</span>&nbsp;<span class="op" id="4232392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232396">_</span><span class="op" id="4232397">,</span>&nbsp;<span class="ident" id="4232399">w</span><span class="op" id="4232400">.</span><span class="ident" id="4232401">err</span>&nbsp;<span class="op" id="4232405">=</span>&nbsp;<span class="ident" id="4232407">w</span><span class="op" id="4232408">.</span><span class="ident" id="4232409">w</span><span class="op" id="4232410">.</span><span class="ident" id="4232411">Write</span><span class="op" id="4232416">(</span><span class="ident" id="4232417">w</span><span class="op" id="4232418">.</span><span class="ident" id="4232419">bytes</span><span class="op" id="4232424">[</span><span class="num" id="4232425">0</span><span class="op" id="4232426">:</span><span class="ident" id="4232427">n</span><span class="op" id="4232428">]</span><span class="op" id="4232429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232433">if</span>&nbsp;<span class="ident" id="4232436">w</span><span class="op" id="4232437">.</span><span class="ident" id="4232438">err</span>&nbsp;<span class="op" id="4232442">!=</span>&nbsp;<span class="builtintype" id="4232445">nil</span>&nbsp;<span class="op" id="4232449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4232454">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4232466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232469">w</span><span class="op" id="4232470">.</span><span class="ident" id="4232471">nbytes</span>&nbsp;<span class="op" id="4232478">=</span>&nbsp;<span class="num" id="4232480">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4232483">_</span><span class="op" id="4232484">,</span>&nbsp;<span class="ident" id="4232486">w</span><span class="op" id="4232487">.</span><span class="ident" id="4232488">err</span>&nbsp;<span class="op" id="4232492">=</span>&nbsp;<span class="ident" id="4232494">w</span><span class="op" id="4232495">.</span><span class="ident" id="4232496">w</span><span class="op" id="4232497">.</span><span class="ident" id="4232498">Write</span><span class="op" id="4232503">(</span><span class="ident" id="4232504">bytes</span><span class="op" id="4232509">)</span><br>
<span class="lineno"></span><span class="op" id="4232511">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4232514">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4232587">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4232666">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4232726">//</span><br>
<span class="lineno">200</span><span class="comment" id="4232729">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4232798">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4232853">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4232929">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4232976">//</span><br>
<span class="lineno">205</span><span class="comment" id="4232979">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4233042">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4233103">func</span>&nbsp;<span class="op" id="4233108">(</span><span class="ident" id="4233109">w</span>&nbsp;<span class="op" id="4233111">*</span><span class="ident" id="4233112">huffmanBitWriter</span><span class="op" id="4233128">)</span>&nbsp;<span class="ident" id="4233130">generateCodegen</span><span class="op" id="4233145">(</span><span class="ident" id="4233146">numLiterals</span>&nbsp;<span class="builtintype" id="4233158">int</span><span class="op" id="4233161">,</span>&nbsp;<span class="ident" id="4233163">numOffsets</span>&nbsp;<span class="builtintype" id="4233174">int</span><span class="op" id="4233177">)</span>&nbsp;<span class="op" id="4233179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4233182">for</span>&nbsp;<span class="ident" id="4233186">i</span>&nbsp;<span class="op" id="4233188">:=</span>&nbsp;<span class="keyword" id="4233191">range</span>&nbsp;<span class="ident" id="4233197">w</span><span class="op" id="4233198">.</span><span class="ident" id="4233199">codegenFreq</span>&nbsp;<span class="op" id="4233211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233215">w</span><span class="op" id="4233216">.</span><span class="ident" id="4233217">codegenFreq</span><span class="op" id="4233228">[</span><span class="ident" id="4233229">i</span><span class="op" id="4233230">]</span>&nbsp;<span class="op" id="4233232">=</span>&nbsp;<span class="num" id="4233234">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4233237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233240">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233316">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233389">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233463">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233475">codegen</span>&nbsp;<span class="op" id="4233483">:=</span>&nbsp;<span class="ident" id="4233486">w</span><span class="op" id="4233487">.</span><span class="ident" id="4233488">codegen</span>&nbsp;<span class="comment" id="4233496">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233506">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4233581">copy</span><span class="op" id="4233585">(</span><span class="ident" id="4233586">codegen</span><span class="op" id="4233593">[</span><span class="num" id="4233594">0</span><span class="op" id="4233595">:</span><span class="ident" id="4233596">numLiterals</span><span class="op" id="4233607">]</span><span class="op" id="4233608">,</span>&nbsp;<span class="ident" id="4233610">w</span><span class="op" id="4233611">.</span><span class="ident" id="4233612">literalEncoding</span><span class="op" id="4233627">.</span><span class="ident" id="4233628">codeBits</span><span class="op" id="4233636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4233639">copy</span><span class="op" id="4233643">(</span><span class="ident" id="4233644">codegen</span><span class="op" id="4233651">[</span><span class="ident" id="4233652">numLiterals</span><span class="op" id="4233663">:</span><span class="ident" id="4233664">numLiterals</span><span class="op" id="4233675">+</span><span class="ident" id="4233676">numOffsets</span><span class="op" id="4233686">]</span><span class="op" id="4233687">,</span>&nbsp;<span class="ident" id="4233689">w</span><span class="op" id="4233690">.</span><span class="ident" id="4233691">offsetEncoding</span><span class="op" id="4233705">.</span><span class="ident" id="4233706">codeBits</span><span class="op" id="4233714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233717">codegen</span><span class="op" id="4233724">[</span><span class="ident" id="4233725">numLiterals</span><span class="op" id="4233736">+</span><span class="ident" id="4233737">numOffsets</span><span class="op" id="4233747">]</span>&nbsp;<span class="op" id="4233749">=</span>&nbsp;<span class="ident" id="4233751">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233761">size</span>&nbsp;<span class="op" id="4233766">:=</span>&nbsp;<span class="ident" id="4233769">codegen</span><span class="op" id="4233776">[</span><span class="num" id="4233777">0</span><span class="op" id="4233778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233781">count</span>&nbsp;<span class="op" id="4233787">:=</span>&nbsp;<span class="num" id="4233790">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233793">outIndex</span>&nbsp;<span class="op" id="4233802">:=</span>&nbsp;<span class="num" id="4233805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4233808">for</span>&nbsp;<span class="ident" id="4233812">inIndex</span>&nbsp;<span class="op" id="4233820">:=</span>&nbsp;<span class="num" id="4233823">1</span><span class="op" id="4233824">;</span>&nbsp;<span class="ident" id="4233826">size</span>&nbsp;<span class="op" id="4233831">!=</span>&nbsp;<span class="ident" id="4233834">badCode</span><span class="op" id="4233841">;</span>&nbsp;<span class="ident" id="4233843">inIndex</span><span class="op" id="4233850">++</span>&nbsp;<span class="op" id="4233853">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233857">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4233927">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4233963">nextSize</span>&nbsp;<span class="op" id="4233972">:=</span>&nbsp;<span class="ident" id="4233975">codegen</span><span class="op" id="4233982">[</span><span class="ident" id="4233983">inIndex</span><span class="op" id="4233990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4233994">if</span>&nbsp;<span class="ident" id="4233997">nextSize</span>&nbsp;<span class="op" id="4234006">==</span>&nbsp;<span class="ident" id="4234009">size</span>&nbsp;<span class="op" id="4234014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234019">count</span><span class="op" id="4234024">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234030">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234045">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234106">if</span>&nbsp;<span class="ident" id="4234109">size</span>&nbsp;<span class="op" id="4234114">!=</span>&nbsp;<span class="num" id="4234117">0</span>&nbsp;<span class="op" id="4234119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234124">codegen</span><span class="op" id="4234131">[</span><span class="ident" id="4234132">outIndex</span><span class="op" id="4234140">]</span>&nbsp;<span class="op" id="4234142">=</span>&nbsp;<span class="ident" id="4234144">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234152">outIndex</span><span class="op" id="4234160">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234166">w</span><span class="op" id="4234167">.</span><span class="ident" id="4234168">codegenFreq</span><span class="op" id="4234179">[</span><span class="ident" id="4234180">size</span><span class="op" id="4234184">]</span><span class="op" id="4234185">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234191">count</span><span class="op" id="4234196">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234202">for</span>&nbsp;<span class="ident" id="4234206">count</span>&nbsp;<span class="op" id="4234212">&gt;=</span>&nbsp;<span class="num" id="4234215">3</span>&nbsp;<span class="op" id="4234217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234223">n</span>&nbsp;<span class="op" id="4234225">:=</span>&nbsp;<span class="num" id="4234228">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234234">if</span>&nbsp;<span class="ident" id="4234237">n</span>&nbsp;<span class="op" id="4234239">&gt;</span>&nbsp;<span class="ident" id="4234241">count</span>&nbsp;<span class="op" id="4234247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234254">n</span>&nbsp;<span class="op" id="4234256">=</span>&nbsp;<span class="ident" id="4234258">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234274">codegen</span><span class="op" id="4234281">[</span><span class="ident" id="4234282">outIndex</span><span class="op" id="4234290">]</span>&nbsp;<span class="op" id="4234292">=</span>&nbsp;<span class="num" id="4234294">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234301">outIndex</span><span class="op" id="4234309">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234316">codegen</span><span class="op" id="4234323">[</span><span class="ident" id="4234324">outIndex</span><span class="op" id="4234332">]</span>&nbsp;<span class="op" id="4234334">=</span>&nbsp;<span class="builtintype" id="4234336">uint8</span><span class="op" id="4234341">(</span><span class="ident" id="4234342">n</span>&nbsp;<span class="op" id="4234344">-</span>&nbsp;<span class="num" id="4234346">3</span><span class="op" id="4234347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234353">outIndex</span><span class="op" id="4234361">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234368">w</span><span class="op" id="4234369">.</span><span class="ident" id="4234370">codegenFreq</span><span class="op" id="4234381">[</span><span class="num" id="4234382">16</span><span class="op" id="4234384">]</span><span class="op" id="4234385">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234392">count</span>&nbsp;<span class="op" id="4234398">-=</span>&nbsp;<span class="ident" id="4234401">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234406">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234410">}</span>&nbsp;<span class="keyword" id="4234412">else</span>&nbsp;<span class="op" id="4234417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234422">for</span>&nbsp;<span class="ident" id="4234426">count</span>&nbsp;<span class="op" id="4234432">&gt;=</span>&nbsp;<span class="num" id="4234435">11</span>&nbsp;<span class="op" id="4234438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234444">n</span>&nbsp;<span class="op" id="4234446">:=</span>&nbsp;<span class="num" id="4234449">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234457">if</span>&nbsp;<span class="ident" id="4234460">n</span>&nbsp;<span class="op" id="4234462">&gt;</span>&nbsp;<span class="ident" id="4234464">count</span>&nbsp;<span class="op" id="4234470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234477">n</span>&nbsp;<span class="op" id="4234479">=</span>&nbsp;<span class="ident" id="4234481">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234497">codegen</span><span class="op" id="4234504">[</span><span class="ident" id="4234505">outIndex</span><span class="op" id="4234513">]</span>&nbsp;<span class="op" id="4234515">=</span>&nbsp;<span class="num" id="4234517">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234524">outIndex</span><span class="op" id="4234532">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234539">codegen</span><span class="op" id="4234546">[</span><span class="ident" id="4234547">outIndex</span><span class="op" id="4234555">]</span>&nbsp;<span class="op" id="4234557">=</span>&nbsp;<span class="builtintype" id="4234559">uint8</span><span class="op" id="4234564">(</span><span class="ident" id="4234565">n</span>&nbsp;<span class="op" id="4234567">-</span>&nbsp;<span class="num" id="4234569">11</span><span class="op" id="4234571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234577">outIndex</span><span class="op" id="4234585">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234592">w</span><span class="op" id="4234593">.</span><span class="ident" id="4234594">codegenFreq</span><span class="op" id="4234605">[</span><span class="num" id="4234606">18</span><span class="op" id="4234608">]</span><span class="op" id="4234609">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234616">count</span>&nbsp;<span class="op" id="4234622">-=</span>&nbsp;<span class="ident" id="4234625">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234635">if</span>&nbsp;<span class="ident" id="4234638">count</span>&nbsp;<span class="op" id="4234644">&gt;=</span>&nbsp;<span class="num" id="4234647">3</span>&nbsp;<span class="op" id="4234649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234655">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234688">codegen</span><span class="op" id="4234695">[</span><span class="ident" id="4234696">outIndex</span><span class="op" id="4234704">]</span>&nbsp;<span class="op" id="4234706">=</span>&nbsp;<span class="num" id="4234708">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234715">outIndex</span><span class="op" id="4234723">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234730">codegen</span><span class="op" id="4234737">[</span><span class="ident" id="4234738">outIndex</span><span class="op" id="4234746">]</span>&nbsp;<span class="op" id="4234748">=</span>&nbsp;<span class="builtintype" id="4234750">uint8</span><span class="op" id="4234755">(</span><span class="ident" id="4234756">count</span>&nbsp;<span class="op" id="4234762">-</span>&nbsp;<span class="num" id="4234764">3</span><span class="op" id="4234765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234771">outIndex</span><span class="op" id="4234779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234786">w</span><span class="op" id="4234787">.</span><span class="ident" id="4234788">codegenFreq</span><span class="op" id="4234799">[</span><span class="num" id="4234800">17</span><span class="op" id="4234802">]</span><span class="op" id="4234803">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234810">count</span>&nbsp;<span class="op" id="4234816">=</span>&nbsp;<span class="num" id="4234818">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234831">count</span><span class="op" id="4234836">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234841">for</span>&nbsp;<span class="op" id="4234845">;</span>&nbsp;<span class="ident" id="4234847">count</span>&nbsp;<span class="op" id="4234853">&gt;=</span>&nbsp;<span class="num" id="4234856">0</span><span class="op" id="4234857">;</span>&nbsp;<span class="ident" id="4234859">count</span><span class="op" id="4234864">--</span>&nbsp;<span class="op" id="4234867">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234872">codegen</span><span class="op" id="4234879">[</span><span class="ident" id="4234880">outIndex</span><span class="op" id="4234888">]</span>&nbsp;<span class="op" id="4234890">=</span>&nbsp;<span class="ident" id="4234892">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234900">outIndex</span><span class="op" id="4234908">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234914">w</span><span class="op" id="4234915">.</span><span class="ident" id="4234916">codegenFreq</span><span class="op" id="4234927">[</span><span class="ident" id="4234928">size</span><span class="op" id="4234932">]</span><span class="op" id="4234933">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234942">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234996">size</span>&nbsp;<span class="op" id="4235001">=</span>&nbsp;<span class="ident" id="4235003">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235014">count</span>&nbsp;<span class="op" id="4235020">=</span>&nbsp;<span class="num" id="4235022">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4235028">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235074">codegen</span><span class="op" id="4235081">[</span><span class="ident" id="4235082">outIndex</span><span class="op" id="4235090">]</span>&nbsp;<span class="op" id="4235092">=</span>&nbsp;<span class="ident" id="4235094">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4235102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4235105">func</span>&nbsp;<span class="op" id="4235110">(</span><span class="ident" id="4235111">w</span>&nbsp;<span class="op" id="4235113">*</span><span class="ident" id="4235114">huffmanBitWriter</span><span class="op" id="4235130">)</span>&nbsp;<span class="ident" id="4235132">writeCode</span><span class="op" id="4235141">(</span><span class="ident" id="4235142">code</span>&nbsp;<span class="op" id="4235147">*</span><span class="ident" id="4235148">huffmanEncoder</span><span class="op" id="4235162">,</span>&nbsp;<span class="ident" id="4235164">literal</span>&nbsp;<span class="builtintype" id="4235172">uint32</span><span class="op" id="4235178">)</span>&nbsp;<span class="op" id="4235180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235183">if</span>&nbsp;<span class="ident" id="4235186">w</span><span class="op" id="4235187">.</span><span class="ident" id="4235188">err</span>&nbsp;<span class="op" id="4235192">!=</span>&nbsp;<span class="builtintype" id="4235195">nil</span>&nbsp;<span class="op" id="4235199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235203">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235214">w</span><span class="op" id="4235215">.</span><span class="ident" id="4235216">writeBits</span><span class="op" id="4235225">(</span><span class="builtintype" id="4235226">int32</span><span class="op" id="4235231">(</span><span class="ident" id="4235232">code</span><span class="op" id="4235236">.</span><span class="ident" id="4235237">code</span><span class="op" id="4235241">[</span><span class="ident" id="4235242">literal</span><span class="op" id="4235249">]</span><span class="op" id="4235250">)</span><span class="op" id="4235251">,</span>&nbsp;<span class="builtintype" id="4235253">int32</span><span class="op" id="4235258">(</span><span class="ident" id="4235259">code</span><span class="op" id="4235263">.</span><span class="ident" id="4235264">codeBits</span><span class="op" id="4235272">[</span><span class="ident" id="4235273">literal</span><span class="op" id="4235280">]</span><span class="op" id="4235281">)</span><span class="op" id="4235282">)</span><br>
<span class="lineno"></span><span class="op" id="4235284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4235287">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4235356">//</span><br>
<span class="lineno"></span><span class="comment" id="4235359">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4235420">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4235480">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4235536">func</span>&nbsp;<span class="op" id="4235541">(</span><span class="ident" id="4235542">w</span>&nbsp;<span class="op" id="4235544">*</span><span class="ident" id="4235545">huffmanBitWriter</span><span class="op" id="4235561">)</span>&nbsp;<span class="ident" id="4235563">writeDynamicHeader</span><span class="op" id="4235581">(</span><span class="ident" id="4235582">numLiterals</span>&nbsp;<span class="builtintype" id="4235594">int</span><span class="op" id="4235597">,</span>&nbsp;<span class="ident" id="4235599">numOffsets</span>&nbsp;<span class="builtintype" id="4235610">int</span><span class="op" id="4235613">,</span>&nbsp;<span class="ident" id="4235615">numCodegens</span>&nbsp;<span class="builtintype" id="4235627">int</span><span class="op" id="4235630">,</span>&nbsp;<span class="ident" id="4235632">isEof</span>&nbsp;<span class="builtintype" id="4235638">bool</span><span class="op" id="4235642">)</span>&nbsp;<span class="op" id="4235644">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235647">if</span>&nbsp;<span class="ident" id="4235650">w</span><span class="op" id="4235651">.</span><span class="ident" id="4235652">err</span>&nbsp;<span class="op" id="4235656">!=</span>&nbsp;<span class="builtintype" id="4235659">nil</span>&nbsp;<span class="op" id="4235663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235667">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235678">var</span>&nbsp;<span class="ident" id="4235682">firstBits</span>&nbsp;<span class="builtintype" id="4235692">int32</span>&nbsp;<span class="op" id="4235698">=</span>&nbsp;<span class="num" id="4235700">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235703">if</span>&nbsp;<span class="ident" id="4235706">isEof</span>&nbsp;<span class="op" id="4235712">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235716">firstBits</span>&nbsp;<span class="op" id="4235726">=</span>&nbsp;<span class="num" id="4235728">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235734">w</span><span class="op" id="4235735">.</span><span class="ident" id="4235736">writeBits</span><span class="op" id="4235745">(</span><span class="ident" id="4235746">firstBits</span><span class="op" id="4235755">,</span>&nbsp;<span class="num" id="4235757">3</span><span class="op" id="4235758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235761">w</span><span class="op" id="4235762">.</span><span class="ident" id="4235763">writeBits</span><span class="op" id="4235772">(</span><span class="builtintype" id="4235773">int32</span><span class="op" id="4235778">(</span><span class="ident" id="4235779">numLiterals</span><span class="op" id="4235790">-</span><span class="num" id="4235791">257</span><span class="op" id="4235794">)</span><span class="op" id="4235795">,</span>&nbsp;<span class="num" id="4235797">5</span><span class="op" id="4235798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235801">w</span><span class="op" id="4235802">.</span><span class="ident" id="4235803">writeBits</span><span class="op" id="4235812">(</span><span class="builtintype" id="4235813">int32</span><span class="op" id="4235818">(</span><span class="ident" id="4235819">numOffsets</span><span class="op" id="4235829">-</span><span class="num" id="4235830">1</span><span class="op" id="4235831">)</span><span class="op" id="4235832">,</span>&nbsp;<span class="num" id="4235834">5</span><span class="op" id="4235835">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235838">w</span><span class="op" id="4235839">.</span><span class="ident" id="4235840">writeBits</span><span class="op" id="4235849">(</span><span class="builtintype" id="4235850">int32</span><span class="op" id="4235855">(</span><span class="ident" id="4235856">numCodegens</span><span class="op" id="4235867">-</span><span class="num" id="4235868">4</span><span class="op" id="4235869">)</span><span class="op" id="4235870">,</span>&nbsp;<span class="num" id="4235872">4</span><span class="op" id="4235873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235877">for</span>&nbsp;<span class="ident" id="4235881">i</span>&nbsp;<span class="op" id="4235883">:=</span>&nbsp;<span class="num" id="4235886">0</span><span class="op" id="4235887">;</span>&nbsp;<span class="ident" id="4235889">i</span>&nbsp;<span class="op" id="4235891">&lt;</span>&nbsp;<span class="ident" id="4235893">numCodegens</span><span class="op" id="4235904">;</span>&nbsp;<span class="ident" id="4235906">i</span><span class="op" id="4235907">++</span>&nbsp;<span class="op" id="4235910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235914">value</span>&nbsp;<span class="op" id="4235920">:=</span>&nbsp;<span class="ident" id="4235923">w</span><span class="op" id="4235924">.</span><span class="ident" id="4235925">codegenEncoding</span><span class="op" id="4235940">.</span><span class="ident" id="4235941">codeBits</span><span class="op" id="4235949">[</span><span class="ident" id="4235950">codegenOrder</span><span class="op" id="4235962">[</span><span class="ident" id="4235963">i</span><span class="op" id="4235964">]</span><span class="op" id="4235965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235969">w</span><span class="op" id="4235970">.</span><span class="ident" id="4235971">writeBits</span><span class="op" id="4235980">(</span><span class="builtintype" id="4235981">int32</span><span class="op" id="4235986">(</span><span class="ident" id="4235987">value</span><span class="op" id="4235992">)</span><span class="op" id="4235993">,</span>&nbsp;<span class="num" id="4235995">3</span><span class="op" id="4235996">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236003">i</span>&nbsp;<span class="op" id="4236005">:=</span>&nbsp;<span class="num" id="4236008">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236011">for</span>&nbsp;<span class="op" id="4236015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236019">var</span>&nbsp;<span class="ident" id="4236023">codeWord</span>&nbsp;<span class="builtintype" id="4236032">int</span>&nbsp;<span class="op" id="4236036">=</span>&nbsp;<span class="builtintype" id="4236038">int</span><span class="op" id="4236041">(</span><span class="ident" id="4236042">w</span><span class="op" id="4236043">.</span><span class="ident" id="4236044">codegen</span><span class="op" id="4236051">[</span><span class="ident" id="4236052">i</span><span class="op" id="4236053">]</span><span class="op" id="4236054">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236058">i</span><span class="op" id="4236059">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236064">if</span>&nbsp;<span class="ident" id="4236067">codeWord</span>&nbsp;<span class="op" id="4236076">==</span>&nbsp;<span class="ident" id="4236079">badCode</span>&nbsp;<span class="op" id="4236087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4236104">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236160">w</span><span class="op" id="4236161">.</span><span class="ident" id="4236162">writeCode</span><span class="op" id="4236171">(</span><span class="ident" id="4236172">w</span><span class="op" id="4236173">.</span><span class="ident" id="4236174">codegenEncoding</span><span class="op" id="4236189">,</span>&nbsp;<span class="builtintype" id="4236191">uint32</span><span class="op" id="4236197">(</span><span class="ident" id="4236198">codeWord</span><span class="op" id="4236206">)</span><span class="op" id="4236207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236212">switch</span>&nbsp;<span class="ident" id="4236219">codeWord</span>&nbsp;<span class="op" id="4236228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236232">case</span>&nbsp;<span class="num" id="4236237">16</span><span class="op" id="4236239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236244">w</span><span class="op" id="4236245">.</span><span class="ident" id="4236246">writeBits</span><span class="op" id="4236255">(</span><span class="builtintype" id="4236256">int32</span><span class="op" id="4236261">(</span><span class="ident" id="4236262">w</span><span class="op" id="4236263">.</span><span class="ident" id="4236264">codegen</span><span class="op" id="4236271">[</span><span class="ident" id="4236272">i</span><span class="op" id="4236273">]</span><span class="op" id="4236274">)</span><span class="op" id="4236275">,</span>&nbsp;<span class="num" id="4236277">2</span><span class="op" id="4236278">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236283">i</span><span class="op" id="4236284">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236290">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236298">case</span>&nbsp;<span class="num" id="4236303">17</span><span class="op" id="4236305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236310">w</span><span class="op" id="4236311">.</span><span class="ident" id="4236312">writeBits</span><span class="op" id="4236321">(</span><span class="builtintype" id="4236322">int32</span><span class="op" id="4236327">(</span><span class="ident" id="4236328">w</span><span class="op" id="4236329">.</span><span class="ident" id="4236330">codegen</span><span class="op" id="4236337">[</span><span class="ident" id="4236338">i</span><span class="op" id="4236339">]</span><span class="op" id="4236340">)</span><span class="op" id="4236341">,</span>&nbsp;<span class="num" id="4236343">3</span><span class="op" id="4236344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236349">i</span><span class="op" id="4236350">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236356">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236364">case</span>&nbsp;<span class="num" id="4236369">18</span><span class="op" id="4236371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236376">w</span><span class="op" id="4236377">.</span><span class="ident" id="4236378">writeBits</span><span class="op" id="4236387">(</span><span class="builtintype" id="4236388">int32</span><span class="op" id="4236393">(</span><span class="ident" id="4236394">w</span><span class="op" id="4236395">.</span><span class="ident" id="4236396">codegen</span><span class="op" id="4236403">[</span><span class="ident" id="4236404">i</span><span class="op" id="4236405">]</span><span class="op" id="4236406">)</span><span class="op" id="4236407">,</span>&nbsp;<span class="num" id="4236409">7</span><span class="op" id="4236410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236415">i</span><span class="op" id="4236416">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236422">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236433">}</span><br>
<span class="lineno"></span><span class="op" id="4236435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4236438">func</span>&nbsp;<span class="op" id="4236443">(</span><span class="ident" id="4236444">w</span>&nbsp;<span class="op" id="4236446">*</span><span class="ident" id="4236447">huffmanBitWriter</span><span class="op" id="4236463">)</span>&nbsp;<span class="ident" id="4236465">writeStoredHeader</span><span class="op" id="4236482">(</span><span class="ident" id="4236483">length</span>&nbsp;<span class="builtintype" id="4236490">int</span><span class="op" id="4236493">,</span>&nbsp;<span class="ident" id="4236495">isEof</span>&nbsp;<span class="builtintype" id="4236501">bool</span><span class="op" id="4236505">)</span>&nbsp;<span class="op" id="4236507">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236510">if</span>&nbsp;<span class="ident" id="4236513">w</span><span class="op" id="4236514">.</span><span class="ident" id="4236515">err</span>&nbsp;<span class="op" id="4236519">!=</span>&nbsp;<span class="builtintype" id="4236522">nil</span>&nbsp;<span class="op" id="4236526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236530">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236541">var</span>&nbsp;<span class="ident" id="4236545">flag</span>&nbsp;<span class="builtintype" id="4236550">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236557">if</span>&nbsp;<span class="ident" id="4236560">isEof</span>&nbsp;<span class="op" id="4236566">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236570">flag</span>&nbsp;<span class="op" id="4236575">=</span>&nbsp;<span class="num" id="4236577">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236583">w</span><span class="op" id="4236584">.</span><span class="ident" id="4236585">writeBits</span><span class="op" id="4236594">(</span><span class="ident" id="4236595">flag</span><span class="op" id="4236599">,</span>&nbsp;<span class="num" id="4236601">3</span><span class="op" id="4236602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236605">w</span><span class="op" id="4236606">.</span><span class="ident" id="4236607">flush</span><span class="op" id="4236612">(</span><span class="op" id="4236613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236616">w</span><span class="op" id="4236617">.</span><span class="ident" id="4236618">writeBits</span><span class="op" id="4236627">(</span><span class="builtintype" id="4236628">int32</span><span class="op" id="4236633">(</span><span class="ident" id="4236634">length</span><span class="op" id="4236640">)</span><span class="op" id="4236641">,</span>&nbsp;<span class="num" id="4236643">16</span><span class="op" id="4236645">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236648">w</span><span class="op" id="4236649">.</span><span class="ident" id="4236650">writeBits</span><span class="op" id="4236659">(</span><span class="builtintype" id="4236660">int32</span><span class="op" id="4236665">(</span><span class="op" id="4236666">^</span><span class="builtintype" id="4236667">uint16</span><span class="op" id="4236673">(</span><span class="ident" id="4236674">length</span><span class="op" id="4236680">)</span><span class="op" id="4236681">)</span><span class="op" id="4236682">,</span>&nbsp;<span class="num" id="4236684">16</span><span class="op" id="4236686">)</span><br>
<span class="lineno"></span><span class="op" id="4236688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4236691">func</span>&nbsp;<span class="op" id="4236696">(</span><span class="ident" id="4236697">w</span>&nbsp;<span class="op" id="4236699">*</span><span class="ident" id="4236700">huffmanBitWriter</span><span class="op" id="4236716">)</span>&nbsp;<span class="ident" id="4236718">writeFixedHeader</span><span class="op" id="4236734">(</span><span class="ident" id="4236735">isEof</span>&nbsp;<span class="builtintype" id="4236741">bool</span><span class="op" id="4236745">)</span>&nbsp;<span class="op" id="4236747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236750">if</span>&nbsp;<span class="ident" id="4236753">w</span><span class="op" id="4236754">.</span><span class="ident" id="4236755">err</span>&nbsp;<span class="op" id="4236759">!=</span>&nbsp;<span class="builtintype" id="4236762">nil</span>&nbsp;<span class="op" id="4236766">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236770">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4236781">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236828">var</span>&nbsp;<span class="ident" id="4236832">value</span>&nbsp;<span class="builtintype" id="4236838">int32</span>&nbsp;<span class="op" id="4236844">=</span>&nbsp;<span class="num" id="4236846">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236849">if</span>&nbsp;<span class="ident" id="4236852">isEof</span>&nbsp;<span class="op" id="4236858">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236862">value</span>&nbsp;<span class="op" id="4236868">=</span>&nbsp;<span class="num" id="4236870">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236876">w</span><span class="op" id="4236877">.</span><span class="ident" id="4236878">writeBits</span><span class="op" id="4236887">(</span><span class="ident" id="4236888">value</span><span class="op" id="4236893">,</span>&nbsp;<span class="num" id="4236895">3</span><span class="op" id="4236896">)</span><br>
<span class="lineno"></span><span class="op" id="4236898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4236901">func</span>&nbsp;<span class="op" id="4236906">(</span><span class="ident" id="4236907">w</span>&nbsp;<span class="op" id="4236909">*</span><span class="ident" id="4236910">huffmanBitWriter</span><span class="op" id="4236926">)</span>&nbsp;<span class="ident" id="4236928">writeBlock</span><span class="op" id="4236938">(</span><span class="ident" id="4236939">tokens</span>&nbsp;<span class="op" id="4236946">[</span><span class="op" id="4236947">]</span><span class="ident" id="4236948">token</span><span class="op" id="4236953">,</span>&nbsp;<span class="ident" id="4236955">eof</span>&nbsp;<span class="builtintype" id="4236959">bool</span><span class="op" id="4236963">,</span>&nbsp;<span class="ident" id="4236965">input</span>&nbsp;<span class="op" id="4236971">[</span><span class="op" id="4236972">]</span><span class="builtintype" id="4236973">byte</span><span class="op" id="4236977">)</span>&nbsp;<span class="op" id="4236979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236982">if</span>&nbsp;<span class="ident" id="4236985">w</span><span class="op" id="4236986">.</span><span class="ident" id="4236987">err</span>&nbsp;<span class="op" id="4236991">!=</span>&nbsp;<span class="builtintype" id="4236994">nil</span>&nbsp;<span class="op" id="4236998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237013">for</span>&nbsp;<span class="ident" id="4237017">i</span>&nbsp;<span class="op" id="4237019">:=</span>&nbsp;<span class="keyword" id="4237022">range</span>&nbsp;<span class="ident" id="4237028">w</span><span class="op" id="4237029">.</span><span class="ident" id="4237030">literalFreq</span>&nbsp;<span class="op" id="4237042">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237046">w</span><span class="op" id="4237047">.</span><span class="ident" id="4237048">literalFreq</span><span class="op" id="4237059">[</span><span class="ident" id="4237060">i</span><span class="op" id="4237061">]</span>&nbsp;<span class="op" id="4237063">=</span>&nbsp;<span class="num" id="4237065">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237071">for</span>&nbsp;<span class="ident" id="4237075">i</span>&nbsp;<span class="op" id="4237077">:=</span>&nbsp;<span class="keyword" id="4237080">range</span>&nbsp;<span class="ident" id="4237086">w</span><span class="op" id="4237087">.</span><span class="ident" id="4237088">offsetFreq</span>&nbsp;<span class="op" id="4237099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237103">w</span><span class="op" id="4237104">.</span><span class="ident" id="4237105">offsetFreq</span><span class="op" id="4237115">[</span><span class="ident" id="4237116">i</span><span class="op" id="4237117">]</span>&nbsp;<span class="op" id="4237119">=</span>&nbsp;<span class="num" id="4237121">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237124">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237128">n</span>&nbsp;<span class="op" id="4237130">:=</span>&nbsp;<span class="builtinfunc" id="4237133">len</span><span class="op" id="4237136">(</span><span class="ident" id="4237137">tokens</span><span class="op" id="4237143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237146">tokens</span>&nbsp;<span class="op" id="4237153">=</span>&nbsp;<span class="ident" id="4237155">tokens</span><span class="op" id="4237161">[</span><span class="num" id="4237162">0</span>&nbsp;<span class="op" id="4237164">:</span>&nbsp;<span class="ident" id="4237166">n</span><span class="op" id="4237167">+</span><span class="num" id="4237168">1</span><span class="op" id="4237169">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237172">tokens</span><span class="op" id="4237178">[</span><span class="ident" id="4237179">n</span><span class="op" id="4237180">]</span>&nbsp;<span class="op" id="4237182">=</span>&nbsp;<span class="ident" id="4237184">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237201">for</span>&nbsp;<span class="ident" id="4237205">_</span><span class="op" id="4237206">,</span>&nbsp;<span class="ident" id="4237208">t</span>&nbsp;<span class="op" id="4237210">:=</span>&nbsp;<span class="keyword" id="4237213">range</span>&nbsp;<span class="ident" id="4237219">tokens</span>&nbsp;<span class="op" id="4237226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237230">switch</span>&nbsp;<span class="ident" id="4237237">t</span><span class="op" id="4237238">.</span><span class="ident" id="4237239">typ</span><span class="op" id="4237242">(</span><span class="op" id="4237243">)</span>&nbsp;<span class="op" id="4237245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237249">case</span>&nbsp;<span class="ident" id="4237254">literalType</span><span class="op" id="4237265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237270">w</span><span class="op" id="4237271">.</span><span class="ident" id="4237272">literalFreq</span><span class="op" id="4237283">[</span><span class="ident" id="4237284">t</span><span class="op" id="4237285">.</span><span class="ident" id="4237286">literal</span><span class="op" id="4237293">(</span><span class="op" id="4237294">)</span><span class="op" id="4237295">]</span><span class="op" id="4237296">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237301">case</span>&nbsp;<span class="ident" id="4237306">matchType</span><span class="op" id="4237315">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237320">length</span>&nbsp;<span class="op" id="4237327">:=</span>&nbsp;<span class="ident" id="4237330">t</span><span class="op" id="4237331">.</span><span class="ident" id="4237332">length</span><span class="op" id="4237338">(</span><span class="op" id="4237339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237344">offset</span>&nbsp;<span class="op" id="4237351">:=</span>&nbsp;<span class="ident" id="4237354">t</span><span class="op" id="4237355">.</span><span class="ident" id="4237356">offset</span><span class="op" id="4237362">(</span><span class="op" id="4237363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237368">w</span><span class="op" id="4237369">.</span><span class="ident" id="4237370">literalFreq</span><span class="op" id="4237381">[</span><span class="ident" id="4237382">lengthCodesStart</span><span class="op" id="4237398">+</span><span class="ident" id="4237399">lengthCode</span><span class="op" id="4237409">(</span><span class="ident" id="4237410">length</span><span class="op" id="4237416">)</span><span class="op" id="4237417">]</span><span class="op" id="4237418">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237424">w</span><span class="op" id="4237425">.</span><span class="ident" id="4237426">offsetFreq</span><span class="op" id="4237436">[</span><span class="ident" id="4237437">offsetCode</span><span class="op" id="4237447">(</span><span class="ident" id="4237448">offset</span><span class="op" id="4237454">)</span><span class="op" id="4237455">]</span><span class="op" id="4237456">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237461">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237468">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237499">numLiterals</span>&nbsp;<span class="op" id="4237511">:=</span>&nbsp;<span class="builtinfunc" id="4237514">len</span><span class="op" id="4237517">(</span><span class="ident" id="4237518">w</span><span class="op" id="4237519">.</span><span class="ident" id="4237520">literalFreq</span><span class="op" id="4237531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237534">for</span>&nbsp;<span class="ident" id="4237538">w</span><span class="op" id="4237539">.</span><span class="ident" id="4237540">literalFreq</span><span class="op" id="4237551">[</span><span class="ident" id="4237552">numLiterals</span><span class="op" id="4237563">-</span><span class="num" id="4237564">1</span><span class="op" id="4237565">]</span>&nbsp;<span class="op" id="4237567">==</span>&nbsp;<span class="num" id="4237570">0</span>&nbsp;<span class="op" id="4237572">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237576">numLiterals</span><span class="op" id="4237587">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237594">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237624">numOffsets</span>&nbsp;<span class="op" id="4237635">:=</span>&nbsp;<span class="builtinfunc" id="4237638">len</span><span class="op" id="4237641">(</span><span class="ident" id="4237642">w</span><span class="op" id="4237643">.</span><span class="ident" id="4237644">offsetFreq</span><span class="op" id="4237654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237657">for</span>&nbsp;<span class="ident" id="4237661">numOffsets</span>&nbsp;<span class="op" id="4237672">&gt;</span>&nbsp;<span class="num" id="4237674">0</span>&nbsp;<span class="op" id="4237676">&amp;&amp;</span>&nbsp;<span class="ident" id="4237679">w</span><span class="op" id="4237680">.</span><span class="ident" id="4237681">offsetFreq</span><span class="op" id="4237691">[</span><span class="ident" id="4237692">numOffsets</span><span class="op" id="4237702">-</span><span class="num" id="4237703">1</span><span class="op" id="4237704">]</span>&nbsp;<span class="op" id="4237706">==</span>&nbsp;<span class="num" id="4237709">0</span>&nbsp;<span class="op" id="4237711">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237715">numOffsets</span><span class="op" id="4237725">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237732">if</span>&nbsp;<span class="ident" id="4237735">numOffsets</span>&nbsp;<span class="op" id="4237746">==</span>&nbsp;<span class="num" id="4237749">0</span>&nbsp;<span class="op" id="4237751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237755">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237837">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237936">w</span><span class="op" id="4237937">.</span><span class="ident" id="4237938">offsetFreq</span><span class="op" id="4237948">[</span><span class="num" id="4237949">0</span><span class="op" id="4237950">]</span>&nbsp;<span class="op" id="4237952">=</span>&nbsp;<span class="num" id="4237954">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237958">numOffsets</span>&nbsp;<span class="op" id="4237969">=</span>&nbsp;<span class="num" id="4237971">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237978">w</span><span class="op" id="4237979">.</span><span class="ident" id="4237980">literalEncoding</span><span class="op" id="4237995">.</span><span class="ident" id="4237996">generate</span><span class="op" id="4238004">(</span><span class="ident" id="4238005">w</span><span class="op" id="4238006">.</span><span class="ident" id="4238007">literalFreq</span><span class="op" id="4238018">,</span>&nbsp;<span class="num" id="4238020">15</span><span class="op" id="4238022">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238025">w</span><span class="op" id="4238026">.</span><span class="ident" id="4238027">offsetEncoding</span><span class="op" id="4238041">.</span><span class="ident" id="4238042">generate</span><span class="op" id="4238050">(</span><span class="ident" id="4238051">w</span><span class="op" id="4238052">.</span><span class="ident" id="4238053">offsetFreq</span><span class="op" id="4238063">,</span>&nbsp;<span class="num" id="4238065">15</span><span class="op" id="4238067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238071">storedBytes</span>&nbsp;<span class="op" id="4238083">:=</span>&nbsp;<span class="num" id="4238086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238089">if</span>&nbsp;<span class="ident" id="4238092">input</span>&nbsp;<span class="op" id="4238098">!=</span>&nbsp;<span class="builtintype" id="4238101">nil</span>&nbsp;<span class="op" id="4238105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238109">storedBytes</span>&nbsp;<span class="op" id="4238121">=</span>&nbsp;<span class="builtinfunc" id="4238123">len</span><span class="op" id="4238126">(</span><span class="ident" id="4238127">input</span><span class="op" id="4238132">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238138">var</span>&nbsp;<span class="ident" id="4238142">extraBits</span>&nbsp;<span class="ident" id="4238152">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238159">var</span>&nbsp;<span class="ident" id="4238163">storedSize</span>&nbsp;<span class="ident" id="4238174">int64</span>&nbsp;<span class="op" id="4238180">=</span>&nbsp;<span class="ident" id="4238182">math</span><span class="op" id="4238186">.</span><span class="ident" id="4238187">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238197">if</span>&nbsp;<span class="ident" id="4238200">storedBytes</span>&nbsp;<span class="op" id="4238212">&lt;=</span>&nbsp;<span class="ident" id="4238215">maxStoreBlockSize</span>&nbsp;<span class="op" id="4238233">&amp;&amp;</span>&nbsp;<span class="ident" id="4238236">input</span>&nbsp;<span class="op" id="4238242">!=</span>&nbsp;<span class="builtintype" id="4238245">nil</span>&nbsp;<span class="op" id="4238249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238253">storedSize</span>&nbsp;<span class="op" id="4238264">=</span>&nbsp;<span class="ident" id="4238266">int64</span><span class="op" id="4238271">(</span><span class="op" id="4238272">(</span><span class="ident" id="4238273">storedBytes</span>&nbsp;<span class="op" id="4238285">+</span>&nbsp;<span class="num" id="4238287">5</span><span class="op" id="4238288">)</span>&nbsp;<span class="op" id="4238290">*</span>&nbsp;<span class="num" id="4238292">8</span><span class="op" id="4238293">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238297">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238369">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238441">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238511">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238541">for</span>&nbsp;<span class="ident" id="4238545">lengthCode</span>&nbsp;<span class="op" id="4238556">:=</span>&nbsp;<span class="ident" id="4238559">lengthCodesStart</span>&nbsp;<span class="op" id="4238576">+</span>&nbsp;<span class="num" id="4238578">8</span><span class="op" id="4238579">;</span>&nbsp;<span class="ident" id="4238581">lengthCode</span>&nbsp;<span class="op" id="4238592">&lt;</span>&nbsp;<span class="ident" id="4238594">numLiterals</span><span class="op" id="4238605">;</span>&nbsp;<span class="ident" id="4238607">lengthCode</span><span class="op" id="4238617">++</span>&nbsp;<span class="op" id="4238620">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238625">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238677">extraBits</span>&nbsp;<span class="op" id="4238687">+=</span>&nbsp;<span class="ident" id="4238690">int64</span><span class="op" id="4238695">(</span><span class="ident" id="4238696">w</span><span class="op" id="4238697">.</span><span class="ident" id="4238698">literalFreq</span><span class="op" id="4238709">[</span><span class="ident" id="4238710">lengthCode</span><span class="op" id="4238720">]</span><span class="op" id="4238721">)</span>&nbsp;<span class="op" id="4238723">*</span>&nbsp;<span class="ident" id="4238725">int64</span><span class="op" id="4238730">(</span><span class="ident" id="4238731">lengthExtraBits</span><span class="op" id="4238746">[</span><span class="ident" id="4238747">lengthCode</span><span class="op" id="4238757">-</span><span class="ident" id="4238758">lengthCodesStart</span><span class="op" id="4238774">]</span><span class="op" id="4238775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238783">for</span>&nbsp;<span class="ident" id="4238787">offsetCode</span>&nbsp;<span class="op" id="4238798">:=</span>&nbsp;<span class="num" id="4238801">4</span><span class="op" id="4238802">;</span>&nbsp;<span class="ident" id="4238804">offsetCode</span>&nbsp;<span class="op" id="4238815">&lt;</span>&nbsp;<span class="ident" id="4238817">numOffsets</span><span class="op" id="4238827">;</span>&nbsp;<span class="ident" id="4238829">offsetCode</span><span class="op" id="4238839">++</span>&nbsp;<span class="op" id="4238842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238847">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238898">extraBits</span>&nbsp;<span class="op" id="4238908">+=</span>&nbsp;<span class="ident" id="4238911">int64</span><span class="op" id="4238916">(</span><span class="ident" id="4238917">w</span><span class="op" id="4238918">.</span><span class="ident" id="4238919">offsetFreq</span><span class="op" id="4238929">[</span><span class="ident" id="4238930">offsetCode</span><span class="op" id="4238940">]</span><span class="op" id="4238941">)</span>&nbsp;<span class="op" id="4238943">*</span>&nbsp;<span class="ident" id="4238945">int64</span><span class="op" id="4238950">(</span><span class="ident" id="4238951">offsetExtraBits</span><span class="op" id="4238966">[</span><span class="ident" id="4238967">offsetCode</span><span class="op" id="4238977">]</span><span class="op" id="4238978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238989">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4239019">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239047">var</span>&nbsp;<span class="ident" id="4239051">size</span>&nbsp;<span class="op" id="4239056">=</span>&nbsp;<span class="ident" id="4239058">int64</span><span class="op" id="4239063">(</span><span class="num" id="4239064">3</span><span class="op" id="4239065">)</span>&nbsp;<span class="op" id="4239067">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239071">fixedLiteralEncoding</span><span class="op" id="4239091">.</span><span class="ident" id="4239092">bitLength</span><span class="op" id="4239101">(</span><span class="ident" id="4239102">w</span><span class="op" id="4239103">.</span><span class="ident" id="4239104">literalFreq</span><span class="op" id="4239115">)</span>&nbsp;<span class="op" id="4239117">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239121">fixedOffsetEncoding</span><span class="op" id="4239140">.</span><span class="ident" id="4239141">bitLength</span><span class="op" id="4239150">(</span><span class="ident" id="4239151">w</span><span class="op" id="4239152">.</span><span class="ident" id="4239153">offsetFreq</span><span class="op" id="4239163">)</span>&nbsp;<span class="op" id="4239165">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239169">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239180">var</span>&nbsp;<span class="ident" id="4239184">literalEncoding</span>&nbsp;<span class="op" id="4239200">=</span>&nbsp;<span class="ident" id="4239202">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239224">var</span>&nbsp;<span class="ident" id="4239228">offsetEncoding</span>&nbsp;<span class="op" id="4239243">=</span>&nbsp;<span class="ident" id="4239245">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4239267">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239288">var</span>&nbsp;<span class="ident" id="4239292">numCodegens</span>&nbsp;<span class="builtintype" id="4239304">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4239310">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4239385">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239433">w</span><span class="op" id="4239434">.</span><span class="ident" id="4239435">generateCodegen</span><span class="op" id="4239450">(</span><span class="ident" id="4239451">numLiterals</span><span class="op" id="4239462">,</span>&nbsp;<span class="ident" id="4239464">numOffsets</span><span class="op" id="4239474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239477">w</span><span class="op" id="4239478">.</span><span class="ident" id="4239479">codegenEncoding</span><span class="op" id="4239494">.</span><span class="ident" id="4239495">generate</span><span class="op" id="4239503">(</span><span class="ident" id="4239504">w</span><span class="op" id="4239505">.</span><span class="ident" id="4239506">codegenFreq</span><span class="op" id="4239517">,</span>&nbsp;<span class="num" id="4239519">7</span><span class="op" id="4239520">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239523">numCodegens</span>&nbsp;<span class="op" id="4239535">=</span>&nbsp;<span class="builtinfunc" id="4239537">len</span><span class="op" id="4239540">(</span><span class="ident" id="4239541">w</span><span class="op" id="4239542">.</span><span class="ident" id="4239543">codegenFreq</span><span class="op" id="4239554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239557">for</span>&nbsp;<span class="ident" id="4239561">numCodegens</span>&nbsp;<span class="op" id="4239573">&gt;</span>&nbsp;<span class="num" id="4239575">4</span>&nbsp;<span class="op" id="4239577">&amp;&amp;</span>&nbsp;<span class="ident" id="4239580">w</span><span class="op" id="4239581">.</span><span class="ident" id="4239582">codegenFreq</span><span class="op" id="4239593">[</span><span class="ident" id="4239594">codegenOrder</span><span class="op" id="4239606">[</span><span class="ident" id="4239607">numCodegens</span><span class="op" id="4239618">-</span><span class="num" id="4239619">1</span><span class="op" id="4239620">]</span><span class="op" id="4239621">]</span>&nbsp;<span class="op" id="4239623">==</span>&nbsp;<span class="num" id="4239626">0</span>&nbsp;<span class="op" id="4239628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239632">numCodegens</span><span class="op" id="4239643">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4239647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239650">dynamicHeader</span>&nbsp;<span class="op" id="4239664">:=</span>&nbsp;<span class="ident" id="4239667">int64</span><span class="op" id="4239672">(</span><span class="num" id="4239673">3</span><span class="op" id="4239674">+</span><span class="num" id="4239675">5</span><span class="op" id="4239676">+</span><span class="num" id="4239677">5</span><span class="op" id="4239678">+</span><span class="num" id="4239679">4</span><span class="op" id="4239680">+</span><span class="op" id="4239681">(</span><span class="num" id="4239682">3</span><span class="op" id="4239683">*</span><span class="ident" id="4239684">numCodegens</span><span class="op" id="4239695">)</span><span class="op" id="4239696">)</span>&nbsp;<span class="op" id="4239698">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239702">w</span><span class="op" id="4239703">.</span><span class="ident" id="4239704">codegenEncoding</span><span class="op" id="4239719">.</span><span class="ident" id="4239720">bitLength</span><span class="op" id="4239729">(</span><span class="ident" id="4239730">w</span><span class="op" id="4239731">.</span><span class="ident" id="4239732">codegenFreq</span><span class="op" id="4239743">)</span>&nbsp;<span class="op" id="4239745">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239749">int64</span><span class="op" id="4239754">(</span><span class="ident" id="4239755">extraBits</span><span class="op" id="4239764">)</span>&nbsp;<span class="op" id="4239766">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239770">int64</span><span class="op" id="4239775">(</span><span class="ident" id="4239776">w</span><span class="op" id="4239777">.</span><span class="ident" id="4239778">codegenFreq</span><span class="op" id="4239789">[</span><span class="num" id="4239790">16</span><span class="op" id="4239792">]</span><span class="op" id="4239793">*</span><span class="num" id="4239794">2</span><span class="op" id="4239795">)</span>&nbsp;<span class="op" id="4239797">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239801">int64</span><span class="op" id="4239806">(</span><span class="ident" id="4239807">w</span><span class="op" id="4239808">.</span><span class="ident" id="4239809">codegenFreq</span><span class="op" id="4239820">[</span><span class="num" id="4239821">17</span><span class="op" id="4239823">]</span><span class="op" id="4239824">*</span><span class="num" id="4239825">3</span><span class="op" id="4239826">)</span>&nbsp;<span class="op" id="4239828">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239832">int64</span><span class="op" id="4239837">(</span><span class="ident" id="4239838">w</span><span class="op" id="4239839">.</span><span class="ident" id="4239840">codegenFreq</span><span class="op" id="4239851">[</span><span class="num" id="4239852">18</span><span class="op" id="4239854">]</span><span class="op" id="4239855">*</span><span class="num" id="4239856">7</span><span class="op" id="4239857">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239860">dynamicSize</span>&nbsp;<span class="op" id="4239872">:=</span>&nbsp;<span class="ident" id="4239875">dynamicHeader</span>&nbsp;<span class="op" id="4239889">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239893">w</span><span class="op" id="4239894">.</span><span class="ident" id="4239895">literalEncoding</span><span class="op" id="4239910">.</span><span class="ident" id="4239911">bitLength</span><span class="op" id="4239920">(</span><span class="ident" id="4239921">w</span><span class="op" id="4239922">.</span><span class="ident" id="4239923">literalFreq</span><span class="op" id="4239934">)</span>&nbsp;<span class="op" id="4239936">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239940">w</span><span class="op" id="4239941">.</span><span class="ident" id="4239942">offsetEncoding</span><span class="op" id="4239956">.</span><span class="ident" id="4239957">bitLength</span><span class="op" id="4239966">(</span><span class="ident" id="4239967">w</span><span class="op" id="4239968">.</span><span class="ident" id="4239969">offsetFreq</span><span class="op" id="4239979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4239983">if</span>&nbsp;<span class="ident" id="4239986">dynamicSize</span>&nbsp;<span class="op" id="4239998">&lt;</span>&nbsp;<span class="ident" id="4240000">size</span>&nbsp;<span class="op" id="4240005">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240009">size</span>&nbsp;<span class="op" id="4240014">=</span>&nbsp;<span class="ident" id="4240016">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240030">literalEncoding</span>&nbsp;<span class="op" id="4240046">=</span>&nbsp;<span class="ident" id="4240048">w</span><span class="op" id="4240049">.</span><span class="ident" id="4240050">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240068">offsetEncoding</span>&nbsp;<span class="op" id="4240083">=</span>&nbsp;<span class="ident" id="4240085">w</span><span class="op" id="4240086">.</span><span class="ident" id="4240087">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4240103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4240107">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240125">if</span>&nbsp;<span class="ident" id="4240128">storedSize</span>&nbsp;<span class="op" id="4240139">&lt;</span>&nbsp;<span class="ident" id="4240141">size</span>&nbsp;<span class="op" id="4240146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240150">w</span><span class="op" id="4240151">.</span><span class="ident" id="4240152">writeStoredHeader</span><span class="op" id="4240169">(</span><span class="ident" id="4240170">storedBytes</span><span class="op" id="4240181">,</span>&nbsp;<span class="ident" id="4240183">eof</span><span class="op" id="4240186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240190">w</span><span class="op" id="4240191">.</span><span class="ident" id="4240192">writeBytes</span><span class="op" id="4240202">(</span><span class="ident" id="4240203">input</span><span class="op" id="4240208">[</span><span class="num" id="4240209">0</span><span class="op" id="4240210">:</span><span class="ident" id="4240211">storedBytes</span><span class="op" id="4240222">]</span><span class="op" id="4240223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240227">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4240235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4240239">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240252">if</span>&nbsp;<span class="ident" id="4240255">literalEncoding</span>&nbsp;<span class="op" id="4240271">==</span>&nbsp;<span class="ident" id="4240274">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4240295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240299">w</span><span class="op" id="4240300">.</span><span class="ident" id="4240301">writeFixedHeader</span><span class="op" id="4240317">(</span><span class="ident" id="4240318">eof</span><span class="op" id="4240321">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4240324">}</span>&nbsp;<span class="keyword" id="4240326">else</span>&nbsp;<span class="op" id="4240331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240335">w</span><span class="op" id="4240336">.</span><span class="ident" id="4240337">writeDynamicHeader</span><span class="op" id="4240355">(</span><span class="ident" id="4240356">numLiterals</span><span class="op" id="4240367">,</span>&nbsp;<span class="ident" id="4240369">numOffsets</span><span class="op" id="4240379">,</span>&nbsp;<span class="ident" id="4240381">numCodegens</span><span class="op" id="4240392">,</span>&nbsp;<span class="ident" id="4240394">eof</span><span class="op" id="4240397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4240400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240403">for</span>&nbsp;<span class="ident" id="4240407">_</span><span class="op" id="4240408">,</span>&nbsp;<span class="ident" id="4240410">t</span>&nbsp;<span class="op" id="4240412">:=</span>&nbsp;<span class="keyword" id="4240415">range</span>&nbsp;<span class="ident" id="4240421">tokens</span>&nbsp;<span class="op" id="4240428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240432">switch</span>&nbsp;<span class="ident" id="4240439">t</span><span class="op" id="4240440">.</span><span class="ident" id="4240441">typ</span><span class="op" id="4240444">(</span><span class="op" id="4240445">)</span>&nbsp;<span class="op" id="4240447">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240451">case</span>&nbsp;<span class="ident" id="4240456">literalType</span><span class="op" id="4240467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240472">w</span><span class="op" id="4240473">.</span><span class="ident" id="4240474">writeCode</span><span class="op" id="4240483">(</span><span class="ident" id="4240484">literalEncoding</span><span class="op" id="4240499">,</span>&nbsp;<span class="ident" id="4240501">t</span><span class="op" id="4240502">.</span><span class="ident" id="4240503">literal</span><span class="op" id="4240510">(</span><span class="op" id="4240511">)</span><span class="op" id="4240512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240517">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240525">case</span>&nbsp;<span class="ident" id="4240530">matchType</span><span class="op" id="4240539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4240544">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240567">length</span>&nbsp;<span class="op" id="4240574">:=</span>&nbsp;<span class="ident" id="4240577">t</span><span class="op" id="4240578">.</span><span class="ident" id="4240579">length</span><span class="op" id="4240585">(</span><span class="op" id="4240586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240591">lengthCode</span>&nbsp;<span class="op" id="4240602">:=</span>&nbsp;<span class="ident" id="4240605">lengthCode</span><span class="op" id="4240615">(</span><span class="ident" id="4240616">length</span><span class="op" id="4240622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240627">w</span><span class="op" id="4240628">.</span><span class="ident" id="4240629">writeCode</span><span class="op" id="4240638">(</span><span class="ident" id="4240639">literalEncoding</span><span class="op" id="4240654">,</span>&nbsp;<span class="ident" id="4240656">lengthCode</span><span class="op" id="4240666">+</span><span class="ident" id="4240667">lengthCodesStart</span><span class="op" id="4240683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240688">extraLengthBits</span>&nbsp;<span class="op" id="4240704">:=</span>&nbsp;<span class="builtintype" id="4240707">int32</span><span class="op" id="4240712">(</span><span class="ident" id="4240713">lengthExtraBits</span><span class="op" id="4240728">[</span><span class="ident" id="4240729">lengthCode</span><span class="op" id="4240739">]</span><span class="op" id="4240740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4240745">if</span>&nbsp;<span class="ident" id="4240748">extraLengthBits</span>&nbsp;<span class="op" id="4240764">&gt;</span>&nbsp;<span class="num" id="4240766">0</span>&nbsp;<span class="op" id="4240768">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240774">extraLength</span>&nbsp;<span class="op" id="4240786">:=</span>&nbsp;<span class="builtintype" id="4240789">int32</span><span class="op" id="4240794">(</span><span class="ident" id="4240795">length</span>&nbsp;<span class="op" id="4240802">-</span>&nbsp;<span class="ident" id="4240804">lengthBase</span><span class="op" id="4240814">[</span><span class="ident" id="4240815">lengthCode</span><span class="op" id="4240825">]</span><span class="op" id="4240826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240832">w</span><span class="op" id="4240833">.</span><span class="ident" id="4240834">writeBits</span><span class="op" id="4240843">(</span><span class="ident" id="4240844">extraLength</span><span class="op" id="4240855">,</span>&nbsp;<span class="ident" id="4240857">extraLengthBits</span><span class="op" id="4240872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4240877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4240882">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240905">offset</span>&nbsp;<span class="op" id="4240912">:=</span>&nbsp;<span class="ident" id="4240915">t</span><span class="op" id="4240916">.</span><span class="ident" id="4240917">offset</span><span class="op" id="4240923">(</span><span class="op" id="4240924">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240929">offsetCode</span>&nbsp;<span class="op" id="4240940">:=</span>&nbsp;<span class="ident" id="4240943">offsetCode</span><span class="op" id="4240953">(</span><span class="ident" id="4240954">offset</span><span class="op" id="4240960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240965">w</span><span class="op" id="4240966">.</span><span class="ident" id="4240967">writeCode</span><span class="op" id="4240976">(</span><span class="ident" id="4240977">offsetEncoding</span><span class="op" id="4240991">,</span>&nbsp;<span class="ident" id="4240993">offsetCode</span><span class="op" id="4241003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241008">extraOffsetBits</span>&nbsp;<span class="op" id="4241024">:=</span>&nbsp;<span class="builtintype" id="4241027">int32</span><span class="op" id="4241032">(</span><span class="ident" id="4241033">offsetExtraBits</span><span class="op" id="4241048">[</span><span class="ident" id="4241049">offsetCode</span><span class="op" id="4241059">]</span><span class="op" id="4241060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241065">if</span>&nbsp;<span class="ident" id="4241068">extraOffsetBits</span>&nbsp;<span class="op" id="4241084">&gt;</span>&nbsp;<span class="num" id="4241086">0</span>&nbsp;<span class="op" id="4241088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241094">extraOffset</span>&nbsp;<span class="op" id="4241106">:=</span>&nbsp;<span class="builtintype" id="4241109">int32</span><span class="op" id="4241114">(</span><span class="ident" id="4241115">offset</span>&nbsp;<span class="op" id="4241122">-</span>&nbsp;<span class="ident" id="4241124">offsetBase</span><span class="op" id="4241134">[</span><span class="ident" id="4241135">offsetCode</span><span class="op" id="4241145">]</span><span class="op" id="4241146">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241152">w</span><span class="op" id="4241153">.</span><span class="ident" id="4241154">writeBits</span><span class="op" id="4241163">(</span><span class="ident" id="4241164">extraOffset</span><span class="op" id="4241175">,</span>&nbsp;<span class="ident" id="4241177">extraOffsetBits</span><span class="op" id="4241192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4241197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241202">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241210">default</span><span class="op" id="4241217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4241222">panic</span><span class="op" id="4241227">(</span><span class="string" id="4241228">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4241251">+</span>&nbsp;<span class="builtintype" id="4241253">string</span><span class="op" id="4241259">(</span><span class="ident" id="4241260">t</span><span class="op" id="4241261">)</span><span class="op" id="4241262">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4241266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4241269">}</span><br>
<span class="lineno"></span><span class="op" id="4241271">}</span>
</div>
</body>
</html>
