<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2489291">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2489346">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2489400">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2489451">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489521">package</span>&nbsp;<span class="ident" id="2489529">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489535">import</span>&nbsp;<span class="op" id="2489542">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2489545">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2489555">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2489565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489568">//&nbsp;for&nbsp;testing:&nbsp;whatever&nbsp;interrupts&nbsp;a&nbsp;sleep</span><br>
<span class="lineno">15</span><span class="keyword" id="2489612">func</span>&nbsp;<span class="ident" id="2489617">interrupt</span><span class="op" id="2489626">(</span><span class="op" id="2489627">)</span>&nbsp;<span class="op" id="2489629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489632">syscall</span><span class="op" id="2489639">.</span><span class="ident" id="2489640">Kill</span><span class="op" id="2489644">(</span><span class="ident" id="2489645">syscall</span><span class="op" id="2489652">.</span><span class="ident" id="2489653">Getpid</span><span class="op" id="2489659">(</span><span class="op" id="2489660">)</span><span class="op" id="2489661">,</span>&nbsp;<span class="ident" id="2489663">syscall</span><span class="op" id="2489670">.</span><span class="ident" id="2489671">SIGCHLD</span><span class="op" id="2489678">)</span><br>
<span class="lineno"></span><span class="op" id="2489680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489683">//&nbsp;readFile&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">20</span><span class="comment" id="2489744">//&nbsp;It&nbsp;is&nbsp;a&nbsp;trivial&nbsp;implementation&nbsp;of&nbsp;ioutil.ReadFile,&nbsp;reimplemented</span><br>
<span class="lineno"></span><span class="comment" id="2489812">//&nbsp;here&nbsp;to&nbsp;avoid&nbsp;depending&nbsp;on&nbsp;io/ioutil&nbsp;or&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2489859">func</span>&nbsp;<span class="ident" id="2489864">readFile</span><span class="op" id="2489872">(</span><span class="ident" id="2489873">name</span>&nbsp;<span class="builtintype" id="2489878">string</span><span class="op" id="2489884">)</span>&nbsp;<span class="op" id="2489886">(</span><span class="op" id="2489887">[</span><span class="op" id="2489888">]</span><span class="builtintype" id="2489889">byte</span><span class="op" id="2489893">,</span>&nbsp;<span class="builtintype" id="2489895">error</span><span class="op" id="2489900">)</span>&nbsp;<span class="op" id="2489902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489905">f</span><span class="op" id="2489906">,</span>&nbsp;<span class="ident" id="2489908">err</span>&nbsp;<span class="op" id="2489912">:=</span>&nbsp;<span class="ident" id="2489915">syscall</span><span class="op" id="2489922">.</span><span class="ident" id="2489923">Open</span><span class="op" id="2489927">(</span><span class="ident" id="2489928">name</span><span class="op" id="2489932">,</span>&nbsp;<span class="ident" id="2489934">syscall</span><span class="op" id="2489941">.</span><span class="ident" id="2489942">O_RDONLY</span><span class="op" id="2489950">,</span>&nbsp;<span class="num" id="2489952">0</span><span class="op" id="2489953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489956">if</span>&nbsp;<span class="ident" id="2489959">err</span>&nbsp;<span class="op" id="2489963">!=</span>&nbsp;<span class="ident" id="2489966">nil</span>&nbsp;<span class="op" id="2489970">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489974">return</span>&nbsp;<span class="ident" id="2489981">nil</span><span class="op" id="2489984">,</span>&nbsp;<span class="ident" id="2489986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489994">defer</span>&nbsp;<span class="ident" id="2490000">syscall</span><span class="op" id="2490007">.</span><span class="ident" id="2490008">Close</span><span class="op" id="2490013">(</span><span class="ident" id="2490014">f</span><span class="op" id="2490015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490018">var</span>&nbsp;<span class="op" id="2490022">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490026">buf</span>&nbsp;<span class="op" id="2490030">[</span><span class="num" id="2490031">4096</span><span class="op" id="2490035">]</span><span class="builtintype" id="2490036">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490043">ret</span>&nbsp;<span class="op" id="2490047">[</span><span class="op" id="2490048">]</span><span class="builtintype" id="2490049">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490056">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2490060">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490068">for</span>&nbsp;<span class="op" id="2490072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490076">n</span><span class="op" id="2490077">,</span>&nbsp;<span class="ident" id="2490079">err</span>&nbsp;<span class="op" id="2490083">=</span>&nbsp;<span class="ident" id="2490085">syscall</span><span class="op" id="2490092">.</span><span class="ident" id="2490093">Read</span><span class="op" id="2490097">(</span><span class="ident" id="2490098">f</span><span class="op" id="2490099">,</span>&nbsp;<span class="ident" id="2490101">buf</span><span class="op" id="2490104">[</span><span class="op" id="2490105">:</span><span class="op" id="2490106">]</span><span class="op" id="2490107">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490111">if</span>&nbsp;<span class="ident" id="2490114">n</span>&nbsp;<span class="op" id="2490116">&gt;</span>&nbsp;<span class="num" id="2490118">0</span>&nbsp;<span class="op" id="2490120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490125">ret</span>&nbsp;<span class="op" id="2490129">=</span>&nbsp;<span class="builtinfunc" id="2490131">append</span><span class="op" id="2490137">(</span><span class="ident" id="2490138">ret</span><span class="op" id="2490141">,</span>&nbsp;<span class="ident" id="2490143">buf</span><span class="op" id="2490146">[</span><span class="op" id="2490147">:</span><span class="ident" id="2490148">n</span><span class="op" id="2490149">]</span><span class="op" id="2490150">...</span><span class="op" id="2490153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490161">if</span>&nbsp;<span class="ident" id="2490164">n</span>&nbsp;<span class="op" id="2490166">==</span>&nbsp;<span class="num" id="2490169">0</span>&nbsp;<span class="op" id="2490171">||</span>&nbsp;<span class="ident" id="2490174">err</span>&nbsp;<span class="op" id="2490178">!=</span>&nbsp;<span class="ident" id="2490181">nil</span>&nbsp;<span class="op" id="2490185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490190">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490204">return</span>&nbsp;<span class="ident" id="2490211">ret</span><span class="op" id="2490214">,</span>&nbsp;<span class="ident" id="2490216">err</span><br>
<span class="lineno"></span><span class="op" id="2490220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="2490223">func</span>&nbsp;<span class="ident" id="2490228">open</span><span class="op" id="2490232">(</span><span class="ident" id="2490233">name</span>&nbsp;<span class="builtintype" id="2490238">string</span><span class="op" id="2490244">)</span>&nbsp;<span class="op" id="2490246">(</span><span class="builtintype" id="2490247">uintptr</span><span class="op" id="2490254">,</span>&nbsp;<span class="builtintype" id="2490256">error</span><span class="op" id="2490261">)</span>&nbsp;<span class="op" id="2490263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490266">fd</span><span class="op" id="2490268">,</span>&nbsp;<span class="ident" id="2490270">err</span>&nbsp;<span class="op" id="2490274">:=</span>&nbsp;<span class="ident" id="2490277">syscall</span><span class="op" id="2490284">.</span><span class="ident" id="2490285">Open</span><span class="op" id="2490289">(</span><span class="ident" id="2490290">name</span><span class="op" id="2490294">,</span>&nbsp;<span class="ident" id="2490296">syscall</span><span class="op" id="2490303">.</span><span class="ident" id="2490304">O_RDONLY</span><span class="op" id="2490312">,</span>&nbsp;<span class="num" id="2490314">0</span><span class="op" id="2490315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490318">if</span>&nbsp;<span class="ident" id="2490321">err</span>&nbsp;<span class="op" id="2490325">!=</span>&nbsp;<span class="ident" id="2490328">nil</span>&nbsp;<span class="op" id="2490332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490336">return</span>&nbsp;<span class="num" id="2490343">0</span><span class="op" id="2490344">,</span>&nbsp;<span class="ident" id="2490346">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490351">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490354">return</span>&nbsp;<span class="builtintype" id="2490361">uintptr</span><span class="op" id="2490368">(</span><span class="ident" id="2490369">fd</span><span class="op" id="2490371">)</span><span class="op" id="2490372">,</span>&nbsp;<span class="ident" id="2490374">nil</span><br>
<span class="lineno"></span><span class="op" id="2490378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2490381">func</span>&nbsp;<span class="ident" id="2490386">closefd</span><span class="op" id="2490393">(</span><span class="ident" id="2490394">fd</span>&nbsp;<span class="builtintype" id="2490397">uintptr</span><span class="op" id="2490404">)</span>&nbsp;<span class="op" id="2490406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490409">syscall</span><span class="op" id="2490416">.</span><span class="ident" id="2490417">Close</span><span class="op" id="2490422">(</span><span class="builtintype" id="2490423">int</span><span class="op" id="2490426">(</span><span class="ident" id="2490427">fd</span><span class="op" id="2490429">)</span><span class="op" id="2490430">)</span><br>
<span class="lineno">55</span><span class="op" id="2490432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2490435">func</span>&nbsp;<span class="ident" id="2490440">preadn</span><span class="op" id="2490446">(</span><span class="ident" id="2490447">fd</span>&nbsp;<span class="builtintype" id="2490450">uintptr</span><span class="op" id="2490457">,</span>&nbsp;<span class="ident" id="2490459">buf</span>&nbsp;<span class="op" id="2490463">[</span><span class="op" id="2490464">]</span><span class="builtintype" id="2490465">byte</span><span class="op" id="2490469">,</span>&nbsp;<span class="ident" id="2490471">off</span>&nbsp;<span class="builtintype" id="2490475">int</span><span class="op" id="2490478">)</span>&nbsp;<span class="builtintype" id="2490480">error</span>&nbsp;<span class="op" id="2490486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490489">whence</span>&nbsp;<span class="op" id="2490496">:=</span>&nbsp;<span class="num" id="2490499">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490502">if</span>&nbsp;<span class="ident" id="2490505">off</span>&nbsp;<span class="op" id="2490509">&lt;</span>&nbsp;<span class="num" id="2490511">0</span>&nbsp;<span class="op" id="2490513">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490517">whence</span>&nbsp;<span class="op" id="2490524">=</span>&nbsp;<span class="num" id="2490526">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490532">if</span>&nbsp;<span class="ident" id="2490535">_</span><span class="op" id="2490536">,</span>&nbsp;<span class="ident" id="2490538">err</span>&nbsp;<span class="op" id="2490542">:=</span>&nbsp;<span class="ident" id="2490545">syscall</span><span class="op" id="2490552">.</span><span class="ident" id="2490553">Seek</span><span class="op" id="2490557">(</span><span class="builtintype" id="2490558">int</span><span class="op" id="2490561">(</span><span class="ident" id="2490562">fd</span><span class="op" id="2490564">)</span><span class="op" id="2490565">,</span>&nbsp;<span class="ident" id="2490567">int64</span><span class="op" id="2490572">(</span><span class="ident" id="2490573">off</span><span class="op" id="2490576">)</span><span class="op" id="2490577">,</span>&nbsp;<span class="ident" id="2490579">whence</span><span class="op" id="2490585">)</span><span class="op" id="2490586">;</span>&nbsp;<span class="ident" id="2490588">err</span>&nbsp;<span class="op" id="2490592">!=</span>&nbsp;<span class="ident" id="2490595">nil</span>&nbsp;<span class="op" id="2490599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490603">return</span>&nbsp;<span class="ident" id="2490610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490615">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490618">for</span>&nbsp;<span class="builtinfunc" id="2490622">len</span><span class="op" id="2490625">(</span><span class="ident" id="2490626">buf</span><span class="op" id="2490629">)</span>&nbsp;<span class="op" id="2490631">&gt;</span>&nbsp;<span class="num" id="2490633">0</span>&nbsp;<span class="op" id="2490635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490639">m</span><span class="op" id="2490640">,</span>&nbsp;<span class="ident" id="2490642">err</span>&nbsp;<span class="op" id="2490646">:=</span>&nbsp;<span class="ident" id="2490649">syscall</span><span class="op" id="2490656">.</span><span class="ident" id="2490657">Read</span><span class="op" id="2490661">(</span><span class="builtintype" id="2490662">int</span><span class="op" id="2490665">(</span><span class="ident" id="2490666">fd</span><span class="op" id="2490668">)</span><span class="op" id="2490669">,</span>&nbsp;<span class="ident" id="2490671">buf</span><span class="op" id="2490674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490678">if</span>&nbsp;<span class="ident" id="2490681">m</span>&nbsp;<span class="op" id="2490683">&lt;=</span>&nbsp;<span class="num" id="2490686">0</span>&nbsp;<span class="op" id="2490688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490693">if</span>&nbsp;<span class="ident" id="2490696">err</span>&nbsp;<span class="op" id="2490700">==</span>&nbsp;<span class="ident" id="2490703">nil</span>&nbsp;<span class="op" id="2490707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490713">return</span>&nbsp;<span class="ident" id="2490720">errors</span><span class="op" id="2490726">.</span><span class="ident" id="2490727">New</span><span class="op" id="2490730">(</span><span class="string" id="2490731">&#34;short&nbsp;read&#34;</span><span class="op" id="2490743">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490753">return</span>&nbsp;<span class="ident" id="2490760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490770">buf</span>&nbsp;<span class="op" id="2490774">=</span>&nbsp;<span class="ident" id="2490776">buf</span><span class="op" id="2490779">[</span><span class="ident" id="2490780">m</span><span class="op" id="2490781">:</span><span class="op" id="2490782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490785">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490788">return</span>&nbsp;<span class="ident" id="2490795">nil</span><br>
<span class="lineno"></span><span class="op" id="2490799">}</span>
</div>
</body>
</html>
