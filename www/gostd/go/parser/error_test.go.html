<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html" class="current">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7117099">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7117154">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7117208">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7117259">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="7117332">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7117405">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7117478">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="7117548">//</span><br>
<span class="lineno">10</span><span class="comment" id="7117551">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="7117623">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="7117697">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="7117770">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="7117813">//</span><br>
<span class="lineno">15</span><span class="comment" id="7117816">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7117889">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="7117948">//</span><br>
<span class="lineno"></span><span class="comment" id="7117951">//&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="7117964">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="7117978">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="7118019">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7118025">package</span>&nbsp;<span class="ident" id="7118033">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7118041">import</span>&nbsp;<span class="op" id="7118048">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118051">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118065">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118077">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118090">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118107">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118117">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7118128">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7118138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7118141">const</span>&nbsp;<span class="ident" id="7118147">testdata</span>&nbsp;<span class="op" id="7118156">=</span>&nbsp;<span class="string" id="7118158">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7118170">var</span>&nbsp;<span class="ident" id="7118174">fsetErrs</span>&nbsp;<span class="op" id="7118183">=</span>&nbsp;<span class="ident" id="7118185">token</span><span class="op" id="7118190">.</span><span class="ident" id="7118191">NewFileSet</span><span class="op" id="7118201">(</span><span class="op" id="7118202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7118205">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="7118263">func</span>&nbsp;<span class="ident" id="7118268">getFile</span><span class="op" id="7118275">(</span><span class="ident" id="7118276">filename</span>&nbsp;<span class="builtintype" id="7118285">string</span><span class="op" id="7118291">)</span>&nbsp;<span class="op" id="7118293">(</span><span class="ident" id="7118294">file</span>&nbsp;<span class="op" id="7118299">*</span><span class="ident" id="7118300">token</span><span class="op" id="7118305">.</span><span class="ident" id="7118306">File</span><span class="op" id="7118310">)</span>&nbsp;<span class="op" id="7118312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7118315">fsetErrs</span><span class="op" id="7118323">.</span><span class="ident" id="7118324">Iterate</span><span class="op" id="7118331">(</span><span class="keyword" id="7118332">func</span><span class="op" id="7118336">(</span><span class="ident" id="7118337">f</span>&nbsp;<span class="op" id="7118339">*</span><span class="ident" id="7118340">token</span><span class="op" id="7118345">.</span><span class="ident" id="7118346">File</span><span class="op" id="7118350">)</span>&nbsp;<span class="builtintype" id="7118352">bool</span>&nbsp;<span class="op" id="7118357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118361">if</span>&nbsp;<span class="ident" id="7118364">f</span><span class="op" id="7118365">.</span><span class="ident" id="7118366">Name</span><span class="op" id="7118370">(</span><span class="op" id="7118371">)</span>&nbsp;<span class="op" id="7118373">==</span>&nbsp;<span class="ident" id="7118376">filename</span>&nbsp;<span class="op" id="7118385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118390">if</span>&nbsp;<span class="ident" id="7118393">file</span>&nbsp;<span class="op" id="7118398">!=</span>&nbsp;<span class="ident" id="7118401">nil</span>&nbsp;<span class="op" id="7118405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7118411">panic</span><span class="op" id="7118416">(</span><span class="ident" id="7118417">filename</span>&nbsp;<span class="op" id="7118426">+</span>&nbsp;<span class="string" id="7118428">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="7118450">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7118455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7118460">file</span>&nbsp;<span class="op" id="7118465">=</span>&nbsp;<span class="ident" id="7118467">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7118471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118475">return</span>&nbsp;<span class="builtintype" id="7118482">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7118488">}</span><span class="op" id="7118489">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118492">return</span>&nbsp;<span class="ident" id="7118499">file</span><br>
<span class="lineno"></span><span class="op" id="7118504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7118507">func</span>&nbsp;<span class="ident" id="7118512">getPos</span><span class="op" id="7118518">(</span><span class="ident" id="7118519">filename</span>&nbsp;<span class="builtintype" id="7118528">string</span><span class="op" id="7118534">,</span>&nbsp;<span class="ident" id="7118536">offset</span>&nbsp;<span class="builtintype" id="7118543">int</span><span class="op" id="7118546">)</span>&nbsp;<span class="ident" id="7118548">token</span><span class="op" id="7118553">.</span><span class="ident" id="7118554">Pos</span>&nbsp;<span class="op" id="7118558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118561">if</span>&nbsp;<span class="ident" id="7118564">f</span>&nbsp;<span class="op" id="7118566">:=</span>&nbsp;<span class="ident" id="7118569">getFile</span><span class="op" id="7118576">(</span><span class="ident" id="7118577">filename</span><span class="op" id="7118585">)</span><span class="op" id="7118586">;</span>&nbsp;<span class="ident" id="7118588">f</span>&nbsp;<span class="op" id="7118590">!=</span>&nbsp;<span class="ident" id="7118593">nil</span>&nbsp;<span class="op" id="7118597">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118601">return</span>&nbsp;<span class="ident" id="7118608">f</span><span class="op" id="7118609">.</span><span class="ident" id="7118610">Pos</span><span class="op" id="7118613">(</span><span class="ident" id="7118614">offset</span><span class="op" id="7118620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7118623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7118626">return</span>&nbsp;<span class="ident" id="7118633">token</span><span class="op" id="7118638">.</span><span class="ident" id="7118639">NoPos</span><br>
<span class="lineno"></span><span class="op" id="7118645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7118648">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="7118713">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="7118778">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="7118843">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="7118909">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="7118932">//</span><br>
<span class="lineno"></span><span class="keyword" id="7118935">var</span>&nbsp;<span class="ident" id="7118939">errRx</span>&nbsp;<span class="op" id="7118945">=</span>&nbsp;<span class="ident" id="7118947">regexp</span><span class="op" id="7118953">.</span><span class="ident" id="7118954">MustCompile</span><span class="op" id="7118965">(</span><span class="string" id="7118966">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="7119005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7119008">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="7119083">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="7119159">//</span><br>
<span class="lineno"></span><span class="keyword" id="7119162">func</span>&nbsp;<span class="ident" id="7119167">expectedErrors</span><span class="op" id="7119181">(</span><span class="ident" id="7119182">t</span>&nbsp;<span class="op" id="7119184">*</span><span class="ident" id="7119185">testing</span><span class="op" id="7119192">.</span><span class="ident" id="7119193">T</span><span class="op" id="7119194">,</span>&nbsp;<span class="ident" id="7119196">filename</span>&nbsp;<span class="builtintype" id="7119205">string</span><span class="op" id="7119211">,</span>&nbsp;<span class="ident" id="7119213">src</span>&nbsp;<span class="op" id="7119217">[</span><span class="op" id="7119218">]</span><span class="builtintype" id="7119219">byte</span><span class="op" id="7119223">)</span>&nbsp;<span class="keyword" id="7119225">map</span><span class="op" id="7119228">[</span><span class="ident" id="7119229">token</span><span class="op" id="7119234">.</span><span class="ident" id="7119235">Pos</span><span class="op" id="7119238">]</span><span class="builtintype" id="7119239">string</span>&nbsp;<span class="op" id="7119246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119249">errors</span>&nbsp;<span class="op" id="7119256">:=</span>&nbsp;<span class="builtinfunc" id="7119259">make</span><span class="op" id="7119263">(</span><span class="keyword" id="7119264">map</span><span class="op" id="7119267">[</span><span class="ident" id="7119268">token</span><span class="op" id="7119273">.</span><span class="ident" id="7119274">Pos</span><span class="op" id="7119277">]</span><span class="builtintype" id="7119278">string</span><span class="op" id="7119284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119288">var</span>&nbsp;<span class="ident" id="7119292">s</span>&nbsp;<span class="ident" id="7119294">scanner</span><span class="op" id="7119301">.</span><span class="ident" id="7119302">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7119311">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7119373">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7119435">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119498">s</span><span class="op" id="7119499">.</span><span class="ident" id="7119500">Init</span><span class="op" id="7119504">(</span><span class="ident" id="7119505">getFile</span><span class="op" id="7119512">(</span><span class="ident" id="7119513">filename</span><span class="op" id="7119521">)</span><span class="op" id="7119522">,</span>&nbsp;<span class="ident" id="7119524">src</span><span class="op" id="7119527">,</span>&nbsp;<span class="ident" id="7119529">nil</span><span class="op" id="7119532">,</span>&nbsp;<span class="ident" id="7119534">scanner</span><span class="op" id="7119541">.</span><span class="ident" id="7119542">ScanComments</span><span class="op" id="7119554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119557">var</span>&nbsp;<span class="ident" id="7119561">prev</span>&nbsp;<span class="ident" id="7119566">token</span><span class="op" id="7119571">.</span><span class="ident" id="7119572">Pos</span>&nbsp;<span class="comment" id="7119576">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119630">var</span>&nbsp;<span class="ident" id="7119634">here</span>&nbsp;<span class="ident" id="7119639">token</span><span class="op" id="7119644">.</span><span class="ident" id="7119645">Pos</span>&nbsp;<span class="comment" id="7119649">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119708">for</span>&nbsp;<span class="op" id="7119712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119716">pos</span><span class="op" id="7119719">,</span>&nbsp;<span class="ident" id="7119721">tok</span><span class="op" id="7119724">,</span>&nbsp;<span class="ident" id="7119726">lit</span>&nbsp;<span class="op" id="7119730">:=</span>&nbsp;<span class="ident" id="7119733">s</span><span class="op" id="7119734">.</span><span class="ident" id="7119735">Scan</span><span class="op" id="7119739">(</span><span class="op" id="7119740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119744">switch</span>&nbsp;<span class="ident" id="7119751">tok</span>&nbsp;<span class="op" id="7119755">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119759">case</span>&nbsp;<span class="ident" id="7119764">token</span><span class="op" id="7119769">.</span><span class="ident" id="7119770">EOF</span><span class="op" id="7119773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119778">return</span>&nbsp;<span class="ident" id="7119785">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119794">case</span>&nbsp;<span class="ident" id="7119799">token</span><span class="op" id="7119804">.</span><span class="ident" id="7119805">COMMENT</span><span class="op" id="7119812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119817">s</span>&nbsp;<span class="op" id="7119819">:=</span>&nbsp;<span class="ident" id="7119822">errRx</span><span class="op" id="7119827">.</span><span class="ident" id="7119828">FindStringSubmatch</span><span class="op" id="7119846">(</span><span class="ident" id="7119847">lit</span><span class="op" id="7119850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119855">if</span>&nbsp;<span class="builtinfunc" id="7119858">len</span><span class="op" id="7119861">(</span><span class="ident" id="7119862">s</span><span class="op" id="7119863">)</span>&nbsp;<span class="op" id="7119865">==</span>&nbsp;<span class="num" id="7119868">3</span>&nbsp;<span class="op" id="7119870">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119876">pos</span>&nbsp;<span class="op" id="7119880">:=</span>&nbsp;<span class="ident" id="7119883">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119892">if</span>&nbsp;<span class="ident" id="7119895">s</span><span class="op" id="7119896">[</span><span class="num" id="7119897">1</span><span class="op" id="7119898">]</span>&nbsp;<span class="op" id="7119900">==</span>&nbsp;<span class="string" id="7119903">&#34;HERE&#34;</span>&nbsp;<span class="op" id="7119910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119917">pos</span>&nbsp;<span class="op" id="7119921">=</span>&nbsp;<span class="ident" id="7119923">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7119932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119938">errors</span><span class="op" id="7119944">[</span><span class="ident" id="7119945">pos</span><span class="op" id="7119948">]</span>&nbsp;<span class="op" id="7119950">=</span>&nbsp;<span class="builtintype" id="7119952">string</span><span class="op" id="7119958">(</span><span class="ident" id="7119959">s</span><span class="op" id="7119960">[</span><span class="num" id="7119961">2</span><span class="op" id="7119962">]</span><span class="op" id="7119963">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7119968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119972">default</span><span class="op" id="7119979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7119984">prev</span>&nbsp;<span class="op" id="7119989">=</span>&nbsp;<span class="ident" id="7119991">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7119998">var</span>&nbsp;<span class="ident" id="7120002">l</span>&nbsp;<span class="builtintype" id="7120004">int</span>&nbsp;<span class="comment" id="7120008">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120027">if</span>&nbsp;<span class="ident" id="7120030">tok</span><span class="op" id="7120033">.</span><span class="ident" id="7120034">IsLiteral</span><span class="op" id="7120043">(</span><span class="op" id="7120044">)</span>&nbsp;<span class="op" id="7120046">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120052">l</span>&nbsp;<span class="op" id="7120054">=</span>&nbsp;<span class="builtinfunc" id="7120056">len</span><span class="op" id="7120059">(</span><span class="ident" id="7120060">lit</span><span class="op" id="7120063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120068">}</span>&nbsp;<span class="keyword" id="7120070">else</span>&nbsp;<span class="op" id="7120075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120081">l</span>&nbsp;<span class="op" id="7120083">=</span>&nbsp;<span class="builtinfunc" id="7120085">len</span><span class="op" id="7120088">(</span><span class="ident" id="7120089">tok</span><span class="op" id="7120092">.</span><span class="ident" id="7120093">String</span><span class="op" id="7120099">(</span><span class="op" id="7120100">)</span><span class="op" id="7120101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120111">here</span>&nbsp;<span class="op" id="7120116">=</span>&nbsp;<span class="ident" id="7120118">prev</span>&nbsp;<span class="op" id="7120123">+</span>&nbsp;<span class="ident" id="7120125">token</span><span class="op" id="7120130">.</span><span class="ident" id="7120131">Pos</span><span class="op" id="7120134">(</span><span class="ident" id="7120135">l</span><span class="op" id="7120136">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120143">}</span><br>
<span class="lineno"></span><span class="op" id="7120145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7120148">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="7120223">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="7120269">//</span><br>
<span class="lineno"></span><span class="keyword" id="7120272">func</span>&nbsp;<span class="ident" id="7120277">compareErrors</span><span class="op" id="7120290">(</span><span class="ident" id="7120291">t</span>&nbsp;<span class="op" id="7120293">*</span><span class="ident" id="7120294">testing</span><span class="op" id="7120301">.</span><span class="ident" id="7120302">T</span><span class="op" id="7120303">,</span>&nbsp;<span class="ident" id="7120305">expected</span>&nbsp;<span class="keyword" id="7120314">map</span><span class="op" id="7120317">[</span><span class="ident" id="7120318">token</span><span class="op" id="7120323">.</span><span class="ident" id="7120324">Pos</span><span class="op" id="7120327">]</span><span class="builtintype" id="7120328">string</span><span class="op" id="7120334">,</span>&nbsp;<span class="ident" id="7120336">found</span>&nbsp;<span class="ident" id="7120342">scanner</span><span class="op" id="7120349">.</span><span class="ident" id="7120350">ErrorList</span><span class="op" id="7120359">)</span>&nbsp;<span class="op" id="7120361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120364">for</span>&nbsp;<span class="ident" id="7120368">_</span><span class="op" id="7120369">,</span>&nbsp;<span class="builtintype" id="7120371">error</span>&nbsp;<span class="op" id="7120377">:=</span>&nbsp;<span class="keyword" id="7120380">range</span>&nbsp;<span class="ident" id="7120386">found</span>&nbsp;<span class="op" id="7120392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7120396">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7120444">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120487">pos</span>&nbsp;<span class="op" id="7120491">:=</span>&nbsp;<span class="ident" id="7120494">getPos</span><span class="op" id="7120500">(</span><span class="builtintype" id="7120501">error</span><span class="op" id="7120506">.</span><span class="ident" id="7120507">Pos</span><span class="op" id="7120510">.</span><span class="ident" id="7120511">Filename</span><span class="op" id="7120519">,</span>&nbsp;<span class="builtintype" id="7120521">error</span><span class="op" id="7120526">.</span><span class="ident" id="7120527">Pos</span><span class="op" id="7120530">.</span><span class="ident" id="7120531">Offset</span><span class="op" id="7120537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120541">if</span>&nbsp;<span class="ident" id="7120544">msg</span><span class="op" id="7120547">,</span>&nbsp;<span class="ident" id="7120549">found</span>&nbsp;<span class="op" id="7120555">:=</span>&nbsp;<span class="ident" id="7120558">expected</span><span class="op" id="7120566">[</span><span class="ident" id="7120567">pos</span><span class="op" id="7120570">]</span><span class="op" id="7120571">;</span>&nbsp;<span class="ident" id="7120573">found</span>&nbsp;<span class="op" id="7120579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7120584">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120638">rx</span><span class="op" id="7120640">,</span>&nbsp;<span class="ident" id="7120642">err</span>&nbsp;<span class="op" id="7120646">:=</span>&nbsp;<span class="ident" id="7120649">regexp</span><span class="op" id="7120655">.</span><span class="ident" id="7120656">Compile</span><span class="op" id="7120663">(</span><span class="ident" id="7120664">msg</span><span class="op" id="7120667">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120672">if</span>&nbsp;<span class="ident" id="7120675">err</span>&nbsp;<span class="op" id="7120679">!=</span>&nbsp;<span class="ident" id="7120682">nil</span>&nbsp;<span class="op" id="7120686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120692">t</span><span class="op" id="7120693">.</span><span class="ident" id="7120694">Errorf</span><span class="op" id="7120700">(</span><span class="string" id="7120701">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7120709">,</span>&nbsp;<span class="builtintype" id="7120711">error</span><span class="op" id="7120716">.</span><span class="ident" id="7120717">Pos</span><span class="op" id="7120720">,</span>&nbsp;<span class="ident" id="7120722">err</span><span class="op" id="7120725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120731">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120748">if</span>&nbsp;<span class="ident" id="7120751">match</span>&nbsp;<span class="op" id="7120757">:=</span>&nbsp;<span class="ident" id="7120760">rx</span><span class="op" id="7120762">.</span><span class="ident" id="7120763">MatchString</span><span class="op" id="7120774">(</span><span class="builtintype" id="7120775">error</span><span class="op" id="7120780">.</span><span class="ident" id="7120781">Msg</span><span class="op" id="7120784">)</span><span class="op" id="7120785">;</span>&nbsp;<span class="op" id="7120787">!</span><span class="ident" id="7120788">match</span>&nbsp;<span class="op" id="7120794">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7120800">t</span><span class="op" id="7120801">.</span><span class="ident" id="7120802">Errorf</span><span class="op" id="7120808">(</span><span class="string" id="7120809">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="7120835">,</span>&nbsp;<span class="builtintype" id="7120837">error</span><span class="op" id="7120842">.</span><span class="ident" id="7120843">Pos</span><span class="op" id="7120846">,</span>&nbsp;<span class="builtintype" id="7120848">error</span><span class="op" id="7120853">.</span><span class="ident" id="7120854">Msg</span><span class="op" id="7120857">,</span>&nbsp;<span class="ident" id="7120859">msg</span><span class="op" id="7120862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7120868">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7120885">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7120930">delete</span><span class="op" id="7120936">(</span><span class="ident" id="7120937">expected</span><span class="op" id="7120945">,</span>&nbsp;<span class="ident" id="7120947">pos</span><span class="op" id="7120950">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7120954">}</span>&nbsp;<span class="keyword" id="7120956">else</span>&nbsp;<span class="op" id="7120961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7120966">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121023">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121089">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121154">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121222">t</span><span class="op" id="7121223">.</span><span class="ident" id="7121224">Errorf</span><span class="op" id="7121230">(</span><span class="string" id="7121231">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7121257">,</span>&nbsp;<span class="builtintype" id="7121259">error</span><span class="op" id="7121264">.</span><span class="ident" id="7121265">Pos</span><span class="op" id="7121268">,</span>&nbsp;<span class="builtintype" id="7121270">error</span><span class="op" id="7121275">.</span><span class="ident" id="7121276">Msg</span><span class="op" id="7121279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121290">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121334">if</span>&nbsp;<span class="builtinfunc" id="7121337">len</span><span class="op" id="7121340">(</span><span class="ident" id="7121341">expected</span><span class="op" id="7121349">)</span>&nbsp;<span class="op" id="7121351">&gt;</span>&nbsp;<span class="num" id="7121353">0</span>&nbsp;<span class="op" id="7121355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121359">t</span><span class="op" id="7121360">.</span><span class="ident" id="7121361">Errorf</span><span class="op" id="7121367">(</span><span class="string" id="7121368">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="7121393">,</span>&nbsp;<span class="builtinfunc" id="7121395">len</span><span class="op" id="7121398">(</span><span class="ident" id="7121399">expected</span><span class="op" id="7121407">)</span><span class="op" id="7121408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121412">for</span>&nbsp;<span class="ident" id="7121416">pos</span><span class="op" id="7121419">,</span>&nbsp;<span class="ident" id="7121421">msg</span>&nbsp;<span class="op" id="7121425">:=</span>&nbsp;<span class="keyword" id="7121428">range</span>&nbsp;<span class="ident" id="7121434">expected</span>&nbsp;<span class="op" id="7121443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121448">t</span><span class="op" id="7121449">.</span><span class="ident" id="7121450">Errorf</span><span class="op" id="7121456">(</span><span class="string" id="7121457">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="7121467">,</span>&nbsp;<span class="ident" id="7121469">fsetErrs</span><span class="op" id="7121477">.</span><span class="ident" id="7121478">Position</span><span class="op" id="7121486">(</span><span class="ident" id="7121487">pos</span><span class="op" id="7121490">)</span><span class="op" id="7121491">,</span>&nbsp;<span class="ident" id="7121493">msg</span><span class="op" id="7121496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121500">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121503">}</span><br>
<span class="lineno"></span><span class="op" id="7121505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7121508">func</span>&nbsp;<span class="ident" id="7121513">checkErrors</span><span class="op" id="7121524">(</span><span class="ident" id="7121525">t</span>&nbsp;<span class="op" id="7121527">*</span><span class="ident" id="7121528">testing</span><span class="op" id="7121535">.</span><span class="ident" id="7121536">T</span><span class="op" id="7121537">,</span>&nbsp;<span class="ident" id="7121539">filename</span>&nbsp;<span class="builtintype" id="7121548">string</span><span class="op" id="7121554">,</span>&nbsp;<span class="ident" id="7121556">input</span>&nbsp;<span class="keyword" id="7121562">interface</span><span class="op" id="7121571">{</span><span class="op" id="7121572">}</span><span class="op" id="7121573">)</span>&nbsp;<span class="op" id="7121575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121578">src</span><span class="op" id="7121581">,</span>&nbsp;<span class="ident" id="7121583">err</span>&nbsp;<span class="op" id="7121587">:=</span>&nbsp;<span class="ident" id="7121590">readSource</span><span class="op" id="7121600">(</span><span class="ident" id="7121601">filename</span><span class="op" id="7121609">,</span>&nbsp;<span class="ident" id="7121611">input</span><span class="op" id="7121616">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121619">if</span>&nbsp;<span class="ident" id="7121622">err</span>&nbsp;<span class="op" id="7121626">!=</span>&nbsp;<span class="ident" id="7121629">nil</span>&nbsp;<span class="op" id="7121633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121637">t</span><span class="op" id="7121638">.</span><span class="ident" id="7121639">Error</span><span class="op" id="7121644">(</span><span class="ident" id="7121645">err</span><span class="op" id="7121648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121652">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121664">_</span><span class="op" id="7121665">,</span>&nbsp;<span class="ident" id="7121667">err</span>&nbsp;<span class="op" id="7121671">=</span>&nbsp;<span class="ident" id="7121673">ParseFile</span><span class="op" id="7121682">(</span><span class="ident" id="7121683">fsetErrs</span><span class="op" id="7121691">,</span>&nbsp;<span class="ident" id="7121693">filename</span><span class="op" id="7121701">,</span>&nbsp;<span class="ident" id="7121703">src</span><span class="op" id="7121706">,</span>&nbsp;<span class="ident" id="7121708">DeclarationErrors</span><span class="op" id="7121725">|</span><span class="ident" id="7121726">AllErrors</span><span class="op" id="7121735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121738">found</span><span class="op" id="7121743">,</span>&nbsp;<span class="ident" id="7121745">ok</span>&nbsp;<span class="op" id="7121748">:=</span>&nbsp;<span class="ident" id="7121751">err</span><span class="op" id="7121754">.</span><span class="op" id="7121755">(</span><span class="ident" id="7121756">scanner</span><span class="op" id="7121763">.</span><span class="ident" id="7121764">ErrorList</span><span class="op" id="7121773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121776">if</span>&nbsp;<span class="ident" id="7121779">err</span>&nbsp;<span class="op" id="7121783">!=</span>&nbsp;<span class="ident" id="7121786">nil</span>&nbsp;<span class="op" id="7121790">&amp;&amp;</span>&nbsp;<span class="op" id="7121793">!</span><span class="ident" id="7121794">ok</span>&nbsp;<span class="op" id="7121797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121801">t</span><span class="op" id="7121802">.</span><span class="ident" id="7121803">Error</span><span class="op" id="7121808">(</span><span class="ident" id="7121809">err</span><span class="op" id="7121812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7121816">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7121824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121827">found</span><span class="op" id="7121832">.</span><span class="ident" id="7121833">RemoveMultiples</span><span class="op" id="7121848">(</span><span class="op" id="7121849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121853">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7121895">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7121972">expected</span>&nbsp;<span class="op" id="7121981">:=</span>&nbsp;<span class="ident" id="7121984">expectedErrors</span><span class="op" id="7121998">(</span><span class="ident" id="7121999">t</span><span class="op" id="7122000">,</span>&nbsp;<span class="ident" id="7122002">filename</span><span class="op" id="7122010">,</span>&nbsp;<span class="ident" id="7122012">src</span><span class="op" id="7122015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7122019">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7122060">compareErrors</span><span class="op" id="7122073">(</span><span class="ident" id="7122074">t</span><span class="op" id="7122075">,</span>&nbsp;<span class="ident" id="7122077">expected</span><span class="op" id="7122085">,</span>&nbsp;<span class="ident" id="7122087">found</span><span class="op" id="7122092">)</span><br>
<span class="lineno"></span><span class="op" id="7122094">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7122097">func</span>&nbsp;<span class="ident" id="7122102">TestErrors</span><span class="op" id="7122112">(</span><span class="ident" id="7122113">t</span>&nbsp;<span class="op" id="7122115">*</span><span class="ident" id="7122116">testing</span><span class="op" id="7122123">.</span><span class="ident" id="7122124">T</span><span class="op" id="7122125">)</span>&nbsp;<span class="op" id="7122127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7122130">list</span><span class="op" id="7122134">,</span>&nbsp;<span class="ident" id="7122136">err</span>&nbsp;<span class="op" id="7122140">:=</span>&nbsp;<span class="ident" id="7122143">ioutil</span><span class="op" id="7122149">.</span><span class="ident" id="7122150">ReadDir</span><span class="op" id="7122157">(</span><span class="ident" id="7122158">testdata</span><span class="op" id="7122166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7122169">if</span>&nbsp;<span class="ident" id="7122172">err</span>&nbsp;<span class="op" id="7122176">!=</span>&nbsp;<span class="ident" id="7122179">nil</span>&nbsp;<span class="op" id="7122183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7122187">t</span><span class="op" id="7122188">.</span><span class="ident" id="7122189">Fatal</span><span class="op" id="7122194">(</span><span class="ident" id="7122195">err</span><span class="op" id="7122198">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7122201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7122204">for</span>&nbsp;<span class="ident" id="7122208">_</span><span class="op" id="7122209">,</span>&nbsp;<span class="ident" id="7122211">fi</span>&nbsp;<span class="op" id="7122214">:=</span>&nbsp;<span class="keyword" id="7122217">range</span>&nbsp;<span class="ident" id="7122223">list</span>&nbsp;<span class="op" id="7122228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7122232">name</span>&nbsp;<span class="op" id="7122237">:=</span>&nbsp;<span class="ident" id="7122240">fi</span><span class="op" id="7122242">.</span><span class="ident" id="7122243">Name</span><span class="op" id="7122247">(</span><span class="op" id="7122248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7122252">if</span>&nbsp;<span class="op" id="7122255">!</span><span class="ident" id="7122256">fi</span><span class="op" id="7122258">.</span><span class="ident" id="7122259">IsDir</span><span class="op" id="7122264">(</span><span class="op" id="7122265">)</span>&nbsp;<span class="op" id="7122267">&amp;&amp;</span>&nbsp;<span class="op" id="7122270">!</span><span class="ident" id="7122271">strings</span><span class="op" id="7122278">.</span><span class="ident" id="7122279">HasPrefix</span><span class="op" id="7122288">(</span><span class="ident" id="7122289">name</span><span class="op" id="7122293">,</span>&nbsp;<span class="string" id="7122295">&#34;.&#34;</span><span class="op" id="7122298">)</span>&nbsp;<span class="op" id="7122300">&amp;&amp;</span>&nbsp;<span class="ident" id="7122303">strings</span><span class="op" id="7122310">.</span><span class="ident" id="7122311">HasSuffix</span><span class="op" id="7122320">(</span><span class="ident" id="7122321">name</span><span class="op" id="7122325">,</span>&nbsp;<span class="string" id="7122327">&#34;.src&#34;</span><span class="op" id="7122333">)</span>&nbsp;<span class="op" id="7122335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7122340">checkErrors</span><span class="op" id="7122351">(</span><span class="ident" id="7122352">t</span><span class="op" id="7122353">,</span>&nbsp;<span class="ident" id="7122355">filepath</span><span class="op" id="7122363">.</span><span class="ident" id="7122364">Join</span><span class="op" id="7122368">(</span><span class="ident" id="7122369">testdata</span><span class="op" id="7122377">,</span>&nbsp;<span class="ident" id="7122379">name</span><span class="op" id="7122383">)</span><span class="op" id="7122384">,</span>&nbsp;<span class="ident" id="7122386">nil</span><span class="op" id="7122389">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7122393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7122396">}</span><br>
<span class="lineno"></span><span class="op" id="7122398">}</span>
</div>
</body>
</html>
