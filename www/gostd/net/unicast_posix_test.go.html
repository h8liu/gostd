<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6750344">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6750400">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6750454">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6750505">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6750523">package</span>&nbsp;<span class="ident" id="6750531">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6750536">import</span>&nbsp;<span class="op" id="6750543">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750546">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750557">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750568">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6750578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6750581">var</span>&nbsp;<span class="ident" id="6750585">listenerTests</span>&nbsp;<span class="op" id="6750599">=</span>&nbsp;<span class="op" id="6750601">[</span><span class="op" id="6750602">]</span><span class="keyword" id="6750603">struct</span>&nbsp;<span class="op" id="6750610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750613">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6750622">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750630">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6750639">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750647">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6750656">bool</span>&nbsp;<span class="comment" id="6750661">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750702">wildcard</span>&nbsp;<span class="builtintype" id="6750711">bool</span>&nbsp;<span class="comment" id="6750716">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="6750746">}</span><span class="op" id="6750747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750750">{</span><span class="ident" id="6750751">net</span><span class="op" id="6750754">:</span>&nbsp;<span class="string" id="6750756">&#34;tcp&#34;</span><span class="op" id="6750761">,</span>&nbsp;<span class="ident" id="6750763">laddr</span><span class="op" id="6750768">:</span>&nbsp;<span class="string" id="6750770">&#34;&#34;</span><span class="op" id="6750772">,</span>&nbsp;<span class="ident" id="6750774">wildcard</span><span class="op" id="6750782">:</span>&nbsp;<span class="builtintype" id="6750784">true</span><span class="op" id="6750788">}</span><span class="op" id="6750789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750792">{</span><span class="ident" id="6750793">net</span><span class="op" id="6750796">:</span>&nbsp;<span class="string" id="6750798">&#34;tcp&#34;</span><span class="op" id="6750803">,</span>&nbsp;<span class="ident" id="6750805">laddr</span><span class="op" id="6750810">:</span>&nbsp;<span class="string" id="6750812">&#34;0.0.0.0&#34;</span><span class="op" id="6750821">,</span>&nbsp;<span class="ident" id="6750823">wildcard</span><span class="op" id="6750831">:</span>&nbsp;<span class="builtintype" id="6750833">true</span><span class="op" id="6750837">}</span><span class="op" id="6750838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750841">{</span><span class="ident" id="6750842">net</span><span class="op" id="6750845">:</span>&nbsp;<span class="string" id="6750847">&#34;tcp&#34;</span><span class="op" id="6750852">,</span>&nbsp;<span class="ident" id="6750854">laddr</span><span class="op" id="6750859">:</span>&nbsp;<span class="string" id="6750861">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6750879">,</span>&nbsp;<span class="ident" id="6750881">wildcard</span><span class="op" id="6750889">:</span>&nbsp;<span class="builtintype" id="6750891">true</span><span class="op" id="6750895">}</span><span class="op" id="6750896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750899">{</span><span class="ident" id="6750900">net</span><span class="op" id="6750903">:</span>&nbsp;<span class="string" id="6750905">&#34;tcp&#34;</span><span class="op" id="6750910">,</span>&nbsp;<span class="ident" id="6750912">laddr</span><span class="op" id="6750917">:</span>&nbsp;<span class="string" id="6750919">&#34;[::]&#34;</span><span class="op" id="6750925">,</span>&nbsp;<span class="ident" id="6750927">ipv6</span><span class="op" id="6750931">:</span>&nbsp;<span class="builtintype" id="6750933">true</span><span class="op" id="6750937">,</span>&nbsp;<span class="ident" id="6750939">wildcard</span><span class="op" id="6750947">:</span>&nbsp;<span class="builtintype" id="6750949">true</span><span class="op" id="6750953">}</span><span class="op" id="6750954">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750958">{</span><span class="ident" id="6750959">net</span><span class="op" id="6750962">:</span>&nbsp;<span class="string" id="6750964">&#34;tcp&#34;</span><span class="op" id="6750969">,</span>&nbsp;<span class="ident" id="6750971">laddr</span><span class="op" id="6750976">:</span>&nbsp;<span class="string" id="6750978">&#34;127.0.0.1&#34;</span><span class="op" id="6750989">}</span><span class="op" id="6750990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750993">{</span><span class="ident" id="6750994">net</span><span class="op" id="6750997">:</span>&nbsp;<span class="string" id="6750999">&#34;tcp&#34;</span><span class="op" id="6751004">,</span>&nbsp;<span class="ident" id="6751006">laddr</span><span class="op" id="6751011">:</span>&nbsp;<span class="string" id="6751013">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6751033">}</span><span class="op" id="6751034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751037">{</span><span class="ident" id="6751038">net</span><span class="op" id="6751041">:</span>&nbsp;<span class="string" id="6751043">&#34;tcp&#34;</span><span class="op" id="6751048">,</span>&nbsp;<span class="ident" id="6751050">laddr</span><span class="op" id="6751055">:</span>&nbsp;<span class="string" id="6751057">&#34;[::1]&#34;</span><span class="op" id="6751064">,</span>&nbsp;<span class="ident" id="6751066">ipv6</span><span class="op" id="6751070">:</span>&nbsp;<span class="builtintype" id="6751072">true</span><span class="op" id="6751076">}</span><span class="op" id="6751077">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751081">{</span><span class="ident" id="6751082">net</span><span class="op" id="6751085">:</span>&nbsp;<span class="string" id="6751087">&#34;tcp4&#34;</span><span class="op" id="6751093">,</span>&nbsp;<span class="ident" id="6751095">laddr</span><span class="op" id="6751100">:</span>&nbsp;<span class="string" id="6751102">&#34;&#34;</span><span class="op" id="6751104">,</span>&nbsp;<span class="ident" id="6751106">wildcard</span><span class="op" id="6751114">:</span>&nbsp;<span class="builtintype" id="6751116">true</span><span class="op" id="6751120">}</span><span class="op" id="6751121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751124">{</span><span class="ident" id="6751125">net</span><span class="op" id="6751128">:</span>&nbsp;<span class="string" id="6751130">&#34;tcp4&#34;</span><span class="op" id="6751136">,</span>&nbsp;<span class="ident" id="6751138">laddr</span><span class="op" id="6751143">:</span>&nbsp;<span class="string" id="6751145">&#34;0.0.0.0&#34;</span><span class="op" id="6751154">,</span>&nbsp;<span class="ident" id="6751156">wildcard</span><span class="op" id="6751164">:</span>&nbsp;<span class="builtintype" id="6751166">true</span><span class="op" id="6751170">}</span><span class="op" id="6751171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751174">{</span><span class="ident" id="6751175">net</span><span class="op" id="6751178">:</span>&nbsp;<span class="string" id="6751180">&#34;tcp4&#34;</span><span class="op" id="6751186">,</span>&nbsp;<span class="ident" id="6751188">laddr</span><span class="op" id="6751193">:</span>&nbsp;<span class="string" id="6751195">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6751213">,</span>&nbsp;<span class="ident" id="6751215">wildcard</span><span class="op" id="6751223">:</span>&nbsp;<span class="builtintype" id="6751225">true</span><span class="op" id="6751229">}</span><span class="op" id="6751230">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751234">{</span><span class="ident" id="6751235">net</span><span class="op" id="6751238">:</span>&nbsp;<span class="string" id="6751240">&#34;tcp4&#34;</span><span class="op" id="6751246">,</span>&nbsp;<span class="ident" id="6751248">laddr</span><span class="op" id="6751253">:</span>&nbsp;<span class="string" id="6751255">&#34;127.0.0.1&#34;</span><span class="op" id="6751266">}</span><span class="op" id="6751267">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751270">{</span><span class="ident" id="6751271">net</span><span class="op" id="6751274">:</span>&nbsp;<span class="string" id="6751276">&#34;tcp4&#34;</span><span class="op" id="6751282">,</span>&nbsp;<span class="ident" id="6751284">laddr</span><span class="op" id="6751289">:</span>&nbsp;<span class="string" id="6751291">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6751311">}</span><span class="op" id="6751312">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751316">{</span><span class="ident" id="6751317">net</span><span class="op" id="6751320">:</span>&nbsp;<span class="string" id="6751322">&#34;tcp6&#34;</span><span class="op" id="6751328">,</span>&nbsp;<span class="ident" id="6751330">laddr</span><span class="op" id="6751335">:</span>&nbsp;<span class="string" id="6751337">&#34;&#34;</span><span class="op" id="6751339">,</span>&nbsp;<span class="ident" id="6751341">ipv6</span><span class="op" id="6751345">:</span>&nbsp;<span class="builtintype" id="6751347">true</span><span class="op" id="6751351">,</span>&nbsp;<span class="ident" id="6751353">wildcard</span><span class="op" id="6751361">:</span>&nbsp;<span class="builtintype" id="6751363">true</span><span class="op" id="6751367">}</span><span class="op" id="6751368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751371">{</span><span class="ident" id="6751372">net</span><span class="op" id="6751375">:</span>&nbsp;<span class="string" id="6751377">&#34;tcp6&#34;</span><span class="op" id="6751383">,</span>&nbsp;<span class="ident" id="6751385">laddr</span><span class="op" id="6751390">:</span>&nbsp;<span class="string" id="6751392">&#34;[::]&#34;</span><span class="op" id="6751398">,</span>&nbsp;<span class="ident" id="6751400">ipv6</span><span class="op" id="6751404">:</span>&nbsp;<span class="builtintype" id="6751406">true</span><span class="op" id="6751410">,</span>&nbsp;<span class="ident" id="6751412">wildcard</span><span class="op" id="6751420">:</span>&nbsp;<span class="builtintype" id="6751422">true</span><span class="op" id="6751426">}</span><span class="op" id="6751427">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751431">{</span><span class="ident" id="6751432">net</span><span class="op" id="6751435">:</span>&nbsp;<span class="string" id="6751437">&#34;tcp6&#34;</span><span class="op" id="6751443">,</span>&nbsp;<span class="ident" id="6751445">laddr</span><span class="op" id="6751450">:</span>&nbsp;<span class="string" id="6751452">&#34;[::1]&#34;</span><span class="op" id="6751459">,</span>&nbsp;<span class="ident" id="6751461">ipv6</span><span class="op" id="6751465">:</span>&nbsp;<span class="builtintype" id="6751467">true</span><span class="op" id="6751471">}</span><span class="op" id="6751472">,</span><br>
<span class="lineno"></span><span class="op" id="6751474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6751477">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6751542">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="6751607">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6751621">func</span>&nbsp;<span class="ident" id="6751626">TestTCPListener</span><span class="op" id="6751641">(</span><span class="ident" id="6751642">t</span>&nbsp;<span class="op" id="6751644">*</span><span class="ident" id="6751645">testing</span><span class="op" id="6751652">.</span><span class="ident" id="6751653">T</span><span class="op" id="6751654">)</span>&nbsp;<span class="op" id="6751656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751659">switch</span>&nbsp;<span class="ident" id="6751666">runtime</span><span class="op" id="6751673">.</span><span class="ident" id="6751674">GOOS</span>&nbsp;<span class="op" id="6751679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751682">case</span>&nbsp;<span class="string" id="6751687">&#34;plan9&#34;</span><span class="op" id="6751694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751698">t</span><span class="op" id="6751699">.</span><span class="ident" id="6751700">Skipf</span><span class="op" id="6751705">(</span><span class="string" id="6751706">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6751727">,</span>&nbsp;<span class="ident" id="6751729">runtime</span><span class="op" id="6751736">.</span><span class="ident" id="6751737">GOOS</span><span class="op" id="6751741">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751748">for</span>&nbsp;<span class="ident" id="6751752">_</span><span class="op" id="6751753">,</span>&nbsp;<span class="ident" id="6751755">tt</span>&nbsp;<span class="op" id="6751758">:=</span>&nbsp;<span class="keyword" id="6751761">range</span>&nbsp;<span class="ident" id="6751767">listenerTests</span>&nbsp;<span class="op" id="6751781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751785">if</span>&nbsp;<span class="ident" id="6751788">tt</span><span class="op" id="6751790">.</span><span class="ident" id="6751791">wildcard</span>&nbsp;<span class="op" id="6751800">&amp;&amp;</span>&nbsp;<span class="op" id="6751803">(</span><span class="ident" id="6751804">testing</span><span class="op" id="6751811">.</span><span class="ident" id="6751812">Short</span><span class="op" id="6751817">(</span><span class="op" id="6751818">)</span>&nbsp;<span class="op" id="6751820">||</span>&nbsp;<span class="op" id="6751823">!</span><span class="op" id="6751824">*</span><span class="ident" id="6751825">testExternal</span><span class="op" id="6751837">)</span>&nbsp;<span class="op" id="6751839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751844">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751859">if</span>&nbsp;<span class="ident" id="6751862">tt</span><span class="op" id="6751864">.</span><span class="ident" id="6751865">ipv6</span>&nbsp;<span class="op" id="6751870">&amp;&amp;</span>&nbsp;<span class="op" id="6751873">!</span><span class="ident" id="6751874">supportsIPv6</span>&nbsp;<span class="op" id="6751887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6751892">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6751903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751907">l1</span><span class="op" id="6751909">,</span>&nbsp;<span class="ident" id="6751911">port</span>&nbsp;<span class="op" id="6751916">:=</span>&nbsp;<span class="ident" id="6751919">usableListenPort</span><span class="op" id="6751935">(</span><span class="ident" id="6751936">t</span><span class="op" id="6751937">,</span>&nbsp;<span class="ident" id="6751939">tt</span><span class="op" id="6751941">.</span><span class="ident" id="6751942">net</span><span class="op" id="6751945">,</span>&nbsp;<span class="ident" id="6751947">tt</span><span class="op" id="6751949">.</span><span class="ident" id="6751950">laddr</span><span class="op" id="6751955">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6751959">checkFirstListener</span><span class="op" id="6751977">(</span><span class="ident" id="6751978">t</span><span class="op" id="6751979">,</span>&nbsp;<span class="ident" id="6751981">tt</span><span class="op" id="6751983">.</span><span class="ident" id="6751984">net</span><span class="op" id="6751987">,</span>&nbsp;<span class="ident" id="6751989">tt</span><span class="op" id="6751991">.</span><span class="ident" id="6751992">laddr</span><span class="op" id="6751997">+</span><span class="string" id="6751998">&#34;:&#34;</span><span class="op" id="6752001">+</span><span class="ident" id="6752002">port</span><span class="op" id="6752006">,</span>&nbsp;<span class="ident" id="6752008">l1</span><span class="op" id="6752010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752014">l2</span><span class="op" id="6752016">,</span>&nbsp;<span class="ident" id="6752018">err</span>&nbsp;<span class="op" id="6752022">:=</span>&nbsp;<span class="ident" id="6752025">Listen</span><span class="op" id="6752031">(</span><span class="ident" id="6752032">tt</span><span class="op" id="6752034">.</span><span class="ident" id="6752035">net</span><span class="op" id="6752038">,</span>&nbsp;<span class="ident" id="6752040">tt</span><span class="op" id="6752042">.</span><span class="ident" id="6752043">laddr</span><span class="op" id="6752048">+</span><span class="string" id="6752049">&#34;:&#34;</span><span class="op" id="6752052">+</span><span class="ident" id="6752053">port</span><span class="op" id="6752057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752061">checkSecondListener</span><span class="op" id="6752080">(</span><span class="ident" id="6752081">t</span><span class="op" id="6752082">,</span>&nbsp;<span class="ident" id="6752084">tt</span><span class="op" id="6752086">.</span><span class="ident" id="6752087">net</span><span class="op" id="6752090">,</span>&nbsp;<span class="ident" id="6752092">tt</span><span class="op" id="6752094">.</span><span class="ident" id="6752095">laddr</span><span class="op" id="6752100">+</span><span class="string" id="6752101">&#34;:&#34;</span><span class="op" id="6752104">+</span><span class="ident" id="6752105">port</span><span class="op" id="6752109">,</span>&nbsp;<span class="ident" id="6752111">err</span><span class="op" id="6752114">,</span>&nbsp;<span class="ident" id="6752116">l2</span><span class="op" id="6752118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752122">l1</span><span class="op" id="6752124">.</span><span class="ident" id="6752125">Close</span><span class="op" id="6752130">(</span><span class="op" id="6752131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752134">}</span><br>
<span class="lineno">65</span><span class="op" id="6752136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6752139">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6752204">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6752269">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="6752283">func</span>&nbsp;<span class="ident" id="6752288">TestUDPListener</span><span class="op" id="6752303">(</span><span class="ident" id="6752304">t</span>&nbsp;<span class="op" id="6752306">*</span><span class="ident" id="6752307">testing</span><span class="op" id="6752314">.</span><span class="ident" id="6752315">T</span><span class="op" id="6752316">)</span>&nbsp;<span class="op" id="6752318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752321">switch</span>&nbsp;<span class="ident" id="6752328">runtime</span><span class="op" id="6752335">.</span><span class="ident" id="6752336">GOOS</span>&nbsp;<span class="op" id="6752341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752344">case</span>&nbsp;<span class="string" id="6752349">&#34;plan9&#34;</span><span class="op" id="6752356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752360">t</span><span class="op" id="6752361">.</span><span class="ident" id="6752362">Skipf</span><span class="op" id="6752367">(</span><span class="string" id="6752368">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6752389">,</span>&nbsp;<span class="ident" id="6752391">runtime</span><span class="op" id="6752398">.</span><span class="ident" id="6752399">GOOS</span><span class="op" id="6752403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752406">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752410">toudpnet</span>&nbsp;<span class="op" id="6752419">:=</span>&nbsp;<span class="keyword" id="6752422">func</span><span class="op" id="6752426">(</span><span class="ident" id="6752427">net</span>&nbsp;<span class="builtintype" id="6752431">string</span><span class="op" id="6752437">)</span>&nbsp;<span class="builtintype" id="6752439">string</span>&nbsp;<span class="op" id="6752446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752450">switch</span>&nbsp;<span class="ident" id="6752457">net</span>&nbsp;<span class="op" id="6752461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752465">case</span>&nbsp;<span class="string" id="6752470">&#34;tcp&#34;</span><span class="op" id="6752475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752480">return</span>&nbsp;<span class="string" id="6752487">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752495">case</span>&nbsp;<span class="string" id="6752500">&#34;tcp4&#34;</span><span class="op" id="6752506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752511">return</span>&nbsp;<span class="string" id="6752518">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752527">case</span>&nbsp;<span class="string" id="6752532">&#34;tcp6&#34;</span><span class="op" id="6752538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752543">return</span>&nbsp;<span class="string" id="6752550">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752559">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752563">return</span>&nbsp;<span class="string" id="6752570">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752583">for</span>&nbsp;<span class="ident" id="6752587">_</span><span class="op" id="6752588">,</span>&nbsp;<span class="ident" id="6752590">tt</span>&nbsp;<span class="op" id="6752593">:=</span>&nbsp;<span class="keyword" id="6752596">range</span>&nbsp;<span class="ident" id="6752602">listenerTests</span>&nbsp;<span class="op" id="6752616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752620">if</span>&nbsp;<span class="ident" id="6752623">tt</span><span class="op" id="6752625">.</span><span class="ident" id="6752626">wildcard</span>&nbsp;<span class="op" id="6752635">&amp;&amp;</span>&nbsp;<span class="op" id="6752638">(</span><span class="ident" id="6752639">testing</span><span class="op" id="6752646">.</span><span class="ident" id="6752647">Short</span><span class="op" id="6752652">(</span><span class="op" id="6752653">)</span>&nbsp;<span class="op" id="6752655">||</span>&nbsp;<span class="op" id="6752658">!</span><span class="op" id="6752659">*</span><span class="ident" id="6752660">testExternal</span><span class="op" id="6752672">)</span>&nbsp;<span class="op" id="6752674">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752679">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752694">if</span>&nbsp;<span class="ident" id="6752697">tt</span><span class="op" id="6752699">.</span><span class="ident" id="6752700">ipv6</span>&nbsp;<span class="op" id="6752705">&amp;&amp;</span>&nbsp;<span class="op" id="6752708">!</span><span class="ident" id="6752709">supportsIPv6</span>&nbsp;<span class="op" id="6752722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6752727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6752738">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752742">tt</span><span class="op" id="6752744">.</span><span class="ident" id="6752745">net</span>&nbsp;<span class="op" id="6752749">=</span>&nbsp;<span class="ident" id="6752751">toudpnet</span><span class="op" id="6752759">(</span><span class="ident" id="6752760">tt</span><span class="op" id="6752762">.</span><span class="ident" id="6752763">net</span><span class="op" id="6752766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752770">l1</span><span class="op" id="6752772">,</span>&nbsp;<span class="ident" id="6752774">port</span>&nbsp;<span class="op" id="6752779">:=</span>&nbsp;<span class="ident" id="6752782">usableListenPacketPort</span><span class="op" id="6752804">(</span><span class="ident" id="6752805">t</span><span class="op" id="6752806">,</span>&nbsp;<span class="ident" id="6752808">tt</span><span class="op" id="6752810">.</span><span class="ident" id="6752811">net</span><span class="op" id="6752814">,</span>&nbsp;<span class="ident" id="6752816">tt</span><span class="op" id="6752818">.</span><span class="ident" id="6752819">laddr</span><span class="op" id="6752824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752828">checkFirstListener</span><span class="op" id="6752846">(</span><span class="ident" id="6752847">t</span><span class="op" id="6752848">,</span>&nbsp;<span class="ident" id="6752850">tt</span><span class="op" id="6752852">.</span><span class="ident" id="6752853">net</span><span class="op" id="6752856">,</span>&nbsp;<span class="ident" id="6752858">tt</span><span class="op" id="6752860">.</span><span class="ident" id="6752861">laddr</span><span class="op" id="6752866">+</span><span class="string" id="6752867">&#34;:&#34;</span><span class="op" id="6752870">+</span><span class="ident" id="6752871">port</span><span class="op" id="6752875">,</span>&nbsp;<span class="ident" id="6752877">l1</span><span class="op" id="6752879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752883">l2</span><span class="op" id="6752885">,</span>&nbsp;<span class="ident" id="6752887">err</span>&nbsp;<span class="op" id="6752891">:=</span>&nbsp;<span class="ident" id="6752894">ListenPacket</span><span class="op" id="6752906">(</span><span class="ident" id="6752907">tt</span><span class="op" id="6752909">.</span><span class="ident" id="6752910">net</span><span class="op" id="6752913">,</span>&nbsp;<span class="ident" id="6752915">tt</span><span class="op" id="6752917">.</span><span class="ident" id="6752918">laddr</span><span class="op" id="6752923">+</span><span class="string" id="6752924">&#34;:&#34;</span><span class="op" id="6752927">+</span><span class="ident" id="6752928">port</span><span class="op" id="6752932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752936">checkSecondListener</span><span class="op" id="6752955">(</span><span class="ident" id="6752956">t</span><span class="op" id="6752957">,</span>&nbsp;<span class="ident" id="6752959">tt</span><span class="op" id="6752961">.</span><span class="ident" id="6752962">net</span><span class="op" id="6752965">,</span>&nbsp;<span class="ident" id="6752967">tt</span><span class="op" id="6752969">.</span><span class="ident" id="6752970">laddr</span><span class="op" id="6752975">+</span><span class="string" id="6752976">&#34;:&#34;</span><span class="op" id="6752979">+</span><span class="ident" id="6752980">port</span><span class="op" id="6752984">,</span>&nbsp;<span class="ident" id="6752986">err</span><span class="op" id="6752989">,</span>&nbsp;<span class="ident" id="6752991">l2</span><span class="op" id="6752993">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6752997">l1</span><span class="op" id="6752999">.</span><span class="ident" id="6753000">Close</span><span class="op" id="6753005">(</span><span class="op" id="6753006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6753009">}</span><br>
<span class="lineno"></span><span class="op" id="6753011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6753014">var</span>&nbsp;<span class="ident" id="6753018">dualStackListenerTests</span>&nbsp;<span class="op" id="6753041">=</span>&nbsp;<span class="op" id="6753043">[</span><span class="op" id="6753044">]</span><span class="keyword" id="6753045">struct</span>&nbsp;<span class="op" id="6753052">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753055">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6753064">string</span>&nbsp;<span class="comment" id="6753071">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753090">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6753099">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753107">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6753116">string</span>&nbsp;<span class="comment" id="6753123">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753143">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6753152">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753160">wildcard</span>&nbsp;<span class="builtintype" id="6753169">bool</span>&nbsp;&nbsp;<span class="comment" id="6753175">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6753206">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6753215">error</span>&nbsp;<span class="comment" id="6753221">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="6753259">}</span><span class="op" id="6753260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753263">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753345">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753434">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753523">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753609">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753695">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753781">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753870">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6753957">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754044">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754131">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754218">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754305">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754392">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754481">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754568">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754655">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754742">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754829">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6754918">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755005">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755092">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755179">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755266">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755270">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755307">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755341">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755414">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755446">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755519">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755551">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755623">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6755655">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755710">{</span><span class="ident" id="6755711">net1</span><span class="op" id="6755715">:</span>&nbsp;<span class="string" id="6755717">&#34;tcp&#34;</span><span class="op" id="6755722">,</span>&nbsp;<span class="ident" id="6755724">laddr1</span><span class="op" id="6755730">:</span>&nbsp;<span class="string" id="6755732">&#34;&#34;</span><span class="op" id="6755734">,</span>&nbsp;<span class="ident" id="6755736">net2</span><span class="op" id="6755740">:</span>&nbsp;<span class="string" id="6755742">&#34;tcp&#34;</span><span class="op" id="6755747">,</span>&nbsp;<span class="ident" id="6755749">laddr2</span><span class="op" id="6755755">:</span>&nbsp;<span class="string" id="6755757">&#34;&#34;</span><span class="op" id="6755759">,</span>&nbsp;<span class="ident" id="6755761">wildcard</span><span class="op" id="6755769">:</span>&nbsp;<span class="builtintype" id="6755771">true</span><span class="op" id="6755775">,</span>&nbsp;<span class="ident" id="6755777">xerr</span><span class="op" id="6755781">:</span>&nbsp;<span class="ident" id="6755783">syscall</span><span class="op" id="6755790">.</span><span class="ident" id="6755791">EADDRINUSE</span><span class="op" id="6755801">}</span><span class="op" id="6755802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755805">{</span><span class="ident" id="6755806">net1</span><span class="op" id="6755810">:</span>&nbsp;<span class="string" id="6755812">&#34;tcp&#34;</span><span class="op" id="6755817">,</span>&nbsp;<span class="ident" id="6755819">laddr1</span><span class="op" id="6755825">:</span>&nbsp;<span class="string" id="6755827">&#34;&#34;</span><span class="op" id="6755829">,</span>&nbsp;<span class="ident" id="6755831">net2</span><span class="op" id="6755835">:</span>&nbsp;<span class="string" id="6755837">&#34;tcp&#34;</span><span class="op" id="6755842">,</span>&nbsp;<span class="ident" id="6755844">laddr2</span><span class="op" id="6755850">:</span>&nbsp;<span class="string" id="6755852">&#34;0.0.0.0&#34;</span><span class="op" id="6755861">,</span>&nbsp;<span class="ident" id="6755863">wildcard</span><span class="op" id="6755871">:</span>&nbsp;<span class="builtintype" id="6755873">true</span><span class="op" id="6755877">,</span>&nbsp;<span class="ident" id="6755879">xerr</span><span class="op" id="6755883">:</span>&nbsp;<span class="ident" id="6755885">syscall</span><span class="op" id="6755892">.</span><span class="ident" id="6755893">EADDRINUSE</span><span class="op" id="6755903">}</span><span class="op" id="6755904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6755907">{</span><span class="ident" id="6755908">net1</span><span class="op" id="6755912">:</span>&nbsp;<span class="string" id="6755914">&#34;tcp&#34;</span><span class="op" id="6755919">,</span>&nbsp;<span class="ident" id="6755921">laddr1</span><span class="op" id="6755927">:</span>&nbsp;<span class="string" id="6755929">&#34;0.0.0.0&#34;</span><span class="op" id="6755938">,</span>&nbsp;<span class="ident" id="6755940">net2</span><span class="op" id="6755944">:</span>&nbsp;<span class="string" id="6755946">&#34;tcp&#34;</span><span class="op" id="6755951">,</span>&nbsp;<span class="ident" id="6755953">laddr2</span><span class="op" id="6755959">:</span>&nbsp;<span class="string" id="6755961">&#34;&#34;</span><span class="op" id="6755963">,</span>&nbsp;<span class="ident" id="6755965">wildcard</span><span class="op" id="6755973">:</span>&nbsp;<span class="builtintype" id="6755975">true</span><span class="op" id="6755979">,</span>&nbsp;<span class="ident" id="6755981">xerr</span><span class="op" id="6755985">:</span>&nbsp;<span class="ident" id="6755987">syscall</span><span class="op" id="6755994">.</span><span class="ident" id="6755995">EADDRINUSE</span><span class="op" id="6756005">}</span><span class="op" id="6756006">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756010">{</span><span class="ident" id="6756011">net1</span><span class="op" id="6756015">:</span>&nbsp;<span class="string" id="6756017">&#34;tcp&#34;</span><span class="op" id="6756022">,</span>&nbsp;<span class="ident" id="6756024">laddr1</span><span class="op" id="6756030">:</span>&nbsp;<span class="string" id="6756032">&#34;&#34;</span><span class="op" id="6756034">,</span>&nbsp;<span class="ident" id="6756036">net2</span><span class="op" id="6756040">:</span>&nbsp;<span class="string" id="6756042">&#34;tcp&#34;</span><span class="op" id="6756047">,</span>&nbsp;<span class="ident" id="6756049">laddr2</span><span class="op" id="6756055">:</span>&nbsp;<span class="string" id="6756057">&#34;[::]&#34;</span><span class="op" id="6756063">,</span>&nbsp;<span class="ident" id="6756065">wildcard</span><span class="op" id="6756073">:</span>&nbsp;<span class="builtintype" id="6756075">true</span><span class="op" id="6756079">,</span>&nbsp;<span class="ident" id="6756081">xerr</span><span class="op" id="6756085">:</span>&nbsp;<span class="ident" id="6756087">syscall</span><span class="op" id="6756094">.</span><span class="ident" id="6756095">EADDRINUSE</span><span class="op" id="6756105">}</span><span class="op" id="6756106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756109">{</span><span class="ident" id="6756110">net1</span><span class="op" id="6756114">:</span>&nbsp;<span class="string" id="6756116">&#34;tcp&#34;</span><span class="op" id="6756121">,</span>&nbsp;<span class="ident" id="6756123">laddr1</span><span class="op" id="6756129">:</span>&nbsp;<span class="string" id="6756131">&#34;[::]&#34;</span><span class="op" id="6756137">,</span>&nbsp;<span class="ident" id="6756139">net2</span><span class="op" id="6756143">:</span>&nbsp;<span class="string" id="6756145">&#34;tcp&#34;</span><span class="op" id="6756150">,</span>&nbsp;<span class="ident" id="6756152">laddr2</span><span class="op" id="6756158">:</span>&nbsp;<span class="string" id="6756160">&#34;&#34;</span><span class="op" id="6756162">,</span>&nbsp;<span class="ident" id="6756164">wildcard</span><span class="op" id="6756172">:</span>&nbsp;<span class="builtintype" id="6756174">true</span><span class="op" id="6756178">,</span>&nbsp;<span class="ident" id="6756180">xerr</span><span class="op" id="6756184">:</span>&nbsp;<span class="ident" id="6756186">syscall</span><span class="op" id="6756193">.</span><span class="ident" id="6756194">EADDRINUSE</span><span class="op" id="6756204">}</span><span class="op" id="6756205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756208">{</span><span class="ident" id="6756209">net1</span><span class="op" id="6756213">:</span>&nbsp;<span class="string" id="6756215">&#34;tcp&#34;</span><span class="op" id="6756220">,</span>&nbsp;<span class="ident" id="6756222">laddr1</span><span class="op" id="6756228">:</span>&nbsp;<span class="string" id="6756230">&#34;0.0.0.0&#34;</span><span class="op" id="6756239">,</span>&nbsp;<span class="ident" id="6756241">net2</span><span class="op" id="6756245">:</span>&nbsp;<span class="string" id="6756247">&#34;tcp&#34;</span><span class="op" id="6756252">,</span>&nbsp;<span class="ident" id="6756254">laddr2</span><span class="op" id="6756260">:</span>&nbsp;<span class="string" id="6756262">&#34;[::]&#34;</span><span class="op" id="6756268">,</span>&nbsp;<span class="ident" id="6756270">wildcard</span><span class="op" id="6756278">:</span>&nbsp;<span class="builtintype" id="6756280">true</span><span class="op" id="6756284">,</span>&nbsp;<span class="ident" id="6756286">xerr</span><span class="op" id="6756290">:</span>&nbsp;<span class="ident" id="6756292">syscall</span><span class="op" id="6756299">.</span><span class="ident" id="6756300">EADDRINUSE</span><span class="op" id="6756310">}</span><span class="op" id="6756311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756314">{</span><span class="ident" id="6756315">net1</span><span class="op" id="6756319">:</span>&nbsp;<span class="string" id="6756321">&#34;tcp&#34;</span><span class="op" id="6756326">,</span>&nbsp;<span class="ident" id="6756328">laddr1</span><span class="op" id="6756334">:</span>&nbsp;<span class="string" id="6756336">&#34;[::]&#34;</span><span class="op" id="6756342">,</span>&nbsp;<span class="ident" id="6756344">net2</span><span class="op" id="6756348">:</span>&nbsp;<span class="string" id="6756350">&#34;tcp&#34;</span><span class="op" id="6756355">,</span>&nbsp;<span class="ident" id="6756357">laddr2</span><span class="op" id="6756363">:</span>&nbsp;<span class="string" id="6756365">&#34;0.0.0.0&#34;</span><span class="op" id="6756374">,</span>&nbsp;<span class="ident" id="6756376">wildcard</span><span class="op" id="6756384">:</span>&nbsp;<span class="builtintype" id="6756386">true</span><span class="op" id="6756390">,</span>&nbsp;<span class="ident" id="6756392">xerr</span><span class="op" id="6756396">:</span>&nbsp;<span class="ident" id="6756398">syscall</span><span class="op" id="6756405">.</span><span class="ident" id="6756406">EADDRINUSE</span><span class="op" id="6756416">}</span><span class="op" id="6756417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756420">{</span><span class="ident" id="6756421">net1</span><span class="op" id="6756425">:</span>&nbsp;<span class="string" id="6756427">&#34;tcp&#34;</span><span class="op" id="6756432">,</span>&nbsp;<span class="ident" id="6756434">laddr1</span><span class="op" id="6756440">:</span>&nbsp;<span class="string" id="6756442">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6756460">,</span>&nbsp;<span class="ident" id="6756462">net2</span><span class="op" id="6756466">:</span>&nbsp;<span class="string" id="6756468">&#34;tcp&#34;</span><span class="op" id="6756473">,</span>&nbsp;<span class="ident" id="6756475">laddr2</span><span class="op" id="6756481">:</span>&nbsp;<span class="string" id="6756483">&#34;[::]&#34;</span><span class="op" id="6756489">,</span>&nbsp;<span class="ident" id="6756491">wildcard</span><span class="op" id="6756499">:</span>&nbsp;<span class="builtintype" id="6756501">true</span><span class="op" id="6756505">,</span>&nbsp;<span class="ident" id="6756507">xerr</span><span class="op" id="6756511">:</span>&nbsp;<span class="ident" id="6756513">syscall</span><span class="op" id="6756520">.</span><span class="ident" id="6756521">EADDRINUSE</span><span class="op" id="6756531">}</span><span class="op" id="6756532">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756535">{</span><span class="ident" id="6756536">net1</span><span class="op" id="6756540">:</span>&nbsp;<span class="string" id="6756542">&#34;tcp&#34;</span><span class="op" id="6756547">,</span>&nbsp;<span class="ident" id="6756549">laddr1</span><span class="op" id="6756555">:</span>&nbsp;<span class="string" id="6756557">&#34;[::]&#34;</span><span class="op" id="6756563">,</span>&nbsp;<span class="ident" id="6756565">net2</span><span class="op" id="6756569">:</span>&nbsp;<span class="string" id="6756571">&#34;tcp&#34;</span><span class="op" id="6756576">,</span>&nbsp;<span class="ident" id="6756578">laddr2</span><span class="op" id="6756584">:</span>&nbsp;<span class="string" id="6756586">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6756604">,</span>&nbsp;<span class="ident" id="6756606">wildcard</span><span class="op" id="6756614">:</span>&nbsp;<span class="builtintype" id="6756616">true</span><span class="op" id="6756620">,</span>&nbsp;<span class="ident" id="6756622">xerr</span><span class="op" id="6756626">:</span>&nbsp;<span class="ident" id="6756628">syscall</span><span class="op" id="6756635">.</span><span class="ident" id="6756636">EADDRINUSE</span><span class="op" id="6756646">}</span><span class="op" id="6756647">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756651">{</span><span class="ident" id="6756652">net1</span><span class="op" id="6756656">:</span>&nbsp;<span class="string" id="6756658">&#34;tcp4&#34;</span><span class="op" id="6756664">,</span>&nbsp;<span class="ident" id="6756666">laddr1</span><span class="op" id="6756672">:</span>&nbsp;<span class="string" id="6756674">&#34;&#34;</span><span class="op" id="6756676">,</span>&nbsp;<span class="ident" id="6756678">net2</span><span class="op" id="6756682">:</span>&nbsp;<span class="string" id="6756684">&#34;tcp6&#34;</span><span class="op" id="6756690">,</span>&nbsp;<span class="ident" id="6756692">laddr2</span><span class="op" id="6756698">:</span>&nbsp;<span class="string" id="6756700">&#34;&#34;</span><span class="op" id="6756702">,</span>&nbsp;<span class="ident" id="6756704">wildcard</span><span class="op" id="6756712">:</span>&nbsp;<span class="builtintype" id="6756714">true</span><span class="op" id="6756718">}</span><span class="op" id="6756719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756722">{</span><span class="ident" id="6756723">net1</span><span class="op" id="6756727">:</span>&nbsp;<span class="string" id="6756729">&#34;tcp6&#34;</span><span class="op" id="6756735">,</span>&nbsp;<span class="ident" id="6756737">laddr1</span><span class="op" id="6756743">:</span>&nbsp;<span class="string" id="6756745">&#34;&#34;</span><span class="op" id="6756747">,</span>&nbsp;<span class="ident" id="6756749">net2</span><span class="op" id="6756753">:</span>&nbsp;<span class="string" id="6756755">&#34;tcp4&#34;</span><span class="op" id="6756761">,</span>&nbsp;<span class="ident" id="6756763">laddr2</span><span class="op" id="6756769">:</span>&nbsp;<span class="string" id="6756771">&#34;&#34;</span><span class="op" id="6756773">,</span>&nbsp;<span class="ident" id="6756775">wildcard</span><span class="op" id="6756783">:</span>&nbsp;<span class="builtintype" id="6756785">true</span><span class="op" id="6756789">}</span><span class="op" id="6756790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756793">{</span><span class="ident" id="6756794">net1</span><span class="op" id="6756798">:</span>&nbsp;<span class="string" id="6756800">&#34;tcp4&#34;</span><span class="op" id="6756806">,</span>&nbsp;<span class="ident" id="6756808">laddr1</span><span class="op" id="6756814">:</span>&nbsp;<span class="string" id="6756816">&#34;0.0.0.0&#34;</span><span class="op" id="6756825">,</span>&nbsp;<span class="ident" id="6756827">net2</span><span class="op" id="6756831">:</span>&nbsp;<span class="string" id="6756833">&#34;tcp6&#34;</span><span class="op" id="6756839">,</span>&nbsp;<span class="ident" id="6756841">laddr2</span><span class="op" id="6756847">:</span>&nbsp;<span class="string" id="6756849">&#34;[::]&#34;</span><span class="op" id="6756855">,</span>&nbsp;<span class="ident" id="6756857">wildcard</span><span class="op" id="6756865">:</span>&nbsp;<span class="builtintype" id="6756867">true</span><span class="op" id="6756871">}</span><span class="op" id="6756872">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756875">{</span><span class="ident" id="6756876">net1</span><span class="op" id="6756880">:</span>&nbsp;<span class="string" id="6756882">&#34;tcp6&#34;</span><span class="op" id="6756888">,</span>&nbsp;<span class="ident" id="6756890">laddr1</span><span class="op" id="6756896">:</span>&nbsp;<span class="string" id="6756898">&#34;[::]&#34;</span><span class="op" id="6756904">,</span>&nbsp;<span class="ident" id="6756906">net2</span><span class="op" id="6756910">:</span>&nbsp;<span class="string" id="6756912">&#34;tcp4&#34;</span><span class="op" id="6756918">,</span>&nbsp;<span class="ident" id="6756920">laddr2</span><span class="op" id="6756926">:</span>&nbsp;<span class="string" id="6756928">&#34;0.0.0.0&#34;</span><span class="op" id="6756937">,</span>&nbsp;<span class="ident" id="6756939">wildcard</span><span class="op" id="6756947">:</span>&nbsp;<span class="builtintype" id="6756949">true</span><span class="op" id="6756953">}</span><span class="op" id="6756954">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6756958">{</span><span class="ident" id="6756959">net1</span><span class="op" id="6756963">:</span>&nbsp;<span class="string" id="6756965">&#34;tcp&#34;</span><span class="op" id="6756970">,</span>&nbsp;<span class="ident" id="6756972">laddr1</span><span class="op" id="6756978">:</span>&nbsp;<span class="string" id="6756980">&#34;127.0.0.1&#34;</span><span class="op" id="6756991">,</span>&nbsp;<span class="ident" id="6756993">net2</span><span class="op" id="6756997">:</span>&nbsp;<span class="string" id="6756999">&#34;tcp&#34;</span><span class="op" id="6757004">,</span>&nbsp;<span class="ident" id="6757006">laddr2</span><span class="op" id="6757012">:</span>&nbsp;<span class="string" id="6757014">&#34;[::1]&#34;</span><span class="op" id="6757021">}</span><span class="op" id="6757022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757025">{</span><span class="ident" id="6757026">net1</span><span class="op" id="6757030">:</span>&nbsp;<span class="string" id="6757032">&#34;tcp&#34;</span><span class="op" id="6757037">,</span>&nbsp;<span class="ident" id="6757039">laddr1</span><span class="op" id="6757045">:</span>&nbsp;<span class="string" id="6757047">&#34;[::1]&#34;</span><span class="op" id="6757054">,</span>&nbsp;<span class="ident" id="6757056">net2</span><span class="op" id="6757060">:</span>&nbsp;<span class="string" id="6757062">&#34;tcp&#34;</span><span class="op" id="6757067">,</span>&nbsp;<span class="ident" id="6757069">laddr2</span><span class="op" id="6757075">:</span>&nbsp;<span class="string" id="6757077">&#34;127.0.0.1&#34;</span><span class="op" id="6757088">}</span><span class="op" id="6757089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757092">{</span><span class="ident" id="6757093">net1</span><span class="op" id="6757097">:</span>&nbsp;<span class="string" id="6757099">&#34;tcp4&#34;</span><span class="op" id="6757105">,</span>&nbsp;<span class="ident" id="6757107">laddr1</span><span class="op" id="6757113">:</span>&nbsp;<span class="string" id="6757115">&#34;127.0.0.1&#34;</span><span class="op" id="6757126">,</span>&nbsp;<span class="ident" id="6757128">net2</span><span class="op" id="6757132">:</span>&nbsp;<span class="string" id="6757134">&#34;tcp6&#34;</span><span class="op" id="6757140">,</span>&nbsp;<span class="ident" id="6757142">laddr2</span><span class="op" id="6757148">:</span>&nbsp;<span class="string" id="6757150">&#34;[::1]&#34;</span><span class="op" id="6757157">}</span><span class="op" id="6757158">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757161">{</span><span class="ident" id="6757162">net1</span><span class="op" id="6757166">:</span>&nbsp;<span class="string" id="6757168">&#34;tcp6&#34;</span><span class="op" id="6757174">,</span>&nbsp;<span class="ident" id="6757176">laddr1</span><span class="op" id="6757182">:</span>&nbsp;<span class="string" id="6757184">&#34;[::1]&#34;</span><span class="op" id="6757191">,</span>&nbsp;<span class="ident" id="6757193">net2</span><span class="op" id="6757197">:</span>&nbsp;<span class="string" id="6757199">&#34;tcp4&#34;</span><span class="op" id="6757205">,</span>&nbsp;<span class="ident" id="6757207">laddr2</span><span class="op" id="6757213">:</span>&nbsp;<span class="string" id="6757215">&#34;127.0.0.1&#34;</span><span class="op" id="6757226">}</span><span class="op" id="6757227">,</span><br>
<span class="lineno"></span><span class="op" id="6757229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6757232">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6757296">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="6757359">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6757395">func</span>&nbsp;<span class="ident" id="6757400">TestDualStackTCPListener</span><span class="op" id="6757424">(</span><span class="ident" id="6757425">t</span>&nbsp;<span class="op" id="6757427">*</span><span class="ident" id="6757428">testing</span><span class="op" id="6757435">.</span><span class="ident" id="6757436">T</span><span class="op" id="6757437">)</span>&nbsp;<span class="op" id="6757439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757442">if</span>&nbsp;<span class="ident" id="6757445">testing</span><span class="op" id="6757452">.</span><span class="ident" id="6757453">Short</span><span class="op" id="6757458">(</span><span class="op" id="6757459">)</span>&nbsp;<span class="op" id="6757461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757465">t</span><span class="op" id="6757466">.</span><span class="ident" id="6757467">Skip</span><span class="op" id="6757471">(</span><span class="string" id="6757472">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6757513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757516">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757519">switch</span>&nbsp;<span class="ident" id="6757526">runtime</span><span class="op" id="6757533">.</span><span class="ident" id="6757534">GOOS</span>&nbsp;<span class="op" id="6757539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757542">case</span>&nbsp;<span class="string" id="6757547">&#34;plan9&#34;</span><span class="op" id="6757554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757558">t</span><span class="op" id="6757559">.</span><span class="ident" id="6757560">Skipf</span><span class="op" id="6757565">(</span><span class="string" id="6757566">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6757587">,</span>&nbsp;<span class="ident" id="6757589">runtime</span><span class="op" id="6757596">.</span><span class="ident" id="6757597">GOOS</span><span class="op" id="6757601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757607">if</span>&nbsp;<span class="op" id="6757610">!</span><span class="ident" id="6757611">supportsIPv6</span>&nbsp;<span class="op" id="6757624">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757628">t</span><span class="op" id="6757629">.</span><span class="ident" id="6757630">Skip</span><span class="op" id="6757634">(</span><span class="string" id="6757635">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6757658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757665">for</span>&nbsp;<span class="ident" id="6757669">_</span><span class="op" id="6757670">,</span>&nbsp;<span class="ident" id="6757672">tt</span>&nbsp;<span class="op" id="6757675">:=</span>&nbsp;<span class="keyword" id="6757678">range</span>&nbsp;<span class="ident" id="6757684">dualStackListenerTests</span>&nbsp;<span class="op" id="6757707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757711">if</span>&nbsp;<span class="ident" id="6757714">tt</span><span class="op" id="6757716">.</span><span class="ident" id="6757717">wildcard</span>&nbsp;<span class="op" id="6757726">&amp;&amp;</span>&nbsp;<span class="op" id="6757729">!</span><span class="op" id="6757730">*</span><span class="ident" id="6757731">testExternal</span>&nbsp;<span class="op" id="6757744">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757764">switch</span>&nbsp;<span class="ident" id="6757771">runtime</span><span class="op" id="6757778">.</span><span class="ident" id="6757779">GOOS</span>&nbsp;<span class="op" id="6757784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757788">case</span>&nbsp;<span class="string" id="6757793">&#34;openbsd&#34;</span><span class="op" id="6757802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6757807">if</span>&nbsp;<span class="ident" id="6757810">tt</span><span class="op" id="6757812">.</span><span class="ident" id="6757813">wildcard</span>&nbsp;<span class="op" id="6757822">&amp;&amp;</span>&nbsp;<span class="ident" id="6757825">differentWildcardAddr</span><span class="op" id="6757846">(</span><span class="ident" id="6757847">tt</span><span class="op" id="6757849">.</span><span class="ident" id="6757850">laddr1</span><span class="op" id="6757856">,</span>&nbsp;<span class="ident" id="6757858">tt</span><span class="op" id="6757860">.</span><span class="ident" id="6757861">laddr2</span><span class="op" id="6757867">)</span>&nbsp;<span class="op" id="6757869">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757875">tt</span><span class="op" id="6757877">.</span><span class="ident" id="6757878">xerr</span>&nbsp;<span class="op" id="6757883">=</span>&nbsp;<span class="ident" id="6757885">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6757896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757900">l1</span><span class="op" id="6757902">,</span>&nbsp;<span class="ident" id="6757904">port</span>&nbsp;<span class="op" id="6757909">:=</span>&nbsp;<span class="ident" id="6757912">usableListenPort</span><span class="op" id="6757928">(</span><span class="ident" id="6757929">t</span><span class="op" id="6757930">,</span>&nbsp;<span class="ident" id="6757932">tt</span><span class="op" id="6757934">.</span><span class="ident" id="6757935">net1</span><span class="op" id="6757939">,</span>&nbsp;<span class="ident" id="6757941">tt</span><span class="op" id="6757943">.</span><span class="ident" id="6757944">laddr1</span><span class="op" id="6757950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757954">laddr</span>&nbsp;<span class="op" id="6757960">:=</span>&nbsp;<span class="ident" id="6757963">tt</span><span class="op" id="6757965">.</span><span class="ident" id="6757966">laddr1</span>&nbsp;<span class="op" id="6757973">+</span>&nbsp;<span class="string" id="6757975">&#34;:&#34;</span>&nbsp;<span class="op" id="6757979">+</span>&nbsp;<span class="ident" id="6757981">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6757988">checkFirstListener</span><span class="op" id="6758006">(</span><span class="ident" id="6758007">t</span><span class="op" id="6758008">,</span>&nbsp;<span class="ident" id="6758010">tt</span><span class="op" id="6758012">.</span><span class="ident" id="6758013">net1</span><span class="op" id="6758017">,</span>&nbsp;<span class="ident" id="6758019">laddr</span><span class="op" id="6758024">,</span>&nbsp;<span class="ident" id="6758026">l1</span><span class="op" id="6758028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758032">laddr</span>&nbsp;<span class="op" id="6758038">=</span>&nbsp;<span class="ident" id="6758040">tt</span><span class="op" id="6758042">.</span><span class="ident" id="6758043">laddr2</span>&nbsp;<span class="op" id="6758050">+</span>&nbsp;<span class="string" id="6758052">&#34;:&#34;</span>&nbsp;<span class="op" id="6758056">+</span>&nbsp;<span class="ident" id="6758058">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758065">l2</span><span class="op" id="6758067">,</span>&nbsp;<span class="ident" id="6758069">err</span>&nbsp;<span class="op" id="6758073">:=</span>&nbsp;<span class="ident" id="6758076">Listen</span><span class="op" id="6758082">(</span><span class="ident" id="6758083">tt</span><span class="op" id="6758085">.</span><span class="ident" id="6758086">net2</span><span class="op" id="6758090">,</span>&nbsp;<span class="ident" id="6758092">laddr</span><span class="op" id="6758097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758101">checkDualStackSecondListener</span><span class="op" id="6758129">(</span><span class="ident" id="6758130">t</span><span class="op" id="6758131">,</span>&nbsp;<span class="ident" id="6758133">tt</span><span class="op" id="6758135">.</span><span class="ident" id="6758136">net2</span><span class="op" id="6758140">,</span>&nbsp;<span class="ident" id="6758142">laddr</span><span class="op" id="6758147">,</span>&nbsp;<span class="ident" id="6758149">tt</span><span class="op" id="6758151">.</span><span class="ident" id="6758152">xerr</span><span class="op" id="6758156">,</span>&nbsp;<span class="ident" id="6758158">err</span><span class="op" id="6758161">,</span>&nbsp;<span class="ident" id="6758163">l2</span><span class="op" id="6758165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758169">l1</span><span class="op" id="6758171">.</span><span class="ident" id="6758172">Close</span><span class="op" id="6758177">(</span><span class="op" id="6758178">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758181">}</span><br>
<span class="lineno"></span><span class="op" id="6758183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6758186">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6758250">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="6758313">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6758349">func</span>&nbsp;<span class="ident" id="6758354">TestDualStackUDPListener</span><span class="op" id="6758378">(</span><span class="ident" id="6758379">t</span>&nbsp;<span class="op" id="6758381">*</span><span class="ident" id="6758382">testing</span><span class="op" id="6758389">.</span><span class="ident" id="6758390">T</span><span class="op" id="6758391">)</span>&nbsp;<span class="op" id="6758393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758396">if</span>&nbsp;<span class="ident" id="6758399">testing</span><span class="op" id="6758406">.</span><span class="ident" id="6758407">Short</span><span class="op" id="6758412">(</span><span class="op" id="6758413">)</span>&nbsp;<span class="op" id="6758415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758419">t</span><span class="op" id="6758420">.</span><span class="ident" id="6758421">Skip</span><span class="op" id="6758425">(</span><span class="string" id="6758426">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6758467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758470">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758473">switch</span>&nbsp;<span class="ident" id="6758480">runtime</span><span class="op" id="6758487">.</span><span class="ident" id="6758488">GOOS</span>&nbsp;<span class="op" id="6758493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758496">case</span>&nbsp;<span class="string" id="6758501">&#34;plan9&#34;</span><span class="op" id="6758508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758512">t</span><span class="op" id="6758513">.</span><span class="ident" id="6758514">Skipf</span><span class="op" id="6758519">(</span><span class="string" id="6758520">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6758541">,</span>&nbsp;<span class="ident" id="6758543">runtime</span><span class="op" id="6758550">.</span><span class="ident" id="6758551">GOOS</span><span class="op" id="6758555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758561">if</span>&nbsp;<span class="op" id="6758564">!</span><span class="ident" id="6758565">supportsIPv6</span>&nbsp;<span class="op" id="6758578">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758582">t</span><span class="op" id="6758583">.</span><span class="ident" id="6758584">Skip</span><span class="op" id="6758588">(</span><span class="string" id="6758589">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6758612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758619">toudpnet</span>&nbsp;<span class="op" id="6758628">:=</span>&nbsp;<span class="keyword" id="6758631">func</span><span class="op" id="6758635">(</span><span class="ident" id="6758636">net</span>&nbsp;<span class="builtintype" id="6758640">string</span><span class="op" id="6758646">)</span>&nbsp;<span class="builtintype" id="6758648">string</span>&nbsp;<span class="op" id="6758655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758659">switch</span>&nbsp;<span class="ident" id="6758666">net</span>&nbsp;<span class="op" id="6758670">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758674">case</span>&nbsp;<span class="string" id="6758679">&#34;tcp&#34;</span><span class="op" id="6758684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758689">return</span>&nbsp;<span class="string" id="6758696">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758704">case</span>&nbsp;<span class="string" id="6758709">&#34;tcp4&#34;</span><span class="op" id="6758715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758720">return</span>&nbsp;<span class="string" id="6758727">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758736">case</span>&nbsp;<span class="string" id="6758741">&#34;tcp6&#34;</span><span class="op" id="6758747">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758752">return</span>&nbsp;<span class="string" id="6758759">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758772">return</span>&nbsp;<span class="string" id="6758779">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758792">for</span>&nbsp;<span class="ident" id="6758796">_</span><span class="op" id="6758797">,</span>&nbsp;<span class="ident" id="6758799">tt</span>&nbsp;<span class="op" id="6758802">:=</span>&nbsp;<span class="keyword" id="6758805">range</span>&nbsp;<span class="ident" id="6758811">dualStackListenerTests</span>&nbsp;<span class="op" id="6758834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758838">if</span>&nbsp;<span class="ident" id="6758841">tt</span><span class="op" id="6758843">.</span><span class="ident" id="6758844">wildcard</span>&nbsp;<span class="op" id="6758853">&amp;&amp;</span>&nbsp;<span class="op" id="6758856">(</span><span class="ident" id="6758857">testing</span><span class="op" id="6758864">.</span><span class="ident" id="6758865">Short</span><span class="op" id="6758870">(</span><span class="op" id="6758871">)</span>&nbsp;<span class="op" id="6758873">||</span>&nbsp;<span class="op" id="6758876">!</span><span class="op" id="6758877">*</span><span class="ident" id="6758878">testExternal</span><span class="op" id="6758890">)</span>&nbsp;<span class="op" id="6758892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758897">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6758908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758912">tt</span><span class="op" id="6758914">.</span><span class="ident" id="6758915">net1</span>&nbsp;<span class="op" id="6758920">=</span>&nbsp;<span class="ident" id="6758922">toudpnet</span><span class="op" id="6758930">(</span><span class="ident" id="6758931">tt</span><span class="op" id="6758933">.</span><span class="ident" id="6758934">net1</span><span class="op" id="6758938">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6758942">tt</span><span class="op" id="6758944">.</span><span class="ident" id="6758945">net2</span>&nbsp;<span class="op" id="6758950">=</span>&nbsp;<span class="ident" id="6758952">toudpnet</span><span class="op" id="6758960">(</span><span class="ident" id="6758961">tt</span><span class="op" id="6758963">.</span><span class="ident" id="6758964">net2</span><span class="op" id="6758968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758972">switch</span>&nbsp;<span class="ident" id="6758979">runtime</span><span class="op" id="6758986">.</span><span class="ident" id="6758987">GOOS</span>&nbsp;<span class="op" id="6758992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6758996">case</span>&nbsp;<span class="string" id="6759001">&#34;openbsd&#34;</span><span class="op" id="6759010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759015">if</span>&nbsp;<span class="ident" id="6759018">tt</span><span class="op" id="6759020">.</span><span class="ident" id="6759021">wildcard</span>&nbsp;<span class="op" id="6759030">&amp;&amp;</span>&nbsp;<span class="ident" id="6759033">differentWildcardAddr</span><span class="op" id="6759054">(</span><span class="ident" id="6759055">tt</span><span class="op" id="6759057">.</span><span class="ident" id="6759058">laddr1</span><span class="op" id="6759064">,</span>&nbsp;<span class="ident" id="6759066">tt</span><span class="op" id="6759068">.</span><span class="ident" id="6759069">laddr2</span><span class="op" id="6759075">)</span>&nbsp;<span class="op" id="6759077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759083">tt</span><span class="op" id="6759085">.</span><span class="ident" id="6759086">xerr</span>&nbsp;<span class="op" id="6759091">=</span>&nbsp;<span class="ident" id="6759093">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759108">l1</span><span class="op" id="6759110">,</span>&nbsp;<span class="ident" id="6759112">port</span>&nbsp;<span class="op" id="6759117">:=</span>&nbsp;<span class="ident" id="6759120">usableListenPacketPort</span><span class="op" id="6759142">(</span><span class="ident" id="6759143">t</span><span class="op" id="6759144">,</span>&nbsp;<span class="ident" id="6759146">tt</span><span class="op" id="6759148">.</span><span class="ident" id="6759149">net1</span><span class="op" id="6759153">,</span>&nbsp;<span class="ident" id="6759155">tt</span><span class="op" id="6759157">.</span><span class="ident" id="6759158">laddr1</span><span class="op" id="6759164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759168">laddr</span>&nbsp;<span class="op" id="6759174">:=</span>&nbsp;<span class="ident" id="6759177">tt</span><span class="op" id="6759179">.</span><span class="ident" id="6759180">laddr1</span>&nbsp;<span class="op" id="6759187">+</span>&nbsp;<span class="string" id="6759189">&#34;:&#34;</span>&nbsp;<span class="op" id="6759193">+</span>&nbsp;<span class="ident" id="6759195">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759202">checkFirstListener</span><span class="op" id="6759220">(</span><span class="ident" id="6759221">t</span><span class="op" id="6759222">,</span>&nbsp;<span class="ident" id="6759224">tt</span><span class="op" id="6759226">.</span><span class="ident" id="6759227">net1</span><span class="op" id="6759231">,</span>&nbsp;<span class="ident" id="6759233">laddr</span><span class="op" id="6759238">,</span>&nbsp;<span class="ident" id="6759240">l1</span><span class="op" id="6759242">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759246">laddr</span>&nbsp;<span class="op" id="6759252">=</span>&nbsp;<span class="ident" id="6759254">tt</span><span class="op" id="6759256">.</span><span class="ident" id="6759257">laddr2</span>&nbsp;<span class="op" id="6759264">+</span>&nbsp;<span class="string" id="6759266">&#34;:&#34;</span>&nbsp;<span class="op" id="6759270">+</span>&nbsp;<span class="ident" id="6759272">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759279">l2</span><span class="op" id="6759281">,</span>&nbsp;<span class="ident" id="6759283">err</span>&nbsp;<span class="op" id="6759287">:=</span>&nbsp;<span class="ident" id="6759290">ListenPacket</span><span class="op" id="6759302">(</span><span class="ident" id="6759303">tt</span><span class="op" id="6759305">.</span><span class="ident" id="6759306">net2</span><span class="op" id="6759310">,</span>&nbsp;<span class="ident" id="6759312">laddr</span><span class="op" id="6759317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759321">checkDualStackSecondListener</span><span class="op" id="6759349">(</span><span class="ident" id="6759350">t</span><span class="op" id="6759351">,</span>&nbsp;<span class="ident" id="6759353">tt</span><span class="op" id="6759355">.</span><span class="ident" id="6759356">net2</span><span class="op" id="6759360">,</span>&nbsp;<span class="ident" id="6759362">laddr</span><span class="op" id="6759367">,</span>&nbsp;<span class="ident" id="6759369">tt</span><span class="op" id="6759371">.</span><span class="ident" id="6759372">xerr</span><span class="op" id="6759376">,</span>&nbsp;<span class="ident" id="6759378">err</span><span class="op" id="6759381">,</span>&nbsp;<span class="ident" id="6759383">l2</span><span class="op" id="6759385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759389">l1</span><span class="op" id="6759391">.</span><span class="ident" id="6759392">Close</span><span class="op" id="6759397">(</span><span class="op" id="6759398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759401">}</span><br>
<span class="lineno">250</span><span class="op" id="6759403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6759406">func</span>&nbsp;<span class="ident" id="6759411">usableListenPort</span><span class="op" id="6759427">(</span><span class="ident" id="6759428">t</span>&nbsp;<span class="op" id="6759430">*</span><span class="ident" id="6759431">testing</span><span class="op" id="6759438">.</span><span class="ident" id="6759439">T</span><span class="op" id="6759440">,</span>&nbsp;<span class="ident" id="6759442">net</span><span class="op" id="6759445">,</span>&nbsp;<span class="ident" id="6759447">laddr</span>&nbsp;<span class="builtintype" id="6759453">string</span><span class="op" id="6759459">)</span>&nbsp;<span class="op" id="6759461">(</span><span class="ident" id="6759462">l</span>&nbsp;<span class="ident" id="6759464">Listener</span><span class="op" id="6759472">,</span>&nbsp;<span class="ident" id="6759474">port</span>&nbsp;<span class="builtintype" id="6759479">string</span><span class="op" id="6759485">)</span>&nbsp;<span class="op" id="6759487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759490">var</span>&nbsp;<span class="ident" id="6759494">nladdr</span>&nbsp;<span class="builtintype" id="6759501">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759509">var</span>&nbsp;<span class="ident" id="6759513">err</span>&nbsp;<span class="builtintype" id="6759517">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759524">switch</span>&nbsp;<span class="ident" id="6759531">net</span>&nbsp;<span class="op" id="6759535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759538">default</span><span class="op" id="6759545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6759549">panic</span><span class="op" id="6759554">(</span><span class="string" id="6759555">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6759579">+</span>&nbsp;<span class="ident" id="6759581">net</span><span class="op" id="6759584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759587">case</span>&nbsp;<span class="string" id="6759592">&#34;tcp&#34;</span><span class="op" id="6759597">,</span>&nbsp;<span class="string" id="6759599">&#34;tcp4&#34;</span><span class="op" id="6759605">,</span>&nbsp;<span class="string" id="6759607">&#34;tcp6&#34;</span><span class="op" id="6759613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759617">l</span><span class="op" id="6759618">,</span>&nbsp;<span class="ident" id="6759620">err</span>&nbsp;<span class="op" id="6759624">=</span>&nbsp;<span class="ident" id="6759626">Listen</span><span class="op" id="6759632">(</span><span class="ident" id="6759633">net</span><span class="op" id="6759636">,</span>&nbsp;<span class="ident" id="6759638">laddr</span><span class="op" id="6759643">+</span><span class="string" id="6759644">&#34;:0&#34;</span><span class="op" id="6759648">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759652">if</span>&nbsp;<span class="ident" id="6759655">err</span>&nbsp;<span class="op" id="6759659">!=</span>&nbsp;<span class="ident" id="6759662">nil</span>&nbsp;<span class="op" id="6759666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759671">t</span><span class="op" id="6759672">.</span><span class="ident" id="6759673">Fatalf</span><span class="op" id="6759679">(</span><span class="string" id="6759680">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759713">,</span>&nbsp;<span class="ident" id="6759715">net</span><span class="op" id="6759718">,</span>&nbsp;<span class="ident" id="6759720">laddr</span><span class="op" id="6759725">,</span>&nbsp;<span class="ident" id="6759727">err</span><span class="op" id="6759730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759738">nladdr</span>&nbsp;<span class="op" id="6759745">=</span>&nbsp;<span class="ident" id="6759747">l</span><span class="op" id="6759748">.</span><span class="op" id="6759749">(</span><span class="op" id="6759750">*</span><span class="ident" id="6759751">TCPListener</span><span class="op" id="6759762">)</span><span class="op" id="6759763">.</span><span class="ident" id="6759764">Addr</span><span class="op" id="6759768">(</span><span class="op" id="6759769">)</span><span class="op" id="6759770">.</span><span class="ident" id="6759771">String</span><span class="op" id="6759777">(</span><span class="op" id="6759778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759781">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759784">_</span><span class="op" id="6759785">,</span>&nbsp;<span class="ident" id="6759787">port</span><span class="op" id="6759791">,</span>&nbsp;<span class="ident" id="6759793">err</span>&nbsp;<span class="op" id="6759797">=</span>&nbsp;<span class="ident" id="6759799">SplitHostPort</span><span class="op" id="6759812">(</span><span class="ident" id="6759813">nladdr</span><span class="op" id="6759819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759822">if</span>&nbsp;<span class="ident" id="6759825">err</span>&nbsp;<span class="op" id="6759829">!=</span>&nbsp;<span class="ident" id="6759832">nil</span>&nbsp;<span class="op" id="6759836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6759840">t</span><span class="op" id="6759841">.</span><span class="ident" id="6759842">Fatalf</span><span class="op" id="6759848">(</span><span class="string" id="6759849">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6759875">,</span>&nbsp;<span class="ident" id="6759877">err</span><span class="op" id="6759880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6759883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759886">return</span>&nbsp;<span class="ident" id="6759893">l</span><span class="op" id="6759894">,</span>&nbsp;<span class="ident" id="6759896">port</span><br>
<span class="lineno">270</span><span class="op" id="6759901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6759904">func</span>&nbsp;<span class="ident" id="6759909">usableListenPacketPort</span><span class="op" id="6759931">(</span><span class="ident" id="6759932">t</span>&nbsp;<span class="op" id="6759934">*</span><span class="ident" id="6759935">testing</span><span class="op" id="6759942">.</span><span class="ident" id="6759943">T</span><span class="op" id="6759944">,</span>&nbsp;<span class="ident" id="6759946">net</span><span class="op" id="6759949">,</span>&nbsp;<span class="ident" id="6759951">laddr</span>&nbsp;<span class="builtintype" id="6759957">string</span><span class="op" id="6759963">)</span>&nbsp;<span class="op" id="6759965">(</span><span class="ident" id="6759966">l</span>&nbsp;<span class="ident" id="6759968">PacketConn</span><span class="op" id="6759978">,</span>&nbsp;<span class="ident" id="6759980">port</span>&nbsp;<span class="builtintype" id="6759985">string</span><span class="op" id="6759991">)</span>&nbsp;<span class="op" id="6759993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6759996">var</span>&nbsp;<span class="ident" id="6760000">nladdr</span>&nbsp;<span class="builtintype" id="6760007">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760015">var</span>&nbsp;<span class="ident" id="6760019">err</span>&nbsp;<span class="builtintype" id="6760023">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760030">switch</span>&nbsp;<span class="ident" id="6760037">net</span>&nbsp;<span class="op" id="6760041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760044">default</span><span class="op" id="6760051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6760055">panic</span><span class="op" id="6760060">(</span><span class="string" id="6760061">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6760091">+</span>&nbsp;<span class="ident" id="6760093">net</span><span class="op" id="6760096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760099">case</span>&nbsp;<span class="string" id="6760104">&#34;udp&#34;</span><span class="op" id="6760109">,</span>&nbsp;<span class="string" id="6760111">&#34;udp4&#34;</span><span class="op" id="6760117">,</span>&nbsp;<span class="string" id="6760119">&#34;udp6&#34;</span><span class="op" id="6760125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760129">l</span><span class="op" id="6760130">,</span>&nbsp;<span class="ident" id="6760132">err</span>&nbsp;<span class="op" id="6760136">=</span>&nbsp;<span class="ident" id="6760138">ListenPacket</span><span class="op" id="6760150">(</span><span class="ident" id="6760151">net</span><span class="op" id="6760154">,</span>&nbsp;<span class="ident" id="6760156">laddr</span><span class="op" id="6760161">+</span><span class="string" id="6760162">&#34;:0&#34;</span><span class="op" id="6760166">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760170">if</span>&nbsp;<span class="ident" id="6760173">err</span>&nbsp;<span class="op" id="6760177">!=</span>&nbsp;<span class="ident" id="6760180">nil</span>&nbsp;<span class="op" id="6760184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760189">t</span><span class="op" id="6760190">.</span><span class="ident" id="6760191">Fatalf</span><span class="op" id="6760197">(</span><span class="string" id="6760198">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6760237">,</span>&nbsp;<span class="ident" id="6760239">net</span><span class="op" id="6760242">,</span>&nbsp;<span class="ident" id="6760244">laddr</span><span class="op" id="6760249">,</span>&nbsp;<span class="ident" id="6760251">err</span><span class="op" id="6760254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760262">nladdr</span>&nbsp;<span class="op" id="6760269">=</span>&nbsp;<span class="ident" id="6760271">l</span><span class="op" id="6760272">.</span><span class="op" id="6760273">(</span><span class="op" id="6760274">*</span><span class="ident" id="6760275">UDPConn</span><span class="op" id="6760282">)</span><span class="op" id="6760283">.</span><span class="ident" id="6760284">LocalAddr</span><span class="op" id="6760293">(</span><span class="op" id="6760294">)</span><span class="op" id="6760295">.</span><span class="ident" id="6760296">String</span><span class="op" id="6760302">(</span><span class="op" id="6760303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760306">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760309">_</span><span class="op" id="6760310">,</span>&nbsp;<span class="ident" id="6760312">port</span><span class="op" id="6760316">,</span>&nbsp;<span class="ident" id="6760318">err</span>&nbsp;<span class="op" id="6760322">=</span>&nbsp;<span class="ident" id="6760324">SplitHostPort</span><span class="op" id="6760337">(</span><span class="ident" id="6760338">nladdr</span><span class="op" id="6760344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760347">if</span>&nbsp;<span class="ident" id="6760350">err</span>&nbsp;<span class="op" id="6760354">!=</span>&nbsp;<span class="ident" id="6760357">nil</span>&nbsp;<span class="op" id="6760361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760365">t</span><span class="op" id="6760366">.</span><span class="ident" id="6760367">Fatalf</span><span class="op" id="6760373">(</span><span class="string" id="6760374">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6760400">,</span>&nbsp;<span class="ident" id="6760402">err</span><span class="op" id="6760405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760411">return</span>&nbsp;<span class="ident" id="6760418">l</span><span class="op" id="6760419">,</span>&nbsp;<span class="ident" id="6760421">port</span><br>
<span class="lineno">290</span><span class="op" id="6760426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760429">func</span>&nbsp;<span class="ident" id="6760434">differentWildcardAddr</span><span class="op" id="6760455">(</span><span class="ident" id="6760456">i</span><span class="op" id="6760457">,</span>&nbsp;<span class="ident" id="6760459">j</span>&nbsp;<span class="builtintype" id="6760461">string</span><span class="op" id="6760467">)</span>&nbsp;<span class="builtintype" id="6760469">bool</span>&nbsp;<span class="op" id="6760474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760477">if</span>&nbsp;<span class="op" id="6760480">(</span><span class="ident" id="6760481">i</span>&nbsp;<span class="op" id="6760483">==</span>&nbsp;<span class="string" id="6760486">&#34;&#34;</span>&nbsp;<span class="op" id="6760489">||</span>&nbsp;<span class="ident" id="6760492">i</span>&nbsp;<span class="op" id="6760494">==</span>&nbsp;<span class="string" id="6760497">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6760507">||</span>&nbsp;<span class="ident" id="6760510">i</span>&nbsp;<span class="op" id="6760512">==</span>&nbsp;<span class="string" id="6760515">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6760531">)</span>&nbsp;<span class="op" id="6760533">&amp;&amp;</span>&nbsp;<span class="op" id="6760536">(</span><span class="ident" id="6760537">j</span>&nbsp;<span class="op" id="6760539">==</span>&nbsp;<span class="string" id="6760542">&#34;&#34;</span>&nbsp;<span class="op" id="6760545">||</span>&nbsp;<span class="ident" id="6760548">j</span>&nbsp;<span class="op" id="6760550">==</span>&nbsp;<span class="string" id="6760553">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6760563">||</span>&nbsp;<span class="ident" id="6760566">j</span>&nbsp;<span class="op" id="6760568">==</span>&nbsp;<span class="string" id="6760571">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6760587">)</span>&nbsp;<span class="op" id="6760589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760593">return</span>&nbsp;<span class="builtintype" id="6760600">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760610">if</span>&nbsp;<span class="ident" id="6760613">i</span>&nbsp;<span class="op" id="6760615">==</span>&nbsp;<span class="string" id="6760618">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6760625">&amp;&amp;</span>&nbsp;<span class="ident" id="6760628">j</span>&nbsp;<span class="op" id="6760630">==</span>&nbsp;<span class="string" id="6760633">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6760640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760644">return</span>&nbsp;<span class="builtintype" id="6760651">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760661">return</span>&nbsp;<span class="builtintype" id="6760668">true</span><br>
<span class="lineno">300</span><span class="op" id="6760673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760676">func</span>&nbsp;<span class="ident" id="6760681">checkFirstListener</span><span class="op" id="6760699">(</span><span class="ident" id="6760700">t</span>&nbsp;<span class="op" id="6760702">*</span><span class="ident" id="6760703">testing</span><span class="op" id="6760710">.</span><span class="ident" id="6760711">T</span><span class="op" id="6760712">,</span>&nbsp;<span class="ident" id="6760714">net</span><span class="op" id="6760717">,</span>&nbsp;<span class="ident" id="6760719">laddr</span>&nbsp;<span class="builtintype" id="6760725">string</span><span class="op" id="6760731">,</span>&nbsp;<span class="ident" id="6760733">l</span>&nbsp;<span class="keyword" id="6760735">interface</span><span class="op" id="6760744">{</span><span class="op" id="6760745">}</span><span class="op" id="6760746">)</span>&nbsp;<span class="op" id="6760748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760751">switch</span>&nbsp;<span class="ident" id="6760758">net</span>&nbsp;<span class="op" id="6760762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760765">case</span>&nbsp;<span class="string" id="6760770">&#34;tcp&#34;</span><span class="op" id="6760775">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760779">fd</span>&nbsp;<span class="op" id="6760782">:=</span>&nbsp;<span class="ident" id="6760785">l</span><span class="op" id="6760786">.</span><span class="op" id="6760787">(</span><span class="op" id="6760788">*</span><span class="ident" id="6760789">TCPListener</span><span class="op" id="6760800">)</span><span class="op" id="6760801">.</span><span class="ident" id="6760802">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760807">checkDualStackAddrFamily</span><span class="op" id="6760831">(</span><span class="ident" id="6760832">t</span><span class="op" id="6760833">,</span>&nbsp;<span class="ident" id="6760835">net</span><span class="op" id="6760838">,</span>&nbsp;<span class="ident" id="6760840">laddr</span><span class="op" id="6760845">,</span>&nbsp;<span class="ident" id="6760847">fd</span><span class="op" id="6760849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760852">case</span>&nbsp;<span class="string" id="6760857">&#34;tcp4&#34;</span><span class="op" id="6760863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760867">fd</span>&nbsp;<span class="op" id="6760870">:=</span>&nbsp;<span class="ident" id="6760873">l</span><span class="op" id="6760874">.</span><span class="op" id="6760875">(</span><span class="op" id="6760876">*</span><span class="ident" id="6760877">TCPListener</span><span class="op" id="6760888">)</span><span class="op" id="6760889">.</span><span class="ident" id="6760890">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760895">if</span>&nbsp;<span class="ident" id="6760898">fd</span><span class="op" id="6760900">.</span><span class="ident" id="6760901">family</span>&nbsp;<span class="op" id="6760908">!=</span>&nbsp;<span class="ident" id="6760911">syscall</span><span class="op" id="6760918">.</span><span class="ident" id="6760919">AF_INET</span>&nbsp;<span class="op" id="6760927">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760932">t</span><span class="op" id="6760933">.</span><span class="ident" id="6760934">Fatalf</span><span class="op" id="6760940">(</span><span class="string" id="6760941">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6761002">,</span>&nbsp;<span class="ident" id="6761004">net</span><span class="op" id="6761007">,</span>&nbsp;<span class="ident" id="6761009">laddr</span><span class="op" id="6761014">,</span>&nbsp;<span class="ident" id="6761016">fd</span><span class="op" id="6761018">.</span><span class="ident" id="6761019">family</span><span class="op" id="6761025">,</span>&nbsp;<span class="ident" id="6761027">syscall</span><span class="op" id="6761034">.</span><span class="ident" id="6761035">AF_INET</span><span class="op" id="6761042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761049">case</span>&nbsp;<span class="string" id="6761054">&#34;tcp6&#34;</span><span class="op" id="6761060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761064">fd</span>&nbsp;<span class="op" id="6761067">:=</span>&nbsp;<span class="ident" id="6761070">l</span><span class="op" id="6761071">.</span><span class="op" id="6761072">(</span><span class="op" id="6761073">*</span><span class="ident" id="6761074">TCPListener</span><span class="op" id="6761085">)</span><span class="op" id="6761086">.</span><span class="ident" id="6761087">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761092">if</span>&nbsp;<span class="ident" id="6761095">fd</span><span class="op" id="6761097">.</span><span class="ident" id="6761098">family</span>&nbsp;<span class="op" id="6761105">!=</span>&nbsp;<span class="ident" id="6761108">syscall</span><span class="op" id="6761115">.</span><span class="ident" id="6761116">AF_INET6</span>&nbsp;<span class="op" id="6761125">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761130">t</span><span class="op" id="6761131">.</span><span class="ident" id="6761132">Fatalf</span><span class="op" id="6761138">(</span><span class="string" id="6761139">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6761200">,</span>&nbsp;<span class="ident" id="6761202">net</span><span class="op" id="6761205">,</span>&nbsp;<span class="ident" id="6761207">laddr</span><span class="op" id="6761212">,</span>&nbsp;<span class="ident" id="6761214">fd</span><span class="op" id="6761216">.</span><span class="ident" id="6761217">family</span><span class="op" id="6761223">,</span>&nbsp;<span class="ident" id="6761225">syscall</span><span class="op" id="6761232">.</span><span class="ident" id="6761233">AF_INET6</span><span class="op" id="6761241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761248">case</span>&nbsp;<span class="string" id="6761253">&#34;udp&#34;</span><span class="op" id="6761258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761262">fd</span>&nbsp;<span class="op" id="6761265">:=</span>&nbsp;<span class="ident" id="6761268">l</span><span class="op" id="6761269">.</span><span class="op" id="6761270">(</span><span class="op" id="6761271">*</span><span class="ident" id="6761272">UDPConn</span><span class="op" id="6761279">)</span><span class="op" id="6761280">.</span><span class="ident" id="6761281">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761286">checkDualStackAddrFamily</span><span class="op" id="6761310">(</span><span class="ident" id="6761311">t</span><span class="op" id="6761312">,</span>&nbsp;<span class="ident" id="6761314">net</span><span class="op" id="6761317">,</span>&nbsp;<span class="ident" id="6761319">laddr</span><span class="op" id="6761324">,</span>&nbsp;<span class="ident" id="6761326">fd</span><span class="op" id="6761328">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761331">case</span>&nbsp;<span class="string" id="6761336">&#34;udp4&#34;</span><span class="op" id="6761342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761346">fd</span>&nbsp;<span class="op" id="6761349">:=</span>&nbsp;<span class="ident" id="6761352">l</span><span class="op" id="6761353">.</span><span class="op" id="6761354">(</span><span class="op" id="6761355">*</span><span class="ident" id="6761356">UDPConn</span><span class="op" id="6761363">)</span><span class="op" id="6761364">.</span><span class="ident" id="6761365">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761370">if</span>&nbsp;<span class="ident" id="6761373">fd</span><span class="op" id="6761375">.</span><span class="ident" id="6761376">family</span>&nbsp;<span class="op" id="6761383">!=</span>&nbsp;<span class="ident" id="6761386">syscall</span><span class="op" id="6761393">.</span><span class="ident" id="6761394">AF_INET</span>&nbsp;<span class="op" id="6761402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761407">t</span><span class="op" id="6761408">.</span><span class="ident" id="6761409">Fatalf</span><span class="op" id="6761415">(</span><span class="string" id="6761416">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6761483">,</span>&nbsp;<span class="ident" id="6761485">net</span><span class="op" id="6761488">,</span>&nbsp;<span class="ident" id="6761490">laddr</span><span class="op" id="6761495">,</span>&nbsp;<span class="ident" id="6761497">fd</span><span class="op" id="6761499">.</span><span class="ident" id="6761500">family</span><span class="op" id="6761506">,</span>&nbsp;<span class="ident" id="6761508">syscall</span><span class="op" id="6761515">.</span><span class="ident" id="6761516">AF_INET</span><span class="op" id="6761523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761527">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761530">case</span>&nbsp;<span class="string" id="6761535">&#34;udp6&#34;</span><span class="op" id="6761541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761545">fd</span>&nbsp;<span class="op" id="6761548">:=</span>&nbsp;<span class="ident" id="6761551">l</span><span class="op" id="6761552">.</span><span class="op" id="6761553">(</span><span class="op" id="6761554">*</span><span class="ident" id="6761555">UDPConn</span><span class="op" id="6761562">)</span><span class="op" id="6761563">.</span><span class="ident" id="6761564">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761569">if</span>&nbsp;<span class="ident" id="6761572">fd</span><span class="op" id="6761574">.</span><span class="ident" id="6761575">family</span>&nbsp;<span class="op" id="6761582">!=</span>&nbsp;<span class="ident" id="6761585">syscall</span><span class="op" id="6761592">.</span><span class="ident" id="6761593">AF_INET6</span>&nbsp;<span class="op" id="6761602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761607">t</span><span class="op" id="6761608">.</span><span class="ident" id="6761609">Fatalf</span><span class="op" id="6761615">(</span><span class="string" id="6761616">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6761683">,</span>&nbsp;<span class="ident" id="6761685">net</span><span class="op" id="6761688">,</span>&nbsp;<span class="ident" id="6761690">laddr</span><span class="op" id="6761695">,</span>&nbsp;<span class="ident" id="6761697">fd</span><span class="op" id="6761699">.</span><span class="ident" id="6761700">family</span><span class="op" id="6761706">,</span>&nbsp;<span class="ident" id="6761708">syscall</span><span class="op" id="6761715">.</span><span class="ident" id="6761716">AF_INET6</span><span class="op" id="6761724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761728">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761731">default</span><span class="op" id="6761738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761742">t</span><span class="op" id="6761743">.</span><span class="ident" id="6761744">Fatalf</span><span class="op" id="6761750">(</span><span class="string" id="6761751">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6761775">,</span>&nbsp;<span class="ident" id="6761777">net</span><span class="op" id="6761780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6761783">}</span><br>
<span class="lineno"></span><span class="op" id="6761785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6761788">func</span>&nbsp;<span class="ident" id="6761793">checkSecondListener</span><span class="op" id="6761812">(</span><span class="ident" id="6761813">t</span>&nbsp;<span class="op" id="6761815">*</span><span class="ident" id="6761816">testing</span><span class="op" id="6761823">.</span><span class="ident" id="6761824">T</span><span class="op" id="6761825">,</span>&nbsp;<span class="ident" id="6761827">net</span><span class="op" id="6761830">,</span>&nbsp;<span class="ident" id="6761832">laddr</span>&nbsp;<span class="builtintype" id="6761838">string</span><span class="op" id="6761844">,</span>&nbsp;<span class="ident" id="6761846">err</span>&nbsp;<span class="builtintype" id="6761850">error</span><span class="op" id="6761855">,</span>&nbsp;<span class="ident" id="6761857">l</span>&nbsp;<span class="keyword" id="6761859">interface</span><span class="op" id="6761868">{</span><span class="op" id="6761869">}</span><span class="op" id="6761870">)</span>&nbsp;<span class="op" id="6761872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761875">switch</span>&nbsp;<span class="ident" id="6761882">net</span>&nbsp;<span class="op" id="6761886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761889">case</span>&nbsp;<span class="string" id="6761894">&#34;tcp&#34;</span><span class="op" id="6761899">,</span>&nbsp;<span class="string" id="6761901">&#34;tcp4&#34;</span><span class="op" id="6761907">,</span>&nbsp;<span class="string" id="6761909">&#34;tcp6&#34;</span><span class="op" id="6761915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6761919">if</span>&nbsp;<span class="ident" id="6761922">err</span>&nbsp;<span class="op" id="6761926">==</span>&nbsp;<span class="ident" id="6761929">nil</span>&nbsp;<span class="op" id="6761933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761938">l</span><span class="op" id="6761939">.</span><span class="op" id="6761940">(</span><span class="op" id="6761941">*</span><span class="ident" id="6761942">TCPListener</span><span class="op" id="6761953">)</span><span class="op" id="6761954">.</span><span class="ident" id="6761955">Close</span><span class="op" id="6761960">(</span><span class="op" id="6761961">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761966">t</span><span class="op" id="6761967">.</span><span class="ident" id="6761968">Fatalf</span><span class="op" id="6761974">(</span><span class="string" id="6761975">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6762010">,</span>&nbsp;<span class="ident" id="6762012">net</span><span class="op" id="6762015">,</span>&nbsp;<span class="ident" id="6762017">laddr</span><span class="op" id="6762022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762029">case</span>&nbsp;<span class="string" id="6762034">&#34;udp&#34;</span><span class="op" id="6762039">,</span>&nbsp;<span class="string" id="6762041">&#34;udp4&#34;</span><span class="op" id="6762047">,</span>&nbsp;<span class="string" id="6762049">&#34;udp6&#34;</span><span class="op" id="6762055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762059">if</span>&nbsp;<span class="ident" id="6762062">err</span>&nbsp;<span class="op" id="6762066">==</span>&nbsp;<span class="ident" id="6762069">nil</span>&nbsp;<span class="op" id="6762073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762078">l</span><span class="op" id="6762079">.</span><span class="op" id="6762080">(</span><span class="op" id="6762081">*</span><span class="ident" id="6762082">UDPConn</span><span class="op" id="6762089">)</span><span class="op" id="6762090">.</span><span class="ident" id="6762091">Close</span><span class="op" id="6762096">(</span><span class="op" id="6762097">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762102">t</span><span class="op" id="6762103">.</span><span class="ident" id="6762104">Fatalf</span><span class="op" id="6762110">(</span><span class="string" id="6762111">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6762152">,</span>&nbsp;<span class="ident" id="6762154">net</span><span class="op" id="6762157">,</span>&nbsp;<span class="ident" id="6762159">laddr</span><span class="op" id="6762164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762171">default</span><span class="op" id="6762178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762182">t</span><span class="op" id="6762183">.</span><span class="ident" id="6762184">Fatalf</span><span class="op" id="6762190">(</span><span class="string" id="6762191">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6762215">,</span>&nbsp;<span class="ident" id="6762217">net</span><span class="op" id="6762220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762223">}</span><br>
<span class="lineno">350</span><span class="op" id="6762225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6762228">func</span>&nbsp;<span class="ident" id="6762233">checkDualStackSecondListener</span><span class="op" id="6762261">(</span><span class="ident" id="6762262">t</span>&nbsp;<span class="op" id="6762264">*</span><span class="ident" id="6762265">testing</span><span class="op" id="6762272">.</span><span class="ident" id="6762273">T</span><span class="op" id="6762274">,</span>&nbsp;<span class="ident" id="6762276">net</span><span class="op" id="6762279">,</span>&nbsp;<span class="ident" id="6762281">laddr</span>&nbsp;<span class="builtintype" id="6762287">string</span><span class="op" id="6762293">,</span>&nbsp;<span class="ident" id="6762295">xerr</span><span class="op" id="6762299">,</span>&nbsp;<span class="ident" id="6762301">err</span>&nbsp;<span class="builtintype" id="6762305">error</span><span class="op" id="6762310">,</span>&nbsp;<span class="ident" id="6762312">l</span>&nbsp;<span class="keyword" id="6762314">interface</span><span class="op" id="6762323">{</span><span class="op" id="6762324">}</span><span class="op" id="6762325">)</span>&nbsp;<span class="op" id="6762327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762330">switch</span>&nbsp;<span class="ident" id="6762337">net</span>&nbsp;<span class="op" id="6762341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762344">case</span>&nbsp;<span class="string" id="6762349">&#34;tcp&#34;</span><span class="op" id="6762354">,</span>&nbsp;<span class="string" id="6762356">&#34;tcp4&#34;</span><span class="op" id="6762362">,</span>&nbsp;<span class="string" id="6762364">&#34;tcp6&#34;</span><span class="op" id="6762370">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762374">if</span>&nbsp;<span class="ident" id="6762377">xerr</span>&nbsp;<span class="op" id="6762382">==</span>&nbsp;<span class="ident" id="6762385">nil</span>&nbsp;<span class="op" id="6762389">&amp;&amp;</span>&nbsp;<span class="ident" id="6762392">err</span>&nbsp;<span class="op" id="6762396">!=</span>&nbsp;<span class="ident" id="6762399">nil</span>&nbsp;<span class="op" id="6762403">||</span>&nbsp;<span class="ident" id="6762406">xerr</span>&nbsp;<span class="op" id="6762411">!=</span>&nbsp;<span class="ident" id="6762414">nil</span>&nbsp;<span class="op" id="6762418">&amp;&amp;</span>&nbsp;<span class="ident" id="6762421">err</span>&nbsp;<span class="op" id="6762425">==</span>&nbsp;<span class="ident" id="6762428">nil</span>&nbsp;<span class="op" id="6762432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762437">t</span><span class="op" id="6762438">.</span><span class="ident" id="6762439">Fatalf</span><span class="op" id="6762445">(</span><span class="string" id="6762446">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6762493">,</span>&nbsp;<span class="ident" id="6762495">net</span><span class="op" id="6762498">,</span>&nbsp;<span class="ident" id="6762500">laddr</span><span class="op" id="6762505">,</span>&nbsp;<span class="ident" id="6762507">err</span><span class="op" id="6762510">,</span>&nbsp;<span class="ident" id="6762512">xerr</span><span class="op" id="6762516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762524">if</span>&nbsp;<span class="ident" id="6762527">err</span>&nbsp;<span class="op" id="6762531">==</span>&nbsp;<span class="ident" id="6762534">nil</span>&nbsp;<span class="op" id="6762538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762543">l</span><span class="op" id="6762544">.</span><span class="op" id="6762545">(</span><span class="op" id="6762546">*</span><span class="ident" id="6762547">TCPListener</span><span class="op" id="6762558">)</span><span class="op" id="6762559">.</span><span class="ident" id="6762560">Close</span><span class="op" id="6762565">(</span><span class="op" id="6762566">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762573">case</span>&nbsp;<span class="string" id="6762578">&#34;udp&#34;</span><span class="op" id="6762583">,</span>&nbsp;<span class="string" id="6762585">&#34;udp4&#34;</span><span class="op" id="6762591">,</span>&nbsp;<span class="string" id="6762593">&#34;udp6&#34;</span><span class="op" id="6762599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762603">if</span>&nbsp;<span class="ident" id="6762606">xerr</span>&nbsp;<span class="op" id="6762611">==</span>&nbsp;<span class="ident" id="6762614">nil</span>&nbsp;<span class="op" id="6762618">&amp;&amp;</span>&nbsp;<span class="ident" id="6762621">err</span>&nbsp;<span class="op" id="6762625">!=</span>&nbsp;<span class="ident" id="6762628">nil</span>&nbsp;<span class="op" id="6762632">||</span>&nbsp;<span class="ident" id="6762635">xerr</span>&nbsp;<span class="op" id="6762640">!=</span>&nbsp;<span class="ident" id="6762643">nil</span>&nbsp;<span class="op" id="6762647">&amp;&amp;</span>&nbsp;<span class="ident" id="6762650">err</span>&nbsp;<span class="op" id="6762654">==</span>&nbsp;<span class="ident" id="6762657">nil</span>&nbsp;<span class="op" id="6762661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762666">t</span><span class="op" id="6762667">.</span><span class="ident" id="6762668">Fatalf</span><span class="op" id="6762674">(</span><span class="string" id="6762675">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6762728">,</span>&nbsp;<span class="ident" id="6762730">net</span><span class="op" id="6762733">,</span>&nbsp;<span class="ident" id="6762735">laddr</span><span class="op" id="6762740">,</span>&nbsp;<span class="ident" id="6762742">err</span><span class="op" id="6762745">,</span>&nbsp;<span class="ident" id="6762747">xerr</span><span class="op" id="6762751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762755">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762759">if</span>&nbsp;<span class="ident" id="6762762">err</span>&nbsp;<span class="op" id="6762766">==</span>&nbsp;<span class="ident" id="6762769">nil</span>&nbsp;<span class="op" id="6762773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762778">l</span><span class="op" id="6762779">.</span><span class="op" id="6762780">(</span><span class="op" id="6762781">*</span><span class="ident" id="6762782">UDPConn</span><span class="op" id="6762789">)</span><span class="op" id="6762790">.</span><span class="ident" id="6762791">Close</span><span class="op" id="6762796">(</span><span class="op" id="6762797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762804">default</span><span class="op" id="6762811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6762815">t</span><span class="op" id="6762816">.</span><span class="ident" id="6762817">Fatalf</span><span class="op" id="6762823">(</span><span class="string" id="6762824">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6762848">,</span>&nbsp;<span class="ident" id="6762850">net</span><span class="op" id="6762853">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6762856">}</span><br>
<span class="lineno"></span><span class="op" id="6762858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6762861">func</span>&nbsp;<span class="ident" id="6762866">checkDualStackAddrFamily</span><span class="op" id="6762890">(</span><span class="ident" id="6762891">t</span>&nbsp;<span class="op" id="6762893">*</span><span class="ident" id="6762894">testing</span><span class="op" id="6762901">.</span><span class="ident" id="6762902">T</span><span class="op" id="6762903">,</span>&nbsp;<span class="ident" id="6762905">net</span><span class="op" id="6762908">,</span>&nbsp;<span class="ident" id="6762910">laddr</span>&nbsp;<span class="builtintype" id="6762916">string</span><span class="op" id="6762922">,</span>&nbsp;<span class="ident" id="6762924">fd</span>&nbsp;<span class="op" id="6762927">*</span><span class="ident" id="6762928">netFD</span><span class="op" id="6762933">)</span>&nbsp;<span class="op" id="6762935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762938">switch</span>&nbsp;<span class="ident" id="6762945">a</span>&nbsp;<span class="op" id="6762947">:=</span>&nbsp;<span class="ident" id="6762950">fd</span><span class="op" id="6762952">.</span><span class="ident" id="6762953">laddr</span><span class="op" id="6762958">.</span><span class="op" id="6762959">(</span><span class="keyword" id="6762960">type</span><span class="op" id="6762964">)</span>&nbsp;<span class="op" id="6762966">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6762969">case</span>&nbsp;<span class="op" id="6762974">*</span><span class="ident" id="6762975">TCPAddr</span><span class="op" id="6762982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6762986">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763042">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763095">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763152">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763174">if</span>&nbsp;<span class="ident" id="6763177">supportsIPv4map</span>&nbsp;<span class="op" id="6763193">&amp;&amp;</span>&nbsp;<span class="ident" id="6763196">fd</span><span class="op" id="6763198">.</span><span class="ident" id="6763199">laddr</span><span class="op" id="6763204">.</span><span class="op" id="6763205">(</span><span class="op" id="6763206">*</span><span class="ident" id="6763207">TCPAddr</span><span class="op" id="6763214">)</span><span class="op" id="6763215">.</span><span class="ident" id="6763216">isWildcard</span><span class="op" id="6763226">(</span><span class="op" id="6763227">)</span>&nbsp;<span class="op" id="6763229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763234">if</span>&nbsp;<span class="ident" id="6763237">fd</span><span class="op" id="6763239">.</span><span class="ident" id="6763240">family</span>&nbsp;<span class="op" id="6763247">!=</span>&nbsp;<span class="ident" id="6763250">syscall</span><span class="op" id="6763257">.</span><span class="ident" id="6763258">AF_INET6</span>&nbsp;<span class="op" id="6763267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6763273">t</span><span class="op" id="6763274">.</span><span class="ident" id="6763275">Fatalf</span><span class="op" id="6763281">(</span><span class="string" id="6763282">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6763337">,</span>&nbsp;<span class="ident" id="6763339">net</span><span class="op" id="6763342">,</span>&nbsp;<span class="ident" id="6763344">laddr</span><span class="op" id="6763349">,</span>&nbsp;<span class="ident" id="6763351">fd</span><span class="op" id="6763353">.</span><span class="ident" id="6763354">family</span><span class="op" id="6763360">,</span>&nbsp;<span class="ident" id="6763362">syscall</span><span class="op" id="6763369">.</span><span class="ident" id="6763370">AF_INET6</span><span class="op" id="6763378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763387">}</span>&nbsp;<span class="keyword" id="6763389">else</span>&nbsp;<span class="op" id="6763394">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763399">if</span>&nbsp;<span class="ident" id="6763402">fd</span><span class="op" id="6763404">.</span><span class="ident" id="6763405">family</span>&nbsp;<span class="op" id="6763412">!=</span>&nbsp;<span class="ident" id="6763415">a</span><span class="op" id="6763416">.</span><span class="ident" id="6763417">family</span><span class="op" id="6763423">(</span><span class="op" id="6763424">)</span>&nbsp;<span class="op" id="6763426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6763432">t</span><span class="op" id="6763433">.</span><span class="ident" id="6763434">Fatalf</span><span class="op" id="6763440">(</span><span class="string" id="6763441">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6763496">,</span>&nbsp;<span class="ident" id="6763498">net</span><span class="op" id="6763501">,</span>&nbsp;<span class="ident" id="6763503">laddr</span><span class="op" id="6763508">,</span>&nbsp;<span class="ident" id="6763510">fd</span><span class="op" id="6763512">.</span><span class="ident" id="6763513">family</span><span class="op" id="6763519">,</span>&nbsp;<span class="ident" id="6763521">a</span><span class="op" id="6763522">.</span><span class="ident" id="6763523">family</span><span class="op" id="6763529">(</span><span class="op" id="6763530">)</span><span class="op" id="6763531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763543">case</span>&nbsp;<span class="op" id="6763548">*</span><span class="ident" id="6763549">UDPAddr</span><span class="op" id="6763556">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763560">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763616">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763669">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6763726">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763748">if</span>&nbsp;<span class="ident" id="6763751">supportsIPv4map</span>&nbsp;<span class="op" id="6763767">&amp;&amp;</span>&nbsp;<span class="ident" id="6763770">fd</span><span class="op" id="6763772">.</span><span class="ident" id="6763773">laddr</span><span class="op" id="6763778">.</span><span class="op" id="6763779">(</span><span class="op" id="6763780">*</span><span class="ident" id="6763781">UDPAddr</span><span class="op" id="6763788">)</span><span class="op" id="6763789">.</span><span class="ident" id="6763790">isWildcard</span><span class="op" id="6763800">(</span><span class="op" id="6763801">)</span>&nbsp;<span class="op" id="6763803">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763808">if</span>&nbsp;<span class="ident" id="6763811">fd</span><span class="op" id="6763813">.</span><span class="ident" id="6763814">family</span>&nbsp;<span class="op" id="6763821">!=</span>&nbsp;<span class="ident" id="6763824">syscall</span><span class="op" id="6763831">.</span><span class="ident" id="6763832">AF_INET6</span>&nbsp;<span class="op" id="6763841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6763847">t</span><span class="op" id="6763848">.</span><span class="ident" id="6763849">Fatalf</span><span class="op" id="6763855">(</span><span class="string" id="6763856">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6763917">,</span>&nbsp;<span class="ident" id="6763919">net</span><span class="op" id="6763922">,</span>&nbsp;<span class="ident" id="6763924">laddr</span><span class="op" id="6763929">,</span>&nbsp;<span class="ident" id="6763931">fd</span><span class="op" id="6763933">.</span><span class="ident" id="6763934">family</span><span class="op" id="6763940">,</span>&nbsp;<span class="ident" id="6763942">syscall</span><span class="op" id="6763949">.</span><span class="ident" id="6763950">AF_INET6</span><span class="op" id="6763958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6763967">}</span>&nbsp;<span class="keyword" id="6763969">else</span>&nbsp;<span class="op" id="6763974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6763979">if</span>&nbsp;<span class="ident" id="6763982">fd</span><span class="op" id="6763984">.</span><span class="ident" id="6763985">family</span>&nbsp;<span class="op" id="6763992">!=</span>&nbsp;<span class="ident" id="6763995">a</span><span class="op" id="6763996">.</span><span class="ident" id="6763997">family</span><span class="op" id="6764003">(</span><span class="op" id="6764004">)</span>&nbsp;<span class="op" id="6764006">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764012">t</span><span class="op" id="6764013">.</span><span class="ident" id="6764014">Fatalf</span><span class="op" id="6764020">(</span><span class="string" id="6764021">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6764082">,</span>&nbsp;<span class="ident" id="6764084">net</span><span class="op" id="6764087">,</span>&nbsp;<span class="ident" id="6764089">laddr</span><span class="op" id="6764094">,</span>&nbsp;<span class="ident" id="6764096">fd</span><span class="op" id="6764098">.</span><span class="ident" id="6764099">family</span><span class="op" id="6764105">,</span>&nbsp;<span class="ident" id="6764107">a</span><span class="op" id="6764108">.</span><span class="ident" id="6764109">family</span><span class="op" id="6764115">(</span><span class="op" id="6764116">)</span><span class="op" id="6764117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764129">default</span><span class="op" id="6764136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764140">t</span><span class="op" id="6764141">.</span><span class="ident" id="6764142">Fatalf</span><span class="op" id="6764148">(</span><span class="string" id="6764149">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="6764187">,</span>&nbsp;<span class="ident" id="6764189">a</span><span class="op" id="6764190">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764193">}</span><br>
<span class="lineno"></span><span class="op" id="6764195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764198">var</span>&nbsp;<span class="ident" id="6764202">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6764229">=</span>&nbsp;<span class="op" id="6764231">[</span><span class="op" id="6764232">]</span><span class="keyword" id="6764233">struct</span>&nbsp;<span class="op" id="6764240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764243">net</span>&nbsp;&nbsp;<span class="builtintype" id="6764248">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764256">addr</span>&nbsp;<span class="builtintype" id="6764261">string</span><br>
<span class="lineno"></span><span class="op" id="6764268">}</span><span class="op" id="6764269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764272">{</span><span class="string" id="6764273">&#34;tcp6&#34;</span><span class="op" id="6764279">,</span>&nbsp;<span class="string" id="6764281">&#34;127.0.0.1&#34;</span><span class="op" id="6764292">}</span><span class="op" id="6764293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764296">{</span><span class="string" id="6764297">&#34;tcp6&#34;</span><span class="op" id="6764303">,</span>&nbsp;<span class="string" id="6764305">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6764325">}</span><span class="op" id="6764326">,</span><br>
<span class="lineno"></span><span class="op" id="6764328">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="6764331">func</span>&nbsp;<span class="ident" id="6764336">TestProhibitionaryDialArgs</span><span class="op" id="6764362">(</span><span class="ident" id="6764363">t</span>&nbsp;<span class="op" id="6764365">*</span><span class="ident" id="6764366">testing</span><span class="op" id="6764373">.</span><span class="ident" id="6764374">T</span><span class="op" id="6764375">)</span>&nbsp;<span class="op" id="6764377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764380">switch</span>&nbsp;<span class="ident" id="6764387">runtime</span><span class="op" id="6764394">.</span><span class="ident" id="6764395">GOOS</span>&nbsp;<span class="op" id="6764400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764403">case</span>&nbsp;<span class="string" id="6764408">&#34;plan9&#34;</span><span class="op" id="6764415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764419">t</span><span class="op" id="6764420">.</span><span class="ident" id="6764421">Skipf</span><span class="op" id="6764426">(</span><span class="string" id="6764427">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6764448">,</span>&nbsp;<span class="ident" id="6764450">runtime</span><span class="op" id="6764457">.</span><span class="ident" id="6764458">GOOS</span><span class="op" id="6764462">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6764468">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764538">if</span>&nbsp;<span class="op" id="6764541">!</span><span class="ident" id="6764542">supportsIPv4map</span>&nbsp;<span class="op" id="6764558">||</span>&nbsp;<span class="ident" id="6764561">testing</span><span class="op" id="6764568">.</span><span class="ident" id="6764569">Short</span><span class="op" id="6764574">(</span><span class="op" id="6764575">)</span>&nbsp;<span class="op" id="6764577">||</span>&nbsp;<span class="op" id="6764580">!</span><span class="op" id="6764581">*</span><span class="ident" id="6764582">testExternal</span>&nbsp;<span class="op" id="6764595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764599">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764607">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764611">l</span><span class="op" id="6764612">,</span>&nbsp;<span class="ident" id="6764614">port</span>&nbsp;<span class="op" id="6764619">:=</span>&nbsp;<span class="ident" id="6764622">usableListenPort</span><span class="op" id="6764638">(</span><span class="ident" id="6764639">t</span><span class="op" id="6764640">,</span>&nbsp;<span class="string" id="6764642">&#34;tcp&#34;</span><span class="op" id="6764647">,</span>&nbsp;<span class="string" id="6764649">&#34;[::]&#34;</span><span class="op" id="6764655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764658">defer</span>&nbsp;<span class="ident" id="6764664">l</span><span class="op" id="6764665">.</span><span class="ident" id="6764666">Close</span><span class="op" id="6764671">(</span><span class="op" id="6764672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764676">for</span>&nbsp;<span class="ident" id="6764680">_</span><span class="op" id="6764681">,</span>&nbsp;<span class="ident" id="6764683">tt</span>&nbsp;<span class="op" id="6764686">:=</span>&nbsp;<span class="keyword" id="6764689">range</span>&nbsp;<span class="ident" id="6764695">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6764722">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764726">c</span><span class="op" id="6764727">,</span>&nbsp;<span class="ident" id="6764729">err</span>&nbsp;<span class="op" id="6764733">:=</span>&nbsp;<span class="ident" id="6764736">Dial</span><span class="op" id="6764740">(</span><span class="ident" id="6764741">tt</span><span class="op" id="6764743">.</span><span class="ident" id="6764744">net</span><span class="op" id="6764747">,</span>&nbsp;<span class="ident" id="6764749">tt</span><span class="op" id="6764751">.</span><span class="ident" id="6764752">addr</span><span class="op" id="6764756">+</span><span class="string" id="6764757">&#34;:&#34;</span><span class="op" id="6764760">+</span><span class="ident" id="6764761">port</span><span class="op" id="6764765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764769">if</span>&nbsp;<span class="ident" id="6764772">err</span>&nbsp;<span class="op" id="6764776">==</span>&nbsp;<span class="ident" id="6764779">nil</span>&nbsp;<span class="op" id="6764783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764788">c</span><span class="op" id="6764789">.</span><span class="ident" id="6764790">Close</span><span class="op" id="6764795">(</span><span class="op" id="6764796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764801">t</span><span class="op" id="6764802">.</span><span class="ident" id="6764803">Fatalf</span><span class="op" id="6764809">(</span><span class="string" id="6764810">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6764836">,</span>&nbsp;<span class="ident" id="6764838">tt</span><span class="op" id="6764840">.</span><span class="ident" id="6764841">net</span><span class="op" id="6764844">,</span>&nbsp;<span class="ident" id="6764846">tt</span><span class="op" id="6764848">.</span><span class="ident" id="6764849">addr</span><span class="op" id="6764853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764857">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764860">}</span><br>
<span class="lineno"></span><span class="op" id="6764862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764865">func</span>&nbsp;<span class="ident" id="6764870">TestWildWildcardListener</span><span class="op" id="6764894">(</span><span class="ident" id="6764895">t</span>&nbsp;<span class="op" id="6764897">*</span><span class="ident" id="6764898">testing</span><span class="op" id="6764905">.</span><span class="ident" id="6764906">T</span><span class="op" id="6764907">)</span>&nbsp;<span class="op" id="6764909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764912">switch</span>&nbsp;<span class="ident" id="6764919">runtime</span><span class="op" id="6764926">.</span><span class="ident" id="6764927">GOOS</span>&nbsp;<span class="op" id="6764932">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764935">case</span>&nbsp;<span class="string" id="6764940">&#34;plan9&#34;</span><span class="op" id="6764947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764951">t</span><span class="op" id="6764952">.</span><span class="ident" id="6764953">Skipf</span><span class="op" id="6764958">(</span><span class="string" id="6764959">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6764980">,</span>&nbsp;<span class="ident" id="6764982">runtime</span><span class="op" id="6764989">.</span><span class="ident" id="6764990">GOOS</span><span class="op" id="6764994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765001">if</span>&nbsp;<span class="ident" id="6765004">testing</span><span class="op" id="6765011">.</span><span class="ident" id="6765012">Short</span><span class="op" id="6765017">(</span><span class="op" id="6765018">)</span>&nbsp;<span class="op" id="6765020">||</span>&nbsp;<span class="op" id="6765023">!</span><span class="op" id="6765024">*</span><span class="ident" id="6765025">testExternal</span>&nbsp;<span class="op" id="6765038">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765042">t</span><span class="op" id="6765043">.</span><span class="ident" id="6765044">Skip</span><span class="op" id="6765048">(</span><span class="string" id="6765049">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6765090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765097">defer</span>&nbsp;<span class="keyword" id="6765103">func</span><span class="op" id="6765107">(</span><span class="op" id="6765108">)</span>&nbsp;<span class="op" id="6765110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765114">if</span>&nbsp;<span class="ident" id="6765117">p</span>&nbsp;<span class="op" id="6765119">:=</span>&nbsp;<span class="builtinfunc" id="6765122">recover</span><span class="op" id="6765129">(</span><span class="op" id="6765130">)</span><span class="op" id="6765131">;</span>&nbsp;<span class="ident" id="6765133">p</span>&nbsp;<span class="op" id="6765135">!=</span>&nbsp;<span class="ident" id="6765138">nil</span>&nbsp;<span class="op" id="6765142">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765147">t</span><span class="op" id="6765148">.</span><span class="ident" id="6765149">Fatalf</span><span class="op" id="6765155">(</span><span class="string" id="6765156">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6765219">,</span>&nbsp;<span class="ident" id="6765221">p</span><span class="op" id="6765222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765229">}</span><span class="op" id="6765230">(</span><span class="op" id="6765231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765235">if</span>&nbsp;<span class="ident" id="6765238">ln</span><span class="op" id="6765240">,</span>&nbsp;<span class="ident" id="6765242">err</span>&nbsp;<span class="op" id="6765246">:=</span>&nbsp;<span class="ident" id="6765249">Listen</span><span class="op" id="6765255">(</span><span class="string" id="6765256">&#34;tcp&#34;</span><span class="op" id="6765261">,</span>&nbsp;<span class="string" id="6765263">&#34;&#34;</span><span class="op" id="6765265">)</span><span class="op" id="6765266">;</span>&nbsp;<span class="ident" id="6765268">err</span>&nbsp;<span class="op" id="6765272">==</span>&nbsp;<span class="ident" id="6765275">nil</span>&nbsp;<span class="op" id="6765279">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765283">ln</span><span class="op" id="6765285">.</span><span class="ident" id="6765286">Close</span><span class="op" id="6765291">(</span><span class="op" id="6765292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765298">if</span>&nbsp;<span class="ident" id="6765301">ln</span><span class="op" id="6765303">,</span>&nbsp;<span class="ident" id="6765305">err</span>&nbsp;<span class="op" id="6765309">:=</span>&nbsp;<span class="ident" id="6765312">ListenPacket</span><span class="op" id="6765324">(</span><span class="string" id="6765325">&#34;udp&#34;</span><span class="op" id="6765330">,</span>&nbsp;<span class="string" id="6765332">&#34;&#34;</span><span class="op" id="6765334">)</span><span class="op" id="6765335">;</span>&nbsp;<span class="ident" id="6765337">err</span>&nbsp;<span class="op" id="6765341">==</span>&nbsp;<span class="ident" id="6765344">nil</span>&nbsp;<span class="op" id="6765348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765352">ln</span><span class="op" id="6765354">.</span><span class="ident" id="6765355">Close</span><span class="op" id="6765360">(</span><span class="op" id="6765361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765364">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765367">if</span>&nbsp;<span class="ident" id="6765370">ln</span><span class="op" id="6765372">,</span>&nbsp;<span class="ident" id="6765374">err</span>&nbsp;<span class="op" id="6765378">:=</span>&nbsp;<span class="ident" id="6765381">ListenTCP</span><span class="op" id="6765390">(</span><span class="string" id="6765391">&#34;tcp&#34;</span><span class="op" id="6765396">,</span>&nbsp;<span class="ident" id="6765398">nil</span><span class="op" id="6765401">)</span><span class="op" id="6765402">;</span>&nbsp;<span class="ident" id="6765404">err</span>&nbsp;<span class="op" id="6765408">==</span>&nbsp;<span class="ident" id="6765411">nil</span>&nbsp;<span class="op" id="6765415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765419">ln</span><span class="op" id="6765421">.</span><span class="ident" id="6765422">Close</span><span class="op" id="6765427">(</span><span class="op" id="6765428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765434">if</span>&nbsp;<span class="ident" id="6765437">ln</span><span class="op" id="6765439">,</span>&nbsp;<span class="ident" id="6765441">err</span>&nbsp;<span class="op" id="6765445">:=</span>&nbsp;<span class="ident" id="6765448">ListenUDP</span><span class="op" id="6765457">(</span><span class="string" id="6765458">&#34;udp&#34;</span><span class="op" id="6765463">,</span>&nbsp;<span class="ident" id="6765465">nil</span><span class="op" id="6765468">)</span><span class="op" id="6765469">;</span>&nbsp;<span class="ident" id="6765471">err</span>&nbsp;<span class="op" id="6765475">==</span>&nbsp;<span class="ident" id="6765478">nil</span>&nbsp;<span class="op" id="6765482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765486">ln</span><span class="op" id="6765488">.</span><span class="ident" id="6765489">Close</span><span class="op" id="6765494">(</span><span class="op" id="6765495">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765501">if</span>&nbsp;<span class="ident" id="6765504">ln</span><span class="op" id="6765506">,</span>&nbsp;<span class="ident" id="6765508">err</span>&nbsp;<span class="op" id="6765512">:=</span>&nbsp;<span class="ident" id="6765515">ListenIP</span><span class="op" id="6765523">(</span><span class="string" id="6765524">&#34;ip:icmp&#34;</span><span class="op" id="6765533">,</span>&nbsp;<span class="ident" id="6765535">nil</span><span class="op" id="6765538">)</span><span class="op" id="6765539">;</span>&nbsp;<span class="ident" id="6765541">err</span>&nbsp;<span class="op" id="6765545">==</span>&nbsp;<span class="ident" id="6765548">nil</span>&nbsp;<span class="op" id="6765552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765556">ln</span><span class="op" id="6765558">.</span><span class="ident" id="6765559">Close</span><span class="op" id="6765564">(</span><span class="op" id="6765565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765568">}</span><br>
<span class="lineno"></span><span class="op" id="6765570">}</span>
</div>
</body>
</html>
