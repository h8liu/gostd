<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6315560">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6315615">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6315669">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6315720">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6315753">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6315817">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6315882">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6315913">//</span><br>
<span class="lineno"></span><span class="comment" id="6315916">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6315974">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6316035">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6316055">package</span>&nbsp;<span class="ident" id="6316063">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6316071">import</span>&nbsp;<span class="op" id="6316078">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316081">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316091">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316098">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316105">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316112">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316118">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316129">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6316137">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6316144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6316147">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6316207">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6316277">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6316346">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6316383">type</span>&nbsp;<span class="ident" id="6316388">Priority</span>&nbsp;<span class="builtintype" id="6316397">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6316402">const</span>&nbsp;<span class="ident" id="6316408">severityMask</span>&nbsp;<span class="op" id="6316421">=</span>&nbsp;<span class="num" id="6316423">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6316428">const</span>&nbsp;<span class="ident" id="6316434">facilityMask</span>&nbsp;<span class="op" id="6316447">=</span>&nbsp;<span class="num" id="6316449">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6316455">const</span>&nbsp;<span class="op" id="6316461">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316464">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316479">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316515">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316563">LOG_EMERG</span>&nbsp;<span class="ident" id="6316573">Priority</span>&nbsp;<span class="op" id="6316582">=</span>&nbsp;<span class="ident" id="6316584">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316590">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316601">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316611">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316620">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316633">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316645">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316655">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6316665">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6316668">const</span>&nbsp;<span class="op" id="6316674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316677">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316692">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316728">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316790">LOG_KERN</span>&nbsp;<span class="ident" id="6316799">Priority</span>&nbsp;<span class="op" id="6316808">=</span>&nbsp;<span class="ident" id="6316810">iota</span>&nbsp;<span class="op" id="6316815">&lt;&lt;</span>&nbsp;<span class="num" id="6316818">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316821">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316831">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316841">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316853">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316863">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316875">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316884">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316894">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316904">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316914">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316928">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316937">_</span>&nbsp;<span class="comment" id="6316939">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316950">_</span>&nbsp;<span class="comment" id="6316952">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316963">_</span>&nbsp;<span class="comment" id="6316965">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316976">_</span>&nbsp;<span class="comment" id="6316978">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316989">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317001">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317013">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317025">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317037">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317049">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317061">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317073">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6317084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317087">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6317135">type</span>&nbsp;<span class="ident" id="6317140">Writer</span>&nbsp;<span class="keyword" id="6317147">struct</span>&nbsp;<span class="op" id="6317154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317157">priority</span>&nbsp;<span class="ident" id="6317166">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317176">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317185">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317193">hostname</span>&nbsp;<span class="builtintype" id="6317202">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317210">network</span>&nbsp;&nbsp;<span class="builtintype" id="6317219">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317227">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6317236">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317245">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6317250">sync</span><span class="op" id="6317254">.</span><span class="ident" id="6317255">Mutex</span>&nbsp;<span class="comment" id="6317261">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317277">conn</span>&nbsp;<span class="ident" id="6317282">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6317293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317296">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6317361">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6317429">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6317494">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6317565">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6317635">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6317663">type</span>&nbsp;<span class="ident" id="6317668">serverConn</span>&nbsp;<span class="keyword" id="6317679">interface</span>&nbsp;<span class="op" id="6317689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317692">writeString</span><span class="op" id="6317703">(</span><span class="ident" id="6317704">p</span>&nbsp;<span class="ident" id="6317706">Priority</span><span class="op" id="6317714">,</span>&nbsp;<span class="ident" id="6317716">hostname</span><span class="op" id="6317724">,</span>&nbsp;<span class="ident" id="6317726">tag</span><span class="op" id="6317729">,</span>&nbsp;<span class="ident" id="6317731">s</span><span class="op" id="6317732">,</span>&nbsp;<span class="ident" id="6317734">nl</span>&nbsp;<span class="builtintype" id="6317737">string</span><span class="op" id="6317743">)</span>&nbsp;<span class="builtintype" id="6317745">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6317752">close</span><span class="op" id="6317757">(</span><span class="op" id="6317758">)</span>&nbsp;<span class="builtintype" id="6317760">error</span><br>
<span class="lineno"></span><span class="op" id="6317766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6317769">type</span>&nbsp;<span class="ident" id="6317774">netConn</span>&nbsp;<span class="keyword" id="6317782">struct</span>&nbsp;<span class="op" id="6317789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317792">local</span>&nbsp;<span class="builtintype" id="6317798">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317804">conn</span>&nbsp;&nbsp;<span class="ident" id="6317810">net</span><span class="op" id="6317813">.</span><span class="ident" id="6317814">Conn</span><br>
<span class="lineno"></span><span class="op" id="6317819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6317822">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6317890">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6317957">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6317981">func</span>&nbsp;<span class="ident" id="6317986">New</span><span class="op" id="6317989">(</span><span class="ident" id="6317990">priority</span>&nbsp;<span class="ident" id="6317999">Priority</span><span class="op" id="6318007">,</span>&nbsp;<span class="ident" id="6318009">tag</span>&nbsp;<span class="builtintype" id="6318013">string</span><span class="op" id="6318019">)</span>&nbsp;<span class="op" id="6318021">(</span><span class="ident" id="6318022">w</span>&nbsp;<span class="op" id="6318024">*</span><span class="ident" id="6318025">Writer</span><span class="op" id="6318031">,</span>&nbsp;<span class="ident" id="6318033">err</span>&nbsp;<span class="builtintype" id="6318037">error</span><span class="op" id="6318042">)</span>&nbsp;<span class="op" id="6318044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318047">return</span>&nbsp;<span class="ident" id="6318054">Dial</span><span class="op" id="6318058">(</span><span class="string" id="6318059">&#34;&#34;</span><span class="op" id="6318061">,</span>&nbsp;<span class="string" id="6318063">&#34;&#34;</span><span class="op" id="6318065">,</span>&nbsp;<span class="ident" id="6318067">priority</span><span class="op" id="6318075">,</span>&nbsp;<span class="ident" id="6318077">tag</span><span class="op" id="6318080">)</span><br>
<span class="lineno">115</span><span class="op" id="6318082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318085">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6318151">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6318222">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6318290">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6318298">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6318368">func</span>&nbsp;<span class="ident" id="6318373">Dial</span><span class="op" id="6318377">(</span><span class="ident" id="6318378">network</span><span class="op" id="6318385">,</span>&nbsp;<span class="ident" id="6318387">raddr</span>&nbsp;<span class="builtintype" id="6318393">string</span><span class="op" id="6318399">,</span>&nbsp;<span class="ident" id="6318401">priority</span>&nbsp;<span class="ident" id="6318410">Priority</span><span class="op" id="6318418">,</span>&nbsp;<span class="ident" id="6318420">tag</span>&nbsp;<span class="builtintype" id="6318424">string</span><span class="op" id="6318430">)</span>&nbsp;<span class="op" id="6318432">(</span><span class="op" id="6318433">*</span><span class="ident" id="6318434">Writer</span><span class="op" id="6318440">,</span>&nbsp;<span class="builtintype" id="6318442">error</span><span class="op" id="6318447">)</span>&nbsp;<span class="op" id="6318449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318452">if</span>&nbsp;<span class="ident" id="6318455">priority</span>&nbsp;<span class="op" id="6318464">&lt;</span>&nbsp;<span class="num" id="6318466">0</span>&nbsp;<span class="op" id="6318468">||</span>&nbsp;<span class="ident" id="6318471">priority</span>&nbsp;<span class="op" id="6318480">&gt;</span>&nbsp;<span class="ident" id="6318482">LOG_LOCAL7</span><span class="op" id="6318492">|</span><span class="ident" id="6318493">LOG_DEBUG</span>&nbsp;<span class="op" id="6318503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318507">return</span>&nbsp;<span class="builtintype" id="6318514">nil</span><span class="op" id="6318517">,</span>&nbsp;<span class="ident" id="6318519">errors</span><span class="op" id="6318525">.</span><span class="ident" id="6318526">New</span><span class="op" id="6318529">(</span><span class="string" id="6318530">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6318560">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318567">if</span>&nbsp;<span class="ident" id="6318570">tag</span>&nbsp;<span class="op" id="6318574">==</span>&nbsp;<span class="string" id="6318577">&#34;&#34;</span>&nbsp;<span class="op" id="6318580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318584">tag</span>&nbsp;<span class="op" id="6318588">=</span>&nbsp;<span class="ident" id="6318590">os</span><span class="op" id="6318592">.</span><span class="ident" id="6318593">Args</span><span class="op" id="6318597">[</span><span class="num" id="6318598">0</span><span class="op" id="6318599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318602">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318605">hostname</span><span class="op" id="6318613">,</span>&nbsp;<span class="ident" id="6318615">_</span>&nbsp;<span class="op" id="6318617">:=</span>&nbsp;<span class="ident" id="6318620">os</span><span class="op" id="6318622">.</span><span class="ident" id="6318623">Hostname</span><span class="op" id="6318631">(</span><span class="op" id="6318632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318636">w</span>&nbsp;<span class="op" id="6318638">:=</span>&nbsp;<span class="op" id="6318641">&amp;</span><span class="ident" id="6318642">Writer</span><span class="op" id="6318648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318652">priority</span><span class="op" id="6318660">:</span>&nbsp;<span class="ident" id="6318662">priority</span><span class="op" id="6318670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318674">tag</span><span class="op" id="6318677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318684">tag</span><span class="op" id="6318687">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318691">hostname</span><span class="op" id="6318699">:</span>&nbsp;<span class="ident" id="6318701">hostname</span><span class="op" id="6318709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318713">network</span><span class="op" id="6318720">:</span>&nbsp;&nbsp;<span class="ident" id="6318723">network</span><span class="op" id="6318730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318734">raddr</span><span class="op" id="6318739">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318744">raddr</span><span class="op" id="6318749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318756">w</span><span class="op" id="6318757">.</span><span class="ident" id="6318758">mu</span><span class="op" id="6318760">.</span><span class="ident" id="6318761">Lock</span><span class="op" id="6318765">(</span><span class="op" id="6318766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318769">defer</span>&nbsp;<span class="ident" id="6318775">w</span><span class="op" id="6318776">.</span><span class="ident" id="6318777">mu</span><span class="op" id="6318779">.</span><span class="ident" id="6318780">Unlock</span><span class="op" id="6318786">(</span><span class="op" id="6318787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318791">err</span>&nbsp;<span class="op" id="6318795">:=</span>&nbsp;<span class="ident" id="6318798">w</span><span class="op" id="6318799">.</span><span class="ident" id="6318800">connect</span><span class="op" id="6318807">(</span><span class="op" id="6318808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318811">if</span>&nbsp;<span class="ident" id="6318814">err</span>&nbsp;<span class="op" id="6318818">!=</span>&nbsp;<span class="builtintype" id="6318821">nil</span>&nbsp;<span class="op" id="6318825">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318829">return</span>&nbsp;<span class="builtintype" id="6318836">nil</span><span class="op" id="6318839">,</span>&nbsp;<span class="ident" id="6318841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318849">return</span>&nbsp;<span class="ident" id="6318856">w</span><span class="op" id="6318857">,</span>&nbsp;<span class="ident" id="6318859">err</span><br>
<span class="lineno"></span><span class="op" id="6318863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6318866">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6318918">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6318955">func</span>&nbsp;<span class="op" id="6318960">(</span><span class="ident" id="6318961">w</span>&nbsp;<span class="op" id="6318963">*</span><span class="ident" id="6318964">Writer</span><span class="op" id="6318970">)</span>&nbsp;<span class="ident" id="6318972">connect</span><span class="op" id="6318979">(</span><span class="op" id="6318980">)</span>&nbsp;<span class="op" id="6318982">(</span><span class="ident" id="6318983">err</span>&nbsp;<span class="builtintype" id="6318987">error</span><span class="op" id="6318992">)</span>&nbsp;<span class="op" id="6318994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318997">if</span>&nbsp;<span class="ident" id="6319000">w</span><span class="op" id="6319001">.</span><span class="ident" id="6319002">conn</span>&nbsp;<span class="op" id="6319007">!=</span>&nbsp;<span class="builtintype" id="6319010">nil</span>&nbsp;<span class="op" id="6319014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6319018">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319080">w</span><span class="op" id="6319081">.</span><span class="ident" id="6319082">conn</span><span class="op" id="6319086">.</span><span class="builtinfunc" id="6319087">close</span><span class="op" id="6319092">(</span><span class="op" id="6319093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319097">w</span><span class="op" id="6319098">.</span><span class="ident" id="6319099">conn</span>&nbsp;<span class="op" id="6319104">=</span>&nbsp;<span class="builtintype" id="6319106">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319115">if</span>&nbsp;<span class="ident" id="6319118">w</span><span class="op" id="6319119">.</span><span class="ident" id="6319120">network</span>&nbsp;<span class="op" id="6319128">==</span>&nbsp;<span class="string" id="6319131">&#34;&#34;</span>&nbsp;<span class="op" id="6319134">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319138">w</span><span class="op" id="6319139">.</span><span class="ident" id="6319140">conn</span><span class="op" id="6319144">,</span>&nbsp;<span class="ident" id="6319146">err</span>&nbsp;<span class="op" id="6319150">=</span>&nbsp;<span class="ident" id="6319152">unixSyslog</span><span class="op" id="6319162">(</span><span class="op" id="6319163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319167">if</span>&nbsp;<span class="ident" id="6319170">w</span><span class="op" id="6319171">.</span><span class="ident" id="6319172">hostname</span>&nbsp;<span class="op" id="6319181">==</span>&nbsp;<span class="string" id="6319184">&#34;&#34;</span>&nbsp;<span class="op" id="6319187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319192">w</span><span class="op" id="6319193">.</span><span class="ident" id="6319194">hostname</span>&nbsp;<span class="op" id="6319203">=</span>&nbsp;<span class="string" id="6319205">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319222">}</span>&nbsp;<span class="keyword" id="6319224">else</span>&nbsp;<span class="op" id="6319229">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319233">var</span>&nbsp;<span class="ident" id="6319237">c</span>&nbsp;<span class="ident" id="6319239">net</span><span class="op" id="6319242">.</span><span class="ident" id="6319243">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319250">c</span><span class="op" id="6319251">,</span>&nbsp;<span class="ident" id="6319253">err</span>&nbsp;<span class="op" id="6319257">=</span>&nbsp;<span class="ident" id="6319259">net</span><span class="op" id="6319262">.</span><span class="ident" id="6319263">Dial</span><span class="op" id="6319267">(</span><span class="ident" id="6319268">w</span><span class="op" id="6319269">.</span><span class="ident" id="6319270">network</span><span class="op" id="6319277">,</span>&nbsp;<span class="ident" id="6319279">w</span><span class="op" id="6319280">.</span><span class="ident" id="6319281">raddr</span><span class="op" id="6319286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319290">if</span>&nbsp;<span class="ident" id="6319293">err</span>&nbsp;<span class="op" id="6319297">==</span>&nbsp;<span class="builtintype" id="6319300">nil</span>&nbsp;<span class="op" id="6319304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319309">w</span><span class="op" id="6319310">.</span><span class="ident" id="6319311">conn</span>&nbsp;<span class="op" id="6319316">=</span>&nbsp;<span class="op" id="6319318">&amp;</span><span class="ident" id="6319319">netConn</span><span class="op" id="6319326">{</span><span class="ident" id="6319327">conn</span><span class="op" id="6319331">:</span>&nbsp;<span class="ident" id="6319333">c</span><span class="op" id="6319334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319339">if</span>&nbsp;<span class="ident" id="6319342">w</span><span class="op" id="6319343">.</span><span class="ident" id="6319344">hostname</span>&nbsp;<span class="op" id="6319353">==</span>&nbsp;<span class="string" id="6319356">&#34;&#34;</span>&nbsp;<span class="op" id="6319359">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319365">w</span><span class="op" id="6319366">.</span><span class="ident" id="6319367">hostname</span>&nbsp;<span class="op" id="6319376">=</span>&nbsp;<span class="ident" id="6319378">c</span><span class="op" id="6319379">.</span><span class="ident" id="6319380">LocalAddr</span><span class="op" id="6319389">(</span><span class="op" id="6319390">)</span><span class="op" id="6319391">.</span><span class="ident" id="6319392">String</span><span class="op" id="6319398">(</span><span class="op" id="6319399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319414">return</span><br>
<span class="lineno">175</span><span class="op" id="6319421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6319424">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6319475">func</span>&nbsp;<span class="op" id="6319480">(</span><span class="ident" id="6319481">w</span>&nbsp;<span class="op" id="6319483">*</span><span class="ident" id="6319484">Writer</span><span class="op" id="6319490">)</span>&nbsp;<span class="ident" id="6319492">Write</span><span class="op" id="6319497">(</span><span class="ident" id="6319498">b</span>&nbsp;<span class="op" id="6319500">[</span><span class="op" id="6319501">]</span><span class="builtintype" id="6319502">byte</span><span class="op" id="6319506">)</span>&nbsp;<span class="op" id="6319508">(</span><span class="builtintype" id="6319509">int</span><span class="op" id="6319512">,</span>&nbsp;<span class="builtintype" id="6319514">error</span><span class="op" id="6319519">)</span>&nbsp;<span class="op" id="6319521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319524">return</span>&nbsp;<span class="ident" id="6319531">w</span><span class="op" id="6319532">.</span><span class="ident" id="6319533">writeAndRetry</span><span class="op" id="6319546">(</span><span class="ident" id="6319547">w</span><span class="op" id="6319548">.</span><span class="ident" id="6319549">priority</span><span class="op" id="6319557">,</span>&nbsp;<span class="builtintype" id="6319559">string</span><span class="op" id="6319565">(</span><span class="ident" id="6319566">b</span><span class="op" id="6319567">)</span><span class="op" id="6319568">)</span><br>
<span class="lineno">180</span><span class="op" id="6319570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6319573">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6319624">func</span>&nbsp;<span class="op" id="6319629">(</span><span class="ident" id="6319630">w</span>&nbsp;<span class="op" id="6319632">*</span><span class="ident" id="6319633">Writer</span><span class="op" id="6319639">)</span>&nbsp;<span class="ident" id="6319641">Close</span><span class="op" id="6319646">(</span><span class="op" id="6319647">)</span>&nbsp;<span class="builtintype" id="6319649">error</span>&nbsp;<span class="op" id="6319655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319658">w</span><span class="op" id="6319659">.</span><span class="ident" id="6319660">mu</span><span class="op" id="6319662">.</span><span class="ident" id="6319663">Lock</span><span class="op" id="6319667">(</span><span class="op" id="6319668">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319671">defer</span>&nbsp;<span class="ident" id="6319677">w</span><span class="op" id="6319678">.</span><span class="ident" id="6319679">mu</span><span class="op" id="6319681">.</span><span class="ident" id="6319682">Unlock</span><span class="op" id="6319688">(</span><span class="op" id="6319689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319693">if</span>&nbsp;<span class="ident" id="6319696">w</span><span class="op" id="6319697">.</span><span class="ident" id="6319698">conn</span>&nbsp;<span class="op" id="6319703">!=</span>&nbsp;<span class="builtintype" id="6319706">nil</span>&nbsp;<span class="op" id="6319710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319714">err</span>&nbsp;<span class="op" id="6319718">:=</span>&nbsp;<span class="ident" id="6319721">w</span><span class="op" id="6319722">.</span><span class="ident" id="6319723">conn</span><span class="op" id="6319727">.</span><span class="builtinfunc" id="6319728">close</span><span class="op" id="6319733">(</span><span class="op" id="6319734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319738">w</span><span class="op" id="6319739">.</span><span class="ident" id="6319740">conn</span>&nbsp;<span class="op" id="6319745">=</span>&nbsp;<span class="builtintype" id="6319747">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319753">return</span>&nbsp;<span class="ident" id="6319760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6319765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319768">return</span>&nbsp;<span class="builtintype" id="6319775">nil</span><br>
<span class="lineno"></span><span class="op" id="6319779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6319782">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6319853">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6319871">func</span>&nbsp;<span class="op" id="6319876">(</span><span class="ident" id="6319877">w</span>&nbsp;<span class="op" id="6319879">*</span><span class="ident" id="6319880">Writer</span><span class="op" id="6319886">)</span>&nbsp;<span class="ident" id="6319888">Emerg</span><span class="op" id="6319893">(</span><span class="ident" id="6319894">m</span>&nbsp;<span class="builtintype" id="6319896">string</span><span class="op" id="6319902">)</span>&nbsp;<span class="op" id="6319904">(</span><span class="ident" id="6319905">err</span>&nbsp;<span class="builtintype" id="6319909">error</span><span class="op" id="6319914">)</span>&nbsp;<span class="op" id="6319916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6319919">_</span><span class="op" id="6319920">,</span>&nbsp;<span class="ident" id="6319922">err</span>&nbsp;<span class="op" id="6319926">=</span>&nbsp;<span class="ident" id="6319928">w</span><span class="op" id="6319929">.</span><span class="ident" id="6319930">writeAndRetry</span><span class="op" id="6319943">(</span><span class="ident" id="6319944">LOG_EMERG</span><span class="op" id="6319953">,</span>&nbsp;<span class="ident" id="6319955">m</span><span class="op" id="6319956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6319959">return</span>&nbsp;<span class="ident" id="6319966">err</span><br>
<span class="lineno">200</span><span class="op" id="6319970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6319973">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6320044">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6320062">func</span>&nbsp;<span class="op" id="6320067">(</span><span class="ident" id="6320068">w</span>&nbsp;<span class="op" id="6320070">*</span><span class="ident" id="6320071">Writer</span><span class="op" id="6320077">)</span>&nbsp;<span class="ident" id="6320079">Alert</span><span class="op" id="6320084">(</span><span class="ident" id="6320085">m</span>&nbsp;<span class="builtintype" id="6320087">string</span><span class="op" id="6320093">)</span>&nbsp;<span class="op" id="6320095">(</span><span class="ident" id="6320096">err</span>&nbsp;<span class="builtintype" id="6320100">error</span><span class="op" id="6320105">)</span>&nbsp;<span class="op" id="6320107">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6320110">_</span><span class="op" id="6320111">,</span>&nbsp;<span class="ident" id="6320113">err</span>&nbsp;<span class="op" id="6320117">=</span>&nbsp;<span class="ident" id="6320119">w</span><span class="op" id="6320120">.</span><span class="ident" id="6320121">writeAndRetry</span><span class="op" id="6320134">(</span><span class="ident" id="6320135">LOG_ALERT</span><span class="op" id="6320144">,</span>&nbsp;<span class="ident" id="6320146">m</span><span class="op" id="6320147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6320150">return</span>&nbsp;<span class="ident" id="6320157">err</span><br>
<span class="lineno"></span><span class="op" id="6320161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6320164">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6320233">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6320251">func</span>&nbsp;<span class="op" id="6320256">(</span><span class="ident" id="6320257">w</span>&nbsp;<span class="op" id="6320259">*</span><span class="ident" id="6320260">Writer</span><span class="op" id="6320266">)</span>&nbsp;<span class="ident" id="6320268">Crit</span><span class="op" id="6320272">(</span><span class="ident" id="6320273">m</span>&nbsp;<span class="builtintype" id="6320275">string</span><span class="op" id="6320281">)</span>&nbsp;<span class="op" id="6320283">(</span><span class="ident" id="6320284">err</span>&nbsp;<span class="builtintype" id="6320288">error</span><span class="op" id="6320293">)</span>&nbsp;<span class="op" id="6320295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6320298">_</span><span class="op" id="6320299">,</span>&nbsp;<span class="ident" id="6320301">err</span>&nbsp;<span class="op" id="6320305">=</span>&nbsp;<span class="ident" id="6320307">w</span><span class="op" id="6320308">.</span><span class="ident" id="6320309">writeAndRetry</span><span class="op" id="6320322">(</span><span class="ident" id="6320323">LOG_CRIT</span><span class="op" id="6320331">,</span>&nbsp;<span class="ident" id="6320333">m</span><span class="op" id="6320334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6320337">return</span>&nbsp;<span class="ident" id="6320344">err</span><br>
<span class="lineno"></span><span class="op" id="6320348">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6320351">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6320418">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6320436">func</span>&nbsp;<span class="op" id="6320441">(</span><span class="ident" id="6320442">w</span>&nbsp;<span class="op" id="6320444">*</span><span class="ident" id="6320445">Writer</span><span class="op" id="6320451">)</span>&nbsp;<span class="ident" id="6320453">Err</span><span class="op" id="6320456">(</span><span class="ident" id="6320457">m</span>&nbsp;<span class="builtintype" id="6320459">string</span><span class="op" id="6320465">)</span>&nbsp;<span class="op" id="6320467">(</span><span class="ident" id="6320468">err</span>&nbsp;<span class="builtintype" id="6320472">error</span><span class="op" id="6320477">)</span>&nbsp;<span class="op" id="6320479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6320482">_</span><span class="op" id="6320483">,</span>&nbsp;<span class="ident" id="6320485">err</span>&nbsp;<span class="op" id="6320489">=</span>&nbsp;<span class="ident" id="6320491">w</span><span class="op" id="6320492">.</span><span class="ident" id="6320493">writeAndRetry</span><span class="op" id="6320506">(</span><span class="ident" id="6320507">LOG_ERR</span><span class="op" id="6320514">,</span>&nbsp;<span class="ident" id="6320516">m</span><span class="op" id="6320517">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6320520">return</span>&nbsp;<span class="ident" id="6320527">err</span><br>
<span class="lineno"></span><span class="op" id="6320531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6320534">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6320600">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6320627">func</span>&nbsp;<span class="op" id="6320632">(</span><span class="ident" id="6320633">w</span>&nbsp;<span class="op" id="6320635">*</span><span class="ident" id="6320636">Writer</span><span class="op" id="6320642">)</span>&nbsp;<span class="ident" id="6320644">Warning</span><span class="op" id="6320651">(</span><span class="ident" id="6320652">m</span>&nbsp;<span class="builtintype" id="6320654">string</span><span class="op" id="6320660">)</span>&nbsp;<span class="op" id="6320662">(</span><span class="ident" id="6320663">err</span>&nbsp;<span class="builtintype" id="6320667">error</span><span class="op" id="6320672">)</span>&nbsp;<span class="op" id="6320674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6320677">_</span><span class="op" id="6320678">,</span>&nbsp;<span class="ident" id="6320680">err</span>&nbsp;<span class="op" id="6320684">=</span>&nbsp;<span class="ident" id="6320686">w</span><span class="op" id="6320687">.</span><span class="ident" id="6320688">writeAndRetry</span><span class="op" id="6320701">(</span><span class="ident" id="6320702">LOG_WARNING</span><span class="op" id="6320713">,</span>&nbsp;<span class="ident" id="6320715">m</span><span class="op" id="6320716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6320719">return</span>&nbsp;<span class="ident" id="6320726">err</span><br>
<span class="lineno"></span><span class="op" id="6320730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6320733">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6320797">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6320824">func</span>&nbsp;<span class="op" id="6320829">(</span><span class="ident" id="6320830">w</span>&nbsp;<span class="op" id="6320832">*</span><span class="ident" id="6320833">Writer</span><span class="op" id="6320839">)</span>&nbsp;<span class="ident" id="6320841">Notice</span><span class="op" id="6320847">(</span><span class="ident" id="6320848">m</span>&nbsp;<span class="builtintype" id="6320850">string</span><span class="op" id="6320856">)</span>&nbsp;<span class="op" id="6320858">(</span><span class="ident" id="6320859">err</span>&nbsp;<span class="builtintype" id="6320863">error</span><span class="op" id="6320868">)</span>&nbsp;<span class="op" id="6320870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6320873">_</span><span class="op" id="6320874">,</span>&nbsp;<span class="ident" id="6320876">err</span>&nbsp;<span class="op" id="6320880">=</span>&nbsp;<span class="ident" id="6320882">w</span><span class="op" id="6320883">.</span><span class="ident" id="6320884">writeAndRetry</span><span class="op" id="6320897">(</span><span class="ident" id="6320898">LOG_NOTICE</span><span class="op" id="6320908">,</span>&nbsp;<span class="ident" id="6320910">m</span><span class="op" id="6320911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6320914">return</span>&nbsp;<span class="ident" id="6320921">err</span><br>
<span class="lineno">235</span><span class="op" id="6320925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6320928">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6320997">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6321015">func</span>&nbsp;<span class="op" id="6321020">(</span><span class="ident" id="6321021">w</span>&nbsp;<span class="op" id="6321023">*</span><span class="ident" id="6321024">Writer</span><span class="op" id="6321030">)</span>&nbsp;<span class="ident" id="6321032">Info</span><span class="op" id="6321036">(</span><span class="ident" id="6321037">m</span>&nbsp;<span class="builtintype" id="6321039">string</span><span class="op" id="6321045">)</span>&nbsp;<span class="op" id="6321047">(</span><span class="ident" id="6321048">err</span>&nbsp;<span class="builtintype" id="6321052">error</span><span class="op" id="6321057">)</span>&nbsp;<span class="op" id="6321059">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321062">_</span><span class="op" id="6321063">,</span>&nbsp;<span class="ident" id="6321065">err</span>&nbsp;<span class="op" id="6321069">=</span>&nbsp;<span class="ident" id="6321071">w</span><span class="op" id="6321072">.</span><span class="ident" id="6321073">writeAndRetry</span><span class="op" id="6321086">(</span><span class="ident" id="6321087">LOG_INFO</span><span class="op" id="6321095">,</span>&nbsp;<span class="ident" id="6321097">m</span><span class="op" id="6321098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321101">return</span>&nbsp;<span class="ident" id="6321108">err</span><br>
<span class="lineno"></span><span class="op" id="6321112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6321115">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6321186">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6321204">func</span>&nbsp;<span class="op" id="6321209">(</span><span class="ident" id="6321210">w</span>&nbsp;<span class="op" id="6321212">*</span><span class="ident" id="6321213">Writer</span><span class="op" id="6321219">)</span>&nbsp;<span class="ident" id="6321221">Debug</span><span class="op" id="6321226">(</span><span class="ident" id="6321227">m</span>&nbsp;<span class="builtintype" id="6321229">string</span><span class="op" id="6321235">)</span>&nbsp;<span class="op" id="6321237">(</span><span class="ident" id="6321238">err</span>&nbsp;<span class="builtintype" id="6321242">error</span><span class="op" id="6321247">)</span>&nbsp;<span class="op" id="6321249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321252">_</span><span class="op" id="6321253">,</span>&nbsp;<span class="ident" id="6321255">err</span>&nbsp;<span class="op" id="6321259">=</span>&nbsp;<span class="ident" id="6321261">w</span><span class="op" id="6321262">.</span><span class="ident" id="6321263">writeAndRetry</span><span class="op" id="6321276">(</span><span class="ident" id="6321277">LOG_DEBUG</span><span class="op" id="6321286">,</span>&nbsp;<span class="ident" id="6321288">m</span><span class="op" id="6321289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321292">return</span>&nbsp;<span class="ident" id="6321299">err</span><br>
<span class="lineno"></span><span class="op" id="6321303">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6321306">func</span>&nbsp;<span class="op" id="6321311">(</span><span class="ident" id="6321312">w</span>&nbsp;<span class="op" id="6321314">*</span><span class="ident" id="6321315">Writer</span><span class="op" id="6321321">)</span>&nbsp;<span class="ident" id="6321323">writeAndRetry</span><span class="op" id="6321336">(</span><span class="ident" id="6321337">p</span>&nbsp;<span class="ident" id="6321339">Priority</span><span class="op" id="6321347">,</span>&nbsp;<span class="ident" id="6321349">s</span>&nbsp;<span class="builtintype" id="6321351">string</span><span class="op" id="6321357">)</span>&nbsp;<span class="op" id="6321359">(</span><span class="builtintype" id="6321360">int</span><span class="op" id="6321363">,</span>&nbsp;<span class="builtintype" id="6321365">error</span><span class="op" id="6321370">)</span>&nbsp;<span class="op" id="6321372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321375">pr</span>&nbsp;<span class="op" id="6321378">:=</span>&nbsp;<span class="op" id="6321381">(</span><span class="ident" id="6321382">w</span><span class="op" id="6321383">.</span><span class="ident" id="6321384">priority</span>&nbsp;<span class="op" id="6321393">&amp;</span>&nbsp;<span class="ident" id="6321395">facilityMask</span><span class="op" id="6321407">)</span>&nbsp;<span class="op" id="6321409">|</span>&nbsp;<span class="op" id="6321411">(</span><span class="ident" id="6321412">p</span>&nbsp;<span class="op" id="6321414">&amp;</span>&nbsp;<span class="ident" id="6321416">severityMask</span><span class="op" id="6321428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321432">w</span><span class="op" id="6321433">.</span><span class="ident" id="6321434">mu</span><span class="op" id="6321436">.</span><span class="ident" id="6321437">Lock</span><span class="op" id="6321441">(</span><span class="op" id="6321442">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321445">defer</span>&nbsp;<span class="ident" id="6321451">w</span><span class="op" id="6321452">.</span><span class="ident" id="6321453">mu</span><span class="op" id="6321455">.</span><span class="ident" id="6321456">Unlock</span><span class="op" id="6321462">(</span><span class="op" id="6321463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321467">if</span>&nbsp;<span class="ident" id="6321470">w</span><span class="op" id="6321471">.</span><span class="ident" id="6321472">conn</span>&nbsp;<span class="op" id="6321477">!=</span>&nbsp;<span class="builtintype" id="6321480">nil</span>&nbsp;<span class="op" id="6321484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321488">if</span>&nbsp;<span class="ident" id="6321491">n</span><span class="op" id="6321492">,</span>&nbsp;<span class="ident" id="6321494">err</span>&nbsp;<span class="op" id="6321498">:=</span>&nbsp;<span class="ident" id="6321501">w</span><span class="op" id="6321502">.</span><span class="ident" id="6321503">write</span><span class="op" id="6321508">(</span><span class="ident" id="6321509">pr</span><span class="op" id="6321511">,</span>&nbsp;<span class="ident" id="6321513">s</span><span class="op" id="6321514">)</span><span class="op" id="6321515">;</span>&nbsp;<span class="ident" id="6321517">err</span>&nbsp;<span class="op" id="6321521">==</span>&nbsp;<span class="builtintype" id="6321524">nil</span>&nbsp;<span class="op" id="6321528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321533">return</span>&nbsp;<span class="ident" id="6321540">n</span><span class="op" id="6321541">,</span>&nbsp;<span class="ident" id="6321543">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321555">if</span>&nbsp;<span class="ident" id="6321558">err</span>&nbsp;<span class="op" id="6321562">:=</span>&nbsp;<span class="ident" id="6321565">w</span><span class="op" id="6321566">.</span><span class="ident" id="6321567">connect</span><span class="op" id="6321574">(</span><span class="op" id="6321575">)</span><span class="op" id="6321576">;</span>&nbsp;<span class="ident" id="6321578">err</span>&nbsp;<span class="op" id="6321582">!=</span>&nbsp;<span class="builtintype" id="6321585">nil</span>&nbsp;<span class="op" id="6321589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321593">return</span>&nbsp;<span class="num" id="6321600">0</span><span class="op" id="6321601">,</span>&nbsp;<span class="ident" id="6321603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321608">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321611">return</span>&nbsp;<span class="ident" id="6321618">w</span><span class="op" id="6321619">.</span><span class="ident" id="6321620">write</span><span class="op" id="6321625">(</span><span class="ident" id="6321626">pr</span><span class="op" id="6321628">,</span>&nbsp;<span class="ident" id="6321630">s</span><span class="op" id="6321631">)</span><br>
<span class="lineno"></span><span class="op" id="6321633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6321636">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6321697">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6321760">func</span>&nbsp;<span class="op" id="6321765">(</span><span class="ident" id="6321766">w</span>&nbsp;<span class="op" id="6321768">*</span><span class="ident" id="6321769">Writer</span><span class="op" id="6321775">)</span>&nbsp;<span class="ident" id="6321777">write</span><span class="op" id="6321782">(</span><span class="ident" id="6321783">p</span>&nbsp;<span class="ident" id="6321785">Priority</span><span class="op" id="6321793">,</span>&nbsp;<span class="ident" id="6321795">msg</span>&nbsp;<span class="builtintype" id="6321799">string</span><span class="op" id="6321805">)</span>&nbsp;<span class="op" id="6321807">(</span><span class="builtintype" id="6321808">int</span><span class="op" id="6321811">,</span>&nbsp;<span class="builtintype" id="6321813">error</span><span class="op" id="6321818">)</span>&nbsp;<span class="op" id="6321820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6321823">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321850">nl</span>&nbsp;<span class="op" id="6321853">:=</span>&nbsp;<span class="string" id="6321856">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321860">if</span>&nbsp;<span class="op" id="6321863">!</span><span class="ident" id="6321864">strings</span><span class="op" id="6321871">.</span><span class="ident" id="6321872">HasSuffix</span><span class="op" id="6321881">(</span><span class="ident" id="6321882">msg</span><span class="op" id="6321885">,</span>&nbsp;<span class="string" id="6321887">&#34;\n&#34;</span><span class="op" id="6321891">)</span>&nbsp;<span class="op" id="6321893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321897">nl</span>&nbsp;<span class="op" id="6321900">=</span>&nbsp;<span class="string" id="6321902">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6321912">err</span>&nbsp;<span class="op" id="6321916">:=</span>&nbsp;<span class="ident" id="6321919">w</span><span class="op" id="6321920">.</span><span class="ident" id="6321921">conn</span><span class="op" id="6321925">.</span><span class="ident" id="6321926">writeString</span><span class="op" id="6321937">(</span><span class="ident" id="6321938">p</span><span class="op" id="6321939">,</span>&nbsp;<span class="ident" id="6321941">w</span><span class="op" id="6321942">.</span><span class="ident" id="6321943">hostname</span><span class="op" id="6321951">,</span>&nbsp;<span class="ident" id="6321953">w</span><span class="op" id="6321954">.</span><span class="ident" id="6321955">tag</span><span class="op" id="6321958">,</span>&nbsp;<span class="ident" id="6321960">msg</span><span class="op" id="6321963">,</span>&nbsp;<span class="ident" id="6321965">nl</span><span class="op" id="6321967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321970">if</span>&nbsp;<span class="ident" id="6321973">err</span>&nbsp;<span class="op" id="6321977">!=</span>&nbsp;<span class="builtintype" id="6321980">nil</span>&nbsp;<span class="op" id="6321984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6321988">return</span>&nbsp;<span class="num" id="6321995">0</span><span class="op" id="6321996">,</span>&nbsp;<span class="ident" id="6321998">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322006">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322066">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322126">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6322144">return</span>&nbsp;<span class="builtinfunc" id="6322151">len</span><span class="op" id="6322154">(</span><span class="ident" id="6322155">msg</span><span class="op" id="6322158">)</span><span class="op" id="6322159">,</span>&nbsp;<span class="builtintype" id="6322161">nil</span><br>
<span class="lineno">285</span><span class="op" id="6322165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322168">func</span>&nbsp;<span class="op" id="6322173">(</span><span class="ident" id="6322174">n</span>&nbsp;<span class="op" id="6322176">*</span><span class="ident" id="6322177">netConn</span><span class="op" id="6322184">)</span>&nbsp;<span class="ident" id="6322186">writeString</span><span class="op" id="6322197">(</span><span class="ident" id="6322198">p</span>&nbsp;<span class="ident" id="6322200">Priority</span><span class="op" id="6322208">,</span>&nbsp;<span class="ident" id="6322210">hostname</span><span class="op" id="6322218">,</span>&nbsp;<span class="ident" id="6322220">tag</span><span class="op" id="6322223">,</span>&nbsp;<span class="ident" id="6322225">msg</span><span class="op" id="6322228">,</span>&nbsp;<span class="ident" id="6322230">nl</span>&nbsp;<span class="builtintype" id="6322233">string</span><span class="op" id="6322239">)</span>&nbsp;<span class="builtintype" id="6322241">error</span>&nbsp;<span class="op" id="6322247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6322250">if</span>&nbsp;<span class="ident" id="6322253">n</span><span class="op" id="6322254">.</span><span class="ident" id="6322255">local</span>&nbsp;<span class="op" id="6322261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322265">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322323">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6322371">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322421">timestamp</span>&nbsp;<span class="op" id="6322431">:=</span>&nbsp;<span class="ident" id="6322434">time</span><span class="op" id="6322438">.</span><span class="ident" id="6322439">Now</span><span class="op" id="6322442">(</span><span class="op" id="6322443">)</span><span class="op" id="6322444">.</span><span class="ident" id="6322445">Format</span><span class="op" id="6322451">(</span><span class="ident" id="6322452">time</span><span class="op" id="6322456">.</span><span class="ident" id="6322457">Stamp</span><span class="op" id="6322462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322466">_</span><span class="op" id="6322467">,</span>&nbsp;<span class="ident" id="6322469">err</span>&nbsp;<span class="op" id="6322473">:=</span>&nbsp;<span class="ident" id="6322476">fmt</span><span class="op" id="6322479">.</span><span class="ident" id="6322480">Fprintf</span><span class="op" id="6322487">(</span><span class="ident" id="6322488">n</span><span class="op" id="6322489">.</span><span class="ident" id="6322490">conn</span><span class="op" id="6322494">,</span>&nbsp;<span class="string" id="6322496">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6322517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322522">p</span><span class="op" id="6322523">,</span>&nbsp;<span class="ident" id="6322525">timestamp</span><span class="op" id="6322534">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322539">tag</span><span class="op" id="6322542">,</span>&nbsp;<span class="ident" id="6322544">os</span><span class="op" id="6322546">.</span><span class="ident" id="6322547">Getpid</span><span class="op" id="6322553">(</span><span class="op" id="6322554">)</span><span class="op" id="6322555">,</span>&nbsp;<span class="ident" id="6322557">msg</span><span class="op" id="6322560">,</span>&nbsp;<span class="ident" id="6322562">nl</span><span class="op" id="6322564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6322568">return</span>&nbsp;<span class="ident" id="6322575">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6322580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322583">timestamp</span>&nbsp;<span class="op" id="6322593">:=</span>&nbsp;<span class="ident" id="6322596">time</span><span class="op" id="6322600">.</span><span class="ident" id="6322601">Now</span><span class="op" id="6322604">(</span><span class="op" id="6322605">)</span><span class="op" id="6322606">.</span><span class="ident" id="6322607">Format</span><span class="op" id="6322613">(</span><span class="ident" id="6322614">time</span><span class="op" id="6322618">.</span><span class="ident" id="6322619">RFC3339</span><span class="op" id="6322626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322629">_</span><span class="op" id="6322630">,</span>&nbsp;<span class="ident" id="6322632">err</span>&nbsp;<span class="op" id="6322636">:=</span>&nbsp;<span class="ident" id="6322639">fmt</span><span class="op" id="6322642">.</span><span class="ident" id="6322643">Fprintf</span><span class="op" id="6322650">(</span><span class="ident" id="6322651">n</span><span class="op" id="6322652">.</span><span class="ident" id="6322653">conn</span><span class="op" id="6322657">,</span>&nbsp;<span class="string" id="6322659">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6322683">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322687">p</span><span class="op" id="6322688">,</span>&nbsp;<span class="ident" id="6322690">timestamp</span><span class="op" id="6322699">,</span>&nbsp;<span class="ident" id="6322701">hostname</span><span class="op" id="6322709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6322713">tag</span><span class="op" id="6322716">,</span>&nbsp;<span class="ident" id="6322718">os</span><span class="op" id="6322720">.</span><span class="ident" id="6322721">Getpid</span><span class="op" id="6322727">(</span><span class="op" id="6322728">)</span><span class="op" id="6322729">,</span>&nbsp;<span class="ident" id="6322731">msg</span><span class="op" id="6322734">,</span>&nbsp;<span class="ident" id="6322736">nl</span><span class="op" id="6322738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6322741">return</span>&nbsp;<span class="ident" id="6322748">err</span><br>
<span class="lineno"></span><span class="op" id="6322752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6322755">func</span>&nbsp;<span class="op" id="6322760">(</span><span class="ident" id="6322761">n</span>&nbsp;<span class="op" id="6322763">*</span><span class="ident" id="6322764">netConn</span><span class="op" id="6322771">)</span>&nbsp;<span class="builtinfunc" id="6322773">close</span><span class="op" id="6322778">(</span><span class="op" id="6322779">)</span>&nbsp;<span class="builtintype" id="6322781">error</span>&nbsp;<span class="op" id="6322787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6322790">return</span>&nbsp;<span class="ident" id="6322797">n</span><span class="op" id="6322798">.</span><span class="ident" id="6322799">conn</span><span class="op" id="6322803">.</span><span class="ident" id="6322804">Close</span><span class="op" id="6322809">(</span><span class="op" id="6322810">)</span><br>
<span class="lineno"></span><span class="op" id="6322812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322815">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6322876">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6322943">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6323007">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6323022">func</span>&nbsp;<span class="ident" id="6323027">NewLogger</span><span class="op" id="6323036">(</span><span class="ident" id="6323037">p</span>&nbsp;<span class="ident" id="6323039">Priority</span><span class="op" id="6323047">,</span>&nbsp;<span class="ident" id="6323049">logFlag</span>&nbsp;<span class="builtintype" id="6323057">int</span><span class="op" id="6323060">)</span>&nbsp;<span class="op" id="6323062">(</span><span class="op" id="6323063">*</span><span class="ident" id="6323064">log</span><span class="op" id="6323067">.</span><span class="ident" id="6323068">Logger</span><span class="op" id="6323074">,</span>&nbsp;<span class="builtintype" id="6323076">error</span><span class="op" id="6323081">)</span>&nbsp;<span class="op" id="6323083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6323086">s</span><span class="op" id="6323087">,</span>&nbsp;<span class="ident" id="6323089">err</span>&nbsp;<span class="op" id="6323093">:=</span>&nbsp;<span class="ident" id="6323096">New</span><span class="op" id="6323099">(</span><span class="ident" id="6323100">p</span><span class="op" id="6323101">,</span>&nbsp;<span class="string" id="6323103">&#34;&#34;</span><span class="op" id="6323105">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323108">if</span>&nbsp;<span class="ident" id="6323111">err</span>&nbsp;<span class="op" id="6323115">!=</span>&nbsp;<span class="builtintype" id="6323118">nil</span>&nbsp;<span class="op" id="6323122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323126">return</span>&nbsp;<span class="builtintype" id="6323133">nil</span><span class="op" id="6323136">,</span>&nbsp;<span class="ident" id="6323138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6323143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6323146">return</span>&nbsp;<span class="ident" id="6323153">log</span><span class="op" id="6323156">.</span><span class="ident" id="6323157">New</span><span class="op" id="6323160">(</span><span class="ident" id="6323161">s</span><span class="op" id="6323162">,</span>&nbsp;<span class="string" id="6323164">&#34;&#34;</span><span class="op" id="6323166">,</span>&nbsp;<span class="ident" id="6323168">logFlag</span><span class="op" id="6323175">)</span><span class="op" id="6323176">,</span>&nbsp;<span class="builtintype" id="6323178">nil</span><br>
<span class="lineno"></span><span class="op" id="6323182">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
