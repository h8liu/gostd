<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html" class="current">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1508232">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1508288">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1508342">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1508393">//&nbsp;CPU&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="1508411">//&nbsp;Based&nbsp;on&nbsp;algorithms&nbsp;and&nbsp;data&nbsp;structures&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1508462">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="1508509">//</span><br>
<span class="lineno"></span><span class="comment" id="1508512">//&nbsp;The&nbsp;main&nbsp;difference&nbsp;between&nbsp;this&nbsp;code&nbsp;and&nbsp;the&nbsp;google-perftools</span><br>
<span class="lineno">10</span><span class="comment" id="1508578">//&nbsp;code&nbsp;is&nbsp;that&nbsp;this&nbsp;code&nbsp;is&nbsp;written&nbsp;to&nbsp;allow&nbsp;copying&nbsp;the&nbsp;profile&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="1508649">//&nbsp;to&nbsp;an&nbsp;arbitrary&nbsp;io.Writer,&nbsp;while&nbsp;the&nbsp;google-perftools&nbsp;code&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="1508718">//&nbsp;writes&nbsp;to&nbsp;an&nbsp;operating&nbsp;system&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="1508757">//</span><br>
<span class="lineno"></span><span class="comment" id="1508760">//&nbsp;The&nbsp;signal&nbsp;handler&nbsp;for&nbsp;the&nbsp;profiling&nbsp;clock&nbsp;tick&nbsp;adds&nbsp;a&nbsp;new&nbsp;stack&nbsp;trace</span><br>
<span class="lineno">15</span><span class="comment" id="1508834">//&nbsp;to&nbsp;a&nbsp;hash&nbsp;table&nbsp;tracking&nbsp;counts&nbsp;for&nbsp;recent&nbsp;traces.&nbsp;&nbsp;Most&nbsp;clock&nbsp;ticks</span><br>
<span class="lineno"></span><span class="comment" id="1508906">//&nbsp;hit&nbsp;in&nbsp;the&nbsp;cache.&nbsp;&nbsp;In&nbsp;the&nbsp;event&nbsp;of&nbsp;a&nbsp;cache&nbsp;miss,&nbsp;an&nbsp;entry&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1508975">//&nbsp;evicted&nbsp;from&nbsp;the&nbsp;hash&nbsp;table,&nbsp;copied&nbsp;to&nbsp;a&nbsp;log&nbsp;that&nbsp;will&nbsp;eventually&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1509047">//&nbsp;written&nbsp;as&nbsp;profile&nbsp;data.&nbsp;&nbsp;The&nbsp;google-perftools&nbsp;code&nbsp;flushed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1509114">//&nbsp;log&nbsp;itself&nbsp;during&nbsp;the&nbsp;signal&nbsp;handler.&nbsp;&nbsp;This&nbsp;code&nbsp;cannot&nbsp;do&nbsp;that,&nbsp;because</span><br>
<span class="lineno">20</span><span class="comment" id="1509190">//&nbsp;the&nbsp;io.Writer&nbsp;might&nbsp;block&nbsp;or&nbsp;need&nbsp;system&nbsp;calls&nbsp;or&nbsp;locks&nbsp;that&nbsp;are&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1509262">//&nbsp;safe&nbsp;to&nbsp;use&nbsp;from&nbsp;within&nbsp;the&nbsp;signal&nbsp;handler.&nbsp;&nbsp;Instead,&nbsp;we&nbsp;split&nbsp;the&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="1509336">//&nbsp;into&nbsp;two&nbsp;halves&nbsp;and&nbsp;let&nbsp;the&nbsp;signal&nbsp;handler&nbsp;fill&nbsp;one&nbsp;half&nbsp;while&nbsp;a&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1509414">//&nbsp;is&nbsp;writing&nbsp;out&nbsp;the&nbsp;other&nbsp;half.&nbsp;&nbsp;When&nbsp;the&nbsp;signal&nbsp;handler&nbsp;fills&nbsp;its&nbsp;half,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1509492">//&nbsp;offers&nbsp;to&nbsp;swap&nbsp;with&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;If&nbsp;the&nbsp;writer&nbsp;is&nbsp;not&nbsp;done&nbsp;with&nbsp;its&nbsp;half,</span><br>
<span class="lineno">25</span><span class="comment" id="1509572">//&nbsp;we&nbsp;lose&nbsp;the&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;clock&nbsp;tick&nbsp;(and&nbsp;record&nbsp;that&nbsp;loss).</span><br>
<span class="lineno"></span><span class="comment" id="1509643">//&nbsp;The&nbsp;goroutine&nbsp;interacts&nbsp;with&nbsp;the&nbsp;signal&nbsp;handler&nbsp;by&nbsp;calling&nbsp;getprofile()&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1509721">//&nbsp;get&nbsp;the&nbsp;next&nbsp;log&nbsp;piece&nbsp;to&nbsp;write,&nbsp;implicitly&nbsp;handing&nbsp;back&nbsp;the&nbsp;last&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="1509794">//&nbsp;piece&nbsp;it&nbsp;obtained.</span><br>
<span class="lineno"></span><span class="comment" id="1509816">//</span><br>
<span class="lineno">30</span><span class="comment" id="1509819">//&nbsp;The&nbsp;state&nbsp;of&nbsp;this&nbsp;dance&nbsp;between&nbsp;the&nbsp;signal&nbsp;handler&nbsp;and&nbsp;the&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1509891">//&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the&nbsp;Profile.handoff&nbsp;field.&nbsp;&nbsp;If&nbsp;handoff&nbsp;==&nbsp;0,&nbsp;then&nbsp;the&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1509972">//&nbsp;is&nbsp;not&nbsp;using&nbsp;either&nbsp;log&nbsp;half&nbsp;and&nbsp;is&nbsp;waiting&nbsp;(or&nbsp;will&nbsp;soon&nbsp;be&nbsp;waiting)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1510049">//&nbsp;a&nbsp;new&nbsp;piece&nbsp;by&nbsp;calling&nbsp;notesleep(&amp;p-&gt;wait).&nbsp;&nbsp;If&nbsp;the&nbsp;signal&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="1510119">//&nbsp;changes&nbsp;handoff&nbsp;from&nbsp;0&nbsp;to&nbsp;non-zero,&nbsp;it&nbsp;must&nbsp;call&nbsp;notewakeup(&amp;p-&gt;wait)</span><br>
<span class="lineno">35</span><span class="comment" id="1510192">//&nbsp;to&nbsp;wake&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;The&nbsp;value&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1510268">//&nbsp;log&nbsp;half&nbsp;being&nbsp;handed&nbsp;off.&nbsp;&nbsp;The&nbsp;goroutine&nbsp;leaves&nbsp;the&nbsp;non-zero&nbsp;value&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1510342">//&nbsp;place&nbsp;until&nbsp;it&nbsp;has&nbsp;finished&nbsp;processing&nbsp;the&nbsp;log&nbsp;half&nbsp;and&nbsp;then&nbsp;flips&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="1510423">//&nbsp;back&nbsp;to&nbsp;zero.&nbsp;&nbsp;Setting&nbsp;the&nbsp;high&nbsp;bit&nbsp;in&nbsp;handoff&nbsp;means&nbsp;that&nbsp;the&nbsp;profiling&nbsp;is&nbsp;over,</span><br>
<span class="lineno"></span><span class="comment" id="1510507">//&nbsp;and&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;now&nbsp;in&nbsp;charge&nbsp;of&nbsp;flushing&nbsp;the&nbsp;data&nbsp;left&nbsp;in&nbsp;the&nbsp;hash&nbsp;table</span><br>
<span class="lineno">40</span><span class="comment" id="1510589">//&nbsp;to&nbsp;the&nbsp;log&nbsp;and&nbsp;returning&nbsp;that&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="1510628">//</span><br>
<span class="lineno"></span><span class="comment" id="1510631">//&nbsp;The&nbsp;handoff&nbsp;field&nbsp;is&nbsp;manipulated&nbsp;using&nbsp;atomic&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="1510692">//&nbsp;For&nbsp;the&nbsp;most&nbsp;part,&nbsp;the&nbsp;manipulation&nbsp;of&nbsp;handoff&nbsp;is&nbsp;orderly:&nbsp;if&nbsp;handoff&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="1510770">//&nbsp;then&nbsp;the&nbsp;signal&nbsp;handler&nbsp;owns&nbsp;it&nbsp;and&nbsp;can&nbsp;change&nbsp;it&nbsp;to&nbsp;non-zero.</span><br>
<span class="lineno">45</span><span class="comment" id="1510836">//&nbsp;If&nbsp;handoff&nbsp;!=&nbsp;0&nbsp;then&nbsp;the&nbsp;goroutine&nbsp;owns&nbsp;it&nbsp;and&nbsp;can&nbsp;change&nbsp;it&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1510909">//&nbsp;If&nbsp;that&nbsp;were&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;story&nbsp;then&nbsp;we&nbsp;would&nbsp;not&nbsp;need&nbsp;to&nbsp;manipulate</span><br>
<span class="lineno"></span><span class="comment" id="1510983">//&nbsp;handoff&nbsp;using&nbsp;atomic&nbsp;operations.&nbsp;&nbsp;The&nbsp;operations&nbsp;are&nbsp;needed,&nbsp;however,</span><br>
<span class="lineno"></span><span class="comment" id="1511056">//&nbsp;in&nbsp;order&nbsp;to&nbsp;let&nbsp;the&nbsp;log&nbsp;closer&nbsp;set&nbsp;the&nbsp;high&nbsp;bit&nbsp;to&nbsp;indicate&nbsp;&#34;EOF&#34;&nbsp;safely</span><br>
<span class="lineno"></span><span class="comment" id="1511132">//&nbsp;in&nbsp;the&nbsp;situation&nbsp;when&nbsp;normally&nbsp;the&nbsp;goroutine&nbsp;&#34;owns&#34;&nbsp;handoff.</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="1511197">package</span>&nbsp;<span class="ident" id="1511205">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1511214">import</span>&nbsp;<span class="string" id="1511221">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="1511231">const</span>&nbsp;<span class="op" id="1511237">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511240">numBuckets</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511256">=</span>&nbsp;<span class="num" id="1511258">1</span>&nbsp;<span class="op" id="1511260">&lt;&lt;</span>&nbsp;<span class="num" id="1511263">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511267">logSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511283">=</span>&nbsp;<span class="num" id="1511285">1</span>&nbsp;<span class="op" id="1511287">&lt;&lt;</span>&nbsp;<span class="num" id="1511290">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511294">assoc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511310">=</span>&nbsp;<span class="num" id="1511312">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511315">maxCPUProfStack</span>&nbsp;<span class="op" id="1511331">=</span>&nbsp;<span class="num" id="1511333">64</span><br>
<span class="lineno">60</span><span class="op" id="1511336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1511339">type</span>&nbsp;<span class="ident" id="1511344">cpuprofEntry</span>&nbsp;<span class="keyword" id="1511357">struct</span>&nbsp;<span class="op" id="1511364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511367">count</span>&nbsp;<span class="builtintype" id="1511373">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511382">depth</span>&nbsp;<span class="builtintype" id="1511388">uintptr</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511397">stack</span>&nbsp;<span class="op" id="1511403">[</span><span class="ident" id="1511404"><a href="/gostd/runtime/cpuprof.go.html#1511315">maxCPUProfStack</a></span><span class="op" id="1511419">]</span><span class="builtintype" id="1511420">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1511428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1511431">type</span>&nbsp;<span class="ident" id="1511436">cpuProfile</span>&nbsp;<span class="keyword" id="1511447">struct</span>&nbsp;<span class="op" id="1511454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511457">on</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1511464">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511472">//&nbsp;profiling&nbsp;is&nbsp;on</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511492">wait</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1511499"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786244">note</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511507">//&nbsp;goroutine&nbsp;waits&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511532">count</span>&nbsp;&nbsp;<span class="builtintype" id="1511539">uintptr</span>&nbsp;<span class="comment" id="1511547">//&nbsp;tick&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511562">evicts</span>&nbsp;<span class="builtintype" id="1511569">uintptr</span>&nbsp;<span class="comment" id="1511577">//&nbsp;eviction&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511596">lost</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1511603">uintptr</span>&nbsp;<span class="comment" id="1511611">//&nbsp;lost&nbsp;ticks&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;logged</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511650">//&nbsp;Active&nbsp;recent&nbsp;stack&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511682">hash</span>&nbsp;<span class="op" id="1511687">[</span><span class="ident" id="1511688"><a href="/gostd/runtime/cpuprof.go.html#1511240">numBuckets</a></span><span class="op" id="1511698">]</span><span class="keyword" id="1511699">struct</span>&nbsp;<span class="op" id="1511706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511710">entry</span>&nbsp;<span class="op" id="1511716">[</span><span class="ident" id="1511717"><a href="/gostd/runtime/cpuprof.go.html#1511294">assoc</a></span><span class="op" id="1511722">]</span><span class="ident" id="1511723"><a href="/gostd/runtime/cpuprof.go.html#1511344">cpuprofEntry</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511741">//&nbsp;Log&nbsp;of&nbsp;traces&nbsp;evicted&nbsp;from&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511778">//&nbsp;Signal&nbsp;handler&nbsp;has&nbsp;filled&nbsp;log[toggle][:nlog].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511828">//&nbsp;Goroutine&nbsp;is&nbsp;writing&nbsp;log[1-toggle][:handoff].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511878">log</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1511886">[</span><span class="num" id="1511887">2</span><span class="op" id="1511888">]</span><span class="op" id="1511889">[</span><span class="ident" id="1511890"><a href="/gostd/runtime/cpuprof.go.html#1511267">logSize</a></span>&nbsp;<span class="op" id="1511898">/</span>&nbsp;<span class="num" id="1511900">2</span><span class="op" id="1511901">]</span><span class="builtintype" id="1511902">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511911">nlog</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1511919">uintptr</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511928">toggle</span>&nbsp;&nbsp;<span class="builtintype" id="1511936">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1511943">handoff</span>&nbsp;<span class="builtintype" id="1511951">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511960">//&nbsp;Writer&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1511978">//&nbsp;Writer&nbsp;maintains&nbsp;its&nbsp;own&nbsp;toggle&nbsp;to&nbsp;avoid&nbsp;races</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1512029">//&nbsp;looking&nbsp;at&nbsp;signal&nbsp;handler&#39;s&nbsp;toggle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512069">wtoggle</span>&nbsp;&nbsp;<span class="builtintype" id="1512078">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512086">wholding</span>&nbsp;<span class="builtintype" id="1512095">bool</span>&nbsp;<span class="comment" id="1512100">//&nbsp;holding&nbsp;&amp;&nbsp;need&nbsp;to&nbsp;release&nbsp;a&nbsp;log&nbsp;half</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512141">flushing</span>&nbsp;<span class="builtintype" id="1512150">bool</span>&nbsp;<span class="comment" id="1512155">//&nbsp;flushing&nbsp;hash&nbsp;table&nbsp;-&nbsp;profile&nbsp;is&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512197">eodSent</span>&nbsp;&nbsp;<span class="builtintype" id="1512206">bool</span>&nbsp;<span class="comment" id="1512211">//&nbsp;special&nbsp;end-of-data&nbsp;record&nbsp;sent;&nbsp;=&gt;&nbsp;flushing</span><br>
<span class="lineno">95</span><span class="op" id="1512259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1512262">var</span>&nbsp;<span class="op" id="1512266">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512269">cpuprofLock</span>&nbsp;<span class="ident" id="1512281"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512288">cpuprof</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1512300">*</span><span class="ident" id="1512301"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512314">eod</span>&nbsp;<span class="op" id="1512318">=</span>&nbsp;<span class="op" id="1512320">[</span><span class="num" id="1512321">3</span><span class="op" id="1512322">]</span><span class="builtintype" id="1512323">uintptr</span><span class="op" id="1512330">{</span><span class="num" id="1512331">0</span><span class="op" id="1512332">,</span>&nbsp;<span class="num" id="1512334">1</span><span class="op" id="1512335">,</span>&nbsp;<span class="num" id="1512337">0</span><span class="op" id="1512338">}</span><br>
<span class="lineno"></span><span class="op" id="1512340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1512343">func</span>&nbsp;<span class="ident" id="1512348">setcpuprofilerate_m</span><span class="op" id="1512367">(</span><span class="op" id="1512368">)</span>&nbsp;<span class="comment" id="1512370">//&nbsp;proc.c</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="1512381">func</span>&nbsp;<span class="ident" id="1512386">setcpuprofilerate</span><span class="op" id="1512403">(</span><span class="ident" id="1512404">hz</span>&nbsp;<span class="builtintype" id="1512407">int32</span><span class="op" id="1512412">)</span>&nbsp;<span class="op" id="1512414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512417">g</span>&nbsp;<span class="op" id="1512419">:=</span>&nbsp;<span class="ident" id="1512422"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1512426">(</span><span class="op" id="1512427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512430"><a href="/gostd/runtime/cpuprof.go.html#1512417">g</a></span><span class="op" id="1512431">.</span><span class="ident" id="1512432"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1512433">.</span><span class="ident" id="1512434"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1512443">[</span><span class="num" id="1512444">0</span><span class="op" id="1512445">]</span>&nbsp;<span class="op" id="1512447">=</span>&nbsp;<span class="builtintype" id="1512449">uintptr</span><span class="op" id="1512456">(</span><span class="ident" id="1512457"><a href="/gostd/runtime/cpuprof.go.html#1512404">hz</a></span><span class="op" id="1512459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1512462"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1512465">(</span><span class="ident" id="1512466"><a href="/gostd/runtime/cpuprof.go.html#1512348">setcpuprofilerate_m</a></span><span class="op" id="1512485">)</span><br>
<span class="lineno">110</span><span class="op" id="1512487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1512490">//&nbsp;lostProfileData&nbsp;is&nbsp;a&nbsp;no-op&nbsp;function&nbsp;used&nbsp;in&nbsp;profiles</span><br>
<span class="lineno"></span><span class="comment" id="1512546">//&nbsp;to&nbsp;mark&nbsp;the&nbsp;number&nbsp;of&nbsp;profiling&nbsp;stack&nbsp;traces&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="1512604">//&nbsp;discarded&nbsp;due&nbsp;to&nbsp;slow&nbsp;data&nbsp;writers.</span><br>
<span class="lineno">115</span><span class="keyword" id="1512643">func</span>&nbsp;<span class="ident" id="1512648">lostProfileData</span><span class="op" id="1512663">(</span><span class="op" id="1512664">)</span>&nbsp;<span class="op" id="1512666">{</span><span class="op" id="1512667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1512670">//&nbsp;SetCPUProfileRate&nbsp;sets&nbsp;the&nbsp;CPU&nbsp;profiling&nbsp;rate&nbsp;to&nbsp;hz&nbsp;samples&nbsp;per&nbsp;second.</span><br>
<span class="lineno"></span><span class="comment" id="1512745">//&nbsp;If&nbsp;hz&nbsp;&lt;=&nbsp;0,&nbsp;SetCPUProfileRate&nbsp;turns&nbsp;off&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="1512799">//&nbsp;If&nbsp;the&nbsp;profiler&nbsp;is&nbsp;on,&nbsp;the&nbsp;rate&nbsp;cannot&nbsp;be&nbsp;changed&nbsp;without&nbsp;first&nbsp;turning&nbsp;it&nbsp;off.</span><br>
<span class="lineno">120</span><span class="comment" id="1512882">//</span><br>
<span class="lineno"></span><span class="comment" id="1512885">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1512941">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.cpuprofile&nbsp;flag&nbsp;instead&nbsp;of&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="1513007">//&nbsp;SetCPUProfileRate&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1513038">func</span>&nbsp;<span class="ident" id="1513043">SetCPUProfileRate</span><span class="op" id="1513060">(</span><span class="ident" id="1513061">hz</span>&nbsp;<span class="builtintype" id="1513064">int</span><span class="op" id="1513067">)</span>&nbsp;<span class="op" id="1513069">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513072">//&nbsp;Clamp&nbsp;hz&nbsp;to&nbsp;something&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513110">if</span>&nbsp;<span class="ident" id="1513113"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span>&nbsp;<span class="op" id="1513116">&lt;</span>&nbsp;<span class="num" id="1513118">0</span>&nbsp;<span class="op" id="1513120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513124"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span>&nbsp;<span class="op" id="1513127">=</span>&nbsp;<span class="num" id="1513129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513135">if</span>&nbsp;<span class="ident" id="1513138"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span>&nbsp;<span class="op" id="1513141">&gt;</span>&nbsp;<span class="num" id="1513143">1000000</span>&nbsp;<span class="op" id="1513151">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513155"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span>&nbsp;<span class="op" id="1513158">=</span>&nbsp;<span class="num" id="1513160">1000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513173"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1513177">(</span><span class="op" id="1513178">&amp;</span><span class="ident" id="1513179"><a href="/gostd/runtime/cpuprof.go.html#1512269">cpuprofLock</a></span><span class="op" id="1513190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513193">if</span>&nbsp;<span class="ident" id="1513196"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span>&nbsp;<span class="op" id="1513199">&gt;</span>&nbsp;<span class="num" id="1513201">0</span>&nbsp;<span class="op" id="1513203">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513207">if</span>&nbsp;<span class="ident" id="1513210"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span>&nbsp;<span class="op" id="1513218">==</span>&nbsp;<span class="builtintype" id="1513221">nil</span>&nbsp;<span class="op" id="1513225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513230"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span>&nbsp;<span class="op" id="1513238">=</span>&nbsp;<span class="op" id="1513240">(</span><span class="op" id="1513241">*</span><span class="ident" id="1513242"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1513252">)</span><span class="op" id="1513253">(</span><span class="ident" id="1513254"><a href="/gostd/runtime/mprof.go.html#1624308">sysAlloc</a></span><span class="op" id="1513262">(</span><span class="ident" id="1513263"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1513269">.</span><span class="ident" id="1513270">Sizeof</span><span class="op" id="1513276">(</span><span class="ident" id="1513277"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1513287">{</span><span class="op" id="1513288">}</span><span class="op" id="1513289">)</span><span class="op" id="1513290">,</span>&nbsp;<span class="op" id="1513292">&amp;</span><span class="ident" id="1513293"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1513301">.</span><span class="ident" id="1513302"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792858">other_sys</a></span><span class="op" id="1513311">)</span><span class="op" id="1513312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513317">if</span>&nbsp;<span class="ident" id="1513320"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span>&nbsp;<span class="op" id="1513328">==</span>&nbsp;<span class="builtintype" id="1513331">nil</span>&nbsp;<span class="op" id="1513335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1513341">print</span><span class="op" id="1513346">(</span><span class="string" id="1513347">&#34;runtime:&nbsp;cpu&nbsp;profiling&nbsp;cannot&nbsp;allocate&nbsp;memory\n&#34;</span><span class="op" id="1513396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513402"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1513408">(</span><span class="op" id="1513409">&amp;</span><span class="ident" id="1513410"><a href="/gostd/runtime/cpuprof.go.html#1512269">cpuprofLock</a></span><span class="op" id="1513421">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513445">if</span>&nbsp;<span class="ident" id="1513448"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1513455">.</span><span class="ident" id="1513456"><a href="/gostd/runtime/cpuprof.go.html#1511457">on</a></span>&nbsp;<span class="op" id="1513459">||</span>&nbsp;<span class="ident" id="1513462"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1513469">.</span><span class="ident" id="1513470"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span>&nbsp;<span class="op" id="1513478">!=</span>&nbsp;<span class="num" id="1513481">0</span>&nbsp;<span class="op" id="1513483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1513488">print</span><span class="op" id="1513493">(</span><span class="string" id="1513494">&#34;runtime:&nbsp;cannot&nbsp;set&nbsp;cpu&nbsp;profile&nbsp;rate&nbsp;until&nbsp;previous&nbsp;profile&nbsp;has&nbsp;finished.\n&#34;</span><span class="op" id="1513571">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513576"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1513582">(</span><span class="op" id="1513583">&amp;</span><span class="ident" id="1513584"><a href="/gostd/runtime/cpuprof.go.html#1512269">cpuprofLock</a></span><span class="op" id="1513595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1513600">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1513609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513614"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1513621">.</span><span class="ident" id="1513622"><a href="/gostd/runtime/cpuprof.go.html#1511457">on</a></span>&nbsp;<span class="op" id="1513625">=</span>&nbsp;<span class="builtintype" id="1513627">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513634">//&nbsp;pprof&nbsp;binary&nbsp;header&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513667">//&nbsp;http://code.google.com/p/google-perftools/source/browse/trunk/src/profiledata.cc#117</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513757">p</span>&nbsp;<span class="op" id="1513759">:=</span>&nbsp;<span class="op" id="1513762">&amp;</span><span class="ident" id="1513763"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1513770">.</span><span class="ident" id="1513771"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1513774">[</span><span class="num" id="1513775">0</span><span class="op" id="1513776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513780"><a href="/gostd/runtime/cpuprof.go.html#1513757">p</a></span><span class="op" id="1513781">[</span><span class="num" id="1513782">0</span><span class="op" id="1513783">]</span>&nbsp;<span class="op" id="1513785">=</span>&nbsp;<span class="num" id="1513787">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513805">//&nbsp;count&nbsp;for&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513827"><a href="/gostd/runtime/cpuprof.go.html#1513757">p</a></span><span class="op" id="1513828">[</span><span class="num" id="1513829">1</span><span class="op" id="1513830">]</span>&nbsp;<span class="op" id="1513832">=</span>&nbsp;<span class="num" id="1513834">3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513852">//&nbsp;depth&nbsp;for&nbsp;header</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513874"><a href="/gostd/runtime/cpuprof.go.html#1513757">p</a></span><span class="op" id="1513875">[</span><span class="num" id="1513876">2</span><span class="op" id="1513877">]</span>&nbsp;<span class="op" id="1513879">=</span>&nbsp;<span class="num" id="1513881">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1513899">//&nbsp;version&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513919"><a href="/gostd/runtime/cpuprof.go.html#1513757">p</a></span><span class="op" id="1513920">[</span><span class="num" id="1513921">3</span><span class="op" id="1513922">]</span>&nbsp;<span class="op" id="1513924">=</span>&nbsp;<span class="builtintype" id="1513926">uintptr</span><span class="op" id="1513933">(</span><span class="num" id="1513934">1e6</span>&nbsp;<span class="op" id="1513938">/</span>&nbsp;<span class="ident" id="1513940"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span><span class="op" id="1513942">)</span>&nbsp;<span class="comment" id="1513944">//&nbsp;period&nbsp;(microseconds)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513971"><a href="/gostd/runtime/cpuprof.go.html#1513757">p</a></span><span class="op" id="1513972">[</span><span class="num" id="1513973">4</span><span class="op" id="1513974">]</span>&nbsp;<span class="op" id="1513976">=</span>&nbsp;<span class="num" id="1513978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1513982"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1513989">.</span><span class="ident" id="1513990"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span>&nbsp;<span class="op" id="1513995">=</span>&nbsp;<span class="num" id="1513997">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514001"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514008">.</span><span class="ident" id="1514009"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span>&nbsp;<span class="op" id="1514016">=</span>&nbsp;<span class="num" id="1514018">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514022"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514029">.</span><span class="ident" id="1514030"><a href="/gostd/runtime/cpuprof.go.html#1512086">wholding</a></span>&nbsp;<span class="op" id="1514039">=</span>&nbsp;<span class="builtintype" id="1514041">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514049"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514056">.</span><span class="ident" id="1514057"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span>&nbsp;<span class="op" id="1514065">=</span>&nbsp;<span class="num" id="1514067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514071"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514078">.</span><span class="ident" id="1514079"><a href="/gostd/runtime/cpuprof.go.html#1512141">flushing</a></span>&nbsp;<span class="op" id="1514088">=</span>&nbsp;<span class="builtintype" id="1514090">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514098"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514105">.</span><span class="ident" id="1514106"><a href="/gostd/runtime/cpuprof.go.html#1512197">eodSent</a></span>&nbsp;<span class="op" id="1514114">=</span>&nbsp;<span class="builtintype" id="1514116">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514124"><a href="/gostd/runtime/lock_futex.go.html#1587088">noteclear</a></span><span class="op" id="1514133">(</span><span class="op" id="1514134">&amp;</span><span class="ident" id="1514135"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514142">.</span><span class="ident" id="1514143"><a href="/gostd/runtime/cpuprof.go.html#1511492">wait</a></span><span class="op" id="1514147">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514152"><a href="/gostd/runtime/cpuprof.go.html#1512386">setcpuprofilerate</a></span><span class="op" id="1514169">(</span><span class="builtintype" id="1514170">int32</span><span class="op" id="1514175">(</span><span class="ident" id="1514176"><a href="/gostd/runtime/cpuprof.go.html#1513061">hz</a></span><span class="op" id="1514178">)</span><span class="op" id="1514179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514182">}</span>&nbsp;<span class="keyword" id="1514184">else</span>&nbsp;<span class="keyword" id="1514189">if</span>&nbsp;<span class="ident" id="1514192"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span>&nbsp;<span class="op" id="1514200">!=</span>&nbsp;<span class="builtintype" id="1514203">nil</span>&nbsp;<span class="op" id="1514207">&amp;&amp;</span>&nbsp;<span class="ident" id="1514210"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514217">.</span><span class="ident" id="1514218"><a href="/gostd/runtime/cpuprof.go.html#1511457">on</a></span>&nbsp;<span class="op" id="1514221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514225"><a href="/gostd/runtime/cpuprof.go.html#1512386">setcpuprofilerate</a></span><span class="op" id="1514242">(</span><span class="num" id="1514243">0</span><span class="op" id="1514244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514248"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514255">.</span><span class="ident" id="1514256"><a href="/gostd/runtime/cpuprof.go.html#1511457">on</a></span>&nbsp;<span class="op" id="1514259">=</span>&nbsp;<span class="builtintype" id="1514261">false</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1514270">//&nbsp;Now&nbsp;add&nbsp;is&nbsp;not&nbsp;running&nbsp;anymore,&nbsp;and&nbsp;getprofile&nbsp;owns&nbsp;the&nbsp;entire&nbsp;log.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1514343">//&nbsp;Set&nbsp;the&nbsp;high&nbsp;bit&nbsp;in&nbsp;prof-&gt;handoff&nbsp;to&nbsp;tell&nbsp;getprofile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514402">for</span>&nbsp;<span class="op" id="1514406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514411">n</span>&nbsp;<span class="op" id="1514413">:=</span>&nbsp;<span class="ident" id="1514416"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514423">.</span><span class="ident" id="1514424"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514435">if</span>&nbsp;<span class="ident" id="1514438"><a href="/gostd/runtime/cpuprof.go.html#1514411">n</a></span><span class="op" id="1514439">&amp;</span><span class="num" id="1514440">0x80000000</span>&nbsp;<span class="op" id="1514451">!=</span>&nbsp;<span class="num" id="1514454">0</span>&nbsp;<span class="op" id="1514456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1514462">print</span><span class="op" id="1514467">(</span><span class="string" id="1514468">&#34;runtime:&nbsp;setcpuprofile(off)&nbsp;twice\n&#34;</span><span class="op" id="1514505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514515">if</span>&nbsp;<span class="ident" id="1514518"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1514521">(</span><span class="op" id="1514522">&amp;</span><span class="ident" id="1514523"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514530">.</span><span class="ident" id="1514531"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1514538">,</span>&nbsp;<span class="ident" id="1514540"><a href="/gostd/runtime/cpuprof.go.html#1514411">n</a></span><span class="op" id="1514541">,</span>&nbsp;<span class="ident" id="1514543"><a href="/gostd/runtime/cpuprof.go.html#1514411">n</a></span><span class="op" id="1514544">|</span><span class="num" id="1514545">0x80000000</span><span class="op" id="1514555">)</span>&nbsp;<span class="op" id="1514557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514563">if</span>&nbsp;<span class="ident" id="1514566"><a href="/gostd/runtime/cpuprof.go.html#1514411">n</a></span>&nbsp;<span class="op" id="1514568">==</span>&nbsp;<span class="num" id="1514571">0</span>&nbsp;<span class="op" id="1514573">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1514580">//&nbsp;we&nbsp;did&nbsp;the&nbsp;transition&nbsp;from&nbsp;0&nbsp;-&gt;&nbsp;nonzero&nbsp;so&nbsp;we&nbsp;wake&nbsp;getprofile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514650"><a href="/gostd/runtime/lock_futex.go.html#1587128">notewakeup</a></span><span class="op" id="1514660">(</span><span class="op" id="1514661">&amp;</span><span class="ident" id="1514662"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514669">.</span><span class="ident" id="1514670"><a href="/gostd/runtime/cpuprof.go.html#1511492">wait</a></span><span class="op" id="1514674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514686">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514695">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514705"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1514711">(</span><span class="op" id="1514712">&amp;</span><span class="ident" id="1514713"><a href="/gostd/runtime/cpuprof.go.html#1512269">cpuprofLock</a></span><span class="op" id="1514724">)</span><br>
<span class="lineno"></span><span class="op" id="1514726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="1514729">func</span>&nbsp;<span class="ident" id="1514734">cpuproftick</span><span class="op" id="1514745">(</span><span class="ident" id="1514746">pc</span>&nbsp;<span class="op" id="1514749">*</span><span class="builtintype" id="1514750">uintptr</span><span class="op" id="1514757">,</span>&nbsp;<span class="ident" id="1514759">n</span>&nbsp;<span class="builtintype" id="1514761">int32</span><span class="op" id="1514766">)</span>&nbsp;<span class="op" id="1514768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1514771">if</span>&nbsp;<span class="ident" id="1514774"><a href="/gostd/runtime/cpuprof.go.html#1514759">n</a></span>&nbsp;<span class="op" id="1514776">&gt;</span>&nbsp;<span class="ident" id="1514778"><a href="/gostd/runtime/cpuprof.go.html#1511315">maxCPUProfStack</a></span>&nbsp;<span class="op" id="1514794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514798"><a href="/gostd/runtime/cpuprof.go.html#1514759">n</a></span>&nbsp;<span class="op" id="1514800">=</span>&nbsp;<span class="ident" id="1514802"><a href="/gostd/runtime/cpuprof.go.html#1511315">maxCPUProfStack</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1514819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514822">s</span>&nbsp;<span class="op" id="1514824">:=</span>&nbsp;<span class="op" id="1514827">(</span><span class="op" id="1514828">*</span><span class="op" id="1514829">[</span><span class="ident" id="1514830"><a href="/gostd/runtime/cpuprof.go.html#1511315">maxCPUProfStack</a></span><span class="op" id="1514845">]</span><span class="builtintype" id="1514846">uintptr</span><span class="op" id="1514853">)</span><span class="op" id="1514854">(</span><span class="ident" id="1514855"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1514861">.</span><span class="ident" id="1514862">Pointer</span><span class="op" id="1514869">(</span><span class="ident" id="1514870"><a href="/gostd/runtime/cpuprof.go.html#1514746">pc</a></span><span class="op" id="1514872">)</span><span class="op" id="1514873">)</span><span class="op" id="1514874">[</span><span class="op" id="1514875">:</span><span class="ident" id="1514876"><a href="/gostd/runtime/cpuprof.go.html#1514759">n</a></span><span class="op" id="1514877">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1514880"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1514887">.</span><span class="ident" id="1514888"><a href="/gostd/runtime/cpuprof.go.html#1515205">add</a></span><span class="op" id="1514891">(</span><span class="ident" id="1514892"><a href="/gostd/runtime/cpuprof.go.html#1514822">s</a></span><span class="op" id="1514893">)</span><br>
<span class="lineno"></span><span class="op" id="1514895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1514898">//&nbsp;add&nbsp;adds&nbsp;the&nbsp;stack&nbsp;trace&nbsp;to&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1514942">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;signal&nbsp;handlers&nbsp;and&nbsp;other&nbsp;limited&nbsp;environments</span><br>
<span class="lineno">200</span><span class="comment" id="1515010">//&nbsp;and&nbsp;cannot&nbsp;allocate&nbsp;memory&nbsp;or&nbsp;acquire&nbsp;locks&nbsp;that&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1515071">//&nbsp;held&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;signal,&nbsp;nor&nbsp;can&nbsp;it&nbsp;use&nbsp;substantial&nbsp;amounts</span><br>
<span class="lineno"></span><span class="comment" id="1515141">//&nbsp;of&nbsp;stack.&nbsp;&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;evict.</span><br>
<span class="lineno"></span><span class="keyword" id="1515184">func</span>&nbsp;<span class="op" id="1515189">(</span><span class="ident" id="1515190">p</span>&nbsp;<span class="op" id="1515192">*</span><span class="ident" id="1515193"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1515203">)</span>&nbsp;<span class="ident" id="1515205">add</span><span class="op" id="1515208">(</span><span class="ident" id="1515209">pc</span>&nbsp;<span class="op" id="1515212">[</span><span class="op" id="1515213">]</span><span class="builtintype" id="1515214">uintptr</span><span class="op" id="1515221">)</span>&nbsp;<span class="op" id="1515223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515226">//&nbsp;Compute&nbsp;hash.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515244">h</span>&nbsp;<span class="op" id="1515246">:=</span>&nbsp;<span class="builtintype" id="1515249">uintptr</span><span class="op" id="1515256">(</span><span class="num" id="1515257">0</span><span class="op" id="1515258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515261">for</span>&nbsp;<span class="ident" id="1515265">_</span><span class="op" id="1515266">,</span>&nbsp;<span class="ident" id="1515268">x</span>&nbsp;<span class="op" id="1515270">:=</span>&nbsp;<span class="keyword" id="1515273">range</span>&nbsp;<span class="ident" id="1515279"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span>&nbsp;<span class="op" id="1515282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515286"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span>&nbsp;<span class="op" id="1515288">=</span>&nbsp;<span class="ident" id="1515290"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span><span class="op" id="1515291">&lt;&lt;</span><span class="num" id="1515293">8</span>&nbsp;<span class="op" id="1515295">|</span>&nbsp;<span class="op" id="1515297">(</span><span class="ident" id="1515298"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span>&nbsp;<span class="op" id="1515300">&gt;&gt;</span>&nbsp;<span class="op" id="1515303">(</span><span class="num" id="1515304">8</span>&nbsp;<span class="op" id="1515306">*</span>&nbsp;<span class="op" id="1515308">(</span><span class="ident" id="1515309"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1515315">.</span><span class="ident" id="1515316">Sizeof</span><span class="op" id="1515322">(</span><span class="ident" id="1515323"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span><span class="op" id="1515324">)</span>&nbsp;<span class="op" id="1515326">-</span>&nbsp;<span class="num" id="1515328">1</span><span class="op" id="1515329">)</span><span class="op" id="1515330">)</span><span class="op" id="1515331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515335"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span>&nbsp;<span class="op" id="1515337">+=</span>&nbsp;<span class="ident" id="1515340"><a href="/gostd/runtime/cpuprof.go.html#1515268">x</a></span><span class="op" id="1515341">*</span><span class="num" id="1515342">31</span>&nbsp;<span class="op" id="1515345">+</span>&nbsp;<span class="ident" id="1515347"><a href="/gostd/runtime/cpuprof.go.html#1515268">x</a></span><span class="op" id="1515348">*</span><span class="num" id="1515349">7</span>&nbsp;<span class="op" id="1515351">+</span>&nbsp;<span class="ident" id="1515353"><a href="/gostd/runtime/cpuprof.go.html#1515268">x</a></span><span class="op" id="1515354">*</span><span class="num" id="1515355">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515358">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515361"><a href="/gostd/runtime/cpuprof.go.html#1515190">p</a></span><span class="op" id="1515362">.</span><span class="ident" id="1515363"><a href="/gostd/runtime/cpuprof.go.html#1511532">count</a></span><span class="op" id="1515368">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515373">//&nbsp;Add&nbsp;to&nbsp;entry&nbsp;count&nbsp;if&nbsp;already&nbsp;present&nbsp;in&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515425">b</span>&nbsp;<span class="op" id="1515427">:=</span>&nbsp;<span class="op" id="1515430">&amp;</span><span class="ident" id="1515431"><a href="/gostd/runtime/cpuprof.go.html#1515190">p</a></span><span class="op" id="1515432">.</span><span class="ident" id="1515433"><a href="/gostd/runtime/cpuprof.go.html#1511682">hash</a></span><span class="op" id="1515437">[</span><span class="ident" id="1515438"><a href="/gostd/runtime/cpuprof.go.html#1515244">h</a></span><span class="op" id="1515439">%</span><span class="ident" id="1515440"><a href="/gostd/runtime/cpuprof.go.html#1511240">numBuckets</a></span><span class="op" id="1515450">]</span><br>
<span class="lineno"></span><span class="ident" id="1515452">Assoc</span><span class="op" id="1515457">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515460">for</span>&nbsp;<span class="ident" id="1515464">i</span>&nbsp;<span class="op" id="1515466">:=</span>&nbsp;<span class="keyword" id="1515469">range</span>&nbsp;<span class="ident" id="1515475"><a href="/gostd/runtime/cpuprof.go.html#1515425">b</a></span><span class="op" id="1515476">.</span><span class="ident" id="1515477"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span>&nbsp;<span class="op" id="1515483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515487">e</span>&nbsp;<span class="op" id="1515489">:=</span>&nbsp;<span class="op" id="1515492">&amp;</span><span class="ident" id="1515493"><a href="/gostd/runtime/cpuprof.go.html#1515425">b</a></span><span class="op" id="1515494">.</span><span class="ident" id="1515495"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span><span class="op" id="1515500">[</span><span class="ident" id="1515501"><a href="/gostd/runtime/cpuprof.go.html#1515464">i</a></span><span class="op" id="1515502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515506">if</span>&nbsp;<span class="ident" id="1515509"><a href="/gostd/runtime/cpuprof.go.html#1515487">e</a></span><span class="op" id="1515510">.</span><span class="ident" id="1515511"><a href="/gostd/runtime/cpuprof.go.html#1511382">depth</a></span>&nbsp;<span class="op" id="1515517">!=</span>&nbsp;<span class="builtintype" id="1515520">uintptr</span><span class="op" id="1515527">(</span><span class="builtinfunc" id="1515528">len</span><span class="op" id="1515531">(</span><span class="ident" id="1515532"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span><span class="op" id="1515534">)</span><span class="op" id="1515535">)</span>&nbsp;<span class="op" id="1515537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515542">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515553">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515557">for</span>&nbsp;<span class="ident" id="1515561">j</span>&nbsp;<span class="op" id="1515563">:=</span>&nbsp;<span class="keyword" id="1515566">range</span>&nbsp;<span class="ident" id="1515572"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span>&nbsp;<span class="op" id="1515575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515580">if</span>&nbsp;<span class="ident" id="1515583"><a href="/gostd/runtime/cpuprof.go.html#1515487">e</a></span><span class="op" id="1515584">.</span><span class="ident" id="1515585"><a href="/gostd/runtime/cpuprof.go.html#1511397">stack</a></span><span class="op" id="1515590">[</span><span class="ident" id="1515591"><a href="/gostd/runtime/cpuprof.go.html#1515561">j</a></span><span class="op" id="1515592">]</span>&nbsp;<span class="op" id="1515594">!=</span>&nbsp;<span class="ident" id="1515597"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span><span class="op" id="1515599">[</span><span class="ident" id="1515600"><a href="/gostd/runtime/cpuprof.go.html#1515561">j</a></span><span class="op" id="1515601">]</span>&nbsp;<span class="op" id="1515603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515609">continue</span>&nbsp;<span class="ident" id="1515618"><a href="/gostd/runtime/cpuprof.go.html#1515452">Assoc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515631">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515635"><a href="/gostd/runtime/cpuprof.go.html#1515487">e</a></span><span class="op" id="1515636">.</span><span class="ident" id="1515637"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span><span class="op" id="1515642">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515647">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515659">//&nbsp;Evict&nbsp;entry&nbsp;with&nbsp;smallest&nbsp;count.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515696">var</span>&nbsp;<span class="ident" id="1515700">e</span>&nbsp;<span class="op" id="1515702">*</span><span class="ident" id="1515703"><a href="/gostd/runtime/cpuprof.go.html#1511344">cpuprofEntry</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515717">for</span>&nbsp;<span class="ident" id="1515721">i</span>&nbsp;<span class="op" id="1515723">:=</span>&nbsp;<span class="keyword" id="1515726">range</span>&nbsp;<span class="ident" id="1515732"><a href="/gostd/runtime/cpuprof.go.html#1515425">b</a></span><span class="op" id="1515733">.</span><span class="ident" id="1515734"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span>&nbsp;<span class="op" id="1515740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515744">if</span>&nbsp;<span class="ident" id="1515747"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span>&nbsp;<span class="op" id="1515749">==</span>&nbsp;<span class="builtintype" id="1515752">nil</span>&nbsp;<span class="op" id="1515756">||</span>&nbsp;<span class="ident" id="1515759"><a href="/gostd/runtime/cpuprof.go.html#1515425">b</a></span><span class="op" id="1515760">.</span><span class="ident" id="1515761"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span><span class="op" id="1515766">[</span><span class="ident" id="1515767"><a href="/gostd/runtime/cpuprof.go.html#1515721">i</a></span><span class="op" id="1515768">]</span><span class="op" id="1515769">.</span><span class="ident" id="1515770"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1515776">&lt;</span>&nbsp;<span class="ident" id="1515778"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1515779">.</span><span class="ident" id="1515780"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1515786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515791"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span>&nbsp;<span class="op" id="1515793">=</span>&nbsp;<span class="op" id="1515795">&amp;</span><span class="ident" id="1515796"><a href="/gostd/runtime/cpuprof.go.html#1515425">b</a></span><span class="op" id="1515797">.</span><span class="ident" id="1515798"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span><span class="op" id="1515803">[</span><span class="ident" id="1515804"><a href="/gostd/runtime/cpuprof.go.html#1515721">i</a></span><span class="op" id="1515805">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515809">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515815">if</span>&nbsp;<span class="ident" id="1515818"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1515819">.</span><span class="ident" id="1515820"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1515826">&gt;</span>&nbsp;<span class="num" id="1515828">0</span>&nbsp;<span class="op" id="1515830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515834">if</span>&nbsp;<span class="op" id="1515837">!</span><span class="ident" id="1515838"><a href="/gostd/runtime/cpuprof.go.html#1515190">p</a></span><span class="op" id="1515839">.</span><span class="ident" id="1515840"><a href="/gostd/runtime/cpuprof.go.html#1516408">evict</a></span><span class="op" id="1515845">(</span><span class="ident" id="1515846"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1515847">)</span>&nbsp;<span class="op" id="1515849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515854">//&nbsp;Could&nbsp;not&nbsp;evict&nbsp;entry.&nbsp;&nbsp;Record&nbsp;lost&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515903"><a href="/gostd/runtime/cpuprof.go.html#1515190">p</a></span><span class="op" id="1515904">.</span><span class="ident" id="1515905"><a href="/gostd/runtime/cpuprof.go.html#1511596">lost</a></span><span class="op" id="1515909">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1515915">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515928"><a href="/gostd/runtime/cpuprof.go.html#1515190">p</a></span><span class="op" id="1515929">.</span><span class="ident" id="1515930"><a href="/gostd/runtime/cpuprof.go.html#1511562">evicts</a></span><span class="op" id="1515936">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1515940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1515944">//&nbsp;Reuse&nbsp;the&nbsp;newly&nbsp;evicted&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1515979"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1515980">.</span><span class="ident" id="1515981"><a href="/gostd/runtime/cpuprof.go.html#1511382">depth</a></span>&nbsp;<span class="op" id="1515987">=</span>&nbsp;<span class="builtintype" id="1515989">uintptr</span><span class="op" id="1515996">(</span><span class="builtinfunc" id="1515997">len</span><span class="op" id="1516000">(</span><span class="ident" id="1516001"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span><span class="op" id="1516003">)</span><span class="op" id="1516004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516007"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1516008">.</span><span class="ident" id="1516009"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1516015">=</span>&nbsp;<span class="num" id="1516017">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1516020">copy</span><span class="op" id="1516024">(</span><span class="ident" id="1516025"><a href="/gostd/runtime/cpuprof.go.html#1515700">e</a></span><span class="op" id="1516026">.</span><span class="ident" id="1516027"><a href="/gostd/runtime/cpuprof.go.html#1511397">stack</a></span><span class="op" id="1516032">[</span><span class="op" id="1516033">:</span><span class="op" id="1516034">]</span><span class="op" id="1516035">,</span>&nbsp;<span class="ident" id="1516037"><a href="/gostd/runtime/cpuprof.go.html#1515209">pc</a></span><span class="op" id="1516039">)</span><br>
<span class="lineno"></span><span class="op" id="1516041">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="1516044">//&nbsp;evict&nbsp;copies&nbsp;the&nbsp;given&nbsp;entry&#39;s&nbsp;data&nbsp;into&nbsp;the&nbsp;log,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1516105">//&nbsp;the&nbsp;entry&nbsp;can&nbsp;be&nbsp;reused.&nbsp;&nbsp;evict&nbsp;is&nbsp;called&nbsp;from&nbsp;add,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="1516166">//&nbsp;is&nbsp;called&nbsp;from&nbsp;the&nbsp;profiling&nbsp;signal&nbsp;handler,&nbsp;so&nbsp;it&nbsp;must&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1516229">//&nbsp;allocate&nbsp;memory&nbsp;or&nbsp;block.&nbsp;&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;flushlog.</span><br>
<span class="lineno">255</span><span class="comment" id="1516288">//&nbsp;evict&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;entry&nbsp;was&nbsp;copied&nbsp;to&nbsp;the&nbsp;log,</span><br>
<span class="lineno"></span><span class="comment" id="1516346">//&nbsp;false&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;room&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1516387">func</span>&nbsp;<span class="op" id="1516392">(</span><span class="ident" id="1516393">p</span>&nbsp;<span class="op" id="1516395">*</span><span class="ident" id="1516396"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1516406">)</span>&nbsp;<span class="ident" id="1516408">evict</span><span class="op" id="1516413">(</span><span class="ident" id="1516414">e</span>&nbsp;<span class="op" id="1516416">*</span><span class="ident" id="1516417"><a href="/gostd/runtime/cpuprof.go.html#1511344">cpuprofEntry</a></span><span class="op" id="1516429">)</span>&nbsp;<span class="builtintype" id="1516431">bool</span>&nbsp;<span class="op" id="1516436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516439">d</span>&nbsp;<span class="op" id="1516441">:=</span>&nbsp;<span class="ident" id="1516444"><a href="/gostd/runtime/cpuprof.go.html#1516414">e</a></span><span class="op" id="1516445">.</span><span class="ident" id="1516446"><a href="/gostd/runtime/cpuprof.go.html#1511382">depth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516453">nslot</span>&nbsp;<span class="op" id="1516459">:=</span>&nbsp;<span class="ident" id="1516462"><a href="/gostd/runtime/cpuprof.go.html#1516439">d</a></span>&nbsp;<span class="op" id="1516464">+</span>&nbsp;<span class="num" id="1516466">2</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516469">log</span>&nbsp;<span class="op" id="1516473">:=</span>&nbsp;<span class="op" id="1516476">&amp;</span><span class="ident" id="1516477"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516478">.</span><span class="ident" id="1516479"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1516482">[</span><span class="ident" id="1516483"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516484">.</span><span class="ident" id="1516485"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span><span class="op" id="1516491">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516494">if</span>&nbsp;<span class="ident" id="1516497"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516498">.</span><span class="ident" id="1516499"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span><span class="op" id="1516503">+</span><span class="ident" id="1516504"><a href="/gostd/runtime/cpuprof.go.html#1516453">nslot</a></span>&nbsp;<span class="op" id="1516510">&gt;</span>&nbsp;<span class="builtintype" id="1516512">uintptr</span><span class="op" id="1516519">(</span><span class="builtinfunc" id="1516520">len</span><span class="op" id="1516523">(</span><span class="ident" id="1516524"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516525">.</span><span class="ident" id="1516526"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1516529">[</span><span class="num" id="1516530">0</span><span class="op" id="1516531">]</span><span class="op" id="1516532">)</span><span class="op" id="1516533">)</span>&nbsp;<span class="op" id="1516535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516539">if</span>&nbsp;<span class="op" id="1516542">!</span><span class="ident" id="1516543"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516544">.</span><span class="ident" id="1516545"><a href="/gostd/runtime/cpuprof.go.html#1517064">flushlog</a></span><span class="op" id="1516553">(</span><span class="op" id="1516554">)</span>&nbsp;<span class="op" id="1516556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516561">return</span>&nbsp;<span class="builtintype" id="1516568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516576">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516580"><a href="/gostd/runtime/cpuprof.go.html#1516469">log</a></span>&nbsp;<span class="op" id="1516584">=</span>&nbsp;<span class="op" id="1516586">&amp;</span><span class="ident" id="1516587"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516588">.</span><span class="ident" id="1516589"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1516592">[</span><span class="ident" id="1516593"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516594">.</span><span class="ident" id="1516595"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span><span class="op" id="1516601">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1516604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516608">q</span>&nbsp;<span class="op" id="1516610">:=</span>&nbsp;<span class="ident" id="1516613"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516614">.</span><span class="ident" id="1516615"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516621"><a href="/gostd/runtime/cpuprof.go.html#1516469">log</a></span><span class="op" id="1516624">[</span><span class="ident" id="1516625"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><span class="op" id="1516626">]</span>&nbsp;<span class="op" id="1516628">=</span>&nbsp;<span class="ident" id="1516630"><a href="/gostd/runtime/cpuprof.go.html#1516414">e</a></span><span class="op" id="1516631">.</span><span class="ident" id="1516632"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516639"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><span class="op" id="1516640">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516644"><a href="/gostd/runtime/cpuprof.go.html#1516469">log</a></span><span class="op" id="1516647">[</span><span class="ident" id="1516648"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><span class="op" id="1516649">]</span>&nbsp;<span class="op" id="1516651">=</span>&nbsp;<span class="ident" id="1516653"><a href="/gostd/runtime/cpuprof.go.html#1516439">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516656"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><span class="op" id="1516657">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1516661">copy</span><span class="op" id="1516665">(</span><span class="ident" id="1516666"><a href="/gostd/runtime/cpuprof.go.html#1516469">log</a></span><span class="op" id="1516669">[</span><span class="ident" id="1516670"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><span class="op" id="1516671">:</span><span class="op" id="1516672">]</span><span class="op" id="1516673">,</span>&nbsp;<span class="ident" id="1516675"><a href="/gostd/runtime/cpuprof.go.html#1516414">e</a></span><span class="op" id="1516676">.</span><span class="ident" id="1516677"><a href="/gostd/runtime/cpuprof.go.html#1511397">stack</a></span><span class="op" id="1516682">[</span><span class="op" id="1516683">:</span><span class="ident" id="1516684"><a href="/gostd/runtime/cpuprof.go.html#1516439">d</a></span><span class="op" id="1516685">]</span><span class="op" id="1516686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516689"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span>&nbsp;<span class="op" id="1516691">+=</span>&nbsp;<span class="ident" id="1516694"><a href="/gostd/runtime/cpuprof.go.html#1516439">d</a></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516697"><a href="/gostd/runtime/cpuprof.go.html#1516393">p</a></span><span class="op" id="1516698">.</span><span class="ident" id="1516699"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span>&nbsp;<span class="op" id="1516704">=</span>&nbsp;<span class="ident" id="1516706"><a href="/gostd/runtime/cpuprof.go.html#1516608">q</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1516709"><a href="/gostd/runtime/cpuprof.go.html#1516414">e</a></span><span class="op" id="1516710">.</span><span class="ident" id="1516711"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1516717">=</span>&nbsp;<span class="num" id="1516719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1516722">return</span>&nbsp;<span class="builtintype" id="1516729">true</span><br>
<span class="lineno"></span><span class="op" id="1516734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="comment" id="1516737">//&nbsp;flushlog&nbsp;tries&nbsp;to&nbsp;flush&nbsp;the&nbsp;current&nbsp;log&nbsp;and&nbsp;switch&nbsp;to&nbsp;the&nbsp;other&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1516809">//&nbsp;flushlog&nbsp;is&nbsp;called&nbsp;from&nbsp;evict,&nbsp;called&nbsp;from&nbsp;add,&nbsp;called&nbsp;from&nbsp;the&nbsp;signal&nbsp;handler,</span><br>
<span class="lineno"></span><span class="comment" id="1516892">//&nbsp;so&nbsp;it&nbsp;cannot&nbsp;allocate&nbsp;memory&nbsp;or&nbsp;block.&nbsp;&nbsp;It&nbsp;can&nbsp;try&nbsp;to&nbsp;swap&nbsp;logs&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="1516964">//&nbsp;the&nbsp;writing&nbsp;goroutine,&nbsp;as&nbsp;explained&nbsp;in&nbsp;the&nbsp;comment&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;this&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1517043">func</span>&nbsp;<span class="op" id="1517048">(</span><span class="ident" id="1517049">p</span>&nbsp;<span class="op" id="1517051">*</span><span class="ident" id="1517052"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1517062">)</span>&nbsp;<span class="ident" id="1517064">flushlog</span><span class="op" id="1517072">(</span><span class="op" id="1517073">)</span>&nbsp;<span class="builtintype" id="1517075">bool</span>&nbsp;<span class="op" id="1517080">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517083">if</span>&nbsp;<span class="op" id="1517086">!</span><span class="ident" id="1517087"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1517090">(</span><span class="op" id="1517091">&amp;</span><span class="ident" id="1517092"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517093">.</span><span class="ident" id="1517094"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1517101">,</span>&nbsp;<span class="num" id="1517103">0</span><span class="op" id="1517104">,</span>&nbsp;<span class="builtintype" id="1517106">uint32</span><span class="op" id="1517112">(</span><span class="ident" id="1517113"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517114">.</span><span class="ident" id="1517115"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span><span class="op" id="1517119">)</span><span class="op" id="1517120">)</span>&nbsp;<span class="op" id="1517122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517126">return</span>&nbsp;<span class="builtintype" id="1517133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517143"><a href="/gostd/runtime/lock_futex.go.html#1587128">notewakeup</a></span><span class="op" id="1517153">(</span><span class="op" id="1517154">&amp;</span><span class="ident" id="1517155"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517156">.</span><span class="ident" id="1517157"><a href="/gostd/runtime/cpuprof.go.html#1511492">wait</a></span><span class="op" id="1517161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517165"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517166">.</span><span class="ident" id="1517167"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span>&nbsp;<span class="op" id="1517174">=</span>&nbsp;<span class="num" id="1517176">1</span>&nbsp;<span class="op" id="1517178">-</span>&nbsp;<span class="ident" id="1517180"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517181">.</span><span class="ident" id="1517182"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517190">log</span>&nbsp;<span class="op" id="1517194">:=</span>&nbsp;<span class="op" id="1517197">&amp;</span><span class="ident" id="1517198"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517199">.</span><span class="ident" id="1517200"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1517203">[</span><span class="ident" id="1517204"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517205">.</span><span class="ident" id="1517206"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span><span class="op" id="1517212">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517215">q</span>&nbsp;<span class="op" id="1517217">:=</span>&nbsp;<span class="builtintype" id="1517220">uintptr</span><span class="op" id="1517227">(</span><span class="num" id="1517228">0</span><span class="op" id="1517229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517232">if</span>&nbsp;<span class="ident" id="1517235"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517236">.</span><span class="ident" id="1517237"><a href="/gostd/runtime/cpuprof.go.html#1511596">lost</a></span>&nbsp;<span class="op" id="1517242">&gt;</span>&nbsp;<span class="num" id="1517244">0</span>&nbsp;<span class="op" id="1517246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517250">lostPC</span>&nbsp;<span class="op" id="1517257">:=</span>&nbsp;<span class="ident" id="1517260"><a href="/gostd/runtime/proc.go.html#1675458">funcPC</a></span><span class="op" id="1517266">(</span><span class="ident" id="1517267"><a href="/gostd/runtime/cpuprof.go.html#1512648">lostProfileData</a></span><span class="op" id="1517282">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517286"><a href="/gostd/runtime/cpuprof.go.html#1517190">log</a></span><span class="op" id="1517289">[</span><span class="num" id="1517290">0</span><span class="op" id="1517291">]</span>&nbsp;<span class="op" id="1517293">=</span>&nbsp;<span class="ident" id="1517295"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517296">.</span><span class="ident" id="1517297"><a href="/gostd/runtime/cpuprof.go.html#1511596">lost</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517304"><a href="/gostd/runtime/cpuprof.go.html#1517190">log</a></span><span class="op" id="1517307">[</span><span class="num" id="1517308">1</span><span class="op" id="1517309">]</span>&nbsp;<span class="op" id="1517311">=</span>&nbsp;<span class="num" id="1517313">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517317"><a href="/gostd/runtime/cpuprof.go.html#1517190">log</a></span><span class="op" id="1517320">[</span><span class="num" id="1517321">2</span><span class="op" id="1517322">]</span>&nbsp;<span class="op" id="1517324">=</span>&nbsp;<span class="ident" id="1517326"><a href="/gostd/runtime/cpuprof.go.html#1517250">lostPC</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517335"><a href="/gostd/runtime/cpuprof.go.html#1517215">q</a></span>&nbsp;<span class="op" id="1517337">=</span>&nbsp;<span class="num" id="1517339">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517343"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517344">.</span><span class="ident" id="1517345"><a href="/gostd/runtime/cpuprof.go.html#1511596">lost</a></span>&nbsp;<span class="op" id="1517350">=</span>&nbsp;<span class="num" id="1517352">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517358"><a href="/gostd/runtime/cpuprof.go.html#1517049">p</a></span><span class="op" id="1517359">.</span><span class="ident" id="1517360"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span>&nbsp;<span class="op" id="1517365">=</span>&nbsp;<span class="ident" id="1517367"><a href="/gostd/runtime/cpuprof.go.html#1517215">q</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517370">return</span>&nbsp;<span class="builtintype" id="1517377">true</span><br>
<span class="lineno"></span><span class="op" id="1517382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="1517385">//&nbsp;getprofile&nbsp;blocks&nbsp;until&nbsp;the&nbsp;next&nbsp;block&nbsp;of&nbsp;profiling&nbsp;data&nbsp;is&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="1517458">//&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;[]byte.&nbsp;&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;the&nbsp;writing&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1517531">func</span>&nbsp;<span class="op" id="1517536">(</span><span class="ident" id="1517537">p</span>&nbsp;<span class="op" id="1517539">*</span><span class="ident" id="1517540"><a href="/gostd/runtime/cpuprof.go.html#1511436">cpuProfile</a></span><span class="op" id="1517550">)</span>&nbsp;<span class="ident" id="1517552">getprofile</span><span class="op" id="1517562">(</span><span class="op" id="1517563">)</span>&nbsp;<span class="op" id="1517565">[</span><span class="op" id="1517566">]</span><span class="builtintype" id="1517567">byte</span>&nbsp;<span class="op" id="1517572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517575">if</span>&nbsp;<span class="ident" id="1517578"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span>&nbsp;<span class="op" id="1517580">==</span>&nbsp;<span class="builtintype" id="1517583">nil</span>&nbsp;<span class="op" id="1517587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517591">return</span>&nbsp;<span class="builtintype" id="1517598">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517607">if</span>&nbsp;<span class="ident" id="1517610"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517611">.</span><span class="ident" id="1517612"><a href="/gostd/runtime/cpuprof.go.html#1512086">wholding</a></span>&nbsp;<span class="op" id="1517621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1517625">//&nbsp;Release&nbsp;previous&nbsp;log&nbsp;to&nbsp;signal&nbsp;handling&nbsp;side.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1517676">//&nbsp;Loop&nbsp;because&nbsp;we&nbsp;are&nbsp;racing&nbsp;against&nbsp;SetCPUProfileRate(0).</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517738">for</span>&nbsp;<span class="op" id="1517742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517747">n</span>&nbsp;<span class="op" id="1517749">:=</span>&nbsp;<span class="ident" id="1517752"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517753">.</span><span class="ident" id="1517754"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517765">if</span>&nbsp;<span class="ident" id="1517768"><a href="/gostd/runtime/cpuprof.go.html#1517747">n</a></span>&nbsp;<span class="op" id="1517770">==</span>&nbsp;<span class="num" id="1517773">0</span>&nbsp;<span class="op" id="1517775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1517781">print</span><span class="op" id="1517786">(</span><span class="string" id="1517787">&#34;runtime:&nbsp;phase&nbsp;error&nbsp;during&nbsp;cpu&nbsp;profile&nbsp;handoff\n&#34;</span><span class="op" id="1517838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517844">return</span>&nbsp;<span class="builtintype" id="1517851">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517863">if</span>&nbsp;<span class="ident" id="1517866"><a href="/gostd/runtime/cpuprof.go.html#1517747">n</a></span><span class="op" id="1517867">&amp;</span><span class="num" id="1517868">0x80000000</span>&nbsp;<span class="op" id="1517879">!=</span>&nbsp;<span class="num" id="1517882">0</span>&nbsp;<span class="op" id="1517884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517890"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517891">.</span><span class="ident" id="1517892"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span>&nbsp;<span class="op" id="1517900">=</span>&nbsp;<span class="num" id="1517902">1</span>&nbsp;<span class="op" id="1517904">-</span>&nbsp;<span class="ident" id="1517906"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517907">.</span><span class="ident" id="1517908"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517920"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517921">.</span><span class="ident" id="1517922"><a href="/gostd/runtime/cpuprof.go.html#1512086">wholding</a></span>&nbsp;<span class="op" id="1517931">=</span>&nbsp;<span class="builtintype" id="1517933">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1517943"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517944">.</span><span class="ident" id="1517945"><a href="/gostd/runtime/cpuprof.go.html#1512141">flushing</a></span>&nbsp;<span class="op" id="1517954">=</span>&nbsp;<span class="builtintype" id="1517956">true</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517965">goto</span>&nbsp;<span class="ident" id="1517970"><a href="/gostd/runtime/cpuprof.go.html#1518719">Flush</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1517979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1517984">if</span>&nbsp;<span class="ident" id="1517987"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1517990">(</span><span class="op" id="1517991">&amp;</span><span class="ident" id="1517992"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1517993">.</span><span class="ident" id="1517994"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1518001">,</span>&nbsp;<span class="ident" id="1518003"><a href="/gostd/runtime/cpuprof.go.html#1517747">n</a></span><span class="op" id="1518004">,</span>&nbsp;<span class="num" id="1518006">0</span><span class="op" id="1518007">)</span>&nbsp;<span class="op" id="1518009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518015">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518024">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518032"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518033">.</span><span class="ident" id="1518034"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span>&nbsp;<span class="op" id="1518042">=</span>&nbsp;<span class="num" id="1518044">1</span>&nbsp;<span class="op" id="1518046">-</span>&nbsp;<span class="ident" id="1518048"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518049">.</span><span class="ident" id="1518050"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518060"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518061">.</span><span class="ident" id="1518062"><a href="/gostd/runtime/cpuprof.go.html#1512086">wholding</a></span>&nbsp;<span class="op" id="1518071">=</span>&nbsp;<span class="builtintype" id="1518073">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518084">if</span>&nbsp;<span class="ident" id="1518087"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518088">.</span><span class="ident" id="1518089"><a href="/gostd/runtime/cpuprof.go.html#1512141">flushing</a></span>&nbsp;<span class="op" id="1518098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518102">goto</span>&nbsp;<span class="ident" id="1518107"><a href="/gostd/runtime/cpuprof.go.html#1518719">Flush</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518118">if</span>&nbsp;<span class="op" id="1518121">!</span><span class="ident" id="1518122"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518123">.</span><span class="ident" id="1518124"><a href="/gostd/runtime/cpuprof.go.html#1511457">on</a></span>&nbsp;<span class="op" id="1518127">&amp;&amp;</span>&nbsp;<span class="ident" id="1518130"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518131">.</span><span class="ident" id="1518132"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span>&nbsp;<span class="op" id="1518140">==</span>&nbsp;<span class="num" id="1518143">0</span>&nbsp;<span class="op" id="1518145">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518149">return</span>&nbsp;<span class="builtintype" id="1518156">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518165">//&nbsp;Wait&nbsp;for&nbsp;new&nbsp;log.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518187"><a href="/gostd/runtime/lock_futex.go.html#1588434">notetsleepg</a></span><span class="op" id="1518198">(</span><span class="op" id="1518199">&amp;</span><span class="ident" id="1518200"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518201">.</span><span class="ident" id="1518202"><a href="/gostd/runtime/cpuprof.go.html#1511492">wait</a></span><span class="op" id="1518206">,</span>&nbsp;<span class="op" id="1518208">-</span><span class="num" id="1518209">1</span><span class="op" id="1518210">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518213"><a href="/gostd/runtime/lock_futex.go.html#1587088">noteclear</a></span><span class="op" id="1518222">(</span><span class="op" id="1518223">&amp;</span><span class="ident" id="1518224"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518225">.</span><span class="ident" id="1518226"><a href="/gostd/runtime/cpuprof.go.html#1511492">wait</a></span><span class="op" id="1518230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518234">switch</span>&nbsp;<span class="ident" id="1518241">n</span>&nbsp;<span class="op" id="1518243">:=</span>&nbsp;<span class="ident" id="1518246"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518247">.</span><span class="ident" id="1518248"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1518255">;</span>&nbsp;<span class="op" id="1518257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518260">case</span>&nbsp;<span class="ident" id="1518265"><a href="/gostd/runtime/cpuprof.go.html#1518241">n</a></span>&nbsp;<span class="op" id="1518267">==</span>&nbsp;<span class="num" id="1518270">0</span><span class="op" id="1518271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1518275">print</span><span class="op" id="1518280">(</span><span class="string" id="1518281">&#34;runtime:&nbsp;phase&nbsp;error&nbsp;during&nbsp;cpu&nbsp;profile&nbsp;wait\n&#34;</span><span class="op" id="1518329">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518333">return</span>&nbsp;<span class="builtintype" id="1518340">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518345">case</span>&nbsp;<span class="ident" id="1518350"><a href="/gostd/runtime/cpuprof.go.html#1518241">n</a></span>&nbsp;<span class="op" id="1518352">==</span>&nbsp;<span class="num" id="1518355">0x80000000</span><span class="op" id="1518365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518369"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518370">.</span><span class="ident" id="1518371"><a href="/gostd/runtime/cpuprof.go.html#1512141">flushing</a></span>&nbsp;<span class="op" id="1518380">=</span>&nbsp;<span class="builtintype" id="1518382">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518389">goto</span>&nbsp;<span class="ident" id="1518394"><a href="/gostd/runtime/cpuprof.go.html#1518719">Flush</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518401">default</span><span class="op" id="1518408">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518412"><a href="/gostd/runtime/cpuprof.go.html#1518241">n</a></span>&nbsp;<span class="op" id="1518414">&amp;^=</span>&nbsp;<span class="num" id="1518418">0x80000000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518432">//&nbsp;Return&nbsp;new&nbsp;log&nbsp;to&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518463"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518464">.</span><span class="ident" id="1518465"><a href="/gostd/runtime/cpuprof.go.html#1512086">wholding</a></span>&nbsp;<span class="op" id="1518474">=</span>&nbsp;<span class="builtintype" id="1518476">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518484">return</span>&nbsp;<span class="ident" id="1518491"><a href="/gostd/runtime/cpuprof.go.html#1519611">uintptrBytes</a></span><span class="op" id="1518503">(</span><span class="ident" id="1518504"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518505">.</span><span class="ident" id="1518506"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1518509">[</span><span class="ident" id="1518510"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518511">.</span><span class="ident" id="1518512"><a href="/gostd/runtime/cpuprof.go.html#1512069">wtoggle</a></span><span class="op" id="1518519">]</span><span class="op" id="1518520">[</span><span class="op" id="1518521">:</span><span class="ident" id="1518522"><a href="/gostd/runtime/cpuprof.go.html#1518241">n</a></span><span class="op" id="1518523">]</span><span class="op" id="1518524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518531">//&nbsp;In&nbsp;flush&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518550">//&nbsp;Add&nbsp;is&nbsp;no&nbsp;longer&nbsp;being&nbsp;called.&nbsp;&nbsp;We&nbsp;own&nbsp;the&nbsp;log.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518602">//&nbsp;Also,&nbsp;p-&gt;handoff&nbsp;is&nbsp;non-zero,&nbsp;so&nbsp;flushlog&nbsp;will&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518667">//&nbsp;Evict&nbsp;the&nbsp;hash&nbsp;table&nbsp;into&nbsp;the&nbsp;log&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span><span class="ident" id="1518719">Flush</span><span class="op" id="1518724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518727">for</span>&nbsp;<span class="ident" id="1518731">i</span>&nbsp;<span class="op" id="1518733">:=</span>&nbsp;<span class="keyword" id="1518736">range</span>&nbsp;<span class="ident" id="1518742"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518743">.</span><span class="ident" id="1518744"><a href="/gostd/runtime/cpuprof.go.html#1511682">hash</a></span>&nbsp;<span class="op" id="1518749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518753">b</span>&nbsp;<span class="op" id="1518755">:=</span>&nbsp;<span class="op" id="1518758">&amp;</span><span class="ident" id="1518759"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518760">.</span><span class="ident" id="1518761"><a href="/gostd/runtime/cpuprof.go.html#1511682">hash</a></span><span class="op" id="1518765">[</span><span class="ident" id="1518766"><a href="/gostd/runtime/cpuprof.go.html#1518731">i</a></span><span class="op" id="1518767">]</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518771">for</span>&nbsp;<span class="ident" id="1518775">j</span>&nbsp;<span class="op" id="1518777">:=</span>&nbsp;<span class="keyword" id="1518780">range</span>&nbsp;<span class="ident" id="1518786"><a href="/gostd/runtime/cpuprof.go.html#1518753">b</a></span><span class="op" id="1518787">.</span><span class="ident" id="1518788"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span>&nbsp;<span class="op" id="1518794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1518799">e</span>&nbsp;<span class="op" id="1518801">:=</span>&nbsp;<span class="op" id="1518804">&amp;</span><span class="ident" id="1518805"><a href="/gostd/runtime/cpuprof.go.html#1518753">b</a></span><span class="op" id="1518806">.</span><span class="ident" id="1518807"><a href="/gostd/runtime/cpuprof.go.html#1511710">entry</a></span><span class="op" id="1518812">[</span><span class="ident" id="1518813"><a href="/gostd/runtime/cpuprof.go.html#1518775">j</a></span><span class="op" id="1518814">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518819">if</span>&nbsp;<span class="ident" id="1518822"><a href="/gostd/runtime/cpuprof.go.html#1518799">e</a></span><span class="op" id="1518823">.</span><span class="ident" id="1518824"><a href="/gostd/runtime/cpuprof.go.html#1511367">count</a></span>&nbsp;<span class="op" id="1518830">&gt;</span>&nbsp;<span class="num" id="1518832">0</span>&nbsp;<span class="op" id="1518834">&amp;&amp;</span>&nbsp;<span class="op" id="1518837">!</span><span class="ident" id="1518838"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518839">.</span><span class="ident" id="1518840"><a href="/gostd/runtime/cpuprof.go.html#1516408">evict</a></span><span class="op" id="1518845">(</span><span class="ident" id="1518846"><a href="/gostd/runtime/cpuprof.go.html#1518799">e</a></span><span class="op" id="1518847">)</span>&nbsp;<span class="op" id="1518849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518855">//&nbsp;Filled&nbsp;the&nbsp;log.&nbsp;&nbsp;Stop&nbsp;the&nbsp;loop&nbsp;and&nbsp;return&nbsp;what&nbsp;we&#39;ve&nbsp;got.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518920">break</span>&nbsp;<span class="ident" id="1518926"><a href="/gostd/runtime/cpuprof.go.html#1518719">Flush</a></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1518942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518946">//&nbsp;Return&nbsp;pending&nbsp;log&nbsp;data.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1518975">if</span>&nbsp;<span class="ident" id="1518978"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1518979">.</span><span class="ident" id="1518980"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span>&nbsp;<span class="op" id="1518985">&gt;</span>&nbsp;<span class="num" id="1518987">0</span>&nbsp;<span class="op" id="1518989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1518993">//&nbsp;Note&nbsp;that&nbsp;we&#39;re&nbsp;using&nbsp;toggle&nbsp;now,&nbsp;not&nbsp;wtoggle,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519045">//&nbsp;because&nbsp;we&#39;re&nbsp;working&nbsp;on&nbsp;the&nbsp;log&nbsp;directly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519093">n</span>&nbsp;<span class="op" id="1519095">:=</span>&nbsp;<span class="ident" id="1519098"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519099">.</span><span class="ident" id="1519100"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519107"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519108">.</span><span class="ident" id="1519109"><a href="/gostd/runtime/cpuprof.go.html#1511911">nlog</a></span>&nbsp;<span class="op" id="1519114">=</span>&nbsp;<span class="num" id="1519116">0</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519120">return</span>&nbsp;<span class="ident" id="1519127"><a href="/gostd/runtime/cpuprof.go.html#1519611">uintptrBytes</a></span><span class="op" id="1519139">(</span><span class="ident" id="1519140"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519141">.</span><span class="ident" id="1519142"><a href="/gostd/runtime/cpuprof.go.html#1511878">log</a></span><span class="op" id="1519145">[</span><span class="ident" id="1519146"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519147">.</span><span class="ident" id="1519148"><a href="/gostd/runtime/cpuprof.go.html#1511928">toggle</a></span><span class="op" id="1519154">]</span><span class="op" id="1519155">[</span><span class="op" id="1519156">:</span><span class="ident" id="1519157"><a href="/gostd/runtime/cpuprof.go.html#1519093">n</a></span><span class="op" id="1519158">]</span><span class="op" id="1519159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519166">//&nbsp;Made&nbsp;it&nbsp;through&nbsp;the&nbsp;table&nbsp;without&nbsp;finding&nbsp;anything&nbsp;to&nbsp;log.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519229">if</span>&nbsp;<span class="op" id="1519232">!</span><span class="ident" id="1519233"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519234">.</span><span class="ident" id="1519235"><a href="/gostd/runtime/cpuprof.go.html#1512197">eodSent</a></span>&nbsp;<span class="op" id="1519243">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519247">//&nbsp;We&nbsp;may&nbsp;not&nbsp;have&nbsp;space&nbsp;to&nbsp;append&nbsp;this&nbsp;to&nbsp;the&nbsp;partial&nbsp;log&nbsp;buf,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519313">//&nbsp;so&nbsp;we&nbsp;always&nbsp;return&nbsp;a&nbsp;new&nbsp;slice&nbsp;for&nbsp;the&nbsp;end-of-data&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519378"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519379">.</span><span class="ident" id="1519380"><a href="/gostd/runtime/cpuprof.go.html#1512197">eodSent</a></span>&nbsp;<span class="op" id="1519388">=</span>&nbsp;<span class="builtintype" id="1519390">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519397">return</span>&nbsp;<span class="ident" id="1519404"><a href="/gostd/runtime/cpuprof.go.html#1519611">uintptrBytes</a></span><span class="op" id="1519416">(</span><span class="ident" id="1519417"><a href="/gostd/runtime/cpuprof.go.html#1512314">eod</a></span><span class="op" id="1519420">[</span><span class="op" id="1519421">:</span><span class="op" id="1519422">]</span><span class="op" id="1519423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519426">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1519430">//&nbsp;Finally&nbsp;done.&nbsp;&nbsp;Clean&nbsp;up&nbsp;and&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519474"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519475">.</span><span class="ident" id="1519476"><a href="/gostd/runtime/cpuprof.go.html#1512141">flushing</a></span>&nbsp;<span class="op" id="1519485">=</span>&nbsp;<span class="builtintype" id="1519487">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519494">if</span>&nbsp;<span class="op" id="1519497">!</span><span class="ident" id="1519498"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1519501">(</span><span class="op" id="1519502">&amp;</span><span class="ident" id="1519503"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519504">.</span><span class="ident" id="1519505"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1519512">,</span>&nbsp;<span class="ident" id="1519514"><a href="/gostd/runtime/cpuprof.go.html#1517537">p</a></span><span class="op" id="1519515">.</span><span class="ident" id="1519516"><a href="/gostd/runtime/cpuprof.go.html#1511943">handoff</a></span><span class="op" id="1519523">,</span>&nbsp;<span class="num" id="1519525">0</span><span class="op" id="1519526">)</span>&nbsp;<span class="op" id="1519528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1519532">print</span><span class="op" id="1519537">(</span><span class="string" id="1519538">&#34;runtime:&nbsp;profile&nbsp;flush&nbsp;racing&nbsp;with&nbsp;something\n&#34;</span><span class="op" id="1519586">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1519589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519592">return</span>&nbsp;<span class="builtintype" id="1519599">nil</span><br>
<span class="lineno"></span><span class="op" id="1519603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1519606">func</span>&nbsp;<span class="ident" id="1519611">uintptrBytes</span><span class="op" id="1519623">(</span><span class="ident" id="1519624">p</span>&nbsp;<span class="op" id="1519626">[</span><span class="op" id="1519627">]</span><span class="builtintype" id="1519628">uintptr</span><span class="op" id="1519635">)</span>&nbsp;<span class="op" id="1519637">(</span><span class="ident" id="1519638">ret</span>&nbsp;<span class="op" id="1519642">[</span><span class="op" id="1519643">]</span><span class="builtintype" id="1519644">byte</span><span class="op" id="1519648">)</span>&nbsp;<span class="op" id="1519650">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519653">pp</span>&nbsp;<span class="op" id="1519656">:=</span>&nbsp;<span class="op" id="1519659">(</span><span class="op" id="1519660">*</span><span class="ident" id="1519661"><a href="/gostd/runtime/slice.go.html#1713356">sliceStruct</a></span><span class="op" id="1519672">)</span><span class="op" id="1519673">(</span><span class="ident" id="1519674"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1519680">.</span><span class="ident" id="1519681">Pointer</span><span class="op" id="1519688">(</span><span class="op" id="1519689">&amp;</span><span class="ident" id="1519690"><a href="/gostd/runtime/cpuprof.go.html#1519624">p</a></span><span class="op" id="1519691">)</span><span class="op" id="1519692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519695">rp</span>&nbsp;<span class="op" id="1519698">:=</span>&nbsp;<span class="op" id="1519701">(</span><span class="op" id="1519702">*</span><span class="ident" id="1519703"><a href="/gostd/runtime/slice.go.html#1713356">sliceStruct</a></span><span class="op" id="1519714">)</span><span class="op" id="1519715">(</span><span class="ident" id="1519716"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1519722">.</span><span class="ident" id="1519723">Pointer</span><span class="op" id="1519730">(</span><span class="op" id="1519731">&amp;</span><span class="ident" id="1519732"><a href="/gostd/runtime/cpuprof.go.html#1519638">ret</a></span><span class="op" id="1519735">)</span><span class="op" id="1519736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519740"><a href="/gostd/runtime/cpuprof.go.html#1519695">rp</a></span><span class="op" id="1519742">.</span><span class="ident" id="1519743"><a href="/gostd/runtime/slice.go.html#1713378">array</a></span>&nbsp;<span class="op" id="1519749">=</span>&nbsp;<span class="ident" id="1519751"><a href="/gostd/runtime/cpuprof.go.html#1519653">pp</a></span><span class="op" id="1519753">.</span><span class="ident" id="1519754"><a href="/gostd/runtime/slice.go.html#1713378">array</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519761"><a href="/gostd/runtime/cpuprof.go.html#1519695">rp</a></span><span class="op" id="1519763">.</span><span class="builtinfunc" id="1519764"><a href="/gostd/runtime/slice.go.html#1713400">len</a></span>&nbsp;<span class="op" id="1519768">=</span>&nbsp;<span class="ident" id="1519770"><a href="/gostd/runtime/cpuprof.go.html#1519653">pp</a></span><span class="op" id="1519772">.</span><span class="builtinfunc" id="1519773"><a href="/gostd/runtime/slice.go.html#1713400">len</a></span>&nbsp;<span class="op" id="1519777">*</span>&nbsp;<span class="builtintype" id="1519779">int</span><span class="op" id="1519782">(</span><span class="ident" id="1519783"><a href="/gostd/runtime/cpuprof.go.html#1511221">unsafe</a></span><span class="op" id="1519789">.</span><span class="ident" id="1519790">Sizeof</span><span class="op" id="1519796">(</span><span class="ident" id="1519797"><a href="/gostd/runtime/cpuprof.go.html#1519624">p</a></span><span class="op" id="1519798">[</span><span class="num" id="1519799">0</span><span class="op" id="1519800">]</span><span class="op" id="1519801">)</span><span class="op" id="1519802">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1519805"><a href="/gostd/runtime/cpuprof.go.html#1519695">rp</a></span><span class="op" id="1519807">.</span><span class="builtinfunc" id="1519808"><a href="/gostd/runtime/slice.go.html#1713411">cap</a></span>&nbsp;<span class="op" id="1519812">=</span>&nbsp;<span class="ident" id="1519814"><a href="/gostd/runtime/cpuprof.go.html#1519695">rp</a></span><span class="op" id="1519816">.</span><span class="builtinfunc" id="1519817"><a href="/gostd/runtime/slice.go.html#1713400">len</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1519823">return</span><br>
<span class="lineno"></span><span class="op" id="1519830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="1519833">//&nbsp;CPUProfile&nbsp;returns&nbsp;the&nbsp;next&nbsp;chunk&nbsp;of&nbsp;binary&nbsp;CPU&nbsp;profiling&nbsp;stack&nbsp;trace&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="1519912">//&nbsp;blocking&nbsp;until&nbsp;data&nbsp;is&nbsp;available.&nbsp;&nbsp;If&nbsp;profiling&nbsp;is&nbsp;turned&nbsp;off&nbsp;and&nbsp;all&nbsp;the&nbsp;profile</span><br>
<span class="lineno"></span><span class="comment" id="1519997">//&nbsp;data&nbsp;accumulated&nbsp;while&nbsp;it&nbsp;was&nbsp;on&nbsp;has&nbsp;been&nbsp;returned,&nbsp;CPUProfile&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1520076">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;save&nbsp;the&nbsp;returned&nbsp;data&nbsp;before&nbsp;calling&nbsp;CPUProfile&nbsp;again.</span><br>
<span class="lineno"></span><span class="comment" id="1520151">//</span><br>
<span class="lineno">420</span><span class="comment" id="1520154">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1520210">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.cpuprofile&nbsp;flag&nbsp;instead&nbsp;of&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="1520276">//&nbsp;CPUProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1520300">func</span>&nbsp;<span class="ident" id="1520305">CPUProfile</span><span class="op" id="1520315">(</span><span class="op" id="1520316">)</span>&nbsp;<span class="op" id="1520318">[</span><span class="op" id="1520319">]</span><span class="builtintype" id="1520320">byte</span>&nbsp;<span class="op" id="1520325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1520328">return</span>&nbsp;<span class="ident" id="1520335"><a href="/gostd/runtime/cpuprof.go.html#1512288">cpuprof</a></span><span class="op" id="1520342">.</span><span class="ident" id="1520343"><a href="/gostd/runtime/cpuprof.go.html#1517552">getprofile</a></span><span class="op" id="1520353">(</span><span class="op" id="1520354">)</span><br>
<span class="lineno">425</span><span class="op" id="1520356">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
