<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html" class="current">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7521292">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7521347">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7521401">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7521452">package</span>&nbsp;<span class="ident" id="7521460">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521465">import</span>&nbsp;<span class="op" id="7521472">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7521475">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7521481">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7521492">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7521503">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7521513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521516">type</span>&nbsp;<span class="ident" id="7521521">listenerFile</span>&nbsp;<span class="keyword" id="7521534">interface</span>&nbsp;<span class="op" id="7521544">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521547">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521557">File</span><span class="op" id="7521561">(</span><span class="op" id="7521562">)</span>&nbsp;<span class="op" id="7521564">(</span><span class="ident" id="7521565">f</span>&nbsp;<span class="op" id="7521567">*</span><span class="ident" id="7521568">os</span><span class="op" id="7521570">.</span><span class="ident" id="7521571">File</span><span class="op" id="7521575">,</span>&nbsp;<span class="ident" id="7521577">err</span>&nbsp;<span class="builtintype" id="7521581">error</span><span class="op" id="7521586">)</span><br>
<span class="lineno"></span><span class="op" id="7521588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521591">type</span>&nbsp;<span class="ident" id="7521596">packetConnFile</span>&nbsp;<span class="keyword" id="7521611">interface</span>&nbsp;<span class="op" id="7521621">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521624">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521636">File</span><span class="op" id="7521640">(</span><span class="op" id="7521641">)</span>&nbsp;<span class="op" id="7521643">(</span><span class="ident" id="7521644">f</span>&nbsp;<span class="op" id="7521646">*</span><span class="ident" id="7521647">os</span><span class="op" id="7521649">.</span><span class="ident" id="7521650">File</span><span class="op" id="7521654">,</span>&nbsp;<span class="ident" id="7521656">err</span>&nbsp;<span class="builtintype" id="7521660">error</span><span class="op" id="7521665">)</span><br>
<span class="lineno"></span><span class="op" id="7521667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521670">type</span>&nbsp;<span class="ident" id="7521675">connFile</span>&nbsp;<span class="keyword" id="7521684">interface</span>&nbsp;<span class="op" id="7521694">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521697">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521703">File</span><span class="op" id="7521707">(</span><span class="op" id="7521708">)</span>&nbsp;<span class="op" id="7521710">(</span><span class="ident" id="7521711">f</span>&nbsp;<span class="op" id="7521713">*</span><span class="ident" id="7521714">os</span><span class="op" id="7521716">.</span><span class="ident" id="7521717">File</span><span class="op" id="7521721">,</span>&nbsp;<span class="ident" id="7521723">err</span>&nbsp;<span class="builtintype" id="7521727">error</span><span class="op" id="7521732">)</span><br>
<span class="lineno"></span><span class="op" id="7521734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521737">func</span>&nbsp;<span class="ident" id="7521742">testFileListener</span><span class="op" id="7521758">(</span><span class="ident" id="7521759">t</span>&nbsp;<span class="op" id="7521761">*</span><span class="ident" id="7521762">testing</span><span class="op" id="7521769">.</span><span class="ident" id="7521770">T</span><span class="op" id="7521771">,</span>&nbsp;<span class="ident" id="7521773">net</span><span class="op" id="7521776">,</span>&nbsp;<span class="ident" id="7521778">laddr</span>&nbsp;<span class="builtintype" id="7521784">string</span><span class="op" id="7521790">)</span>&nbsp;<span class="op" id="7521792">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521795">switch</span>&nbsp;<span class="ident" id="7521802">net</span>&nbsp;<span class="op" id="7521806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521809">case</span>&nbsp;<span class="string" id="7521814">&#34;tcp&#34;</span><span class="op" id="7521819">,</span>&nbsp;<span class="string" id="7521821">&#34;tcp4&#34;</span><span class="op" id="7521827">,</span>&nbsp;<span class="string" id="7521829">&#34;tcp6&#34;</span><span class="op" id="7521835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521839">laddr</span>&nbsp;<span class="op" id="7521845">+=</span>&nbsp;<span class="string" id="7521848">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7521853">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521879">l</span><span class="op" id="7521880">,</span>&nbsp;<span class="ident" id="7521882">err</span>&nbsp;<span class="op" id="7521886">:=</span>&nbsp;<span class="ident" id="7521889">Listen</span><span class="op" id="7521895">(</span><span class="ident" id="7521896">net</span><span class="op" id="7521899">,</span>&nbsp;<span class="ident" id="7521901">laddr</span><span class="op" id="7521906">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521909">if</span>&nbsp;<span class="ident" id="7521912">err</span>&nbsp;<span class="op" id="7521916">!=</span>&nbsp;<span class="ident" id="7521919">nil</span>&nbsp;<span class="op" id="7521923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521927">t</span><span class="op" id="7521928">.</span><span class="ident" id="7521929">Fatalf</span><span class="op" id="7521935">(</span><span class="string" id="7521936">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7521955">,</span>&nbsp;<span class="ident" id="7521957">err</span><span class="op" id="7521960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521966">defer</span>&nbsp;<span class="ident" id="7521972">l</span><span class="op" id="7521973">.</span><span class="ident" id="7521974">Close</span><span class="op" id="7521979">(</span><span class="op" id="7521980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521983">lf</span>&nbsp;<span class="op" id="7521986">:=</span>&nbsp;<span class="ident" id="7521989">l</span><span class="op" id="7521990">.</span><span class="op" id="7521991">(</span><span class="ident" id="7521992">listenerFile</span><span class="op" id="7522004">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522007">f</span><span class="op" id="7522008">,</span>&nbsp;<span class="ident" id="7522010">err</span>&nbsp;<span class="op" id="7522014">:=</span>&nbsp;<span class="ident" id="7522017">lf</span><span class="op" id="7522019">.</span><span class="ident" id="7522020">File</span><span class="op" id="7522024">(</span><span class="op" id="7522025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522028">if</span>&nbsp;<span class="ident" id="7522031">err</span>&nbsp;<span class="op" id="7522035">!=</span>&nbsp;<span class="ident" id="7522038">nil</span>&nbsp;<span class="op" id="7522042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522046">t</span><span class="op" id="7522047">.</span><span class="ident" id="7522048">Fatalf</span><span class="op" id="7522054">(</span><span class="string" id="7522055">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7522072">,</span>&nbsp;<span class="ident" id="7522074">err</span><span class="op" id="7522077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522083">c</span><span class="op" id="7522084">,</span>&nbsp;<span class="ident" id="7522086">err</span>&nbsp;<span class="op" id="7522090">:=</span>&nbsp;<span class="ident" id="7522093">FileListener</span><span class="op" id="7522105">(</span><span class="ident" id="7522106">f</span><span class="op" id="7522107">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522110">if</span>&nbsp;<span class="ident" id="7522113">err</span>&nbsp;<span class="op" id="7522117">!=</span>&nbsp;<span class="ident" id="7522120">nil</span>&nbsp;<span class="op" id="7522124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522128">t</span><span class="op" id="7522129">.</span><span class="ident" id="7522130">Fatalf</span><span class="op" id="7522136">(</span><span class="string" id="7522137">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7522162">,</span>&nbsp;<span class="ident" id="7522164">err</span><span class="op" id="7522167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522173">if</span>&nbsp;<span class="op" id="7522176">!</span><span class="ident" id="7522177">reflect</span><span class="op" id="7522184">.</span><span class="ident" id="7522185">DeepEqual</span><span class="op" id="7522194">(</span><span class="ident" id="7522195">l</span><span class="op" id="7522196">.</span><span class="ident" id="7522197">Addr</span><span class="op" id="7522201">(</span><span class="op" id="7522202">)</span><span class="op" id="7522203">,</span>&nbsp;<span class="ident" id="7522205">c</span><span class="op" id="7522206">.</span><span class="ident" id="7522207">Addr</span><span class="op" id="7522211">(</span><span class="op" id="7522212">)</span><span class="op" id="7522213">)</span>&nbsp;<span class="op" id="7522215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522219">t</span><span class="op" id="7522220">.</span><span class="ident" id="7522221">Fatalf</span><span class="op" id="7522227">(</span><span class="string" id="7522228">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7522257">,</span>&nbsp;<span class="ident" id="7522259">l</span><span class="op" id="7522260">.</span><span class="ident" id="7522261">Addr</span><span class="op" id="7522265">(</span><span class="op" id="7522266">)</span><span class="op" id="7522267">,</span>&nbsp;<span class="ident" id="7522269">c</span><span class="op" id="7522270">.</span><span class="ident" id="7522271">Addr</span><span class="op" id="7522275">(</span><span class="op" id="7522276">)</span><span class="op" id="7522277">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522283">if</span>&nbsp;<span class="ident" id="7522286">err</span>&nbsp;<span class="op" id="7522290">:=</span>&nbsp;<span class="ident" id="7522293">c</span><span class="op" id="7522294">.</span><span class="ident" id="7522295">Close</span><span class="op" id="7522300">(</span><span class="op" id="7522301">)</span><span class="op" id="7522302">;</span>&nbsp;<span class="ident" id="7522304">err</span>&nbsp;<span class="op" id="7522308">!=</span>&nbsp;<span class="ident" id="7522311">nil</span>&nbsp;<span class="op" id="7522315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522319">t</span><span class="op" id="7522320">.</span><span class="ident" id="7522321">Fatalf</span><span class="op" id="7522327">(</span><span class="string" id="7522328">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7522346">,</span>&nbsp;<span class="ident" id="7522348">err</span><span class="op" id="7522351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522357">if</span>&nbsp;<span class="ident" id="7522360">err</span>&nbsp;<span class="op" id="7522364">:=</span>&nbsp;<span class="ident" id="7522367">f</span><span class="op" id="7522368">.</span><span class="ident" id="7522369">Close</span><span class="op" id="7522374">(</span><span class="op" id="7522375">)</span><span class="op" id="7522376">;</span>&nbsp;<span class="ident" id="7522378">err</span>&nbsp;<span class="op" id="7522382">!=</span>&nbsp;<span class="ident" id="7522385">nil</span>&nbsp;<span class="op" id="7522389">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522393">t</span><span class="op" id="7522394">.</span><span class="ident" id="7522395">Fatalf</span><span class="op" id="7522401">(</span><span class="string" id="7522402">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7522420">,</span>&nbsp;<span class="ident" id="7522422">err</span><span class="op" id="7522425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522428">}</span><br>
<span class="lineno"></span><span class="op" id="7522430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7522433">var</span>&nbsp;<span class="ident" id="7522437">fileListenerTests</span>&nbsp;<span class="op" id="7522455">=</span>&nbsp;<span class="op" id="7522457">[</span><span class="op" id="7522458">]</span><span class="keyword" id="7522459">struct</span>&nbsp;<span class="op" id="7522466">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522469">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7522475">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522483">laddr</span>&nbsp;<span class="builtintype" id="7522489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522497">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7522503">bool</span>&nbsp;<span class="comment" id="7522508">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522549">linux</span>&nbsp;<span class="builtintype" id="7522555">bool</span>&nbsp;<span class="comment" id="7522560">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7522614">}</span><span class="op" id="7522615">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522618">{</span><span class="ident" id="7522619">net</span><span class="op" id="7522622">:</span>&nbsp;<span class="string" id="7522624">&#34;tcp&#34;</span><span class="op" id="7522629">,</span>&nbsp;<span class="ident" id="7522631">laddr</span><span class="op" id="7522636">:</span>&nbsp;<span class="string" id="7522638">&#34;&#34;</span><span class="op" id="7522640">}</span><span class="op" id="7522641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522644">{</span><span class="ident" id="7522645">net</span><span class="op" id="7522648">:</span>&nbsp;<span class="string" id="7522650">&#34;tcp&#34;</span><span class="op" id="7522655">,</span>&nbsp;<span class="ident" id="7522657">laddr</span><span class="op" id="7522662">:</span>&nbsp;<span class="string" id="7522664">&#34;0.0.0.0&#34;</span><span class="op" id="7522673">}</span><span class="op" id="7522674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522677">{</span><span class="ident" id="7522678">net</span><span class="op" id="7522681">:</span>&nbsp;<span class="string" id="7522683">&#34;tcp&#34;</span><span class="op" id="7522688">,</span>&nbsp;<span class="ident" id="7522690">laddr</span><span class="op" id="7522695">:</span>&nbsp;<span class="string" id="7522697">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7522715">}</span><span class="op" id="7522716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522719">{</span><span class="ident" id="7522720">net</span><span class="op" id="7522723">:</span>&nbsp;<span class="string" id="7522725">&#34;tcp&#34;</span><span class="op" id="7522730">,</span>&nbsp;<span class="ident" id="7522732">laddr</span><span class="op" id="7522737">:</span>&nbsp;<span class="string" id="7522739">&#34;[::]&#34;</span><span class="op" id="7522745">,</span>&nbsp;<span class="ident" id="7522747">ipv6</span><span class="op" id="7522751">:</span>&nbsp;<span class="builtintype" id="7522753">true</span><span class="op" id="7522757">}</span><span class="op" id="7522758">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522762">{</span><span class="ident" id="7522763">net</span><span class="op" id="7522766">:</span>&nbsp;<span class="string" id="7522768">&#34;tcp&#34;</span><span class="op" id="7522773">,</span>&nbsp;<span class="ident" id="7522775">laddr</span><span class="op" id="7522780">:</span>&nbsp;<span class="string" id="7522782">&#34;127.0.0.1&#34;</span><span class="op" id="7522793">}</span><span class="op" id="7522794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522797">{</span><span class="ident" id="7522798">net</span><span class="op" id="7522801">:</span>&nbsp;<span class="string" id="7522803">&#34;tcp&#34;</span><span class="op" id="7522808">,</span>&nbsp;<span class="ident" id="7522810">laddr</span><span class="op" id="7522815">:</span>&nbsp;<span class="string" id="7522817">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7522837">}</span><span class="op" id="7522838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522841">{</span><span class="ident" id="7522842">net</span><span class="op" id="7522845">:</span>&nbsp;<span class="string" id="7522847">&#34;tcp&#34;</span><span class="op" id="7522852">,</span>&nbsp;<span class="ident" id="7522854">laddr</span><span class="op" id="7522859">:</span>&nbsp;<span class="string" id="7522861">&#34;[::1]&#34;</span><span class="op" id="7522868">,</span>&nbsp;<span class="ident" id="7522870">ipv6</span><span class="op" id="7522874">:</span>&nbsp;<span class="builtintype" id="7522876">true</span><span class="op" id="7522880">}</span><span class="op" id="7522881">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522885">{</span><span class="ident" id="7522886">net</span><span class="op" id="7522889">:</span>&nbsp;<span class="string" id="7522891">&#34;tcp4&#34;</span><span class="op" id="7522897">,</span>&nbsp;<span class="ident" id="7522899">laddr</span><span class="op" id="7522904">:</span>&nbsp;<span class="string" id="7522906">&#34;&#34;</span><span class="op" id="7522908">}</span><span class="op" id="7522909">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522912">{</span><span class="ident" id="7522913">net</span><span class="op" id="7522916">:</span>&nbsp;<span class="string" id="7522918">&#34;tcp4&#34;</span><span class="op" id="7522924">,</span>&nbsp;<span class="ident" id="7522926">laddr</span><span class="op" id="7522931">:</span>&nbsp;<span class="string" id="7522933">&#34;0.0.0.0&#34;</span><span class="op" id="7522942">}</span><span class="op" id="7522943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522946">{</span><span class="ident" id="7522947">net</span><span class="op" id="7522950">:</span>&nbsp;<span class="string" id="7522952">&#34;tcp4&#34;</span><span class="op" id="7522958">,</span>&nbsp;<span class="ident" id="7522960">laddr</span><span class="op" id="7522965">:</span>&nbsp;<span class="string" id="7522967">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7522985">}</span><span class="op" id="7522986">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522990">{</span><span class="ident" id="7522991">net</span><span class="op" id="7522994">:</span>&nbsp;<span class="string" id="7522996">&#34;tcp4&#34;</span><span class="op" id="7523002">,</span>&nbsp;<span class="ident" id="7523004">laddr</span><span class="op" id="7523009">:</span>&nbsp;<span class="string" id="7523011">&#34;127.0.0.1&#34;</span><span class="op" id="7523022">}</span><span class="op" id="7523023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523026">{</span><span class="ident" id="7523027">net</span><span class="op" id="7523030">:</span>&nbsp;<span class="string" id="7523032">&#34;tcp4&#34;</span><span class="op" id="7523038">,</span>&nbsp;<span class="ident" id="7523040">laddr</span><span class="op" id="7523045">:</span>&nbsp;<span class="string" id="7523047">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7523067">}</span><span class="op" id="7523068">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523072">{</span><span class="ident" id="7523073">net</span><span class="op" id="7523076">:</span>&nbsp;<span class="string" id="7523078">&#34;tcp6&#34;</span><span class="op" id="7523084">,</span>&nbsp;<span class="ident" id="7523086">laddr</span><span class="op" id="7523091">:</span>&nbsp;<span class="string" id="7523093">&#34;&#34;</span><span class="op" id="7523095">,</span>&nbsp;<span class="ident" id="7523097">ipv6</span><span class="op" id="7523101">:</span>&nbsp;<span class="builtintype" id="7523103">true</span><span class="op" id="7523107">}</span><span class="op" id="7523108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523111">{</span><span class="ident" id="7523112">net</span><span class="op" id="7523115">:</span>&nbsp;<span class="string" id="7523117">&#34;tcp6&#34;</span><span class="op" id="7523123">,</span>&nbsp;<span class="ident" id="7523125">laddr</span><span class="op" id="7523130">:</span>&nbsp;<span class="string" id="7523132">&#34;[::]&#34;</span><span class="op" id="7523138">,</span>&nbsp;<span class="ident" id="7523140">ipv6</span><span class="op" id="7523144">:</span>&nbsp;<span class="builtintype" id="7523146">true</span><span class="op" id="7523150">}</span><span class="op" id="7523151">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523155">{</span><span class="ident" id="7523156">net</span><span class="op" id="7523159">:</span>&nbsp;<span class="string" id="7523161">&#34;tcp6&#34;</span><span class="op" id="7523167">,</span>&nbsp;<span class="ident" id="7523169">laddr</span><span class="op" id="7523174">:</span>&nbsp;<span class="string" id="7523176">&#34;[::1]&#34;</span><span class="op" id="7523183">,</span>&nbsp;<span class="ident" id="7523185">ipv6</span><span class="op" id="7523189">:</span>&nbsp;<span class="builtintype" id="7523191">true</span><span class="op" id="7523195">}</span><span class="op" id="7523196">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523200">{</span><span class="ident" id="7523201">net</span><span class="op" id="7523204">:</span>&nbsp;<span class="string" id="7523206">&#34;unix&#34;</span><span class="op" id="7523212">,</span>&nbsp;<span class="ident" id="7523214">laddr</span><span class="op" id="7523219">:</span>&nbsp;<span class="string" id="7523221">&#34;@gotest/net&#34;</span><span class="op" id="7523234">,</span>&nbsp;<span class="ident" id="7523236">linux</span><span class="op" id="7523241">:</span>&nbsp;<span class="builtintype" id="7523243">true</span><span class="op" id="7523247">}</span><span class="op" id="7523248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523251">{</span><span class="ident" id="7523252">net</span><span class="op" id="7523255">:</span>&nbsp;<span class="string" id="7523257">&#34;unixpacket&#34;</span><span class="op" id="7523269">,</span>&nbsp;<span class="ident" id="7523271">laddr</span><span class="op" id="7523276">:</span>&nbsp;<span class="string" id="7523278">&#34;@gotest/net&#34;</span><span class="op" id="7523291">,</span>&nbsp;<span class="ident" id="7523293">linux</span><span class="op" id="7523298">:</span>&nbsp;<span class="builtintype" id="7523300">true</span><span class="op" id="7523304">}</span><span class="op" id="7523305">,</span><br>
<span class="lineno"></span><span class="op" id="7523307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7523310">func</span>&nbsp;<span class="ident" id="7523315">TestFileListener</span><span class="op" id="7523331">(</span><span class="ident" id="7523332">t</span>&nbsp;<span class="op" id="7523334">*</span><span class="ident" id="7523335">testing</span><span class="op" id="7523342">.</span><span class="ident" id="7523343">T</span><span class="op" id="7523344">)</span>&nbsp;<span class="op" id="7523346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523349">switch</span>&nbsp;<span class="ident" id="7523356">runtime</span><span class="op" id="7523363">.</span><span class="ident" id="7523364">GOOS</span>&nbsp;<span class="op" id="7523369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523372">case</span>&nbsp;<span class="string" id="7523377">&#34;nacl&#34;</span><span class="op" id="7523383">,</span>&nbsp;<span class="string" id="7523385">&#34;windows&#34;</span><span class="op" id="7523394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523398">t</span><span class="op" id="7523399">.</span><span class="ident" id="7523400">Skipf</span><span class="op" id="7523405">(</span><span class="string" id="7523406">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7523427">,</span>&nbsp;<span class="ident" id="7523429">runtime</span><span class="op" id="7523436">.</span><span class="ident" id="7523437">GOOS</span><span class="op" id="7523441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523444">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523448">for</span>&nbsp;<span class="ident" id="7523452">_</span><span class="op" id="7523453">,</span>&nbsp;<span class="ident" id="7523455">tt</span>&nbsp;<span class="op" id="7523458">:=</span>&nbsp;<span class="keyword" id="7523461">range</span>&nbsp;<span class="ident" id="7523467">fileListenerTests</span>&nbsp;<span class="op" id="7523485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523489">if</span>&nbsp;<span class="ident" id="7523492">skipServerTest</span><span class="op" id="7523506">(</span><span class="ident" id="7523507">tt</span><span class="op" id="7523509">.</span><span class="ident" id="7523510">net</span><span class="op" id="7523513">,</span>&nbsp;<span class="string" id="7523515">&#34;unix&#34;</span><span class="op" id="7523521">,</span>&nbsp;<span class="ident" id="7523523">tt</span><span class="op" id="7523525">.</span><span class="ident" id="7523526">laddr</span><span class="op" id="7523531">,</span>&nbsp;<span class="ident" id="7523533">tt</span><span class="op" id="7523535">.</span><span class="ident" id="7523536">ipv6</span><span class="op" id="7523540">,</span>&nbsp;<span class="builtintype" id="7523542">false</span><span class="op" id="7523547">,</span>&nbsp;<span class="ident" id="7523549">tt</span><span class="op" id="7523551">.</span><span class="ident" id="7523552">linux</span><span class="op" id="7523557">)</span>&nbsp;<span class="op" id="7523559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523575">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523579">if</span>&nbsp;<span class="ident" id="7523582">skipServerTest</span><span class="op" id="7523596">(</span><span class="ident" id="7523597">tt</span><span class="op" id="7523599">.</span><span class="ident" id="7523600">net</span><span class="op" id="7523603">,</span>&nbsp;<span class="string" id="7523605">&#34;unixpacket&#34;</span><span class="op" id="7523617">,</span>&nbsp;<span class="ident" id="7523619">tt</span><span class="op" id="7523621">.</span><span class="ident" id="7523622">laddr</span><span class="op" id="7523627">,</span>&nbsp;<span class="ident" id="7523629">tt</span><span class="op" id="7523631">.</span><span class="ident" id="7523632">ipv6</span><span class="op" id="7523636">,</span>&nbsp;<span class="builtintype" id="7523638">false</span><span class="op" id="7523643">,</span>&nbsp;<span class="ident" id="7523645">tt</span><span class="op" id="7523647">.</span><span class="ident" id="7523648">linux</span><span class="op" id="7523653">)</span>&nbsp;<span class="op" id="7523655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523675">testFileListener</span><span class="op" id="7523691">(</span><span class="ident" id="7523692">t</span><span class="op" id="7523693">,</span>&nbsp;<span class="ident" id="7523695">tt</span><span class="op" id="7523697">.</span><span class="ident" id="7523698">net</span><span class="op" id="7523701">,</span>&nbsp;<span class="ident" id="7523703">tt</span><span class="op" id="7523705">.</span><span class="ident" id="7523706">laddr</span><span class="op" id="7523711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523714">}</span><br>
<span class="lineno">105</span><span class="op" id="7523716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7523719">func</span>&nbsp;<span class="ident" id="7523724">testFilePacketConn</span><span class="op" id="7523742">(</span><span class="ident" id="7523743">t</span>&nbsp;<span class="op" id="7523745">*</span><span class="ident" id="7523746">testing</span><span class="op" id="7523753">.</span><span class="ident" id="7523754">T</span><span class="op" id="7523755">,</span>&nbsp;<span class="ident" id="7523757">pcf</span>&nbsp;<span class="ident" id="7523761">packetConnFile</span><span class="op" id="7523775">,</span>&nbsp;<span class="ident" id="7523777">listen</span>&nbsp;<span class="builtintype" id="7523784">bool</span><span class="op" id="7523788">)</span>&nbsp;<span class="op" id="7523790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523793">f</span><span class="op" id="7523794">,</span>&nbsp;<span class="ident" id="7523796">err</span>&nbsp;<span class="op" id="7523800">:=</span>&nbsp;<span class="ident" id="7523803">pcf</span><span class="op" id="7523806">.</span><span class="ident" id="7523807">File</span><span class="op" id="7523811">(</span><span class="op" id="7523812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523815">if</span>&nbsp;<span class="ident" id="7523818">err</span>&nbsp;<span class="op" id="7523822">!=</span>&nbsp;<span class="ident" id="7523825">nil</span>&nbsp;<span class="op" id="7523829">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523833">t</span><span class="op" id="7523834">.</span><span class="ident" id="7523835">Fatalf</span><span class="op" id="7523841">(</span><span class="string" id="7523842">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7523859">,</span>&nbsp;<span class="ident" id="7523861">err</span><span class="op" id="7523864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523870">c</span><span class="op" id="7523871">,</span>&nbsp;<span class="ident" id="7523873">err</span>&nbsp;<span class="op" id="7523877">:=</span>&nbsp;<span class="ident" id="7523880">FilePacketConn</span><span class="op" id="7523894">(</span><span class="ident" id="7523895">f</span><span class="op" id="7523896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523899">if</span>&nbsp;<span class="ident" id="7523902">err</span>&nbsp;<span class="op" id="7523906">!=</span>&nbsp;<span class="ident" id="7523909">nil</span>&nbsp;<span class="op" id="7523913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523917">t</span><span class="op" id="7523918">.</span><span class="ident" id="7523919">Fatalf</span><span class="op" id="7523925">(</span><span class="string" id="7523926">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7523953">,</span>&nbsp;<span class="ident" id="7523955">err</span><span class="op" id="7523958">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523964">if</span>&nbsp;<span class="op" id="7523967">!</span><span class="ident" id="7523968">reflect</span><span class="op" id="7523975">.</span><span class="ident" id="7523976">DeepEqual</span><span class="op" id="7523985">(</span><span class="ident" id="7523986">pcf</span><span class="op" id="7523989">.</span><span class="ident" id="7523990">LocalAddr</span><span class="op" id="7523999">(</span><span class="op" id="7524000">)</span><span class="op" id="7524001">,</span>&nbsp;<span class="ident" id="7524003">c</span><span class="op" id="7524004">.</span><span class="ident" id="7524005">LocalAddr</span><span class="op" id="7524014">(</span><span class="op" id="7524015">)</span><span class="op" id="7524016">)</span>&nbsp;<span class="op" id="7524018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524022">t</span><span class="op" id="7524023">.</span><span class="ident" id="7524024">Fatalf</span><span class="op" id="7524030">(</span><span class="string" id="7524031">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7524065">,</span>&nbsp;<span class="ident" id="7524067">pcf</span><span class="op" id="7524070">.</span><span class="ident" id="7524071">LocalAddr</span><span class="op" id="7524080">(</span><span class="op" id="7524081">)</span><span class="op" id="7524082">,</span>&nbsp;<span class="ident" id="7524084">c</span><span class="op" id="7524085">.</span><span class="ident" id="7524086">LocalAddr</span><span class="op" id="7524095">(</span><span class="op" id="7524096">)</span><span class="op" id="7524097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524103">if</span>&nbsp;<span class="ident" id="7524106">listen</span>&nbsp;<span class="op" id="7524113">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524117">if</span>&nbsp;<span class="ident" id="7524120">_</span><span class="op" id="7524121">,</span>&nbsp;<span class="ident" id="7524123">err</span>&nbsp;<span class="op" id="7524127">:=</span>&nbsp;<span class="ident" id="7524130">c</span><span class="op" id="7524131">.</span><span class="ident" id="7524132">WriteTo</span><span class="op" id="7524139">(</span><span class="op" id="7524140">[</span><span class="op" id="7524141">]</span><span class="builtintype" id="7524142">byte</span><span class="op" id="7524146">{</span><span class="op" id="7524147">}</span><span class="op" id="7524148">,</span>&nbsp;<span class="ident" id="7524150">c</span><span class="op" id="7524151">.</span><span class="ident" id="7524152">LocalAddr</span><span class="op" id="7524161">(</span><span class="op" id="7524162">)</span><span class="op" id="7524163">)</span><span class="op" id="7524164">;</span>&nbsp;<span class="ident" id="7524166">err</span>&nbsp;<span class="op" id="7524170">!=</span>&nbsp;<span class="ident" id="7524173">nil</span>&nbsp;<span class="op" id="7524177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524182">t</span><span class="op" id="7524183">.</span><span class="ident" id="7524184">Fatalf</span><span class="op" id="7524190">(</span><span class="string" id="7524191">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524211">,</span>&nbsp;<span class="ident" id="7524213">err</span><span class="op" id="7524216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524226">if</span>&nbsp;<span class="ident" id="7524229">err</span>&nbsp;<span class="op" id="7524233">:=</span>&nbsp;<span class="ident" id="7524236">c</span><span class="op" id="7524237">.</span><span class="ident" id="7524238">Close</span><span class="op" id="7524243">(</span><span class="op" id="7524244">)</span><span class="op" id="7524245">;</span>&nbsp;<span class="ident" id="7524247">err</span>&nbsp;<span class="op" id="7524251">!=</span>&nbsp;<span class="ident" id="7524254">nil</span>&nbsp;<span class="op" id="7524258">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524262">t</span><span class="op" id="7524263">.</span><span class="ident" id="7524264">Fatalf</span><span class="op" id="7524270">(</span><span class="string" id="7524271">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524289">,</span>&nbsp;<span class="ident" id="7524291">err</span><span class="op" id="7524294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524300">if</span>&nbsp;<span class="ident" id="7524303">err</span>&nbsp;<span class="op" id="7524307">:=</span>&nbsp;<span class="ident" id="7524310">f</span><span class="op" id="7524311">.</span><span class="ident" id="7524312">Close</span><span class="op" id="7524317">(</span><span class="op" id="7524318">)</span><span class="op" id="7524319">;</span>&nbsp;<span class="ident" id="7524321">err</span>&nbsp;<span class="op" id="7524325">!=</span>&nbsp;<span class="ident" id="7524328">nil</span>&nbsp;<span class="op" id="7524332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524336">t</span><span class="op" id="7524337">.</span><span class="ident" id="7524338">Fatalf</span><span class="op" id="7524344">(</span><span class="string" id="7524345">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524363">,</span>&nbsp;<span class="ident" id="7524365">err</span><span class="op" id="7524368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524371">}</span><br>
<span class="lineno">130</span><span class="op" id="7524373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7524376">func</span>&nbsp;<span class="ident" id="7524381">testFilePacketConnListen</span><span class="op" id="7524405">(</span><span class="ident" id="7524406">t</span>&nbsp;<span class="op" id="7524408">*</span><span class="ident" id="7524409">testing</span><span class="op" id="7524416">.</span><span class="ident" id="7524417">T</span><span class="op" id="7524418">,</span>&nbsp;<span class="ident" id="7524420">net</span><span class="op" id="7524423">,</span>&nbsp;<span class="ident" id="7524425">laddr</span>&nbsp;<span class="builtintype" id="7524431">string</span><span class="op" id="7524437">)</span>&nbsp;<span class="op" id="7524439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524442">switch</span>&nbsp;<span class="ident" id="7524449">net</span>&nbsp;<span class="op" id="7524453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524456">case</span>&nbsp;<span class="string" id="7524461">&#34;udp&#34;</span><span class="op" id="7524466">,</span>&nbsp;<span class="string" id="7524468">&#34;udp4&#34;</span><span class="op" id="7524474">,</span>&nbsp;<span class="string" id="7524476">&#34;udp6&#34;</span><span class="op" id="7524482">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524486">laddr</span>&nbsp;<span class="op" id="7524492">+=</span>&nbsp;<span class="string" id="7524495">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7524500">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524526">l</span><span class="op" id="7524527">,</span>&nbsp;<span class="ident" id="7524529">err</span>&nbsp;<span class="op" id="7524533">:=</span>&nbsp;<span class="ident" id="7524536">ListenPacket</span><span class="op" id="7524548">(</span><span class="ident" id="7524549">net</span><span class="op" id="7524552">,</span>&nbsp;<span class="ident" id="7524554">laddr</span><span class="op" id="7524559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524562">if</span>&nbsp;<span class="ident" id="7524565">err</span>&nbsp;<span class="op" id="7524569">!=</span>&nbsp;<span class="ident" id="7524572">nil</span>&nbsp;<span class="op" id="7524576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524580">t</span><span class="op" id="7524581">.</span><span class="ident" id="7524582">Fatalf</span><span class="op" id="7524588">(</span><span class="string" id="7524589">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524614">,</span>&nbsp;<span class="ident" id="7524616">err</span><span class="op" id="7524619">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524625">testFilePacketConn</span><span class="op" id="7524643">(</span><span class="ident" id="7524644">t</span><span class="op" id="7524645">,</span>&nbsp;<span class="ident" id="7524647">l</span><span class="op" id="7524648">.</span><span class="op" id="7524649">(</span><span class="ident" id="7524650">packetConnFile</span><span class="op" id="7524664">)</span><span class="op" id="7524665">,</span>&nbsp;<span class="builtintype" id="7524667">true</span><span class="op" id="7524671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524674">if</span>&nbsp;<span class="ident" id="7524677">err</span>&nbsp;<span class="op" id="7524681">:=</span>&nbsp;<span class="ident" id="7524684">l</span><span class="op" id="7524685">.</span><span class="ident" id="7524686">Close</span><span class="op" id="7524691">(</span><span class="op" id="7524692">)</span><span class="op" id="7524693">;</span>&nbsp;<span class="ident" id="7524695">err</span>&nbsp;<span class="op" id="7524699">!=</span>&nbsp;<span class="ident" id="7524702">nil</span>&nbsp;<span class="op" id="7524706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524710">t</span><span class="op" id="7524711">.</span><span class="ident" id="7524712">Fatalf</span><span class="op" id="7524718">(</span><span class="string" id="7524719">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524737">,</span>&nbsp;<span class="ident" id="7524739">err</span><span class="op" id="7524742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524745">}</span><br>
<span class="lineno">145</span><span class="op" id="7524747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7524750">func</span>&nbsp;<span class="ident" id="7524755">testFilePacketConnDial</span><span class="op" id="7524777">(</span><span class="ident" id="7524778">t</span>&nbsp;<span class="op" id="7524780">*</span><span class="ident" id="7524781">testing</span><span class="op" id="7524788">.</span><span class="ident" id="7524789">T</span><span class="op" id="7524790">,</span>&nbsp;<span class="ident" id="7524792">net</span><span class="op" id="7524795">,</span>&nbsp;<span class="ident" id="7524797">raddr</span>&nbsp;<span class="builtintype" id="7524803">string</span><span class="op" id="7524809">)</span>&nbsp;<span class="op" id="7524811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524814">switch</span>&nbsp;<span class="ident" id="7524821">net</span>&nbsp;<span class="op" id="7524825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524828">case</span>&nbsp;<span class="string" id="7524833">&#34;udp&#34;</span><span class="op" id="7524838">,</span>&nbsp;<span class="string" id="7524840">&#34;udp4&#34;</span><span class="op" id="7524846">,</span>&nbsp;<span class="string" id="7524848">&#34;udp6&#34;</span><span class="op" id="7524854">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524858">raddr</span>&nbsp;<span class="op" id="7524864">+=</span>&nbsp;<span class="string" id="7524867">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524880">c</span><span class="op" id="7524881">,</span>&nbsp;<span class="ident" id="7524883">err</span>&nbsp;<span class="op" id="7524887">:=</span>&nbsp;<span class="ident" id="7524890">Dial</span><span class="op" id="7524894">(</span><span class="ident" id="7524895">net</span><span class="op" id="7524898">,</span>&nbsp;<span class="ident" id="7524900">raddr</span><span class="op" id="7524905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524908">if</span>&nbsp;<span class="ident" id="7524911">err</span>&nbsp;<span class="op" id="7524915">!=</span>&nbsp;<span class="ident" id="7524918">nil</span>&nbsp;<span class="op" id="7524922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524926">t</span><span class="op" id="7524927">.</span><span class="ident" id="7524928">Fatalf</span><span class="op" id="7524934">(</span><span class="string" id="7524935">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524952">,</span>&nbsp;<span class="ident" id="7524954">err</span><span class="op" id="7524957">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524963">testFilePacketConn</span><span class="op" id="7524981">(</span><span class="ident" id="7524982">t</span><span class="op" id="7524983">,</span>&nbsp;<span class="ident" id="7524985">c</span><span class="op" id="7524986">.</span><span class="op" id="7524987">(</span><span class="ident" id="7524988">packetConnFile</span><span class="op" id="7525002">)</span><span class="op" id="7525003">,</span>&nbsp;<span class="builtintype" id="7525005">false</span><span class="op" id="7525010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525013">if</span>&nbsp;<span class="ident" id="7525016">err</span>&nbsp;<span class="op" id="7525020">:=</span>&nbsp;<span class="ident" id="7525023">c</span><span class="op" id="7525024">.</span><span class="ident" id="7525025">Close</span><span class="op" id="7525030">(</span><span class="op" id="7525031">)</span><span class="op" id="7525032">;</span>&nbsp;<span class="ident" id="7525034">err</span>&nbsp;<span class="op" id="7525038">!=</span>&nbsp;<span class="ident" id="7525041">nil</span>&nbsp;<span class="op" id="7525045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525049">t</span><span class="op" id="7525050">.</span><span class="ident" id="7525051">Fatalf</span><span class="op" id="7525057">(</span><span class="string" id="7525058">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7525076">,</span>&nbsp;<span class="ident" id="7525078">err</span><span class="op" id="7525081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525084">}</span><br>
<span class="lineno">160</span><span class="op" id="7525086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7525089">var</span>&nbsp;<span class="ident" id="7525093">filePacketConnTests</span>&nbsp;<span class="op" id="7525113">=</span>&nbsp;<span class="op" id="7525115">[</span><span class="op" id="7525116">]</span><span class="keyword" id="7525117">struct</span>&nbsp;<span class="op" id="7525124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525127">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7525133">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525141">addr</span>&nbsp;&nbsp;<span class="builtintype" id="7525147">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525155">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7525161">bool</span>&nbsp;<span class="comment" id="7525166">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525207">linux</span>&nbsp;<span class="builtintype" id="7525213">bool</span>&nbsp;<span class="comment" id="7525218">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7525272">}</span><span class="op" id="7525273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525276">{</span><span class="ident" id="7525277">net</span><span class="op" id="7525280">:</span>&nbsp;<span class="string" id="7525282">&#34;udp&#34;</span><span class="op" id="7525287">,</span>&nbsp;<span class="ident" id="7525289">addr</span><span class="op" id="7525293">:</span>&nbsp;<span class="string" id="7525295">&#34;127.0.0.1&#34;</span><span class="op" id="7525306">}</span><span class="op" id="7525307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525310">{</span><span class="ident" id="7525311">net</span><span class="op" id="7525314">:</span>&nbsp;<span class="string" id="7525316">&#34;udp&#34;</span><span class="op" id="7525321">,</span>&nbsp;<span class="ident" id="7525323">addr</span><span class="op" id="7525327">:</span>&nbsp;<span class="string" id="7525329">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7525349">}</span><span class="op" id="7525350">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525353">{</span><span class="ident" id="7525354">net</span><span class="op" id="7525357">:</span>&nbsp;<span class="string" id="7525359">&#34;udp&#34;</span><span class="op" id="7525364">,</span>&nbsp;<span class="ident" id="7525366">addr</span><span class="op" id="7525370">:</span>&nbsp;<span class="string" id="7525372">&#34;[::1]&#34;</span><span class="op" id="7525379">,</span>&nbsp;<span class="ident" id="7525381">ipv6</span><span class="op" id="7525385">:</span>&nbsp;<span class="builtintype" id="7525387">true</span><span class="op" id="7525391">}</span><span class="op" id="7525392">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525396">{</span><span class="ident" id="7525397">net</span><span class="op" id="7525400">:</span>&nbsp;<span class="string" id="7525402">&#34;udp4&#34;</span><span class="op" id="7525408">,</span>&nbsp;<span class="ident" id="7525410">addr</span><span class="op" id="7525414">:</span>&nbsp;<span class="string" id="7525416">&#34;127.0.0.1&#34;</span><span class="op" id="7525427">}</span><span class="op" id="7525428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525431">{</span><span class="ident" id="7525432">net</span><span class="op" id="7525435">:</span>&nbsp;<span class="string" id="7525437">&#34;udp4&#34;</span><span class="op" id="7525443">,</span>&nbsp;<span class="ident" id="7525445">addr</span><span class="op" id="7525449">:</span>&nbsp;<span class="string" id="7525451">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7525471">}</span><span class="op" id="7525472">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525476">{</span><span class="ident" id="7525477">net</span><span class="op" id="7525480">:</span>&nbsp;<span class="string" id="7525482">&#34;udp6&#34;</span><span class="op" id="7525488">,</span>&nbsp;<span class="ident" id="7525490">addr</span><span class="op" id="7525494">:</span>&nbsp;<span class="string" id="7525496">&#34;[::1]&#34;</span><span class="op" id="7525503">,</span>&nbsp;<span class="ident" id="7525505">ipv6</span><span class="op" id="7525509">:</span>&nbsp;<span class="builtintype" id="7525511">true</span><span class="op" id="7525515">}</span><span class="op" id="7525516">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525520">{</span><span class="ident" id="7525521">net</span><span class="op" id="7525524">:</span>&nbsp;<span class="string" id="7525526">&#34;ip4:icmp&#34;</span><span class="op" id="7525536">,</span>&nbsp;<span class="ident" id="7525538">addr</span><span class="op" id="7525542">:</span>&nbsp;<span class="string" id="7525544">&#34;127.0.0.1&#34;</span><span class="op" id="7525555">}</span><span class="op" id="7525556">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525560">{</span><span class="ident" id="7525561">net</span><span class="op" id="7525564">:</span>&nbsp;<span class="string" id="7525566">&#34;unixgram&#34;</span><span class="op" id="7525576">,</span>&nbsp;<span class="ident" id="7525578">addr</span><span class="op" id="7525582">:</span>&nbsp;<span class="string" id="7525584">&#34;@gotest3/net&#34;</span><span class="op" id="7525598">,</span>&nbsp;<span class="ident" id="7525600">linux</span><span class="op" id="7525605">:</span>&nbsp;<span class="builtintype" id="7525607">true</span><span class="op" id="7525611">}</span><span class="op" id="7525612">,</span><br>
<span class="lineno">180</span><span class="op" id="7525614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7525617">func</span>&nbsp;<span class="ident" id="7525622">TestFilePacketConn</span><span class="op" id="7525640">(</span><span class="ident" id="7525641">t</span>&nbsp;<span class="op" id="7525643">*</span><span class="ident" id="7525644">testing</span><span class="op" id="7525651">.</span><span class="ident" id="7525652">T</span><span class="op" id="7525653">)</span>&nbsp;<span class="op" id="7525655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525658">switch</span>&nbsp;<span class="ident" id="7525665">runtime</span><span class="op" id="7525672">.</span><span class="ident" id="7525673">GOOS</span>&nbsp;<span class="op" id="7525678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525681">case</span>&nbsp;<span class="string" id="7525686">&#34;nacl&#34;</span><span class="op" id="7525692">,</span>&nbsp;<span class="string" id="7525694">&#34;plan9&#34;</span><span class="op" id="7525701">,</span>&nbsp;<span class="string" id="7525703">&#34;windows&#34;</span><span class="op" id="7525712">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525716">t</span><span class="op" id="7525717">.</span><span class="ident" id="7525718">Skipf</span><span class="op" id="7525723">(</span><span class="string" id="7525724">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7525745">,</span>&nbsp;<span class="ident" id="7525747">runtime</span><span class="op" id="7525754">.</span><span class="ident" id="7525755">GOOS</span><span class="op" id="7525759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525766">for</span>&nbsp;<span class="ident" id="7525770">_</span><span class="op" id="7525771">,</span>&nbsp;<span class="ident" id="7525773">tt</span>&nbsp;<span class="op" id="7525776">:=</span>&nbsp;<span class="keyword" id="7525779">range</span>&nbsp;<span class="ident" id="7525785">filePacketConnTests</span>&nbsp;<span class="op" id="7525805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525809">if</span>&nbsp;<span class="ident" id="7525812">skipServerTest</span><span class="op" id="7525826">(</span><span class="ident" id="7525827">tt</span><span class="op" id="7525829">.</span><span class="ident" id="7525830">net</span><span class="op" id="7525833">,</span>&nbsp;<span class="string" id="7525835">&#34;unixgram&#34;</span><span class="op" id="7525845">,</span>&nbsp;<span class="ident" id="7525847">tt</span><span class="op" id="7525849">.</span><span class="ident" id="7525850">addr</span><span class="op" id="7525854">,</span>&nbsp;<span class="ident" id="7525856">tt</span><span class="op" id="7525858">.</span><span class="ident" id="7525859">ipv6</span><span class="op" id="7525863">,</span>&nbsp;<span class="builtintype" id="7525865">false</span><span class="op" id="7525870">,</span>&nbsp;<span class="ident" id="7525872">tt</span><span class="op" id="7525874">.</span><span class="ident" id="7525875">linux</span><span class="op" id="7525880">)</span>&nbsp;<span class="op" id="7525882">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525887">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525902">if</span>&nbsp;<span class="ident" id="7525905">os</span><span class="op" id="7525907">.</span><span class="ident" id="7525908">Getuid</span><span class="op" id="7525914">(</span><span class="op" id="7525915">)</span>&nbsp;<span class="op" id="7525917">!=</span>&nbsp;<span class="num" id="7525920">0</span>&nbsp;<span class="op" id="7525922">&amp;&amp;</span>&nbsp;<span class="ident" id="7525925">tt</span><span class="op" id="7525927">.</span><span class="ident" id="7525928">net</span>&nbsp;<span class="op" id="7525932">==</span>&nbsp;<span class="string" id="7525935">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="7525946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525951">t</span><span class="op" id="7525952">.</span><span class="ident" id="7525953">Log</span><span class="op" id="7525956">(</span><span class="string" id="7525957">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7525986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525991">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526006">testFilePacketConnListen</span><span class="op" id="7526030">(</span><span class="ident" id="7526031">t</span><span class="op" id="7526032">,</span>&nbsp;<span class="ident" id="7526034">tt</span><span class="op" id="7526036">.</span><span class="ident" id="7526037">net</span><span class="op" id="7526040">,</span>&nbsp;<span class="ident" id="7526042">tt</span><span class="op" id="7526044">.</span><span class="ident" id="7526045">addr</span><span class="op" id="7526049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526053">switch</span>&nbsp;<span class="ident" id="7526060">tt</span><span class="op" id="7526062">.</span><span class="ident" id="7526063">addr</span>&nbsp;<span class="op" id="7526068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526072">case</span>&nbsp;<span class="string" id="7526077">&#34;&#34;</span><span class="op" id="7526079">,</span>&nbsp;<span class="string" id="7526081">&#34;0.0.0.0&#34;</span><span class="op" id="7526090">,</span>&nbsp;<span class="string" id="7526092">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7526110">,</span>&nbsp;<span class="string" id="7526112">&#34;[::]&#34;</span><span class="op" id="7526118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526122">default</span><span class="op" id="7526129">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526134">if</span>&nbsp;<span class="ident" id="7526137">tt</span><span class="op" id="7526139">.</span><span class="ident" id="7526140">net</span>&nbsp;<span class="op" id="7526144">!=</span>&nbsp;<span class="string" id="7526147">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7526158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526164">testFilePacketConnDial</span><span class="op" id="7526186">(</span><span class="ident" id="7526187">t</span><span class="op" id="7526188">,</span>&nbsp;<span class="ident" id="7526190">tt</span><span class="op" id="7526192">.</span><span class="ident" id="7526193">net</span><span class="op" id="7526196">,</span>&nbsp;<span class="ident" id="7526198">tt</span><span class="op" id="7526200">.</span><span class="ident" id="7526201">addr</span><span class="op" id="7526205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526217">}</span><br>
<span class="lineno">205</span><span class="op" id="7526219">}</span>
</div>
</body>
</html>
