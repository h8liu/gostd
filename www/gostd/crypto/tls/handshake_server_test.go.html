<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8135284">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8135339">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8135393">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8135444">package</span>&nbsp;<span class="ident" id="8135452">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8135457">import</span>&nbsp;<span class="op" id="8135464">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135467">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135476">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135492">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135511">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135525">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135541">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135557">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135567">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135574">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135580">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135592">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135599">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135605">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135616">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135633">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135644">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8135655">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="8135662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8135665">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8135743">type</span>&nbsp;<span class="ident" id="8135748">zeroSource</span>&nbsp;<span class="keyword" id="8135759">struct</span><span class="op" id="8135765">{</span><span class="op" id="8135766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8135769">func</span>&nbsp;<span class="op" id="8135774">(</span><span class="ident" id="8135775">zeroSource</span><span class="op" id="8135785">)</span>&nbsp;<span class="ident" id="8135787">Read</span><span class="op" id="8135791">(</span><span class="ident" id="8135792">b</span>&nbsp;<span class="op" id="8135794">[</span><span class="op" id="8135795">]</span><span class="builtintype" id="8135796">byte</span><span class="op" id="8135800">)</span>&nbsp;<span class="op" id="8135802">(</span><span class="ident" id="8135803">n</span>&nbsp;<span class="builtintype" id="8135805">int</span><span class="op" id="8135808">,</span>&nbsp;<span class="ident" id="8135810">err</span>&nbsp;<span class="builtintype" id="8135814">error</span><span class="op" id="8135819">)</span>&nbsp;<span class="op" id="8135821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135824">for</span>&nbsp;<span class="ident" id="8135828">i</span>&nbsp;<span class="op" id="8135830">:=</span>&nbsp;<span class="keyword" id="8135833">range</span>&nbsp;<span class="ident" id="8135839">b</span>&nbsp;<span class="op" id="8135841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135845">b</span><span class="op" id="8135846">[</span><span class="ident" id="8135847">i</span><span class="op" id="8135848">]</span>&nbsp;<span class="op" id="8135850">=</span>&nbsp;<span class="num" id="8135852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135859">return</span>&nbsp;<span class="builtinfunc" id="8135866">len</span><span class="op" id="8135869">(</span><span class="ident" id="8135870">b</span><span class="op" id="8135871">)</span><span class="op" id="8135872">,</span>&nbsp;<span class="ident" id="8135874">nil</span><br>
<span class="lineno"></span><span class="op" id="8135878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8135881">var</span>&nbsp;<span class="ident" id="8135885">testConfig</span>&nbsp;<span class="op" id="8135896">*</span><span class="ident" id="8135897">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8135905">func</span>&nbsp;<span class="ident" id="8135910">init</span><span class="op" id="8135914">(</span><span class="op" id="8135915">)</span>&nbsp;<span class="op" id="8135917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135920">testConfig</span>&nbsp;<span class="op" id="8135931">=</span>&nbsp;<span class="op" id="8135933">&amp;</span><span class="ident" id="8135934">Config</span><span class="op" id="8135940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135944">Time</span><span class="op" id="8135948">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135964">func</span><span class="op" id="8135968">(</span><span class="op" id="8135969">)</span>&nbsp;<span class="ident" id="8135971">time</span><span class="op" id="8135975">.</span><span class="ident" id="8135976">Time</span>&nbsp;<span class="op" id="8135981">{</span>&nbsp;<span class="keyword" id="8135983">return</span>&nbsp;<span class="ident" id="8135990">time</span><span class="op" id="8135994">.</span><span class="ident" id="8135995">Unix</span><span class="op" id="8135999">(</span><span class="num" id="8136000">0</span><span class="op" id="8136001">,</span>&nbsp;<span class="num" id="8136003">0</span><span class="op" id="8136004">)</span>&nbsp;<span class="op" id="8136006">}</span><span class="op" id="8136007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136011">Rand</span><span class="op" id="8136015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136031">zeroSource</span><span class="op" id="8136041">{</span><span class="op" id="8136042">}</span><span class="op" id="8136043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136047">Certificates</span><span class="op" id="8136059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8136067">make</span><span class="op" id="8136071">(</span><span class="op" id="8136072">[</span><span class="op" id="8136073">]</span><span class="ident" id="8136074">Certificate</span><span class="op" id="8136085">,</span>&nbsp;<span class="num" id="8136087">2</span><span class="op" id="8136088">)</span><span class="op" id="8136089">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136093">InsecureSkipVerify</span><span class="op" id="8136111">:</span>&nbsp;<span class="builtintype" id="8136113">true</span><span class="op" id="8136117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136121">MinVersion</span><span class="op" id="8136131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136141">VersionSSL30</span><span class="op" id="8136153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136157">MaxVersion</span><span class="op" id="8136167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136177">VersionTLS12</span><span class="op" id="8136189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136195">testConfig</span><span class="op" id="8136205">.</span><span class="ident" id="8136206">Certificates</span><span class="op" id="8136218">[</span><span class="num" id="8136219">0</span><span class="op" id="8136220">]</span><span class="op" id="8136221">.</span><span class="ident" id="8136222">Certificate</span>&nbsp;<span class="op" id="8136234">=</span>&nbsp;<span class="op" id="8136236">[</span><span class="op" id="8136237">]</span><span class="op" id="8136238">[</span><span class="op" id="8136239">]</span><span class="builtintype" id="8136240">byte</span><span class="op" id="8136244">{</span><span class="ident" id="8136245">testRSACertificate</span><span class="op" id="8136263">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136266">testConfig</span><span class="op" id="8136276">.</span><span class="ident" id="8136277">Certificates</span><span class="op" id="8136289">[</span><span class="num" id="8136290">0</span><span class="op" id="8136291">]</span><span class="op" id="8136292">.</span><span class="ident" id="8136293">PrivateKey</span>&nbsp;<span class="op" id="8136304">=</span>&nbsp;<span class="ident" id="8136306">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136325">testConfig</span><span class="op" id="8136335">.</span><span class="ident" id="8136336">Certificates</span><span class="op" id="8136348">[</span><span class="num" id="8136349">1</span><span class="op" id="8136350">]</span><span class="op" id="8136351">.</span><span class="ident" id="8136352">Certificate</span>&nbsp;<span class="op" id="8136364">=</span>&nbsp;<span class="op" id="8136366">[</span><span class="op" id="8136367">]</span><span class="op" id="8136368">[</span><span class="op" id="8136369">]</span><span class="builtintype" id="8136370">byte</span><span class="op" id="8136374">{</span><span class="ident" id="8136375">testSNICertificate</span><span class="op" id="8136393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136396">testConfig</span><span class="op" id="8136406">.</span><span class="ident" id="8136407">Certificates</span><span class="op" id="8136419">[</span><span class="num" id="8136420">1</span><span class="op" id="8136421">]</span><span class="op" id="8136422">.</span><span class="ident" id="8136423">PrivateKey</span>&nbsp;<span class="op" id="8136434">=</span>&nbsp;<span class="ident" id="8136436">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136455">testConfig</span><span class="op" id="8136465">.</span><span class="ident" id="8136466">BuildNameToCertificate</span><span class="op" id="8136488">(</span><span class="op" id="8136489">)</span><br>
<span class="lineno"></span><span class="op" id="8136491">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8136494">func</span>&nbsp;<span class="ident" id="8136499">testClientHelloFailure</span><span class="op" id="8136521">(</span><span class="ident" id="8136522">t</span>&nbsp;<span class="op" id="8136524">*</span><span class="ident" id="8136525">testing</span><span class="op" id="8136532">.</span><span class="ident" id="8136533">T</span><span class="op" id="8136534">,</span>&nbsp;<span class="ident" id="8136536">m</span>&nbsp;<span class="ident" id="8136538">handshakeMessage</span><span class="op" id="8136554">,</span>&nbsp;<span class="ident" id="8136556">expectedSubStr</span>&nbsp;<span class="builtintype" id="8136571">string</span><span class="op" id="8136577">)</span>&nbsp;<span class="op" id="8136579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8136582">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8136623">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8136666">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136686">c</span><span class="op" id="8136687">,</span>&nbsp;<span class="ident" id="8136689">s</span>&nbsp;<span class="op" id="8136691">:=</span>&nbsp;<span class="ident" id="8136694">net</span><span class="op" id="8136697">.</span><span class="ident" id="8136698">Pipe</span><span class="op" id="8136702">(</span><span class="op" id="8136703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136706">go</span>&nbsp;<span class="keyword" id="8136709">func</span><span class="op" id="8136713">(</span><span class="op" id="8136714">)</span>&nbsp;<span class="op" id="8136716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136720">cli</span>&nbsp;<span class="op" id="8136724">:=</span>&nbsp;<span class="ident" id="8136727">Client</span><span class="op" id="8136733">(</span><span class="ident" id="8136734">c</span><span class="op" id="8136735">,</span>&nbsp;<span class="ident" id="8136737">testConfig</span><span class="op" id="8136747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136751">if</span>&nbsp;<span class="ident" id="8136754">ch</span><span class="op" id="8136756">,</span>&nbsp;<span class="ident" id="8136758">ok</span>&nbsp;<span class="op" id="8136761">:=</span>&nbsp;<span class="ident" id="8136764">m</span><span class="op" id="8136765">.</span><span class="op" id="8136766">(</span><span class="op" id="8136767">*</span><span class="ident" id="8136768">clientHelloMsg</span><span class="op" id="8136782">)</span><span class="op" id="8136783">;</span>&nbsp;<span class="ident" id="8136785">ok</span>&nbsp;<span class="op" id="8136788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136793">cli</span><span class="op" id="8136796">.</span><span class="ident" id="8136797">vers</span>&nbsp;<span class="op" id="8136802">=</span>&nbsp;<span class="ident" id="8136804">ch</span><span class="op" id="8136806">.</span><span class="ident" id="8136807">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136818">cli</span><span class="op" id="8136821">.</span><span class="ident" id="8136822">writeRecord</span><span class="op" id="8136833">(</span><span class="ident" id="8136834">recordTypeHandshake</span><span class="op" id="8136853">,</span>&nbsp;<span class="ident" id="8136855">m</span><span class="op" id="8136856">.</span><span class="ident" id="8136857">marshal</span><span class="op" id="8136864">(</span><span class="op" id="8136865">)</span><span class="op" id="8136866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136870">c</span><span class="op" id="8136871">.</span><span class="ident" id="8136872">Close</span><span class="op" id="8136877">(</span><span class="op" id="8136878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136881">}</span><span class="op" id="8136882">(</span><span class="op" id="8136883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136886">err</span>&nbsp;<span class="op" id="8136890">:=</span>&nbsp;<span class="ident" id="8136893">Server</span><span class="op" id="8136899">(</span><span class="ident" id="8136900">s</span><span class="op" id="8136901">,</span>&nbsp;<span class="ident" id="8136903">testConfig</span><span class="op" id="8136913">)</span><span class="op" id="8136914">.</span><span class="ident" id="8136915">Handshake</span><span class="op" id="8136924">(</span><span class="op" id="8136925">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136928">s</span><span class="op" id="8136929">.</span><span class="ident" id="8136930">Close</span><span class="op" id="8136935">(</span><span class="op" id="8136936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136939">if</span>&nbsp;<span class="ident" id="8136942">err</span>&nbsp;<span class="op" id="8136946">==</span>&nbsp;<span class="ident" id="8136949">nil</span>&nbsp;<span class="op" id="8136953">||</span>&nbsp;<span class="op" id="8136956">!</span><span class="ident" id="8136957">strings</span><span class="op" id="8136964">.</span><span class="ident" id="8136965">Contains</span><span class="op" id="8136973">(</span><span class="ident" id="8136974">err</span><span class="op" id="8136977">.</span><span class="ident" id="8136978">Error</span><span class="op" id="8136983">(</span><span class="op" id="8136984">)</span><span class="op" id="8136985">,</span>&nbsp;<span class="ident" id="8136987">expectedSubStr</span><span class="op" id="8137001">)</span>&nbsp;<span class="op" id="8137003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137007">t</span><span class="op" id="8137008">.</span><span class="ident" id="8137009">Errorf</span><span class="op" id="8137015">(</span><span class="string" id="8137016">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8137065">,</span>&nbsp;<span class="ident" id="8137067">err</span><span class="op" id="8137070">,</span>&nbsp;<span class="ident" id="8137072">expectedSubStr</span><span class="op" id="8137086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137089">}</span><br>
<span class="lineno"></span><span class="op" id="8137091">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8137094">func</span>&nbsp;<span class="ident" id="8137099">TestSimpleError</span><span class="op" id="8137114">(</span><span class="ident" id="8137115">t</span>&nbsp;<span class="op" id="8137117">*</span><span class="ident" id="8137118">testing</span><span class="op" id="8137125">.</span><span class="ident" id="8137126">T</span><span class="op" id="8137127">)</span>&nbsp;<span class="op" id="8137129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137132">testClientHelloFailure</span><span class="op" id="8137154">(</span><span class="ident" id="8137155">t</span><span class="op" id="8137156">,</span>&nbsp;<span class="op" id="8137158">&amp;</span><span class="ident" id="8137159">serverHelloDoneMsg</span><span class="op" id="8137177">{</span><span class="op" id="8137178">}</span><span class="op" id="8137179">,</span>&nbsp;<span class="string" id="8137181">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="8137211">)</span><br>
<span class="lineno"></span><span class="op" id="8137213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8137216">var</span>&nbsp;<span class="ident" id="8137220">badProtocolVersions</span>&nbsp;<span class="op" id="8137240">=</span>&nbsp;<span class="op" id="8137242">[</span><span class="op" id="8137243">]</span><span class="builtintype" id="8137244">uint16</span><span class="op" id="8137250">{</span><span class="num" id="8137251">0x0000</span><span class="op" id="8137257">,</span>&nbsp;<span class="num" id="8137259">0x0005</span><span class="op" id="8137265">,</span>&nbsp;<span class="num" id="8137267">0x0100</span><span class="op" id="8137273">,</span>&nbsp;<span class="num" id="8137275">0x0105</span><span class="op" id="8137281">,</span>&nbsp;<span class="num" id="8137283">0x0200</span><span class="op" id="8137289">,</span>&nbsp;<span class="num" id="8137291">0x0205</span><span class="op" id="8137297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137300">func</span>&nbsp;<span class="ident" id="8137305">TestRejectBadProtocolVersion</span><span class="op" id="8137333">(</span><span class="ident" id="8137334">t</span>&nbsp;<span class="op" id="8137336">*</span><span class="ident" id="8137337">testing</span><span class="op" id="8137344">.</span><span class="ident" id="8137345">T</span><span class="op" id="8137346">)</span>&nbsp;<span class="op" id="8137348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137351">for</span>&nbsp;<span class="ident" id="8137355">_</span><span class="op" id="8137356">,</span>&nbsp;<span class="ident" id="8137358">v</span>&nbsp;<span class="op" id="8137360">:=</span>&nbsp;<span class="keyword" id="8137363">range</span>&nbsp;<span class="ident" id="8137369">badProtocolVersions</span>&nbsp;<span class="op" id="8137389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137393">testClientHelloFailure</span><span class="op" id="8137415">(</span><span class="ident" id="8137416">t</span><span class="op" id="8137417">,</span>&nbsp;<span class="op" id="8137419">&amp;</span><span class="ident" id="8137420">clientHelloMsg</span><span class="op" id="8137434">{</span><span class="ident" id="8137435">vers</span><span class="op" id="8137439">:</span>&nbsp;<span class="ident" id="8137441">v</span><span class="op" id="8137442">}</span><span class="op" id="8137443">,</span>&nbsp;<span class="string" id="8137445">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="8137484">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137487">}</span><br>
<span class="lineno"></span><span class="op" id="8137489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137492">func</span>&nbsp;<span class="ident" id="8137497">TestNoSuiteOverlap</span><span class="op" id="8137515">(</span><span class="ident" id="8137516">t</span>&nbsp;<span class="op" id="8137518">*</span><span class="ident" id="8137519">testing</span><span class="op" id="8137526">.</span><span class="ident" id="8137527">T</span><span class="op" id="8137528">)</span>&nbsp;<span class="op" id="8137530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137533">clientHello</span>&nbsp;<span class="op" id="8137545">:=</span>&nbsp;<span class="op" id="8137548">&amp;</span><span class="ident" id="8137549">clientHelloMsg</span><span class="op" id="8137563">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137567">vers</span><span class="op" id="8137571">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8137587">0x0301</span><span class="op" id="8137593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137597">cipherSuites</span><span class="op" id="8137609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137617">[</span><span class="op" id="8137618">]</span><span class="builtintype" id="8137619">uint16</span><span class="op" id="8137625">{</span><span class="num" id="8137626">0xff00</span><span class="op" id="8137632">}</span><span class="op" id="8137633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137637">compressionMethods</span><span class="op" id="8137655">:</span>&nbsp;<span class="op" id="8137657">[</span><span class="op" id="8137658">]</span><span class="builtintype" id="8137659">uint8</span><span class="op" id="8137664">{</span><span class="num" id="8137665">0</span><span class="op" id="8137666">}</span><span class="op" id="8137667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137673">testClientHelloFailure</span><span class="op" id="8137695">(</span><span class="ident" id="8137696">t</span><span class="op" id="8137697">,</span>&nbsp;<span class="ident" id="8137699">clientHello</span><span class="op" id="8137710">,</span>&nbsp;<span class="string" id="8137712">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="8137765">)</span><br>
<span class="lineno">95</span><span class="op" id="8137767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137770">func</span>&nbsp;<span class="ident" id="8137775">TestNoCompressionOverlap</span><span class="op" id="8137799">(</span><span class="ident" id="8137800">t</span>&nbsp;<span class="op" id="8137802">*</span><span class="ident" id="8137803">testing</span><span class="op" id="8137810">.</span><span class="ident" id="8137811">T</span><span class="op" id="8137812">)</span>&nbsp;<span class="op" id="8137814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137817">clientHello</span>&nbsp;<span class="op" id="8137829">:=</span>&nbsp;<span class="op" id="8137832">&amp;</span><span class="ident" id="8137833">clientHelloMsg</span><span class="op" id="8137847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137851">vers</span><span class="op" id="8137855">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8137871">0x0301</span><span class="op" id="8137877">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137881">cipherSuites</span><span class="op" id="8137893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137901">[</span><span class="op" id="8137902">]</span><span class="builtintype" id="8137903">uint16</span><span class="op" id="8137909">{</span><span class="ident" id="8137910">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8137934">}</span><span class="op" id="8137935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137939">compressionMethods</span><span class="op" id="8137957">:</span>&nbsp;<span class="op" id="8137959">[</span><span class="op" id="8137960">]</span><span class="builtintype" id="8137961">uint8</span><span class="op" id="8137966">{</span><span class="num" id="8137967">0xff</span><span class="op" id="8137971">}</span><span class="op" id="8137972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137978">testClientHelloFailure</span><span class="op" id="8138000">(</span><span class="ident" id="8138001">t</span><span class="op" id="8138002">,</span>&nbsp;<span class="ident" id="8138004">clientHello</span><span class="op" id="8138015">,</span>&nbsp;<span class="string" id="8138017">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="8138067">)</span><br>
<span class="lineno"></span><span class="op" id="8138069">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8138072">func</span>&nbsp;<span class="ident" id="8138077">TestTLS12OnlyCipherSuites</span><span class="op" id="8138102">(</span><span class="ident" id="8138103">t</span>&nbsp;<span class="op" id="8138105">*</span><span class="ident" id="8138106">testing</span><span class="op" id="8138113">.</span><span class="ident" id="8138114">T</span><span class="op" id="8138115">)</span>&nbsp;<span class="op" id="8138117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138120">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138191">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138226">var</span>&nbsp;<span class="ident" id="8138230">zeros</span>&nbsp;<span class="op" id="8138236">[</span><span class="num" id="8138237">32</span><span class="op" id="8138239">]</span><span class="builtintype" id="8138240">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138247">clientHello</span>&nbsp;<span class="op" id="8138259">:=</span>&nbsp;<span class="op" id="8138262">&amp;</span><span class="ident" id="8138263">clientHelloMsg</span><span class="op" id="8138277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138281">vers</span><span class="op" id="8138285">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8138289">VersionTLS11</span><span class="op" id="8138301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138305">random</span><span class="op" id="8138311">:</span>&nbsp;<span class="ident" id="8138313">zeros</span><span class="op" id="8138318">[</span><span class="op" id="8138319">:</span><span class="op" id="8138320">]</span><span class="op" id="8138321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138325">cipherSuites</span><span class="op" id="8138337">:</span>&nbsp;<span class="op" id="8138339">[</span><span class="op" id="8138340">]</span><span class="builtintype" id="8138341">uint16</span><span class="op" id="8138347">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138352">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138404">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138452">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138504">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138546">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="8138583">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138588">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8138612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138616">}</span><span class="op" id="8138617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138621">compressionMethods</span><span class="op" id="8138639">:</span>&nbsp;<span class="op" id="8138641">[</span><span class="op" id="8138642">]</span><span class="builtintype" id="8138643">uint8</span><span class="op" id="8138648">{</span><span class="ident" id="8138649">compressionNone</span><span class="op" id="8138664">}</span><span class="op" id="8138665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138669">supportedCurves</span><span class="op" id="8138684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138689">[</span><span class="op" id="8138690">]</span><span class="ident" id="8138691">CurveID</span><span class="op" id="8138698">{</span><span class="ident" id="8138699">CurveP256</span><span class="op" id="8138708">,</span>&nbsp;<span class="ident" id="8138710">CurveP384</span><span class="op" id="8138719">,</span>&nbsp;<span class="ident" id="8138721">CurveP521</span><span class="op" id="8138730">}</span><span class="op" id="8138731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138735">supportedPoints</span><span class="op" id="8138750">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138755">[</span><span class="op" id="8138756">]</span><span class="builtintype" id="8138757">uint8</span><span class="op" id="8138762">{</span><span class="ident" id="8138763">pointFormatUncompressed</span><span class="op" id="8138786">}</span><span class="op" id="8138787">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138794">c</span><span class="op" id="8138795">,</span>&nbsp;<span class="ident" id="8138797">s</span>&nbsp;<span class="op" id="8138799">:=</span>&nbsp;<span class="ident" id="8138802">net</span><span class="op" id="8138805">.</span><span class="ident" id="8138806">Pipe</span><span class="op" id="8138810">(</span><span class="op" id="8138811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138814">var</span>&nbsp;<span class="ident" id="8138818">reply</span>&nbsp;<span class="keyword" id="8138824">interface</span><span class="op" id="8138833">{</span><span class="op" id="8138834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138837">var</span>&nbsp;<span class="ident" id="8138841">clientErr</span>&nbsp;<span class="builtintype" id="8138851">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138858">go</span>&nbsp;<span class="keyword" id="8138861">func</span><span class="op" id="8138865">(</span><span class="op" id="8138866">)</span>&nbsp;<span class="op" id="8138868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138872">cli</span>&nbsp;<span class="op" id="8138876">:=</span>&nbsp;<span class="ident" id="8138879">Client</span><span class="op" id="8138885">(</span><span class="ident" id="8138886">c</span><span class="op" id="8138887">,</span>&nbsp;<span class="ident" id="8138889">testConfig</span><span class="op" id="8138899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138903">cli</span><span class="op" id="8138906">.</span><span class="ident" id="8138907">vers</span>&nbsp;<span class="op" id="8138912">=</span>&nbsp;<span class="ident" id="8138914">clientHello</span><span class="op" id="8138925">.</span><span class="ident" id="8138926">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138933">cli</span><span class="op" id="8138936">.</span><span class="ident" id="8138937">writeRecord</span><span class="op" id="8138948">(</span><span class="ident" id="8138949">recordTypeHandshake</span><span class="op" id="8138968">,</span>&nbsp;<span class="ident" id="8138970">clientHello</span><span class="op" id="8138981">.</span><span class="ident" id="8138982">marshal</span><span class="op" id="8138989">(</span><span class="op" id="8138990">)</span><span class="op" id="8138991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138995">reply</span><span class="op" id="8139000">,</span>&nbsp;<span class="ident" id="8139002">clientErr</span>&nbsp;<span class="op" id="8139012">=</span>&nbsp;<span class="ident" id="8139014">cli</span><span class="op" id="8139017">.</span><span class="ident" id="8139018">readHandshake</span><span class="op" id="8139031">(</span><span class="op" id="8139032">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139036">c</span><span class="op" id="8139037">.</span><span class="ident" id="8139038">Close</span><span class="op" id="8139043">(</span><span class="op" id="8139044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139047">}</span><span class="op" id="8139048">(</span><span class="op" id="8139049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139052">config</span>&nbsp;<span class="op" id="8139059">:=</span>&nbsp;<span class="op" id="8139062">*</span><span class="ident" id="8139063">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139075">config</span><span class="op" id="8139081">.</span><span class="ident" id="8139082">CipherSuites</span>&nbsp;<span class="op" id="8139095">=</span>&nbsp;<span class="ident" id="8139097">clientHello</span><span class="op" id="8139108">.</span><span class="ident" id="8139109">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139123">Server</span><span class="op" id="8139129">(</span><span class="ident" id="8139130">s</span><span class="op" id="8139131">,</span>&nbsp;<span class="op" id="8139133">&amp;</span><span class="ident" id="8139134">config</span><span class="op" id="8139140">)</span><span class="op" id="8139141">.</span><span class="ident" id="8139142">Handshake</span><span class="op" id="8139151">(</span><span class="op" id="8139152">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139155">s</span><span class="op" id="8139156">.</span><span class="ident" id="8139157">Close</span><span class="op" id="8139162">(</span><span class="op" id="8139163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139166">if</span>&nbsp;<span class="ident" id="8139169">clientErr</span>&nbsp;<span class="op" id="8139179">!=</span>&nbsp;<span class="ident" id="8139182">nil</span>&nbsp;<span class="op" id="8139186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139190">t</span><span class="op" id="8139191">.</span><span class="ident" id="8139192">Fatal</span><span class="op" id="8139197">(</span><span class="ident" id="8139198">clientErr</span><span class="op" id="8139207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139213">serverHello</span><span class="op" id="8139224">,</span>&nbsp;<span class="ident" id="8139226">ok</span>&nbsp;<span class="op" id="8139229">:=</span>&nbsp;<span class="ident" id="8139232">reply</span><span class="op" id="8139237">.</span><span class="op" id="8139238">(</span><span class="op" id="8139239">*</span><span class="ident" id="8139240">serverHelloMsg</span><span class="op" id="8139254">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139257">if</span>&nbsp;<span class="op" id="8139260">!</span><span class="ident" id="8139261">ok</span>&nbsp;<span class="op" id="8139264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139268">t</span><span class="op" id="8139269">.</span><span class="ident" id="8139270">Fatalf</span><span class="op" id="8139276">(</span><span class="string" id="8139277">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="8139328">,</span>&nbsp;<span class="ident" id="8139330">reply</span><span class="op" id="8139335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139341">if</span>&nbsp;<span class="ident" id="8139344">s</span>&nbsp;<span class="op" id="8139346">:=</span>&nbsp;<span class="ident" id="8139349">serverHello</span><span class="op" id="8139360">.</span><span class="ident" id="8139361">cipherSuite</span><span class="op" id="8139372">;</span>&nbsp;<span class="ident" id="8139374">s</span>&nbsp;<span class="op" id="8139376">!=</span>&nbsp;<span class="ident" id="8139379">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8139404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139408">t</span><span class="op" id="8139409">.</span><span class="ident" id="8139410">Fatalf</span><span class="op" id="8139416">(</span><span class="string" id="8139417">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="8139451">,</span>&nbsp;<span class="ident" id="8139453">s</span><span class="op" id="8139454">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139457">}</span><br>
<span class="lineno"></span><span class="op" id="8139459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8139462">func</span>&nbsp;<span class="ident" id="8139467">TestAlertForwarding</span><span class="op" id="8139486">(</span><span class="ident" id="8139487">t</span>&nbsp;<span class="op" id="8139489">*</span><span class="ident" id="8139490">testing</span><span class="op" id="8139497">.</span><span class="ident" id="8139498">T</span><span class="op" id="8139499">)</span>&nbsp;<span class="op" id="8139501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139504">c</span><span class="op" id="8139505">,</span>&nbsp;<span class="ident" id="8139507">s</span>&nbsp;<span class="op" id="8139509">:=</span>&nbsp;<span class="ident" id="8139512">net</span><span class="op" id="8139515">.</span><span class="ident" id="8139516">Pipe</span><span class="op" id="8139520">(</span><span class="op" id="8139521">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139524">go</span>&nbsp;<span class="keyword" id="8139527">func</span><span class="op" id="8139531">(</span><span class="op" id="8139532">)</span>&nbsp;<span class="op" id="8139534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139538">Client</span><span class="op" id="8139544">(</span><span class="ident" id="8139545">c</span><span class="op" id="8139546">,</span>&nbsp;<span class="ident" id="8139548">testConfig</span><span class="op" id="8139558">)</span><span class="op" id="8139559">.</span><span class="ident" id="8139560">sendAlert</span><span class="op" id="8139569">(</span><span class="ident" id="8139570">alertUnknownCA</span><span class="op" id="8139584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139588">c</span><span class="op" id="8139589">.</span><span class="ident" id="8139590">Close</span><span class="op" id="8139595">(</span><span class="op" id="8139596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139599">}</span><span class="op" id="8139600">(</span><span class="op" id="8139601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139605">err</span>&nbsp;<span class="op" id="8139609">:=</span>&nbsp;<span class="ident" id="8139612">Server</span><span class="op" id="8139618">(</span><span class="ident" id="8139619">s</span><span class="op" id="8139620">,</span>&nbsp;<span class="ident" id="8139622">testConfig</span><span class="op" id="8139632">)</span><span class="op" id="8139633">.</span><span class="ident" id="8139634">Handshake</span><span class="op" id="8139643">(</span><span class="op" id="8139644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139647">s</span><span class="op" id="8139648">.</span><span class="ident" id="8139649">Close</span><span class="op" id="8139654">(</span><span class="op" id="8139655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139658">if</span>&nbsp;<span class="ident" id="8139661">e</span><span class="op" id="8139662">,</span>&nbsp;<span class="ident" id="8139664">ok</span>&nbsp;<span class="op" id="8139667">:=</span>&nbsp;<span class="ident" id="8139670">err</span><span class="op" id="8139673">.</span><span class="op" id="8139674">(</span><span class="op" id="8139675">*</span><span class="ident" id="8139676">net</span><span class="op" id="8139679">.</span><span class="ident" id="8139680">OpError</span><span class="op" id="8139687">)</span><span class="op" id="8139688">;</span>&nbsp;<span class="op" id="8139690">!</span><span class="ident" id="8139691">ok</span>&nbsp;<span class="op" id="8139694">||</span>&nbsp;<span class="ident" id="8139697">e</span><span class="op" id="8139698">.</span><span class="ident" id="8139699">Err</span>&nbsp;<span class="op" id="8139703">!=</span>&nbsp;<span class="builtintype" id="8139706">error</span><span class="op" id="8139711">(</span><span class="ident" id="8139712">alertUnknownCA</span><span class="op" id="8139726">)</span>&nbsp;<span class="op" id="8139728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139732">t</span><span class="op" id="8139733">.</span><span class="ident" id="8139734">Errorf</span><span class="op" id="8139740">(</span><span class="string" id="8139741">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8139770">,</span>&nbsp;<span class="ident" id="8139772">err</span><span class="op" id="8139775">,</span>&nbsp;<span class="builtintype" id="8139777">error</span><span class="op" id="8139782">(</span><span class="ident" id="8139783">alertUnknownCA</span><span class="op" id="8139797">)</span><span class="op" id="8139798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139801">}</span><br>
<span class="lineno">165</span><span class="op" id="8139803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8139806">func</span>&nbsp;<span class="ident" id="8139811">TestClose</span><span class="op" id="8139820">(</span><span class="ident" id="8139821">t</span>&nbsp;<span class="op" id="8139823">*</span><span class="ident" id="8139824">testing</span><span class="op" id="8139831">.</span><span class="ident" id="8139832">T</span><span class="op" id="8139833">)</span>&nbsp;<span class="op" id="8139835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139838">c</span><span class="op" id="8139839">,</span>&nbsp;<span class="ident" id="8139841">s</span>&nbsp;<span class="op" id="8139843">:=</span>&nbsp;<span class="ident" id="8139846">net</span><span class="op" id="8139849">.</span><span class="ident" id="8139850">Pipe</span><span class="op" id="8139854">(</span><span class="op" id="8139855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139858">go</span>&nbsp;<span class="ident" id="8139861">c</span><span class="op" id="8139862">.</span><span class="ident" id="8139863">Close</span><span class="op" id="8139868">(</span><span class="op" id="8139869">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139873">err</span>&nbsp;<span class="op" id="8139877">:=</span>&nbsp;<span class="ident" id="8139880">Server</span><span class="op" id="8139886">(</span><span class="ident" id="8139887">s</span><span class="op" id="8139888">,</span>&nbsp;<span class="ident" id="8139890">testConfig</span><span class="op" id="8139900">)</span><span class="op" id="8139901">.</span><span class="ident" id="8139902">Handshake</span><span class="op" id="8139911">(</span><span class="op" id="8139912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139915">s</span><span class="op" id="8139916">.</span><span class="ident" id="8139917">Close</span><span class="op" id="8139922">(</span><span class="op" id="8139923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139926">if</span>&nbsp;<span class="ident" id="8139929">err</span>&nbsp;<span class="op" id="8139933">!=</span>&nbsp;<span class="ident" id="8139936">io</span><span class="op" id="8139938">.</span><span class="ident" id="8139939">EOF</span>&nbsp;<span class="op" id="8139943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139947">t</span><span class="op" id="8139948">.</span><span class="ident" id="8139949">Errorf</span><span class="op" id="8139955">(</span><span class="string" id="8139956">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8139985">,</span>&nbsp;<span class="ident" id="8139987">err</span><span class="op" id="8139990">,</span>&nbsp;<span class="ident" id="8139992">io</span><span class="op" id="8139994">.</span><span class="ident" id="8139995">EOF</span><span class="op" id="8139998">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140001">}</span><br>
<span class="lineno"></span><span class="op" id="8140003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140006">func</span>&nbsp;<span class="ident" id="8140011">testHandshake</span><span class="op" id="8140024">(</span><span class="ident" id="8140025">clientConfig</span><span class="op" id="8140037">,</span>&nbsp;<span class="ident" id="8140039">serverConfig</span>&nbsp;<span class="op" id="8140052">*</span><span class="ident" id="8140053">Config</span><span class="op" id="8140059">)</span>&nbsp;<span class="op" id="8140061">(</span><span class="ident" id="8140062">state</span>&nbsp;<span class="ident" id="8140068">ConnectionState</span><span class="op" id="8140083">,</span>&nbsp;<span class="ident" id="8140085">err</span>&nbsp;<span class="builtintype" id="8140089">error</span><span class="op" id="8140094">)</span>&nbsp;<span class="op" id="8140096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140099">c</span><span class="op" id="8140100">,</span>&nbsp;<span class="ident" id="8140102">s</span>&nbsp;<span class="op" id="8140104">:=</span>&nbsp;<span class="ident" id="8140107">net</span><span class="op" id="8140110">.</span><span class="ident" id="8140111">Pipe</span><span class="op" id="8140115">(</span><span class="op" id="8140116">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140119">done</span>&nbsp;<span class="op" id="8140124">:=</span>&nbsp;<span class="builtinfunc" id="8140127">make</span><span class="op" id="8140131">(</span><span class="keyword" id="8140132">chan</span>&nbsp;<span class="builtintype" id="8140137">bool</span><span class="op" id="8140141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140144">go</span>&nbsp;<span class="keyword" id="8140147">func</span><span class="op" id="8140151">(</span><span class="op" id="8140152">)</span>&nbsp;<span class="op" id="8140154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140158">cli</span>&nbsp;<span class="op" id="8140162">:=</span>&nbsp;<span class="ident" id="8140165">Client</span><span class="op" id="8140171">(</span><span class="ident" id="8140172">c</span><span class="op" id="8140173">,</span>&nbsp;<span class="ident" id="8140175">clientConfig</span><span class="op" id="8140187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140191">cli</span><span class="op" id="8140194">.</span><span class="ident" id="8140195">Handshake</span><span class="op" id="8140204">(</span><span class="op" id="8140205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140209">c</span><span class="op" id="8140210">.</span><span class="ident" id="8140211">Close</span><span class="op" id="8140216">(</span><span class="op" id="8140217">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140221">done</span>&nbsp;<span class="op" id="8140226">&lt;-</span>&nbsp;<span class="builtintype" id="8140229">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140235">}</span><span class="op" id="8140236">(</span><span class="op" id="8140237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140240">server</span>&nbsp;<span class="op" id="8140247">:=</span>&nbsp;<span class="ident" id="8140250">Server</span><span class="op" id="8140256">(</span><span class="ident" id="8140257">s</span><span class="op" id="8140258">,</span>&nbsp;<span class="ident" id="8140260">serverConfig</span><span class="op" id="8140272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140275">err</span>&nbsp;<span class="op" id="8140279">=</span>&nbsp;<span class="ident" id="8140281">server</span><span class="op" id="8140287">.</span><span class="ident" id="8140288">Handshake</span><span class="op" id="8140297">(</span><span class="op" id="8140298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140301">if</span>&nbsp;<span class="ident" id="8140304">err</span>&nbsp;<span class="op" id="8140308">==</span>&nbsp;<span class="ident" id="8140311">nil</span>&nbsp;<span class="op" id="8140315">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140319">state</span>&nbsp;<span class="op" id="8140325">=</span>&nbsp;<span class="ident" id="8140327">server</span><span class="op" id="8140333">.</span><span class="ident" id="8140334">ConnectionState</span><span class="op" id="8140349">(</span><span class="op" id="8140350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140356">s</span><span class="op" id="8140357">.</span><span class="ident" id="8140358">Close</span><span class="op" id="8140363">(</span><span class="op" id="8140364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140367">&lt;-</span><span class="ident" id="8140369">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140375">return</span><br>
<span class="lineno">195</span><span class="op" id="8140382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140385">func</span>&nbsp;<span class="ident" id="8140390">TestVersion</span><span class="op" id="8140401">(</span><span class="ident" id="8140402">t</span>&nbsp;<span class="op" id="8140404">*</span><span class="ident" id="8140405">testing</span><span class="op" id="8140412">.</span><span class="ident" id="8140413">T</span><span class="op" id="8140414">)</span>&nbsp;<span class="op" id="8140416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140419">serverConfig</span>&nbsp;<span class="op" id="8140432">:=</span>&nbsp;<span class="op" id="8140435">&amp;</span><span class="ident" id="8140436">Config</span><span class="op" id="8140442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140446">Certificates</span><span class="op" id="8140458">:</span>&nbsp;<span class="ident" id="8140460">testConfig</span><span class="op" id="8140470">.</span><span class="ident" id="8140471">Certificates</span><span class="op" id="8140483">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140487">MaxVersion</span><span class="op" id="8140497">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8140501">VersionTLS11</span><span class="op" id="8140513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140519">clientConfig</span>&nbsp;<span class="op" id="8140532">:=</span>&nbsp;<span class="op" id="8140535">&amp;</span><span class="ident" id="8140536">Config</span><span class="op" id="8140542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140546">InsecureSkipVerify</span><span class="op" id="8140564">:</span>&nbsp;<span class="builtintype" id="8140566">true</span><span class="op" id="8140570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140573">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140576">state</span><span class="op" id="8140581">,</span>&nbsp;<span class="ident" id="8140583">err</span>&nbsp;<span class="op" id="8140587">:=</span>&nbsp;<span class="ident" id="8140590">testHandshake</span><span class="op" id="8140603">(</span><span class="ident" id="8140604">clientConfig</span><span class="op" id="8140616">,</span>&nbsp;<span class="ident" id="8140618">serverConfig</span><span class="op" id="8140630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140633">if</span>&nbsp;<span class="ident" id="8140636">err</span>&nbsp;<span class="op" id="8140640">!=</span>&nbsp;<span class="ident" id="8140643">nil</span>&nbsp;<span class="op" id="8140647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140651">t</span><span class="op" id="8140652">.</span><span class="ident" id="8140653">Fatalf</span><span class="op" id="8140659">(</span><span class="string" id="8140660">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8140682">,</span>&nbsp;<span class="ident" id="8140684">err</span><span class="op" id="8140687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140693">if</span>&nbsp;<span class="ident" id="8140696">state</span><span class="op" id="8140701">.</span><span class="ident" id="8140702">Version</span>&nbsp;<span class="op" id="8140710">!=</span>&nbsp;<span class="ident" id="8140713">VersionTLS11</span>&nbsp;<span class="op" id="8140726">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140730">t</span><span class="op" id="8140731">.</span><span class="ident" id="8140732">Fatalf</span><span class="op" id="8140738">(</span><span class="string" id="8140739">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="8140775">,</span>&nbsp;<span class="ident" id="8140777">state</span><span class="op" id="8140782">.</span><span class="ident" id="8140783">Version</span><span class="op" id="8140790">,</span>&nbsp;<span class="ident" id="8140792">VersionTLS11</span><span class="op" id="8140804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140807">}</span><br>
<span class="lineno"></span><span class="op" id="8140809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140812">func</span>&nbsp;<span class="ident" id="8140817">TestCipherSuitePreference</span><span class="op" id="8140842">(</span><span class="ident" id="8140843">t</span>&nbsp;<span class="op" id="8140845">*</span><span class="ident" id="8140846">testing</span><span class="op" id="8140853">.</span><span class="ident" id="8140854">T</span><span class="op" id="8140855">)</span>&nbsp;<span class="op" id="8140857">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140860">serverConfig</span>&nbsp;<span class="op" id="8140873">:=</span>&nbsp;<span class="op" id="8140876">&amp;</span><span class="ident" id="8140877">Config</span><span class="op" id="8140883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140887">CipherSuites</span><span class="op" id="8140899">:</span>&nbsp;<span class="op" id="8140901">[</span><span class="op" id="8140902">]</span><span class="builtintype" id="8140903">uint16</span><span class="op" id="8140909">{</span><span class="ident" id="8140910">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8140934">,</span>&nbsp;<span class="ident" id="8140936">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8140964">,</span>&nbsp;<span class="ident" id="8140966">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8140996">}</span><span class="op" id="8140997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141001">Certificates</span><span class="op" id="8141013">:</span>&nbsp;<span class="ident" id="8141015">testConfig</span><span class="op" id="8141025">.</span><span class="ident" id="8141026">Certificates</span><span class="op" id="8141038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141042">MaxVersion</span><span class="op" id="8141052">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8141056">VersionTLS11</span><span class="op" id="8141068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141071">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141074">clientConfig</span>&nbsp;<span class="op" id="8141087">:=</span>&nbsp;<span class="op" id="8141090">&amp;</span><span class="ident" id="8141091">Config</span><span class="op" id="8141097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141101">CipherSuites</span><span class="op" id="8141113">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141121">[</span><span class="op" id="8141122">]</span><span class="builtintype" id="8141123">uint16</span><span class="op" id="8141129">{</span><span class="ident" id="8141130">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8141158">,</span>&nbsp;<span class="ident" id="8141160">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8141184">}</span><span class="op" id="8141185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141189">InsecureSkipVerify</span><span class="op" id="8141207">:</span>&nbsp;<span class="builtintype" id="8141209">true</span><span class="op" id="8141213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141219">state</span><span class="op" id="8141224">,</span>&nbsp;<span class="ident" id="8141226">err</span>&nbsp;<span class="op" id="8141230">:=</span>&nbsp;<span class="ident" id="8141233">testHandshake</span><span class="op" id="8141246">(</span><span class="ident" id="8141247">clientConfig</span><span class="op" id="8141259">,</span>&nbsp;<span class="ident" id="8141261">serverConfig</span><span class="op" id="8141273">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141276">if</span>&nbsp;<span class="ident" id="8141279">err</span>&nbsp;<span class="op" id="8141283">!=</span>&nbsp;<span class="ident" id="8141286">nil</span>&nbsp;<span class="op" id="8141290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141294">t</span><span class="op" id="8141295">.</span><span class="ident" id="8141296">Fatalf</span><span class="op" id="8141302">(</span><span class="string" id="8141303">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8141325">,</span>&nbsp;<span class="ident" id="8141327">err</span><span class="op" id="8141330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141336">if</span>&nbsp;<span class="ident" id="8141339">state</span><span class="op" id="8141344">.</span><span class="ident" id="8141345">CipherSuite</span>&nbsp;<span class="op" id="8141357">!=</span>&nbsp;<span class="ident" id="8141360">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="8141389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8141393">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141456">t</span><span class="op" id="8141457">.</span><span class="ident" id="8141458">Fatalf</span><span class="op" id="8141464">(</span><span class="string" id="8141465">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8141507">,</span>&nbsp;<span class="ident" id="8141509">state</span><span class="op" id="8141514">.</span><span class="ident" id="8141515">CipherSuite</span><span class="op" id="8141526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141533">serverConfig</span><span class="op" id="8141545">.</span><span class="ident" id="8141546">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8141571">=</span>&nbsp;<span class="builtintype" id="8141573">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141579">state</span><span class="op" id="8141584">,</span>&nbsp;<span class="ident" id="8141586">err</span>&nbsp;<span class="op" id="8141590">=</span>&nbsp;<span class="ident" id="8141592">testHandshake</span><span class="op" id="8141605">(</span><span class="ident" id="8141606">clientConfig</span><span class="op" id="8141618">,</span>&nbsp;<span class="ident" id="8141620">serverConfig</span><span class="op" id="8141632">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141635">if</span>&nbsp;<span class="ident" id="8141638">err</span>&nbsp;<span class="op" id="8141642">!=</span>&nbsp;<span class="ident" id="8141645">nil</span>&nbsp;<span class="op" id="8141649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141653">t</span><span class="op" id="8141654">.</span><span class="ident" id="8141655">Fatalf</span><span class="op" id="8141661">(</span><span class="string" id="8141662">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8141684">,</span>&nbsp;<span class="ident" id="8141686">err</span><span class="op" id="8141689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141695">if</span>&nbsp;<span class="ident" id="8141698">state</span><span class="op" id="8141703">.</span><span class="ident" id="8141704">CipherSuite</span>&nbsp;<span class="op" id="8141716">!=</span>&nbsp;<span class="ident" id="8141719">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8141744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141748">t</span><span class="op" id="8141749">.</span><span class="ident" id="8141750">Fatalf</span><span class="op" id="8141756">(</span><span class="string" id="8141757">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8141799">,</span>&nbsp;<span class="ident" id="8141801">state</span><span class="op" id="8141806">.</span><span class="ident" id="8141807">CipherSuite</span><span class="op" id="8141818">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141821">}</span><br>
<span class="lineno"></span><span class="op" id="8141823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8141826">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8141901">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8141917">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8141997">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8142016">type</span>&nbsp;<span class="ident" id="8142021">serverTest</span>&nbsp;<span class="keyword" id="8142032">struct</span>&nbsp;<span class="op" id="8142039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142042">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142115">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142156">name</span>&nbsp;<span class="builtintype" id="8142161">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142169">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142235">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142280">command</span>&nbsp;<span class="op" id="8142288">[</span><span class="op" id="8142289">]</span><span class="builtintype" id="8142290">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142298">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142362">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142396">expectedPeerCerts</span>&nbsp;<span class="op" id="8142414">[</span><span class="op" id="8142415">]</span><span class="builtintype" id="8142416">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142424">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142495">config</span>&nbsp;<span class="op" id="8142502">*</span><span class="ident" id="8142503">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142511">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142585">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142623">expectAlert</span>&nbsp;<span class="builtintype" id="8142635">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142641">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142710">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142782">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="8142812">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142820">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142889">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8142962">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142999">validate</span>&nbsp;<span class="keyword" id="8143008">func</span><span class="op" id="8143012">(</span><span class="ident" id="8143013">ConnectionState</span><span class="op" id="8143028">)</span>&nbsp;<span class="builtintype" id="8143030">error</span><br>
<span class="lineno">270</span><span class="op" id="8143036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8143039">var</span>&nbsp;<span class="ident" id="8143043">defaultClientCommand</span>&nbsp;<span class="op" id="8143064">=</span>&nbsp;<span class="op" id="8143066">[</span><span class="op" id="8143067">]</span><span class="builtintype" id="8143068">string</span><span class="op" id="8143074">{</span><span class="string" id="8143075">&#34;openssl&#34;</span><span class="op" id="8143084">,</span>&nbsp;<span class="string" id="8143086">&#34;s_client&#34;</span><span class="op" id="8143096">,</span>&nbsp;<span class="string" id="8143098">&#34;-no_ticket&#34;</span><span class="op" id="8143110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8143113">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="8143189">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8143269">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="8143284">func</span>&nbsp;<span class="op" id="8143289">(</span><span class="ident" id="8143290">test</span>&nbsp;<span class="op" id="8143295">*</span><span class="ident" id="8143296">serverTest</span><span class="op" id="8143306">)</span>&nbsp;<span class="ident" id="8143308">connFromCommand</span><span class="op" id="8143323">(</span><span class="op" id="8143324">)</span>&nbsp;<span class="op" id="8143326">(</span><span class="ident" id="8143327">conn</span>&nbsp;<span class="op" id="8143332">*</span><span class="ident" id="8143333">recordingConn</span><span class="op" id="8143346">,</span>&nbsp;<span class="ident" id="8143348">child</span>&nbsp;<span class="op" id="8143354">*</span><span class="ident" id="8143355">exec</span><span class="op" id="8143359">.</span><span class="ident" id="8143360">Cmd</span><span class="op" id="8143363">,</span>&nbsp;<span class="ident" id="8143365">err</span>&nbsp;<span class="builtintype" id="8143369">error</span><span class="op" id="8143374">)</span>&nbsp;<span class="op" id="8143376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143379">l</span><span class="op" id="8143380">,</span>&nbsp;<span class="ident" id="8143382">err</span>&nbsp;<span class="op" id="8143386">:=</span>&nbsp;<span class="ident" id="8143389">net</span><span class="op" id="8143392">.</span><span class="ident" id="8143393">ListenTCP</span><span class="op" id="8143402">(</span><span class="string" id="8143403">&#34;tcp&#34;</span><span class="op" id="8143408">,</span>&nbsp;<span class="op" id="8143410">&amp;</span><span class="ident" id="8143411">net</span><span class="op" id="8143414">.</span><span class="ident" id="8143415">TCPAddr</span><span class="op" id="8143422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143426">IP</span><span class="op" id="8143428">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8143432">net</span><span class="op" id="8143435">.</span><span class="ident" id="8143436">IPv4</span><span class="op" id="8143440">(</span><span class="num" id="8143441">127</span><span class="op" id="8143444">,</span>&nbsp;<span class="num" id="8143446">0</span><span class="op" id="8143447">,</span>&nbsp;<span class="num" id="8143449">0</span><span class="op" id="8143450">,</span>&nbsp;<span class="num" id="8143452">1</span><span class="op" id="8143453">)</span><span class="op" id="8143454">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143458">Port</span><span class="op" id="8143462">:</span>&nbsp;<span class="num" id="8143464">0</span><span class="op" id="8143465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143468">}</span><span class="op" id="8143469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143472">if</span>&nbsp;<span class="ident" id="8143475">err</span>&nbsp;<span class="op" id="8143479">!=</span>&nbsp;<span class="ident" id="8143482">nil</span>&nbsp;<span class="op" id="8143486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143490">return</span>&nbsp;<span class="ident" id="8143497">nil</span><span class="op" id="8143500">,</span>&nbsp;<span class="ident" id="8143502">nil</span><span class="op" id="8143505">,</span>&nbsp;<span class="ident" id="8143507">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143512">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143515">defer</span>&nbsp;<span class="ident" id="8143521">l</span><span class="op" id="8143522">.</span><span class="ident" id="8143523">Close</span><span class="op" id="8143528">(</span><span class="op" id="8143529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143533">port</span>&nbsp;<span class="op" id="8143538">:=</span>&nbsp;<span class="ident" id="8143541">l</span><span class="op" id="8143542">.</span><span class="ident" id="8143543">Addr</span><span class="op" id="8143547">(</span><span class="op" id="8143548">)</span><span class="op" id="8143549">.</span><span class="op" id="8143550">(</span><span class="op" id="8143551">*</span><span class="ident" id="8143552">net</span><span class="op" id="8143555">.</span><span class="ident" id="8143556">TCPAddr</span><span class="op" id="8143563">)</span><span class="op" id="8143564">.</span><span class="ident" id="8143565">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143572">var</span>&nbsp;<span class="ident" id="8143576">command</span>&nbsp;<span class="op" id="8143584">[</span><span class="op" id="8143585">]</span><span class="builtintype" id="8143586">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143594">command</span>&nbsp;<span class="op" id="8143602">=</span>&nbsp;<span class="builtinfunc" id="8143604">append</span><span class="op" id="8143610">(</span><span class="ident" id="8143611">command</span><span class="op" id="8143618">,</span>&nbsp;<span class="ident" id="8143620">test</span><span class="op" id="8143624">.</span><span class="ident" id="8143625">command</span><span class="op" id="8143632">...</span><span class="op" id="8143635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143638">if</span>&nbsp;<span class="builtinfunc" id="8143641">len</span><span class="op" id="8143644">(</span><span class="ident" id="8143645">command</span><span class="op" id="8143652">)</span>&nbsp;<span class="op" id="8143654">==</span>&nbsp;<span class="num" id="8143657">0</span>&nbsp;<span class="op" id="8143659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143663">command</span>&nbsp;<span class="op" id="8143671">=</span>&nbsp;<span class="ident" id="8143673">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143698">command</span>&nbsp;<span class="op" id="8143706">=</span>&nbsp;<span class="builtinfunc" id="8143708">append</span><span class="op" id="8143714">(</span><span class="ident" id="8143715">command</span><span class="op" id="8143722">,</span>&nbsp;<span class="string" id="8143724">&#34;-connect&#34;</span><span class="op" id="8143734">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143737">command</span>&nbsp;<span class="op" id="8143745">=</span>&nbsp;<span class="builtinfunc" id="8143747">append</span><span class="op" id="8143753">(</span><span class="ident" id="8143754">command</span><span class="op" id="8143761">,</span>&nbsp;<span class="ident" id="8143763">fmt</span><span class="op" id="8143766">.</span><span class="ident" id="8143767">Sprintf</span><span class="op" id="8143774">(</span><span class="string" id="8143775">&#34;127.0.0.1:%d&#34;</span><span class="op" id="8143789">,</span>&nbsp;<span class="ident" id="8143791">port</span><span class="op" id="8143795">)</span><span class="op" id="8143796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143799">cmd</span>&nbsp;<span class="op" id="8143803">:=</span>&nbsp;<span class="ident" id="8143806">exec</span><span class="op" id="8143810">.</span><span class="ident" id="8143811">Command</span><span class="op" id="8143818">(</span><span class="ident" id="8143819">command</span><span class="op" id="8143826">[</span><span class="num" id="8143827">0</span><span class="op" id="8143828">]</span><span class="op" id="8143829">,</span>&nbsp;<span class="ident" id="8143831">command</span><span class="op" id="8143838">[</span><span class="num" id="8143839">1</span><span class="op" id="8143840">:</span><span class="op" id="8143841">]</span><span class="op" id="8143842">...</span><span class="op" id="8143845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143848">cmd</span><span class="op" id="8143851">.</span><span class="ident" id="8143852">Stdin</span>&nbsp;<span class="op" id="8143858">=</span>&nbsp;<span class="ident" id="8143860">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143865">var</span>&nbsp;<span class="ident" id="8143869">output</span>&nbsp;<span class="ident" id="8143876">bytes</span><span class="op" id="8143881">.</span><span class="ident" id="8143882">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143890">cmd</span><span class="op" id="8143893">.</span><span class="ident" id="8143894">Stdout</span>&nbsp;<span class="op" id="8143901">=</span>&nbsp;<span class="op" id="8143903">&amp;</span><span class="ident" id="8143904">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143912">cmd</span><span class="op" id="8143915">.</span><span class="ident" id="8143916">Stderr</span>&nbsp;<span class="op" id="8143923">=</span>&nbsp;<span class="op" id="8143925">&amp;</span><span class="ident" id="8143926">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143934">if</span>&nbsp;<span class="ident" id="8143937">err</span>&nbsp;<span class="op" id="8143941">:=</span>&nbsp;<span class="ident" id="8143944">cmd</span><span class="op" id="8143947">.</span><span class="ident" id="8143948">Start</span><span class="op" id="8143953">(</span><span class="op" id="8143954">)</span><span class="op" id="8143955">;</span>&nbsp;<span class="ident" id="8143957">err</span>&nbsp;<span class="op" id="8143961">!=</span>&nbsp;<span class="ident" id="8143964">nil</span>&nbsp;<span class="op" id="8143968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143972">return</span>&nbsp;<span class="ident" id="8143979">nil</span><span class="op" id="8143982">,</span>&nbsp;<span class="ident" id="8143984">nil</span><span class="op" id="8143987">,</span>&nbsp;<span class="ident" id="8143989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143998">connChan</span>&nbsp;<span class="op" id="8144007">:=</span>&nbsp;<span class="builtinfunc" id="8144010">make</span><span class="op" id="8144014">(</span><span class="keyword" id="8144015">chan</span>&nbsp;<span class="keyword" id="8144020">interface</span><span class="op" id="8144029">{</span><span class="op" id="8144030">}</span><span class="op" id="8144031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144034">go</span>&nbsp;<span class="keyword" id="8144037">func</span><span class="op" id="8144041">(</span><span class="op" id="8144042">)</span>&nbsp;<span class="op" id="8144044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144048">tcpConn</span><span class="op" id="8144055">,</span>&nbsp;<span class="ident" id="8144057">err</span>&nbsp;<span class="op" id="8144061">:=</span>&nbsp;<span class="ident" id="8144064">l</span><span class="op" id="8144065">.</span><span class="ident" id="8144066">Accept</span><span class="op" id="8144072">(</span><span class="op" id="8144073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144077">if</span>&nbsp;<span class="ident" id="8144080">err</span>&nbsp;<span class="op" id="8144084">!=</span>&nbsp;<span class="ident" id="8144087">nil</span>&nbsp;<span class="op" id="8144091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144096">connChan</span>&nbsp;<span class="op" id="8144105">&lt;-</span>&nbsp;<span class="ident" id="8144108">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144118">connChan</span>&nbsp;<span class="op" id="8144127">&lt;-</span>&nbsp;<span class="ident" id="8144130">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144139">}</span><span class="op" id="8144140">(</span><span class="op" id="8144141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144145">var</span>&nbsp;<span class="ident" id="8144149">tcpConn</span>&nbsp;<span class="ident" id="8144157">net</span><span class="op" id="8144160">.</span><span class="ident" id="8144161">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144167">select</span>&nbsp;<span class="op" id="8144174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144177">case</span>&nbsp;<span class="ident" id="8144182">connOrError</span>&nbsp;<span class="op" id="8144194">:=</span>&nbsp;<span class="op" id="8144197">&lt;-</span><span class="ident" id="8144199">connChan</span><span class="op" id="8144207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144211">if</span>&nbsp;<span class="ident" id="8144214">err</span><span class="op" id="8144217">,</span>&nbsp;<span class="ident" id="8144219">ok</span>&nbsp;<span class="op" id="8144222">:=</span>&nbsp;<span class="ident" id="8144225">connOrError</span><span class="op" id="8144236">.</span><span class="op" id="8144237">(</span><span class="builtintype" id="8144238">error</span><span class="op" id="8144243">)</span><span class="op" id="8144244">;</span>&nbsp;<span class="ident" id="8144246">ok</span>&nbsp;<span class="op" id="8144249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144254">return</span>&nbsp;<span class="ident" id="8144261">nil</span><span class="op" id="8144264">,</span>&nbsp;<span class="ident" id="8144266">nil</span><span class="op" id="8144269">,</span>&nbsp;<span class="ident" id="8144271">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144277">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144281">tcpConn</span>&nbsp;<span class="op" id="8144289">=</span>&nbsp;<span class="ident" id="8144291">connOrError</span><span class="op" id="8144302">.</span><span class="op" id="8144303">(</span><span class="ident" id="8144304">net</span><span class="op" id="8144307">.</span><span class="ident" id="8144308">Conn</span><span class="op" id="8144312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144315">case</span>&nbsp;<span class="op" id="8144320">&lt;-</span><span class="ident" id="8144322">time</span><span class="op" id="8144326">.</span><span class="ident" id="8144327">After</span><span class="op" id="8144332">(</span><span class="num" id="8144333">2</span>&nbsp;<span class="op" id="8144335">*</span>&nbsp;<span class="ident" id="8144337">time</span><span class="op" id="8144341">.</span><span class="ident" id="8144342">Second</span><span class="op" id="8144348">)</span><span class="op" id="8144349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144353">output</span><span class="op" id="8144359">.</span><span class="ident" id="8144360">WriteTo</span><span class="op" id="8144367">(</span><span class="ident" id="8144368">os</span><span class="op" id="8144370">.</span><span class="ident" id="8144371">Stdout</span><span class="op" id="8144377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144381">return</span>&nbsp;<span class="ident" id="8144388">nil</span><span class="op" id="8144391">,</span>&nbsp;<span class="ident" id="8144393">nil</span><span class="op" id="8144396">,</span>&nbsp;<span class="ident" id="8144398">errors</span><span class="op" id="8144404">.</span><span class="ident" id="8144405">New</span><span class="op" id="8144408">(</span><span class="string" id="8144409">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="8144462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144465">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144469">record</span>&nbsp;<span class="op" id="8144476">:=</span>&nbsp;<span class="op" id="8144479">&amp;</span><span class="ident" id="8144480">recordingConn</span><span class="op" id="8144493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144497">Conn</span><span class="op" id="8144501">:</span>&nbsp;<span class="ident" id="8144503">tcpConn</span><span class="op" id="8144510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144517">return</span>&nbsp;<span class="ident" id="8144524">record</span><span class="op" id="8144530">,</span>&nbsp;<span class="ident" id="8144532">cmd</span><span class="op" id="8144535">,</span>&nbsp;<span class="ident" id="8144537">nil</span><br>
<span class="lineno"></span><span class="op" id="8144541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8144544">func</span>&nbsp;<span class="op" id="8144549">(</span><span class="ident" id="8144550">test</span>&nbsp;<span class="op" id="8144555">*</span><span class="ident" id="8144556">serverTest</span><span class="op" id="8144566">)</span>&nbsp;<span class="ident" id="8144568">dataPath</span><span class="op" id="8144576">(</span><span class="op" id="8144577">)</span>&nbsp;<span class="builtintype" id="8144579">string</span>&nbsp;<span class="op" id="8144586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144589">return</span>&nbsp;<span class="ident" id="8144596">filepath</span><span class="op" id="8144604">.</span><span class="ident" id="8144605">Join</span><span class="op" id="8144609">(</span><span class="string" id="8144610">&#34;testdata&#34;</span><span class="op" id="8144620">,</span>&nbsp;<span class="string" id="8144622">&#34;Server-&#34;</span><span class="op" id="8144631">+</span><span class="ident" id="8144632">test</span><span class="op" id="8144636">.</span><span class="ident" id="8144637">name</span><span class="op" id="8144641">)</span><br>
<span class="lineno">335</span><span class="op" id="8144643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8144646">func</span>&nbsp;<span class="op" id="8144651">(</span><span class="ident" id="8144652">test</span>&nbsp;<span class="op" id="8144657">*</span><span class="ident" id="8144658">serverTest</span><span class="op" id="8144668">)</span>&nbsp;<span class="ident" id="8144670">loadData</span><span class="op" id="8144678">(</span><span class="op" id="8144679">)</span>&nbsp;<span class="op" id="8144681">(</span><span class="ident" id="8144682">flows</span>&nbsp;<span class="op" id="8144688">[</span><span class="op" id="8144689">]</span><span class="op" id="8144690">[</span><span class="op" id="8144691">]</span><span class="builtintype" id="8144692">byte</span><span class="op" id="8144696">,</span>&nbsp;<span class="ident" id="8144698">err</span>&nbsp;<span class="builtintype" id="8144702">error</span><span class="op" id="8144707">)</span>&nbsp;<span class="op" id="8144709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144712">in</span><span class="op" id="8144714">,</span>&nbsp;<span class="ident" id="8144716">err</span>&nbsp;<span class="op" id="8144720">:=</span>&nbsp;<span class="ident" id="8144723">os</span><span class="op" id="8144725">.</span><span class="ident" id="8144726">Open</span><span class="op" id="8144730">(</span><span class="ident" id="8144731">test</span><span class="op" id="8144735">.</span><span class="ident" id="8144736">dataPath</span><span class="op" id="8144744">(</span><span class="op" id="8144745">)</span><span class="op" id="8144746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144749">if</span>&nbsp;<span class="ident" id="8144752">err</span>&nbsp;<span class="op" id="8144756">!=</span>&nbsp;<span class="ident" id="8144759">nil</span>&nbsp;<span class="op" id="8144763">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144767">return</span>&nbsp;<span class="ident" id="8144774">nil</span><span class="op" id="8144777">,</span>&nbsp;<span class="ident" id="8144779">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144787">defer</span>&nbsp;<span class="ident" id="8144793">in</span><span class="op" id="8144795">.</span><span class="ident" id="8144796">Close</span><span class="op" id="8144801">(</span><span class="op" id="8144802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144805">return</span>&nbsp;<span class="ident" id="8144812">parseTestData</span><span class="op" id="8144825">(</span><span class="ident" id="8144826">in</span><span class="op" id="8144828">)</span><br>
<span class="lineno"></span><span class="op" id="8144830">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8144833">func</span>&nbsp;<span class="op" id="8144838">(</span><span class="ident" id="8144839">test</span>&nbsp;<span class="op" id="8144844">*</span><span class="ident" id="8144845">serverTest</span><span class="op" id="8144855">)</span>&nbsp;<span class="ident" id="8144857">run</span><span class="op" id="8144860">(</span><span class="ident" id="8144861">t</span>&nbsp;<span class="op" id="8144863">*</span><span class="ident" id="8144864">testing</span><span class="op" id="8144871">.</span><span class="ident" id="8144872">T</span><span class="op" id="8144873">,</span>&nbsp;<span class="ident" id="8144875">write</span>&nbsp;<span class="builtintype" id="8144881">bool</span><span class="op" id="8144885">)</span>&nbsp;<span class="op" id="8144887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144890">var</span>&nbsp;<span class="ident" id="8144894">clientConn</span><span class="op" id="8144904">,</span>&nbsp;<span class="ident" id="8144906">serverConn</span>&nbsp;<span class="ident" id="8144917">net</span><span class="op" id="8144920">.</span><span class="ident" id="8144921">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144927">var</span>&nbsp;<span class="ident" id="8144931">recordingConn</span>&nbsp;<span class="op" id="8144945">*</span><span class="ident" id="8144946">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144961">var</span>&nbsp;<span class="ident" id="8144965">childProcess</span>&nbsp;<span class="op" id="8144978">*</span><span class="ident" id="8144979">exec</span><span class="op" id="8144983">.</span><span class="ident" id="8144984">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144990">if</span>&nbsp;<span class="ident" id="8144993">write</span>&nbsp;<span class="op" id="8144999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145003">var</span>&nbsp;<span class="ident" id="8145007">err</span>&nbsp;<span class="builtintype" id="8145011">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145019">recordingConn</span><span class="op" id="8145032">,</span>&nbsp;<span class="ident" id="8145034">childProcess</span><span class="op" id="8145046">,</span>&nbsp;<span class="ident" id="8145048">err</span>&nbsp;<span class="op" id="8145052">=</span>&nbsp;<span class="ident" id="8145054">test</span><span class="op" id="8145058">.</span><span class="ident" id="8145059">connFromCommand</span><span class="op" id="8145074">(</span><span class="op" id="8145075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145079">if</span>&nbsp;<span class="ident" id="8145082">err</span>&nbsp;<span class="op" id="8145086">!=</span>&nbsp;<span class="ident" id="8145089">nil</span>&nbsp;<span class="op" id="8145093">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145098">t</span><span class="op" id="8145099">.</span><span class="ident" id="8145100">Fatalf</span><span class="op" id="8145106">(</span><span class="string" id="8145107">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8145139">,</span>&nbsp;<span class="ident" id="8145141">err</span><span class="op" id="8145144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145152">serverConn</span>&nbsp;<span class="op" id="8145163">=</span>&nbsp;<span class="ident" id="8145165">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145180">}</span>&nbsp;<span class="keyword" id="8145182">else</span>&nbsp;<span class="op" id="8145187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145191">clientConn</span><span class="op" id="8145201">,</span>&nbsp;<span class="ident" id="8145203">serverConn</span>&nbsp;<span class="op" id="8145214">=</span>&nbsp;<span class="ident" id="8145216">net</span><span class="op" id="8145219">.</span><span class="ident" id="8145220">Pipe</span><span class="op" id="8145224">(</span><span class="op" id="8145225">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145231">config</span>&nbsp;<span class="op" id="8145238">:=</span>&nbsp;<span class="ident" id="8145241">test</span><span class="op" id="8145245">.</span><span class="ident" id="8145246">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145254">if</span>&nbsp;<span class="ident" id="8145257">config</span>&nbsp;<span class="op" id="8145264">==</span>&nbsp;<span class="ident" id="8145267">nil</span>&nbsp;<span class="op" id="8145271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145275">config</span>&nbsp;<span class="op" id="8145282">=</span>&nbsp;<span class="ident" id="8145284">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145296">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145299">server</span>&nbsp;<span class="op" id="8145306">:=</span>&nbsp;<span class="ident" id="8145309">Server</span><span class="op" id="8145315">(</span><span class="ident" id="8145316">serverConn</span><span class="op" id="8145326">,</span>&nbsp;<span class="ident" id="8145328">config</span><span class="op" id="8145334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145337">connStateChan</span>&nbsp;<span class="op" id="8145351">:=</span>&nbsp;<span class="builtinfunc" id="8145354">make</span><span class="op" id="8145358">(</span><span class="keyword" id="8145359">chan</span>&nbsp;<span class="ident" id="8145364">ConnectionState</span><span class="op" id="8145379">,</span>&nbsp;<span class="num" id="8145381">1</span><span class="op" id="8145382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145385">go</span>&nbsp;<span class="keyword" id="8145388">func</span><span class="op" id="8145392">(</span><span class="op" id="8145393">)</span>&nbsp;<span class="op" id="8145395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145399">var</span>&nbsp;<span class="ident" id="8145403">err</span>&nbsp;<span class="builtintype" id="8145407">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145415">if</span>&nbsp;<span class="ident" id="8145418">_</span><span class="op" id="8145419">,</span>&nbsp;<span class="ident" id="8145421">err</span>&nbsp;<span class="op" id="8145425">=</span>&nbsp;<span class="ident" id="8145427">server</span><span class="op" id="8145433">.</span><span class="ident" id="8145434">Write</span><span class="op" id="8145439">(</span><span class="op" id="8145440">[</span><span class="op" id="8145441">]</span><span class="builtintype" id="8145442">byte</span><span class="op" id="8145446">(</span><span class="string" id="8145447">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="8145463">)</span><span class="op" id="8145464">)</span><span class="op" id="8145465">;</span>&nbsp;<span class="ident" id="8145467">err</span>&nbsp;<span class="op" id="8145471">!=</span>&nbsp;<span class="ident" id="8145474">nil</span>&nbsp;<span class="op" id="8145478">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145483">t</span><span class="op" id="8145484">.</span><span class="ident" id="8145485">Logf</span><span class="op" id="8145489">(</span><span class="string" id="8145490">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="8145519">,</span>&nbsp;<span class="ident" id="8145521">err</span><span class="op" id="8145524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145532">if</span>&nbsp;<span class="builtinfunc" id="8145535">len</span><span class="op" id="8145538">(</span><span class="ident" id="8145539">test</span><span class="op" id="8145543">.</span><span class="ident" id="8145544">expectHandshakeErrorIncluding</span><span class="op" id="8145573">)</span>&nbsp;<span class="op" id="8145575">&gt;</span>&nbsp;<span class="num" id="8145577">0</span>&nbsp;<span class="op" id="8145579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145584">if</span>&nbsp;<span class="ident" id="8145587">err</span>&nbsp;<span class="op" id="8145591">==</span>&nbsp;<span class="ident" id="8145594">nil</span>&nbsp;<span class="op" id="8145598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145604">t</span><span class="op" id="8145605">.</span><span class="ident" id="8145606">Errorf</span><span class="op" id="8145612">(</span><span class="string" id="8145613">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="8145652">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145657">}</span>&nbsp;<span class="keyword" id="8145659">else</span>&nbsp;<span class="keyword" id="8145664">if</span>&nbsp;<span class="ident" id="8145667">s</span>&nbsp;<span class="op" id="8145669">:=</span>&nbsp;<span class="ident" id="8145672">err</span><span class="op" id="8145675">.</span><span class="ident" id="8145676">Error</span><span class="op" id="8145681">(</span><span class="op" id="8145682">)</span><span class="op" id="8145683">;</span>&nbsp;<span class="op" id="8145685">!</span><span class="ident" id="8145686">strings</span><span class="op" id="8145693">.</span><span class="ident" id="8145694">Contains</span><span class="op" id="8145702">(</span><span class="ident" id="8145703">s</span><span class="op" id="8145704">,</span>&nbsp;<span class="ident" id="8145706">test</span><span class="op" id="8145710">.</span><span class="ident" id="8145711">expectHandshakeErrorIncluding</span><span class="op" id="8145740">)</span>&nbsp;<span class="op" id="8145742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145748">t</span><span class="op" id="8145749">.</span><span class="ident" id="8145750">Errorf</span><span class="op" id="8145756">(</span><span class="string" id="8145757">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8145802">,</span>&nbsp;<span class="ident" id="8145804">test</span><span class="op" id="8145808">.</span><span class="ident" id="8145809">expectHandshakeErrorIncluding</span><span class="op" id="8145838">,</span>&nbsp;<span class="ident" id="8145840">s</span><span class="op" id="8145841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145854">server</span><span class="op" id="8145860">.</span><span class="ident" id="8145861">Close</span><span class="op" id="8145866">(</span><span class="op" id="8145867">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145871">serverConn</span><span class="op" id="8145881">.</span><span class="ident" id="8145882">Close</span><span class="op" id="8145887">(</span><span class="op" id="8145888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145892">connStateChan</span>&nbsp;<span class="op" id="8145906">&lt;-</span>&nbsp;<span class="ident" id="8145909">server</span><span class="op" id="8145915">.</span><span class="ident" id="8145916">ConnectionState</span><span class="op" id="8145931">(</span><span class="op" id="8145932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145935">}</span><span class="op" id="8145936">(</span><span class="op" id="8145937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145941">if</span>&nbsp;<span class="op" id="8145944">!</span><span class="ident" id="8145945">write</span>&nbsp;<span class="op" id="8145951">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145955">flows</span><span class="op" id="8145960">,</span>&nbsp;<span class="ident" id="8145962">err</span>&nbsp;<span class="op" id="8145966">:=</span>&nbsp;<span class="ident" id="8145969">test</span><span class="op" id="8145973">.</span><span class="ident" id="8145974">loadData</span><span class="op" id="8145982">(</span><span class="op" id="8145983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145987">if</span>&nbsp;<span class="ident" id="8145990">err</span>&nbsp;<span class="op" id="8145994">!=</span>&nbsp;<span class="ident" id="8145997">nil</span>&nbsp;<span class="op" id="8146001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146006">if</span>&nbsp;<span class="op" id="8146009">!</span><span class="ident" id="8146010">test</span><span class="op" id="8146014">.</span><span class="ident" id="8146015">expectAlert</span>&nbsp;<span class="op" id="8146027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146033">t</span><span class="op" id="8146034">.</span><span class="ident" id="8146035">Fatalf</span><span class="op" id="8146041">(</span><span class="string" id="8146042">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="8146075">,</span>&nbsp;<span class="ident" id="8146077">test</span><span class="op" id="8146081">.</span><span class="ident" id="8146082">name</span><span class="op" id="8146086">,</span>&nbsp;<span class="ident" id="8146088">test</span><span class="op" id="8146092">.</span><span class="ident" id="8146093">dataPath</span><span class="op" id="8146101">(</span><span class="op" id="8146102">)</span><span class="op" id="8146103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146108">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146116">for</span>&nbsp;<span class="ident" id="8146120">i</span><span class="op" id="8146121">,</span>&nbsp;<span class="ident" id="8146123">b</span>&nbsp;<span class="op" id="8146125">:=</span>&nbsp;<span class="keyword" id="8146128">range</span>&nbsp;<span class="ident" id="8146134">flows</span>&nbsp;<span class="op" id="8146140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146145">if</span>&nbsp;<span class="ident" id="8146148">i</span><span class="op" id="8146149">%</span><span class="num" id="8146150">2</span>&nbsp;<span class="op" id="8146152">==</span>&nbsp;<span class="num" id="8146155">0</span>&nbsp;<span class="op" id="8146157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146163">clientConn</span><span class="op" id="8146173">.</span><span class="ident" id="8146174">Write</span><span class="op" id="8146179">(</span><span class="ident" id="8146180">b</span><span class="op" id="8146181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146187">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146204">bb</span>&nbsp;<span class="op" id="8146207">:=</span>&nbsp;<span class="builtinfunc" id="8146210">make</span><span class="op" id="8146214">(</span><span class="op" id="8146215">[</span><span class="op" id="8146216">]</span><span class="builtintype" id="8146217">byte</span><span class="op" id="8146221">,</span>&nbsp;<span class="builtinfunc" id="8146223">len</span><span class="op" id="8146226">(</span><span class="ident" id="8146227">b</span><span class="op" id="8146228">)</span><span class="op" id="8146229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146234">n</span><span class="op" id="8146235">,</span>&nbsp;<span class="ident" id="8146237">err</span>&nbsp;<span class="op" id="8146241">:=</span>&nbsp;<span class="ident" id="8146244">io</span><span class="op" id="8146246">.</span><span class="ident" id="8146247">ReadFull</span><span class="op" id="8146255">(</span><span class="ident" id="8146256">clientConn</span><span class="op" id="8146266">,</span>&nbsp;<span class="ident" id="8146268">bb</span><span class="op" id="8146270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146275">if</span>&nbsp;<span class="ident" id="8146278">test</span><span class="op" id="8146282">.</span><span class="ident" id="8146283">expectAlert</span>&nbsp;<span class="op" id="8146295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146301">if</span>&nbsp;<span class="ident" id="8146304">err</span>&nbsp;<span class="op" id="8146308">==</span>&nbsp;<span class="ident" id="8146311">nil</span>&nbsp;<span class="op" id="8146315">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146322">t</span><span class="op" id="8146323">.</span><span class="ident" id="8146324">Fatal</span><span class="op" id="8146329">(</span><span class="string" id="8146330">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="8146372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146383">}</span>&nbsp;<span class="keyword" id="8146385">else</span>&nbsp;<span class="op" id="8146390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146396">if</span>&nbsp;<span class="ident" id="8146399">err</span>&nbsp;<span class="op" id="8146403">!=</span>&nbsp;<span class="ident" id="8146406">nil</span>&nbsp;<span class="op" id="8146410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146417">t</span><span class="op" id="8146418">.</span><span class="ident" id="8146419">Fatalf</span><span class="op" id="8146425">(</span><span class="string" id="8146426">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="8146479">,</span>&nbsp;<span class="ident" id="8146481">test</span><span class="op" id="8146485">.</span><span class="ident" id="8146486">name</span><span class="op" id="8146490">,</span>&nbsp;<span class="ident" id="8146492">i</span><span class="op" id="8146493">+</span><span class="num" id="8146494">1</span><span class="op" id="8146495">,</span>&nbsp;<span class="ident" id="8146497">err</span><span class="op" id="8146500">,</span>&nbsp;<span class="ident" id="8146502">n</span><span class="op" id="8146503">,</span>&nbsp;<span class="builtinfunc" id="8146505">len</span><span class="op" id="8146508">(</span><span class="ident" id="8146509">bb</span><span class="op" id="8146511">)</span><span class="op" id="8146512">,</span>&nbsp;<span class="ident" id="8146514">bb</span><span class="op" id="8146516">[</span><span class="op" id="8146517">:</span><span class="ident" id="8146518">n</span><span class="op" id="8146519">]</span><span class="op" id="8146520">,</span>&nbsp;<span class="ident" id="8146522">b</span><span class="op" id="8146523">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146535">if</span>&nbsp;<span class="op" id="8146538">!</span><span class="ident" id="8146539">bytes</span><span class="op" id="8146544">.</span><span class="ident" id="8146545">Equal</span><span class="op" id="8146550">(</span><span class="ident" id="8146551">b</span><span class="op" id="8146552">,</span>&nbsp;<span class="ident" id="8146554">bb</span><span class="op" id="8146556">)</span>&nbsp;<span class="op" id="8146558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146565">t</span><span class="op" id="8146566">.</span><span class="ident" id="8146567">Fatalf</span><span class="op" id="8146573">(</span><span class="string" id="8146574">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8146616">,</span>&nbsp;<span class="ident" id="8146618">test</span><span class="op" id="8146622">.</span><span class="ident" id="8146623">name</span><span class="op" id="8146627">,</span>&nbsp;<span class="ident" id="8146629">i</span><span class="op" id="8146630">+</span><span class="num" id="8146631">1</span><span class="op" id="8146632">,</span>&nbsp;<span class="ident" id="8146634">bb</span><span class="op" id="8146636">,</span>&nbsp;<span class="ident" id="8146638">b</span><span class="op" id="8146639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146650">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146658">clientConn</span><span class="op" id="8146668">.</span><span class="ident" id="8146669">Close</span><span class="op" id="8146674">(</span><span class="op" id="8146675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8146678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146682">connState</span>&nbsp;<span class="op" id="8146692">:=</span>&nbsp;<span class="op" id="8146695">&lt;-</span><span class="ident" id="8146697">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146712">peerCerts</span>&nbsp;<span class="op" id="8146722">:=</span>&nbsp;<span class="ident" id="8146725">connState</span><span class="op" id="8146734">.</span><span class="ident" id="8146735">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146753">if</span>&nbsp;<span class="builtinfunc" id="8146756">len</span><span class="op" id="8146759">(</span><span class="ident" id="8146760">peerCerts</span><span class="op" id="8146769">)</span>&nbsp;<span class="op" id="8146771">==</span>&nbsp;<span class="builtinfunc" id="8146774">len</span><span class="op" id="8146777">(</span><span class="ident" id="8146778">test</span><span class="op" id="8146782">.</span><span class="ident" id="8146783">expectedPeerCerts</span><span class="op" id="8146800">)</span>&nbsp;<span class="op" id="8146802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146806">for</span>&nbsp;<span class="ident" id="8146810">i</span><span class="op" id="8146811">,</span>&nbsp;<span class="ident" id="8146813">peerCert</span>&nbsp;<span class="op" id="8146822">:=</span>&nbsp;<span class="keyword" id="8146825">range</span>&nbsp;<span class="ident" id="8146831">peerCerts</span>&nbsp;<span class="op" id="8146841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146846">block</span><span class="op" id="8146851">,</span>&nbsp;<span class="ident" id="8146853">_</span>&nbsp;<span class="op" id="8146855">:=</span>&nbsp;<span class="ident" id="8146858">pem</span><span class="op" id="8146861">.</span><span class="ident" id="8146862">Decode</span><span class="op" id="8146868">(</span><span class="op" id="8146869">[</span><span class="op" id="8146870">]</span><span class="builtintype" id="8146871">byte</span><span class="op" id="8146875">(</span><span class="ident" id="8146876">test</span><span class="op" id="8146880">.</span><span class="ident" id="8146881">expectedPeerCerts</span><span class="op" id="8146898">[</span><span class="ident" id="8146899">i</span><span class="op" id="8146900">]</span><span class="op" id="8146901">)</span><span class="op" id="8146902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8146907">if</span>&nbsp;<span class="op" id="8146910">!</span><span class="ident" id="8146911">bytes</span><span class="op" id="8146916">.</span><span class="ident" id="8146917">Equal</span><span class="op" id="8146922">(</span><span class="ident" id="8146923">block</span><span class="op" id="8146928">.</span><span class="ident" id="8146929">Bytes</span><span class="op" id="8146934">,</span>&nbsp;<span class="ident" id="8146936">peerCert</span><span class="op" id="8146944">.</span><span class="ident" id="8146945">Raw</span><span class="op" id="8146948">)</span>&nbsp;<span class="op" id="8146950">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8146956">t</span><span class="op" id="8146957">.</span><span class="ident" id="8146958">Fatalf</span><span class="op" id="8146964">(</span><span class="string" id="8146965">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="8146995">,</span>&nbsp;<span class="ident" id="8146997">test</span><span class="op" id="8147001">.</span><span class="ident" id="8147002">name</span><span class="op" id="8147006">,</span>&nbsp;<span class="ident" id="8147008">i</span><span class="op" id="8147009">+</span><span class="num" id="8147010">1</span><span class="op" id="8147011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147023">}</span>&nbsp;<span class="keyword" id="8147025">else</span>&nbsp;<span class="op" id="8147030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147034">t</span><span class="op" id="8147035">.</span><span class="ident" id="8147036">Fatalf</span><span class="op" id="8147042">(</span><span class="string" id="8147043">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="8147102">,</span>&nbsp;<span class="ident" id="8147104">test</span><span class="op" id="8147108">.</span><span class="ident" id="8147109">name</span><span class="op" id="8147113">,</span>&nbsp;<span class="builtinfunc" id="8147115">len</span><span class="op" id="8147118">(</span><span class="ident" id="8147119">test</span><span class="op" id="8147123">.</span><span class="ident" id="8147124">expectedPeerCerts</span><span class="op" id="8147141">)</span><span class="op" id="8147142">,</span>&nbsp;<span class="builtinfunc" id="8147144">len</span><span class="op" id="8147147">(</span><span class="ident" id="8147148">peerCerts</span><span class="op" id="8147157">)</span><span class="op" id="8147158">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147165">if</span>&nbsp;<span class="ident" id="8147168">test</span><span class="op" id="8147172">.</span><span class="ident" id="8147173">validate</span>&nbsp;<span class="op" id="8147182">!=</span>&nbsp;<span class="ident" id="8147185">nil</span>&nbsp;<span class="op" id="8147189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147193">if</span>&nbsp;<span class="ident" id="8147196">err</span>&nbsp;<span class="op" id="8147200">:=</span>&nbsp;<span class="ident" id="8147203">test</span><span class="op" id="8147207">.</span><span class="ident" id="8147208">validate</span><span class="op" id="8147216">(</span><span class="ident" id="8147217">connState</span><span class="op" id="8147226">)</span><span class="op" id="8147227">;</span>&nbsp;<span class="ident" id="8147229">err</span>&nbsp;<span class="op" id="8147233">!=</span>&nbsp;<span class="ident" id="8147236">nil</span>&nbsp;<span class="op" id="8147240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147245">t</span><span class="op" id="8147246">.</span><span class="ident" id="8147247">Fatalf</span><span class="op" id="8147253">(</span><span class="string" id="8147254">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8147292">,</span>&nbsp;<span class="ident" id="8147294">err</span><span class="op" id="8147297">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147308">if</span>&nbsp;<span class="ident" id="8147311">write</span>&nbsp;<span class="op" id="8147317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147321">path</span>&nbsp;<span class="op" id="8147326">:=</span>&nbsp;<span class="ident" id="8147329">test</span><span class="op" id="8147333">.</span><span class="ident" id="8147334">dataPath</span><span class="op" id="8147342">(</span><span class="op" id="8147343">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147347">out</span><span class="op" id="8147350">,</span>&nbsp;<span class="ident" id="8147352">err</span>&nbsp;<span class="op" id="8147356">:=</span>&nbsp;<span class="ident" id="8147359">os</span><span class="op" id="8147361">.</span><span class="ident" id="8147362">OpenFile</span><span class="op" id="8147370">(</span><span class="ident" id="8147371">path</span><span class="op" id="8147375">,</span>&nbsp;<span class="ident" id="8147377">os</span><span class="op" id="8147379">.</span><span class="ident" id="8147380">O_WRONLY</span><span class="op" id="8147388">|</span><span class="ident" id="8147389">os</span><span class="op" id="8147391">.</span><span class="ident" id="8147392">O_CREATE</span><span class="op" id="8147400">|</span><span class="ident" id="8147401">os</span><span class="op" id="8147403">.</span><span class="ident" id="8147404">O_TRUNC</span><span class="op" id="8147411">,</span>&nbsp;<span class="num" id="8147413">0644</span><span class="op" id="8147417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147421">if</span>&nbsp;<span class="ident" id="8147424">err</span>&nbsp;<span class="op" id="8147428">!=</span>&nbsp;<span class="ident" id="8147431">nil</span>&nbsp;<span class="op" id="8147435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147440">t</span><span class="op" id="8147441">.</span><span class="ident" id="8147442">Fatalf</span><span class="op" id="8147448">(</span><span class="string" id="8147449">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8147483">,</span>&nbsp;<span class="ident" id="8147485">err</span><span class="op" id="8147488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147496">defer</span>&nbsp;<span class="ident" id="8147502">out</span><span class="op" id="8147505">.</span><span class="ident" id="8147506">Close</span><span class="op" id="8147511">(</span><span class="op" id="8147512">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147516">recordingConn</span><span class="op" id="8147529">.</span><span class="ident" id="8147530">Close</span><span class="op" id="8147535">(</span><span class="op" id="8147536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147540">if</span>&nbsp;<span class="builtinfunc" id="8147543">len</span><span class="op" id="8147546">(</span><span class="ident" id="8147547">recordingConn</span><span class="op" id="8147560">.</span><span class="ident" id="8147561">flows</span><span class="op" id="8147566">)</span>&nbsp;<span class="op" id="8147568">&lt;</span>&nbsp;<span class="num" id="8147570">3</span>&nbsp;<span class="op" id="8147572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147577">childProcess</span><span class="op" id="8147589">.</span><span class="ident" id="8147590">Stdout</span><span class="op" id="8147596">.</span><span class="op" id="8147597">(</span><span class="op" id="8147598">*</span><span class="ident" id="8147599">bytes</span><span class="op" id="8147604">.</span><span class="ident" id="8147605">Buffer</span><span class="op" id="8147611">)</span><span class="op" id="8147612">.</span><span class="ident" id="8147613">WriteTo</span><span class="op" id="8147620">(</span><span class="ident" id="8147621">os</span><span class="op" id="8147623">.</span><span class="ident" id="8147624">Stdout</span><span class="op" id="8147630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147635">if</span>&nbsp;<span class="builtinfunc" id="8147638">len</span><span class="op" id="8147641">(</span><span class="ident" id="8147642">test</span><span class="op" id="8147646">.</span><span class="ident" id="8147647">expectHandshakeErrorIncluding</span><span class="op" id="8147676">)</span>&nbsp;<span class="op" id="8147678">==</span>&nbsp;<span class="num" id="8147681">0</span>&nbsp;<span class="op" id="8147683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147689">t</span><span class="op" id="8147690">.</span><span class="ident" id="8147691">Fatalf</span><span class="op" id="8147697">(</span><span class="string" id="8147698">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="8147716">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147729">recordingConn</span><span class="op" id="8147742">.</span><span class="ident" id="8147743">WriteTo</span><span class="op" id="8147750">(</span><span class="ident" id="8147751">out</span><span class="op" id="8147754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147758">fmt</span><span class="op" id="8147761">.</span><span class="ident" id="8147762">Printf</span><span class="op" id="8147768">(</span><span class="string" id="8147769">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8147781">,</span>&nbsp;<span class="ident" id="8147783">path</span><span class="op" id="8147787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147791">childProcess</span><span class="op" id="8147803">.</span><span class="ident" id="8147804">Wait</span><span class="op" id="8147808">(</span><span class="op" id="8147809">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8147812">}</span><br>
<span class="lineno"></span><span class="op" id="8147814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8147817">func</span>&nbsp;<span class="ident" id="8147822">runServerTestForVersion</span><span class="op" id="8147845">(</span><span class="ident" id="8147846">t</span>&nbsp;<span class="op" id="8147848">*</span><span class="ident" id="8147849">testing</span><span class="op" id="8147856">.</span><span class="ident" id="8147857">T</span><span class="op" id="8147858">,</span>&nbsp;<span class="ident" id="8147860">template</span>&nbsp;<span class="op" id="8147869">*</span><span class="ident" id="8147870">serverTest</span><span class="op" id="8147880">,</span>&nbsp;<span class="ident" id="8147882">prefix</span><span class="op" id="8147888">,</span>&nbsp;<span class="ident" id="8147890">option</span>&nbsp;<span class="builtintype" id="8147897">string</span><span class="op" id="8147903">)</span>&nbsp;<span class="op" id="8147905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147908">test</span>&nbsp;<span class="op" id="8147913">:=</span>&nbsp;<span class="op" id="8147916">*</span><span class="ident" id="8147917">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147927">test</span><span class="op" id="8147931">.</span><span class="ident" id="8147932">name</span>&nbsp;<span class="op" id="8147937">=</span>&nbsp;<span class="ident" id="8147939">prefix</span>&nbsp;<span class="op" id="8147946">+</span>&nbsp;<span class="ident" id="8147948">test</span><span class="op" id="8147952">.</span><span class="ident" id="8147953">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8147959">if</span>&nbsp;<span class="builtinfunc" id="8147962">len</span><span class="op" id="8147965">(</span><span class="ident" id="8147966">test</span><span class="op" id="8147970">.</span><span class="ident" id="8147971">command</span><span class="op" id="8147978">)</span>&nbsp;<span class="op" id="8147980">==</span>&nbsp;<span class="num" id="8147983">0</span>&nbsp;<span class="op" id="8147985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8147989">test</span><span class="op" id="8147993">.</span><span class="ident" id="8147994">command</span>&nbsp;<span class="op" id="8148002">=</span>&nbsp;<span class="ident" id="8148004">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148029">test</span><span class="op" id="8148033">.</span><span class="ident" id="8148034">command</span>&nbsp;<span class="op" id="8148042">=</span>&nbsp;<span class="builtinfunc" id="8148044">append</span><span class="op" id="8148050">(</span><span class="op" id="8148051">[</span><span class="op" id="8148052">]</span><span class="builtintype" id="8148053">string</span><span class="op" id="8148059">(</span><span class="ident" id="8148060">nil</span><span class="op" id="8148063">)</span><span class="op" id="8148064">,</span>&nbsp;<span class="ident" id="8148066">test</span><span class="op" id="8148070">.</span><span class="ident" id="8148071">command</span><span class="op" id="8148078">...</span><span class="op" id="8148081">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148084">test</span><span class="op" id="8148088">.</span><span class="ident" id="8148089">command</span>&nbsp;<span class="op" id="8148097">=</span>&nbsp;<span class="builtinfunc" id="8148099">append</span><span class="op" id="8148105">(</span><span class="ident" id="8148106">test</span><span class="op" id="8148110">.</span><span class="ident" id="8148111">command</span><span class="op" id="8148118">,</span>&nbsp;<span class="ident" id="8148120">option</span><span class="op" id="8148126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148129">test</span><span class="op" id="8148133">.</span><span class="ident" id="8148134">run</span><span class="op" id="8148137">(</span><span class="ident" id="8148138">t</span><span class="op" id="8148139">,</span>&nbsp;<span class="op" id="8148141">*</span><span class="ident" id="8148142">update</span><span class="op" id="8148148">)</span><br>
<span class="lineno"></span><span class="op" id="8148150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148153">func</span>&nbsp;<span class="ident" id="8148158">runServerTestSSLv3</span><span class="op" id="8148176">(</span><span class="ident" id="8148177">t</span>&nbsp;<span class="op" id="8148179">*</span><span class="ident" id="8148180">testing</span><span class="op" id="8148187">.</span><span class="ident" id="8148188">T</span><span class="op" id="8148189">,</span>&nbsp;<span class="ident" id="8148191">template</span>&nbsp;<span class="op" id="8148200">*</span><span class="ident" id="8148201">serverTest</span><span class="op" id="8148211">)</span>&nbsp;<span class="op" id="8148213">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148216">runServerTestForVersion</span><span class="op" id="8148239">(</span><span class="ident" id="8148240">t</span><span class="op" id="8148241">,</span>&nbsp;<span class="ident" id="8148243">template</span><span class="op" id="8148251">,</span>&nbsp;<span class="string" id="8148253">&#34;SSLv3-&#34;</span><span class="op" id="8148261">,</span>&nbsp;<span class="string" id="8148263">&#34;-ssl3&#34;</span><span class="op" id="8148270">)</span><br>
<span class="lineno"></span><span class="op" id="8148272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148275">func</span>&nbsp;<span class="ident" id="8148280">runServerTestTLS10</span><span class="op" id="8148298">(</span><span class="ident" id="8148299">t</span>&nbsp;<span class="op" id="8148301">*</span><span class="ident" id="8148302">testing</span><span class="op" id="8148309">.</span><span class="ident" id="8148310">T</span><span class="op" id="8148311">,</span>&nbsp;<span class="ident" id="8148313">template</span>&nbsp;<span class="op" id="8148322">*</span><span class="ident" id="8148323">serverTest</span><span class="op" id="8148333">)</span>&nbsp;<span class="op" id="8148335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148338">runServerTestForVersion</span><span class="op" id="8148361">(</span><span class="ident" id="8148362">t</span><span class="op" id="8148363">,</span>&nbsp;<span class="ident" id="8148365">template</span><span class="op" id="8148373">,</span>&nbsp;<span class="string" id="8148375">&#34;TLSv10-&#34;</span><span class="op" id="8148384">,</span>&nbsp;<span class="string" id="8148386">&#34;-tls1&#34;</span><span class="op" id="8148393">)</span><br>
<span class="lineno">470</span><span class="op" id="8148395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8148398">func</span>&nbsp;<span class="ident" id="8148403">runServerTestTLS11</span><span class="op" id="8148421">(</span><span class="ident" id="8148422">t</span>&nbsp;<span class="op" id="8148424">*</span><span class="ident" id="8148425">testing</span><span class="op" id="8148432">.</span><span class="ident" id="8148433">T</span><span class="op" id="8148434">,</span>&nbsp;<span class="ident" id="8148436">template</span>&nbsp;<span class="op" id="8148445">*</span><span class="ident" id="8148446">serverTest</span><span class="op" id="8148456">)</span>&nbsp;<span class="op" id="8148458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148461">runServerTestForVersion</span><span class="op" id="8148484">(</span><span class="ident" id="8148485">t</span><span class="op" id="8148486">,</span>&nbsp;<span class="ident" id="8148488">template</span><span class="op" id="8148496">,</span>&nbsp;<span class="string" id="8148498">&#34;TLSv11-&#34;</span><span class="op" id="8148507">,</span>&nbsp;<span class="string" id="8148509">&#34;-tls1_1&#34;</span><span class="op" id="8148518">)</span><br>
<span class="lineno"></span><span class="op" id="8148520">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8148523">func</span>&nbsp;<span class="ident" id="8148528">runServerTestTLS12</span><span class="op" id="8148546">(</span><span class="ident" id="8148547">t</span>&nbsp;<span class="op" id="8148549">*</span><span class="ident" id="8148550">testing</span><span class="op" id="8148557">.</span><span class="ident" id="8148558">T</span><span class="op" id="8148559">,</span>&nbsp;<span class="ident" id="8148561">template</span>&nbsp;<span class="op" id="8148570">*</span><span class="ident" id="8148571">serverTest</span><span class="op" id="8148581">)</span>&nbsp;<span class="op" id="8148583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148586">runServerTestForVersion</span><span class="op" id="8148609">(</span><span class="ident" id="8148610">t</span><span class="op" id="8148611">,</span>&nbsp;<span class="ident" id="8148613">template</span><span class="op" id="8148621">,</span>&nbsp;<span class="string" id="8148623">&#34;TLSv12-&#34;</span><span class="op" id="8148632">,</span>&nbsp;<span class="string" id="8148634">&#34;-tls1_2&#34;</span><span class="op" id="8148643">)</span><br>
<span class="lineno"></span><span class="op" id="8148645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8148648">func</span>&nbsp;<span class="ident" id="8148653">TestHandshakeServerRSARC4</span><span class="op" id="8148678">(</span><span class="ident" id="8148679">t</span>&nbsp;<span class="op" id="8148681">*</span><span class="ident" id="8148682">testing</span><span class="op" id="8148689">.</span><span class="ident" id="8148690">T</span><span class="op" id="8148691">)</span>&nbsp;<span class="op" id="8148693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148696">test</span>&nbsp;<span class="op" id="8148701">:=</span>&nbsp;<span class="op" id="8148704">&amp;</span><span class="ident" id="8148705">serverTest</span><span class="op" id="8148715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148719">name</span><span class="op" id="8148723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8148728">&#34;RSA-RC4&#34;</span><span class="op" id="8148737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148741">command</span><span class="op" id="8148748">:</span>&nbsp;<span class="op" id="8148750">[</span><span class="op" id="8148751">]</span><span class="builtintype" id="8148752">string</span><span class="op" id="8148758">{</span><span class="string" id="8148759">&#34;openssl&#34;</span><span class="op" id="8148768">,</span>&nbsp;<span class="string" id="8148770">&#34;s_client&#34;</span><span class="op" id="8148780">,</span>&nbsp;<span class="string" id="8148782">&#34;-no_ticket&#34;</span><span class="op" id="8148794">,</span>&nbsp;<span class="string" id="8148796">&#34;-cipher&#34;</span><span class="op" id="8148805">,</span>&nbsp;<span class="string" id="8148807">&#34;RC4-SHA&#34;</span><span class="op" id="8148816">}</span><span class="op" id="8148817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8148820">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148823">runServerTestSSLv3</span><span class="op" id="8148841">(</span><span class="ident" id="8148842">t</span><span class="op" id="8148843">,</span>&nbsp;<span class="ident" id="8148845">test</span><span class="op" id="8148849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148852">runServerTestTLS10</span><span class="op" id="8148870">(</span><span class="ident" id="8148871">t</span><span class="op" id="8148872">,</span>&nbsp;<span class="ident" id="8148874">test</span><span class="op" id="8148878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148881">runServerTestTLS11</span><span class="op" id="8148899">(</span><span class="ident" id="8148900">t</span><span class="op" id="8148901">,</span>&nbsp;<span class="ident" id="8148903">test</span><span class="op" id="8148907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148910">runServerTestTLS12</span><span class="op" id="8148928">(</span><span class="ident" id="8148929">t</span><span class="op" id="8148930">,</span>&nbsp;<span class="ident" id="8148932">test</span><span class="op" id="8148936">)</span><br>
<span class="lineno"></span><span class="op" id="8148938">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="8148941">func</span>&nbsp;<span class="ident" id="8148946">TestHandshakeServerRSA3DES</span><span class="op" id="8148972">(</span><span class="ident" id="8148973">t</span>&nbsp;<span class="op" id="8148975">*</span><span class="ident" id="8148976">testing</span><span class="op" id="8148983">.</span><span class="ident" id="8148984">T</span><span class="op" id="8148985">)</span>&nbsp;<span class="op" id="8148987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8148990">test</span>&nbsp;<span class="op" id="8148995">:=</span>&nbsp;<span class="op" id="8148998">&amp;</span><span class="ident" id="8148999">serverTest</span><span class="op" id="8149009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149013">name</span><span class="op" id="8149017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149022">&#34;RSA-3DES&#34;</span><span class="op" id="8149032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149036">command</span><span class="op" id="8149043">:</span>&nbsp;<span class="op" id="8149045">[</span><span class="op" id="8149046">]</span><span class="builtintype" id="8149047">string</span><span class="op" id="8149053">{</span><span class="string" id="8149054">&#34;openssl&#34;</span><span class="op" id="8149063">,</span>&nbsp;<span class="string" id="8149065">&#34;s_client&#34;</span><span class="op" id="8149075">,</span>&nbsp;<span class="string" id="8149077">&#34;-no_ticket&#34;</span><span class="op" id="8149089">,</span>&nbsp;<span class="string" id="8149091">&#34;-cipher&#34;</span><span class="op" id="8149100">,</span>&nbsp;<span class="string" id="8149102">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="8149116">}</span><span class="op" id="8149117">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149123">runServerTestSSLv3</span><span class="op" id="8149141">(</span><span class="ident" id="8149142">t</span><span class="op" id="8149143">,</span>&nbsp;<span class="ident" id="8149145">test</span><span class="op" id="8149149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149152">runServerTestTLS10</span><span class="op" id="8149170">(</span><span class="ident" id="8149171">t</span><span class="op" id="8149172">,</span>&nbsp;<span class="ident" id="8149174">test</span><span class="op" id="8149178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149181">runServerTestTLS12</span><span class="op" id="8149199">(</span><span class="ident" id="8149200">t</span><span class="op" id="8149201">,</span>&nbsp;<span class="ident" id="8149203">test</span><span class="op" id="8149207">)</span><br>
<span class="lineno"></span><span class="op" id="8149209">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="8149212">func</span>&nbsp;<span class="ident" id="8149217">TestHandshakeServerRSAAES</span><span class="op" id="8149242">(</span><span class="ident" id="8149243">t</span>&nbsp;<span class="op" id="8149245">*</span><span class="ident" id="8149246">testing</span><span class="op" id="8149253">.</span><span class="ident" id="8149254">T</span><span class="op" id="8149255">)</span>&nbsp;<span class="op" id="8149257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149260">test</span>&nbsp;<span class="op" id="8149265">:=</span>&nbsp;<span class="op" id="8149268">&amp;</span><span class="ident" id="8149269">serverTest</span><span class="op" id="8149279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149283">name</span><span class="op" id="8149287">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149292">&#34;RSA-AES&#34;</span><span class="op" id="8149301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149305">command</span><span class="op" id="8149312">:</span>&nbsp;<span class="op" id="8149314">[</span><span class="op" id="8149315">]</span><span class="builtintype" id="8149316">string</span><span class="op" id="8149322">{</span><span class="string" id="8149323">&#34;openssl&#34;</span><span class="op" id="8149332">,</span>&nbsp;<span class="string" id="8149334">&#34;s_client&#34;</span><span class="op" id="8149344">,</span>&nbsp;<span class="string" id="8149346">&#34;-no_ticket&#34;</span><span class="op" id="8149358">,</span>&nbsp;<span class="string" id="8149360">&#34;-cipher&#34;</span><span class="op" id="8149369">,</span>&nbsp;<span class="string" id="8149371">&#34;AES128-SHA&#34;</span><span class="op" id="8149383">}</span><span class="op" id="8149384">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149390">runServerTestSSLv3</span><span class="op" id="8149408">(</span><span class="ident" id="8149409">t</span><span class="op" id="8149410">,</span>&nbsp;<span class="ident" id="8149412">test</span><span class="op" id="8149416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149419">runServerTestTLS10</span><span class="op" id="8149437">(</span><span class="ident" id="8149438">t</span><span class="op" id="8149439">,</span>&nbsp;<span class="ident" id="8149441">test</span><span class="op" id="8149445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149448">runServerTestTLS12</span><span class="op" id="8149466">(</span><span class="ident" id="8149467">t</span><span class="op" id="8149468">,</span>&nbsp;<span class="ident" id="8149470">test</span><span class="op" id="8149474">)</span><br>
<span class="lineno"></span><span class="op" id="8149476">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="8149479">func</span>&nbsp;<span class="ident" id="8149484">TestHandshakeServerAESGCM</span><span class="op" id="8149509">(</span><span class="ident" id="8149510">t</span>&nbsp;<span class="op" id="8149512">*</span><span class="ident" id="8149513">testing</span><span class="op" id="8149520">.</span><span class="ident" id="8149521">T</span><span class="op" id="8149522">)</span>&nbsp;<span class="op" id="8149524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149527">test</span>&nbsp;<span class="op" id="8149532">:=</span>&nbsp;<span class="op" id="8149535">&amp;</span><span class="ident" id="8149536">serverTest</span><span class="op" id="8149546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149550">name</span><span class="op" id="8149554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149559">&#34;RSA-AES-GCM&#34;</span><span class="op" id="8149572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149576">command</span><span class="op" id="8149583">:</span>&nbsp;<span class="op" id="8149585">[</span><span class="op" id="8149586">]</span><span class="builtintype" id="8149587">string</span><span class="op" id="8149593">{</span><span class="string" id="8149594">&#34;openssl&#34;</span><span class="op" id="8149603">,</span>&nbsp;<span class="string" id="8149605">&#34;s_client&#34;</span><span class="op" id="8149615">,</span>&nbsp;<span class="string" id="8149617">&#34;-no_ticket&#34;</span><span class="op" id="8149629">,</span>&nbsp;<span class="string" id="8149631">&#34;-cipher&#34;</span><span class="op" id="8149640">,</span>&nbsp;<span class="string" id="8149642">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8149671">}</span><span class="op" id="8149672">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149678">runServerTestTLS12</span><span class="op" id="8149696">(</span><span class="ident" id="8149697">t</span><span class="op" id="8149698">,</span>&nbsp;<span class="ident" id="8149700">test</span><span class="op" id="8149704">)</span><br>
<span class="lineno"></span><span class="op" id="8149706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149709">func</span>&nbsp;<span class="ident" id="8149714">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="8149746">(</span><span class="ident" id="8149747">t</span>&nbsp;<span class="op" id="8149749">*</span><span class="ident" id="8149750">testing</span><span class="op" id="8149757">.</span><span class="ident" id="8149758">T</span><span class="op" id="8149759">)</span>&nbsp;<span class="op" id="8149761">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149764">config</span>&nbsp;<span class="op" id="8149771">:=</span>&nbsp;<span class="op" id="8149774">*</span><span class="ident" id="8149775">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149787">config</span><span class="op" id="8149793">.</span><span class="ident" id="8149794">Certificates</span>&nbsp;<span class="op" id="8149807">=</span>&nbsp;<span class="builtinfunc" id="8149809">make</span><span class="op" id="8149813">(</span><span class="op" id="8149814">[</span><span class="op" id="8149815">]</span><span class="ident" id="8149816">Certificate</span><span class="op" id="8149827">,</span>&nbsp;<span class="num" id="8149829">1</span><span class="op" id="8149830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149833">config</span><span class="op" id="8149839">.</span><span class="ident" id="8149840">Certificates</span><span class="op" id="8149852">[</span><span class="num" id="8149853">0</span><span class="op" id="8149854">]</span><span class="op" id="8149855">.</span><span class="ident" id="8149856">Certificate</span>&nbsp;<span class="op" id="8149868">=</span>&nbsp;<span class="op" id="8149870">[</span><span class="op" id="8149871">]</span><span class="op" id="8149872">[</span><span class="op" id="8149873">]</span><span class="builtintype" id="8149874">byte</span><span class="op" id="8149878">{</span><span class="ident" id="8149879">testECDSACertificate</span><span class="op" id="8149899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149902">config</span><span class="op" id="8149908">.</span><span class="ident" id="8149909">Certificates</span><span class="op" id="8149921">[</span><span class="num" id="8149922">0</span><span class="op" id="8149923">]</span><span class="op" id="8149924">.</span><span class="ident" id="8149925">PrivateKey</span>&nbsp;<span class="op" id="8149936">=</span>&nbsp;<span class="ident" id="8149938">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149959">config</span><span class="op" id="8149965">.</span><span class="ident" id="8149966">BuildNameToCertificate</span><span class="op" id="8149988">(</span><span class="op" id="8149989">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149993">test</span>&nbsp;<span class="op" id="8149998">:=</span>&nbsp;<span class="op" id="8150001">&amp;</span><span class="ident" id="8150002">serverTest</span><span class="op" id="8150012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150016">name</span><span class="op" id="8150020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150025">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8150042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150046">command</span><span class="op" id="8150053">:</span>&nbsp;<span class="op" id="8150055">[</span><span class="op" id="8150056">]</span><span class="builtintype" id="8150057">string</span><span class="op" id="8150063">{</span><span class="string" id="8150064">&#34;openssl&#34;</span><span class="op" id="8150073">,</span>&nbsp;<span class="string" id="8150075">&#34;s_client&#34;</span><span class="op" id="8150085">,</span>&nbsp;<span class="string" id="8150087">&#34;-no_ticket&#34;</span><span class="op" id="8150099">,</span>&nbsp;<span class="string" id="8150101">&#34;-cipher&#34;</span><span class="op" id="8150110">,</span>&nbsp;<span class="string" id="8150112">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="8150136">}</span><span class="op" id="8150137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150141">config</span><span class="op" id="8150147">:</span>&nbsp;&nbsp;<span class="op" id="8150150">&amp;</span><span class="ident" id="8150151">config</span><span class="op" id="8150157">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150163">runServerTestTLS10</span><span class="op" id="8150181">(</span><span class="ident" id="8150182">t</span><span class="op" id="8150183">,</span>&nbsp;<span class="ident" id="8150185">test</span><span class="op" id="8150189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150192">runServerTestTLS12</span><span class="op" id="8150210">(</span><span class="ident" id="8150211">t</span><span class="op" id="8150212">,</span>&nbsp;<span class="ident" id="8150214">test</span><span class="op" id="8150218">)</span><br>
<span class="lineno"></span><span class="op" id="8150220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="8150223">func</span>&nbsp;<span class="ident" id="8150228">TestHandshakeServerALPN</span><span class="op" id="8150251">(</span><span class="ident" id="8150252">t</span>&nbsp;<span class="op" id="8150254">*</span><span class="ident" id="8150255">testing</span><span class="op" id="8150262">.</span><span class="ident" id="8150263">T</span><span class="op" id="8150264">)</span>&nbsp;<span class="op" id="8150266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150269">config</span>&nbsp;<span class="op" id="8150276">:=</span>&nbsp;<span class="op" id="8150279">*</span><span class="ident" id="8150280">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150292">config</span><span class="op" id="8150298">.</span><span class="ident" id="8150299">NextProtos</span>&nbsp;<span class="op" id="8150310">=</span>&nbsp;<span class="op" id="8150312">[</span><span class="op" id="8150313">]</span><span class="builtintype" id="8150314">string</span><span class="op" id="8150320">{</span><span class="string" id="8150321">&#34;proto1&#34;</span><span class="op" id="8150329">,</span>&nbsp;<span class="string" id="8150331">&#34;proto2&#34;</span><span class="op" id="8150339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150343">test</span>&nbsp;<span class="op" id="8150348">:=</span>&nbsp;<span class="op" id="8150351">&amp;</span><span class="ident" id="8150352">serverTest</span><span class="op" id="8150362">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150366">name</span><span class="op" id="8150370">:</span>&nbsp;<span class="string" id="8150372">&#34;ALPN&#34;</span><span class="op" id="8150378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8150382">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8150448">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150491">command</span><span class="op" id="8150498">:</span>&nbsp;<span class="op" id="8150500">[</span><span class="op" id="8150501">]</span><span class="builtintype" id="8150502">string</span><span class="op" id="8150508">{</span><span class="string" id="8150509">&#34;openssl&#34;</span><span class="op" id="8150518">,</span>&nbsp;<span class="string" id="8150520">&#34;s_client&#34;</span><span class="op" id="8150530">,</span>&nbsp;<span class="string" id="8150532">&#34;-alpn&#34;</span><span class="op" id="8150539">,</span>&nbsp;<span class="string" id="8150541">&#34;proto2,proto1&#34;</span><span class="op" id="8150556">}</span><span class="op" id="8150557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150561">config</span><span class="op" id="8150567">:</span>&nbsp;&nbsp;<span class="op" id="8150570">&amp;</span><span class="ident" id="8150571">config</span><span class="op" id="8150577">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150581">validate</span><span class="op" id="8150589">:</span>&nbsp;<span class="keyword" id="8150591">func</span><span class="op" id="8150595">(</span><span class="ident" id="8150596">state</span>&nbsp;<span class="ident" id="8150602">ConnectionState</span><span class="op" id="8150617">)</span>&nbsp;<span class="builtintype" id="8150619">error</span>&nbsp;<span class="op" id="8150625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8150630">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150689">if</span>&nbsp;<span class="ident" id="8150692">state</span><span class="op" id="8150697">.</span><span class="ident" id="8150698">NegotiatedProtocol</span>&nbsp;<span class="op" id="8150717">!=</span>&nbsp;<span class="string" id="8150720">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8150729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150735">return</span>&nbsp;<span class="ident" id="8150742">fmt</span><span class="op" id="8150745">.</span><span class="ident" id="8150746">Errorf</span><span class="op" id="8150752">(</span><span class="string" id="8150753">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8150785">,</span>&nbsp;<span class="ident" id="8150787">state</span><span class="op" id="8150792">.</span><span class="ident" id="8150793">NegotiatedProtocol</span><span class="op" id="8150811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150816">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150821">return</span>&nbsp;<span class="ident" id="8150828">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150834">}</span><span class="op" id="8150835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150841">runServerTestTLS12</span><span class="op" id="8150859">(</span><span class="ident" id="8150860">t</span><span class="op" id="8150861">,</span>&nbsp;<span class="ident" id="8150863">test</span><span class="op" id="8150867">)</span><br>
<span class="lineno"></span><span class="op" id="8150869">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="8150872">func</span>&nbsp;<span class="ident" id="8150877">TestHandshakeServerALPNNoMatch</span><span class="op" id="8150907">(</span><span class="ident" id="8150908">t</span>&nbsp;<span class="op" id="8150910">*</span><span class="ident" id="8150911">testing</span><span class="op" id="8150918">.</span><span class="ident" id="8150919">T</span><span class="op" id="8150920">)</span>&nbsp;<span class="op" id="8150922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150925">config</span>&nbsp;<span class="op" id="8150932">:=</span>&nbsp;<span class="op" id="8150935">*</span><span class="ident" id="8150936">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150948">config</span><span class="op" id="8150954">.</span><span class="ident" id="8150955">NextProtos</span>&nbsp;<span class="op" id="8150966">=</span>&nbsp;<span class="op" id="8150968">[</span><span class="op" id="8150969">]</span><span class="builtintype" id="8150970">string</span><span class="op" id="8150976">{</span><span class="string" id="8150977">&#34;proto3&#34;</span><span class="op" id="8150985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150989">test</span>&nbsp;<span class="op" id="8150994">:=</span>&nbsp;<span class="op" id="8150997">&amp;</span><span class="ident" id="8150998">serverTest</span><span class="op" id="8151008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151012">name</span><span class="op" id="8151016">:</span>&nbsp;<span class="string" id="8151018">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8151032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8151036">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8151102">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151145">command</span><span class="op" id="8151152">:</span>&nbsp;<span class="op" id="8151154">[</span><span class="op" id="8151155">]</span><span class="builtintype" id="8151156">string</span><span class="op" id="8151162">{</span><span class="string" id="8151163">&#34;openssl&#34;</span><span class="op" id="8151172">,</span>&nbsp;<span class="string" id="8151174">&#34;s_client&#34;</span><span class="op" id="8151184">,</span>&nbsp;<span class="string" id="8151186">&#34;-alpn&#34;</span><span class="op" id="8151193">,</span>&nbsp;<span class="string" id="8151195">&#34;proto2,proto1&#34;</span><span class="op" id="8151210">}</span><span class="op" id="8151211">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151215">config</span><span class="op" id="8151221">:</span>&nbsp;&nbsp;<span class="op" id="8151224">&amp;</span><span class="ident" id="8151225">config</span><span class="op" id="8151231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151235">validate</span><span class="op" id="8151243">:</span>&nbsp;<span class="keyword" id="8151245">func</span><span class="op" id="8151249">(</span><span class="ident" id="8151250">state</span>&nbsp;<span class="ident" id="8151256">ConnectionState</span><span class="op" id="8151271">)</span>&nbsp;<span class="builtintype" id="8151273">error</span>&nbsp;<span class="op" id="8151279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8151284">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8151343">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151386">if</span>&nbsp;<span class="ident" id="8151389">state</span><span class="op" id="8151394">.</span><span class="ident" id="8151395">NegotiatedProtocol</span>&nbsp;<span class="op" id="8151414">!=</span>&nbsp;<span class="string" id="8151417">&#34;&#34;</span>&nbsp;<span class="op" id="8151420">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151426">return</span>&nbsp;<span class="ident" id="8151433">fmt</span><span class="op" id="8151436">.</span><span class="ident" id="8151437">Errorf</span><span class="op" id="8151443">(</span><span class="string" id="8151444">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8151472">,</span>&nbsp;<span class="ident" id="8151474">state</span><span class="op" id="8151479">.</span><span class="ident" id="8151480">NegotiatedProtocol</span><span class="op" id="8151498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151508">return</span>&nbsp;<span class="ident" id="8151515">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151521">}</span><span class="op" id="8151522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151525">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151528">runServerTestTLS12</span><span class="op" id="8151546">(</span><span class="ident" id="8151547">t</span><span class="op" id="8151548">,</span>&nbsp;<span class="ident" id="8151550">test</span><span class="op" id="8151554">)</span><br>
<span class="lineno"></span><span class="op" id="8151556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8151559">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8151631">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="8151711">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8151775">func</span>&nbsp;<span class="ident" id="8151780">TestHandshakeServerSNI</span><span class="op" id="8151802">(</span><span class="ident" id="8151803">t</span>&nbsp;<span class="op" id="8151805">*</span><span class="ident" id="8151806">testing</span><span class="op" id="8151813">.</span><span class="ident" id="8151814">T</span><span class="op" id="8151815">)</span>&nbsp;<span class="op" id="8151817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151820">test</span>&nbsp;<span class="op" id="8151825">:=</span>&nbsp;<span class="op" id="8151828">&amp;</span><span class="ident" id="8151829">serverTest</span><span class="op" id="8151839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151843">name</span><span class="op" id="8151847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151852">&#34;SNI&#34;</span><span class="op" id="8151857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151861">command</span><span class="op" id="8151868">:</span>&nbsp;<span class="op" id="8151870">[</span><span class="op" id="8151871">]</span><span class="builtintype" id="8151872">string</span><span class="op" id="8151878">{</span><span class="string" id="8151879">&#34;openssl&#34;</span><span class="op" id="8151888">,</span>&nbsp;<span class="string" id="8151890">&#34;s_client&#34;</span><span class="op" id="8151900">,</span>&nbsp;<span class="string" id="8151902">&#34;-no_ticket&#34;</span><span class="op" id="8151914">,</span>&nbsp;<span class="string" id="8151916">&#34;-cipher&#34;</span><span class="op" id="8151925">,</span>&nbsp;<span class="string" id="8151927">&#34;AES128-SHA&#34;</span><span class="op" id="8151939">,</span>&nbsp;<span class="string" id="8151941">&#34;-servername&#34;</span><span class="op" id="8151954">,</span>&nbsp;<span class="string" id="8151956">&#34;snitest.com&#34;</span><span class="op" id="8151969">}</span><span class="op" id="8151970">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151976">runServerTestTLS12</span><span class="op" id="8151994">(</span><span class="ident" id="8151995">t</span><span class="op" id="8151996">,</span>&nbsp;<span class="ident" id="8151998">test</span><span class="op" id="8152002">)</span><br>
<span class="lineno"></span><span class="op" id="8152004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8152007">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="8152086">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="8152129">func</span>&nbsp;<span class="ident" id="8152134">TestHandshakeServerSNIGetCertificate</span><span class="op" id="8152170">(</span><span class="ident" id="8152171">t</span>&nbsp;<span class="op" id="8152173">*</span><span class="ident" id="8152174">testing</span><span class="op" id="8152181">.</span><span class="ident" id="8152182">T</span><span class="op" id="8152183">)</span>&nbsp;<span class="op" id="8152185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152188">config</span>&nbsp;<span class="op" id="8152195">:=</span>&nbsp;<span class="op" id="8152198">*</span><span class="ident" id="8152199">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8152212">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152281">nameToCert</span>&nbsp;<span class="op" id="8152292">:=</span>&nbsp;<span class="ident" id="8152295">config</span><span class="op" id="8152301">.</span><span class="ident" id="8152302">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152321">config</span><span class="op" id="8152327">.</span><span class="ident" id="8152328">NameToCertificate</span>&nbsp;<span class="op" id="8152346">=</span>&nbsp;<span class="ident" id="8152348">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152353">config</span><span class="op" id="8152359">.</span><span class="ident" id="8152360">GetCertificate</span>&nbsp;<span class="op" id="8152375">=</span>&nbsp;<span class="keyword" id="8152377">func</span><span class="op" id="8152381">(</span><span class="ident" id="8152382">clientHello</span>&nbsp;<span class="op" id="8152394">*</span><span class="ident" id="8152395">ClientHelloInfo</span><span class="op" id="8152410">)</span>&nbsp;<span class="op" id="8152412">(</span><span class="op" id="8152413">*</span><span class="ident" id="8152414">Certificate</span><span class="op" id="8152425">,</span>&nbsp;<span class="builtintype" id="8152427">error</span><span class="op" id="8152432">)</span>&nbsp;<span class="op" id="8152434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152438">cert</span><span class="op" id="8152442">,</span>&nbsp;<span class="ident" id="8152444">_</span>&nbsp;<span class="op" id="8152446">:=</span>&nbsp;<span class="ident" id="8152449">nameToCert</span><span class="op" id="8152459">[</span><span class="ident" id="8152460">clientHello</span><span class="op" id="8152471">.</span><span class="ident" id="8152472">ServerName</span><span class="op" id="8152482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8152486">return</span>&nbsp;<span class="ident" id="8152493">cert</span><span class="op" id="8152497">,</span>&nbsp;<span class="ident" id="8152499">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152507">test</span>&nbsp;<span class="op" id="8152512">:=</span>&nbsp;<span class="op" id="8152515">&amp;</span><span class="ident" id="8152516">serverTest</span><span class="op" id="8152526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152530">name</span><span class="op" id="8152534">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152539">&#34;SNI&#34;</span><span class="op" id="8152544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152548">command</span><span class="op" id="8152555">:</span>&nbsp;<span class="op" id="8152557">[</span><span class="op" id="8152558">]</span><span class="builtintype" id="8152559">string</span><span class="op" id="8152565">{</span><span class="string" id="8152566">&#34;openssl&#34;</span><span class="op" id="8152575">,</span>&nbsp;<span class="string" id="8152577">&#34;s_client&#34;</span><span class="op" id="8152587">,</span>&nbsp;<span class="string" id="8152589">&#34;-no_ticket&#34;</span><span class="op" id="8152601">,</span>&nbsp;<span class="string" id="8152603">&#34;-cipher&#34;</span><span class="op" id="8152612">,</span>&nbsp;<span class="string" id="8152614">&#34;AES128-SHA&#34;</span><span class="op" id="8152626">,</span>&nbsp;<span class="string" id="8152628">&#34;-servername&#34;</span><span class="op" id="8152641">,</span>&nbsp;<span class="string" id="8152643">&#34;snitest.com&#34;</span><span class="op" id="8152656">}</span><span class="op" id="8152657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152661">config</span><span class="op" id="8152667">:</span>&nbsp;&nbsp;<span class="op" id="8152670">&amp;</span><span class="ident" id="8152671">config</span><span class="op" id="8152677">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152683">runServerTestTLS12</span><span class="op" id="8152701">(</span><span class="ident" id="8152702">t</span><span class="op" id="8152703">,</span>&nbsp;<span class="ident" id="8152705">test</span><span class="op" id="8152709">)</span><br>
<span class="lineno"></span><span class="op" id="8152711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8152714">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="8152773">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8152848">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8152922">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8152952">func</span>&nbsp;<span class="ident" id="8152957">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="8153001">(</span><span class="ident" id="8153002">t</span>&nbsp;<span class="op" id="8153004">*</span><span class="ident" id="8153005">testing</span><span class="op" id="8153012">.</span><span class="ident" id="8153013">T</span><span class="op" id="8153014">)</span>&nbsp;<span class="op" id="8153016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153019">config</span>&nbsp;<span class="op" id="8153026">:=</span>&nbsp;<span class="op" id="8153029">*</span><span class="ident" id="8153030">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153043">config</span><span class="op" id="8153049">.</span><span class="ident" id="8153050">GetCertificate</span>&nbsp;<span class="op" id="8153065">=</span>&nbsp;<span class="keyword" id="8153067">func</span><span class="op" id="8153071">(</span><span class="ident" id="8153072">clientHello</span>&nbsp;<span class="op" id="8153084">*</span><span class="ident" id="8153085">ClientHelloInfo</span><span class="op" id="8153100">)</span>&nbsp;<span class="op" id="8153102">(</span><span class="op" id="8153103">*</span><span class="ident" id="8153104">Certificate</span><span class="op" id="8153115">,</span>&nbsp;<span class="builtintype" id="8153117">error</span><span class="op" id="8153122">)</span>&nbsp;<span class="op" id="8153124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8153128">return</span>&nbsp;<span class="ident" id="8153135">nil</span><span class="op" id="8153138">,</span>&nbsp;<span class="ident" id="8153140">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8153145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153148">test</span>&nbsp;<span class="op" id="8153153">:=</span>&nbsp;<span class="op" id="8153156">&amp;</span><span class="ident" id="8153157">serverTest</span><span class="op" id="8153167">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153171">name</span><span class="op" id="8153175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8153180">&#34;SNI&#34;</span><span class="op" id="8153185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153189">command</span><span class="op" id="8153196">:</span>&nbsp;<span class="op" id="8153198">[</span><span class="op" id="8153199">]</span><span class="builtintype" id="8153200">string</span><span class="op" id="8153206">{</span><span class="string" id="8153207">&#34;openssl&#34;</span><span class="op" id="8153216">,</span>&nbsp;<span class="string" id="8153218">&#34;s_client&#34;</span><span class="op" id="8153228">,</span>&nbsp;<span class="string" id="8153230">&#34;-no_ticket&#34;</span><span class="op" id="8153242">,</span>&nbsp;<span class="string" id="8153244">&#34;-cipher&#34;</span><span class="op" id="8153253">,</span>&nbsp;<span class="string" id="8153255">&#34;AES128-SHA&#34;</span><span class="op" id="8153267">,</span>&nbsp;<span class="string" id="8153269">&#34;-servername&#34;</span><span class="op" id="8153282">,</span>&nbsp;<span class="string" id="8153284">&#34;snitest.com&#34;</span><span class="op" id="8153297">}</span><span class="op" id="8153298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153302">config</span><span class="op" id="8153308">:</span>&nbsp;&nbsp;<span class="op" id="8153311">&amp;</span><span class="ident" id="8153312">config</span><span class="op" id="8153318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8153321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153324">runServerTestTLS12</span><span class="op" id="8153342">(</span><span class="ident" id="8153343">t</span><span class="op" id="8153344">,</span>&nbsp;<span class="ident" id="8153346">test</span><span class="op" id="8153350">)</span><br>
<span class="lineno">625</span><span class="op" id="8153352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8153355">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8153431">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="8153472">func</span>&nbsp;<span class="ident" id="8153477">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="8153518">(</span><span class="ident" id="8153519">t</span>&nbsp;<span class="op" id="8153521">*</span><span class="ident" id="8153522">testing</span><span class="op" id="8153529">.</span><span class="ident" id="8153530">T</span><span class="op" id="8153531">)</span>&nbsp;<span class="op" id="8153533">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153536">config</span>&nbsp;<span class="op" id="8153543">:=</span>&nbsp;<span class="op" id="8153546">*</span><span class="ident" id="8153547">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153560">config</span><span class="op" id="8153566">.</span><span class="ident" id="8153567">GetCertificate</span>&nbsp;<span class="op" id="8153582">=</span>&nbsp;<span class="keyword" id="8153584">func</span><span class="op" id="8153588">(</span><span class="ident" id="8153589">clientHello</span>&nbsp;<span class="op" id="8153601">*</span><span class="ident" id="8153602">ClientHelloInfo</span><span class="op" id="8153617">)</span>&nbsp;<span class="op" id="8153619">(</span><span class="op" id="8153620">*</span><span class="ident" id="8153621">Certificate</span><span class="op" id="8153632">,</span>&nbsp;<span class="builtintype" id="8153634">error</span><span class="op" id="8153639">)</span>&nbsp;<span class="op" id="8153641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8153645">return</span>&nbsp;<span class="ident" id="8153652">nil</span><span class="op" id="8153655">,</span>&nbsp;<span class="ident" id="8153657">fmt</span><span class="op" id="8153660">.</span><span class="ident" id="8153661">Errorf</span><span class="op" id="8153667">(</span><span class="string" id="8153668">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="8153698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8153701">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153704">test</span>&nbsp;<span class="op" id="8153709">:=</span>&nbsp;<span class="op" id="8153712">&amp;</span><span class="ident" id="8153713">serverTest</span><span class="op" id="8153723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153727">name</span><span class="op" id="8153731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8153740">&#34;SNI&#34;</span><span class="op" id="8153745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153749">command</span><span class="op" id="8153756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153762">[</span><span class="op" id="8153763">]</span><span class="builtintype" id="8153764">string</span><span class="op" id="8153770">{</span><span class="string" id="8153771">&#34;openssl&#34;</span><span class="op" id="8153780">,</span>&nbsp;<span class="string" id="8153782">&#34;s_client&#34;</span><span class="op" id="8153792">,</span>&nbsp;<span class="string" id="8153794">&#34;-no_ticket&#34;</span><span class="op" id="8153806">,</span>&nbsp;<span class="string" id="8153808">&#34;-cipher&#34;</span><span class="op" id="8153817">,</span>&nbsp;<span class="string" id="8153819">&#34;AES128-SHA&#34;</span><span class="op" id="8153831">,</span>&nbsp;<span class="string" id="8153833">&#34;-servername&#34;</span><span class="op" id="8153846">,</span>&nbsp;<span class="string" id="8153848">&#34;snitest.com&#34;</span><span class="op" id="8153861">}</span><span class="op" id="8153862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153866">config</span><span class="op" id="8153872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153879">&amp;</span><span class="ident" id="8153880">config</span><span class="op" id="8153886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153890">expectAlert</span><span class="op" id="8153901">:</span>&nbsp;<span class="builtintype" id="8153903">true</span><span class="op" id="8153907">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8153910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8153913">runServerTestTLS12</span><span class="op" id="8153931">(</span><span class="ident" id="8153932">t</span><span class="op" id="8153933">,</span>&nbsp;<span class="ident" id="8153935">test</span><span class="op" id="8153939">)</span><br>
<span class="lineno"></span><span class="op" id="8153941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8153944">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="8154024">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8154098">func</span>&nbsp;<span class="ident" id="8154103">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="8154137">(</span><span class="ident" id="8154138">t</span>&nbsp;<span class="op" id="8154140">*</span><span class="ident" id="8154141">testing</span><span class="op" id="8154148">.</span><span class="ident" id="8154149">T</span><span class="op" id="8154150">)</span>&nbsp;<span class="op" id="8154152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154155">config</span>&nbsp;<span class="op" id="8154162">:=</span>&nbsp;<span class="op" id="8154165">*</span><span class="ident" id="8154166">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154178">config</span><span class="op" id="8154184">.</span><span class="ident" id="8154185">CipherSuites</span>&nbsp;<span class="op" id="8154198">=</span>&nbsp;<span class="op" id="8154200">[</span><span class="op" id="8154201">]</span><span class="builtintype" id="8154202">uint16</span><span class="op" id="8154208">{</span><span class="ident" id="8154209">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8154245">,</span>&nbsp;<span class="ident" id="8154247">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8154281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154284">config</span><span class="op" id="8154290">.</span><span class="ident" id="8154291">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8154316">=</span>&nbsp;<span class="builtintype" id="8154318">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154325">test</span>&nbsp;<span class="op" id="8154330">:=</span>&nbsp;<span class="op" id="8154333">&amp;</span><span class="ident" id="8154334">serverTest</span><span class="op" id="8154344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154348">name</span><span class="op" id="8154352">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8154356">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="8154386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154390">config</span><span class="op" id="8154396">:</span>&nbsp;<span class="op" id="8154398">&amp;</span><span class="ident" id="8154399">config</span><span class="op" id="8154405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8154408">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154411">runServerTestTLS12</span><span class="op" id="8154429">(</span><span class="ident" id="8154430">t</span><span class="op" id="8154431">,</span>&nbsp;<span class="ident" id="8154433">test</span><span class="op" id="8154437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154441">config</span>&nbsp;<span class="op" id="8154448">=</span>&nbsp;<span class="op" id="8154450">*</span><span class="ident" id="8154451">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154463">config</span><span class="op" id="8154469">.</span><span class="ident" id="8154470">CipherSuites</span>&nbsp;<span class="op" id="8154483">=</span>&nbsp;<span class="op" id="8154485">[</span><span class="op" id="8154486">]</span><span class="builtintype" id="8154487">uint16</span><span class="op" id="8154493">{</span><span class="ident" id="8154494">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8154528">,</span>&nbsp;<span class="ident" id="8154530">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8154566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154569">config</span><span class="op" id="8154575">.</span><span class="ident" id="8154576">Certificates</span>&nbsp;<span class="op" id="8154589">=</span>&nbsp;<span class="op" id="8154591">[</span><span class="op" id="8154592">]</span><span class="ident" id="8154593">Certificate</span><span class="op" id="8154604">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8154608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154613">Certificate</span><span class="op" id="8154624">:</span>&nbsp;<span class="op" id="8154626">[</span><span class="op" id="8154627">]</span><span class="op" id="8154628">[</span><span class="op" id="8154629">]</span><span class="builtintype" id="8154630">byte</span><span class="op" id="8154634">{</span><span class="ident" id="8154635">testECDSACertificate</span><span class="op" id="8154655">}</span><span class="op" id="8154656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154661">PrivateKey</span><span class="op" id="8154671">:</span>&nbsp;&nbsp;<span class="ident" id="8154674">testECDSAPrivateKey</span><span class="op" id="8154693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8154697">}</span><span class="op" id="8154698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8154701">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154704">config</span><span class="op" id="8154710">.</span><span class="ident" id="8154711">BuildNameToCertificate</span><span class="op" id="8154733">(</span><span class="op" id="8154734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154737">config</span><span class="op" id="8154743">.</span><span class="ident" id="8154744">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8154769">=</span>&nbsp;<span class="builtintype" id="8154771">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154778">test</span>&nbsp;<span class="op" id="8154783">=</span>&nbsp;<span class="op" id="8154785">&amp;</span><span class="ident" id="8154786">serverTest</span><span class="op" id="8154796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154800">name</span><span class="op" id="8154804">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8154808">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="8154840">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154844">config</span><span class="op" id="8154850">:</span>&nbsp;<span class="op" id="8154852">&amp;</span><span class="ident" id="8154853">config</span><span class="op" id="8154859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8154862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154865">runServerTestTLS12</span><span class="op" id="8154883">(</span><span class="ident" id="8154884">t</span><span class="op" id="8154885">,</span>&nbsp;<span class="ident" id="8154887">test</span><span class="op" id="8154891">)</span><br>
<span class="lineno"></span><span class="op" id="8154893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="8154896">func</span>&nbsp;<span class="ident" id="8154901">TestResumption</span><span class="op" id="8154915">(</span><span class="ident" id="8154916">t</span>&nbsp;<span class="op" id="8154918">*</span><span class="ident" id="8154919">testing</span><span class="op" id="8154926">.</span><span class="ident" id="8154927">T</span><span class="op" id="8154928">)</span>&nbsp;<span class="op" id="8154930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8154933">sessionFilePath</span>&nbsp;<span class="op" id="8154949">:=</span>&nbsp;<span class="ident" id="8154952">tempFile</span><span class="op" id="8154960">(</span><span class="string" id="8154961">&#34;&#34;</span><span class="op" id="8154963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8154966">defer</span>&nbsp;<span class="ident" id="8154972">os</span><span class="op" id="8154974">.</span><span class="ident" id="8154975">Remove</span><span class="op" id="8154981">(</span><span class="ident" id="8154982">sessionFilePath</span><span class="op" id="8154997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155001">test</span>&nbsp;<span class="op" id="8155006">:=</span>&nbsp;<span class="op" id="8155009">&amp;</span><span class="ident" id="8155010">serverTest</span><span class="op" id="8155020">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155024">name</span><span class="op" id="8155028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8155033">&#34;IssueTicket&#34;</span><span class="op" id="8155046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155050">command</span><span class="op" id="8155057">:</span>&nbsp;<span class="op" id="8155059">[</span><span class="op" id="8155060">]</span><span class="builtintype" id="8155061">string</span><span class="op" id="8155067">{</span><span class="string" id="8155068">&#34;openssl&#34;</span><span class="op" id="8155077">,</span>&nbsp;<span class="string" id="8155079">&#34;s_client&#34;</span><span class="op" id="8155089">,</span>&nbsp;<span class="string" id="8155091">&#34;-cipher&#34;</span><span class="op" id="8155100">,</span>&nbsp;<span class="string" id="8155102">&#34;RC4-SHA&#34;</span><span class="op" id="8155111">,</span>&nbsp;<span class="string" id="8155113">&#34;-sess_out&#34;</span><span class="op" id="8155124">,</span>&nbsp;<span class="ident" id="8155126">sessionFilePath</span><span class="op" id="8155141">}</span><span class="op" id="8155142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8155145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155148">runServerTestTLS12</span><span class="op" id="8155166">(</span><span class="ident" id="8155167">t</span><span class="op" id="8155168">,</span>&nbsp;<span class="ident" id="8155170">test</span><span class="op" id="8155174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155178">test</span>&nbsp;<span class="op" id="8155183">=</span>&nbsp;<span class="op" id="8155185">&amp;</span><span class="ident" id="8155186">serverTest</span><span class="op" id="8155196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155200">name</span><span class="op" id="8155204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8155209">&#34;Resume&#34;</span><span class="op" id="8155217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155221">command</span><span class="op" id="8155228">:</span>&nbsp;<span class="op" id="8155230">[</span><span class="op" id="8155231">]</span><span class="builtintype" id="8155232">string</span><span class="op" id="8155238">{</span><span class="string" id="8155239">&#34;openssl&#34;</span><span class="op" id="8155248">,</span>&nbsp;<span class="string" id="8155250">&#34;s_client&#34;</span><span class="op" id="8155260">,</span>&nbsp;<span class="string" id="8155262">&#34;-cipher&#34;</span><span class="op" id="8155271">,</span>&nbsp;<span class="string" id="8155273">&#34;RC4-SHA&#34;</span><span class="op" id="8155282">,</span>&nbsp;<span class="string" id="8155284">&#34;-sess_in&#34;</span><span class="op" id="8155294">,</span>&nbsp;<span class="ident" id="8155296">sessionFilePath</span><span class="op" id="8155311">}</span><span class="op" id="8155312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8155315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155318">runServerTestTLS12</span><span class="op" id="8155336">(</span><span class="ident" id="8155337">t</span><span class="op" id="8155338">,</span>&nbsp;<span class="ident" id="8155340">test</span><span class="op" id="8155344">)</span><br>
<span class="lineno">690</span><span class="op" id="8155346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8155349">func</span>&nbsp;<span class="ident" id="8155354">TestResumptionDisabled</span><span class="op" id="8155376">(</span><span class="ident" id="8155377">t</span>&nbsp;<span class="op" id="8155379">*</span><span class="ident" id="8155380">testing</span><span class="op" id="8155387">.</span><span class="ident" id="8155388">T</span><span class="op" id="8155389">)</span>&nbsp;<span class="op" id="8155391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155394">sessionFilePath</span>&nbsp;<span class="op" id="8155410">:=</span>&nbsp;<span class="ident" id="8155413">tempFile</span><span class="op" id="8155421">(</span><span class="string" id="8155422">&#34;&#34;</span><span class="op" id="8155424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8155427">defer</span>&nbsp;<span class="ident" id="8155433">os</span><span class="op" id="8155435">.</span><span class="ident" id="8155436">Remove</span><span class="op" id="8155442">(</span><span class="ident" id="8155443">sessionFilePath</span><span class="op" id="8155458">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155462">config</span>&nbsp;<span class="op" id="8155469">:=</span>&nbsp;<span class="op" id="8155472">*</span><span class="ident" id="8155473">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155486">test</span>&nbsp;<span class="op" id="8155491">:=</span>&nbsp;<span class="op" id="8155494">&amp;</span><span class="ident" id="8155495">serverTest</span><span class="op" id="8155505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155509">name</span><span class="op" id="8155513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8155518">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="8155541">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155545">command</span><span class="op" id="8155552">:</span>&nbsp;<span class="op" id="8155554">[</span><span class="op" id="8155555">]</span><span class="builtintype" id="8155556">string</span><span class="op" id="8155562">{</span><span class="string" id="8155563">&#34;openssl&#34;</span><span class="op" id="8155572">,</span>&nbsp;<span class="string" id="8155574">&#34;s_client&#34;</span><span class="op" id="8155584">,</span>&nbsp;<span class="string" id="8155586">&#34;-cipher&#34;</span><span class="op" id="8155595">,</span>&nbsp;<span class="string" id="8155597">&#34;RC4-SHA&#34;</span><span class="op" id="8155606">,</span>&nbsp;<span class="string" id="8155608">&#34;-sess_out&#34;</span><span class="op" id="8155619">,</span>&nbsp;<span class="ident" id="8155621">sessionFilePath</span><span class="op" id="8155636">}</span><span class="op" id="8155637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155641">config</span><span class="op" id="8155647">:</span>&nbsp;&nbsp;<span class="op" id="8155650">&amp;</span><span class="ident" id="8155651">config</span><span class="op" id="8155657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8155660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155663">runServerTestTLS12</span><span class="op" id="8155681">(</span><span class="ident" id="8155682">t</span><span class="op" id="8155683">,</span>&nbsp;<span class="ident" id="8155685">test</span><span class="op" id="8155689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155693">config</span><span class="op" id="8155699">.</span><span class="ident" id="8155700">SessionTicketsDisabled</span>&nbsp;<span class="op" id="8155723">=</span>&nbsp;<span class="builtintype" id="8155725">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155732">test</span>&nbsp;<span class="op" id="8155737">=</span>&nbsp;<span class="op" id="8155739">&amp;</span><span class="ident" id="8155740">serverTest</span><span class="op" id="8155750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155754">name</span><span class="op" id="8155758">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8155763">&#34;ResumeDisabled&#34;</span><span class="op" id="8155779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155783">command</span><span class="op" id="8155790">:</span>&nbsp;<span class="op" id="8155792">[</span><span class="op" id="8155793">]</span><span class="builtintype" id="8155794">string</span><span class="op" id="8155800">{</span><span class="string" id="8155801">&#34;openssl&#34;</span><span class="op" id="8155810">,</span>&nbsp;<span class="string" id="8155812">&#34;s_client&#34;</span><span class="op" id="8155822">,</span>&nbsp;<span class="string" id="8155824">&#34;-cipher&#34;</span><span class="op" id="8155833">,</span>&nbsp;<span class="string" id="8155835">&#34;RC4-SHA&#34;</span><span class="op" id="8155844">,</span>&nbsp;<span class="string" id="8155846">&#34;-sess_in&#34;</span><span class="op" id="8155856">,</span>&nbsp;<span class="ident" id="8155858">sessionFilePath</span><span class="op" id="8155873">}</span><span class="op" id="8155874">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155878">config</span><span class="op" id="8155884">:</span>&nbsp;&nbsp;<span class="op" id="8155887">&amp;</span><span class="ident" id="8155888">config</span><span class="op" id="8155894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8155897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8155900">runServerTestTLS12</span><span class="op" id="8155918">(</span><span class="ident" id="8155919">t</span><span class="op" id="8155920">,</span>&nbsp;<span class="ident" id="8155922">test</span><span class="op" id="8155926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8155930">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8156002">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="8156070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8156073">func</span>&nbsp;<span class="ident" id="8156078">TestFallbackSCSV</span><span class="op" id="8156094">(</span><span class="ident" id="8156095">t</span>&nbsp;<span class="op" id="8156097">*</span><span class="ident" id="8156098">testing</span><span class="op" id="8156105">.</span><span class="ident" id="8156106">T</span><span class="op" id="8156107">)</span>&nbsp;<span class="op" id="8156109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8156112">test</span>&nbsp;<span class="op" id="8156117">:=</span>&nbsp;<span class="op" id="8156120">&amp;</span><span class="ident" id="8156121">serverTest</span><span class="op" id="8156131">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8156135">name</span><span class="op" id="8156139">:</span>&nbsp;<span class="string" id="8156141">&#34;FallbackSCSV&#34;</span><span class="op" id="8156155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8156159">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8156220">command</span><span class="op" id="8156227">:</span>&nbsp;<span class="op" id="8156229">[</span><span class="op" id="8156230">]</span><span class="builtintype" id="8156231">string</span><span class="op" id="8156237">{</span><span class="string" id="8156238">&#34;openssl&#34;</span><span class="op" id="8156247">,</span>&nbsp;<span class="string" id="8156249">&#34;s_client&#34;</span><span class="op" id="8156259">,</span>&nbsp;<span class="string" id="8156261">&#34;-fallback_scsv&#34;</span><span class="op" id="8156277">}</span><span class="op" id="8156278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8156282">expectHandshakeErrorIncluding</span><span class="op" id="8156311">:</span>&nbsp;<span class="string" id="8156313">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="8156345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8156348">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8156351">runServerTestTLS11</span><span class="op" id="8156369">(</span><span class="ident" id="8156370">t</span><span class="op" id="8156371">,</span>&nbsp;<span class="ident" id="8156373">test</span><span class="op" id="8156377">)</span><br>
<span class="lineno"></span><span class="op" id="8156379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8156382">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="8156443">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="8156505">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8156541">const</span>&nbsp;<span class="ident" id="8156547">clientCertificatePEM</span>&nbsp;<span class="op" id="8156568">=</span>&nbsp;<span class="string" id="8156570">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8157303">const</span>&nbsp;<span class="ident" id="8157309">clientKeyPEM</span>&nbsp;<span class="op" id="8157322">=</span>&nbsp;<span class="string" id="8157324">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8158211">const</span>&nbsp;<span class="ident" id="8158217">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="8158243">=</span>&nbsp;<span class="string" id="8158245">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8158998">const</span>&nbsp;<span class="ident" id="8159004">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="8159022">=</span>&nbsp;<span class="string" id="8159024">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="8159464">func</span>&nbsp;<span class="ident" id="8159469">TestClientAuth</span><span class="op" id="8159483">(</span><span class="ident" id="8159484">t</span>&nbsp;<span class="op" id="8159486">*</span><span class="ident" id="8159487">testing</span><span class="op" id="8159494">.</span><span class="ident" id="8159495">T</span><span class="op" id="8159496">)</span>&nbsp;<span class="op" id="8159498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159501">var</span>&nbsp;<span class="ident" id="8159505">certPath</span><span class="op" id="8159513">,</span>&nbsp;<span class="ident" id="8159515">keyPath</span><span class="op" id="8159522">,</span>&nbsp;<span class="ident" id="8159524">ecdsaCertPath</span><span class="op" id="8159537">,</span>&nbsp;<span class="ident" id="8159539">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="8159552">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159561">if</span>&nbsp;<span class="op" id="8159564">*</span><span class="ident" id="8159565">update</span>&nbsp;<span class="op" id="8159572">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159576">certPath</span>&nbsp;<span class="op" id="8159585">=</span>&nbsp;<span class="ident" id="8159587">tempFile</span><span class="op" id="8159595">(</span><span class="ident" id="8159596">clientCertificatePEM</span><span class="op" id="8159616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159620">defer</span>&nbsp;<span class="ident" id="8159626">os</span><span class="op" id="8159628">.</span><span class="ident" id="8159629">Remove</span><span class="op" id="8159635">(</span><span class="ident" id="8159636">certPath</span><span class="op" id="8159644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159648">keyPath</span>&nbsp;<span class="op" id="8159656">=</span>&nbsp;<span class="ident" id="8159658">tempFile</span><span class="op" id="8159666">(</span><span class="ident" id="8159667">clientKeyPEM</span><span class="op" id="8159679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159683">defer</span>&nbsp;<span class="ident" id="8159689">os</span><span class="op" id="8159691">.</span><span class="ident" id="8159692">Remove</span><span class="op" id="8159698">(</span><span class="ident" id="8159699">keyPath</span><span class="op" id="8159706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159710">ecdsaCertPath</span>&nbsp;<span class="op" id="8159724">=</span>&nbsp;<span class="ident" id="8159726">tempFile</span><span class="op" id="8159734">(</span><span class="ident" id="8159735">clientECDSACertificatePEM</span><span class="op" id="8159760">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159764">defer</span>&nbsp;<span class="ident" id="8159770">os</span><span class="op" id="8159772">.</span><span class="ident" id="8159773">Remove</span><span class="op" id="8159779">(</span><span class="ident" id="8159780">ecdsaCertPath</span><span class="op" id="8159793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159797">ecdsaKeyPath</span>&nbsp;<span class="op" id="8159810">=</span>&nbsp;<span class="ident" id="8159812">tempFile</span><span class="op" id="8159820">(</span><span class="ident" id="8159821">clientECDSAKeyPEM</span><span class="op" id="8159838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8159842">defer</span>&nbsp;<span class="ident" id="8159848">os</span><span class="op" id="8159850">.</span><span class="ident" id="8159851">Remove</span><span class="op" id="8159857">(</span><span class="ident" id="8159858">ecdsaKeyPath</span><span class="op" id="8159870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8159873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159877">config</span>&nbsp;<span class="op" id="8159884">:=</span>&nbsp;<span class="op" id="8159887">*</span><span class="ident" id="8159888">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159900">config</span><span class="op" id="8159906">.</span><span class="ident" id="8159907">ClientAuth</span>&nbsp;<span class="op" id="8159918">=</span>&nbsp;<span class="ident" id="8159920">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159940">test</span>&nbsp;<span class="op" id="8159945">:=</span>&nbsp;<span class="op" id="8159948">&amp;</span><span class="ident" id="8159949">serverTest</span><span class="op" id="8159959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8159963">name</span><span class="op" id="8159967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8159972">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="8160001">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160005">command</span><span class="op" id="8160012">:</span>&nbsp;<span class="op" id="8160014">[</span><span class="op" id="8160015">]</span><span class="builtintype" id="8160016">string</span><span class="op" id="8160022">{</span><span class="string" id="8160023">&#34;openssl&#34;</span><span class="op" id="8160032">,</span>&nbsp;<span class="string" id="8160034">&#34;s_client&#34;</span><span class="op" id="8160044">,</span>&nbsp;<span class="string" id="8160046">&#34;-no_ticket&#34;</span><span class="op" id="8160058">,</span>&nbsp;<span class="string" id="8160060">&#34;-cipher&#34;</span><span class="op" id="8160069">,</span>&nbsp;<span class="string" id="8160071">&#34;RC4-SHA&#34;</span><span class="op" id="8160080">}</span><span class="op" id="8160081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160085">config</span><span class="op" id="8160091">:</span>&nbsp;&nbsp;<span class="op" id="8160094">&amp;</span><span class="ident" id="8160095">config</span><span class="op" id="8160101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8160104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160107">runServerTestTLS12</span><span class="op" id="8160125">(</span><span class="ident" id="8160126">t</span><span class="op" id="8160127">,</span>&nbsp;<span class="ident" id="8160129">test</span><span class="op" id="8160133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160137">test</span>&nbsp;<span class="op" id="8160142">=</span>&nbsp;<span class="op" id="8160144">&amp;</span><span class="ident" id="8160145">serverTest</span><span class="op" id="8160155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160159">name</span><span class="op" id="8160163">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160178">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="8160207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160211">command</span><span class="op" id="8160218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160230">[</span><span class="op" id="8160231">]</span><span class="builtintype" id="8160232">string</span><span class="op" id="8160238">{</span><span class="string" id="8160239">&#34;openssl&#34;</span><span class="op" id="8160248">,</span>&nbsp;<span class="string" id="8160250">&#34;s_client&#34;</span><span class="op" id="8160260">,</span>&nbsp;<span class="string" id="8160262">&#34;-no_ticket&#34;</span><span class="op" id="8160274">,</span>&nbsp;<span class="string" id="8160276">&#34;-cipher&#34;</span><span class="op" id="8160285">,</span>&nbsp;<span class="string" id="8160287">&#34;RC4-SHA&#34;</span><span class="op" id="8160296">,</span>&nbsp;<span class="string" id="8160298">&#34;-cert&#34;</span><span class="op" id="8160305">,</span>&nbsp;<span class="ident" id="8160307">certPath</span><span class="op" id="8160315">,</span>&nbsp;<span class="string" id="8160317">&#34;-key&#34;</span><span class="op" id="8160323">,</span>&nbsp;<span class="ident" id="8160325">keyPath</span><span class="op" id="8160332">}</span><span class="op" id="8160333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160337">config</span><span class="op" id="8160343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160356">&amp;</span><span class="ident" id="8160357">config</span><span class="op" id="8160363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160367">expectedPeerCerts</span><span class="op" id="8160384">:</span>&nbsp;<span class="op" id="8160386">[</span><span class="op" id="8160387">]</span><span class="builtintype" id="8160388">string</span><span class="op" id="8160394">{</span><span class="ident" id="8160395">clientCertificatePEM</span><span class="op" id="8160415">}</span><span class="op" id="8160416">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8160419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160422">runServerTestTLS12</span><span class="op" id="8160440">(</span><span class="ident" id="8160441">t</span><span class="op" id="8160442">,</span>&nbsp;<span class="ident" id="8160444">test</span><span class="op" id="8160448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160452">test</span>&nbsp;<span class="op" id="8160457">=</span>&nbsp;<span class="op" id="8160459">&amp;</span><span class="ident" id="8160460">serverTest</span><span class="op" id="8160470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160474">name</span><span class="op" id="8160478">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160493">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="8160527">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160531">command</span><span class="op" id="8160538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160550">[</span><span class="op" id="8160551">]</span><span class="builtintype" id="8160552">string</span><span class="op" id="8160558">{</span><span class="string" id="8160559">&#34;openssl&#34;</span><span class="op" id="8160568">,</span>&nbsp;<span class="string" id="8160570">&#34;s_client&#34;</span><span class="op" id="8160580">,</span>&nbsp;<span class="string" id="8160582">&#34;-no_ticket&#34;</span><span class="op" id="8160594">,</span>&nbsp;<span class="string" id="8160596">&#34;-cipher&#34;</span><span class="op" id="8160605">,</span>&nbsp;<span class="string" id="8160607">&#34;RC4-SHA&#34;</span><span class="op" id="8160616">,</span>&nbsp;<span class="string" id="8160618">&#34;-cert&#34;</span><span class="op" id="8160625">,</span>&nbsp;<span class="ident" id="8160627">ecdsaCertPath</span><span class="op" id="8160640">,</span>&nbsp;<span class="string" id="8160642">&#34;-key&#34;</span><span class="op" id="8160648">,</span>&nbsp;<span class="ident" id="8160650">ecdsaKeyPath</span><span class="op" id="8160662">}</span><span class="op" id="8160663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160667">config</span><span class="op" id="8160673">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160686">&amp;</span><span class="ident" id="8160687">config</span><span class="op" id="8160693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160697">expectedPeerCerts</span><span class="op" id="8160714">:</span>&nbsp;<span class="op" id="8160716">[</span><span class="op" id="8160717">]</span><span class="builtintype" id="8160718">string</span><span class="op" id="8160724">{</span><span class="ident" id="8160725">clientECDSACertificatePEM</span><span class="op" id="8160750">}</span><span class="op" id="8160751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8160754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160757">runServerTestTLS12</span><span class="op" id="8160775">(</span><span class="ident" id="8160776">t</span><span class="op" id="8160777">,</span>&nbsp;<span class="ident" id="8160779">test</span><span class="op" id="8160783">)</span><br>
<span class="lineno">830</span><span class="op" id="8160785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160788">func</span>&nbsp;<span class="ident" id="8160793">bigFromString</span><span class="op" id="8160806">(</span><span class="ident" id="8160807">s</span>&nbsp;<span class="builtintype" id="8160809">string</span><span class="op" id="8160815">)</span>&nbsp;<span class="op" id="8160817">*</span><span class="ident" id="8160818">big</span><span class="op" id="8160821">.</span><span class="ident" id="8160822">Int</span>&nbsp;<span class="op" id="8160826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160829">ret</span>&nbsp;<span class="op" id="8160833">:=</span>&nbsp;<span class="builtinfunc" id="8160836">new</span><span class="op" id="8160839">(</span><span class="ident" id="8160840">big</span><span class="op" id="8160843">.</span><span class="ident" id="8160844">Int</span><span class="op" id="8160847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160850">ret</span><span class="op" id="8160853">.</span><span class="ident" id="8160854">SetString</span><span class="op" id="8160863">(</span><span class="ident" id="8160864">s</span><span class="op" id="8160865">,</span>&nbsp;<span class="num" id="8160867">10</span><span class="op" id="8160869">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8160872">return</span>&nbsp;<span class="ident" id="8160879">ret</span><br>
<span class="lineno"></span><span class="op" id="8160883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160886">func</span>&nbsp;<span class="ident" id="8160891">fromHex</span><span class="op" id="8160898">(</span><span class="ident" id="8160899">s</span>&nbsp;<span class="builtintype" id="8160901">string</span><span class="op" id="8160907">)</span>&nbsp;<span class="op" id="8160909">[</span><span class="op" id="8160910">]</span><span class="builtintype" id="8160911">byte</span>&nbsp;<span class="op" id="8160916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160919">b</span><span class="op" id="8160920">,</span>&nbsp;<span class="ident" id="8160922">_</span>&nbsp;<span class="op" id="8160924">:=</span>&nbsp;<span class="ident" id="8160927">hex</span><span class="op" id="8160930">.</span><span class="ident" id="8160931">DecodeString</span><span class="op" id="8160943">(</span><span class="ident" id="8160944">s</span><span class="op" id="8160945">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8160948">return</span>&nbsp;<span class="ident" id="8160955">b</span><br>
<span class="lineno"></span><span class="op" id="8160957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160960">var</span>&nbsp;<span class="ident" id="8160964">testRSACertificate</span>&nbsp;<span class="op" id="8160983">=</span>&nbsp;<span class="ident" id="8160985">fromHex</span><span class="op" id="8160992">(</span><span class="string" id="8160993">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="8162379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="8162382">var</span>&nbsp;<span class="ident" id="8162386">testECDSACertificate</span>&nbsp;<span class="op" id="8162407">=</span>&nbsp;<span class="ident" id="8162409">fromHex</span><span class="op" id="8162416">(</span><span class="string" id="8162417">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="8163451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163454">var</span>&nbsp;<span class="ident" id="8163458">testSNICertificate</span>&nbsp;<span class="op" id="8163477">=</span>&nbsp;<span class="ident" id="8163479">fromHex</span><span class="op" id="8163486">(</span><span class="string" id="8163487">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="8164493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8164496">var</span>&nbsp;<span class="ident" id="8164500">testRSAPrivateKey</span>&nbsp;<span class="op" id="8164518">=</span>&nbsp;<span class="op" id="8164520">&amp;</span><span class="ident" id="8164521">rsa</span><span class="op" id="8164524">.</span><span class="ident" id="8164525">PrivateKey</span><span class="op" id="8164535">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164538">PublicKey</span><span class="op" id="8164547">:</span>&nbsp;<span class="ident" id="8164549">rsa</span><span class="op" id="8164552">.</span><span class="ident" id="8164553">PublicKey</span><span class="op" id="8164562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164566">N</span><span class="op" id="8164567">:</span>&nbsp;<span class="ident" id="8164569">bigFromString</span><span class="op" id="8164582">(</span><span class="string" id="8164583">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="8164894">)</span><span class="op" id="8164895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164899">E</span><span class="op" id="8164900">:</span>&nbsp;<span class="num" id="8164902">65537</span><span class="op" id="8164907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164910">}</span><span class="op" id="8164911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164914">D</span><span class="op" id="8164915">:</span>&nbsp;<span class="ident" id="8164917">bigFromString</span><span class="op" id="8164930">(</span><span class="string" id="8164931">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="8165241">)</span><span class="op" id="8165242">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165245">Primes</span><span class="op" id="8165251">:</span>&nbsp;<span class="op" id="8165253">[</span><span class="op" id="8165254">]</span><span class="op" id="8165255">*</span><span class="ident" id="8165256">big</span><span class="op" id="8165259">.</span><span class="ident" id="8165260">Int</span><span class="op" id="8165263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165267">bigFromString</span><span class="op" id="8165280">(</span><span class="string" id="8165281">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="8165438">)</span><span class="op" id="8165439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165443">bigFromString</span><span class="op" id="8165456">(</span><span class="string" id="8165457">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="8165614">)</span><span class="op" id="8165615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165618">}</span><span class="op" id="8165619">,</span><br>
<span class="lineno"></span><span class="op" id="8165621">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="8165624">var</span>&nbsp;<span class="ident" id="8165628">testECDSAPrivateKey</span>&nbsp;<span class="op" id="8165648">=</span>&nbsp;<span class="op" id="8165650">&amp;</span><span class="ident" id="8165651">ecdsa</span><span class="op" id="8165656">.</span><span class="ident" id="8165657">PrivateKey</span><span class="op" id="8165667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165670">PublicKey</span><span class="op" id="8165679">:</span>&nbsp;<span class="ident" id="8165681">ecdsa</span><span class="op" id="8165686">.</span><span class="ident" id="8165687">PublicKey</span><span class="op" id="8165696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165700">Curve</span><span class="op" id="8165705">:</span>&nbsp;<span class="ident" id="8165707">elliptic</span><span class="op" id="8165715">.</span><span class="ident" id="8165716">P521</span><span class="op" id="8165720">(</span><span class="op" id="8165721">)</span><span class="op" id="8165722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165726">X</span><span class="op" id="8165727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165733">bigFromString</span><span class="op" id="8165746">(</span><span class="string" id="8165747">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="8165906">)</span><span class="op" id="8165907">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165911">Y</span><span class="op" id="8165912">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165918">bigFromString</span><span class="op" id="8165931">(</span><span class="string" id="8165932">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="8166091">)</span><span class="op" id="8166092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166095">}</span><span class="op" id="8166096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166099">D</span><span class="op" id="8166100">:</span>&nbsp;<span class="ident" id="8166102">bigFromString</span><span class="op" id="8166115">(</span><span class="string" id="8166116">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="8166275">)</span><span class="op" id="8166276">,</span><br>
<span class="lineno"></span><span class="op" id="8166278">}</span>
</div>
</body>
</html>
