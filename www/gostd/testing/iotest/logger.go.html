<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5792586">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5792641">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5792695">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5792746">package</span>&nbsp;<span class="ident" id="5792754">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5792762">import</span>&nbsp;<span class="op" id="5792769">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5792772">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5792778">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5792784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5792787">type</span>&nbsp;<span class="ident" id="5792792">writeLogger</span>&nbsp;<span class="keyword" id="5792804">struct</span>&nbsp;<span class="op" id="5792811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5792814">prefix</span>&nbsp;<span class="builtintype" id="5792821">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5792829">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5792836">io</span><span class="op" id="5792838">.</span><span class="ident" id="5792839">Writer</span><br>
<span class="lineno">15</span><span class="op" id="5792846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5792849">func</span>&nbsp;<span class="op" id="5792854">(</span><span class="ident" id="5792855">l</span>&nbsp;<span class="op" id="5792857">*</span><span class="ident" id="5792858">writeLogger</span><span class="op" id="5792869">)</span>&nbsp;<span class="ident" id="5792871">Write</span><span class="op" id="5792876">(</span><span class="ident" id="5792877">p</span>&nbsp;<span class="op" id="5792879">[</span><span class="op" id="5792880">]</span><span class="builtintype" id="5792881">byte</span><span class="op" id="5792885">)</span>&nbsp;<span class="op" id="5792887">(</span><span class="ident" id="5792888">n</span>&nbsp;<span class="builtintype" id="5792890">int</span><span class="op" id="5792893">,</span>&nbsp;<span class="ident" id="5792895">err</span>&nbsp;<span class="builtintype" id="5792899">error</span><span class="op" id="5792904">)</span>&nbsp;<span class="op" id="5792906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5792909">n</span><span class="op" id="5792910">,</span>&nbsp;<span class="ident" id="5792912">err</span>&nbsp;<span class="op" id="5792916">=</span>&nbsp;<span class="ident" id="5792918">l</span><span class="op" id="5792919">.</span><span class="ident" id="5792920">w</span><span class="op" id="5792921">.</span><span class="ident" id="5792922">Write</span><span class="op" id="5792927">(</span><span class="ident" id="5792928">p</span><span class="op" id="5792929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5792932">if</span>&nbsp;<span class="ident" id="5792935">err</span>&nbsp;<span class="op" id="5792939">!=</span>&nbsp;<span class="ident" id="5792942">nil</span>&nbsp;<span class="op" id="5792946">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5792950">log</span><span class="op" id="5792953">.</span><span class="ident" id="5792954">Printf</span><span class="op" id="5792960">(</span><span class="string" id="5792961">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5792972">,</span>&nbsp;<span class="ident" id="5792974">l</span><span class="op" id="5792975">.</span><span class="ident" id="5792976">prefix</span><span class="op" id="5792982">,</span>&nbsp;<span class="ident" id="5792984">p</span><span class="op" id="5792985">[</span><span class="num" id="5792986">0</span><span class="op" id="5792987">:</span><span class="ident" id="5792988">n</span><span class="op" id="5792989">]</span><span class="op" id="5792990">,</span>&nbsp;<span class="ident" id="5792992">err</span><span class="op" id="5792995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5792998">}</span>&nbsp;<span class="keyword" id="5793000">else</span>&nbsp;<span class="op" id="5793005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793009">log</span><span class="op" id="5793012">.</span><span class="ident" id="5793013">Printf</span><span class="op" id="5793019">(</span><span class="string" id="5793020">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5793027">,</span>&nbsp;<span class="ident" id="5793029">l</span><span class="op" id="5793030">.</span><span class="ident" id="5793031">prefix</span><span class="op" id="5793037">,</span>&nbsp;<span class="ident" id="5793039">p</span><span class="op" id="5793040">[</span><span class="num" id="5793041">0</span><span class="op" id="5793042">:</span><span class="ident" id="5793043">n</span><span class="op" id="5793044">]</span><span class="op" id="5793045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5793048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5793051">return</span><br>
<span class="lineno">25</span><span class="op" id="5793058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5793061">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="5793123">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5793188">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="5793245">func</span>&nbsp;<span class="ident" id="5793250">NewWriteLogger</span><span class="op" id="5793264">(</span><span class="ident" id="5793265">prefix</span>&nbsp;<span class="builtintype" id="5793272">string</span><span class="op" id="5793278">,</span>&nbsp;<span class="ident" id="5793280">w</span>&nbsp;<span class="ident" id="5793282">io</span><span class="op" id="5793284">.</span><span class="ident" id="5793285">Writer</span><span class="op" id="5793291">)</span>&nbsp;<span class="ident" id="5793293">io</span><span class="op" id="5793295">.</span><span class="ident" id="5793296">Writer</span>&nbsp;<span class="op" id="5793303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5793306">return</span>&nbsp;<span class="op" id="5793313">&amp;</span><span class="ident" id="5793314">writeLogger</span><span class="op" id="5793325">{</span><span class="ident" id="5793326">prefix</span><span class="op" id="5793332">,</span>&nbsp;<span class="ident" id="5793334">w</span><span class="op" id="5793335">}</span><br>
<span class="lineno"></span><span class="op" id="5793337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793340">type</span>&nbsp;<span class="ident" id="5793345">readLogger</span>&nbsp;<span class="keyword" id="5793356">struct</span>&nbsp;<span class="op" id="5793363">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793366">prefix</span>&nbsp;<span class="builtintype" id="5793373">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793381">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793388">io</span><span class="op" id="5793390">.</span><span class="ident" id="5793391">Reader</span><br>
<span class="lineno"></span><span class="op" id="5793398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793401">func</span>&nbsp;<span class="op" id="5793406">(</span><span class="ident" id="5793407">l</span>&nbsp;<span class="op" id="5793409">*</span><span class="ident" id="5793410">readLogger</span><span class="op" id="5793420">)</span>&nbsp;<span class="ident" id="5793422">Read</span><span class="op" id="5793426">(</span><span class="ident" id="5793427">p</span>&nbsp;<span class="op" id="5793429">[</span><span class="op" id="5793430">]</span><span class="builtintype" id="5793431">byte</span><span class="op" id="5793435">)</span>&nbsp;<span class="op" id="5793437">(</span><span class="ident" id="5793438">n</span>&nbsp;<span class="builtintype" id="5793440">int</span><span class="op" id="5793443">,</span>&nbsp;<span class="ident" id="5793445">err</span>&nbsp;<span class="builtintype" id="5793449">error</span><span class="op" id="5793454">)</span>&nbsp;<span class="op" id="5793456">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793459">n</span><span class="op" id="5793460">,</span>&nbsp;<span class="ident" id="5793462">err</span>&nbsp;<span class="op" id="5793466">=</span>&nbsp;<span class="ident" id="5793468">l</span><span class="op" id="5793469">.</span><span class="ident" id="5793470">r</span><span class="op" id="5793471">.</span><span class="ident" id="5793472">Read</span><span class="op" id="5793476">(</span><span class="ident" id="5793477">p</span><span class="op" id="5793478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5793481">if</span>&nbsp;<span class="ident" id="5793484">err</span>&nbsp;<span class="op" id="5793488">!=</span>&nbsp;<span class="ident" id="5793491">nil</span>&nbsp;<span class="op" id="5793495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793499">log</span><span class="op" id="5793502">.</span><span class="ident" id="5793503">Printf</span><span class="op" id="5793509">(</span><span class="string" id="5793510">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5793521">,</span>&nbsp;<span class="ident" id="5793523">l</span><span class="op" id="5793524">.</span><span class="ident" id="5793525">prefix</span><span class="op" id="5793531">,</span>&nbsp;<span class="ident" id="5793533">p</span><span class="op" id="5793534">[</span><span class="num" id="5793535">0</span><span class="op" id="5793536">:</span><span class="ident" id="5793537">n</span><span class="op" id="5793538">]</span><span class="op" id="5793539">,</span>&nbsp;<span class="ident" id="5793541">err</span><span class="op" id="5793544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5793547">}</span>&nbsp;<span class="keyword" id="5793549">else</span>&nbsp;<span class="op" id="5793554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793558">log</span><span class="op" id="5793561">.</span><span class="ident" id="5793562">Printf</span><span class="op" id="5793568">(</span><span class="string" id="5793569">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5793576">,</span>&nbsp;<span class="ident" id="5793578">l</span><span class="op" id="5793579">.</span><span class="ident" id="5793580">prefix</span><span class="op" id="5793586">,</span>&nbsp;<span class="ident" id="5793588">p</span><span class="op" id="5793589">[</span><span class="num" id="5793590">0</span><span class="op" id="5793591">:</span><span class="ident" id="5793592">n</span><span class="op" id="5793593">]</span><span class="op" id="5793594">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5793597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5793600">return</span><br>
<span class="lineno"></span><span class="op" id="5793607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5793610">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="5793671">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5793734">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="5793791">func</span>&nbsp;<span class="ident" id="5793796">NewReadLogger</span><span class="op" id="5793809">(</span><span class="ident" id="5793810">prefix</span>&nbsp;<span class="builtintype" id="5793817">string</span><span class="op" id="5793823">,</span>&nbsp;<span class="ident" id="5793825">r</span>&nbsp;<span class="ident" id="5793827">io</span><span class="op" id="5793829">.</span><span class="ident" id="5793830">Reader</span><span class="op" id="5793836">)</span>&nbsp;<span class="ident" id="5793838">io</span><span class="op" id="5793840">.</span><span class="ident" id="5793841">Reader</span>&nbsp;<span class="op" id="5793848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5793851">return</span>&nbsp;<span class="op" id="5793858">&amp;</span><span class="ident" id="5793859">readLogger</span><span class="op" id="5793869">{</span><span class="ident" id="5793870">prefix</span><span class="op" id="5793876">,</span>&nbsp;<span class="ident" id="5793878">r</span><span class="op" id="5793879">}</span><br>
<span class="lineno"></span><span class="op" id="5793881">}</span>
</div>
</body>
</html>
