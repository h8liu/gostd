<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html" class="current">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1331703">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1331758">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1331812">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1331863">//&nbsp;Package&nbsp;bzip2&nbsp;implements&nbsp;bzip2&nbsp;decompression.</span><br>
<span class="lineno"></span><span class="keyword" id="1331912">package</span>&nbsp;<span class="ident" id="1331920">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1331927">import</span>&nbsp;<span class="string" id="1331934">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="1331940">//&nbsp;There&#39;s&nbsp;no&nbsp;RFC&nbsp;for&nbsp;bzip2.&nbsp;I&nbsp;used&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for&nbsp;reference&nbsp;and&nbsp;a&nbsp;lot</span><br>
<span class="lineno"></span><span class="comment" id="1332019">//&nbsp;of&nbsp;guessing:&nbsp;http://en.wikipedia.org/wiki/Bzip2</span><br>
<span class="lineno"></span><span class="comment" id="1332070">//&nbsp;The&nbsp;source&nbsp;code&nbsp;to&nbsp;pyflate&nbsp;was&nbsp;useful&nbsp;for&nbsp;debugging:</span><br>
<span class="lineno"></span><span class="comment" id="1332126">//&nbsp;http://www.paul.sladen.org/projects/pyflate</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1332174">//&nbsp;A&nbsp;StructuralError&nbsp;is&nbsp;returned&nbsp;when&nbsp;the&nbsp;bzip2&nbsp;data&nbsp;is&nbsp;found&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1332242">//&nbsp;syntactically&nbsp;invalid.</span><br>
<span class="lineno"></span><span class="keyword" id="1332268">type</span>&nbsp;<span class="ident" id="1332273">StructuralError</span>&nbsp;<span class="builtintype" id="1332289">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1332297">func</span>&nbsp;<span class="op" id="1332302">(</span><span class="ident" id="1332303">s</span>&nbsp;<span class="ident" id="1332305"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1332320">)</span>&nbsp;<span class="ident" id="1332322">Error</span><span class="op" id="1332327">(</span><span class="op" id="1332328">)</span>&nbsp;<span class="builtintype" id="1332330">string</span>&nbsp;<span class="op" id="1332337">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1332340">return</span>&nbsp;<span class="string" id="1332347">&#34;bzip2&nbsp;data&nbsp;invalid:&nbsp;&#34;</span>&nbsp;<span class="op" id="1332370">+</span>&nbsp;<span class="builtintype" id="1332372">string</span><span class="op" id="1332378">(</span><span class="ident" id="1332379"><a href="/gostd/compress/bzip2/bzip2.go.html#1332303">s</a></span><span class="op" id="1332380">)</span><br>
<span class="lineno"></span><span class="op" id="1332382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1332385">//&nbsp;A&nbsp;reader&nbsp;decompresses&nbsp;bzip2&nbsp;compressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1332433">type</span>&nbsp;<span class="ident" id="1332438">reader</span>&nbsp;<span class="keyword" id="1332445">struct</span>&nbsp;<span class="op" id="1332452">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332455">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332468"><a href="/gostd/compress/bzip2/bit_reader.go.html#1329987">bitReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332479">fileCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332492">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332500">blockCRC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332513">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332521">wantBlockCRC</span>&nbsp;<span class="builtintype" id="1332534">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332542">setupDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332555">bool</span>&nbsp;<span class="comment" id="1332560">//&nbsp;true&nbsp;if&nbsp;we&nbsp;have&nbsp;parsed&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332605">blockSize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332618">int</span>&nbsp;&nbsp;<span class="comment" id="1332623">//&nbsp;blockSize&nbsp;in&nbsp;bytes,&nbsp;i.e.&nbsp;900&nbsp;*&nbsp;1024.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332664">eof</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332677">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332683">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332696">[</span><span class="op" id="1332697">]</span><span class="builtintype" id="1332698">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332706">//&nbsp;stores&nbsp;Burrows-Wheeler&nbsp;transformed&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332751">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332764">[</span><span class="num" id="1332765">256</span><span class="op" id="1332768">]</span><span class="builtintype" id="1332769">uint</span>&nbsp;<span class="comment" id="1332774">//&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;for&nbsp;the&nbsp;inverse&nbsp;BWT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332813">tt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332826">[</span><span class="op" id="1332827">]</span><span class="builtintype" id="1332828">uint32</span>&nbsp;&nbsp;<span class="comment" id="1332836">//&nbsp;mirrors&nbsp;the&nbsp;`tt&#39;&nbsp;array&nbsp;in&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;and&nbsp;contains&nbsp;the&nbsp;P&nbsp;array&nbsp;in&nbsp;the&nbsp;upper&nbsp;24&nbsp;bits.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332930">tPos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1332943">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332953">//&nbsp;Index&nbsp;of&nbsp;the&nbsp;next&nbsp;output&nbsp;byte&nbsp;in&nbsp;tt.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332995">preRLE</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333007">[</span><span class="op" id="1333008">]</span><span class="builtintype" id="1333009">uint32</span>&nbsp;<span class="comment" id="1333016">//&nbsp;contains&nbsp;the&nbsp;RLE&nbsp;data&nbsp;still&nbsp;to&nbsp;be&nbsp;processed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333065">preRLEUsed</span>&nbsp;&nbsp;<span class="builtintype" id="1333077">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333086">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;of&nbsp;preRLE&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333124">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1333136">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333145">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;value&nbsp;seen.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333175">byteRepeats</span>&nbsp;<span class="builtintype" id="1333187">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333196">//&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;lastByte&nbsp;seen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333240">repeats</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1333252">uint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1333261">//&nbsp;the&nbsp;number&nbsp;of&nbsp;copies&nbsp;of&nbsp;lastByte&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="op" id="1333308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333311">//&nbsp;NewReader&nbsp;returns&nbsp;an&nbsp;io.Reader&nbsp;which&nbsp;decompresses&nbsp;bzip2&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">45</span><span class="comment" id="1333383">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="1333430">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="1333492">func</span>&nbsp;<span class="ident" id="1333497">NewReader</span><span class="op" id="1333506">(</span><span class="ident" id="1333507">r</span>&nbsp;<span class="ident" id="1333509"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1333511">.</span><span class="ident" id="1333512"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="1333518">)</span>&nbsp;<span class="ident" id="1333520"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1333522">.</span><span class="ident" id="1333523"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="1333530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333533">bz2</span>&nbsp;<span class="op" id="1333537">:=</span>&nbsp;<span class="builtinfunc" id="1333540">new</span><span class="op" id="1333543">(</span><span class="ident" id="1333544"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1333550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333553"><a href="/gostd/compress/bzip2/bzip2.go.html#1333533">bz2</a></span><span class="op" id="1333556">.</span><span class="ident" id="1333557"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span>&nbsp;<span class="op" id="1333560">=</span>&nbsp;<span class="ident" id="1333562"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330208">newBitReader</a></span><span class="op" id="1333574">(</span><span class="ident" id="1333575"><a href="/gostd/compress/bzip2/bzip2.go.html#1333507">r</a></span><span class="op" id="1333576">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333579">return</span>&nbsp;<span class="ident" id="1333586"><a href="/gostd/compress/bzip2/bzip2.go.html#1333533">bz2</a></span><br>
<span class="lineno"></span><span class="op" id="1333590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1333593">const</span>&nbsp;<span class="ident" id="1333599">bzip2FileMagic</span>&nbsp;<span class="op" id="1333614">=</span>&nbsp;<span class="num" id="1333616">0x425a</span>&nbsp;<span class="comment" id="1333623">//&nbsp;&#34;BZ&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="1333631">const</span>&nbsp;<span class="ident" id="1333637">bzip2BlockMagic</span>&nbsp;<span class="op" id="1333653">=</span>&nbsp;<span class="num" id="1333655">0x314159265359</span><br>
<span class="lineno">55</span><span class="keyword" id="1333670">const</span>&nbsp;<span class="ident" id="1333676">bzip2FinalMagic</span>&nbsp;<span class="op" id="1333692">=</span>&nbsp;<span class="num" id="1333694">0x177245385090</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333710">//&nbsp;setup&nbsp;parses&nbsp;the&nbsp;bzip2&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="1333744">func</span>&nbsp;<span class="op" id="1333749">(</span><span class="ident" id="1333750">bz2</span>&nbsp;<span class="op" id="1333754">*</span><span class="ident" id="1333755"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1333761">)</span>&nbsp;<span class="ident" id="1333763">setup</span><span class="op" id="1333768">(</span><span class="ident" id="1333769">needMagic</span>&nbsp;<span class="builtintype" id="1333779">bool</span><span class="op" id="1333783">)</span>&nbsp;<span class="builtintype" id="1333785">error</span>&nbsp;<span class="op" id="1333791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333794">br</span>&nbsp;<span class="op" id="1333797">:=</span>&nbsp;<span class="op" id="1333800">&amp;</span><span class="ident" id="1333801"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1333804">.</span><span class="ident" id="1333805"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333810">if</span>&nbsp;<span class="ident" id="1333813"><a href="/gostd/compress/bzip2/bzip2.go.html#1333769">needMagic</a></span>&nbsp;<span class="op" id="1333823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333827">magic</span>&nbsp;<span class="op" id="1333833">:=</span>&nbsp;<span class="ident" id="1333836"><a href="/gostd/compress/bzip2/bzip2.go.html#1333794">br</a></span><span class="op" id="1333838">.</span><span class="ident" id="1333839"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1333847">(</span><span class="num" id="1333848">16</span><span class="op" id="1333850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333854">if</span>&nbsp;<span class="ident" id="1333857"><a href="/gostd/compress/bzip2/bzip2.go.html#1333827">magic</a></span>&nbsp;<span class="op" id="1333863">!=</span>&nbsp;<span class="ident" id="1333866"><a href="/gostd/compress/bzip2/bzip2.go.html#1333599">bzip2FileMagic</a></span>&nbsp;<span class="op" id="1333881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333886">return</span>&nbsp;<span class="ident" id="1333893"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1333908">(</span><span class="string" id="1333909">&#34;bad&nbsp;magic&nbsp;value&#34;</span><span class="op" id="1333926">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1333933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1333937">t</span>&nbsp;<span class="op" id="1333939">:=</span>&nbsp;<span class="ident" id="1333942"><a href="/gostd/compress/bzip2/bzip2.go.html#1333794">br</a></span><span class="op" id="1333944">.</span><span class="ident" id="1333945"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1333953">(</span><span class="num" id="1333954">8</span><span class="op" id="1333955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333958">if</span>&nbsp;<span class="ident" id="1333961"><a href="/gostd/compress/bzip2/bzip2.go.html#1333937">t</a></span>&nbsp;<span class="op" id="1333963">!=</span>&nbsp;<span class="string" id="1333966">&#39;h&#39;</span>&nbsp;<span class="op" id="1333970">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1333974">return</span>&nbsp;<span class="ident" id="1333981"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1333996">(</span><span class="string" id="1333997">&#34;non-Huffman&nbsp;entropy&nbsp;encoding&#34;</span><span class="op" id="1334027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334034">level</span>&nbsp;<span class="op" id="1334040">:=</span>&nbsp;<span class="ident" id="1334043"><a href="/gostd/compress/bzip2/bzip2.go.html#1333794">br</a></span><span class="op" id="1334045">.</span><span class="ident" id="1334046"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1334054">(</span><span class="num" id="1334055">8</span><span class="op" id="1334056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334059">if</span>&nbsp;<span class="ident" id="1334062"><a href="/gostd/compress/bzip2/bzip2.go.html#1334034">level</a></span>&nbsp;<span class="op" id="1334068">&lt;</span>&nbsp;<span class="string" id="1334070">&#39;1&#39;</span>&nbsp;<span class="op" id="1334074">||</span>&nbsp;<span class="ident" id="1334077"><a href="/gostd/compress/bzip2/bzip2.go.html#1334034">level</a></span>&nbsp;<span class="op" id="1334083">&gt;</span>&nbsp;<span class="string" id="1334085">&#39;9&#39;</span>&nbsp;<span class="op" id="1334089">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334093">return</span>&nbsp;<span class="ident" id="1334100"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1334115">(</span><span class="string" id="1334116">&#34;invalid&nbsp;compression&nbsp;level&#34;</span><span class="op" id="1334143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334150"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334153">.</span><span class="ident" id="1334154"><a href="/gostd/compress/bzip2/bzip2.go.html#1332479">fileCRC</a></span>&nbsp;<span class="op" id="1334162">=</span>&nbsp;<span class="num" id="1334164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334167"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334170">.</span><span class="ident" id="1334171"><a href="/gostd/compress/bzip2/bzip2.go.html#1332605">blockSize</a></span>&nbsp;<span class="op" id="1334181">=</span>&nbsp;<span class="num" id="1334183">100</span>&nbsp;<span class="op" id="1334187">*</span>&nbsp;<span class="num" id="1334189">1024</span>&nbsp;<span class="op" id="1334194">*</span>&nbsp;<span class="op" id="1334196">(</span><span class="builtintype" id="1334197">int</span><span class="op" id="1334200">(</span><span class="ident" id="1334201"><a href="/gostd/compress/bzip2/bzip2.go.html#1334034">level</a></span><span class="op" id="1334206">)</span>&nbsp;<span class="op" id="1334208">-</span>&nbsp;<span class="string" id="1334210">&#39;0&#39;</span><span class="op" id="1334213">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334216">if</span>&nbsp;<span class="ident" id="1334219"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334222">.</span><span class="ident" id="1334223"><a href="/gostd/compress/bzip2/bzip2.go.html#1332605">blockSize</a></span>&nbsp;<span class="op" id="1334233">&gt;</span>&nbsp;<span class="builtinfunc" id="1334235">len</span><span class="op" id="1334238">(</span><span class="ident" id="1334239"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334242">.</span><span class="ident" id="1334243"><a href="/gostd/compress/bzip2/bzip2.go.html#1332813">tt</a></span><span class="op" id="1334245">)</span>&nbsp;<span class="op" id="1334247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334251"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334254">.</span><span class="ident" id="1334255"><a href="/gostd/compress/bzip2/bzip2.go.html#1332813">tt</a></span>&nbsp;<span class="op" id="1334258">=</span>&nbsp;<span class="builtinfunc" id="1334260">make</span><span class="op" id="1334264">(</span><span class="op" id="1334265">[</span><span class="op" id="1334266">]</span><span class="builtintype" id="1334267">uint32</span><span class="op" id="1334273">,</span>&nbsp;<span class="ident" id="1334275"><a href="/gostd/compress/bzip2/bzip2.go.html#1333750">bz2</a></span><span class="op" id="1334278">.</span><span class="ident" id="1334279"><a href="/gostd/compress/bzip2/bzip2.go.html#1332605">blockSize</a></span><span class="op" id="1334288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334294">return</span>&nbsp;<span class="builtintype" id="1334301">nil</span><br>
<span class="lineno"></span><span class="op" id="1334305">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="1334308">func</span>&nbsp;<span class="op" id="1334313">(</span><span class="ident" id="1334314">bz2</span>&nbsp;<span class="op" id="1334318">*</span><span class="ident" id="1334319"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1334325">)</span>&nbsp;<span class="ident" id="1334327">Read</span><span class="op" id="1334331">(</span><span class="ident" id="1334332">buf</span>&nbsp;<span class="op" id="1334336">[</span><span class="op" id="1334337">]</span><span class="builtintype" id="1334338">byte</span><span class="op" id="1334342">)</span>&nbsp;<span class="op" id="1334344">(</span><span class="ident" id="1334345">n</span>&nbsp;<span class="builtintype" id="1334347">int</span><span class="op" id="1334350">,</span>&nbsp;<span class="ident" id="1334352">err</span>&nbsp;<span class="builtintype" id="1334356">error</span><span class="op" id="1334361">)</span>&nbsp;<span class="op" id="1334363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334366">if</span>&nbsp;<span class="ident" id="1334369"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334372">.</span><span class="ident" id="1334373"><a href="/gostd/compress/bzip2/bzip2.go.html#1332664">eof</a></span>&nbsp;<span class="op" id="1334377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334381">return</span>&nbsp;<span class="num" id="1334388">0</span><span class="op" id="1334389">,</span>&nbsp;<span class="ident" id="1334391"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1334393">.</span><span class="ident" id="1334394"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334399">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334403">if</span>&nbsp;<span class="op" id="1334406">!</span><span class="ident" id="1334407"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334410">.</span><span class="ident" id="1334411"><a href="/gostd/compress/bzip2/bzip2.go.html#1332542">setupDone</a></span>&nbsp;<span class="op" id="1334421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334425"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span>&nbsp;<span class="op" id="1334429">=</span>&nbsp;<span class="ident" id="1334431"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334434">.</span><span class="ident" id="1334435"><a href="/gostd/compress/bzip2/bzip2.go.html#1333763">setup</a></span><span class="op" id="1334440">(</span><span class="builtintype" id="1334441">true</span><span class="op" id="1334445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334449">brErr</span>&nbsp;<span class="op" id="1334455">:=</span>&nbsp;<span class="ident" id="1334458"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334461">.</span><span class="ident" id="1334462"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><span class="op" id="1334464">.</span><span class="ident" id="1334465"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331671">Err</a></span><span class="op" id="1334468">(</span><span class="op" id="1334469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334473">if</span>&nbsp;<span class="ident" id="1334476"><a href="/gostd/compress/bzip2/bzip2.go.html#1334449">brErr</a></span>&nbsp;<span class="op" id="1334482">!=</span>&nbsp;<span class="builtintype" id="1334485">nil</span>&nbsp;<span class="op" id="1334489">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334494"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span>&nbsp;<span class="op" id="1334498">=</span>&nbsp;<span class="ident" id="1334500"><a href="/gostd/compress/bzip2/bzip2.go.html#1334449">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334512">if</span>&nbsp;<span class="ident" id="1334515"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span>&nbsp;<span class="op" id="1334519">!=</span>&nbsp;<span class="builtintype" id="1334522">nil</span>&nbsp;<span class="op" id="1334526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334531">return</span>&nbsp;<span class="num" id="1334538">0</span><span class="op" id="1334539">,</span>&nbsp;<span class="ident" id="1334541"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334547">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334551"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334554">.</span><span class="ident" id="1334555"><a href="/gostd/compress/bzip2/bzip2.go.html#1332542">setupDone</a></span>&nbsp;<span class="op" id="1334565">=</span>&nbsp;<span class="builtintype" id="1334567">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334577"><a href="/gostd/compress/bzip2/bzip2.go.html#1334345">n</a></span><span class="op" id="1334578">,</span>&nbsp;<span class="ident" id="1334580"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span>&nbsp;<span class="op" id="1334584">=</span>&nbsp;<span class="ident" id="1334586"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334589">.</span><span class="ident" id="1334590"><a href="/gostd/compress/bzip2/bzip2.go.html#1336040">read</a></span><span class="op" id="1334594">(</span><span class="ident" id="1334595"><a href="/gostd/compress/bzip2/bzip2.go.html#1334332">buf</a></span><span class="op" id="1334598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334601">brErr</span>&nbsp;<span class="op" id="1334607">:=</span>&nbsp;<span class="ident" id="1334610"><a href="/gostd/compress/bzip2/bzip2.go.html#1334314">bz2</a></span><span class="op" id="1334613">.</span><span class="ident" id="1334614"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><span class="op" id="1334616">.</span><span class="ident" id="1334617"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331671">Err</a></span><span class="op" id="1334620">(</span><span class="op" id="1334621">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334624">if</span>&nbsp;<span class="ident" id="1334627"><a href="/gostd/compress/bzip2/bzip2.go.html#1334601">brErr</a></span>&nbsp;<span class="op" id="1334633">!=</span>&nbsp;<span class="builtintype" id="1334636">nil</span>&nbsp;<span class="op" id="1334640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1334644"><a href="/gostd/compress/bzip2/bzip2.go.html#1334352">err</a></span>&nbsp;<span class="op" id="1334648">=</span>&nbsp;<span class="ident" id="1334650"><a href="/gostd/compress/bzip2/bzip2.go.html#1334601">brErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1334660">return</span><br>
<span class="lineno"></span><span class="op" id="1334667">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="1334670">func</span>&nbsp;<span class="op" id="1334675">(</span><span class="ident" id="1334676">bz2</span>&nbsp;<span class="op" id="1334680">*</span><span class="ident" id="1334681"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1334687">)</span>&nbsp;<span class="ident" id="1334689">readFromBlock</span><span class="op" id="1334702">(</span><span class="ident" id="1334703">buf</span>&nbsp;<span class="op" id="1334707">[</span><span class="op" id="1334708">]</span><span class="builtintype" id="1334709">byte</span><span class="op" id="1334713">)</span>&nbsp;<span class="builtintype" id="1334715">int</span>&nbsp;<span class="op" id="1334719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334722">//&nbsp;bzip2&nbsp;is&nbsp;a&nbsp;block&nbsp;based&nbsp;compressor,&nbsp;except&nbsp;that&nbsp;it&nbsp;has&nbsp;a&nbsp;run-length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334793">//&nbsp;preprocessing&nbsp;step.&nbsp;The&nbsp;block&nbsp;based&nbsp;nature&nbsp;means&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334858">//&nbsp;preallocate&nbsp;fixed-size&nbsp;buffers&nbsp;and&nbsp;reuse&nbsp;them.&nbsp;However,&nbsp;the&nbsp;RLE</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334926">//&nbsp;preprocessing&nbsp;would&nbsp;require&nbsp;allocating&nbsp;huge&nbsp;buffers&nbsp;to&nbsp;store&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1334995">//&nbsp;maximum&nbsp;expansion.&nbsp;Thus&nbsp;we&nbsp;process&nbsp;blocks&nbsp;all&nbsp;at&nbsp;once,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335065">//&nbsp;the&nbsp;RLE&nbsp;which&nbsp;we&nbsp;decompress&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335110">n</span>&nbsp;<span class="op" id="1335112">:=</span>&nbsp;<span class="num" id="1335115">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335118">for</span>&nbsp;<span class="op" id="1335122">(</span><span class="ident" id="1335123"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335126">.</span><span class="ident" id="1335127"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span>&nbsp;<span class="op" id="1335135">&gt;</span>&nbsp;<span class="num" id="1335137">0</span>&nbsp;<span class="op" id="1335139">||</span>&nbsp;<span class="ident" id="1335142"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335145">.</span><span class="ident" id="1335146"><a href="/gostd/compress/bzip2/bzip2.go.html#1333065">preRLEUsed</a></span>&nbsp;<span class="op" id="1335157">&lt;</span>&nbsp;<span class="builtinfunc" id="1335159">len</span><span class="op" id="1335162">(</span><span class="ident" id="1335163"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335166">.</span><span class="ident" id="1335167"><a href="/gostd/compress/bzip2/bzip2.go.html#1332995">preRLE</a></span><span class="op" id="1335173">)</span><span class="op" id="1335174">)</span>&nbsp;<span class="op" id="1335176">&amp;&amp;</span>&nbsp;<span class="ident" id="1335179"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span>&nbsp;<span class="op" id="1335181">&lt;</span>&nbsp;<span class="builtinfunc" id="1335183">len</span><span class="op" id="1335186">(</span><span class="ident" id="1335187"><a href="/gostd/compress/bzip2/bzip2.go.html#1334703">buf</a></span><span class="op" id="1335190">)</span>&nbsp;<span class="op" id="1335192">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335196">//&nbsp;We&nbsp;have&nbsp;RLE&nbsp;data&nbsp;pending.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335228">//&nbsp;The&nbsp;run-length&nbsp;encoding&nbsp;works&nbsp;like&nbsp;this:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335274">//&nbsp;Any&nbsp;sequence&nbsp;of&nbsp;four&nbsp;equal&nbsp;bytes&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335336">//&nbsp;byte&nbsp;which&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;repeats&nbsp;of&nbsp;that&nbsp;byte&nbsp;to</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335399">//&nbsp;include.&nbsp;(The&nbsp;number&nbsp;of&nbsp;repeats&nbsp;can&nbsp;be&nbsp;zero.)&nbsp;Because&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335465">//&nbsp;decompressing&nbsp;on-demand&nbsp;our&nbsp;state&nbsp;is&nbsp;kept&nbsp;in&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1335526">//&nbsp;object.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335540">if</span>&nbsp;<span class="ident" id="1335543"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335546">.</span><span class="ident" id="1335547"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span>&nbsp;<span class="op" id="1335555">&gt;</span>&nbsp;<span class="num" id="1335557">0</span>&nbsp;<span class="op" id="1335559">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335564"><a href="/gostd/compress/bzip2/bzip2.go.html#1334703">buf</a></span><span class="op" id="1335567">[</span><span class="ident" id="1335568"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span><span class="op" id="1335569">]</span>&nbsp;<span class="op" id="1335571">=</span>&nbsp;<span class="builtintype" id="1335573">byte</span><span class="op" id="1335577">(</span><span class="ident" id="1335578"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335581">.</span><span class="ident" id="1335582"><a href="/gostd/compress/bzip2/bzip2.go.html#1333124">lastByte</a></span><span class="op" id="1335590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335595"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span><span class="op" id="1335596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335602"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335605">.</span><span class="ident" id="1335606"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span><span class="op" id="1335613">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335619">if</span>&nbsp;<span class="ident" id="1335622"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335625">.</span><span class="ident" id="1335626"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span>&nbsp;<span class="op" id="1335634">==</span>&nbsp;<span class="num" id="1335637">0</span>&nbsp;<span class="op" id="1335639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335645"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335648">.</span><span class="ident" id="1335649"><a href="/gostd/compress/bzip2/bzip2.go.html#1333124">lastByte</a></span>&nbsp;<span class="op" id="1335658">=</span>&nbsp;<span class="op" id="1335660">-</span><span class="num" id="1335661">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335671">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335687"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335690">.</span><span class="ident" id="1335691"><a href="/gostd/compress/bzip2/bzip2.go.html#1332930">tPos</a></span>&nbsp;<span class="op" id="1335696">=</span>&nbsp;<span class="ident" id="1335698"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335701">.</span><span class="ident" id="1335702"><a href="/gostd/compress/bzip2/bzip2.go.html#1332995">preRLE</a></span><span class="op" id="1335708">[</span><span class="ident" id="1335709"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335712">.</span><span class="ident" id="1335713"><a href="/gostd/compress/bzip2/bzip2.go.html#1332930">tPos</a></span><span class="op" id="1335717">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335721">b</span>&nbsp;<span class="op" id="1335723">:=</span>&nbsp;<span class="builtintype" id="1335726">byte</span><span class="op" id="1335730">(</span><span class="ident" id="1335731"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335734">.</span><span class="ident" id="1335735"><a href="/gostd/compress/bzip2/bzip2.go.html#1332930">tPos</a></span><span class="op" id="1335739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335743"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335746">.</span><span class="ident" id="1335747"><a href="/gostd/compress/bzip2/bzip2.go.html#1332930">tPos</a></span>&nbsp;<span class="op" id="1335752">&gt;&gt;=</span>&nbsp;<span class="num" id="1335756">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335760"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335763">.</span><span class="ident" id="1335764"><a href="/gostd/compress/bzip2/bzip2.go.html#1333065">preRLEUsed</a></span><span class="op" id="1335774">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335780">if</span>&nbsp;<span class="ident" id="1335783"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335786">.</span><span class="ident" id="1335787"><a href="/gostd/compress/bzip2/bzip2.go.html#1333175">byteRepeats</a></span>&nbsp;<span class="op" id="1335799">==</span>&nbsp;<span class="num" id="1335802">3</span>&nbsp;<span class="op" id="1335804">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335809"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335812">.</span><span class="ident" id="1335813"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span>&nbsp;<span class="op" id="1335821">=</span>&nbsp;<span class="builtintype" id="1335823">uint</span><span class="op" id="1335827">(</span><span class="ident" id="1335828"><a href="/gostd/compress/bzip2/bzip2.go.html#1335721">b</a></span><span class="op" id="1335829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335834"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335837">.</span><span class="ident" id="1335838"><a href="/gostd/compress/bzip2/bzip2.go.html#1333175">byteRepeats</a></span>&nbsp;<span class="op" id="1335850">=</span>&nbsp;<span class="num" id="1335852">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335857">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1335873">if</span>&nbsp;<span class="ident" id="1335876"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335879">.</span><span class="ident" id="1335880"><a href="/gostd/compress/bzip2/bzip2.go.html#1333124">lastByte</a></span>&nbsp;<span class="op" id="1335889">==</span>&nbsp;<span class="builtintype" id="1335892">int</span><span class="op" id="1335895">(</span><span class="ident" id="1335896"><a href="/gostd/compress/bzip2/bzip2.go.html#1335721">b</a></span><span class="op" id="1335897">)</span>&nbsp;<span class="op" id="1335899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335904"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335907">.</span><span class="ident" id="1335908"><a href="/gostd/compress/bzip2/bzip2.go.html#1333175">byteRepeats</a></span><span class="op" id="1335919">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335924">}</span>&nbsp;<span class="keyword" id="1335926">else</span>&nbsp;<span class="op" id="1335931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335936"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335939">.</span><span class="ident" id="1335940"><a href="/gostd/compress/bzip2/bzip2.go.html#1333175">byteRepeats</a></span>&nbsp;<span class="op" id="1335952">=</span>&nbsp;<span class="num" id="1335954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1335958">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335962"><a href="/gostd/compress/bzip2/bzip2.go.html#1334676">bz2</a></span><span class="op" id="1335965">.</span><span class="ident" id="1335966"><a href="/gostd/compress/bzip2/bzip2.go.html#1333124">lastByte</a></span>&nbsp;<span class="op" id="1335975">=</span>&nbsp;<span class="builtintype" id="1335977">int</span><span class="op" id="1335980">(</span><span class="ident" id="1335981"><a href="/gostd/compress/bzip2/bzip2.go.html#1335721">b</a></span><span class="op" id="1335982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335987"><a href="/gostd/compress/bzip2/bzip2.go.html#1334703">buf</a></span><span class="op" id="1335990">[</span><span class="ident" id="1335991"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span><span class="op" id="1335992">]</span>&nbsp;<span class="op" id="1335994">=</span>&nbsp;<span class="ident" id="1335996"><a href="/gostd/compress/bzip2/bzip2.go.html#1335721">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336000"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span><span class="op" id="1336001">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336005">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336009">return</span>&nbsp;<span class="ident" id="1336016"><a href="/gostd/compress/bzip2/bzip2.go.html#1335110">n</a></span><br>
<span class="lineno"></span><span class="op" id="1336018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1336021">func</span>&nbsp;<span class="op" id="1336026">(</span><span class="ident" id="1336027">bz2</span>&nbsp;<span class="op" id="1336031">*</span><span class="ident" id="1336032"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1336038">)</span>&nbsp;<span class="ident" id="1336040">read</span><span class="op" id="1336044">(</span><span class="ident" id="1336045">buf</span>&nbsp;<span class="op" id="1336049">[</span><span class="op" id="1336050">]</span><span class="builtintype" id="1336051">byte</span><span class="op" id="1336055">)</span>&nbsp;<span class="op" id="1336057">(</span><span class="builtintype" id="1336058">int</span><span class="op" id="1336061">,</span>&nbsp;<span class="builtintype" id="1336063">error</span><span class="op" id="1336068">)</span>&nbsp;<span class="op" id="1336070">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336073">for</span>&nbsp;<span class="op" id="1336077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336081">n</span>&nbsp;<span class="op" id="1336083">:=</span>&nbsp;<span class="ident" id="1336086"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336089">.</span><span class="ident" id="1336090"><a href="/gostd/compress/bzip2/bzip2.go.html#1334689">readFromBlock</a></span><span class="op" id="1336103">(</span><span class="ident" id="1336104"><a href="/gostd/compress/bzip2/bzip2.go.html#1336045">buf</a></span><span class="op" id="1336107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336111">if</span>&nbsp;<span class="ident" id="1336114"><a href="/gostd/compress/bzip2/bzip2.go.html#1336081">n</a></span>&nbsp;<span class="op" id="1336116">&gt;</span>&nbsp;<span class="num" id="1336118">0</span>&nbsp;<span class="op" id="1336120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336125"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336128">.</span><span class="ident" id="1336129"><a href="/gostd/compress/bzip2/bzip2.go.html#1332500">blockCRC</a></span>&nbsp;<span class="op" id="1336138">=</span>&nbsp;<span class="ident" id="1336140"><a href="/gostd/compress/bzip2/bzip2.go.html#1344952">updateCRC</a></span><span class="op" id="1336149">(</span><span class="ident" id="1336150"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336153">.</span><span class="ident" id="1336154"><a href="/gostd/compress/bzip2/bzip2.go.html#1332500">blockCRC</a></span><span class="op" id="1336162">,</span>&nbsp;<span class="ident" id="1336164"><a href="/gostd/compress/bzip2/bzip2.go.html#1336045">buf</a></span><span class="op" id="1336167">[</span><span class="op" id="1336168">:</span><span class="ident" id="1336169"><a href="/gostd/compress/bzip2/bzip2.go.html#1336081">n</a></span><span class="op" id="1336170">]</span><span class="op" id="1336171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336176">return</span>&nbsp;<span class="ident" id="1336183"><a href="/gostd/compress/bzip2/bzip2.go.html#1336081">n</a></span><span class="op" id="1336184">,</span>&nbsp;<span class="builtintype" id="1336186">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336197">//&nbsp;End&nbsp;of&nbsp;block.&nbsp;Check&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336227">if</span>&nbsp;<span class="ident" id="1336230"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336233">.</span><span class="ident" id="1336234"><a href="/gostd/compress/bzip2/bzip2.go.html#1332500">blockCRC</a></span>&nbsp;<span class="op" id="1336243">!=</span>&nbsp;<span class="ident" id="1336246"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336249">.</span><span class="ident" id="1336250"><a href="/gostd/compress/bzip2/bzip2.go.html#1332521">wantBlockCRC</a></span>&nbsp;<span class="op" id="1336263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336268"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336271">.</span><span class="ident" id="1336272"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><span class="op" id="1336274">.</span><span class="ident" id="1336275"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1336279">=</span>&nbsp;<span class="ident" id="1336281"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1336296">(</span><span class="string" id="1336297">&#34;block&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="1336322">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336327">return</span>&nbsp;<span class="num" id="1336334">0</span><span class="op" id="1336335">,</span>&nbsp;<span class="ident" id="1336337"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336340">.</span><span class="ident" id="1336341"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><span class="op" id="1336343">.</span><span class="ident" id="1336344"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336355">//&nbsp;Find&nbsp;next&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336377">br</span>&nbsp;<span class="op" id="1336380">:=</span>&nbsp;<span class="op" id="1336383">&amp;</span><span class="ident" id="1336384"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336387">.</span><span class="ident" id="1336388"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336393">switch</span>&nbsp;<span class="ident" id="1336400"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336402">.</span><span class="ident" id="1336403"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330570">ReadBits64</a></span><span class="op" id="1336413">(</span><span class="num" id="1336414">48</span><span class="op" id="1336416">)</span>&nbsp;<span class="op" id="1336418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336422">default</span><span class="op" id="1336429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336434">return</span>&nbsp;<span class="num" id="1336441">0</span><span class="op" id="1336442">,</span>&nbsp;<span class="ident" id="1336444"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1336459">(</span><span class="string" id="1336460">&#34;bad&nbsp;magic&nbsp;value&nbsp;found&#34;</span><span class="op" id="1336483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336488">case</span>&nbsp;<span class="ident" id="1336493"><a href="/gostd/compress/bzip2/bzip2.go.html#1333637">bzip2BlockMagic</a></span><span class="op" id="1336508">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336513">//&nbsp;Start&nbsp;of&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336535">err</span>&nbsp;<span class="op" id="1336539">:=</span>&nbsp;<span class="ident" id="1336542"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336545">.</span><span class="ident" id="1336546"><a href="/gostd/compress/bzip2/bzip2.go.html#1337642">readBlock</a></span><span class="op" id="1336555">(</span><span class="op" id="1336556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336561">if</span>&nbsp;<span class="ident" id="1336564"><a href="/gostd/compress/bzip2/bzip2.go.html#1336535">err</a></span>&nbsp;<span class="op" id="1336568">!=</span>&nbsp;<span class="builtintype" id="1336571">nil</span>&nbsp;<span class="op" id="1336575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336581">return</span>&nbsp;<span class="num" id="1336588">0</span><span class="op" id="1336589">,</span>&nbsp;<span class="ident" id="1336591"><a href="/gostd/compress/bzip2/bzip2.go.html#1336535">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336598">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336603">case</span>&nbsp;<span class="ident" id="1336608"><a href="/gostd/compress/bzip2/bzip2.go.html#1333676">bzip2FinalMagic</a></span><span class="op" id="1336623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336628">//&nbsp;Check&nbsp;end-of-file&nbsp;CRC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336657">wantFileCRC</span>&nbsp;<span class="op" id="1336669">:=</span>&nbsp;<span class="builtintype" id="1336672">uint32</span><span class="op" id="1336678">(</span><span class="ident" id="1336679"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336681">.</span><span class="ident" id="1336682"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330570">ReadBits64</a></span><span class="op" id="1336692">(</span><span class="num" id="1336693">32</span><span class="op" id="1336695">)</span><span class="op" id="1336696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336701">if</span>&nbsp;<span class="ident" id="1336704"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336706">.</span><span class="ident" id="1336707"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1336711">!=</span>&nbsp;<span class="builtintype" id="1336714">nil</span>&nbsp;<span class="op" id="1336718">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336724">return</span>&nbsp;<span class="num" id="1336731">0</span><span class="op" id="1336732">,</span>&nbsp;<span class="ident" id="1336734"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336736">.</span><span class="ident" id="1336737"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336749">if</span>&nbsp;<span class="ident" id="1336752"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1336755">.</span><span class="ident" id="1336756"><a href="/gostd/compress/bzip2/bzip2.go.html#1332479">fileCRC</a></span>&nbsp;<span class="op" id="1336764">!=</span>&nbsp;<span class="ident" id="1336767"><a href="/gostd/compress/bzip2/bzip2.go.html#1336657">wantFileCRC</a></span>&nbsp;<span class="op" id="1336779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336785"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336787">.</span><span class="ident" id="1336788"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1336792">=</span>&nbsp;<span class="ident" id="1336794"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1336809">(</span><span class="string" id="1336810">&#34;file&nbsp;checksum&nbsp;mismatch&#34;</span><span class="op" id="1336834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336840">return</span>&nbsp;<span class="num" id="1336847">0</span><span class="op" id="1336848">,</span>&nbsp;<span class="ident" id="1336850"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336852">.</span><span class="ident" id="1336853"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336866">//&nbsp;Skip&nbsp;ahead&nbsp;to&nbsp;byte&nbsp;boundary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336901">//&nbsp;Is&nbsp;there&nbsp;a&nbsp;file&nbsp;concatenated&nbsp;to&nbsp;this&nbsp;one?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1336949">//&nbsp;It&nbsp;would&nbsp;start&nbsp;with&nbsp;BZ.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1336979">if</span>&nbsp;<span class="ident" id="1336982"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1336984">.</span><span class="ident" id="1336985"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330040">bits</a></span><span class="op" id="1336989">%</span><span class="num" id="1336990">8</span>&nbsp;<span class="op" id="1336992">!=</span>&nbsp;<span class="num" id="1336995">0</span>&nbsp;<span class="op" id="1336997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337003"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337005">.</span><span class="ident" id="1337006"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1337014">(</span><span class="ident" id="1337015"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337017">.</span><span class="ident" id="1337018"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330040">bits</a></span>&nbsp;<span class="op" id="1337023">%</span>&nbsp;<span class="num" id="1337025">8</span><span class="op" id="1337026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337036">b</span><span class="op" id="1337037">,</span>&nbsp;<span class="ident" id="1337039">err</span>&nbsp;<span class="op" id="1337043">:=</span>&nbsp;<span class="ident" id="1337046"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337048">.</span><span class="ident" id="1337049"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330007">r</a></span><span class="op" id="1337050">.</span><span class="ident" id="1337051"><a href="/gostd/io/io.go.html#1426989">ReadByte</a></span><span class="op" id="1337059">(</span><span class="op" id="1337060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337065">if</span>&nbsp;<span class="ident" id="1337068"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337072">==</span>&nbsp;<span class="ident" id="1337075"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1337077">.</span><span class="ident" id="1337078"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="1337082">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337088"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337090">.</span><span class="ident" id="1337091"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1337095">=</span>&nbsp;<span class="ident" id="1337097"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1337099">.</span><span class="ident" id="1337100"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337108"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1337111">.</span><span class="ident" id="1337112"><a href="/gostd/compress/bzip2/bzip2.go.html#1332664">eof</a></span>&nbsp;<span class="op" id="1337116">=</span>&nbsp;<span class="builtintype" id="1337118">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337127">return</span>&nbsp;<span class="num" id="1337134">0</span><span class="op" id="1337135">,</span>&nbsp;<span class="ident" id="1337137"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1337139">.</span><span class="ident" id="1337140"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337152">if</span>&nbsp;<span class="ident" id="1337155"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337159">!=</span>&nbsp;<span class="builtintype" id="1337162">nil</span>&nbsp;<span class="op" id="1337166">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337172"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337174">.</span><span class="ident" id="1337175"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1337179">=</span>&nbsp;<span class="ident" id="1337181"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337189">return</span>&nbsp;<span class="num" id="1337196">0</span><span class="op" id="1337197">,</span>&nbsp;<span class="ident" id="1337199"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337211">z</span><span class="op" id="1337212">,</span>&nbsp;<span class="ident" id="1337214"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337218">:=</span>&nbsp;<span class="ident" id="1337221"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337223">.</span><span class="ident" id="1337224"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330007">r</a></span><span class="op" id="1337225">.</span><span class="ident" id="1337226"><a href="/gostd/io/io.go.html#1426989">ReadByte</a></span><span class="op" id="1337234">(</span><span class="op" id="1337235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337240">if</span>&nbsp;<span class="ident" id="1337243"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337247">!=</span>&nbsp;<span class="builtintype" id="1337250">nil</span>&nbsp;<span class="op" id="1337254">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337260">if</span>&nbsp;<span class="ident" id="1337263"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337267">==</span>&nbsp;<span class="ident" id="1337270"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1337272">.</span><span class="ident" id="1337273"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="1337277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337284"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span>&nbsp;<span class="op" id="1337288">=</span>&nbsp;<span class="ident" id="1337290"><a href="/gostd/compress/bzip2/bzip2.go.html#1331934">io</a></span><span class="op" id="1337292">.</span><span class="ident" id="1337293"><a href="/gostd/io/io.go.html#1420096">ErrUnexpectedEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337320"><a href="/gostd/compress/bzip2/bzip2.go.html#1336377">br</a></span><span class="op" id="1337322">.</span><span class="ident" id="1337323"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330051">err</a></span>&nbsp;<span class="op" id="1337327">=</span>&nbsp;<span class="ident" id="1337329"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337337">return</span>&nbsp;<span class="num" id="1337344">0</span><span class="op" id="1337345">,</span>&nbsp;<span class="ident" id="1337347"><a href="/gostd/compress/bzip2/bzip2.go.html#1337039">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337359">if</span>&nbsp;<span class="ident" id="1337362"><a href="/gostd/compress/bzip2/bzip2.go.html#1337036">b</a></span>&nbsp;<span class="op" id="1337364">!=</span>&nbsp;<span class="string" id="1337367">&#39;B&#39;</span>&nbsp;<span class="op" id="1337371">||</span>&nbsp;<span class="ident" id="1337374"><a href="/gostd/compress/bzip2/bzip2.go.html#1337211">z</a></span>&nbsp;<span class="op" id="1337376">!=</span>&nbsp;<span class="string" id="1337379">&#39;Z&#39;</span>&nbsp;<span class="op" id="1337383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337389">return</span>&nbsp;<span class="num" id="1337396">0</span><span class="op" id="1337397">,</span>&nbsp;<span class="ident" id="1337399"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1337414">(</span><span class="string" id="1337415">&#34;bad&nbsp;magic&nbsp;value&nbsp;in&nbsp;continuation&nbsp;file&#34;</span><span class="op" id="1337453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337463">if</span>&nbsp;<span class="ident" id="1337466">err</span>&nbsp;<span class="op" id="1337470">:=</span>&nbsp;<span class="ident" id="1337473"><a href="/gostd/compress/bzip2/bzip2.go.html#1336027">bz2</a></span><span class="op" id="1337476">.</span><span class="ident" id="1337477"><a href="/gostd/compress/bzip2/bzip2.go.html#1333763">setup</a></span><span class="op" id="1337482">(</span><span class="builtintype" id="1337483">false</span><span class="op" id="1337488">)</span><span class="op" id="1337489">;</span>&nbsp;<span class="ident" id="1337491"><a href="/gostd/compress/bzip2/bzip2.go.html#1337466">err</a></span>&nbsp;<span class="op" id="1337495">!=</span>&nbsp;<span class="builtintype" id="1337498">nil</span>&nbsp;<span class="op" id="1337502">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337508">return</span>&nbsp;<span class="num" id="1337515">0</span><span class="op" id="1337516">,</span>&nbsp;<span class="ident" id="1337518"><a href="/gostd/compress/bzip2/bzip2.go.html#1337466">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337532">}</span><br>
<span class="lineno"></span><span class="op" id="1337534">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="1337537">//&nbsp;readBlock&nbsp;reads&nbsp;a&nbsp;bzip2&nbsp;block.&nbsp;The&nbsp;magic&nbsp;number&nbsp;should&nbsp;already&nbsp;have&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1337623">func</span>&nbsp;<span class="op" id="1337628">(</span><span class="ident" id="1337629">bz2</span>&nbsp;<span class="op" id="1337633">*</span><span class="ident" id="1337634"><a href="/gostd/compress/bzip2/bzip2.go.html#1332438">reader</a></span><span class="op" id="1337640">)</span>&nbsp;<span class="ident" id="1337642">readBlock</span><span class="op" id="1337651">(</span><span class="op" id="1337652">)</span>&nbsp;<span class="op" id="1337654">(</span><span class="ident" id="1337655">err</span>&nbsp;<span class="builtintype" id="1337659">error</span><span class="op" id="1337664">)</span>&nbsp;<span class="op" id="1337666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337669">br</span>&nbsp;<span class="op" id="1337672">:=</span>&nbsp;<span class="op" id="1337675">&amp;</span><span class="ident" id="1337676"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337679">.</span><span class="ident" id="1337680"><a href="/gostd/compress/bzip2/bzip2.go.html#1332455">br</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337684"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337687">.</span><span class="ident" id="1337688"><a href="/gostd/compress/bzip2/bzip2.go.html#1332521">wantBlockCRC</a></span>&nbsp;<span class="op" id="1337701">=</span>&nbsp;<span class="builtintype" id="1337703">uint32</span><span class="op" id="1337709">(</span><span class="ident" id="1337710"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1337712">.</span><span class="ident" id="1337713"><a href="/gostd/compress/bzip2/bit_reader.go.html#1330570">ReadBits64</a></span><span class="op" id="1337723">(</span><span class="num" id="1337724">32</span><span class="op" id="1337726">)</span><span class="op" id="1337727">)</span>&nbsp;<span class="comment" id="1337729">//&nbsp;skip&nbsp;checksum.&nbsp;TODO:&nbsp;check&nbsp;it&nbsp;if&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;what&nbsp;it&nbsp;is.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337796"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337799">.</span><span class="ident" id="1337800"><a href="/gostd/compress/bzip2/bzip2.go.html#1332500">blockCRC</a></span>&nbsp;<span class="op" id="1337809">=</span>&nbsp;<span class="num" id="1337811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337814"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337817">.</span><span class="ident" id="1337818"><a href="/gostd/compress/bzip2/bzip2.go.html#1332479">fileCRC</a></span>&nbsp;<span class="op" id="1337826">=</span>&nbsp;<span class="op" id="1337828">(</span><span class="ident" id="1337829"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337832">.</span><span class="ident" id="1337833"><a href="/gostd/compress/bzip2/bzip2.go.html#1332479">fileCRC</a></span><span class="op" id="1337840">&lt;&lt;</span><span class="num" id="1337842">1</span>&nbsp;<span class="op" id="1337844">|</span>&nbsp;<span class="ident" id="1337846"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337849">.</span><span class="ident" id="1337850"><a href="/gostd/compress/bzip2/bzip2.go.html#1332479">fileCRC</a></span><span class="op" id="1337857">&gt;&gt;</span><span class="num" id="1337859">31</span><span class="op" id="1337861">)</span>&nbsp;<span class="op" id="1337863">^</span>&nbsp;<span class="ident" id="1337865"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1337868">.</span><span class="ident" id="1337869"><a href="/gostd/compress/bzip2/bzip2.go.html#1332521">wantBlockCRC</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337883">randomized</span>&nbsp;<span class="op" id="1337894">:=</span>&nbsp;<span class="ident" id="1337897"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1337899">.</span><span class="ident" id="1337900"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1337908">(</span><span class="num" id="1337909">1</span><span class="op" id="1337910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337913">if</span>&nbsp;<span class="ident" id="1337916"><a href="/gostd/compress/bzip2/bzip2.go.html#1337883">randomized</a></span>&nbsp;<span class="op" id="1337927">!=</span>&nbsp;<span class="num" id="1337930">0</span>&nbsp;<span class="op" id="1337932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1337936">return</span>&nbsp;<span class="ident" id="1337943"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1337958">(</span><span class="string" id="1337959">&#34;deprecated&nbsp;randomized&nbsp;files&#34;</span><span class="op" id="1337988">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1337994">origPtr</span>&nbsp;<span class="op" id="1338002">:=</span>&nbsp;<span class="builtintype" id="1338005">uint</span><span class="op" id="1338009">(</span><span class="ident" id="1338010"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1338012">.</span><span class="ident" id="1338013"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1338021">(</span><span class="num" id="1338022">24</span><span class="op" id="1338024">)</span><span class="op" id="1338025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338029">//&nbsp;If&nbsp;not&nbsp;every&nbsp;byte&nbsp;value&nbsp;is&nbsp;used&nbsp;in&nbsp;the&nbsp;block&nbsp;(i.e.,&nbsp;it&#39;s&nbsp;text)&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338101">//&nbsp;the&nbsp;symbol&nbsp;set&nbsp;is&nbsp;reduced.&nbsp;The&nbsp;symbols&nbsp;used&nbsp;are&nbsp;stored&nbsp;as&nbsp;a</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338165">//&nbsp;two-level,&nbsp;16x16&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338194">symbolRangeUsedBitmap</span>&nbsp;<span class="op" id="1338216">:=</span>&nbsp;<span class="ident" id="1338219"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1338221">.</span><span class="ident" id="1338222"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1338230">(</span><span class="num" id="1338231">16</span><span class="op" id="1338233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338236">symbolPresent</span>&nbsp;<span class="op" id="1338250">:=</span>&nbsp;<span class="builtinfunc" id="1338253">make</span><span class="op" id="1338257">(</span><span class="op" id="1338258">[</span><span class="op" id="1338259">]</span><span class="builtintype" id="1338260">bool</span><span class="op" id="1338264">,</span>&nbsp;<span class="num" id="1338266">256</span><span class="op" id="1338269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338272">numSymbols</span>&nbsp;<span class="op" id="1338283">:=</span>&nbsp;<span class="num" id="1338286">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338289">for</span>&nbsp;<span class="ident" id="1338293">symRange</span>&nbsp;<span class="op" id="1338302">:=</span>&nbsp;<span class="builtintype" id="1338305">uint</span><span class="op" id="1338309">(</span><span class="num" id="1338310">0</span><span class="op" id="1338311">)</span><span class="op" id="1338312">;</span>&nbsp;<span class="ident" id="1338314"><a href="/gostd/compress/bzip2/bzip2.go.html#1338293">symRange</a></span>&nbsp;<span class="op" id="1338323">&lt;</span>&nbsp;<span class="num" id="1338325">16</span><span class="op" id="1338327">;</span>&nbsp;<span class="ident" id="1338329"><a href="/gostd/compress/bzip2/bzip2.go.html#1338293">symRange</a></span><span class="op" id="1338337">++</span>&nbsp;<span class="op" id="1338340">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338344">if</span>&nbsp;<span class="ident" id="1338347"><a href="/gostd/compress/bzip2/bzip2.go.html#1338194">symbolRangeUsedBitmap</a></span><span class="op" id="1338368">&amp;</span><span class="op" id="1338369">(</span><span class="num" id="1338370">1</span><span class="op" id="1338371">&lt;&lt;</span><span class="op" id="1338373">(</span><span class="num" id="1338374">15</span><span class="op" id="1338376">-</span><span class="ident" id="1338377"><a href="/gostd/compress/bzip2/bzip2.go.html#1338293">symRange</a></span><span class="op" id="1338385">)</span><span class="op" id="1338386">)</span>&nbsp;<span class="op" id="1338388">!=</span>&nbsp;<span class="num" id="1338391">0</span>&nbsp;<span class="op" id="1338393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338398">bits</span>&nbsp;<span class="op" id="1338403">:=</span>&nbsp;<span class="ident" id="1338406"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1338408">.</span><span class="ident" id="1338409"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1338417">(</span><span class="num" id="1338418">16</span><span class="op" id="1338420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338425">for</span>&nbsp;<span class="ident" id="1338429">symbol</span>&nbsp;<span class="op" id="1338436">:=</span>&nbsp;<span class="builtintype" id="1338439">uint</span><span class="op" id="1338443">(</span><span class="num" id="1338444">0</span><span class="op" id="1338445">)</span><span class="op" id="1338446">;</span>&nbsp;<span class="ident" id="1338448"><a href="/gostd/compress/bzip2/bzip2.go.html#1338429">symbol</a></span>&nbsp;<span class="op" id="1338455">&lt;</span>&nbsp;<span class="num" id="1338457">16</span><span class="op" id="1338459">;</span>&nbsp;<span class="ident" id="1338461"><a href="/gostd/compress/bzip2/bzip2.go.html#1338429">symbol</a></span><span class="op" id="1338467">++</span>&nbsp;<span class="op" id="1338470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338476">if</span>&nbsp;<span class="ident" id="1338479"><a href="/gostd/compress/bzip2/bzip2.go.html#1338398">bits</a></span><span class="op" id="1338483">&amp;</span><span class="op" id="1338484">(</span><span class="num" id="1338485">1</span><span class="op" id="1338486">&lt;&lt;</span><span class="op" id="1338488">(</span><span class="num" id="1338489">15</span><span class="op" id="1338491">-</span><span class="ident" id="1338492"><a href="/gostd/compress/bzip2/bzip2.go.html#1338429">symbol</a></span><span class="op" id="1338498">)</span><span class="op" id="1338499">)</span>&nbsp;<span class="op" id="1338501">!=</span>&nbsp;<span class="num" id="1338504">0</span>&nbsp;<span class="op" id="1338506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338513"><a href="/gostd/compress/bzip2/bzip2.go.html#1338236">symbolPresent</a></span><span class="op" id="1338526">[</span><span class="num" id="1338527">16</span><span class="op" id="1338529">*</span><span class="ident" id="1338530"><a href="/gostd/compress/bzip2/bzip2.go.html#1338293">symRange</a></span><span class="op" id="1338538">+</span><span class="ident" id="1338539"><a href="/gostd/compress/bzip2/bzip2.go.html#1338429">symbol</a></span><span class="op" id="1338545">]</span>&nbsp;<span class="op" id="1338547">=</span>&nbsp;<span class="builtintype" id="1338549">true</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338559"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span><span class="op" id="1338569">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338588">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338592">if</span>&nbsp;<span class="ident" id="1338595"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span>&nbsp;<span class="op" id="1338606">==</span>&nbsp;<span class="num" id="1338609">0</span>&nbsp;<span class="op" id="1338611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338615">//&nbsp;There&nbsp;must&nbsp;be&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338649">return</span>&nbsp;<span class="ident" id="1338656"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1338671">(</span><span class="string" id="1338672">&#34;no&nbsp;symbols&nbsp;in&nbsp;input&#34;</span><span class="op" id="1338693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338696">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338700">//&nbsp;A&nbsp;block&nbsp;uses&nbsp;between&nbsp;two&nbsp;and&nbsp;six&nbsp;different&nbsp;Huffman&nbsp;trees.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338762">numHuffmanTrees</span>&nbsp;<span class="op" id="1338778">:=</span>&nbsp;<span class="ident" id="1338781"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1338783">.</span><span class="ident" id="1338784"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1338792">(</span><span class="num" id="1338793">3</span><span class="op" id="1338794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338797">if</span>&nbsp;<span class="ident" id="1338800"><a href="/gostd/compress/bzip2/bzip2.go.html#1338762">numHuffmanTrees</a></span>&nbsp;<span class="op" id="1338816">&lt;</span>&nbsp;<span class="num" id="1338818">2</span>&nbsp;<span class="op" id="1338820">||</span>&nbsp;<span class="ident" id="1338823"><a href="/gostd/compress/bzip2/bzip2.go.html#1338762">numHuffmanTrees</a></span>&nbsp;<span class="op" id="1338839">&gt;</span>&nbsp;<span class="num" id="1338841">6</span>&nbsp;<span class="op" id="1338843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1338847">return</span>&nbsp;<span class="ident" id="1338854"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1338869">(</span><span class="string" id="1338870">&#34;invalid&nbsp;number&nbsp;of&nbsp;Huffman&nbsp;trees&#34;</span><span class="op" id="1338903">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1338906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338910">//&nbsp;The&nbsp;Huffman&nbsp;tree&nbsp;can&nbsp;switch&nbsp;every&nbsp;50&nbsp;symbols&nbsp;so&nbsp;there&#39;s&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338980">//&nbsp;tree&nbsp;indexes&nbsp;telling&nbsp;us&nbsp;which&nbsp;tree&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;50&nbsp;symbol&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339052">numSelectors</span>&nbsp;<span class="op" id="1339065">:=</span>&nbsp;<span class="ident" id="1339068"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1339070">.</span><span class="ident" id="1339071"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1339079">(</span><span class="num" id="1339080">15</span><span class="op" id="1339082">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339085">treeIndexes</span>&nbsp;<span class="op" id="1339097">:=</span>&nbsp;<span class="builtinfunc" id="1339100">make</span><span class="op" id="1339104">(</span><span class="op" id="1339105">[</span><span class="op" id="1339106">]</span><span class="builtintype" id="1339107">uint8</span><span class="op" id="1339112">,</span>&nbsp;<span class="ident" id="1339114"><a href="/gostd/compress/bzip2/bzip2.go.html#1339052">numSelectors</a></span><span class="op" id="1339126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339130">//&nbsp;The&nbsp;tree&nbsp;indexes&nbsp;are&nbsp;move-to-front&nbsp;transformed&nbsp;and&nbsp;stored&nbsp;as&nbsp;unary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339201">//&nbsp;numbers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339214">mtfTreeDecoder</span>&nbsp;<span class="op" id="1339229">:=</span>&nbsp;<span class="ident" id="1339232"><a href="/gostd/compress/bzip2/move_to_front.go.html#1353438">newMTFDecoderWithRange</a></span><span class="op" id="1339254">(</span><span class="ident" id="1339255"><a href="/gostd/compress/bzip2/bzip2.go.html#1338762">numHuffmanTrees</a></span><span class="op" id="1339270">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339273">for</span>&nbsp;<span class="ident" id="1339277">i</span>&nbsp;<span class="op" id="1339279">:=</span>&nbsp;<span class="keyword" id="1339282">range</span>&nbsp;<span class="ident" id="1339288"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span>&nbsp;<span class="op" id="1339300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339304">c</span>&nbsp;<span class="op" id="1339306">:=</span>&nbsp;<span class="num" id="1339309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339313">for</span>&nbsp;<span class="op" id="1339317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339322">inc</span>&nbsp;<span class="op" id="1339326">:=</span>&nbsp;<span class="ident" id="1339329"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1339331">.</span><span class="ident" id="1339332"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1339340">(</span><span class="num" id="1339341">1</span><span class="op" id="1339342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339347">if</span>&nbsp;<span class="ident" id="1339350"><a href="/gostd/compress/bzip2/bzip2.go.html#1339322">inc</a></span>&nbsp;<span class="op" id="1339354">==</span>&nbsp;<span class="num" id="1339357">0</span>&nbsp;<span class="op" id="1339359">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339365">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339379"><a href="/gostd/compress/bzip2/bzip2.go.html#1339304">c</a></span><span class="op" id="1339380">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339389">if</span>&nbsp;<span class="ident" id="1339392"><a href="/gostd/compress/bzip2/bzip2.go.html#1339304">c</a></span>&nbsp;<span class="op" id="1339394">&gt;=</span>&nbsp;<span class="ident" id="1339397"><a href="/gostd/compress/bzip2/bzip2.go.html#1338762">numHuffmanTrees</a></span>&nbsp;<span class="op" id="1339413">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339418">return</span>&nbsp;<span class="ident" id="1339425"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1339440">(</span><span class="string" id="1339441">&#34;tree&nbsp;index&nbsp;too&nbsp;large&#34;</span><span class="op" id="1339463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339471"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1339482">[</span><span class="ident" id="1339483"><a href="/gostd/compress/bzip2/bzip2.go.html#1339277">i</a></span><span class="op" id="1339484">]</span>&nbsp;<span class="op" id="1339486">=</span>&nbsp;<span class="builtintype" id="1339488">uint8</span><span class="op" id="1339493">(</span><span class="ident" id="1339494"><a href="/gostd/compress/bzip2/bzip2.go.html#1339214">mtfTreeDecoder</a></span><span class="op" id="1339508">.</span><span class="ident" id="1339509"><a href="/gostd/compress/bzip2/move_to_front.go.html#1353697">Decode</a></span><span class="op" id="1339515">(</span><span class="ident" id="1339516"><a href="/gostd/compress/bzip2/bzip2.go.html#1339304">c</a></span><span class="op" id="1339517">)</span><span class="op" id="1339518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339525">//&nbsp;The&nbsp;list&nbsp;of&nbsp;symbols&nbsp;for&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;taken&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339595">//&nbsp;the&nbsp;previously&nbsp;decoded&nbsp;symbol&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339637">symbols</span>&nbsp;<span class="op" id="1339645">:=</span>&nbsp;<span class="builtinfunc" id="1339648">make</span><span class="op" id="1339652">(</span><span class="op" id="1339653">[</span><span class="op" id="1339654">]</span><span class="builtintype" id="1339655">byte</span><span class="op" id="1339659">,</span>&nbsp;<span class="ident" id="1339661"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span><span class="op" id="1339671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339674">nextSymbol</span>&nbsp;<span class="op" id="1339685">:=</span>&nbsp;<span class="num" id="1339688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339691">for</span>&nbsp;<span class="ident" id="1339695">i</span>&nbsp;<span class="op" id="1339697">:=</span>&nbsp;<span class="num" id="1339700">0</span><span class="op" id="1339701">;</span>&nbsp;<span class="ident" id="1339703"><a href="/gostd/compress/bzip2/bzip2.go.html#1339695">i</a></span>&nbsp;<span class="op" id="1339705">&lt;</span>&nbsp;<span class="num" id="1339707">256</span><span class="op" id="1339710">;</span>&nbsp;<span class="ident" id="1339712"><a href="/gostd/compress/bzip2/bzip2.go.html#1339695">i</a></span><span class="op" id="1339713">++</span>&nbsp;<span class="op" id="1339716">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1339720">if</span>&nbsp;<span class="ident" id="1339723"><a href="/gostd/compress/bzip2/bzip2.go.html#1338236">symbolPresent</a></span><span class="op" id="1339736">[</span><span class="ident" id="1339737"><a href="/gostd/compress/bzip2/bzip2.go.html#1339695">i</a></span><span class="op" id="1339738">]</span>&nbsp;<span class="op" id="1339740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339745"><a href="/gostd/compress/bzip2/bzip2.go.html#1339637">symbols</a></span><span class="op" id="1339752">[</span><span class="ident" id="1339753"><a href="/gostd/compress/bzip2/bzip2.go.html#1339674">nextSymbol</a></span><span class="op" id="1339763">]</span>&nbsp;<span class="op" id="1339765">=</span>&nbsp;<span class="builtintype" id="1339767">byte</span><span class="op" id="1339771">(</span><span class="ident" id="1339772"><a href="/gostd/compress/bzip2/bzip2.go.html#1339695">i</a></span><span class="op" id="1339773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339778"><a href="/gostd/compress/bzip2/bzip2.go.html#1339674">nextSymbol</a></span><span class="op" id="1339788">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339796">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339799">mtf</span>&nbsp;<span class="op" id="1339803">:=</span>&nbsp;<span class="ident" id="1339806"><a href="/gostd/compress/bzip2/move_to_front.go.html#1353186">newMTFDecoder</a></span><span class="op" id="1339819">(</span><span class="ident" id="1339820"><a href="/gostd/compress/bzip2/bzip2.go.html#1339637">symbols</a></span><span class="op" id="1339827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339831"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span>&nbsp;<span class="op" id="1339842">+=</span>&nbsp;<span class="num" id="1339845">2</span>&nbsp;<span class="comment" id="1339847">//&nbsp;to&nbsp;account&nbsp;for&nbsp;RUNA&nbsp;and&nbsp;RUNB&nbsp;symbols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1339888">huffmanTrees</span>&nbsp;<span class="op" id="1339901">:=</span>&nbsp;<span class="builtinfunc" id="1339904">make</span><span class="op" id="1339908">(</span><span class="op" id="1339909">[</span><span class="op" id="1339910">]</span><span class="ident" id="1339911"><a href="/gostd/compress/bzip2/huffman.go.html#1345375">huffmanTree</a></span><span class="op" id="1339922">,</span>&nbsp;<span class="ident" id="1339924"><a href="/gostd/compress/bzip2/bzip2.go.html#1338762">numHuffmanTrees</a></span><span class="op" id="1339939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1339943">//&nbsp;Now&nbsp;we&nbsp;decode&nbsp;the&nbsp;arrays&nbsp;of&nbsp;code-lengths&nbsp;for&nbsp;each&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340003">lengths</span>&nbsp;<span class="op" id="1340011">:=</span>&nbsp;<span class="builtinfunc" id="1340014">make</span><span class="op" id="1340018">(</span><span class="op" id="1340019">[</span><span class="op" id="1340020">]</span><span class="builtintype" id="1340021">uint8</span><span class="op" id="1340026">,</span>&nbsp;<span class="ident" id="1340028"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span><span class="op" id="1340038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340041">for</span>&nbsp;<span class="ident" id="1340045">i</span>&nbsp;<span class="op" id="1340047">:=</span>&nbsp;<span class="keyword" id="1340050">range</span>&nbsp;<span class="ident" id="1340056"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span>&nbsp;<span class="op" id="1340069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340073">//&nbsp;The&nbsp;code&nbsp;lengths&nbsp;are&nbsp;delta&nbsp;encoded&nbsp;from&nbsp;a&nbsp;5-bit&nbsp;base&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340138">length</span>&nbsp;<span class="op" id="1340145">:=</span>&nbsp;<span class="ident" id="1340148"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1340150">.</span><span class="ident" id="1340151"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331347">ReadBits</a></span><span class="op" id="1340159">(</span><span class="num" id="1340160">5</span><span class="op" id="1340161">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340165">for</span>&nbsp;<span class="ident" id="1340169">j</span>&nbsp;<span class="op" id="1340171">:=</span>&nbsp;<span class="keyword" id="1340174">range</span>&nbsp;<span class="ident" id="1340180"><a href="/gostd/compress/bzip2/bzip2.go.html#1340003">lengths</a></span>&nbsp;<span class="op" id="1340188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340193">for</span>&nbsp;<span class="op" id="1340197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340203">if</span>&nbsp;<span class="op" id="1340206">!</span><span class="ident" id="1340207"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1340209">.</span><span class="ident" id="1340210"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331446">ReadBit</a></span><span class="op" id="1340217">(</span><span class="op" id="1340218">)</span>&nbsp;<span class="op" id="1340220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340227">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340237">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340243">if</span>&nbsp;<span class="ident" id="1340246"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1340248">.</span><span class="ident" id="1340249"><a href="/gostd/compress/bzip2/bit_reader.go.html#1331446">ReadBit</a></span><span class="op" id="1340256">(</span><span class="op" id="1340257">)</span>&nbsp;<span class="op" id="1340259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340266"><a href="/gostd/compress/bzip2/bzip2.go.html#1340138">length</a></span><span class="op" id="1340272">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340279">}</span>&nbsp;<span class="keyword" id="1340281">else</span>&nbsp;<span class="op" id="1340286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340293"><a href="/gostd/compress/bzip2/bzip2.go.html#1340138">length</a></span><span class="op" id="1340299">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340306">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340316">if</span>&nbsp;<span class="ident" id="1340319"><a href="/gostd/compress/bzip2/bzip2.go.html#1340138">length</a></span>&nbsp;<span class="op" id="1340326">&lt;</span>&nbsp;<span class="num" id="1340328">0</span>&nbsp;<span class="op" id="1340330">||</span>&nbsp;<span class="ident" id="1340333"><a href="/gostd/compress/bzip2/bzip2.go.html#1340138">length</a></span>&nbsp;<span class="op" id="1340340">&gt;</span>&nbsp;<span class="num" id="1340342">20</span>&nbsp;<span class="op" id="1340345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340351">return</span>&nbsp;<span class="ident" id="1340358"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1340373">(</span><span class="string" id="1340374">&#34;Huffman&nbsp;length&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1340403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340413"><a href="/gostd/compress/bzip2/bzip2.go.html#1340003">lengths</a></span><span class="op" id="1340420">[</span><span class="ident" id="1340421"><a href="/gostd/compress/bzip2/bzip2.go.html#1340169">j</a></span><span class="op" id="1340422">]</span>&nbsp;<span class="op" id="1340424">=</span>&nbsp;<span class="builtintype" id="1340426">uint8</span><span class="op" id="1340431">(</span><span class="ident" id="1340432"><a href="/gostd/compress/bzip2/bzip2.go.html#1340138">length</a></span><span class="op" id="1340438">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340446"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span><span class="op" id="1340458">[</span><span class="ident" id="1340459"><a href="/gostd/compress/bzip2/bzip2.go.html#1340045">i</a></span><span class="op" id="1340460">]</span><span class="op" id="1340461">,</span>&nbsp;<span class="ident" id="1340463"><a href="/gostd/compress/bzip2/bzip2.go.html#1337655">err</a></span>&nbsp;<span class="op" id="1340467">=</span>&nbsp;<span class="ident" id="1340469"><a href="/gostd/compress/bzip2/huffman.go.html#1347017">newHuffmanTree</a></span><span class="op" id="1340483">(</span><span class="ident" id="1340484"><a href="/gostd/compress/bzip2/bzip2.go.html#1340003">lengths</a></span><span class="op" id="1340491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340495">if</span>&nbsp;<span class="ident" id="1340498"><a href="/gostd/compress/bzip2/bzip2.go.html#1337655">err</a></span>&nbsp;<span class="op" id="1340502">!=</span>&nbsp;<span class="builtintype" id="1340505">nil</span>&nbsp;<span class="op" id="1340509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340514">return</span>&nbsp;<span class="ident" id="1340521"><a href="/gostd/compress/bzip2/bzip2.go.html#1337655">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340527">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340534">selectorIndex</span>&nbsp;<span class="op" id="1340548">:=</span>&nbsp;<span class="num" id="1340551">1</span>&nbsp;<span class="comment" id="1340553">//&nbsp;the&nbsp;next&nbsp;tree&nbsp;index&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340584">if</span>&nbsp;<span class="builtinfunc" id="1340587">len</span><span class="op" id="1340590">(</span><span class="ident" id="1340591"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1340602">)</span>&nbsp;<span class="op" id="1340604">==</span>&nbsp;<span class="num" id="1340607">0</span>&nbsp;<span class="op" id="1340609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340613">return</span>&nbsp;<span class="ident" id="1340620"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1340635">(</span><span class="string" id="1340636">&#34;no&nbsp;tree&nbsp;selectors&nbsp;given&#34;</span><span class="op" id="1340661">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340667">if</span>&nbsp;<span class="builtintype" id="1340670">int</span><span class="op" id="1340673">(</span><span class="ident" id="1340674"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1340685">[</span><span class="num" id="1340686">0</span><span class="op" id="1340687">]</span><span class="op" id="1340688">)</span>&nbsp;<span class="op" id="1340690">&gt;=</span>&nbsp;<span class="builtinfunc" id="1340693">len</span><span class="op" id="1340696">(</span><span class="ident" id="1340697"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span><span class="op" id="1340709">)</span>&nbsp;<span class="op" id="1340711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1340715">return</span>&nbsp;<span class="ident" id="1340722"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1340737">(</span><span class="string" id="1340738">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1340766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340772">currentHuffmanTree</span>&nbsp;<span class="op" id="1340791">:=</span>&nbsp;<span class="ident" id="1340794"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span><span class="op" id="1340806">[</span><span class="ident" id="1340807"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1340818">[</span><span class="num" id="1340819">0</span><span class="op" id="1340820">]</span><span class="op" id="1340821">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1340824">bufIndex</span>&nbsp;<span class="op" id="1340833">:=</span>&nbsp;<span class="num" id="1340836">0</span>&nbsp;<span class="comment" id="1340838">//&nbsp;indexes&nbsp;bz2.buf,&nbsp;the&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340878">//&nbsp;The&nbsp;output&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;transform&nbsp;is&nbsp;run-length&nbsp;encoded&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340950">//&nbsp;we&nbsp;merge&nbsp;the&nbsp;decoding&nbsp;into&nbsp;the&nbsp;Huffman&nbsp;parsing&nbsp;loop.&nbsp;These&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341017">//&nbsp;variables&nbsp;accumulate&nbsp;the&nbsp;repeat&nbsp;count.&nbsp;See&nbsp;the&nbsp;Wikipedia&nbsp;page&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341087">//&nbsp;details.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341100">repeat</span>&nbsp;<span class="op" id="1341107">:=</span>&nbsp;<span class="num" id="1341110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341113">repeat_power</span>&nbsp;<span class="op" id="1341126">:=</span>&nbsp;<span class="num" id="1341129">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341133">//&nbsp;The&nbsp;`C&#39;&nbsp;array&nbsp;(used&nbsp;by&nbsp;the&nbsp;inverse&nbsp;BWT)&nbsp;needs&nbsp;to&nbsp;be&nbsp;zero&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341207">for</span>&nbsp;<span class="ident" id="1341211">i</span>&nbsp;<span class="op" id="1341213">:=</span>&nbsp;<span class="keyword" id="1341216">range</span>&nbsp;<span class="ident" id="1341222"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1341225">.</span><span class="ident" id="1341226"><a href="/gostd/compress/bzip2/bzip2.go.html#1332751">c</a></span>&nbsp;<span class="op" id="1341228">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341232"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1341235">.</span><span class="ident" id="1341236"><a href="/gostd/compress/bzip2/bzip2.go.html#1332751">c</a></span><span class="op" id="1341237">[</span><span class="ident" id="1341238"><a href="/gostd/compress/bzip2/bzip2.go.html#1341211">i</a></span><span class="op" id="1341239">]</span>&nbsp;<span class="op" id="1341241">=</span>&nbsp;<span class="num" id="1341243">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341250">decoded</span>&nbsp;<span class="op" id="1341258">:=</span>&nbsp;<span class="num" id="1341261">0</span>&nbsp;<span class="comment" id="1341263">//&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;symbols&nbsp;decoded&nbsp;by&nbsp;the&nbsp;current&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341325">for</span>&nbsp;<span class="op" id="1341329">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341333">if</span>&nbsp;<span class="ident" id="1341336"><a href="/gostd/compress/bzip2/bzip2.go.html#1341250">decoded</a></span>&nbsp;<span class="op" id="1341344">==</span>&nbsp;<span class="num" id="1341347">50</span>&nbsp;<span class="op" id="1341350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341355">if</span>&nbsp;<span class="ident" id="1341358"><a href="/gostd/compress/bzip2/bzip2.go.html#1340534">selectorIndex</a></span>&nbsp;<span class="op" id="1341372">&gt;=</span>&nbsp;<span class="ident" id="1341375"><a href="/gostd/compress/bzip2/bzip2.go.html#1339052">numSelectors</a></span>&nbsp;<span class="op" id="1341388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341394">return</span>&nbsp;<span class="ident" id="1341401"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1341416">(</span><span class="string" id="1341417">&#34;insufficient&nbsp;selector&nbsp;indices&nbsp;for&nbsp;number&nbsp;of&nbsp;symbols&#34;</span><span class="op" id="1341470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341480">if</span>&nbsp;<span class="builtintype" id="1341483">int</span><span class="op" id="1341486">(</span><span class="ident" id="1341487"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1341498">[</span><span class="ident" id="1341499"><a href="/gostd/compress/bzip2/bzip2.go.html#1340534">selectorIndex</a></span><span class="op" id="1341512">]</span><span class="op" id="1341513">)</span>&nbsp;<span class="op" id="1341515">&gt;=</span>&nbsp;<span class="builtinfunc" id="1341518">len</span><span class="op" id="1341521">(</span><span class="ident" id="1341522"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span><span class="op" id="1341534">)</span>&nbsp;<span class="op" id="1341536">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341542">return</span>&nbsp;<span class="ident" id="1341549"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1341564">(</span><span class="string" id="1341565">&#34;tree&nbsp;selector&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1341593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341603"><a href="/gostd/compress/bzip2/bzip2.go.html#1340772">currentHuffmanTree</a></span>&nbsp;<span class="op" id="1341622">=</span>&nbsp;<span class="ident" id="1341624"><a href="/gostd/compress/bzip2/bzip2.go.html#1339888">huffmanTrees</a></span><span class="op" id="1341636">[</span><span class="ident" id="1341637"><a href="/gostd/compress/bzip2/bzip2.go.html#1339085">treeIndexes</a></span><span class="op" id="1341648">[</span><span class="ident" id="1341649"><a href="/gostd/compress/bzip2/bzip2.go.html#1340534">selectorIndex</a></span><span class="op" id="1341662">]</span><span class="op" id="1341663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341668"><a href="/gostd/compress/bzip2/bzip2.go.html#1340534">selectorIndex</a></span><span class="op" id="1341681">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341687"><a href="/gostd/compress/bzip2/bzip2.go.html#1341250">decoded</a></span>&nbsp;<span class="op" id="1341695">=</span>&nbsp;<span class="num" id="1341697">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341706">v</span>&nbsp;<span class="op" id="1341708">:=</span>&nbsp;<span class="ident" id="1341711"><a href="/gostd/compress/bzip2/bzip2.go.html#1340772">currentHuffmanTree</a></span><span class="op" id="1341729">.</span><span class="ident" id="1341730"><a href="/gostd/compress/bzip2/huffman.go.html#1346383">Decode</a></span><span class="op" id="1341736">(</span><span class="ident" id="1341737"><a href="/gostd/compress/bzip2/bzip2.go.html#1337669">br</a></span><span class="op" id="1341739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341743"><a href="/gostd/compress/bzip2/bzip2.go.html#1341250">decoded</a></span><span class="op" id="1341750">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341756">if</span>&nbsp;<span class="ident" id="1341759"><a href="/gostd/compress/bzip2/bzip2.go.html#1341706">v</a></span>&nbsp;<span class="op" id="1341761">&lt;</span>&nbsp;<span class="num" id="1341763">2</span>&nbsp;<span class="op" id="1341765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341770">//&nbsp;This&nbsp;is&nbsp;either&nbsp;the&nbsp;RUNA&nbsp;or&nbsp;RUNB&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1341816">if</span>&nbsp;<span class="ident" id="1341819"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1341826">==</span>&nbsp;<span class="num" id="1341829">0</span>&nbsp;<span class="op" id="1341831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341837"><a href="/gostd/compress/bzip2/bzip2.go.html#1341113">repeat_power</a></span>&nbsp;<span class="op" id="1341850">=</span>&nbsp;<span class="num" id="1341852">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341857">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341862"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1341869">+=</span>&nbsp;<span class="ident" id="1341872"><a href="/gostd/compress/bzip2/bzip2.go.html#1341113">repeat_power</a></span>&nbsp;<span class="op" id="1341885">&lt;&lt;</span>&nbsp;<span class="ident" id="1341888"><a href="/gostd/compress/bzip2/bzip2.go.html#1341706">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1341893"><a href="/gostd/compress/bzip2/bzip2.go.html#1341113">repeat_power</a></span>&nbsp;<span class="op" id="1341906">&lt;&lt;=</span>&nbsp;<span class="num" id="1341910">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341916">//&nbsp;This&nbsp;limit&nbsp;of&nbsp;2&nbsp;million&nbsp;comes&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341974">//&nbsp;code.&nbsp;It&nbsp;prevents&nbsp;repeat&nbsp;from&nbsp;overflowing.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342023">if</span>&nbsp;<span class="ident" id="1342026"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1342033">&gt;</span>&nbsp;<span class="num" id="1342035">2</span><span class="op" id="1342036">*</span><span class="num" id="1342037">1024</span><span class="op" id="1342041">*</span><span class="num" id="1342042">1024</span>&nbsp;<span class="op" id="1342047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342053">return</span>&nbsp;<span class="ident" id="1342060"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1342075">(</span><span class="string" id="1342076">&#34;repeat&nbsp;count&nbsp;too&nbsp;large&#34;</span><span class="op" id="1342100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342110">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342121">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342126">if</span>&nbsp;<span class="ident" id="1342129"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1342136">&gt;</span>&nbsp;<span class="num" id="1342138">0</span>&nbsp;<span class="op" id="1342140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342145">//&nbsp;We&nbsp;have&nbsp;decoded&nbsp;a&nbsp;complete&nbsp;run-length&nbsp;so&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342203">//&nbsp;replicate&nbsp;the&nbsp;last&nbsp;output&nbsp;symbol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342243">if</span>&nbsp;<span class="ident" id="1342246"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1342253">&gt;</span>&nbsp;<span class="ident" id="1342255"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1342258">.</span><span class="ident" id="1342259"><a href="/gostd/compress/bzip2/bzip2.go.html#1332605">blockSize</a></span><span class="op" id="1342268">-</span><span class="ident" id="1342269"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span>&nbsp;<span class="op" id="1342278">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342284">return</span>&nbsp;<span class="ident" id="1342291"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1342306">(</span><span class="string" id="1342307">&#34;repeats&nbsp;past&nbsp;end&nbsp;of&nbsp;block&#34;</span><span class="op" id="1342334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342344">for</span>&nbsp;<span class="ident" id="1342348">i</span>&nbsp;<span class="op" id="1342350">:=</span>&nbsp;<span class="num" id="1342353">0</span><span class="op" id="1342354">;</span>&nbsp;<span class="ident" id="1342356"><a href="/gostd/compress/bzip2/bzip2.go.html#1342348">i</a></span>&nbsp;<span class="op" id="1342358">&lt;</span>&nbsp;<span class="ident" id="1342360"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span><span class="op" id="1342366">;</span>&nbsp;<span class="ident" id="1342368"><a href="/gostd/compress/bzip2/bzip2.go.html#1342348">i</a></span><span class="op" id="1342369">++</span>&nbsp;<span class="op" id="1342372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342378">b</span>&nbsp;<span class="op" id="1342380">:=</span>&nbsp;<span class="builtintype" id="1342383">byte</span><span class="op" id="1342387">(</span><span class="ident" id="1342388"><a href="/gostd/compress/bzip2/bzip2.go.html#1339799">mtf</a></span><span class="op" id="1342391">.</span><span class="ident" id="1342392"><a href="/gostd/compress/bzip2/move_to_front.go.html#1354108">First</a></span><span class="op" id="1342397">(</span><span class="op" id="1342398">)</span><span class="op" id="1342399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342405"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1342408">.</span><span class="ident" id="1342409"><a href="/gostd/compress/bzip2/bzip2.go.html#1332813">tt</a></span><span class="op" id="1342411">[</span><span class="ident" id="1342412"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1342420">]</span>&nbsp;<span class="op" id="1342422">=</span>&nbsp;<span class="builtintype" id="1342424">uint32</span><span class="op" id="1342430">(</span><span class="ident" id="1342431"><a href="/gostd/compress/bzip2/bzip2.go.html#1342378">b</a></span><span class="op" id="1342432">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342438"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1342441">.</span><span class="ident" id="1342442"><a href="/gostd/compress/bzip2/bzip2.go.html#1332751">c</a></span><span class="op" id="1342443">[</span><span class="ident" id="1342444"><a href="/gostd/compress/bzip2/bzip2.go.html#1342378">b</a></span><span class="op" id="1342445">]</span><span class="op" id="1342446">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342453"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1342461">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1342472"><a href="/gostd/compress/bzip2/bzip2.go.html#1341100">repeat</a></span>&nbsp;<span class="op" id="1342479">=</span>&nbsp;<span class="num" id="1342481">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342485">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342490">if</span>&nbsp;<span class="builtintype" id="1342493">int</span><span class="op" id="1342496">(</span><span class="ident" id="1342497"><a href="/gostd/compress/bzip2/bzip2.go.html#1341706">v</a></span><span class="op" id="1342498">)</span>&nbsp;<span class="op" id="1342500">==</span>&nbsp;<span class="ident" id="1342503"><a href="/gostd/compress/bzip2/bzip2.go.html#1338272">numSymbols</a></span><span class="op" id="1342513">-</span><span class="num" id="1342514">1</span>&nbsp;<span class="op" id="1342516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342521">//&nbsp;This&nbsp;is&nbsp;the&nbsp;EOF&nbsp;symbol.&nbsp;Because&nbsp;it&#39;s&nbsp;always&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342578">//&nbsp;end&nbsp;of&nbsp;the&nbsp;move-to-front&nbsp;list,&nbsp;and&nbsp;never&nbsp;gets&nbsp;moved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342636">//&nbsp;to&nbsp;the&nbsp;front,&nbsp;it&nbsp;has&nbsp;this&nbsp;unique&nbsp;value.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1342682">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342695">//&nbsp;Since&nbsp;two&nbsp;metasymbols&nbsp;(RUNA&nbsp;and&nbsp;RUNB)&nbsp;have&nbsp;values&nbsp;0&nbsp;and&nbsp;1,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342759">//&nbsp;one&nbsp;would&nbsp;expect&nbsp;|v-2|&nbsp;to&nbsp;be&nbsp;passed&nbsp;to&nbsp;the&nbsp;MTF&nbsp;decoder.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342820">//&nbsp;However,&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;MTF&nbsp;list&nbsp;is&nbsp;never&nbsp;referenced&nbsp;as&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342886">//&nbsp;it&#39;s&nbsp;always&nbsp;referenced&nbsp;with&nbsp;a&nbsp;run-length&nbsp;of&nbsp;1.&nbsp;Thus&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342945">//&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;encoded&nbsp;and&nbsp;we&nbsp;have&nbsp;|v-1|&nbsp;in&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343007">//&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343018">b</span>&nbsp;<span class="op" id="1343020">:=</span>&nbsp;<span class="builtintype" id="1343023">byte</span><span class="op" id="1343027">(</span><span class="ident" id="1343028"><a href="/gostd/compress/bzip2/bzip2.go.html#1339799">mtf</a></span><span class="op" id="1343031">.</span><span class="ident" id="1343032"><a href="/gostd/compress/bzip2/move_to_front.go.html#1353697">Decode</a></span><span class="op" id="1343038">(</span><span class="builtintype" id="1343039">int</span><span class="op" id="1343042">(</span><span class="ident" id="1343043"><a href="/gostd/compress/bzip2/bzip2.go.html#1341706">v</a></span>&nbsp;<span class="op" id="1343045">-</span>&nbsp;<span class="num" id="1343047">1</span><span class="op" id="1343048">)</span><span class="op" id="1343049">)</span><span class="op" id="1343050">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1343054">if</span>&nbsp;<span class="ident" id="1343057"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span>&nbsp;<span class="op" id="1343066">&gt;=</span>&nbsp;<span class="ident" id="1343069"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343072">.</span><span class="ident" id="1343073"><a href="/gostd/compress/bzip2/bzip2.go.html#1332605">blockSize</a></span>&nbsp;<span class="op" id="1343083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1343088">return</span>&nbsp;<span class="ident" id="1343095"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1343110">(</span><span class="string" id="1343111">&#34;data&nbsp;exceeds&nbsp;block&nbsp;size&#34;</span><span class="op" id="1343136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1343140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343144"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343147">.</span><span class="ident" id="1343148"><a href="/gostd/compress/bzip2/bzip2.go.html#1332813">tt</a></span><span class="op" id="1343150">[</span><span class="ident" id="1343151"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1343159">]</span>&nbsp;<span class="op" id="1343161">=</span>&nbsp;<span class="builtintype" id="1343163">uint32</span><span class="op" id="1343169">(</span><span class="ident" id="1343170"><a href="/gostd/compress/bzip2/bzip2.go.html#1343018">b</a></span><span class="op" id="1343171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343175"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343178">.</span><span class="ident" id="1343179"><a href="/gostd/compress/bzip2/bzip2.go.html#1332751">c</a></span><span class="op" id="1343180">[</span><span class="ident" id="1343181"><a href="/gostd/compress/bzip2/bzip2.go.html#1343018">b</a></span><span class="op" id="1343182">]</span><span class="op" id="1343183">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343188"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1343196">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1343200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1343204">if</span>&nbsp;<span class="ident" id="1343207"><a href="/gostd/compress/bzip2/bzip2.go.html#1337994">origPtr</a></span>&nbsp;<span class="op" id="1343215">&gt;=</span>&nbsp;<span class="builtintype" id="1343218">uint</span><span class="op" id="1343222">(</span><span class="ident" id="1343223"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1343231">)</span>&nbsp;<span class="op" id="1343233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1343237">return</span>&nbsp;<span class="ident" id="1343244"><a href="/gostd/compress/bzip2/bzip2.go.html#1332273">StructuralError</a></span><span class="op" id="1343259">(</span><span class="string" id="1343260">&#34;origPtr&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="1343283">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1343286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343290">//&nbsp;We&nbsp;have&nbsp;completed&nbsp;the&nbsp;entropy&nbsp;decoding.&nbsp;Now&nbsp;we&nbsp;can&nbsp;perform&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1343357">//&nbsp;inverse&nbsp;BWT&nbsp;and&nbsp;setup&nbsp;the&nbsp;RLE&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343399"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343402">.</span><span class="ident" id="1343403"><a href="/gostd/compress/bzip2/bzip2.go.html#1332995">preRLE</a></span>&nbsp;<span class="op" id="1343410">=</span>&nbsp;<span class="ident" id="1343412"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343415">.</span><span class="ident" id="1343416"><a href="/gostd/compress/bzip2/bzip2.go.html#1332813">tt</a></span><span class="op" id="1343418">[</span><span class="op" id="1343419">:</span><span class="ident" id="1343420"><a href="/gostd/compress/bzip2/bzip2.go.html#1340824">bufIndex</a></span><span class="op" id="1343428">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343431"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343434">.</span><span class="ident" id="1343435"><a href="/gostd/compress/bzip2/bzip2.go.html#1333065">preRLEUsed</a></span>&nbsp;<span class="op" id="1343446">=</span>&nbsp;<span class="num" id="1343448">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343451"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343454">.</span><span class="ident" id="1343455"><a href="/gostd/compress/bzip2/bzip2.go.html#1332930">tPos</a></span>&nbsp;<span class="op" id="1343460">=</span>&nbsp;<span class="ident" id="1343462"><a href="/gostd/compress/bzip2/bzip2.go.html#1344177">inverseBWT</a></span><span class="op" id="1343472">(</span><span class="ident" id="1343473"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343476">.</span><span class="ident" id="1343477"><a href="/gostd/compress/bzip2/bzip2.go.html#1332995">preRLE</a></span><span class="op" id="1343483">,</span>&nbsp;<span class="ident" id="1343485"><a href="/gostd/compress/bzip2/bzip2.go.html#1337994">origPtr</a></span><span class="op" id="1343492">,</span>&nbsp;<span class="ident" id="1343494"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343497">.</span><span class="ident" id="1343498"><a href="/gostd/compress/bzip2/bzip2.go.html#1332751">c</a></span><span class="op" id="1343499">[</span><span class="op" id="1343500">:</span><span class="op" id="1343501">]</span><span class="op" id="1343502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343505"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343508">.</span><span class="ident" id="1343509"><a href="/gostd/compress/bzip2/bzip2.go.html#1333124">lastByte</a></span>&nbsp;<span class="op" id="1343518">=</span>&nbsp;<span class="op" id="1343520">-</span><span class="num" id="1343521">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343524"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343527">.</span><span class="ident" id="1343528"><a href="/gostd/compress/bzip2/bzip2.go.html#1333175">byteRepeats</a></span>&nbsp;<span class="op" id="1343540">=</span>&nbsp;<span class="num" id="1343542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1343545"><a href="/gostd/compress/bzip2/bzip2.go.html#1337629">bz2</a></span><span class="op" id="1343548">.</span><span class="ident" id="1343549"><a href="/gostd/compress/bzip2/bzip2.go.html#1333240">repeats</a></span>&nbsp;<span class="op" id="1343557">=</span>&nbsp;<span class="num" id="1343559">0</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1343563">return</span>&nbsp;<span class="builtintype" id="1343570">nil</span><br>
<span class="lineno"></span><span class="op" id="1343574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1343577">//&nbsp;inverseBWT&nbsp;implements&nbsp;the&nbsp;inverse&nbsp;Burrows-Wheeler&nbsp;transform&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno">450</span><span class="comment" id="1343656">//&nbsp;http://www.hpl.hp.com/techreports/Compaq-DEC/SRC-RR-124.pdf,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno"></span><span class="comment" id="1343733">//&nbsp;In&nbsp;that&nbsp;document,&nbsp;origPtr&nbsp;is&nbsp;called&nbsp;`I&#39;&nbsp;and&nbsp;c&nbsp;is&nbsp;the&nbsp;`C&#39;&nbsp;array&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1343809">//&nbsp;first&nbsp;pass&nbsp;over&nbsp;the&nbsp;data.&nbsp;It&#39;s&nbsp;an&nbsp;argument&nbsp;here&nbsp;because&nbsp;we&nbsp;merge&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="1343887">//&nbsp;pass&nbsp;with&nbsp;the&nbsp;Huffman&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="comment" id="1343922">//</span><br>
<span class="lineno">455</span><span class="comment" id="1343925">//&nbsp;This&nbsp;also&nbsp;implements&nbsp;the&nbsp;`single&nbsp;array&#39;&nbsp;method&nbsp;from&nbsp;the&nbsp;bzip2&nbsp;source&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1344002">//&nbsp;which&nbsp;leaves&nbsp;the&nbsp;output,&nbsp;still&nbsp;shuffled,&nbsp;in&nbsp;the&nbsp;bottom&nbsp;8&nbsp;bits&nbsp;of&nbsp;tt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1344082">//&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;top&nbsp;24-bits.&nbsp;The&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;byte&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1344159">//&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1344172">func</span>&nbsp;<span class="ident" id="1344177">inverseBWT</span><span class="op" id="1344187">(</span><span class="ident" id="1344188">tt</span>&nbsp;<span class="op" id="1344191">[</span><span class="op" id="1344192">]</span><span class="builtintype" id="1344193">uint32</span><span class="op" id="1344199">,</span>&nbsp;<span class="ident" id="1344201">origPtr</span>&nbsp;<span class="builtintype" id="1344209">uint</span><span class="op" id="1344213">,</span>&nbsp;<span class="ident" id="1344215">c</span>&nbsp;<span class="op" id="1344217">[</span><span class="op" id="1344218">]</span><span class="builtintype" id="1344219">uint</span><span class="op" id="1344223">)</span>&nbsp;<span class="builtintype" id="1344225">uint32</span>&nbsp;<span class="op" id="1344232">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344235">sum</span>&nbsp;<span class="op" id="1344239">:=</span>&nbsp;<span class="builtintype" id="1344242">uint</span><span class="op" id="1344246">(</span><span class="num" id="1344247">0</span><span class="op" id="1344248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344251">for</span>&nbsp;<span class="ident" id="1344255">i</span>&nbsp;<span class="op" id="1344257">:=</span>&nbsp;<span class="num" id="1344260">0</span><span class="op" id="1344261">;</span>&nbsp;<span class="ident" id="1344263"><a href="/gostd/compress/bzip2/bzip2.go.html#1344255">i</a></span>&nbsp;<span class="op" id="1344265">&lt;</span>&nbsp;<span class="num" id="1344267">256</span><span class="op" id="1344270">;</span>&nbsp;<span class="ident" id="1344272"><a href="/gostd/compress/bzip2/bzip2.go.html#1344255">i</a></span><span class="op" id="1344273">++</span>&nbsp;<span class="op" id="1344276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344280"><a href="/gostd/compress/bzip2/bzip2.go.html#1344235">sum</a></span>&nbsp;<span class="op" id="1344284">+=</span>&nbsp;<span class="ident" id="1344287"><a href="/gostd/compress/bzip2/bzip2.go.html#1344215">c</a></span><span class="op" id="1344288">[</span><span class="ident" id="1344289"><a href="/gostd/compress/bzip2/bzip2.go.html#1344255">i</a></span><span class="op" id="1344290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344294"><a href="/gostd/compress/bzip2/bzip2.go.html#1344215">c</a></span><span class="op" id="1344295">[</span><span class="ident" id="1344296"><a href="/gostd/compress/bzip2/bzip2.go.html#1344255">i</a></span><span class="op" id="1344297">]</span>&nbsp;<span class="op" id="1344299">=</span>&nbsp;<span class="ident" id="1344301"><a href="/gostd/compress/bzip2/bzip2.go.html#1344235">sum</a></span>&nbsp;<span class="op" id="1344305">-</span>&nbsp;<span class="ident" id="1344307"><a href="/gostd/compress/bzip2/bzip2.go.html#1344215">c</a></span><span class="op" id="1344308">[</span><span class="ident" id="1344309"><a href="/gostd/compress/bzip2/bzip2.go.html#1344255">i</a></span><span class="op" id="1344310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344313">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344317">for</span>&nbsp;<span class="ident" id="1344321">i</span>&nbsp;<span class="op" id="1344323">:=</span>&nbsp;<span class="keyword" id="1344326">range</span>&nbsp;<span class="ident" id="1344332"><a href="/gostd/compress/bzip2/bzip2.go.html#1344188">tt</a></span>&nbsp;<span class="op" id="1344335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344339">b</span>&nbsp;<span class="op" id="1344341">:=</span>&nbsp;<span class="ident" id="1344344"><a href="/gostd/compress/bzip2/bzip2.go.html#1344188">tt</a></span><span class="op" id="1344346">[</span><span class="ident" id="1344347"><a href="/gostd/compress/bzip2/bzip2.go.html#1344321">i</a></span><span class="op" id="1344348">]</span>&nbsp;<span class="op" id="1344350">&amp;</span>&nbsp;<span class="num" id="1344352">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344359"><a href="/gostd/compress/bzip2/bzip2.go.html#1344188">tt</a></span><span class="op" id="1344361">[</span><span class="ident" id="1344362"><a href="/gostd/compress/bzip2/bzip2.go.html#1344215">c</a></span><span class="op" id="1344363">[</span><span class="ident" id="1344364"><a href="/gostd/compress/bzip2/bzip2.go.html#1344339">b</a></span><span class="op" id="1344365">]</span><span class="op" id="1344366">]</span>&nbsp;<span class="op" id="1344368">|=</span>&nbsp;<span class="builtintype" id="1344371">uint32</span><span class="op" id="1344377">(</span><span class="ident" id="1344378"><a href="/gostd/compress/bzip2/bzip2.go.html#1344321">i</a></span><span class="op" id="1344379">)</span>&nbsp;<span class="op" id="1344381">&lt;&lt;</span>&nbsp;<span class="num" id="1344384">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344388"><a href="/gostd/compress/bzip2/bzip2.go.html#1344215">c</a></span><span class="op" id="1344389">[</span><span class="ident" id="1344390"><a href="/gostd/compress/bzip2/bzip2.go.html#1344339">b</a></span><span class="op" id="1344391">]</span><span class="op" id="1344392">++</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344400">return</span>&nbsp;<span class="ident" id="1344407"><a href="/gostd/compress/bzip2/bzip2.go.html#1344188">tt</a></span><span class="op" id="1344409">[</span><span class="ident" id="1344410"><a href="/gostd/compress/bzip2/bzip2.go.html#1344201">origPtr</a></span><span class="op" id="1344417">]</span>&nbsp;<span class="op" id="1344419">&gt;&gt;</span>&nbsp;<span class="num" id="1344422">8</span><br>
<span class="lineno"></span><span class="op" id="1344424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="comment" id="1344427">//&nbsp;This&nbsp;is&nbsp;a&nbsp;standard&nbsp;CRC32&nbsp;like&nbsp;in&nbsp;hash/crc32&nbsp;except&nbsp;that&nbsp;all&nbsp;the&nbsp;shifts&nbsp;are&nbsp;reversed,</span><br>
<span class="lineno"></span><span class="comment" id="1344515">//&nbsp;causing&nbsp;the&nbsp;bits&nbsp;in&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;processed&nbsp;in&nbsp;the&nbsp;reverse&nbsp;of&nbsp;the&nbsp;usual&nbsp;order.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1344600">var</span>&nbsp;<span class="ident" id="1344604">crctab</span>&nbsp;<span class="op" id="1344611">[</span><span class="num" id="1344612">256</span><span class="op" id="1344615">]</span><span class="builtintype" id="1344616">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="1344624">func</span>&nbsp;<span class="ident" id="1344629">init</span><span class="op" id="1344633">(</span><span class="op" id="1344634">)</span>&nbsp;<span class="op" id="1344636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344639">const</span>&nbsp;<span class="ident" id="1344645">poly</span>&nbsp;<span class="op" id="1344650">=</span>&nbsp;<span class="num" id="1344652">0x04C11DB7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344664">for</span>&nbsp;<span class="ident" id="1344668">i</span>&nbsp;<span class="op" id="1344670">:=</span>&nbsp;<span class="keyword" id="1344673">range</span>&nbsp;<span class="ident" id="1344679"><a href="/gostd/compress/bzip2/bzip2.go.html#1344604">crctab</a></span>&nbsp;<span class="op" id="1344686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344690">crc</span>&nbsp;<span class="op" id="1344694">:=</span>&nbsp;<span class="builtintype" id="1344697">uint32</span><span class="op" id="1344703">(</span><span class="ident" id="1344704"><a href="/gostd/compress/bzip2/bzip2.go.html#1344668">i</a></span><span class="op" id="1344705">)</span>&nbsp;<span class="op" id="1344707">&lt;&lt;</span>&nbsp;<span class="num" id="1344710">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344715">for</span>&nbsp;<span class="ident" id="1344719">j</span>&nbsp;<span class="op" id="1344721">:=</span>&nbsp;<span class="num" id="1344724">0</span><span class="op" id="1344725">;</span>&nbsp;<span class="ident" id="1344727"><a href="/gostd/compress/bzip2/bzip2.go.html#1344719">j</a></span>&nbsp;<span class="op" id="1344729">&lt;</span>&nbsp;<span class="num" id="1344731">8</span><span class="op" id="1344732">;</span>&nbsp;<span class="ident" id="1344734"><a href="/gostd/compress/bzip2/bzip2.go.html#1344719">j</a></span><span class="op" id="1344735">++</span>&nbsp;<span class="op" id="1344738">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1344743">if</span>&nbsp;<span class="ident" id="1344746"><a href="/gostd/compress/bzip2/bzip2.go.html#1344690">crc</a></span><span class="op" id="1344749">&amp;</span><span class="num" id="1344750">0x80000000</span>&nbsp;<span class="op" id="1344761">!=</span>&nbsp;<span class="num" id="1344764">0</span>&nbsp;<span class="op" id="1344766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344772"><a href="/gostd/compress/bzip2/bzip2.go.html#1344690">crc</a></span>&nbsp;<span class="op" id="1344776">=</span>&nbsp;<span class="op" id="1344778">(</span><span class="ident" id="1344779"><a href="/gostd/compress/bzip2/bzip2.go.html#1344690">crc</a></span>&nbsp;<span class="op" id="1344783">&lt;&lt;</span>&nbsp;<span class="num" id="1344786">1</span><span class="op" id="1344787">)</span>&nbsp;<span class="op" id="1344789">^</span>&nbsp;<span class="ident" id="1344791"><a href="/gostd/compress/bzip2/bzip2.go.html#1344645">poly</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344799">}</span>&nbsp;<span class="keyword" id="1344801">else</span>&nbsp;<span class="op" id="1344806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344812"><a href="/gostd/compress/bzip2/bzip2.go.html#1344690">crc</a></span>&nbsp;<span class="op" id="1344816">&lt;&lt;=</span>&nbsp;<span class="num" id="1344820">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344825">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344833"><a href="/gostd/compress/bzip2/bzip2.go.html#1344604">crctab</a></span><span class="op" id="1344839">[</span><span class="ident" id="1344840"><a href="/gostd/compress/bzip2/bzip2.go.html#1344668">i</a></span><span class="op" id="1344841">]</span>&nbsp;<span class="op" id="1344843">=</span>&nbsp;<span class="ident" id="1344845"><a href="/gostd/compress/bzip2/bzip2.go.html#1344690">crc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1344850">}</span><br>
<span class="lineno"></span><span class="op" id="1344852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1344855">//&nbsp;updateCRC&nbsp;updates&nbsp;the&nbsp;crc&nbsp;value&nbsp;to&nbsp;incorporate&nbsp;the&nbsp;data&nbsp;in&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="1344920">//&nbsp;The&nbsp;initial&nbsp;value&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1344947">func</span>&nbsp;<span class="ident" id="1344952">updateCRC</span><span class="op" id="1344961">(</span><span class="ident" id="1344962">val</span>&nbsp;<span class="builtintype" id="1344966">uint32</span><span class="op" id="1344972">,</span>&nbsp;<span class="ident" id="1344974">b</span>&nbsp;<span class="op" id="1344976">[</span><span class="op" id="1344977">]</span><span class="builtintype" id="1344978">byte</span><span class="op" id="1344982">)</span>&nbsp;<span class="builtintype" id="1344984">uint32</span>&nbsp;<span class="op" id="1344991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1344994">crc</span>&nbsp;<span class="op" id="1344998">:=</span>&nbsp;<span class="op" id="1345001">^</span><span class="ident" id="1345002"><a href="/gostd/compress/bzip2/bzip2.go.html#1344962">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345007">for</span>&nbsp;<span class="ident" id="1345011">_</span><span class="op" id="1345012">,</span>&nbsp;<span class="ident" id="1345014">v</span>&nbsp;<span class="op" id="1345016">:=</span>&nbsp;<span class="keyword" id="1345019">range</span>&nbsp;<span class="ident" id="1345025"><a href="/gostd/compress/bzip2/bzip2.go.html#1344974">b</a></span>&nbsp;<span class="op" id="1345027">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1345031"><a href="/gostd/compress/bzip2/bzip2.go.html#1344994">crc</a></span>&nbsp;<span class="op" id="1345035">=</span>&nbsp;<span class="ident" id="1345037"><a href="/gostd/compress/bzip2/bzip2.go.html#1344604">crctab</a></span><span class="op" id="1345043">[</span><span class="builtintype" id="1345044">byte</span><span class="op" id="1345048">(</span><span class="ident" id="1345049"><a href="/gostd/compress/bzip2/bzip2.go.html#1344994">crc</a></span><span class="op" id="1345052">&gt;&gt;</span><span class="num" id="1345054">24</span><span class="op" id="1345056">)</span><span class="op" id="1345057">^</span><span class="ident" id="1345058"><a href="/gostd/compress/bzip2/bzip2.go.html#1345014">v</a></span><span class="op" id="1345059">]</span>&nbsp;<span class="op" id="1345061">^</span>&nbsp;<span class="op" id="1345063">(</span><span class="ident" id="1345064"><a href="/gostd/compress/bzip2/bzip2.go.html#1344994">crc</a></span>&nbsp;<span class="op" id="1345068">&lt;&lt;</span>&nbsp;<span class="num" id="1345071">8</span><span class="op" id="1345072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1345075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1345078">return</span>&nbsp;<span class="op" id="1345085">^</span><span class="ident" id="1345086"><a href="/gostd/compress/bzip2/bzip2.go.html#1344994">crc</a></span><br>
<span class="lineno"></span><span class="op" id="1345090">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
