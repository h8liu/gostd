<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8350236">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8350292">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8350346">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8350397">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8350415">package</span>&nbsp;<span class="ident" id="8350423">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8350428">import</span>&nbsp;<span class="op" id="8350435">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350438">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350449">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8350460">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8350470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8350473">var</span>&nbsp;<span class="ident" id="8350477">listenerTests</span>&nbsp;<span class="op" id="8350491">=</span>&nbsp;<span class="op" id="8350493">[</span><span class="op" id="8350494">]</span><span class="keyword" id="8350495">struct</span>&nbsp;<span class="op" id="8350502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350505">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8350514">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350522">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8350531">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350539">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8350548">bool</span>&nbsp;<span class="comment" id="8350553">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350594">wildcard</span>&nbsp;<span class="builtintype" id="8350603">bool</span>&nbsp;<span class="comment" id="8350608">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="8350638">}</span><span class="op" id="8350639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350642">{</span><span class="ident" id="8350643">net</span><span class="op" id="8350646">:</span>&nbsp;<span class="string" id="8350648">&#34;tcp&#34;</span><span class="op" id="8350653">,</span>&nbsp;<span class="ident" id="8350655">laddr</span><span class="op" id="8350660">:</span>&nbsp;<span class="string" id="8350662">&#34;&#34;</span><span class="op" id="8350664">,</span>&nbsp;<span class="ident" id="8350666">wildcard</span><span class="op" id="8350674">:</span>&nbsp;<span class="builtintype" id="8350676">true</span><span class="op" id="8350680">}</span><span class="op" id="8350681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350684">{</span><span class="ident" id="8350685">net</span><span class="op" id="8350688">:</span>&nbsp;<span class="string" id="8350690">&#34;tcp&#34;</span><span class="op" id="8350695">,</span>&nbsp;<span class="ident" id="8350697">laddr</span><span class="op" id="8350702">:</span>&nbsp;<span class="string" id="8350704">&#34;0.0.0.0&#34;</span><span class="op" id="8350713">,</span>&nbsp;<span class="ident" id="8350715">wildcard</span><span class="op" id="8350723">:</span>&nbsp;<span class="builtintype" id="8350725">true</span><span class="op" id="8350729">}</span><span class="op" id="8350730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350733">{</span><span class="ident" id="8350734">net</span><span class="op" id="8350737">:</span>&nbsp;<span class="string" id="8350739">&#34;tcp&#34;</span><span class="op" id="8350744">,</span>&nbsp;<span class="ident" id="8350746">laddr</span><span class="op" id="8350751">:</span>&nbsp;<span class="string" id="8350753">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8350771">,</span>&nbsp;<span class="ident" id="8350773">wildcard</span><span class="op" id="8350781">:</span>&nbsp;<span class="builtintype" id="8350783">true</span><span class="op" id="8350787">}</span><span class="op" id="8350788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350791">{</span><span class="ident" id="8350792">net</span><span class="op" id="8350795">:</span>&nbsp;<span class="string" id="8350797">&#34;tcp&#34;</span><span class="op" id="8350802">,</span>&nbsp;<span class="ident" id="8350804">laddr</span><span class="op" id="8350809">:</span>&nbsp;<span class="string" id="8350811">&#34;[::]&#34;</span><span class="op" id="8350817">,</span>&nbsp;<span class="ident" id="8350819">ipv6</span><span class="op" id="8350823">:</span>&nbsp;<span class="builtintype" id="8350825">true</span><span class="op" id="8350829">,</span>&nbsp;<span class="ident" id="8350831">wildcard</span><span class="op" id="8350839">:</span>&nbsp;<span class="builtintype" id="8350841">true</span><span class="op" id="8350845">}</span><span class="op" id="8350846">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350850">{</span><span class="ident" id="8350851">net</span><span class="op" id="8350854">:</span>&nbsp;<span class="string" id="8350856">&#34;tcp&#34;</span><span class="op" id="8350861">,</span>&nbsp;<span class="ident" id="8350863">laddr</span><span class="op" id="8350868">:</span>&nbsp;<span class="string" id="8350870">&#34;127.0.0.1&#34;</span><span class="op" id="8350881">}</span><span class="op" id="8350882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350885">{</span><span class="ident" id="8350886">net</span><span class="op" id="8350889">:</span>&nbsp;<span class="string" id="8350891">&#34;tcp&#34;</span><span class="op" id="8350896">,</span>&nbsp;<span class="ident" id="8350898">laddr</span><span class="op" id="8350903">:</span>&nbsp;<span class="string" id="8350905">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8350925">}</span><span class="op" id="8350926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350929">{</span><span class="ident" id="8350930">net</span><span class="op" id="8350933">:</span>&nbsp;<span class="string" id="8350935">&#34;tcp&#34;</span><span class="op" id="8350940">,</span>&nbsp;<span class="ident" id="8350942">laddr</span><span class="op" id="8350947">:</span>&nbsp;<span class="string" id="8350949">&#34;[::1]&#34;</span><span class="op" id="8350956">,</span>&nbsp;<span class="ident" id="8350958">ipv6</span><span class="op" id="8350962">:</span>&nbsp;<span class="builtintype" id="8350964">true</span><span class="op" id="8350968">}</span><span class="op" id="8350969">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350973">{</span><span class="ident" id="8350974">net</span><span class="op" id="8350977">:</span>&nbsp;<span class="string" id="8350979">&#34;tcp4&#34;</span><span class="op" id="8350985">,</span>&nbsp;<span class="ident" id="8350987">laddr</span><span class="op" id="8350992">:</span>&nbsp;<span class="string" id="8350994">&#34;&#34;</span><span class="op" id="8350996">,</span>&nbsp;<span class="ident" id="8350998">wildcard</span><span class="op" id="8351006">:</span>&nbsp;<span class="builtintype" id="8351008">true</span><span class="op" id="8351012">}</span><span class="op" id="8351013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351016">{</span><span class="ident" id="8351017">net</span><span class="op" id="8351020">:</span>&nbsp;<span class="string" id="8351022">&#34;tcp4&#34;</span><span class="op" id="8351028">,</span>&nbsp;<span class="ident" id="8351030">laddr</span><span class="op" id="8351035">:</span>&nbsp;<span class="string" id="8351037">&#34;0.0.0.0&#34;</span><span class="op" id="8351046">,</span>&nbsp;<span class="ident" id="8351048">wildcard</span><span class="op" id="8351056">:</span>&nbsp;<span class="builtintype" id="8351058">true</span><span class="op" id="8351062">}</span><span class="op" id="8351063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351066">{</span><span class="ident" id="8351067">net</span><span class="op" id="8351070">:</span>&nbsp;<span class="string" id="8351072">&#34;tcp4&#34;</span><span class="op" id="8351078">,</span>&nbsp;<span class="ident" id="8351080">laddr</span><span class="op" id="8351085">:</span>&nbsp;<span class="string" id="8351087">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8351105">,</span>&nbsp;<span class="ident" id="8351107">wildcard</span><span class="op" id="8351115">:</span>&nbsp;<span class="builtintype" id="8351117">true</span><span class="op" id="8351121">}</span><span class="op" id="8351122">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351126">{</span><span class="ident" id="8351127">net</span><span class="op" id="8351130">:</span>&nbsp;<span class="string" id="8351132">&#34;tcp4&#34;</span><span class="op" id="8351138">,</span>&nbsp;<span class="ident" id="8351140">laddr</span><span class="op" id="8351145">:</span>&nbsp;<span class="string" id="8351147">&#34;127.0.0.1&#34;</span><span class="op" id="8351158">}</span><span class="op" id="8351159">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351162">{</span><span class="ident" id="8351163">net</span><span class="op" id="8351166">:</span>&nbsp;<span class="string" id="8351168">&#34;tcp4&#34;</span><span class="op" id="8351174">,</span>&nbsp;<span class="ident" id="8351176">laddr</span><span class="op" id="8351181">:</span>&nbsp;<span class="string" id="8351183">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8351203">}</span><span class="op" id="8351204">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351208">{</span><span class="ident" id="8351209">net</span><span class="op" id="8351212">:</span>&nbsp;<span class="string" id="8351214">&#34;tcp6&#34;</span><span class="op" id="8351220">,</span>&nbsp;<span class="ident" id="8351222">laddr</span><span class="op" id="8351227">:</span>&nbsp;<span class="string" id="8351229">&#34;&#34;</span><span class="op" id="8351231">,</span>&nbsp;<span class="ident" id="8351233">ipv6</span><span class="op" id="8351237">:</span>&nbsp;<span class="builtintype" id="8351239">true</span><span class="op" id="8351243">,</span>&nbsp;<span class="ident" id="8351245">wildcard</span><span class="op" id="8351253">:</span>&nbsp;<span class="builtintype" id="8351255">true</span><span class="op" id="8351259">}</span><span class="op" id="8351260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351263">{</span><span class="ident" id="8351264">net</span><span class="op" id="8351267">:</span>&nbsp;<span class="string" id="8351269">&#34;tcp6&#34;</span><span class="op" id="8351275">,</span>&nbsp;<span class="ident" id="8351277">laddr</span><span class="op" id="8351282">:</span>&nbsp;<span class="string" id="8351284">&#34;[::]&#34;</span><span class="op" id="8351290">,</span>&nbsp;<span class="ident" id="8351292">ipv6</span><span class="op" id="8351296">:</span>&nbsp;<span class="builtintype" id="8351298">true</span><span class="op" id="8351302">,</span>&nbsp;<span class="ident" id="8351304">wildcard</span><span class="op" id="8351312">:</span>&nbsp;<span class="builtintype" id="8351314">true</span><span class="op" id="8351318">}</span><span class="op" id="8351319">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351323">{</span><span class="ident" id="8351324">net</span><span class="op" id="8351327">:</span>&nbsp;<span class="string" id="8351329">&#34;tcp6&#34;</span><span class="op" id="8351335">,</span>&nbsp;<span class="ident" id="8351337">laddr</span><span class="op" id="8351342">:</span>&nbsp;<span class="string" id="8351344">&#34;[::1]&#34;</span><span class="op" id="8351351">,</span>&nbsp;<span class="ident" id="8351353">ipv6</span><span class="op" id="8351357">:</span>&nbsp;<span class="builtintype" id="8351359">true</span><span class="op" id="8351363">}</span><span class="op" id="8351364">,</span><br>
<span class="lineno"></span><span class="op" id="8351366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8351369">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8351434">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="8351499">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8351513">func</span>&nbsp;<span class="ident" id="8351518">TestTCPListener</span><span class="op" id="8351533">(</span><span class="ident" id="8351534">t</span>&nbsp;<span class="op" id="8351536">*</span><span class="ident" id="8351537">testing</span><span class="op" id="8351544">.</span><span class="ident" id="8351545">T</span><span class="op" id="8351546">)</span>&nbsp;<span class="op" id="8351548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351551">switch</span>&nbsp;<span class="ident" id="8351558">runtime</span><span class="op" id="8351565">.</span><span class="ident" id="8351566">GOOS</span>&nbsp;<span class="op" id="8351571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351574">case</span>&nbsp;<span class="string" id="8351579">&#34;plan9&#34;</span><span class="op" id="8351586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351590">t</span><span class="op" id="8351591">.</span><span class="ident" id="8351592">Skipf</span><span class="op" id="8351597">(</span><span class="string" id="8351598">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8351619">,</span>&nbsp;<span class="ident" id="8351621">runtime</span><span class="op" id="8351628">.</span><span class="ident" id="8351629">GOOS</span><span class="op" id="8351633">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351640">for</span>&nbsp;<span class="ident" id="8351644">_</span><span class="op" id="8351645">,</span>&nbsp;<span class="ident" id="8351647">tt</span>&nbsp;<span class="op" id="8351650">:=</span>&nbsp;<span class="keyword" id="8351653">range</span>&nbsp;<span class="ident" id="8351659">listenerTests</span>&nbsp;<span class="op" id="8351673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351677">if</span>&nbsp;<span class="ident" id="8351680">tt</span><span class="op" id="8351682">.</span><span class="ident" id="8351683">wildcard</span>&nbsp;<span class="op" id="8351692">&amp;&amp;</span>&nbsp;<span class="op" id="8351695">(</span><span class="ident" id="8351696">testing</span><span class="op" id="8351703">.</span><span class="ident" id="8351704">Short</span><span class="op" id="8351709">(</span><span class="op" id="8351710">)</span>&nbsp;<span class="op" id="8351712">||</span>&nbsp;<span class="op" id="8351715">!</span><span class="op" id="8351716">*</span><span class="ident" id="8351717">testExternal</span><span class="op" id="8351729">)</span>&nbsp;<span class="op" id="8351731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351736">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351751">if</span>&nbsp;<span class="ident" id="8351754">tt</span><span class="op" id="8351756">.</span><span class="ident" id="8351757">ipv6</span>&nbsp;<span class="op" id="8351762">&amp;&amp;</span>&nbsp;<span class="op" id="8351765">!</span><span class="ident" id="8351766">supportsIPv6</span>&nbsp;<span class="op" id="8351779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8351784">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8351795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351799">l1</span><span class="op" id="8351801">,</span>&nbsp;<span class="ident" id="8351803">port</span>&nbsp;<span class="op" id="8351808">:=</span>&nbsp;<span class="ident" id="8351811">usableListenPort</span><span class="op" id="8351827">(</span><span class="ident" id="8351828">t</span><span class="op" id="8351829">,</span>&nbsp;<span class="ident" id="8351831">tt</span><span class="op" id="8351833">.</span><span class="ident" id="8351834">net</span><span class="op" id="8351837">,</span>&nbsp;<span class="ident" id="8351839">tt</span><span class="op" id="8351841">.</span><span class="ident" id="8351842">laddr</span><span class="op" id="8351847">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351851">checkFirstListener</span><span class="op" id="8351869">(</span><span class="ident" id="8351870">t</span><span class="op" id="8351871">,</span>&nbsp;<span class="ident" id="8351873">tt</span><span class="op" id="8351875">.</span><span class="ident" id="8351876">net</span><span class="op" id="8351879">,</span>&nbsp;<span class="ident" id="8351881">tt</span><span class="op" id="8351883">.</span><span class="ident" id="8351884">laddr</span><span class="op" id="8351889">+</span><span class="string" id="8351890">&#34;:&#34;</span><span class="op" id="8351893">+</span><span class="ident" id="8351894">port</span><span class="op" id="8351898">,</span>&nbsp;<span class="ident" id="8351900">l1</span><span class="op" id="8351902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351906">l2</span><span class="op" id="8351908">,</span>&nbsp;<span class="ident" id="8351910">err</span>&nbsp;<span class="op" id="8351914">:=</span>&nbsp;<span class="ident" id="8351917">Listen</span><span class="op" id="8351923">(</span><span class="ident" id="8351924">tt</span><span class="op" id="8351926">.</span><span class="ident" id="8351927">net</span><span class="op" id="8351930">,</span>&nbsp;<span class="ident" id="8351932">tt</span><span class="op" id="8351934">.</span><span class="ident" id="8351935">laddr</span><span class="op" id="8351940">+</span><span class="string" id="8351941">&#34;:&#34;</span><span class="op" id="8351944">+</span><span class="ident" id="8351945">port</span><span class="op" id="8351949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8351953">checkSecondListener</span><span class="op" id="8351972">(</span><span class="ident" id="8351973">t</span><span class="op" id="8351974">,</span>&nbsp;<span class="ident" id="8351976">tt</span><span class="op" id="8351978">.</span><span class="ident" id="8351979">net</span><span class="op" id="8351982">,</span>&nbsp;<span class="ident" id="8351984">tt</span><span class="op" id="8351986">.</span><span class="ident" id="8351987">laddr</span><span class="op" id="8351992">+</span><span class="string" id="8351993">&#34;:&#34;</span><span class="op" id="8351996">+</span><span class="ident" id="8351997">port</span><span class="op" id="8352001">,</span>&nbsp;<span class="ident" id="8352003">err</span><span class="op" id="8352006">,</span>&nbsp;<span class="ident" id="8352008">l2</span><span class="op" id="8352010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352014">l1</span><span class="op" id="8352016">.</span><span class="ident" id="8352017">Close</span><span class="op" id="8352022">(</span><span class="op" id="8352023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352026">}</span><br>
<span class="lineno">65</span><span class="op" id="8352028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8352031">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8352096">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8352161">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="8352175">func</span>&nbsp;<span class="ident" id="8352180">TestUDPListener</span><span class="op" id="8352195">(</span><span class="ident" id="8352196">t</span>&nbsp;<span class="op" id="8352198">*</span><span class="ident" id="8352199">testing</span><span class="op" id="8352206">.</span><span class="ident" id="8352207">T</span><span class="op" id="8352208">)</span>&nbsp;<span class="op" id="8352210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352213">switch</span>&nbsp;<span class="ident" id="8352220">runtime</span><span class="op" id="8352227">.</span><span class="ident" id="8352228">GOOS</span>&nbsp;<span class="op" id="8352233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352236">case</span>&nbsp;<span class="string" id="8352241">&#34;plan9&#34;</span><span class="op" id="8352248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352252">t</span><span class="op" id="8352253">.</span><span class="ident" id="8352254">Skipf</span><span class="op" id="8352259">(</span><span class="string" id="8352260">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8352281">,</span>&nbsp;<span class="ident" id="8352283">runtime</span><span class="op" id="8352290">.</span><span class="ident" id="8352291">GOOS</span><span class="op" id="8352295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352298">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352302">toudpnet</span>&nbsp;<span class="op" id="8352311">:=</span>&nbsp;<span class="keyword" id="8352314">func</span><span class="op" id="8352318">(</span><span class="ident" id="8352319">net</span>&nbsp;<span class="builtintype" id="8352323">string</span><span class="op" id="8352329">)</span>&nbsp;<span class="builtintype" id="8352331">string</span>&nbsp;<span class="op" id="8352338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352342">switch</span>&nbsp;<span class="ident" id="8352349">net</span>&nbsp;<span class="op" id="8352353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352357">case</span>&nbsp;<span class="string" id="8352362">&#34;tcp&#34;</span><span class="op" id="8352367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352372">return</span>&nbsp;<span class="string" id="8352379">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352387">case</span>&nbsp;<span class="string" id="8352392">&#34;tcp4&#34;</span><span class="op" id="8352398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352403">return</span>&nbsp;<span class="string" id="8352410">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352419">case</span>&nbsp;<span class="string" id="8352424">&#34;tcp6&#34;</span><span class="op" id="8352430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352435">return</span>&nbsp;<span class="string" id="8352442">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352451">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352455">return</span>&nbsp;<span class="string" id="8352462">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352475">for</span>&nbsp;<span class="ident" id="8352479">_</span><span class="op" id="8352480">,</span>&nbsp;<span class="ident" id="8352482">tt</span>&nbsp;<span class="op" id="8352485">:=</span>&nbsp;<span class="keyword" id="8352488">range</span>&nbsp;<span class="ident" id="8352494">listenerTests</span>&nbsp;<span class="op" id="8352508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352512">if</span>&nbsp;<span class="ident" id="8352515">tt</span><span class="op" id="8352517">.</span><span class="ident" id="8352518">wildcard</span>&nbsp;<span class="op" id="8352527">&amp;&amp;</span>&nbsp;<span class="op" id="8352530">(</span><span class="ident" id="8352531">testing</span><span class="op" id="8352538">.</span><span class="ident" id="8352539">Short</span><span class="op" id="8352544">(</span><span class="op" id="8352545">)</span>&nbsp;<span class="op" id="8352547">||</span>&nbsp;<span class="op" id="8352550">!</span><span class="op" id="8352551">*</span><span class="ident" id="8352552">testExternal</span><span class="op" id="8352564">)</span>&nbsp;<span class="op" id="8352566">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352571">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352586">if</span>&nbsp;<span class="ident" id="8352589">tt</span><span class="op" id="8352591">.</span><span class="ident" id="8352592">ipv6</span>&nbsp;<span class="op" id="8352597">&amp;&amp;</span>&nbsp;<span class="op" id="8352600">!</span><span class="ident" id="8352601">supportsIPv6</span>&nbsp;<span class="op" id="8352614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8352619">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352630">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352634">tt</span><span class="op" id="8352636">.</span><span class="ident" id="8352637">net</span>&nbsp;<span class="op" id="8352641">=</span>&nbsp;<span class="ident" id="8352643">toudpnet</span><span class="op" id="8352651">(</span><span class="ident" id="8352652">tt</span><span class="op" id="8352654">.</span><span class="ident" id="8352655">net</span><span class="op" id="8352658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352662">l1</span><span class="op" id="8352664">,</span>&nbsp;<span class="ident" id="8352666">port</span>&nbsp;<span class="op" id="8352671">:=</span>&nbsp;<span class="ident" id="8352674">usableListenPacketPort</span><span class="op" id="8352696">(</span><span class="ident" id="8352697">t</span><span class="op" id="8352698">,</span>&nbsp;<span class="ident" id="8352700">tt</span><span class="op" id="8352702">.</span><span class="ident" id="8352703">net</span><span class="op" id="8352706">,</span>&nbsp;<span class="ident" id="8352708">tt</span><span class="op" id="8352710">.</span><span class="ident" id="8352711">laddr</span><span class="op" id="8352716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352720">checkFirstListener</span><span class="op" id="8352738">(</span><span class="ident" id="8352739">t</span><span class="op" id="8352740">,</span>&nbsp;<span class="ident" id="8352742">tt</span><span class="op" id="8352744">.</span><span class="ident" id="8352745">net</span><span class="op" id="8352748">,</span>&nbsp;<span class="ident" id="8352750">tt</span><span class="op" id="8352752">.</span><span class="ident" id="8352753">laddr</span><span class="op" id="8352758">+</span><span class="string" id="8352759">&#34;:&#34;</span><span class="op" id="8352762">+</span><span class="ident" id="8352763">port</span><span class="op" id="8352767">,</span>&nbsp;<span class="ident" id="8352769">l1</span><span class="op" id="8352771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352775">l2</span><span class="op" id="8352777">,</span>&nbsp;<span class="ident" id="8352779">err</span>&nbsp;<span class="op" id="8352783">:=</span>&nbsp;<span class="ident" id="8352786">ListenPacket</span><span class="op" id="8352798">(</span><span class="ident" id="8352799">tt</span><span class="op" id="8352801">.</span><span class="ident" id="8352802">net</span><span class="op" id="8352805">,</span>&nbsp;<span class="ident" id="8352807">tt</span><span class="op" id="8352809">.</span><span class="ident" id="8352810">laddr</span><span class="op" id="8352815">+</span><span class="string" id="8352816">&#34;:&#34;</span><span class="op" id="8352819">+</span><span class="ident" id="8352820">port</span><span class="op" id="8352824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352828">checkSecondListener</span><span class="op" id="8352847">(</span><span class="ident" id="8352848">t</span><span class="op" id="8352849">,</span>&nbsp;<span class="ident" id="8352851">tt</span><span class="op" id="8352853">.</span><span class="ident" id="8352854">net</span><span class="op" id="8352857">,</span>&nbsp;<span class="ident" id="8352859">tt</span><span class="op" id="8352861">.</span><span class="ident" id="8352862">laddr</span><span class="op" id="8352867">+</span><span class="string" id="8352868">&#34;:&#34;</span><span class="op" id="8352871">+</span><span class="ident" id="8352872">port</span><span class="op" id="8352876">,</span>&nbsp;<span class="ident" id="8352878">err</span><span class="op" id="8352881">,</span>&nbsp;<span class="ident" id="8352883">l2</span><span class="op" id="8352885">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352889">l1</span><span class="op" id="8352891">.</span><span class="ident" id="8352892">Close</span><span class="op" id="8352897">(</span><span class="op" id="8352898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8352901">}</span><br>
<span class="lineno"></span><span class="op" id="8352903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8352906">var</span>&nbsp;<span class="ident" id="8352910">dualStackListenerTests</span>&nbsp;<span class="op" id="8352933">=</span>&nbsp;<span class="op" id="8352935">[</span><span class="op" id="8352936">]</span><span class="keyword" id="8352937">struct</span>&nbsp;<span class="op" id="8352944">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352947">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8352956">string</span>&nbsp;<span class="comment" id="8352963">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352982">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8352991">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8352999">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8353008">string</span>&nbsp;<span class="comment" id="8353015">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353035">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8353044">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353052">wildcard</span>&nbsp;<span class="builtintype" id="8353061">bool</span>&nbsp;&nbsp;<span class="comment" id="8353067">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8353098">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8353107">error</span>&nbsp;<span class="comment" id="8353113">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="8353151">}</span><span class="op" id="8353152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353155">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353237">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353326">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353415">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353501">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353587">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353673">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353762">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353849">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8353936">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354023">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354110">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354197">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354284">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354373">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354460">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354547">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354634">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354721">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354810">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354897">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8354984">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355071">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355158">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355162">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355199">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355233">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355306">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355338">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355411">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355443">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355515">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8355547">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355602">{</span><span class="ident" id="8355603">net1</span><span class="op" id="8355607">:</span>&nbsp;<span class="string" id="8355609">&#34;tcp&#34;</span><span class="op" id="8355614">,</span>&nbsp;<span class="ident" id="8355616">laddr1</span><span class="op" id="8355622">:</span>&nbsp;<span class="string" id="8355624">&#34;&#34;</span><span class="op" id="8355626">,</span>&nbsp;<span class="ident" id="8355628">net2</span><span class="op" id="8355632">:</span>&nbsp;<span class="string" id="8355634">&#34;tcp&#34;</span><span class="op" id="8355639">,</span>&nbsp;<span class="ident" id="8355641">laddr2</span><span class="op" id="8355647">:</span>&nbsp;<span class="string" id="8355649">&#34;&#34;</span><span class="op" id="8355651">,</span>&nbsp;<span class="ident" id="8355653">wildcard</span><span class="op" id="8355661">:</span>&nbsp;<span class="builtintype" id="8355663">true</span><span class="op" id="8355667">,</span>&nbsp;<span class="ident" id="8355669">xerr</span><span class="op" id="8355673">:</span>&nbsp;<span class="ident" id="8355675">syscall</span><span class="op" id="8355682">.</span><span class="ident" id="8355683">EADDRINUSE</span><span class="op" id="8355693">}</span><span class="op" id="8355694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355697">{</span><span class="ident" id="8355698">net1</span><span class="op" id="8355702">:</span>&nbsp;<span class="string" id="8355704">&#34;tcp&#34;</span><span class="op" id="8355709">,</span>&nbsp;<span class="ident" id="8355711">laddr1</span><span class="op" id="8355717">:</span>&nbsp;<span class="string" id="8355719">&#34;&#34;</span><span class="op" id="8355721">,</span>&nbsp;<span class="ident" id="8355723">net2</span><span class="op" id="8355727">:</span>&nbsp;<span class="string" id="8355729">&#34;tcp&#34;</span><span class="op" id="8355734">,</span>&nbsp;<span class="ident" id="8355736">laddr2</span><span class="op" id="8355742">:</span>&nbsp;<span class="string" id="8355744">&#34;0.0.0.0&#34;</span><span class="op" id="8355753">,</span>&nbsp;<span class="ident" id="8355755">wildcard</span><span class="op" id="8355763">:</span>&nbsp;<span class="builtintype" id="8355765">true</span><span class="op" id="8355769">,</span>&nbsp;<span class="ident" id="8355771">xerr</span><span class="op" id="8355775">:</span>&nbsp;<span class="ident" id="8355777">syscall</span><span class="op" id="8355784">.</span><span class="ident" id="8355785">EADDRINUSE</span><span class="op" id="8355795">}</span><span class="op" id="8355796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355799">{</span><span class="ident" id="8355800">net1</span><span class="op" id="8355804">:</span>&nbsp;<span class="string" id="8355806">&#34;tcp&#34;</span><span class="op" id="8355811">,</span>&nbsp;<span class="ident" id="8355813">laddr1</span><span class="op" id="8355819">:</span>&nbsp;<span class="string" id="8355821">&#34;0.0.0.0&#34;</span><span class="op" id="8355830">,</span>&nbsp;<span class="ident" id="8355832">net2</span><span class="op" id="8355836">:</span>&nbsp;<span class="string" id="8355838">&#34;tcp&#34;</span><span class="op" id="8355843">,</span>&nbsp;<span class="ident" id="8355845">laddr2</span><span class="op" id="8355851">:</span>&nbsp;<span class="string" id="8355853">&#34;&#34;</span><span class="op" id="8355855">,</span>&nbsp;<span class="ident" id="8355857">wildcard</span><span class="op" id="8355865">:</span>&nbsp;<span class="builtintype" id="8355867">true</span><span class="op" id="8355871">,</span>&nbsp;<span class="ident" id="8355873">xerr</span><span class="op" id="8355877">:</span>&nbsp;<span class="ident" id="8355879">syscall</span><span class="op" id="8355886">.</span><span class="ident" id="8355887">EADDRINUSE</span><span class="op" id="8355897">}</span><span class="op" id="8355898">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8355902">{</span><span class="ident" id="8355903">net1</span><span class="op" id="8355907">:</span>&nbsp;<span class="string" id="8355909">&#34;tcp&#34;</span><span class="op" id="8355914">,</span>&nbsp;<span class="ident" id="8355916">laddr1</span><span class="op" id="8355922">:</span>&nbsp;<span class="string" id="8355924">&#34;&#34;</span><span class="op" id="8355926">,</span>&nbsp;<span class="ident" id="8355928">net2</span><span class="op" id="8355932">:</span>&nbsp;<span class="string" id="8355934">&#34;tcp&#34;</span><span class="op" id="8355939">,</span>&nbsp;<span class="ident" id="8355941">laddr2</span><span class="op" id="8355947">:</span>&nbsp;<span class="string" id="8355949">&#34;[::]&#34;</span><span class="op" id="8355955">,</span>&nbsp;<span class="ident" id="8355957">wildcard</span><span class="op" id="8355965">:</span>&nbsp;<span class="builtintype" id="8355967">true</span><span class="op" id="8355971">,</span>&nbsp;<span class="ident" id="8355973">xerr</span><span class="op" id="8355977">:</span>&nbsp;<span class="ident" id="8355979">syscall</span><span class="op" id="8355986">.</span><span class="ident" id="8355987">EADDRINUSE</span><span class="op" id="8355997">}</span><span class="op" id="8355998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356001">{</span><span class="ident" id="8356002">net1</span><span class="op" id="8356006">:</span>&nbsp;<span class="string" id="8356008">&#34;tcp&#34;</span><span class="op" id="8356013">,</span>&nbsp;<span class="ident" id="8356015">laddr1</span><span class="op" id="8356021">:</span>&nbsp;<span class="string" id="8356023">&#34;[::]&#34;</span><span class="op" id="8356029">,</span>&nbsp;<span class="ident" id="8356031">net2</span><span class="op" id="8356035">:</span>&nbsp;<span class="string" id="8356037">&#34;tcp&#34;</span><span class="op" id="8356042">,</span>&nbsp;<span class="ident" id="8356044">laddr2</span><span class="op" id="8356050">:</span>&nbsp;<span class="string" id="8356052">&#34;&#34;</span><span class="op" id="8356054">,</span>&nbsp;<span class="ident" id="8356056">wildcard</span><span class="op" id="8356064">:</span>&nbsp;<span class="builtintype" id="8356066">true</span><span class="op" id="8356070">,</span>&nbsp;<span class="ident" id="8356072">xerr</span><span class="op" id="8356076">:</span>&nbsp;<span class="ident" id="8356078">syscall</span><span class="op" id="8356085">.</span><span class="ident" id="8356086">EADDRINUSE</span><span class="op" id="8356096">}</span><span class="op" id="8356097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356100">{</span><span class="ident" id="8356101">net1</span><span class="op" id="8356105">:</span>&nbsp;<span class="string" id="8356107">&#34;tcp&#34;</span><span class="op" id="8356112">,</span>&nbsp;<span class="ident" id="8356114">laddr1</span><span class="op" id="8356120">:</span>&nbsp;<span class="string" id="8356122">&#34;0.0.0.0&#34;</span><span class="op" id="8356131">,</span>&nbsp;<span class="ident" id="8356133">net2</span><span class="op" id="8356137">:</span>&nbsp;<span class="string" id="8356139">&#34;tcp&#34;</span><span class="op" id="8356144">,</span>&nbsp;<span class="ident" id="8356146">laddr2</span><span class="op" id="8356152">:</span>&nbsp;<span class="string" id="8356154">&#34;[::]&#34;</span><span class="op" id="8356160">,</span>&nbsp;<span class="ident" id="8356162">wildcard</span><span class="op" id="8356170">:</span>&nbsp;<span class="builtintype" id="8356172">true</span><span class="op" id="8356176">,</span>&nbsp;<span class="ident" id="8356178">xerr</span><span class="op" id="8356182">:</span>&nbsp;<span class="ident" id="8356184">syscall</span><span class="op" id="8356191">.</span><span class="ident" id="8356192">EADDRINUSE</span><span class="op" id="8356202">}</span><span class="op" id="8356203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356206">{</span><span class="ident" id="8356207">net1</span><span class="op" id="8356211">:</span>&nbsp;<span class="string" id="8356213">&#34;tcp&#34;</span><span class="op" id="8356218">,</span>&nbsp;<span class="ident" id="8356220">laddr1</span><span class="op" id="8356226">:</span>&nbsp;<span class="string" id="8356228">&#34;[::]&#34;</span><span class="op" id="8356234">,</span>&nbsp;<span class="ident" id="8356236">net2</span><span class="op" id="8356240">:</span>&nbsp;<span class="string" id="8356242">&#34;tcp&#34;</span><span class="op" id="8356247">,</span>&nbsp;<span class="ident" id="8356249">laddr2</span><span class="op" id="8356255">:</span>&nbsp;<span class="string" id="8356257">&#34;0.0.0.0&#34;</span><span class="op" id="8356266">,</span>&nbsp;<span class="ident" id="8356268">wildcard</span><span class="op" id="8356276">:</span>&nbsp;<span class="builtintype" id="8356278">true</span><span class="op" id="8356282">,</span>&nbsp;<span class="ident" id="8356284">xerr</span><span class="op" id="8356288">:</span>&nbsp;<span class="ident" id="8356290">syscall</span><span class="op" id="8356297">.</span><span class="ident" id="8356298">EADDRINUSE</span><span class="op" id="8356308">}</span><span class="op" id="8356309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356312">{</span><span class="ident" id="8356313">net1</span><span class="op" id="8356317">:</span>&nbsp;<span class="string" id="8356319">&#34;tcp&#34;</span><span class="op" id="8356324">,</span>&nbsp;<span class="ident" id="8356326">laddr1</span><span class="op" id="8356332">:</span>&nbsp;<span class="string" id="8356334">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8356352">,</span>&nbsp;<span class="ident" id="8356354">net2</span><span class="op" id="8356358">:</span>&nbsp;<span class="string" id="8356360">&#34;tcp&#34;</span><span class="op" id="8356365">,</span>&nbsp;<span class="ident" id="8356367">laddr2</span><span class="op" id="8356373">:</span>&nbsp;<span class="string" id="8356375">&#34;[::]&#34;</span><span class="op" id="8356381">,</span>&nbsp;<span class="ident" id="8356383">wildcard</span><span class="op" id="8356391">:</span>&nbsp;<span class="builtintype" id="8356393">true</span><span class="op" id="8356397">,</span>&nbsp;<span class="ident" id="8356399">xerr</span><span class="op" id="8356403">:</span>&nbsp;<span class="ident" id="8356405">syscall</span><span class="op" id="8356412">.</span><span class="ident" id="8356413">EADDRINUSE</span><span class="op" id="8356423">}</span><span class="op" id="8356424">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356427">{</span><span class="ident" id="8356428">net1</span><span class="op" id="8356432">:</span>&nbsp;<span class="string" id="8356434">&#34;tcp&#34;</span><span class="op" id="8356439">,</span>&nbsp;<span class="ident" id="8356441">laddr1</span><span class="op" id="8356447">:</span>&nbsp;<span class="string" id="8356449">&#34;[::]&#34;</span><span class="op" id="8356455">,</span>&nbsp;<span class="ident" id="8356457">net2</span><span class="op" id="8356461">:</span>&nbsp;<span class="string" id="8356463">&#34;tcp&#34;</span><span class="op" id="8356468">,</span>&nbsp;<span class="ident" id="8356470">laddr2</span><span class="op" id="8356476">:</span>&nbsp;<span class="string" id="8356478">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8356496">,</span>&nbsp;<span class="ident" id="8356498">wildcard</span><span class="op" id="8356506">:</span>&nbsp;<span class="builtintype" id="8356508">true</span><span class="op" id="8356512">,</span>&nbsp;<span class="ident" id="8356514">xerr</span><span class="op" id="8356518">:</span>&nbsp;<span class="ident" id="8356520">syscall</span><span class="op" id="8356527">.</span><span class="ident" id="8356528">EADDRINUSE</span><span class="op" id="8356538">}</span><span class="op" id="8356539">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356543">{</span><span class="ident" id="8356544">net1</span><span class="op" id="8356548">:</span>&nbsp;<span class="string" id="8356550">&#34;tcp4&#34;</span><span class="op" id="8356556">,</span>&nbsp;<span class="ident" id="8356558">laddr1</span><span class="op" id="8356564">:</span>&nbsp;<span class="string" id="8356566">&#34;&#34;</span><span class="op" id="8356568">,</span>&nbsp;<span class="ident" id="8356570">net2</span><span class="op" id="8356574">:</span>&nbsp;<span class="string" id="8356576">&#34;tcp6&#34;</span><span class="op" id="8356582">,</span>&nbsp;<span class="ident" id="8356584">laddr2</span><span class="op" id="8356590">:</span>&nbsp;<span class="string" id="8356592">&#34;&#34;</span><span class="op" id="8356594">,</span>&nbsp;<span class="ident" id="8356596">wildcard</span><span class="op" id="8356604">:</span>&nbsp;<span class="builtintype" id="8356606">true</span><span class="op" id="8356610">}</span><span class="op" id="8356611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356614">{</span><span class="ident" id="8356615">net1</span><span class="op" id="8356619">:</span>&nbsp;<span class="string" id="8356621">&#34;tcp6&#34;</span><span class="op" id="8356627">,</span>&nbsp;<span class="ident" id="8356629">laddr1</span><span class="op" id="8356635">:</span>&nbsp;<span class="string" id="8356637">&#34;&#34;</span><span class="op" id="8356639">,</span>&nbsp;<span class="ident" id="8356641">net2</span><span class="op" id="8356645">:</span>&nbsp;<span class="string" id="8356647">&#34;tcp4&#34;</span><span class="op" id="8356653">,</span>&nbsp;<span class="ident" id="8356655">laddr2</span><span class="op" id="8356661">:</span>&nbsp;<span class="string" id="8356663">&#34;&#34;</span><span class="op" id="8356665">,</span>&nbsp;<span class="ident" id="8356667">wildcard</span><span class="op" id="8356675">:</span>&nbsp;<span class="builtintype" id="8356677">true</span><span class="op" id="8356681">}</span><span class="op" id="8356682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356685">{</span><span class="ident" id="8356686">net1</span><span class="op" id="8356690">:</span>&nbsp;<span class="string" id="8356692">&#34;tcp4&#34;</span><span class="op" id="8356698">,</span>&nbsp;<span class="ident" id="8356700">laddr1</span><span class="op" id="8356706">:</span>&nbsp;<span class="string" id="8356708">&#34;0.0.0.0&#34;</span><span class="op" id="8356717">,</span>&nbsp;<span class="ident" id="8356719">net2</span><span class="op" id="8356723">:</span>&nbsp;<span class="string" id="8356725">&#34;tcp6&#34;</span><span class="op" id="8356731">,</span>&nbsp;<span class="ident" id="8356733">laddr2</span><span class="op" id="8356739">:</span>&nbsp;<span class="string" id="8356741">&#34;[::]&#34;</span><span class="op" id="8356747">,</span>&nbsp;<span class="ident" id="8356749">wildcard</span><span class="op" id="8356757">:</span>&nbsp;<span class="builtintype" id="8356759">true</span><span class="op" id="8356763">}</span><span class="op" id="8356764">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356767">{</span><span class="ident" id="8356768">net1</span><span class="op" id="8356772">:</span>&nbsp;<span class="string" id="8356774">&#34;tcp6&#34;</span><span class="op" id="8356780">,</span>&nbsp;<span class="ident" id="8356782">laddr1</span><span class="op" id="8356788">:</span>&nbsp;<span class="string" id="8356790">&#34;[::]&#34;</span><span class="op" id="8356796">,</span>&nbsp;<span class="ident" id="8356798">net2</span><span class="op" id="8356802">:</span>&nbsp;<span class="string" id="8356804">&#34;tcp4&#34;</span><span class="op" id="8356810">,</span>&nbsp;<span class="ident" id="8356812">laddr2</span><span class="op" id="8356818">:</span>&nbsp;<span class="string" id="8356820">&#34;0.0.0.0&#34;</span><span class="op" id="8356829">,</span>&nbsp;<span class="ident" id="8356831">wildcard</span><span class="op" id="8356839">:</span>&nbsp;<span class="builtintype" id="8356841">true</span><span class="op" id="8356845">}</span><span class="op" id="8356846">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356850">{</span><span class="ident" id="8356851">net1</span><span class="op" id="8356855">:</span>&nbsp;<span class="string" id="8356857">&#34;tcp&#34;</span><span class="op" id="8356862">,</span>&nbsp;<span class="ident" id="8356864">laddr1</span><span class="op" id="8356870">:</span>&nbsp;<span class="string" id="8356872">&#34;127.0.0.1&#34;</span><span class="op" id="8356883">,</span>&nbsp;<span class="ident" id="8356885">net2</span><span class="op" id="8356889">:</span>&nbsp;<span class="string" id="8356891">&#34;tcp&#34;</span><span class="op" id="8356896">,</span>&nbsp;<span class="ident" id="8356898">laddr2</span><span class="op" id="8356904">:</span>&nbsp;<span class="string" id="8356906">&#34;[::1]&#34;</span><span class="op" id="8356913">}</span><span class="op" id="8356914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356917">{</span><span class="ident" id="8356918">net1</span><span class="op" id="8356922">:</span>&nbsp;<span class="string" id="8356924">&#34;tcp&#34;</span><span class="op" id="8356929">,</span>&nbsp;<span class="ident" id="8356931">laddr1</span><span class="op" id="8356937">:</span>&nbsp;<span class="string" id="8356939">&#34;[::1]&#34;</span><span class="op" id="8356946">,</span>&nbsp;<span class="ident" id="8356948">net2</span><span class="op" id="8356952">:</span>&nbsp;<span class="string" id="8356954">&#34;tcp&#34;</span><span class="op" id="8356959">,</span>&nbsp;<span class="ident" id="8356961">laddr2</span><span class="op" id="8356967">:</span>&nbsp;<span class="string" id="8356969">&#34;127.0.0.1&#34;</span><span class="op" id="8356980">}</span><span class="op" id="8356981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8356984">{</span><span class="ident" id="8356985">net1</span><span class="op" id="8356989">:</span>&nbsp;<span class="string" id="8356991">&#34;tcp4&#34;</span><span class="op" id="8356997">,</span>&nbsp;<span class="ident" id="8356999">laddr1</span><span class="op" id="8357005">:</span>&nbsp;<span class="string" id="8357007">&#34;127.0.0.1&#34;</span><span class="op" id="8357018">,</span>&nbsp;<span class="ident" id="8357020">net2</span><span class="op" id="8357024">:</span>&nbsp;<span class="string" id="8357026">&#34;tcp6&#34;</span><span class="op" id="8357032">,</span>&nbsp;<span class="ident" id="8357034">laddr2</span><span class="op" id="8357040">:</span>&nbsp;<span class="string" id="8357042">&#34;[::1]&#34;</span><span class="op" id="8357049">}</span><span class="op" id="8357050">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357053">{</span><span class="ident" id="8357054">net1</span><span class="op" id="8357058">:</span>&nbsp;<span class="string" id="8357060">&#34;tcp6&#34;</span><span class="op" id="8357066">,</span>&nbsp;<span class="ident" id="8357068">laddr1</span><span class="op" id="8357074">:</span>&nbsp;<span class="string" id="8357076">&#34;[::1]&#34;</span><span class="op" id="8357083">,</span>&nbsp;<span class="ident" id="8357085">net2</span><span class="op" id="8357089">:</span>&nbsp;<span class="string" id="8357091">&#34;tcp4&#34;</span><span class="op" id="8357097">,</span>&nbsp;<span class="ident" id="8357099">laddr2</span><span class="op" id="8357105">:</span>&nbsp;<span class="string" id="8357107">&#34;127.0.0.1&#34;</span><span class="op" id="8357118">}</span><span class="op" id="8357119">,</span><br>
<span class="lineno"></span><span class="op" id="8357121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8357124">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8357188">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="8357251">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8357287">func</span>&nbsp;<span class="ident" id="8357292">TestDualStackTCPListener</span><span class="op" id="8357316">(</span><span class="ident" id="8357317">t</span>&nbsp;<span class="op" id="8357319">*</span><span class="ident" id="8357320">testing</span><span class="op" id="8357327">.</span><span class="ident" id="8357328">T</span><span class="op" id="8357329">)</span>&nbsp;<span class="op" id="8357331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357334">if</span>&nbsp;<span class="ident" id="8357337">testing</span><span class="op" id="8357344">.</span><span class="ident" id="8357345">Short</span><span class="op" id="8357350">(</span><span class="op" id="8357351">)</span>&nbsp;<span class="op" id="8357353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357357">t</span><span class="op" id="8357358">.</span><span class="ident" id="8357359">Skip</span><span class="op" id="8357363">(</span><span class="string" id="8357364">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8357405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357408">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357411">switch</span>&nbsp;<span class="ident" id="8357418">runtime</span><span class="op" id="8357425">.</span><span class="ident" id="8357426">GOOS</span>&nbsp;<span class="op" id="8357431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357434">case</span>&nbsp;<span class="string" id="8357439">&#34;plan9&#34;</span><span class="op" id="8357446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357450">t</span><span class="op" id="8357451">.</span><span class="ident" id="8357452">Skipf</span><span class="op" id="8357457">(</span><span class="string" id="8357458">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8357479">,</span>&nbsp;<span class="ident" id="8357481">runtime</span><span class="op" id="8357488">.</span><span class="ident" id="8357489">GOOS</span><span class="op" id="8357493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357499">if</span>&nbsp;<span class="op" id="8357502">!</span><span class="ident" id="8357503">supportsIPv6</span>&nbsp;<span class="op" id="8357516">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357520">t</span><span class="op" id="8357521">.</span><span class="ident" id="8357522">Skip</span><span class="op" id="8357526">(</span><span class="string" id="8357527">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8357550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357557">for</span>&nbsp;<span class="ident" id="8357561">_</span><span class="op" id="8357562">,</span>&nbsp;<span class="ident" id="8357564">tt</span>&nbsp;<span class="op" id="8357567">:=</span>&nbsp;<span class="keyword" id="8357570">range</span>&nbsp;<span class="ident" id="8357576">dualStackListenerTests</span>&nbsp;<span class="op" id="8357599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357603">if</span>&nbsp;<span class="ident" id="8357606">tt</span><span class="op" id="8357608">.</span><span class="ident" id="8357609">wildcard</span>&nbsp;<span class="op" id="8357618">&amp;&amp;</span>&nbsp;<span class="op" id="8357621">!</span><span class="op" id="8357622">*</span><span class="ident" id="8357623">testExternal</span>&nbsp;<span class="op" id="8357636">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357641">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357656">switch</span>&nbsp;<span class="ident" id="8357663">runtime</span><span class="op" id="8357670">.</span><span class="ident" id="8357671">GOOS</span>&nbsp;<span class="op" id="8357676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357680">case</span>&nbsp;<span class="string" id="8357685">&#34;openbsd&#34;</span><span class="op" id="8357694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8357699">if</span>&nbsp;<span class="ident" id="8357702">tt</span><span class="op" id="8357704">.</span><span class="ident" id="8357705">wildcard</span>&nbsp;<span class="op" id="8357714">&amp;&amp;</span>&nbsp;<span class="ident" id="8357717">differentWildcardAddr</span><span class="op" id="8357738">(</span><span class="ident" id="8357739">tt</span><span class="op" id="8357741">.</span><span class="ident" id="8357742">laddr1</span><span class="op" id="8357748">,</span>&nbsp;<span class="ident" id="8357750">tt</span><span class="op" id="8357752">.</span><span class="ident" id="8357753">laddr2</span><span class="op" id="8357759">)</span>&nbsp;<span class="op" id="8357761">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357767">tt</span><span class="op" id="8357769">.</span><span class="ident" id="8357770">xerr</span>&nbsp;<span class="op" id="8357775">=</span>&nbsp;<span class="ident" id="8357777">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8357788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357792">l1</span><span class="op" id="8357794">,</span>&nbsp;<span class="ident" id="8357796">port</span>&nbsp;<span class="op" id="8357801">:=</span>&nbsp;<span class="ident" id="8357804">usableListenPort</span><span class="op" id="8357820">(</span><span class="ident" id="8357821">t</span><span class="op" id="8357822">,</span>&nbsp;<span class="ident" id="8357824">tt</span><span class="op" id="8357826">.</span><span class="ident" id="8357827">net1</span><span class="op" id="8357831">,</span>&nbsp;<span class="ident" id="8357833">tt</span><span class="op" id="8357835">.</span><span class="ident" id="8357836">laddr1</span><span class="op" id="8357842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357846">laddr</span>&nbsp;<span class="op" id="8357852">:=</span>&nbsp;<span class="ident" id="8357855">tt</span><span class="op" id="8357857">.</span><span class="ident" id="8357858">laddr1</span>&nbsp;<span class="op" id="8357865">+</span>&nbsp;<span class="string" id="8357867">&#34;:&#34;</span>&nbsp;<span class="op" id="8357871">+</span>&nbsp;<span class="ident" id="8357873">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357880">checkFirstListener</span><span class="op" id="8357898">(</span><span class="ident" id="8357899">t</span><span class="op" id="8357900">,</span>&nbsp;<span class="ident" id="8357902">tt</span><span class="op" id="8357904">.</span><span class="ident" id="8357905">net1</span><span class="op" id="8357909">,</span>&nbsp;<span class="ident" id="8357911">laddr</span><span class="op" id="8357916">,</span>&nbsp;<span class="ident" id="8357918">l1</span><span class="op" id="8357920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357924">laddr</span>&nbsp;<span class="op" id="8357930">=</span>&nbsp;<span class="ident" id="8357932">tt</span><span class="op" id="8357934">.</span><span class="ident" id="8357935">laddr2</span>&nbsp;<span class="op" id="8357942">+</span>&nbsp;<span class="string" id="8357944">&#34;:&#34;</span>&nbsp;<span class="op" id="8357948">+</span>&nbsp;<span class="ident" id="8357950">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357957">l2</span><span class="op" id="8357959">,</span>&nbsp;<span class="ident" id="8357961">err</span>&nbsp;<span class="op" id="8357965">:=</span>&nbsp;<span class="ident" id="8357968">Listen</span><span class="op" id="8357974">(</span><span class="ident" id="8357975">tt</span><span class="op" id="8357977">.</span><span class="ident" id="8357978">net2</span><span class="op" id="8357982">,</span>&nbsp;<span class="ident" id="8357984">laddr</span><span class="op" id="8357989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8357993">checkDualStackSecondListener</span><span class="op" id="8358021">(</span><span class="ident" id="8358022">t</span><span class="op" id="8358023">,</span>&nbsp;<span class="ident" id="8358025">tt</span><span class="op" id="8358027">.</span><span class="ident" id="8358028">net2</span><span class="op" id="8358032">,</span>&nbsp;<span class="ident" id="8358034">laddr</span><span class="op" id="8358039">,</span>&nbsp;<span class="ident" id="8358041">tt</span><span class="op" id="8358043">.</span><span class="ident" id="8358044">xerr</span><span class="op" id="8358048">,</span>&nbsp;<span class="ident" id="8358050">err</span><span class="op" id="8358053">,</span>&nbsp;<span class="ident" id="8358055">l2</span><span class="op" id="8358057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358061">l1</span><span class="op" id="8358063">.</span><span class="ident" id="8358064">Close</span><span class="op" id="8358069">(</span><span class="op" id="8358070">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358073">}</span><br>
<span class="lineno"></span><span class="op" id="8358075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8358078">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8358142">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="8358205">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8358241">func</span>&nbsp;<span class="ident" id="8358246">TestDualStackUDPListener</span><span class="op" id="8358270">(</span><span class="ident" id="8358271">t</span>&nbsp;<span class="op" id="8358273">*</span><span class="ident" id="8358274">testing</span><span class="op" id="8358281">.</span><span class="ident" id="8358282">T</span><span class="op" id="8358283">)</span>&nbsp;<span class="op" id="8358285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358288">if</span>&nbsp;<span class="ident" id="8358291">testing</span><span class="op" id="8358298">.</span><span class="ident" id="8358299">Short</span><span class="op" id="8358304">(</span><span class="op" id="8358305">)</span>&nbsp;<span class="op" id="8358307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358311">t</span><span class="op" id="8358312">.</span><span class="ident" id="8358313">Skip</span><span class="op" id="8358317">(</span><span class="string" id="8358318">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8358359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358362">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358365">switch</span>&nbsp;<span class="ident" id="8358372">runtime</span><span class="op" id="8358379">.</span><span class="ident" id="8358380">GOOS</span>&nbsp;<span class="op" id="8358385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358388">case</span>&nbsp;<span class="string" id="8358393">&#34;plan9&#34;</span><span class="op" id="8358400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358404">t</span><span class="op" id="8358405">.</span><span class="ident" id="8358406">Skipf</span><span class="op" id="8358411">(</span><span class="string" id="8358412">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8358433">,</span>&nbsp;<span class="ident" id="8358435">runtime</span><span class="op" id="8358442">.</span><span class="ident" id="8358443">GOOS</span><span class="op" id="8358447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358453">if</span>&nbsp;<span class="op" id="8358456">!</span><span class="ident" id="8358457">supportsIPv6</span>&nbsp;<span class="op" id="8358470">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358474">t</span><span class="op" id="8358475">.</span><span class="ident" id="8358476">Skip</span><span class="op" id="8358480">(</span><span class="string" id="8358481">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8358504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358511">toudpnet</span>&nbsp;<span class="op" id="8358520">:=</span>&nbsp;<span class="keyword" id="8358523">func</span><span class="op" id="8358527">(</span><span class="ident" id="8358528">net</span>&nbsp;<span class="builtintype" id="8358532">string</span><span class="op" id="8358538">)</span>&nbsp;<span class="builtintype" id="8358540">string</span>&nbsp;<span class="op" id="8358547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358551">switch</span>&nbsp;<span class="ident" id="8358558">net</span>&nbsp;<span class="op" id="8358562">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358566">case</span>&nbsp;<span class="string" id="8358571">&#34;tcp&#34;</span><span class="op" id="8358576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358581">return</span>&nbsp;<span class="string" id="8358588">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358596">case</span>&nbsp;<span class="string" id="8358601">&#34;tcp4&#34;</span><span class="op" id="8358607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358612">return</span>&nbsp;<span class="string" id="8358619">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358628">case</span>&nbsp;<span class="string" id="8358633">&#34;tcp6&#34;</span><span class="op" id="8358639">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358644">return</span>&nbsp;<span class="string" id="8358651">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358664">return</span>&nbsp;<span class="string" id="8358671">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358684">for</span>&nbsp;<span class="ident" id="8358688">_</span><span class="op" id="8358689">,</span>&nbsp;<span class="ident" id="8358691">tt</span>&nbsp;<span class="op" id="8358694">:=</span>&nbsp;<span class="keyword" id="8358697">range</span>&nbsp;<span class="ident" id="8358703">dualStackListenerTests</span>&nbsp;<span class="op" id="8358726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358730">if</span>&nbsp;<span class="ident" id="8358733">tt</span><span class="op" id="8358735">.</span><span class="ident" id="8358736">wildcard</span>&nbsp;<span class="op" id="8358745">&amp;&amp;</span>&nbsp;<span class="op" id="8358748">(</span><span class="ident" id="8358749">testing</span><span class="op" id="8358756">.</span><span class="ident" id="8358757">Short</span><span class="op" id="8358762">(</span><span class="op" id="8358763">)</span>&nbsp;<span class="op" id="8358765">||</span>&nbsp;<span class="op" id="8358768">!</span><span class="op" id="8358769">*</span><span class="ident" id="8358770">testExternal</span><span class="op" id="8358782">)</span>&nbsp;<span class="op" id="8358784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358789">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358804">tt</span><span class="op" id="8358806">.</span><span class="ident" id="8358807">net1</span>&nbsp;<span class="op" id="8358812">=</span>&nbsp;<span class="ident" id="8358814">toudpnet</span><span class="op" id="8358822">(</span><span class="ident" id="8358823">tt</span><span class="op" id="8358825">.</span><span class="ident" id="8358826">net1</span><span class="op" id="8358830">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358834">tt</span><span class="op" id="8358836">.</span><span class="ident" id="8358837">net2</span>&nbsp;<span class="op" id="8358842">=</span>&nbsp;<span class="ident" id="8358844">toudpnet</span><span class="op" id="8358852">(</span><span class="ident" id="8358853">tt</span><span class="op" id="8358855">.</span><span class="ident" id="8358856">net2</span><span class="op" id="8358860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358864">switch</span>&nbsp;<span class="ident" id="8358871">runtime</span><span class="op" id="8358878">.</span><span class="ident" id="8358879">GOOS</span>&nbsp;<span class="op" id="8358884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358888">case</span>&nbsp;<span class="string" id="8358893">&#34;openbsd&#34;</span><span class="op" id="8358902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8358907">if</span>&nbsp;<span class="ident" id="8358910">tt</span><span class="op" id="8358912">.</span><span class="ident" id="8358913">wildcard</span>&nbsp;<span class="op" id="8358922">&amp;&amp;</span>&nbsp;<span class="ident" id="8358925">differentWildcardAddr</span><span class="op" id="8358946">(</span><span class="ident" id="8358947">tt</span><span class="op" id="8358949">.</span><span class="ident" id="8358950">laddr1</span><span class="op" id="8358956">,</span>&nbsp;<span class="ident" id="8358958">tt</span><span class="op" id="8358960">.</span><span class="ident" id="8358961">laddr2</span><span class="op" id="8358967">)</span>&nbsp;<span class="op" id="8358969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8358975">tt</span><span class="op" id="8358977">.</span><span class="ident" id="8358978">xerr</span>&nbsp;<span class="op" id="8358983">=</span>&nbsp;<span class="ident" id="8358985">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8358996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359000">l1</span><span class="op" id="8359002">,</span>&nbsp;<span class="ident" id="8359004">port</span>&nbsp;<span class="op" id="8359009">:=</span>&nbsp;<span class="ident" id="8359012">usableListenPacketPort</span><span class="op" id="8359034">(</span><span class="ident" id="8359035">t</span><span class="op" id="8359036">,</span>&nbsp;<span class="ident" id="8359038">tt</span><span class="op" id="8359040">.</span><span class="ident" id="8359041">net1</span><span class="op" id="8359045">,</span>&nbsp;<span class="ident" id="8359047">tt</span><span class="op" id="8359049">.</span><span class="ident" id="8359050">laddr1</span><span class="op" id="8359056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359060">laddr</span>&nbsp;<span class="op" id="8359066">:=</span>&nbsp;<span class="ident" id="8359069">tt</span><span class="op" id="8359071">.</span><span class="ident" id="8359072">laddr1</span>&nbsp;<span class="op" id="8359079">+</span>&nbsp;<span class="string" id="8359081">&#34;:&#34;</span>&nbsp;<span class="op" id="8359085">+</span>&nbsp;<span class="ident" id="8359087">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359094">checkFirstListener</span><span class="op" id="8359112">(</span><span class="ident" id="8359113">t</span><span class="op" id="8359114">,</span>&nbsp;<span class="ident" id="8359116">tt</span><span class="op" id="8359118">.</span><span class="ident" id="8359119">net1</span><span class="op" id="8359123">,</span>&nbsp;<span class="ident" id="8359125">laddr</span><span class="op" id="8359130">,</span>&nbsp;<span class="ident" id="8359132">l1</span><span class="op" id="8359134">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359138">laddr</span>&nbsp;<span class="op" id="8359144">=</span>&nbsp;<span class="ident" id="8359146">tt</span><span class="op" id="8359148">.</span><span class="ident" id="8359149">laddr2</span>&nbsp;<span class="op" id="8359156">+</span>&nbsp;<span class="string" id="8359158">&#34;:&#34;</span>&nbsp;<span class="op" id="8359162">+</span>&nbsp;<span class="ident" id="8359164">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359171">l2</span><span class="op" id="8359173">,</span>&nbsp;<span class="ident" id="8359175">err</span>&nbsp;<span class="op" id="8359179">:=</span>&nbsp;<span class="ident" id="8359182">ListenPacket</span><span class="op" id="8359194">(</span><span class="ident" id="8359195">tt</span><span class="op" id="8359197">.</span><span class="ident" id="8359198">net2</span><span class="op" id="8359202">,</span>&nbsp;<span class="ident" id="8359204">laddr</span><span class="op" id="8359209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359213">checkDualStackSecondListener</span><span class="op" id="8359241">(</span><span class="ident" id="8359242">t</span><span class="op" id="8359243">,</span>&nbsp;<span class="ident" id="8359245">tt</span><span class="op" id="8359247">.</span><span class="ident" id="8359248">net2</span><span class="op" id="8359252">,</span>&nbsp;<span class="ident" id="8359254">laddr</span><span class="op" id="8359259">,</span>&nbsp;<span class="ident" id="8359261">tt</span><span class="op" id="8359263">.</span><span class="ident" id="8359264">xerr</span><span class="op" id="8359268">,</span>&nbsp;<span class="ident" id="8359270">err</span><span class="op" id="8359273">,</span>&nbsp;<span class="ident" id="8359275">l2</span><span class="op" id="8359277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359281">l1</span><span class="op" id="8359283">.</span><span class="ident" id="8359284">Close</span><span class="op" id="8359289">(</span><span class="op" id="8359290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359293">}</span><br>
<span class="lineno">250</span><span class="op" id="8359295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8359298">func</span>&nbsp;<span class="ident" id="8359303">usableListenPort</span><span class="op" id="8359319">(</span><span class="ident" id="8359320">t</span>&nbsp;<span class="op" id="8359322">*</span><span class="ident" id="8359323">testing</span><span class="op" id="8359330">.</span><span class="ident" id="8359331">T</span><span class="op" id="8359332">,</span>&nbsp;<span class="ident" id="8359334">net</span><span class="op" id="8359337">,</span>&nbsp;<span class="ident" id="8359339">laddr</span>&nbsp;<span class="builtintype" id="8359345">string</span><span class="op" id="8359351">)</span>&nbsp;<span class="op" id="8359353">(</span><span class="ident" id="8359354">l</span>&nbsp;<span class="ident" id="8359356">Listener</span><span class="op" id="8359364">,</span>&nbsp;<span class="ident" id="8359366">port</span>&nbsp;<span class="builtintype" id="8359371">string</span><span class="op" id="8359377">)</span>&nbsp;<span class="op" id="8359379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359382">var</span>&nbsp;<span class="ident" id="8359386">nladdr</span>&nbsp;<span class="builtintype" id="8359393">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359401">var</span>&nbsp;<span class="ident" id="8359405">err</span>&nbsp;<span class="builtintype" id="8359409">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359416">switch</span>&nbsp;<span class="ident" id="8359423">net</span>&nbsp;<span class="op" id="8359427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359430">default</span><span class="op" id="8359437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8359441">panic</span><span class="op" id="8359446">(</span><span class="string" id="8359447">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8359471">+</span>&nbsp;<span class="ident" id="8359473">net</span><span class="op" id="8359476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359479">case</span>&nbsp;<span class="string" id="8359484">&#34;tcp&#34;</span><span class="op" id="8359489">,</span>&nbsp;<span class="string" id="8359491">&#34;tcp4&#34;</span><span class="op" id="8359497">,</span>&nbsp;<span class="string" id="8359499">&#34;tcp6&#34;</span><span class="op" id="8359505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359509">l</span><span class="op" id="8359510">,</span>&nbsp;<span class="ident" id="8359512">err</span>&nbsp;<span class="op" id="8359516">=</span>&nbsp;<span class="ident" id="8359518">Listen</span><span class="op" id="8359524">(</span><span class="ident" id="8359525">net</span><span class="op" id="8359528">,</span>&nbsp;<span class="ident" id="8359530">laddr</span><span class="op" id="8359535">+</span><span class="string" id="8359536">&#34;:0&#34;</span><span class="op" id="8359540">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359544">if</span>&nbsp;<span class="ident" id="8359547">err</span>&nbsp;<span class="op" id="8359551">!=</span>&nbsp;<span class="ident" id="8359554">nil</span>&nbsp;<span class="op" id="8359558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359563">t</span><span class="op" id="8359564">.</span><span class="ident" id="8359565">Fatalf</span><span class="op" id="8359571">(</span><span class="string" id="8359572">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8359605">,</span>&nbsp;<span class="ident" id="8359607">net</span><span class="op" id="8359610">,</span>&nbsp;<span class="ident" id="8359612">laddr</span><span class="op" id="8359617">,</span>&nbsp;<span class="ident" id="8359619">err</span><span class="op" id="8359622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359630">nladdr</span>&nbsp;<span class="op" id="8359637">=</span>&nbsp;<span class="ident" id="8359639">l</span><span class="op" id="8359640">.</span><span class="op" id="8359641">(</span><span class="op" id="8359642">*</span><span class="ident" id="8359643">TCPListener</span><span class="op" id="8359654">)</span><span class="op" id="8359655">.</span><span class="ident" id="8359656">Addr</span><span class="op" id="8359660">(</span><span class="op" id="8359661">)</span><span class="op" id="8359662">.</span><span class="ident" id="8359663">String</span><span class="op" id="8359669">(</span><span class="op" id="8359670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359673">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359676">_</span><span class="op" id="8359677">,</span>&nbsp;<span class="ident" id="8359679">port</span><span class="op" id="8359683">,</span>&nbsp;<span class="ident" id="8359685">err</span>&nbsp;<span class="op" id="8359689">=</span>&nbsp;<span class="ident" id="8359691">SplitHostPort</span><span class="op" id="8359704">(</span><span class="ident" id="8359705">nladdr</span><span class="op" id="8359711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359714">if</span>&nbsp;<span class="ident" id="8359717">err</span>&nbsp;<span class="op" id="8359721">!=</span>&nbsp;<span class="ident" id="8359724">nil</span>&nbsp;<span class="op" id="8359728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8359732">t</span><span class="op" id="8359733">.</span><span class="ident" id="8359734">Fatalf</span><span class="op" id="8359740">(</span><span class="string" id="8359741">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8359767">,</span>&nbsp;<span class="ident" id="8359769">err</span><span class="op" id="8359772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8359775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359778">return</span>&nbsp;<span class="ident" id="8359785">l</span><span class="op" id="8359786">,</span>&nbsp;<span class="ident" id="8359788">port</span><br>
<span class="lineno">270</span><span class="op" id="8359793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8359796">func</span>&nbsp;<span class="ident" id="8359801">usableListenPacketPort</span><span class="op" id="8359823">(</span><span class="ident" id="8359824">t</span>&nbsp;<span class="op" id="8359826">*</span><span class="ident" id="8359827">testing</span><span class="op" id="8359834">.</span><span class="ident" id="8359835">T</span><span class="op" id="8359836">,</span>&nbsp;<span class="ident" id="8359838">net</span><span class="op" id="8359841">,</span>&nbsp;<span class="ident" id="8359843">laddr</span>&nbsp;<span class="builtintype" id="8359849">string</span><span class="op" id="8359855">)</span>&nbsp;<span class="op" id="8359857">(</span><span class="ident" id="8359858">l</span>&nbsp;<span class="ident" id="8359860">PacketConn</span><span class="op" id="8359870">,</span>&nbsp;<span class="ident" id="8359872">port</span>&nbsp;<span class="builtintype" id="8359877">string</span><span class="op" id="8359883">)</span>&nbsp;<span class="op" id="8359885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359888">var</span>&nbsp;<span class="ident" id="8359892">nladdr</span>&nbsp;<span class="builtintype" id="8359899">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359907">var</span>&nbsp;<span class="ident" id="8359911">err</span>&nbsp;<span class="builtintype" id="8359915">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359922">switch</span>&nbsp;<span class="ident" id="8359929">net</span>&nbsp;<span class="op" id="8359933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359936">default</span><span class="op" id="8359943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8359947">panic</span><span class="op" id="8359952">(</span><span class="string" id="8359953">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8359983">+</span>&nbsp;<span class="ident" id="8359985">net</span><span class="op" id="8359988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8359991">case</span>&nbsp;<span class="string" id="8359996">&#34;udp&#34;</span><span class="op" id="8360001">,</span>&nbsp;<span class="string" id="8360003">&#34;udp4&#34;</span><span class="op" id="8360009">,</span>&nbsp;<span class="string" id="8360011">&#34;udp6&#34;</span><span class="op" id="8360017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360021">l</span><span class="op" id="8360022">,</span>&nbsp;<span class="ident" id="8360024">err</span>&nbsp;<span class="op" id="8360028">=</span>&nbsp;<span class="ident" id="8360030">ListenPacket</span><span class="op" id="8360042">(</span><span class="ident" id="8360043">net</span><span class="op" id="8360046">,</span>&nbsp;<span class="ident" id="8360048">laddr</span><span class="op" id="8360053">+</span><span class="string" id="8360054">&#34;:0&#34;</span><span class="op" id="8360058">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360062">if</span>&nbsp;<span class="ident" id="8360065">err</span>&nbsp;<span class="op" id="8360069">!=</span>&nbsp;<span class="ident" id="8360072">nil</span>&nbsp;<span class="op" id="8360076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360081">t</span><span class="op" id="8360082">.</span><span class="ident" id="8360083">Fatalf</span><span class="op" id="8360089">(</span><span class="string" id="8360090">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8360129">,</span>&nbsp;<span class="ident" id="8360131">net</span><span class="op" id="8360134">,</span>&nbsp;<span class="ident" id="8360136">laddr</span><span class="op" id="8360141">,</span>&nbsp;<span class="ident" id="8360143">err</span><span class="op" id="8360146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360154">nladdr</span>&nbsp;<span class="op" id="8360161">=</span>&nbsp;<span class="ident" id="8360163">l</span><span class="op" id="8360164">.</span><span class="op" id="8360165">(</span><span class="op" id="8360166">*</span><span class="ident" id="8360167">UDPConn</span><span class="op" id="8360174">)</span><span class="op" id="8360175">.</span><span class="ident" id="8360176">LocalAddr</span><span class="op" id="8360185">(</span><span class="op" id="8360186">)</span><span class="op" id="8360187">.</span><span class="ident" id="8360188">String</span><span class="op" id="8360194">(</span><span class="op" id="8360195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360198">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360201">_</span><span class="op" id="8360202">,</span>&nbsp;<span class="ident" id="8360204">port</span><span class="op" id="8360208">,</span>&nbsp;<span class="ident" id="8360210">err</span>&nbsp;<span class="op" id="8360214">=</span>&nbsp;<span class="ident" id="8360216">SplitHostPort</span><span class="op" id="8360229">(</span><span class="ident" id="8360230">nladdr</span><span class="op" id="8360236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360239">if</span>&nbsp;<span class="ident" id="8360242">err</span>&nbsp;<span class="op" id="8360246">!=</span>&nbsp;<span class="ident" id="8360249">nil</span>&nbsp;<span class="op" id="8360253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360257">t</span><span class="op" id="8360258">.</span><span class="ident" id="8360259">Fatalf</span><span class="op" id="8360265">(</span><span class="string" id="8360266">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8360292">,</span>&nbsp;<span class="ident" id="8360294">err</span><span class="op" id="8360297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360303">return</span>&nbsp;<span class="ident" id="8360310">l</span><span class="op" id="8360311">,</span>&nbsp;<span class="ident" id="8360313">port</span><br>
<span class="lineno">290</span><span class="op" id="8360318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8360321">func</span>&nbsp;<span class="ident" id="8360326">differentWildcardAddr</span><span class="op" id="8360347">(</span><span class="ident" id="8360348">i</span><span class="op" id="8360349">,</span>&nbsp;<span class="ident" id="8360351">j</span>&nbsp;<span class="builtintype" id="8360353">string</span><span class="op" id="8360359">)</span>&nbsp;<span class="builtintype" id="8360361">bool</span>&nbsp;<span class="op" id="8360366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360369">if</span>&nbsp;<span class="op" id="8360372">(</span><span class="ident" id="8360373">i</span>&nbsp;<span class="op" id="8360375">==</span>&nbsp;<span class="string" id="8360378">&#34;&#34;</span>&nbsp;<span class="op" id="8360381">||</span>&nbsp;<span class="ident" id="8360384">i</span>&nbsp;<span class="op" id="8360386">==</span>&nbsp;<span class="string" id="8360389">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8360399">||</span>&nbsp;<span class="ident" id="8360402">i</span>&nbsp;<span class="op" id="8360404">==</span>&nbsp;<span class="string" id="8360407">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8360423">)</span>&nbsp;<span class="op" id="8360425">&amp;&amp;</span>&nbsp;<span class="op" id="8360428">(</span><span class="ident" id="8360429">j</span>&nbsp;<span class="op" id="8360431">==</span>&nbsp;<span class="string" id="8360434">&#34;&#34;</span>&nbsp;<span class="op" id="8360437">||</span>&nbsp;<span class="ident" id="8360440">j</span>&nbsp;<span class="op" id="8360442">==</span>&nbsp;<span class="string" id="8360445">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8360455">||</span>&nbsp;<span class="ident" id="8360458">j</span>&nbsp;<span class="op" id="8360460">==</span>&nbsp;<span class="string" id="8360463">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8360479">)</span>&nbsp;<span class="op" id="8360481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360485">return</span>&nbsp;<span class="builtintype" id="8360492">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360502">if</span>&nbsp;<span class="ident" id="8360505">i</span>&nbsp;<span class="op" id="8360507">==</span>&nbsp;<span class="string" id="8360510">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8360517">&amp;&amp;</span>&nbsp;<span class="ident" id="8360520">j</span>&nbsp;<span class="op" id="8360522">==</span>&nbsp;<span class="string" id="8360525">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8360532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360536">return</span>&nbsp;<span class="builtintype" id="8360543">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360553">return</span>&nbsp;<span class="builtintype" id="8360560">true</span><br>
<span class="lineno">300</span><span class="op" id="8360565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8360568">func</span>&nbsp;<span class="ident" id="8360573">checkFirstListener</span><span class="op" id="8360591">(</span><span class="ident" id="8360592">t</span>&nbsp;<span class="op" id="8360594">*</span><span class="ident" id="8360595">testing</span><span class="op" id="8360602">.</span><span class="ident" id="8360603">T</span><span class="op" id="8360604">,</span>&nbsp;<span class="ident" id="8360606">net</span><span class="op" id="8360609">,</span>&nbsp;<span class="ident" id="8360611">laddr</span>&nbsp;<span class="builtintype" id="8360617">string</span><span class="op" id="8360623">,</span>&nbsp;<span class="ident" id="8360625">l</span>&nbsp;<span class="keyword" id="8360627">interface</span><span class="op" id="8360636">{</span><span class="op" id="8360637">}</span><span class="op" id="8360638">)</span>&nbsp;<span class="op" id="8360640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360643">switch</span>&nbsp;<span class="ident" id="8360650">net</span>&nbsp;<span class="op" id="8360654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360657">case</span>&nbsp;<span class="string" id="8360662">&#34;tcp&#34;</span><span class="op" id="8360667">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360671">fd</span>&nbsp;<span class="op" id="8360674">:=</span>&nbsp;<span class="ident" id="8360677">l</span><span class="op" id="8360678">.</span><span class="op" id="8360679">(</span><span class="op" id="8360680">*</span><span class="ident" id="8360681">TCPListener</span><span class="op" id="8360692">)</span><span class="op" id="8360693">.</span><span class="ident" id="8360694">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360699">checkDualStackAddrFamily</span><span class="op" id="8360723">(</span><span class="ident" id="8360724">t</span><span class="op" id="8360725">,</span>&nbsp;<span class="ident" id="8360727">net</span><span class="op" id="8360730">,</span>&nbsp;<span class="ident" id="8360732">laddr</span><span class="op" id="8360737">,</span>&nbsp;<span class="ident" id="8360739">fd</span><span class="op" id="8360741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360744">case</span>&nbsp;<span class="string" id="8360749">&#34;tcp4&#34;</span><span class="op" id="8360755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360759">fd</span>&nbsp;<span class="op" id="8360762">:=</span>&nbsp;<span class="ident" id="8360765">l</span><span class="op" id="8360766">.</span><span class="op" id="8360767">(</span><span class="op" id="8360768">*</span><span class="ident" id="8360769">TCPListener</span><span class="op" id="8360780">)</span><span class="op" id="8360781">.</span><span class="ident" id="8360782">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360787">if</span>&nbsp;<span class="ident" id="8360790">fd</span><span class="op" id="8360792">.</span><span class="ident" id="8360793">family</span>&nbsp;<span class="op" id="8360800">!=</span>&nbsp;<span class="ident" id="8360803">syscall</span><span class="op" id="8360810">.</span><span class="ident" id="8360811">AF_INET</span>&nbsp;<span class="op" id="8360819">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360824">t</span><span class="op" id="8360825">.</span><span class="ident" id="8360826">Fatalf</span><span class="op" id="8360832">(</span><span class="string" id="8360833">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8360894">,</span>&nbsp;<span class="ident" id="8360896">net</span><span class="op" id="8360899">,</span>&nbsp;<span class="ident" id="8360901">laddr</span><span class="op" id="8360906">,</span>&nbsp;<span class="ident" id="8360908">fd</span><span class="op" id="8360910">.</span><span class="ident" id="8360911">family</span><span class="op" id="8360917">,</span>&nbsp;<span class="ident" id="8360919">syscall</span><span class="op" id="8360926">.</span><span class="ident" id="8360927">AF_INET</span><span class="op" id="8360934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8360938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360941">case</span>&nbsp;<span class="string" id="8360946">&#34;tcp6&#34;</span><span class="op" id="8360952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8360956">fd</span>&nbsp;<span class="op" id="8360959">:=</span>&nbsp;<span class="ident" id="8360962">l</span><span class="op" id="8360963">.</span><span class="op" id="8360964">(</span><span class="op" id="8360965">*</span><span class="ident" id="8360966">TCPListener</span><span class="op" id="8360977">)</span><span class="op" id="8360978">.</span><span class="ident" id="8360979">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8360984">if</span>&nbsp;<span class="ident" id="8360987">fd</span><span class="op" id="8360989">.</span><span class="ident" id="8360990">family</span>&nbsp;<span class="op" id="8360997">!=</span>&nbsp;<span class="ident" id="8361000">syscall</span><span class="op" id="8361007">.</span><span class="ident" id="8361008">AF_INET6</span>&nbsp;<span class="op" id="8361017">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361022">t</span><span class="op" id="8361023">.</span><span class="ident" id="8361024">Fatalf</span><span class="op" id="8361030">(</span><span class="string" id="8361031">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8361092">,</span>&nbsp;<span class="ident" id="8361094">net</span><span class="op" id="8361097">,</span>&nbsp;<span class="ident" id="8361099">laddr</span><span class="op" id="8361104">,</span>&nbsp;<span class="ident" id="8361106">fd</span><span class="op" id="8361108">.</span><span class="ident" id="8361109">family</span><span class="op" id="8361115">,</span>&nbsp;<span class="ident" id="8361117">syscall</span><span class="op" id="8361124">.</span><span class="ident" id="8361125">AF_INET6</span><span class="op" id="8361133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361140">case</span>&nbsp;<span class="string" id="8361145">&#34;udp&#34;</span><span class="op" id="8361150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361154">fd</span>&nbsp;<span class="op" id="8361157">:=</span>&nbsp;<span class="ident" id="8361160">l</span><span class="op" id="8361161">.</span><span class="op" id="8361162">(</span><span class="op" id="8361163">*</span><span class="ident" id="8361164">UDPConn</span><span class="op" id="8361171">)</span><span class="op" id="8361172">.</span><span class="ident" id="8361173">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361178">checkDualStackAddrFamily</span><span class="op" id="8361202">(</span><span class="ident" id="8361203">t</span><span class="op" id="8361204">,</span>&nbsp;<span class="ident" id="8361206">net</span><span class="op" id="8361209">,</span>&nbsp;<span class="ident" id="8361211">laddr</span><span class="op" id="8361216">,</span>&nbsp;<span class="ident" id="8361218">fd</span><span class="op" id="8361220">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361223">case</span>&nbsp;<span class="string" id="8361228">&#34;udp4&#34;</span><span class="op" id="8361234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361238">fd</span>&nbsp;<span class="op" id="8361241">:=</span>&nbsp;<span class="ident" id="8361244">l</span><span class="op" id="8361245">.</span><span class="op" id="8361246">(</span><span class="op" id="8361247">*</span><span class="ident" id="8361248">UDPConn</span><span class="op" id="8361255">)</span><span class="op" id="8361256">.</span><span class="ident" id="8361257">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361262">if</span>&nbsp;<span class="ident" id="8361265">fd</span><span class="op" id="8361267">.</span><span class="ident" id="8361268">family</span>&nbsp;<span class="op" id="8361275">!=</span>&nbsp;<span class="ident" id="8361278">syscall</span><span class="op" id="8361285">.</span><span class="ident" id="8361286">AF_INET</span>&nbsp;<span class="op" id="8361294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361299">t</span><span class="op" id="8361300">.</span><span class="ident" id="8361301">Fatalf</span><span class="op" id="8361307">(</span><span class="string" id="8361308">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8361375">,</span>&nbsp;<span class="ident" id="8361377">net</span><span class="op" id="8361380">,</span>&nbsp;<span class="ident" id="8361382">laddr</span><span class="op" id="8361387">,</span>&nbsp;<span class="ident" id="8361389">fd</span><span class="op" id="8361391">.</span><span class="ident" id="8361392">family</span><span class="op" id="8361398">,</span>&nbsp;<span class="ident" id="8361400">syscall</span><span class="op" id="8361407">.</span><span class="ident" id="8361408">AF_INET</span><span class="op" id="8361415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361419">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361422">case</span>&nbsp;<span class="string" id="8361427">&#34;udp6&#34;</span><span class="op" id="8361433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361437">fd</span>&nbsp;<span class="op" id="8361440">:=</span>&nbsp;<span class="ident" id="8361443">l</span><span class="op" id="8361444">.</span><span class="op" id="8361445">(</span><span class="op" id="8361446">*</span><span class="ident" id="8361447">UDPConn</span><span class="op" id="8361454">)</span><span class="op" id="8361455">.</span><span class="ident" id="8361456">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361461">if</span>&nbsp;<span class="ident" id="8361464">fd</span><span class="op" id="8361466">.</span><span class="ident" id="8361467">family</span>&nbsp;<span class="op" id="8361474">!=</span>&nbsp;<span class="ident" id="8361477">syscall</span><span class="op" id="8361484">.</span><span class="ident" id="8361485">AF_INET6</span>&nbsp;<span class="op" id="8361494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361499">t</span><span class="op" id="8361500">.</span><span class="ident" id="8361501">Fatalf</span><span class="op" id="8361507">(</span><span class="string" id="8361508">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8361575">,</span>&nbsp;<span class="ident" id="8361577">net</span><span class="op" id="8361580">,</span>&nbsp;<span class="ident" id="8361582">laddr</span><span class="op" id="8361587">,</span>&nbsp;<span class="ident" id="8361589">fd</span><span class="op" id="8361591">.</span><span class="ident" id="8361592">family</span><span class="op" id="8361598">,</span>&nbsp;<span class="ident" id="8361600">syscall</span><span class="op" id="8361607">.</span><span class="ident" id="8361608">AF_INET6</span><span class="op" id="8361616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361620">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361623">default</span><span class="op" id="8361630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361634">t</span><span class="op" id="8361635">.</span><span class="ident" id="8361636">Fatalf</span><span class="op" id="8361642">(</span><span class="string" id="8361643">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8361667">,</span>&nbsp;<span class="ident" id="8361669">net</span><span class="op" id="8361672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361675">}</span><br>
<span class="lineno"></span><span class="op" id="8361677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="8361680">func</span>&nbsp;<span class="ident" id="8361685">checkSecondListener</span><span class="op" id="8361704">(</span><span class="ident" id="8361705">t</span>&nbsp;<span class="op" id="8361707">*</span><span class="ident" id="8361708">testing</span><span class="op" id="8361715">.</span><span class="ident" id="8361716">T</span><span class="op" id="8361717">,</span>&nbsp;<span class="ident" id="8361719">net</span><span class="op" id="8361722">,</span>&nbsp;<span class="ident" id="8361724">laddr</span>&nbsp;<span class="builtintype" id="8361730">string</span><span class="op" id="8361736">,</span>&nbsp;<span class="ident" id="8361738">err</span>&nbsp;<span class="builtintype" id="8361742">error</span><span class="op" id="8361747">,</span>&nbsp;<span class="ident" id="8361749">l</span>&nbsp;<span class="keyword" id="8361751">interface</span><span class="op" id="8361760">{</span><span class="op" id="8361761">}</span><span class="op" id="8361762">)</span>&nbsp;<span class="op" id="8361764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361767">switch</span>&nbsp;<span class="ident" id="8361774">net</span>&nbsp;<span class="op" id="8361778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361781">case</span>&nbsp;<span class="string" id="8361786">&#34;tcp&#34;</span><span class="op" id="8361791">,</span>&nbsp;<span class="string" id="8361793">&#34;tcp4&#34;</span><span class="op" id="8361799">,</span>&nbsp;<span class="string" id="8361801">&#34;tcp6&#34;</span><span class="op" id="8361807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361811">if</span>&nbsp;<span class="ident" id="8361814">err</span>&nbsp;<span class="op" id="8361818">==</span>&nbsp;<span class="ident" id="8361821">nil</span>&nbsp;<span class="op" id="8361825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361830">l</span><span class="op" id="8361831">.</span><span class="op" id="8361832">(</span><span class="op" id="8361833">*</span><span class="ident" id="8361834">TCPListener</span><span class="op" id="8361845">)</span><span class="op" id="8361846">.</span><span class="ident" id="8361847">Close</span><span class="op" id="8361852">(</span><span class="op" id="8361853">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361858">t</span><span class="op" id="8361859">.</span><span class="ident" id="8361860">Fatalf</span><span class="op" id="8361866">(</span><span class="string" id="8361867">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8361902">,</span>&nbsp;<span class="ident" id="8361904">net</span><span class="op" id="8361907">,</span>&nbsp;<span class="ident" id="8361909">laddr</span><span class="op" id="8361914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8361918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361921">case</span>&nbsp;<span class="string" id="8361926">&#34;udp&#34;</span><span class="op" id="8361931">,</span>&nbsp;<span class="string" id="8361933">&#34;udp4&#34;</span><span class="op" id="8361939">,</span>&nbsp;<span class="string" id="8361941">&#34;udp6&#34;</span><span class="op" id="8361947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8361951">if</span>&nbsp;<span class="ident" id="8361954">err</span>&nbsp;<span class="op" id="8361958">==</span>&nbsp;<span class="ident" id="8361961">nil</span>&nbsp;<span class="op" id="8361965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361970">l</span><span class="op" id="8361971">.</span><span class="op" id="8361972">(</span><span class="op" id="8361973">*</span><span class="ident" id="8361974">UDPConn</span><span class="op" id="8361981">)</span><span class="op" id="8361982">.</span><span class="ident" id="8361983">Close</span><span class="op" id="8361988">(</span><span class="op" id="8361989">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8361994">t</span><span class="op" id="8361995">.</span><span class="ident" id="8361996">Fatalf</span><span class="op" id="8362002">(</span><span class="string" id="8362003">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8362044">,</span>&nbsp;<span class="ident" id="8362046">net</span><span class="op" id="8362049">,</span>&nbsp;<span class="ident" id="8362051">laddr</span><span class="op" id="8362056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362063">default</span><span class="op" id="8362070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362074">t</span><span class="op" id="8362075">.</span><span class="ident" id="8362076">Fatalf</span><span class="op" id="8362082">(</span><span class="string" id="8362083">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8362107">,</span>&nbsp;<span class="ident" id="8362109">net</span><span class="op" id="8362112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362115">}</span><br>
<span class="lineno">350</span><span class="op" id="8362117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8362120">func</span>&nbsp;<span class="ident" id="8362125">checkDualStackSecondListener</span><span class="op" id="8362153">(</span><span class="ident" id="8362154">t</span>&nbsp;<span class="op" id="8362156">*</span><span class="ident" id="8362157">testing</span><span class="op" id="8362164">.</span><span class="ident" id="8362165">T</span><span class="op" id="8362166">,</span>&nbsp;<span class="ident" id="8362168">net</span><span class="op" id="8362171">,</span>&nbsp;<span class="ident" id="8362173">laddr</span>&nbsp;<span class="builtintype" id="8362179">string</span><span class="op" id="8362185">,</span>&nbsp;<span class="ident" id="8362187">xerr</span><span class="op" id="8362191">,</span>&nbsp;<span class="ident" id="8362193">err</span>&nbsp;<span class="builtintype" id="8362197">error</span><span class="op" id="8362202">,</span>&nbsp;<span class="ident" id="8362204">l</span>&nbsp;<span class="keyword" id="8362206">interface</span><span class="op" id="8362215">{</span><span class="op" id="8362216">}</span><span class="op" id="8362217">)</span>&nbsp;<span class="op" id="8362219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362222">switch</span>&nbsp;<span class="ident" id="8362229">net</span>&nbsp;<span class="op" id="8362233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362236">case</span>&nbsp;<span class="string" id="8362241">&#34;tcp&#34;</span><span class="op" id="8362246">,</span>&nbsp;<span class="string" id="8362248">&#34;tcp4&#34;</span><span class="op" id="8362254">,</span>&nbsp;<span class="string" id="8362256">&#34;tcp6&#34;</span><span class="op" id="8362262">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362266">if</span>&nbsp;<span class="ident" id="8362269">xerr</span>&nbsp;<span class="op" id="8362274">==</span>&nbsp;<span class="ident" id="8362277">nil</span>&nbsp;<span class="op" id="8362281">&amp;&amp;</span>&nbsp;<span class="ident" id="8362284">err</span>&nbsp;<span class="op" id="8362288">!=</span>&nbsp;<span class="ident" id="8362291">nil</span>&nbsp;<span class="op" id="8362295">||</span>&nbsp;<span class="ident" id="8362298">xerr</span>&nbsp;<span class="op" id="8362303">!=</span>&nbsp;<span class="ident" id="8362306">nil</span>&nbsp;<span class="op" id="8362310">&amp;&amp;</span>&nbsp;<span class="ident" id="8362313">err</span>&nbsp;<span class="op" id="8362317">==</span>&nbsp;<span class="ident" id="8362320">nil</span>&nbsp;<span class="op" id="8362324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362329">t</span><span class="op" id="8362330">.</span><span class="ident" id="8362331">Fatalf</span><span class="op" id="8362337">(</span><span class="string" id="8362338">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8362385">,</span>&nbsp;<span class="ident" id="8362387">net</span><span class="op" id="8362390">,</span>&nbsp;<span class="ident" id="8362392">laddr</span><span class="op" id="8362397">,</span>&nbsp;<span class="ident" id="8362399">err</span><span class="op" id="8362402">,</span>&nbsp;<span class="ident" id="8362404">xerr</span><span class="op" id="8362408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362416">if</span>&nbsp;<span class="ident" id="8362419">err</span>&nbsp;<span class="op" id="8362423">==</span>&nbsp;<span class="ident" id="8362426">nil</span>&nbsp;<span class="op" id="8362430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362435">l</span><span class="op" id="8362436">.</span><span class="op" id="8362437">(</span><span class="op" id="8362438">*</span><span class="ident" id="8362439">TCPListener</span><span class="op" id="8362450">)</span><span class="op" id="8362451">.</span><span class="ident" id="8362452">Close</span><span class="op" id="8362457">(</span><span class="op" id="8362458">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362465">case</span>&nbsp;<span class="string" id="8362470">&#34;udp&#34;</span><span class="op" id="8362475">,</span>&nbsp;<span class="string" id="8362477">&#34;udp4&#34;</span><span class="op" id="8362483">,</span>&nbsp;<span class="string" id="8362485">&#34;udp6&#34;</span><span class="op" id="8362491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362495">if</span>&nbsp;<span class="ident" id="8362498">xerr</span>&nbsp;<span class="op" id="8362503">==</span>&nbsp;<span class="ident" id="8362506">nil</span>&nbsp;<span class="op" id="8362510">&amp;&amp;</span>&nbsp;<span class="ident" id="8362513">err</span>&nbsp;<span class="op" id="8362517">!=</span>&nbsp;<span class="ident" id="8362520">nil</span>&nbsp;<span class="op" id="8362524">||</span>&nbsp;<span class="ident" id="8362527">xerr</span>&nbsp;<span class="op" id="8362532">!=</span>&nbsp;<span class="ident" id="8362535">nil</span>&nbsp;<span class="op" id="8362539">&amp;&amp;</span>&nbsp;<span class="ident" id="8362542">err</span>&nbsp;<span class="op" id="8362546">==</span>&nbsp;<span class="ident" id="8362549">nil</span>&nbsp;<span class="op" id="8362553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362558">t</span><span class="op" id="8362559">.</span><span class="ident" id="8362560">Fatalf</span><span class="op" id="8362566">(</span><span class="string" id="8362567">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8362620">,</span>&nbsp;<span class="ident" id="8362622">net</span><span class="op" id="8362625">,</span>&nbsp;<span class="ident" id="8362627">laddr</span><span class="op" id="8362632">,</span>&nbsp;<span class="ident" id="8362634">err</span><span class="op" id="8362637">,</span>&nbsp;<span class="ident" id="8362639">xerr</span><span class="op" id="8362643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362647">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362651">if</span>&nbsp;<span class="ident" id="8362654">err</span>&nbsp;<span class="op" id="8362658">==</span>&nbsp;<span class="ident" id="8362661">nil</span>&nbsp;<span class="op" id="8362665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362670">l</span><span class="op" id="8362671">.</span><span class="op" id="8362672">(</span><span class="op" id="8362673">*</span><span class="ident" id="8362674">UDPConn</span><span class="op" id="8362681">)</span><span class="op" id="8362682">.</span><span class="ident" id="8362683">Close</span><span class="op" id="8362688">(</span><span class="op" id="8362689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362696">default</span><span class="op" id="8362703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8362707">t</span><span class="op" id="8362708">.</span><span class="ident" id="8362709">Fatalf</span><span class="op" id="8362715">(</span><span class="string" id="8362716">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8362740">,</span>&nbsp;<span class="ident" id="8362742">net</span><span class="op" id="8362745">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8362748">}</span><br>
<span class="lineno"></span><span class="op" id="8362750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8362753">func</span>&nbsp;<span class="ident" id="8362758">checkDualStackAddrFamily</span><span class="op" id="8362782">(</span><span class="ident" id="8362783">t</span>&nbsp;<span class="op" id="8362785">*</span><span class="ident" id="8362786">testing</span><span class="op" id="8362793">.</span><span class="ident" id="8362794">T</span><span class="op" id="8362795">,</span>&nbsp;<span class="ident" id="8362797">net</span><span class="op" id="8362800">,</span>&nbsp;<span class="ident" id="8362802">laddr</span>&nbsp;<span class="builtintype" id="8362808">string</span><span class="op" id="8362814">,</span>&nbsp;<span class="ident" id="8362816">fd</span>&nbsp;<span class="op" id="8362819">*</span><span class="ident" id="8362820">netFD</span><span class="op" id="8362825">)</span>&nbsp;<span class="op" id="8362827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362830">switch</span>&nbsp;<span class="ident" id="8362837">a</span>&nbsp;<span class="op" id="8362839">:=</span>&nbsp;<span class="ident" id="8362842">fd</span><span class="op" id="8362844">.</span><span class="ident" id="8362845">laddr</span><span class="op" id="8362850">.</span><span class="op" id="8362851">(</span><span class="keyword" id="8362852">type</span><span class="op" id="8362856">)</span>&nbsp;<span class="op" id="8362858">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8362861">case</span>&nbsp;<span class="op" id="8362866">*</span><span class="ident" id="8362867">TCPAddr</span><span class="op" id="8362874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8362878">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8362934">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8362987">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8363044">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363066">if</span>&nbsp;<span class="ident" id="8363069">supportsIPv4map</span>&nbsp;<span class="op" id="8363085">&amp;&amp;</span>&nbsp;<span class="ident" id="8363088">fd</span><span class="op" id="8363090">.</span><span class="ident" id="8363091">laddr</span><span class="op" id="8363096">.</span><span class="op" id="8363097">(</span><span class="op" id="8363098">*</span><span class="ident" id="8363099">TCPAddr</span><span class="op" id="8363106">)</span><span class="op" id="8363107">.</span><span class="ident" id="8363108">isWildcard</span><span class="op" id="8363118">(</span><span class="op" id="8363119">)</span>&nbsp;<span class="op" id="8363121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363126">if</span>&nbsp;<span class="ident" id="8363129">fd</span><span class="op" id="8363131">.</span><span class="ident" id="8363132">family</span>&nbsp;<span class="op" id="8363139">!=</span>&nbsp;<span class="ident" id="8363142">syscall</span><span class="op" id="8363149">.</span><span class="ident" id="8363150">AF_INET6</span>&nbsp;<span class="op" id="8363159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363165">t</span><span class="op" id="8363166">.</span><span class="ident" id="8363167">Fatalf</span><span class="op" id="8363173">(</span><span class="string" id="8363174">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8363229">,</span>&nbsp;<span class="ident" id="8363231">net</span><span class="op" id="8363234">,</span>&nbsp;<span class="ident" id="8363236">laddr</span><span class="op" id="8363241">,</span>&nbsp;<span class="ident" id="8363243">fd</span><span class="op" id="8363245">.</span><span class="ident" id="8363246">family</span><span class="op" id="8363252">,</span>&nbsp;<span class="ident" id="8363254">syscall</span><span class="op" id="8363261">.</span><span class="ident" id="8363262">AF_INET6</span><span class="op" id="8363270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363279">}</span>&nbsp;<span class="keyword" id="8363281">else</span>&nbsp;<span class="op" id="8363286">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363291">if</span>&nbsp;<span class="ident" id="8363294">fd</span><span class="op" id="8363296">.</span><span class="ident" id="8363297">family</span>&nbsp;<span class="op" id="8363304">!=</span>&nbsp;<span class="ident" id="8363307">a</span><span class="op" id="8363308">.</span><span class="ident" id="8363309">family</span><span class="op" id="8363315">(</span><span class="op" id="8363316">)</span>&nbsp;<span class="op" id="8363318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363324">t</span><span class="op" id="8363325">.</span><span class="ident" id="8363326">Fatalf</span><span class="op" id="8363332">(</span><span class="string" id="8363333">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8363388">,</span>&nbsp;<span class="ident" id="8363390">net</span><span class="op" id="8363393">,</span>&nbsp;<span class="ident" id="8363395">laddr</span><span class="op" id="8363400">,</span>&nbsp;<span class="ident" id="8363402">fd</span><span class="op" id="8363404">.</span><span class="ident" id="8363405">family</span><span class="op" id="8363411">,</span>&nbsp;<span class="ident" id="8363413">a</span><span class="op" id="8363414">.</span><span class="ident" id="8363415">family</span><span class="op" id="8363421">(</span><span class="op" id="8363422">)</span><span class="op" id="8363423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363435">case</span>&nbsp;<span class="op" id="8363440">*</span><span class="ident" id="8363441">UDPAddr</span><span class="op" id="8363448">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8363452">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8363508">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8363561">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8363618">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363640">if</span>&nbsp;<span class="ident" id="8363643">supportsIPv4map</span>&nbsp;<span class="op" id="8363659">&amp;&amp;</span>&nbsp;<span class="ident" id="8363662">fd</span><span class="op" id="8363664">.</span><span class="ident" id="8363665">laddr</span><span class="op" id="8363670">.</span><span class="op" id="8363671">(</span><span class="op" id="8363672">*</span><span class="ident" id="8363673">UDPAddr</span><span class="op" id="8363680">)</span><span class="op" id="8363681">.</span><span class="ident" id="8363682">isWildcard</span><span class="op" id="8363692">(</span><span class="op" id="8363693">)</span>&nbsp;<span class="op" id="8363695">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363700">if</span>&nbsp;<span class="ident" id="8363703">fd</span><span class="op" id="8363705">.</span><span class="ident" id="8363706">family</span>&nbsp;<span class="op" id="8363713">!=</span>&nbsp;<span class="ident" id="8363716">syscall</span><span class="op" id="8363723">.</span><span class="ident" id="8363724">AF_INET6</span>&nbsp;<span class="op" id="8363733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363739">t</span><span class="op" id="8363740">.</span><span class="ident" id="8363741">Fatalf</span><span class="op" id="8363747">(</span><span class="string" id="8363748">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8363809">,</span>&nbsp;<span class="ident" id="8363811">net</span><span class="op" id="8363814">,</span>&nbsp;<span class="ident" id="8363816">laddr</span><span class="op" id="8363821">,</span>&nbsp;<span class="ident" id="8363823">fd</span><span class="op" id="8363825">.</span><span class="ident" id="8363826">family</span><span class="op" id="8363832">,</span>&nbsp;<span class="ident" id="8363834">syscall</span><span class="op" id="8363841">.</span><span class="ident" id="8363842">AF_INET6</span><span class="op" id="8363850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8363859">}</span>&nbsp;<span class="keyword" id="8363861">else</span>&nbsp;<span class="op" id="8363866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8363871">if</span>&nbsp;<span class="ident" id="8363874">fd</span><span class="op" id="8363876">.</span><span class="ident" id="8363877">family</span>&nbsp;<span class="op" id="8363884">!=</span>&nbsp;<span class="ident" id="8363887">a</span><span class="op" id="8363888">.</span><span class="ident" id="8363889">family</span><span class="op" id="8363895">(</span><span class="op" id="8363896">)</span>&nbsp;<span class="op" id="8363898">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8363904">t</span><span class="op" id="8363905">.</span><span class="ident" id="8363906">Fatalf</span><span class="op" id="8363912">(</span><span class="string" id="8363913">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8363974">,</span>&nbsp;<span class="ident" id="8363976">net</span><span class="op" id="8363979">,</span>&nbsp;<span class="ident" id="8363981">laddr</span><span class="op" id="8363986">,</span>&nbsp;<span class="ident" id="8363988">fd</span><span class="op" id="8363990">.</span><span class="ident" id="8363991">family</span><span class="op" id="8363997">,</span>&nbsp;<span class="ident" id="8363999">a</span><span class="op" id="8364000">.</span><span class="ident" id="8364001">family</span><span class="op" id="8364007">(</span><span class="op" id="8364008">)</span><span class="op" id="8364009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364021">default</span><span class="op" id="8364028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364032">t</span><span class="op" id="8364033">.</span><span class="ident" id="8364034">Fatalf</span><span class="op" id="8364040">(</span><span class="string" id="8364041">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="8364079">,</span>&nbsp;<span class="ident" id="8364081">a</span><span class="op" id="8364082">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364085">}</span><br>
<span class="lineno"></span><span class="op" id="8364087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8364090">var</span>&nbsp;<span class="ident" id="8364094">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8364121">=</span>&nbsp;<span class="op" id="8364123">[</span><span class="op" id="8364124">]</span><span class="keyword" id="8364125">struct</span>&nbsp;<span class="op" id="8364132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364135">net</span>&nbsp;&nbsp;<span class="builtintype" id="8364140">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364148">addr</span>&nbsp;<span class="builtintype" id="8364153">string</span><br>
<span class="lineno"></span><span class="op" id="8364160">}</span><span class="op" id="8364161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364164">{</span><span class="string" id="8364165">&#34;tcp6&#34;</span><span class="op" id="8364171">,</span>&nbsp;<span class="string" id="8364173">&#34;127.0.0.1&#34;</span><span class="op" id="8364184">}</span><span class="op" id="8364185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364188">{</span><span class="string" id="8364189">&#34;tcp6&#34;</span><span class="op" id="8364195">,</span>&nbsp;<span class="string" id="8364197">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8364217">}</span><span class="op" id="8364218">,</span><br>
<span class="lineno"></span><span class="op" id="8364220">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="8364223">func</span>&nbsp;<span class="ident" id="8364228">TestProhibitionaryDialArgs</span><span class="op" id="8364254">(</span><span class="ident" id="8364255">t</span>&nbsp;<span class="op" id="8364257">*</span><span class="ident" id="8364258">testing</span><span class="op" id="8364265">.</span><span class="ident" id="8364266">T</span><span class="op" id="8364267">)</span>&nbsp;<span class="op" id="8364269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364272">switch</span>&nbsp;<span class="ident" id="8364279">runtime</span><span class="op" id="8364286">.</span><span class="ident" id="8364287">GOOS</span>&nbsp;<span class="op" id="8364292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364295">case</span>&nbsp;<span class="string" id="8364300">&#34;plan9&#34;</span><span class="op" id="8364307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364311">t</span><span class="op" id="8364312">.</span><span class="ident" id="8364313">Skipf</span><span class="op" id="8364318">(</span><span class="string" id="8364319">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8364340">,</span>&nbsp;<span class="ident" id="8364342">runtime</span><span class="op" id="8364349">.</span><span class="ident" id="8364350">GOOS</span><span class="op" id="8364354">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8364360">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364430">if</span>&nbsp;<span class="op" id="8364433">!</span><span class="ident" id="8364434">supportsIPv4map</span>&nbsp;<span class="op" id="8364450">||</span>&nbsp;<span class="ident" id="8364453">testing</span><span class="op" id="8364460">.</span><span class="ident" id="8364461">Short</span><span class="op" id="8364466">(</span><span class="op" id="8364467">)</span>&nbsp;<span class="op" id="8364469">||</span>&nbsp;<span class="op" id="8364472">!</span><span class="op" id="8364473">*</span><span class="ident" id="8364474">testExternal</span>&nbsp;<span class="op" id="8364487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364499">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364503">l</span><span class="op" id="8364504">,</span>&nbsp;<span class="ident" id="8364506">port</span>&nbsp;<span class="op" id="8364511">:=</span>&nbsp;<span class="ident" id="8364514">usableListenPort</span><span class="op" id="8364530">(</span><span class="ident" id="8364531">t</span><span class="op" id="8364532">,</span>&nbsp;<span class="string" id="8364534">&#34;tcp&#34;</span><span class="op" id="8364539">,</span>&nbsp;<span class="string" id="8364541">&#34;[::]&#34;</span><span class="op" id="8364547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364550">defer</span>&nbsp;<span class="ident" id="8364556">l</span><span class="op" id="8364557">.</span><span class="ident" id="8364558">Close</span><span class="op" id="8364563">(</span><span class="op" id="8364564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364568">for</span>&nbsp;<span class="ident" id="8364572">_</span><span class="op" id="8364573">,</span>&nbsp;<span class="ident" id="8364575">tt</span>&nbsp;<span class="op" id="8364578">:=</span>&nbsp;<span class="keyword" id="8364581">range</span>&nbsp;<span class="ident" id="8364587">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8364614">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364618">c</span><span class="op" id="8364619">,</span>&nbsp;<span class="ident" id="8364621">err</span>&nbsp;<span class="op" id="8364625">:=</span>&nbsp;<span class="ident" id="8364628">Dial</span><span class="op" id="8364632">(</span><span class="ident" id="8364633">tt</span><span class="op" id="8364635">.</span><span class="ident" id="8364636">net</span><span class="op" id="8364639">,</span>&nbsp;<span class="ident" id="8364641">tt</span><span class="op" id="8364643">.</span><span class="ident" id="8364644">addr</span><span class="op" id="8364648">+</span><span class="string" id="8364649">&#34;:&#34;</span><span class="op" id="8364652">+</span><span class="ident" id="8364653">port</span><span class="op" id="8364657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364661">if</span>&nbsp;<span class="ident" id="8364664">err</span>&nbsp;<span class="op" id="8364668">==</span>&nbsp;<span class="ident" id="8364671">nil</span>&nbsp;<span class="op" id="8364675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364680">c</span><span class="op" id="8364681">.</span><span class="ident" id="8364682">Close</span><span class="op" id="8364687">(</span><span class="op" id="8364688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364693">t</span><span class="op" id="8364694">.</span><span class="ident" id="8364695">Fatalf</span><span class="op" id="8364701">(</span><span class="string" id="8364702">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8364728">,</span>&nbsp;<span class="ident" id="8364730">tt</span><span class="op" id="8364732">.</span><span class="ident" id="8364733">net</span><span class="op" id="8364736">,</span>&nbsp;<span class="ident" id="8364738">tt</span><span class="op" id="8364740">.</span><span class="ident" id="8364741">addr</span><span class="op" id="8364745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364749">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364752">}</span><br>
<span class="lineno"></span><span class="op" id="8364754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8364757">func</span>&nbsp;<span class="ident" id="8364762">TestWildWildcardListener</span><span class="op" id="8364786">(</span><span class="ident" id="8364787">t</span>&nbsp;<span class="op" id="8364789">*</span><span class="ident" id="8364790">testing</span><span class="op" id="8364797">.</span><span class="ident" id="8364798">T</span><span class="op" id="8364799">)</span>&nbsp;<span class="op" id="8364801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364804">switch</span>&nbsp;<span class="ident" id="8364811">runtime</span><span class="op" id="8364818">.</span><span class="ident" id="8364819">GOOS</span>&nbsp;<span class="op" id="8364824">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364827">case</span>&nbsp;<span class="string" id="8364832">&#34;plan9&#34;</span><span class="op" id="8364839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364843">t</span><span class="op" id="8364844">.</span><span class="ident" id="8364845">Skipf</span><span class="op" id="8364850">(</span><span class="string" id="8364851">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8364872">,</span>&nbsp;<span class="ident" id="8364874">runtime</span><span class="op" id="8364881">.</span><span class="ident" id="8364882">GOOS</span><span class="op" id="8364886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364893">if</span>&nbsp;<span class="ident" id="8364896">testing</span><span class="op" id="8364903">.</span><span class="ident" id="8364904">Short</span><span class="op" id="8364909">(</span><span class="op" id="8364910">)</span>&nbsp;<span class="op" id="8364912">||</span>&nbsp;<span class="op" id="8364915">!</span><span class="op" id="8364916">*</span><span class="ident" id="8364917">testExternal</span>&nbsp;<span class="op" id="8364930">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8364934">t</span><span class="op" id="8364935">.</span><span class="ident" id="8364936">Skip</span><span class="op" id="8364940">(</span><span class="string" id="8364941">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8364982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8364985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8364989">defer</span>&nbsp;<span class="keyword" id="8364995">func</span><span class="op" id="8364999">(</span><span class="op" id="8365000">)</span>&nbsp;<span class="op" id="8365002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365006">if</span>&nbsp;<span class="ident" id="8365009">p</span>&nbsp;<span class="op" id="8365011">:=</span>&nbsp;<span class="builtinfunc" id="8365014">recover</span><span class="op" id="8365021">(</span><span class="op" id="8365022">)</span><span class="op" id="8365023">;</span>&nbsp;<span class="ident" id="8365025">p</span>&nbsp;<span class="op" id="8365027">!=</span>&nbsp;<span class="ident" id="8365030">nil</span>&nbsp;<span class="op" id="8365034">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365039">t</span><span class="op" id="8365040">.</span><span class="ident" id="8365041">Fatalf</span><span class="op" id="8365047">(</span><span class="string" id="8365048">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8365111">,</span>&nbsp;<span class="ident" id="8365113">p</span><span class="op" id="8365114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365121">}</span><span class="op" id="8365122">(</span><span class="op" id="8365123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365127">if</span>&nbsp;<span class="ident" id="8365130">ln</span><span class="op" id="8365132">,</span>&nbsp;<span class="ident" id="8365134">err</span>&nbsp;<span class="op" id="8365138">:=</span>&nbsp;<span class="ident" id="8365141">Listen</span><span class="op" id="8365147">(</span><span class="string" id="8365148">&#34;tcp&#34;</span><span class="op" id="8365153">,</span>&nbsp;<span class="string" id="8365155">&#34;&#34;</span><span class="op" id="8365157">)</span><span class="op" id="8365158">;</span>&nbsp;<span class="ident" id="8365160">err</span>&nbsp;<span class="op" id="8365164">==</span>&nbsp;<span class="ident" id="8365167">nil</span>&nbsp;<span class="op" id="8365171">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365175">ln</span><span class="op" id="8365177">.</span><span class="ident" id="8365178">Close</span><span class="op" id="8365183">(</span><span class="op" id="8365184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365190">if</span>&nbsp;<span class="ident" id="8365193">ln</span><span class="op" id="8365195">,</span>&nbsp;<span class="ident" id="8365197">err</span>&nbsp;<span class="op" id="8365201">:=</span>&nbsp;<span class="ident" id="8365204">ListenPacket</span><span class="op" id="8365216">(</span><span class="string" id="8365217">&#34;udp&#34;</span><span class="op" id="8365222">,</span>&nbsp;<span class="string" id="8365224">&#34;&#34;</span><span class="op" id="8365226">)</span><span class="op" id="8365227">;</span>&nbsp;<span class="ident" id="8365229">err</span>&nbsp;<span class="op" id="8365233">==</span>&nbsp;<span class="ident" id="8365236">nil</span>&nbsp;<span class="op" id="8365240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365244">ln</span><span class="op" id="8365246">.</span><span class="ident" id="8365247">Close</span><span class="op" id="8365252">(</span><span class="op" id="8365253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365256">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365259">if</span>&nbsp;<span class="ident" id="8365262">ln</span><span class="op" id="8365264">,</span>&nbsp;<span class="ident" id="8365266">err</span>&nbsp;<span class="op" id="8365270">:=</span>&nbsp;<span class="ident" id="8365273">ListenTCP</span><span class="op" id="8365282">(</span><span class="string" id="8365283">&#34;tcp&#34;</span><span class="op" id="8365288">,</span>&nbsp;<span class="ident" id="8365290">nil</span><span class="op" id="8365293">)</span><span class="op" id="8365294">;</span>&nbsp;<span class="ident" id="8365296">err</span>&nbsp;<span class="op" id="8365300">==</span>&nbsp;<span class="ident" id="8365303">nil</span>&nbsp;<span class="op" id="8365307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365311">ln</span><span class="op" id="8365313">.</span><span class="ident" id="8365314">Close</span><span class="op" id="8365319">(</span><span class="op" id="8365320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365326">if</span>&nbsp;<span class="ident" id="8365329">ln</span><span class="op" id="8365331">,</span>&nbsp;<span class="ident" id="8365333">err</span>&nbsp;<span class="op" id="8365337">:=</span>&nbsp;<span class="ident" id="8365340">ListenUDP</span><span class="op" id="8365349">(</span><span class="string" id="8365350">&#34;udp&#34;</span><span class="op" id="8365355">,</span>&nbsp;<span class="ident" id="8365357">nil</span><span class="op" id="8365360">)</span><span class="op" id="8365361">;</span>&nbsp;<span class="ident" id="8365363">err</span>&nbsp;<span class="op" id="8365367">==</span>&nbsp;<span class="ident" id="8365370">nil</span>&nbsp;<span class="op" id="8365374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365378">ln</span><span class="op" id="8365380">.</span><span class="ident" id="8365381">Close</span><span class="op" id="8365386">(</span><span class="op" id="8365387">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8365393">if</span>&nbsp;<span class="ident" id="8365396">ln</span><span class="op" id="8365398">,</span>&nbsp;<span class="ident" id="8365400">err</span>&nbsp;<span class="op" id="8365404">:=</span>&nbsp;<span class="ident" id="8365407">ListenIP</span><span class="op" id="8365415">(</span><span class="string" id="8365416">&#34;ip:icmp&#34;</span><span class="op" id="8365425">,</span>&nbsp;<span class="ident" id="8365427">nil</span><span class="op" id="8365430">)</span><span class="op" id="8365431">;</span>&nbsp;<span class="ident" id="8365433">err</span>&nbsp;<span class="op" id="8365437">==</span>&nbsp;<span class="ident" id="8365440">nil</span>&nbsp;<span class="op" id="8365444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8365448">ln</span><span class="op" id="8365450">.</span><span class="ident" id="8365451">Close</span><span class="op" id="8365456">(</span><span class="op" id="8365457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8365460">}</span><br>
<span class="lineno"></span><span class="op" id="8365462">}</span>
</div>
</body>
</html>
