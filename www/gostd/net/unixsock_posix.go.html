<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html" class="current">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4199233">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4199289">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4199343">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4199394">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4199472">package</span>&nbsp;<span class="ident" id="4199480">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4199485">import</span>&nbsp;<span class="op" id="4199492">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4199495">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4199505">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4199511">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4199522">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4199529">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4199532">func</span>&nbsp;<span class="ident" id="4199537">unixSocket</span><span class="op" id="4199547">(</span><span class="ident" id="4199548">net</span>&nbsp;<span class="builtintype" id="4199552">string</span><span class="op" id="4199558">,</span>&nbsp;<span class="ident" id="4199560">laddr</span><span class="op" id="4199565">,</span>&nbsp;<span class="ident" id="4199567">raddr</span>&nbsp;<span class="ident" id="4199573">sockaddr</span><span class="op" id="4199581">,</span>&nbsp;<span class="ident" id="4199583">mode</span>&nbsp;<span class="builtintype" id="4199588">string</span><span class="op" id="4199594">,</span>&nbsp;<span class="ident" id="4199596">deadline</span>&nbsp;<span class="ident" id="4199605">time</span><span class="op" id="4199609">.</span><span class="ident" id="4199610">Time</span><span class="op" id="4199614">)</span>&nbsp;<span class="op" id="4199616">(</span><span class="op" id="4199617">*</span><span class="ident" id="4199618">netFD</span><span class="op" id="4199623">,</span>&nbsp;<span class="builtintype" id="4199625">error</span><span class="op" id="4199630">)</span>&nbsp;<span class="op" id="4199632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199635">var</span>&nbsp;<span class="ident" id="4199639">sotype</span>&nbsp;<span class="builtintype" id="4199646">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199651">switch</span>&nbsp;<span class="ident" id="4199658">net</span>&nbsp;<span class="op" id="4199662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199665">case</span>&nbsp;<span class="string" id="4199670">&#34;unix&#34;</span><span class="op" id="4199676">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199680">sotype</span>&nbsp;<span class="op" id="4199687">=</span>&nbsp;<span class="ident" id="4199689">syscall</span><span class="op" id="4199696">.</span><span class="ident" id="4199697">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199710">case</span>&nbsp;<span class="string" id="4199715">&#34;unixgram&#34;</span><span class="op" id="4199725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199729">sotype</span>&nbsp;<span class="op" id="4199736">=</span>&nbsp;<span class="ident" id="4199738">syscall</span><span class="op" id="4199745">.</span><span class="ident" id="4199746">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199758">case</span>&nbsp;<span class="string" id="4199763">&#34;unixpacket&#34;</span><span class="op" id="4199775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199779">sotype</span>&nbsp;<span class="op" id="4199786">=</span>&nbsp;<span class="ident" id="4199788">syscall</span><span class="op" id="4199795">.</span><span class="ident" id="4199796">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199812">default</span><span class="op" id="4199819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199823">return</span>&nbsp;<span class="ident" id="4199830">nil</span><span class="op" id="4199833">,</span>&nbsp;<span class="ident" id="4199835">UnknownNetworkError</span><span class="op" id="4199854">(</span><span class="ident" id="4199855">net</span><span class="op" id="4199858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4199861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199865">switch</span>&nbsp;<span class="ident" id="4199872">mode</span>&nbsp;<span class="op" id="4199877">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199880">case</span>&nbsp;<span class="string" id="4199885">&#34;dial&#34;</span><span class="op" id="4199891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199895">if</span>&nbsp;<span class="ident" id="4199898">laddr</span>&nbsp;<span class="op" id="4199904">!=</span>&nbsp;<span class="ident" id="4199907">nil</span>&nbsp;<span class="op" id="4199911">&amp;&amp;</span>&nbsp;<span class="ident" id="4199914">laddr</span><span class="op" id="4199919">.</span><span class="ident" id="4199920">isWildcard</span><span class="op" id="4199930">(</span><span class="op" id="4199931">)</span>&nbsp;<span class="op" id="4199933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199938">laddr</span>&nbsp;<span class="op" id="4199944">=</span>&nbsp;<span class="ident" id="4199946">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4199952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199956">if</span>&nbsp;<span class="ident" id="4199959">raddr</span>&nbsp;<span class="op" id="4199965">!=</span>&nbsp;<span class="ident" id="4199968">nil</span>&nbsp;<span class="op" id="4199972">&amp;&amp;</span>&nbsp;<span class="ident" id="4199975">raddr</span><span class="op" id="4199980">.</span><span class="ident" id="4199981">isWildcard</span><span class="op" id="4199991">(</span><span class="op" id="4199992">)</span>&nbsp;<span class="op" id="4199994">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199999">raddr</span>&nbsp;<span class="op" id="4200005">=</span>&nbsp;<span class="ident" id="4200007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200017">if</span>&nbsp;<span class="ident" id="4200020">raddr</span>&nbsp;<span class="op" id="4200026">==</span>&nbsp;<span class="ident" id="4200029">nil</span>&nbsp;<span class="op" id="4200033">&amp;&amp;</span>&nbsp;<span class="op" id="4200036">(</span><span class="ident" id="4200037">sotype</span>&nbsp;<span class="op" id="4200044">!=</span>&nbsp;<span class="ident" id="4200047">syscall</span><span class="op" id="4200054">.</span><span class="ident" id="4200055">SOCK_DGRAM</span>&nbsp;<span class="op" id="4200066">||</span>&nbsp;<span class="ident" id="4200069">laddr</span>&nbsp;<span class="op" id="4200075">==</span>&nbsp;<span class="ident" id="4200078">nil</span><span class="op" id="4200081">)</span>&nbsp;<span class="op" id="4200083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200088">return</span>&nbsp;<span class="ident" id="4200095">nil</span><span class="op" id="4200098">,</span>&nbsp;<span class="ident" id="4200100">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200120">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200123">case</span>&nbsp;<span class="string" id="4200128">&#34;listen&#34;</span><span class="op" id="4200136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200139">default</span><span class="op" id="4200146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200150">return</span>&nbsp;<span class="ident" id="4200157">nil</span><span class="op" id="4200160">,</span>&nbsp;<span class="ident" id="4200162">errors</span><span class="op" id="4200168">.</span><span class="ident" id="4200169">New</span><span class="op" id="4200172">(</span><span class="string" id="4200173">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="4200190">+</span>&nbsp;<span class="ident" id="4200192">mode</span><span class="op" id="4200196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200203">fd</span><span class="op" id="4200205">,</span>&nbsp;<span class="ident" id="4200207">err</span>&nbsp;<span class="op" id="4200211">:=</span>&nbsp;<span class="ident" id="4200214">socket</span><span class="op" id="4200220">(</span><span class="ident" id="4200221">net</span><span class="op" id="4200224">,</span>&nbsp;<span class="ident" id="4200226">syscall</span><span class="op" id="4200233">.</span><span class="ident" id="4200234">AF_UNIX</span><span class="op" id="4200241">,</span>&nbsp;<span class="ident" id="4200243">sotype</span><span class="op" id="4200249">,</span>&nbsp;<span class="num" id="4200251">0</span><span class="op" id="4200252">,</span>&nbsp;<span class="builtintype" id="4200254">false</span><span class="op" id="4200259">,</span>&nbsp;<span class="ident" id="4200261">laddr</span><span class="op" id="4200266">,</span>&nbsp;<span class="ident" id="4200268">raddr</span><span class="op" id="4200273">,</span>&nbsp;<span class="ident" id="4200275">deadline</span><span class="op" id="4200283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200286">if</span>&nbsp;<span class="ident" id="4200289">err</span>&nbsp;<span class="op" id="4200293">!=</span>&nbsp;<span class="ident" id="4200296">nil</span>&nbsp;<span class="op" id="4200300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200304">return</span>&nbsp;<span class="ident" id="4200311">nil</span><span class="op" id="4200314">,</span>&nbsp;<span class="ident" id="4200316">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200324">return</span>&nbsp;<span class="ident" id="4200331">fd</span><span class="op" id="4200333">,</span>&nbsp;<span class="ident" id="4200335">nil</span><br>
<span class="lineno">50</span><span class="op" id="4200339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4200342">func</span>&nbsp;<span class="ident" id="4200347">sockaddrToUnix</span><span class="op" id="4200361">(</span><span class="ident" id="4200362">sa</span>&nbsp;<span class="ident" id="4200365">syscall</span><span class="op" id="4200372">.</span><span class="ident" id="4200373">Sockaddr</span><span class="op" id="4200381">)</span>&nbsp;<span class="ident" id="4200383">Addr</span>&nbsp;<span class="op" id="4200388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200391">if</span>&nbsp;<span class="ident" id="4200394">s</span><span class="op" id="4200395">,</span>&nbsp;<span class="ident" id="4200397">ok</span>&nbsp;<span class="op" id="4200400">:=</span>&nbsp;<span class="ident" id="4200403">sa</span><span class="op" id="4200405">.</span><span class="op" id="4200406">(</span><span class="op" id="4200407">*</span><span class="ident" id="4200408">syscall</span><span class="op" id="4200415">.</span><span class="ident" id="4200416">SockaddrUnix</span><span class="op" id="4200428">)</span><span class="op" id="4200429">;</span>&nbsp;<span class="ident" id="4200431">ok</span>&nbsp;<span class="op" id="4200434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200438">return</span>&nbsp;<span class="op" id="4200445">&amp;</span><span class="ident" id="4200446">UnixAddr</span><span class="op" id="4200454">{</span><span class="ident" id="4200455">Name</span><span class="op" id="4200459">:</span>&nbsp;<span class="ident" id="4200461">s</span><span class="op" id="4200462">.</span><span class="ident" id="4200463">Name</span><span class="op" id="4200467">,</span>&nbsp;<span class="ident" id="4200469">Net</span><span class="op" id="4200472">:</span>&nbsp;<span class="string" id="4200474">&#34;unix&#34;</span><span class="op" id="4200480">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200486">return</span>&nbsp;<span class="ident" id="4200493">nil</span><br>
<span class="lineno"></span><span class="op" id="4200497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4200500">func</span>&nbsp;<span class="ident" id="4200505">sockaddrToUnixgram</span><span class="op" id="4200523">(</span><span class="ident" id="4200524">sa</span>&nbsp;<span class="ident" id="4200527">syscall</span><span class="op" id="4200534">.</span><span class="ident" id="4200535">Sockaddr</span><span class="op" id="4200543">)</span>&nbsp;<span class="ident" id="4200545">Addr</span>&nbsp;<span class="op" id="4200550">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200553">if</span>&nbsp;<span class="ident" id="4200556">s</span><span class="op" id="4200557">,</span>&nbsp;<span class="ident" id="4200559">ok</span>&nbsp;<span class="op" id="4200562">:=</span>&nbsp;<span class="ident" id="4200565">sa</span><span class="op" id="4200567">.</span><span class="op" id="4200568">(</span><span class="op" id="4200569">*</span><span class="ident" id="4200570">syscall</span><span class="op" id="4200577">.</span><span class="ident" id="4200578">SockaddrUnix</span><span class="op" id="4200590">)</span><span class="op" id="4200591">;</span>&nbsp;<span class="ident" id="4200593">ok</span>&nbsp;<span class="op" id="4200596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200600">return</span>&nbsp;<span class="op" id="4200607">&amp;</span><span class="ident" id="4200608">UnixAddr</span><span class="op" id="4200616">{</span><span class="ident" id="4200617">Name</span><span class="op" id="4200621">:</span>&nbsp;<span class="ident" id="4200623">s</span><span class="op" id="4200624">.</span><span class="ident" id="4200625">Name</span><span class="op" id="4200629">,</span>&nbsp;<span class="ident" id="4200631">Net</span><span class="op" id="4200634">:</span>&nbsp;<span class="string" id="4200636">&#34;unixgram&#34;</span><span class="op" id="4200646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200652">return</span>&nbsp;<span class="ident" id="4200659">nil</span><br>
<span class="lineno"></span><span class="op" id="4200663">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4200666">func</span>&nbsp;<span class="ident" id="4200671">sockaddrToUnixpacket</span><span class="op" id="4200691">(</span><span class="ident" id="4200692">sa</span>&nbsp;<span class="ident" id="4200695">syscall</span><span class="op" id="4200702">.</span><span class="ident" id="4200703">Sockaddr</span><span class="op" id="4200711">)</span>&nbsp;<span class="ident" id="4200713">Addr</span>&nbsp;<span class="op" id="4200718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200721">if</span>&nbsp;<span class="ident" id="4200724">s</span><span class="op" id="4200725">,</span>&nbsp;<span class="ident" id="4200727">ok</span>&nbsp;<span class="op" id="4200730">:=</span>&nbsp;<span class="ident" id="4200733">sa</span><span class="op" id="4200735">.</span><span class="op" id="4200736">(</span><span class="op" id="4200737">*</span><span class="ident" id="4200738">syscall</span><span class="op" id="4200745">.</span><span class="ident" id="4200746">SockaddrUnix</span><span class="op" id="4200758">)</span><span class="op" id="4200759">;</span>&nbsp;<span class="ident" id="4200761">ok</span>&nbsp;<span class="op" id="4200764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200768">return</span>&nbsp;<span class="op" id="4200775">&amp;</span><span class="ident" id="4200776">UnixAddr</span><span class="op" id="4200784">{</span><span class="ident" id="4200785">Name</span><span class="op" id="4200789">:</span>&nbsp;<span class="ident" id="4200791">s</span><span class="op" id="4200792">.</span><span class="ident" id="4200793">Name</span><span class="op" id="4200797">,</span>&nbsp;<span class="ident" id="4200799">Net</span><span class="op" id="4200802">:</span>&nbsp;<span class="string" id="4200804">&#34;unixpacket&#34;</span><span class="op" id="4200816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200819">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200822">return</span>&nbsp;<span class="ident" id="4200829">nil</span><br>
<span class="lineno"></span><span class="op" id="4200833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4200836">func</span>&nbsp;<span class="ident" id="4200841">sotypeToNet</span><span class="op" id="4200852">(</span><span class="ident" id="4200853">sotype</span>&nbsp;<span class="builtintype" id="4200860">int</span><span class="op" id="4200863">)</span>&nbsp;<span class="builtintype" id="4200865">string</span>&nbsp;<span class="op" id="4200872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200875">switch</span>&nbsp;<span class="ident" id="4200882">sotype</span>&nbsp;<span class="op" id="4200889">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200892">case</span>&nbsp;<span class="ident" id="4200897">syscall</span><span class="op" id="4200904">.</span><span class="ident" id="4200905">SOCK_STREAM</span><span class="op" id="4200916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200920">return</span>&nbsp;<span class="string" id="4200927">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200935">case</span>&nbsp;<span class="ident" id="4200940">syscall</span><span class="op" id="4200947">.</span><span class="ident" id="4200948">SOCK_DGRAM</span><span class="op" id="4200958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200962">return</span>&nbsp;<span class="string" id="4200969">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200981">case</span>&nbsp;<span class="ident" id="4200986">syscall</span><span class="op" id="4200993">.</span><span class="ident" id="4200994">SOCK_SEQPACKET</span><span class="op" id="4201008">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201012">return</span>&nbsp;<span class="string" id="4201019">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201033">default</span><span class="op" id="4201040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4201044">panic</span><span class="op" id="4201049">(</span><span class="string" id="4201050">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="4201083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201086">}</span><br>
<span class="lineno"></span><span class="op" id="4201088">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4201091">func</span>&nbsp;<span class="op" id="4201096">(</span><span class="ident" id="4201097">a</span>&nbsp;<span class="op" id="4201099">*</span><span class="ident" id="4201100">UnixAddr</span><span class="op" id="4201108">)</span>&nbsp;<span class="ident" id="4201110">family</span><span class="op" id="4201116">(</span><span class="op" id="4201117">)</span>&nbsp;<span class="builtintype" id="4201119">int</span>&nbsp;<span class="op" id="4201123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201126">return</span>&nbsp;<span class="ident" id="4201133">syscall</span><span class="op" id="4201140">.</span><span class="ident" id="4201141">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="4201149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4201152">func</span>&nbsp;<span class="op" id="4201157">(</span><span class="ident" id="4201158">a</span>&nbsp;<span class="op" id="4201160">*</span><span class="ident" id="4201161">UnixAddr</span><span class="op" id="4201169">)</span>&nbsp;<span class="ident" id="4201171">isWildcard</span><span class="op" id="4201181">(</span><span class="op" id="4201182">)</span>&nbsp;<span class="builtintype" id="4201184">bool</span>&nbsp;<span class="op" id="4201189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201192">return</span>&nbsp;<span class="ident" id="4201199">a</span>&nbsp;<span class="op" id="4201201">==</span>&nbsp;<span class="ident" id="4201204">nil</span>&nbsp;<span class="op" id="4201208">||</span>&nbsp;<span class="ident" id="4201211">a</span><span class="op" id="4201212">.</span><span class="ident" id="4201213">Name</span>&nbsp;<span class="op" id="4201218">==</span>&nbsp;<span class="string" id="4201221">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4201224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4201227">func</span>&nbsp;<span class="op" id="4201232">(</span><span class="ident" id="4201233">a</span>&nbsp;<span class="op" id="4201235">*</span><span class="ident" id="4201236">UnixAddr</span><span class="op" id="4201244">)</span>&nbsp;<span class="ident" id="4201246">sockaddr</span><span class="op" id="4201254">(</span><span class="ident" id="4201255">family</span>&nbsp;<span class="builtintype" id="4201262">int</span><span class="op" id="4201265">)</span>&nbsp;<span class="op" id="4201267">(</span><span class="ident" id="4201268">syscall</span><span class="op" id="4201275">.</span><span class="ident" id="4201276">Sockaddr</span><span class="op" id="4201284">,</span>&nbsp;<span class="builtintype" id="4201286">error</span><span class="op" id="4201291">)</span>&nbsp;<span class="op" id="4201293">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201296">if</span>&nbsp;<span class="ident" id="4201299">a</span>&nbsp;<span class="op" id="4201301">==</span>&nbsp;<span class="ident" id="4201304">nil</span>&nbsp;<span class="op" id="4201308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201312">return</span>&nbsp;<span class="ident" id="4201319">nil</span><span class="op" id="4201322">,</span>&nbsp;<span class="ident" id="4201324">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201332">return</span>&nbsp;<span class="op" id="4201339">&amp;</span><span class="ident" id="4201340">syscall</span><span class="op" id="4201347">.</span><span class="ident" id="4201348">SockaddrUnix</span><span class="op" id="4201360">{</span><span class="ident" id="4201361">Name</span><span class="op" id="4201365">:</span>&nbsp;<span class="ident" id="4201367">a</span><span class="op" id="4201368">.</span><span class="ident" id="4201369">Name</span><span class="op" id="4201373">}</span><span class="op" id="4201374">,</span>&nbsp;<span class="ident" id="4201376">nil</span><br>
<span class="lineno"></span><span class="op" id="4201380">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4201383">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="4201454">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4201481">type</span>&nbsp;<span class="ident" id="4201486">UnixConn</span>&nbsp;<span class="keyword" id="4201495">struct</span>&nbsp;<span class="op" id="4201502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201505">conn</span><br>
<span class="lineno">105</span><span class="op" id="4201510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4201513">func</span>&nbsp;<span class="ident" id="4201518">newUnixConn</span><span class="op" id="4201529">(</span><span class="ident" id="4201530">fd</span>&nbsp;<span class="op" id="4201533">*</span><span class="ident" id="4201534">netFD</span><span class="op" id="4201539">)</span>&nbsp;<span class="op" id="4201541">*</span><span class="ident" id="4201542">UnixConn</span>&nbsp;<span class="op" id="4201551">{</span>&nbsp;<span class="keyword" id="4201553">return</span>&nbsp;<span class="op" id="4201560">&amp;</span><span class="ident" id="4201561">UnixConn</span><span class="op" id="4201569">{</span><span class="ident" id="4201570">conn</span><span class="op" id="4201574">{</span><span class="ident" id="4201575">fd</span><span class="op" id="4201577">}</span><span class="op" id="4201578">}</span>&nbsp;<span class="op" id="4201580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4201583">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="4201654">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4201725">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="4201740">//</span><br>
<span class="lineno"></span><span class="comment" id="4201743">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4201808">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4201875">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4201895">func</span>&nbsp;<span class="op" id="4201900">(</span><span class="ident" id="4201901">c</span>&nbsp;<span class="op" id="4201903">*</span><span class="ident" id="4201904">UnixConn</span><span class="op" id="4201912">)</span>&nbsp;<span class="ident" id="4201914">ReadFromUnix</span><span class="op" id="4201926">(</span><span class="ident" id="4201927">b</span>&nbsp;<span class="op" id="4201929">[</span><span class="op" id="4201930">]</span><span class="builtintype" id="4201931">byte</span><span class="op" id="4201935">)</span>&nbsp;<span class="op" id="4201937">(</span><span class="ident" id="4201938">n</span>&nbsp;<span class="builtintype" id="4201940">int</span><span class="op" id="4201943">,</span>&nbsp;<span class="ident" id="4201945">addr</span>&nbsp;<span class="op" id="4201950">*</span><span class="ident" id="4201951">UnixAddr</span><span class="op" id="4201959">,</span>&nbsp;<span class="ident" id="4201961">err</span>&nbsp;<span class="builtintype" id="4201965">error</span><span class="op" id="4201970">)</span>&nbsp;<span class="op" id="4201972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201975">if</span>&nbsp;<span class="op" id="4201978">!</span><span class="ident" id="4201979">c</span><span class="op" id="4201980">.</span><span class="ident" id="4201981">ok</span><span class="op" id="4201983">(</span><span class="op" id="4201984">)</span>&nbsp;<span class="op" id="4201986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201990">return</span>&nbsp;<span class="num" id="4201997">0</span><span class="op" id="4201998">,</span>&nbsp;<span class="ident" id="4202000">nil</span><span class="op" id="4202003">,</span>&nbsp;<span class="ident" id="4202005">syscall</span><span class="op" id="4202012">.</span><span class="ident" id="4202013">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202021">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202024">n</span><span class="op" id="4202025">,</span>&nbsp;<span class="ident" id="4202027">sa</span><span class="op" id="4202029">,</span>&nbsp;<span class="ident" id="4202031">err</span>&nbsp;<span class="op" id="4202035">:=</span>&nbsp;<span class="ident" id="4202038">c</span><span class="op" id="4202039">.</span><span class="ident" id="4202040">fd</span><span class="op" id="4202042">.</span><span class="ident" id="4202043">readFrom</span><span class="op" id="4202051">(</span><span class="ident" id="4202052">b</span><span class="op" id="4202053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202056">switch</span>&nbsp;<span class="ident" id="4202063">sa</span>&nbsp;<span class="op" id="4202066">:=</span>&nbsp;<span class="ident" id="4202069">sa</span><span class="op" id="4202071">.</span><span class="op" id="4202072">(</span><span class="keyword" id="4202073">type</span><span class="op" id="4202077">)</span>&nbsp;<span class="op" id="4202079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202082">case</span>&nbsp;<span class="op" id="4202087">*</span><span class="ident" id="4202088">syscall</span><span class="op" id="4202095">.</span><span class="ident" id="4202096">SockaddrUnix</span><span class="op" id="4202108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202112">if</span>&nbsp;<span class="ident" id="4202115">sa</span><span class="op" id="4202117">.</span><span class="ident" id="4202118">Name</span>&nbsp;<span class="op" id="4202123">!=</span>&nbsp;<span class="string" id="4202126">&#34;&#34;</span>&nbsp;<span class="op" id="4202129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202134">addr</span>&nbsp;<span class="op" id="4202139">=</span>&nbsp;<span class="op" id="4202141">&amp;</span><span class="ident" id="4202142">UnixAddr</span><span class="op" id="4202150">{</span><span class="ident" id="4202151">Name</span><span class="op" id="4202155">:</span>&nbsp;<span class="ident" id="4202157">sa</span><span class="op" id="4202159">.</span><span class="ident" id="4202160">Name</span><span class="op" id="4202164">,</span>&nbsp;<span class="ident" id="4202166">Net</span><span class="op" id="4202169">:</span>&nbsp;<span class="ident" id="4202171">sotypeToNet</span><span class="op" id="4202182">(</span><span class="ident" id="4202183">c</span><span class="op" id="4202184">.</span><span class="ident" id="4202185">fd</span><span class="op" id="4202187">.</span><span class="ident" id="4202188">sotype</span><span class="op" id="4202194">)</span><span class="op" id="4202195">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202205">return</span><br>
<span class="lineno"></span><span class="op" id="4202212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4202215">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4202270">func</span>&nbsp;<span class="op" id="4202275">(</span><span class="ident" id="4202276">c</span>&nbsp;<span class="op" id="4202278">*</span><span class="ident" id="4202279">UnixConn</span><span class="op" id="4202287">)</span>&nbsp;<span class="ident" id="4202289">ReadFrom</span><span class="op" id="4202297">(</span><span class="ident" id="4202298">b</span>&nbsp;<span class="op" id="4202300">[</span><span class="op" id="4202301">]</span><span class="builtintype" id="4202302">byte</span><span class="op" id="4202306">)</span>&nbsp;<span class="op" id="4202308">(</span><span class="builtintype" id="4202309">int</span><span class="op" id="4202312">,</span>&nbsp;<span class="ident" id="4202314">Addr</span><span class="op" id="4202318">,</span>&nbsp;<span class="builtintype" id="4202320">error</span><span class="op" id="4202325">)</span>&nbsp;<span class="op" id="4202327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202330">if</span>&nbsp;<span class="op" id="4202333">!</span><span class="ident" id="4202334">c</span><span class="op" id="4202335">.</span><span class="ident" id="4202336">ok</span><span class="op" id="4202338">(</span><span class="op" id="4202339">)</span>&nbsp;<span class="op" id="4202341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202345">return</span>&nbsp;<span class="num" id="4202352">0</span><span class="op" id="4202353">,</span>&nbsp;<span class="ident" id="4202355">nil</span><span class="op" id="4202358">,</span>&nbsp;<span class="ident" id="4202360">syscall</span><span class="op" id="4202367">.</span><span class="ident" id="4202368">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202376">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202379">n</span><span class="op" id="4202380">,</span>&nbsp;<span class="ident" id="4202382">addr</span><span class="op" id="4202386">,</span>&nbsp;<span class="ident" id="4202388">err</span>&nbsp;<span class="op" id="4202392">:=</span>&nbsp;<span class="ident" id="4202395">c</span><span class="op" id="4202396">.</span><span class="ident" id="4202397">ReadFromUnix</span><span class="op" id="4202409">(</span><span class="ident" id="4202410">b</span><span class="op" id="4202411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202414">return</span>&nbsp;<span class="ident" id="4202421">n</span><span class="op" id="4202422">,</span>&nbsp;<span class="ident" id="4202424">addr</span><span class="op" id="4202428">.</span><span class="ident" id="4202429">toAddr</span><span class="op" id="4202435">(</span><span class="op" id="4202436">)</span><span class="op" id="4202437">,</span>&nbsp;<span class="ident" id="4202439">err</span><br>
<span class="lineno"></span><span class="op" id="4202443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4202446">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="4202515">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4202586">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="4202657">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="4202727">func</span>&nbsp;<span class="op" id="4202732">(</span><span class="ident" id="4202733">c</span>&nbsp;<span class="op" id="4202735">*</span><span class="ident" id="4202736">UnixConn</span><span class="op" id="4202744">)</span>&nbsp;<span class="ident" id="4202746">ReadMsgUnix</span><span class="op" id="4202757">(</span><span class="ident" id="4202758">b</span><span class="op" id="4202759">,</span>&nbsp;<span class="ident" id="4202761">oob</span>&nbsp;<span class="op" id="4202765">[</span><span class="op" id="4202766">]</span><span class="builtintype" id="4202767">byte</span><span class="op" id="4202771">)</span>&nbsp;<span class="op" id="4202773">(</span><span class="ident" id="4202774">n</span><span class="op" id="4202775">,</span>&nbsp;<span class="ident" id="4202777">oobn</span><span class="op" id="4202781">,</span>&nbsp;<span class="ident" id="4202783">flags</span>&nbsp;<span class="builtintype" id="4202789">int</span><span class="op" id="4202792">,</span>&nbsp;<span class="ident" id="4202794">addr</span>&nbsp;<span class="op" id="4202799">*</span><span class="ident" id="4202800">UnixAddr</span><span class="op" id="4202808">,</span>&nbsp;<span class="ident" id="4202810">err</span>&nbsp;<span class="builtintype" id="4202814">error</span><span class="op" id="4202819">)</span>&nbsp;<span class="op" id="4202821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202824">if</span>&nbsp;<span class="op" id="4202827">!</span><span class="ident" id="4202828">c</span><span class="op" id="4202829">.</span><span class="ident" id="4202830">ok</span><span class="op" id="4202832">(</span><span class="op" id="4202833">)</span>&nbsp;<span class="op" id="4202835">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202839">return</span>&nbsp;<span class="num" id="4202846">0</span><span class="op" id="4202847">,</span>&nbsp;<span class="num" id="4202849">0</span><span class="op" id="4202850">,</span>&nbsp;<span class="num" id="4202852">0</span><span class="op" id="4202853">,</span>&nbsp;<span class="ident" id="4202855">nil</span><span class="op" id="4202858">,</span>&nbsp;<span class="ident" id="4202860">syscall</span><span class="op" id="4202867">.</span><span class="ident" id="4202868">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202879">n</span><span class="op" id="4202880">,</span>&nbsp;<span class="ident" id="4202882">oobn</span><span class="op" id="4202886">,</span>&nbsp;<span class="ident" id="4202888">flags</span><span class="op" id="4202893">,</span>&nbsp;<span class="ident" id="4202895">sa</span><span class="op" id="4202897">,</span>&nbsp;<span class="ident" id="4202899">err</span>&nbsp;<span class="op" id="4202903">:=</span>&nbsp;<span class="ident" id="4202906">c</span><span class="op" id="4202907">.</span><span class="ident" id="4202908">fd</span><span class="op" id="4202910">.</span><span class="ident" id="4202911">readMsg</span><span class="op" id="4202918">(</span><span class="ident" id="4202919">b</span><span class="op" id="4202920">,</span>&nbsp;<span class="ident" id="4202922">oob</span><span class="op" id="4202925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202928">switch</span>&nbsp;<span class="ident" id="4202935">sa</span>&nbsp;<span class="op" id="4202938">:=</span>&nbsp;<span class="ident" id="4202941">sa</span><span class="op" id="4202943">.</span><span class="op" id="4202944">(</span><span class="keyword" id="4202945">type</span><span class="op" id="4202949">)</span>&nbsp;<span class="op" id="4202951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202954">case</span>&nbsp;<span class="op" id="4202959">*</span><span class="ident" id="4202960">syscall</span><span class="op" id="4202967">.</span><span class="ident" id="4202968">SockaddrUnix</span><span class="op" id="4202980">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202984">if</span>&nbsp;<span class="ident" id="4202987">sa</span><span class="op" id="4202989">.</span><span class="ident" id="4202990">Name</span>&nbsp;<span class="op" id="4202995">!=</span>&nbsp;<span class="string" id="4202998">&#34;&#34;</span>&nbsp;<span class="op" id="4203001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203006">addr</span>&nbsp;<span class="op" id="4203011">=</span>&nbsp;<span class="op" id="4203013">&amp;</span><span class="ident" id="4203014">UnixAddr</span><span class="op" id="4203022">{</span><span class="ident" id="4203023">Name</span><span class="op" id="4203027">:</span>&nbsp;<span class="ident" id="4203029">sa</span><span class="op" id="4203031">.</span><span class="ident" id="4203032">Name</span><span class="op" id="4203036">,</span>&nbsp;<span class="ident" id="4203038">Net</span><span class="op" id="4203041">:</span>&nbsp;<span class="ident" id="4203043">sotypeToNet</span><span class="op" id="4203054">(</span><span class="ident" id="4203055">c</span><span class="op" id="4203056">.</span><span class="ident" id="4203057">fd</span><span class="op" id="4203059">.</span><span class="ident" id="4203060">sotype</span><span class="op" id="4203066">)</span><span class="op" id="4203067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203077">return</span><br>
<span class="lineno">155</span><span class="op" id="4203084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4203087">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4203161">//</span><br>
<span class="lineno"></span><span class="comment" id="4203164">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="4203228">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4203295">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="4203364">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="4203377">func</span>&nbsp;<span class="op" id="4203382">(</span><span class="ident" id="4203383">c</span>&nbsp;<span class="op" id="4203385">*</span><span class="ident" id="4203386">UnixConn</span><span class="op" id="4203394">)</span>&nbsp;<span class="ident" id="4203396">WriteToUnix</span><span class="op" id="4203407">(</span><span class="ident" id="4203408">b</span>&nbsp;<span class="op" id="4203410">[</span><span class="op" id="4203411">]</span><span class="builtintype" id="4203412">byte</span><span class="op" id="4203416">,</span>&nbsp;<span class="ident" id="4203418">addr</span>&nbsp;<span class="op" id="4203423">*</span><span class="ident" id="4203424">UnixAddr</span><span class="op" id="4203432">)</span>&nbsp;<span class="op" id="4203434">(</span><span class="ident" id="4203435">n</span>&nbsp;<span class="builtintype" id="4203437">int</span><span class="op" id="4203440">,</span>&nbsp;<span class="ident" id="4203442">err</span>&nbsp;<span class="builtintype" id="4203446">error</span><span class="op" id="4203451">)</span>&nbsp;<span class="op" id="4203453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203456">if</span>&nbsp;<span class="op" id="4203459">!</span><span class="ident" id="4203460">c</span><span class="op" id="4203461">.</span><span class="ident" id="4203462">ok</span><span class="op" id="4203464">(</span><span class="op" id="4203465">)</span>&nbsp;<span class="op" id="4203467">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203471">return</span>&nbsp;<span class="num" id="4203478">0</span><span class="op" id="4203479">,</span>&nbsp;<span class="ident" id="4203481">syscall</span><span class="op" id="4203488">.</span><span class="ident" id="4203489">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203500">if</span>&nbsp;<span class="ident" id="4203503">c</span><span class="op" id="4203504">.</span><span class="ident" id="4203505">fd</span><span class="op" id="4203507">.</span><span class="ident" id="4203508">isConnected</span>&nbsp;<span class="op" id="4203520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203524">return</span>&nbsp;<span class="num" id="4203531">0</span><span class="op" id="4203532">,</span>&nbsp;<span class="op" id="4203534">&amp;</span><span class="ident" id="4203535">OpError</span><span class="op" id="4203542">{</span><span class="ident" id="4203543">Op</span><span class="op" id="4203545">:</span>&nbsp;<span class="string" id="4203547">&#34;write&#34;</span><span class="op" id="4203554">,</span>&nbsp;<span class="ident" id="4203556">Net</span><span class="op" id="4203559">:</span>&nbsp;<span class="ident" id="4203561">c</span><span class="op" id="4203562">.</span><span class="ident" id="4203563">fd</span><span class="op" id="4203565">.</span><span class="ident" id="4203566">net</span><span class="op" id="4203569">,</span>&nbsp;<span class="ident" id="4203571">Addr</span><span class="op" id="4203575">:</span>&nbsp;<span class="ident" id="4203577">addr</span><span class="op" id="4203581">,</span>&nbsp;<span class="ident" id="4203583">Err</span><span class="op" id="4203586">:</span>&nbsp;<span class="ident" id="4203588">ErrWriteToConnected</span><span class="op" id="4203607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203610">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203613">if</span>&nbsp;<span class="ident" id="4203616">addr</span>&nbsp;<span class="op" id="4203621">==</span>&nbsp;<span class="ident" id="4203624">nil</span>&nbsp;<span class="op" id="4203628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203632">return</span>&nbsp;<span class="num" id="4203639">0</span><span class="op" id="4203640">,</span>&nbsp;<span class="op" id="4203642">&amp;</span><span class="ident" id="4203643">OpError</span><span class="op" id="4203650">{</span><span class="ident" id="4203651">Op</span><span class="op" id="4203653">:</span>&nbsp;<span class="string" id="4203655">&#34;write&#34;</span><span class="op" id="4203662">,</span>&nbsp;<span class="ident" id="4203664">Net</span><span class="op" id="4203667">:</span>&nbsp;<span class="ident" id="4203669">c</span><span class="op" id="4203670">.</span><span class="ident" id="4203671">fd</span><span class="op" id="4203673">.</span><span class="ident" id="4203674">net</span><span class="op" id="4203677">,</span>&nbsp;<span class="ident" id="4203679">Addr</span><span class="op" id="4203683">:</span>&nbsp;<span class="ident" id="4203685">nil</span><span class="op" id="4203688">,</span>&nbsp;<span class="ident" id="4203690">Err</span><span class="op" id="4203693">:</span>&nbsp;<span class="ident" id="4203695">errMissingAddress</span><span class="op" id="4203712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203718">if</span>&nbsp;<span class="ident" id="4203721">addr</span><span class="op" id="4203725">.</span><span class="ident" id="4203726">Net</span>&nbsp;<span class="op" id="4203730">!=</span>&nbsp;<span class="ident" id="4203733">sotypeToNet</span><span class="op" id="4203744">(</span><span class="ident" id="4203745">c</span><span class="op" id="4203746">.</span><span class="ident" id="4203747">fd</span><span class="op" id="4203749">.</span><span class="ident" id="4203750">sotype</span><span class="op" id="4203756">)</span>&nbsp;<span class="op" id="4203758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203762">return</span>&nbsp;<span class="num" id="4203769">0</span><span class="op" id="4203770">,</span>&nbsp;<span class="ident" id="4203772">syscall</span><span class="op" id="4203779">.</span><span class="ident" id="4203780">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203797">sa</span>&nbsp;<span class="op" id="4203800">:=</span>&nbsp;<span class="op" id="4203803">&amp;</span><span class="ident" id="4203804">syscall</span><span class="op" id="4203811">.</span><span class="ident" id="4203812">SockaddrUnix</span><span class="op" id="4203824">{</span><span class="ident" id="4203825">Name</span><span class="op" id="4203829">:</span>&nbsp;<span class="ident" id="4203831">addr</span><span class="op" id="4203835">.</span><span class="ident" id="4203836">Name</span><span class="op" id="4203840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203843">return</span>&nbsp;<span class="ident" id="4203850">c</span><span class="op" id="4203851">.</span><span class="ident" id="4203852">fd</span><span class="op" id="4203854">.</span><span class="ident" id="4203855">writeTo</span><span class="op" id="4203862">(</span><span class="ident" id="4203863">b</span><span class="op" id="4203864">,</span>&nbsp;<span class="ident" id="4203866">sa</span><span class="op" id="4203868">)</span><br>
<span class="lineno"></span><span class="op" id="4203870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4203873">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4203926">func</span>&nbsp;<span class="op" id="4203931">(</span><span class="ident" id="4203932">c</span>&nbsp;<span class="op" id="4203934">*</span><span class="ident" id="4203935">UnixConn</span><span class="op" id="4203943">)</span>&nbsp;<span class="ident" id="4203945">WriteTo</span><span class="op" id="4203952">(</span><span class="ident" id="4203953">b</span>&nbsp;<span class="op" id="4203955">[</span><span class="op" id="4203956">]</span><span class="builtintype" id="4203957">byte</span><span class="op" id="4203961">,</span>&nbsp;<span class="ident" id="4203963">addr</span>&nbsp;<span class="ident" id="4203968">Addr</span><span class="op" id="4203972">)</span>&nbsp;<span class="op" id="4203974">(</span><span class="ident" id="4203975">n</span>&nbsp;<span class="builtintype" id="4203977">int</span><span class="op" id="4203980">,</span>&nbsp;<span class="ident" id="4203982">err</span>&nbsp;<span class="builtintype" id="4203986">error</span><span class="op" id="4203991">)</span>&nbsp;<span class="op" id="4203993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203996">if</span>&nbsp;<span class="op" id="4203999">!</span><span class="ident" id="4204000">c</span><span class="op" id="4204001">.</span><span class="ident" id="4204002">ok</span><span class="op" id="4204004">(</span><span class="op" id="4204005">)</span>&nbsp;<span class="op" id="4204007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204011">return</span>&nbsp;<span class="num" id="4204018">0</span><span class="op" id="4204019">,</span>&nbsp;<span class="ident" id="4204021">syscall</span><span class="op" id="4204028">.</span><span class="ident" id="4204029">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204037">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204040">a</span><span class="op" id="4204041">,</span>&nbsp;<span class="ident" id="4204043">ok</span>&nbsp;<span class="op" id="4204046">:=</span>&nbsp;<span class="ident" id="4204049">addr</span><span class="op" id="4204053">.</span><span class="op" id="4204054">(</span><span class="op" id="4204055">*</span><span class="ident" id="4204056">UnixAddr</span><span class="op" id="4204064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204067">if</span>&nbsp;<span class="op" id="4204070">!</span><span class="ident" id="4204071">ok</span>&nbsp;<span class="op" id="4204074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204078">return</span>&nbsp;<span class="num" id="4204085">0</span><span class="op" id="4204086">,</span>&nbsp;<span class="op" id="4204088">&amp;</span><span class="ident" id="4204089">OpError</span><span class="op" id="4204096">{</span><span class="string" id="4204097">&#34;write&#34;</span><span class="op" id="4204104">,</span>&nbsp;<span class="ident" id="4204106">c</span><span class="op" id="4204107">.</span><span class="ident" id="4204108">fd</span><span class="op" id="4204110">.</span><span class="ident" id="4204111">net</span><span class="op" id="4204114">,</span>&nbsp;<span class="ident" id="4204116">addr</span><span class="op" id="4204120">,</span>&nbsp;<span class="ident" id="4204122">syscall</span><span class="op" id="4204129">.</span><span class="ident" id="4204130">EINVAL</span><span class="op" id="4204136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204142">return</span>&nbsp;<span class="ident" id="4204149">c</span><span class="op" id="4204150">.</span><span class="ident" id="4204151">WriteToUnix</span><span class="op" id="4204162">(</span><span class="ident" id="4204163">b</span><span class="op" id="4204164">,</span>&nbsp;<span class="ident" id="4204166">a</span><span class="op" id="4204167">)</span><br>
<span class="lineno">190</span><span class="op" id="4204169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4204172">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="4204239">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4204307">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="4204363">func</span>&nbsp;<span class="op" id="4204368">(</span><span class="ident" id="4204369">c</span>&nbsp;<span class="op" id="4204371">*</span><span class="ident" id="4204372">UnixConn</span><span class="op" id="4204380">)</span>&nbsp;<span class="ident" id="4204382">WriteMsgUnix</span><span class="op" id="4204394">(</span><span class="ident" id="4204395">b</span><span class="op" id="4204396">,</span>&nbsp;<span class="ident" id="4204398">oob</span>&nbsp;<span class="op" id="4204402">[</span><span class="op" id="4204403">]</span><span class="builtintype" id="4204404">byte</span><span class="op" id="4204408">,</span>&nbsp;<span class="ident" id="4204410">addr</span>&nbsp;<span class="op" id="4204415">*</span><span class="ident" id="4204416">UnixAddr</span><span class="op" id="4204424">)</span>&nbsp;<span class="op" id="4204426">(</span><span class="ident" id="4204427">n</span><span class="op" id="4204428">,</span>&nbsp;<span class="ident" id="4204430">oobn</span>&nbsp;<span class="builtintype" id="4204435">int</span><span class="op" id="4204438">,</span>&nbsp;<span class="ident" id="4204440">err</span>&nbsp;<span class="builtintype" id="4204444">error</span><span class="op" id="4204449">)</span>&nbsp;<span class="op" id="4204451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204454">if</span>&nbsp;<span class="op" id="4204457">!</span><span class="ident" id="4204458">c</span><span class="op" id="4204459">.</span><span class="ident" id="4204460">ok</span><span class="op" id="4204462">(</span><span class="op" id="4204463">)</span>&nbsp;<span class="op" id="4204465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204469">return</span>&nbsp;<span class="num" id="4204476">0</span><span class="op" id="4204477">,</span>&nbsp;<span class="num" id="4204479">0</span><span class="op" id="4204480">,</span>&nbsp;<span class="ident" id="4204482">syscall</span><span class="op" id="4204489">.</span><span class="ident" id="4204490">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204501">if</span>&nbsp;<span class="ident" id="4204504">c</span><span class="op" id="4204505">.</span><span class="ident" id="4204506">fd</span><span class="op" id="4204508">.</span><span class="ident" id="4204509">sotype</span>&nbsp;<span class="op" id="4204516">==</span>&nbsp;<span class="ident" id="4204519">syscall</span><span class="op" id="4204526">.</span><span class="ident" id="4204527">SOCK_DGRAM</span>&nbsp;<span class="op" id="4204538">&amp;&amp;</span>&nbsp;<span class="ident" id="4204541">c</span><span class="op" id="4204542">.</span><span class="ident" id="4204543">fd</span><span class="op" id="4204545">.</span><span class="ident" id="4204546">isConnected</span>&nbsp;<span class="op" id="4204558">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204562">return</span>&nbsp;<span class="num" id="4204569">0</span><span class="op" id="4204570">,</span>&nbsp;<span class="num" id="4204572">0</span><span class="op" id="4204573">,</span>&nbsp;<span class="op" id="4204575">&amp;</span><span class="ident" id="4204576">OpError</span><span class="op" id="4204583">{</span><span class="ident" id="4204584">Op</span><span class="op" id="4204586">:</span>&nbsp;<span class="string" id="4204588">&#34;write&#34;</span><span class="op" id="4204595">,</span>&nbsp;<span class="ident" id="4204597">Net</span><span class="op" id="4204600">:</span>&nbsp;<span class="ident" id="4204602">c</span><span class="op" id="4204603">.</span><span class="ident" id="4204604">fd</span><span class="op" id="4204606">.</span><span class="ident" id="4204607">net</span><span class="op" id="4204610">,</span>&nbsp;<span class="ident" id="4204612">Addr</span><span class="op" id="4204616">:</span>&nbsp;<span class="ident" id="4204618">addr</span><span class="op" id="4204622">,</span>&nbsp;<span class="ident" id="4204624">Err</span><span class="op" id="4204627">:</span>&nbsp;<span class="ident" id="4204629">ErrWriteToConnected</span><span class="op" id="4204648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204654">if</span>&nbsp;<span class="ident" id="4204657">addr</span>&nbsp;<span class="op" id="4204662">!=</span>&nbsp;<span class="ident" id="4204665">nil</span>&nbsp;<span class="op" id="4204669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204673">if</span>&nbsp;<span class="ident" id="4204676">addr</span><span class="op" id="4204680">.</span><span class="ident" id="4204681">Net</span>&nbsp;<span class="op" id="4204685">!=</span>&nbsp;<span class="ident" id="4204688">sotypeToNet</span><span class="op" id="4204699">(</span><span class="ident" id="4204700">c</span><span class="op" id="4204701">.</span><span class="ident" id="4204702">fd</span><span class="op" id="4204704">.</span><span class="ident" id="4204705">sotype</span><span class="op" id="4204711">)</span>&nbsp;<span class="op" id="4204713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204718">return</span>&nbsp;<span class="num" id="4204725">0</span><span class="op" id="4204726">,</span>&nbsp;<span class="num" id="4204728">0</span><span class="op" id="4204729">,</span>&nbsp;<span class="ident" id="4204731">syscall</span><span class="op" id="4204738">.</span><span class="ident" id="4204739">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204758">sa</span>&nbsp;<span class="op" id="4204761">:=</span>&nbsp;<span class="op" id="4204764">&amp;</span><span class="ident" id="4204765">syscall</span><span class="op" id="4204772">.</span><span class="ident" id="4204773">SockaddrUnix</span><span class="op" id="4204785">{</span><span class="ident" id="4204786">Name</span><span class="op" id="4204790">:</span>&nbsp;<span class="ident" id="4204792">addr</span><span class="op" id="4204796">.</span><span class="ident" id="4204797">Name</span><span class="op" id="4204801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204805">return</span>&nbsp;<span class="ident" id="4204812">c</span><span class="op" id="4204813">.</span><span class="ident" id="4204814">fd</span><span class="op" id="4204816">.</span><span class="ident" id="4204817">writeMsg</span><span class="op" id="4204825">(</span><span class="ident" id="4204826">b</span><span class="op" id="4204827">,</span>&nbsp;<span class="ident" id="4204829">oob</span><span class="op" id="4204832">,</span>&nbsp;<span class="ident" id="4204834">sa</span><span class="op" id="4204836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204842">return</span>&nbsp;<span class="ident" id="4204849">c</span><span class="op" id="4204850">.</span><span class="ident" id="4204851">fd</span><span class="op" id="4204853">.</span><span class="ident" id="4204854">writeMsg</span><span class="op" id="4204862">(</span><span class="ident" id="4204863">b</span><span class="op" id="4204864">,</span>&nbsp;<span class="ident" id="4204866">oob</span><span class="op" id="4204869">,</span>&nbsp;<span class="ident" id="4204871">nil</span><span class="op" id="4204874">)</span><br>
<span class="lineno">210</span><span class="op" id="4204876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4204879">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4204951">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4204990">func</span>&nbsp;<span class="op" id="4204995">(</span><span class="ident" id="4204996">c</span>&nbsp;<span class="op" id="4204998">*</span><span class="ident" id="4204999">UnixConn</span><span class="op" id="4205007">)</span>&nbsp;<span class="ident" id="4205009">CloseRead</span><span class="op" id="4205018">(</span><span class="op" id="4205019">)</span>&nbsp;<span class="builtintype" id="4205021">error</span>&nbsp;<span class="op" id="4205027">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205030">if</span>&nbsp;<span class="op" id="4205033">!</span><span class="ident" id="4205034">c</span><span class="op" id="4205035">.</span><span class="ident" id="4205036">ok</span><span class="op" id="4205038">(</span><span class="op" id="4205039">)</span>&nbsp;<span class="op" id="4205041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205045">return</span>&nbsp;<span class="ident" id="4205052">syscall</span><span class="op" id="4205059">.</span><span class="ident" id="4205060">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205071">return</span>&nbsp;<span class="ident" id="4205078">c</span><span class="op" id="4205079">.</span><span class="ident" id="4205080">fd</span><span class="op" id="4205082">.</span><span class="ident" id="4205083">closeRead</span><span class="op" id="4205092">(</span><span class="op" id="4205093">)</span><br>
<span class="lineno"></span><span class="op" id="4205095">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4205098">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4205171">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4205210">func</span>&nbsp;<span class="op" id="4205215">(</span><span class="ident" id="4205216">c</span>&nbsp;<span class="op" id="4205218">*</span><span class="ident" id="4205219">UnixConn</span><span class="op" id="4205227">)</span>&nbsp;<span class="ident" id="4205229">CloseWrite</span><span class="op" id="4205239">(</span><span class="op" id="4205240">)</span>&nbsp;<span class="builtintype" id="4205242">error</span>&nbsp;<span class="op" id="4205248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205251">if</span>&nbsp;<span class="op" id="4205254">!</span><span class="ident" id="4205255">c</span><span class="op" id="4205256">.</span><span class="ident" id="4205257">ok</span><span class="op" id="4205259">(</span><span class="op" id="4205260">)</span>&nbsp;<span class="op" id="4205262">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205266">return</span>&nbsp;<span class="ident" id="4205273">syscall</span><span class="op" id="4205280">.</span><span class="ident" id="4205281">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205292">return</span>&nbsp;<span class="ident" id="4205299">c</span><span class="op" id="4205300">.</span><span class="ident" id="4205301">fd</span><span class="op" id="4205303">.</span><span class="ident" id="4205304">closeWrite</span><span class="op" id="4205314">(</span><span class="op" id="4205315">)</span><br>
<span class="lineno"></span><span class="op" id="4205317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="4205320">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4205389">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4205459">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4205519">func</span>&nbsp;<span class="ident" id="4205524">DialUnix</span><span class="op" id="4205532">(</span><span class="ident" id="4205533">net</span>&nbsp;<span class="builtintype" id="4205537">string</span><span class="op" id="4205543">,</span>&nbsp;<span class="ident" id="4205545">laddr</span><span class="op" id="4205550">,</span>&nbsp;<span class="ident" id="4205552">raddr</span>&nbsp;<span class="op" id="4205558">*</span><span class="ident" id="4205559">UnixAddr</span><span class="op" id="4205567">)</span>&nbsp;<span class="op" id="4205569">(</span><span class="op" id="4205570">*</span><span class="ident" id="4205571">UnixConn</span><span class="op" id="4205579">,</span>&nbsp;<span class="builtintype" id="4205581">error</span><span class="op" id="4205586">)</span>&nbsp;<span class="op" id="4205588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205591">switch</span>&nbsp;<span class="ident" id="4205598">net</span>&nbsp;<span class="op" id="4205602">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205605">case</span>&nbsp;<span class="string" id="4205610">&#34;unix&#34;</span><span class="op" id="4205616">,</span>&nbsp;<span class="string" id="4205618">&#34;unixgram&#34;</span><span class="op" id="4205628">,</span>&nbsp;<span class="string" id="4205630">&#34;unixpacket&#34;</span><span class="op" id="4205642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205645">default</span><span class="op" id="4205652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205656">return</span>&nbsp;<span class="ident" id="4205663">nil</span><span class="op" id="4205666">,</span>&nbsp;<span class="op" id="4205668">&amp;</span><span class="ident" id="4205669">OpError</span><span class="op" id="4205676">{</span><span class="ident" id="4205677">Op</span><span class="op" id="4205679">:</span>&nbsp;<span class="string" id="4205681">&#34;dial&#34;</span><span class="op" id="4205687">,</span>&nbsp;<span class="ident" id="4205689">Net</span><span class="op" id="4205692">:</span>&nbsp;<span class="ident" id="4205694">net</span><span class="op" id="4205697">,</span>&nbsp;<span class="ident" id="4205699">Addr</span><span class="op" id="4205703">:</span>&nbsp;<span class="ident" id="4205705">raddr</span><span class="op" id="4205710">,</span>&nbsp;<span class="ident" id="4205712">Err</span><span class="op" id="4205715">:</span>&nbsp;<span class="ident" id="4205717">UnknownNetworkError</span><span class="op" id="4205736">(</span><span class="ident" id="4205737">net</span><span class="op" id="4205740">)</span><span class="op" id="4205741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205747">return</span>&nbsp;<span class="ident" id="4205754">dialUnix</span><span class="op" id="4205762">(</span><span class="ident" id="4205763">net</span><span class="op" id="4205766">,</span>&nbsp;<span class="ident" id="4205768">laddr</span><span class="op" id="4205773">,</span>&nbsp;<span class="ident" id="4205775">raddr</span><span class="op" id="4205780">,</span>&nbsp;<span class="ident" id="4205782">noDeadline</span><span class="op" id="4205792">)</span><br>
<span class="lineno">240</span><span class="op" id="4205794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4205797">func</span>&nbsp;<span class="ident" id="4205802">dialUnix</span><span class="op" id="4205810">(</span><span class="ident" id="4205811">net</span>&nbsp;<span class="builtintype" id="4205815">string</span><span class="op" id="4205821">,</span>&nbsp;<span class="ident" id="4205823">laddr</span><span class="op" id="4205828">,</span>&nbsp;<span class="ident" id="4205830">raddr</span>&nbsp;<span class="op" id="4205836">*</span><span class="ident" id="4205837">UnixAddr</span><span class="op" id="4205845">,</span>&nbsp;<span class="ident" id="4205847">deadline</span>&nbsp;<span class="ident" id="4205856">time</span><span class="op" id="4205860">.</span><span class="ident" id="4205861">Time</span><span class="op" id="4205865">)</span>&nbsp;<span class="op" id="4205867">(</span><span class="op" id="4205868">*</span><span class="ident" id="4205869">UnixConn</span><span class="op" id="4205877">,</span>&nbsp;<span class="builtintype" id="4205879">error</span><span class="op" id="4205884">)</span>&nbsp;<span class="op" id="4205886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205889">fd</span><span class="op" id="4205891">,</span>&nbsp;<span class="ident" id="4205893">err</span>&nbsp;<span class="op" id="4205897">:=</span>&nbsp;<span class="ident" id="4205900">unixSocket</span><span class="op" id="4205910">(</span><span class="ident" id="4205911">net</span><span class="op" id="4205914">,</span>&nbsp;<span class="ident" id="4205916">laddr</span><span class="op" id="4205921">,</span>&nbsp;<span class="ident" id="4205923">raddr</span><span class="op" id="4205928">,</span>&nbsp;<span class="string" id="4205930">&#34;dial&#34;</span><span class="op" id="4205936">,</span>&nbsp;<span class="ident" id="4205938">deadline</span><span class="op" id="4205946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205949">if</span>&nbsp;<span class="ident" id="4205952">err</span>&nbsp;<span class="op" id="4205956">!=</span>&nbsp;<span class="ident" id="4205959">nil</span>&nbsp;<span class="op" id="4205963">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205967">return</span>&nbsp;<span class="ident" id="4205974">nil</span><span class="op" id="4205977">,</span>&nbsp;<span class="op" id="4205979">&amp;</span><span class="ident" id="4205980">OpError</span><span class="op" id="4205987">{</span><span class="ident" id="4205988">Op</span><span class="op" id="4205990">:</span>&nbsp;<span class="string" id="4205992">&#34;dial&#34;</span><span class="op" id="4205998">,</span>&nbsp;<span class="ident" id="4206000">Net</span><span class="op" id="4206003">:</span>&nbsp;<span class="ident" id="4206005">net</span><span class="op" id="4206008">,</span>&nbsp;<span class="ident" id="4206010">Addr</span><span class="op" id="4206014">:</span>&nbsp;<span class="ident" id="4206016">raddr</span><span class="op" id="4206021">,</span>&nbsp;<span class="ident" id="4206023">Err</span><span class="op" id="4206026">:</span>&nbsp;<span class="ident" id="4206028">err</span><span class="op" id="4206031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206037">return</span>&nbsp;<span class="ident" id="4206044">newUnixConn</span><span class="op" id="4206055">(</span><span class="ident" id="4206056">fd</span><span class="op" id="4206058">)</span><span class="op" id="4206059">,</span>&nbsp;<span class="ident" id="4206061">nil</span><br>
<span class="lineno"></span><span class="op" id="4206065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4206068">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4206134">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="4206203">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4206222">type</span>&nbsp;<span class="ident" id="4206227">UnixListener</span>&nbsp;<span class="keyword" id="4206240">struct</span>&nbsp;<span class="op" id="4206247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206250">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4206255">*</span><span class="ident" id="4206256">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206263">path</span>&nbsp;<span class="builtintype" id="4206268">string</span><br>
<span class="lineno"></span><span class="op" id="4206275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4206278">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4206348">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="4206415">func</span>&nbsp;<span class="ident" id="4206420">ListenUnix</span><span class="op" id="4206430">(</span><span class="ident" id="4206431">net</span>&nbsp;<span class="builtintype" id="4206435">string</span><span class="op" id="4206441">,</span>&nbsp;<span class="ident" id="4206443">laddr</span>&nbsp;<span class="op" id="4206449">*</span><span class="ident" id="4206450">UnixAddr</span><span class="op" id="4206458">)</span>&nbsp;<span class="op" id="4206460">(</span><span class="op" id="4206461">*</span><span class="ident" id="4206462">UnixListener</span><span class="op" id="4206474">,</span>&nbsp;<span class="builtintype" id="4206476">error</span><span class="op" id="4206481">)</span>&nbsp;<span class="op" id="4206483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206486">switch</span>&nbsp;<span class="ident" id="4206493">net</span>&nbsp;<span class="op" id="4206497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206500">case</span>&nbsp;<span class="string" id="4206505">&#34;unix&#34;</span><span class="op" id="4206511">,</span>&nbsp;<span class="string" id="4206513">&#34;unixpacket&#34;</span><span class="op" id="4206525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206528">default</span><span class="op" id="4206535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206539">return</span>&nbsp;<span class="ident" id="4206546">nil</span><span class="op" id="4206549">,</span>&nbsp;<span class="op" id="4206551">&amp;</span><span class="ident" id="4206552">OpError</span><span class="op" id="4206559">{</span><span class="ident" id="4206560">Op</span><span class="op" id="4206562">:</span>&nbsp;<span class="string" id="4206564">&#34;listen&#34;</span><span class="op" id="4206572">,</span>&nbsp;<span class="ident" id="4206574">Net</span><span class="op" id="4206577">:</span>&nbsp;<span class="ident" id="4206579">net</span><span class="op" id="4206582">,</span>&nbsp;<span class="ident" id="4206584">Addr</span><span class="op" id="4206588">:</span>&nbsp;<span class="ident" id="4206590">laddr</span><span class="op" id="4206595">,</span>&nbsp;<span class="ident" id="4206597">Err</span><span class="op" id="4206600">:</span>&nbsp;<span class="ident" id="4206602">UnknownNetworkError</span><span class="op" id="4206621">(</span><span class="ident" id="4206622">net</span><span class="op" id="4206625">)</span><span class="op" id="4206626">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206632">if</span>&nbsp;<span class="ident" id="4206635">laddr</span>&nbsp;<span class="op" id="4206641">==</span>&nbsp;<span class="ident" id="4206644">nil</span>&nbsp;<span class="op" id="4206648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206652">return</span>&nbsp;<span class="ident" id="4206659">nil</span><span class="op" id="4206662">,</span>&nbsp;<span class="op" id="4206664">&amp;</span><span class="ident" id="4206665">OpError</span><span class="op" id="4206672">{</span><span class="ident" id="4206673">Op</span><span class="op" id="4206675">:</span>&nbsp;<span class="string" id="4206677">&#34;listen&#34;</span><span class="op" id="4206685">,</span>&nbsp;<span class="ident" id="4206687">Net</span><span class="op" id="4206690">:</span>&nbsp;<span class="ident" id="4206692">net</span><span class="op" id="4206695">,</span>&nbsp;<span class="ident" id="4206697">Addr</span><span class="op" id="4206701">:</span>&nbsp;<span class="ident" id="4206703">nil</span><span class="op" id="4206706">,</span>&nbsp;<span class="ident" id="4206708">Err</span><span class="op" id="4206711">:</span>&nbsp;<span class="ident" id="4206713">errMissingAddress</span><span class="op" id="4206730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206736">fd</span><span class="op" id="4206738">,</span>&nbsp;<span class="ident" id="4206740">err</span>&nbsp;<span class="op" id="4206744">:=</span>&nbsp;<span class="ident" id="4206747">unixSocket</span><span class="op" id="4206757">(</span><span class="ident" id="4206758">net</span><span class="op" id="4206761">,</span>&nbsp;<span class="ident" id="4206763">laddr</span><span class="op" id="4206768">,</span>&nbsp;<span class="ident" id="4206770">nil</span><span class="op" id="4206773">,</span>&nbsp;<span class="string" id="4206775">&#34;listen&#34;</span><span class="op" id="4206783">,</span>&nbsp;<span class="ident" id="4206785">noDeadline</span><span class="op" id="4206795">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206798">if</span>&nbsp;<span class="ident" id="4206801">err</span>&nbsp;<span class="op" id="4206805">!=</span>&nbsp;<span class="ident" id="4206808">nil</span>&nbsp;<span class="op" id="4206812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206816">return</span>&nbsp;<span class="ident" id="4206823">nil</span><span class="op" id="4206826">,</span>&nbsp;<span class="op" id="4206828">&amp;</span><span class="ident" id="4206829">OpError</span><span class="op" id="4206836">{</span><span class="ident" id="4206837">Op</span><span class="op" id="4206839">:</span>&nbsp;<span class="string" id="4206841">&#34;listen&#34;</span><span class="op" id="4206849">,</span>&nbsp;<span class="ident" id="4206851">Net</span><span class="op" id="4206854">:</span>&nbsp;<span class="ident" id="4206856">net</span><span class="op" id="4206859">,</span>&nbsp;<span class="ident" id="4206861">Addr</span><span class="op" id="4206865">:</span>&nbsp;<span class="ident" id="4206867">laddr</span><span class="op" id="4206872">,</span>&nbsp;<span class="ident" id="4206874">Err</span><span class="op" id="4206877">:</span>&nbsp;<span class="ident" id="4206879">err</span><span class="op" id="4206882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206888">return</span>&nbsp;<span class="op" id="4206895">&amp;</span><span class="ident" id="4206896">UnixListener</span><span class="op" id="4206908">{</span><span class="ident" id="4206909">fd</span><span class="op" id="4206911">,</span>&nbsp;<span class="ident" id="4206913">fd</span><span class="op" id="4206915">.</span><span class="ident" id="4206916">laddr</span><span class="op" id="4206921">.</span><span class="ident" id="4206922">String</span><span class="op" id="4206928">(</span><span class="op" id="4206929">)</span><span class="op" id="4206930">}</span><span class="op" id="4206931">,</span>&nbsp;<span class="ident" id="4206933">nil</span><br>
<span class="lineno"></span><span class="op" id="4206937">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="4206940">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4207005">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4207020">func</span>&nbsp;<span class="op" id="4207025">(</span><span class="ident" id="4207026">l</span>&nbsp;<span class="op" id="4207028">*</span><span class="ident" id="4207029">UnixListener</span><span class="op" id="4207041">)</span>&nbsp;<span class="ident" id="4207043">AcceptUnix</span><span class="op" id="4207053">(</span><span class="op" id="4207054">)</span>&nbsp;<span class="op" id="4207056">(</span><span class="op" id="4207057">*</span><span class="ident" id="4207058">UnixConn</span><span class="op" id="4207066">,</span>&nbsp;<span class="builtintype" id="4207068">error</span><span class="op" id="4207073">)</span>&nbsp;<span class="op" id="4207075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207078">if</span>&nbsp;<span class="ident" id="4207081">l</span>&nbsp;<span class="op" id="4207083">==</span>&nbsp;<span class="ident" id="4207086">nil</span>&nbsp;<span class="op" id="4207090">||</span>&nbsp;<span class="ident" id="4207093">l</span><span class="op" id="4207094">.</span><span class="ident" id="4207095">fd</span>&nbsp;<span class="op" id="4207098">==</span>&nbsp;<span class="ident" id="4207101">nil</span>&nbsp;<span class="op" id="4207105">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207109">return</span>&nbsp;<span class="ident" id="4207116">nil</span><span class="op" id="4207119">,</span>&nbsp;<span class="ident" id="4207121">syscall</span><span class="op" id="4207128">.</span><span class="ident" id="4207129">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4207137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207140">fd</span><span class="op" id="4207142">,</span>&nbsp;<span class="ident" id="4207144">err</span>&nbsp;<span class="op" id="4207148">:=</span>&nbsp;<span class="ident" id="4207151">l</span><span class="op" id="4207152">.</span><span class="ident" id="4207153">fd</span><span class="op" id="4207155">.</span><span class="ident" id="4207156">accept</span><span class="op" id="4207162">(</span><span class="op" id="4207163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207166">if</span>&nbsp;<span class="ident" id="4207169">err</span>&nbsp;<span class="op" id="4207173">!=</span>&nbsp;<span class="ident" id="4207176">nil</span>&nbsp;<span class="op" id="4207180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207184">return</span>&nbsp;<span class="ident" id="4207191">nil</span><span class="op" id="4207194">,</span>&nbsp;<span class="ident" id="4207196">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4207201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207204">c</span>&nbsp;<span class="op" id="4207206">:=</span>&nbsp;<span class="ident" id="4207209">newUnixConn</span><span class="op" id="4207220">(</span><span class="ident" id="4207221">fd</span><span class="op" id="4207223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207226">return</span>&nbsp;<span class="ident" id="4207233">c</span><span class="op" id="4207234">,</span>&nbsp;<span class="ident" id="4207236">nil</span><br>
<span class="lineno"></span><span class="op" id="4207240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="4207243">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4207312">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="4207367">func</span>&nbsp;<span class="op" id="4207372">(</span><span class="ident" id="4207373">l</span>&nbsp;<span class="op" id="4207375">*</span><span class="ident" id="4207376">UnixListener</span><span class="op" id="4207388">)</span>&nbsp;<span class="ident" id="4207390">Accept</span><span class="op" id="4207396">(</span><span class="op" id="4207397">)</span>&nbsp;<span class="op" id="4207399">(</span><span class="ident" id="4207400">c</span>&nbsp;<span class="ident" id="4207402">Conn</span><span class="op" id="4207406">,</span>&nbsp;<span class="ident" id="4207408">err</span>&nbsp;<span class="builtintype" id="4207412">error</span><span class="op" id="4207417">)</span>&nbsp;<span class="op" id="4207419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4207422">c1</span><span class="op" id="4207424">,</span>&nbsp;<span class="ident" id="4207426">err</span>&nbsp;<span class="op" id="4207430">:=</span>&nbsp;<span class="ident" id="4207433">l</span><span class="op" id="4207434">.</span><span class="ident" id="4207435">AcceptUnix</span><span class="op" id="4207445">(</span><span class="op" id="4207446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207449">if</span>&nbsp;<span class="ident" id="4207452">err</span>&nbsp;<span class="op" id="4207456">!=</span>&nbsp;<span class="ident" id="4207459">nil</span>&nbsp;<span class="op" id="4207463">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207467">return</span>&nbsp;<span class="ident" id="4207474">nil</span><span class="op" id="4207477">,</span>&nbsp;<span class="ident" id="4207479">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4207484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207487">return</span>&nbsp;<span class="ident" id="4207494">c1</span><span class="op" id="4207496">,</span>&nbsp;<span class="ident" id="4207498">nil</span><br>
<span class="lineno"></span><span class="op" id="4207502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4207505">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="4207569">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4207600">func</span>&nbsp;<span class="op" id="4207605">(</span><span class="ident" id="4207606">l</span>&nbsp;<span class="op" id="4207608">*</span><span class="ident" id="4207609">UnixListener</span><span class="op" id="4207621">)</span>&nbsp;<span class="ident" id="4207623">Close</span><span class="op" id="4207628">(</span><span class="op" id="4207629">)</span>&nbsp;<span class="builtintype" id="4207631">error</span>&nbsp;<span class="op" id="4207637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207640">if</span>&nbsp;<span class="ident" id="4207643">l</span>&nbsp;<span class="op" id="4207645">==</span>&nbsp;<span class="ident" id="4207648">nil</span>&nbsp;<span class="op" id="4207652">||</span>&nbsp;<span class="ident" id="4207655">l</span><span class="op" id="4207656">.</span><span class="ident" id="4207657">fd</span>&nbsp;<span class="op" id="4207660">==</span>&nbsp;<span class="ident" id="4207663">nil</span>&nbsp;<span class="op" id="4207667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4207671">return</span>&nbsp;<span class="ident" id="4207678">syscall</span><span class="op" id="4207685">.</span><span class="ident" id="4207686">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4207694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207698">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207740">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207781">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207819">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207862">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207907">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207950">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4207992">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4208040">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4208086">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208120">if</span>&nbsp;<span class="ident" id="4208123">l</span><span class="op" id="4208124">.</span><span class="ident" id="4208125">path</span><span class="op" id="4208129">[</span><span class="num" id="4208130">0</span><span class="op" id="4208131">]</span>&nbsp;<span class="op" id="4208133">!=</span>&nbsp;<span class="string" id="4208136">&#39;@&#39;</span>&nbsp;<span class="op" id="4208140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4208144">syscall</span><span class="op" id="4208151">.</span><span class="ident" id="4208152">Unlink</span><span class="op" id="4208158">(</span><span class="ident" id="4208159">l</span><span class="op" id="4208160">.</span><span class="ident" id="4208161">path</span><span class="op" id="4208165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208168">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208171">return</span>&nbsp;<span class="ident" id="4208178">l</span><span class="op" id="4208179">.</span><span class="ident" id="4208180">fd</span><span class="op" id="4208182">.</span><span class="ident" id="4208183">Close</span><span class="op" id="4208188">(</span><span class="op" id="4208189">)</span><br>
<span class="lineno"></span><span class="op" id="4208191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4208194">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4208242">func</span>&nbsp;<span class="op" id="4208247">(</span><span class="ident" id="4208248">l</span>&nbsp;<span class="op" id="4208250">*</span><span class="ident" id="4208251">UnixListener</span><span class="op" id="4208263">)</span>&nbsp;<span class="ident" id="4208265">Addr</span><span class="op" id="4208269">(</span><span class="op" id="4208270">)</span>&nbsp;<span class="ident" id="4208272">Addr</span>&nbsp;<span class="op" id="4208277">{</span>&nbsp;<span class="keyword" id="4208279">return</span>&nbsp;<span class="ident" id="4208286">l</span><span class="op" id="4208287">.</span><span class="ident" id="4208288">fd</span><span class="op" id="4208290">.</span><span class="ident" id="4208291">laddr</span>&nbsp;<span class="op" id="4208297">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4208300">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="4208363">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4208407">func</span>&nbsp;<span class="op" id="4208412">(</span><span class="ident" id="4208413">l</span>&nbsp;<span class="op" id="4208415">*</span><span class="ident" id="4208416">UnixListener</span><span class="op" id="4208428">)</span>&nbsp;<span class="ident" id="4208430">SetDeadline</span><span class="op" id="4208441">(</span><span class="ident" id="4208442">t</span>&nbsp;<span class="ident" id="4208444">time</span><span class="op" id="4208448">.</span><span class="ident" id="4208449">Time</span><span class="op" id="4208453">)</span>&nbsp;<span class="op" id="4208455">(</span><span class="ident" id="4208456">err</span>&nbsp;<span class="builtintype" id="4208460">error</span><span class="op" id="4208465">)</span>&nbsp;<span class="op" id="4208467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208470">if</span>&nbsp;<span class="ident" id="4208473">l</span>&nbsp;<span class="op" id="4208475">==</span>&nbsp;<span class="ident" id="4208478">nil</span>&nbsp;<span class="op" id="4208482">||</span>&nbsp;<span class="ident" id="4208485">l</span><span class="op" id="4208486">.</span><span class="ident" id="4208487">fd</span>&nbsp;<span class="op" id="4208490">==</span>&nbsp;<span class="ident" id="4208493">nil</span>&nbsp;<span class="op" id="4208497">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208501">return</span>&nbsp;<span class="ident" id="4208508">syscall</span><span class="op" id="4208515">.</span><span class="ident" id="4208516">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4208524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4208527">return</span>&nbsp;<span class="ident" id="4208534">l</span><span class="op" id="4208535">.</span><span class="ident" id="4208536">fd</span><span class="op" id="4208538">.</span><span class="ident" id="4208539">setDeadline</span><span class="op" id="4208550">(</span><span class="ident" id="4208551">t</span><span class="op" id="4208552">)</span><br>
<span class="lineno"></span><span class="op" id="4208554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="4208557">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="4208623">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="4208693">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="4208758">//</span><br>
<span class="lineno"></span><span class="comment" id="4208761">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="4208825">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="4208891">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="4208955">func</span>&nbsp;<span class="op" id="4208960">(</span><span class="ident" id="4208961">l</span>&nbsp;<span class="op" id="4208963">*</span><span class="ident" id="4208964">UnixListener</span><span class="op" id="4208976">)</span>&nbsp;<span class="ident" id="4208978">File</span><span class="op" id="4208982">(</span><span class="op" id="4208983">)</span>&nbsp;<span class="op" id="4208985">(</span><span class="ident" id="4208986">f</span>&nbsp;<span class="op" id="4208988">*</span><span class="ident" id="4208989">os</span><span class="op" id="4208991">.</span><span class="ident" id="4208992">File</span><span class="op" id="4208996">,</span>&nbsp;<span class="ident" id="4208998">err</span>&nbsp;<span class="builtintype" id="4209002">error</span><span class="op" id="4209007">)</span>&nbsp;<span class="op" id="4209009">{</span>&nbsp;<span class="keyword" id="4209011">return</span>&nbsp;<span class="ident" id="4209018">l</span><span class="op" id="4209019">.</span><span class="ident" id="4209020">fd</span><span class="op" id="4209022">.</span><span class="ident" id="4209023">dup</span><span class="op" id="4209026">(</span><span class="op" id="4209027">)</span>&nbsp;<span class="op" id="4209029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4209032">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="4209103">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4209171">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4209241">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="4209300">func</span>&nbsp;<span class="ident" id="4209305">ListenUnixgram</span><span class="op" id="4209319">(</span><span class="ident" id="4209320">net</span>&nbsp;<span class="builtintype" id="4209324">string</span><span class="op" id="4209330">,</span>&nbsp;<span class="ident" id="4209332">laddr</span>&nbsp;<span class="op" id="4209338">*</span><span class="ident" id="4209339">UnixAddr</span><span class="op" id="4209347">)</span>&nbsp;<span class="op" id="4209349">(</span><span class="op" id="4209350">*</span><span class="ident" id="4209351">UnixConn</span><span class="op" id="4209359">,</span>&nbsp;<span class="builtintype" id="4209361">error</span><span class="op" id="4209366">)</span>&nbsp;<span class="op" id="4209368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209371">switch</span>&nbsp;<span class="ident" id="4209378">net</span>&nbsp;<span class="op" id="4209382">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209385">case</span>&nbsp;<span class="string" id="4209390">&#34;unixgram&#34;</span><span class="op" id="4209400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209403">default</span><span class="op" id="4209410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209414">return</span>&nbsp;<span class="ident" id="4209421">nil</span><span class="op" id="4209424">,</span>&nbsp;<span class="op" id="4209426">&amp;</span><span class="ident" id="4209427">OpError</span><span class="op" id="4209434">{</span><span class="ident" id="4209435">Op</span><span class="op" id="4209437">:</span>&nbsp;<span class="string" id="4209439">&#34;listen&#34;</span><span class="op" id="4209447">,</span>&nbsp;<span class="ident" id="4209449">Net</span><span class="op" id="4209452">:</span>&nbsp;<span class="ident" id="4209454">net</span><span class="op" id="4209457">,</span>&nbsp;<span class="ident" id="4209459">Addr</span><span class="op" id="4209463">:</span>&nbsp;<span class="ident" id="4209465">laddr</span><span class="op" id="4209470">,</span>&nbsp;<span class="ident" id="4209472">Err</span><span class="op" id="4209475">:</span>&nbsp;<span class="ident" id="4209477">UnknownNetworkError</span><span class="op" id="4209496">(</span><span class="ident" id="4209497">net</span><span class="op" id="4209500">)</span><span class="op" id="4209501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209507">if</span>&nbsp;<span class="ident" id="4209510">laddr</span>&nbsp;<span class="op" id="4209516">==</span>&nbsp;<span class="ident" id="4209519">nil</span>&nbsp;<span class="op" id="4209523">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209527">return</span>&nbsp;<span class="ident" id="4209534">nil</span><span class="op" id="4209537">,</span>&nbsp;<span class="op" id="4209539">&amp;</span><span class="ident" id="4209540">OpError</span><span class="op" id="4209547">{</span><span class="ident" id="4209548">Op</span><span class="op" id="4209550">:</span>&nbsp;<span class="string" id="4209552">&#34;listen&#34;</span><span class="op" id="4209560">,</span>&nbsp;<span class="ident" id="4209562">Net</span><span class="op" id="4209565">:</span>&nbsp;<span class="ident" id="4209567">net</span><span class="op" id="4209570">,</span>&nbsp;<span class="ident" id="4209572">Addr</span><span class="op" id="4209576">:</span>&nbsp;<span class="ident" id="4209578">nil</span><span class="op" id="4209581">,</span>&nbsp;<span class="ident" id="4209583">Err</span><span class="op" id="4209586">:</span>&nbsp;<span class="ident" id="4209588">errMissingAddress</span><span class="op" id="4209605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4209611">fd</span><span class="op" id="4209613">,</span>&nbsp;<span class="ident" id="4209615">err</span>&nbsp;<span class="op" id="4209619">:=</span>&nbsp;<span class="ident" id="4209622">unixSocket</span><span class="op" id="4209632">(</span><span class="ident" id="4209633">net</span><span class="op" id="4209636">,</span>&nbsp;<span class="ident" id="4209638">laddr</span><span class="op" id="4209643">,</span>&nbsp;<span class="ident" id="4209645">nil</span><span class="op" id="4209648">,</span>&nbsp;<span class="string" id="4209650">&#34;listen&#34;</span><span class="op" id="4209658">,</span>&nbsp;<span class="ident" id="4209660">noDeadline</span><span class="op" id="4209670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209673">if</span>&nbsp;<span class="ident" id="4209676">err</span>&nbsp;<span class="op" id="4209680">!=</span>&nbsp;<span class="ident" id="4209683">nil</span>&nbsp;<span class="op" id="4209687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209691">return</span>&nbsp;<span class="ident" id="4209698">nil</span><span class="op" id="4209701">,</span>&nbsp;<span class="op" id="4209703">&amp;</span><span class="ident" id="4209704">OpError</span><span class="op" id="4209711">{</span><span class="ident" id="4209712">Op</span><span class="op" id="4209714">:</span>&nbsp;<span class="string" id="4209716">&#34;listen&#34;</span><span class="op" id="4209724">,</span>&nbsp;<span class="ident" id="4209726">Net</span><span class="op" id="4209729">:</span>&nbsp;<span class="ident" id="4209731">net</span><span class="op" id="4209734">,</span>&nbsp;<span class="ident" id="4209736">Addr</span><span class="op" id="4209740">:</span>&nbsp;<span class="ident" id="4209742">laddr</span><span class="op" id="4209747">,</span>&nbsp;<span class="ident" id="4209749">Err</span><span class="op" id="4209752">:</span>&nbsp;<span class="ident" id="4209754">err</span><span class="op" id="4209757">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4209760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4209763">return</span>&nbsp;<span class="ident" id="4209770">newUnixConn</span><span class="op" id="4209781">(</span><span class="ident" id="4209782">fd</span><span class="op" id="4209784">)</span><span class="op" id="4209785">,</span>&nbsp;<span class="ident" id="4209787">nil</span><br>
<span class="lineno"></span><span class="op" id="4209791">}</span>
</div>
</body>
</html>
