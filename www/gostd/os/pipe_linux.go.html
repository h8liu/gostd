<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2350411">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2350466">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2350520">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2350571">package</span>&nbsp;<span class="ident" id="2350579">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2350583">import</span>&nbsp;<span class="string" id="2350590">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2350601">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2350684">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2350730">func</span>&nbsp;<span class="ident" id="2350735">Pipe</span><span class="op" id="2350739">(</span><span class="op" id="2350740">)</span>&nbsp;<span class="op" id="2350742">(</span><span class="ident" id="2350743">r</span>&nbsp;<span class="op" id="2350745">*</span><span class="ident" id="2350746">File</span><span class="op" id="2350750">,</span>&nbsp;<span class="ident" id="2350752">w</span>&nbsp;<span class="op" id="2350754">*</span><span class="ident" id="2350755">File</span><span class="op" id="2350759">,</span>&nbsp;<span class="ident" id="2350761">err</span>&nbsp;<span class="builtintype" id="2350765">error</span><span class="op" id="2350770">)</span>&nbsp;<span class="op" id="2350772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350775">var</span>&nbsp;<span class="ident" id="2350779">p</span>&nbsp;<span class="op" id="2350781">[</span><span class="num" id="2350782">2</span><span class="op" id="2350783">]</span><span class="builtintype" id="2350784">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2350790">e</span>&nbsp;<span class="op" id="2350792">:=</span>&nbsp;<span class="ident" id="2350795">syscall</span><span class="op" id="2350802">.</span><span class="ident" id="2350803">Pipe2</span><span class="op" id="2350808">(</span><span class="ident" id="2350809">p</span><span class="op" id="2350810">[</span><span class="num" id="2350811">0</span><span class="op" id="2350812">:</span><span class="op" id="2350813">]</span><span class="op" id="2350814">,</span>&nbsp;<span class="ident" id="2350816">syscall</span><span class="op" id="2350823">.</span><span class="ident" id="2350824">O_CLOEXEC</span><span class="op" id="2350833">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350836">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350911">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2350941">if</span>&nbsp;<span class="ident" id="2350944">e</span>&nbsp;<span class="op" id="2350946">==</span>&nbsp;<span class="ident" id="2350949">syscall</span><span class="op" id="2350956">.</span><span class="ident" id="2350957">ENOSYS</span>&nbsp;<span class="op" id="2350964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2350968">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351021">syscall</span><span class="op" id="2351028">.</span><span class="ident" id="2351029">ForkLock</span><span class="op" id="2351037">.</span><span class="ident" id="2351038">RLock</span><span class="op" id="2351043">(</span><span class="op" id="2351044">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351048">e</span>&nbsp;<span class="op" id="2351050">=</span>&nbsp;<span class="ident" id="2351052">syscall</span><span class="op" id="2351059">.</span><span class="ident" id="2351060">Pipe</span><span class="op" id="2351064">(</span><span class="ident" id="2351065">p</span><span class="op" id="2351066">[</span><span class="num" id="2351067">0</span><span class="op" id="2351068">:</span><span class="op" id="2351069">]</span><span class="op" id="2351070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351074">if</span>&nbsp;<span class="ident" id="2351077">e</span>&nbsp;<span class="op" id="2351079">!=</span>&nbsp;<span class="ident" id="2351082">nil</span>&nbsp;<span class="op" id="2351086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351091">syscall</span><span class="op" id="2351098">.</span><span class="ident" id="2351099">ForkLock</span><span class="op" id="2351107">.</span><span class="ident" id="2351108">RUnlock</span><span class="op" id="2351115">(</span><span class="op" id="2351116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351121">return</span>&nbsp;<span class="ident" id="2351128">nil</span><span class="op" id="2351131">,</span>&nbsp;<span class="ident" id="2351133">nil</span><span class="op" id="2351136">,</span>&nbsp;<span class="ident" id="2351138">NewSyscallError</span><span class="op" id="2351153">(</span><span class="string" id="2351154">&#34;pipe&#34;</span><span class="op" id="2351160">,</span>&nbsp;<span class="ident" id="2351162">e</span><span class="op" id="2351163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351167">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351171">syscall</span><span class="op" id="2351178">.</span><span class="ident" id="2351179">CloseOnExec</span><span class="op" id="2351190">(</span><span class="ident" id="2351191">p</span><span class="op" id="2351192">[</span><span class="num" id="2351193">0</span><span class="op" id="2351194">]</span><span class="op" id="2351195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351199">syscall</span><span class="op" id="2351206">.</span><span class="ident" id="2351207">CloseOnExec</span><span class="op" id="2351218">(</span><span class="ident" id="2351219">p</span><span class="op" id="2351220">[</span><span class="num" id="2351221">1</span><span class="op" id="2351222">]</span><span class="op" id="2351223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2351227">syscall</span><span class="op" id="2351234">.</span><span class="ident" id="2351235">ForkLock</span><span class="op" id="2351243">.</span><span class="ident" id="2351244">RUnlock</span><span class="op" id="2351251">(</span><span class="op" id="2351252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351255">}</span>&nbsp;<span class="keyword" id="2351257">else</span>&nbsp;<span class="keyword" id="2351262">if</span>&nbsp;<span class="ident" id="2351265">e</span>&nbsp;<span class="op" id="2351267">!=</span>&nbsp;<span class="ident" id="2351270">nil</span>&nbsp;<span class="op" id="2351274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351278">return</span>&nbsp;<span class="ident" id="2351285">nil</span><span class="op" id="2351288">,</span>&nbsp;<span class="ident" id="2351290">nil</span><span class="op" id="2351293">,</span>&nbsp;<span class="ident" id="2351295">NewSyscallError</span><span class="op" id="2351310">(</span><span class="string" id="2351311">&#34;pipe2&#34;</span><span class="op" id="2351318">,</span>&nbsp;<span class="ident" id="2351320">e</span><span class="op" id="2351321">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2351324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2351328">return</span>&nbsp;<span class="ident" id="2351335">NewFile</span><span class="op" id="2351342">(</span><span class="builtintype" id="2351343">uintptr</span><span class="op" id="2351350">(</span><span class="ident" id="2351351">p</span><span class="op" id="2351352">[</span><span class="num" id="2351353">0</span><span class="op" id="2351354">]</span><span class="op" id="2351355">)</span><span class="op" id="2351356">,</span>&nbsp;<span class="string" id="2351358">&#34;|0&#34;</span><span class="op" id="2351362">)</span><span class="op" id="2351363">,</span>&nbsp;<span class="ident" id="2351365">NewFile</span><span class="op" id="2351372">(</span><span class="builtintype" id="2351373">uintptr</span><span class="op" id="2351380">(</span><span class="ident" id="2351381">p</span><span class="op" id="2351382">[</span><span class="num" id="2351383">1</span><span class="op" id="2351384">]</span><span class="op" id="2351385">)</span><span class="op" id="2351386">,</span>&nbsp;<span class="string" id="2351388">&#34;|1&#34;</span><span class="op" id="2351392">)</span><span class="op" id="2351393">,</span>&nbsp;<span class="ident" id="2351395">nil</span><br>
<span class="lineno"></span><span class="op" id="2351399">}</span>
</div>
</body>
</html>
