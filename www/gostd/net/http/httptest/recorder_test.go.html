<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7376085">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7376140">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7376194">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7376245">package</span>&nbsp;<span class="ident" id="7376253">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7376263">import</span>&nbsp;<span class="op" id="7376270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7376273">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7376280">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7376292">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7376302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7376305">func</span>&nbsp;<span class="ident" id="7376310">TestRecorder</span><span class="op" id="7376322">(</span><span class="ident" id="7376323">t</span>&nbsp;<span class="op" id="7376325">*</span><span class="ident" id="7376326">testing</span><span class="op" id="7376333">.</span><span class="ident" id="7376334">T</span><span class="op" id="7376335">)</span>&nbsp;<span class="op" id="7376337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376340">type</span>&nbsp;<span class="ident" id="7376345">checkFunc</span>&nbsp;<span class="keyword" id="7376355">func</span><span class="op" id="7376359">(</span><span class="op" id="7376360">*</span><span class="ident" id="7376361">ResponseRecorder</span><span class="op" id="7376377">)</span>&nbsp;<span class="builtintype" id="7376379">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376386">check</span>&nbsp;<span class="op" id="7376392">:=</span>&nbsp;<span class="keyword" id="7376395">func</span><span class="op" id="7376399">(</span><span class="ident" id="7376400">fns</span>&nbsp;<span class="op" id="7376404">...</span><span class="ident" id="7376407">checkFunc</span><span class="op" id="7376416">)</span>&nbsp;<span class="op" id="7376418">[</span><span class="op" id="7376419">]</span><span class="ident" id="7376420">checkFunc</span>&nbsp;<span class="op" id="7376430">{</span>&nbsp;<span class="keyword" id="7376432">return</span>&nbsp;<span class="ident" id="7376439">fns</span>&nbsp;<span class="op" id="7376443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376447">hasStatus</span>&nbsp;<span class="op" id="7376457">:=</span>&nbsp;<span class="keyword" id="7376460">func</span><span class="op" id="7376464">(</span><span class="ident" id="7376465">wantCode</span>&nbsp;<span class="builtintype" id="7376474">int</span><span class="op" id="7376477">)</span>&nbsp;<span class="ident" id="7376479">checkFunc</span>&nbsp;<span class="op" id="7376489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376493">return</span>&nbsp;<span class="keyword" id="7376500">func</span><span class="op" id="7376504">(</span><span class="ident" id="7376505">rec</span>&nbsp;<span class="op" id="7376509">*</span><span class="ident" id="7376510">ResponseRecorder</span><span class="op" id="7376526">)</span>&nbsp;<span class="builtintype" id="7376528">error</span>&nbsp;<span class="op" id="7376534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376539">if</span>&nbsp;<span class="ident" id="7376542">rec</span><span class="op" id="7376545">.</span><span class="ident" id="7376546">Code</span>&nbsp;<span class="op" id="7376551">!=</span>&nbsp;<span class="ident" id="7376554">wantCode</span>&nbsp;<span class="op" id="7376563">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376569">return</span>&nbsp;<span class="ident" id="7376576">fmt</span><span class="op" id="7376579">.</span><span class="ident" id="7376580">Errorf</span><span class="op" id="7376586">(</span><span class="string" id="7376587">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7376609">,</span>&nbsp;<span class="ident" id="7376611">rec</span><span class="op" id="7376614">.</span><span class="ident" id="7376615">Code</span><span class="op" id="7376619">,</span>&nbsp;<span class="ident" id="7376621">wantCode</span><span class="op" id="7376629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376639">return</span>&nbsp;<span class="ident" id="7376646">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376655">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376658">hasContents</span>&nbsp;<span class="op" id="7376670">:=</span>&nbsp;<span class="keyword" id="7376673">func</span><span class="op" id="7376677">(</span><span class="ident" id="7376678">want</span>&nbsp;<span class="builtintype" id="7376683">string</span><span class="op" id="7376689">)</span>&nbsp;<span class="ident" id="7376691">checkFunc</span>&nbsp;<span class="op" id="7376701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376705">return</span>&nbsp;<span class="keyword" id="7376712">func</span><span class="op" id="7376716">(</span><span class="ident" id="7376717">rec</span>&nbsp;<span class="op" id="7376721">*</span><span class="ident" id="7376722">ResponseRecorder</span><span class="op" id="7376738">)</span>&nbsp;<span class="builtintype" id="7376740">error</span>&nbsp;<span class="op" id="7376746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376751">if</span>&nbsp;<span class="ident" id="7376754">rec</span><span class="op" id="7376757">.</span><span class="ident" id="7376758">Body</span><span class="op" id="7376762">.</span><span class="ident" id="7376763">String</span><span class="op" id="7376769">(</span><span class="op" id="7376770">)</span>&nbsp;<span class="op" id="7376772">!=</span>&nbsp;<span class="ident" id="7376775">want</span>&nbsp;<span class="op" id="7376780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376786">return</span>&nbsp;<span class="ident" id="7376793">fmt</span><span class="op" id="7376796">.</span><span class="ident" id="7376797">Errorf</span><span class="op" id="7376803">(</span><span class="string" id="7376804">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7376825">,</span>&nbsp;<span class="ident" id="7376827">rec</span><span class="op" id="7376830">.</span><span class="ident" id="7376831">Body</span><span class="op" id="7376835">.</span><span class="ident" id="7376836">String</span><span class="op" id="7376842">(</span><span class="op" id="7376843">)</span><span class="op" id="7376844">,</span>&nbsp;<span class="ident" id="7376846">want</span><span class="op" id="7376850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376855">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376860">return</span>&nbsp;<span class="ident" id="7376867">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376879">hasFlush</span>&nbsp;<span class="op" id="7376888">:=</span>&nbsp;<span class="keyword" id="7376891">func</span><span class="op" id="7376895">(</span><span class="ident" id="7376896">want</span>&nbsp;<span class="builtintype" id="7376901">bool</span><span class="op" id="7376905">)</span>&nbsp;<span class="ident" id="7376907">checkFunc</span>&nbsp;<span class="op" id="7376917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376921">return</span>&nbsp;<span class="keyword" id="7376928">func</span><span class="op" id="7376932">(</span><span class="ident" id="7376933">rec</span>&nbsp;<span class="op" id="7376937">*</span><span class="ident" id="7376938">ResponseRecorder</span><span class="op" id="7376954">)</span>&nbsp;<span class="builtintype" id="7376956">error</span>&nbsp;<span class="op" id="7376962">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376967">if</span>&nbsp;<span class="ident" id="7376970">rec</span><span class="op" id="7376973">.</span><span class="ident" id="7376974">Flushed</span>&nbsp;<span class="op" id="7376982">!=</span>&nbsp;<span class="ident" id="7376985">want</span>&nbsp;<span class="op" id="7376990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376996">return</span>&nbsp;<span class="ident" id="7377003">fmt</span><span class="op" id="7377006">.</span><span class="ident" id="7377007">Errorf</span><span class="op" id="7377013">(</span><span class="string" id="7377014">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7377037">,</span>&nbsp;<span class="ident" id="7377039">rec</span><span class="op" id="7377042">.</span><span class="ident" id="7377043">Flushed</span><span class="op" id="7377050">,</span>&nbsp;<span class="ident" id="7377052">want</span><span class="op" id="7377056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377066">return</span>&nbsp;<span class="ident" id="7377073">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377079">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377086">tests</span>&nbsp;<span class="op" id="7377092">:=</span>&nbsp;<span class="op" id="7377095">[</span><span class="op" id="7377096">]</span><span class="keyword" id="7377097">struct</span>&nbsp;<span class="op" id="7377104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377108">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7377115">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377124">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7377131">func</span><span class="op" id="7377135">(</span><span class="ident" id="7377136">w</span>&nbsp;<span class="ident" id="7377138">http</span><span class="op" id="7377142">.</span><span class="ident" id="7377143">ResponseWriter</span><span class="op" id="7377157">,</span>&nbsp;<span class="ident" id="7377159">r</span>&nbsp;<span class="op" id="7377161">*</span><span class="ident" id="7377162">http</span><span class="op" id="7377166">.</span><span class="ident" id="7377167">Request</span><span class="op" id="7377174">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377178">checks</span>&nbsp;<span class="op" id="7377185">[</span><span class="op" id="7377186">]</span><span class="ident" id="7377187">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377198">}</span><span class="op" id="7377199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7377208">&#34;200&nbsp;default&#34;</span><span class="op" id="7377221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377226">func</span><span class="op" id="7377230">(</span><span class="ident" id="7377231">w</span>&nbsp;<span class="ident" id="7377233">http</span><span class="op" id="7377237">.</span><span class="ident" id="7377238">ResponseWriter</span><span class="op" id="7377252">,</span>&nbsp;<span class="ident" id="7377254">r</span>&nbsp;<span class="op" id="7377256">*</span><span class="ident" id="7377257">http</span><span class="op" id="7377261">.</span><span class="ident" id="7377262">Request</span><span class="op" id="7377269">)</span>&nbsp;<span class="op" id="7377271">{</span><span class="op" id="7377272">}</span><span class="op" id="7377273">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377278">check</span><span class="op" id="7377283">(</span><span class="ident" id="7377284">hasStatus</span><span class="op" id="7377293">(</span><span class="num" id="7377294">200</span><span class="op" id="7377297">)</span><span class="op" id="7377298">,</span>&nbsp;<span class="ident" id="7377300">hasContents</span><span class="op" id="7377311">(</span><span class="string" id="7377312">&#34;&#34;</span><span class="op" id="7377314">)</span><span class="op" id="7377315">)</span><span class="op" id="7377316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377320">}</span><span class="op" id="7377321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7377330">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7377347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377352">func</span><span class="op" id="7377356">(</span><span class="ident" id="7377357">w</span>&nbsp;<span class="ident" id="7377359">http</span><span class="op" id="7377363">.</span><span class="ident" id="7377364">ResponseWriter</span><span class="op" id="7377378">,</span>&nbsp;<span class="ident" id="7377380">r</span>&nbsp;<span class="op" id="7377382">*</span><span class="ident" id="7377383">http</span><span class="op" id="7377387">.</span><span class="ident" id="7377388">Request</span><span class="op" id="7377395">)</span>&nbsp;<span class="op" id="7377397">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377403">w</span><span class="op" id="7377404">.</span><span class="ident" id="7377405">WriteHeader</span><span class="op" id="7377416">(</span><span class="num" id="7377417">201</span><span class="op" id="7377420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377426">w</span><span class="op" id="7377427">.</span><span class="ident" id="7377428">WriteHeader</span><span class="op" id="7377439">(</span><span class="num" id="7377440">202</span><span class="op" id="7377443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377449">w</span><span class="op" id="7377450">.</span><span class="ident" id="7377451">Write</span><span class="op" id="7377456">(</span><span class="op" id="7377457">[</span><span class="op" id="7377458">]</span><span class="builtintype" id="7377459">byte</span><span class="op" id="7377463">(</span><span class="string" id="7377464">&#34;hi&#34;</span><span class="op" id="7377468">)</span><span class="op" id="7377469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377474">}</span><span class="op" id="7377475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377480">check</span><span class="op" id="7377485">(</span><span class="ident" id="7377486">hasStatus</span><span class="op" id="7377495">(</span><span class="num" id="7377496">201</span><span class="op" id="7377499">)</span><span class="op" id="7377500">,</span>&nbsp;<span class="ident" id="7377502">hasContents</span><span class="op" id="7377513">(</span><span class="string" id="7377514">&#34;hi&#34;</span><span class="op" id="7377518">)</span><span class="op" id="7377519">)</span><span class="op" id="7377520">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377524">}</span><span class="op" id="7377525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7377534">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7377551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377556">func</span><span class="op" id="7377560">(</span><span class="ident" id="7377561">w</span>&nbsp;<span class="ident" id="7377563">http</span><span class="op" id="7377567">.</span><span class="ident" id="7377568">ResponseWriter</span><span class="op" id="7377582">,</span>&nbsp;<span class="ident" id="7377584">r</span>&nbsp;<span class="op" id="7377586">*</span><span class="ident" id="7377587">http</span><span class="op" id="7377591">.</span><span class="ident" id="7377592">Request</span><span class="op" id="7377599">)</span>&nbsp;<span class="op" id="7377601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377607">w</span><span class="op" id="7377608">.</span><span class="ident" id="7377609">Write</span><span class="op" id="7377614">(</span><span class="op" id="7377615">[</span><span class="op" id="7377616">]</span><span class="builtintype" id="7377617">byte</span><span class="op" id="7377621">(</span><span class="string" id="7377622">&#34;hi&nbsp;first&#34;</span><span class="op" id="7377632">)</span><span class="op" id="7377633">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377639">w</span><span class="op" id="7377640">.</span><span class="ident" id="7377641">WriteHeader</span><span class="op" id="7377652">(</span><span class="num" id="7377653">201</span><span class="op" id="7377656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377662">w</span><span class="op" id="7377663">.</span><span class="ident" id="7377664">WriteHeader</span><span class="op" id="7377675">(</span><span class="num" id="7377676">202</span><span class="op" id="7377679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377684">}</span><span class="op" id="7377685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377690">check</span><span class="op" id="7377695">(</span><span class="ident" id="7377696">hasStatus</span><span class="op" id="7377705">(</span><span class="num" id="7377706">200</span><span class="op" id="7377709">)</span><span class="op" id="7377710">,</span>&nbsp;<span class="ident" id="7377712">hasContents</span><span class="op" id="7377723">(</span><span class="string" id="7377724">&#34;hi&nbsp;first&#34;</span><span class="op" id="7377734">)</span><span class="op" id="7377735">,</span>&nbsp;<span class="ident" id="7377737">hasFlush</span><span class="op" id="7377745">(</span><span class="builtintype" id="7377746">false</span><span class="op" id="7377751">)</span><span class="op" id="7377752">)</span><span class="op" id="7377753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377757">}</span><span class="op" id="7377758">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7377767">&#34;flush&#34;</span><span class="op" id="7377774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377779">func</span><span class="op" id="7377783">(</span><span class="ident" id="7377784">w</span>&nbsp;<span class="ident" id="7377786">http</span><span class="op" id="7377790">.</span><span class="ident" id="7377791">ResponseWriter</span><span class="op" id="7377805">,</span>&nbsp;<span class="ident" id="7377807">r</span>&nbsp;<span class="op" id="7377809">*</span><span class="ident" id="7377810">http</span><span class="op" id="7377814">.</span><span class="ident" id="7377815">Request</span><span class="op" id="7377822">)</span>&nbsp;<span class="op" id="7377824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377830">w</span><span class="op" id="7377831">.</span><span class="op" id="7377832">(</span><span class="ident" id="7377833">http</span><span class="op" id="7377837">.</span><span class="ident" id="7377838">Flusher</span><span class="op" id="7377845">)</span><span class="op" id="7377846">.</span><span class="ident" id="7377847">Flush</span><span class="op" id="7377852">(</span><span class="op" id="7377853">)</span>&nbsp;<span class="comment" id="7377855">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377879">w</span><span class="op" id="7377880">.</span><span class="ident" id="7377881">WriteHeader</span><span class="op" id="7377892">(</span><span class="num" id="7377893">201</span><span class="op" id="7377896">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377901">}</span><span class="op" id="7377902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377907">check</span><span class="op" id="7377912">(</span><span class="ident" id="7377913">hasStatus</span><span class="op" id="7377922">(</span><span class="num" id="7377923">200</span><span class="op" id="7377926">)</span><span class="op" id="7377927">,</span>&nbsp;<span class="ident" id="7377929">hasFlush</span><span class="op" id="7377937">(</span><span class="builtintype" id="7377938">true</span><span class="op" id="7377942">)</span><span class="op" id="7377943">)</span><span class="op" id="7377944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377948">}</span><span class="op" id="7377949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377955">r</span><span class="op" id="7377956">,</span>&nbsp;<span class="ident" id="7377958">_</span>&nbsp;<span class="op" id="7377960">:=</span>&nbsp;<span class="ident" id="7377963">http</span><span class="op" id="7377967">.</span><span class="ident" id="7377968">NewRequest</span><span class="op" id="7377978">(</span><span class="string" id="7377979">&#34;GET&#34;</span><span class="op" id="7377984">,</span>&nbsp;<span class="string" id="7377986">&#34;http://foo.com/&#34;</span><span class="op" id="7378003">,</span>&nbsp;<span class="ident" id="7378005">nil</span><span class="op" id="7378008">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378011">for</span>&nbsp;<span class="ident" id="7378015">_</span><span class="op" id="7378016">,</span>&nbsp;<span class="ident" id="7378018">tt</span>&nbsp;<span class="op" id="7378021">:=</span>&nbsp;<span class="keyword" id="7378024">range</span>&nbsp;<span class="ident" id="7378030">tests</span>&nbsp;<span class="op" id="7378036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378040">h</span>&nbsp;<span class="op" id="7378042">:=</span>&nbsp;<span class="ident" id="7378045">http</span><span class="op" id="7378049">.</span><span class="ident" id="7378050">HandlerFunc</span><span class="op" id="7378061">(</span><span class="ident" id="7378062">tt</span><span class="op" id="7378064">.</span><span class="ident" id="7378065">h</span><span class="op" id="7378066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378070">rec</span>&nbsp;<span class="op" id="7378074">:=</span>&nbsp;<span class="ident" id="7378077">NewRecorder</span><span class="op" id="7378088">(</span><span class="op" id="7378089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378093">h</span><span class="op" id="7378094">.</span><span class="ident" id="7378095">ServeHTTP</span><span class="op" id="7378104">(</span><span class="ident" id="7378105">rec</span><span class="op" id="7378108">,</span>&nbsp;<span class="ident" id="7378110">r</span><span class="op" id="7378111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378115">for</span>&nbsp;<span class="ident" id="7378119">_</span><span class="op" id="7378120">,</span>&nbsp;<span class="ident" id="7378122">check</span>&nbsp;<span class="op" id="7378128">:=</span>&nbsp;<span class="keyword" id="7378131">range</span>&nbsp;<span class="ident" id="7378137">tt</span><span class="op" id="7378139">.</span><span class="ident" id="7378140">checks</span>&nbsp;<span class="op" id="7378147">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7378152">if</span>&nbsp;<span class="ident" id="7378155">err</span>&nbsp;<span class="op" id="7378159">:=</span>&nbsp;<span class="ident" id="7378162">check</span><span class="op" id="7378167">(</span><span class="ident" id="7378168">rec</span><span class="op" id="7378171">)</span><span class="op" id="7378172">;</span>&nbsp;<span class="ident" id="7378174">err</span>&nbsp;<span class="op" id="7378178">!=</span>&nbsp;<span class="ident" id="7378181">nil</span>&nbsp;<span class="op" id="7378185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7378191">t</span><span class="op" id="7378192">.</span><span class="ident" id="7378193">Errorf</span><span class="op" id="7378199">(</span><span class="string" id="7378200">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7378208">,</span>&nbsp;<span class="ident" id="7378210">tt</span><span class="op" id="7378212">.</span><span class="ident" id="7378213">name</span><span class="op" id="7378217">,</span>&nbsp;<span class="ident" id="7378219">err</span><span class="op" id="7378222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7378234">}</span><br>
<span class="lineno">90</span><span class="op" id="7378236">}</span>
</div>
</body>
</html>
