<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8332703">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8332758">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8332812">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8332863">package</span>&nbsp;<span class="ident" id="8332871">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8332880">import</span>&nbsp;<span class="op" id="8332887">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332890">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332899">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332909">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332917">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332924">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332934">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332947">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332959">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332972">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8332989">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8333000">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8333007">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8333010">const</span>&nbsp;<span class="op" id="8333016">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333019">dataDir</span>&nbsp;&nbsp;<span class="op" id="8333028">=</span>&nbsp;<span class="string" id="8333030">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333042">tabwidth</span>&nbsp;<span class="op" id="8333051">=</span>&nbsp;<span class="num" id="8333053">8</span><br>
<span class="lineno"></span><span class="op" id="8333055">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8333058">var</span>&nbsp;<span class="ident" id="8333062">update</span>&nbsp;<span class="op" id="8333069">=</span>&nbsp;<span class="ident" id="8333071">flag</span><span class="op" id="8333075">.</span><span class="ident" id="8333076">Bool</span><span class="op" id="8333080">(</span><span class="string" id="8333081">&#34;update&#34;</span><span class="op" id="8333089">,</span>&nbsp;<span class="builtintype" id="8333091">false</span><span class="op" id="8333096">,</span>&nbsp;<span class="string" id="8333098">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="8333119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8333122">var</span>&nbsp;<span class="ident" id="8333126">fset</span>&nbsp;<span class="op" id="8333131">=</span>&nbsp;<span class="ident" id="8333133">token</span><span class="op" id="8333138">.</span><span class="ident" id="8333139">NewFileSet</span><span class="op" id="8333149">(</span><span class="op" id="8333150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8333153">type</span>&nbsp;<span class="ident" id="8333158">checkMode</span>&nbsp;<span class="builtintype" id="8333168">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8333174">const</span>&nbsp;<span class="op" id="8333180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333183">export</span>&nbsp;<span class="ident" id="8333190">checkMode</span>&nbsp;<span class="op" id="8333200">=</span>&nbsp;<span class="num" id="8333202">1</span>&nbsp;<span class="op" id="8333204">&lt;&lt;</span>&nbsp;<span class="ident" id="8333207">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333213">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333224">idempotent</span><br>
<span class="lineno"></span><span class="op" id="8333235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8333238">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8333313">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="8333388">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="8333399">func</span>&nbsp;<span class="ident" id="8333404">format</span><span class="op" id="8333410">(</span><span class="ident" id="8333411">src</span>&nbsp;<span class="op" id="8333415">[</span><span class="op" id="8333416">]</span><span class="builtintype" id="8333417">byte</span><span class="op" id="8333421">,</span>&nbsp;<span class="ident" id="8333423">mode</span>&nbsp;<span class="ident" id="8333428">checkMode</span><span class="op" id="8333437">)</span>&nbsp;<span class="op" id="8333439">(</span><span class="op" id="8333440">[</span><span class="op" id="8333441">]</span><span class="builtintype" id="8333442">byte</span><span class="op" id="8333446">,</span>&nbsp;<span class="builtintype" id="8333448">error</span><span class="op" id="8333453">)</span>&nbsp;<span class="op" id="8333455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8333458">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333472">f</span><span class="op" id="8333473">,</span>&nbsp;<span class="ident" id="8333475">err</span>&nbsp;<span class="op" id="8333479">:=</span>&nbsp;<span class="ident" id="8333482">parser</span><span class="op" id="8333488">.</span><span class="ident" id="8333489">ParseFile</span><span class="op" id="8333498">(</span><span class="ident" id="8333499">fset</span><span class="op" id="8333503">,</span>&nbsp;<span class="string" id="8333505">&#34;&#34;</span><span class="op" id="8333507">,</span>&nbsp;<span class="ident" id="8333509">src</span><span class="op" id="8333512">,</span>&nbsp;<span class="ident" id="8333514">parser</span><span class="op" id="8333520">.</span><span class="ident" id="8333521">ParseComments</span><span class="op" id="8333534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333537">if</span>&nbsp;<span class="ident" id="8333540">err</span>&nbsp;<span class="op" id="8333544">!=</span>&nbsp;<span class="ident" id="8333547">nil</span>&nbsp;<span class="op" id="8333551">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333555">return</span>&nbsp;<span class="ident" id="8333562">nil</span><span class="op" id="8333565">,</span>&nbsp;<span class="ident" id="8333567">fmt</span><span class="op" id="8333570">.</span><span class="ident" id="8333571">Errorf</span><span class="op" id="8333577">(</span><span class="string" id="8333578">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8333593">,</span>&nbsp;<span class="ident" id="8333595">err</span><span class="op" id="8333598">,</span>&nbsp;<span class="ident" id="8333600">src</span><span class="op" id="8333603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8333610">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333642">if</span>&nbsp;<span class="ident" id="8333645">mode</span><span class="op" id="8333649">&amp;</span><span class="ident" id="8333650">export</span>&nbsp;<span class="op" id="8333657">!=</span>&nbsp;<span class="num" id="8333660">0</span>&nbsp;<span class="op" id="8333662">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333666">ast</span><span class="op" id="8333669">.</span><span class="ident" id="8333670">FileExports</span><span class="op" id="8333681">(</span><span class="ident" id="8333682">f</span><span class="op" id="8333683">)</span>&nbsp;<span class="comment" id="8333685">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333704">f</span><span class="op" id="8333705">.</span><span class="ident" id="8333706">Comments</span>&nbsp;<span class="op" id="8333715">=</span>&nbsp;<span class="ident" id="8333717">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8333723">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8333772">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333808">cfg</span>&nbsp;<span class="op" id="8333812">:=</span>&nbsp;<span class="ident" id="8333815">Config</span><span class="op" id="8333821">{</span><span class="ident" id="8333822">Tabwidth</span><span class="op" id="8333830">:</span>&nbsp;<span class="ident" id="8333832">tabwidth</span><span class="op" id="8333840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333843">if</span>&nbsp;<span class="ident" id="8333846">mode</span><span class="op" id="8333850">&amp;</span><span class="ident" id="8333851">rawFormat</span>&nbsp;<span class="op" id="8333861">!=</span>&nbsp;<span class="num" id="8333864">0</span>&nbsp;<span class="op" id="8333866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333870">cfg</span><span class="op" id="8333873">.</span><span class="ident" id="8333874">Mode</span>&nbsp;<span class="op" id="8333879">|=</span>&nbsp;<span class="ident" id="8333882">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8333897">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333911">var</span>&nbsp;<span class="ident" id="8333915">buf</span>&nbsp;<span class="ident" id="8333919">bytes</span><span class="op" id="8333924">.</span><span class="ident" id="8333925">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333933">if</span>&nbsp;<span class="ident" id="8333936">err</span>&nbsp;<span class="op" id="8333940">:=</span>&nbsp;<span class="ident" id="8333943">cfg</span><span class="op" id="8333946">.</span><span class="ident" id="8333947">Fprint</span><span class="op" id="8333953">(</span><span class="op" id="8333954">&amp;</span><span class="ident" id="8333955">buf</span><span class="op" id="8333958">,</span>&nbsp;<span class="ident" id="8333960">fset</span><span class="op" id="8333964">,</span>&nbsp;<span class="ident" id="8333966">f</span><span class="op" id="8333967">)</span><span class="op" id="8333968">;</span>&nbsp;<span class="ident" id="8333970">err</span>&nbsp;<span class="op" id="8333974">!=</span>&nbsp;<span class="ident" id="8333977">nil</span>&nbsp;<span class="op" id="8333981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333985">return</span>&nbsp;<span class="ident" id="8333992">nil</span><span class="op" id="8333995">,</span>&nbsp;<span class="ident" id="8333997">fmt</span><span class="op" id="8334000">.</span><span class="ident" id="8334001">Errorf</span><span class="op" id="8334007">(</span><span class="string" id="8334008">&#34;print:&nbsp;%s&#34;</span><span class="op" id="8334019">,</span>&nbsp;<span class="ident" id="8334021">err</span><span class="op" id="8334024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334027">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8334031">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334087">res</span>&nbsp;<span class="op" id="8334091">:=</span>&nbsp;<span class="ident" id="8334094">buf</span><span class="op" id="8334097">.</span><span class="ident" id="8334098">Bytes</span><span class="op" id="8334103">(</span><span class="op" id="8334104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334107">if</span>&nbsp;<span class="ident" id="8334110">_</span><span class="op" id="8334111">,</span>&nbsp;<span class="ident" id="8334113">err</span>&nbsp;<span class="op" id="8334117">:=</span>&nbsp;<span class="ident" id="8334120">parser</span><span class="op" id="8334126">.</span><span class="ident" id="8334127">ParseFile</span><span class="op" id="8334136">(</span><span class="ident" id="8334137">fset</span><span class="op" id="8334141">,</span>&nbsp;<span class="string" id="8334143">&#34;&#34;</span><span class="op" id="8334145">,</span>&nbsp;<span class="ident" id="8334147">res</span><span class="op" id="8334150">,</span>&nbsp;<span class="num" id="8334152">0</span><span class="op" id="8334153">)</span><span class="op" id="8334154">;</span>&nbsp;<span class="ident" id="8334156">err</span>&nbsp;<span class="op" id="8334160">!=</span>&nbsp;<span class="ident" id="8334163">nil</span>&nbsp;<span class="op" id="8334167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334171">return</span>&nbsp;<span class="ident" id="8334178">nil</span><span class="op" id="8334181">,</span>&nbsp;<span class="ident" id="8334183">fmt</span><span class="op" id="8334186">.</span><span class="ident" id="8334187">Errorf</span><span class="op" id="8334193">(</span><span class="string" id="8334194">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8334212">,</span>&nbsp;<span class="ident" id="8334214">err</span><span class="op" id="8334217">,</span>&nbsp;<span class="ident" id="8334219">buf</span><span class="op" id="8334222">.</span><span class="ident" id="8334223">Bytes</span><span class="op" id="8334228">(</span><span class="op" id="8334229">)</span><span class="op" id="8334230">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334237">return</span>&nbsp;<span class="ident" id="8334244">res</span><span class="op" id="8334247">,</span>&nbsp;<span class="ident" id="8334249">nil</span><br>
<span class="lineno"></span><span class="op" id="8334253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="8334256">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="8334316">func</span>&nbsp;<span class="ident" id="8334321">lineAt</span><span class="op" id="8334327">(</span><span class="ident" id="8334328">text</span>&nbsp;<span class="op" id="8334333">[</span><span class="op" id="8334334">]</span><span class="builtintype" id="8334335">byte</span><span class="op" id="8334339">,</span>&nbsp;<span class="ident" id="8334341">offs</span>&nbsp;<span class="builtintype" id="8334346">int</span><span class="op" id="8334349">)</span>&nbsp;<span class="op" id="8334351">[</span><span class="op" id="8334352">]</span><span class="builtintype" id="8334353">byte</span>&nbsp;<span class="op" id="8334358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334361">i</span>&nbsp;<span class="op" id="8334363">:=</span>&nbsp;<span class="ident" id="8334366">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334372">for</span>&nbsp;<span class="ident" id="8334376">i</span>&nbsp;<span class="op" id="8334378">&lt;</span>&nbsp;<span class="builtinfunc" id="8334380">len</span><span class="op" id="8334383">(</span><span class="ident" id="8334384">text</span><span class="op" id="8334388">)</span>&nbsp;<span class="op" id="8334390">&amp;&amp;</span>&nbsp;<span class="ident" id="8334393">text</span><span class="op" id="8334397">[</span><span class="ident" id="8334398">i</span><span class="op" id="8334399">]</span>&nbsp;<span class="op" id="8334401">!=</span>&nbsp;<span class="string" id="8334404">&#39;\n&#39;</span>&nbsp;<span class="op" id="8334409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334413">i</span><span class="op" id="8334414">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334421">return</span>&nbsp;<span class="ident" id="8334428">text</span><span class="op" id="8334432">[</span><span class="ident" id="8334433">offs</span><span class="op" id="8334437">:</span><span class="ident" id="8334438">i</span><span class="op" id="8334439">]</span><br>
<span class="lineno"></span><span class="op" id="8334441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8334444">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="8334470">func</span>&nbsp;<span class="ident" id="8334475">diff</span><span class="op" id="8334479">(</span><span class="ident" id="8334480">aname</span><span class="op" id="8334485">,</span>&nbsp;<span class="ident" id="8334487">bname</span>&nbsp;<span class="builtintype" id="8334493">string</span><span class="op" id="8334499">,</span>&nbsp;<span class="ident" id="8334501">a</span><span class="op" id="8334502">,</span>&nbsp;<span class="ident" id="8334504">b</span>&nbsp;<span class="op" id="8334506">[</span><span class="op" id="8334507">]</span><span class="builtintype" id="8334508">byte</span><span class="op" id="8334512">)</span>&nbsp;<span class="builtintype" id="8334514">error</span>&nbsp;<span class="op" id="8334520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334523">var</span>&nbsp;<span class="ident" id="8334527">buf</span>&nbsp;<span class="ident" id="8334531">bytes</span><span class="op" id="8334536">.</span><span class="ident" id="8334537">Buffer</span>&nbsp;<span class="comment" id="8334544">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8334576">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334596">if</span>&nbsp;<span class="builtinfunc" id="8334599">len</span><span class="op" id="8334602">(</span><span class="ident" id="8334603">a</span><span class="op" id="8334604">)</span>&nbsp;<span class="op" id="8334606">!=</span>&nbsp;<span class="builtinfunc" id="8334609">len</span><span class="op" id="8334612">(</span><span class="ident" id="8334613">b</span><span class="op" id="8334614">)</span>&nbsp;<span class="op" id="8334616">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334620">fmt</span><span class="op" id="8334623">.</span><span class="ident" id="8334624">Fprintf</span><span class="op" id="8334631">(</span><span class="op" id="8334632">&amp;</span><span class="ident" id="8334633">buf</span><span class="op" id="8334636">,</span>&nbsp;<span class="string" id="8334638">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8334684">,</span>&nbsp;<span class="ident" id="8334686">aname</span><span class="op" id="8334691">,</span>&nbsp;<span class="builtinfunc" id="8334693">len</span><span class="op" id="8334696">(</span><span class="ident" id="8334697">a</span><span class="op" id="8334698">)</span><span class="op" id="8334699">,</span>&nbsp;<span class="ident" id="8334701">bname</span><span class="op" id="8334706">,</span>&nbsp;<span class="builtinfunc" id="8334708">len</span><span class="op" id="8334711">(</span><span class="ident" id="8334712">b</span><span class="op" id="8334713">)</span><span class="op" id="8334714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8334721">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334742">line</span>&nbsp;<span class="op" id="8334747">:=</span>&nbsp;<span class="num" id="8334750">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334753">offs</span>&nbsp;<span class="op" id="8334758">:=</span>&nbsp;<span class="num" id="8334761">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334764">for</span>&nbsp;<span class="ident" id="8334768">i</span>&nbsp;<span class="op" id="8334770">:=</span>&nbsp;<span class="num" id="8334773">0</span><span class="op" id="8334774">;</span>&nbsp;<span class="ident" id="8334776">i</span>&nbsp;<span class="op" id="8334778">&lt;</span>&nbsp;<span class="builtinfunc" id="8334780">len</span><span class="op" id="8334783">(</span><span class="ident" id="8334784">a</span><span class="op" id="8334785">)</span>&nbsp;<span class="op" id="8334787">&amp;&amp;</span>&nbsp;<span class="ident" id="8334790">i</span>&nbsp;<span class="op" id="8334792">&lt;</span>&nbsp;<span class="builtinfunc" id="8334794">len</span><span class="op" id="8334797">(</span><span class="ident" id="8334798">b</span><span class="op" id="8334799">)</span><span class="op" id="8334800">;</span>&nbsp;<span class="ident" id="8334802">i</span><span class="op" id="8334803">++</span>&nbsp;<span class="op" id="8334806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334810">ch</span>&nbsp;<span class="op" id="8334813">:=</span>&nbsp;<span class="ident" id="8334816">a</span><span class="op" id="8334817">[</span><span class="ident" id="8334818">i</span><span class="op" id="8334819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334823">if</span>&nbsp;<span class="ident" id="8334826">ch</span>&nbsp;<span class="op" id="8334829">!=</span>&nbsp;<span class="ident" id="8334832">b</span><span class="op" id="8334833">[</span><span class="ident" id="8334834">i</span><span class="op" id="8334835">]</span>&nbsp;<span class="op" id="8334837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334842">fmt</span><span class="op" id="8334845">.</span><span class="ident" id="8334846">Fprintf</span><span class="op" id="8334853">(</span><span class="op" id="8334854">&amp;</span><span class="ident" id="8334855">buf</span><span class="op" id="8334858">,</span>&nbsp;<span class="string" id="8334860">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8334876">,</span>&nbsp;<span class="ident" id="8334878">aname</span><span class="op" id="8334883">,</span>&nbsp;<span class="ident" id="8334885">line</span><span class="op" id="8334889">,</span>&nbsp;<span class="ident" id="8334891">i</span><span class="op" id="8334892">-</span><span class="ident" id="8334893">offs</span><span class="op" id="8334897">+</span><span class="num" id="8334898">1</span><span class="op" id="8334899">,</span>&nbsp;<span class="ident" id="8334901">lineAt</span><span class="op" id="8334907">(</span><span class="ident" id="8334908">a</span><span class="op" id="8334909">,</span>&nbsp;<span class="ident" id="8334911">offs</span><span class="op" id="8334915">)</span><span class="op" id="8334916">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334921">fmt</span><span class="op" id="8334924">.</span><span class="ident" id="8334925">Fprintf</span><span class="op" id="8334932">(</span><span class="op" id="8334933">&amp;</span><span class="ident" id="8334934">buf</span><span class="op" id="8334937">,</span>&nbsp;<span class="string" id="8334939">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8334955">,</span>&nbsp;<span class="ident" id="8334957">bname</span><span class="op" id="8334962">,</span>&nbsp;<span class="ident" id="8334964">line</span><span class="op" id="8334968">,</span>&nbsp;<span class="ident" id="8334970">i</span><span class="op" id="8334971">-</span><span class="ident" id="8334972">offs</span><span class="op" id="8334976">+</span><span class="num" id="8334977">1</span><span class="op" id="8334978">,</span>&nbsp;<span class="ident" id="8334980">lineAt</span><span class="op" id="8334986">(</span><span class="ident" id="8334987">b</span><span class="op" id="8334988">,</span>&nbsp;<span class="ident" id="8334990">offs</span><span class="op" id="8334994">)</span><span class="op" id="8334995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335000">fmt</span><span class="op" id="8335003">.</span><span class="ident" id="8335004">Fprintf</span><span class="op" id="8335011">(</span><span class="op" id="8335012">&amp;</span><span class="ident" id="8335013">buf</span><span class="op" id="8335016">,</span>&nbsp;<span class="string" id="8335018">&#34;\n\n&#34;</span><span class="op" id="8335024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335029">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335041">if</span>&nbsp;<span class="ident" id="8335044">ch</span>&nbsp;<span class="op" id="8335047">==</span>&nbsp;<span class="string" id="8335050">&#39;\n&#39;</span>&nbsp;<span class="op" id="8335055">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335060">line</span><span class="op" id="8335064">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335070">offs</span>&nbsp;<span class="op" id="8335075">=</span>&nbsp;<span class="ident" id="8335077">i</span>&nbsp;<span class="op" id="8335079">+</span>&nbsp;<span class="num" id="8335081">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335092">if</span>&nbsp;<span class="ident" id="8335095">buf</span><span class="op" id="8335098">.</span><span class="ident" id="8335099">Len</span><span class="op" id="8335102">(</span><span class="op" id="8335103">)</span>&nbsp;<span class="op" id="8335105">&gt;</span>&nbsp;<span class="num" id="8335107">0</span>&nbsp;<span class="op" id="8335109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335113">return</span>&nbsp;<span class="ident" id="8335120">errors</span><span class="op" id="8335126">.</span><span class="ident" id="8335127">New</span><span class="op" id="8335130">(</span><span class="ident" id="8335131">buf</span><span class="op" id="8335134">.</span><span class="ident" id="8335135">String</span><span class="op" id="8335141">(</span><span class="op" id="8335142">)</span><span class="op" id="8335143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335149">return</span>&nbsp;<span class="ident" id="8335156">nil</span><br>
<span class="lineno"></span><span class="op" id="8335160">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8335163">func</span>&nbsp;<span class="ident" id="8335168">runcheck</span><span class="op" id="8335176">(</span><span class="ident" id="8335177">t</span>&nbsp;<span class="op" id="8335179">*</span><span class="ident" id="8335180">testing</span><span class="op" id="8335187">.</span><span class="ident" id="8335188">T</span><span class="op" id="8335189">,</span>&nbsp;<span class="ident" id="8335191">source</span><span class="op" id="8335197">,</span>&nbsp;<span class="ident" id="8335199">golden</span>&nbsp;<span class="builtintype" id="8335206">string</span><span class="op" id="8335212">,</span>&nbsp;<span class="ident" id="8335214">mode</span>&nbsp;<span class="ident" id="8335219">checkMode</span><span class="op" id="8335228">)</span>&nbsp;<span class="op" id="8335230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335233">src</span><span class="op" id="8335236">,</span>&nbsp;<span class="ident" id="8335238">err</span>&nbsp;<span class="op" id="8335242">:=</span>&nbsp;<span class="ident" id="8335245">ioutil</span><span class="op" id="8335251">.</span><span class="ident" id="8335252">ReadFile</span><span class="op" id="8335260">(</span><span class="ident" id="8335261">source</span><span class="op" id="8335267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335270">if</span>&nbsp;<span class="ident" id="8335273">err</span>&nbsp;<span class="op" id="8335277">!=</span>&nbsp;<span class="ident" id="8335280">nil</span>&nbsp;<span class="op" id="8335284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335288">t</span><span class="op" id="8335289">.</span><span class="ident" id="8335290">Error</span><span class="op" id="8335295">(</span><span class="ident" id="8335296">err</span><span class="op" id="8335299">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335303">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335315">res</span><span class="op" id="8335318">,</span>&nbsp;<span class="ident" id="8335320">err</span>&nbsp;<span class="op" id="8335324">:=</span>&nbsp;<span class="ident" id="8335327">format</span><span class="op" id="8335333">(</span><span class="ident" id="8335334">src</span><span class="op" id="8335337">,</span>&nbsp;<span class="ident" id="8335339">mode</span><span class="op" id="8335343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335346">if</span>&nbsp;<span class="ident" id="8335349">err</span>&nbsp;<span class="op" id="8335353">!=</span>&nbsp;<span class="ident" id="8335356">nil</span>&nbsp;<span class="op" id="8335360">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335364">t</span><span class="op" id="8335365">.</span><span class="ident" id="8335366">Error</span><span class="op" id="8335371">(</span><span class="ident" id="8335372">err</span><span class="op" id="8335375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335379">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335391">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335428">if</span>&nbsp;<span class="op" id="8335431">*</span><span class="ident" id="8335432">update</span>&nbsp;<span class="op" id="8335439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335443">if</span>&nbsp;<span class="ident" id="8335446">err</span>&nbsp;<span class="op" id="8335450">:=</span>&nbsp;<span class="ident" id="8335453">ioutil</span><span class="op" id="8335459">.</span><span class="ident" id="8335460">WriteFile</span><span class="op" id="8335469">(</span><span class="ident" id="8335470">golden</span><span class="op" id="8335476">,</span>&nbsp;<span class="ident" id="8335478">res</span><span class="op" id="8335481">,</span>&nbsp;<span class="num" id="8335483">0644</span><span class="op" id="8335487">)</span><span class="op" id="8335488">;</span>&nbsp;<span class="ident" id="8335490">err</span>&nbsp;<span class="op" id="8335494">!=</span>&nbsp;<span class="ident" id="8335497">nil</span>&nbsp;<span class="op" id="8335501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335506">t</span><span class="op" id="8335507">.</span><span class="ident" id="8335508">Error</span><span class="op" id="8335513">(</span><span class="ident" id="8335514">err</span><span class="op" id="8335517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335525">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335537">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335552">gld</span><span class="op" id="8335555">,</span>&nbsp;<span class="ident" id="8335557">err</span>&nbsp;<span class="op" id="8335561">:=</span>&nbsp;<span class="ident" id="8335564">ioutil</span><span class="op" id="8335570">.</span><span class="ident" id="8335571">ReadFile</span><span class="op" id="8335579">(</span><span class="ident" id="8335580">golden</span><span class="op" id="8335586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335589">if</span>&nbsp;<span class="ident" id="8335592">err</span>&nbsp;<span class="op" id="8335596">!=</span>&nbsp;<span class="ident" id="8335599">nil</span>&nbsp;<span class="op" id="8335603">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335607">t</span><span class="op" id="8335608">.</span><span class="ident" id="8335609">Error</span><span class="op" id="8335614">(</span><span class="ident" id="8335615">err</span><span class="op" id="8335618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335622">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335634">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335683">if</span>&nbsp;<span class="ident" id="8335686">err</span>&nbsp;<span class="op" id="8335690">:=</span>&nbsp;<span class="ident" id="8335693">diff</span><span class="op" id="8335697">(</span><span class="ident" id="8335698">source</span><span class="op" id="8335704">,</span>&nbsp;<span class="ident" id="8335706">golden</span><span class="op" id="8335712">,</span>&nbsp;<span class="ident" id="8335714">res</span><span class="op" id="8335717">,</span>&nbsp;<span class="ident" id="8335719">gld</span><span class="op" id="8335722">)</span><span class="op" id="8335723">;</span>&nbsp;<span class="ident" id="8335725">err</span>&nbsp;<span class="op" id="8335729">!=</span>&nbsp;<span class="ident" id="8335732">nil</span>&nbsp;<span class="op" id="8335736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335740">t</span><span class="op" id="8335741">.</span><span class="ident" id="8335742">Error</span><span class="op" id="8335747">(</span><span class="ident" id="8335748">err</span><span class="op" id="8335751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335755">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335767">if</span>&nbsp;<span class="ident" id="8335770">mode</span><span class="op" id="8335774">&amp;</span><span class="ident" id="8335775">idempotent</span>&nbsp;<span class="op" id="8335786">!=</span>&nbsp;<span class="num" id="8335789">0</span>&nbsp;<span class="op" id="8335791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335795">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335837">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335900">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335962">res</span><span class="op" id="8335965">,</span>&nbsp;<span class="ident" id="8335967">err</span>&nbsp;<span class="op" id="8335971">=</span>&nbsp;<span class="ident" id="8335973">format</span><span class="op" id="8335979">(</span><span class="ident" id="8335980">gld</span><span class="op" id="8335983">,</span>&nbsp;<span class="ident" id="8335985">mode</span><span class="op" id="8335989">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335993">if</span>&nbsp;<span class="ident" id="8335996">err</span>&nbsp;<span class="op" id="8336000">:=</span>&nbsp;<span class="ident" id="8336003">diff</span><span class="op" id="8336007">(</span><span class="ident" id="8336008">golden</span><span class="op" id="8336014">,</span>&nbsp;<span class="ident" id="8336016">fmt</span><span class="op" id="8336019">.</span><span class="ident" id="8336020">Sprintf</span><span class="op" id="8336027">(</span><span class="string" id="8336028">&#34;format(%s)&#34;</span><span class="op" id="8336040">,</span>&nbsp;<span class="ident" id="8336042">golden</span><span class="op" id="8336048">)</span><span class="op" id="8336049">,</span>&nbsp;<span class="ident" id="8336051">gld</span><span class="op" id="8336054">,</span>&nbsp;<span class="ident" id="8336056">res</span><span class="op" id="8336059">)</span><span class="op" id="8336060">;</span>&nbsp;<span class="ident" id="8336062">err</span>&nbsp;<span class="op" id="8336066">!=</span>&nbsp;<span class="ident" id="8336069">nil</span>&nbsp;<span class="op" id="8336073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336078">t</span><span class="op" id="8336079">.</span><span class="ident" id="8336080">Errorf</span><span class="op" id="8336086">(</span><span class="string" id="8336087">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="8336117">,</span>&nbsp;<span class="ident" id="8336119">err</span><span class="op" id="8336122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336129">}</span><br>
<span class="lineno"></span><span class="op" id="8336131">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8336134">func</span>&nbsp;<span class="ident" id="8336139">check</span><span class="op" id="8336144">(</span><span class="ident" id="8336145">t</span>&nbsp;<span class="op" id="8336147">*</span><span class="ident" id="8336148">testing</span><span class="op" id="8336155">.</span><span class="ident" id="8336156">T</span><span class="op" id="8336157">,</span>&nbsp;<span class="ident" id="8336159">source</span><span class="op" id="8336165">,</span>&nbsp;<span class="ident" id="8336167">golden</span>&nbsp;<span class="builtintype" id="8336174">string</span><span class="op" id="8336180">,</span>&nbsp;<span class="ident" id="8336182">mode</span>&nbsp;<span class="ident" id="8336187">checkMode</span><span class="op" id="8336196">)</span>&nbsp;<span class="op" id="8336198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8336201">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336218">cc</span>&nbsp;<span class="op" id="8336221">:=</span>&nbsp;<span class="builtinfunc" id="8336224">make</span><span class="op" id="8336228">(</span><span class="keyword" id="8336229">chan</span>&nbsp;<span class="builtintype" id="8336234">int</span><span class="op" id="8336237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336240">go</span>&nbsp;<span class="keyword" id="8336243">func</span><span class="op" id="8336247">(</span><span class="op" id="8336248">)</span>&nbsp;<span class="op" id="8336250">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336254">runcheck</span><span class="op" id="8336262">(</span><span class="ident" id="8336263">t</span><span class="op" id="8336264">,</span>&nbsp;<span class="ident" id="8336266">source</span><span class="op" id="8336272">,</span>&nbsp;<span class="ident" id="8336274">golden</span><span class="op" id="8336280">,</span>&nbsp;<span class="ident" id="8336282">mode</span><span class="op" id="8336286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336290">cc</span>&nbsp;<span class="op" id="8336293">&lt;-</span>&nbsp;<span class="num" id="8336296">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336299">}</span><span class="op" id="8336300">(</span><span class="op" id="8336301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8336305">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336327">select</span>&nbsp;<span class="op" id="8336334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336337">case</span>&nbsp;<span class="op" id="8336342">&lt;-</span><span class="ident" id="8336344">time</span><span class="op" id="8336348">.</span><span class="ident" id="8336349">After</span><span class="op" id="8336354">(</span><span class="num" id="8336355">10</span>&nbsp;<span class="op" id="8336358">*</span>&nbsp;<span class="ident" id="8336360">time</span><span class="op" id="8336364">.</span><span class="ident" id="8336365">Second</span><span class="op" id="8336371">)</span><span class="op" id="8336372">:</span>&nbsp;<span class="comment" id="8336374">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8336434">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336466">t</span><span class="op" id="8336467">.</span><span class="ident" id="8336468">Errorf</span><span class="op" id="8336474">(</span><span class="string" id="8336475">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="8336499">,</span>&nbsp;<span class="ident" id="8336501">source</span><span class="op" id="8336507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336510">case</span>&nbsp;<span class="op" id="8336515">&lt;-</span><span class="ident" id="8336517">cc</span><span class="op" id="8336519">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8336523">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336569">}</span><br>
<span class="lineno"></span><span class="op" id="8336571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336574">type</span>&nbsp;<span class="ident" id="8336579">entry</span>&nbsp;<span class="keyword" id="8336585">struct</span>&nbsp;<span class="op" id="8336592">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336595">source</span><span class="op" id="8336601">,</span>&nbsp;<span class="ident" id="8336603">golden</span>&nbsp;<span class="builtintype" id="8336610">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336618">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8336633">checkMode</span><br>
<span class="lineno"></span><span class="op" id="8336643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8336646">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="8336715">var</span>&nbsp;<span class="ident" id="8336719">data</span>&nbsp;<span class="op" id="8336724">=</span>&nbsp;<span class="op" id="8336726">[</span><span class="op" id="8336727">]</span><span class="ident" id="8336728">entry</span><span class="op" id="8336733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336736">{</span><span class="string" id="8336737">&#34;empty.input&#34;</span><span class="op" id="8336750">,</span>&nbsp;<span class="string" id="8336752">&#34;empty.golden&#34;</span><span class="op" id="8336766">,</span>&nbsp;<span class="ident" id="8336768">idempotent</span><span class="op" id="8336778">}</span><span class="op" id="8336779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336782">{</span><span class="string" id="8336783">&#34;comments.input&#34;</span><span class="op" id="8336799">,</span>&nbsp;<span class="string" id="8336801">&#34;comments.golden&#34;</span><span class="op" id="8336818">,</span>&nbsp;<span class="num" id="8336820">0</span><span class="op" id="8336821">}</span><span class="op" id="8336822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336825">{</span><span class="string" id="8336826">&#34;comments.input&#34;</span><span class="op" id="8336842">,</span>&nbsp;<span class="string" id="8336844">&#34;comments.x&#34;</span><span class="op" id="8336856">,</span>&nbsp;<span class="ident" id="8336858">export</span><span class="op" id="8336864">}</span><span class="op" id="8336865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336868">{</span><span class="string" id="8336869">&#34;comments2.input&#34;</span><span class="op" id="8336886">,</span>&nbsp;<span class="string" id="8336888">&#34;comments2.golden&#34;</span><span class="op" id="8336906">,</span>&nbsp;<span class="ident" id="8336908">idempotent</span><span class="op" id="8336918">}</span><span class="op" id="8336919">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336922">{</span><span class="string" id="8336923">&#34;linebreaks.input&#34;</span><span class="op" id="8336941">,</span>&nbsp;<span class="string" id="8336943">&#34;linebreaks.golden&#34;</span><span class="op" id="8336962">,</span>&nbsp;<span class="ident" id="8336964">idempotent</span><span class="op" id="8336974">}</span><span class="op" id="8336975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336978">{</span><span class="string" id="8336979">&#34;expressions.input&#34;</span><span class="op" id="8336998">,</span>&nbsp;<span class="string" id="8337000">&#34;expressions.golden&#34;</span><span class="op" id="8337020">,</span>&nbsp;<span class="ident" id="8337022">idempotent</span><span class="op" id="8337032">}</span><span class="op" id="8337033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337036">{</span><span class="string" id="8337037">&#34;expressions.input&#34;</span><span class="op" id="8337056">,</span>&nbsp;<span class="string" id="8337058">&#34;expressions.raw&#34;</span><span class="op" id="8337075">,</span>&nbsp;<span class="ident" id="8337077">rawFormat</span>&nbsp;<span class="op" id="8337087">|</span>&nbsp;<span class="ident" id="8337089">idempotent</span><span class="op" id="8337099">}</span><span class="op" id="8337100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337103">{</span><span class="string" id="8337104">&#34;declarations.input&#34;</span><span class="op" id="8337124">,</span>&nbsp;<span class="string" id="8337126">&#34;declarations.golden&#34;</span><span class="op" id="8337147">,</span>&nbsp;<span class="num" id="8337149">0</span><span class="op" id="8337150">}</span><span class="op" id="8337151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337154">{</span><span class="string" id="8337155">&#34;statements.input&#34;</span><span class="op" id="8337173">,</span>&nbsp;<span class="string" id="8337175">&#34;statements.golden&#34;</span><span class="op" id="8337194">,</span>&nbsp;<span class="num" id="8337196">0</span><span class="op" id="8337197">}</span><span class="op" id="8337198">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337201">{</span><span class="string" id="8337202">&#34;slow.input&#34;</span><span class="op" id="8337214">,</span>&nbsp;<span class="string" id="8337216">&#34;slow.golden&#34;</span><span class="op" id="8337229">,</span>&nbsp;<span class="ident" id="8337231">idempotent</span><span class="op" id="8337241">}</span><span class="op" id="8337242">,</span><br>
<span class="lineno"></span><span class="op" id="8337244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337247">func</span>&nbsp;<span class="ident" id="8337252">TestFiles</span><span class="op" id="8337261">(</span><span class="ident" id="8337262">t</span>&nbsp;<span class="op" id="8337264">*</span><span class="ident" id="8337265">testing</span><span class="op" id="8337272">.</span><span class="ident" id="8337273">T</span><span class="op" id="8337274">)</span>&nbsp;<span class="op" id="8337276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337279">for</span>&nbsp;<span class="ident" id="8337283">_</span><span class="op" id="8337284">,</span>&nbsp;<span class="ident" id="8337286">e</span>&nbsp;<span class="op" id="8337288">:=</span>&nbsp;<span class="keyword" id="8337291">range</span>&nbsp;<span class="ident" id="8337297">data</span>&nbsp;<span class="op" id="8337302">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337306">source</span>&nbsp;<span class="op" id="8337313">:=</span>&nbsp;<span class="ident" id="8337316">filepath</span><span class="op" id="8337324">.</span><span class="ident" id="8337325">Join</span><span class="op" id="8337329">(</span><span class="ident" id="8337330">dataDir</span><span class="op" id="8337337">,</span>&nbsp;<span class="ident" id="8337339">e</span><span class="op" id="8337340">.</span><span class="ident" id="8337341">source</span><span class="op" id="8337347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337351">golden</span>&nbsp;<span class="op" id="8337358">:=</span>&nbsp;<span class="ident" id="8337361">filepath</span><span class="op" id="8337369">.</span><span class="ident" id="8337370">Join</span><span class="op" id="8337374">(</span><span class="ident" id="8337375">dataDir</span><span class="op" id="8337382">,</span>&nbsp;<span class="ident" id="8337384">e</span><span class="op" id="8337385">.</span><span class="ident" id="8337386">golden</span><span class="op" id="8337392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337396">check</span><span class="op" id="8337401">(</span><span class="ident" id="8337402">t</span><span class="op" id="8337403">,</span>&nbsp;<span class="ident" id="8337405">source</span><span class="op" id="8337411">,</span>&nbsp;<span class="ident" id="8337413">golden</span><span class="op" id="8337419">,</span>&nbsp;<span class="ident" id="8337421">e</span><span class="op" id="8337422">.</span><span class="ident" id="8337423">mode</span><span class="op" id="8337427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8337431">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8337478">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337514">}</span><br>
<span class="lineno"></span><span class="op" id="8337516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8337519">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="8337595">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="8337671">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="8337700">//</span><br>
<span class="lineno"></span><span class="keyword" id="8337703">func</span>&nbsp;<span class="ident" id="8337708">TestLineComments</span><span class="op" id="8337724">(</span><span class="ident" id="8337725">t</span>&nbsp;<span class="op" id="8337727">*</span><span class="ident" id="8337728">testing</span><span class="op" id="8337735">.</span><span class="ident" id="8337736">T</span><span class="op" id="8337737">)</span>&nbsp;<span class="op" id="8337739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337742">const</span>&nbsp;<span class="ident" id="8337748">src</span>&nbsp;<span class="op" id="8337752">=</span>&nbsp;<span class="string" id="8337754">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337815">fset</span>&nbsp;<span class="op" id="8337820">:=</span>&nbsp;<span class="ident" id="8337823">token</span><span class="op" id="8337828">.</span><span class="ident" id="8337829">NewFileSet</span><span class="op" id="8337839">(</span><span class="op" id="8337840">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337843">f</span><span class="op" id="8337844">,</span>&nbsp;<span class="ident" id="8337846">err</span>&nbsp;<span class="op" id="8337850">:=</span>&nbsp;<span class="ident" id="8337853">parser</span><span class="op" id="8337859">.</span><span class="ident" id="8337860">ParseFile</span><span class="op" id="8337869">(</span><span class="ident" id="8337870">fset</span><span class="op" id="8337874">,</span>&nbsp;<span class="string" id="8337876">&#34;&#34;</span><span class="op" id="8337878">,</span>&nbsp;<span class="ident" id="8337880">src</span><span class="op" id="8337883">,</span>&nbsp;<span class="ident" id="8337885">parser</span><span class="op" id="8337891">.</span><span class="ident" id="8337892">ParseComments</span><span class="op" id="8337905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337908">if</span>&nbsp;<span class="ident" id="8337911">err</span>&nbsp;<span class="op" id="8337915">!=</span>&nbsp;<span class="ident" id="8337918">nil</span>&nbsp;<span class="op" id="8337922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8337926">panic</span><span class="op" id="8337931">(</span><span class="ident" id="8337932">err</span><span class="op" id="8337935">)</span>&nbsp;<span class="comment" id="8337937">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337959">var</span>&nbsp;<span class="ident" id="8337963">buf</span>&nbsp;<span class="ident" id="8337967">bytes</span><span class="op" id="8337972">.</span><span class="ident" id="8337973">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337981">fset</span>&nbsp;<span class="op" id="8337986">=</span>&nbsp;<span class="ident" id="8337988">token</span><span class="op" id="8337993">.</span><span class="ident" id="8337994">NewFileSet</span><span class="op" id="8338004">(</span><span class="op" id="8338005">)</span>&nbsp;<span class="comment" id="8338007">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338034">Fprint</span><span class="op" id="8338040">(</span><span class="op" id="8338041">&amp;</span><span class="ident" id="8338042">buf</span><span class="op" id="8338045">,</span>&nbsp;<span class="ident" id="8338047">fset</span><span class="op" id="8338051">,</span>&nbsp;<span class="ident" id="8338053">f</span><span class="op" id="8338054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338058">nlines</span>&nbsp;<span class="op" id="8338065">:=</span>&nbsp;<span class="num" id="8338068">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338071">for</span>&nbsp;<span class="ident" id="8338075">_</span><span class="op" id="8338076">,</span>&nbsp;<span class="ident" id="8338078">ch</span>&nbsp;<span class="op" id="8338081">:=</span>&nbsp;<span class="keyword" id="8338084">range</span>&nbsp;<span class="ident" id="8338090">buf</span><span class="op" id="8338093">.</span><span class="ident" id="8338094">Bytes</span><span class="op" id="8338099">(</span><span class="op" id="8338100">)</span>&nbsp;<span class="op" id="8338102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338106">if</span>&nbsp;<span class="ident" id="8338109">ch</span>&nbsp;<span class="op" id="8338112">==</span>&nbsp;<span class="string" id="8338115">&#39;\n&#39;</span>&nbsp;<span class="op" id="8338120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338125">nlines</span><span class="op" id="8338131">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338139">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338143">const</span>&nbsp;<span class="ident" id="8338149">expected</span>&nbsp;<span class="op" id="8338158">=</span>&nbsp;<span class="num" id="8338160">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338163">if</span>&nbsp;<span class="ident" id="8338166">nlines</span>&nbsp;<span class="op" id="8338173">&lt;</span>&nbsp;<span class="ident" id="8338175">expected</span>&nbsp;<span class="op" id="8338184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338188">t</span><span class="op" id="8338189">.</span><span class="ident" id="8338190">Errorf</span><span class="op" id="8338196">(</span><span class="string" id="8338197">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="8338220">,</span>&nbsp;<span class="ident" id="8338222">nlines</span><span class="op" id="8338228">,</span>&nbsp;<span class="ident" id="8338230">expected</span><span class="op" id="8338238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338242">t</span><span class="op" id="8338243">.</span><span class="ident" id="8338244">Errorf</span><span class="op" id="8338250">(</span><span class="string" id="8338251">&#34;result:\n%s&#34;</span><span class="op" id="8338264">,</span>&nbsp;<span class="ident" id="8338266">buf</span><span class="op" id="8338269">.</span><span class="ident" id="8338270">Bytes</span><span class="op" id="8338275">(</span><span class="op" id="8338276">)</span><span class="op" id="8338277">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338280">}</span><br>
<span class="lineno"></span><span class="op" id="8338282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8338285">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="8338350">func</span>&nbsp;<span class="ident" id="8338355">init</span><span class="op" id="8338359">(</span><span class="op" id="8338360">)</span>&nbsp;<span class="op" id="8338362">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338365">const</span>&nbsp;<span class="ident" id="8338371">name</span>&nbsp;<span class="op" id="8338376">=</span>&nbsp;<span class="string" id="8338378">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338388">var</span>&nbsp;<span class="ident" id="8338392">buf</span>&nbsp;<span class="ident" id="8338396">bytes</span><span class="op" id="8338401">.</span><span class="ident" id="8338402">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338410">if</span>&nbsp;<span class="ident" id="8338413">err</span>&nbsp;<span class="op" id="8338417">:=</span>&nbsp;<span class="ident" id="8338420">Fprint</span><span class="op" id="8338426">(</span><span class="op" id="8338427">&amp;</span><span class="ident" id="8338428">buf</span><span class="op" id="8338431">,</span>&nbsp;<span class="ident" id="8338433">fset</span><span class="op" id="8338437">,</span>&nbsp;<span class="op" id="8338439">&amp;</span><span class="ident" id="8338440">ast</span><span class="op" id="8338443">.</span><span class="ident" id="8338444">Ident</span><span class="op" id="8338449">{</span><span class="ident" id="8338450">Name</span><span class="op" id="8338454">:</span>&nbsp;<span class="ident" id="8338456">name</span><span class="op" id="8338460">}</span><span class="op" id="8338461">)</span><span class="op" id="8338462">;</span>&nbsp;<span class="ident" id="8338464">err</span>&nbsp;<span class="op" id="8338468">!=</span>&nbsp;<span class="ident" id="8338471">nil</span>&nbsp;<span class="op" id="8338475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8338479">panic</span><span class="op" id="8338484">(</span><span class="ident" id="8338485">err</span><span class="op" id="8338488">)</span>&nbsp;<span class="comment" id="8338490">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338508">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8338511">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8338574">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338588">if</span>&nbsp;<span class="ident" id="8338591">s</span>&nbsp;<span class="op" id="8338593">:=</span>&nbsp;<span class="ident" id="8338596">buf</span><span class="op" id="8338599">.</span><span class="ident" id="8338600">String</span><span class="op" id="8338606">(</span><span class="op" id="8338607">)</span><span class="op" id="8338608">;</span>&nbsp;<span class="op" id="8338610">!</span><span class="ident" id="8338611">debug</span>&nbsp;<span class="op" id="8338617">&amp;&amp;</span>&nbsp;<span class="ident" id="8338620">s</span>&nbsp;<span class="op" id="8338622">!=</span>&nbsp;<span class="ident" id="8338625">name</span>&nbsp;<span class="op" id="8338630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8338634">panic</span><span class="op" id="8338639">(</span><span class="string" id="8338640">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="8338647">+</span>&nbsp;<span class="ident" id="8338649">s</span>&nbsp;<span class="op" id="8338651">+</span>&nbsp;<span class="string" id="8338653">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="8338663">+</span>&nbsp;<span class="ident" id="8338665">name</span><span class="op" id="8338669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338672">}</span><br>
<span class="lineno">255</span><span class="op" id="8338674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8338677">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="8338752">func</span>&nbsp;<span class="ident" id="8338757">TestBadNodes</span><span class="op" id="8338769">(</span><span class="ident" id="8338770">t</span>&nbsp;<span class="op" id="8338772">*</span><span class="ident" id="8338773">testing</span><span class="op" id="8338780">.</span><span class="ident" id="8338781">T</span><span class="op" id="8338782">)</span>&nbsp;<span class="op" id="8338784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338787">const</span>&nbsp;<span class="ident" id="8338793">src</span>&nbsp;<span class="op" id="8338797">=</span>&nbsp;<span class="string" id="8338799">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338815">const</span>&nbsp;<span class="ident" id="8338821">res</span>&nbsp;<span class="op" id="8338825">=</span>&nbsp;<span class="string" id="8338827">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338851">f</span><span class="op" id="8338852">,</span>&nbsp;<span class="ident" id="8338854">err</span>&nbsp;<span class="op" id="8338858">:=</span>&nbsp;<span class="ident" id="8338861">parser</span><span class="op" id="8338867">.</span><span class="ident" id="8338868">ParseFile</span><span class="op" id="8338877">(</span><span class="ident" id="8338878">fset</span><span class="op" id="8338882">,</span>&nbsp;<span class="string" id="8338884">&#34;&#34;</span><span class="op" id="8338886">,</span>&nbsp;<span class="ident" id="8338888">src</span><span class="op" id="8338891">,</span>&nbsp;<span class="ident" id="8338893">parser</span><span class="op" id="8338899">.</span><span class="ident" id="8338900">ParseComments</span><span class="op" id="8338913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338916">if</span>&nbsp;<span class="ident" id="8338919">err</span>&nbsp;<span class="op" id="8338923">==</span>&nbsp;<span class="ident" id="8338926">nil</span>&nbsp;<span class="op" id="8338930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338934">t</span><span class="op" id="8338935">.</span><span class="ident" id="8338936">Error</span><span class="op" id="8338941">(</span><span class="string" id="8338942">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="8338968">)</span>&nbsp;<span class="comment" id="8338970">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338988">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338991">var</span>&nbsp;<span class="ident" id="8338995">buf</span>&nbsp;<span class="ident" id="8338999">bytes</span><span class="op" id="8339004">.</span><span class="ident" id="8339005">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339013">Fprint</span><span class="op" id="8339019">(</span><span class="op" id="8339020">&amp;</span><span class="ident" id="8339021">buf</span><span class="op" id="8339024">,</span>&nbsp;<span class="ident" id="8339026">fset</span><span class="op" id="8339030">,</span>&nbsp;<span class="ident" id="8339032">f</span><span class="op" id="8339033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339036">if</span>&nbsp;<span class="ident" id="8339039">buf</span><span class="op" id="8339042">.</span><span class="ident" id="8339043">String</span><span class="op" id="8339049">(</span><span class="op" id="8339050">)</span>&nbsp;<span class="op" id="8339052">!=</span>&nbsp;<span class="ident" id="8339055">res</span>&nbsp;<span class="op" id="8339059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339063">t</span><span class="op" id="8339064">.</span><span class="ident" id="8339065">Errorf</span><span class="op" id="8339071">(</span><span class="string" id="8339072">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8339093">,</span>&nbsp;<span class="ident" id="8339095">buf</span><span class="op" id="8339098">.</span><span class="ident" id="8339099">String</span><span class="op" id="8339105">(</span><span class="op" id="8339106">)</span><span class="op" id="8339107">,</span>&nbsp;<span class="ident" id="8339109">res</span><span class="op" id="8339112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339115">}</span><br>
<span class="lineno">270</span><span class="op" id="8339117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8339120">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="8339189">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="8339261">func</span>&nbsp;<span class="ident" id="8339266">testComment</span><span class="op" id="8339277">(</span><span class="ident" id="8339278">t</span>&nbsp;<span class="op" id="8339280">*</span><span class="ident" id="8339281">testing</span><span class="op" id="8339288">.</span><span class="ident" id="8339289">T</span><span class="op" id="8339290">,</span>&nbsp;<span class="ident" id="8339292">f</span>&nbsp;<span class="op" id="8339294">*</span><span class="ident" id="8339295">ast</span><span class="op" id="8339298">.</span><span class="ident" id="8339299">File</span><span class="op" id="8339303">,</span>&nbsp;<span class="ident" id="8339305">srclen</span>&nbsp;<span class="builtintype" id="8339312">int</span><span class="op" id="8339315">,</span>&nbsp;<span class="ident" id="8339317">comment</span>&nbsp;<span class="op" id="8339325">*</span><span class="ident" id="8339326">ast</span><span class="op" id="8339329">.</span><span class="ident" id="8339330">Comment</span><span class="op" id="8339337">)</span>&nbsp;<span class="op" id="8339339">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339342">f</span><span class="op" id="8339343">.</span><span class="ident" id="8339344">Comments</span><span class="op" id="8339352">[</span><span class="num" id="8339353">0</span><span class="op" id="8339354">]</span><span class="op" id="8339355">.</span><span class="ident" id="8339356">List</span><span class="op" id="8339360">[</span><span class="num" id="8339361">0</span><span class="op" id="8339362">]</span>&nbsp;<span class="op" id="8339364">=</span>&nbsp;<span class="ident" id="8339366">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339375">var</span>&nbsp;<span class="ident" id="8339379">buf</span>&nbsp;<span class="ident" id="8339383">bytes</span><span class="op" id="8339388">.</span><span class="ident" id="8339389">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339397">for</span>&nbsp;<span class="ident" id="8339401">offs</span>&nbsp;<span class="op" id="8339406">:=</span>&nbsp;<span class="num" id="8339409">0</span><span class="op" id="8339410">;</span>&nbsp;<span class="ident" id="8339412">offs</span>&nbsp;<span class="op" id="8339417">&lt;=</span>&nbsp;<span class="ident" id="8339420">srclen</span><span class="op" id="8339426">;</span>&nbsp;<span class="ident" id="8339428">offs</span><span class="op" id="8339432">++</span>&nbsp;<span class="op" id="8339435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339439">buf</span><span class="op" id="8339442">.</span><span class="ident" id="8339443">Reset</span><span class="op" id="8339448">(</span><span class="op" id="8339449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8339453">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8339507">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339561">if</span>&nbsp;<span class="ident" id="8339564">err</span>&nbsp;<span class="op" id="8339568">:=</span>&nbsp;<span class="ident" id="8339571">Fprint</span><span class="op" id="8339577">(</span><span class="op" id="8339578">&amp;</span><span class="ident" id="8339579">buf</span><span class="op" id="8339582">,</span>&nbsp;<span class="ident" id="8339584">fset</span><span class="op" id="8339588">,</span>&nbsp;<span class="ident" id="8339590">f</span><span class="op" id="8339591">)</span><span class="op" id="8339592">;</span>&nbsp;<span class="ident" id="8339594">err</span>&nbsp;<span class="op" id="8339598">!=</span>&nbsp;<span class="ident" id="8339601">nil</span>&nbsp;<span class="op" id="8339605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339610">t</span><span class="op" id="8339611">.</span><span class="ident" id="8339612">Error</span><span class="op" id="8339617">(</span><span class="ident" id="8339618">err</span><span class="op" id="8339621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339629">if</span>&nbsp;<span class="ident" id="8339632">_</span><span class="op" id="8339633">,</span>&nbsp;<span class="ident" id="8339635">err</span>&nbsp;<span class="op" id="8339639">:=</span>&nbsp;<span class="ident" id="8339642">parser</span><span class="op" id="8339648">.</span><span class="ident" id="8339649">ParseFile</span><span class="op" id="8339658">(</span><span class="ident" id="8339659">fset</span><span class="op" id="8339663">,</span>&nbsp;<span class="string" id="8339665">&#34;&#34;</span><span class="op" id="8339667">,</span>&nbsp;<span class="ident" id="8339669">buf</span><span class="op" id="8339672">.</span><span class="ident" id="8339673">Bytes</span><span class="op" id="8339678">(</span><span class="op" id="8339679">)</span><span class="op" id="8339680">,</span>&nbsp;<span class="num" id="8339682">0</span><span class="op" id="8339683">)</span><span class="op" id="8339684">;</span>&nbsp;<span class="ident" id="8339686">err</span>&nbsp;<span class="op" id="8339690">!=</span>&nbsp;<span class="ident" id="8339693">nil</span>&nbsp;<span class="op" id="8339697">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339702">t</span><span class="op" id="8339703">.</span><span class="ident" id="8339704">Fatalf</span><span class="op" id="8339710">(</span><span class="string" id="8339711">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="8339748">,</span>&nbsp;<span class="ident" id="8339750">comment</span><span class="op" id="8339757">.</span><span class="ident" id="8339758">Slash</span><span class="op" id="8339763">,</span>&nbsp;<span class="ident" id="8339765">buf</span><span class="op" id="8339768">.</span><span class="ident" id="8339769">String</span><span class="op" id="8339775">(</span><span class="op" id="8339776">)</span><span class="op" id="8339777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8339785">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8339830">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339877">comment</span><span class="op" id="8339884">.</span><span class="ident" id="8339885">Slash</span><span class="op" id="8339890">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339894">}</span><br>
<span class="lineno"></span><span class="op" id="8339896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8339899">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="8339953">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="8340022">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="8340039">func</span>&nbsp;<span class="ident" id="8340044">TestBadComments</span><span class="op" id="8340059">(</span><span class="ident" id="8340060">t</span>&nbsp;<span class="op" id="8340062">*</span><span class="ident" id="8340063">testing</span><span class="op" id="8340070">.</span><span class="ident" id="8340071">T</span><span class="op" id="8340072">)</span>&nbsp;<span class="op" id="8340074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340077">const</span>&nbsp;<span class="ident" id="8340083">src</span>&nbsp;<span class="op" id="8340087">=</span>&nbsp;<span class="string" id="8340089">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340343">f</span><span class="op" id="8340344">,</span>&nbsp;<span class="ident" id="8340346">err</span>&nbsp;<span class="op" id="8340350">:=</span>&nbsp;<span class="ident" id="8340353">parser</span><span class="op" id="8340359">.</span><span class="ident" id="8340360">ParseFile</span><span class="op" id="8340369">(</span><span class="ident" id="8340370">fset</span><span class="op" id="8340374">,</span>&nbsp;<span class="string" id="8340376">&#34;&#34;</span><span class="op" id="8340378">,</span>&nbsp;<span class="ident" id="8340380">src</span><span class="op" id="8340383">,</span>&nbsp;<span class="ident" id="8340385">parser</span><span class="op" id="8340391">.</span><span class="ident" id="8340392">ParseComments</span><span class="op" id="8340405">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340408">if</span>&nbsp;<span class="ident" id="8340411">err</span>&nbsp;<span class="op" id="8340415">!=</span>&nbsp;<span class="ident" id="8340418">nil</span>&nbsp;<span class="op" id="8340422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340426">t</span><span class="op" id="8340427">.</span><span class="ident" id="8340428">Error</span><span class="op" id="8340433">(</span><span class="ident" id="8340434">err</span><span class="op" id="8340437">)</span>&nbsp;<span class="comment" id="8340439">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340461">comment</span>&nbsp;<span class="op" id="8340469">:=</span>&nbsp;<span class="ident" id="8340472">f</span><span class="op" id="8340473">.</span><span class="ident" id="8340474">Comments</span><span class="op" id="8340482">[</span><span class="num" id="8340483">0</span><span class="op" id="8340484">]</span><span class="op" id="8340485">.</span><span class="ident" id="8340486">List</span><span class="op" id="8340490">[</span><span class="num" id="8340491">0</span><span class="op" id="8340492">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340495">pos</span>&nbsp;<span class="op" id="8340499">:=</span>&nbsp;<span class="ident" id="8340502">comment</span><span class="op" id="8340509">.</span><span class="ident" id="8340510">Pos</span><span class="op" id="8340513">(</span><span class="op" id="8340514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340517">if</span>&nbsp;<span class="ident" id="8340520">fset</span><span class="op" id="8340524">.</span><span class="ident" id="8340525">Position</span><span class="op" id="8340533">(</span><span class="ident" id="8340534">pos</span><span class="op" id="8340537">)</span><span class="op" id="8340538">.</span><span class="ident" id="8340539">Offset</span>&nbsp;<span class="op" id="8340546">!=</span>&nbsp;<span class="num" id="8340549">1</span>&nbsp;<span class="op" id="8340551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340555">t</span><span class="op" id="8340556">.</span><span class="ident" id="8340557">Error</span><span class="op" id="8340562">(</span><span class="string" id="8340563">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="8340582">)</span>&nbsp;<span class="comment" id="8340584">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340606">testComment</span><span class="op" id="8340617">(</span><span class="ident" id="8340618">t</span><span class="op" id="8340619">,</span>&nbsp;<span class="ident" id="8340621">f</span><span class="op" id="8340622">,</span>&nbsp;<span class="builtinfunc" id="8340624">len</span><span class="op" id="8340627">(</span><span class="ident" id="8340628">src</span><span class="op" id="8340631">)</span><span class="op" id="8340632">,</span>&nbsp;<span class="op" id="8340634">&amp;</span><span class="ident" id="8340635">ast</span><span class="op" id="8340638">.</span><span class="ident" id="8340639">Comment</span><span class="op" id="8340646">{</span><span class="ident" id="8340647">Slash</span><span class="op" id="8340652">:</span>&nbsp;<span class="ident" id="8340654">pos</span><span class="op" id="8340657">,</span>&nbsp;<span class="ident" id="8340659">Text</span><span class="op" id="8340663">:</span>&nbsp;<span class="string" id="8340665">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="8340683">}</span><span class="op" id="8340684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340687">testComment</span><span class="op" id="8340698">(</span><span class="ident" id="8340699">t</span><span class="op" id="8340700">,</span>&nbsp;<span class="ident" id="8340702">f</span><span class="op" id="8340703">,</span>&nbsp;<span class="builtinfunc" id="8340705">len</span><span class="op" id="8340708">(</span><span class="ident" id="8340709">src</span><span class="op" id="8340712">)</span><span class="op" id="8340713">,</span>&nbsp;<span class="op" id="8340715">&amp;</span><span class="ident" id="8340716">ast</span><span class="op" id="8340719">.</span><span class="ident" id="8340720">Comment</span><span class="op" id="8340727">{</span><span class="ident" id="8340728">Slash</span><span class="op" id="8340733">:</span>&nbsp;<span class="ident" id="8340735">pos</span><span class="op" id="8340738">,</span>&nbsp;<span class="ident" id="8340740">Text</span><span class="op" id="8340744">:</span>&nbsp;<span class="string" id="8340746">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8340767">}</span><span class="op" id="8340768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340771">testComment</span><span class="op" id="8340782">(</span><span class="ident" id="8340783">t</span><span class="op" id="8340784">,</span>&nbsp;<span class="ident" id="8340786">f</span><span class="op" id="8340787">,</span>&nbsp;<span class="builtinfunc" id="8340789">len</span><span class="op" id="8340792">(</span><span class="ident" id="8340793">src</span><span class="op" id="8340796">)</span><span class="op" id="8340797">,</span>&nbsp;<span class="op" id="8340799">&amp;</span><span class="ident" id="8340800">ast</span><span class="op" id="8340803">.</span><span class="ident" id="8340804">Comment</span><span class="op" id="8340811">{</span><span class="ident" id="8340812">Slash</span><span class="op" id="8340817">:</span>&nbsp;<span class="ident" id="8340819">pos</span><span class="op" id="8340822">,</span>&nbsp;<span class="ident" id="8340824">Text</span><span class="op" id="8340828">:</span>&nbsp;<span class="string" id="8340830">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8340854">}</span><span class="op" id="8340855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340858">testComment</span><span class="op" id="8340869">(</span><span class="ident" id="8340870">t</span><span class="op" id="8340871">,</span>&nbsp;<span class="ident" id="8340873">f</span><span class="op" id="8340874">,</span>&nbsp;<span class="builtinfunc" id="8340876">len</span><span class="op" id="8340879">(</span><span class="ident" id="8340880">src</span><span class="op" id="8340883">)</span><span class="op" id="8340884">,</span>&nbsp;<span class="op" id="8340886">&amp;</span><span class="ident" id="8340887">ast</span><span class="op" id="8340890">.</span><span class="ident" id="8340891">Comment</span><span class="op" id="8340898">{</span><span class="ident" id="8340899">Slash</span><span class="op" id="8340904">:</span>&nbsp;<span class="ident" id="8340906">pos</span><span class="op" id="8340909">,</span>&nbsp;<span class="ident" id="8340911">Text</span><span class="op" id="8340915">:</span>&nbsp;<span class="string" id="8340917">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="8340945">}</span><span class="op" id="8340946">)</span><br>
<span class="lineno"></span><span class="op" id="8340948">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="8340951">type</span>&nbsp;<span class="ident" id="8340956">visitor</span>&nbsp;<span class="keyword" id="8340964">chan</span>&nbsp;<span class="op" id="8340969">*</span><span class="ident" id="8340970">ast</span><span class="op" id="8340973">.</span><span class="ident" id="8340974">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8340981">func</span>&nbsp;<span class="op" id="8340986">(</span><span class="ident" id="8340987">v</span>&nbsp;<span class="ident" id="8340989">visitor</span><span class="op" id="8340996">)</span>&nbsp;<span class="ident" id="8340998">Visit</span><span class="op" id="8341003">(</span><span class="ident" id="8341004">n</span>&nbsp;<span class="ident" id="8341006">ast</span><span class="op" id="8341009">.</span><span class="ident" id="8341010">Node</span><span class="op" id="8341014">)</span>&nbsp;<span class="op" id="8341016">(</span><span class="ident" id="8341017">w</span>&nbsp;<span class="ident" id="8341019">ast</span><span class="op" id="8341022">.</span><span class="ident" id="8341023">Visitor</span><span class="op" id="8341030">)</span>&nbsp;<span class="op" id="8341032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341035">if</span>&nbsp;<span class="ident" id="8341038">ident</span><span class="op" id="8341043">,</span>&nbsp;<span class="ident" id="8341045">ok</span>&nbsp;<span class="op" id="8341048">:=</span>&nbsp;<span class="ident" id="8341051">n</span><span class="op" id="8341052">.</span><span class="op" id="8341053">(</span><span class="op" id="8341054">*</span><span class="ident" id="8341055">ast</span><span class="op" id="8341058">.</span><span class="ident" id="8341059">Ident</span><span class="op" id="8341064">)</span><span class="op" id="8341065">;</span>&nbsp;<span class="ident" id="8341067">ok</span>&nbsp;<span class="op" id="8341070">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341074">v</span>&nbsp;<span class="op" id="8341076">&lt;-</span>&nbsp;<span class="ident" id="8341079">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341089">return</span>&nbsp;<span class="ident" id="8341096">v</span><br>
<span class="lineno"></span><span class="op" id="8341098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="8341101">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="8341179">func</span>&nbsp;<span class="ident" id="8341184">idents</span><span class="op" id="8341190">(</span><span class="ident" id="8341191">f</span>&nbsp;<span class="op" id="8341193">*</span><span class="ident" id="8341194">ast</span><span class="op" id="8341197">.</span><span class="ident" id="8341198">File</span><span class="op" id="8341202">)</span>&nbsp;<span class="op" id="8341204">&lt;-</span><span class="keyword" id="8341206">chan</span>&nbsp;<span class="op" id="8341211">*</span><span class="ident" id="8341212">ast</span><span class="op" id="8341215">.</span><span class="ident" id="8341216">Ident</span>&nbsp;<span class="op" id="8341222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341225">v</span>&nbsp;<span class="op" id="8341227">:=</span>&nbsp;<span class="builtinfunc" id="8341230">make</span><span class="op" id="8341234">(</span><span class="ident" id="8341235">visitor</span><span class="op" id="8341242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341245">go</span>&nbsp;<span class="keyword" id="8341248">func</span><span class="op" id="8341252">(</span><span class="op" id="8341253">)</span>&nbsp;<span class="op" id="8341255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341259">ast</span><span class="op" id="8341262">.</span><span class="ident" id="8341263">Walk</span><span class="op" id="8341267">(</span><span class="ident" id="8341268">v</span><span class="op" id="8341269">,</span>&nbsp;<span class="ident" id="8341271">f</span><span class="op" id="8341272">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8341276">close</span><span class="op" id="8341281">(</span><span class="ident" id="8341282">v</span><span class="op" id="8341283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341286">}</span><span class="op" id="8341287">(</span><span class="op" id="8341288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341291">return</span>&nbsp;<span class="ident" id="8341298">v</span><br>
<span class="lineno"></span><span class="op" id="8341300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="8341303">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="8341363">func</span>&nbsp;<span class="ident" id="8341368">identCount</span><span class="op" id="8341378">(</span><span class="ident" id="8341379">f</span>&nbsp;<span class="op" id="8341381">*</span><span class="ident" id="8341382">ast</span><span class="op" id="8341385">.</span><span class="ident" id="8341386">File</span><span class="op" id="8341390">)</span>&nbsp;<span class="builtintype" id="8341392">int</span>&nbsp;<span class="op" id="8341396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341399">n</span>&nbsp;<span class="op" id="8341401">:=</span>&nbsp;<span class="num" id="8341404">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341407">for</span>&nbsp;<span class="keyword" id="8341411">range</span>&nbsp;<span class="ident" id="8341417">idents</span><span class="op" id="8341423">(</span><span class="ident" id="8341424">f</span><span class="op" id="8341425">)</span>&nbsp;<span class="op" id="8341427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341431">n</span><span class="op" id="8341432">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341439">return</span>&nbsp;<span class="ident" id="8341446">n</span><br>
<span class="lineno"></span><span class="op" id="8341448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8341451">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="8341515">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="8341580">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="8341598">func</span>&nbsp;<span class="ident" id="8341603">TestSourcePos</span><span class="op" id="8341616">(</span><span class="ident" id="8341617">t</span>&nbsp;<span class="op" id="8341619">*</span><span class="ident" id="8341620">testing</span><span class="op" id="8341627">.</span><span class="ident" id="8341628">T</span><span class="op" id="8341629">)</span>&nbsp;<span class="op" id="8341631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341634">const</span>&nbsp;<span class="ident" id="8341640">src</span>&nbsp;<span class="op" id="8341644">=</span>&nbsp;<span class="string" id="8341646">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8341871">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341890">f1</span><span class="op" id="8341892">,</span>&nbsp;<span class="ident" id="8341894">err</span>&nbsp;<span class="op" id="8341898">:=</span>&nbsp;<span class="ident" id="8341901">parser</span><span class="op" id="8341907">.</span><span class="ident" id="8341908">ParseFile</span><span class="op" id="8341917">(</span><span class="ident" id="8341918">fset</span><span class="op" id="8341922">,</span>&nbsp;<span class="string" id="8341924">&#34;src&#34;</span><span class="op" id="8341929">,</span>&nbsp;<span class="ident" id="8341931">src</span><span class="op" id="8341934">,</span>&nbsp;<span class="ident" id="8341936">parser</span><span class="op" id="8341942">.</span><span class="ident" id="8341943">ParseComments</span><span class="op" id="8341956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341959">if</span>&nbsp;<span class="ident" id="8341962">err</span>&nbsp;<span class="op" id="8341966">!=</span>&nbsp;<span class="ident" id="8341969">nil</span>&nbsp;<span class="op" id="8341973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341977">t</span><span class="op" id="8341978">.</span><span class="ident" id="8341979">Fatal</span><span class="op" id="8341984">(</span><span class="ident" id="8341985">err</span><span class="op" id="8341988">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8341995">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342021">var</span>&nbsp;<span class="ident" id="8342025">buf</span>&nbsp;<span class="ident" id="8342029">bytes</span><span class="op" id="8342034">.</span><span class="ident" id="8342035">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342043">err</span>&nbsp;<span class="op" id="8342047">=</span>&nbsp;<span class="op" id="8342049">(</span><span class="op" id="8342050">&amp;</span><span class="ident" id="8342051">Config</span><span class="op" id="8342057">{</span><span class="ident" id="8342058">Mode</span><span class="op" id="8342062">:</span>&nbsp;<span class="ident" id="8342064">UseSpaces</span>&nbsp;<span class="op" id="8342074">|</span>&nbsp;<span class="ident" id="8342076">SourcePos</span><span class="op" id="8342085">,</span>&nbsp;<span class="ident" id="8342087">Tabwidth</span><span class="op" id="8342095">:</span>&nbsp;<span class="num" id="8342097">8</span><span class="op" id="8342098">}</span><span class="op" id="8342099">)</span><span class="op" id="8342100">.</span><span class="ident" id="8342101">Fprint</span><span class="op" id="8342107">(</span><span class="op" id="8342108">&amp;</span><span class="ident" id="8342109">buf</span><span class="op" id="8342112">,</span>&nbsp;<span class="ident" id="8342114">fset</span><span class="op" id="8342118">,</span>&nbsp;<span class="ident" id="8342120">f1</span><span class="op" id="8342122">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342125">if</span>&nbsp;<span class="ident" id="8342128">err</span>&nbsp;<span class="op" id="8342132">!=</span>&nbsp;<span class="ident" id="8342135">nil</span>&nbsp;<span class="op" id="8342139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342143">t</span><span class="op" id="8342144">.</span><span class="ident" id="8342145">Fatal</span><span class="op" id="8342150">(</span><span class="ident" id="8342151">err</span><span class="op" id="8342154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342161">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342195">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342271">f2</span><span class="op" id="8342273">,</span>&nbsp;<span class="ident" id="8342275">err</span>&nbsp;<span class="op" id="8342279">:=</span>&nbsp;<span class="ident" id="8342282">parser</span><span class="op" id="8342288">.</span><span class="ident" id="8342289">ParseFile</span><span class="op" id="8342298">(</span><span class="ident" id="8342299">fset</span><span class="op" id="8342303">,</span>&nbsp;<span class="string" id="8342305">&#34;&#34;</span><span class="op" id="8342307">,</span>&nbsp;<span class="ident" id="8342309">buf</span><span class="op" id="8342312">.</span><span class="ident" id="8342313">Bytes</span><span class="op" id="8342318">(</span><span class="op" id="8342319">)</span><span class="op" id="8342320">,</span>&nbsp;<span class="num" id="8342322">0</span><span class="op" id="8342323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342326">if</span>&nbsp;<span class="ident" id="8342329">err</span>&nbsp;<span class="op" id="8342333">!=</span>&nbsp;<span class="ident" id="8342336">nil</span>&nbsp;<span class="op" id="8342340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342344">t</span><span class="op" id="8342345">.</span><span class="ident" id="8342346">Fatalf</span><span class="op" id="8342352">(</span><span class="string" id="8342353">&#34;%s\n%s&#34;</span><span class="op" id="8342361">,</span>&nbsp;<span class="ident" id="8342363">err</span><span class="op" id="8342366">,</span>&nbsp;<span class="ident" id="8342368">buf</span><span class="op" id="8342371">.</span><span class="ident" id="8342372">Bytes</span><span class="op" id="8342377">(</span><span class="op" id="8342378">)</span><span class="op" id="8342379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342382">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342386">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342457">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342529">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342600">n1</span>&nbsp;<span class="op" id="8342603">:=</span>&nbsp;<span class="ident" id="8342606">identCount</span><span class="op" id="8342616">(</span><span class="ident" id="8342617">f1</span><span class="op" id="8342619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342622">n2</span>&nbsp;<span class="op" id="8342625">:=</span>&nbsp;<span class="ident" id="8342628">identCount</span><span class="op" id="8342638">(</span><span class="ident" id="8342639">f2</span><span class="op" id="8342641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342644">if</span>&nbsp;<span class="ident" id="8342647">n1</span>&nbsp;<span class="op" id="8342650">==</span>&nbsp;<span class="num" id="8342653">0</span>&nbsp;<span class="op" id="8342655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342659">t</span><span class="op" id="8342660">.</span><span class="ident" id="8342661">Fatal</span><span class="op" id="8342666">(</span><span class="string" id="8342667">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="8342682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342685">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342688">if</span>&nbsp;<span class="ident" id="8342691">n2</span>&nbsp;<span class="op" id="8342694">!=</span>&nbsp;<span class="ident" id="8342697">n1</span>&nbsp;<span class="op" id="8342700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342704">t</span><span class="op" id="8342705">.</span><span class="ident" id="8342706">Errorf</span><span class="op" id="8342712">(</span><span class="string" id="8342713">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8342737">,</span>&nbsp;<span class="ident" id="8342739">n2</span><span class="op" id="8342741">,</span>&nbsp;<span class="ident" id="8342743">n1</span><span class="op" id="8342745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8342752">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342814">i2range</span>&nbsp;<span class="op" id="8342822">:=</span>&nbsp;<span class="ident" id="8342825">idents</span><span class="op" id="8342831">(</span><span class="ident" id="8342832">f2</span><span class="op" id="8342834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342837">for</span>&nbsp;<span class="ident" id="8342841">i1</span>&nbsp;<span class="op" id="8342844">:=</span>&nbsp;<span class="keyword" id="8342847">range</span>&nbsp;<span class="ident" id="8342853">idents</span><span class="op" id="8342859">(</span><span class="ident" id="8342860">f1</span><span class="op" id="8342862">)</span>&nbsp;<span class="op" id="8342864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342868">i2</span>&nbsp;<span class="op" id="8342871">:=</span>&nbsp;<span class="op" id="8342874">&lt;-</span><span class="ident" id="8342876">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342887">if</span>&nbsp;<span class="ident" id="8342890">i2</span><span class="op" id="8342892">.</span><span class="ident" id="8342893">Name</span>&nbsp;<span class="op" id="8342898">!=</span>&nbsp;<span class="ident" id="8342901">i1</span><span class="op" id="8342903">.</span><span class="ident" id="8342904">Name</span>&nbsp;<span class="op" id="8342909">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342914">t</span><span class="op" id="8342915">.</span><span class="ident" id="8342916">Errorf</span><span class="op" id="8342922">(</span><span class="string" id="8342923">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8342946">,</span>&nbsp;<span class="ident" id="8342948">i2</span><span class="op" id="8342950">.</span><span class="ident" id="8342951">Name</span><span class="op" id="8342955">,</span>&nbsp;<span class="ident" id="8342957">i1</span><span class="op" id="8342959">.</span><span class="ident" id="8342960">Name</span><span class="op" id="8342964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342973">l1</span>&nbsp;<span class="op" id="8342976">:=</span>&nbsp;<span class="ident" id="8342979">fset</span><span class="op" id="8342983">.</span><span class="ident" id="8342984">Position</span><span class="op" id="8342992">(</span><span class="ident" id="8342993">i1</span><span class="op" id="8342995">.</span><span class="ident" id="8342996">Pos</span><span class="op" id="8342999">(</span><span class="op" id="8343000">)</span><span class="op" id="8343001">)</span><span class="op" id="8343002">.</span><span class="ident" id="8343003">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343010">l2</span>&nbsp;<span class="op" id="8343013">:=</span>&nbsp;<span class="ident" id="8343016">fset</span><span class="op" id="8343020">.</span><span class="ident" id="8343021">Position</span><span class="op" id="8343029">(</span><span class="ident" id="8343030">i2</span><span class="op" id="8343032">.</span><span class="ident" id="8343033">Pos</span><span class="op" id="8343036">(</span><span class="op" id="8343037">)</span><span class="op" id="8343038">)</span><span class="op" id="8343039">.</span><span class="ident" id="8343040">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343047">if</span>&nbsp;<span class="ident" id="8343050">l2</span>&nbsp;<span class="op" id="8343053">!=</span>&nbsp;<span class="ident" id="8343056">l1</span>&nbsp;<span class="op" id="8343059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343064">t</span><span class="op" id="8343065">.</span><span class="ident" id="8343066">Errorf</span><span class="op" id="8343072">(</span><span class="string" id="8343073">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="8343102">,</span>&nbsp;<span class="ident" id="8343104">l2</span><span class="op" id="8343106">,</span>&nbsp;<span class="ident" id="8343108">l1</span><span class="op" id="8343110">,</span>&nbsp;<span class="ident" id="8343112">i1</span><span class="op" id="8343114">.</span><span class="ident" id="8343115">Name</span><span class="op" id="8343119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343130">if</span>&nbsp;<span class="ident" id="8343133">t</span><span class="op" id="8343134">.</span><span class="ident" id="8343135">Failed</span><span class="op" id="8343141">(</span><span class="op" id="8343142">)</span>&nbsp;<span class="op" id="8343144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343148">t</span><span class="op" id="8343149">.</span><span class="ident" id="8343150">Logf</span><span class="op" id="8343154">(</span><span class="string" id="8343155">&#34;\n%s&#34;</span><span class="op" id="8343161">,</span>&nbsp;<span class="ident" id="8343163">buf</span><span class="op" id="8343166">.</span><span class="ident" id="8343167">Bytes</span><span class="op" id="8343172">(</span><span class="op" id="8343173">)</span><span class="op" id="8343174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343177">}</span><br>
<span class="lineno"></span><span class="op" id="8343179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8343182">var</span>&nbsp;<span class="ident" id="8343186">decls</span>&nbsp;<span class="op" id="8343192">=</span>&nbsp;<span class="op" id="8343194">[</span><span class="op" id="8343195">]</span><span class="builtintype" id="8343196">string</span><span class="op" id="8343202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343205">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="8343219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343222">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="8343274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343277">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="8343319">,</span><br>
<span class="lineno"></span><span class="op" id="8343321">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="8343324">func</span>&nbsp;<span class="ident" id="8343329">TestDeclLists</span><span class="op" id="8343342">(</span><span class="ident" id="8343343">t</span>&nbsp;<span class="op" id="8343345">*</span><span class="ident" id="8343346">testing</span><span class="op" id="8343353">.</span><span class="ident" id="8343354">T</span><span class="op" id="8343355">)</span>&nbsp;<span class="op" id="8343357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343360">for</span>&nbsp;<span class="ident" id="8343364">_</span><span class="op" id="8343365">,</span>&nbsp;<span class="ident" id="8343367">src</span>&nbsp;<span class="op" id="8343371">:=</span>&nbsp;<span class="keyword" id="8343374">range</span>&nbsp;<span class="ident" id="8343380">decls</span>&nbsp;<span class="op" id="8343386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343390">file</span><span class="op" id="8343394">,</span>&nbsp;<span class="ident" id="8343396">err</span>&nbsp;<span class="op" id="8343400">:=</span>&nbsp;<span class="ident" id="8343403">parser</span><span class="op" id="8343409">.</span><span class="ident" id="8343410">ParseFile</span><span class="op" id="8343419">(</span><span class="ident" id="8343420">fset</span><span class="op" id="8343424">,</span>&nbsp;<span class="string" id="8343426">&#34;&#34;</span><span class="op" id="8343428">,</span>&nbsp;<span class="string" id="8343430">&#34;package&nbsp;p;&#34;</span><span class="op" id="8343442">+</span><span class="ident" id="8343443">src</span><span class="op" id="8343446">,</span>&nbsp;<span class="ident" id="8343448">parser</span><span class="op" id="8343454">.</span><span class="ident" id="8343455">ParseComments</span><span class="op" id="8343468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343472">if</span>&nbsp;<span class="ident" id="8343475">err</span>&nbsp;<span class="op" id="8343479">!=</span>&nbsp;<span class="ident" id="8343482">nil</span>&nbsp;<span class="op" id="8343486">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8343491">panic</span><span class="op" id="8343496">(</span><span class="ident" id="8343497">err</span><span class="op" id="8343500">)</span>&nbsp;<span class="comment" id="8343502">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343526">var</span>&nbsp;<span class="ident" id="8343530">buf</span>&nbsp;<span class="ident" id="8343534">bytes</span><span class="op" id="8343539">.</span><span class="ident" id="8343540">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343549">err</span>&nbsp;<span class="op" id="8343553">=</span>&nbsp;<span class="ident" id="8343555">Fprint</span><span class="op" id="8343561">(</span><span class="op" id="8343562">&amp;</span><span class="ident" id="8343563">buf</span><span class="op" id="8343566">,</span>&nbsp;<span class="ident" id="8343568">fset</span><span class="op" id="8343572">,</span>&nbsp;<span class="ident" id="8343574">file</span><span class="op" id="8343578">.</span><span class="ident" id="8343579">Decls</span><span class="op" id="8343584">)</span>&nbsp;<span class="comment" id="8343586">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343615">if</span>&nbsp;<span class="ident" id="8343618">err</span>&nbsp;<span class="op" id="8343622">!=</span>&nbsp;<span class="ident" id="8343625">nil</span>&nbsp;<span class="op" id="8343629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8343634">panic</span><span class="op" id="8343639">(</span><span class="ident" id="8343640">err</span><span class="op" id="8343643">)</span>&nbsp;<span class="comment" id="8343645">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343669">out</span>&nbsp;<span class="op" id="8343673">:=</span>&nbsp;<span class="ident" id="8343676">buf</span><span class="op" id="8343679">.</span><span class="ident" id="8343680">String</span><span class="op" id="8343686">(</span><span class="op" id="8343687">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343691">if</span>&nbsp;<span class="ident" id="8343694">out</span>&nbsp;<span class="op" id="8343698">!=</span>&nbsp;<span class="ident" id="8343701">src</span>&nbsp;<span class="op" id="8343705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343710">t</span><span class="op" id="8343711">.</span><span class="ident" id="8343712">Errorf</span><span class="op" id="8343718">(</span><span class="string" id="8343719">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8343743">,</span>&nbsp;<span class="ident" id="8343745">out</span><span class="op" id="8343748">,</span>&nbsp;<span class="ident" id="8343750">src</span><span class="op" id="8343753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343760">}</span><br>
<span class="lineno"></span><span class="op" id="8343762">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8343765">var</span>&nbsp;<span class="ident" id="8343769">stmts</span>&nbsp;<span class="op" id="8343775">=</span>&nbsp;<span class="op" id="8343777">[</span><span class="op" id="8343778">]</span><span class="builtintype" id="8343779">string</span><span class="op" id="8343785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343788">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="8343796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343799">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="8343841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343844">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="8343871">,</span><br>
<span class="lineno">460</span><span class="op" id="8343873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343876">func</span>&nbsp;<span class="ident" id="8343881">TestStmtLists</span><span class="op" id="8343894">(</span><span class="ident" id="8343895">t</span>&nbsp;<span class="op" id="8343897">*</span><span class="ident" id="8343898">testing</span><span class="op" id="8343905">.</span><span class="ident" id="8343906">T</span><span class="op" id="8343907">)</span>&nbsp;<span class="op" id="8343909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343912">for</span>&nbsp;<span class="ident" id="8343916">_</span><span class="op" id="8343917">,</span>&nbsp;<span class="ident" id="8343919">src</span>&nbsp;<span class="op" id="8343923">:=</span>&nbsp;<span class="keyword" id="8343926">range</span>&nbsp;<span class="ident" id="8343932">stmts</span>&nbsp;<span class="op" id="8343938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343942">file</span><span class="op" id="8343946">,</span>&nbsp;<span class="ident" id="8343948">err</span>&nbsp;<span class="op" id="8343952">:=</span>&nbsp;<span class="ident" id="8343955">parser</span><span class="op" id="8343961">.</span><span class="ident" id="8343962">ParseFile</span><span class="op" id="8343971">(</span><span class="ident" id="8343972">fset</span><span class="op" id="8343976">,</span>&nbsp;<span class="string" id="8343978">&#34;&#34;</span><span class="op" id="8343980">,</span>&nbsp;<span class="string" id="8343982">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="8344005">+</span><span class="ident" id="8344006">src</span><span class="op" id="8344009">+</span><span class="string" id="8344010">&#34;}&#34;</span><span class="op" id="8344013">,</span>&nbsp;<span class="ident" id="8344015">parser</span><span class="op" id="8344021">.</span><span class="ident" id="8344022">ParseComments</span><span class="op" id="8344035">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344039">if</span>&nbsp;<span class="ident" id="8344042">err</span>&nbsp;<span class="op" id="8344046">!=</span>&nbsp;<span class="ident" id="8344049">nil</span>&nbsp;<span class="op" id="8344053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8344058">panic</span><span class="op" id="8344063">(</span><span class="ident" id="8344064">err</span><span class="op" id="8344067">)</span>&nbsp;<span class="comment" id="8344069">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344093">var</span>&nbsp;<span class="ident" id="8344097">buf</span>&nbsp;<span class="ident" id="8344101">bytes</span><span class="op" id="8344106">.</span><span class="ident" id="8344107">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344116">err</span>&nbsp;<span class="op" id="8344120">=</span>&nbsp;<span class="ident" id="8344122">Fprint</span><span class="op" id="8344128">(</span><span class="op" id="8344129">&amp;</span><span class="ident" id="8344130">buf</span><span class="op" id="8344133">,</span>&nbsp;<span class="ident" id="8344135">fset</span><span class="op" id="8344139">,</span>&nbsp;<span class="ident" id="8344141">file</span><span class="op" id="8344145">.</span><span class="ident" id="8344146">Decls</span><span class="op" id="8344151">[</span><span class="num" id="8344152">0</span><span class="op" id="8344153">]</span><span class="op" id="8344154">.</span><span class="op" id="8344155">(</span><span class="op" id="8344156">*</span><span class="ident" id="8344157">ast</span><span class="op" id="8344160">.</span><span class="ident" id="8344161">FuncDecl</span><span class="op" id="8344169">)</span><span class="op" id="8344170">.</span><span class="ident" id="8344171">Body</span><span class="op" id="8344175">.</span><span class="ident" id="8344176">List</span><span class="op" id="8344180">)</span>&nbsp;<span class="comment" id="8344182">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344209">if</span>&nbsp;<span class="ident" id="8344212">err</span>&nbsp;<span class="op" id="8344216">!=</span>&nbsp;<span class="ident" id="8344219">nil</span>&nbsp;<span class="op" id="8344223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8344228">panic</span><span class="op" id="8344233">(</span><span class="ident" id="8344234">err</span><span class="op" id="8344237">)</span>&nbsp;<span class="comment" id="8344239">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344263">out</span>&nbsp;<span class="op" id="8344267">:=</span>&nbsp;<span class="ident" id="8344270">buf</span><span class="op" id="8344273">.</span><span class="ident" id="8344274">String</span><span class="op" id="8344280">(</span><span class="op" id="8344281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344285">if</span>&nbsp;<span class="ident" id="8344288">out</span>&nbsp;<span class="op" id="8344292">!=</span>&nbsp;<span class="ident" id="8344295">src</span>&nbsp;<span class="op" id="8344299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344304">t</span><span class="op" id="8344305">.</span><span class="ident" id="8344306">Errorf</span><span class="op" id="8344312">(</span><span class="string" id="8344313">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8344337">,</span>&nbsp;<span class="ident" id="8344339">out</span><span class="op" id="8344342">,</span>&nbsp;<span class="ident" id="8344344">src</span><span class="op" id="8344347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344354">}</span><br>
<span class="lineno">480</span><span class="op" id="8344356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8344359">func</span>&nbsp;<span class="ident" id="8344364">TestBaseIndent</span><span class="op" id="8344378">(</span><span class="ident" id="8344379">t</span>&nbsp;<span class="op" id="8344381">*</span><span class="ident" id="8344382">testing</span><span class="op" id="8344389">.</span><span class="ident" id="8344390">T</span><span class="op" id="8344391">)</span>&nbsp;<span class="op" id="8344393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344396">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344465">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344534">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344554">const</span>&nbsp;<span class="ident" id="8344560">filename</span>&nbsp;<span class="op" id="8344569">=</span>&nbsp;<span class="string" id="8344571">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344585">src</span><span class="op" id="8344588">,</span>&nbsp;<span class="ident" id="8344590">err</span>&nbsp;<span class="op" id="8344594">:=</span>&nbsp;<span class="ident" id="8344597">ioutil</span><span class="op" id="8344603">.</span><span class="ident" id="8344604">ReadFile</span><span class="op" id="8344612">(</span><span class="ident" id="8344613">filename</span><span class="op" id="8344621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344624">if</span>&nbsp;<span class="ident" id="8344627">err</span>&nbsp;<span class="op" id="8344631">!=</span>&nbsp;<span class="ident" id="8344634">nil</span>&nbsp;<span class="op" id="8344638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8344642">panic</span><span class="op" id="8344647">(</span><span class="ident" id="8344648">err</span><span class="op" id="8344651">)</span>&nbsp;<span class="comment" id="8344653">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344675">file</span><span class="op" id="8344679">,</span>&nbsp;<span class="ident" id="8344681">err</span>&nbsp;<span class="op" id="8344685">:=</span>&nbsp;<span class="ident" id="8344688">parser</span><span class="op" id="8344694">.</span><span class="ident" id="8344695">ParseFile</span><span class="op" id="8344704">(</span><span class="ident" id="8344705">fset</span><span class="op" id="8344709">,</span>&nbsp;<span class="ident" id="8344711">filename</span><span class="op" id="8344719">,</span>&nbsp;<span class="ident" id="8344721">src</span><span class="op" id="8344724">,</span>&nbsp;<span class="num" id="8344726">0</span><span class="op" id="8344727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344730">if</span>&nbsp;<span class="ident" id="8344733">err</span>&nbsp;<span class="op" id="8344737">!=</span>&nbsp;<span class="ident" id="8344740">nil</span>&nbsp;<span class="op" id="8344744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8344748">panic</span><span class="op" id="8344753">(</span><span class="ident" id="8344754">err</span><span class="op" id="8344757">)</span>&nbsp;<span class="comment" id="8344759">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344781">var</span>&nbsp;<span class="ident" id="8344785">buf</span>&nbsp;<span class="ident" id="8344789">bytes</span><span class="op" id="8344794">.</span><span class="ident" id="8344795">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344803">for</span>&nbsp;<span class="ident" id="8344807">indent</span>&nbsp;<span class="op" id="8344814">:=</span>&nbsp;<span class="num" id="8344817">0</span><span class="op" id="8344818">;</span>&nbsp;<span class="ident" id="8344820">indent</span>&nbsp;<span class="op" id="8344827">&lt;</span>&nbsp;<span class="num" id="8344829">4</span><span class="op" id="8344830">;</span>&nbsp;<span class="ident" id="8344832">indent</span><span class="op" id="8344838">++</span>&nbsp;<span class="op" id="8344841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344845">buf</span><span class="op" id="8344848">.</span><span class="ident" id="8344849">Reset</span><span class="op" id="8344854">(</span><span class="op" id="8344855">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344859">(</span><span class="op" id="8344860">&amp;</span><span class="ident" id="8344861">Config</span><span class="op" id="8344867">{</span><span class="ident" id="8344868">Tabwidth</span><span class="op" id="8344876">:</span>&nbsp;<span class="ident" id="8344878">tabwidth</span><span class="op" id="8344886">,</span>&nbsp;<span class="ident" id="8344888">Indent</span><span class="op" id="8344894">:</span>&nbsp;<span class="ident" id="8344896">indent</span><span class="op" id="8344902">}</span><span class="op" id="8344903">)</span><span class="op" id="8344904">.</span><span class="ident" id="8344905">Fprint</span><span class="op" id="8344911">(</span><span class="op" id="8344912">&amp;</span><span class="ident" id="8344913">buf</span><span class="op" id="8344916">,</span>&nbsp;<span class="ident" id="8344918">fset</span><span class="op" id="8344922">,</span>&nbsp;<span class="ident" id="8344924">file</span><span class="op" id="8344928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344932">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344989">lines</span>&nbsp;<span class="op" id="8344995">:=</span>&nbsp;<span class="ident" id="8344998">bytes</span><span class="op" id="8345003">.</span><span class="ident" id="8345004">Split</span><span class="op" id="8345009">(</span><span class="ident" id="8345010">buf</span><span class="op" id="8345013">.</span><span class="ident" id="8345014">Bytes</span><span class="op" id="8345019">(</span><span class="op" id="8345020">)</span><span class="op" id="8345021">,</span>&nbsp;<span class="op" id="8345023">[</span><span class="op" id="8345024">]</span><span class="builtintype" id="8345025">byte</span><span class="op" id="8345029">{</span><span class="string" id="8345030">&#39;\n&#39;</span><span class="op" id="8345034">}</span><span class="op" id="8345035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345039">for</span>&nbsp;<span class="ident" id="8345043">i</span><span class="op" id="8345044">,</span>&nbsp;<span class="ident" id="8345046">line</span>&nbsp;<span class="op" id="8345051">:=</span>&nbsp;<span class="keyword" id="8345054">range</span>&nbsp;<span class="ident" id="8345060">lines</span>&nbsp;<span class="op" id="8345066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345071">if</span>&nbsp;<span class="builtinfunc" id="8345074">len</span><span class="op" id="8345077">(</span><span class="ident" id="8345078">line</span><span class="op" id="8345082">)</span>&nbsp;<span class="op" id="8345084">==</span>&nbsp;<span class="num" id="8345087">0</span>&nbsp;<span class="op" id="8345089">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345095">continue</span>&nbsp;<span class="comment" id="8345104">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345150">n</span>&nbsp;<span class="op" id="8345152">:=</span>&nbsp;<span class="num" id="8345155">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345160">for</span>&nbsp;<span class="ident" id="8345164">j</span><span class="op" id="8345165">,</span>&nbsp;<span class="ident" id="8345167">b</span>&nbsp;<span class="op" id="8345169">:=</span>&nbsp;<span class="keyword" id="8345172">range</span>&nbsp;<span class="ident" id="8345178">line</span>&nbsp;<span class="op" id="8345183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345189">if</span>&nbsp;<span class="ident" id="8345192">b</span>&nbsp;<span class="op" id="8345194">!=</span>&nbsp;<span class="string" id="8345197">&#39;\t&#39;</span>&nbsp;<span class="op" id="8345202">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8345209">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345236">n</span>&nbsp;<span class="op" id="8345238">=</span>&nbsp;<span class="ident" id="8345240">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345247">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345262">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345267">if</span>&nbsp;<span class="ident" id="8345270">n</span>&nbsp;<span class="op" id="8345272">&lt;</span>&nbsp;<span class="ident" id="8345274">indent</span>&nbsp;<span class="op" id="8345281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345287">t</span><span class="op" id="8345288">.</span><span class="ident" id="8345289">Errorf</span><span class="op" id="8345295">(</span><span class="string" id="8345296">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="8345345">,</span>&nbsp;<span class="ident" id="8345347">i</span><span class="op" id="8345348">,</span>&nbsp;<span class="ident" id="8345350">n</span><span class="op" id="8345351">,</span>&nbsp;<span class="ident" id="8345353">indent</span><span class="op" id="8345359">,</span>&nbsp;<span class="ident" id="8345361">line</span><span class="op" id="8345365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345377">}</span><br>
<span class="lineno">520</span><span class="op" id="8345379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8345382">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="8345449">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="8345521">func</span>&nbsp;<span class="ident" id="8345526">TestFuncType</span><span class="op" id="8345538">(</span><span class="ident" id="8345539">t</span>&nbsp;<span class="op" id="8345541">*</span><span class="ident" id="8345542">testing</span><span class="op" id="8345549">.</span><span class="ident" id="8345550">T</span><span class="op" id="8345551">)</span>&nbsp;<span class="op" id="8345553">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345556">src</span>&nbsp;<span class="op" id="8345560">:=</span>&nbsp;<span class="op" id="8345563">&amp;</span><span class="ident" id="8345564">ast</span><span class="op" id="8345567">.</span><span class="ident" id="8345568">File</span><span class="op" id="8345572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345576">Name</span><span class="op" id="8345580">:</span>&nbsp;<span class="op" id="8345582">&amp;</span><span class="ident" id="8345583">ast</span><span class="op" id="8345586">.</span><span class="ident" id="8345587">Ident</span><span class="op" id="8345592">{</span><span class="ident" id="8345593">Name</span><span class="op" id="8345597">:</span>&nbsp;<span class="string" id="8345599">&#34;p&#34;</span><span class="op" id="8345602">}</span><span class="op" id="8345603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345607">Decls</span><span class="op" id="8345612">:</span>&nbsp;<span class="op" id="8345614">[</span><span class="op" id="8345615">]</span><span class="ident" id="8345616">ast</span><span class="op" id="8345619">.</span><span class="ident" id="8345620">Decl</span><span class="op" id="8345624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345629">&amp;</span><span class="ident" id="8345630">ast</span><span class="op" id="8345633">.</span><span class="ident" id="8345634">FuncDecl</span><span class="op" id="8345642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345648">Name</span><span class="op" id="8345652">:</span>&nbsp;<span class="op" id="8345654">&amp;</span><span class="ident" id="8345655">ast</span><span class="op" id="8345658">.</span><span class="ident" id="8345659">Ident</span><span class="op" id="8345664">{</span><span class="ident" id="8345665">Name</span><span class="op" id="8345669">:</span>&nbsp;<span class="string" id="8345671">&#34;f&#34;</span><span class="op" id="8345674">}</span><span class="op" id="8345675">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345681">Type</span><span class="op" id="8345685">:</span>&nbsp;<span class="op" id="8345687">&amp;</span><span class="ident" id="8345688">ast</span><span class="op" id="8345691">.</span><span class="ident" id="8345692">FuncType</span><span class="op" id="8345700">{</span><span class="op" id="8345701">}</span><span class="op" id="8345702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345707">}</span><span class="op" id="8345708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345712">}</span><span class="op" id="8345713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345720">var</span>&nbsp;<span class="ident" id="8345724">buf</span>&nbsp;<span class="ident" id="8345728">bytes</span><span class="op" id="8345733">.</span><span class="ident" id="8345734">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345742">if</span>&nbsp;<span class="ident" id="8345745">err</span>&nbsp;<span class="op" id="8345749">:=</span>&nbsp;<span class="ident" id="8345752">Fprint</span><span class="op" id="8345758">(</span><span class="op" id="8345759">&amp;</span><span class="ident" id="8345760">buf</span><span class="op" id="8345763">,</span>&nbsp;<span class="ident" id="8345765">fset</span><span class="op" id="8345769">,</span>&nbsp;<span class="ident" id="8345771">src</span><span class="op" id="8345774">)</span><span class="op" id="8345775">;</span>&nbsp;<span class="ident" id="8345777">err</span>&nbsp;<span class="op" id="8345781">!=</span>&nbsp;<span class="ident" id="8345784">nil</span>&nbsp;<span class="op" id="8345788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345792">t</span><span class="op" id="8345793">.</span><span class="ident" id="8345794">Fatal</span><span class="op" id="8345799">(</span><span class="ident" id="8345800">err</span><span class="op" id="8345803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345809">got</span>&nbsp;<span class="op" id="8345813">:=</span>&nbsp;<span class="ident" id="8345816">buf</span><span class="op" id="8345819">.</span><span class="ident" id="8345820">String</span><span class="op" id="8345826">(</span><span class="op" id="8345827">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345831">const</span>&nbsp;<span class="ident" id="8345837">want</span>&nbsp;<span class="op" id="8345842">=</span>&nbsp;<span class="string" id="8345844">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345869">if</span>&nbsp;<span class="ident" id="8345872">got</span>&nbsp;<span class="op" id="8345876">!=</span>&nbsp;<span class="ident" id="8345879">want</span>&nbsp;<span class="op" id="8345884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345888">t</span><span class="op" id="8345889">.</span><span class="ident" id="8345890">Fatalf</span><span class="op" id="8345896">(</span><span class="string" id="8345897">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="8345920">,</span>&nbsp;<span class="ident" id="8345922">got</span><span class="op" id="8345925">,</span>&nbsp;<span class="ident" id="8345927">want</span><span class="op" id="8345931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345934">}</span><br>
<span class="lineno"></span><span class="op" id="8345936">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="8345939">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="8346018">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="8346036">func</span>&nbsp;<span class="ident" id="8346041">TestX</span><span class="op" id="8346046">(</span><span class="ident" id="8346047">t</span>&nbsp;<span class="op" id="8346049">*</span><span class="ident" id="8346050">testing</span><span class="op" id="8346057">.</span><span class="ident" id="8346058">T</span><span class="op" id="8346059">)</span>&nbsp;<span class="op" id="8346061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346064">const</span>&nbsp;<span class="ident" id="8346070">src</span>&nbsp;<span class="op" id="8346074">=</span>&nbsp;<span class="string" id="8346076">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346103">_</span><span class="op" id="8346104">,</span>&nbsp;<span class="ident" id="8346106">err</span>&nbsp;<span class="op" id="8346110">:=</span>&nbsp;<span class="ident" id="8346113">format</span><span class="op" id="8346119">(</span><span class="op" id="8346120">[</span><span class="op" id="8346121">]</span><span class="builtintype" id="8346122">byte</span><span class="op" id="8346126">(</span><span class="ident" id="8346127">src</span><span class="op" id="8346130">)</span><span class="op" id="8346131">,</span>&nbsp;<span class="num" id="8346133">0</span><span class="op" id="8346134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346137">if</span>&nbsp;<span class="ident" id="8346140">err</span>&nbsp;<span class="op" id="8346144">!=</span>&nbsp;<span class="ident" id="8346147">nil</span>&nbsp;<span class="op" id="8346151">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346155">t</span><span class="op" id="8346156">.</span><span class="ident" id="8346157">Error</span><span class="op" id="8346162">(</span><span class="ident" id="8346163">err</span><span class="op" id="8346166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346169">}</span><br>
<span class="lineno"></span><span class="op" id="8346171">}</span>
</div>
</body>
</html>
