<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5971543">package</span>&nbsp;<span class="ident" id="5971551">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5971558">//&nbsp;InstSys&nbsp;exectues&nbsp;a&nbsp;system&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="5971599">type</span>&nbsp;<span class="ident" id="5971604">instSys</span>&nbsp;<span class="keyword" id="5971612">struct</span><span class="op" id="5971618">{</span><span class="op" id="5971619">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="5971622">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;system&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5971660">//&nbsp;Returns&nbsp;any&nbsp;exception&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="5971698">func</span>&nbsp;<span class="op" id="5971703">(</span><span class="ident" id="5971704">i</span>&nbsp;<span class="op" id="5971706">*</span><span class="ident" id="5971707"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971604">instSys</a></span><span class="op" id="5971714">)</span>&nbsp;<span class="ident" id="5971716">I</span><span class="op" id="5971717">(</span><span class="ident" id="5971718">cpu</span>&nbsp;<span class="op" id="5971722">*</span><span class="ident" id="5971723"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5971726">,</span>&nbsp;<span class="ident" id="5971728">in</span>&nbsp;<span class="builtintype" id="5971731">uint32</span><span class="op" id="5971737">)</span>&nbsp;<span class="op" id="5971739">*</span><span class="ident" id="5971740"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5971746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971749">op</span>&nbsp;<span class="op" id="5971752">:=</span>&nbsp;<span class="op" id="5971755">(</span><span class="ident" id="5971756"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971728">in</a></span>&nbsp;<span class="op" id="5971759">&gt;&gt;</span>&nbsp;<span class="num" id="5971762">24</span><span class="op" id="5971764">)</span>&nbsp;<span class="op" id="5971766">&amp;</span>&nbsp;<span class="num" id="5971768">0xff</span>&nbsp;<span class="comment" id="5971773">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971785">src</span>&nbsp;<span class="op" id="5971789">:=</span>&nbsp;<span class="op" id="5971792">(</span><span class="ident" id="5971793"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971728">in</a></span>&nbsp;<span class="op" id="5971796">&gt;&gt;</span>&nbsp;<span class="num" id="5971799">21</span><span class="op" id="5971801">)</span>&nbsp;<span class="op" id="5971803">&amp;</span>&nbsp;<span class="num" id="5971805">0x7</span>&nbsp;<span class="comment" id="5971809">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971821">s</span>&nbsp;<span class="op" id="5971823">:=</span>&nbsp;<span class="ident" id="5971826"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5971829">.</span><span class="ident" id="5971830">regs</span><span class="op" id="5971834">[</span><span class="ident" id="5971835"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971785">src</a></span><span class="op" id="5971838">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971842">switch</span>&nbsp;<span class="ident" id="5971849"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971749">op</a></span>&nbsp;<span class="op" id="5971852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971855">case</span>&nbsp;<span class="num" id="5971860">64</span><span class="op" id="5971862">:</span>&nbsp;<span class="comment" id="5971864">//&nbsp;halt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971874">return</span>&nbsp;<span class="ident" id="5971881"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966023">errHalt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971890">case</span>&nbsp;<span class="num" id="5971895">65</span><span class="op" id="5971897">:</span>&nbsp;<span class="comment" id="5971899">//&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971912">if</span>&nbsp;<span class="op" id="5971915">!</span><span class="ident" id="5971916"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5971919">.</span><span class="ident" id="5971920">UserMode</span><span class="op" id="5971928">(</span><span class="op" id="5971929">)</span>&nbsp;<span class="op" id="5971931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971936">return</span>&nbsp;<span class="ident" id="5971943"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971960">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971964">return</span>&nbsp;<span class="ident" id="5971971"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5971974">.</span><span class="ident" id="5971975">Syscall</span><span class="op" id="5971982">(</span><span class="op" id="5971983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971986">case</span>&nbsp;<span class="num" id="5971991">66</span><span class="op" id="5971993">:</span>&nbsp;<span class="comment" id="5971995">//&nbsp;usermod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972008"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972011">.</span><span class="ident" id="5972012">ring</span>&nbsp;<span class="op" id="5972017">=</span>&nbsp;<span class="num" id="5972019">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972022">case</span>&nbsp;<span class="num" id="5972027">67</span><span class="op" id="5972029">:</span>&nbsp;<span class="comment" id="5972031">//&nbsp;vtable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972043">if</span>&nbsp;<span class="ident" id="5972046"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972049">.</span><span class="ident" id="5972050">UserMode</span><span class="op" id="5972058">(</span><span class="op" id="5972059">)</span>&nbsp;<span class="op" id="5972061">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972066">return</span>&nbsp;<span class="ident" id="5972073"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972094"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972097">.</span><span class="ident" id="5972098">virtMem</span><span class="op" id="5972105">.</span><span class="ident" id="5972106">SetTable</span><span class="op" id="5972114">(</span><span class="ident" id="5972115"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971821">s</a></span><span class="op" id="5972116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972119">case</span>&nbsp;<span class="num" id="5972124">68</span><span class="op" id="5972126">:</span>&nbsp;<span class="comment" id="5972128">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972138">if</span>&nbsp;<span class="ident" id="5972141"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972144">.</span><span class="ident" id="5972145">UserMode</span><span class="op" id="5972153">(</span><span class="op" id="5972154">)</span>&nbsp;<span class="op" id="5972156">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972161">return</span>&nbsp;<span class="ident" id="5972168"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972189">return</span>&nbsp;<span class="ident" id="5972196"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972199">.</span><span class="ident" id="5972200">Iret</span><span class="op" id="5972204">(</span><span class="op" id="5972205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972208">case</span>&nbsp;<span class="num" id="5972213">69</span><span class="op" id="5972215">:</span>&nbsp;<span class="comment" id="5972217">//&nbsp;cpuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972228"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971821">s</a></span>&nbsp;<span class="op" id="5972230">=</span>&nbsp;<span class="builtintype" id="5972232">uint32</span><span class="op" id="5972238">(</span><span class="ident" id="5972239"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972242">.</span><span class="ident" id="5972243">index</span><span class="op" id="5972248">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972251">default</span><span class="op" id="5972258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972262">return</span>&nbsp;<span class="ident" id="5972269"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5966122">errInvalidInst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972289"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971718">cpu</a></span><span class="op" id="5972292">.</span><span class="ident" id="5972293">regs</span><span class="op" id="5972297">[</span><span class="ident" id="5972298"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971785">src</a></span><span class="op" id="5972301">]</span>&nbsp;<span class="op" id="5972303">=</span>&nbsp;<span class="ident" id="5972305"><a href="/lonnie.io/e8vm/arch8/inst_sys.go.html#5971821">s</a></span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972309">return</span>&nbsp;<span class="ident" id="5972316">nil</span><br>
<span class="lineno"></span><span class="op" id="5972320">}</span>
</div>
</body>
</html>
