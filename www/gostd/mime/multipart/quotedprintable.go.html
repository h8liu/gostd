<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5246766">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5246821">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5246875">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5246926">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="5246999">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="5247014">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="5247086">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="5247160">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5247209">package</span>&nbsp;<span class="ident" id="5247217">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5247228">import</span>&nbsp;<span class="op" id="5247235">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5247238">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5247247">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5247256">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5247263">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5247268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5247271">type</span>&nbsp;<span class="ident" id="5247276">qpReader</span>&nbsp;<span class="keyword" id="5247285">struct</span>&nbsp;<span class="op" id="5247292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247295">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5247300">*</span><span class="ident" id="5247301">bufio</span><span class="op" id="5247306">.</span><span class="ident" id="5247307">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247315">rerr</span>&nbsp;<span class="builtintype" id="5247320">error</span>&nbsp;&nbsp;<span class="comment" id="5247327">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247347">line</span>&nbsp;<span class="op" id="5247352">[</span><span class="op" id="5247353">]</span><span class="builtintype" id="5247354">byte</span>&nbsp;<span class="comment" id="5247359">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="5247395">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5247398">func</span>&nbsp;<span class="ident" id="5247403">newQuotedPrintableReader</span><span class="op" id="5247427">(</span><span class="ident" id="5247428">r</span>&nbsp;<span class="ident" id="5247430">io</span><span class="op" id="5247432">.</span><span class="ident" id="5247433">Reader</span><span class="op" id="5247439">)</span>&nbsp;<span class="ident" id="5247441">io</span><span class="op" id="5247443">.</span><span class="ident" id="5247444">Reader</span>&nbsp;<span class="op" id="5247451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247454">return</span>&nbsp;<span class="op" id="5247461">&amp;</span><span class="ident" id="5247462">qpReader</span><span class="op" id="5247470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5247474">br</span><span class="op" id="5247476">:</span>&nbsp;<span class="ident" id="5247478">bufio</span><span class="op" id="5247483">.</span><span class="ident" id="5247484">NewReader</span><span class="op" id="5247493">(</span><span class="ident" id="5247494">r</span><span class="op" id="5247495">)</span><span class="op" id="5247496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247499">}</span><br>
<span class="lineno">30</span><span class="op" id="5247501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5247504">func</span>&nbsp;<span class="ident" id="5247509">fromHex</span><span class="op" id="5247516">(</span><span class="ident" id="5247517">b</span>&nbsp;<span class="builtintype" id="5247519">byte</span><span class="op" id="5247523">)</span>&nbsp;<span class="op" id="5247525">(</span><span class="builtintype" id="5247526">byte</span><span class="op" id="5247530">,</span>&nbsp;<span class="builtintype" id="5247532">error</span><span class="op" id="5247537">)</span>&nbsp;<span class="op" id="5247539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247542">switch</span>&nbsp;<span class="op" id="5247549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247552">case</span>&nbsp;<span class="ident" id="5247557">b</span>&nbsp;<span class="op" id="5247559">&gt;=</span>&nbsp;<span class="string" id="5247562">&#39;0&#39;</span>&nbsp;<span class="op" id="5247566">&amp;&amp;</span>&nbsp;<span class="ident" id="5247569">b</span>&nbsp;<span class="op" id="5247571">&lt;=</span>&nbsp;<span class="string" id="5247574">&#39;9&#39;</span><span class="op" id="5247577">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247581">return</span>&nbsp;<span class="ident" id="5247588">b</span>&nbsp;<span class="op" id="5247590">-</span>&nbsp;<span class="string" id="5247592">&#39;0&#39;</span><span class="op" id="5247595">,</span>&nbsp;<span class="ident" id="5247597">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247602">case</span>&nbsp;<span class="ident" id="5247607">b</span>&nbsp;<span class="op" id="5247609">&gt;=</span>&nbsp;<span class="string" id="5247612">&#39;A&#39;</span>&nbsp;<span class="op" id="5247616">&amp;&amp;</span>&nbsp;<span class="ident" id="5247619">b</span>&nbsp;<span class="op" id="5247621">&lt;=</span>&nbsp;<span class="string" id="5247624">&#39;F&#39;</span><span class="op" id="5247627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247631">return</span>&nbsp;<span class="ident" id="5247638">b</span>&nbsp;<span class="op" id="5247640">-</span>&nbsp;<span class="string" id="5247642">&#39;A&#39;</span>&nbsp;<span class="op" id="5247646">+</span>&nbsp;<span class="num" id="5247648">10</span><span class="op" id="5247650">,</span>&nbsp;<span class="ident" id="5247652">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247660">return</span>&nbsp;<span class="num" id="5247667">0</span><span class="op" id="5247668">,</span>&nbsp;<span class="ident" id="5247670">fmt</span><span class="op" id="5247673">.</span><span class="ident" id="5247674">Errorf</span><span class="op" id="5247680">(</span><span class="string" id="5247681">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="5247734">,</span>&nbsp;<span class="ident" id="5247736">b</span><span class="op" id="5247737">)</span><br>
<span class="lineno">40</span><span class="op" id="5247739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5247742">func</span>&nbsp;<span class="op" id="5247747">(</span><span class="ident" id="5247748">q</span>&nbsp;<span class="op" id="5247750">*</span><span class="ident" id="5247751">qpReader</span><span class="op" id="5247759">)</span>&nbsp;<span class="ident" id="5247761">readHexByte</span><span class="op" id="5247772">(</span><span class="ident" id="5247773">v</span>&nbsp;<span class="op" id="5247775">[</span><span class="op" id="5247776">]</span><span class="builtintype" id="5247777">byte</span><span class="op" id="5247781">)</span>&nbsp;<span class="op" id="5247783">(</span><span class="ident" id="5247784">b</span>&nbsp;<span class="builtintype" id="5247786">byte</span><span class="op" id="5247790">,</span>&nbsp;<span class="ident" id="5247792">err</span>&nbsp;<span class="builtintype" id="5247796">error</span><span class="op" id="5247801">)</span>&nbsp;<span class="op" id="5247803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247806">if</span>&nbsp;<span class="builtinfunc" id="5247809">len</span><span class="op" id="5247812">(</span><span class="ident" id="5247813">v</span><span class="op" id="5247814">)</span>&nbsp;<span class="op" id="5247816">&lt;</span>&nbsp;<span class="num" id="5247818">2</span>&nbsp;<span class="op" id="5247820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247824">return</span>&nbsp;<span class="num" id="5247831">0</span><span class="op" id="5247832">,</span>&nbsp;<span class="ident" id="5247834">io</span><span class="op" id="5247836">.</span><span class="ident" id="5247837">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247858">var</span>&nbsp;<span class="ident" id="5247862">hb</span><span class="op" id="5247864">,</span>&nbsp;<span class="ident" id="5247866">lb</span>&nbsp;<span class="builtintype" id="5247869">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247875">if</span>&nbsp;<span class="ident" id="5247878">hb</span><span class="op" id="5247880">,</span>&nbsp;<span class="ident" id="5247882">err</span>&nbsp;<span class="op" id="5247886">=</span>&nbsp;<span class="ident" id="5247888">fromHex</span><span class="op" id="5247895">(</span><span class="ident" id="5247896">v</span><span class="op" id="5247897">[</span><span class="num" id="5247898">0</span><span class="op" id="5247899">]</span><span class="op" id="5247900">)</span><span class="op" id="5247901">;</span>&nbsp;<span class="ident" id="5247903">err</span>&nbsp;<span class="op" id="5247907">!=</span>&nbsp;<span class="ident" id="5247910">nil</span>&nbsp;<span class="op" id="5247914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247918">return</span>&nbsp;<span class="num" id="5247925">0</span><span class="op" id="5247926">,</span>&nbsp;<span class="ident" id="5247928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247933">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247936">if</span>&nbsp;<span class="ident" id="5247939">lb</span><span class="op" id="5247941">,</span>&nbsp;<span class="ident" id="5247943">err</span>&nbsp;<span class="op" id="5247947">=</span>&nbsp;<span class="ident" id="5247949">fromHex</span><span class="op" id="5247956">(</span><span class="ident" id="5247957">v</span><span class="op" id="5247958">[</span><span class="num" id="5247959">1</span><span class="op" id="5247960">]</span><span class="op" id="5247961">)</span><span class="op" id="5247962">;</span>&nbsp;<span class="ident" id="5247964">err</span>&nbsp;<span class="op" id="5247968">!=</span>&nbsp;<span class="ident" id="5247971">nil</span>&nbsp;<span class="op" id="5247975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247979">return</span>&nbsp;<span class="num" id="5247986">0</span><span class="op" id="5247987">,</span>&nbsp;<span class="ident" id="5247989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5247994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5247997">return</span>&nbsp;<span class="ident" id="5248004">hb</span><span class="op" id="5248006">&lt;&lt;</span><span class="num" id="5248008">4</span>&nbsp;<span class="op" id="5248010">|</span>&nbsp;<span class="ident" id="5248012">lb</span><span class="op" id="5248014">,</span>&nbsp;<span class="ident" id="5248016">nil</span><br>
<span class="lineno"></span><span class="op" id="5248020">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="5248023">func</span>&nbsp;<span class="ident" id="5248028">isQPDiscardWhitespace</span><span class="op" id="5248049">(</span><span class="ident" id="5248050">r</span>&nbsp;<span class="builtintype" id="5248052">rune</span><span class="op" id="5248056">)</span>&nbsp;<span class="builtintype" id="5248058">bool</span>&nbsp;<span class="op" id="5248063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248066">switch</span>&nbsp;<span class="ident" id="5248073">r</span>&nbsp;<span class="op" id="5248075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248078">case</span>&nbsp;<span class="string" id="5248083">&#39;\n&#39;</span><span class="op" id="5248087">,</span>&nbsp;<span class="string" id="5248089">&#39;\r&#39;</span><span class="op" id="5248093">,</span>&nbsp;<span class="string" id="5248095">&#39;&nbsp;&#39;</span><span class="op" id="5248098">,</span>&nbsp;<span class="string" id="5248100">&#39;\t&#39;</span><span class="op" id="5248104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248108">return</span>&nbsp;<span class="builtintype" id="5248115">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248124">return</span>&nbsp;<span class="builtintype" id="5248131">false</span><br>
<span class="lineno"></span><span class="op" id="5248137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5248140">var</span>&nbsp;<span class="op" id="5248144">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248147">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248158">=</span>&nbsp;<span class="op" id="5248160">[</span><span class="op" id="5248161">]</span><span class="builtintype" id="5248162">byte</span><span class="op" id="5248166">(</span><span class="string" id="5248167">&#34;\r\n&#34;</span><span class="op" id="5248173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248176">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248187">=</span>&nbsp;<span class="op" id="5248189">[</span><span class="op" id="5248190">]</span><span class="builtintype" id="5248191">byte</span><span class="op" id="5248195">(</span><span class="string" id="5248196">&#34;\n&#34;</span><span class="op" id="5248200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248203">softSuffix</span>&nbsp;<span class="op" id="5248214">=</span>&nbsp;<span class="op" id="5248216">[</span><span class="op" id="5248217">]</span><span class="builtintype" id="5248218">byte</span><span class="op" id="5248222">(</span><span class="string" id="5248223">&#34;=&#34;</span><span class="op" id="5248226">)</span><br>
<span class="lineno"></span><span class="op" id="5248228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5248231">func</span>&nbsp;<span class="op" id="5248236">(</span><span class="ident" id="5248237">q</span>&nbsp;<span class="op" id="5248239">*</span><span class="ident" id="5248240">qpReader</span><span class="op" id="5248248">)</span>&nbsp;<span class="ident" id="5248250">Read</span><span class="op" id="5248254">(</span><span class="ident" id="5248255">p</span>&nbsp;<span class="op" id="5248257">[</span><span class="op" id="5248258">]</span><span class="builtintype" id="5248259">byte</span><span class="op" id="5248263">)</span>&nbsp;<span class="op" id="5248265">(</span><span class="ident" id="5248266">n</span>&nbsp;<span class="builtintype" id="5248268">int</span><span class="op" id="5248271">,</span>&nbsp;<span class="ident" id="5248273">err</span>&nbsp;<span class="builtintype" id="5248277">error</span><span class="op" id="5248282">)</span>&nbsp;<span class="op" id="5248284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248287">for</span>&nbsp;<span class="builtinfunc" id="5248291">len</span><span class="op" id="5248294">(</span><span class="ident" id="5248295">p</span><span class="op" id="5248296">)</span>&nbsp;<span class="op" id="5248298">&gt;</span>&nbsp;<span class="num" id="5248300">0</span>&nbsp;<span class="op" id="5248302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248306">if</span>&nbsp;<span class="builtinfunc" id="5248309">len</span><span class="op" id="5248312">(</span><span class="ident" id="5248313">q</span><span class="op" id="5248314">.</span><span class="ident" id="5248315">line</span><span class="op" id="5248319">)</span>&nbsp;<span class="op" id="5248321">==</span>&nbsp;<span class="num" id="5248324">0</span>&nbsp;<span class="op" id="5248326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248331">if</span>&nbsp;<span class="ident" id="5248334">q</span><span class="op" id="5248335">.</span><span class="ident" id="5248336">rerr</span>&nbsp;<span class="op" id="5248341">!=</span>&nbsp;<span class="ident" id="5248344">nil</span>&nbsp;<span class="op" id="5248348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248354">return</span>&nbsp;<span class="ident" id="5248361">n</span><span class="op" id="5248362">,</span>&nbsp;<span class="ident" id="5248364">q</span><span class="op" id="5248365">.</span><span class="ident" id="5248366">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248379">q</span><span class="op" id="5248380">.</span><span class="ident" id="5248381">line</span><span class="op" id="5248385">,</span>&nbsp;<span class="ident" id="5248387">q</span><span class="op" id="5248388">.</span><span class="ident" id="5248389">rerr</span>&nbsp;<span class="op" id="5248394">=</span>&nbsp;<span class="ident" id="5248396">q</span><span class="op" id="5248397">.</span><span class="ident" id="5248398">br</span><span class="op" id="5248400">.</span><span class="ident" id="5248401">ReadSlice</span><span class="op" id="5248410">(</span><span class="string" id="5248411">&#39;\n&#39;</span><span class="op" id="5248415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5248421">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248473">hasLF</span>&nbsp;<span class="op" id="5248479">:=</span>&nbsp;<span class="ident" id="5248482">bytes</span><span class="op" id="5248487">.</span><span class="ident" id="5248488">HasSuffix</span><span class="op" id="5248497">(</span><span class="ident" id="5248498">q</span><span class="op" id="5248499">.</span><span class="ident" id="5248500">line</span><span class="op" id="5248504">,</span>&nbsp;<span class="ident" id="5248506">lf</span><span class="op" id="5248508">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248513">hasCR</span>&nbsp;<span class="op" id="5248519">:=</span>&nbsp;<span class="ident" id="5248522">bytes</span><span class="op" id="5248527">.</span><span class="ident" id="5248528">HasSuffix</span><span class="op" id="5248537">(</span><span class="ident" id="5248538">q</span><span class="op" id="5248539">.</span><span class="ident" id="5248540">line</span><span class="op" id="5248544">,</span>&nbsp;<span class="ident" id="5248546">crlf</span><span class="op" id="5248550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248555">wholeLine</span>&nbsp;<span class="op" id="5248565">:=</span>&nbsp;<span class="ident" id="5248568">q</span><span class="op" id="5248569">.</span><span class="ident" id="5248570">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248578">q</span><span class="op" id="5248579">.</span><span class="ident" id="5248580">line</span>&nbsp;<span class="op" id="5248585">=</span>&nbsp;<span class="ident" id="5248587">bytes</span><span class="op" id="5248592">.</span><span class="ident" id="5248593">TrimRightFunc</span><span class="op" id="5248606">(</span><span class="ident" id="5248607">wholeLine</span><span class="op" id="5248616">,</span>&nbsp;<span class="ident" id="5248618">isQPDiscardWhitespace</span><span class="op" id="5248639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248644">if</span>&nbsp;<span class="ident" id="5248647">bytes</span><span class="op" id="5248652">.</span><span class="ident" id="5248653">HasSuffix</span><span class="op" id="5248662">(</span><span class="ident" id="5248663">q</span><span class="op" id="5248664">.</span><span class="ident" id="5248665">line</span><span class="op" id="5248669">,</span>&nbsp;<span class="ident" id="5248671">softSuffix</span><span class="op" id="5248681">)</span>&nbsp;<span class="op" id="5248683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248689">rightStripped</span>&nbsp;<span class="op" id="5248703">:=</span>&nbsp;<span class="ident" id="5248706">wholeLine</span><span class="op" id="5248715">[</span><span class="builtinfunc" id="5248716">len</span><span class="op" id="5248719">(</span><span class="ident" id="5248720">q</span><span class="op" id="5248721">.</span><span class="ident" id="5248722">line</span><span class="op" id="5248726">)</span><span class="op" id="5248727">:</span><span class="op" id="5248728">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248734">q</span><span class="op" id="5248735">.</span><span class="ident" id="5248736">line</span>&nbsp;<span class="op" id="5248741">=</span>&nbsp;<span class="ident" id="5248743">q</span><span class="op" id="5248744">.</span><span class="ident" id="5248745">line</span><span class="op" id="5248749">[</span><span class="op" id="5248750">:</span><span class="builtinfunc" id="5248751">len</span><span class="op" id="5248754">(</span><span class="ident" id="5248755">q</span><span class="op" id="5248756">.</span><span class="ident" id="5248757">line</span><span class="op" id="5248761">)</span><span class="op" id="5248762">-</span><span class="num" id="5248763">1</span><span class="op" id="5248764">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248770">if</span>&nbsp;<span class="op" id="5248773">!</span><span class="ident" id="5248774">bytes</span><span class="op" id="5248779">.</span><span class="ident" id="5248780">HasPrefix</span><span class="op" id="5248789">(</span><span class="ident" id="5248790">rightStripped</span><span class="op" id="5248803">,</span>&nbsp;<span class="ident" id="5248805">lf</span><span class="op" id="5248807">)</span>&nbsp;<span class="op" id="5248809">&amp;&amp;</span>&nbsp;<span class="op" id="5248812">!</span><span class="ident" id="5248813">bytes</span><span class="op" id="5248818">.</span><span class="ident" id="5248819">HasPrefix</span><span class="op" id="5248828">(</span><span class="ident" id="5248829">rightStripped</span><span class="op" id="5248842">,</span>&nbsp;<span class="ident" id="5248844">crlf</span><span class="op" id="5248848">)</span>&nbsp;<span class="op" id="5248850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248857">q</span><span class="op" id="5248858">.</span><span class="ident" id="5248859">rerr</span>&nbsp;<span class="op" id="5248864">=</span>&nbsp;<span class="ident" id="5248866">fmt</span><span class="op" id="5248869">.</span><span class="ident" id="5248870">Errorf</span><span class="op" id="5248876">(</span><span class="string" id="5248877">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="5248915">,</span>&nbsp;<span class="ident" id="5248917">rightStripped</span><span class="op" id="5248930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5248941">}</span>&nbsp;<span class="keyword" id="5248943">else</span>&nbsp;<span class="keyword" id="5248948">if</span>&nbsp;<span class="ident" id="5248951">hasLF</span>&nbsp;<span class="op" id="5248957">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5248963">if</span>&nbsp;<span class="ident" id="5248966">hasCR</span>&nbsp;<span class="op" id="5248972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5248979">q</span><span class="op" id="5248980">.</span><span class="ident" id="5248981">line</span>&nbsp;<span class="op" id="5248986">=</span>&nbsp;<span class="builtinfunc" id="5248988">append</span><span class="op" id="5248994">(</span><span class="ident" id="5248995">q</span><span class="op" id="5248996">.</span><span class="ident" id="5248997">line</span><span class="op" id="5249001">,</span>&nbsp;<span class="string" id="5249003">&#39;\r&#39;</span><span class="op" id="5249007">,</span>&nbsp;<span class="string" id="5249009">&#39;\n&#39;</span><span class="op" id="5249013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249019">}</span>&nbsp;<span class="keyword" id="5249021">else</span>&nbsp;<span class="op" id="5249026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249033">q</span><span class="op" id="5249034">.</span><span class="ident" id="5249035">line</span>&nbsp;<span class="op" id="5249040">=</span>&nbsp;<span class="builtinfunc" id="5249042">append</span><span class="op" id="5249048">(</span><span class="ident" id="5249049">q</span><span class="op" id="5249050">.</span><span class="ident" id="5249051">line</span><span class="op" id="5249055">,</span>&nbsp;<span class="string" id="5249057">&#39;\n&#39;</span><span class="op" id="5249061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249067">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249077">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249092">b</span>&nbsp;<span class="op" id="5249094">:=</span>&nbsp;<span class="ident" id="5249097">q</span><span class="op" id="5249098">.</span><span class="ident" id="5249099">line</span><span class="op" id="5249103">[</span><span class="num" id="5249104">0</span><span class="op" id="5249105">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249110">switch</span>&nbsp;<span class="op" id="5249117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249121">case</span>&nbsp;<span class="ident" id="5249126">b</span>&nbsp;<span class="op" id="5249128">==</span>&nbsp;<span class="string" id="5249131">&#39;=&#39;</span><span class="op" id="5249134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249139">b</span><span class="op" id="5249140">,</span>&nbsp;<span class="ident" id="5249142">err</span>&nbsp;<span class="op" id="5249146">=</span>&nbsp;<span class="ident" id="5249148">q</span><span class="op" id="5249149">.</span><span class="ident" id="5249150">readHexByte</span><span class="op" id="5249161">(</span><span class="ident" id="5249162">q</span><span class="op" id="5249163">.</span><span class="ident" id="5249164">line</span><span class="op" id="5249168">[</span><span class="num" id="5249169">1</span><span class="op" id="5249170">:</span><span class="op" id="5249171">]</span><span class="op" id="5249172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249177">if</span>&nbsp;<span class="ident" id="5249180">err</span>&nbsp;<span class="op" id="5249184">!=</span>&nbsp;<span class="ident" id="5249187">nil</span>&nbsp;<span class="op" id="5249191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249197">return</span>&nbsp;<span class="ident" id="5249204">n</span><span class="op" id="5249205">,</span>&nbsp;<span class="ident" id="5249207">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249219">q</span><span class="op" id="5249220">.</span><span class="ident" id="5249221">line</span>&nbsp;<span class="op" id="5249226">=</span>&nbsp;<span class="ident" id="5249228">q</span><span class="op" id="5249229">.</span><span class="ident" id="5249230">line</span><span class="op" id="5249234">[</span><span class="num" id="5249235">2</span><span class="op" id="5249236">:</span><span class="op" id="5249237">]</span>&nbsp;<span class="comment" id="5249239">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249278">case</span>&nbsp;<span class="ident" id="5249283">b</span>&nbsp;<span class="op" id="5249285">==</span>&nbsp;<span class="string" id="5249288">&#39;\t&#39;</span>&nbsp;<span class="op" id="5249293">||</span>&nbsp;<span class="ident" id="5249296">b</span>&nbsp;<span class="op" id="5249298">==</span>&nbsp;<span class="string" id="5249301">&#39;\r&#39;</span>&nbsp;<span class="op" id="5249306">||</span>&nbsp;<span class="ident" id="5249309">b</span>&nbsp;<span class="op" id="5249311">==</span>&nbsp;<span class="string" id="5249314">&#39;\n&#39;</span><span class="op" id="5249318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249323">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249331">case</span>&nbsp;<span class="ident" id="5249336">b</span>&nbsp;<span class="op" id="5249338">&lt;</span>&nbsp;<span class="string" id="5249340">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5249344">||</span>&nbsp;<span class="ident" id="5249347">b</span>&nbsp;<span class="op" id="5249349">&gt;</span>&nbsp;<span class="string" id="5249351">&#39;~&#39;</span><span class="op" id="5249354">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249359">return</span>&nbsp;<span class="ident" id="5249366">n</span><span class="op" id="5249367">,</span>&nbsp;<span class="ident" id="5249369">fmt</span><span class="op" id="5249372">.</span><span class="ident" id="5249373">Errorf</span><span class="op" id="5249379">(</span><span class="string" id="5249380">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="5249447">,</span>&nbsp;<span class="ident" id="5249449">b</span><span class="op" id="5249450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249458">p</span><span class="op" id="5249459">[</span><span class="num" id="5249460">0</span><span class="op" id="5249461">]</span>&nbsp;<span class="op" id="5249463">=</span>&nbsp;<span class="ident" id="5249465">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249469">p</span>&nbsp;<span class="op" id="5249471">=</span>&nbsp;<span class="ident" id="5249473">p</span><span class="op" id="5249474">[</span><span class="num" id="5249475">1</span><span class="op" id="5249476">:</span><span class="op" id="5249477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249481">q</span><span class="op" id="5249482">.</span><span class="ident" id="5249483">line</span>&nbsp;<span class="op" id="5249488">=</span>&nbsp;<span class="ident" id="5249490">q</span><span class="op" id="5249491">.</span><span class="ident" id="5249492">line</span><span class="op" id="5249496">[</span><span class="num" id="5249497">1</span><span class="op" id="5249498">:</span><span class="op" id="5249499">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5249503">n</span><span class="op" id="5249504">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5249508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5249511">return</span>&nbsp;<span class="ident" id="5249518">n</span><span class="op" id="5249519">,</span>&nbsp;<span class="ident" id="5249521">nil</span><br>
<span class="lineno"></span><span class="op" id="5249525">}</span>
</div>
</body>
</html>
