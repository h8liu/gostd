<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3677438">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3677493">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3677547">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3677598">package</span>&nbsp;<span class="ident" id="3677606">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3677617">import</span>&nbsp;<span class="op" id="3677624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677627">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677636">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677651">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677661">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677668">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677674">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3677691">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3677701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677704">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3677746">type</span>&nbsp;<span class="ident" id="3677751">Writer</span>&nbsp;<span class="keyword" id="3677758">struct</span>&nbsp;<span class="op" id="3677765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677768">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677777">io</span><span class="op" id="3677779">.</span><span class="ident" id="3677780">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677788">boundary</span>&nbsp;<span class="builtintype" id="3677797">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677805">lastpart</span>&nbsp;<span class="op" id="3677814">*</span><span class="ident" id="3677815">part</span><br>
<span class="lineno"></span><span class="op" id="3677820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677823">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3677891">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3677908">func</span>&nbsp;<span class="ident" id="3677913">NewWriter</span><span class="op" id="3677922">(</span><span class="ident" id="3677923">w</span>&nbsp;<span class="ident" id="3677925">io</span><span class="op" id="3677927">.</span><span class="ident" id="3677928">Writer</span><span class="op" id="3677934">)</span>&nbsp;<span class="op" id="3677936">*</span><span class="ident" id="3677937">Writer</span>&nbsp;<span class="op" id="3677944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677947">return</span>&nbsp;<span class="op" id="3677954">&amp;</span><span class="ident" id="3677955">Writer</span><span class="op" id="3677961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677965">w</span><span class="op" id="3677966">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677975">w</span><span class="op" id="3677976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677980">boundary</span><span class="op" id="3677988">:</span>&nbsp;<span class="ident" id="3677990">randomBoundary</span><span class="op" id="3678004">(</span><span class="op" id="3678005">)</span><span class="op" id="3678006">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678009">}</span><br>
<span class="lineno"></span><span class="op" id="3678011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678014">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3678057">func</span>&nbsp;<span class="op" id="3678062">(</span><span class="ident" id="3678063">w</span>&nbsp;<span class="op" id="3678065">*</span><span class="ident" id="3678066">Writer</span><span class="op" id="3678072">)</span>&nbsp;<span class="ident" id="3678074">Boundary</span><span class="op" id="3678082">(</span><span class="op" id="3678083">)</span>&nbsp;<span class="builtintype" id="3678085">string</span>&nbsp;<span class="op" id="3678092">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678095">return</span>&nbsp;<span class="ident" id="3678102">w</span><span class="op" id="3678103">.</span><span class="ident" id="3678104">boundary</span><br>
<span class="lineno"></span><span class="op" id="3678113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678116">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3678181">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3678227">//</span><br>
<span class="lineno"></span><span class="comment" id="3678230">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3678299">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3678365">func</span>&nbsp;<span class="op" id="3678370">(</span><span class="ident" id="3678371">w</span>&nbsp;<span class="op" id="3678373">*</span><span class="ident" id="3678374">Writer</span><span class="op" id="3678380">)</span>&nbsp;<span class="ident" id="3678382">SetBoundary</span><span class="op" id="3678393">(</span><span class="ident" id="3678394">boundary</span>&nbsp;<span class="builtintype" id="3678403">string</span><span class="op" id="3678409">)</span>&nbsp;<span class="builtintype" id="3678411">error</span>&nbsp;<span class="op" id="3678417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678420">if</span>&nbsp;<span class="ident" id="3678423">w</span><span class="op" id="3678424">.</span><span class="ident" id="3678425">lastpart</span>&nbsp;<span class="op" id="3678434">!=</span>&nbsp;<span class="ident" id="3678437">nil</span>&nbsp;<span class="op" id="3678441">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678445">return</span>&nbsp;<span class="ident" id="3678452">errors</span><span class="op" id="3678458">.</span><span class="ident" id="3678459">New</span><span class="op" id="3678462">(</span><span class="string" id="3678463">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3678501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3678507">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678533">if</span>&nbsp;<span class="builtinfunc" id="3678536">len</span><span class="op" id="3678539">(</span><span class="ident" id="3678540">boundary</span><span class="op" id="3678548">)</span>&nbsp;<span class="op" id="3678550">&lt;</span>&nbsp;<span class="num" id="3678552">1</span>&nbsp;<span class="op" id="3678554">||</span>&nbsp;<span class="builtinfunc" id="3678557">len</span><span class="op" id="3678560">(</span><span class="ident" id="3678561">boundary</span><span class="op" id="3678569">)</span>&nbsp;<span class="op" id="3678571">&gt;</span>&nbsp;<span class="num" id="3678573">69</span>&nbsp;<span class="op" id="3678576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678580">return</span>&nbsp;<span class="ident" id="3678587">errors</span><span class="op" id="3678593">.</span><span class="ident" id="3678594">New</span><span class="op" id="3678597">(</span><span class="string" id="3678598">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3678629">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678635">for</span>&nbsp;<span class="ident" id="3678639">_</span><span class="op" id="3678640">,</span>&nbsp;<span class="ident" id="3678642">b</span>&nbsp;<span class="op" id="3678644">:=</span>&nbsp;<span class="keyword" id="3678647">range</span>&nbsp;<span class="ident" id="3678653">boundary</span>&nbsp;<span class="op" id="3678662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678666">if</span>&nbsp;<span class="string" id="3678669">&#39;A&#39;</span>&nbsp;<span class="op" id="3678673">&lt;=</span>&nbsp;<span class="ident" id="3678676">b</span>&nbsp;<span class="op" id="3678678">&amp;&amp;</span>&nbsp;<span class="ident" id="3678681">b</span>&nbsp;<span class="op" id="3678683">&lt;=</span>&nbsp;<span class="string" id="3678686">&#39;Z&#39;</span>&nbsp;<span class="op" id="3678690">||</span>&nbsp;<span class="string" id="3678693">&#39;a&#39;</span>&nbsp;<span class="op" id="3678697">&lt;=</span>&nbsp;<span class="ident" id="3678700">b</span>&nbsp;<span class="op" id="3678702">&amp;&amp;</span>&nbsp;<span class="ident" id="3678705">b</span>&nbsp;<span class="op" id="3678707">&lt;=</span>&nbsp;<span class="string" id="3678710">&#39;z&#39;</span>&nbsp;<span class="op" id="3678714">||</span>&nbsp;<span class="string" id="3678717">&#39;0&#39;</span>&nbsp;<span class="op" id="3678721">&lt;=</span>&nbsp;<span class="ident" id="3678724">b</span>&nbsp;<span class="op" id="3678726">&amp;&amp;</span>&nbsp;<span class="ident" id="3678729">b</span>&nbsp;<span class="op" id="3678731">&lt;=</span>&nbsp;<span class="string" id="3678734">&#39;9&#39;</span>&nbsp;<span class="op" id="3678738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678743">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678754">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678758">switch</span>&nbsp;<span class="ident" id="3678765">b</span>&nbsp;<span class="op" id="3678767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678771">case</span>&nbsp;<span class="string" id="3678776">&#39;\&#39;&#39;</span><span class="op" id="3678780">,</span>&nbsp;<span class="string" id="3678782">&#39;(&#39;</span><span class="op" id="3678785">,</span>&nbsp;<span class="string" id="3678787">&#39;)&#39;</span><span class="op" id="3678790">,</span>&nbsp;<span class="string" id="3678792">&#39;+&#39;</span><span class="op" id="3678795">,</span>&nbsp;<span class="string" id="3678797">&#39;_&#39;</span><span class="op" id="3678800">,</span>&nbsp;<span class="string" id="3678802">&#39;,&#39;</span><span class="op" id="3678805">,</span>&nbsp;<span class="string" id="3678807">&#39;-&#39;</span><span class="op" id="3678810">,</span>&nbsp;<span class="string" id="3678812">&#39;.&#39;</span><span class="op" id="3678815">,</span>&nbsp;<span class="string" id="3678817">&#39;/&#39;</span><span class="op" id="3678820">,</span>&nbsp;<span class="string" id="3678822">&#39;:&#39;</span><span class="op" id="3678825">,</span>&nbsp;<span class="string" id="3678827">&#39;=&#39;</span><span class="op" id="3678830">,</span>&nbsp;<span class="string" id="3678832">&#39;?&#39;</span><span class="op" id="3678835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678840">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678855">return</span>&nbsp;<span class="ident" id="3678862">errors</span><span class="op" id="3678868">.</span><span class="ident" id="3678869">New</span><span class="op" id="3678872">(</span><span class="string" id="3678873">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3678907">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678913">w</span><span class="op" id="3678914">.</span><span class="ident" id="3678915">boundary</span>&nbsp;<span class="op" id="3678924">=</span>&nbsp;<span class="ident" id="3678926">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678936">return</span>&nbsp;<span class="ident" id="3678943">nil</span><br>
<span class="lineno"></span><span class="op" id="3678947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3678950">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3679010">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3679062">func</span>&nbsp;<span class="op" id="3679067">(</span><span class="ident" id="3679068">w</span>&nbsp;<span class="op" id="3679070">*</span><span class="ident" id="3679071">Writer</span><span class="op" id="3679077">)</span>&nbsp;<span class="ident" id="3679079">FormDataContentType</span><span class="op" id="3679098">(</span><span class="op" id="3679099">)</span>&nbsp;<span class="builtintype" id="3679101">string</span>&nbsp;<span class="op" id="3679108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679111">return</span>&nbsp;<span class="string" id="3679118">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3679151">+</span>&nbsp;<span class="ident" id="3679153">w</span><span class="op" id="3679154">.</span><span class="ident" id="3679155">boundary</span><br>
<span class="lineno"></span><span class="op" id="3679164">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3679167">func</span>&nbsp;<span class="ident" id="3679172">randomBoundary</span><span class="op" id="3679186">(</span><span class="op" id="3679187">)</span>&nbsp;<span class="builtintype" id="3679189">string</span>&nbsp;<span class="op" id="3679196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679199">var</span>&nbsp;<span class="ident" id="3679203">buf</span>&nbsp;<span class="op" id="3679207">[</span><span class="num" id="3679208">30</span><span class="op" id="3679210">]</span><span class="builtintype" id="3679211">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3679217">_</span><span class="op" id="3679218">,</span>&nbsp;<span class="ident" id="3679220">err</span>&nbsp;<span class="op" id="3679224">:=</span>&nbsp;<span class="ident" id="3679227">io</span><span class="op" id="3679229">.</span><span class="ident" id="3679230">ReadFull</span><span class="op" id="3679238">(</span><span class="ident" id="3679239">rand</span><span class="op" id="3679243">.</span><span class="ident" id="3679244">Reader</span><span class="op" id="3679250">,</span>&nbsp;<span class="ident" id="3679252">buf</span><span class="op" id="3679255">[</span><span class="op" id="3679256">:</span><span class="op" id="3679257">]</span><span class="op" id="3679258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679261">if</span>&nbsp;<span class="ident" id="3679264">err</span>&nbsp;<span class="op" id="3679268">!=</span>&nbsp;<span class="ident" id="3679271">nil</span>&nbsp;<span class="op" id="3679275">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3679279">panic</span><span class="op" id="3679284">(</span><span class="ident" id="3679285">err</span><span class="op" id="3679288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679294">return</span>&nbsp;<span class="ident" id="3679301">fmt</span><span class="op" id="3679304">.</span><span class="ident" id="3679305">Sprintf</span><span class="op" id="3679312">(</span><span class="string" id="3679313">&#34;%x&#34;</span><span class="op" id="3679317">,</span>&nbsp;<span class="ident" id="3679319">buf</span><span class="op" id="3679322">[</span><span class="op" id="3679323">:</span><span class="op" id="3679324">]</span><span class="op" id="3679325">)</span><br>
<span class="lineno"></span><span class="op" id="3679327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3679330">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3679394">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3679460">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3679529">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3679547">func</span>&nbsp;<span class="op" id="3679552">(</span><span class="ident" id="3679553">w</span>&nbsp;<span class="op" id="3679555">*</span><span class="ident" id="3679556">Writer</span><span class="op" id="3679562">)</span>&nbsp;<span class="ident" id="3679564">CreatePart</span><span class="op" id="3679574">(</span><span class="ident" id="3679575">header</span>&nbsp;<span class="ident" id="3679582">textproto</span><span class="op" id="3679591">.</span><span class="ident" id="3679592">MIMEHeader</span><span class="op" id="3679602">)</span>&nbsp;<span class="op" id="3679604">(</span><span class="ident" id="3679605">io</span><span class="op" id="3679607">.</span><span class="ident" id="3679608">Writer</span><span class="op" id="3679614">,</span>&nbsp;<span class="builtintype" id="3679616">error</span><span class="op" id="3679621">)</span>&nbsp;<span class="op" id="3679623">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679626">if</span>&nbsp;<span class="ident" id="3679629">w</span><span class="op" id="3679630">.</span><span class="ident" id="3679631">lastpart</span>&nbsp;<span class="op" id="3679640">!=</span>&nbsp;<span class="ident" id="3679643">nil</span>&nbsp;<span class="op" id="3679647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679651">if</span>&nbsp;<span class="ident" id="3679654">err</span>&nbsp;<span class="op" id="3679658">:=</span>&nbsp;<span class="ident" id="3679661">w</span><span class="op" id="3679662">.</span><span class="ident" id="3679663">lastpart</span><span class="op" id="3679671">.</span><span class="builtinfunc" id="3679672">close</span><span class="op" id="3679677">(</span><span class="op" id="3679678">)</span><span class="op" id="3679679">;</span>&nbsp;<span class="ident" id="3679681">err</span>&nbsp;<span class="op" id="3679685">!=</span>&nbsp;<span class="ident" id="3679688">nil</span>&nbsp;<span class="op" id="3679692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679697">return</span>&nbsp;<span class="ident" id="3679704">nil</span><span class="op" id="3679707">,</span>&nbsp;<span class="ident" id="3679709">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679718">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679721">var</span>&nbsp;<span class="ident" id="3679725">b</span>&nbsp;<span class="ident" id="3679727">bytes</span><span class="op" id="3679732">.</span><span class="ident" id="3679733">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679741">if</span>&nbsp;<span class="ident" id="3679744">w</span><span class="op" id="3679745">.</span><span class="ident" id="3679746">lastpart</span>&nbsp;<span class="op" id="3679755">!=</span>&nbsp;<span class="ident" id="3679758">nil</span>&nbsp;<span class="op" id="3679762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3679766">fmt</span><span class="op" id="3679769">.</span><span class="ident" id="3679770">Fprintf</span><span class="op" id="3679777">(</span><span class="op" id="3679778">&amp;</span><span class="ident" id="3679779">b</span><span class="op" id="3679780">,</span>&nbsp;<span class="string" id="3679782">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3679796">,</span>&nbsp;<span class="ident" id="3679798">w</span><span class="op" id="3679799">.</span><span class="ident" id="3679800">boundary</span><span class="op" id="3679808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679811">}</span>&nbsp;<span class="keyword" id="3679813">else</span>&nbsp;<span class="op" id="3679818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3679822">fmt</span><span class="op" id="3679825">.</span><span class="ident" id="3679826">Fprintf</span><span class="op" id="3679833">(</span><span class="op" id="3679834">&amp;</span><span class="ident" id="3679835">b</span><span class="op" id="3679836">,</span>&nbsp;<span class="string" id="3679838">&#34;--%s\r\n&#34;</span><span class="op" id="3679848">,</span>&nbsp;<span class="ident" id="3679850">w</span><span class="op" id="3679851">.</span><span class="ident" id="3679852">boundary</span><span class="op" id="3679860">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3679866">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3679943">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679990">for</span>&nbsp;<span class="ident" id="3679994">k</span><span class="op" id="3679995">,</span>&nbsp;<span class="ident" id="3679997">vv</span>&nbsp;<span class="op" id="3680000">:=</span>&nbsp;<span class="keyword" id="3680003">range</span>&nbsp;<span class="ident" id="3680009">header</span>&nbsp;<span class="op" id="3680016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680020">for</span>&nbsp;<span class="ident" id="3680024">_</span><span class="op" id="3680025">,</span>&nbsp;<span class="ident" id="3680027">v</span>&nbsp;<span class="op" id="3680029">:=</span>&nbsp;<span class="keyword" id="3680032">range</span>&nbsp;<span class="ident" id="3680038">vv</span>&nbsp;<span class="op" id="3680041">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680046">fmt</span><span class="op" id="3680049">.</span><span class="ident" id="3680050">Fprintf</span><span class="op" id="3680057">(</span><span class="op" id="3680058">&amp;</span><span class="ident" id="3680059">b</span><span class="op" id="3680060">,</span>&nbsp;<span class="string" id="3680062">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3680074">,</span>&nbsp;<span class="ident" id="3680076">k</span><span class="op" id="3680077">,</span>&nbsp;<span class="ident" id="3680079">v</span><span class="op" id="3680080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680090">fmt</span><span class="op" id="3680093">.</span><span class="ident" id="3680094">Fprintf</span><span class="op" id="3680101">(</span><span class="op" id="3680102">&amp;</span><span class="ident" id="3680103">b</span><span class="op" id="3680104">,</span>&nbsp;<span class="string" id="3680106">&#34;\r\n&#34;</span><span class="op" id="3680112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680115">_</span><span class="op" id="3680116">,</span>&nbsp;<span class="ident" id="3680118">err</span>&nbsp;<span class="op" id="3680122">:=</span>&nbsp;<span class="ident" id="3680125">io</span><span class="op" id="3680127">.</span><span class="ident" id="3680128">Copy</span><span class="op" id="3680132">(</span><span class="ident" id="3680133">w</span><span class="op" id="3680134">.</span><span class="ident" id="3680135">w</span><span class="op" id="3680136">,</span>&nbsp;<span class="op" id="3680138">&amp;</span><span class="ident" id="3680139">b</span><span class="op" id="3680140">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680143">if</span>&nbsp;<span class="ident" id="3680146">err</span>&nbsp;<span class="op" id="3680150">!=</span>&nbsp;<span class="ident" id="3680153">nil</span>&nbsp;<span class="op" id="3680157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680161">return</span>&nbsp;<span class="ident" id="3680168">nil</span><span class="op" id="3680171">,</span>&nbsp;<span class="ident" id="3680173">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680181">p</span>&nbsp;<span class="op" id="3680183">:=</span>&nbsp;<span class="op" id="3680186">&amp;</span><span class="ident" id="3680187">part</span><span class="op" id="3680191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680195">mw</span><span class="op" id="3680197">:</span>&nbsp;<span class="ident" id="3680199">w</span><span class="op" id="3680200">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680206">w</span><span class="op" id="3680207">.</span><span class="ident" id="3680208">lastpart</span>&nbsp;<span class="op" id="3680217">=</span>&nbsp;<span class="ident" id="3680219">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680222">return</span>&nbsp;<span class="ident" id="3680229">p</span><span class="op" id="3680230">,</span>&nbsp;<span class="ident" id="3680232">nil</span><br>
<span class="lineno"></span><span class="op" id="3680236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3680239">var</span>&nbsp;<span class="ident" id="3680243">quoteEscaper</span>&nbsp;<span class="op" id="3680256">=</span>&nbsp;<span class="ident" id="3680258">strings</span><span class="op" id="3680265">.</span><span class="ident" id="3680266">NewReplacer</span><span class="op" id="3680277">(</span><span class="string" id="3680278">&#34;\\&#34;</span><span class="op" id="3680282">,</span>&nbsp;<span class="string" id="3680284">&#34;\\\\&#34;</span><span class="op" id="3680290">,</span>&nbsp;<span class="string" id="3680292">`&#34;`</span><span class="op" id="3680295">,</span>&nbsp;<span class="string" id="3680297">&#34;\\\&#34;&#34;</span><span class="op" id="3680303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3680306">func</span>&nbsp;<span class="ident" id="3680311">escapeQuotes</span><span class="op" id="3680323">(</span><span class="ident" id="3680324">s</span>&nbsp;<span class="builtintype" id="3680326">string</span><span class="op" id="3680332">)</span>&nbsp;<span class="builtintype" id="3680334">string</span>&nbsp;<span class="op" id="3680341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680344">return</span>&nbsp;<span class="ident" id="3680351">quoteEscaper</span><span class="op" id="3680363">.</span><span class="ident" id="3680364">Replace</span><span class="op" id="3680371">(</span><span class="ident" id="3680372">s</span><span class="op" id="3680373">)</span><br>
<span class="lineno"></span><span class="op" id="3680375">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3680378">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3680451">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3680521">func</span>&nbsp;<span class="op" id="3680526">(</span><span class="ident" id="3680527">w</span>&nbsp;<span class="op" id="3680529">*</span><span class="ident" id="3680530">Writer</span><span class="op" id="3680536">)</span>&nbsp;<span class="ident" id="3680538">CreateFormFile</span><span class="op" id="3680552">(</span><span class="ident" id="3680553">fieldname</span><span class="op" id="3680562">,</span>&nbsp;<span class="ident" id="3680564">filename</span>&nbsp;<span class="builtintype" id="3680573">string</span><span class="op" id="3680579">)</span>&nbsp;<span class="op" id="3680581">(</span><span class="ident" id="3680582">io</span><span class="op" id="3680584">.</span><span class="ident" id="3680585">Writer</span><span class="op" id="3680591">,</span>&nbsp;<span class="builtintype" id="3680593">error</span><span class="op" id="3680598">)</span>&nbsp;<span class="op" id="3680600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680603">h</span>&nbsp;<span class="op" id="3680605">:=</span>&nbsp;<span class="builtinfunc" id="3680608">make</span><span class="op" id="3680612">(</span><span class="ident" id="3680613">textproto</span><span class="op" id="3680622">.</span><span class="ident" id="3680623">MIMEHeader</span><span class="op" id="3680633">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680636">h</span><span class="op" id="3680637">.</span><span class="ident" id="3680638">Set</span><span class="op" id="3680641">(</span><span class="string" id="3680642">&#34;Content-Disposition&#34;</span><span class="op" id="3680663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680667">fmt</span><span class="op" id="3680670">.</span><span class="ident" id="3680671">Sprintf</span><span class="op" id="3680678">(</span><span class="string" id="3680679">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3680716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680721">escapeQuotes</span><span class="op" id="3680733">(</span><span class="ident" id="3680734">fieldname</span><span class="op" id="3680743">)</span><span class="op" id="3680744">,</span>&nbsp;<span class="ident" id="3680746">escapeQuotes</span><span class="op" id="3680758">(</span><span class="ident" id="3680759">filename</span><span class="op" id="3680767">)</span><span class="op" id="3680768">)</span><span class="op" id="3680769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680772">h</span><span class="op" id="3680773">.</span><span class="ident" id="3680774">Set</span><span class="op" id="3680777">(</span><span class="string" id="3680778">&#34;Content-Type&#34;</span><span class="op" id="3680792">,</span>&nbsp;<span class="string" id="3680794">&#34;application/octet-stream&#34;</span><span class="op" id="3680820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680823">return</span>&nbsp;<span class="ident" id="3680830">w</span><span class="op" id="3680831">.</span><span class="ident" id="3680832">CreatePart</span><span class="op" id="3680842">(</span><span class="ident" id="3680843">h</span><span class="op" id="3680844">)</span><br>
<span class="lineno">130</span><span class="op" id="3680846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3680849">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3680909">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3680930">func</span>&nbsp;<span class="op" id="3680935">(</span><span class="ident" id="3680936">w</span>&nbsp;<span class="op" id="3680938">*</span><span class="ident" id="3680939">Writer</span><span class="op" id="3680945">)</span>&nbsp;<span class="ident" id="3680947">CreateFormField</span><span class="op" id="3680962">(</span><span class="ident" id="3680963">fieldname</span>&nbsp;<span class="builtintype" id="3680973">string</span><span class="op" id="3680979">)</span>&nbsp;<span class="op" id="3680981">(</span><span class="ident" id="3680982">io</span><span class="op" id="3680984">.</span><span class="ident" id="3680985">Writer</span><span class="op" id="3680991">,</span>&nbsp;<span class="builtintype" id="3680993">error</span><span class="op" id="3680998">)</span>&nbsp;<span class="op" id="3681000">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681003">h</span>&nbsp;<span class="op" id="3681005">:=</span>&nbsp;<span class="builtinfunc" id="3681008">make</span><span class="op" id="3681012">(</span><span class="ident" id="3681013">textproto</span><span class="op" id="3681022">.</span><span class="ident" id="3681023">MIMEHeader</span><span class="op" id="3681033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681036">h</span><span class="op" id="3681037">.</span><span class="ident" id="3681038">Set</span><span class="op" id="3681041">(</span><span class="string" id="3681042">&#34;Content-Disposition&#34;</span><span class="op" id="3681063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681067">fmt</span><span class="op" id="3681070">.</span><span class="ident" id="3681071">Sprintf</span><span class="op" id="3681078">(</span><span class="string" id="3681079">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3681101">,</span>&nbsp;<span class="ident" id="3681103">escapeQuotes</span><span class="op" id="3681115">(</span><span class="ident" id="3681116">fieldname</span><span class="op" id="3681125">)</span><span class="op" id="3681126">)</span><span class="op" id="3681127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681130">return</span>&nbsp;<span class="ident" id="3681137">w</span><span class="op" id="3681138">.</span><span class="ident" id="3681139">CreatePart</span><span class="op" id="3681149">(</span><span class="ident" id="3681150">h</span><span class="op" id="3681151">)</span><br>
<span class="lineno"></span><span class="op" id="3681153">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3681156">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3681225">func</span>&nbsp;<span class="op" id="3681230">(</span><span class="ident" id="3681231">w</span>&nbsp;<span class="op" id="3681233">*</span><span class="ident" id="3681234">Writer</span><span class="op" id="3681240">)</span>&nbsp;<span class="ident" id="3681242">WriteField</span><span class="op" id="3681252">(</span><span class="ident" id="3681253">fieldname</span><span class="op" id="3681262">,</span>&nbsp;<span class="ident" id="3681264">value</span>&nbsp;<span class="builtintype" id="3681270">string</span><span class="op" id="3681276">)</span>&nbsp;<span class="builtintype" id="3681278">error</span>&nbsp;<span class="op" id="3681284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681287">p</span><span class="op" id="3681288">,</span>&nbsp;<span class="ident" id="3681290">err</span>&nbsp;<span class="op" id="3681294">:=</span>&nbsp;<span class="ident" id="3681297">w</span><span class="op" id="3681298">.</span><span class="ident" id="3681299">CreateFormField</span><span class="op" id="3681314">(</span><span class="ident" id="3681315">fieldname</span><span class="op" id="3681324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681327">if</span>&nbsp;<span class="ident" id="3681330">err</span>&nbsp;<span class="op" id="3681334">!=</span>&nbsp;<span class="ident" id="3681337">nil</span>&nbsp;<span class="op" id="3681341">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681345">return</span>&nbsp;<span class="ident" id="3681352">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681360">_</span><span class="op" id="3681361">,</span>&nbsp;<span class="ident" id="3681363">err</span>&nbsp;<span class="op" id="3681367">=</span>&nbsp;<span class="ident" id="3681369">p</span><span class="op" id="3681370">.</span><span class="ident" id="3681371">Write</span><span class="op" id="3681376">(</span><span class="op" id="3681377">[</span><span class="op" id="3681378">]</span><span class="builtintype" id="3681379">byte</span><span class="op" id="3681383">(</span><span class="ident" id="3681384">value</span><span class="op" id="3681389">)</span><span class="op" id="3681390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681393">return</span>&nbsp;<span class="ident" id="3681400">err</span><br>
<span class="lineno"></span><span class="op" id="3681404">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3681407">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3681471">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3681507">func</span>&nbsp;<span class="op" id="3681512">(</span><span class="ident" id="3681513">w</span>&nbsp;<span class="op" id="3681515">*</span><span class="ident" id="3681516">Writer</span><span class="op" id="3681522">)</span>&nbsp;<span class="ident" id="3681524">Close</span><span class="op" id="3681529">(</span><span class="op" id="3681530">)</span>&nbsp;<span class="builtintype" id="3681532">error</span>&nbsp;<span class="op" id="3681538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681541">if</span>&nbsp;<span class="ident" id="3681544">w</span><span class="op" id="3681545">.</span><span class="ident" id="3681546">lastpart</span>&nbsp;<span class="op" id="3681555">!=</span>&nbsp;<span class="ident" id="3681558">nil</span>&nbsp;<span class="op" id="3681562">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681566">if</span>&nbsp;<span class="ident" id="3681569">err</span>&nbsp;<span class="op" id="3681573">:=</span>&nbsp;<span class="ident" id="3681576">w</span><span class="op" id="3681577">.</span><span class="ident" id="3681578">lastpart</span><span class="op" id="3681586">.</span><span class="builtinfunc" id="3681587">close</span><span class="op" id="3681592">(</span><span class="op" id="3681593">)</span><span class="op" id="3681594">;</span>&nbsp;<span class="ident" id="3681596">err</span>&nbsp;<span class="op" id="3681600">!=</span>&nbsp;<span class="ident" id="3681603">nil</span>&nbsp;<span class="op" id="3681607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681612">return</span>&nbsp;<span class="ident" id="3681619">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681629">w</span><span class="op" id="3681630">.</span><span class="ident" id="3681631">lastpart</span>&nbsp;<span class="op" id="3681640">=</span>&nbsp;<span class="ident" id="3681642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681647">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681650">_</span><span class="op" id="3681651">,</span>&nbsp;<span class="ident" id="3681653">err</span>&nbsp;<span class="op" id="3681657">:=</span>&nbsp;<span class="ident" id="3681660">fmt</span><span class="op" id="3681663">.</span><span class="ident" id="3681664">Fprintf</span><span class="op" id="3681671">(</span><span class="ident" id="3681672">w</span><span class="op" id="3681673">.</span><span class="ident" id="3681674">w</span><span class="op" id="3681675">,</span>&nbsp;<span class="string" id="3681677">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3681693">,</span>&nbsp;<span class="ident" id="3681695">w</span><span class="op" id="3681696">.</span><span class="ident" id="3681697">boundary</span><span class="op" id="3681705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681708">return</span>&nbsp;<span class="ident" id="3681715">err</span><br>
<span class="lineno"></span><span class="op" id="3681719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3681722">type</span>&nbsp;<span class="ident" id="3681727">part</span>&nbsp;<span class="keyword" id="3681732">struct</span>&nbsp;<span class="op" id="3681739">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681742">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681749">*</span><span class="ident" id="3681750">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681758">closed</span>&nbsp;<span class="builtintype" id="3681765">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681771">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3681778">error</span>&nbsp;<span class="comment" id="3681784">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3681820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3681823">func</span>&nbsp;<span class="op" id="3681828">(</span><span class="ident" id="3681829">p</span>&nbsp;<span class="op" id="3681831">*</span><span class="ident" id="3681832">part</span><span class="op" id="3681836">)</span>&nbsp;<span class="builtinfunc" id="3681838">close</span><span class="op" id="3681843">(</span><span class="op" id="3681844">)</span>&nbsp;<span class="builtintype" id="3681846">error</span>&nbsp;<span class="op" id="3681852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681855">p</span><span class="op" id="3681856">.</span><span class="ident" id="3681857">closed</span>&nbsp;<span class="op" id="3681864">=</span>&nbsp;<span class="builtintype" id="3681866">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681872">return</span>&nbsp;<span class="ident" id="3681879">p</span><span class="op" id="3681880">.</span><span class="ident" id="3681881">we</span><br>
<span class="lineno"></span><span class="op" id="3681884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3681887">func</span>&nbsp;<span class="op" id="3681892">(</span><span class="ident" id="3681893">p</span>&nbsp;<span class="op" id="3681895">*</span><span class="ident" id="3681896">part</span><span class="op" id="3681900">)</span>&nbsp;<span class="ident" id="3681902">Write</span><span class="op" id="3681907">(</span><span class="ident" id="3681908">d</span>&nbsp;<span class="op" id="3681910">[</span><span class="op" id="3681911">]</span><span class="builtintype" id="3681912">byte</span><span class="op" id="3681916">)</span>&nbsp;<span class="op" id="3681918">(</span><span class="ident" id="3681919">n</span>&nbsp;<span class="builtintype" id="3681921">int</span><span class="op" id="3681924">,</span>&nbsp;<span class="ident" id="3681926">err</span>&nbsp;<span class="builtintype" id="3681930">error</span><span class="op" id="3681935">)</span>&nbsp;<span class="op" id="3681937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681940">if</span>&nbsp;<span class="ident" id="3681943">p</span><span class="op" id="3681944">.</span><span class="ident" id="3681945">closed</span>&nbsp;<span class="op" id="3681952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681956">return</span>&nbsp;<span class="num" id="3681963">0</span><span class="op" id="3681964">,</span>&nbsp;<span class="ident" id="3681966">errors</span><span class="op" id="3681972">.</span><span class="ident" id="3681973">New</span><span class="op" id="3681976">(</span><span class="string" id="3681977">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3682018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682024">n</span><span class="op" id="3682025">,</span>&nbsp;<span class="ident" id="3682027">err</span>&nbsp;<span class="op" id="3682031">=</span>&nbsp;<span class="ident" id="3682033">p</span><span class="op" id="3682034">.</span><span class="ident" id="3682035">mw</span><span class="op" id="3682037">.</span><span class="ident" id="3682038">w</span><span class="op" id="3682039">.</span><span class="ident" id="3682040">Write</span><span class="op" id="3682045">(</span><span class="ident" id="3682046">d</span><span class="op" id="3682047">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682050">if</span>&nbsp;<span class="ident" id="3682053">err</span>&nbsp;<span class="op" id="3682057">!=</span>&nbsp;<span class="ident" id="3682060">nil</span>&nbsp;<span class="op" id="3682064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682068">p</span><span class="op" id="3682069">.</span><span class="ident" id="3682070">we</span>&nbsp;<span class="op" id="3682073">=</span>&nbsp;<span class="ident" id="3682075">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682083">return</span><br>
<span class="lineno"></span><span class="op" id="3682090">}</span>
</div>
</body>
</html>
