<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html" class="current">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6590053">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6590108">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6590162">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6590213">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590278">package</span>&nbsp;<span class="ident" id="6590286">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590291">import</span>&nbsp;<span class="op" id="6590298">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590301">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590307">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590320">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590326">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590334">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590345">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6590356">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6590363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590366">var</span>&nbsp;<span class="ident" id="6590370">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6590396">=</span>&nbsp;<span class="op" id="6590398">[</span><span class="op" id="6590399">]</span><span class="keyword" id="6590400">struct</span>&nbsp;<span class="op" id="6590407">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590410">server</span>&nbsp;&nbsp;<span class="builtintype" id="6590418">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590426">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6590434">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590442">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6590450">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590458">timeout</span>&nbsp;<span class="builtintype" id="6590466">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590471">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6590479">int</span><br>
<span class="lineno">25</span><span class="op" id="6590483">}</span><span class="op" id="6590484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6590487">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6590546">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590586">{</span><span class="string" id="6590587">&#34;8.8.8.8:53&#34;</span><span class="op" id="6590599">,</span>&nbsp;<span class="string" id="6590601">&#34;com.&#34;</span><span class="op" id="6590607">,</span>&nbsp;<span class="ident" id="6590609">dnsTypeALL</span><span class="op" id="6590619">,</span>&nbsp;<span class="num" id="6590621">2</span><span class="op" id="6590622">,</span>&nbsp;<span class="ident" id="6590624">dnsRcodeSuccess</span><span class="op" id="6590639">}</span><span class="op" id="6590640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590643">{</span><span class="string" id="6590644">&#34;8.8.4.4:53&#34;</span><span class="op" id="6590656">,</span>&nbsp;<span class="string" id="6590658">&#34;com.&#34;</span><span class="op" id="6590664">,</span>&nbsp;<span class="ident" id="6590666">dnsTypeALL</span><span class="op" id="6590676">,</span>&nbsp;<span class="num" id="6590678">4</span><span class="op" id="6590679">,</span>&nbsp;<span class="ident" id="6590681">dnsRcodeSuccess</span><span class="op" id="6590696">}</span><span class="op" id="6590697">,</span><br>
<span class="lineno">30</span><span class="op" id="6590699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590702">func</span>&nbsp;<span class="ident" id="6590707">TestDNSTransportFallback</span><span class="op" id="6590731">(</span><span class="ident" id="6590732">t</span>&nbsp;<span class="op" id="6590734">*</span><span class="ident" id="6590735">testing</span><span class="op" id="6590742">.</span><span class="ident" id="6590743">T</span><span class="op" id="6590744">)</span>&nbsp;<span class="op" id="6590746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590749">if</span>&nbsp;<span class="ident" id="6590752">testing</span><span class="op" id="6590759">.</span><span class="ident" id="6590760">Short</span><span class="op" id="6590765">(</span><span class="op" id="6590766">)</span>&nbsp;<span class="op" id="6590768">||</span>&nbsp;<span class="op" id="6590771">!</span><span class="op" id="6590772">*</span><span class="ident" id="6590773">testExternal</span>&nbsp;<span class="op" id="6590786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590790">t</span><span class="op" id="6590791">.</span><span class="ident" id="6590792">Skip</span><span class="op" id="6590796">(</span><span class="string" id="6590797">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6590838">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590845">for</span>&nbsp;<span class="ident" id="6590849">_</span><span class="op" id="6590850">,</span>&nbsp;<span class="ident" id="6590852">tt</span>&nbsp;<span class="op" id="6590855">:=</span>&nbsp;<span class="keyword" id="6590858">range</span>&nbsp;<span class="ident" id="6590864">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6590890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590894">timeout</span>&nbsp;<span class="op" id="6590902">:=</span>&nbsp;<span class="ident" id="6590905">time</span><span class="op" id="6590909">.</span><span class="ident" id="6590910">Duration</span><span class="op" id="6590918">(</span><span class="ident" id="6590919">tt</span><span class="op" id="6590921">.</span><span class="ident" id="6590922">timeout</span><span class="op" id="6590929">)</span>&nbsp;<span class="op" id="6590931">*</span>&nbsp;<span class="ident" id="6590933">time</span><span class="op" id="6590937">.</span><span class="ident" id="6590938">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590947">msg</span><span class="op" id="6590950">,</span>&nbsp;<span class="ident" id="6590952">err</span>&nbsp;<span class="op" id="6590956">:=</span>&nbsp;<span class="ident" id="6590959">exchange</span><span class="op" id="6590967">(</span><span class="ident" id="6590968">tt</span><span class="op" id="6590970">.</span><span class="ident" id="6590971">server</span><span class="op" id="6590977">,</span>&nbsp;<span class="ident" id="6590979">tt</span><span class="op" id="6590981">.</span><span class="ident" id="6590982">name</span><span class="op" id="6590986">,</span>&nbsp;<span class="ident" id="6590988">tt</span><span class="op" id="6590990">.</span><span class="ident" id="6590991">qtype</span><span class="op" id="6590996">,</span>&nbsp;<span class="ident" id="6590998">timeout</span><span class="op" id="6591005">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591009">if</span>&nbsp;<span class="ident" id="6591012">err</span>&nbsp;<span class="op" id="6591016">!=</span>&nbsp;<span class="ident" id="6591019">nil</span>&nbsp;<span class="op" id="6591023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591028">t</span><span class="op" id="6591029">.</span><span class="ident" id="6591030">Error</span><span class="op" id="6591035">(</span><span class="ident" id="6591036">err</span><span class="op" id="6591039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591044">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591059">switch</span>&nbsp;<span class="ident" id="6591066">msg</span><span class="op" id="6591069">.</span><span class="ident" id="6591070">rcode</span>&nbsp;<span class="op" id="6591076">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591080">case</span>&nbsp;<span class="ident" id="6591085">tt</span><span class="op" id="6591087">.</span><span class="ident" id="6591088">rcode</span><span class="op" id="6591093">,</span>&nbsp;<span class="ident" id="6591095">dnsRcodeServerFailure</span><span class="op" id="6591116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591120">default</span><span class="op" id="6591127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591132">t</span><span class="op" id="6591133">.</span><span class="ident" id="6591134">Errorf</span><span class="op" id="6591140">(</span><span class="string" id="6591141">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6591166">,</span>&nbsp;<span class="ident" id="6591168">msg</span><span class="op" id="6591171">.</span><span class="ident" id="6591172">rcode</span><span class="op" id="6591177">,</span>&nbsp;<span class="ident" id="6591179">tt</span><span class="op" id="6591181">.</span><span class="ident" id="6591182">server</span><span class="op" id="6591188">,</span>&nbsp;<span class="ident" id="6591190">tt</span><span class="op" id="6591192">.</span><span class="ident" id="6591193">rcode</span><span class="op" id="6591198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591203">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591214">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591217">}</span><br>
<span class="lineno"></span><span class="op" id="6591219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6591222">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="6591289">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="6591306">var</span>&nbsp;<span class="ident" id="6591310">specialDomainNameTests</span>&nbsp;<span class="op" id="6591333">=</span>&nbsp;<span class="op" id="6591335">[</span><span class="op" id="6591336">]</span><span class="keyword" id="6591337">struct</span>&nbsp;<span class="op" id="6591344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591347">name</span>&nbsp;&nbsp;<span class="builtintype" id="6591353">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591361">qtype</span>&nbsp;<span class="builtintype" id="6591367">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591375">rcode</span>&nbsp;<span class="builtintype" id="6591381">int</span><br>
<span class="lineno"></span><span class="op" id="6591385">}</span><span class="op" id="6591386">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591389">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591453">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591480">{</span><span class="string" id="6591481">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="6591508">,</span>&nbsp;<span class="ident" id="6591510">dnsTypePTR</span><span class="op" id="6591520">,</span>&nbsp;<span class="ident" id="6591522">dnsRcodeNameError</span><span class="op" id="6591539">}</span><span class="op" id="6591540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591543">{</span><span class="string" id="6591544">&#34;test.&#34;</span><span class="op" id="6591551">,</span>&nbsp;<span class="ident" id="6591553">dnsTypeALL</span><span class="op" id="6591563">,</span>&nbsp;<span class="ident" id="6591565">dnsRcodeNameError</span><span class="op" id="6591582">}</span><span class="op" id="6591583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591586">{</span><span class="string" id="6591587">&#34;example.com.&#34;</span><span class="op" id="6591601">,</span>&nbsp;<span class="ident" id="6591603">dnsTypeALL</span><span class="op" id="6591613">,</span>&nbsp;<span class="ident" id="6591615">dnsRcodeSuccess</span><span class="op" id="6591630">}</span><span class="op" id="6591631">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591635">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591695">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591754">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591814">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591867">{</span><span class="string" id="6591868">&#34;localhost.&#34;</span><span class="op" id="6591880">,</span>&nbsp;<span class="ident" id="6591882">dnsTypeALL</span><span class="op" id="6591892">,</span>&nbsp;<span class="ident" id="6591894">dnsRcodeNameError</span><span class="op" id="6591911">}</span><span class="op" id="6591912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591915">{</span><span class="string" id="6591916">&#34;invalid.&#34;</span><span class="op" id="6591926">,</span>&nbsp;<span class="ident" id="6591928">dnsTypeALL</span><span class="op" id="6591938">,</span>&nbsp;<span class="ident" id="6591940">dnsRcodeNameError</span><span class="op" id="6591957">}</span><span class="op" id="6591958">,</span><br>
<span class="lineno"></span><span class="op" id="6591960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6591963">func</span>&nbsp;<span class="ident" id="6591968">TestSpecialDomainName</span><span class="op" id="6591989">(</span><span class="ident" id="6591990">t</span>&nbsp;<span class="op" id="6591992">*</span><span class="ident" id="6591993">testing</span><span class="op" id="6592000">.</span><span class="ident" id="6592001">T</span><span class="op" id="6592002">)</span>&nbsp;<span class="op" id="6592004">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592007">if</span>&nbsp;<span class="ident" id="6592010">testing</span><span class="op" id="6592017">.</span><span class="ident" id="6592018">Short</span><span class="op" id="6592023">(</span><span class="op" id="6592024">)</span>&nbsp;<span class="op" id="6592026">||</span>&nbsp;<span class="op" id="6592029">!</span><span class="op" id="6592030">*</span><span class="ident" id="6592031">testExternal</span>&nbsp;<span class="op" id="6592044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592048">t</span><span class="op" id="6592049">.</span><span class="ident" id="6592050">Skip</span><span class="op" id="6592054">(</span><span class="string" id="6592055">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6592096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592103">server</span>&nbsp;<span class="op" id="6592110">:=</span>&nbsp;<span class="string" id="6592113">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592127">for</span>&nbsp;<span class="ident" id="6592131">_</span><span class="op" id="6592132">,</span>&nbsp;<span class="ident" id="6592134">tt</span>&nbsp;<span class="op" id="6592137">:=</span>&nbsp;<span class="keyword" id="6592140">range</span>&nbsp;<span class="ident" id="6592146">specialDomainNameTests</span>&nbsp;<span class="op" id="6592169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592173">msg</span><span class="op" id="6592176">,</span>&nbsp;<span class="ident" id="6592178">err</span>&nbsp;<span class="op" id="6592182">:=</span>&nbsp;<span class="ident" id="6592185">exchange</span><span class="op" id="6592193">(</span><span class="ident" id="6592194">server</span><span class="op" id="6592200">,</span>&nbsp;<span class="ident" id="6592202">tt</span><span class="op" id="6592204">.</span><span class="ident" id="6592205">name</span><span class="op" id="6592209">,</span>&nbsp;<span class="ident" id="6592211">tt</span><span class="op" id="6592213">.</span><span class="ident" id="6592214">qtype</span><span class="op" id="6592219">,</span>&nbsp;<span class="num" id="6592221">0</span><span class="op" id="6592222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592226">if</span>&nbsp;<span class="ident" id="6592229">err</span>&nbsp;<span class="op" id="6592233">!=</span>&nbsp;<span class="ident" id="6592236">nil</span>&nbsp;<span class="op" id="6592240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592245">t</span><span class="op" id="6592246">.</span><span class="ident" id="6592247">Error</span><span class="op" id="6592252">(</span><span class="ident" id="6592253">err</span><span class="op" id="6592256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592261">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592276">switch</span>&nbsp;<span class="ident" id="6592283">msg</span><span class="op" id="6592286">.</span><span class="ident" id="6592287">rcode</span>&nbsp;<span class="op" id="6592293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592297">case</span>&nbsp;<span class="ident" id="6592302">tt</span><span class="op" id="6592304">.</span><span class="ident" id="6592305">rcode</span><span class="op" id="6592310">,</span>&nbsp;<span class="ident" id="6592312">dnsRcodeServerFailure</span><span class="op" id="6592333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592337">default</span><span class="op" id="6592344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592349">t</span><span class="op" id="6592350">.</span><span class="ident" id="6592351">Errorf</span><span class="op" id="6592357">(</span><span class="string" id="6592358">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6592383">,</span>&nbsp;<span class="ident" id="6592385">msg</span><span class="op" id="6592388">.</span><span class="ident" id="6592389">rcode</span><span class="op" id="6592394">,</span>&nbsp;<span class="ident" id="6592396">server</span><span class="op" id="6592402">,</span>&nbsp;<span class="ident" id="6592404">tt</span><span class="op" id="6592406">.</span><span class="ident" id="6592407">rcode</span><span class="op" id="6592412">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592431">}</span><br>
<span class="lineno"></span><span class="op" id="6592433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6592436">type</span>&nbsp;<span class="ident" id="6592441">resolvConfTest</span>&nbsp;<span class="keyword" id="6592456">struct</span>&nbsp;<span class="op" id="6592463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592466">*</span><span class="ident" id="6592467">testing</span><span class="op" id="6592474">.</span><span class="ident" id="6592475">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592478">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592486">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592494">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6592502">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592510">started</span>&nbsp;<span class="builtintype" id="6592518">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592524">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6592532">chan</span>&nbsp;<span class="keyword" id="6592537">chan</span>&nbsp;<span class="keyword" id="6592542">struct</span><span class="op" id="6592548">{</span><span class="op" id="6592549">}</span><br>
<span class="lineno"></span><span class="op" id="6592551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6592554">func</span>&nbsp;<span class="ident" id="6592559">newResolvConfTest</span><span class="op" id="6592576">(</span><span class="ident" id="6592577">t</span>&nbsp;<span class="op" id="6592579">*</span><span class="ident" id="6592580">testing</span><span class="op" id="6592587">.</span><span class="ident" id="6592588">T</span><span class="op" id="6592589">)</span>&nbsp;<span class="op" id="6592591">*</span><span class="ident" id="6592592">resolvConfTest</span>&nbsp;<span class="op" id="6592607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592610">dir</span><span class="op" id="6592613">,</span>&nbsp;<span class="ident" id="6592615">err</span>&nbsp;<span class="op" id="6592619">:=</span>&nbsp;<span class="ident" id="6592622">ioutil</span><span class="op" id="6592628">.</span><span class="ident" id="6592629">TempDir</span><span class="op" id="6592636">(</span><span class="string" id="6592637">&#34;&#34;</span><span class="op" id="6592639">,</span>&nbsp;<span class="string" id="6592641">&#34;resolvConfTest&#34;</span><span class="op" id="6592657">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592660">if</span>&nbsp;<span class="ident" id="6592663">err</span>&nbsp;<span class="op" id="6592667">!=</span>&nbsp;<span class="ident" id="6592670">nil</span>&nbsp;<span class="op" id="6592674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592678">t</span><span class="op" id="6592679">.</span><span class="ident" id="6592680">Fatalf</span><span class="op" id="6592686">(</span><span class="string" id="6592687">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="6592718">,</span>&nbsp;<span class="ident" id="6592720">err</span><span class="op" id="6592723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592730">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592765">onceLoadConfig</span><span class="op" id="6592779">.</span><span class="ident" id="6592780">Do</span><span class="op" id="6592782">(</span><span class="keyword" id="6592783">func</span><span class="op" id="6592787">(</span><span class="op" id="6592788">)</span>&nbsp;<span class="op" id="6592790">{</span><span class="op" id="6592791">}</span><span class="op" id="6592792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592796">r</span>&nbsp;<span class="op" id="6592798">:=</span>&nbsp;<span class="op" id="6592801">&amp;</span><span class="ident" id="6592802">resolvConfTest</span><span class="op" id="6592816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592820">T</span><span class="op" id="6592821">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6592827">t</span><span class="op" id="6592828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592832">dir</span><span class="op" id="6592835">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6592839">dir</span><span class="op" id="6592842">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592846">path</span><span class="op" id="6592850">:</span>&nbsp;&nbsp;<span class="ident" id="6592853">path</span><span class="op" id="6592857">.</span><span class="ident" id="6592858">Join</span><span class="op" id="6592862">(</span><span class="ident" id="6592863">dir</span><span class="op" id="6592866">,</span>&nbsp;<span class="string" id="6592868">&#34;resolv.conf&#34;</span><span class="op" id="6592881">)</span><span class="op" id="6592882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592886">quitc</span><span class="op" id="6592891">:</span>&nbsp;<span class="builtinfunc" id="6592893">make</span><span class="op" id="6592897">(</span><span class="keyword" id="6592898">chan</span>&nbsp;<span class="keyword" id="6592903">chan</span>&nbsp;<span class="keyword" id="6592908">struct</span><span class="op" id="6592914">{</span><span class="op" id="6592915">}</span><span class="op" id="6592916">)</span><span class="op" id="6592917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592924">return</span>&nbsp;<span class="ident" id="6592931">r</span><br>
<span class="lineno">120</span><span class="op" id="6592933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6592936">func</span>&nbsp;<span class="op" id="6592941">(</span><span class="ident" id="6592942">r</span>&nbsp;<span class="op" id="6592944">*</span><span class="ident" id="6592945">resolvConfTest</span><span class="op" id="6592959">)</span>&nbsp;<span class="ident" id="6592961">Start</span><span class="op" id="6592966">(</span><span class="op" id="6592967">)</span>&nbsp;<span class="op" id="6592969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592972">loadConfig</span><span class="op" id="6592982">(</span><span class="ident" id="6592983">r</span><span class="op" id="6592984">.</span><span class="ident" id="6592985">path</span><span class="op" id="6592989">,</span>&nbsp;<span class="num" id="6592991">100</span><span class="op" id="6592994">*</span><span class="ident" id="6592995">time</span><span class="op" id="6592999">.</span><span class="ident" id="6593000">Millisecond</span><span class="op" id="6593011">,</span>&nbsp;<span class="ident" id="6593013">r</span><span class="op" id="6593014">.</span><span class="ident" id="6593015">quitc</span><span class="op" id="6593020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593023">r</span><span class="op" id="6593024">.</span><span class="ident" id="6593025">started</span>&nbsp;<span class="op" id="6593033">=</span>&nbsp;<span class="builtintype" id="6593035">true</span><br>
<span class="lineno">125</span><span class="op" id="6593040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6593043">func</span>&nbsp;<span class="op" id="6593048">(</span><span class="ident" id="6593049">r</span>&nbsp;<span class="op" id="6593051">*</span><span class="ident" id="6593052">resolvConfTest</span><span class="op" id="6593066">)</span>&nbsp;<span class="ident" id="6593068">SetConf</span><span class="op" id="6593075">(</span><span class="ident" id="6593076">s</span>&nbsp;<span class="builtintype" id="6593078">string</span><span class="op" id="6593084">)</span>&nbsp;<span class="op" id="6593086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6593089">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6593158">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593213">time</span><span class="op" id="6593217">.</span><span class="ident" id="6593218">Sleep</span><span class="op" id="6593223">(</span><span class="ident" id="6593224">time</span><span class="op" id="6593228">.</span><span class="ident" id="6593229">Second</span><span class="op" id="6593235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593239">f</span><span class="op" id="6593240">,</span>&nbsp;<span class="ident" id="6593242">err</span>&nbsp;<span class="op" id="6593246">:=</span>&nbsp;<span class="ident" id="6593249">os</span><span class="op" id="6593251">.</span><span class="ident" id="6593252">OpenFile</span><span class="op" id="6593260">(</span><span class="ident" id="6593261">r</span><span class="op" id="6593262">.</span><span class="ident" id="6593263">path</span><span class="op" id="6593267">,</span>&nbsp;<span class="ident" id="6593269">os</span><span class="op" id="6593271">.</span><span class="ident" id="6593272">O_CREATE</span><span class="op" id="6593280">|</span><span class="ident" id="6593281">os</span><span class="op" id="6593283">.</span><span class="ident" id="6593284">O_TRUNC</span><span class="op" id="6593291">|</span><span class="ident" id="6593292">os</span><span class="op" id="6593294">.</span><span class="ident" id="6593295">O_WRONLY</span><span class="op" id="6593303">,</span>&nbsp;<span class="num" id="6593305">0600</span><span class="op" id="6593309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593312">if</span>&nbsp;<span class="ident" id="6593315">err</span>&nbsp;<span class="op" id="6593319">!=</span>&nbsp;<span class="ident" id="6593322">nil</span>&nbsp;<span class="op" id="6593326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593330">r</span><span class="op" id="6593331">.</span><span class="ident" id="6593332">Fatalf</span><span class="op" id="6593338">(</span><span class="string" id="6593339">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6593374">,</span>&nbsp;<span class="ident" id="6593376">r</span><span class="op" id="6593377">.</span><span class="ident" id="6593378">path</span><span class="op" id="6593382">,</span>&nbsp;<span class="ident" id="6593384">err</span><span class="op" id="6593387">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593393">if</span>&nbsp;<span class="ident" id="6593396">_</span><span class="op" id="6593397">,</span>&nbsp;<span class="ident" id="6593399">err</span>&nbsp;<span class="op" id="6593403">:=</span>&nbsp;<span class="ident" id="6593406">io</span><span class="op" id="6593408">.</span><span class="ident" id="6593409">WriteString</span><span class="op" id="6593420">(</span><span class="ident" id="6593421">f</span><span class="op" id="6593422">,</span>&nbsp;<span class="ident" id="6593424">s</span><span class="op" id="6593425">)</span><span class="op" id="6593426">;</span>&nbsp;<span class="ident" id="6593428">err</span>&nbsp;<span class="op" id="6593432">!=</span>&nbsp;<span class="ident" id="6593435">nil</span>&nbsp;<span class="op" id="6593439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593443">f</span><span class="op" id="6593444">.</span><span class="ident" id="6593445">Close</span><span class="op" id="6593450">(</span><span class="op" id="6593451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593455">r</span><span class="op" id="6593456">.</span><span class="ident" id="6593457">Fatalf</span><span class="op" id="6593463">(</span><span class="string" id="6593464">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="6593495">,</span>&nbsp;<span class="ident" id="6593497">err</span><span class="op" id="6593500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593503">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593506">f</span><span class="op" id="6593507">.</span><span class="ident" id="6593508">Close</span><span class="op" id="6593513">(</span><span class="op" id="6593514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593518">if</span>&nbsp;<span class="ident" id="6593521">r</span><span class="op" id="6593522">.</span><span class="ident" id="6593523">started</span>&nbsp;<span class="op" id="6593531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593535">cfg</span><span class="op" id="6593538">.</span><span class="ident" id="6593539">ch</span>&nbsp;<span class="op" id="6593542">&lt;-</span>&nbsp;<span class="keyword" id="6593545">struct</span><span class="op" id="6593551">{</span><span class="op" id="6593552">}</span><span class="op" id="6593553">{</span><span class="op" id="6593554">}</span>&nbsp;<span class="comment" id="6593556">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593573">cfg</span><span class="op" id="6593576">.</span><span class="ident" id="6593577">ch</span>&nbsp;<span class="op" id="6593580">&lt;-</span>&nbsp;<span class="keyword" id="6593583">struct</span><span class="op" id="6593589">{</span><span class="op" id="6593590">}</span><span class="op" id="6593591">{</span><span class="op" id="6593592">}</span>&nbsp;<span class="comment" id="6593594">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593624">cfg</span><span class="op" id="6593627">.</span><span class="ident" id="6593628">ch</span>&nbsp;<span class="op" id="6593631">&lt;-</span>&nbsp;<span class="keyword" id="6593634">struct</span><span class="op" id="6593640">{</span><span class="op" id="6593641">}</span><span class="op" id="6593642">{</span><span class="op" id="6593643">}</span>&nbsp;<span class="comment" id="6593645">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593677">}</span><br>
<span class="lineno"></span><span class="op" id="6593679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6593682">func</span>&nbsp;<span class="op" id="6593687">(</span><span class="ident" id="6593688">r</span>&nbsp;<span class="op" id="6593690">*</span><span class="ident" id="6593691">resolvConfTest</span><span class="op" id="6593705">)</span>&nbsp;<span class="ident" id="6593707">WantServers</span><span class="op" id="6593718">(</span><span class="ident" id="6593719">want</span>&nbsp;<span class="op" id="6593724">[</span><span class="op" id="6593725">]</span><span class="builtintype" id="6593726">string</span><span class="op" id="6593732">)</span>&nbsp;<span class="op" id="6593734">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593737">cfg</span><span class="op" id="6593740">.</span><span class="ident" id="6593741">mu</span><span class="op" id="6593743">.</span><span class="ident" id="6593744">RLock</span><span class="op" id="6593749">(</span><span class="op" id="6593750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593753">defer</span>&nbsp;<span class="ident" id="6593759">cfg</span><span class="op" id="6593762">.</span><span class="ident" id="6593763">mu</span><span class="op" id="6593765">.</span><span class="ident" id="6593766">RUnlock</span><span class="op" id="6593773">(</span><span class="op" id="6593774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593777">if</span>&nbsp;<span class="ident" id="6593780">got</span>&nbsp;<span class="op" id="6593784">:=</span>&nbsp;<span class="ident" id="6593787">cfg</span><span class="op" id="6593790">.</span><span class="ident" id="6593791">dnsConfig</span><span class="op" id="6593800">.</span><span class="ident" id="6593801">servers</span><span class="op" id="6593808">;</span>&nbsp;<span class="op" id="6593810">!</span><span class="ident" id="6593811">reflect</span><span class="op" id="6593818">.</span><span class="ident" id="6593819">DeepEqual</span><span class="op" id="6593828">(</span><span class="ident" id="6593829">got</span><span class="op" id="6593832">,</span>&nbsp;<span class="ident" id="6593834">want</span><span class="op" id="6593838">)</span>&nbsp;<span class="op" id="6593840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593844">r</span><span class="op" id="6593845">.</span><span class="ident" id="6593846">Fatalf</span><span class="op" id="6593852">(</span><span class="string" id="6593853">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6593899">,</span>&nbsp;<span class="ident" id="6593901">got</span><span class="op" id="6593904">,</span>&nbsp;<span class="ident" id="6593906">want</span><span class="op" id="6593910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593913">}</span><br>
<span class="lineno">155</span><span class="op" id="6593915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6593918">func</span>&nbsp;<span class="op" id="6593923">(</span><span class="ident" id="6593924">r</span>&nbsp;<span class="op" id="6593926">*</span><span class="ident" id="6593927">resolvConfTest</span><span class="op" id="6593941">)</span>&nbsp;<span class="ident" id="6593943">Close</span><span class="op" id="6593948">(</span><span class="op" id="6593949">)</span>&nbsp;<span class="op" id="6593951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593954">resp</span>&nbsp;<span class="op" id="6593959">:=</span>&nbsp;<span class="builtinfunc" id="6593962">make</span><span class="op" id="6593966">(</span><span class="keyword" id="6593967">chan</span>&nbsp;<span class="keyword" id="6593972">struct</span><span class="op" id="6593978">{</span><span class="op" id="6593979">}</span><span class="op" id="6593980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593983">r</span><span class="op" id="6593984">.</span><span class="ident" id="6593985">quitc</span>&nbsp;<span class="op" id="6593991">&lt;-</span>&nbsp;<span class="ident" id="6593994">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594000">&lt;-</span><span class="ident" id="6594002">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594008">if</span>&nbsp;<span class="ident" id="6594011">err</span>&nbsp;<span class="op" id="6594015">:=</span>&nbsp;<span class="ident" id="6594018">os</span><span class="op" id="6594020">.</span><span class="ident" id="6594021">RemoveAll</span><span class="op" id="6594030">(</span><span class="ident" id="6594031">r</span><span class="op" id="6594032">.</span><span class="ident" id="6594033">dir</span><span class="op" id="6594036">)</span><span class="op" id="6594037">;</span>&nbsp;<span class="ident" id="6594039">err</span>&nbsp;<span class="op" id="6594043">!=</span>&nbsp;<span class="ident" id="6594046">nil</span>&nbsp;<span class="op" id="6594050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594054">r</span><span class="op" id="6594055">.</span><span class="ident" id="6594056">Logf</span><span class="op" id="6594060">(</span><span class="string" id="6594061">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6594095">,</span>&nbsp;<span class="ident" id="6594097">r</span><span class="op" id="6594098">.</span><span class="ident" id="6594099">dir</span><span class="op" id="6594102">,</span>&nbsp;<span class="ident" id="6594104">err</span><span class="op" id="6594107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594110">}</span><br>
<span class="lineno"></span><span class="op" id="6594112">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6594115">func</span>&nbsp;<span class="ident" id="6594120">TestReloadResolvConfFail</span><span class="op" id="6594144">(</span><span class="ident" id="6594145">t</span>&nbsp;<span class="op" id="6594147">*</span><span class="ident" id="6594148">testing</span><span class="op" id="6594155">.</span><span class="ident" id="6594156">T</span><span class="op" id="6594157">)</span>&nbsp;<span class="op" id="6594159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594162">if</span>&nbsp;<span class="ident" id="6594165">testing</span><span class="op" id="6594172">.</span><span class="ident" id="6594173">Short</span><span class="op" id="6594178">(</span><span class="op" id="6594179">)</span>&nbsp;<span class="op" id="6594181">||</span>&nbsp;<span class="op" id="6594184">!</span><span class="op" id="6594185">*</span><span class="ident" id="6594186">testExternal</span>&nbsp;<span class="op" id="6594199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594203">t</span><span class="op" id="6594204">.</span><span class="ident" id="6594205">Skip</span><span class="op" id="6594209">(</span><span class="string" id="6594210">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6594251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594254">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594258">r</span>&nbsp;<span class="op" id="6594260">:=</span>&nbsp;<span class="ident" id="6594263">newResolvConfTest</span><span class="op" id="6594280">(</span><span class="ident" id="6594281">t</span><span class="op" id="6594282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594285">defer</span>&nbsp;<span class="ident" id="6594291">r</span><span class="op" id="6594292">.</span><span class="ident" id="6594293">Close</span><span class="op" id="6594298">(</span><span class="op" id="6594299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594303">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594342">r</span><span class="op" id="6594343">.</span><span class="ident" id="6594344">Start</span><span class="op" id="6594349">(</span><span class="op" id="6594350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594353">if</span>&nbsp;<span class="ident" id="6594356">_</span><span class="op" id="6594357">,</span>&nbsp;<span class="ident" id="6594359">err</span>&nbsp;<span class="op" id="6594363">:=</span>&nbsp;<span class="ident" id="6594366">goLookupIP</span><span class="op" id="6594376">(</span><span class="string" id="6594377">&#34;golang.org&#34;</span><span class="op" id="6594389">)</span><span class="op" id="6594390">;</span>&nbsp;<span class="ident" id="6594392">err</span>&nbsp;<span class="op" id="6594396">==</span>&nbsp;<span class="ident" id="6594399">nil</span>&nbsp;<span class="op" id="6594403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594407">t</span><span class="op" id="6594408">.</span><span class="ident" id="6594409">Fatal</span><span class="op" id="6594414">(</span><span class="string" id="6594415">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="6594446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594453">r</span><span class="op" id="6594454">.</span><span class="ident" id="6594455">SetConf</span><span class="op" id="6594462">(</span><span class="string" id="6594463">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6594483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594486">if</span>&nbsp;<span class="ident" id="6594489">_</span><span class="op" id="6594490">,</span>&nbsp;<span class="ident" id="6594492">err</span>&nbsp;<span class="op" id="6594496">:=</span>&nbsp;<span class="ident" id="6594499">goLookupIP</span><span class="op" id="6594509">(</span><span class="string" id="6594510">&#34;golang.org&#34;</span><span class="op" id="6594522">)</span><span class="op" id="6594523">;</span>&nbsp;<span class="ident" id="6594525">err</span>&nbsp;<span class="op" id="6594529">!=</span>&nbsp;<span class="ident" id="6594532">nil</span>&nbsp;<span class="op" id="6594536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594540">t</span><span class="op" id="6594541">.</span><span class="ident" id="6594542">Fatalf</span><span class="op" id="6594548">(</span><span class="string" id="6594549">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6594587">,</span>&nbsp;<span class="ident" id="6594589">err</span><span class="op" id="6594592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594599">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594647">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594691">r</span><span class="op" id="6594692">.</span><span class="ident" id="6594693">SetConf</span><span class="op" id="6594700">(</span><span class="string" id="6594701">&#34;&#34;</span><span class="op" id="6594703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594706">if</span>&nbsp;<span class="ident" id="6594709">_</span><span class="op" id="6594710">,</span>&nbsp;<span class="ident" id="6594712">err</span>&nbsp;<span class="op" id="6594716">:=</span>&nbsp;<span class="ident" id="6594719">goLookupIP</span><span class="op" id="6594729">(</span><span class="string" id="6594730">&#34;golang.org&#34;</span><span class="op" id="6594742">)</span><span class="op" id="6594743">;</span>&nbsp;<span class="ident" id="6594745">err</span>&nbsp;<span class="op" id="6594749">!=</span>&nbsp;<span class="ident" id="6594752">nil</span>&nbsp;<span class="op" id="6594756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594760">t</span><span class="op" id="6594761">.</span><span class="ident" id="6594762">Fatalf</span><span class="op" id="6594768">(</span><span class="string" id="6594769">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6594812">,</span>&nbsp;<span class="ident" id="6594814">err</span><span class="op" id="6594817">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594820">}</span><br>
<span class="lineno"></span><span class="op" id="6594822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594825">func</span>&nbsp;<span class="ident" id="6594830">TestReloadResolvConfChange</span><span class="op" id="6594856">(</span><span class="ident" id="6594857">t</span>&nbsp;<span class="op" id="6594859">*</span><span class="ident" id="6594860">testing</span><span class="op" id="6594867">.</span><span class="ident" id="6594868">T</span><span class="op" id="6594869">)</span>&nbsp;<span class="op" id="6594871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594874">if</span>&nbsp;<span class="ident" id="6594877">testing</span><span class="op" id="6594884">.</span><span class="ident" id="6594885">Short</span><span class="op" id="6594890">(</span><span class="op" id="6594891">)</span>&nbsp;<span class="op" id="6594893">||</span>&nbsp;<span class="op" id="6594896">!</span><span class="op" id="6594897">*</span><span class="ident" id="6594898">testExternal</span>&nbsp;<span class="op" id="6594911">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594915">t</span><span class="op" id="6594916">.</span><span class="ident" id="6594917">Skip</span><span class="op" id="6594921">(</span><span class="string" id="6594922">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6594963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594970">r</span>&nbsp;<span class="op" id="6594972">:=</span>&nbsp;<span class="ident" id="6594975">newResolvConfTest</span><span class="op" id="6594992">(</span><span class="ident" id="6594993">t</span><span class="op" id="6594994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594997">defer</span>&nbsp;<span class="ident" id="6595003">r</span><span class="op" id="6595004">.</span><span class="ident" id="6595005">Close</span><span class="op" id="6595010">(</span><span class="op" id="6595011">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595015">r</span><span class="op" id="6595016">.</span><span class="ident" id="6595017">SetConf</span><span class="op" id="6595024">(</span><span class="string" id="6595025">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6595045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595048">r</span><span class="op" id="6595049">.</span><span class="ident" id="6595050">Start</span><span class="op" id="6595055">(</span><span class="op" id="6595056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595060">if</span>&nbsp;<span class="ident" id="6595063">_</span><span class="op" id="6595064">,</span>&nbsp;<span class="ident" id="6595066">err</span>&nbsp;<span class="op" id="6595070">:=</span>&nbsp;<span class="ident" id="6595073">goLookupIP</span><span class="op" id="6595083">(</span><span class="string" id="6595084">&#34;golang.org&#34;</span><span class="op" id="6595096">)</span><span class="op" id="6595097">;</span>&nbsp;<span class="ident" id="6595099">err</span>&nbsp;<span class="op" id="6595103">!=</span>&nbsp;<span class="ident" id="6595106">nil</span>&nbsp;<span class="op" id="6595110">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595114">t</span><span class="op" id="6595115">.</span><span class="ident" id="6595116">Fatalf</span><span class="op" id="6595122">(</span><span class="string" id="6595123">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595152">,</span>&nbsp;<span class="ident" id="6595154">err</span><span class="op" id="6595157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595163">r</span><span class="op" id="6595164">.</span><span class="ident" id="6595165">WantServers</span><span class="op" id="6595176">(</span><span class="op" id="6595177">[</span><span class="op" id="6595178">]</span><span class="builtintype" id="6595179">string</span><span class="op" id="6595185">{</span><span class="string" id="6595186">&#34;8.8.8.8&#34;</span><span class="op" id="6595195">}</span><span class="op" id="6595196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595200">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595251">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595291">r</span><span class="op" id="6595292">.</span><span class="ident" id="6595293">SetConf</span><span class="op" id="6595300">(</span><span class="string" id="6595301">&#34;&#34;</span><span class="op" id="6595303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595306">if</span>&nbsp;<span class="ident" id="6595309">_</span><span class="op" id="6595310">,</span>&nbsp;<span class="ident" id="6595312">err</span>&nbsp;<span class="op" id="6595316">:=</span>&nbsp;<span class="ident" id="6595319">goLookupIP</span><span class="op" id="6595329">(</span><span class="string" id="6595330">&#34;golang.org&#34;</span><span class="op" id="6595342">)</span><span class="op" id="6595343">;</span>&nbsp;<span class="ident" id="6595345">err</span>&nbsp;<span class="op" id="6595349">!=</span>&nbsp;<span class="ident" id="6595352">nil</span>&nbsp;<span class="op" id="6595356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595360">t</span><span class="op" id="6595361">.</span><span class="ident" id="6595362">Fatalf</span><span class="op" id="6595368">(</span><span class="string" id="6595369">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595403">,</span>&nbsp;<span class="ident" id="6595405">err</span><span class="op" id="6595408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595411">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595415">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595458">r</span><span class="op" id="6595459">.</span><span class="ident" id="6595460">SetConf</span><span class="op" id="6595467">(</span><span class="string" id="6595468">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="6595488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595491">r</span><span class="op" id="6595492">.</span><span class="ident" id="6595493">WantServers</span><span class="op" id="6595504">(</span><span class="op" id="6595505">[</span><span class="op" id="6595506">]</span><span class="builtintype" id="6595507">string</span><span class="op" id="6595513">{</span><span class="string" id="6595514">&#34;8.8.4.4&#34;</span><span class="op" id="6595523">}</span><span class="op" id="6595524">)</span><br>
<span class="lineno"></span><span class="op" id="6595526">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6595529">func</span>&nbsp;<span class="ident" id="6595534">BenchmarkGoLookupIP</span><span class="op" id="6595553">(</span><span class="ident" id="6595554">b</span>&nbsp;<span class="op" id="6595556">*</span><span class="ident" id="6595557">testing</span><span class="op" id="6595564">.</span><span class="ident" id="6595565">B</span><span class="op" id="6595566">)</span>&nbsp;<span class="op" id="6595568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595571">for</span>&nbsp;<span class="ident" id="6595575">i</span>&nbsp;<span class="op" id="6595577">:=</span>&nbsp;<span class="num" id="6595580">0</span><span class="op" id="6595581">;</span>&nbsp;<span class="ident" id="6595583">i</span>&nbsp;<span class="op" id="6595585">&lt;</span>&nbsp;<span class="ident" id="6595587">b</span><span class="op" id="6595588">.</span><span class="ident" id="6595589">N</span><span class="op" id="6595590">;</span>&nbsp;<span class="ident" id="6595592">i</span><span class="op" id="6595593">++</span>&nbsp;<span class="op" id="6595596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595600">goLookupIP</span><span class="op" id="6595610">(</span><span class="string" id="6595611">&#34;www.example.com&#34;</span><span class="op" id="6595628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595631">}</span><br>
<span class="lineno">225</span><span class="op" id="6595633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595636">func</span>&nbsp;<span class="ident" id="6595641">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="6595670">(</span><span class="ident" id="6595671">b</span>&nbsp;<span class="op" id="6595673">*</span><span class="ident" id="6595674">testing</span><span class="op" id="6595681">.</span><span class="ident" id="6595682">B</span><span class="op" id="6595683">)</span>&nbsp;<span class="op" id="6595685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595688">for</span>&nbsp;<span class="ident" id="6595692">i</span>&nbsp;<span class="op" id="6595694">:=</span>&nbsp;<span class="num" id="6595697">0</span><span class="op" id="6595698">;</span>&nbsp;<span class="ident" id="6595700">i</span>&nbsp;<span class="op" id="6595702">&lt;</span>&nbsp;<span class="ident" id="6595704">b</span><span class="op" id="6595705">.</span><span class="ident" id="6595706">N</span><span class="op" id="6595707">;</span>&nbsp;<span class="ident" id="6595709">i</span><span class="op" id="6595710">++</span>&nbsp;<span class="op" id="6595713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595717">goLookupIP</span><span class="op" id="6595727">(</span><span class="string" id="6595728">&#34;some.nonexistent&#34;</span><span class="op" id="6595746">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595749">}</span><br>
<span class="lineno"></span><span class="op" id="6595751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595754">func</span>&nbsp;<span class="ident" id="6595759">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="6595798">(</span><span class="ident" id="6595799">b</span>&nbsp;<span class="op" id="6595801">*</span><span class="ident" id="6595802">testing</span><span class="op" id="6595809">.</span><span class="ident" id="6595810">B</span><span class="op" id="6595811">)</span>&nbsp;<span class="op" id="6595813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595816">onceLoadConfig</span><span class="op" id="6595830">.</span><span class="ident" id="6595831">Do</span><span class="op" id="6595833">(</span><span class="ident" id="6595834">loadDefaultConfig</span><span class="op" id="6595851">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595854">if</span>&nbsp;<span class="ident" id="6595857">cfg</span><span class="op" id="6595860">.</span><span class="ident" id="6595861">dnserr</span>&nbsp;<span class="op" id="6595868">!=</span>&nbsp;<span class="ident" id="6595871">nil</span>&nbsp;<span class="op" id="6595875">||</span>&nbsp;<span class="ident" id="6595878">cfg</span><span class="op" id="6595881">.</span><span class="ident" id="6595882">dnsConfig</span>&nbsp;<span class="op" id="6595892">==</span>&nbsp;<span class="ident" id="6595895">nil</span>&nbsp;<span class="op" id="6595899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595903">b</span><span class="op" id="6595904">.</span><span class="ident" id="6595905">Fatalf</span><span class="op" id="6595911">(</span><span class="string" id="6595912">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595935">,</span>&nbsp;<span class="ident" id="6595937">cfg</span><span class="op" id="6595940">.</span><span class="ident" id="6595941">dnserr</span><span class="op" id="6595947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595953">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596017">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596054">orig</span>&nbsp;<span class="op" id="6596059">:=</span>&nbsp;<span class="ident" id="6596062">cfg</span><span class="op" id="6596065">.</span><span class="ident" id="6596066">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596077">cfg</span><span class="op" id="6596080">.</span><span class="ident" id="6596081">dnsConfig</span><span class="op" id="6596090">.</span><span class="ident" id="6596091">servers</span>&nbsp;<span class="op" id="6596099">=</span>&nbsp;<span class="builtinfunc" id="6596101">append</span><span class="op" id="6596107">(</span><span class="op" id="6596108">[</span><span class="op" id="6596109">]</span><span class="builtintype" id="6596110">string</span><span class="op" id="6596116">{</span><span class="string" id="6596117">&#34;203.0.113.254&#34;</span><span class="op" id="6596132">}</span><span class="op" id="6596133">,</span>&nbsp;<span class="ident" id="6596135">cfg</span><span class="op" id="6596138">.</span><span class="ident" id="6596139">dnsConfig</span><span class="op" id="6596148">.</span><span class="ident" id="6596149">servers</span><span class="op" id="6596156">...</span><span class="op" id="6596159">)</span>&nbsp;<span class="comment" id="6596161">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596200">for</span>&nbsp;<span class="ident" id="6596204">i</span>&nbsp;<span class="op" id="6596206">:=</span>&nbsp;<span class="num" id="6596209">0</span><span class="op" id="6596210">;</span>&nbsp;<span class="ident" id="6596212">i</span>&nbsp;<span class="op" id="6596214">&lt;</span>&nbsp;<span class="ident" id="6596216">b</span><span class="op" id="6596217">.</span><span class="ident" id="6596218">N</span><span class="op" id="6596219">;</span>&nbsp;<span class="ident" id="6596221">i</span><span class="op" id="6596222">++</span>&nbsp;<span class="op" id="6596225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596229">goLookupIP</span><span class="op" id="6596239">(</span><span class="string" id="6596240">&#34;www.example.com&#34;</span><span class="op" id="6596257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596260">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596263">cfg</span><span class="op" id="6596266">.</span><span class="ident" id="6596267">dnsConfig</span>&nbsp;<span class="op" id="6596277">=</span>&nbsp;<span class="ident" id="6596279">orig</span><br>
<span class="lineno"></span><span class="op" id="6596284">}</span>
</div>
</body>
</html>
