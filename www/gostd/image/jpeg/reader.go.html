<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6154214">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6154269">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6154323">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6154374">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6154435">//</span><br>
<span class="lineno"></span><span class="comment" id="6154438">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="6154517">package</span>&nbsp;<span class="ident" id="6154525">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6154531">import</span>&nbsp;<span class="op" id="6154538">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6154541">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6154550">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6154565">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6154570">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6154573">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6154650">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6154707">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="6154768">type</span>&nbsp;<span class="ident" id="6154773">FormatError</span>&nbsp;<span class="builtintype" id="6154785">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6154793">func</span>&nbsp;<span class="op" id="6154798">(</span><span class="ident" id="6154799">e</span>&nbsp;<span class="ident" id="6154801">FormatError</span><span class="op" id="6154812">)</span>&nbsp;<span class="ident" id="6154814">Error</span><span class="op" id="6154819">(</span><span class="op" id="6154820">)</span>&nbsp;<span class="builtintype" id="6154822">string</span>&nbsp;<span class="op" id="6154829">{</span>&nbsp;<span class="keyword" id="6154831">return</span>&nbsp;<span class="string" id="6154838">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="6154862">+</span>&nbsp;<span class="builtintype" id="6154864">string</span><span class="op" id="6154870">(</span><span class="ident" id="6154871">e</span><span class="op" id="6154872">)</span>&nbsp;<span class="op" id="6154874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6154877">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="6154968">type</span>&nbsp;<span class="ident" id="6154973">UnsupportedError</span>&nbsp;<span class="builtintype" id="6154990">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6154998">func</span>&nbsp;<span class="op" id="6155003">(</span><span class="ident" id="6155004">e</span>&nbsp;<span class="ident" id="6155006">UnsupportedError</span><span class="op" id="6155022">)</span>&nbsp;<span class="ident" id="6155024">Error</span><span class="op" id="6155029">(</span><span class="op" id="6155030">)</span>&nbsp;<span class="builtintype" id="6155032">string</span>&nbsp;<span class="op" id="6155039">{</span>&nbsp;<span class="keyword" id="6155041">return</span>&nbsp;<span class="string" id="6155048">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="6155077">+</span>&nbsp;<span class="builtintype" id="6155079">string</span><span class="op" id="6155085">(</span><span class="ident" id="6155086">e</span><span class="op" id="6155087">)</span>&nbsp;<span class="op" id="6155089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6155092">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="6155148">type</span>&nbsp;<span class="ident" id="6155153">component</span>&nbsp;<span class="keyword" id="6155163">struct</span>&nbsp;<span class="op" id="6155170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155173">h</span>&nbsp;&nbsp;<span class="builtintype" id="6155176">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6155182">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155214">v</span>&nbsp;&nbsp;<span class="builtintype" id="6155217">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6155223">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155253">c</span>&nbsp;&nbsp;<span class="builtintype" id="6155256">uint8</span>&nbsp;<span class="comment" id="6155262">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155288">tq</span>&nbsp;<span class="builtintype" id="6155291">uint8</span>&nbsp;<span class="comment" id="6155297">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="6155341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6155344">const</span>&nbsp;<span class="op" id="6155350">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155353">dcTable</span>&nbsp;<span class="op" id="6155361">=</span>&nbsp;<span class="num" id="6155363">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155366">acTable</span>&nbsp;<span class="op" id="6155374">=</span>&nbsp;<span class="num" id="6155376">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155379">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155387">=</span>&nbsp;<span class="num" id="6155389">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155392">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155400">=</span>&nbsp;<span class="num" id="6155402">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155405">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155413">=</span>&nbsp;<span class="num" id="6155415">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6155419">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155470">nGrayComponent</span>&nbsp;<span class="op" id="6155485">=</span>&nbsp;<span class="num" id="6155487">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6155490">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155542">nColorComponent</span>&nbsp;<span class="op" id="6155558">=</span>&nbsp;<span class="num" id="6155560">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6155564">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6155646">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6155722">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155759">maxH</span>&nbsp;<span class="op" id="6155764">=</span>&nbsp;<span class="num" id="6155766">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155769">maxV</span>&nbsp;<span class="op" id="6155774">=</span>&nbsp;<span class="num" id="6155776">2</span><br>
<span class="lineno"></span><span class="op" id="6155778">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6155781">const</span>&nbsp;<span class="op" id="6155787">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155790">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155802">=</span>&nbsp;<span class="num" id="6155804">0xd8</span>&nbsp;<span class="comment" id="6155809">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155829">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155841">=</span>&nbsp;<span class="num" id="6155843">0xd9</span>&nbsp;<span class="comment" id="6155848">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155866">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="6155878">=</span>&nbsp;<span class="num" id="6155880">0xc0</span>&nbsp;<span class="comment" id="6155885">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155916">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="6155928">=</span>&nbsp;<span class="num" id="6155930">0xc2</span>&nbsp;<span class="comment" id="6155935">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6155969">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6155981">=</span>&nbsp;<span class="num" id="6155983">0xc4</span>&nbsp;<span class="comment" id="6155988">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156014">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6156026">=</span>&nbsp;<span class="num" id="6156028">0xdb</span>&nbsp;<span class="comment" id="6156033">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156064">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6156076">=</span>&nbsp;<span class="num" id="6156078">0xda</span>&nbsp;<span class="comment" id="6156083">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156102">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6156114">=</span>&nbsp;<span class="num" id="6156116">0xdd</span>&nbsp;<span class="comment" id="6156121">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156150">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="6156162">=</span>&nbsp;<span class="num" id="6156164">0xd0</span>&nbsp;<span class="comment" id="6156169">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156186">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="6156198">=</span>&nbsp;<span class="num" id="6156200">0xd7</span>&nbsp;<span class="comment" id="6156205">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156222">app0Marker</span>&nbsp;&nbsp;<span class="op" id="6156234">=</span>&nbsp;<span class="num" id="6156236">0xe0</span>&nbsp;<span class="comment" id="6156241">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156271">app15Marker</span>&nbsp;<span class="op" id="6156283">=</span>&nbsp;<span class="num" id="6156285">0xef</span>&nbsp;<span class="comment" id="6156290">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156321">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6156333">=</span>&nbsp;<span class="num" id="6156335">0xfe</span>&nbsp;<span class="comment" id="6156340">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="6156352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6156355">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="6156433">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6156511">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="6156591">var</span>&nbsp;<span class="ident" id="6156595">unzig</span>&nbsp;<span class="op" id="6156601">=</span>&nbsp;<span class="op" id="6156603">[</span><span class="ident" id="6156604">blockSize</span><span class="op" id="6156613">]</span><span class="builtintype" id="6156614">int</span><span class="op" id="6156617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156620">0</span><span class="op" id="6156621">,</span>&nbsp;<span class="num" id="6156623">1</span><span class="op" id="6156624">,</span>&nbsp;<span class="num" id="6156626">8</span><span class="op" id="6156627">,</span>&nbsp;<span class="num" id="6156629">16</span><span class="op" id="6156631">,</span>&nbsp;<span class="num" id="6156633">9</span><span class="op" id="6156634">,</span>&nbsp;<span class="num" id="6156636">2</span><span class="op" id="6156637">,</span>&nbsp;<span class="num" id="6156639">3</span><span class="op" id="6156640">,</span>&nbsp;<span class="num" id="6156642">10</span><span class="op" id="6156644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156647">17</span><span class="op" id="6156649">,</span>&nbsp;<span class="num" id="6156651">24</span><span class="op" id="6156653">,</span>&nbsp;<span class="num" id="6156655">32</span><span class="op" id="6156657">,</span>&nbsp;<span class="num" id="6156659">25</span><span class="op" id="6156661">,</span>&nbsp;<span class="num" id="6156663">18</span><span class="op" id="6156665">,</span>&nbsp;<span class="num" id="6156667">11</span><span class="op" id="6156669">,</span>&nbsp;<span class="num" id="6156671">4</span><span class="op" id="6156672">,</span>&nbsp;<span class="num" id="6156674">5</span><span class="op" id="6156675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156678">12</span><span class="op" id="6156680">,</span>&nbsp;<span class="num" id="6156682">19</span><span class="op" id="6156684">,</span>&nbsp;<span class="num" id="6156686">26</span><span class="op" id="6156688">,</span>&nbsp;<span class="num" id="6156690">33</span><span class="op" id="6156692">,</span>&nbsp;<span class="num" id="6156694">40</span><span class="op" id="6156696">,</span>&nbsp;<span class="num" id="6156698">48</span><span class="op" id="6156700">,</span>&nbsp;<span class="num" id="6156702">41</span><span class="op" id="6156704">,</span>&nbsp;<span class="num" id="6156706">34</span><span class="op" id="6156708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156711">27</span><span class="op" id="6156713">,</span>&nbsp;<span class="num" id="6156715">20</span><span class="op" id="6156717">,</span>&nbsp;<span class="num" id="6156719">13</span><span class="op" id="6156721">,</span>&nbsp;<span class="num" id="6156723">6</span><span class="op" id="6156724">,</span>&nbsp;<span class="num" id="6156726">7</span><span class="op" id="6156727">,</span>&nbsp;<span class="num" id="6156729">14</span><span class="op" id="6156731">,</span>&nbsp;<span class="num" id="6156733">21</span><span class="op" id="6156735">,</span>&nbsp;<span class="num" id="6156737">28</span><span class="op" id="6156739">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156742">35</span><span class="op" id="6156744">,</span>&nbsp;<span class="num" id="6156746">42</span><span class="op" id="6156748">,</span>&nbsp;<span class="num" id="6156750">49</span><span class="op" id="6156752">,</span>&nbsp;<span class="num" id="6156754">56</span><span class="op" id="6156756">,</span>&nbsp;<span class="num" id="6156758">57</span><span class="op" id="6156760">,</span>&nbsp;<span class="num" id="6156762">50</span><span class="op" id="6156764">,</span>&nbsp;<span class="num" id="6156766">43</span><span class="op" id="6156768">,</span>&nbsp;<span class="num" id="6156770">36</span><span class="op" id="6156772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156775">29</span><span class="op" id="6156777">,</span>&nbsp;<span class="num" id="6156779">22</span><span class="op" id="6156781">,</span>&nbsp;<span class="num" id="6156783">15</span><span class="op" id="6156785">,</span>&nbsp;<span class="num" id="6156787">23</span><span class="op" id="6156789">,</span>&nbsp;<span class="num" id="6156791">30</span><span class="op" id="6156793">,</span>&nbsp;<span class="num" id="6156795">37</span><span class="op" id="6156797">,</span>&nbsp;<span class="num" id="6156799">44</span><span class="op" id="6156801">,</span>&nbsp;<span class="num" id="6156803">51</span><span class="op" id="6156805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156808">58</span><span class="op" id="6156810">,</span>&nbsp;<span class="num" id="6156812">59</span><span class="op" id="6156814">,</span>&nbsp;<span class="num" id="6156816">52</span><span class="op" id="6156818">,</span>&nbsp;<span class="num" id="6156820">45</span><span class="op" id="6156822">,</span>&nbsp;<span class="num" id="6156824">38</span><span class="op" id="6156826">,</span>&nbsp;<span class="num" id="6156828">31</span><span class="op" id="6156830">,</span>&nbsp;<span class="num" id="6156832">39</span><span class="op" id="6156834">,</span>&nbsp;<span class="num" id="6156836">46</span><span class="op" id="6156838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6156841">53</span><span class="op" id="6156843">,</span>&nbsp;<span class="num" id="6156845">60</span><span class="op" id="6156847">,</span>&nbsp;<span class="num" id="6156849">61</span><span class="op" id="6156851">,</span>&nbsp;<span class="num" id="6156853">54</span><span class="op" id="6156855">,</span>&nbsp;<span class="num" id="6156857">47</span><span class="op" id="6156859">,</span>&nbsp;<span class="num" id="6156861">55</span><span class="op" id="6156863">,</span>&nbsp;<span class="num" id="6156865">62</span><span class="op" id="6156867">,</span>&nbsp;<span class="num" id="6156869">63</span><span class="op" id="6156871">,</span><br>
<span class="lineno"></span><span class="op" id="6156873">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="6156876">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="6156901">type</span>&nbsp;<span class="ident" id="6156906">Reader</span>&nbsp;<span class="keyword" id="6156913">interface</span>&nbsp;<span class="op" id="6156923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156926">io</span><span class="op" id="6156928">.</span><span class="ident" id="6156929">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6156941">io</span><span class="op" id="6156943">.</span><span class="ident" id="6156944">Reader</span><br>
<span class="lineno">90</span><span class="op" id="6156951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6156954">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6157032">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6157112">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="6157126">type</span>&nbsp;<span class="ident" id="6157131">bits</span>&nbsp;<span class="keyword" id="6157136">struct</span>&nbsp;<span class="op" id="6157143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157146">a</span>&nbsp;<span class="builtintype" id="6157148">uint32</span>&nbsp;<span class="comment" id="6157155">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157172">m</span>&nbsp;<span class="builtintype" id="6157174">uint32</span>&nbsp;<span class="comment" id="6157181">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157234">n</span>&nbsp;<span class="builtintype" id="6157236">int32</span>&nbsp;&nbsp;<span class="comment" id="6157243">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="6157278">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="6157281">type</span>&nbsp;<span class="ident" id="6157286">decoder</span>&nbsp;<span class="keyword" id="6157294">struct</span>&nbsp;<span class="op" id="6157301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157304">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157309">io</span><span class="op" id="6157311">.</span><span class="ident" id="6157312">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157320">bits</span>&nbsp;<span class="ident" id="6157325">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157331">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157401">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157470">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157521">bytes</span>&nbsp;<span class="keyword" id="6157527">struct</span>&nbsp;<span class="op" id="6157534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157538">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157600">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157656">buf</span>&nbsp;&nbsp;<span class="op" id="6157661">[</span><span class="num" id="6157662">4096</span><span class="op" id="6157666">]</span><span class="builtintype" id="6157667">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157674">i</span><span class="op" id="6157675">,</span>&nbsp;<span class="ident" id="6157677">j</span>&nbsp;<span class="builtintype" id="6157679">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157685">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6157744">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157784">nUnreadable</span>&nbsp;<span class="builtintype" id="6157796">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6157801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157804">width</span><span class="op" id="6157809">,</span>&nbsp;<span class="ident" id="6157811">height</span>&nbsp;<span class="builtintype" id="6157818">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157823">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6157837">*</span><span class="ident" id="6157838">image</span><span class="op" id="6157843">.</span><span class="ident" id="6157844">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157850">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6157864">*</span><span class="ident" id="6157865">image</span><span class="op" id="6157870">.</span><span class="ident" id="6157871">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157878">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6157892">int</span>&nbsp;<span class="comment" id="6157896">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157918">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6157932">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157937">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6157951">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6157957">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6157971">uint16</span>&nbsp;<span class="comment" id="6157978">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158029">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158043">[</span><span class="ident" id="6158044">nColorComponent</span><span class="op" id="6158059">]</span><span class="ident" id="6158060">component</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158071">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158085">[</span><span class="ident" id="6158086">nColorComponent</span><span class="op" id="6158101">]</span><span class="op" id="6158102">[</span><span class="op" id="6158103">]</span><span class="ident" id="6158104">block</span>&nbsp;<span class="comment" id="6158110">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158158">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158172">[</span><span class="ident" id="6158173">maxTc</span>&nbsp;<span class="op" id="6158179">+</span>&nbsp;<span class="num" id="6158181">1</span><span class="op" id="6158182">]</span><span class="op" id="6158183">[</span><span class="ident" id="6158184">maxTh</span>&nbsp;<span class="op" id="6158190">+</span>&nbsp;<span class="num" id="6158192">1</span><span class="op" id="6158193">]</span><span class="ident" id="6158194">huffman</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158203">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158217">[</span><span class="ident" id="6158218">maxTq</span>&nbsp;<span class="op" id="6158224">+</span>&nbsp;<span class="num" id="6158226">1</span><span class="op" id="6158227">]</span><span class="ident" id="6158228">block</span>&nbsp;<span class="comment" id="6158234">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158277">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158291">[</span><span class="ident" id="6158292">blockSize</span>&nbsp;<span class="op" id="6158302">+</span>&nbsp;<span class="num" id="6158304">1</span><span class="op" id="6158305">]</span><span class="builtintype" id="6158306">byte</span><br>
<span class="lineno"></span><span class="op" id="6158311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6158314">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6158388">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6158456">func</span>&nbsp;<span class="op" id="6158461">(</span><span class="ident" id="6158462">d</span>&nbsp;<span class="op" id="6158464">*</span><span class="ident" id="6158465">decoder</span><span class="op" id="6158472">)</span>&nbsp;<span class="ident" id="6158474">fill</span><span class="op" id="6158478">(</span><span class="op" id="6158479">)</span>&nbsp;<span class="builtintype" id="6158481">error</span>&nbsp;<span class="op" id="6158487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158490">if</span>&nbsp;<span class="ident" id="6158493">d</span><span class="op" id="6158494">.</span><span class="ident" id="6158495">bytes</span><span class="op" id="6158500">.</span><span class="ident" id="6158501">i</span>&nbsp;<span class="op" id="6158503">!=</span>&nbsp;<span class="ident" id="6158506">d</span><span class="op" id="6158507">.</span><span class="ident" id="6158508">bytes</span><span class="op" id="6158513">.</span><span class="ident" id="6158514">j</span>&nbsp;<span class="op" id="6158516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6158520">panic</span><span class="op" id="6158525">(</span><span class="string" id="6158526">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="6158569">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158575">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158645">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158680">if</span>&nbsp;<span class="ident" id="6158683">d</span><span class="op" id="6158684">.</span><span class="ident" id="6158685">bytes</span><span class="op" id="6158690">.</span><span class="ident" id="6158691">j</span>&nbsp;<span class="op" id="6158693">&gt;</span>&nbsp;<span class="num" id="6158695">2</span>&nbsp;<span class="op" id="6158697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158701">d</span><span class="op" id="6158702">.</span><span class="ident" id="6158703">bytes</span><span class="op" id="6158708">.</span><span class="ident" id="6158709">buf</span><span class="op" id="6158712">[</span><span class="num" id="6158713">0</span><span class="op" id="6158714">]</span>&nbsp;<span class="op" id="6158716">=</span>&nbsp;<span class="ident" id="6158718">d</span><span class="op" id="6158719">.</span><span class="ident" id="6158720">bytes</span><span class="op" id="6158725">.</span><span class="ident" id="6158726">buf</span><span class="op" id="6158729">[</span><span class="ident" id="6158730">d</span><span class="op" id="6158731">.</span><span class="ident" id="6158732">bytes</span><span class="op" id="6158737">.</span><span class="ident" id="6158738">j</span><span class="op" id="6158739">-</span><span class="num" id="6158740">2</span><span class="op" id="6158741">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158745">d</span><span class="op" id="6158746">.</span><span class="ident" id="6158747">bytes</span><span class="op" id="6158752">.</span><span class="ident" id="6158753">buf</span><span class="op" id="6158756">[</span><span class="num" id="6158757">1</span><span class="op" id="6158758">]</span>&nbsp;<span class="op" id="6158760">=</span>&nbsp;<span class="ident" id="6158762">d</span><span class="op" id="6158763">.</span><span class="ident" id="6158764">bytes</span><span class="op" id="6158769">.</span><span class="ident" id="6158770">buf</span><span class="op" id="6158773">[</span><span class="ident" id="6158774">d</span><span class="op" id="6158775">.</span><span class="ident" id="6158776">bytes</span><span class="op" id="6158781">.</span><span class="ident" id="6158782">j</span><span class="op" id="6158783">-</span><span class="num" id="6158784">1</span><span class="op" id="6158785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158789">d</span><span class="op" id="6158790">.</span><span class="ident" id="6158791">bytes</span><span class="op" id="6158796">.</span><span class="ident" id="6158797">i</span><span class="op" id="6158798">,</span>&nbsp;<span class="ident" id="6158800">d</span><span class="op" id="6158801">.</span><span class="ident" id="6158802">bytes</span><span class="op" id="6158807">.</span><span class="ident" id="6158808">j</span>&nbsp;<span class="op" id="6158810">=</span>&nbsp;<span class="num" id="6158812">2</span><span class="op" id="6158813">,</span>&nbsp;<span class="num" id="6158815">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6158821">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158857">n</span><span class="op" id="6158858">,</span>&nbsp;<span class="ident" id="6158860">err</span>&nbsp;<span class="op" id="6158864">:=</span>&nbsp;<span class="ident" id="6158867">d</span><span class="op" id="6158868">.</span><span class="ident" id="6158869">r</span><span class="op" id="6158870">.</span><span class="ident" id="6158871">Read</span><span class="op" id="6158875">(</span><span class="ident" id="6158876">d</span><span class="op" id="6158877">.</span><span class="ident" id="6158878">bytes</span><span class="op" id="6158883">.</span><span class="ident" id="6158884">buf</span><span class="op" id="6158887">[</span><span class="ident" id="6158888">d</span><span class="op" id="6158889">.</span><span class="ident" id="6158890">bytes</span><span class="op" id="6158895">.</span><span class="ident" id="6158896">j</span><span class="op" id="6158897">:</span><span class="op" id="6158898">]</span><span class="op" id="6158899">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158902">d</span><span class="op" id="6158903">.</span><span class="ident" id="6158904">bytes</span><span class="op" id="6158909">.</span><span class="ident" id="6158910">j</span>&nbsp;<span class="op" id="6158912">+=</span>&nbsp;<span class="ident" id="6158915">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158918">if</span>&nbsp;<span class="ident" id="6158921">n</span>&nbsp;<span class="op" id="6158923">&gt;</span>&nbsp;<span class="num" id="6158925">0</span>&nbsp;<span class="op" id="6158927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6158931">err</span>&nbsp;<span class="op" id="6158935">=</span>&nbsp;<span class="ident" id="6158937">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6158942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6158945">return</span>&nbsp;<span class="ident" id="6158952">err</span><br>
<span class="lineno">150</span><span class="op" id="6158956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6158959">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="6159033">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="6159113">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="6159192">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="6159270">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="6159338">func</span>&nbsp;<span class="op" id="6159343">(</span><span class="ident" id="6159344">d</span>&nbsp;<span class="op" id="6159346">*</span><span class="ident" id="6159347">decoder</span><span class="op" id="6159354">)</span>&nbsp;<span class="ident" id="6159356">unreadByteStuffedByte</span><span class="op" id="6159377">(</span><span class="op" id="6159378">)</span>&nbsp;<span class="op" id="6159380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159383">if</span>&nbsp;<span class="ident" id="6159386">d</span><span class="op" id="6159387">.</span><span class="ident" id="6159388">bytes</span><span class="op" id="6159393">.</span><span class="ident" id="6159394">nUnreadable</span>&nbsp;<span class="op" id="6159406">==</span>&nbsp;<span class="num" id="6159409">0</span>&nbsp;<span class="op" id="6159411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6159415">panic</span><span class="op" id="6159420">(</span><span class="string" id="6159421">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="6159475">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159481">d</span><span class="op" id="6159482">.</span><span class="ident" id="6159483">bytes</span><span class="op" id="6159488">.</span><span class="ident" id="6159489">i</span>&nbsp;<span class="op" id="6159491">-=</span>&nbsp;<span class="ident" id="6159494">d</span><span class="op" id="6159495">.</span><span class="ident" id="6159496">bytes</span><span class="op" id="6159501">.</span><span class="ident" id="6159502">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159515">d</span><span class="op" id="6159516">.</span><span class="ident" id="6159517">bytes</span><span class="op" id="6159522">.</span><span class="ident" id="6159523">nUnreadable</span>&nbsp;<span class="op" id="6159535">=</span>&nbsp;<span class="num" id="6159537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159540">if</span>&nbsp;<span class="ident" id="6159543">d</span><span class="op" id="6159544">.</span><span class="ident" id="6159545">bits</span><span class="op" id="6159549">.</span><span class="ident" id="6159550">n</span>&nbsp;<span class="op" id="6159552">&gt;=</span>&nbsp;<span class="num" id="6159555">8</span>&nbsp;<span class="op" id="6159557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159561">d</span><span class="op" id="6159562">.</span><span class="ident" id="6159563">bits</span><span class="op" id="6159567">.</span><span class="ident" id="6159568">a</span>&nbsp;<span class="op" id="6159570">&gt;&gt;=</span>&nbsp;<span class="num" id="6159574">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159578">d</span><span class="op" id="6159579">.</span><span class="ident" id="6159580">bits</span><span class="op" id="6159584">.</span><span class="ident" id="6159585">n</span>&nbsp;<span class="op" id="6159587">-=</span>&nbsp;<span class="num" id="6159590">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159594">d</span><span class="op" id="6159595">.</span><span class="ident" id="6159596">bits</span><span class="op" id="6159600">.</span><span class="ident" id="6159601">m</span>&nbsp;<span class="op" id="6159603">&gt;&gt;=</span>&nbsp;<span class="num" id="6159607">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159610">}</span><br>
<span class="lineno"></span><span class="op" id="6159612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="6159615">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="6159692">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="6159725">func</span>&nbsp;<span class="op" id="6159730">(</span><span class="ident" id="6159731">d</span>&nbsp;<span class="op" id="6159733">*</span><span class="ident" id="6159734">decoder</span><span class="op" id="6159741">)</span>&nbsp;<span class="ident" id="6159743">readByte</span><span class="op" id="6159751">(</span><span class="op" id="6159752">)</span>&nbsp;<span class="op" id="6159754">(</span><span class="ident" id="6159755">x</span>&nbsp;<span class="builtintype" id="6159757">byte</span><span class="op" id="6159761">,</span>&nbsp;<span class="ident" id="6159763">err</span>&nbsp;<span class="builtintype" id="6159767">error</span><span class="op" id="6159772">)</span>&nbsp;<span class="op" id="6159774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159777">for</span>&nbsp;<span class="ident" id="6159781">d</span><span class="op" id="6159782">.</span><span class="ident" id="6159783">bytes</span><span class="op" id="6159788">.</span><span class="ident" id="6159789">i</span>&nbsp;<span class="op" id="6159791">==</span>&nbsp;<span class="ident" id="6159794">d</span><span class="op" id="6159795">.</span><span class="ident" id="6159796">bytes</span><span class="op" id="6159801">.</span><span class="ident" id="6159802">j</span>&nbsp;<span class="op" id="6159804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159808">if</span>&nbsp;<span class="ident" id="6159811">err</span>&nbsp;<span class="op" id="6159815">=</span>&nbsp;<span class="ident" id="6159817">d</span><span class="op" id="6159818">.</span><span class="ident" id="6159819">fill</span><span class="op" id="6159823">(</span><span class="op" id="6159824">)</span><span class="op" id="6159825">;</span>&nbsp;<span class="ident" id="6159827">err</span>&nbsp;<span class="op" id="6159831">!=</span>&nbsp;<span class="ident" id="6159834">nil</span>&nbsp;<span class="op" id="6159838">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159843">return</span>&nbsp;<span class="num" id="6159850">0</span><span class="op" id="6159851">,</span>&nbsp;<span class="ident" id="6159853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6159862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159865">x</span>&nbsp;<span class="op" id="6159867">=</span>&nbsp;<span class="ident" id="6159869">d</span><span class="op" id="6159870">.</span><span class="ident" id="6159871">bytes</span><span class="op" id="6159876">.</span><span class="ident" id="6159877">buf</span><span class="op" id="6159880">[</span><span class="ident" id="6159881">d</span><span class="op" id="6159882">.</span><span class="ident" id="6159883">bytes</span><span class="op" id="6159888">.</span><span class="ident" id="6159889">i</span><span class="op" id="6159890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159893">d</span><span class="op" id="6159894">.</span><span class="ident" id="6159895">bytes</span><span class="op" id="6159900">.</span><span class="ident" id="6159901">i</span><span class="op" id="6159902">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159906">d</span><span class="op" id="6159907">.</span><span class="ident" id="6159908">bytes</span><span class="op" id="6159913">.</span><span class="ident" id="6159914">nUnreadable</span>&nbsp;<span class="op" id="6159926">=</span>&nbsp;<span class="num" id="6159928">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6159931">return</span>&nbsp;<span class="ident" id="6159938">x</span><span class="op" id="6159939">,</span>&nbsp;<span class="ident" id="6159941">nil</span><br>
<span class="lineno"></span><span class="op" id="6159945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6159948">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="6160025">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6160100">var</span>&nbsp;<span class="ident" id="6160104">errMissingFF00</span>&nbsp;<span class="op" id="6160119">=</span>&nbsp;<span class="ident" id="6160121">FormatError</span><span class="op" id="6160132">(</span><span class="string" id="6160133">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="6160158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160161">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6160239">func</span>&nbsp;<span class="op" id="6160244">(</span><span class="ident" id="6160245">d</span>&nbsp;<span class="op" id="6160247">*</span><span class="ident" id="6160248">decoder</span><span class="op" id="6160255">)</span>&nbsp;<span class="ident" id="6160257">readByteStuffedByte</span><span class="op" id="6160276">(</span><span class="op" id="6160277">)</span>&nbsp;<span class="op" id="6160279">(</span><span class="ident" id="6160280">x</span>&nbsp;<span class="builtintype" id="6160282">byte</span><span class="op" id="6160286">,</span>&nbsp;<span class="ident" id="6160288">err</span>&nbsp;<span class="builtintype" id="6160292">error</span><span class="op" id="6160297">)</span>&nbsp;<span class="op" id="6160299">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6160302">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160369">if</span>&nbsp;<span class="ident" id="6160372">d</span><span class="op" id="6160373">.</span><span class="ident" id="6160374">bytes</span><span class="op" id="6160379">.</span><span class="ident" id="6160380">i</span><span class="op" id="6160381">+</span><span class="num" id="6160382">2</span>&nbsp;<span class="op" id="6160384">&lt;=</span>&nbsp;<span class="ident" id="6160387">d</span><span class="op" id="6160388">.</span><span class="ident" id="6160389">bytes</span><span class="op" id="6160394">.</span><span class="ident" id="6160395">j</span>&nbsp;<span class="op" id="6160397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160401">x</span>&nbsp;<span class="op" id="6160403">=</span>&nbsp;<span class="ident" id="6160405">d</span><span class="op" id="6160406">.</span><span class="ident" id="6160407">bytes</span><span class="op" id="6160412">.</span><span class="ident" id="6160413">buf</span><span class="op" id="6160416">[</span><span class="ident" id="6160417">d</span><span class="op" id="6160418">.</span><span class="ident" id="6160419">bytes</span><span class="op" id="6160424">.</span><span class="ident" id="6160425">i</span><span class="op" id="6160426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160430">d</span><span class="op" id="6160431">.</span><span class="ident" id="6160432">bytes</span><span class="op" id="6160437">.</span><span class="ident" id="6160438">i</span><span class="op" id="6160439">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160444">d</span><span class="op" id="6160445">.</span><span class="ident" id="6160446">bytes</span><span class="op" id="6160451">.</span><span class="ident" id="6160452">nUnreadable</span>&nbsp;<span class="op" id="6160464">=</span>&nbsp;<span class="num" id="6160466">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160470">if</span>&nbsp;<span class="ident" id="6160473">x</span>&nbsp;<span class="op" id="6160475">!=</span>&nbsp;<span class="num" id="6160478">0xff</span>&nbsp;<span class="op" id="6160483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160488">return</span>&nbsp;<span class="ident" id="6160495">x</span><span class="op" id="6160496">,</span>&nbsp;<span class="ident" id="6160498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160508">if</span>&nbsp;<span class="ident" id="6160511">d</span><span class="op" id="6160512">.</span><span class="ident" id="6160513">bytes</span><span class="op" id="6160518">.</span><span class="ident" id="6160519">buf</span><span class="op" id="6160522">[</span><span class="ident" id="6160523">d</span><span class="op" id="6160524">.</span><span class="ident" id="6160525">bytes</span><span class="op" id="6160530">.</span><span class="ident" id="6160531">i</span><span class="op" id="6160532">]</span>&nbsp;<span class="op" id="6160534">!=</span>&nbsp;<span class="num" id="6160537">0x00</span>&nbsp;<span class="op" id="6160542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160547">return</span>&nbsp;<span class="num" id="6160554">0</span><span class="op" id="6160555">,</span>&nbsp;<span class="ident" id="6160557">errMissingFF00</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160578">d</span><span class="op" id="6160579">.</span><span class="ident" id="6160580">bytes</span><span class="op" id="6160585">.</span><span class="ident" id="6160586">i</span><span class="op" id="6160587">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160592">d</span><span class="op" id="6160593">.</span><span class="ident" id="6160594">bytes</span><span class="op" id="6160599">.</span><span class="ident" id="6160600">nUnreadable</span>&nbsp;<span class="op" id="6160612">=</span>&nbsp;<span class="num" id="6160614">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160618">return</span>&nbsp;<span class="num" id="6160625">0xff</span><span class="op" id="6160629">,</span>&nbsp;<span class="ident" id="6160631">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160636">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160640">x</span><span class="op" id="6160641">,</span>&nbsp;<span class="ident" id="6160643">err</span>&nbsp;<span class="op" id="6160647">=</span>&nbsp;<span class="ident" id="6160649">d</span><span class="op" id="6160650">.</span><span class="ident" id="6160651">readByte</span><span class="op" id="6160659">(</span><span class="op" id="6160660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160663">if</span>&nbsp;<span class="ident" id="6160666">err</span>&nbsp;<span class="op" id="6160670">!=</span>&nbsp;<span class="ident" id="6160673">nil</span>&nbsp;<span class="op" id="6160677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160681">return</span>&nbsp;<span class="num" id="6160688">0</span><span class="op" id="6160689">,</span>&nbsp;<span class="ident" id="6160691">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160696">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160699">if</span>&nbsp;<span class="ident" id="6160702">x</span>&nbsp;<span class="op" id="6160704">!=</span>&nbsp;<span class="num" id="6160707">0xff</span>&nbsp;<span class="op" id="6160712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160716">d</span><span class="op" id="6160717">.</span><span class="ident" id="6160718">bytes</span><span class="op" id="6160723">.</span><span class="ident" id="6160724">nUnreadable</span>&nbsp;<span class="op" id="6160736">=</span>&nbsp;<span class="num" id="6160738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160742">return</span>&nbsp;<span class="ident" id="6160749">x</span><span class="op" id="6160750">,</span>&nbsp;<span class="ident" id="6160752">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160761">x</span><span class="op" id="6160762">,</span>&nbsp;<span class="ident" id="6160764">err</span>&nbsp;<span class="op" id="6160768">=</span>&nbsp;<span class="ident" id="6160770">d</span><span class="op" id="6160771">.</span><span class="ident" id="6160772">readByte</span><span class="op" id="6160780">(</span><span class="op" id="6160781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160784">if</span>&nbsp;<span class="ident" id="6160787">err</span>&nbsp;<span class="op" id="6160791">!=</span>&nbsp;<span class="ident" id="6160794">nil</span>&nbsp;<span class="op" id="6160798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160802">d</span><span class="op" id="6160803">.</span><span class="ident" id="6160804">bytes</span><span class="op" id="6160809">.</span><span class="ident" id="6160810">nUnreadable</span>&nbsp;<span class="op" id="6160822">=</span>&nbsp;<span class="num" id="6160824">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160828">return</span>&nbsp;<span class="num" id="6160835">0</span><span class="op" id="6160836">,</span>&nbsp;<span class="ident" id="6160838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160843">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6160846">d</span><span class="op" id="6160847">.</span><span class="ident" id="6160848">bytes</span><span class="op" id="6160853">.</span><span class="ident" id="6160854">nUnreadable</span>&nbsp;<span class="op" id="6160866">=</span>&nbsp;<span class="num" id="6160868">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160871">if</span>&nbsp;<span class="ident" id="6160874">x</span>&nbsp;<span class="op" id="6160876">!=</span>&nbsp;<span class="num" id="6160879">0x00</span>&nbsp;<span class="op" id="6160884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160888">return</span>&nbsp;<span class="num" id="6160895">0</span><span class="op" id="6160896">,</span>&nbsp;<span class="ident" id="6160898">errMissingFF00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6160914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6160917">return</span>&nbsp;<span class="num" id="6160924">0xff</span><span class="op" id="6160928">,</span>&nbsp;<span class="ident" id="6160930">nil</span><br>
<span class="lineno">225</span><span class="op" id="6160934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160937">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="6161012">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="6161025">func</span>&nbsp;<span class="op" id="6161030">(</span><span class="ident" id="6161031">d</span>&nbsp;<span class="op" id="6161033">*</span><span class="ident" id="6161034">decoder</span><span class="op" id="6161041">)</span>&nbsp;<span class="ident" id="6161043">readFull</span><span class="op" id="6161051">(</span><span class="ident" id="6161052">p</span>&nbsp;<span class="op" id="6161054">[</span><span class="op" id="6161055">]</span><span class="builtintype" id="6161056">byte</span><span class="op" id="6161060">)</span>&nbsp;<span class="builtintype" id="6161062">error</span>&nbsp;<span class="op" id="6161068">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6161071">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161110">if</span>&nbsp;<span class="ident" id="6161113">d</span><span class="op" id="6161114">.</span><span class="ident" id="6161115">bytes</span><span class="op" id="6161120">.</span><span class="ident" id="6161121">nUnreadable</span>&nbsp;<span class="op" id="6161133">!=</span>&nbsp;<span class="num" id="6161136">0</span>&nbsp;<span class="op" id="6161138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161142">if</span>&nbsp;<span class="ident" id="6161145">d</span><span class="op" id="6161146">.</span><span class="ident" id="6161147">bits</span><span class="op" id="6161151">.</span><span class="ident" id="6161152">n</span>&nbsp;<span class="op" id="6161154">&gt;=</span>&nbsp;<span class="num" id="6161157">8</span>&nbsp;<span class="op" id="6161159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161164">d</span><span class="op" id="6161165">.</span><span class="ident" id="6161166">unreadByteStuffedByte</span><span class="op" id="6161187">(</span><span class="op" id="6161188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161192">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161196">d</span><span class="op" id="6161197">.</span><span class="ident" id="6161198">bytes</span><span class="op" id="6161203">.</span><span class="ident" id="6161204">nUnreadable</span>&nbsp;<span class="op" id="6161216">=</span>&nbsp;<span class="num" id="6161218">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161225">for</span>&nbsp;<span class="op" id="6161229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161233">n</span>&nbsp;<span class="op" id="6161235">:=</span>&nbsp;<span class="builtinfunc" id="6161238">copy</span><span class="op" id="6161242">(</span><span class="ident" id="6161243">p</span><span class="op" id="6161244">,</span>&nbsp;<span class="ident" id="6161246">d</span><span class="op" id="6161247">.</span><span class="ident" id="6161248">bytes</span><span class="op" id="6161253">.</span><span class="ident" id="6161254">buf</span><span class="op" id="6161257">[</span><span class="ident" id="6161258">d</span><span class="op" id="6161259">.</span><span class="ident" id="6161260">bytes</span><span class="op" id="6161265">.</span><span class="ident" id="6161266">i</span><span class="op" id="6161267">:</span><span class="ident" id="6161268">d</span><span class="op" id="6161269">.</span><span class="ident" id="6161270">bytes</span><span class="op" id="6161275">.</span><span class="ident" id="6161276">j</span><span class="op" id="6161277">]</span><span class="op" id="6161278">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161282">p</span>&nbsp;<span class="op" id="6161284">=</span>&nbsp;<span class="ident" id="6161286">p</span><span class="op" id="6161287">[</span><span class="ident" id="6161288">n</span><span class="op" id="6161289">:</span><span class="op" id="6161290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161294">d</span><span class="op" id="6161295">.</span><span class="ident" id="6161296">bytes</span><span class="op" id="6161301">.</span><span class="ident" id="6161302">i</span>&nbsp;<span class="op" id="6161304">+=</span>&nbsp;<span class="ident" id="6161307">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161311">if</span>&nbsp;<span class="builtinfunc" id="6161314">len</span><span class="op" id="6161317">(</span><span class="ident" id="6161318">p</span><span class="op" id="6161319">)</span>&nbsp;<span class="op" id="6161321">==</span>&nbsp;<span class="num" id="6161324">0</span>&nbsp;<span class="op" id="6161326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161331">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161339">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161343">if</span>&nbsp;<span class="ident" id="6161346">err</span>&nbsp;<span class="op" id="6161350">:=</span>&nbsp;<span class="ident" id="6161353">d</span><span class="op" id="6161354">.</span><span class="ident" id="6161355">fill</span><span class="op" id="6161359">(</span><span class="op" id="6161360">)</span><span class="op" id="6161361">;</span>&nbsp;<span class="ident" id="6161363">err</span>&nbsp;<span class="op" id="6161367">!=</span>&nbsp;<span class="ident" id="6161370">nil</span>&nbsp;<span class="op" id="6161374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161379">if</span>&nbsp;<span class="ident" id="6161382">err</span>&nbsp;<span class="op" id="6161386">==</span>&nbsp;<span class="ident" id="6161389">io</span><span class="op" id="6161391">.</span><span class="ident" id="6161392">EOF</span>&nbsp;<span class="op" id="6161396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161402">err</span>&nbsp;<span class="op" id="6161406">=</span>&nbsp;<span class="ident" id="6161408">io</span><span class="op" id="6161410">.</span><span class="ident" id="6161411">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161436">return</span>&nbsp;<span class="ident" id="6161443">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161455">return</span>&nbsp;<span class="ident" id="6161462">nil</span><br>
<span class="lineno"></span><span class="op" id="6161466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6161469">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6161505">func</span>&nbsp;<span class="op" id="6161510">(</span><span class="ident" id="6161511">d</span>&nbsp;<span class="op" id="6161513">*</span><span class="ident" id="6161514">decoder</span><span class="op" id="6161521">)</span>&nbsp;<span class="ident" id="6161523">ignore</span><span class="op" id="6161529">(</span><span class="ident" id="6161530">n</span>&nbsp;<span class="builtintype" id="6161532">int</span><span class="op" id="6161535">)</span>&nbsp;<span class="builtintype" id="6161537">error</span>&nbsp;<span class="op" id="6161543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6161546">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161585">if</span>&nbsp;<span class="ident" id="6161588">d</span><span class="op" id="6161589">.</span><span class="ident" id="6161590">bytes</span><span class="op" id="6161595">.</span><span class="ident" id="6161596">nUnreadable</span>&nbsp;<span class="op" id="6161608">!=</span>&nbsp;<span class="num" id="6161611">0</span>&nbsp;<span class="op" id="6161613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161617">if</span>&nbsp;<span class="ident" id="6161620">d</span><span class="op" id="6161621">.</span><span class="ident" id="6161622">bits</span><span class="op" id="6161626">.</span><span class="ident" id="6161627">n</span>&nbsp;<span class="op" id="6161629">&gt;=</span>&nbsp;<span class="num" id="6161632">8</span>&nbsp;<span class="op" id="6161634">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161639">d</span><span class="op" id="6161640">.</span><span class="ident" id="6161641">unreadByteStuffedByte</span><span class="op" id="6161662">(</span><span class="op" id="6161663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161671">d</span><span class="op" id="6161672">.</span><span class="ident" id="6161673">bytes</span><span class="op" id="6161678">.</span><span class="ident" id="6161679">nUnreadable</span>&nbsp;<span class="op" id="6161691">=</span>&nbsp;<span class="num" id="6161693">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161700">for</span>&nbsp;<span class="op" id="6161704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161708">m</span>&nbsp;<span class="op" id="6161710">:=</span>&nbsp;<span class="ident" id="6161713">d</span><span class="op" id="6161714">.</span><span class="ident" id="6161715">bytes</span><span class="op" id="6161720">.</span><span class="ident" id="6161721">j</span>&nbsp;<span class="op" id="6161723">-</span>&nbsp;<span class="ident" id="6161725">d</span><span class="op" id="6161726">.</span><span class="ident" id="6161727">bytes</span><span class="op" id="6161732">.</span><span class="ident" id="6161733">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161737">if</span>&nbsp;<span class="ident" id="6161740">m</span>&nbsp;<span class="op" id="6161742">&gt;</span>&nbsp;<span class="ident" id="6161744">n</span>&nbsp;<span class="op" id="6161746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161751">m</span>&nbsp;<span class="op" id="6161753">=</span>&nbsp;<span class="ident" id="6161755">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161759">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161763">d</span><span class="op" id="6161764">.</span><span class="ident" id="6161765">bytes</span><span class="op" id="6161770">.</span><span class="ident" id="6161771">i</span>&nbsp;<span class="op" id="6161773">+=</span>&nbsp;<span class="ident" id="6161776">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161780">n</span>&nbsp;<span class="op" id="6161782">-=</span>&nbsp;<span class="ident" id="6161785">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161789">if</span>&nbsp;<span class="ident" id="6161792">n</span>&nbsp;<span class="op" id="6161794">==</span>&nbsp;<span class="num" id="6161797">0</span>&nbsp;<span class="op" id="6161799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161804">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161812">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161816">if</span>&nbsp;<span class="ident" id="6161819">err</span>&nbsp;<span class="op" id="6161823">:=</span>&nbsp;<span class="ident" id="6161826">d</span><span class="op" id="6161827">.</span><span class="ident" id="6161828">fill</span><span class="op" id="6161832">(</span><span class="op" id="6161833">)</span><span class="op" id="6161834">;</span>&nbsp;<span class="ident" id="6161836">err</span>&nbsp;<span class="op" id="6161840">!=</span>&nbsp;<span class="ident" id="6161843">nil</span>&nbsp;<span class="op" id="6161847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161852">if</span>&nbsp;<span class="ident" id="6161855">err</span>&nbsp;<span class="op" id="6161859">==</span>&nbsp;<span class="ident" id="6161862">io</span><span class="op" id="6161864">.</span><span class="ident" id="6161865">EOF</span>&nbsp;<span class="op" id="6161869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6161875">err</span>&nbsp;<span class="op" id="6161879">=</span>&nbsp;<span class="ident" id="6161881">io</span><span class="op" id="6161883">.</span><span class="ident" id="6161884">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161909">return</span>&nbsp;<span class="ident" id="6161916">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6161925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6161928">return</span>&nbsp;<span class="ident" id="6161935">nil</span><br>
<span class="lineno"></span><span class="op" id="6161939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6161942">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="6161973">func</span>&nbsp;<span class="op" id="6161978">(</span><span class="ident" id="6161979">d</span>&nbsp;<span class="op" id="6161981">*</span><span class="ident" id="6161982">decoder</span><span class="op" id="6161989">)</span>&nbsp;<span class="ident" id="6161991">processSOF</span><span class="op" id="6162001">(</span><span class="ident" id="6162002">n</span>&nbsp;<span class="builtintype" id="6162004">int</span><span class="op" id="6162007">)</span>&nbsp;<span class="builtintype" id="6162009">error</span>&nbsp;<span class="op" id="6162015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162018">switch</span>&nbsp;<span class="ident" id="6162025">n</span>&nbsp;<span class="op" id="6162027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162030">case</span>&nbsp;<span class="num" id="6162035">6</span>&nbsp;<span class="op" id="6162037">+</span>&nbsp;<span class="num" id="6162039">3</span><span class="op" id="6162040">*</span><span class="ident" id="6162041">nGrayComponent</span><span class="op" id="6162055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162059">d</span><span class="op" id="6162060">.</span><span class="ident" id="6162061">nComp</span>&nbsp;<span class="op" id="6162067">=</span>&nbsp;<span class="ident" id="6162069">nGrayComponent</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162085">case</span>&nbsp;<span class="num" id="6162090">6</span>&nbsp;<span class="op" id="6162092">+</span>&nbsp;<span class="num" id="6162094">3</span><span class="op" id="6162095">*</span><span class="ident" id="6162096">nColorComponent</span><span class="op" id="6162111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162115">d</span><span class="op" id="6162116">.</span><span class="ident" id="6162117">nComp</span>&nbsp;<span class="op" id="6162123">=</span>&nbsp;<span class="ident" id="6162125">nColorComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162142">default</span><span class="op" id="6162149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162153">return</span>&nbsp;<span class="ident" id="6162160">UnsupportedError</span><span class="op" id="6162176">(</span><span class="string" id="6162177">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6162199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162202">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162205">if</span>&nbsp;<span class="ident" id="6162208">err</span>&nbsp;<span class="op" id="6162212">:=</span>&nbsp;<span class="ident" id="6162215">d</span><span class="op" id="6162216">.</span><span class="ident" id="6162217">readFull</span><span class="op" id="6162225">(</span><span class="ident" id="6162226">d</span><span class="op" id="6162227">.</span><span class="ident" id="6162228">tmp</span><span class="op" id="6162231">[</span><span class="op" id="6162232">:</span><span class="ident" id="6162233">n</span><span class="op" id="6162234">]</span><span class="op" id="6162235">)</span><span class="op" id="6162236">;</span>&nbsp;<span class="ident" id="6162238">err</span>&nbsp;<span class="op" id="6162242">!=</span>&nbsp;<span class="ident" id="6162245">nil</span>&nbsp;<span class="op" id="6162249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162253">return</span>&nbsp;<span class="ident" id="6162260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162268">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162305">if</span>&nbsp;<span class="ident" id="6162308">d</span><span class="op" id="6162309">.</span><span class="ident" id="6162310">tmp</span><span class="op" id="6162313">[</span><span class="num" id="6162314">0</span><span class="op" id="6162315">]</span>&nbsp;<span class="op" id="6162317">!=</span>&nbsp;<span class="num" id="6162320">8</span>&nbsp;<span class="op" id="6162322">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162326">return</span>&nbsp;<span class="ident" id="6162333">UnsupportedError</span><span class="op" id="6162349">(</span><span class="string" id="6162350">&#34;precision&#34;</span><span class="op" id="6162361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162367">d</span><span class="op" id="6162368">.</span><span class="ident" id="6162369">height</span>&nbsp;<span class="op" id="6162376">=</span>&nbsp;<span class="builtintype" id="6162378">int</span><span class="op" id="6162381">(</span><span class="ident" id="6162382">d</span><span class="op" id="6162383">.</span><span class="ident" id="6162384">tmp</span><span class="op" id="6162387">[</span><span class="num" id="6162388">1</span><span class="op" id="6162389">]</span><span class="op" id="6162390">)</span><span class="op" id="6162391">&lt;&lt;</span><span class="num" id="6162393">8</span>&nbsp;<span class="op" id="6162395">+</span>&nbsp;<span class="builtintype" id="6162397">int</span><span class="op" id="6162400">(</span><span class="ident" id="6162401">d</span><span class="op" id="6162402">.</span><span class="ident" id="6162403">tmp</span><span class="op" id="6162406">[</span><span class="num" id="6162407">2</span><span class="op" id="6162408">]</span><span class="op" id="6162409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162412">d</span><span class="op" id="6162413">.</span><span class="ident" id="6162414">width</span>&nbsp;<span class="op" id="6162420">=</span>&nbsp;<span class="builtintype" id="6162422">int</span><span class="op" id="6162425">(</span><span class="ident" id="6162426">d</span><span class="op" id="6162427">.</span><span class="ident" id="6162428">tmp</span><span class="op" id="6162431">[</span><span class="num" id="6162432">3</span><span class="op" id="6162433">]</span><span class="op" id="6162434">)</span><span class="op" id="6162435">&lt;&lt;</span><span class="num" id="6162437">8</span>&nbsp;<span class="op" id="6162439">+</span>&nbsp;<span class="builtintype" id="6162441">int</span><span class="op" id="6162444">(</span><span class="ident" id="6162445">d</span><span class="op" id="6162446">.</span><span class="ident" id="6162447">tmp</span><span class="op" id="6162450">[</span><span class="num" id="6162451">4</span><span class="op" id="6162452">]</span><span class="op" id="6162453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162456">if</span>&nbsp;<span class="builtintype" id="6162459">int</span><span class="op" id="6162462">(</span><span class="ident" id="6162463">d</span><span class="op" id="6162464">.</span><span class="ident" id="6162465">tmp</span><span class="op" id="6162468">[</span><span class="num" id="6162469">5</span><span class="op" id="6162470">]</span><span class="op" id="6162471">)</span>&nbsp;<span class="op" id="6162473">!=</span>&nbsp;<span class="ident" id="6162476">d</span><span class="op" id="6162477">.</span><span class="ident" id="6162478">nComp</span>&nbsp;<span class="op" id="6162484">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162488">return</span>&nbsp;<span class="ident" id="6162495">UnsupportedError</span><span class="op" id="6162511">(</span><span class="string" id="6162512">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="6162554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6162557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162560">for</span>&nbsp;<span class="ident" id="6162564">i</span>&nbsp;<span class="op" id="6162566">:=</span>&nbsp;<span class="num" id="6162569">0</span><span class="op" id="6162570">;</span>&nbsp;<span class="ident" id="6162572">i</span>&nbsp;<span class="op" id="6162574">&lt;</span>&nbsp;<span class="ident" id="6162576">d</span><span class="op" id="6162577">.</span><span class="ident" id="6162578">nComp</span><span class="op" id="6162583">;</span>&nbsp;<span class="ident" id="6162585">i</span><span class="op" id="6162586">++</span>&nbsp;<span class="op" id="6162589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162593">d</span><span class="op" id="6162594">.</span><span class="ident" id="6162595">comp</span><span class="op" id="6162599">[</span><span class="ident" id="6162600">i</span><span class="op" id="6162601">]</span><span class="op" id="6162602">.</span><span class="ident" id="6162603">c</span>&nbsp;<span class="op" id="6162605">=</span>&nbsp;<span class="ident" id="6162607">d</span><span class="op" id="6162608">.</span><span class="ident" id="6162609">tmp</span><span class="op" id="6162612">[</span><span class="num" id="6162613">6</span><span class="op" id="6162614">+</span><span class="num" id="6162615">3</span><span class="op" id="6162616">*</span><span class="ident" id="6162617">i</span><span class="op" id="6162618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6162622">d</span><span class="op" id="6162623">.</span><span class="ident" id="6162624">comp</span><span class="op" id="6162628">[</span><span class="ident" id="6162629">i</span><span class="op" id="6162630">]</span><span class="op" id="6162631">.</span><span class="ident" id="6162632">tq</span>&nbsp;<span class="op" id="6162635">=</span>&nbsp;<span class="ident" id="6162637">d</span><span class="op" id="6162638">.</span><span class="ident" id="6162639">tmp</span><span class="op" id="6162642">[</span><span class="num" id="6162643">8</span><span class="op" id="6162644">+</span><span class="num" id="6162645">3</span><span class="op" id="6162646">*</span><span class="ident" id="6162647">i</span><span class="op" id="6162648">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6162652">if</span>&nbsp;<span class="ident" id="6162655">d</span><span class="op" id="6162656">.</span><span class="ident" id="6162657">nComp</span>&nbsp;<span class="op" id="6162663">==</span>&nbsp;<span class="ident" id="6162666">nGrayComponent</span>&nbsp;<span class="op" id="6162681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162686">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162760">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162833">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162909">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6162986">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163062">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163139">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163215">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163291">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163368">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163441">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163472">d</span><span class="op" id="6163473">.</span><span class="ident" id="6163474">comp</span><span class="op" id="6163478">[</span><span class="ident" id="6163479">i</span><span class="op" id="6163480">]</span><span class="op" id="6163481">.</span><span class="ident" id="6163482">h</span>&nbsp;<span class="op" id="6163484">=</span>&nbsp;<span class="num" id="6163486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163491">d</span><span class="op" id="6163492">.</span><span class="ident" id="6163493">comp</span><span class="op" id="6163497">[</span><span class="ident" id="6163498">i</span><span class="op" id="6163499">]</span><span class="op" id="6163500">.</span><span class="ident" id="6163501">v</span>&nbsp;<span class="op" id="6163503">=</span>&nbsp;<span class="num" id="6163505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163510">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6163521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163525">hv</span>&nbsp;<span class="op" id="6163528">:=</span>&nbsp;<span class="ident" id="6163531">d</span><span class="op" id="6163532">.</span><span class="ident" id="6163533">tmp</span><span class="op" id="6163536">[</span><span class="num" id="6163537">7</span><span class="op" id="6163538">+</span><span class="num" id="6163539">3</span><span class="op" id="6163540">*</span><span class="ident" id="6163541">i</span><span class="op" id="6163542">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163546">d</span><span class="op" id="6163547">.</span><span class="ident" id="6163548">comp</span><span class="op" id="6163552">[</span><span class="ident" id="6163553">i</span><span class="op" id="6163554">]</span><span class="op" id="6163555">.</span><span class="ident" id="6163556">h</span>&nbsp;<span class="op" id="6163558">=</span>&nbsp;<span class="builtintype" id="6163560">int</span><span class="op" id="6163563">(</span><span class="ident" id="6163564">hv</span>&nbsp;<span class="op" id="6163567">&gt;&gt;</span>&nbsp;<span class="num" id="6163570">4</span><span class="op" id="6163571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6163575">d</span><span class="op" id="6163576">.</span><span class="ident" id="6163577">comp</span><span class="op" id="6163581">[</span><span class="ident" id="6163582">i</span><span class="op" id="6163583">]</span><span class="op" id="6163584">.</span><span class="ident" id="6163585">v</span>&nbsp;<span class="op" id="6163587">=</span>&nbsp;<span class="builtintype" id="6163589">int</span><span class="op" id="6163592">(</span><span class="ident" id="6163593">hv</span>&nbsp;<span class="op" id="6163596">&amp;</span>&nbsp;<span class="num" id="6163598">0x0f</span><span class="op" id="6163602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163606">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163681">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163753">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6163828">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163885">if</span>&nbsp;<span class="ident" id="6163888">i</span>&nbsp;<span class="op" id="6163890">==</span>&nbsp;<span class="num" id="6163893">0</span>&nbsp;<span class="op" id="6163895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163900">if</span>&nbsp;<span class="ident" id="6163903">hv</span>&nbsp;<span class="op" id="6163906">!=</span>&nbsp;<span class="num" id="6163909">0x11</span>&nbsp;<span class="op" id="6163914">&amp;&amp;</span>&nbsp;<span class="ident" id="6163917">hv</span>&nbsp;<span class="op" id="6163920">!=</span>&nbsp;<span class="num" id="6163923">0x21</span>&nbsp;<span class="op" id="6163928">&amp;&amp;</span>&nbsp;<span class="ident" id="6163931">hv</span>&nbsp;<span class="op" id="6163934">!=</span>&nbsp;<span class="num" id="6163937">0x22</span>&nbsp;<span class="op" id="6163942">&amp;&amp;</span>&nbsp;<span class="ident" id="6163945">hv</span>&nbsp;<span class="op" id="6163948">!=</span>&nbsp;<span class="num" id="6163951">0x12</span>&nbsp;<span class="op" id="6163956">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6163962">return</span>&nbsp;<span class="ident" id="6163969">UnsupportedError</span><span class="op" id="6163985">(</span><span class="string" id="6163986">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="6164016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164025">}</span>&nbsp;<span class="keyword" id="6164027">else</span>&nbsp;<span class="keyword" id="6164032">if</span>&nbsp;<span class="ident" id="6164035">hv</span>&nbsp;<span class="op" id="6164038">!=</span>&nbsp;<span class="num" id="6164041">0x11</span>&nbsp;<span class="op" id="6164046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164051">return</span>&nbsp;<span class="ident" id="6164058">UnsupportedError</span><span class="op" id="6164074">(</span><span class="string" id="6164075">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="6164105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164109">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164115">return</span>&nbsp;<span class="ident" id="6164122">nil</span><br>
<span class="lineno"></span><span class="op" id="6164126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6164129">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="6164162">func</span>&nbsp;<span class="op" id="6164167">(</span><span class="ident" id="6164168">d</span>&nbsp;<span class="op" id="6164170">*</span><span class="ident" id="6164171">decoder</span><span class="op" id="6164178">)</span>&nbsp;<span class="ident" id="6164180">processDQT</span><span class="op" id="6164190">(</span><span class="ident" id="6164191">n</span>&nbsp;<span class="builtintype" id="6164193">int</span><span class="op" id="6164196">)</span>&nbsp;<span class="builtintype" id="6164198">error</span>&nbsp;<span class="op" id="6164204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164207">const</span>&nbsp;<span class="ident" id="6164213">qtLength</span>&nbsp;<span class="op" id="6164222">=</span>&nbsp;<span class="num" id="6164224">1</span>&nbsp;<span class="op" id="6164226">+</span>&nbsp;<span class="ident" id="6164228">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164239">for</span>&nbsp;<span class="op" id="6164243">;</span>&nbsp;<span class="ident" id="6164245">n</span>&nbsp;<span class="op" id="6164247">&gt;=</span>&nbsp;<span class="ident" id="6164250">qtLength</span><span class="op" id="6164258">;</span>&nbsp;<span class="ident" id="6164260">n</span>&nbsp;<span class="op" id="6164262">-=</span>&nbsp;<span class="ident" id="6164265">qtLength</span>&nbsp;<span class="op" id="6164274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164278">if</span>&nbsp;<span class="ident" id="6164281">err</span>&nbsp;<span class="op" id="6164285">:=</span>&nbsp;<span class="ident" id="6164288">d</span><span class="op" id="6164289">.</span><span class="ident" id="6164290">readFull</span><span class="op" id="6164298">(</span><span class="ident" id="6164299">d</span><span class="op" id="6164300">.</span><span class="ident" id="6164301">tmp</span><span class="op" id="6164304">[</span><span class="op" id="6164305">:</span><span class="ident" id="6164306">qtLength</span><span class="op" id="6164314">]</span><span class="op" id="6164315">)</span><span class="op" id="6164316">;</span>&nbsp;<span class="ident" id="6164318">err</span>&nbsp;<span class="op" id="6164322">!=</span>&nbsp;<span class="ident" id="6164325">nil</span>&nbsp;<span class="op" id="6164329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164334">return</span>&nbsp;<span class="ident" id="6164341">err</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164351">pq</span>&nbsp;<span class="op" id="6164354">:=</span>&nbsp;<span class="ident" id="6164357">d</span><span class="op" id="6164358">.</span><span class="ident" id="6164359">tmp</span><span class="op" id="6164362">[</span><span class="num" id="6164363">0</span><span class="op" id="6164364">]</span>&nbsp;<span class="op" id="6164366">&gt;&gt;</span>&nbsp;<span class="num" id="6164369">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164373">if</span>&nbsp;<span class="ident" id="6164376">pq</span>&nbsp;<span class="op" id="6164379">!=</span>&nbsp;<span class="num" id="6164382">0</span>&nbsp;<span class="op" id="6164384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164389">return</span>&nbsp;<span class="ident" id="6164396">UnsupportedError</span><span class="op" id="6164412">(</span><span class="string" id="6164413">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="6164427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164431">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164435">tq</span>&nbsp;<span class="op" id="6164438">:=</span>&nbsp;<span class="ident" id="6164441">d</span><span class="op" id="6164442">.</span><span class="ident" id="6164443">tmp</span><span class="op" id="6164446">[</span><span class="num" id="6164447">0</span><span class="op" id="6164448">]</span>&nbsp;<span class="op" id="6164450">&amp;</span>&nbsp;<span class="num" id="6164452">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164459">if</span>&nbsp;<span class="ident" id="6164462">tq</span>&nbsp;<span class="op" id="6164465">&gt;</span>&nbsp;<span class="ident" id="6164467">maxTq</span>&nbsp;<span class="op" id="6164473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164478">return</span>&nbsp;<span class="ident" id="6164485">FormatError</span><span class="op" id="6164496">(</span><span class="string" id="6164497">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="6164511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164519">for</span>&nbsp;<span class="ident" id="6164523">i</span>&nbsp;<span class="op" id="6164525">:=</span>&nbsp;<span class="keyword" id="6164528">range</span>&nbsp;<span class="ident" id="6164534">d</span><span class="op" id="6164535">.</span><span class="ident" id="6164536">quant</span><span class="op" id="6164541">[</span><span class="ident" id="6164542">tq</span><span class="op" id="6164544">]</span>&nbsp;<span class="op" id="6164546">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164551">d</span><span class="op" id="6164552">.</span><span class="ident" id="6164553">quant</span><span class="op" id="6164558">[</span><span class="ident" id="6164559">tq</span><span class="op" id="6164561">]</span><span class="op" id="6164562">[</span><span class="ident" id="6164563">i</span><span class="op" id="6164564">]</span>&nbsp;<span class="op" id="6164566">=</span>&nbsp;<span class="builtintype" id="6164568">int32</span><span class="op" id="6164573">(</span><span class="ident" id="6164574">d</span><span class="op" id="6164575">.</span><span class="ident" id="6164576">tmp</span><span class="op" id="6164579">[</span><span class="ident" id="6164580">i</span><span class="op" id="6164581">+</span><span class="num" id="6164582">1</span><span class="op" id="6164583">]</span><span class="op" id="6164584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164594">if</span>&nbsp;<span class="ident" id="6164597">n</span>&nbsp;<span class="op" id="6164599">!=</span>&nbsp;<span class="num" id="6164602">0</span>&nbsp;<span class="op" id="6164604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164608">return</span>&nbsp;<span class="ident" id="6164615">FormatError</span><span class="op" id="6164626">(</span><span class="string" id="6164627">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6164649">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164655">return</span>&nbsp;<span class="ident" id="6164662">nil</span><br>
<span class="lineno"></span><span class="op" id="6164666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6164669">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="6164702">func</span>&nbsp;<span class="op" id="6164707">(</span><span class="ident" id="6164708">d</span>&nbsp;<span class="op" id="6164710">*</span><span class="ident" id="6164711">decoder</span><span class="op" id="6164718">)</span>&nbsp;<span class="ident" id="6164720">processDRI</span><span class="op" id="6164730">(</span><span class="ident" id="6164731">n</span>&nbsp;<span class="builtintype" id="6164733">int</span><span class="op" id="6164736">)</span>&nbsp;<span class="builtintype" id="6164738">error</span>&nbsp;<span class="op" id="6164744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164747">if</span>&nbsp;<span class="ident" id="6164750">n</span>&nbsp;<span class="op" id="6164752">!=</span>&nbsp;<span class="num" id="6164755">2</span>&nbsp;<span class="op" id="6164757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164761">return</span>&nbsp;<span class="ident" id="6164768">FormatError</span><span class="op" id="6164779">(</span><span class="string" id="6164780">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6164802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164808">if</span>&nbsp;<span class="ident" id="6164811">err</span>&nbsp;<span class="op" id="6164815">:=</span>&nbsp;<span class="ident" id="6164818">d</span><span class="op" id="6164819">.</span><span class="ident" id="6164820">readFull</span><span class="op" id="6164828">(</span><span class="ident" id="6164829">d</span><span class="op" id="6164830">.</span><span class="ident" id="6164831">tmp</span><span class="op" id="6164834">[</span><span class="op" id="6164835">:</span><span class="num" id="6164836">2</span><span class="op" id="6164837">]</span><span class="op" id="6164838">)</span><span class="op" id="6164839">;</span>&nbsp;<span class="ident" id="6164841">err</span>&nbsp;<span class="op" id="6164845">!=</span>&nbsp;<span class="ident" id="6164848">nil</span>&nbsp;<span class="op" id="6164852">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164856">return</span>&nbsp;<span class="ident" id="6164863">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6164868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6164871">d</span><span class="op" id="6164872">.</span><span class="ident" id="6164873">ri</span>&nbsp;<span class="op" id="6164876">=</span>&nbsp;<span class="builtintype" id="6164878">int</span><span class="op" id="6164881">(</span><span class="ident" id="6164882">d</span><span class="op" id="6164883">.</span><span class="ident" id="6164884">tmp</span><span class="op" id="6164887">[</span><span class="num" id="6164888">0</span><span class="op" id="6164889">]</span><span class="op" id="6164890">)</span><span class="op" id="6164891">&lt;&lt;</span><span class="num" id="6164893">8</span>&nbsp;<span class="op" id="6164895">+</span>&nbsp;<span class="builtintype" id="6164897">int</span><span class="op" id="6164900">(</span><span class="ident" id="6164901">d</span><span class="op" id="6164902">.</span><span class="ident" id="6164903">tmp</span><span class="op" id="6164906">[</span><span class="num" id="6164907">1</span><span class="op" id="6164908">]</span><span class="op" id="6164909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6164912">return</span>&nbsp;<span class="ident" id="6164919">nil</span><br>
<span class="lineno"></span><span class="op" id="6164923">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="6164926">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6164996">func</span>&nbsp;<span class="op" id="6165001">(</span><span class="ident" id="6165002">d</span>&nbsp;<span class="op" id="6165004">*</span><span class="ident" id="6165005">decoder</span><span class="op" id="6165012">)</span>&nbsp;<span class="ident" id="6165014">decode</span><span class="op" id="6165020">(</span><span class="ident" id="6165021">r</span>&nbsp;<span class="ident" id="6165023">io</span><span class="op" id="6165025">.</span><span class="ident" id="6165026">Reader</span><span class="op" id="6165032">,</span>&nbsp;<span class="ident" id="6165034">configOnly</span>&nbsp;<span class="builtintype" id="6165045">bool</span><span class="op" id="6165049">)</span>&nbsp;<span class="op" id="6165051">(</span><span class="ident" id="6165052">image</span><span class="op" id="6165057">.</span><span class="ident" id="6165058">Image</span><span class="op" id="6165063">,</span>&nbsp;<span class="builtintype" id="6165065">error</span><span class="op" id="6165070">)</span>&nbsp;<span class="op" id="6165072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165075">d</span><span class="op" id="6165076">.</span><span class="ident" id="6165077">r</span>&nbsp;<span class="op" id="6165079">=</span>&nbsp;<span class="ident" id="6165081">r</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165085">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165126">if</span>&nbsp;<span class="ident" id="6165129">err</span>&nbsp;<span class="op" id="6165133">:=</span>&nbsp;<span class="ident" id="6165136">d</span><span class="op" id="6165137">.</span><span class="ident" id="6165138">readFull</span><span class="op" id="6165146">(</span><span class="ident" id="6165147">d</span><span class="op" id="6165148">.</span><span class="ident" id="6165149">tmp</span><span class="op" id="6165152">[</span><span class="op" id="6165153">:</span><span class="num" id="6165154">2</span><span class="op" id="6165155">]</span><span class="op" id="6165156">)</span><span class="op" id="6165157">;</span>&nbsp;<span class="ident" id="6165159">err</span>&nbsp;<span class="op" id="6165163">!=</span>&nbsp;<span class="ident" id="6165166">nil</span>&nbsp;<span class="op" id="6165170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165174">return</span>&nbsp;<span class="ident" id="6165181">nil</span><span class="op" id="6165184">,</span>&nbsp;<span class="ident" id="6165186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6165191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165194">if</span>&nbsp;<span class="ident" id="6165197">d</span><span class="op" id="6165198">.</span><span class="ident" id="6165199">tmp</span><span class="op" id="6165202">[</span><span class="num" id="6165203">0</span><span class="op" id="6165204">]</span>&nbsp;<span class="op" id="6165206">!=</span>&nbsp;<span class="num" id="6165209">0xff</span>&nbsp;<span class="op" id="6165214">||</span>&nbsp;<span class="ident" id="6165217">d</span><span class="op" id="6165218">.</span><span class="ident" id="6165219">tmp</span><span class="op" id="6165222">[</span><span class="num" id="6165223">1</span><span class="op" id="6165224">]</span>&nbsp;<span class="op" id="6165226">!=</span>&nbsp;<span class="ident" id="6165229">soiMarker</span>&nbsp;<span class="op" id="6165239">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165243">return</span>&nbsp;<span class="ident" id="6165250">nil</span><span class="op" id="6165253">,</span>&nbsp;<span class="ident" id="6165255">FormatError</span><span class="op" id="6165266">(</span><span class="string" id="6165267">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="6165287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6165290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165294">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165360">for</span>&nbsp;<span class="op" id="6165364">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6165368">err</span>&nbsp;<span class="op" id="6165372">:=</span>&nbsp;<span class="ident" id="6165375">d</span><span class="op" id="6165376">.</span><span class="ident" id="6165377">readFull</span><span class="op" id="6165385">(</span><span class="ident" id="6165386">d</span><span class="op" id="6165387">.</span><span class="ident" id="6165388">tmp</span><span class="op" id="6165391">[</span><span class="op" id="6165392">:</span><span class="num" id="6165393">2</span><span class="op" id="6165394">]</span><span class="op" id="6165395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165399">if</span>&nbsp;<span class="ident" id="6165402">err</span>&nbsp;<span class="op" id="6165406">!=</span>&nbsp;<span class="ident" id="6165409">nil</span>&nbsp;<span class="op" id="6165413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165418">return</span>&nbsp;<span class="ident" id="6165425">nil</span><span class="op" id="6165428">,</span>&nbsp;<span class="ident" id="6165430">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6165436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6165440">for</span>&nbsp;<span class="ident" id="6165444">d</span><span class="op" id="6165445">.</span><span class="ident" id="6165446">tmp</span><span class="op" id="6165449">[</span><span class="num" id="6165450">0</span><span class="op" id="6165451">]</span>&nbsp;<span class="op" id="6165453">!=</span>&nbsp;<span class="num" id="6165456">0xff</span>&nbsp;<span class="op" id="6165461">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165466">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165535">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165601">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165670">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165737">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165807">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165873">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6165942">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166014">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166081">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166153">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166177">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166183">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166254">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166281">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166287">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166354">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166408">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166414">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166484">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166551">d</span><span class="op" id="6166552">.</span><span class="ident" id="6166553">tmp</span><span class="op" id="6166556">[</span><span class="num" id="6166557">0</span><span class="op" id="6166558">]</span>&nbsp;<span class="op" id="6166560">=</span>&nbsp;<span class="ident" id="6166562">d</span><span class="op" id="6166563">.</span><span class="ident" id="6166564">tmp</span><span class="op" id="6166567">[</span><span class="num" id="6166568">1</span><span class="op" id="6166569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166574">d</span><span class="op" id="6166575">.</span><span class="ident" id="6166576">tmp</span><span class="op" id="6166579">[</span><span class="num" id="6166580">1</span><span class="op" id="6166581">]</span><span class="op" id="6166582">,</span>&nbsp;<span class="ident" id="6166584">err</span>&nbsp;<span class="op" id="6166588">=</span>&nbsp;<span class="ident" id="6166590">d</span><span class="op" id="6166591">.</span><span class="ident" id="6166592">readByte</span><span class="op" id="6166600">(</span><span class="op" id="6166601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166606">if</span>&nbsp;<span class="ident" id="6166609">err</span>&nbsp;<span class="op" id="6166613">!=</span>&nbsp;<span class="ident" id="6166616">nil</span>&nbsp;<span class="op" id="6166620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166626">return</span>&nbsp;<span class="ident" id="6166633">nil</span><span class="op" id="6166636">,</span>&nbsp;<span class="ident" id="6166638">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6166645">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6166649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166653">marker</span>&nbsp;<span class="op" id="6166660">:=</span>&nbsp;<span class="ident" id="6166663">d</span><span class="op" id="6166664">.</span><span class="ident" id="6166665">tmp</span><span class="op" id="6166668">[</span><span class="num" id="6166669">1</span><span class="op" id="6166670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166674">if</span>&nbsp;<span class="ident" id="6166677">marker</span>&nbsp;<span class="op" id="6166684">==</span>&nbsp;<span class="num" id="6166687">0</span>&nbsp;<span class="op" id="6166689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166694">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166737">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6166748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166752">for</span>&nbsp;<span class="ident" id="6166756">marker</span>&nbsp;<span class="op" id="6166763">==</span>&nbsp;<span class="num" id="6166766">0xff</span>&nbsp;<span class="op" id="6166771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166776">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6166850">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6166916">marker</span><span class="op" id="6166922">,</span>&nbsp;<span class="ident" id="6166924">err</span>&nbsp;<span class="op" id="6166928">=</span>&nbsp;<span class="ident" id="6166930">d</span><span class="op" id="6166931">.</span><span class="ident" id="6166932">readByte</span><span class="op" id="6166940">(</span><span class="op" id="6166941">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166946">if</span>&nbsp;<span class="ident" id="6166949">err</span>&nbsp;<span class="op" id="6166953">!=</span>&nbsp;<span class="ident" id="6166956">nil</span>&nbsp;<span class="op" id="6166960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166966">return</span>&nbsp;<span class="ident" id="6166973">nil</span><span class="op" id="6166976">,</span>&nbsp;<span class="ident" id="6166978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6166985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6166989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6166993">if</span>&nbsp;<span class="ident" id="6166996">marker</span>&nbsp;<span class="op" id="6167003">==</span>&nbsp;<span class="ident" id="6167006">eoiMarker</span>&nbsp;<span class="op" id="6167016">{</span>&nbsp;<span class="comment" id="6167018">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167038">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167050">if</span>&nbsp;<span class="ident" id="6167053">rst0Marker</span>&nbsp;<span class="op" id="6167064">&lt;=</span>&nbsp;<span class="ident" id="6167067">marker</span>&nbsp;<span class="op" id="6167074">&amp;&amp;</span>&nbsp;<span class="ident" id="6167077">marker</span>&nbsp;<span class="op" id="6167084">&lt;=</span>&nbsp;<span class="ident" id="6167087">rst7Marker</span>&nbsp;<span class="op" id="6167098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167103">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167187">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167264">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167343">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167428">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167514">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167590">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167606">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6167689">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167764">if</span>&nbsp;<span class="ident" id="6167767">err</span>&nbsp;<span class="op" id="6167771">=</span>&nbsp;<span class="ident" id="6167773">d</span><span class="op" id="6167774">.</span><span class="ident" id="6167775">readFull</span><span class="op" id="6167783">(</span><span class="ident" id="6167784">d</span><span class="op" id="6167785">.</span><span class="ident" id="6167786">tmp</span><span class="op" id="6167789">[</span><span class="op" id="6167790">:</span><span class="num" id="6167791">2</span><span class="op" id="6167792">]</span><span class="op" id="6167793">)</span><span class="op" id="6167794">;</span>&nbsp;<span class="ident" id="6167796">err</span>&nbsp;<span class="op" id="6167800">!=</span>&nbsp;<span class="ident" id="6167803">nil</span>&nbsp;<span class="op" id="6167807">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167812">return</span>&nbsp;<span class="ident" id="6167819">nil</span><span class="op" id="6167822">,</span>&nbsp;<span class="ident" id="6167824">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6167834">n</span>&nbsp;<span class="op" id="6167836">:=</span>&nbsp;<span class="builtintype" id="6167839">int</span><span class="op" id="6167842">(</span><span class="ident" id="6167843">d</span><span class="op" id="6167844">.</span><span class="ident" id="6167845">tmp</span><span class="op" id="6167848">[</span><span class="num" id="6167849">0</span><span class="op" id="6167850">]</span><span class="op" id="6167851">)</span><span class="op" id="6167852">&lt;&lt;</span><span class="num" id="6167854">8</span>&nbsp;<span class="op" id="6167856">+</span>&nbsp;<span class="builtintype" id="6167858">int</span><span class="op" id="6167861">(</span><span class="ident" id="6167862">d</span><span class="op" id="6167863">.</span><span class="ident" id="6167864">tmp</span><span class="op" id="6167867">[</span><span class="num" id="6167868">1</span><span class="op" id="6167869">]</span><span class="op" id="6167870">)</span>&nbsp;<span class="op" id="6167872">-</span>&nbsp;<span class="num" id="6167874">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167878">if</span>&nbsp;<span class="ident" id="6167881">n</span>&nbsp;<span class="op" id="6167883">&lt;</span>&nbsp;<span class="num" id="6167885">0</span>&nbsp;<span class="op" id="6167887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167892">return</span>&nbsp;<span class="ident" id="6167899">nil</span><span class="op" id="6167902">,</span>&nbsp;<span class="ident" id="6167904">FormatError</span><span class="op" id="6167915">(</span><span class="string" id="6167916">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="6167938">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6167942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167947">switch</span>&nbsp;<span class="op" id="6167954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6167958">case</span>&nbsp;<span class="ident" id="6167963">marker</span>&nbsp;<span class="op" id="6167970">==</span>&nbsp;<span class="ident" id="6167973">sof0Marker</span>&nbsp;<span class="op" id="6167984">||</span>&nbsp;<span class="ident" id="6167987">marker</span>&nbsp;<span class="op" id="6167994">==</span>&nbsp;<span class="ident" id="6167997">sof2Marker</span><span class="op" id="6168007">:</span>&nbsp;<span class="comment" id="6168009">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168031">d</span><span class="op" id="6168032">.</span><span class="ident" id="6168033">progressive</span>&nbsp;<span class="op" id="6168045">=</span>&nbsp;<span class="ident" id="6168047">marker</span>&nbsp;<span class="op" id="6168054">==</span>&nbsp;<span class="ident" id="6168057">sof2Marker</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168071">err</span>&nbsp;<span class="op" id="6168075">=</span>&nbsp;<span class="ident" id="6168077">d</span><span class="op" id="6168078">.</span><span class="ident" id="6168079">processSOF</span><span class="op" id="6168089">(</span><span class="ident" id="6168090">n</span><span class="op" id="6168091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168096">if</span>&nbsp;<span class="ident" id="6168099">configOnly</span>&nbsp;<span class="op" id="6168110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168116">return</span>&nbsp;<span class="ident" id="6168123">nil</span><span class="op" id="6168126">,</span>&nbsp;<span class="ident" id="6168128">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168139">case</span>&nbsp;<span class="ident" id="6168144">marker</span>&nbsp;<span class="op" id="6168151">==</span>&nbsp;<span class="ident" id="6168154">dhtMarker</span><span class="op" id="6168163">:</span>&nbsp;<span class="comment" id="6168165">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168193">err</span>&nbsp;<span class="op" id="6168197">=</span>&nbsp;<span class="ident" id="6168199">d</span><span class="op" id="6168200">.</span><span class="ident" id="6168201">processDHT</span><span class="op" id="6168211">(</span><span class="ident" id="6168212">n</span><span class="op" id="6168213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168217">case</span>&nbsp;<span class="ident" id="6168222">marker</span>&nbsp;<span class="op" id="6168229">==</span>&nbsp;<span class="ident" id="6168232">dqtMarker</span><span class="op" id="6168241">:</span>&nbsp;<span class="comment" id="6168243">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168276">err</span>&nbsp;<span class="op" id="6168280">=</span>&nbsp;<span class="ident" id="6168282">d</span><span class="op" id="6168283">.</span><span class="ident" id="6168284">processDQT</span><span class="op" id="6168294">(</span><span class="ident" id="6168295">n</span><span class="op" id="6168296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168300">case</span>&nbsp;<span class="ident" id="6168305">marker</span>&nbsp;<span class="op" id="6168312">==</span>&nbsp;<span class="ident" id="6168315">sosMarker</span><span class="op" id="6168324">:</span>&nbsp;<span class="comment" id="6168326">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168347">err</span>&nbsp;<span class="op" id="6168351">=</span>&nbsp;<span class="ident" id="6168353">d</span><span class="op" id="6168354">.</span><span class="ident" id="6168355">processSOS</span><span class="op" id="6168365">(</span><span class="ident" id="6168366">n</span><span class="op" id="6168367">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168371">case</span>&nbsp;<span class="ident" id="6168376">marker</span>&nbsp;<span class="op" id="6168383">==</span>&nbsp;<span class="ident" id="6168386">driMarker</span><span class="op" id="6168395">:</span>&nbsp;<span class="comment" id="6168397">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168428">err</span>&nbsp;<span class="op" id="6168432">=</span>&nbsp;<span class="ident" id="6168434">d</span><span class="op" id="6168435">.</span><span class="ident" id="6168436">processDRI</span><span class="op" id="6168446">(</span><span class="ident" id="6168447">n</span><span class="op" id="6168448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168452">case</span>&nbsp;<span class="ident" id="6168457">app0Marker</span>&nbsp;<span class="op" id="6168468">&lt;=</span>&nbsp;<span class="ident" id="6168471">marker</span>&nbsp;<span class="op" id="6168478">&amp;&amp;</span>&nbsp;<span class="ident" id="6168481">marker</span>&nbsp;<span class="op" id="6168488">&lt;=</span>&nbsp;<span class="ident" id="6168491">app15Marker</span>&nbsp;<span class="op" id="6168503">||</span>&nbsp;<span class="ident" id="6168506">marker</span>&nbsp;<span class="op" id="6168513">==</span>&nbsp;<span class="ident" id="6168516">comMarker</span><span class="op" id="6168525">:</span>&nbsp;<span class="comment" id="6168527">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168567">err</span>&nbsp;<span class="op" id="6168571">=</span>&nbsp;<span class="ident" id="6168573">d</span><span class="op" id="6168574">.</span><span class="ident" id="6168575">ignore</span><span class="op" id="6168581">(</span><span class="ident" id="6168582">n</span><span class="op" id="6168583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168587">default</span><span class="op" id="6168594">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6168599">err</span>&nbsp;<span class="op" id="6168603">=</span>&nbsp;<span class="ident" id="6168605">UnsupportedError</span><span class="op" id="6168621">(</span><span class="string" id="6168622">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="6168638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168646">if</span>&nbsp;<span class="ident" id="6168649">err</span>&nbsp;<span class="op" id="6168653">!=</span>&nbsp;<span class="ident" id="6168656">nil</span>&nbsp;<span class="op" id="6168660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168665">return</span>&nbsp;<span class="ident" id="6168672">nil</span><span class="op" id="6168675">,</span>&nbsp;<span class="ident" id="6168677">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168683">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168689">if</span>&nbsp;<span class="ident" id="6168692">d</span><span class="op" id="6168693">.</span><span class="ident" id="6168694">img1</span>&nbsp;<span class="op" id="6168699">!=</span>&nbsp;<span class="ident" id="6168702">nil</span>&nbsp;<span class="op" id="6168706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168710">return</span>&nbsp;<span class="ident" id="6168717">d</span><span class="op" id="6168718">.</span><span class="ident" id="6168719">img1</span><span class="op" id="6168723">,</span>&nbsp;<span class="ident" id="6168725">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168733">if</span>&nbsp;<span class="ident" id="6168736">d</span><span class="op" id="6168737">.</span><span class="ident" id="6168738">img3</span>&nbsp;<span class="op" id="6168743">!=</span>&nbsp;<span class="ident" id="6168746">nil</span>&nbsp;<span class="op" id="6168750">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168754">return</span>&nbsp;<span class="ident" id="6168761">d</span><span class="op" id="6168762">.</span><span class="ident" id="6168763">img3</span><span class="op" id="6168767">,</span>&nbsp;<span class="ident" id="6168769">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6168774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168777">return</span>&nbsp;<span class="ident" id="6168784">nil</span><span class="op" id="6168787">,</span>&nbsp;<span class="ident" id="6168789">FormatError</span><span class="op" id="6168800">(</span><span class="string" id="6168801">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="6168821">)</span><br>
<span class="lineno"></span><span class="op" id="6168823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="6168826">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6168896">func</span>&nbsp;<span class="ident" id="6168901">Decode</span><span class="op" id="6168907">(</span><span class="ident" id="6168908">r</span>&nbsp;<span class="ident" id="6168910">io</span><span class="op" id="6168912">.</span><span class="ident" id="6168913">Reader</span><span class="op" id="6168919">)</span>&nbsp;<span class="op" id="6168921">(</span><span class="ident" id="6168922">image</span><span class="op" id="6168927">.</span><span class="ident" id="6168928">Image</span><span class="op" id="6168933">,</span>&nbsp;<span class="builtintype" id="6168935">error</span><span class="op" id="6168940">)</span>&nbsp;<span class="op" id="6168942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168945">var</span>&nbsp;<span class="ident" id="6168949">d</span>&nbsp;<span class="ident" id="6168951">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6168960">return</span>&nbsp;<span class="ident" id="6168967">d</span><span class="op" id="6168968">.</span><span class="ident" id="6168969">decode</span><span class="op" id="6168975">(</span><span class="ident" id="6168976">r</span><span class="op" id="6168977">,</span>&nbsp;<span class="builtintype" id="6168979">false</span><span class="op" id="6168984">)</span><br>
<span class="lineno"></span><span class="op" id="6168986">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="6168989">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6169068">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6169098">func</span>&nbsp;<span class="ident" id="6169103">DecodeConfig</span><span class="op" id="6169115">(</span><span class="ident" id="6169116">r</span>&nbsp;<span class="ident" id="6169118">io</span><span class="op" id="6169120">.</span><span class="ident" id="6169121">Reader</span><span class="op" id="6169127">)</span>&nbsp;<span class="op" id="6169129">(</span><span class="ident" id="6169130">image</span><span class="op" id="6169135">.</span><span class="ident" id="6169136">Config</span><span class="op" id="6169142">,</span>&nbsp;<span class="builtintype" id="6169144">error</span><span class="op" id="6169149">)</span>&nbsp;<span class="op" id="6169151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169154">var</span>&nbsp;<span class="ident" id="6169158">d</span>&nbsp;<span class="ident" id="6169160">decoder</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169169">if</span>&nbsp;<span class="ident" id="6169172">_</span><span class="op" id="6169173">,</span>&nbsp;<span class="ident" id="6169175">err</span>&nbsp;<span class="op" id="6169179">:=</span>&nbsp;<span class="ident" id="6169182">d</span><span class="op" id="6169183">.</span><span class="ident" id="6169184">decode</span><span class="op" id="6169190">(</span><span class="ident" id="6169191">r</span><span class="op" id="6169192">,</span>&nbsp;<span class="builtintype" id="6169194">true</span><span class="op" id="6169198">)</span><span class="op" id="6169199">;</span>&nbsp;<span class="ident" id="6169201">err</span>&nbsp;<span class="op" id="6169205">!=</span>&nbsp;<span class="ident" id="6169208">nil</span>&nbsp;<span class="op" id="6169212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169216">return</span>&nbsp;<span class="ident" id="6169223">image</span><span class="op" id="6169228">.</span><span class="ident" id="6169229">Config</span><span class="op" id="6169235">{</span><span class="op" id="6169236">}</span><span class="op" id="6169237">,</span>&nbsp;<span class="ident" id="6169239">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169247">switch</span>&nbsp;<span class="ident" id="6169254">d</span><span class="op" id="6169255">.</span><span class="ident" id="6169256">nComp</span>&nbsp;<span class="op" id="6169262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169265">case</span>&nbsp;<span class="ident" id="6169270">nGrayComponent</span><span class="op" id="6169284">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169288">return</span>&nbsp;<span class="ident" id="6169295">image</span><span class="op" id="6169300">.</span><span class="ident" id="6169301">Config</span><span class="op" id="6169307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169312">ColorModel</span><span class="op" id="6169322">:</span>&nbsp;<span class="ident" id="6169324">color</span><span class="op" id="6169329">.</span><span class="ident" id="6169330">GrayModel</span><span class="op" id="6169339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169344">Width</span><span class="op" id="6169349">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169356">d</span><span class="op" id="6169357">.</span><span class="ident" id="6169358">width</span><span class="op" id="6169363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169368">Height</span><span class="op" id="6169374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169380">d</span><span class="op" id="6169381">.</span><span class="ident" id="6169382">height</span><span class="op" id="6169388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169392">}</span><span class="op" id="6169393">,</span>&nbsp;<span class="ident" id="6169395">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169400">case</span>&nbsp;<span class="ident" id="6169405">nColorComponent</span><span class="op" id="6169420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169424">return</span>&nbsp;<span class="ident" id="6169431">image</span><span class="op" id="6169436">.</span><span class="ident" id="6169437">Config</span><span class="op" id="6169443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169448">ColorModel</span><span class="op" id="6169458">:</span>&nbsp;<span class="ident" id="6169460">color</span><span class="op" id="6169465">.</span><span class="ident" id="6169466">YCbCrModel</span><span class="op" id="6169476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169481">Width</span><span class="op" id="6169486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169493">d</span><span class="op" id="6169494">.</span><span class="ident" id="6169495">width</span><span class="op" id="6169500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169505">Height</span><span class="op" id="6169511">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169517">d</span><span class="op" id="6169518">.</span><span class="ident" id="6169519">height</span><span class="op" id="6169525">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169529">}</span><span class="op" id="6169530">,</span>&nbsp;<span class="ident" id="6169532">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169540">return</span>&nbsp;<span class="ident" id="6169547">image</span><span class="op" id="6169552">.</span><span class="ident" id="6169553">Config</span><span class="op" id="6169559">{</span><span class="op" id="6169560">}</span><span class="op" id="6169561">,</span>&nbsp;<span class="ident" id="6169563">FormatError</span><span class="op" id="6169574">(</span><span class="string" id="6169575">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6169595">)</span><br>
<span class="lineno"></span><span class="op" id="6169597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6169600">func</span>&nbsp;<span class="ident" id="6169605">init</span><span class="op" id="6169609">(</span><span class="op" id="6169610">)</span>&nbsp;<span class="op" id="6169612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169615">image</span><span class="op" id="6169620">.</span><span class="ident" id="6169621">RegisterFormat</span><span class="op" id="6169635">(</span><span class="string" id="6169636">&#34;jpeg&#34;</span><span class="op" id="6169642">,</span>&nbsp;<span class="string" id="6169644">&#34;\xff\xd8&#34;</span><span class="op" id="6169654">,</span>&nbsp;<span class="ident" id="6169656">Decode</span><span class="op" id="6169662">,</span>&nbsp;<span class="ident" id="6169664">DecodeConfig</span><span class="op" id="6169676">)</span><br>
<span class="lineno"></span><span class="op" id="6169678">}</span>
</div>
</body>
</html>
