<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5104343">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5104398">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5104452">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5104503">package</span>&nbsp;<span class="ident" id="5104511">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5104521">import</span>&nbsp;<span class="op" id="5104528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5104531">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5104540">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5104550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104553">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5104632">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5104710">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5104788">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5104798">var</span>&nbsp;<span class="ident" id="5104802">transitionFunc</span>&nbsp;<span class="op" id="5104817">=</span>&nbsp;<span class="op" id="5104819">[</span><span class="op" id="5104820">...</span><span class="op" id="5104823">]</span><span class="keyword" id="5104824">func</span><span class="op" id="5104828">(</span><span class="ident" id="5104829">context</span><span class="op" id="5104836">,</span>&nbsp;<span class="op" id="5104838">[</span><span class="op" id="5104839">]</span><span class="builtintype" id="5104840">byte</span><span class="op" id="5104844">)</span>&nbsp;<span class="op" id="5104846">(</span><span class="ident" id="5104847">context</span><span class="op" id="5104854">,</span>&nbsp;<span class="builtintype" id="5104856">int</span><span class="op" id="5104859">)</span><span class="op" id="5104860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104863">stateText</span><span class="op" id="5104872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5104881">tText</span><span class="op" id="5104886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104889">stateTag</span><span class="op" id="5104897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5104907">tTag</span><span class="op" id="5104911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104914">stateAttrName</span><span class="op" id="5104927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5104932">tAttrName</span><span class="op" id="5104941">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104944">stateAfterName</span><span class="op" id="5104958">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5104962">tAfterName</span><span class="op" id="5104972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104975">stateBeforeValue</span><span class="op" id="5104991">:</span>&nbsp;<span class="ident" id="5104993">tBeforeValue</span><span class="op" id="5105005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105008">stateHTMLCmt</span><span class="op" id="5105020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105026">tHTMLCmt</span><span class="op" id="5105034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105037">stateRCDATA</span><span class="op" id="5105048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105055">tSpecialTagEnd</span><span class="op" id="5105069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105072">stateAttr</span><span class="op" id="5105081">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105090">tAttr</span><span class="op" id="5105095">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105098">stateURL</span><span class="op" id="5105106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105116">tURL</span><span class="op" id="5105120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105123">stateJS</span><span class="op" id="5105130">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105141">tJS</span><span class="op" id="5105144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105147">stateJSDqStr</span><span class="op" id="5105159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105165">tJSDelimited</span><span class="op" id="5105177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105180">stateJSSqStr</span><span class="op" id="5105192">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105198">tJSDelimited</span><span class="op" id="5105210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105213">stateJSRegexp</span><span class="op" id="5105226">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105231">tJSDelimited</span><span class="op" id="5105243">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105246">stateJSBlockCmt</span><span class="op" id="5105261">:</span>&nbsp;&nbsp;<span class="ident" id="5105264">tBlockCmt</span><span class="op" id="5105273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105276">stateJSLineCmt</span><span class="op" id="5105290">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5105294">tLineCmt</span><span class="op" id="5105302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105305">stateCSS</span><span class="op" id="5105313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105323">tCSS</span><span class="op" id="5105327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105330">stateCSSDqStr</span><span class="op" id="5105343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105348">tCSSStr</span><span class="op" id="5105355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105358">stateCSSSqStr</span><span class="op" id="5105371">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105376">tCSSStr</span><span class="op" id="5105383">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105386">stateCSSDqURL</span><span class="op" id="5105399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105404">tCSSStr</span><span class="op" id="5105411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105414">stateCSSSqURL</span><span class="op" id="5105427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105432">tCSSStr</span><span class="op" id="5105439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105442">stateCSSURL</span><span class="op" id="5105453">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105460">tCSSStr</span><span class="op" id="5105467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105470">stateCSSBlockCmt</span><span class="op" id="5105486">:</span>&nbsp;<span class="ident" id="5105488">tBlockCmt</span><span class="op" id="5105497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105500">stateCSSLineCmt</span><span class="op" id="5105515">:</span>&nbsp;&nbsp;<span class="ident" id="5105518">tLineCmt</span><span class="op" id="5105526">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105529">stateError</span><span class="op" id="5105539">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5105547">tError</span><span class="op" id="5105553">,</span><br>
<span class="lineno"></span><span class="op" id="5105555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5105558">var</span>&nbsp;<span class="ident" id="5105562">commentStart</span>&nbsp;<span class="op" id="5105575">=</span>&nbsp;<span class="op" id="5105577">[</span><span class="op" id="5105578">]</span><span class="builtintype" id="5105579">byte</span><span class="op" id="5105583">(</span><span class="string" id="5105584">&#34;&lt;!--&#34;</span><span class="op" id="5105590">)</span><br>
<span class="lineno"></span><span class="keyword" id="5105592">var</span>&nbsp;<span class="ident" id="5105596">commentEnd</span>&nbsp;<span class="op" id="5105607">=</span>&nbsp;<span class="op" id="5105609">[</span><span class="op" id="5105610">]</span><span class="builtintype" id="5105611">byte</span><span class="op" id="5105615">(</span><span class="string" id="5105616">&#34;--&gt;&#34;</span><span class="op" id="5105621">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5105624">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5105688">func</span>&nbsp;<span class="ident" id="5105693">tText</span><span class="op" id="5105698">(</span><span class="ident" id="5105699">c</span>&nbsp;<span class="ident" id="5105701">context</span><span class="op" id="5105708">,</span>&nbsp;<span class="ident" id="5105710">s</span>&nbsp;<span class="op" id="5105712">[</span><span class="op" id="5105713">]</span><span class="builtintype" id="5105714">byte</span><span class="op" id="5105718">)</span>&nbsp;<span class="op" id="5105720">(</span><span class="ident" id="5105721">context</span><span class="op" id="5105728">,</span>&nbsp;<span class="builtintype" id="5105730">int</span><span class="op" id="5105733">)</span>&nbsp;<span class="op" id="5105735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105738">k</span>&nbsp;<span class="op" id="5105740">:=</span>&nbsp;<span class="num" id="5105743">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105746">for</span>&nbsp;<span class="op" id="5105750">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105754">i</span>&nbsp;<span class="op" id="5105756">:=</span>&nbsp;<span class="ident" id="5105759">k</span>&nbsp;<span class="op" id="5105761">+</span>&nbsp;<span class="ident" id="5105763">bytes</span><span class="op" id="5105768">.</span><span class="ident" id="5105769">IndexByte</span><span class="op" id="5105778">(</span><span class="ident" id="5105779">s</span><span class="op" id="5105780">[</span><span class="ident" id="5105781">k</span><span class="op" id="5105782">:</span><span class="op" id="5105783">]</span><span class="op" id="5105784">,</span>&nbsp;<span class="string" id="5105786">&#39;&lt;&#39;</span><span class="op" id="5105789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105793">if</span>&nbsp;<span class="ident" id="5105796">i</span>&nbsp;<span class="op" id="5105798">&lt;</span>&nbsp;<span class="ident" id="5105800">k</span>&nbsp;<span class="op" id="5105802">||</span>&nbsp;<span class="ident" id="5105805">i</span><span class="op" id="5105806">+</span><span class="num" id="5105807">1</span>&nbsp;<span class="op" id="5105809">==</span>&nbsp;<span class="builtinfunc" id="5105812">len</span><span class="op" id="5105815">(</span><span class="ident" id="5105816">s</span><span class="op" id="5105817">)</span>&nbsp;<span class="op" id="5105819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105824">return</span>&nbsp;<span class="ident" id="5105831">c</span><span class="op" id="5105832">,</span>&nbsp;<span class="builtinfunc" id="5105834">len</span><span class="op" id="5105837">(</span><span class="ident" id="5105838">s</span><span class="op" id="5105839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105843">}</span>&nbsp;<span class="keyword" id="5105845">else</span>&nbsp;<span class="keyword" id="5105850">if</span>&nbsp;<span class="ident" id="5105853">i</span><span class="op" id="5105854">+</span><span class="num" id="5105855">4</span>&nbsp;<span class="op" id="5105857">&lt;=</span>&nbsp;<span class="builtinfunc" id="5105860">len</span><span class="op" id="5105863">(</span><span class="ident" id="5105864">s</span><span class="op" id="5105865">)</span>&nbsp;<span class="op" id="5105867">&amp;&amp;</span>&nbsp;<span class="ident" id="5105870">bytes</span><span class="op" id="5105875">.</span><span class="ident" id="5105876">Equal</span><span class="op" id="5105881">(</span><span class="ident" id="5105882">commentStart</span><span class="op" id="5105894">,</span>&nbsp;<span class="ident" id="5105896">s</span><span class="op" id="5105897">[</span><span class="ident" id="5105898">i</span><span class="op" id="5105899">:</span><span class="ident" id="5105900">i</span><span class="op" id="5105901">+</span><span class="num" id="5105902">4</span><span class="op" id="5105903">]</span><span class="op" id="5105904">)</span>&nbsp;<span class="op" id="5105906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105911">return</span>&nbsp;<span class="ident" id="5105918">context</span><span class="op" id="5105925">{</span><span class="ident" id="5105926">state</span><span class="op" id="5105931">:</span>&nbsp;<span class="ident" id="5105933">stateHTMLCmt</span><span class="op" id="5105945">}</span><span class="op" id="5105946">,</span>&nbsp;<span class="ident" id="5105948">i</span>&nbsp;<span class="op" id="5105950">+</span>&nbsp;<span class="num" id="5105952">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105960">i</span><span class="op" id="5105961">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105966">end</span>&nbsp;<span class="op" id="5105970">:=</span>&nbsp;<span class="builtintype" id="5105973">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105981">if</span>&nbsp;<span class="ident" id="5105984">s</span><span class="op" id="5105985">[</span><span class="ident" id="5105986">i</span><span class="op" id="5105987">]</span>&nbsp;<span class="op" id="5105989">==</span>&nbsp;<span class="string" id="5105992">&#39;/&#39;</span>&nbsp;<span class="op" id="5105996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106001">if</span>&nbsp;<span class="ident" id="5106004">i</span><span class="op" id="5106005">+</span><span class="num" id="5106006">1</span>&nbsp;<span class="op" id="5106008">==</span>&nbsp;<span class="builtinfunc" id="5106011">len</span><span class="op" id="5106014">(</span><span class="ident" id="5106015">s</span><span class="op" id="5106016">)</span>&nbsp;<span class="op" id="5106018">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106024">return</span>&nbsp;<span class="ident" id="5106031">c</span><span class="op" id="5106032">,</span>&nbsp;<span class="builtinfunc" id="5106034">len</span><span class="op" id="5106037">(</span><span class="ident" id="5106038">s</span><span class="op" id="5106039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106049">end</span><span class="op" id="5106052">,</span>&nbsp;<span class="ident" id="5106054">i</span>&nbsp;<span class="op" id="5106056">=</span>&nbsp;<span class="builtintype" id="5106058">true</span><span class="op" id="5106062">,</span>&nbsp;<span class="ident" id="5106064">i</span><span class="op" id="5106065">+</span><span class="num" id="5106066">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106074">j</span><span class="op" id="5106075">,</span>&nbsp;<span class="ident" id="5106077">e</span>&nbsp;<span class="op" id="5106079">:=</span>&nbsp;<span class="ident" id="5106082">eatTagName</span><span class="op" id="5106092">(</span><span class="ident" id="5106093">s</span><span class="op" id="5106094">,</span>&nbsp;<span class="ident" id="5106096">i</span><span class="op" id="5106097">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106101">if</span>&nbsp;<span class="ident" id="5106104">j</span>&nbsp;<span class="op" id="5106106">!=</span>&nbsp;<span class="ident" id="5106109">i</span>&nbsp;<span class="op" id="5106111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106116">if</span>&nbsp;<span class="ident" id="5106119">end</span>&nbsp;<span class="op" id="5106123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106129">e</span>&nbsp;<span class="op" id="5106131">=</span>&nbsp;<span class="ident" id="5106133">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106153">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106184">return</span>&nbsp;<span class="ident" id="5106191">context</span><span class="op" id="5106198">{</span><span class="ident" id="5106199">state</span><span class="op" id="5106204">:</span>&nbsp;<span class="ident" id="5106206">stateTag</span><span class="op" id="5106214">,</span>&nbsp;<span class="ident" id="5106216">element</span><span class="op" id="5106223">:</span>&nbsp;<span class="ident" id="5106225">e</span><span class="op" id="5106226">}</span><span class="op" id="5106227">,</span>&nbsp;<span class="ident" id="5106229">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106237">k</span>&nbsp;<span class="op" id="5106239">=</span>&nbsp;<span class="ident" id="5106241">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106244">}</span><br>
<span class="lineno"></span><span class="op" id="5106246">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5106249">var</span>&nbsp;<span class="ident" id="5106253">elementContentType</span>&nbsp;<span class="op" id="5106272">=</span>&nbsp;<span class="op" id="5106274">[</span><span class="op" id="5106275">...</span><span class="op" id="5106278">]</span><span class="ident" id="5106279">state</span><span class="op" id="5106284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106287">elementNone</span><span class="op" id="5106298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5106304">stateText</span><span class="op" id="5106313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106316">elementScript</span><span class="op" id="5106329">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5106333">stateJS</span><span class="op" id="5106340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106343">elementStyle</span><span class="op" id="5106355">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5106360">stateCSS</span><span class="op" id="5106368">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106371">elementTextarea</span><span class="op" id="5106386">:</span>&nbsp;<span class="ident" id="5106388">stateRCDATA</span><span class="op" id="5106399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106402">elementTitle</span><span class="op" id="5106414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5106419">stateRCDATA</span><span class="op" id="5106430">,</span><br>
<span class="lineno"></span><span class="op" id="5106432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5106435">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5106497">func</span>&nbsp;<span class="ident" id="5106502">tTag</span><span class="op" id="5106506">(</span><span class="ident" id="5106507">c</span>&nbsp;<span class="ident" id="5106509">context</span><span class="op" id="5106516">,</span>&nbsp;<span class="ident" id="5106518">s</span>&nbsp;<span class="op" id="5106520">[</span><span class="op" id="5106521">]</span><span class="builtintype" id="5106522">byte</span><span class="op" id="5106526">)</span>&nbsp;<span class="op" id="5106528">(</span><span class="ident" id="5106529">context</span><span class="op" id="5106536">,</span>&nbsp;<span class="builtintype" id="5106538">int</span><span class="op" id="5106541">)</span>&nbsp;<span class="op" id="5106543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5106546">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106575">i</span>&nbsp;<span class="op" id="5106577">:=</span>&nbsp;<span class="ident" id="5106580">eatWhiteSpace</span><span class="op" id="5106593">(</span><span class="ident" id="5106594">s</span><span class="op" id="5106595">,</span>&nbsp;<span class="num" id="5106597">0</span><span class="op" id="5106598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106601">if</span>&nbsp;<span class="ident" id="5106604">i</span>&nbsp;<span class="op" id="5106606">==</span>&nbsp;<span class="builtinfunc" id="5106609">len</span><span class="op" id="5106612">(</span><span class="ident" id="5106613">s</span><span class="op" id="5106614">)</span>&nbsp;<span class="op" id="5106616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106620">return</span>&nbsp;<span class="ident" id="5106627">c</span><span class="op" id="5106628">,</span>&nbsp;<span class="builtinfunc" id="5106630">len</span><span class="op" id="5106633">(</span><span class="ident" id="5106634">s</span><span class="op" id="5106635">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106641">if</span>&nbsp;<span class="ident" id="5106644">s</span><span class="op" id="5106645">[</span><span class="ident" id="5106646">i</span><span class="op" id="5106647">]</span>&nbsp;<span class="op" id="5106649">==</span>&nbsp;<span class="string" id="5106652">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5106656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106660">return</span>&nbsp;<span class="ident" id="5106667">context</span><span class="op" id="5106674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106679">state</span><span class="op" id="5106684">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5106688">elementContentType</span><span class="op" id="5106706">[</span><span class="ident" id="5106707">c</span><span class="op" id="5106708">.</span><span class="ident" id="5106709">element</span><span class="op" id="5106716">]</span><span class="op" id="5106717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106722">element</span><span class="op" id="5106729">:</span>&nbsp;<span class="ident" id="5106731">c</span><span class="op" id="5106732">.</span><span class="ident" id="5106733">element</span><span class="op" id="5106740">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106744">}</span><span class="op" id="5106745">,</span>&nbsp;<span class="ident" id="5106747">i</span>&nbsp;<span class="op" id="5106749">+</span>&nbsp;<span class="num" id="5106751">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106757">j</span><span class="op" id="5106758">,</span>&nbsp;<span class="ident" id="5106760">err</span>&nbsp;<span class="op" id="5106764">:=</span>&nbsp;<span class="ident" id="5106767">eatAttrName</span><span class="op" id="5106778">(</span><span class="ident" id="5106779">s</span><span class="op" id="5106780">,</span>&nbsp;<span class="ident" id="5106782">i</span><span class="op" id="5106783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106786">if</span>&nbsp;<span class="ident" id="5106789">err</span>&nbsp;<span class="op" id="5106793">!=</span>&nbsp;<span class="ident" id="5106796">nil</span>&nbsp;<span class="op" id="5106800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106804">return</span>&nbsp;<span class="ident" id="5106811">context</span><span class="op" id="5106818">{</span><span class="ident" id="5106819">state</span><span class="op" id="5106824">:</span>&nbsp;<span class="ident" id="5106826">stateError</span><span class="op" id="5106836">,</span>&nbsp;<span class="ident" id="5106838">err</span><span class="op" id="5106841">:</span>&nbsp;<span class="ident" id="5106843">err</span><span class="op" id="5106846">}</span><span class="op" id="5106847">,</span>&nbsp;<span class="builtinfunc" id="5106849">len</span><span class="op" id="5106852">(</span><span class="ident" id="5106853">s</span><span class="op" id="5106854">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5106857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106860">state</span><span class="op" id="5106865">,</span>&nbsp;<span class="ident" id="5106867">attr</span>&nbsp;<span class="op" id="5106872">:=</span>&nbsp;<span class="ident" id="5106875">stateTag</span><span class="op" id="5106883">,</span>&nbsp;<span class="ident" id="5106885">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106895">if</span>&nbsp;<span class="ident" id="5106898">i</span>&nbsp;<span class="op" id="5106900">==</span>&nbsp;<span class="ident" id="5106903">j</span>&nbsp;<span class="op" id="5106905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5106909">return</span>&nbsp;<span class="ident" id="5106916">context</span><span class="op" id="5106923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106928">state</span><span class="op" id="5106933">:</span>&nbsp;<span class="ident" id="5106935">stateError</span><span class="op" id="5106945">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5106950">err</span><span class="op" id="5106953">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5106957">errorf</span><span class="op" id="5106963">(</span><span class="ident" id="5106964">ErrBadHTML</span><span class="op" id="5106974">,</span>&nbsp;<span class="ident" id="5106976">nil</span><span class="op" id="5106979">,</span>&nbsp;<span class="num" id="5106981">0</span><span class="op" id="5106982">,</span>&nbsp;<span class="string" id="5106984">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5107038">,</span>&nbsp;<span class="ident" id="5107040">s</span><span class="op" id="5107041">[</span><span class="ident" id="5107042">i</span><span class="op" id="5107043">:</span><span class="op" id="5107044">]</span><span class="op" id="5107045">)</span><span class="op" id="5107046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107050">}</span><span class="op" id="5107051">,</span>&nbsp;<span class="builtinfunc" id="5107053">len</span><span class="op" id="5107056">(</span><span class="ident" id="5107057">s</span><span class="op" id="5107058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107064">switch</span>&nbsp;<span class="ident" id="5107071">attrType</span><span class="op" id="5107079">(</span><span class="builtintype" id="5107080">string</span><span class="op" id="5107086">(</span><span class="ident" id="5107087">s</span><span class="op" id="5107088">[</span><span class="ident" id="5107089">i</span><span class="op" id="5107090">:</span><span class="ident" id="5107091">j</span><span class="op" id="5107092">]</span><span class="op" id="5107093">)</span><span class="op" id="5107094">)</span>&nbsp;<span class="op" id="5107096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107099">case</span>&nbsp;<span class="ident" id="5107104">contentTypeURL</span><span class="op" id="5107118">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107122">attr</span>&nbsp;<span class="op" id="5107127">=</span>&nbsp;<span class="ident" id="5107129">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107138">case</span>&nbsp;<span class="ident" id="5107143">contentTypeCSS</span><span class="op" id="5107157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107161">attr</span>&nbsp;<span class="op" id="5107166">=</span>&nbsp;<span class="ident" id="5107168">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107179">case</span>&nbsp;<span class="ident" id="5107184">contentTypeJS</span><span class="op" id="5107197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107201">attr</span>&nbsp;<span class="op" id="5107206">=</span>&nbsp;<span class="ident" id="5107208">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107223">if</span>&nbsp;<span class="ident" id="5107226">j</span>&nbsp;<span class="op" id="5107228">==</span>&nbsp;<span class="builtinfunc" id="5107231">len</span><span class="op" id="5107234">(</span><span class="ident" id="5107235">s</span><span class="op" id="5107236">)</span>&nbsp;<span class="op" id="5107238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107242">state</span>&nbsp;<span class="op" id="5107248">=</span>&nbsp;<span class="ident" id="5107250">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107265">}</span>&nbsp;<span class="keyword" id="5107267">else</span>&nbsp;<span class="op" id="5107272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107276">state</span>&nbsp;<span class="op" id="5107282">=</span>&nbsp;<span class="ident" id="5107284">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107303">return</span>&nbsp;<span class="ident" id="5107310">context</span><span class="op" id="5107317">{</span><span class="ident" id="5107318">state</span><span class="op" id="5107323">:</span>&nbsp;<span class="ident" id="5107325">state</span><span class="op" id="5107330">,</span>&nbsp;<span class="ident" id="5107332">element</span><span class="op" id="5107339">:</span>&nbsp;<span class="ident" id="5107341">c</span><span class="op" id="5107342">.</span><span class="ident" id="5107343">element</span><span class="op" id="5107350">,</span>&nbsp;<span class="ident" id="5107352">attr</span><span class="op" id="5107356">:</span>&nbsp;<span class="ident" id="5107358">attr</span><span class="op" id="5107362">}</span><span class="op" id="5107363">,</span>&nbsp;<span class="ident" id="5107365">j</span><br>
<span class="lineno"></span><span class="op" id="5107367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5107370">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5107437">func</span>&nbsp;<span class="ident" id="5107442">tAttrName</span><span class="op" id="5107451">(</span><span class="ident" id="5107452">c</span>&nbsp;<span class="ident" id="5107454">context</span><span class="op" id="5107461">,</span>&nbsp;<span class="ident" id="5107463">s</span>&nbsp;<span class="op" id="5107465">[</span><span class="op" id="5107466">]</span><span class="builtintype" id="5107467">byte</span><span class="op" id="5107471">)</span>&nbsp;<span class="op" id="5107473">(</span><span class="ident" id="5107474">context</span><span class="op" id="5107481">,</span>&nbsp;<span class="builtintype" id="5107483">int</span><span class="op" id="5107486">)</span>&nbsp;<span class="op" id="5107488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107491">i</span><span class="op" id="5107492">,</span>&nbsp;<span class="ident" id="5107494">err</span>&nbsp;<span class="op" id="5107498">:=</span>&nbsp;<span class="ident" id="5107501">eatAttrName</span><span class="op" id="5107512">(</span><span class="ident" id="5107513">s</span><span class="op" id="5107514">,</span>&nbsp;<span class="num" id="5107516">0</span><span class="op" id="5107517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107520">if</span>&nbsp;<span class="ident" id="5107523">err</span>&nbsp;<span class="op" id="5107527">!=</span>&nbsp;<span class="ident" id="5107530">nil</span>&nbsp;<span class="op" id="5107534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107538">return</span>&nbsp;<span class="ident" id="5107545">context</span><span class="op" id="5107552">{</span><span class="ident" id="5107553">state</span><span class="op" id="5107558">:</span>&nbsp;<span class="ident" id="5107560">stateError</span><span class="op" id="5107570">,</span>&nbsp;<span class="ident" id="5107572">err</span><span class="op" id="5107575">:</span>&nbsp;<span class="ident" id="5107577">err</span><span class="op" id="5107580">}</span><span class="op" id="5107581">,</span>&nbsp;<span class="builtinfunc" id="5107583">len</span><span class="op" id="5107586">(</span><span class="ident" id="5107587">s</span><span class="op" id="5107588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107591">}</span>&nbsp;<span class="keyword" id="5107593">else</span>&nbsp;<span class="keyword" id="5107598">if</span>&nbsp;<span class="ident" id="5107601">i</span>&nbsp;<span class="op" id="5107603">!=</span>&nbsp;<span class="builtinfunc" id="5107606">len</span><span class="op" id="5107609">(</span><span class="ident" id="5107610">s</span><span class="op" id="5107611">)</span>&nbsp;<span class="op" id="5107613">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107617">c</span><span class="op" id="5107618">.</span><span class="ident" id="5107619">state</span>&nbsp;<span class="op" id="5107625">=</span>&nbsp;<span class="ident" id="5107627">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107646">return</span>&nbsp;<span class="ident" id="5107653">c</span><span class="op" id="5107654">,</span>&nbsp;<span class="ident" id="5107656">i</span><br>
<span class="lineno"></span><span class="op" id="5107658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5107661">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5107730">func</span>&nbsp;<span class="ident" id="5107735">tAfterName</span><span class="op" id="5107745">(</span><span class="ident" id="5107746">c</span>&nbsp;<span class="ident" id="5107748">context</span><span class="op" id="5107755">,</span>&nbsp;<span class="ident" id="5107757">s</span>&nbsp;<span class="op" id="5107759">[</span><span class="op" id="5107760">]</span><span class="builtintype" id="5107761">byte</span><span class="op" id="5107765">)</span>&nbsp;<span class="op" id="5107767">(</span><span class="ident" id="5107768">context</span><span class="op" id="5107775">,</span>&nbsp;<span class="builtintype" id="5107777">int</span><span class="op" id="5107780">)</span>&nbsp;<span class="op" id="5107782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107785">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107822">i</span>&nbsp;<span class="op" id="5107824">:=</span>&nbsp;<span class="ident" id="5107827">eatWhiteSpace</span><span class="op" id="5107840">(</span><span class="ident" id="5107841">s</span><span class="op" id="5107842">,</span>&nbsp;<span class="num" id="5107844">0</span><span class="op" id="5107845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107848">if</span>&nbsp;<span class="ident" id="5107851">i</span>&nbsp;<span class="op" id="5107853">==</span>&nbsp;<span class="builtinfunc" id="5107856">len</span><span class="op" id="5107859">(</span><span class="ident" id="5107860">s</span><span class="op" id="5107861">)</span>&nbsp;<span class="op" id="5107863">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107867">return</span>&nbsp;<span class="ident" id="5107874">c</span><span class="op" id="5107875">,</span>&nbsp;<span class="builtinfunc" id="5107877">len</span><span class="op" id="5107880">(</span><span class="ident" id="5107881">s</span><span class="op" id="5107882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5107885">}</span>&nbsp;<span class="keyword" id="5107887">else</span>&nbsp;<span class="keyword" id="5107892">if</span>&nbsp;<span class="ident" id="5107895">s</span><span class="op" id="5107896">[</span><span class="ident" id="5107897">i</span><span class="op" id="5107898">]</span>&nbsp;<span class="op" id="5107900">!=</span>&nbsp;<span class="string" id="5107903">&#39;=&#39;</span>&nbsp;<span class="op" id="5107907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5107911">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5107971">c</span><span class="op" id="5107972">.</span><span class="ident" id="5107973">state</span>&nbsp;<span class="op" id="5107979">=</span>&nbsp;<span class="ident" id="5107981">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5107992">return</span>&nbsp;<span class="ident" id="5107999">c</span><span class="op" id="5108000">,</span>&nbsp;<span class="ident" id="5108002">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108008">c</span><span class="op" id="5108009">.</span><span class="ident" id="5108010">state</span>&nbsp;<span class="op" id="5108016">=</span>&nbsp;<span class="ident" id="5108018">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108036">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108057">return</span>&nbsp;<span class="ident" id="5108064">c</span><span class="op" id="5108065">,</span>&nbsp;<span class="ident" id="5108067">i</span>&nbsp;<span class="op" id="5108069">+</span>&nbsp;<span class="num" id="5108071">1</span><br>
<span class="lineno"></span><span class="op" id="5108073">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5108076">var</span>&nbsp;<span class="ident" id="5108080">attrStartStates</span>&nbsp;<span class="op" id="5108096">=</span>&nbsp;<span class="op" id="5108098">[</span><span class="op" id="5108099">...</span><span class="op" id="5108102">]</span><span class="ident" id="5108103">state</span><span class="op" id="5108108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108111">attrNone</span><span class="op" id="5108119">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5108123">stateAttr</span><span class="op" id="5108132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108135">attrScript</span><span class="op" id="5108145">:</span>&nbsp;<span class="ident" id="5108147">stateJS</span><span class="op" id="5108154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108157">attrStyle</span><span class="op" id="5108166">:</span>&nbsp;&nbsp;<span class="ident" id="5108169">stateCSS</span><span class="op" id="5108177">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108180">attrURL</span><span class="op" id="5108187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5108192">stateURL</span><span class="op" id="5108200">,</span><br>
<span class="lineno"></span><span class="op" id="5108202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5108205">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5108278">func</span>&nbsp;<span class="ident" id="5108283">tBeforeValue</span><span class="op" id="5108295">(</span><span class="ident" id="5108296">c</span>&nbsp;<span class="ident" id="5108298">context</span><span class="op" id="5108305">,</span>&nbsp;<span class="ident" id="5108307">s</span>&nbsp;<span class="op" id="5108309">[</span><span class="op" id="5108310">]</span><span class="builtintype" id="5108311">byte</span><span class="op" id="5108315">)</span>&nbsp;<span class="op" id="5108317">(</span><span class="ident" id="5108318">context</span><span class="op" id="5108325">,</span>&nbsp;<span class="builtintype" id="5108327">int</span><span class="op" id="5108330">)</span>&nbsp;<span class="op" id="5108332">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108335">i</span>&nbsp;<span class="op" id="5108337">:=</span>&nbsp;<span class="ident" id="5108340">eatWhiteSpace</span><span class="op" id="5108353">(</span><span class="ident" id="5108354">s</span><span class="op" id="5108355">,</span>&nbsp;<span class="num" id="5108357">0</span><span class="op" id="5108358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108361">if</span>&nbsp;<span class="ident" id="5108364">i</span>&nbsp;<span class="op" id="5108366">==</span>&nbsp;<span class="builtinfunc" id="5108369">len</span><span class="op" id="5108372">(</span><span class="ident" id="5108373">s</span><span class="op" id="5108374">)</span>&nbsp;<span class="op" id="5108376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108380">return</span>&nbsp;<span class="ident" id="5108387">c</span><span class="op" id="5108388">,</span>&nbsp;<span class="builtinfunc" id="5108390">len</span><span class="op" id="5108393">(</span><span class="ident" id="5108394">s</span><span class="op" id="5108395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5108401">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108435">delim</span>&nbsp;<span class="op" id="5108441">:=</span>&nbsp;<span class="ident" id="5108444">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108464">switch</span>&nbsp;<span class="ident" id="5108471">s</span><span class="op" id="5108472">[</span><span class="ident" id="5108473">i</span><span class="op" id="5108474">]</span>&nbsp;<span class="op" id="5108476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108479">case</span>&nbsp;<span class="string" id="5108484">&#39;\&#39;&#39;</span><span class="op" id="5108488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108492">delim</span><span class="op" id="5108497">,</span>&nbsp;<span class="ident" id="5108499">i</span>&nbsp;<span class="op" id="5108501">=</span>&nbsp;<span class="ident" id="5108503">delimSingleQuote</span><span class="op" id="5108519">,</span>&nbsp;<span class="ident" id="5108521">i</span><span class="op" id="5108522">+</span><span class="num" id="5108523">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108526">case</span>&nbsp;<span class="string" id="5108531">&#39;&#34;&#39;</span><span class="op" id="5108534">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108538">delim</span><span class="op" id="5108543">,</span>&nbsp;<span class="ident" id="5108545">i</span>&nbsp;<span class="op" id="5108547">=</span>&nbsp;<span class="ident" id="5108549">delimDoubleQuote</span><span class="op" id="5108565">,</span>&nbsp;<span class="ident" id="5108567">i</span><span class="op" id="5108568">+</span><span class="num" id="5108569">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5108575">c</span><span class="op" id="5108576">.</span><span class="ident" id="5108577">state</span><span class="op" id="5108582">,</span>&nbsp;<span class="ident" id="5108584">c</span><span class="op" id="5108585">.</span><span class="ident" id="5108586">delim</span><span class="op" id="5108591">,</span>&nbsp;<span class="ident" id="5108593">c</span><span class="op" id="5108594">.</span><span class="ident" id="5108595">attr</span>&nbsp;<span class="op" id="5108600">=</span>&nbsp;<span class="ident" id="5108602">attrStartStates</span><span class="op" id="5108617">[</span><span class="ident" id="5108618">c</span><span class="op" id="5108619">.</span><span class="ident" id="5108620">attr</span><span class="op" id="5108624">]</span><span class="op" id="5108625">,</span>&nbsp;<span class="ident" id="5108627">delim</span><span class="op" id="5108632">,</span>&nbsp;<span class="ident" id="5108634">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108644">return</span>&nbsp;<span class="ident" id="5108651">c</span><span class="op" id="5108652">,</span>&nbsp;<span class="ident" id="5108654">i</span><br>
<span class="lineno"></span><span class="op" id="5108656">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5108659">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5108724">func</span>&nbsp;<span class="ident" id="5108729">tHTMLCmt</span><span class="op" id="5108737">(</span><span class="ident" id="5108738">c</span>&nbsp;<span class="ident" id="5108740">context</span><span class="op" id="5108747">,</span>&nbsp;<span class="ident" id="5108749">s</span>&nbsp;<span class="op" id="5108751">[</span><span class="op" id="5108752">]</span><span class="builtintype" id="5108753">byte</span><span class="op" id="5108757">)</span>&nbsp;<span class="op" id="5108759">(</span><span class="ident" id="5108760">context</span><span class="op" id="5108767">,</span>&nbsp;<span class="builtintype" id="5108769">int</span><span class="op" id="5108772">)</span>&nbsp;<span class="op" id="5108774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108777">if</span>&nbsp;<span class="ident" id="5108780">i</span>&nbsp;<span class="op" id="5108782">:=</span>&nbsp;<span class="ident" id="5108785">bytes</span><span class="op" id="5108790">.</span><span class="ident" id="5108791">Index</span><span class="op" id="5108796">(</span><span class="ident" id="5108797">s</span><span class="op" id="5108798">,</span>&nbsp;<span class="ident" id="5108800">commentEnd</span><span class="op" id="5108810">)</span><span class="op" id="5108811">;</span>&nbsp;<span class="ident" id="5108813">i</span>&nbsp;<span class="op" id="5108815">!=</span>&nbsp;<span class="op" id="5108818">-</span><span class="num" id="5108819">1</span>&nbsp;<span class="op" id="5108821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108825">return</span>&nbsp;<span class="ident" id="5108832">context</span><span class="op" id="5108839">{</span><span class="op" id="5108840">}</span><span class="op" id="5108841">,</span>&nbsp;<span class="ident" id="5108843">i</span>&nbsp;<span class="op" id="5108845">+</span>&nbsp;<span class="num" id="5108847">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5108850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5108853">return</span>&nbsp;<span class="ident" id="5108860">c</span><span class="op" id="5108861">,</span>&nbsp;<span class="builtinfunc" id="5108863">len</span><span class="op" id="5108866">(</span><span class="ident" id="5108867">s</span><span class="op" id="5108868">)</span><br>
<span class="lineno"></span><span class="op" id="5108870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5108873">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5108947">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5109010">var</span>&nbsp;<span class="ident" id="5109014">specialTagEndMarkers</span>&nbsp;<span class="op" id="5109035">=</span>&nbsp;<span class="op" id="5109037">[</span><span class="op" id="5109038">...</span><span class="op" id="5109041">]</span><span class="builtintype" id="5109042">string</span><span class="op" id="5109048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109051">elementScript</span><span class="op" id="5109064">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5109068">&#34;&lt;/script&#34;</span><span class="op" id="5109078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109081">elementStyle</span><span class="op" id="5109093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5109098">&#34;&lt;/style&#34;</span><span class="op" id="5109107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109110">elementTextarea</span><span class="op" id="5109125">:</span>&nbsp;<span class="string" id="5109127">&#34;&lt;/textarea&#34;</span><span class="op" id="5109139">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109142">elementTitle</span><span class="op" id="5109154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5109159">&#34;&lt;/title&#34;</span><span class="op" id="5109168">,</span><br>
<span class="lineno"></span><span class="op" id="5109170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5109173">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5109250">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5109269">func</span>&nbsp;<span class="ident" id="5109274">tSpecialTagEnd</span><span class="op" id="5109288">(</span><span class="ident" id="5109289">c</span>&nbsp;<span class="ident" id="5109291">context</span><span class="op" id="5109298">,</span>&nbsp;<span class="ident" id="5109300">s</span>&nbsp;<span class="op" id="5109302">[</span><span class="op" id="5109303">]</span><span class="builtintype" id="5109304">byte</span><span class="op" id="5109308">)</span>&nbsp;<span class="op" id="5109310">(</span><span class="ident" id="5109311">context</span><span class="op" id="5109318">,</span>&nbsp;<span class="builtintype" id="5109320">int</span><span class="op" id="5109323">)</span>&nbsp;<span class="op" id="5109325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109328">if</span>&nbsp;<span class="ident" id="5109331">c</span><span class="op" id="5109332">.</span><span class="ident" id="5109333">element</span>&nbsp;<span class="op" id="5109341">!=</span>&nbsp;<span class="ident" id="5109344">elementNone</span>&nbsp;<span class="op" id="5109356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109360">if</span>&nbsp;<span class="ident" id="5109363">i</span>&nbsp;<span class="op" id="5109365">:=</span>&nbsp;<span class="ident" id="5109368">strings</span><span class="op" id="5109375">.</span><span class="ident" id="5109376">Index</span><span class="op" id="5109381">(</span><span class="ident" id="5109382">strings</span><span class="op" id="5109389">.</span><span class="ident" id="5109390">ToLower</span><span class="op" id="5109397">(</span><span class="builtintype" id="5109398">string</span><span class="op" id="5109404">(</span><span class="ident" id="5109405">s</span><span class="op" id="5109406">)</span><span class="op" id="5109407">)</span><span class="op" id="5109408">,</span>&nbsp;<span class="ident" id="5109410">specialTagEndMarkers</span><span class="op" id="5109430">[</span><span class="ident" id="5109431">c</span><span class="op" id="5109432">.</span><span class="ident" id="5109433">element</span><span class="op" id="5109440">]</span><span class="op" id="5109441">)</span><span class="op" id="5109442">;</span>&nbsp;<span class="ident" id="5109444">i</span>&nbsp;<span class="op" id="5109446">!=</span>&nbsp;<span class="op" id="5109449">-</span><span class="num" id="5109450">1</span>&nbsp;<span class="op" id="5109452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109457">return</span>&nbsp;<span class="ident" id="5109464">context</span><span class="op" id="5109471">{</span><span class="op" id="5109472">}</span><span class="op" id="5109473">,</span>&nbsp;<span class="ident" id="5109475">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109479">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109485">return</span>&nbsp;<span class="ident" id="5109492">c</span><span class="op" id="5109493">,</span>&nbsp;<span class="builtinfunc" id="5109495">len</span><span class="op" id="5109498">(</span><span class="ident" id="5109499">s</span><span class="op" id="5109500">)</span><br>
<span class="lineno"></span><span class="op" id="5109502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5109505">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5109574">func</span>&nbsp;<span class="ident" id="5109579">tAttr</span><span class="op" id="5109584">(</span><span class="ident" id="5109585">c</span>&nbsp;<span class="ident" id="5109587">context</span><span class="op" id="5109594">,</span>&nbsp;<span class="ident" id="5109596">s</span>&nbsp;<span class="op" id="5109598">[</span><span class="op" id="5109599">]</span><span class="builtintype" id="5109600">byte</span><span class="op" id="5109604">)</span>&nbsp;<span class="op" id="5109606">(</span><span class="ident" id="5109607">context</span><span class="op" id="5109614">,</span>&nbsp;<span class="builtintype" id="5109616">int</span><span class="op" id="5109619">)</span>&nbsp;<span class="op" id="5109621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109624">return</span>&nbsp;<span class="ident" id="5109631">c</span><span class="op" id="5109632">,</span>&nbsp;<span class="builtinfunc" id="5109634">len</span><span class="op" id="5109637">(</span><span class="ident" id="5109638">s</span><span class="op" id="5109639">)</span><br>
<span class="lineno"></span><span class="op" id="5109641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5109644">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5109706">func</span>&nbsp;<span class="ident" id="5109711">tURL</span><span class="op" id="5109715">(</span><span class="ident" id="5109716">c</span>&nbsp;<span class="ident" id="5109718">context</span><span class="op" id="5109725">,</span>&nbsp;<span class="ident" id="5109727">s</span>&nbsp;<span class="op" id="5109729">[</span><span class="op" id="5109730">]</span><span class="builtintype" id="5109731">byte</span><span class="op" id="5109735">)</span>&nbsp;<span class="op" id="5109737">(</span><span class="ident" id="5109738">context</span><span class="op" id="5109745">,</span>&nbsp;<span class="builtintype" id="5109747">int</span><span class="op" id="5109750">)</span>&nbsp;<span class="op" id="5109752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5109755">if</span>&nbsp;<span class="ident" id="5109758">bytes</span><span class="op" id="5109763">.</span><span class="ident" id="5109764">IndexAny</span><span class="op" id="5109772">(</span><span class="ident" id="5109773">s</span><span class="op" id="5109774">,</span>&nbsp;<span class="string" id="5109776">&#34;#?&#34;</span><span class="op" id="5109780">)</span>&nbsp;<span class="op" id="5109782">&gt;=</span>&nbsp;<span class="num" id="5109785">0</span>&nbsp;<span class="op" id="5109787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5109791">c</span><span class="op" id="5109792">.</span><span class="ident" id="5109793">urlPart</span>&nbsp;<span class="op" id="5109801">=</span>&nbsp;<span class="ident" id="5109803">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5109823">}</span>&nbsp;<span class="keyword" id="5109825">else</span>&nbsp;<span class="keyword" id="5109830">if</span>&nbsp;<span class="builtinfunc" id="5109833">len</span><span class="op" id="5109836">(</span><span class="ident" id="5109837">s</span><span class="op" id="5109838">)</span>&nbsp;<span class="op" id="5109840">!=</span>&nbsp;<span class="ident" id="5109843">eatWhiteSpace</span><span class="op" id="5109856">(</span><span class="ident" id="5109857">s</span><span class="op" id="5109858">,</span>&nbsp;<span class="num" id="5109860">0</span><span class="op" id="5109861">)</span>&nbsp;<span class="op" id="5109863">&amp;&amp;</span>&nbsp;<span class="ident" id="5109866">c</span><span class="op" id="5109867">.</span><span class="ident" id="5109868">urlPart</span>&nbsp;<span class="op" id="5109876">==</span>&nbsp;<span class="ident" id="5109879">urlPartNone</span>&nbsp;<span class="op" id="5109891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5109895">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5109960">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110023">c</span><span class="op" id="5110024">.</span><span class="ident" id="5110025">urlPart</span>&nbsp;<span class="op" id="5110033">=</span>&nbsp;<span class="ident" id="5110035">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110055">return</span>&nbsp;<span class="ident" id="5110062">c</span><span class="op" id="5110063">,</span>&nbsp;<span class="builtinfunc" id="5110065">len</span><span class="op" id="5110068">(</span><span class="ident" id="5110069">s</span><span class="op" id="5110070">)</span><br>
<span class="lineno"></span><span class="op" id="5110072">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5110075">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5110135">func</span>&nbsp;<span class="ident" id="5110140">tJS</span><span class="op" id="5110143">(</span><span class="ident" id="5110144">c</span>&nbsp;<span class="ident" id="5110146">context</span><span class="op" id="5110153">,</span>&nbsp;<span class="ident" id="5110155">s</span>&nbsp;<span class="op" id="5110157">[</span><span class="op" id="5110158">]</span><span class="builtintype" id="5110159">byte</span><span class="op" id="5110163">)</span>&nbsp;<span class="op" id="5110165">(</span><span class="ident" id="5110166">context</span><span class="op" id="5110173">,</span>&nbsp;<span class="builtintype" id="5110175">int</span><span class="op" id="5110178">)</span>&nbsp;<span class="op" id="5110180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110183">i</span>&nbsp;<span class="op" id="5110185">:=</span>&nbsp;<span class="ident" id="5110188">bytes</span><span class="op" id="5110193">.</span><span class="ident" id="5110194">IndexAny</span><span class="op" id="5110202">(</span><span class="ident" id="5110203">s</span><span class="op" id="5110204">,</span>&nbsp;<span class="string" id="5110206">`&#34;&#39;/`</span><span class="op" id="5110211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110214">if</span>&nbsp;<span class="ident" id="5110217">i</span>&nbsp;<span class="op" id="5110219">==</span>&nbsp;<span class="op" id="5110222">-</span><span class="num" id="5110223">1</span>&nbsp;<span class="op" id="5110225">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5110229">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110286">c</span><span class="op" id="5110287">.</span><span class="ident" id="5110288">jsCtx</span>&nbsp;<span class="op" id="5110294">=</span>&nbsp;<span class="ident" id="5110296">nextJSCtx</span><span class="op" id="5110305">(</span><span class="ident" id="5110306">s</span><span class="op" id="5110307">,</span>&nbsp;<span class="ident" id="5110309">c</span><span class="op" id="5110310">.</span><span class="ident" id="5110311">jsCtx</span><span class="op" id="5110316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110320">return</span>&nbsp;<span class="ident" id="5110327">c</span><span class="op" id="5110328">,</span>&nbsp;<span class="builtinfunc" id="5110330">len</span><span class="op" id="5110333">(</span><span class="ident" id="5110334">s</span><span class="op" id="5110335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110341">c</span><span class="op" id="5110342">.</span><span class="ident" id="5110343">jsCtx</span>&nbsp;<span class="op" id="5110349">=</span>&nbsp;<span class="ident" id="5110351">nextJSCtx</span><span class="op" id="5110360">(</span><span class="ident" id="5110361">s</span><span class="op" id="5110362">[</span><span class="op" id="5110363">:</span><span class="ident" id="5110364">i</span><span class="op" id="5110365">]</span><span class="op" id="5110366">,</span>&nbsp;<span class="ident" id="5110368">c</span><span class="op" id="5110369">.</span><span class="ident" id="5110370">jsCtx</span><span class="op" id="5110375">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110378">switch</span>&nbsp;<span class="ident" id="5110385">s</span><span class="op" id="5110386">[</span><span class="ident" id="5110387">i</span><span class="op" id="5110388">]</span>&nbsp;<span class="op" id="5110390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110393">case</span>&nbsp;<span class="string" id="5110398">&#39;&#34;&#39;</span><span class="op" id="5110401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110405">c</span><span class="op" id="5110406">.</span><span class="ident" id="5110407">state</span><span class="op" id="5110412">,</span>&nbsp;<span class="ident" id="5110414">c</span><span class="op" id="5110415">.</span><span class="ident" id="5110416">jsCtx</span>&nbsp;<span class="op" id="5110422">=</span>&nbsp;<span class="ident" id="5110424">stateJSDqStr</span><span class="op" id="5110436">,</span>&nbsp;<span class="ident" id="5110438">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110451">case</span>&nbsp;<span class="string" id="5110456">&#39;\&#39;&#39;</span><span class="op" id="5110460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110464">c</span><span class="op" id="5110465">.</span><span class="ident" id="5110466">state</span><span class="op" id="5110471">,</span>&nbsp;<span class="ident" id="5110473">c</span><span class="op" id="5110474">.</span><span class="ident" id="5110475">jsCtx</span>&nbsp;<span class="op" id="5110481">=</span>&nbsp;<span class="ident" id="5110483">stateJSSqStr</span><span class="op" id="5110495">,</span>&nbsp;<span class="ident" id="5110497">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110510">case</span>&nbsp;<span class="string" id="5110515">&#39;/&#39;</span><span class="op" id="5110518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110522">switch</span>&nbsp;<span class="op" id="5110529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110533">case</span>&nbsp;<span class="ident" id="5110538">i</span><span class="op" id="5110539">+</span><span class="num" id="5110540">1</span>&nbsp;<span class="op" id="5110542">&lt;</span>&nbsp;<span class="builtinfunc" id="5110544">len</span><span class="op" id="5110547">(</span><span class="ident" id="5110548">s</span><span class="op" id="5110549">)</span>&nbsp;<span class="op" id="5110551">&amp;&amp;</span>&nbsp;<span class="ident" id="5110554">s</span><span class="op" id="5110555">[</span><span class="ident" id="5110556">i</span><span class="op" id="5110557">+</span><span class="num" id="5110558">1</span><span class="op" id="5110559">]</span>&nbsp;<span class="op" id="5110561">==</span>&nbsp;<span class="string" id="5110564">&#39;/&#39;</span><span class="op" id="5110567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110572">c</span><span class="op" id="5110573">.</span><span class="ident" id="5110574">state</span><span class="op" id="5110579">,</span>&nbsp;<span class="ident" id="5110581">i</span>&nbsp;<span class="op" id="5110583">=</span>&nbsp;<span class="ident" id="5110585">stateJSLineCmt</span><span class="op" id="5110599">,</span>&nbsp;<span class="ident" id="5110601">i</span><span class="op" id="5110602">+</span><span class="num" id="5110603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110607">case</span>&nbsp;<span class="ident" id="5110612">i</span><span class="op" id="5110613">+</span><span class="num" id="5110614">1</span>&nbsp;<span class="op" id="5110616">&lt;</span>&nbsp;<span class="builtinfunc" id="5110618">len</span><span class="op" id="5110621">(</span><span class="ident" id="5110622">s</span><span class="op" id="5110623">)</span>&nbsp;<span class="op" id="5110625">&amp;&amp;</span>&nbsp;<span class="ident" id="5110628">s</span><span class="op" id="5110629">[</span><span class="ident" id="5110630">i</span><span class="op" id="5110631">+</span><span class="num" id="5110632">1</span><span class="op" id="5110633">]</span>&nbsp;<span class="op" id="5110635">==</span>&nbsp;<span class="string" id="5110638">&#39;*&#39;</span><span class="op" id="5110641">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110646">c</span><span class="op" id="5110647">.</span><span class="ident" id="5110648">state</span><span class="op" id="5110653">,</span>&nbsp;<span class="ident" id="5110655">i</span>&nbsp;<span class="op" id="5110657">=</span>&nbsp;<span class="ident" id="5110659">stateJSBlockCmt</span><span class="op" id="5110674">,</span>&nbsp;<span class="ident" id="5110676">i</span><span class="op" id="5110677">+</span><span class="num" id="5110678">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110682">case</span>&nbsp;<span class="ident" id="5110687">c</span><span class="op" id="5110688">.</span><span class="ident" id="5110689">jsCtx</span>&nbsp;<span class="op" id="5110695">==</span>&nbsp;<span class="ident" id="5110698">jsCtxRegexp</span><span class="op" id="5110709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110714">c</span><span class="op" id="5110715">.</span><span class="ident" id="5110716">state</span>&nbsp;<span class="op" id="5110722">=</span>&nbsp;<span class="ident" id="5110724">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110740">case</span>&nbsp;<span class="ident" id="5110745">c</span><span class="op" id="5110746">.</span><span class="ident" id="5110747">jsCtx</span>&nbsp;<span class="op" id="5110753">==</span>&nbsp;<span class="ident" id="5110756">jsCtxDivOp</span><span class="op" id="5110766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110771">c</span><span class="op" id="5110772">.</span><span class="ident" id="5110773">jsCtx</span>&nbsp;<span class="op" id="5110779">=</span>&nbsp;<span class="ident" id="5110781">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110795">default</span><span class="op" id="5110802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110807">return</span>&nbsp;<span class="ident" id="5110814">context</span><span class="op" id="5110821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110827">state</span><span class="op" id="5110832">:</span>&nbsp;<span class="ident" id="5110834">stateError</span><span class="op" id="5110844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5110850">err</span><span class="op" id="5110853">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5110857">errorf</span><span class="op" id="5110863">(</span><span class="ident" id="5110864">ErrSlashAmbig</span><span class="op" id="5110877">,</span>&nbsp;<span class="ident" id="5110879">nil</span><span class="op" id="5110882">,</span>&nbsp;<span class="num" id="5110884">0</span><span class="op" id="5110885">,</span>&nbsp;<span class="string" id="5110887">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5110932">,</span>&nbsp;<span class="ident" id="5110934">s</span><span class="op" id="5110935">[</span><span class="ident" id="5110936">i</span><span class="op" id="5110937">:</span><span class="op" id="5110938">]</span><span class="op" id="5110939">)</span><span class="op" id="5110940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110945">}</span><span class="op" id="5110946">,</span>&nbsp;<span class="builtinfunc" id="5110948">len</span><span class="op" id="5110951">(</span><span class="ident" id="5110952">s</span><span class="op" id="5110953">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110960">default</span><span class="op" id="5110967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5110971">panic</span><span class="op" id="5110976">(</span><span class="string" id="5110977">&#34;unreachable&#34;</span><span class="op" id="5110990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5110993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5110996">return</span>&nbsp;<span class="ident" id="5111003">c</span><span class="op" id="5111004">,</span>&nbsp;<span class="ident" id="5111006">i</span>&nbsp;<span class="op" id="5111008">+</span>&nbsp;<span class="num" id="5111010">1</span><br>
<span class="lineno">255</span><span class="op" id="5111012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5111015">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5111095">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5111106">func</span>&nbsp;<span class="ident" id="5111111">tJSDelimited</span><span class="op" id="5111123">(</span><span class="ident" id="5111124">c</span>&nbsp;<span class="ident" id="5111126">context</span><span class="op" id="5111133">,</span>&nbsp;<span class="ident" id="5111135">s</span>&nbsp;<span class="op" id="5111137">[</span><span class="op" id="5111138">]</span><span class="builtintype" id="5111139">byte</span><span class="op" id="5111143">)</span>&nbsp;<span class="op" id="5111145">(</span><span class="ident" id="5111146">context</span><span class="op" id="5111153">,</span>&nbsp;<span class="builtintype" id="5111155">int</span><span class="op" id="5111158">)</span>&nbsp;<span class="op" id="5111160">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111163">specials</span>&nbsp;<span class="op" id="5111172">:=</span>&nbsp;<span class="string" id="5111175">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111181">switch</span>&nbsp;<span class="ident" id="5111188">c</span><span class="op" id="5111189">.</span><span class="ident" id="5111190">state</span>&nbsp;<span class="op" id="5111196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111199">case</span>&nbsp;<span class="ident" id="5111204">stateJSSqStr</span><span class="op" id="5111216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111220">specials</span>&nbsp;<span class="op" id="5111229">=</span>&nbsp;<span class="string" id="5111231">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111237">case</span>&nbsp;<span class="ident" id="5111242">stateJSRegexp</span><span class="op" id="5111255">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111259">specials</span>&nbsp;<span class="op" id="5111268">=</span>&nbsp;<span class="string" id="5111270">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111282">k</span><span class="op" id="5111283">,</span>&nbsp;<span class="ident" id="5111285">inCharset</span>&nbsp;<span class="op" id="5111295">:=</span>&nbsp;<span class="num" id="5111298">0</span><span class="op" id="5111299">,</span>&nbsp;<span class="builtintype" id="5111301">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111308">for</span>&nbsp;<span class="op" id="5111312">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111316">i</span>&nbsp;<span class="op" id="5111318">:=</span>&nbsp;<span class="ident" id="5111321">k</span>&nbsp;<span class="op" id="5111323">+</span>&nbsp;<span class="ident" id="5111325">bytes</span><span class="op" id="5111330">.</span><span class="ident" id="5111331">IndexAny</span><span class="op" id="5111339">(</span><span class="ident" id="5111340">s</span><span class="op" id="5111341">[</span><span class="ident" id="5111342">k</span><span class="op" id="5111343">:</span><span class="op" id="5111344">]</span><span class="op" id="5111345">,</span>&nbsp;<span class="ident" id="5111347">specials</span><span class="op" id="5111355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111359">if</span>&nbsp;<span class="ident" id="5111362">i</span>&nbsp;<span class="op" id="5111364">&lt;</span>&nbsp;<span class="ident" id="5111366">k</span>&nbsp;<span class="op" id="5111368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111373">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111385">switch</span>&nbsp;<span class="ident" id="5111392">s</span><span class="op" id="5111393">[</span><span class="ident" id="5111394">i</span><span class="op" id="5111395">]</span>&nbsp;<span class="op" id="5111397">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111401">case</span>&nbsp;<span class="string" id="5111406">&#39;\\&#39;</span><span class="op" id="5111410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111415">i</span><span class="op" id="5111416">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111422">if</span>&nbsp;<span class="ident" id="5111425">i</span>&nbsp;<span class="op" id="5111427">==</span>&nbsp;<span class="builtinfunc" id="5111430">len</span><span class="op" id="5111433">(</span><span class="ident" id="5111434">s</span><span class="op" id="5111435">)</span>&nbsp;<span class="op" id="5111437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111443">return</span>&nbsp;<span class="ident" id="5111450">context</span><span class="op" id="5111457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111464">state</span><span class="op" id="5111469">:</span>&nbsp;<span class="ident" id="5111471">stateError</span><span class="op" id="5111481">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111488">err</span><span class="op" id="5111491">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5111495">errorf</span><span class="op" id="5111501">(</span><span class="ident" id="5111502">ErrPartialEscape</span><span class="op" id="5111518">,</span>&nbsp;<span class="ident" id="5111520">nil</span><span class="op" id="5111523">,</span>&nbsp;<span class="num" id="5111525">0</span><span class="op" id="5111526">,</span>&nbsp;<span class="string" id="5111528">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5111573">,</span>&nbsp;<span class="ident" id="5111575">s</span><span class="op" id="5111576">)</span><span class="op" id="5111577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111583">}</span><span class="op" id="5111584">,</span>&nbsp;<span class="builtinfunc" id="5111586">len</span><span class="op" id="5111589">(</span><span class="ident" id="5111590">s</span><span class="op" id="5111591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111600">case</span>&nbsp;<span class="string" id="5111605">&#39;[&#39;</span><span class="op" id="5111608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111613">inCharset</span>&nbsp;<span class="op" id="5111623">=</span>&nbsp;<span class="builtintype" id="5111625">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111632">case</span>&nbsp;<span class="string" id="5111637">&#39;]&#39;</span><span class="op" id="5111640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111645">inCharset</span>&nbsp;<span class="op" id="5111655">=</span>&nbsp;<span class="builtintype" id="5111657">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111665">default</span><span class="op" id="5111672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111677">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111697">if</span>&nbsp;<span class="op" id="5111700">!</span><span class="ident" id="5111701">inCharset</span>&nbsp;<span class="op" id="5111711">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111717">c</span><span class="op" id="5111718">.</span><span class="ident" id="5111719">state</span><span class="op" id="5111724">,</span>&nbsp;<span class="ident" id="5111726">c</span><span class="op" id="5111727">.</span><span class="ident" id="5111728">jsCtx</span>&nbsp;<span class="op" id="5111734">=</span>&nbsp;<span class="ident" id="5111736">stateJS</span><span class="op" id="5111743">,</span>&nbsp;<span class="ident" id="5111745">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111760">return</span>&nbsp;<span class="ident" id="5111767">c</span><span class="op" id="5111768">,</span>&nbsp;<span class="ident" id="5111770">i</span>&nbsp;<span class="op" id="5111772">+</span>&nbsp;<span class="num" id="5111774">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111787">k</span>&nbsp;<span class="op" id="5111789">=</span>&nbsp;<span class="ident" id="5111791">i</span>&nbsp;<span class="op" id="5111793">+</span>&nbsp;<span class="num" id="5111795">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5111798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111802">if</span>&nbsp;<span class="ident" id="5111805">inCharset</span>&nbsp;<span class="op" id="5111815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111819">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5111884">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5111915">return</span>&nbsp;<span class="ident" id="5111922">context</span><span class="op" id="5111929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111934">state</span><span class="op" id="5111939">:</span>&nbsp;<span class="ident" id="5111941">stateError</span><span class="op" id="5111951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5111956">err</span><span class="op" id="5111959">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5111963">errorf</span><span class="op" id="5111969">(</span><span class="ident" id="5111970">ErrPartialCharset</span><span class="op" id="5111987">,</span>&nbsp;<span class="ident" id="5111989">nil</span><span class="op" id="5111992">,</span>&nbsp;<span class="num" id="5111994">0</span><span class="op" id="5111995">,</span>&nbsp;<span class="string" id="5111997">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5112031">,</span>&nbsp;<span class="ident" id="5112033">s</span><span class="op" id="5112034">)</span><span class="op" id="5112035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5112039">}</span><span class="op" id="5112040">,</span>&nbsp;<span class="builtinfunc" id="5112042">len</span><span class="op" id="5112045">(</span><span class="ident" id="5112046">s</span><span class="op" id="5112047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5112050">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112054">return</span>&nbsp;<span class="ident" id="5112061">c</span><span class="op" id="5112062">,</span>&nbsp;<span class="builtinfunc" id="5112064">len</span><span class="op" id="5112067">(</span><span class="ident" id="5112068">s</span><span class="op" id="5112069">)</span><br>
<span class="lineno"></span><span class="op" id="5112071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5112074">var</span>&nbsp;<span class="ident" id="5112078">blockCommentEnd</span>&nbsp;<span class="op" id="5112094">=</span>&nbsp;<span class="op" id="5112096">[</span><span class="op" id="5112097">]</span><span class="builtintype" id="5112098">byte</span><span class="op" id="5112102">(</span><span class="string" id="5112103">&#34;*/&#34;</span><span class="op" id="5112107">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5112110">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5112182">func</span>&nbsp;<span class="ident" id="5112187">tBlockCmt</span><span class="op" id="5112196">(</span><span class="ident" id="5112197">c</span>&nbsp;<span class="ident" id="5112199">context</span><span class="op" id="5112206">,</span>&nbsp;<span class="ident" id="5112208">s</span>&nbsp;<span class="op" id="5112210">[</span><span class="op" id="5112211">]</span><span class="builtintype" id="5112212">byte</span><span class="op" id="5112216">)</span>&nbsp;<span class="op" id="5112218">(</span><span class="ident" id="5112219">context</span><span class="op" id="5112226">,</span>&nbsp;<span class="builtintype" id="5112228">int</span><span class="op" id="5112231">)</span>&nbsp;<span class="op" id="5112233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112236">i</span>&nbsp;<span class="op" id="5112238">:=</span>&nbsp;<span class="ident" id="5112241">bytes</span><span class="op" id="5112246">.</span><span class="ident" id="5112247">Index</span><span class="op" id="5112252">(</span><span class="ident" id="5112253">s</span><span class="op" id="5112254">,</span>&nbsp;<span class="ident" id="5112256">blockCommentEnd</span><span class="op" id="5112271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112274">if</span>&nbsp;<span class="ident" id="5112277">i</span>&nbsp;<span class="op" id="5112279">==</span>&nbsp;<span class="op" id="5112282">-</span><span class="num" id="5112283">1</span>&nbsp;<span class="op" id="5112285">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112289">return</span>&nbsp;<span class="ident" id="5112296">c</span><span class="op" id="5112297">,</span>&nbsp;<span class="builtinfunc" id="5112299">len</span><span class="op" id="5112302">(</span><span class="ident" id="5112303">s</span><span class="op" id="5112304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5112307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112310">switch</span>&nbsp;<span class="ident" id="5112317">c</span><span class="op" id="5112318">.</span><span class="ident" id="5112319">state</span>&nbsp;<span class="op" id="5112325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112328">case</span>&nbsp;<span class="ident" id="5112333">stateJSBlockCmt</span><span class="op" id="5112348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112352">c</span><span class="op" id="5112353">.</span><span class="ident" id="5112354">state</span>&nbsp;<span class="op" id="5112360">=</span>&nbsp;<span class="ident" id="5112362">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112371">case</span>&nbsp;<span class="ident" id="5112376">stateCSSBlockCmt</span><span class="op" id="5112392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112396">c</span><span class="op" id="5112397">.</span><span class="ident" id="5112398">state</span>&nbsp;<span class="op" id="5112404">=</span>&nbsp;<span class="ident" id="5112406">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112416">default</span><span class="op" id="5112423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5112427">panic</span><span class="op" id="5112432">(</span><span class="ident" id="5112433">c</span><span class="op" id="5112434">.</span><span class="ident" id="5112435">state</span><span class="op" id="5112440">.</span><span class="ident" id="5112441">String</span><span class="op" id="5112447">(</span><span class="op" id="5112448">)</span><span class="op" id="5112449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5112452">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112455">return</span>&nbsp;<span class="ident" id="5112462">c</span><span class="op" id="5112463">,</span>&nbsp;<span class="ident" id="5112465">i</span>&nbsp;<span class="op" id="5112467">+</span>&nbsp;<span class="num" id="5112469">2</span><br>
<span class="lineno"></span><span class="op" id="5112471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5112474">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5112543">func</span>&nbsp;<span class="ident" id="5112548">tLineCmt</span><span class="op" id="5112556">(</span><span class="ident" id="5112557">c</span>&nbsp;<span class="ident" id="5112559">context</span><span class="op" id="5112566">,</span>&nbsp;<span class="ident" id="5112568">s</span>&nbsp;<span class="op" id="5112570">[</span><span class="op" id="5112571">]</span><span class="builtintype" id="5112572">byte</span><span class="op" id="5112576">)</span>&nbsp;<span class="op" id="5112578">(</span><span class="ident" id="5112579">context</span><span class="op" id="5112586">,</span>&nbsp;<span class="builtintype" id="5112588">int</span><span class="op" id="5112591">)</span>&nbsp;<span class="op" id="5112593">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112596">var</span>&nbsp;<span class="ident" id="5112600">lineTerminators</span>&nbsp;<span class="builtintype" id="5112616">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112624">var</span>&nbsp;<span class="ident" id="5112628">endState</span>&nbsp;<span class="ident" id="5112637">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112644">switch</span>&nbsp;<span class="ident" id="5112651">c</span><span class="op" id="5112652">.</span><span class="ident" id="5112653">state</span>&nbsp;<span class="op" id="5112659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112662">case</span>&nbsp;<span class="ident" id="5112667">stateJSLineCmt</span><span class="op" id="5112681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112685">lineTerminators</span><span class="op" id="5112700">,</span>&nbsp;<span class="ident" id="5112702">endState</span>&nbsp;<span class="op" id="5112711">=</span>&nbsp;<span class="string" id="5112713">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5112731">,</span>&nbsp;<span class="ident" id="5112733">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5112742">case</span>&nbsp;<span class="ident" id="5112747">stateCSSLineCmt</span><span class="op" id="5112762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5112766">lineTerminators</span><span class="op" id="5112781">,</span>&nbsp;<span class="ident" id="5112783">endState</span>&nbsp;<span class="op" id="5112792">=</span>&nbsp;<span class="string" id="5112794">&#34;\n\f\r&#34;</span><span class="op" id="5112802">,</span>&nbsp;<span class="ident" id="5112804">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112815">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112881">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112925">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5112960">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113001">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113064">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113120">default</span><span class="op" id="5113127">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5113131">panic</span><span class="op" id="5113136">(</span><span class="ident" id="5113137">c</span><span class="op" id="5113138">.</span><span class="ident" id="5113139">state</span><span class="op" id="5113144">.</span><span class="ident" id="5113145">String</span><span class="op" id="5113151">(</span><span class="op" id="5113152">)</span><span class="op" id="5113153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113160">i</span>&nbsp;<span class="op" id="5113162">:=</span>&nbsp;<span class="ident" id="5113165">bytes</span><span class="op" id="5113170">.</span><span class="ident" id="5113171">IndexAny</span><span class="op" id="5113179">(</span><span class="ident" id="5113180">s</span><span class="op" id="5113181">,</span>&nbsp;<span class="ident" id="5113183">lineTerminators</span><span class="op" id="5113198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113201">if</span>&nbsp;<span class="ident" id="5113204">i</span>&nbsp;<span class="op" id="5113206">==</span>&nbsp;<span class="op" id="5113209">-</span><span class="num" id="5113210">1</span>&nbsp;<span class="op" id="5113212">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113216">return</span>&nbsp;<span class="ident" id="5113223">c</span><span class="op" id="5113224">,</span>&nbsp;<span class="builtinfunc" id="5113226">len</span><span class="op" id="5113229">(</span><span class="ident" id="5113230">s</span><span class="op" id="5113231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5113234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5113237">c</span><span class="op" id="5113238">.</span><span class="ident" id="5113239">state</span>&nbsp;<span class="op" id="5113245">=</span>&nbsp;<span class="ident" id="5113247">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113257">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113323">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113386">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113446">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113512">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5113576">return</span>&nbsp;<span class="ident" id="5113583">c</span><span class="op" id="5113584">,</span>&nbsp;<span class="ident" id="5113586">i</span><br>
<span class="lineno"></span><span class="op" id="5113588">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5113591">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5113653">func</span>&nbsp;<span class="ident" id="5113658">tCSS</span><span class="op" id="5113662">(</span><span class="ident" id="5113663">c</span>&nbsp;<span class="ident" id="5113665">context</span><span class="op" id="5113672">,</span>&nbsp;<span class="ident" id="5113674">s</span>&nbsp;<span class="op" id="5113676">[</span><span class="op" id="5113677">]</span><span class="builtintype" id="5113678">byte</span><span class="op" id="5113682">)</span>&nbsp;<span class="op" id="5113684">(</span><span class="ident" id="5113685">context</span><span class="op" id="5113692">,</span>&nbsp;<span class="builtintype" id="5113694">int</span><span class="op" id="5113697">)</span>&nbsp;<span class="op" id="5113699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113702">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113759">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113801">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113867">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113929">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113944">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5113997">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114043">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114094">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114155">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114171">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114228">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114298">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114302">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114365">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114400">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114404">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114458">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114527">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114599">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114620">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114688">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114758">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114819">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114890">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5114959">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5114998">k</span>&nbsp;<span class="op" id="5115000">:=</span>&nbsp;<span class="num" id="5115003">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115006">for</span>&nbsp;<span class="op" id="5115010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115014">i</span>&nbsp;<span class="op" id="5115016">:=</span>&nbsp;<span class="ident" id="5115019">k</span>&nbsp;<span class="op" id="5115021">+</span>&nbsp;<span class="ident" id="5115023">bytes</span><span class="op" id="5115028">.</span><span class="ident" id="5115029">IndexAny</span><span class="op" id="5115037">(</span><span class="ident" id="5115038">s</span><span class="op" id="5115039">[</span><span class="ident" id="5115040">k</span><span class="op" id="5115041">:</span><span class="op" id="5115042">]</span><span class="op" id="5115043">,</span>&nbsp;<span class="string" id="5115045">`(&#34;&#39;/`</span><span class="op" id="5115051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115055">if</span>&nbsp;<span class="ident" id="5115058">i</span>&nbsp;<span class="op" id="5115060">&lt;</span>&nbsp;<span class="ident" id="5115062">k</span>&nbsp;<span class="op" id="5115064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115069">return</span>&nbsp;<span class="ident" id="5115076">c</span><span class="op" id="5115077">,</span>&nbsp;<span class="builtinfunc" id="5115079">len</span><span class="op" id="5115082">(</span><span class="ident" id="5115083">s</span><span class="op" id="5115084">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115092">switch</span>&nbsp;<span class="ident" id="5115099">s</span><span class="op" id="5115100">[</span><span class="ident" id="5115101">i</span><span class="op" id="5115102">]</span>&nbsp;<span class="op" id="5115104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115108">case</span>&nbsp;<span class="string" id="5115113">&#39;(&#39;</span><span class="op" id="5115116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5115121">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115153">p</span>&nbsp;<span class="op" id="5115155">:=</span>&nbsp;<span class="ident" id="5115158">bytes</span><span class="op" id="5115163">.</span><span class="ident" id="5115164">TrimRight</span><span class="op" id="5115173">(</span><span class="ident" id="5115174">s</span><span class="op" id="5115175">[</span><span class="op" id="5115176">:</span><span class="ident" id="5115177">i</span><span class="op" id="5115178">]</span><span class="op" id="5115179">,</span>&nbsp;<span class="string" id="5115181">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5115192">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115197">if</span>&nbsp;<span class="ident" id="5115200">endsWithCSSKeyword</span><span class="op" id="5115218">(</span><span class="ident" id="5115219">p</span><span class="op" id="5115220">,</span>&nbsp;<span class="string" id="5115222">&#34;url&#34;</span><span class="op" id="5115227">)</span>&nbsp;<span class="op" id="5115229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115235">j</span>&nbsp;<span class="op" id="5115237">:=</span>&nbsp;<span class="builtinfunc" id="5115240">len</span><span class="op" id="5115243">(</span><span class="ident" id="5115244">s</span><span class="op" id="5115245">)</span>&nbsp;<span class="op" id="5115247">-</span>&nbsp;<span class="builtinfunc" id="5115249">len</span><span class="op" id="5115252">(</span><span class="ident" id="5115253">bytes</span><span class="op" id="5115258">.</span><span class="ident" id="5115259">TrimLeft</span><span class="op" id="5115267">(</span><span class="ident" id="5115268">s</span><span class="op" id="5115269">[</span><span class="ident" id="5115270">i</span><span class="op" id="5115271">+</span><span class="num" id="5115272">1</span><span class="op" id="5115273">:</span><span class="op" id="5115274">]</span><span class="op" id="5115275">,</span>&nbsp;<span class="string" id="5115277">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5115288">)</span><span class="op" id="5115289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115295">switch</span>&nbsp;<span class="op" id="5115302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115308">case</span>&nbsp;<span class="ident" id="5115313">j</span>&nbsp;<span class="op" id="5115315">!=</span>&nbsp;<span class="builtinfunc" id="5115318">len</span><span class="op" id="5115321">(</span><span class="ident" id="5115322">s</span><span class="op" id="5115323">)</span>&nbsp;<span class="op" id="5115325">&amp;&amp;</span>&nbsp;<span class="ident" id="5115328">s</span><span class="op" id="5115329">[</span><span class="ident" id="5115330">j</span><span class="op" id="5115331">]</span>&nbsp;<span class="op" id="5115333">==</span>&nbsp;<span class="string" id="5115336">&#39;&#34;&#39;</span><span class="op" id="5115339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115346">c</span><span class="op" id="5115347">.</span><span class="ident" id="5115348">state</span><span class="op" id="5115353">,</span>&nbsp;<span class="ident" id="5115355">j</span>&nbsp;<span class="op" id="5115357">=</span>&nbsp;<span class="ident" id="5115359">stateCSSDqURL</span><span class="op" id="5115372">,</span>&nbsp;<span class="ident" id="5115374">j</span><span class="op" id="5115375">+</span><span class="num" id="5115376">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115382">case</span>&nbsp;<span class="ident" id="5115387">j</span>&nbsp;<span class="op" id="5115389">!=</span>&nbsp;<span class="builtinfunc" id="5115392">len</span><span class="op" id="5115395">(</span><span class="ident" id="5115396">s</span><span class="op" id="5115397">)</span>&nbsp;<span class="op" id="5115399">&amp;&amp;</span>&nbsp;<span class="ident" id="5115402">s</span><span class="op" id="5115403">[</span><span class="ident" id="5115404">j</span><span class="op" id="5115405">]</span>&nbsp;<span class="op" id="5115407">==</span>&nbsp;<span class="string" id="5115410">&#39;\&#39;&#39;</span><span class="op" id="5115414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115421">c</span><span class="op" id="5115422">.</span><span class="ident" id="5115423">state</span><span class="op" id="5115428">,</span>&nbsp;<span class="ident" id="5115430">j</span>&nbsp;<span class="op" id="5115432">=</span>&nbsp;<span class="ident" id="5115434">stateCSSSqURL</span><span class="op" id="5115447">,</span>&nbsp;<span class="ident" id="5115449">j</span><span class="op" id="5115450">+</span><span class="num" id="5115451">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115457">default</span><span class="op" id="5115464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115471">c</span><span class="op" id="5115472">.</span><span class="ident" id="5115473">state</span>&nbsp;<span class="op" id="5115479">=</span>&nbsp;<span class="ident" id="5115481">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115497">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115503">return</span>&nbsp;<span class="ident" id="5115510">c</span><span class="op" id="5115511">,</span>&nbsp;<span class="ident" id="5115513">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115522">case</span>&nbsp;<span class="string" id="5115527">&#39;/&#39;</span><span class="op" id="5115530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115535">if</span>&nbsp;<span class="ident" id="5115538">i</span><span class="op" id="5115539">+</span><span class="num" id="5115540">1</span>&nbsp;<span class="op" id="5115542">&lt;</span>&nbsp;<span class="builtinfunc" id="5115544">len</span><span class="op" id="5115547">(</span><span class="ident" id="5115548">s</span><span class="op" id="5115549">)</span>&nbsp;<span class="op" id="5115551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115557">switch</span>&nbsp;<span class="ident" id="5115564">s</span><span class="op" id="5115565">[</span><span class="ident" id="5115566">i</span><span class="op" id="5115567">+</span><span class="num" id="5115568">1</span><span class="op" id="5115569">]</span>&nbsp;<span class="op" id="5115571">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115577">case</span>&nbsp;<span class="string" id="5115582">&#39;/&#39;</span><span class="op" id="5115585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115592">c</span><span class="op" id="5115593">.</span><span class="ident" id="5115594">state</span>&nbsp;<span class="op" id="5115600">=</span>&nbsp;<span class="ident" id="5115602">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115623">return</span>&nbsp;<span class="ident" id="5115630">c</span><span class="op" id="5115631">,</span>&nbsp;<span class="ident" id="5115633">i</span>&nbsp;<span class="op" id="5115635">+</span>&nbsp;<span class="num" id="5115637">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115643">case</span>&nbsp;<span class="string" id="5115648">&#39;*&#39;</span><span class="op" id="5115651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115658">c</span><span class="op" id="5115659">.</span><span class="ident" id="5115660">state</span>&nbsp;<span class="op" id="5115666">=</span>&nbsp;<span class="ident" id="5115668">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115690">return</span>&nbsp;<span class="ident" id="5115697">c</span><span class="op" id="5115698">,</span>&nbsp;<span class="ident" id="5115700">i</span>&nbsp;<span class="op" id="5115702">+</span>&nbsp;<span class="num" id="5115704">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115719">case</span>&nbsp;<span class="string" id="5115724">&#39;&#34;&#39;</span><span class="op" id="5115727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115732">c</span><span class="op" id="5115733">.</span><span class="ident" id="5115734">state</span>&nbsp;<span class="op" id="5115740">=</span>&nbsp;<span class="ident" id="5115742">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115759">return</span>&nbsp;<span class="ident" id="5115766">c</span><span class="op" id="5115767">,</span>&nbsp;<span class="ident" id="5115769">i</span>&nbsp;<span class="op" id="5115771">+</span>&nbsp;<span class="num" id="5115773">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115777">case</span>&nbsp;<span class="string" id="5115782">&#39;\&#39;&#39;</span><span class="op" id="5115786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115791">c</span><span class="op" id="5115792">.</span><span class="ident" id="5115793">state</span>&nbsp;<span class="op" id="5115799">=</span>&nbsp;<span class="ident" id="5115801">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115818">return</span>&nbsp;<span class="ident" id="5115825">c</span><span class="op" id="5115826">,</span>&nbsp;<span class="ident" id="5115828">i</span>&nbsp;<span class="op" id="5115830">+</span>&nbsp;<span class="num" id="5115832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115836">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5115840">k</span>&nbsp;<span class="op" id="5115842">=</span>&nbsp;<span class="ident" id="5115844">i</span>&nbsp;<span class="op" id="5115846">+</span>&nbsp;<span class="num" id="5115848">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5115851">}</span><br>
<span class="lineno"></span><span class="op" id="5115853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5115856">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5115937">func</span>&nbsp;<span class="ident" id="5115942">tCSSStr</span><span class="op" id="5115949">(</span><span class="ident" id="5115950">c</span>&nbsp;<span class="ident" id="5115952">context</span><span class="op" id="5115959">,</span>&nbsp;<span class="ident" id="5115961">s</span>&nbsp;<span class="op" id="5115963">[</span><span class="op" id="5115964">]</span><span class="builtintype" id="5115965">byte</span><span class="op" id="5115969">)</span>&nbsp;<span class="op" id="5115971">(</span><span class="ident" id="5115972">context</span><span class="op" id="5115979">,</span>&nbsp;<span class="builtintype" id="5115981">int</span><span class="op" id="5115984">)</span>&nbsp;<span class="op" id="5115986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5115989">var</span>&nbsp;<span class="ident" id="5115993">endAndEsc</span>&nbsp;<span class="builtintype" id="5116003">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116011">switch</span>&nbsp;<span class="ident" id="5116018">c</span><span class="op" id="5116019">.</span><span class="ident" id="5116020">state</span>&nbsp;<span class="op" id="5116026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116029">case</span>&nbsp;<span class="ident" id="5116034">stateCSSDqStr</span><span class="op" id="5116047">,</span>&nbsp;<span class="ident" id="5116049">stateCSSDqURL</span><span class="op" id="5116062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116066">endAndEsc</span>&nbsp;<span class="op" id="5116076">=</span>&nbsp;<span class="string" id="5116078">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116084">case</span>&nbsp;<span class="ident" id="5116089">stateCSSSqStr</span><span class="op" id="5116102">,</span>&nbsp;<span class="ident" id="5116104">stateCSSSqURL</span><span class="op" id="5116117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116121">endAndEsc</span>&nbsp;<span class="op" id="5116131">=</span>&nbsp;<span class="string" id="5116133">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116139">case</span>&nbsp;<span class="ident" id="5116144">stateCSSURL</span><span class="op" id="5116155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116159">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5116219">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116281">endAndEsc</span>&nbsp;<span class="op" id="5116291">=</span>&nbsp;<span class="string" id="5116293">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116309">default</span><span class="op" id="5116316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5116320">panic</span><span class="op" id="5116325">(</span><span class="ident" id="5116326">c</span><span class="op" id="5116327">.</span><span class="ident" id="5116328">state</span><span class="op" id="5116333">.</span><span class="ident" id="5116334">String</span><span class="op" id="5116340">(</span><span class="op" id="5116341">)</span><span class="op" id="5116342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116349">k</span>&nbsp;<span class="op" id="5116351">:=</span>&nbsp;<span class="num" id="5116354">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116357">for</span>&nbsp;<span class="op" id="5116361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116365">i</span>&nbsp;<span class="op" id="5116367">:=</span>&nbsp;<span class="ident" id="5116370">k</span>&nbsp;<span class="op" id="5116372">+</span>&nbsp;<span class="ident" id="5116374">bytes</span><span class="op" id="5116379">.</span><span class="ident" id="5116380">IndexAny</span><span class="op" id="5116388">(</span><span class="ident" id="5116389">s</span><span class="op" id="5116390">[</span><span class="ident" id="5116391">k</span><span class="op" id="5116392">:</span><span class="op" id="5116393">]</span><span class="op" id="5116394">,</span>&nbsp;<span class="ident" id="5116396">endAndEsc</span><span class="op" id="5116405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116409">if</span>&nbsp;<span class="ident" id="5116412">i</span>&nbsp;<span class="op" id="5116414">&lt;</span>&nbsp;<span class="ident" id="5116416">k</span>&nbsp;<span class="op" id="5116418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116423">c</span><span class="op" id="5116424">,</span>&nbsp;<span class="ident" id="5116426">nread</span>&nbsp;<span class="op" id="5116432">:=</span>&nbsp;<span class="ident" id="5116435">tURL</span><span class="op" id="5116439">(</span><span class="ident" id="5116440">c</span><span class="op" id="5116441">,</span>&nbsp;<span class="ident" id="5116443">decodeCSS</span><span class="op" id="5116452">(</span><span class="ident" id="5116453">s</span><span class="op" id="5116454">[</span><span class="ident" id="5116455">k</span><span class="op" id="5116456">:</span><span class="op" id="5116457">]</span><span class="op" id="5116458">)</span><span class="op" id="5116459">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116464">return</span>&nbsp;<span class="ident" id="5116471">c</span><span class="op" id="5116472">,</span>&nbsp;<span class="ident" id="5116474">k</span>&nbsp;<span class="op" id="5116476">+</span>&nbsp;<span class="ident" id="5116478">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116490">if</span>&nbsp;<span class="ident" id="5116493">s</span><span class="op" id="5116494">[</span><span class="ident" id="5116495">i</span><span class="op" id="5116496">]</span>&nbsp;<span class="op" id="5116498">==</span>&nbsp;<span class="string" id="5116501">&#39;\\&#39;</span>&nbsp;<span class="op" id="5116506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116511">i</span><span class="op" id="5116512">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116518">if</span>&nbsp;<span class="ident" id="5116521">i</span>&nbsp;<span class="op" id="5116523">==</span>&nbsp;<span class="builtinfunc" id="5116526">len</span><span class="op" id="5116529">(</span><span class="ident" id="5116530">s</span><span class="op" id="5116531">)</span>&nbsp;<span class="op" id="5116533">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116539">return</span>&nbsp;<span class="ident" id="5116546">context</span><span class="op" id="5116553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116560">state</span><span class="op" id="5116565">:</span>&nbsp;<span class="ident" id="5116567">stateError</span><span class="op" id="5116577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116584">err</span><span class="op" id="5116587">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5116591">errorf</span><span class="op" id="5116597">(</span><span class="ident" id="5116598">ErrPartialEscape</span><span class="op" id="5116614">,</span>&nbsp;<span class="ident" id="5116616">nil</span><span class="op" id="5116619">,</span>&nbsp;<span class="num" id="5116621">0</span><span class="op" id="5116622">,</span>&nbsp;<span class="string" id="5116624">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5116670">,</span>&nbsp;<span class="ident" id="5116672">s</span><span class="op" id="5116673">)</span><span class="op" id="5116674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116680">}</span><span class="op" id="5116681">,</span>&nbsp;<span class="builtinfunc" id="5116683">len</span><span class="op" id="5116686">(</span><span class="ident" id="5116687">s</span><span class="op" id="5116688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116693">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116697">}</span>&nbsp;<span class="keyword" id="5116699">else</span>&nbsp;<span class="op" id="5116704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116709">c</span><span class="op" id="5116710">.</span><span class="ident" id="5116711">state</span>&nbsp;<span class="op" id="5116717">=</span>&nbsp;<span class="ident" id="5116719">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116731">return</span>&nbsp;<span class="ident" id="5116738">c</span><span class="op" id="5116739">,</span>&nbsp;<span class="ident" id="5116741">i</span>&nbsp;<span class="op" id="5116743">+</span>&nbsp;<span class="num" id="5116745">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116753">c</span><span class="op" id="5116754">,</span>&nbsp;<span class="ident" id="5116756">_</span>&nbsp;<span class="op" id="5116758">=</span>&nbsp;<span class="ident" id="5116760">tURL</span><span class="op" id="5116764">(</span><span class="ident" id="5116765">c</span><span class="op" id="5116766">,</span>&nbsp;<span class="ident" id="5116768">decodeCSS</span><span class="op" id="5116777">(</span><span class="ident" id="5116778">s</span><span class="op" id="5116779">[</span><span class="op" id="5116780">:</span><span class="ident" id="5116781">i</span><span class="op" id="5116782">+</span><span class="num" id="5116783">1</span><span class="op" id="5116784">]</span><span class="op" id="5116785">)</span><span class="op" id="5116786">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5116790">k</span>&nbsp;<span class="op" id="5116792">=</span>&nbsp;<span class="ident" id="5116794">i</span>&nbsp;<span class="op" id="5116796">+</span>&nbsp;<span class="num" id="5116798">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5116801">}</span><br>
<span class="lineno"></span><span class="op" id="5116803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116806">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5116872">func</span>&nbsp;<span class="ident" id="5116877">tError</span><span class="op" id="5116883">(</span><span class="ident" id="5116884">c</span>&nbsp;<span class="ident" id="5116886">context</span><span class="op" id="5116893">,</span>&nbsp;<span class="ident" id="5116895">s</span>&nbsp;<span class="op" id="5116897">[</span><span class="op" id="5116898">]</span><span class="builtintype" id="5116899">byte</span><span class="op" id="5116903">)</span>&nbsp;<span class="op" id="5116905">(</span><span class="ident" id="5116906">context</span><span class="op" id="5116913">,</span>&nbsp;<span class="builtintype" id="5116915">int</span><span class="op" id="5116918">)</span>&nbsp;<span class="op" id="5116920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5116923">return</span>&nbsp;<span class="ident" id="5116930">c</span><span class="op" id="5116931">,</span>&nbsp;<span class="builtinfunc" id="5116933">len</span><span class="op" id="5116936">(</span><span class="ident" id="5116937">s</span><span class="op" id="5116938">)</span><br>
<span class="lineno"></span><span class="op" id="5116940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116943">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5117019">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5117088">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5117161">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5117177">func</span>&nbsp;<span class="ident" id="5117182">eatAttrName</span><span class="op" id="5117193">(</span><span class="ident" id="5117194">s</span>&nbsp;<span class="op" id="5117196">[</span><span class="op" id="5117197">]</span><span class="builtintype" id="5117198">byte</span><span class="op" id="5117202">,</span>&nbsp;<span class="ident" id="5117204">i</span>&nbsp;<span class="builtintype" id="5117206">int</span><span class="op" id="5117209">)</span>&nbsp;<span class="op" id="5117211">(</span><span class="builtintype" id="5117212">int</span><span class="op" id="5117215">,</span>&nbsp;<span class="op" id="5117217">*</span><span class="ident" id="5117218">Error</span><span class="op" id="5117223">)</span>&nbsp;<span class="op" id="5117225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117228">for</span>&nbsp;<span class="ident" id="5117232">j</span>&nbsp;<span class="op" id="5117234">:=</span>&nbsp;<span class="ident" id="5117237">i</span><span class="op" id="5117238">;</span>&nbsp;<span class="ident" id="5117240">j</span>&nbsp;<span class="op" id="5117242">&lt;</span>&nbsp;<span class="builtinfunc" id="5117244">len</span><span class="op" id="5117247">(</span><span class="ident" id="5117248">s</span><span class="op" id="5117249">)</span><span class="op" id="5117250">;</span>&nbsp;<span class="ident" id="5117252">j</span><span class="op" id="5117253">++</span>&nbsp;<span class="op" id="5117256">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117260">switch</span>&nbsp;<span class="ident" id="5117267">s</span><span class="op" id="5117268">[</span><span class="ident" id="5117269">j</span><span class="op" id="5117270">]</span>&nbsp;<span class="op" id="5117272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117276">case</span>&nbsp;<span class="string" id="5117281">&#39;&nbsp;&#39;</span><span class="op" id="5117284">,</span>&nbsp;<span class="string" id="5117286">&#39;\t&#39;</span><span class="op" id="5117290">,</span>&nbsp;<span class="string" id="5117292">&#39;\n&#39;</span><span class="op" id="5117296">,</span>&nbsp;<span class="string" id="5117298">&#39;\f&#39;</span><span class="op" id="5117302">,</span>&nbsp;<span class="string" id="5117304">&#39;\r&#39;</span><span class="op" id="5117308">,</span>&nbsp;<span class="string" id="5117310">&#39;=&#39;</span><span class="op" id="5117313">,</span>&nbsp;<span class="string" id="5117315">&#39;&gt;&#39;</span><span class="op" id="5117318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117323">return</span>&nbsp;<span class="ident" id="5117330">j</span><span class="op" id="5117331">,</span>&nbsp;<span class="ident" id="5117333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117339">case</span>&nbsp;<span class="string" id="5117344">&#39;\&#39;&#39;</span><span class="op" id="5117348">,</span>&nbsp;<span class="string" id="5117350">&#39;&#34;&#39;</span><span class="op" id="5117353">,</span>&nbsp;<span class="string" id="5117355">&#39;&lt;&#39;</span><span class="op" id="5117358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117363">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117418">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117474">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117500">return</span>&nbsp;<span class="op" id="5117507">-</span><span class="num" id="5117508">1</span><span class="op" id="5117509">,</span>&nbsp;<span class="ident" id="5117511">errorf</span><span class="op" id="5117517">(</span><span class="ident" id="5117518">ErrBadHTML</span><span class="op" id="5117528">,</span>&nbsp;<span class="ident" id="5117530">nil</span><span class="op" id="5117533">,</span>&nbsp;<span class="num" id="5117535">0</span><span class="op" id="5117536">,</span>&nbsp;<span class="string" id="5117538">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5117567">,</span>&nbsp;<span class="ident" id="5117569">s</span><span class="op" id="5117570">[</span><span class="ident" id="5117571">j</span><span class="op" id="5117572">:</span><span class="ident" id="5117573">j</span><span class="op" id="5117574">+</span><span class="num" id="5117575">1</span><span class="op" id="5117576">]</span><span class="op" id="5117577">,</span>&nbsp;<span class="ident" id="5117579">s</span><span class="op" id="5117580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117584">default</span><span class="op" id="5117591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5117596">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5117611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117614">return</span>&nbsp;<span class="builtinfunc" id="5117621">len</span><span class="op" id="5117624">(</span><span class="ident" id="5117625">s</span><span class="op" id="5117626">)</span><span class="op" id="5117627">,</span>&nbsp;<span class="ident" id="5117629">nil</span><br>
<span class="lineno"></span><span class="op" id="5117633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5117636">var</span>&nbsp;<span class="ident" id="5117640">elementNameMap</span>&nbsp;<span class="op" id="5117655">=</span>&nbsp;<span class="keyword" id="5117657">map</span><span class="op" id="5117660">[</span><span class="builtintype" id="5117661">string</span><span class="op" id="5117667">]</span><span class="ident" id="5117668">element</span><span class="op" id="5117675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5117678">&#34;script&#34;</span><span class="op" id="5117686">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5117690">elementScript</span><span class="op" id="5117703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5117706">&#34;style&#34;</span><span class="op" id="5117713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117718">elementStyle</span><span class="op" id="5117730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5117733">&#34;textarea&#34;</span><span class="op" id="5117743">:</span>&nbsp;<span class="ident" id="5117745">elementTextarea</span><span class="op" id="5117760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5117763">&#34;title&#34;</span><span class="op" id="5117770">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117775">elementTitle</span><span class="op" id="5117787">,</span><br>
<span class="lineno">505</span><span class="op" id="5117789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5117792">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5117844">func</span>&nbsp;<span class="ident" id="5117849">asciiAlpha</span><span class="op" id="5117859">(</span><span class="ident" id="5117860">c</span>&nbsp;<span class="builtintype" id="5117862">byte</span><span class="op" id="5117866">)</span>&nbsp;<span class="builtintype" id="5117868">bool</span>&nbsp;<span class="op" id="5117873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5117876">return</span>&nbsp;<span class="string" id="5117883">&#39;A&#39;</span>&nbsp;<span class="op" id="5117887">&lt;=</span>&nbsp;<span class="ident" id="5117890">c</span>&nbsp;<span class="op" id="5117892">&amp;&amp;</span>&nbsp;<span class="ident" id="5117895">c</span>&nbsp;<span class="op" id="5117897">&lt;=</span>&nbsp;<span class="string" id="5117900">&#39;Z&#39;</span>&nbsp;<span class="op" id="5117904">||</span>&nbsp;<span class="string" id="5117907">&#39;a&#39;</span>&nbsp;<span class="op" id="5117911">&lt;=</span>&nbsp;<span class="ident" id="5117914">c</span>&nbsp;<span class="op" id="5117916">&amp;&amp;</span>&nbsp;<span class="ident" id="5117919">c</span>&nbsp;<span class="op" id="5117921">&lt;=</span>&nbsp;<span class="string" id="5117924">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5117928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5117931">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5117995">func</span>&nbsp;<span class="ident" id="5118000">asciiAlphaNum</span><span class="op" id="5118013">(</span><span class="ident" id="5118014">c</span>&nbsp;<span class="builtintype" id="5118016">byte</span><span class="op" id="5118020">)</span>&nbsp;<span class="builtintype" id="5118022">bool</span>&nbsp;<span class="op" id="5118027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118030">return</span>&nbsp;<span class="ident" id="5118037">asciiAlpha</span><span class="op" id="5118047">(</span><span class="ident" id="5118048">c</span><span class="op" id="5118049">)</span>&nbsp;<span class="op" id="5118051">||</span>&nbsp;<span class="string" id="5118054">&#39;0&#39;</span>&nbsp;<span class="op" id="5118058">&lt;=</span>&nbsp;<span class="ident" id="5118061">c</span>&nbsp;<span class="op" id="5118063">&amp;&amp;</span>&nbsp;<span class="ident" id="5118066">c</span>&nbsp;<span class="op" id="5118068">&lt;=</span>&nbsp;<span class="string" id="5118071">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5118075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5118078">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5118163">func</span>&nbsp;<span class="ident" id="5118168">eatTagName</span><span class="op" id="5118178">(</span><span class="ident" id="5118179">s</span>&nbsp;<span class="op" id="5118181">[</span><span class="op" id="5118182">]</span><span class="builtintype" id="5118183">byte</span><span class="op" id="5118187">,</span>&nbsp;<span class="ident" id="5118189">i</span>&nbsp;<span class="builtintype" id="5118191">int</span><span class="op" id="5118194">)</span>&nbsp;<span class="op" id="5118196">(</span><span class="builtintype" id="5118197">int</span><span class="op" id="5118200">,</span>&nbsp;<span class="ident" id="5118202">element</span><span class="op" id="5118209">)</span>&nbsp;<span class="op" id="5118211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118214">if</span>&nbsp;<span class="ident" id="5118217">i</span>&nbsp;<span class="op" id="5118219">==</span>&nbsp;<span class="builtinfunc" id="5118222">len</span><span class="op" id="5118225">(</span><span class="ident" id="5118226">s</span><span class="op" id="5118227">)</span>&nbsp;<span class="op" id="5118229">||</span>&nbsp;<span class="op" id="5118232">!</span><span class="ident" id="5118233">asciiAlpha</span><span class="op" id="5118243">(</span><span class="ident" id="5118244">s</span><span class="op" id="5118245">[</span><span class="ident" id="5118246">i</span><span class="op" id="5118247">]</span><span class="op" id="5118248">)</span>&nbsp;<span class="op" id="5118250">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118254">return</span>&nbsp;<span class="ident" id="5118261">i</span><span class="op" id="5118262">,</span>&nbsp;<span class="ident" id="5118264">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118280">j</span>&nbsp;<span class="op" id="5118282">:=</span>&nbsp;<span class="ident" id="5118285">i</span>&nbsp;<span class="op" id="5118287">+</span>&nbsp;<span class="num" id="5118289">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118292">for</span>&nbsp;<span class="ident" id="5118296">j</span>&nbsp;<span class="op" id="5118298">&lt;</span>&nbsp;<span class="builtinfunc" id="5118300">len</span><span class="op" id="5118303">(</span><span class="ident" id="5118304">s</span><span class="op" id="5118305">)</span>&nbsp;<span class="op" id="5118307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118311">x</span>&nbsp;<span class="op" id="5118313">:=</span>&nbsp;<span class="ident" id="5118316">s</span><span class="op" id="5118317">[</span><span class="ident" id="5118318">j</span><span class="op" id="5118319">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118323">if</span>&nbsp;<span class="ident" id="5118326">asciiAlphaNum</span><span class="op" id="5118339">(</span><span class="ident" id="5118340">x</span><span class="op" id="5118341">)</span>&nbsp;<span class="op" id="5118343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118348">j</span><span class="op" id="5118349">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118355">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5118370">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118427">if</span>&nbsp;<span class="op" id="5118430">(</span><span class="ident" id="5118431">x</span>&nbsp;<span class="op" id="5118433">==</span>&nbsp;<span class="string" id="5118436">&#39;:&#39;</span>&nbsp;<span class="op" id="5118440">||</span>&nbsp;<span class="ident" id="5118443">x</span>&nbsp;<span class="op" id="5118445">==</span>&nbsp;<span class="string" id="5118448">&#39;-&#39;</span><span class="op" id="5118451">)</span>&nbsp;<span class="op" id="5118453">&amp;&amp;</span>&nbsp;<span class="ident" id="5118456">j</span><span class="op" id="5118457">+</span><span class="num" id="5118458">1</span>&nbsp;<span class="op" id="5118460">&lt;</span>&nbsp;<span class="builtinfunc" id="5118462">len</span><span class="op" id="5118465">(</span><span class="ident" id="5118466">s</span><span class="op" id="5118467">)</span>&nbsp;<span class="op" id="5118469">&amp;&amp;</span>&nbsp;<span class="ident" id="5118472">asciiAlphaNum</span><span class="op" id="5118485">(</span><span class="ident" id="5118486">s</span><span class="op" id="5118487">[</span><span class="ident" id="5118488">j</span><span class="op" id="5118489">+</span><span class="num" id="5118490">1</span><span class="op" id="5118491">]</span><span class="op" id="5118492">)</span>&nbsp;<span class="op" id="5118494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5118499">j</span>&nbsp;<span class="op" id="5118501">+=</span>&nbsp;<span class="num" id="5118504">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118509">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118524">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118534">return</span>&nbsp;<span class="ident" id="5118541">j</span><span class="op" id="5118542">,</span>&nbsp;<span class="ident" id="5118544">elementNameMap</span><span class="op" id="5118558">[</span><span class="ident" id="5118559">strings</span><span class="op" id="5118566">.</span><span class="ident" id="5118567">ToLower</span><span class="op" id="5118574">(</span><span class="builtintype" id="5118575">string</span><span class="op" id="5118581">(</span><span class="ident" id="5118582">s</span><span class="op" id="5118583">[</span><span class="ident" id="5118584">i</span><span class="op" id="5118585">:</span><span class="ident" id="5118586">j</span><span class="op" id="5118587">]</span><span class="op" id="5118588">)</span><span class="op" id="5118589">)</span><span class="op" id="5118590">]</span><br>
<span class="lineno"></span><span class="op" id="5118592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5118595">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5118667">func</span>&nbsp;<span class="ident" id="5118672">eatWhiteSpace</span><span class="op" id="5118685">(</span><span class="ident" id="5118686">s</span>&nbsp;<span class="op" id="5118688">[</span><span class="op" id="5118689">]</span><span class="builtintype" id="5118690">byte</span><span class="op" id="5118694">,</span>&nbsp;<span class="ident" id="5118696">i</span>&nbsp;<span class="builtintype" id="5118698">int</span><span class="op" id="5118701">)</span>&nbsp;<span class="builtintype" id="5118703">int</span>&nbsp;<span class="op" id="5118707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118710">for</span>&nbsp;<span class="ident" id="5118714">j</span>&nbsp;<span class="op" id="5118716">:=</span>&nbsp;<span class="ident" id="5118719">i</span><span class="op" id="5118720">;</span>&nbsp;<span class="ident" id="5118722">j</span>&nbsp;<span class="op" id="5118724">&lt;</span>&nbsp;<span class="builtinfunc" id="5118726">len</span><span class="op" id="5118729">(</span><span class="ident" id="5118730">s</span><span class="op" id="5118731">)</span><span class="op" id="5118732">;</span>&nbsp;<span class="ident" id="5118734">j</span><span class="op" id="5118735">++</span>&nbsp;<span class="op" id="5118738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118742">switch</span>&nbsp;<span class="ident" id="5118749">s</span><span class="op" id="5118750">[</span><span class="ident" id="5118751">j</span><span class="op" id="5118752">]</span>&nbsp;<span class="op" id="5118754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118758">case</span>&nbsp;<span class="string" id="5118763">&#39;&nbsp;&#39;</span><span class="op" id="5118766">,</span>&nbsp;<span class="string" id="5118768">&#39;\t&#39;</span><span class="op" id="5118772">,</span>&nbsp;<span class="string" id="5118774">&#39;\n&#39;</span><span class="op" id="5118778">,</span>&nbsp;<span class="string" id="5118780">&#39;\f&#39;</span><span class="op" id="5118784">,</span>&nbsp;<span class="string" id="5118786">&#39;\r&#39;</span><span class="op" id="5118790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5118795">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118807">default</span><span class="op" id="5118814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118819">return</span>&nbsp;<span class="ident" id="5118826">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5118833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5118836">return</span>&nbsp;<span class="builtinfunc" id="5118843">len</span><span class="op" id="5118846">(</span><span class="ident" id="5118847">s</span><span class="op" id="5118848">)</span><br>
<span class="lineno">550</span><span class="op" id="5118850">}</span>
</div>
</body>
</html>
