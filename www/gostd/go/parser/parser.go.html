<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html" class="current">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4465601">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4465656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4465710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4465761">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4465833">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4465907">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4465982">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4466040">//</span><br>
<span class="lineno">10</span><span class="keyword" id="4466043">package</span>&nbsp;<span class="ident" id="4466051">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4466059">import</span>&nbsp;<span class="op" id="4466066">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466069">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466076">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466086">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466100">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466112">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466123">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4466134">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4466144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4466147">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4466206">type</span>&nbsp;<span class="ident" id="4466211">parser</span>&nbsp;<span class="keyword" id="4466218">struct</span>&nbsp;<span class="op" id="4466225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466228">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4466236">*</span><span class="ident" id="4466237">token</span><span class="op" id="4466242">.</span><span class="ident" id="4466243">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466249">errors</span>&nbsp;&nbsp;<span class="ident" id="4466257">scanner</span><span class="op" id="4466264">.</span><span class="ident" id="4466265">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466276">scanner</span>&nbsp;<span class="ident" id="4466284">scanner</span><span class="op" id="4466291">.</span><span class="ident" id="4466292">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466302">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466324">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4466331">Mode</span>&nbsp;<span class="comment" id="4466336">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466353">trace</span>&nbsp;&nbsp;<span class="builtintype" id="4466360">bool</span>&nbsp;<span class="comment" id="4466365">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466392">indent</span>&nbsp;<span class="builtintype" id="4466399">int</span>&nbsp;&nbsp;<span class="comment" id="4466404">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466445">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466458">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4466470">[</span><span class="op" id="4466471">]</span><span class="op" id="4466472">*</span><span class="ident" id="4466473">ast</span><span class="op" id="4466476">.</span><span class="ident" id="4466477">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466491">leadComment</span>&nbsp;<span class="op" id="4466503">*</span><span class="ident" id="4466504">ast</span><span class="op" id="4466507">.</span><span class="ident" id="4466508">CommentGroup</span>&nbsp;<span class="comment" id="4466521">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466543">lineComment</span>&nbsp;<span class="op" id="4466555">*</span><span class="ident" id="4466556">ast</span><span class="op" id="4466559">.</span><span class="ident" id="4466560">CommentGroup</span>&nbsp;<span class="comment" id="4466573">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466596">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466611">pos</span>&nbsp;<span class="ident" id="4466615">token</span><span class="op" id="4466620">.</span><span class="ident" id="4466621">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4466627">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466646">tok</span>&nbsp;<span class="ident" id="4466650">token</span><span class="op" id="4466655">.</span><span class="ident" id="4466656">Token</span>&nbsp;<span class="comment" id="4466662">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466687">lit</span>&nbsp;<span class="builtintype" id="4466691">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466703">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466722">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466741">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466801">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466861">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466927">syncPos</span>&nbsp;<span class="ident" id="4466935">token</span><span class="op" id="4466940">.</span><span class="ident" id="4466941">Pos</span>&nbsp;<span class="comment" id="4466945">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4466979">syncCnt</span>&nbsp;<span class="builtintype" id="4466987">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4466997">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467046">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467079">exprLev</span>&nbsp;<span class="builtintype" id="4467087">int</span>&nbsp;&nbsp;<span class="comment" id="4467092">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467140">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4467148">bool</span>&nbsp;<span class="comment" id="4467153">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467205">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467236">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4467247">*</span><span class="ident" id="4467248">ast</span><span class="op" id="4467251">.</span><span class="ident" id="4467252">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467265">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467291">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4467302">*</span><span class="ident" id="4467303">ast</span><span class="op" id="4467306">.</span><span class="ident" id="4467307">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467320">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467356">unresolved</span>&nbsp;<span class="op" id="4467367">[</span><span class="op" id="4467368">]</span><span class="op" id="4467369">*</span><span class="ident" id="4467370">ast</span><span class="op" id="4467373">.</span><span class="ident" id="4467374">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467385">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467412">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4467423">[</span><span class="op" id="4467424">]</span><span class="op" id="4467425">*</span><span class="ident" id="4467426">ast</span><span class="op" id="4467429">.</span><span class="ident" id="4467430">ImportSpec</span>&nbsp;<span class="comment" id="4467441">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467462">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467479">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467521">labelScope</span>&nbsp;&nbsp;<span class="op" id="4467533">*</span><span class="ident" id="4467534">ast</span><span class="op" id="4467537">.</span><span class="ident" id="4467538">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4467548">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467585">targetStack</span>&nbsp;<span class="op" id="4467597">[</span><span class="op" id="4467598">]</span><span class="op" id="4467599">[</span><span class="op" id="4467600">]</span><span class="op" id="4467601">*</span><span class="ident" id="4467602">ast</span><span class="op" id="4467605">.</span><span class="ident" id="4467606">Ident</span>&nbsp;<span class="comment" id="4467612">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="4467642">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4467645">func</span>&nbsp;<span class="op" id="4467650">(</span><span class="ident" id="4467651">p</span>&nbsp;<span class="op" id="4467653">*</span><span class="ident" id="4467654">parser</span><span class="op" id="4467660">)</span>&nbsp;<span class="ident" id="4467662">init</span><span class="op" id="4467666">(</span><span class="ident" id="4467667">fset</span>&nbsp;<span class="op" id="4467672">*</span><span class="ident" id="4467673">token</span><span class="op" id="4467678">.</span><span class="ident" id="4467679">FileSet</span><span class="op" id="4467686">,</span>&nbsp;<span class="ident" id="4467688">filename</span>&nbsp;<span class="builtintype" id="4467697">string</span><span class="op" id="4467703">,</span>&nbsp;<span class="ident" id="4467705">src</span>&nbsp;<span class="op" id="4467709">[</span><span class="op" id="4467710">]</span><span class="builtintype" id="4467711">byte</span><span class="op" id="4467715">,</span>&nbsp;<span class="ident" id="4467717">mode</span>&nbsp;<span class="ident" id="4467722">Mode</span><span class="op" id="4467726">)</span>&nbsp;<span class="op" id="4467728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467731">p</span><span class="op" id="4467732">.</span><span class="ident" id="4467733">file</span>&nbsp;<span class="op" id="4467738">=</span>&nbsp;<span class="ident" id="4467740">fset</span><span class="op" id="4467744">.</span><span class="ident" id="4467745">AddFile</span><span class="op" id="4467752">(</span><span class="ident" id="4467753">filename</span><span class="op" id="4467761">,</span>&nbsp;<span class="op" id="4467763">-</span><span class="num" id="4467764">1</span><span class="op" id="4467765">,</span>&nbsp;<span class="builtinfunc" id="4467767">len</span><span class="op" id="4467770">(</span><span class="ident" id="4467771">src</span><span class="op" id="4467774">)</span><span class="op" id="4467775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4467778">var</span>&nbsp;<span class="ident" id="4467782">m</span>&nbsp;<span class="ident" id="4467784">scanner</span><span class="op" id="4467791">.</span><span class="ident" id="4467792">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4467798">if</span>&nbsp;<span class="ident" id="4467801">mode</span><span class="op" id="4467805">&amp;</span><span class="ident" id="4467806">ParseComments</span>&nbsp;<span class="op" id="4467820">!=</span>&nbsp;<span class="num" id="4467823">0</span>&nbsp;<span class="op" id="4467825">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467829">m</span>&nbsp;<span class="op" id="4467831">=</span>&nbsp;<span class="ident" id="4467833">scanner</span><span class="op" id="4467840">.</span><span class="ident" id="4467841">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4467855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467858">eh</span>&nbsp;<span class="op" id="4467861">:=</span>&nbsp;<span class="keyword" id="4467864">func</span><span class="op" id="4467868">(</span><span class="ident" id="4467869">pos</span>&nbsp;<span class="ident" id="4467873">token</span><span class="op" id="4467878">.</span><span class="ident" id="4467879">Position</span><span class="op" id="4467887">,</span>&nbsp;<span class="ident" id="4467889">msg</span>&nbsp;<span class="builtintype" id="4467893">string</span><span class="op" id="4467899">)</span>&nbsp;<span class="op" id="4467901">{</span>&nbsp;<span class="ident" id="4467903">p</span><span class="op" id="4467904">.</span><span class="ident" id="4467905">errors</span><span class="op" id="4467911">.</span><span class="ident" id="4467912">Add</span><span class="op" id="4467915">(</span><span class="ident" id="4467916">pos</span><span class="op" id="4467919">,</span>&nbsp;<span class="ident" id="4467921">msg</span><span class="op" id="4467924">)</span>&nbsp;<span class="op" id="4467926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467929">p</span><span class="op" id="4467930">.</span><span class="ident" id="4467931">scanner</span><span class="op" id="4467938">.</span><span class="ident" id="4467939">Init</span><span class="op" id="4467943">(</span><span class="ident" id="4467944">p</span><span class="op" id="4467945">.</span><span class="ident" id="4467946">file</span><span class="op" id="4467950">,</span>&nbsp;<span class="ident" id="4467952">src</span><span class="op" id="4467955">,</span>&nbsp;<span class="ident" id="4467957">eh</span><span class="op" id="4467959">,</span>&nbsp;<span class="ident" id="4467961">m</span><span class="op" id="4467962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467966">p</span><span class="op" id="4467967">.</span><span class="ident" id="4467968">mode</span>&nbsp;<span class="op" id="4467973">=</span>&nbsp;<span class="ident" id="4467975">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467981">p</span><span class="op" id="4467982">.</span><span class="ident" id="4467983">trace</span>&nbsp;<span class="op" id="4467989">=</span>&nbsp;<span class="ident" id="4467991">mode</span><span class="op" id="4467995">&amp;</span><span class="ident" id="4467996">Trace</span>&nbsp;<span class="op" id="4468002">!=</span>&nbsp;<span class="num" id="4468005">0</span>&nbsp;<span class="comment" id="4468007">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468057">p</span><span class="op" id="4468058">.</span><span class="ident" id="4468059">next</span><span class="op" id="4468063">(</span><span class="op" id="4468064">)</span><br>
<span class="lineno"></span><span class="op" id="4468066">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4468069">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4468149">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468169">func</span>&nbsp;<span class="op" id="4468174">(</span><span class="ident" id="4468175">p</span>&nbsp;<span class="op" id="4468177">*</span><span class="ident" id="4468178">parser</span><span class="op" id="4468184">)</span>&nbsp;<span class="ident" id="4468186">openScope</span><span class="op" id="4468195">(</span><span class="op" id="4468196">)</span>&nbsp;<span class="op" id="4468198">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468201">p</span><span class="op" id="4468202">.</span><span class="ident" id="4468203">topScope</span>&nbsp;<span class="op" id="4468212">=</span>&nbsp;<span class="ident" id="4468214">ast</span><span class="op" id="4468217">.</span><span class="ident" id="4468218">NewScope</span><span class="op" id="4468226">(</span><span class="ident" id="4468227">p</span><span class="op" id="4468228">.</span><span class="ident" id="4468229">topScope</span><span class="op" id="4468237">)</span><br>
<span class="lineno"></span><span class="op" id="4468239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468242">func</span>&nbsp;<span class="op" id="4468247">(</span><span class="ident" id="4468248">p</span>&nbsp;<span class="op" id="4468250">*</span><span class="ident" id="4468251">parser</span><span class="op" id="4468257">)</span>&nbsp;<span class="ident" id="4468259">closeScope</span><span class="op" id="4468269">(</span><span class="op" id="4468270">)</span>&nbsp;<span class="op" id="4468272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468275">p</span><span class="op" id="4468276">.</span><span class="ident" id="4468277">topScope</span>&nbsp;<span class="op" id="4468286">=</span>&nbsp;<span class="ident" id="4468288">p</span><span class="op" id="4468289">.</span><span class="ident" id="4468290">topScope</span><span class="op" id="4468298">.</span><span class="ident" id="4468299">Outer</span><br>
<span class="lineno">90</span><span class="op" id="4468305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468308">func</span>&nbsp;<span class="op" id="4468313">(</span><span class="ident" id="4468314">p</span>&nbsp;<span class="op" id="4468316">*</span><span class="ident" id="4468317">parser</span><span class="op" id="4468323">)</span>&nbsp;<span class="ident" id="4468325">openLabelScope</span><span class="op" id="4468339">(</span><span class="op" id="4468340">)</span>&nbsp;<span class="op" id="4468342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468345">p</span><span class="op" id="4468346">.</span><span class="ident" id="4468347">labelScope</span>&nbsp;<span class="op" id="4468358">=</span>&nbsp;<span class="ident" id="4468360">ast</span><span class="op" id="4468363">.</span><span class="ident" id="4468364">NewScope</span><span class="op" id="4468372">(</span><span class="ident" id="4468373">p</span><span class="op" id="4468374">.</span><span class="ident" id="4468375">labelScope</span><span class="op" id="4468385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468388">p</span><span class="op" id="4468389">.</span><span class="ident" id="4468390">targetStack</span>&nbsp;<span class="op" id="4468402">=</span>&nbsp;<span class="builtinfunc" id="4468404">append</span><span class="op" id="4468410">(</span><span class="ident" id="4468411">p</span><span class="op" id="4468412">.</span><span class="ident" id="4468413">targetStack</span><span class="op" id="4468424">,</span>&nbsp;<span class="ident" id="4468426">nil</span><span class="op" id="4468429">)</span><br>
<span class="lineno">95</span><span class="op" id="4468431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468434">func</span>&nbsp;<span class="op" id="4468439">(</span><span class="ident" id="4468440">p</span>&nbsp;<span class="op" id="4468442">*</span><span class="ident" id="4468443">parser</span><span class="op" id="4468449">)</span>&nbsp;<span class="ident" id="4468451">closeLabelScope</span><span class="op" id="4468466">(</span><span class="op" id="4468467">)</span>&nbsp;<span class="op" id="4468469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468472">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468491">n</span>&nbsp;<span class="op" id="4468493">:=</span>&nbsp;<span class="builtinfunc" id="4468496">len</span><span class="op" id="4468499">(</span><span class="ident" id="4468500">p</span><span class="op" id="4468501">.</span><span class="ident" id="4468502">targetStack</span><span class="op" id="4468513">)</span>&nbsp;<span class="op" id="4468515">-</span>&nbsp;<span class="num" id="4468517">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468520">scope</span>&nbsp;<span class="op" id="4468526">:=</span>&nbsp;<span class="ident" id="4468529">p</span><span class="op" id="4468530">.</span><span class="ident" id="4468531">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4468543">for</span>&nbsp;<span class="ident" id="4468547">_</span><span class="op" id="4468548">,</span>&nbsp;<span class="ident" id="4468550">ident</span>&nbsp;<span class="op" id="4468556">:=</span>&nbsp;<span class="keyword" id="4468559">range</span>&nbsp;<span class="ident" id="4468565">p</span><span class="op" id="4468566">.</span><span class="ident" id="4468567">targetStack</span><span class="op" id="4468578">[</span><span class="ident" id="4468579">n</span><span class="op" id="4468580">]</span>&nbsp;<span class="op" id="4468582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468586">ident</span><span class="op" id="4468591">.</span><span class="ident" id="4468592">Obj</span>&nbsp;<span class="op" id="4468596">=</span>&nbsp;<span class="ident" id="4468598">scope</span><span class="op" id="4468603">.</span><span class="ident" id="4468604">Lookup</span><span class="op" id="4468610">(</span><span class="ident" id="4468611">ident</span><span class="op" id="4468616">.</span><span class="ident" id="4468617">Name</span><span class="op" id="4468621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4468625">if</span>&nbsp;<span class="ident" id="4468628">ident</span><span class="op" id="4468633">.</span><span class="ident" id="4468634">Obj</span>&nbsp;<span class="op" id="4468638">==</span>&nbsp;<span class="ident" id="4468641">nil</span>&nbsp;<span class="op" id="4468645">&amp;&amp;</span>&nbsp;<span class="ident" id="4468648">p</span><span class="op" id="4468649">.</span><span class="ident" id="4468650">mode</span><span class="op" id="4468654">&amp;</span><span class="ident" id="4468655">DeclarationErrors</span>&nbsp;<span class="op" id="4468673">!=</span>&nbsp;<span class="num" id="4468676">0</span>&nbsp;<span class="op" id="4468678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468683">p</span><span class="op" id="4468684">.</span><span class="builtintype" id="4468685">error</span><span class="op" id="4468690">(</span><span class="ident" id="4468691">ident</span><span class="op" id="4468696">.</span><span class="ident" id="4468697">Pos</span><span class="op" id="4468700">(</span><span class="op" id="4468701">)</span><span class="op" id="4468702">,</span>&nbsp;<span class="ident" id="4468704">fmt</span><span class="op" id="4468707">.</span><span class="ident" id="4468708">Sprintf</span><span class="op" id="4468715">(</span><span class="string" id="4468716">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="4468736">,</span>&nbsp;<span class="ident" id="4468738">ident</span><span class="op" id="4468743">.</span><span class="ident" id="4468744">Name</span><span class="op" id="4468748">)</span><span class="op" id="4468749">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4468753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4468756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468759">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468779">p</span><span class="op" id="4468780">.</span><span class="ident" id="4468781">targetStack</span>&nbsp;<span class="op" id="4468793">=</span>&nbsp;<span class="ident" id="4468795">p</span><span class="op" id="4468796">.</span><span class="ident" id="4468797">targetStack</span><span class="op" id="4468808">[</span><span class="num" id="4468809">0</span><span class="op" id="4468810">:</span><span class="ident" id="4468811">n</span><span class="op" id="4468812">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468815">p</span><span class="op" id="4468816">.</span><span class="ident" id="4468817">labelScope</span>&nbsp;<span class="op" id="4468828">=</span>&nbsp;<span class="ident" id="4468830">p</span><span class="op" id="4468831">.</span><span class="ident" id="4468832">labelScope</span><span class="op" id="4468842">.</span><span class="ident" id="4468843">Outer</span><br>
<span class="lineno">110</span><span class="op" id="4468849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468852">func</span>&nbsp;<span class="op" id="4468857">(</span><span class="ident" id="4468858">p</span>&nbsp;<span class="op" id="4468860">*</span><span class="ident" id="4468861">parser</span><span class="op" id="4468867">)</span>&nbsp;<span class="ident" id="4468869">declare</span><span class="op" id="4468876">(</span><span class="ident" id="4468877">decl</span><span class="op" id="4468881">,</span>&nbsp;<span class="ident" id="4468883">data</span>&nbsp;<span class="keyword" id="4468888">interface</span><span class="op" id="4468897">{</span><span class="op" id="4468898">}</span><span class="op" id="4468899">,</span>&nbsp;<span class="ident" id="4468901">scope</span>&nbsp;<span class="op" id="4468907">*</span><span class="ident" id="4468908">ast</span><span class="op" id="4468911">.</span><span class="ident" id="4468912">Scope</span><span class="op" id="4468917">,</span>&nbsp;<span class="ident" id="4468919">kind</span>&nbsp;<span class="ident" id="4468924">ast</span><span class="op" id="4468927">.</span><span class="ident" id="4468928">ObjKind</span><span class="op" id="4468935">,</span>&nbsp;<span class="ident" id="4468937">idents</span>&nbsp;<span class="op" id="4468944">...</span><span class="op" id="4468947">*</span><span class="ident" id="4468948">ast</span><span class="op" id="4468951">.</span><span class="ident" id="4468952">Ident</span><span class="op" id="4468957">)</span>&nbsp;<span class="op" id="4468959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4468962">for</span>&nbsp;<span class="ident" id="4468966">_</span><span class="op" id="4468967">,</span>&nbsp;<span class="ident" id="4468969">ident</span>&nbsp;<span class="op" id="4468975">:=</span>&nbsp;<span class="keyword" id="4468978">range</span>&nbsp;<span class="ident" id="4468984">idents</span>&nbsp;<span class="op" id="4468991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468995">assert</span><span class="op" id="4469001">(</span><span class="ident" id="4469002">ident</span><span class="op" id="4469007">.</span><span class="ident" id="4469008">Obj</span>&nbsp;<span class="op" id="4469012">==</span>&nbsp;<span class="ident" id="4469015">nil</span><span class="op" id="4469018">,</span>&nbsp;<span class="string" id="4469020">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4469061">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469065">obj</span>&nbsp;<span class="op" id="4469069">:=</span>&nbsp;<span class="ident" id="4469072">ast</span><span class="op" id="4469075">.</span><span class="ident" id="4469076">NewObj</span><span class="op" id="4469082">(</span><span class="ident" id="4469083">kind</span><span class="op" id="4469087">,</span>&nbsp;<span class="ident" id="4469089">ident</span><span class="op" id="4469094">.</span><span class="ident" id="4469095">Name</span><span class="op" id="4469099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469103">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469165">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469227">obj</span><span class="op" id="4469230">.</span><span class="ident" id="4469231">Decl</span>&nbsp;<span class="op" id="4469236">=</span>&nbsp;<span class="ident" id="4469238">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469245">obj</span><span class="op" id="4469248">.</span><span class="ident" id="4469249">Data</span>&nbsp;<span class="op" id="4469254">=</span>&nbsp;<span class="ident" id="4469256">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469263">ident</span><span class="op" id="4469268">.</span><span class="ident" id="4469269">Obj</span>&nbsp;<span class="op" id="4469273">=</span>&nbsp;<span class="ident" id="4469275">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469281">if</span>&nbsp;<span class="ident" id="4469284">ident</span><span class="op" id="4469289">.</span><span class="ident" id="4469290">Name</span>&nbsp;<span class="op" id="4469295">!=</span>&nbsp;<span class="string" id="4469298">&#34;_&#34;</span>&nbsp;<span class="op" id="4469302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469307">if</span>&nbsp;<span class="ident" id="4469310">alt</span>&nbsp;<span class="op" id="4469314">:=</span>&nbsp;<span class="ident" id="4469317">scope</span><span class="op" id="4469322">.</span><span class="ident" id="4469323">Insert</span><span class="op" id="4469329">(</span><span class="ident" id="4469330">obj</span><span class="op" id="4469333">)</span><span class="op" id="4469334">;</span>&nbsp;<span class="ident" id="4469336">alt</span>&nbsp;<span class="op" id="4469340">!=</span>&nbsp;<span class="ident" id="4469343">nil</span>&nbsp;<span class="op" id="4469347">&amp;&amp;</span>&nbsp;<span class="ident" id="4469350">p</span><span class="op" id="4469351">.</span><span class="ident" id="4469352">mode</span><span class="op" id="4469356">&amp;</span><span class="ident" id="4469357">DeclarationErrors</span>&nbsp;<span class="op" id="4469375">!=</span>&nbsp;<span class="num" id="4469378">0</span>&nbsp;<span class="op" id="4469380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469386">prevDecl</span>&nbsp;<span class="op" id="4469395">:=</span>&nbsp;<span class="string" id="4469398">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469405">if</span>&nbsp;<span class="ident" id="4469408">pos</span>&nbsp;<span class="op" id="4469412">:=</span>&nbsp;<span class="ident" id="4469415">alt</span><span class="op" id="4469418">.</span><span class="ident" id="4469419">Pos</span><span class="op" id="4469422">(</span><span class="op" id="4469423">)</span><span class="op" id="4469424">;</span>&nbsp;<span class="ident" id="4469426">pos</span><span class="op" id="4469429">.</span><span class="ident" id="4469430">IsValid</span><span class="op" id="4469437">(</span><span class="op" id="4469438">)</span>&nbsp;<span class="op" id="4469440">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469447">prevDecl</span>&nbsp;<span class="op" id="4469456">=</span>&nbsp;<span class="ident" id="4469458">fmt</span><span class="op" id="4469461">.</span><span class="ident" id="4469462">Sprintf</span><span class="op" id="4469469">(</span><span class="string" id="4469470">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="4469502">,</span>&nbsp;<span class="ident" id="4469504">p</span><span class="op" id="4469505">.</span><span class="ident" id="4469506">file</span><span class="op" id="4469510">.</span><span class="ident" id="4469511">Position</span><span class="op" id="4469519">(</span><span class="ident" id="4469520">pos</span><span class="op" id="4469523">)</span><span class="op" id="4469524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469536">p</span><span class="op" id="4469537">.</span><span class="builtintype" id="4469538">error</span><span class="op" id="4469543">(</span><span class="ident" id="4469544">ident</span><span class="op" id="4469549">.</span><span class="ident" id="4469550">Pos</span><span class="op" id="4469553">(</span><span class="op" id="4469554">)</span><span class="op" id="4469555">,</span>&nbsp;<span class="ident" id="4469557">fmt</span><span class="op" id="4469560">.</span><span class="ident" id="4469561">Sprintf</span><span class="op" id="4469568">(</span><span class="string" id="4469569">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="4469600">,</span>&nbsp;<span class="ident" id="4469602">ident</span><span class="op" id="4469607">.</span><span class="ident" id="4469608">Name</span><span class="op" id="4469612">,</span>&nbsp;<span class="ident" id="4469614">prevDecl</span><span class="op" id="4469622">)</span><span class="op" id="4469623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469632">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469635">}</span><br>
<span class="lineno"></span><span class="op" id="4469637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4469640">func</span>&nbsp;<span class="op" id="4469645">(</span><span class="ident" id="4469646">p</span>&nbsp;<span class="op" id="4469648">*</span><span class="ident" id="4469649">parser</span><span class="op" id="4469655">)</span>&nbsp;<span class="ident" id="4469657">shortVarDecl</span><span class="op" id="4469669">(</span><span class="ident" id="4469670">decl</span>&nbsp;<span class="op" id="4469675">*</span><span class="ident" id="4469676">ast</span><span class="op" id="4469679">.</span><span class="ident" id="4469680">AssignStmt</span><span class="op" id="4469690">,</span>&nbsp;<span class="ident" id="4469692">list</span>&nbsp;<span class="op" id="4469697">[</span><span class="op" id="4469698">]</span><span class="ident" id="4469699">ast</span><span class="op" id="4469702">.</span><span class="ident" id="4469703">Expr</span><span class="op" id="4469707">)</span>&nbsp;<span class="op" id="4469709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469712">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469778">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469844">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469915">n</span>&nbsp;<span class="op" id="4469917">:=</span>&nbsp;<span class="num" id="4469920">0</span>&nbsp;<span class="comment" id="4469922">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469950">for</span>&nbsp;<span class="ident" id="4469954">_</span><span class="op" id="4469955">,</span>&nbsp;<span class="ident" id="4469957">x</span>&nbsp;<span class="op" id="4469959">:=</span>&nbsp;<span class="keyword" id="4469962">range</span>&nbsp;<span class="ident" id="4469968">list</span>&nbsp;<span class="op" id="4469973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469977">if</span>&nbsp;<span class="ident" id="4469980">ident</span><span class="op" id="4469985">,</span>&nbsp;<span class="ident" id="4469987">isIdent</span>&nbsp;<span class="op" id="4469995">:=</span>&nbsp;<span class="ident" id="4469998">x</span><span class="op" id="4469999">.</span><span class="op" id="4470000">(</span><span class="op" id="4470001">*</span><span class="ident" id="4470002">ast</span><span class="op" id="4470005">.</span><span class="ident" id="4470006">Ident</span><span class="op" id="4470011">)</span><span class="op" id="4470012">;</span>&nbsp;<span class="ident" id="4470014">isIdent</span>&nbsp;<span class="op" id="4470022">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470027">assert</span><span class="op" id="4470033">(</span><span class="ident" id="4470034">ident</span><span class="op" id="4470039">.</span><span class="ident" id="4470040">Obj</span>&nbsp;<span class="op" id="4470044">==</span>&nbsp;<span class="ident" id="4470047">nil</span><span class="op" id="4470050">,</span>&nbsp;<span class="string" id="4470052">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4470093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470098">obj</span>&nbsp;<span class="op" id="4470102">:=</span>&nbsp;<span class="ident" id="4470105">ast</span><span class="op" id="4470108">.</span><span class="ident" id="4470109">NewObj</span><span class="op" id="4470115">(</span><span class="ident" id="4470116">ast</span><span class="op" id="4470119">.</span><span class="ident" id="4470120">Var</span><span class="op" id="4470123">,</span>&nbsp;<span class="ident" id="4470125">ident</span><span class="op" id="4470130">.</span><span class="ident" id="4470131">Name</span><span class="op" id="4470135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470140">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470196">obj</span><span class="op" id="4470199">.</span><span class="ident" id="4470200">Decl</span>&nbsp;<span class="op" id="4470205">=</span>&nbsp;<span class="ident" id="4470207">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470215">ident</span><span class="op" id="4470220">.</span><span class="ident" id="4470221">Obj</span>&nbsp;<span class="op" id="4470225">=</span>&nbsp;<span class="ident" id="4470227">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470234">if</span>&nbsp;<span class="ident" id="4470237">ident</span><span class="op" id="4470242">.</span><span class="ident" id="4470243">Name</span>&nbsp;<span class="op" id="4470248">!=</span>&nbsp;<span class="string" id="4470251">&#34;_&#34;</span>&nbsp;<span class="op" id="4470255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470261">if</span>&nbsp;<span class="ident" id="4470264">alt</span>&nbsp;<span class="op" id="4470268">:=</span>&nbsp;<span class="ident" id="4470271">p</span><span class="op" id="4470272">.</span><span class="ident" id="4470273">topScope</span><span class="op" id="4470281">.</span><span class="ident" id="4470282">Insert</span><span class="op" id="4470288">(</span><span class="ident" id="4470289">obj</span><span class="op" id="4470292">)</span><span class="op" id="4470293">;</span>&nbsp;<span class="ident" id="4470295">alt</span>&nbsp;<span class="op" id="4470299">!=</span>&nbsp;<span class="ident" id="4470302">nil</span>&nbsp;<span class="op" id="4470306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470313">ident</span><span class="op" id="4470318">.</span><span class="ident" id="4470319">Obj</span>&nbsp;<span class="op" id="4470323">=</span>&nbsp;<span class="ident" id="4470325">alt</span>&nbsp;<span class="comment" id="4470329">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470350">}</span>&nbsp;<span class="keyword" id="4470352">else</span>&nbsp;<span class="op" id="4470357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470364">n</span><span class="op" id="4470365">++</span>&nbsp;<span class="comment" id="4470368">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470400">}</span>&nbsp;<span class="keyword" id="4470402">else</span>&nbsp;<span class="op" id="4470407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470412">p</span><span class="op" id="4470413">.</span><span class="ident" id="4470414">errorExpected</span><span class="op" id="4470427">(</span><span class="ident" id="4470428">x</span><span class="op" id="4470429">.</span><span class="ident" id="4470430">Pos</span><span class="op" id="4470433">(</span><span class="op" id="4470434">)</span><span class="op" id="4470435">,</span>&nbsp;<span class="string" id="4470437">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4470468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470472">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470478">if</span>&nbsp;<span class="ident" id="4470481">n</span>&nbsp;<span class="op" id="4470483">==</span>&nbsp;<span class="num" id="4470486">0</span>&nbsp;<span class="op" id="4470488">&amp;&amp;</span>&nbsp;<span class="ident" id="4470491">p</span><span class="op" id="4470492">.</span><span class="ident" id="4470493">mode</span><span class="op" id="4470497">&amp;</span><span class="ident" id="4470498">DeclarationErrors</span>&nbsp;<span class="op" id="4470516">!=</span>&nbsp;<span class="num" id="4470519">0</span>&nbsp;<span class="op" id="4470521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470525">p</span><span class="op" id="4470526">.</span><span class="builtintype" id="4470527">error</span><span class="op" id="4470532">(</span><span class="ident" id="4470533">list</span><span class="op" id="4470537">[</span><span class="num" id="4470538">0</span><span class="op" id="4470539">]</span><span class="op" id="4470540">.</span><span class="ident" id="4470541">Pos</span><span class="op" id="4470544">(</span><span class="op" id="4470545">)</span><span class="op" id="4470546">,</span>&nbsp;<span class="string" id="4470548">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4470585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470588">}</span><br>
<span class="lineno"></span><span class="op" id="4470590">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="4470593">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4470673">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="4470755">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="4470780">var</span>&nbsp;<span class="ident" id="4470784">unresolved</span>&nbsp;<span class="op" id="4470795">=</span>&nbsp;<span class="builtinfunc" id="4470797">new</span><span class="op" id="4470800">(</span><span class="ident" id="4470801">ast</span><span class="op" id="4470804">.</span><span class="ident" id="4470805">Object</span><span class="op" id="4470811">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4470814">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4470887">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4470960">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="4471034">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="4471050">//</span><br>
<span class="lineno"></span><span class="keyword" id="4471053">func</span>&nbsp;<span class="op" id="4471058">(</span><span class="ident" id="4471059">p</span>&nbsp;<span class="op" id="4471061">*</span><span class="ident" id="4471062">parser</span><span class="op" id="4471068">)</span>&nbsp;<span class="ident" id="4471070">tryResolve</span><span class="op" id="4471080">(</span><span class="ident" id="4471081">x</span>&nbsp;<span class="ident" id="4471083">ast</span><span class="op" id="4471086">.</span><span class="ident" id="4471087">Expr</span><span class="op" id="4471091">,</span>&nbsp;<span class="ident" id="4471093">collectUnresolved</span>&nbsp;<span class="builtintype" id="4471111">bool</span><span class="op" id="4471115">)</span>&nbsp;<span class="op" id="4471117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471120">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471188">ident</span><span class="op" id="4471193">,</span>&nbsp;<span class="ident" id="4471195">_</span>&nbsp;<span class="op" id="4471197">:=</span>&nbsp;<span class="ident" id="4471200">x</span><span class="op" id="4471201">.</span><span class="op" id="4471202">(</span><span class="op" id="4471203">*</span><span class="ident" id="4471204">ast</span><span class="op" id="4471207">.</span><span class="ident" id="4471208">Ident</span><span class="op" id="4471213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471216">if</span>&nbsp;<span class="ident" id="4471219">ident</span>&nbsp;<span class="op" id="4471225">==</span>&nbsp;<span class="ident" id="4471228">nil</span>&nbsp;<span class="op" id="4471232">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471236">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471247">assert</span><span class="op" id="4471253">(</span><span class="ident" id="4471254">ident</span><span class="op" id="4471259">.</span><span class="ident" id="4471260">Obj</span>&nbsp;<span class="op" id="4471264">==</span>&nbsp;<span class="ident" id="4471267">nil</span><span class="op" id="4471270">,</span>&nbsp;<span class="string" id="4471272">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4471313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471316">if</span>&nbsp;<span class="ident" id="4471319">ident</span><span class="op" id="4471324">.</span><span class="ident" id="4471325">Name</span>&nbsp;<span class="op" id="4471330">==</span>&nbsp;<span class="string" id="4471333">&#34;_&#34;</span>&nbsp;<span class="op" id="4471337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471341">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471352">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471386">for</span>&nbsp;<span class="ident" id="4471390">s</span>&nbsp;<span class="op" id="4471392">:=</span>&nbsp;<span class="ident" id="4471395">p</span><span class="op" id="4471396">.</span><span class="ident" id="4471397">topScope</span><span class="op" id="4471405">;</span>&nbsp;<span class="ident" id="4471407">s</span>&nbsp;<span class="op" id="4471409">!=</span>&nbsp;<span class="ident" id="4471412">nil</span><span class="op" id="4471415">;</span>&nbsp;<span class="ident" id="4471417">s</span>&nbsp;<span class="op" id="4471419">=</span>&nbsp;<span class="ident" id="4471421">s</span><span class="op" id="4471422">.</span><span class="ident" id="4471423">Outer</span>&nbsp;<span class="op" id="4471429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471433">if</span>&nbsp;<span class="ident" id="4471436">obj</span>&nbsp;<span class="op" id="4471440">:=</span>&nbsp;<span class="ident" id="4471443">s</span><span class="op" id="4471444">.</span><span class="ident" id="4471445">Lookup</span><span class="op" id="4471451">(</span><span class="ident" id="4471452">ident</span><span class="op" id="4471457">.</span><span class="ident" id="4471458">Name</span><span class="op" id="4471462">)</span><span class="op" id="4471463">;</span>&nbsp;<span class="ident" id="4471465">obj</span>&nbsp;<span class="op" id="4471469">!=</span>&nbsp;<span class="ident" id="4471472">nil</span>&nbsp;<span class="op" id="4471476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471481">ident</span><span class="op" id="4471486">.</span><span class="ident" id="4471487">Obj</span>&nbsp;<span class="op" id="4471491">=</span>&nbsp;<span class="ident" id="4471493">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471515">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471576">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471634">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471695">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471739">if</span>&nbsp;<span class="ident" id="4471742">collectUnresolved</span>&nbsp;<span class="op" id="4471760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471764">ident</span><span class="op" id="4471769">.</span><span class="ident" id="4471770">Obj</span>&nbsp;<span class="op" id="4471774">=</span>&nbsp;<span class="ident" id="4471776">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471789">p</span><span class="op" id="4471790">.</span><span class="ident" id="4471791">unresolved</span>&nbsp;<span class="op" id="4471802">=</span>&nbsp;<span class="builtinfunc" id="4471804">append</span><span class="op" id="4471810">(</span><span class="ident" id="4471811">p</span><span class="op" id="4471812">.</span><span class="ident" id="4471813">unresolved</span><span class="op" id="4471823">,</span>&nbsp;<span class="ident" id="4471825">ident</span><span class="op" id="4471830">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471833">}</span><br>
<span class="lineno"></span><span class="op" id="4471835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4471838">func</span>&nbsp;<span class="op" id="4471843">(</span><span class="ident" id="4471844">p</span>&nbsp;<span class="op" id="4471846">*</span><span class="ident" id="4471847">parser</span><span class="op" id="4471853">)</span>&nbsp;<span class="ident" id="4471855">resolve</span><span class="op" id="4471862">(</span><span class="ident" id="4471863">x</span>&nbsp;<span class="ident" id="4471865">ast</span><span class="op" id="4471868">.</span><span class="ident" id="4471869">Expr</span><span class="op" id="4471873">)</span>&nbsp;<span class="op" id="4471875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471878">p</span><span class="op" id="4471879">.</span><span class="ident" id="4471880">tryResolve</span><span class="op" id="4471890">(</span><span class="ident" id="4471891">x</span><span class="op" id="4471892">,</span>&nbsp;<span class="builtintype" id="4471894">true</span><span class="op" id="4471898">)</span><br>
<span class="lineno">200</span><span class="op" id="4471900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4471903">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4471983">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4472003">func</span>&nbsp;<span class="op" id="4472008">(</span><span class="ident" id="4472009">p</span>&nbsp;<span class="op" id="4472011">*</span><span class="ident" id="4472012">parser</span><span class="op" id="4472018">)</span>&nbsp;<span class="ident" id="4472020">printTrace</span><span class="op" id="4472030">(</span><span class="ident" id="4472031">a</span>&nbsp;<span class="op" id="4472033">...</span><span class="keyword" id="4472036">interface</span><span class="op" id="4472045">{</span><span class="op" id="4472046">}</span><span class="op" id="4472047">)</span>&nbsp;<span class="op" id="4472049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472052">const</span>&nbsp;<span class="ident" id="4472058">dots</span>&nbsp;<span class="op" id="4472063">=</span>&nbsp;<span class="string" id="4472065">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472133">const</span>&nbsp;<span class="ident" id="4472139">n</span>&nbsp;<span class="op" id="4472141">=</span>&nbsp;<span class="builtinfunc" id="4472143">len</span><span class="op" id="4472146">(</span><span class="ident" id="4472147">dots</span><span class="op" id="4472151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472154">pos</span>&nbsp;<span class="op" id="4472158">:=</span>&nbsp;<span class="ident" id="4472161">p</span><span class="op" id="4472162">.</span><span class="ident" id="4472163">file</span><span class="op" id="4472167">.</span><span class="ident" id="4472168">Position</span><span class="op" id="4472176">(</span><span class="ident" id="4472177">p</span><span class="op" id="4472178">.</span><span class="ident" id="4472179">pos</span><span class="op" id="4472182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472185">fmt</span><span class="op" id="4472188">.</span><span class="ident" id="4472189">Printf</span><span class="op" id="4472195">(</span><span class="string" id="4472196">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="4472207">,</span>&nbsp;<span class="ident" id="4472209">pos</span><span class="op" id="4472212">.</span><span class="ident" id="4472213">Line</span><span class="op" id="4472217">,</span>&nbsp;<span class="ident" id="4472219">pos</span><span class="op" id="4472222">.</span><span class="ident" id="4472223">Column</span><span class="op" id="4472229">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472232">i</span>&nbsp;<span class="op" id="4472234">:=</span>&nbsp;<span class="num" id="4472237">2</span>&nbsp;<span class="op" id="4472239">*</span>&nbsp;<span class="ident" id="4472241">p</span><span class="op" id="4472242">.</span><span class="ident" id="4472243">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472251">for</span>&nbsp;<span class="ident" id="4472255">i</span>&nbsp;<span class="op" id="4472257">&gt;</span>&nbsp;<span class="ident" id="4472259">n</span>&nbsp;<span class="op" id="4472261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472265">fmt</span><span class="op" id="4472268">.</span><span class="ident" id="4472269">Print</span><span class="op" id="4472274">(</span><span class="ident" id="4472275">dots</span><span class="op" id="4472279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472283">i</span>&nbsp;<span class="op" id="4472285">-=</span>&nbsp;<span class="ident" id="4472288">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472291">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472294">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472305">fmt</span><span class="op" id="4472308">.</span><span class="ident" id="4472309">Print</span><span class="op" id="4472314">(</span><span class="ident" id="4472315">dots</span><span class="op" id="4472319">[</span><span class="num" id="4472320">0</span><span class="op" id="4472321">:</span><span class="ident" id="4472322">i</span><span class="op" id="4472323">]</span><span class="op" id="4472324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472327">fmt</span><span class="op" id="4472330">.</span><span class="ident" id="4472331">Println</span><span class="op" id="4472338">(</span><span class="ident" id="4472339">a</span><span class="op" id="4472340">...</span><span class="op" id="4472343">)</span><br>
<span class="lineno"></span><span class="op" id="4472345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="4472348">func</span>&nbsp;<span class="ident" id="4472353">trace</span><span class="op" id="4472358">(</span><span class="ident" id="4472359">p</span>&nbsp;<span class="op" id="4472361">*</span><span class="ident" id="4472362">parser</span><span class="op" id="4472368">,</span>&nbsp;<span class="ident" id="4472370">msg</span>&nbsp;<span class="builtintype" id="4472374">string</span><span class="op" id="4472380">)</span>&nbsp;<span class="op" id="4472382">*</span><span class="ident" id="4472383">parser</span>&nbsp;<span class="op" id="4472390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472393">p</span><span class="op" id="4472394">.</span><span class="ident" id="4472395">printTrace</span><span class="op" id="4472405">(</span><span class="ident" id="4472406">msg</span><span class="op" id="4472409">,</span>&nbsp;<span class="string" id="4472411">&#34;(&#34;</span><span class="op" id="4472414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472417">p</span><span class="op" id="4472418">.</span><span class="ident" id="4472419">indent</span><span class="op" id="4472425">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472429">return</span>&nbsp;<span class="ident" id="4472436">p</span><br>
<span class="lineno"></span><span class="op" id="4472438">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4472441">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="4472485">func</span>&nbsp;<span class="ident" id="4472490">un</span><span class="op" id="4472492">(</span><span class="ident" id="4472493">p</span>&nbsp;<span class="op" id="4472495">*</span><span class="ident" id="4472496">parser</span><span class="op" id="4472502">)</span>&nbsp;<span class="op" id="4472504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472507">p</span><span class="op" id="4472508">.</span><span class="ident" id="4472509">indent</span><span class="op" id="4472515">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472519">p</span><span class="op" id="4472520">.</span><span class="ident" id="4472521">printTrace</span><span class="op" id="4472531">(</span><span class="string" id="4472532">&#34;)&#34;</span><span class="op" id="4472535">)</span><br>
<span class="lineno">230</span><span class="op" id="4472537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472540">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="4472570">func</span>&nbsp;<span class="op" id="4472575">(</span><span class="ident" id="4472576">p</span>&nbsp;<span class="op" id="4472578">*</span><span class="ident" id="4472579">parser</span><span class="op" id="4472585">)</span>&nbsp;<span class="ident" id="4472587">next0</span><span class="op" id="4472592">(</span><span class="op" id="4472593">)</span>&nbsp;<span class="op" id="4472595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472598">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472660">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472720">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472779">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472826">if</span>&nbsp;<span class="ident" id="4472829">p</span><span class="op" id="4472830">.</span><span class="ident" id="4472831">trace</span>&nbsp;<span class="op" id="4472837">&amp;&amp;</span>&nbsp;<span class="ident" id="4472840">p</span><span class="op" id="4472841">.</span><span class="ident" id="4472842">pos</span><span class="op" id="4472845">.</span><span class="ident" id="4472846">IsValid</span><span class="op" id="4472853">(</span><span class="op" id="4472854">)</span>&nbsp;<span class="op" id="4472856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472860">s</span>&nbsp;<span class="op" id="4472862">:=</span>&nbsp;<span class="ident" id="4472865">p</span><span class="op" id="4472866">.</span><span class="ident" id="4472867">tok</span><span class="op" id="4472870">.</span><span class="ident" id="4472871">String</span><span class="op" id="4472877">(</span><span class="op" id="4472878">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472882">switch</span>&nbsp;<span class="op" id="4472889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472893">case</span>&nbsp;<span class="ident" id="4472898">p</span><span class="op" id="4472899">.</span><span class="ident" id="4472900">tok</span><span class="op" id="4472903">.</span><span class="ident" id="4472904">IsLiteral</span><span class="op" id="4472913">(</span><span class="op" id="4472914">)</span><span class="op" id="4472915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472920">p</span><span class="op" id="4472921">.</span><span class="ident" id="4472922">printTrace</span><span class="op" id="4472932">(</span><span class="ident" id="4472933">s</span><span class="op" id="4472934">,</span>&nbsp;<span class="ident" id="4472936">p</span><span class="op" id="4472937">.</span><span class="ident" id="4472938">lit</span><span class="op" id="4472941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472945">case</span>&nbsp;<span class="ident" id="4472950">p</span><span class="op" id="4472951">.</span><span class="ident" id="4472952">tok</span><span class="op" id="4472955">.</span><span class="ident" id="4472956">IsOperator</span><span class="op" id="4472966">(</span><span class="op" id="4472967">)</span><span class="op" id="4472968">,</span>&nbsp;<span class="ident" id="4472970">p</span><span class="op" id="4472971">.</span><span class="ident" id="4472972">tok</span><span class="op" id="4472975">.</span><span class="ident" id="4472976">IsKeyword</span><span class="op" id="4472985">(</span><span class="op" id="4472986">)</span><span class="op" id="4472987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472992">p</span><span class="op" id="4472993">.</span><span class="ident" id="4472994">printTrace</span><span class="op" id="4473004">(</span><span class="string" id="4473005">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="4473010">+</span>&nbsp;<span class="ident" id="4473012">s</span>&nbsp;<span class="op" id="4473014">+</span>&nbsp;<span class="string" id="4473016">&#34;\&#34;&#34;</span><span class="op" id="4473020">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473024">default</span><span class="op" id="4473031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473036">p</span><span class="op" id="4473037">.</span><span class="ident" id="4473038">printTrace</span><span class="op" id="4473048">(</span><span class="ident" id="4473049">s</span><span class="op" id="4473050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473061">p</span><span class="op" id="4473062">.</span><span class="ident" id="4473063">pos</span><span class="op" id="4473066">,</span>&nbsp;<span class="ident" id="4473068">p</span><span class="op" id="4473069">.</span><span class="ident" id="4473070">tok</span><span class="op" id="4473073">,</span>&nbsp;<span class="ident" id="4473075">p</span><span class="op" id="4473076">.</span><span class="ident" id="4473077">lit</span>&nbsp;<span class="op" id="4473081">=</span>&nbsp;<span class="ident" id="4473083">p</span><span class="op" id="4473084">.</span><span class="ident" id="4473085">scanner</span><span class="op" id="4473092">.</span><span class="ident" id="4473093">Scan</span><span class="op" id="4473097">(</span><span class="op" id="4473098">)</span><br>
<span class="lineno"></span><span class="op" id="4473100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4473103">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="4473169">func</span>&nbsp;<span class="op" id="4473174">(</span><span class="ident" id="4473175">p</span>&nbsp;<span class="op" id="4473177">*</span><span class="ident" id="4473178">parser</span><span class="op" id="4473184">)</span>&nbsp;<span class="ident" id="4473186">consumeComment</span><span class="op" id="4473200">(</span><span class="op" id="4473201">)</span>&nbsp;<span class="op" id="4473203">(</span><span class="ident" id="4473204">comment</span>&nbsp;<span class="op" id="4473212">*</span><span class="ident" id="4473213">ast</span><span class="op" id="4473216">.</span><span class="ident" id="4473217">Comment</span><span class="op" id="4473224">,</span>&nbsp;<span class="ident" id="4473226">endline</span>&nbsp;<span class="builtintype" id="4473234">int</span><span class="op" id="4473237">)</span>&nbsp;<span class="op" id="4473239">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473242">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473315">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473383">endline</span>&nbsp;<span class="op" id="4473391">=</span>&nbsp;<span class="ident" id="4473393">p</span><span class="op" id="4473394">.</span><span class="ident" id="4473395">file</span><span class="op" id="4473399">.</span><span class="ident" id="4473400">Line</span><span class="op" id="4473404">(</span><span class="ident" id="4473405">p</span><span class="op" id="4473406">.</span><span class="ident" id="4473407">pos</span><span class="op" id="4473410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473413">if</span>&nbsp;<span class="ident" id="4473416">p</span><span class="op" id="4473417">.</span><span class="ident" id="4473418">lit</span><span class="op" id="4473421">[</span><span class="num" id="4473422">1</span><span class="op" id="4473423">]</span>&nbsp;<span class="op" id="4473425">==</span>&nbsp;<span class="string" id="4473428">&#39;*&#39;</span>&nbsp;<span class="op" id="4473432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473436">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473502">for</span>&nbsp;<span class="ident" id="4473506">i</span>&nbsp;<span class="op" id="4473508">:=</span>&nbsp;<span class="num" id="4473511">0</span><span class="op" id="4473512">;</span>&nbsp;<span class="ident" id="4473514">i</span>&nbsp;<span class="op" id="4473516">&lt;</span>&nbsp;<span class="builtinfunc" id="4473518">len</span><span class="op" id="4473521">(</span><span class="ident" id="4473522">p</span><span class="op" id="4473523">.</span><span class="ident" id="4473524">lit</span><span class="op" id="4473527">)</span><span class="op" id="4473528">;</span>&nbsp;<span class="ident" id="4473530">i</span><span class="op" id="4473531">++</span>&nbsp;<span class="op" id="4473534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473539">if</span>&nbsp;<span class="ident" id="4473542">p</span><span class="op" id="4473543">.</span><span class="ident" id="4473544">lit</span><span class="op" id="4473547">[</span><span class="ident" id="4473548">i</span><span class="op" id="4473549">]</span>&nbsp;<span class="op" id="4473551">==</span>&nbsp;<span class="string" id="4473554">&#39;\n&#39;</span>&nbsp;<span class="op" id="4473559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473565">endline</span><span class="op" id="4473572">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473582">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473589">comment</span>&nbsp;<span class="op" id="4473597">=</span>&nbsp;<span class="op" id="4473599">&amp;</span><span class="ident" id="4473600">ast</span><span class="op" id="4473603">.</span><span class="ident" id="4473604">Comment</span><span class="op" id="4473611">{</span><span class="ident" id="4473612">Slash</span><span class="op" id="4473617">:</span>&nbsp;<span class="ident" id="4473619">p</span><span class="op" id="4473620">.</span><span class="ident" id="4473621">pos</span><span class="op" id="4473624">,</span>&nbsp;<span class="ident" id="4473626">Text</span><span class="op" id="4473630">:</span>&nbsp;<span class="ident" id="4473632">p</span><span class="op" id="4473633">.</span><span class="ident" id="4473634">lit</span><span class="op" id="4473637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473640">p</span><span class="op" id="4473641">.</span><span class="ident" id="4473642">next0</span><span class="op" id="4473647">(</span><span class="op" id="4473648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473652">return</span><br>
<span class="lineno"></span><span class="op" id="4473659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4473662">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4473726">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="4473790">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4473854">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4473896">//</span><br>
<span class="lineno"></span><span class="keyword" id="4473899">func</span>&nbsp;<span class="op" id="4473904">(</span><span class="ident" id="4473905">p</span>&nbsp;<span class="op" id="4473907">*</span><span class="ident" id="4473908">parser</span><span class="op" id="4473914">)</span>&nbsp;<span class="ident" id="4473916">consumeCommentGroup</span><span class="op" id="4473935">(</span><span class="ident" id="4473936">n</span>&nbsp;<span class="builtintype" id="4473938">int</span><span class="op" id="4473941">)</span>&nbsp;<span class="op" id="4473943">(</span><span class="ident" id="4473944">comments</span>&nbsp;<span class="op" id="4473953">*</span><span class="ident" id="4473954">ast</span><span class="op" id="4473957">.</span><span class="ident" id="4473958">CommentGroup</span><span class="op" id="4473970">,</span>&nbsp;<span class="ident" id="4473972">endline</span>&nbsp;<span class="builtintype" id="4473980">int</span><span class="op" id="4473983">)</span>&nbsp;<span class="op" id="4473985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473988">var</span>&nbsp;<span class="ident" id="4473992">list</span>&nbsp;<span class="op" id="4473997">[</span><span class="op" id="4473998">]</span><span class="op" id="4473999">*</span><span class="ident" id="4474000">ast</span><span class="op" id="4474003">.</span><span class="ident" id="4474004">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474013">endline</span>&nbsp;<span class="op" id="4474021">=</span>&nbsp;<span class="ident" id="4474023">p</span><span class="op" id="4474024">.</span><span class="ident" id="4474025">file</span><span class="op" id="4474029">.</span><span class="ident" id="4474030">Line</span><span class="op" id="4474034">(</span><span class="ident" id="4474035">p</span><span class="op" id="4474036">.</span><span class="ident" id="4474037">pos</span><span class="op" id="4474040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474043">for</span>&nbsp;<span class="ident" id="4474047">p</span><span class="op" id="4474048">.</span><span class="ident" id="4474049">tok</span>&nbsp;<span class="op" id="4474053">==</span>&nbsp;<span class="ident" id="4474056">token</span><span class="op" id="4474061">.</span><span class="ident" id="4474062">COMMENT</span>&nbsp;<span class="op" id="4474070">&amp;&amp;</span>&nbsp;<span class="ident" id="4474073">p</span><span class="op" id="4474074">.</span><span class="ident" id="4474075">file</span><span class="op" id="4474079">.</span><span class="ident" id="4474080">Line</span><span class="op" id="4474084">(</span><span class="ident" id="4474085">p</span><span class="op" id="4474086">.</span><span class="ident" id="4474087">pos</span><span class="op" id="4474090">)</span>&nbsp;<span class="op" id="4474092">&lt;=</span>&nbsp;<span class="ident" id="4474095">endline</span><span class="op" id="4474102">+</span><span class="ident" id="4474103">n</span>&nbsp;<span class="op" id="4474105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474109">var</span>&nbsp;<span class="ident" id="4474113">comment</span>&nbsp;<span class="op" id="4474121">*</span><span class="ident" id="4474122">ast</span><span class="op" id="4474125">.</span><span class="ident" id="4474126">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474136">comment</span><span class="op" id="4474143">,</span>&nbsp;<span class="ident" id="4474145">endline</span>&nbsp;<span class="op" id="4474153">=</span>&nbsp;<span class="ident" id="4474155">p</span><span class="op" id="4474156">.</span><span class="ident" id="4474157">consumeComment</span><span class="op" id="4474171">(</span><span class="op" id="4474172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474176">list</span>&nbsp;<span class="op" id="4474181">=</span>&nbsp;<span class="builtinfunc" id="4474183">append</span><span class="op" id="4474189">(</span><span class="ident" id="4474190">list</span><span class="op" id="4474194">,</span>&nbsp;<span class="ident" id="4474196">comment</span><span class="op" id="4474203">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4474206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474210">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474253">comments</span>&nbsp;<span class="op" id="4474262">=</span>&nbsp;<span class="op" id="4474264">&amp;</span><span class="ident" id="4474265">ast</span><span class="op" id="4474268">.</span><span class="ident" id="4474269">CommentGroup</span><span class="op" id="4474281">{</span><span class="ident" id="4474282">List</span><span class="op" id="4474286">:</span>&nbsp;<span class="ident" id="4474288">list</span><span class="op" id="4474292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474295">p</span><span class="op" id="4474296">.</span><span class="ident" id="4474297">comments</span>&nbsp;<span class="op" id="4474306">=</span>&nbsp;<span class="builtinfunc" id="4474308">append</span><span class="op" id="4474314">(</span><span class="ident" id="4474315">p</span><span class="op" id="4474316">.</span><span class="ident" id="4474317">comments</span><span class="op" id="4474325">,</span>&nbsp;<span class="ident" id="4474327">comments</span><span class="op" id="4474335">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474339">return</span><br>
<span class="lineno"></span><span class="op" id="4474346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4474349">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="4474415">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4474481">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4474503">//</span><br>
<span class="lineno"></span><span class="comment" id="4474506">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4474569">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="4474640">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4474698">//</span><br>
<span class="lineno"></span><span class="comment" id="4474701">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="4474765">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4474836">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="4474854">//</span><br>
<span class="lineno"></span><span class="comment" id="4474857">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4474923">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="4474945">//</span><br>
<span class="lineno"></span><span class="keyword" id="4474948">func</span>&nbsp;<span class="op" id="4474953">(</span><span class="ident" id="4474954">p</span>&nbsp;<span class="op" id="4474956">*</span><span class="ident" id="4474957">parser</span><span class="op" id="4474963">)</span>&nbsp;<span class="ident" id="4474965">next</span><span class="op" id="4474969">(</span><span class="op" id="4474970">)</span>&nbsp;<span class="op" id="4474972">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474975">p</span><span class="op" id="4474976">.</span><span class="ident" id="4474977">leadComment</span>&nbsp;<span class="op" id="4474989">=</span>&nbsp;<span class="ident" id="4474991">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474996">p</span><span class="op" id="4474997">.</span><span class="ident" id="4474998">lineComment</span>&nbsp;<span class="op" id="4475010">=</span>&nbsp;<span class="ident" id="4475012">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475017">prev</span>&nbsp;<span class="op" id="4475022">:=</span>&nbsp;<span class="ident" id="4475025">p</span><span class="op" id="4475026">.</span><span class="ident" id="4475027">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475032">p</span><span class="op" id="4475033">.</span><span class="ident" id="4475034">next0</span><span class="op" id="4475039">(</span><span class="op" id="4475040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475044">if</span>&nbsp;<span class="ident" id="4475047">p</span><span class="op" id="4475048">.</span><span class="ident" id="4475049">tok</span>&nbsp;<span class="op" id="4475053">==</span>&nbsp;<span class="ident" id="4475056">token</span><span class="op" id="4475061">.</span><span class="ident" id="4475062">COMMENT</span>&nbsp;<span class="op" id="4475070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475074">var</span>&nbsp;<span class="ident" id="4475078">comment</span>&nbsp;<span class="op" id="4475086">*</span><span class="ident" id="4475087">ast</span><span class="op" id="4475090">.</span><span class="ident" id="4475091">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475106">var</span>&nbsp;<span class="ident" id="4475110">endline</span>&nbsp;<span class="builtintype" id="4475118">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475125">if</span>&nbsp;<span class="ident" id="4475128">p</span><span class="op" id="4475129">.</span><span class="ident" id="4475130">file</span><span class="op" id="4475134">.</span><span class="ident" id="4475135">Line</span><span class="op" id="4475139">(</span><span class="ident" id="4475140">p</span><span class="op" id="4475141">.</span><span class="ident" id="4475142">pos</span><span class="op" id="4475145">)</span>&nbsp;<span class="op" id="4475147">==</span>&nbsp;<span class="ident" id="4475150">p</span><span class="op" id="4475151">.</span><span class="ident" id="4475152">file</span><span class="op" id="4475156">.</span><span class="ident" id="4475157">Line</span><span class="op" id="4475161">(</span><span class="ident" id="4475162">prev</span><span class="op" id="4475166">)</span>&nbsp;<span class="op" id="4475168">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475173">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475233">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475291">comment</span><span class="op" id="4475298">,</span>&nbsp;<span class="ident" id="4475300">endline</span>&nbsp;<span class="op" id="4475308">=</span>&nbsp;<span class="ident" id="4475310">p</span><span class="op" id="4475311">.</span><span class="ident" id="4475312">consumeCommentGroup</span><span class="op" id="4475331">(</span><span class="num" id="4475332">0</span><span class="op" id="4475333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475338">if</span>&nbsp;<span class="ident" id="4475341">p</span><span class="op" id="4475342">.</span><span class="ident" id="4475343">file</span><span class="op" id="4475347">.</span><span class="ident" id="4475348">Line</span><span class="op" id="4475352">(</span><span class="ident" id="4475353">p</span><span class="op" id="4475354">.</span><span class="ident" id="4475355">pos</span><span class="op" id="4475358">)</span>&nbsp;<span class="op" id="4475360">!=</span>&nbsp;<span class="ident" id="4475363">endline</span>&nbsp;<span class="op" id="4475371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475377">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475428">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475477">p</span><span class="op" id="4475478">.</span><span class="ident" id="4475479">lineComment</span>&nbsp;<span class="op" id="4475491">=</span>&nbsp;<span class="ident" id="4475493">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475513">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475553">endline</span>&nbsp;<span class="op" id="4475561">=</span>&nbsp;<span class="op" id="4475563">-</span><span class="num" id="4475564">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475568">for</span>&nbsp;<span class="ident" id="4475572">p</span><span class="op" id="4475573">.</span><span class="ident" id="4475574">tok</span>&nbsp;<span class="op" id="4475578">==</span>&nbsp;<span class="ident" id="4475581">token</span><span class="op" id="4475586">.</span><span class="ident" id="4475587">COMMENT</span>&nbsp;<span class="op" id="4475595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475600">comment</span><span class="op" id="4475607">,</span>&nbsp;<span class="ident" id="4475609">endline</span>&nbsp;<span class="op" id="4475617">=</span>&nbsp;<span class="ident" id="4475619">p</span><span class="op" id="4475620">.</span><span class="ident" id="4475621">consumeCommentGroup</span><span class="op" id="4475640">(</span><span class="num" id="4475641">1</span><span class="op" id="4475642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475646">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475651">if</span>&nbsp;<span class="ident" id="4475654">endline</span><span class="op" id="4475661">+</span><span class="num" id="4475662">1</span>&nbsp;<span class="op" id="4475664">==</span>&nbsp;<span class="ident" id="4475667">p</span><span class="op" id="4475668">.</span><span class="ident" id="4475669">file</span><span class="op" id="4475673">.</span><span class="ident" id="4475674">Line</span><span class="op" id="4475678">(</span><span class="ident" id="4475679">p</span><span class="op" id="4475680">.</span><span class="ident" id="4475681">pos</span><span class="op" id="4475684">)</span>&nbsp;<span class="op" id="4475686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475691">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4475759">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475827">p</span><span class="op" id="4475828">.</span><span class="ident" id="4475829">leadComment</span>&nbsp;<span class="op" id="4475841">=</span>&nbsp;<span class="ident" id="4475843">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475856">}</span><br>
<span class="lineno"></span><span class="op" id="4475858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4475861">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="4475921">type</span>&nbsp;<span class="ident" id="4475926">bailout</span>&nbsp;<span class="keyword" id="4475934">struct</span><span class="op" id="4475940">{</span><span class="op" id="4475941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4475944">func</span>&nbsp;<span class="op" id="4475949">(</span><span class="ident" id="4475950">p</span>&nbsp;<span class="op" id="4475952">*</span><span class="ident" id="4475953">parser</span><span class="op" id="4475959">)</span>&nbsp;<span class="builtintype" id="4475961">error</span><span class="op" id="4475966">(</span><span class="ident" id="4475967">pos</span>&nbsp;<span class="ident" id="4475971">token</span><span class="op" id="4475976">.</span><span class="ident" id="4475977">Pos</span><span class="op" id="4475980">,</span>&nbsp;<span class="ident" id="4475982">msg</span>&nbsp;<span class="builtintype" id="4475986">string</span><span class="op" id="4475992">)</span>&nbsp;<span class="op" id="4475994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475997">epos</span>&nbsp;<span class="op" id="4476002">:=</span>&nbsp;<span class="ident" id="4476005">p</span><span class="op" id="4476006">.</span><span class="ident" id="4476007">file</span><span class="op" id="4476011">.</span><span class="ident" id="4476012">Position</span><span class="op" id="4476020">(</span><span class="ident" id="4476021">pos</span><span class="op" id="4476024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4476028">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4476098">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4476169">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476184">if</span>&nbsp;<span class="ident" id="4476187">p</span><span class="op" id="4476188">.</span><span class="ident" id="4476189">mode</span><span class="op" id="4476193">&amp;</span><span class="ident" id="4476194">AllErrors</span>&nbsp;<span class="op" id="4476204">==</span>&nbsp;<span class="num" id="4476207">0</span>&nbsp;<span class="op" id="4476209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476213">n</span>&nbsp;<span class="op" id="4476215">:=</span>&nbsp;<span class="builtinfunc" id="4476218">len</span><span class="op" id="4476221">(</span><span class="ident" id="4476222">p</span><span class="op" id="4476223">.</span><span class="ident" id="4476224">errors</span><span class="op" id="4476230">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476234">if</span>&nbsp;<span class="ident" id="4476237">n</span>&nbsp;<span class="op" id="4476239">&gt;</span>&nbsp;<span class="num" id="4476241">0</span>&nbsp;<span class="op" id="4476243">&amp;&amp;</span>&nbsp;<span class="ident" id="4476246">p</span><span class="op" id="4476247">.</span><span class="ident" id="4476248">errors</span><span class="op" id="4476254">[</span><span class="ident" id="4476255">n</span><span class="op" id="4476256">-</span><span class="num" id="4476257">1</span><span class="op" id="4476258">]</span><span class="op" id="4476259">.</span><span class="ident" id="4476260">Pos</span><span class="op" id="4476263">.</span><span class="ident" id="4476264">Line</span>&nbsp;<span class="op" id="4476269">==</span>&nbsp;<span class="ident" id="4476272">epos</span><span class="op" id="4476276">.</span><span class="ident" id="4476277">Line</span>&nbsp;<span class="op" id="4476282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476287">return</span>&nbsp;<span class="comment" id="4476294">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476337">if</span>&nbsp;<span class="ident" id="4476340">n</span>&nbsp;<span class="op" id="4476342">&gt;</span>&nbsp;<span class="num" id="4476344">10</span>&nbsp;<span class="op" id="4476347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4476352">panic</span><span class="op" id="4476357">(</span><span class="ident" id="4476358">bailout</span><span class="op" id="4476365">{</span><span class="op" id="4476366">}</span><span class="op" id="4476367">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476378">p</span><span class="op" id="4476379">.</span><span class="ident" id="4476380">errors</span><span class="op" id="4476386">.</span><span class="ident" id="4476387">Add</span><span class="op" id="4476390">(</span><span class="ident" id="4476391">epos</span><span class="op" id="4476395">,</span>&nbsp;<span class="ident" id="4476397">msg</span><span class="op" id="4476400">)</span><br>
<span class="lineno"></span><span class="op" id="4476402">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4476405">func</span>&nbsp;<span class="op" id="4476410">(</span><span class="ident" id="4476411">p</span>&nbsp;<span class="op" id="4476413">*</span><span class="ident" id="4476414">parser</span><span class="op" id="4476420">)</span>&nbsp;<span class="ident" id="4476422">errorExpected</span><span class="op" id="4476435">(</span><span class="ident" id="4476436">pos</span>&nbsp;<span class="ident" id="4476440">token</span><span class="op" id="4476445">.</span><span class="ident" id="4476446">Pos</span><span class="op" id="4476449">,</span>&nbsp;<span class="ident" id="4476451">msg</span>&nbsp;<span class="builtintype" id="4476455">string</span><span class="op" id="4476461">)</span>&nbsp;<span class="op" id="4476463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476466">msg</span>&nbsp;<span class="op" id="4476470">=</span>&nbsp;<span class="string" id="4476472">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="4476484">+</span>&nbsp;<span class="ident" id="4476486">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476491">if</span>&nbsp;<span class="ident" id="4476494">pos</span>&nbsp;<span class="op" id="4476498">==</span>&nbsp;<span class="ident" id="4476501">p</span><span class="op" id="4476502">.</span><span class="ident" id="4476503">pos</span>&nbsp;<span class="op" id="4476507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4476511">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4476560">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476602">if</span>&nbsp;<span class="ident" id="4476605">p</span><span class="op" id="4476606">.</span><span class="ident" id="4476607">tok</span>&nbsp;<span class="op" id="4476611">==</span>&nbsp;<span class="ident" id="4476614">token</span><span class="op" id="4476619">.</span><span class="ident" id="4476620">SEMICOLON</span>&nbsp;<span class="op" id="4476630">&amp;&amp;</span>&nbsp;<span class="ident" id="4476633">p</span><span class="op" id="4476634">.</span><span class="ident" id="4476635">lit</span>&nbsp;<span class="op" id="4476639">==</span>&nbsp;<span class="string" id="4476642">&#34;\n&#34;</span>&nbsp;<span class="op" id="4476647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476652">msg</span>&nbsp;<span class="op" id="4476656">+=</span>&nbsp;<span class="string" id="4476659">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476679">}</span>&nbsp;<span class="keyword" id="4476681">else</span>&nbsp;<span class="op" id="4476686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476691">msg</span>&nbsp;<span class="op" id="4476695">+=</span>&nbsp;<span class="string" id="4476698">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="4476710">+</span>&nbsp;<span class="ident" id="4476712">p</span><span class="op" id="4476713">.</span><span class="ident" id="4476714">tok</span><span class="op" id="4476717">.</span><span class="ident" id="4476718">String</span><span class="op" id="4476724">(</span><span class="op" id="4476725">)</span>&nbsp;<span class="op" id="4476727">+</span>&nbsp;<span class="string" id="4476729">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476736">if</span>&nbsp;<span class="ident" id="4476739">p</span><span class="op" id="4476740">.</span><span class="ident" id="4476741">tok</span><span class="op" id="4476744">.</span><span class="ident" id="4476745">IsLiteral</span><span class="op" id="4476754">(</span><span class="op" id="4476755">)</span>&nbsp;<span class="op" id="4476757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476763">msg</span>&nbsp;<span class="op" id="4476767">+=</span>&nbsp;<span class="string" id="4476770">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4476774">+</span>&nbsp;<span class="ident" id="4476776">p</span><span class="op" id="4476777">.</span><span class="ident" id="4476778">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476792">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476795">p</span><span class="op" id="4476796">.</span><span class="builtintype" id="4476797">error</span><span class="op" id="4476802">(</span><span class="ident" id="4476803">pos</span><span class="op" id="4476806">,</span>&nbsp;<span class="ident" id="4476808">msg</span><span class="op" id="4476811">)</span><br>
<span class="lineno"></span><span class="op" id="4476813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4476816">func</span>&nbsp;<span class="op" id="4476821">(</span><span class="ident" id="4476822">p</span>&nbsp;<span class="op" id="4476824">*</span><span class="ident" id="4476825">parser</span><span class="op" id="4476831">)</span>&nbsp;<span class="ident" id="4476833">expect</span><span class="op" id="4476839">(</span><span class="ident" id="4476840">tok</span>&nbsp;<span class="ident" id="4476844">token</span><span class="op" id="4476849">.</span><span class="ident" id="4476850">Token</span><span class="op" id="4476855">)</span>&nbsp;<span class="ident" id="4476857">token</span><span class="op" id="4476862">.</span><span class="ident" id="4476863">Pos</span>&nbsp;<span class="op" id="4476867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476870">pos</span>&nbsp;<span class="op" id="4476874">:=</span>&nbsp;<span class="ident" id="4476877">p</span><span class="op" id="4476878">.</span><span class="ident" id="4476879">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476884">if</span>&nbsp;<span class="ident" id="4476887">p</span><span class="op" id="4476888">.</span><span class="ident" id="4476889">tok</span>&nbsp;<span class="op" id="4476893">!=</span>&nbsp;<span class="ident" id="4476896">tok</span>&nbsp;<span class="op" id="4476900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476904">p</span><span class="op" id="4476905">.</span><span class="ident" id="4476906">errorExpected</span><span class="op" id="4476919">(</span><span class="ident" id="4476920">pos</span><span class="op" id="4476923">,</span>&nbsp;<span class="string" id="4476925">&#34;&#39;&#34;</span><span class="op" id="4476928">+</span><span class="ident" id="4476929">tok</span><span class="op" id="4476932">.</span><span class="ident" id="4476933">String</span><span class="op" id="4476939">(</span><span class="op" id="4476940">)</span><span class="op" id="4476941">+</span><span class="string" id="4476942">&#34;&#39;&#34;</span><span class="op" id="4476945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476951">p</span><span class="op" id="4476952">.</span><span class="ident" id="4476953">next</span><span class="op" id="4476957">(</span><span class="op" id="4476958">)</span>&nbsp;<span class="comment" id="4476960">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476978">return</span>&nbsp;<span class="ident" id="4476985">pos</span><br>
<span class="lineno">390</span><span class="op" id="4476989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4476992">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4477060">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="4477120">//</span><br>
<span class="lineno">395</span><span class="keyword" id="4477123">func</span>&nbsp;<span class="op" id="4477128">(</span><span class="ident" id="4477129">p</span>&nbsp;<span class="op" id="4477131">*</span><span class="ident" id="4477132">parser</span><span class="op" id="4477138">)</span>&nbsp;<span class="ident" id="4477140">expectClosing</span><span class="op" id="4477153">(</span><span class="ident" id="4477154">tok</span>&nbsp;<span class="ident" id="4477158">token</span><span class="op" id="4477163">.</span><span class="ident" id="4477164">Token</span><span class="op" id="4477169">,</span>&nbsp;<span class="ident" id="4477171">context</span>&nbsp;<span class="builtintype" id="4477179">string</span><span class="op" id="4477185">)</span>&nbsp;<span class="ident" id="4477187">token</span><span class="op" id="4477192">.</span><span class="ident" id="4477193">Pos</span>&nbsp;<span class="op" id="4477197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477200">if</span>&nbsp;<span class="ident" id="4477203">p</span><span class="op" id="4477204">.</span><span class="ident" id="4477205">tok</span>&nbsp;<span class="op" id="4477209">!=</span>&nbsp;<span class="ident" id="4477212">tok</span>&nbsp;<span class="op" id="4477216">&amp;&amp;</span>&nbsp;<span class="ident" id="4477219">p</span><span class="op" id="4477220">.</span><span class="ident" id="4477221">tok</span>&nbsp;<span class="op" id="4477225">==</span>&nbsp;<span class="ident" id="4477228">token</span><span class="op" id="4477233">.</span><span class="ident" id="4477234">SEMICOLON</span>&nbsp;<span class="op" id="4477244">&amp;&amp;</span>&nbsp;<span class="ident" id="4477247">p</span><span class="op" id="4477248">.</span><span class="ident" id="4477249">lit</span>&nbsp;<span class="op" id="4477253">==</span>&nbsp;<span class="string" id="4477256">&#34;\n&#34;</span>&nbsp;<span class="op" id="4477261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477265">p</span><span class="op" id="4477266">.</span><span class="builtintype" id="4477267">error</span><span class="op" id="4477272">(</span><span class="ident" id="4477273">p</span><span class="op" id="4477274">.</span><span class="ident" id="4477275">pos</span><span class="op" id="4477278">,</span>&nbsp;<span class="string" id="4477280">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4477312">+</span><span class="ident" id="4477313">context</span><span class="op" id="4477320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477324">p</span><span class="op" id="4477325">.</span><span class="ident" id="4477326">next</span><span class="op" id="4477330">(</span><span class="op" id="4477331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477334">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477337">return</span>&nbsp;<span class="ident" id="4477344">p</span><span class="op" id="4477345">.</span><span class="ident" id="4477346">expect</span><span class="op" id="4477352">(</span><span class="ident" id="4477353">tok</span><span class="op" id="4477356">)</span><br>
<span class="lineno"></span><span class="op" id="4477358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4477361">func</span>&nbsp;<span class="op" id="4477366">(</span><span class="ident" id="4477367">p</span>&nbsp;<span class="op" id="4477369">*</span><span class="ident" id="4477370">parser</span><span class="op" id="4477376">)</span>&nbsp;<span class="ident" id="4477378">expectSemi</span><span class="op" id="4477388">(</span><span class="op" id="4477389">)</span>&nbsp;<span class="op" id="4477391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4477394">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477448">if</span>&nbsp;<span class="ident" id="4477451">p</span><span class="op" id="4477452">.</span><span class="ident" id="4477453">tok</span>&nbsp;<span class="op" id="4477457">!=</span>&nbsp;<span class="ident" id="4477460">token</span><span class="op" id="4477465">.</span><span class="ident" id="4477466">RPAREN</span>&nbsp;<span class="op" id="4477473">&amp;&amp;</span>&nbsp;<span class="ident" id="4477476">p</span><span class="op" id="4477477">.</span><span class="ident" id="4477478">tok</span>&nbsp;<span class="op" id="4477482">!=</span>&nbsp;<span class="ident" id="4477485">token</span><span class="op" id="4477490">.</span><span class="ident" id="4477491">RBRACE</span>&nbsp;<span class="op" id="4477498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477502">if</span>&nbsp;<span class="ident" id="4477505">p</span><span class="op" id="4477506">.</span><span class="ident" id="4477507">tok</span>&nbsp;<span class="op" id="4477511">==</span>&nbsp;<span class="ident" id="4477514">token</span><span class="op" id="4477519">.</span><span class="ident" id="4477520">SEMICOLON</span>&nbsp;<span class="op" id="4477530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477535">p</span><span class="op" id="4477536">.</span><span class="ident" id="4477537">next</span><span class="op" id="4477541">(</span><span class="op" id="4477542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477546">}</span>&nbsp;<span class="keyword" id="4477548">else</span>&nbsp;<span class="op" id="4477553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477558">p</span><span class="op" id="4477559">.</span><span class="ident" id="4477560">errorExpected</span><span class="op" id="4477573">(</span><span class="ident" id="4477574">p</span><span class="op" id="4477575">.</span><span class="ident" id="4477576">pos</span><span class="op" id="4477579">,</span>&nbsp;<span class="string" id="4477581">&#34;&#39;;&#39;&#34;</span><span class="op" id="4477586">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477591">syncStmt</span><span class="op" id="4477599">(</span><span class="ident" id="4477600">p</span><span class="op" id="4477601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477608">}</span><br>
<span class="lineno"></span><span class="op" id="4477610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="4477613">func</span>&nbsp;<span class="op" id="4477618">(</span><span class="ident" id="4477619">p</span>&nbsp;<span class="op" id="4477621">*</span><span class="ident" id="4477622">parser</span><span class="op" id="4477628">)</span>&nbsp;<span class="ident" id="4477630">atComma</span><span class="op" id="4477637">(</span><span class="ident" id="4477638">context</span>&nbsp;<span class="builtintype" id="4477646">string</span><span class="op" id="4477652">)</span>&nbsp;<span class="builtintype" id="4477654">bool</span>&nbsp;<span class="op" id="4477659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477662">if</span>&nbsp;<span class="ident" id="4477665">p</span><span class="op" id="4477666">.</span><span class="ident" id="4477667">tok</span>&nbsp;<span class="op" id="4477671">==</span>&nbsp;<span class="ident" id="4477674">token</span><span class="op" id="4477679">.</span><span class="ident" id="4477680">COMMA</span>&nbsp;<span class="op" id="4477686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477690">return</span>&nbsp;<span class="builtintype" id="4477697">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477706">if</span>&nbsp;<span class="ident" id="4477709">p</span><span class="op" id="4477710">.</span><span class="ident" id="4477711">tok</span>&nbsp;<span class="op" id="4477715">==</span>&nbsp;<span class="ident" id="4477718">token</span><span class="op" id="4477723">.</span><span class="ident" id="4477724">SEMICOLON</span>&nbsp;<span class="op" id="4477734">&amp;&amp;</span>&nbsp;<span class="ident" id="4477737">p</span><span class="op" id="4477738">.</span><span class="ident" id="4477739">lit</span>&nbsp;<span class="op" id="4477743">==</span>&nbsp;<span class="string" id="4477746">&#34;\n&#34;</span>&nbsp;<span class="op" id="4477751">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477755">p</span><span class="op" id="4477756">.</span><span class="builtintype" id="4477757">error</span><span class="op" id="4477762">(</span><span class="ident" id="4477763">p</span><span class="op" id="4477764">.</span><span class="ident" id="4477765">pos</span><span class="op" id="4477768">,</span>&nbsp;<span class="string" id="4477770">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4477802">+</span><span class="ident" id="4477803">context</span><span class="op" id="4477810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477814">return</span>&nbsp;<span class="builtintype" id="4477821">true</span>&nbsp;<span class="comment" id="4477826">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477866">return</span>&nbsp;<span class="builtintype" id="4477873">false</span><br>
<span class="lineno">425</span><span class="op" id="4477879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4477882">func</span>&nbsp;<span class="ident" id="4477887">assert</span><span class="op" id="4477893">(</span><span class="ident" id="4477894">cond</span>&nbsp;<span class="builtintype" id="4477899">bool</span><span class="op" id="4477903">,</span>&nbsp;<span class="ident" id="4477905">msg</span>&nbsp;<span class="builtintype" id="4477909">string</span><span class="op" id="4477915">)</span>&nbsp;<span class="op" id="4477917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477920">if</span>&nbsp;<span class="op" id="4477923">!</span><span class="ident" id="4477924">cond</span>&nbsp;<span class="op" id="4477929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4477933">panic</span><span class="op" id="4477938">(</span><span class="string" id="4477939">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4477968">+</span>&nbsp;<span class="ident" id="4477970">msg</span><span class="op" id="4477973">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477976">}</span><br>
<span class="lineno"></span><span class="op" id="4477978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4477981">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4478025">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="4478069">//</span><br>
<span class="lineno"></span><span class="keyword" id="4478072">func</span>&nbsp;<span class="ident" id="4478077">syncStmt</span><span class="op" id="4478085">(</span><span class="ident" id="4478086">p</span>&nbsp;<span class="op" id="4478088">*</span><span class="ident" id="4478089">parser</span><span class="op" id="4478095">)</span>&nbsp;<span class="op" id="4478097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478100">for</span>&nbsp;<span class="op" id="4478104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478108">switch</span>&nbsp;<span class="ident" id="4478115">p</span><span class="op" id="4478116">.</span><span class="ident" id="4478117">tok</span>&nbsp;<span class="op" id="4478121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478125">case</span>&nbsp;<span class="ident" id="4478130">token</span><span class="op" id="4478135">.</span><span class="ident" id="4478136">BREAK</span><span class="op" id="4478141">,</span>&nbsp;<span class="ident" id="4478143">token</span><span class="op" id="4478148">.</span><span class="ident" id="4478149">CONST</span><span class="op" id="4478154">,</span>&nbsp;<span class="ident" id="4478156">token</span><span class="op" id="4478161">.</span><span class="ident" id="4478162">CONTINUE</span><span class="op" id="4478170">,</span>&nbsp;<span class="ident" id="4478172">token</span><span class="op" id="4478177">.</span><span class="ident" id="4478178">DEFER</span><span class="op" id="4478183">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478188">token</span><span class="op" id="4478193">.</span><span class="ident" id="4478194">FALLTHROUGH</span><span class="op" id="4478205">,</span>&nbsp;<span class="ident" id="4478207">token</span><span class="op" id="4478212">.</span><span class="ident" id="4478213">FOR</span><span class="op" id="4478216">,</span>&nbsp;<span class="ident" id="4478218">token</span><span class="op" id="4478223">.</span><span class="ident" id="4478224">GO</span><span class="op" id="4478226">,</span>&nbsp;<span class="ident" id="4478228">token</span><span class="op" id="4478233">.</span><span class="ident" id="4478234">GOTO</span><span class="op" id="4478238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478243">token</span><span class="op" id="4478248">.</span><span class="ident" id="4478249">IF</span><span class="op" id="4478251">,</span>&nbsp;<span class="ident" id="4478253">token</span><span class="op" id="4478258">.</span><span class="ident" id="4478259">RETURN</span><span class="op" id="4478265">,</span>&nbsp;<span class="ident" id="4478267">token</span><span class="op" id="4478272">.</span><span class="ident" id="4478273">SELECT</span><span class="op" id="4478279">,</span>&nbsp;<span class="ident" id="4478281">token</span><span class="op" id="4478286">.</span><span class="ident" id="4478287">SWITCH</span><span class="op" id="4478293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478298">token</span><span class="op" id="4478303">.</span><span class="ident" id="4478304">TYPE</span><span class="op" id="4478308">,</span>&nbsp;<span class="ident" id="4478310">token</span><span class="op" id="4478315">.</span><span class="ident" id="4478316">VAR</span><span class="op" id="4478319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478324">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478382">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478440">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478496">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478552">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478608">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478662">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478697">if</span>&nbsp;<span class="ident" id="4478700">p</span><span class="op" id="4478701">.</span><span class="ident" id="4478702">pos</span>&nbsp;<span class="op" id="4478706">==</span>&nbsp;<span class="ident" id="4478709">p</span><span class="op" id="4478710">.</span><span class="ident" id="4478711">syncPos</span>&nbsp;<span class="op" id="4478719">&amp;&amp;</span>&nbsp;<span class="ident" id="4478722">p</span><span class="op" id="4478723">.</span><span class="ident" id="4478724">syncCnt</span>&nbsp;<span class="op" id="4478732">&lt;</span>&nbsp;<span class="num" id="4478734">10</span>&nbsp;<span class="op" id="4478737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478743">p</span><span class="op" id="4478744">.</span><span class="ident" id="4478745">syncCnt</span><span class="op" id="4478752">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478759">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4478769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478774">if</span>&nbsp;<span class="ident" id="4478777">p</span><span class="op" id="4478778">.</span><span class="ident" id="4478779">pos</span>&nbsp;<span class="op" id="4478783">&gt;</span>&nbsp;<span class="ident" id="4478785">p</span><span class="op" id="4478786">.</span><span class="ident" id="4478787">syncPos</span>&nbsp;<span class="op" id="4478795">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478801">p</span><span class="op" id="4478802">.</span><span class="ident" id="4478803">syncPos</span>&nbsp;<span class="op" id="4478811">=</span>&nbsp;<span class="ident" id="4478813">p</span><span class="op" id="4478814">.</span><span class="ident" id="4478815">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478823">p</span><span class="op" id="4478824">.</span><span class="ident" id="4478825">syncCnt</span>&nbsp;<span class="op" id="4478833">=</span>&nbsp;<span class="num" id="4478835">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4478851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478856">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478910">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478967">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479021">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479076">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479111">case</span>&nbsp;<span class="ident" id="4479116">token</span><span class="op" id="4479121">.</span><span class="ident" id="4479122">EOF</span><span class="op" id="4479125">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479130">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479143">p</span><span class="op" id="4479144">.</span><span class="ident" id="4479145">next</span><span class="op" id="4479149">(</span><span class="op" id="4479150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479153">}</span><br>
<span class="lineno"></span><span class="op" id="4479155">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4479158">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="4479204">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4479248">//</span><br>
<span class="lineno"></span><span class="keyword" id="4479251">func</span>&nbsp;<span class="ident" id="4479256">syncDecl</span><span class="op" id="4479264">(</span><span class="ident" id="4479265">p</span>&nbsp;<span class="op" id="4479267">*</span><span class="ident" id="4479268">parser</span><span class="op" id="4479274">)</span>&nbsp;<span class="op" id="4479276">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479279">for</span>&nbsp;<span class="op" id="4479283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479287">switch</span>&nbsp;<span class="ident" id="4479294">p</span><span class="op" id="4479295">.</span><span class="ident" id="4479296">tok</span>&nbsp;<span class="op" id="4479300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479304">case</span>&nbsp;<span class="ident" id="4479309">token</span><span class="op" id="4479314">.</span><span class="ident" id="4479315">CONST</span><span class="op" id="4479320">,</span>&nbsp;<span class="ident" id="4479322">token</span><span class="op" id="4479327">.</span><span class="ident" id="4479328">TYPE</span><span class="op" id="4479332">,</span>&nbsp;<span class="ident" id="4479334">token</span><span class="op" id="4479339">.</span><span class="ident" id="4479340">VAR</span><span class="op" id="4479343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479348">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479379">if</span>&nbsp;<span class="ident" id="4479382">p</span><span class="op" id="4479383">.</span><span class="ident" id="4479384">pos</span>&nbsp;<span class="op" id="4479388">==</span>&nbsp;<span class="ident" id="4479391">p</span><span class="op" id="4479392">.</span><span class="ident" id="4479393">syncPos</span>&nbsp;<span class="op" id="4479401">&amp;&amp;</span>&nbsp;<span class="ident" id="4479404">p</span><span class="op" id="4479405">.</span><span class="ident" id="4479406">syncCnt</span>&nbsp;<span class="op" id="4479414">&lt;</span>&nbsp;<span class="num" id="4479416">10</span>&nbsp;<span class="op" id="4479419">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479425">p</span><span class="op" id="4479426">.</span><span class="ident" id="4479427">syncCnt</span><span class="op" id="4479434">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479441">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479456">if</span>&nbsp;<span class="ident" id="4479459">p</span><span class="op" id="4479460">.</span><span class="ident" id="4479461">pos</span>&nbsp;<span class="op" id="4479465">&gt;</span>&nbsp;<span class="ident" id="4479467">p</span><span class="op" id="4479468">.</span><span class="ident" id="4479469">syncPos</span>&nbsp;<span class="op" id="4479477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479483">p</span><span class="op" id="4479484">.</span><span class="ident" id="4479485">syncPos</span>&nbsp;<span class="op" id="4479493">=</span>&nbsp;<span class="ident" id="4479495">p</span><span class="op" id="4479496">.</span><span class="ident" id="4479497">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479505">p</span><span class="op" id="4479506">.</span><span class="ident" id="4479507">syncCnt</span>&nbsp;<span class="op" id="4479515">=</span>&nbsp;<span class="num" id="4479517">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479523">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479537">case</span>&nbsp;<span class="ident" id="4479542">token</span><span class="op" id="4479547">.</span><span class="ident" id="4479548">EOF</span><span class="op" id="4479551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479556">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479569">p</span><span class="op" id="4479570">.</span><span class="ident" id="4479571">next</span><span class="op" id="4479575">(</span><span class="op" id="4479576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479579">}</span><br>
<span class="lineno"></span><span class="op" id="4479581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="4479584">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4479654">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="4479726">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4479763">//</span><br>
<span class="lineno"></span><span class="comment" id="4479766">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="4479841">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4479915">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4479994">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4480069">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="4480082">//</span><br>
<span class="lineno">505</span><span class="keyword" id="4480085">func</span>&nbsp;<span class="op" id="4480090">(</span><span class="ident" id="4480091">p</span>&nbsp;<span class="op" id="4480093">*</span><span class="ident" id="4480094">parser</span><span class="op" id="4480100">)</span>&nbsp;<span class="ident" id="4480102">safePos</span><span class="op" id="4480109">(</span><span class="ident" id="4480110">pos</span>&nbsp;<span class="ident" id="4480114">token</span><span class="op" id="4480119">.</span><span class="ident" id="4480120">Pos</span><span class="op" id="4480123">)</span>&nbsp;<span class="op" id="4480125">(</span><span class="ident" id="4480126">res</span>&nbsp;<span class="ident" id="4480130">token</span><span class="op" id="4480135">.</span><span class="ident" id="4480136">Pos</span><span class="op" id="4480139">)</span>&nbsp;<span class="op" id="4480141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480144">defer</span>&nbsp;<span class="keyword" id="4480150">func</span><span class="op" id="4480154">(</span><span class="op" id="4480155">)</span>&nbsp;<span class="op" id="4480157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480161">if</span>&nbsp;<span class="builtinfunc" id="4480164">recover</span><span class="op" id="4480171">(</span><span class="op" id="4480172">)</span>&nbsp;<span class="op" id="4480174">!=</span>&nbsp;<span class="ident" id="4480177">nil</span>&nbsp;<span class="op" id="4480181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480186">res</span>&nbsp;<span class="op" id="4480190">=</span>&nbsp;<span class="ident" id="4480192">token</span><span class="op" id="4480197">.</span><span class="ident" id="4480198">Pos</span><span class="op" id="4480201">(</span><span class="ident" id="4480202">p</span><span class="op" id="4480203">.</span><span class="ident" id="4480204">file</span><span class="op" id="4480208">.</span><span class="ident" id="4480209">Base</span><span class="op" id="4480213">(</span><span class="op" id="4480214">)</span>&nbsp;<span class="op" id="4480216">+</span>&nbsp;<span class="ident" id="4480218">p</span><span class="op" id="4480219">.</span><span class="ident" id="4480220">file</span><span class="op" id="4480224">.</span><span class="ident" id="4480225">Size</span><span class="op" id="4480229">(</span><span class="op" id="4480230">)</span><span class="op" id="4480231">)</span>&nbsp;<span class="comment" id="4480233">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480251">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480254">}</span><span class="op" id="4480255">(</span><span class="op" id="4480256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480259">_</span>&nbsp;<span class="op" id="4480261">=</span>&nbsp;<span class="ident" id="4480263">p</span><span class="op" id="4480264">.</span><span class="ident" id="4480265">file</span><span class="op" id="4480269">.</span><span class="ident" id="4480270">Offset</span><span class="op" id="4480276">(</span><span class="ident" id="4480277">pos</span><span class="op" id="4480280">)</span>&nbsp;<span class="comment" id="4480282">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480330">return</span>&nbsp;<span class="ident" id="4480337">pos</span><br>
<span class="lineno"></span><span class="op" id="4480341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="4480344">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4480424">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4480440">func</span>&nbsp;<span class="op" id="4480445">(</span><span class="ident" id="4480446">p</span>&nbsp;<span class="op" id="4480448">*</span><span class="ident" id="4480449">parser</span><span class="op" id="4480455">)</span>&nbsp;<span class="ident" id="4480457">parseIdent</span><span class="op" id="4480467">(</span><span class="op" id="4480468">)</span>&nbsp;<span class="op" id="4480470">*</span><span class="ident" id="4480471">ast</span><span class="op" id="4480474">.</span><span class="ident" id="4480475">Ident</span>&nbsp;<span class="op" id="4480481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480484">pos</span>&nbsp;<span class="op" id="4480488">:=</span>&nbsp;<span class="ident" id="4480491">p</span><span class="op" id="4480492">.</span><span class="ident" id="4480493">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480498">name</span>&nbsp;<span class="op" id="4480503">:=</span>&nbsp;<span class="string" id="4480506">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480511">if</span>&nbsp;<span class="ident" id="4480514">p</span><span class="op" id="4480515">.</span><span class="ident" id="4480516">tok</span>&nbsp;<span class="op" id="4480520">==</span>&nbsp;<span class="ident" id="4480523">token</span><span class="op" id="4480528">.</span><span class="ident" id="4480529">IDENT</span>&nbsp;<span class="op" id="4480535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480539">name</span>&nbsp;<span class="op" id="4480544">=</span>&nbsp;<span class="ident" id="4480546">p</span><span class="op" id="4480547">.</span><span class="ident" id="4480548">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480554">p</span><span class="op" id="4480555">.</span><span class="ident" id="4480556">next</span><span class="op" id="4480560">(</span><span class="op" id="4480561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480564">}</span>&nbsp;<span class="keyword" id="4480566">else</span>&nbsp;<span class="op" id="4480571">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480575">p</span><span class="op" id="4480576">.</span><span class="ident" id="4480577">expect</span><span class="op" id="4480583">(</span><span class="ident" id="4480584">token</span><span class="op" id="4480589">.</span><span class="ident" id="4480590">IDENT</span><span class="op" id="4480595">)</span>&nbsp;<span class="comment" id="4480597">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480632">return</span>&nbsp;<span class="op" id="4480639">&amp;</span><span class="ident" id="4480640">ast</span><span class="op" id="4480643">.</span><span class="ident" id="4480644">Ident</span><span class="op" id="4480649">{</span><span class="ident" id="4480650">NamePos</span><span class="op" id="4480657">:</span>&nbsp;<span class="ident" id="4480659">pos</span><span class="op" id="4480662">,</span>&nbsp;<span class="ident" id="4480664">Name</span><span class="op" id="4480668">:</span>&nbsp;<span class="ident" id="4480670">name</span><span class="op" id="4480674">}</span><br>
<span class="lineno"></span><span class="op" id="4480676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="4480679">func</span>&nbsp;<span class="op" id="4480684">(</span><span class="ident" id="4480685">p</span>&nbsp;<span class="op" id="4480687">*</span><span class="ident" id="4480688">parser</span><span class="op" id="4480694">)</span>&nbsp;<span class="ident" id="4480696">parseIdentList</span><span class="op" id="4480710">(</span><span class="op" id="4480711">)</span>&nbsp;<span class="op" id="4480713">(</span><span class="ident" id="4480714">list</span>&nbsp;<span class="op" id="4480719">[</span><span class="op" id="4480720">]</span><span class="op" id="4480721">*</span><span class="ident" id="4480722">ast</span><span class="op" id="4480725">.</span><span class="ident" id="4480726">Ident</span><span class="op" id="4480731">)</span>&nbsp;<span class="op" id="4480733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480736">if</span>&nbsp;<span class="ident" id="4480739">p</span><span class="op" id="4480740">.</span><span class="ident" id="4480741">trace</span>&nbsp;<span class="op" id="4480747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480751">defer</span>&nbsp;<span class="ident" id="4480757">un</span><span class="op" id="4480759">(</span><span class="ident" id="4480760">trace</span><span class="op" id="4480765">(</span><span class="ident" id="4480766">p</span><span class="op" id="4480767">,</span>&nbsp;<span class="string" id="4480769">&#34;IdentList&#34;</span><span class="op" id="4480780">)</span><span class="op" id="4480781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480788">list</span>&nbsp;<span class="op" id="4480793">=</span>&nbsp;<span class="builtinfunc" id="4480795">append</span><span class="op" id="4480801">(</span><span class="ident" id="4480802">list</span><span class="op" id="4480806">,</span>&nbsp;<span class="ident" id="4480808">p</span><span class="op" id="4480809">.</span><span class="ident" id="4480810">parseIdent</span><span class="op" id="4480820">(</span><span class="op" id="4480821">)</span><span class="op" id="4480822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480825">for</span>&nbsp;<span class="ident" id="4480829">p</span><span class="op" id="4480830">.</span><span class="ident" id="4480831">tok</span>&nbsp;<span class="op" id="4480835">==</span>&nbsp;<span class="ident" id="4480838">token</span><span class="op" id="4480843">.</span><span class="ident" id="4480844">COMMA</span>&nbsp;<span class="op" id="4480850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480854">p</span><span class="op" id="4480855">.</span><span class="ident" id="4480856">next</span><span class="op" id="4480860">(</span><span class="op" id="4480861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480865">list</span>&nbsp;<span class="op" id="4480870">=</span>&nbsp;<span class="builtinfunc" id="4480872">append</span><span class="op" id="4480878">(</span><span class="ident" id="4480879">list</span><span class="op" id="4480883">,</span>&nbsp;<span class="ident" id="4480885">p</span><span class="op" id="4480886">.</span><span class="ident" id="4480887">parseIdent</span><span class="op" id="4480897">(</span><span class="op" id="4480898">)</span><span class="op" id="4480899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480902">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480906">return</span><br>
<span class="lineno"></span><span class="op" id="4480913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4480916">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="4480996">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4481019">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4481098">func</span>&nbsp;<span class="op" id="4481103">(</span><span class="ident" id="4481104">p</span>&nbsp;<span class="op" id="4481106">*</span><span class="ident" id="4481107">parser</span><span class="op" id="4481113">)</span>&nbsp;<span class="ident" id="4481115">parseExprList</span><span class="op" id="4481128">(</span><span class="ident" id="4481129">lhs</span>&nbsp;<span class="builtintype" id="4481133">bool</span><span class="op" id="4481137">)</span>&nbsp;<span class="op" id="4481139">(</span><span class="ident" id="4481140">list</span>&nbsp;<span class="op" id="4481145">[</span><span class="op" id="4481146">]</span><span class="ident" id="4481147">ast</span><span class="op" id="4481150">.</span><span class="ident" id="4481151">Expr</span><span class="op" id="4481155">)</span>&nbsp;<span class="op" id="4481157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481160">if</span>&nbsp;<span class="ident" id="4481163">p</span><span class="op" id="4481164">.</span><span class="ident" id="4481165">trace</span>&nbsp;<span class="op" id="4481171">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481175">defer</span>&nbsp;<span class="ident" id="4481181">un</span><span class="op" id="4481183">(</span><span class="ident" id="4481184">trace</span><span class="op" id="4481189">(</span><span class="ident" id="4481190">p</span><span class="op" id="4481191">,</span>&nbsp;<span class="string" id="4481193">&#34;ExpressionList&#34;</span><span class="op" id="4481209">)</span><span class="op" id="4481210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4481213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481217">list</span>&nbsp;<span class="op" id="4481222">=</span>&nbsp;<span class="builtinfunc" id="4481224">append</span><span class="op" id="4481230">(</span><span class="ident" id="4481231">list</span><span class="op" id="4481235">,</span>&nbsp;<span class="ident" id="4481237">p</span><span class="op" id="4481238">.</span><span class="ident" id="4481239">checkExpr</span><span class="op" id="4481248">(</span><span class="ident" id="4481249">p</span><span class="op" id="4481250">.</span><span class="ident" id="4481251">parseExpr</span><span class="op" id="4481260">(</span><span class="ident" id="4481261">lhs</span><span class="op" id="4481264">)</span><span class="op" id="4481265">)</span><span class="op" id="4481266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481269">for</span>&nbsp;<span class="ident" id="4481273">p</span><span class="op" id="4481274">.</span><span class="ident" id="4481275">tok</span>&nbsp;<span class="op" id="4481279">==</span>&nbsp;<span class="ident" id="4481282">token</span><span class="op" id="4481287">.</span><span class="ident" id="4481288">COMMA</span>&nbsp;<span class="op" id="4481294">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481298">p</span><span class="op" id="4481299">.</span><span class="ident" id="4481300">next</span><span class="op" id="4481304">(</span><span class="op" id="4481305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481309">list</span>&nbsp;<span class="op" id="4481314">=</span>&nbsp;<span class="builtinfunc" id="4481316">append</span><span class="op" id="4481322">(</span><span class="ident" id="4481323">list</span><span class="op" id="4481327">,</span>&nbsp;<span class="ident" id="4481329">p</span><span class="op" id="4481330">.</span><span class="ident" id="4481331">checkExpr</span><span class="op" id="4481340">(</span><span class="ident" id="4481341">p</span><span class="op" id="4481342">.</span><span class="ident" id="4481343">parseExpr</span><span class="op" id="4481352">(</span><span class="ident" id="4481353">lhs</span><span class="op" id="4481356">)</span><span class="op" id="4481357">)</span><span class="op" id="4481358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4481361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481365">return</span><br>
<span class="lineno">560</span><span class="op" id="4481372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4481375">func</span>&nbsp;<span class="op" id="4481380">(</span><span class="ident" id="4481381">p</span>&nbsp;<span class="op" id="4481383">*</span><span class="ident" id="4481384">parser</span><span class="op" id="4481390">)</span>&nbsp;<span class="ident" id="4481392">parseLhsList</span><span class="op" id="4481404">(</span><span class="op" id="4481405">)</span>&nbsp;<span class="op" id="4481407">[</span><span class="op" id="4481408">]</span><span class="ident" id="4481409">ast</span><span class="op" id="4481412">.</span><span class="ident" id="4481413">Expr</span>&nbsp;<span class="op" id="4481418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481421">old</span>&nbsp;<span class="op" id="4481425">:=</span>&nbsp;<span class="ident" id="4481428">p</span><span class="op" id="4481429">.</span><span class="ident" id="4481430">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481437">p</span><span class="op" id="4481438">.</span><span class="ident" id="4481439">inRhs</span>&nbsp;<span class="op" id="4481445">=</span>&nbsp;<span class="builtintype" id="4481447">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481454">list</span>&nbsp;<span class="op" id="4481459">:=</span>&nbsp;<span class="ident" id="4481462">p</span><span class="op" id="4481463">.</span><span class="ident" id="4481464">parseExprList</span><span class="op" id="4481477">(</span><span class="builtintype" id="4481478">true</span><span class="op" id="4481482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481485">switch</span>&nbsp;<span class="ident" id="4481492">p</span><span class="op" id="4481493">.</span><span class="ident" id="4481494">tok</span>&nbsp;<span class="op" id="4481498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481501">case</span>&nbsp;<span class="ident" id="4481506">token</span><span class="op" id="4481511">.</span><span class="ident" id="4481512">DEFINE</span><span class="op" id="4481518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481522">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481563">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481605">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481665">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481690">case</span>&nbsp;<span class="ident" id="4481695">token</span><span class="op" id="4481700">.</span><span class="ident" id="4481701">COLON</span><span class="op" id="4481706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481710">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481780">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481852">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481881">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4481938">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482009">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482078">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482123">default</span><span class="op" id="4482130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482134">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482178">for</span>&nbsp;<span class="ident" id="4482182">_</span><span class="op" id="4482183">,</span>&nbsp;<span class="ident" id="4482185">x</span>&nbsp;<span class="op" id="4482187">:=</span>&nbsp;<span class="keyword" id="4482190">range</span>&nbsp;<span class="ident" id="4482196">list</span>&nbsp;<span class="op" id="4482201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482206">p</span><span class="op" id="4482207">.</span><span class="ident" id="4482208">resolve</span><span class="op" id="4482215">(</span><span class="ident" id="4482216">x</span><span class="op" id="4482217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482221">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482227">p</span><span class="op" id="4482228">.</span><span class="ident" id="4482229">inRhs</span>&nbsp;<span class="op" id="4482235">=</span>&nbsp;<span class="ident" id="4482237">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482242">return</span>&nbsp;<span class="ident" id="4482249">list</span><br>
<span class="lineno"></span><span class="op" id="4482254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4482257">func</span>&nbsp;<span class="op" id="4482262">(</span><span class="ident" id="4482263">p</span>&nbsp;<span class="op" id="4482265">*</span><span class="ident" id="4482266">parser</span><span class="op" id="4482272">)</span>&nbsp;<span class="ident" id="4482274">parseRhsList</span><span class="op" id="4482286">(</span><span class="op" id="4482287">)</span>&nbsp;<span class="op" id="4482289">[</span><span class="op" id="4482290">]</span><span class="ident" id="4482291">ast</span><span class="op" id="4482294">.</span><span class="ident" id="4482295">Expr</span>&nbsp;<span class="op" id="4482300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482303">old</span>&nbsp;<span class="op" id="4482307">:=</span>&nbsp;<span class="ident" id="4482310">p</span><span class="op" id="4482311">.</span><span class="ident" id="4482312">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482319">p</span><span class="op" id="4482320">.</span><span class="ident" id="4482321">inRhs</span>&nbsp;<span class="op" id="4482327">=</span>&nbsp;<span class="builtintype" id="4482329">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482335">list</span>&nbsp;<span class="op" id="4482340">:=</span>&nbsp;<span class="ident" id="4482343">p</span><span class="op" id="4482344">.</span><span class="ident" id="4482345">parseExprList</span><span class="op" id="4482358">(</span><span class="builtintype" id="4482359">false</span><span class="op" id="4482364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482367">p</span><span class="op" id="4482368">.</span><span class="ident" id="4482369">inRhs</span>&nbsp;<span class="op" id="4482375">=</span>&nbsp;<span class="ident" id="4482377">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482382">return</span>&nbsp;<span class="ident" id="4482389">list</span><br>
<span class="lineno"></span><span class="op" id="4482394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4482397">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4482477">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4482487">func</span>&nbsp;<span class="op" id="4482492">(</span><span class="ident" id="4482493">p</span>&nbsp;<span class="op" id="4482495">*</span><span class="ident" id="4482496">parser</span><span class="op" id="4482502">)</span>&nbsp;<span class="ident" id="4482504">parseType</span><span class="op" id="4482513">(</span><span class="op" id="4482514">)</span>&nbsp;<span class="ident" id="4482516">ast</span><span class="op" id="4482519">.</span><span class="ident" id="4482520">Expr</span>&nbsp;<span class="op" id="4482525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482528">if</span>&nbsp;<span class="ident" id="4482531">p</span><span class="op" id="4482532">.</span><span class="ident" id="4482533">trace</span>&nbsp;<span class="op" id="4482539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482543">defer</span>&nbsp;<span class="ident" id="4482549">un</span><span class="op" id="4482551">(</span><span class="ident" id="4482552">trace</span><span class="op" id="4482557">(</span><span class="ident" id="4482558">p</span><span class="op" id="4482559">,</span>&nbsp;<span class="string" id="4482561">&#34;Type&#34;</span><span class="op" id="4482567">)</span><span class="op" id="4482568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482571">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482575">typ</span>&nbsp;<span class="op" id="4482579">:=</span>&nbsp;<span class="ident" id="4482582">p</span><span class="op" id="4482583">.</span><span class="ident" id="4482584">tryType</span><span class="op" id="4482591">(</span><span class="op" id="4482592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482596">if</span>&nbsp;<span class="ident" id="4482599">typ</span>&nbsp;<span class="op" id="4482603">==</span>&nbsp;<span class="ident" id="4482606">nil</span>&nbsp;<span class="op" id="4482610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482614">pos</span>&nbsp;<span class="op" id="4482618">:=</span>&nbsp;<span class="ident" id="4482621">p</span><span class="op" id="4482622">.</span><span class="ident" id="4482623">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482629">p</span><span class="op" id="4482630">.</span><span class="ident" id="4482631">errorExpected</span><span class="op" id="4482644">(</span><span class="ident" id="4482645">pos</span><span class="op" id="4482648">,</span>&nbsp;<span class="string" id="4482650">&#34;type&#34;</span><span class="op" id="4482656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482660">p</span><span class="op" id="4482661">.</span><span class="ident" id="4482662">next</span><span class="op" id="4482666">(</span><span class="op" id="4482667">)</span>&nbsp;<span class="comment" id="4482669">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482688">return</span>&nbsp;<span class="op" id="4482695">&amp;</span><span class="ident" id="4482696">ast</span><span class="op" id="4482699">.</span><span class="ident" id="4482700">BadExpr</span><span class="op" id="4482707">{</span><span class="ident" id="4482708">From</span><span class="op" id="4482712">:</span>&nbsp;<span class="ident" id="4482714">pos</span><span class="op" id="4482717">,</span>&nbsp;<span class="ident" id="4482719">To</span><span class="op" id="4482721">:</span>&nbsp;<span class="ident" id="4482723">p</span><span class="op" id="4482724">.</span><span class="ident" id="4482725">pos</span><span class="op" id="4482728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482735">return</span>&nbsp;<span class="ident" id="4482742">typ</span><br>
<span class="lineno"></span><span class="op" id="4482746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4482749">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4482804">func</span>&nbsp;<span class="op" id="4482809">(</span><span class="ident" id="4482810">p</span>&nbsp;<span class="op" id="4482812">*</span><span class="ident" id="4482813">parser</span><span class="op" id="4482819">)</span>&nbsp;<span class="ident" id="4482821">parseTypeName</span><span class="op" id="4482834">(</span><span class="op" id="4482835">)</span>&nbsp;<span class="ident" id="4482837">ast</span><span class="op" id="4482840">.</span><span class="ident" id="4482841">Expr</span>&nbsp;<span class="op" id="4482846">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482849">if</span>&nbsp;<span class="ident" id="4482852">p</span><span class="op" id="4482853">.</span><span class="ident" id="4482854">trace</span>&nbsp;<span class="op" id="4482860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482864">defer</span>&nbsp;<span class="ident" id="4482870">un</span><span class="op" id="4482872">(</span><span class="ident" id="4482873">trace</span><span class="op" id="4482878">(</span><span class="ident" id="4482879">p</span><span class="op" id="4482880">,</span>&nbsp;<span class="string" id="4482882">&#34;TypeName&#34;</span><span class="op" id="4482892">)</span><span class="op" id="4482893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482900">ident</span>&nbsp;<span class="op" id="4482906">:=</span>&nbsp;<span class="ident" id="4482909">p</span><span class="op" id="4482910">.</span><span class="ident" id="4482911">parseIdent</span><span class="op" id="4482921">(</span><span class="op" id="4482922">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482925">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482992">if</span>&nbsp;<span class="ident" id="4482995">p</span><span class="op" id="4482996">.</span><span class="ident" id="4482997">tok</span>&nbsp;<span class="op" id="4483001">==</span>&nbsp;<span class="ident" id="4483004">token</span><span class="op" id="4483009">.</span><span class="ident" id="4483010">PERIOD</span>&nbsp;<span class="op" id="4483017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483021">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483050">p</span><span class="op" id="4483051">.</span><span class="ident" id="4483052">next</span><span class="op" id="4483056">(</span><span class="op" id="4483057">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483061">p</span><span class="op" id="4483062">.</span><span class="ident" id="4483063">resolve</span><span class="op" id="4483070">(</span><span class="ident" id="4483071">ident</span><span class="op" id="4483076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483080">sel</span>&nbsp;<span class="op" id="4483084">:=</span>&nbsp;<span class="ident" id="4483087">p</span><span class="op" id="4483088">.</span><span class="ident" id="4483089">parseIdent</span><span class="op" id="4483099">(</span><span class="op" id="4483100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483104">return</span>&nbsp;<span class="op" id="4483111">&amp;</span><span class="ident" id="4483112">ast</span><span class="op" id="4483115">.</span><span class="ident" id="4483116">SelectorExpr</span><span class="op" id="4483128">{</span><span class="ident" id="4483129">X</span><span class="op" id="4483130">:</span>&nbsp;<span class="ident" id="4483132">ident</span><span class="op" id="4483137">,</span>&nbsp;<span class="ident" id="4483139">Sel</span><span class="op" id="4483142">:</span>&nbsp;<span class="ident" id="4483144">sel</span><span class="op" id="4483147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483154">return</span>&nbsp;<span class="ident" id="4483161">ident</span><br>
<span class="lineno"></span><span class="op" id="4483167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4483170">func</span>&nbsp;<span class="op" id="4483175">(</span><span class="ident" id="4483176">p</span>&nbsp;<span class="op" id="4483178">*</span><span class="ident" id="4483179">parser</span><span class="op" id="4483185">)</span>&nbsp;<span class="ident" id="4483187">parseArrayType</span><span class="op" id="4483201">(</span><span class="op" id="4483202">)</span>&nbsp;<span class="ident" id="4483204">ast</span><span class="op" id="4483207">.</span><span class="ident" id="4483208">Expr</span>&nbsp;<span class="op" id="4483213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483216">if</span>&nbsp;<span class="ident" id="4483219">p</span><span class="op" id="4483220">.</span><span class="ident" id="4483221">trace</span>&nbsp;<span class="op" id="4483227">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483231">defer</span>&nbsp;<span class="ident" id="4483237">un</span><span class="op" id="4483239">(</span><span class="ident" id="4483240">trace</span><span class="op" id="4483245">(</span><span class="ident" id="4483246">p</span><span class="op" id="4483247">,</span>&nbsp;<span class="string" id="4483249">&#34;ArrayType&#34;</span><span class="op" id="4483260">)</span><span class="op" id="4483261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483268">lbrack</span>&nbsp;<span class="op" id="4483275">:=</span>&nbsp;<span class="ident" id="4483278">p</span><span class="op" id="4483279">.</span><span class="ident" id="4483280">expect</span><span class="op" id="4483286">(</span><span class="ident" id="4483287">token</span><span class="op" id="4483292">.</span><span class="ident" id="4483293">LBRACK</span><span class="op" id="4483299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483302">p</span><span class="op" id="4483303">.</span><span class="ident" id="4483304">exprLev</span><span class="op" id="4483311">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483315">var</span>&nbsp;<span class="builtinfunc" id="4483319">len</span>&nbsp;<span class="ident" id="4483323">ast</span><span class="op" id="4483326">.</span><span class="ident" id="4483327">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483333">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483392">if</span>&nbsp;<span class="ident" id="4483395">p</span><span class="op" id="4483396">.</span><span class="ident" id="4483397">tok</span>&nbsp;<span class="op" id="4483401">==</span>&nbsp;<span class="ident" id="4483404">token</span><span class="op" id="4483409">.</span><span class="ident" id="4483410">ELLIPSIS</span>&nbsp;<span class="op" id="4483419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4483423">len</span>&nbsp;<span class="op" id="4483427">=</span>&nbsp;<span class="op" id="4483429">&amp;</span><span class="ident" id="4483430">ast</span><span class="op" id="4483433">.</span><span class="ident" id="4483434">Ellipsis</span><span class="op" id="4483442">{</span><span class="ident" id="4483443">Ellipsis</span><span class="op" id="4483451">:</span>&nbsp;<span class="ident" id="4483453">p</span><span class="op" id="4483454">.</span><span class="ident" id="4483455">pos</span><span class="op" id="4483458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483462">p</span><span class="op" id="4483463">.</span><span class="ident" id="4483464">next</span><span class="op" id="4483468">(</span><span class="op" id="4483469">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483472">}</span>&nbsp;<span class="keyword" id="4483474">else</span>&nbsp;<span class="keyword" id="4483479">if</span>&nbsp;<span class="ident" id="4483482">p</span><span class="op" id="4483483">.</span><span class="ident" id="4483484">tok</span>&nbsp;<span class="op" id="4483488">!=</span>&nbsp;<span class="ident" id="4483491">token</span><span class="op" id="4483496">.</span><span class="ident" id="4483497">RBRACK</span>&nbsp;<span class="op" id="4483504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4483508">len</span>&nbsp;<span class="op" id="4483512">=</span>&nbsp;<span class="ident" id="4483514">p</span><span class="op" id="4483515">.</span><span class="ident" id="4483516">parseRhs</span><span class="op" id="4483524">(</span><span class="op" id="4483525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483531">p</span><span class="op" id="4483532">.</span><span class="ident" id="4483533">exprLev</span><span class="op" id="4483540">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483544">p</span><span class="op" id="4483545">.</span><span class="ident" id="4483546">expect</span><span class="op" id="4483552">(</span><span class="ident" id="4483553">token</span><span class="op" id="4483558">.</span><span class="ident" id="4483559">RBRACK</span><span class="op" id="4483565">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483568">elt</span>&nbsp;<span class="op" id="4483572">:=</span>&nbsp;<span class="ident" id="4483575">p</span><span class="op" id="4483576">.</span><span class="ident" id="4483577">parseType</span><span class="op" id="4483586">(</span><span class="op" id="4483587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483591">return</span>&nbsp;<span class="op" id="4483598">&amp;</span><span class="ident" id="4483599">ast</span><span class="op" id="4483602">.</span><span class="ident" id="4483603">ArrayType</span><span class="op" id="4483612">{</span><span class="ident" id="4483613">Lbrack</span><span class="op" id="4483619">:</span>&nbsp;<span class="ident" id="4483621">lbrack</span><span class="op" id="4483627">,</span>&nbsp;<span class="ident" id="4483629">Len</span><span class="op" id="4483632">:</span>&nbsp;<span class="builtinfunc" id="4483634">len</span><span class="op" id="4483637">,</span>&nbsp;<span class="ident" id="4483639">Elt</span><span class="op" id="4483642">:</span>&nbsp;<span class="ident" id="4483644">elt</span><span class="op" id="4483647">}</span><br>
<span class="lineno"></span><span class="op" id="4483649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="4483652">func</span>&nbsp;<span class="op" id="4483657">(</span><span class="ident" id="4483658">p</span>&nbsp;<span class="op" id="4483660">*</span><span class="ident" id="4483661">parser</span><span class="op" id="4483667">)</span>&nbsp;<span class="ident" id="4483669">makeIdentList</span><span class="op" id="4483682">(</span><span class="ident" id="4483683">list</span>&nbsp;<span class="op" id="4483688">[</span><span class="op" id="4483689">]</span><span class="ident" id="4483690">ast</span><span class="op" id="4483693">.</span><span class="ident" id="4483694">Expr</span><span class="op" id="4483698">)</span>&nbsp;<span class="op" id="4483700">[</span><span class="op" id="4483701">]</span><span class="op" id="4483702">*</span><span class="ident" id="4483703">ast</span><span class="op" id="4483706">.</span><span class="ident" id="4483707">Ident</span>&nbsp;<span class="op" id="4483713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483716">idents</span>&nbsp;<span class="op" id="4483723">:=</span>&nbsp;<span class="builtinfunc" id="4483726">make</span><span class="op" id="4483730">(</span><span class="op" id="4483731">[</span><span class="op" id="4483732">]</span><span class="op" id="4483733">*</span><span class="ident" id="4483734">ast</span><span class="op" id="4483737">.</span><span class="ident" id="4483738">Ident</span><span class="op" id="4483743">,</span>&nbsp;<span class="builtinfunc" id="4483745">len</span><span class="op" id="4483748">(</span><span class="ident" id="4483749">list</span><span class="op" id="4483753">)</span><span class="op" id="4483754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483757">for</span>&nbsp;<span class="ident" id="4483761">i</span><span class="op" id="4483762">,</span>&nbsp;<span class="ident" id="4483764">x</span>&nbsp;<span class="op" id="4483766">:=</span>&nbsp;<span class="keyword" id="4483769">range</span>&nbsp;<span class="ident" id="4483775">list</span>&nbsp;<span class="op" id="4483780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483784">ident</span><span class="op" id="4483789">,</span>&nbsp;<span class="ident" id="4483791">isIdent</span>&nbsp;<span class="op" id="4483799">:=</span>&nbsp;<span class="ident" id="4483802">x</span><span class="op" id="4483803">.</span><span class="op" id="4483804">(</span><span class="op" id="4483805">*</span><span class="ident" id="4483806">ast</span><span class="op" id="4483809">.</span><span class="ident" id="4483810">Ident</span><span class="op" id="4483815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483819">if</span>&nbsp;<span class="op" id="4483822">!</span><span class="ident" id="4483823">isIdent</span>&nbsp;<span class="op" id="4483831">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483836">if</span>&nbsp;<span class="ident" id="4483839">_</span><span class="op" id="4483840">,</span>&nbsp;<span class="ident" id="4483842">isBad</span>&nbsp;<span class="op" id="4483848">:=</span>&nbsp;<span class="ident" id="4483851">x</span><span class="op" id="4483852">.</span><span class="op" id="4483853">(</span><span class="op" id="4483854">*</span><span class="ident" id="4483855">ast</span><span class="op" id="4483858">.</span><span class="ident" id="4483859">BadExpr</span><span class="op" id="4483866">)</span><span class="op" id="4483867">;</span>&nbsp;<span class="op" id="4483869">!</span><span class="ident" id="4483870">isBad</span>&nbsp;<span class="op" id="4483876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483882">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483925">p</span><span class="op" id="4483926">.</span><span class="ident" id="4483927">errorExpected</span><span class="op" id="4483940">(</span><span class="ident" id="4483941">x</span><span class="op" id="4483942">.</span><span class="ident" id="4483943">Pos</span><span class="op" id="4483946">(</span><span class="op" id="4483947">)</span><span class="op" id="4483948">,</span>&nbsp;<span class="string" id="4483950">&#34;identifier&#34;</span><span class="op" id="4483962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483972">ident</span>&nbsp;<span class="op" id="4483978">=</span>&nbsp;<span class="op" id="4483980">&amp;</span><span class="ident" id="4483981">ast</span><span class="op" id="4483984">.</span><span class="ident" id="4483985">Ident</span><span class="op" id="4483990">{</span><span class="ident" id="4483991">NamePos</span><span class="op" id="4483998">:</span>&nbsp;<span class="ident" id="4484000">x</span><span class="op" id="4484001">.</span><span class="ident" id="4484002">Pos</span><span class="op" id="4484005">(</span><span class="op" id="4484006">)</span><span class="op" id="4484007">,</span>&nbsp;<span class="ident" id="4484009">Name</span><span class="op" id="4484013">:</span>&nbsp;<span class="string" id="4484015">&#34;_&#34;</span><span class="op" id="4484018">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484026">idents</span><span class="op" id="4484032">[</span><span class="ident" id="4484033">i</span><span class="op" id="4484034">]</span>&nbsp;<span class="op" id="4484036">=</span>&nbsp;<span class="ident" id="4484038">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484048">return</span>&nbsp;<span class="ident" id="4484055">idents</span><br>
<span class="lineno"></span><span class="op" id="4484062">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4484065">func</span>&nbsp;<span class="op" id="4484070">(</span><span class="ident" id="4484071">p</span>&nbsp;<span class="op" id="4484073">*</span><span class="ident" id="4484074">parser</span><span class="op" id="4484080">)</span>&nbsp;<span class="ident" id="4484082">parseFieldDecl</span><span class="op" id="4484096">(</span><span class="ident" id="4484097">scope</span>&nbsp;<span class="op" id="4484103">*</span><span class="ident" id="4484104">ast</span><span class="op" id="4484107">.</span><span class="ident" id="4484108">Scope</span><span class="op" id="4484113">)</span>&nbsp;<span class="op" id="4484115">*</span><span class="ident" id="4484116">ast</span><span class="op" id="4484119">.</span><span class="ident" id="4484120">Field</span>&nbsp;<span class="op" id="4484126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484129">if</span>&nbsp;<span class="ident" id="4484132">p</span><span class="op" id="4484133">.</span><span class="ident" id="4484134">trace</span>&nbsp;<span class="op" id="4484140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484144">defer</span>&nbsp;<span class="ident" id="4484150">un</span><span class="op" id="4484152">(</span><span class="ident" id="4484153">trace</span><span class="op" id="4484158">(</span><span class="ident" id="4484159">p</span><span class="op" id="4484160">,</span>&nbsp;<span class="string" id="4484162">&#34;FieldDecl&#34;</span><span class="op" id="4484173">)</span><span class="op" id="4484174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484177">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484181">doc</span>&nbsp;<span class="op" id="4484185">:=</span>&nbsp;<span class="ident" id="4484188">p</span><span class="op" id="4484189">.</span><span class="ident" id="4484190">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4484204">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484218">list</span><span class="op" id="4484222">,</span>&nbsp;<span class="ident" id="4484224">typ</span>&nbsp;<span class="op" id="4484228">:=</span>&nbsp;<span class="ident" id="4484231">p</span><span class="op" id="4484232">.</span><span class="ident" id="4484233">parseVarList</span><span class="op" id="4484245">(</span><span class="builtintype" id="4484246">false</span><span class="op" id="4484251">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4484255">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484263">var</span>&nbsp;<span class="ident" id="4484267">tag</span>&nbsp;<span class="op" id="4484271">*</span><span class="ident" id="4484272">ast</span><span class="op" id="4484275">.</span><span class="ident" id="4484276">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484286">if</span>&nbsp;<span class="ident" id="4484289">p</span><span class="op" id="4484290">.</span><span class="ident" id="4484291">tok</span>&nbsp;<span class="op" id="4484295">==</span>&nbsp;<span class="ident" id="4484298">token</span><span class="op" id="4484303">.</span><span class="ident" id="4484304">STRING</span>&nbsp;<span class="op" id="4484311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484315">tag</span>&nbsp;<span class="op" id="4484319">=</span>&nbsp;<span class="op" id="4484321">&amp;</span><span class="ident" id="4484322">ast</span><span class="op" id="4484325">.</span><span class="ident" id="4484326">BasicLit</span><span class="op" id="4484334">{</span><span class="ident" id="4484335">ValuePos</span><span class="op" id="4484343">:</span>&nbsp;<span class="ident" id="4484345">p</span><span class="op" id="4484346">.</span><span class="ident" id="4484347">pos</span><span class="op" id="4484350">,</span>&nbsp;<span class="ident" id="4484352">Kind</span><span class="op" id="4484356">:</span>&nbsp;<span class="ident" id="4484358">p</span><span class="op" id="4484359">.</span><span class="ident" id="4484360">tok</span><span class="op" id="4484363">,</span>&nbsp;<span class="ident" id="4484365">Value</span><span class="op" id="4484370">:</span>&nbsp;<span class="ident" id="4484372">p</span><span class="op" id="4484373">.</span><span class="ident" id="4484374">lit</span><span class="op" id="4484377">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484381">p</span><span class="op" id="4484382">.</span><span class="ident" id="4484383">next</span><span class="op" id="4484387">(</span><span class="op" id="4484388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4484395">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484412">var</span>&nbsp;<span class="ident" id="4484416">idents</span>&nbsp;<span class="op" id="4484423">[</span><span class="op" id="4484424">]</span><span class="op" id="4484425">*</span><span class="ident" id="4484426">ast</span><span class="op" id="4484429">.</span><span class="ident" id="4484430">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484437">if</span>&nbsp;<span class="ident" id="4484440">typ</span>&nbsp;<span class="op" id="4484444">!=</span>&nbsp;<span class="ident" id="4484447">nil</span>&nbsp;<span class="op" id="4484451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4484455">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484480">idents</span>&nbsp;<span class="op" id="4484487">=</span>&nbsp;<span class="ident" id="4484489">p</span><span class="op" id="4484490">.</span><span class="ident" id="4484491">makeIdentList</span><span class="op" id="4484504">(</span><span class="ident" id="4484505">list</span><span class="op" id="4484509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484512">}</span>&nbsp;<span class="keyword" id="4484514">else</span>&nbsp;<span class="op" id="4484519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4484523">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484560">typ</span>&nbsp;<span class="op" id="4484564">=</span>&nbsp;<span class="ident" id="4484566">list</span><span class="op" id="4484570">[</span><span class="num" id="4484571">0</span><span class="op" id="4484572">]</span>&nbsp;<span class="comment" id="4484574">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484615">if</span>&nbsp;<span class="ident" id="4484618">n</span>&nbsp;<span class="op" id="4484620">:=</span>&nbsp;<span class="builtinfunc" id="4484623">len</span><span class="op" id="4484626">(</span><span class="ident" id="4484627">list</span><span class="op" id="4484631">)</span><span class="op" id="4484632">;</span>&nbsp;<span class="ident" id="4484634">n</span>&nbsp;<span class="op" id="4484636">&gt;</span>&nbsp;<span class="num" id="4484638">1</span>&nbsp;<span class="op" id="4484640">||</span>&nbsp;<span class="op" id="4484643">!</span><span class="ident" id="4484644">isTypeName</span><span class="op" id="4484654">(</span><span class="ident" id="4484655">deref</span><span class="op" id="4484660">(</span><span class="ident" id="4484661">typ</span><span class="op" id="4484664">)</span><span class="op" id="4484665">)</span>&nbsp;<span class="op" id="4484667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484672">pos</span>&nbsp;<span class="op" id="4484676">:=</span>&nbsp;<span class="ident" id="4484679">typ</span><span class="op" id="4484682">.</span><span class="ident" id="4484683">Pos</span><span class="op" id="4484686">(</span><span class="op" id="4484687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484692">p</span><span class="op" id="4484693">.</span><span class="ident" id="4484694">errorExpected</span><span class="op" id="4484707">(</span><span class="ident" id="4484708">pos</span><span class="op" id="4484711">,</span>&nbsp;<span class="string" id="4484713">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="4484730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484735">typ</span>&nbsp;<span class="op" id="4484739">=</span>&nbsp;<span class="op" id="4484741">&amp;</span><span class="ident" id="4484742">ast</span><span class="op" id="4484745">.</span><span class="ident" id="4484746">BadExpr</span><span class="op" id="4484753">{</span><span class="ident" id="4484754">From</span><span class="op" id="4484758">:</span>&nbsp;<span class="ident" id="4484760">pos</span><span class="op" id="4484763">,</span>&nbsp;<span class="ident" id="4484765">To</span><span class="op" id="4484767">:</span>&nbsp;<span class="ident" id="4484769">p</span><span class="op" id="4484770">.</span><span class="ident" id="4484771">safePos</span><span class="op" id="4484778">(</span><span class="ident" id="4484779">list</span><span class="op" id="4484783">[</span><span class="ident" id="4484784">n</span><span class="op" id="4484785">-</span><span class="num" id="4484786">1</span><span class="op" id="4484787">]</span><span class="op" id="4484788">.</span><span class="ident" id="4484789">End</span><span class="op" id="4484792">(</span><span class="op" id="4484793">)</span><span class="op" id="4484794">)</span><span class="op" id="4484795">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484806">p</span><span class="op" id="4484807">.</span><span class="ident" id="4484808">expectSemi</span><span class="op" id="4484818">(</span><span class="op" id="4484819">)</span>&nbsp;<span class="comment" id="4484821">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484862">field</span>&nbsp;<span class="op" id="4484868">:=</span>&nbsp;<span class="op" id="4484871">&amp;</span><span class="ident" id="4484872">ast</span><span class="op" id="4484875">.</span><span class="ident" id="4484876">Field</span><span class="op" id="4484881">{</span><span class="ident" id="4484882">Doc</span><span class="op" id="4484885">:</span>&nbsp;<span class="ident" id="4484887">doc</span><span class="op" id="4484890">,</span>&nbsp;<span class="ident" id="4484892">Names</span><span class="op" id="4484897">:</span>&nbsp;<span class="ident" id="4484899">idents</span><span class="op" id="4484905">,</span>&nbsp;<span class="ident" id="4484907">Type</span><span class="op" id="4484911">:</span>&nbsp;<span class="ident" id="4484913">typ</span><span class="op" id="4484916">,</span>&nbsp;<span class="ident" id="4484918">Tag</span><span class="op" id="4484921">:</span>&nbsp;<span class="ident" id="4484923">tag</span><span class="op" id="4484926">,</span>&nbsp;<span class="ident" id="4484928">Comment</span><span class="op" id="4484935">:</span>&nbsp;<span class="ident" id="4484937">p</span><span class="op" id="4484938">.</span><span class="ident" id="4484939">lineComment</span><span class="op" id="4484950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484953">p</span><span class="op" id="4484954">.</span><span class="ident" id="4484955">declare</span><span class="op" id="4484962">(</span><span class="ident" id="4484963">field</span><span class="op" id="4484968">,</span>&nbsp;<span class="ident" id="4484970">nil</span><span class="op" id="4484973">,</span>&nbsp;<span class="ident" id="4484975">scope</span><span class="op" id="4484980">,</span>&nbsp;<span class="ident" id="4484982">ast</span><span class="op" id="4484985">.</span><span class="ident" id="4484986">Var</span><span class="op" id="4484989">,</span>&nbsp;<span class="ident" id="4484991">idents</span><span class="op" id="4484997">...</span><span class="op" id="4485000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485003">p</span><span class="op" id="4485004">.</span><span class="ident" id="4485005">resolve</span><span class="op" id="4485012">(</span><span class="ident" id="4485013">typ</span><span class="op" id="4485016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485020">return</span>&nbsp;<span class="ident" id="4485027">field</span><br>
<span class="lineno">715</span><span class="op" id="4485033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4485036">func</span>&nbsp;<span class="op" id="4485041">(</span><span class="ident" id="4485042">p</span>&nbsp;<span class="op" id="4485044">*</span><span class="ident" id="4485045">parser</span><span class="op" id="4485051">)</span>&nbsp;<span class="ident" id="4485053">parseStructType</span><span class="op" id="4485068">(</span><span class="op" id="4485069">)</span>&nbsp;<span class="op" id="4485071">*</span><span class="ident" id="4485072">ast</span><span class="op" id="4485075">.</span><span class="ident" id="4485076">StructType</span>&nbsp;<span class="op" id="4485087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485090">if</span>&nbsp;<span class="ident" id="4485093">p</span><span class="op" id="4485094">.</span><span class="ident" id="4485095">trace</span>&nbsp;<span class="op" id="4485101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485105">defer</span>&nbsp;<span class="ident" id="4485111">un</span><span class="op" id="4485113">(</span><span class="ident" id="4485114">trace</span><span class="op" id="4485119">(</span><span class="ident" id="4485120">p</span><span class="op" id="4485121">,</span>&nbsp;<span class="string" id="4485123">&#34;StructType&#34;</span><span class="op" id="4485135">)</span><span class="op" id="4485136">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485143">pos</span>&nbsp;<span class="op" id="4485147">:=</span>&nbsp;<span class="ident" id="4485150">p</span><span class="op" id="4485151">.</span><span class="ident" id="4485152">expect</span><span class="op" id="4485158">(</span><span class="ident" id="4485159">token</span><span class="op" id="4485164">.</span><span class="ident" id="4485165">STRUCT</span><span class="op" id="4485171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485174">lbrace</span>&nbsp;<span class="op" id="4485181">:=</span>&nbsp;<span class="ident" id="4485184">p</span><span class="op" id="4485185">.</span><span class="ident" id="4485186">expect</span><span class="op" id="4485192">(</span><span class="ident" id="4485193">token</span><span class="op" id="4485198">.</span><span class="ident" id="4485199">LBRACE</span><span class="op" id="4485205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485208">scope</span>&nbsp;<span class="op" id="4485214">:=</span>&nbsp;<span class="ident" id="4485217">ast</span><span class="op" id="4485220">.</span><span class="ident" id="4485221">NewScope</span><span class="op" id="4485229">(</span><span class="ident" id="4485230">nil</span><span class="op" id="4485233">)</span>&nbsp;<span class="comment" id="4485235">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485252">var</span>&nbsp;<span class="ident" id="4485256">list</span>&nbsp;<span class="op" id="4485261">[</span><span class="op" id="4485262">]</span><span class="op" id="4485263">*</span><span class="ident" id="4485264">ast</span><span class="op" id="4485267">.</span><span class="ident" id="4485268">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485275">for</span>&nbsp;<span class="ident" id="4485279">p</span><span class="op" id="4485280">.</span><span class="ident" id="4485281">tok</span>&nbsp;<span class="op" id="4485285">==</span>&nbsp;<span class="ident" id="4485288">token</span><span class="op" id="4485293">.</span><span class="ident" id="4485294">IDENT</span>&nbsp;<span class="op" id="4485300">||</span>&nbsp;<span class="ident" id="4485303">p</span><span class="op" id="4485304">.</span><span class="ident" id="4485305">tok</span>&nbsp;<span class="op" id="4485309">==</span>&nbsp;<span class="ident" id="4485312">token</span><span class="op" id="4485317">.</span><span class="ident" id="4485318">MUL</span>&nbsp;<span class="op" id="4485322">||</span>&nbsp;<span class="ident" id="4485325">p</span><span class="op" id="4485326">.</span><span class="ident" id="4485327">tok</span>&nbsp;<span class="op" id="4485331">==</span>&nbsp;<span class="ident" id="4485334">token</span><span class="op" id="4485339">.</span><span class="ident" id="4485340">LPAREN</span>&nbsp;<span class="op" id="4485347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4485351">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4485414">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4485477">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485536">list</span>&nbsp;<span class="op" id="4485541">=</span>&nbsp;<span class="builtinfunc" id="4485543">append</span><span class="op" id="4485549">(</span><span class="ident" id="4485550">list</span><span class="op" id="4485554">,</span>&nbsp;<span class="ident" id="4485556">p</span><span class="op" id="4485557">.</span><span class="ident" id="4485558">parseFieldDecl</span><span class="op" id="4485572">(</span><span class="ident" id="4485573">scope</span><span class="op" id="4485578">)</span><span class="op" id="4485579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485585">rbrace</span>&nbsp;<span class="op" id="4485592">:=</span>&nbsp;<span class="ident" id="4485595">p</span><span class="op" id="4485596">.</span><span class="ident" id="4485597">expect</span><span class="op" id="4485603">(</span><span class="ident" id="4485604">token</span><span class="op" id="4485609">.</span><span class="ident" id="4485610">RBRACE</span><span class="op" id="4485616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485620">return</span>&nbsp;<span class="op" id="4485627">&amp;</span><span class="ident" id="4485628">ast</span><span class="op" id="4485631">.</span><span class="ident" id="4485632">StructType</span><span class="op" id="4485642">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485646">Struct</span><span class="op" id="4485652">:</span>&nbsp;<span class="ident" id="4485654">pos</span><span class="op" id="4485657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485661">Fields</span><span class="op" id="4485667">:</span>&nbsp;<span class="op" id="4485669">&amp;</span><span class="ident" id="4485670">ast</span><span class="op" id="4485673">.</span><span class="ident" id="4485674">FieldList</span><span class="op" id="4485683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485688">Opening</span><span class="op" id="4485695">:</span>&nbsp;<span class="ident" id="4485697">lbrace</span><span class="op" id="4485703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485708">List</span><span class="op" id="4485712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485717">list</span><span class="op" id="4485721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485726">Closing</span><span class="op" id="4485733">:</span>&nbsp;<span class="ident" id="4485735">rbrace</span><span class="op" id="4485741">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485745">}</span><span class="op" id="4485746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485749">}</span><br>
<span class="lineno"></span><span class="op" id="4485751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4485754">func</span>&nbsp;<span class="op" id="4485759">(</span><span class="ident" id="4485760">p</span>&nbsp;<span class="op" id="4485762">*</span><span class="ident" id="4485763">parser</span><span class="op" id="4485769">)</span>&nbsp;<span class="ident" id="4485771">parsePointerType</span><span class="op" id="4485787">(</span><span class="op" id="4485788">)</span>&nbsp;<span class="op" id="4485790">*</span><span class="ident" id="4485791">ast</span><span class="op" id="4485794">.</span><span class="ident" id="4485795">StarExpr</span>&nbsp;<span class="op" id="4485804">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485807">if</span>&nbsp;<span class="ident" id="4485810">p</span><span class="op" id="4485811">.</span><span class="ident" id="4485812">trace</span>&nbsp;<span class="op" id="4485818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485822">defer</span>&nbsp;<span class="ident" id="4485828">un</span><span class="op" id="4485830">(</span><span class="ident" id="4485831">trace</span><span class="op" id="4485836">(</span><span class="ident" id="4485837">p</span><span class="op" id="4485838">,</span>&nbsp;<span class="string" id="4485840">&#34;PointerType&#34;</span><span class="op" id="4485853">)</span><span class="op" id="4485854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485861">star</span>&nbsp;<span class="op" id="4485866">:=</span>&nbsp;<span class="ident" id="4485869">p</span><span class="op" id="4485870">.</span><span class="ident" id="4485871">expect</span><span class="op" id="4485877">(</span><span class="ident" id="4485878">token</span><span class="op" id="4485883">.</span><span class="ident" id="4485884">MUL</span><span class="op" id="4485887">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485890">base</span>&nbsp;<span class="op" id="4485895">:=</span>&nbsp;<span class="ident" id="4485898">p</span><span class="op" id="4485899">.</span><span class="ident" id="4485900">parseType</span><span class="op" id="4485909">(</span><span class="op" id="4485910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485914">return</span>&nbsp;<span class="op" id="4485921">&amp;</span><span class="ident" id="4485922">ast</span><span class="op" id="4485925">.</span><span class="ident" id="4485926">StarExpr</span><span class="op" id="4485934">{</span><span class="ident" id="4485935">Star</span><span class="op" id="4485939">:</span>&nbsp;<span class="ident" id="4485941">star</span><span class="op" id="4485945">,</span>&nbsp;<span class="ident" id="4485947">X</span><span class="op" id="4485948">:</span>&nbsp;<span class="ident" id="4485950">base</span><span class="op" id="4485954">}</span><br>
<span class="lineno"></span><span class="op" id="4485956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4485959">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4486014">func</span>&nbsp;<span class="op" id="4486019">(</span><span class="ident" id="4486020">p</span>&nbsp;<span class="op" id="4486022">*</span><span class="ident" id="4486023">parser</span><span class="op" id="4486029">)</span>&nbsp;<span class="ident" id="4486031">tryVarType</span><span class="op" id="4486041">(</span><span class="ident" id="4486042">isParam</span>&nbsp;<span class="builtintype" id="4486050">bool</span><span class="op" id="4486054">)</span>&nbsp;<span class="ident" id="4486056">ast</span><span class="op" id="4486059">.</span><span class="ident" id="4486060">Expr</span>&nbsp;<span class="op" id="4486065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486068">if</span>&nbsp;<span class="ident" id="4486071">isParam</span>&nbsp;<span class="op" id="4486079">&amp;&amp;</span>&nbsp;<span class="ident" id="4486082">p</span><span class="op" id="4486083">.</span><span class="ident" id="4486084">tok</span>&nbsp;<span class="op" id="4486088">==</span>&nbsp;<span class="ident" id="4486091">token</span><span class="op" id="4486096">.</span><span class="ident" id="4486097">ELLIPSIS</span>&nbsp;<span class="op" id="4486106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486110">pos</span>&nbsp;<span class="op" id="4486114">:=</span>&nbsp;<span class="ident" id="4486117">p</span><span class="op" id="4486118">.</span><span class="ident" id="4486119">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486125">p</span><span class="op" id="4486126">.</span><span class="ident" id="4486127">next</span><span class="op" id="4486131">(</span><span class="op" id="4486132">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486136">typ</span>&nbsp;<span class="op" id="4486140">:=</span>&nbsp;<span class="ident" id="4486143">p</span><span class="op" id="4486144">.</span><span class="ident" id="4486145">tryIdentOrType</span><span class="op" id="4486159">(</span><span class="op" id="4486160">)</span>&nbsp;<span class="comment" id="4486162">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486226">if</span>&nbsp;<span class="ident" id="4486229">typ</span>&nbsp;<span class="op" id="4486233">!=</span>&nbsp;<span class="ident" id="4486236">nil</span>&nbsp;<span class="op" id="4486240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486245">p</span><span class="op" id="4486246">.</span><span class="ident" id="4486247">resolve</span><span class="op" id="4486254">(</span><span class="ident" id="4486255">typ</span><span class="op" id="4486258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486262">}</span>&nbsp;<span class="keyword" id="4486264">else</span>&nbsp;<span class="op" id="4486269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486274">p</span><span class="op" id="4486275">.</span><span class="builtintype" id="4486276">error</span><span class="op" id="4486281">(</span><span class="ident" id="4486282">pos</span><span class="op" id="4486285">,</span>&nbsp;<span class="string" id="4486287">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="4486320">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486325">typ</span>&nbsp;<span class="op" id="4486329">=</span>&nbsp;<span class="op" id="4486331">&amp;</span><span class="ident" id="4486332">ast</span><span class="op" id="4486335">.</span><span class="ident" id="4486336">BadExpr</span><span class="op" id="4486343">{</span><span class="ident" id="4486344">From</span><span class="op" id="4486348">:</span>&nbsp;<span class="ident" id="4486350">pos</span><span class="op" id="4486353">,</span>&nbsp;<span class="ident" id="4486355">To</span><span class="op" id="4486357">:</span>&nbsp;<span class="ident" id="4486359">p</span><span class="op" id="4486360">.</span><span class="ident" id="4486361">pos</span><span class="op" id="4486364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486372">return</span>&nbsp;<span class="op" id="4486379">&amp;</span><span class="ident" id="4486380">ast</span><span class="op" id="4486383">.</span><span class="ident" id="4486384">Ellipsis</span><span class="op" id="4486392">{</span><span class="ident" id="4486393">Ellipsis</span><span class="op" id="4486401">:</span>&nbsp;<span class="ident" id="4486403">pos</span><span class="op" id="4486406">,</span>&nbsp;<span class="ident" id="4486408">Elt</span><span class="op" id="4486411">:</span>&nbsp;<span class="ident" id="4486413">typ</span><span class="op" id="4486416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486422">return</span>&nbsp;<span class="ident" id="4486429">p</span><span class="op" id="4486430">.</span><span class="ident" id="4486431">tryIdentOrType</span><span class="op" id="4486445">(</span><span class="op" id="4486446">)</span><br>
<span class="lineno">770</span><span class="op" id="4486448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486451">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4486506">func</span>&nbsp;<span class="op" id="4486511">(</span><span class="ident" id="4486512">p</span>&nbsp;<span class="op" id="4486514">*</span><span class="ident" id="4486515">parser</span><span class="op" id="4486521">)</span>&nbsp;<span class="ident" id="4486523">parseVarType</span><span class="op" id="4486535">(</span><span class="ident" id="4486536">isParam</span>&nbsp;<span class="builtintype" id="4486544">bool</span><span class="op" id="4486548">)</span>&nbsp;<span class="ident" id="4486550">ast</span><span class="op" id="4486553">.</span><span class="ident" id="4486554">Expr</span>&nbsp;<span class="op" id="4486559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486562">typ</span>&nbsp;<span class="op" id="4486566">:=</span>&nbsp;<span class="ident" id="4486569">p</span><span class="op" id="4486570">.</span><span class="ident" id="4486571">tryVarType</span><span class="op" id="4486581">(</span><span class="ident" id="4486582">isParam</span><span class="op" id="4486589">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486592">if</span>&nbsp;<span class="ident" id="4486595">typ</span>&nbsp;<span class="op" id="4486599">==</span>&nbsp;<span class="ident" id="4486602">nil</span>&nbsp;<span class="op" id="4486606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486610">pos</span>&nbsp;<span class="op" id="4486614">:=</span>&nbsp;<span class="ident" id="4486617">p</span><span class="op" id="4486618">.</span><span class="ident" id="4486619">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486625">p</span><span class="op" id="4486626">.</span><span class="ident" id="4486627">errorExpected</span><span class="op" id="4486640">(</span><span class="ident" id="4486641">pos</span><span class="op" id="4486644">,</span>&nbsp;<span class="string" id="4486646">&#34;type&#34;</span><span class="op" id="4486652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486656">p</span><span class="op" id="4486657">.</span><span class="ident" id="4486658">next</span><span class="op" id="4486662">(</span><span class="op" id="4486663">)</span>&nbsp;<span class="comment" id="4486665">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486684">typ</span>&nbsp;<span class="op" id="4486688">=</span>&nbsp;<span class="op" id="4486690">&amp;</span><span class="ident" id="4486691">ast</span><span class="op" id="4486694">.</span><span class="ident" id="4486695">BadExpr</span><span class="op" id="4486702">{</span><span class="ident" id="4486703">From</span><span class="op" id="4486707">:</span>&nbsp;<span class="ident" id="4486709">pos</span><span class="op" id="4486712">,</span>&nbsp;<span class="ident" id="4486714">To</span><span class="op" id="4486716">:</span>&nbsp;<span class="ident" id="4486718">p</span><span class="op" id="4486719">.</span><span class="ident" id="4486720">pos</span><span class="op" id="4486723">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486729">return</span>&nbsp;<span class="ident" id="4486736">typ</span><br>
<span class="lineno"></span><span class="op" id="4486740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486743">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="4486808">func</span>&nbsp;<span class="op" id="4486813">(</span><span class="ident" id="4486814">p</span>&nbsp;<span class="op" id="4486816">*</span><span class="ident" id="4486817">parser</span><span class="op" id="4486823">)</span>&nbsp;<span class="ident" id="4486825">parseVarList</span><span class="op" id="4486837">(</span><span class="ident" id="4486838">isParam</span>&nbsp;<span class="builtintype" id="4486846">bool</span><span class="op" id="4486850">)</span>&nbsp;<span class="op" id="4486852">(</span><span class="ident" id="4486853">list</span>&nbsp;<span class="op" id="4486858">[</span><span class="op" id="4486859">]</span><span class="ident" id="4486860">ast</span><span class="op" id="4486863">.</span><span class="ident" id="4486864">Expr</span><span class="op" id="4486868">,</span>&nbsp;<span class="ident" id="4486870">typ</span>&nbsp;<span class="ident" id="4486874">ast</span><span class="op" id="4486877">.</span><span class="ident" id="4486878">Expr</span><span class="op" id="4486882">)</span>&nbsp;<span class="op" id="4486884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486887">if</span>&nbsp;<span class="ident" id="4486890">p</span><span class="op" id="4486891">.</span><span class="ident" id="4486892">trace</span>&nbsp;<span class="op" id="4486898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486902">defer</span>&nbsp;<span class="ident" id="4486908">un</span><span class="op" id="4486910">(</span><span class="ident" id="4486911">trace</span><span class="op" id="4486916">(</span><span class="ident" id="4486917">p</span><span class="op" id="4486918">,</span>&nbsp;<span class="string" id="4486920">&#34;VarList&#34;</span><span class="op" id="4486929">)</span><span class="op" id="4486930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486937">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486995">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486999">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487062">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487125">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487188">for</span>&nbsp;<span class="ident" id="4487192">typ</span>&nbsp;<span class="op" id="4487196">:=</span>&nbsp;<span class="ident" id="4487199">p</span><span class="op" id="4487200">.</span><span class="ident" id="4487201">parseVarType</span><span class="op" id="4487213">(</span><span class="ident" id="4487214">isParam</span><span class="op" id="4487221">)</span><span class="op" id="4487222">;</span>&nbsp;<span class="ident" id="4487224">typ</span>&nbsp;<span class="op" id="4487228">!=</span>&nbsp;<span class="ident" id="4487231">nil</span><span class="op" id="4487234">;</span>&nbsp;<span class="op" id="4487236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487240">list</span>&nbsp;<span class="op" id="4487245">=</span>&nbsp;<span class="builtinfunc" id="4487247">append</span><span class="op" id="4487253">(</span><span class="ident" id="4487254">list</span><span class="op" id="4487258">,</span>&nbsp;<span class="ident" id="4487260">typ</span><span class="op" id="4487263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487267">if</span>&nbsp;<span class="ident" id="4487270">p</span><span class="op" id="4487271">.</span><span class="ident" id="4487272">tok</span>&nbsp;<span class="op" id="4487276">!=</span>&nbsp;<span class="ident" id="4487279">token</span><span class="op" id="4487284">.</span><span class="ident" id="4487285">COMMA</span>&nbsp;<span class="op" id="4487291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487296">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487304">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487308">p</span><span class="op" id="4487309">.</span><span class="ident" id="4487310">next</span><span class="op" id="4487314">(</span><span class="op" id="4487315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487319">typ</span>&nbsp;<span class="op" id="4487323">=</span>&nbsp;<span class="ident" id="4487325">p</span><span class="op" id="4487326">.</span><span class="ident" id="4487327">tryVarType</span><span class="op" id="4487337">(</span><span class="ident" id="4487338">isParam</span><span class="op" id="4487345">)</span>&nbsp;<span class="comment" id="4487347">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487388">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487455">typ</span>&nbsp;<span class="op" id="4487459">=</span>&nbsp;<span class="ident" id="4487461">p</span><span class="op" id="4487462">.</span><span class="ident" id="4487463">tryVarType</span><span class="op" id="4487473">(</span><span class="ident" id="4487474">isParam</span><span class="op" id="4487481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487485">return</span><br>
<span class="lineno"></span><span class="op" id="4487492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4487495">func</span>&nbsp;<span class="op" id="4487500">(</span><span class="ident" id="4487501">p</span>&nbsp;<span class="op" id="4487503">*</span><span class="ident" id="4487504">parser</span><span class="op" id="4487510">)</span>&nbsp;<span class="ident" id="4487512">parseParameterList</span><span class="op" id="4487530">(</span><span class="ident" id="4487531">scope</span>&nbsp;<span class="op" id="4487537">*</span><span class="ident" id="4487538">ast</span><span class="op" id="4487541">.</span><span class="ident" id="4487542">Scope</span><span class="op" id="4487547">,</span>&nbsp;<span class="ident" id="4487549">ellipsisOk</span>&nbsp;<span class="builtintype" id="4487560">bool</span><span class="op" id="4487564">)</span>&nbsp;<span class="op" id="4487566">(</span><span class="ident" id="4487567">params</span>&nbsp;<span class="op" id="4487574">[</span><span class="op" id="4487575">]</span><span class="op" id="4487576">*</span><span class="ident" id="4487577">ast</span><span class="op" id="4487580">.</span><span class="ident" id="4487581">Field</span><span class="op" id="4487586">)</span>&nbsp;<span class="op" id="4487588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487591">if</span>&nbsp;<span class="ident" id="4487594">p</span><span class="op" id="4487595">.</span><span class="ident" id="4487596">trace</span>&nbsp;<span class="op" id="4487602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487606">defer</span>&nbsp;<span class="ident" id="4487612">un</span><span class="op" id="4487614">(</span><span class="ident" id="4487615">trace</span><span class="op" id="4487620">(</span><span class="ident" id="4487621">p</span><span class="op" id="4487622">,</span>&nbsp;<span class="string" id="4487624">&#34;ParameterList&#34;</span><span class="op" id="4487639">)</span><span class="op" id="4487640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487647">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487665">list</span><span class="op" id="4487669">,</span>&nbsp;<span class="ident" id="4487671">typ</span>&nbsp;<span class="op" id="4487675">:=</span>&nbsp;<span class="ident" id="4487678">p</span><span class="op" id="4487679">.</span><span class="ident" id="4487680">parseVarList</span><span class="op" id="4487692">(</span><span class="ident" id="4487693">ellipsisOk</span><span class="op" id="4487703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487707">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487724">if</span>&nbsp;<span class="ident" id="4487727">typ</span>&nbsp;<span class="op" id="4487731">!=</span>&nbsp;<span class="ident" id="4487734">nil</span>&nbsp;<span class="op" id="4487738">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487742">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487767">idents</span>&nbsp;<span class="op" id="4487774">:=</span>&nbsp;<span class="ident" id="4487777">p</span><span class="op" id="4487778">.</span><span class="ident" id="4487779">makeIdentList</span><span class="op" id="4487792">(</span><span class="ident" id="4487793">list</span><span class="op" id="4487797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487801">field</span>&nbsp;<span class="op" id="4487807">:=</span>&nbsp;<span class="op" id="4487810">&amp;</span><span class="ident" id="4487811">ast</span><span class="op" id="4487814">.</span><span class="ident" id="4487815">Field</span><span class="op" id="4487820">{</span><span class="ident" id="4487821">Names</span><span class="op" id="4487826">:</span>&nbsp;<span class="ident" id="4487828">idents</span><span class="op" id="4487834">,</span>&nbsp;<span class="ident" id="4487836">Type</span><span class="op" id="4487840">:</span>&nbsp;<span class="ident" id="4487842">typ</span><span class="op" id="4487845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487849">params</span>&nbsp;<span class="op" id="4487856">=</span>&nbsp;<span class="builtinfunc" id="4487858">append</span><span class="op" id="4487864">(</span><span class="ident" id="4487865">params</span><span class="op" id="4487871">,</span>&nbsp;<span class="ident" id="4487873">field</span><span class="op" id="4487878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487882">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487943">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487999">p</span><span class="op" id="4488000">.</span><span class="ident" id="4488001">declare</span><span class="op" id="4488008">(</span><span class="ident" id="4488009">field</span><span class="op" id="4488014">,</span>&nbsp;<span class="ident" id="4488016">nil</span><span class="op" id="4488019">,</span>&nbsp;<span class="ident" id="4488021">scope</span><span class="op" id="4488026">,</span>&nbsp;<span class="ident" id="4488028">ast</span><span class="op" id="4488031">.</span><span class="ident" id="4488032">Var</span><span class="op" id="4488035">,</span>&nbsp;<span class="ident" id="4488037">idents</span><span class="op" id="4488043">...</span><span class="op" id="4488046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488050">p</span><span class="op" id="4488051">.</span><span class="ident" id="4488052">resolve</span><span class="op" id="4488059">(</span><span class="ident" id="4488060">typ</span><span class="op" id="4488063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488067">if</span>&nbsp;<span class="op" id="4488070">!</span><span class="ident" id="4488071">p</span><span class="op" id="4488072">.</span><span class="ident" id="4488073">atComma</span><span class="op" id="4488080">(</span><span class="string" id="4488081">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4488097">)</span>&nbsp;<span class="op" id="4488099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488104">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488117">p</span><span class="op" id="4488118">.</span><span class="ident" id="4488119">next</span><span class="op" id="4488123">(</span><span class="op" id="4488124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488128">for</span>&nbsp;<span class="ident" id="4488132">p</span><span class="op" id="4488133">.</span><span class="ident" id="4488134">tok</span>&nbsp;<span class="op" id="4488138">!=</span>&nbsp;<span class="ident" id="4488141">token</span><span class="op" id="4488146">.</span><span class="ident" id="4488147">RPAREN</span>&nbsp;<span class="op" id="4488154">&amp;&amp;</span>&nbsp;<span class="ident" id="4488157">p</span><span class="op" id="4488158">.</span><span class="ident" id="4488159">tok</span>&nbsp;<span class="op" id="4488163">!=</span>&nbsp;<span class="ident" id="4488166">token</span><span class="op" id="4488171">.</span><span class="ident" id="4488172">EOF</span>&nbsp;<span class="op" id="4488176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488181">idents</span>&nbsp;<span class="op" id="4488188">:=</span>&nbsp;<span class="ident" id="4488191">p</span><span class="op" id="4488192">.</span><span class="ident" id="4488193">parseIdentList</span><span class="op" id="4488207">(</span><span class="op" id="4488208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488213">typ</span>&nbsp;<span class="op" id="4488217">:=</span>&nbsp;<span class="ident" id="4488220">p</span><span class="op" id="4488221">.</span><span class="ident" id="4488222">parseVarType</span><span class="op" id="4488234">(</span><span class="ident" id="4488235">ellipsisOk</span><span class="op" id="4488245">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488250">field</span>&nbsp;<span class="op" id="4488256">:=</span>&nbsp;<span class="op" id="4488259">&amp;</span><span class="ident" id="4488260">ast</span><span class="op" id="4488263">.</span><span class="ident" id="4488264">Field</span><span class="op" id="4488269">{</span><span class="ident" id="4488270">Names</span><span class="op" id="4488275">:</span>&nbsp;<span class="ident" id="4488277">idents</span><span class="op" id="4488283">,</span>&nbsp;<span class="ident" id="4488285">Type</span><span class="op" id="4488289">:</span>&nbsp;<span class="ident" id="4488291">typ</span><span class="op" id="4488294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488299">params</span>&nbsp;<span class="op" id="4488306">=</span>&nbsp;<span class="builtinfunc" id="4488308">append</span><span class="op" id="4488314">(</span><span class="ident" id="4488315">params</span><span class="op" id="4488321">,</span>&nbsp;<span class="ident" id="4488323">field</span><span class="op" id="4488328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488333">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488395">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488452">p</span><span class="op" id="4488453">.</span><span class="ident" id="4488454">declare</span><span class="op" id="4488461">(</span><span class="ident" id="4488462">field</span><span class="op" id="4488467">,</span>&nbsp;<span class="ident" id="4488469">nil</span><span class="op" id="4488472">,</span>&nbsp;<span class="ident" id="4488474">scope</span><span class="op" id="4488479">,</span>&nbsp;<span class="ident" id="4488481">ast</span><span class="op" id="4488484">.</span><span class="ident" id="4488485">Var</span><span class="op" id="4488488">,</span>&nbsp;<span class="ident" id="4488490">idents</span><span class="op" id="4488496">...</span><span class="op" id="4488499">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488504">p</span><span class="op" id="4488505">.</span><span class="ident" id="4488506">resolve</span><span class="op" id="4488513">(</span><span class="ident" id="4488514">typ</span><span class="op" id="4488517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488522">if</span>&nbsp;<span class="op" id="4488525">!</span><span class="ident" id="4488526">p</span><span class="op" id="4488527">.</span><span class="ident" id="4488528">atComma</span><span class="op" id="4488535">(</span><span class="string" id="4488536">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4488552">)</span>&nbsp;<span class="op" id="4488554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488560">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488574">p</span><span class="op" id="4488575">.</span><span class="ident" id="4488576">next</span><span class="op" id="4488580">(</span><span class="op" id="4488581">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488589">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488601">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488646">params</span>&nbsp;<span class="op" id="4488653">=</span>&nbsp;<span class="builtinfunc" id="4488655">make</span><span class="op" id="4488659">(</span><span class="op" id="4488660">[</span><span class="op" id="4488661">]</span><span class="op" id="4488662">*</span><span class="ident" id="4488663">ast</span><span class="op" id="4488666">.</span><span class="ident" id="4488667">Field</span><span class="op" id="4488672">,</span>&nbsp;<span class="builtinfunc" id="4488674">len</span><span class="op" id="4488677">(</span><span class="ident" id="4488678">list</span><span class="op" id="4488682">)</span><span class="op" id="4488683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488686">for</span>&nbsp;<span class="ident" id="4488690">i</span><span class="op" id="4488691">,</span>&nbsp;<span class="ident" id="4488693">typ</span>&nbsp;<span class="op" id="4488697">:=</span>&nbsp;<span class="keyword" id="4488700">range</span>&nbsp;<span class="ident" id="4488706">list</span>&nbsp;<span class="op" id="4488711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488715">p</span><span class="op" id="4488716">.</span><span class="ident" id="4488717">resolve</span><span class="op" id="4488724">(</span><span class="ident" id="4488725">typ</span><span class="op" id="4488728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488732">params</span><span class="op" id="4488738">[</span><span class="ident" id="4488739">i</span><span class="op" id="4488740">]</span>&nbsp;<span class="op" id="4488742">=</span>&nbsp;<span class="op" id="4488744">&amp;</span><span class="ident" id="4488745">ast</span><span class="op" id="4488748">.</span><span class="ident" id="4488749">Field</span><span class="op" id="4488754">{</span><span class="ident" id="4488755">Type</span><span class="op" id="4488759">:</span>&nbsp;<span class="ident" id="4488761">typ</span><span class="op" id="4488764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488767">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488770">return</span><br>
<span class="lineno"></span><span class="op" id="4488777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4488780">func</span>&nbsp;<span class="op" id="4488785">(</span><span class="ident" id="4488786">p</span>&nbsp;<span class="op" id="4488788">*</span><span class="ident" id="4488789">parser</span><span class="op" id="4488795">)</span>&nbsp;<span class="ident" id="4488797">parseParameters</span><span class="op" id="4488812">(</span><span class="ident" id="4488813">scope</span>&nbsp;<span class="op" id="4488819">*</span><span class="ident" id="4488820">ast</span><span class="op" id="4488823">.</span><span class="ident" id="4488824">Scope</span><span class="op" id="4488829">,</span>&nbsp;<span class="ident" id="4488831">ellipsisOk</span>&nbsp;<span class="builtintype" id="4488842">bool</span><span class="op" id="4488846">)</span>&nbsp;<span class="op" id="4488848">*</span><span class="ident" id="4488849">ast</span><span class="op" id="4488852">.</span><span class="ident" id="4488853">FieldList</span>&nbsp;<span class="op" id="4488863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488866">if</span>&nbsp;<span class="ident" id="4488869">p</span><span class="op" id="4488870">.</span><span class="ident" id="4488871">trace</span>&nbsp;<span class="op" id="4488877">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488881">defer</span>&nbsp;<span class="ident" id="4488887">un</span><span class="op" id="4488889">(</span><span class="ident" id="4488890">trace</span><span class="op" id="4488895">(</span><span class="ident" id="4488896">p</span><span class="op" id="4488897">,</span>&nbsp;<span class="string" id="4488899">&#34;Parameters&#34;</span><span class="op" id="4488911">)</span><span class="op" id="4488912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488919">var</span>&nbsp;<span class="ident" id="4488923">params</span>&nbsp;<span class="op" id="4488930">[</span><span class="op" id="4488931">]</span><span class="op" id="4488932">*</span><span class="ident" id="4488933">ast</span><span class="op" id="4488936">.</span><span class="ident" id="4488937">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488944">lparen</span>&nbsp;<span class="op" id="4488951">:=</span>&nbsp;<span class="ident" id="4488954">p</span><span class="op" id="4488955">.</span><span class="ident" id="4488956">expect</span><span class="op" id="4488962">(</span><span class="ident" id="4488963">token</span><span class="op" id="4488968">.</span><span class="ident" id="4488969">LPAREN</span><span class="op" id="4488975">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488978">if</span>&nbsp;<span class="ident" id="4488981">p</span><span class="op" id="4488982">.</span><span class="ident" id="4488983">tok</span>&nbsp;<span class="op" id="4488987">!=</span>&nbsp;<span class="ident" id="4488990">token</span><span class="op" id="4488995">.</span><span class="ident" id="4488996">RPAREN</span>&nbsp;<span class="op" id="4489003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489007">params</span>&nbsp;<span class="op" id="4489014">=</span>&nbsp;<span class="ident" id="4489016">p</span><span class="op" id="4489017">.</span><span class="ident" id="4489018">parseParameterList</span><span class="op" id="4489036">(</span><span class="ident" id="4489037">scope</span><span class="op" id="4489042">,</span>&nbsp;<span class="ident" id="4489044">ellipsisOk</span><span class="op" id="4489054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489060">rparen</span>&nbsp;<span class="op" id="4489067">:=</span>&nbsp;<span class="ident" id="4489070">p</span><span class="op" id="4489071">.</span><span class="ident" id="4489072">expect</span><span class="op" id="4489078">(</span><span class="ident" id="4489079">token</span><span class="op" id="4489084">.</span><span class="ident" id="4489085">RPAREN</span><span class="op" id="4489091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489095">return</span>&nbsp;<span class="op" id="4489102">&amp;</span><span class="ident" id="4489103">ast</span><span class="op" id="4489106">.</span><span class="ident" id="4489107">FieldList</span><span class="op" id="4489116">{</span><span class="ident" id="4489117">Opening</span><span class="op" id="4489124">:</span>&nbsp;<span class="ident" id="4489126">lparen</span><span class="op" id="4489132">,</span>&nbsp;<span class="ident" id="4489134">List</span><span class="op" id="4489138">:</span>&nbsp;<span class="ident" id="4489140">params</span><span class="op" id="4489146">,</span>&nbsp;<span class="ident" id="4489148">Closing</span><span class="op" id="4489155">:</span>&nbsp;<span class="ident" id="4489157">rparen</span><span class="op" id="4489163">}</span><br>
<span class="lineno"></span><span class="op" id="4489165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489168">func</span>&nbsp;<span class="op" id="4489173">(</span><span class="ident" id="4489174">p</span>&nbsp;<span class="op" id="4489176">*</span><span class="ident" id="4489177">parser</span><span class="op" id="4489183">)</span>&nbsp;<span class="ident" id="4489185">parseResult</span><span class="op" id="4489196">(</span><span class="ident" id="4489197">scope</span>&nbsp;<span class="op" id="4489203">*</span><span class="ident" id="4489204">ast</span><span class="op" id="4489207">.</span><span class="ident" id="4489208">Scope</span><span class="op" id="4489213">)</span>&nbsp;<span class="op" id="4489215">*</span><span class="ident" id="4489216">ast</span><span class="op" id="4489219">.</span><span class="ident" id="4489220">FieldList</span>&nbsp;<span class="op" id="4489230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489233">if</span>&nbsp;<span class="ident" id="4489236">p</span><span class="op" id="4489237">.</span><span class="ident" id="4489238">trace</span>&nbsp;<span class="op" id="4489244">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489248">defer</span>&nbsp;<span class="ident" id="4489254">un</span><span class="op" id="4489256">(</span><span class="ident" id="4489257">trace</span><span class="op" id="4489262">(</span><span class="ident" id="4489263">p</span><span class="op" id="4489264">,</span>&nbsp;<span class="string" id="4489266">&#34;Result&#34;</span><span class="op" id="4489274">)</span><span class="op" id="4489275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489282">if</span>&nbsp;<span class="ident" id="4489285">p</span><span class="op" id="4489286">.</span><span class="ident" id="4489287">tok</span>&nbsp;<span class="op" id="4489291">==</span>&nbsp;<span class="ident" id="4489294">token</span><span class="op" id="4489299">.</span><span class="ident" id="4489300">LPAREN</span>&nbsp;<span class="op" id="4489307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489311">return</span>&nbsp;<span class="ident" id="4489318">p</span><span class="op" id="4489319">.</span><span class="ident" id="4489320">parseParameters</span><span class="op" id="4489335">(</span><span class="ident" id="4489336">scope</span><span class="op" id="4489341">,</span>&nbsp;<span class="builtintype" id="4489343">false</span><span class="op" id="4489348">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489355">typ</span>&nbsp;<span class="op" id="4489359">:=</span>&nbsp;<span class="ident" id="4489362">p</span><span class="op" id="4489363">.</span><span class="ident" id="4489364">tryType</span><span class="op" id="4489371">(</span><span class="op" id="4489372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489375">if</span>&nbsp;<span class="ident" id="4489378">typ</span>&nbsp;<span class="op" id="4489382">!=</span>&nbsp;<span class="ident" id="4489385">nil</span>&nbsp;<span class="op" id="4489389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489393">list</span>&nbsp;<span class="op" id="4489398">:=</span>&nbsp;<span class="builtinfunc" id="4489401">make</span><span class="op" id="4489405">(</span><span class="op" id="4489406">[</span><span class="op" id="4489407">]</span><span class="op" id="4489408">*</span><span class="ident" id="4489409">ast</span><span class="op" id="4489412">.</span><span class="ident" id="4489413">Field</span><span class="op" id="4489418">,</span>&nbsp;<span class="num" id="4489420">1</span><span class="op" id="4489421">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489425">list</span><span class="op" id="4489429">[</span><span class="num" id="4489430">0</span><span class="op" id="4489431">]</span>&nbsp;<span class="op" id="4489433">=</span>&nbsp;<span class="op" id="4489435">&amp;</span><span class="ident" id="4489436">ast</span><span class="op" id="4489439">.</span><span class="ident" id="4489440">Field</span><span class="op" id="4489445">{</span><span class="ident" id="4489446">Type</span><span class="op" id="4489450">:</span>&nbsp;<span class="ident" id="4489452">typ</span><span class="op" id="4489455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489459">return</span>&nbsp;<span class="op" id="4489466">&amp;</span><span class="ident" id="4489467">ast</span><span class="op" id="4489470">.</span><span class="ident" id="4489471">FieldList</span><span class="op" id="4489480">{</span><span class="ident" id="4489481">List</span><span class="op" id="4489485">:</span>&nbsp;<span class="ident" id="4489487">list</span><span class="op" id="4489491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489498">return</span>&nbsp;<span class="ident" id="4489505">nil</span><br>
<span class="lineno">890</span><span class="op" id="4489509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489512">func</span>&nbsp;<span class="op" id="4489517">(</span><span class="ident" id="4489518">p</span>&nbsp;<span class="op" id="4489520">*</span><span class="ident" id="4489521">parser</span><span class="op" id="4489527">)</span>&nbsp;<span class="ident" id="4489529">parseSignature</span><span class="op" id="4489543">(</span><span class="ident" id="4489544">scope</span>&nbsp;<span class="op" id="4489550">*</span><span class="ident" id="4489551">ast</span><span class="op" id="4489554">.</span><span class="ident" id="4489555">Scope</span><span class="op" id="4489560">)</span>&nbsp;<span class="op" id="4489562">(</span><span class="ident" id="4489563">params</span><span class="op" id="4489569">,</span>&nbsp;<span class="ident" id="4489571">results</span>&nbsp;<span class="op" id="4489579">*</span><span class="ident" id="4489580">ast</span><span class="op" id="4489583">.</span><span class="ident" id="4489584">FieldList</span><span class="op" id="4489593">)</span>&nbsp;<span class="op" id="4489595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489598">if</span>&nbsp;<span class="ident" id="4489601">p</span><span class="op" id="4489602">.</span><span class="ident" id="4489603">trace</span>&nbsp;<span class="op" id="4489609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489613">defer</span>&nbsp;<span class="ident" id="4489619">un</span><span class="op" id="4489621">(</span><span class="ident" id="4489622">trace</span><span class="op" id="4489627">(</span><span class="ident" id="4489628">p</span><span class="op" id="4489629">,</span>&nbsp;<span class="string" id="4489631">&#34;Signature&#34;</span><span class="op" id="4489642">)</span><span class="op" id="4489643">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489650">params</span>&nbsp;<span class="op" id="4489657">=</span>&nbsp;<span class="ident" id="4489659">p</span><span class="op" id="4489660">.</span><span class="ident" id="4489661">parseParameters</span><span class="op" id="4489676">(</span><span class="ident" id="4489677">scope</span><span class="op" id="4489682">,</span>&nbsp;<span class="builtintype" id="4489684">true</span><span class="op" id="4489688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489691">results</span>&nbsp;<span class="op" id="4489699">=</span>&nbsp;<span class="ident" id="4489701">p</span><span class="op" id="4489702">.</span><span class="ident" id="4489703">parseResult</span><span class="op" id="4489714">(</span><span class="ident" id="4489715">scope</span><span class="op" id="4489720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489724">return</span><br>
<span class="lineno"></span><span class="op" id="4489731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489734">func</span>&nbsp;<span class="op" id="4489739">(</span><span class="ident" id="4489740">p</span>&nbsp;<span class="op" id="4489742">*</span><span class="ident" id="4489743">parser</span><span class="op" id="4489749">)</span>&nbsp;<span class="ident" id="4489751">parseFuncType</span><span class="op" id="4489764">(</span><span class="op" id="4489765">)</span>&nbsp;<span class="op" id="4489767">(</span><span class="op" id="4489768">*</span><span class="ident" id="4489769">ast</span><span class="op" id="4489772">.</span><span class="ident" id="4489773">FuncType</span><span class="op" id="4489781">,</span>&nbsp;<span class="op" id="4489783">*</span><span class="ident" id="4489784">ast</span><span class="op" id="4489787">.</span><span class="ident" id="4489788">Scope</span><span class="op" id="4489793">)</span>&nbsp;<span class="op" id="4489795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489798">if</span>&nbsp;<span class="ident" id="4489801">p</span><span class="op" id="4489802">.</span><span class="ident" id="4489803">trace</span>&nbsp;<span class="op" id="4489809">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489813">defer</span>&nbsp;<span class="ident" id="4489819">un</span><span class="op" id="4489821">(</span><span class="ident" id="4489822">trace</span><span class="op" id="4489827">(</span><span class="ident" id="4489828">p</span><span class="op" id="4489829">,</span>&nbsp;<span class="string" id="4489831">&#34;FuncType&#34;</span><span class="op" id="4489841">)</span><span class="op" id="4489842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489849">pos</span>&nbsp;<span class="op" id="4489853">:=</span>&nbsp;<span class="ident" id="4489856">p</span><span class="op" id="4489857">.</span><span class="ident" id="4489858">expect</span><span class="op" id="4489864">(</span><span class="ident" id="4489865">token</span><span class="op" id="4489870">.</span><span class="ident" id="4489871">FUNC</span><span class="op" id="4489875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489878">scope</span>&nbsp;<span class="op" id="4489884">:=</span>&nbsp;<span class="ident" id="4489887">ast</span><span class="op" id="4489890">.</span><span class="ident" id="4489891">NewScope</span><span class="op" id="4489899">(</span><span class="ident" id="4489900">p</span><span class="op" id="4489901">.</span><span class="ident" id="4489902">topScope</span><span class="op" id="4489910">)</span>&nbsp;<span class="comment" id="4489912">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489931">params</span><span class="op" id="4489937">,</span>&nbsp;<span class="ident" id="4489939">results</span>&nbsp;<span class="op" id="4489947">:=</span>&nbsp;<span class="ident" id="4489950">p</span><span class="op" id="4489951">.</span><span class="ident" id="4489952">parseSignature</span><span class="op" id="4489966">(</span><span class="ident" id="4489967">scope</span><span class="op" id="4489972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489976">return</span>&nbsp;<span class="op" id="4489983">&amp;</span><span class="ident" id="4489984">ast</span><span class="op" id="4489987">.</span><span class="ident" id="4489988">FuncType</span><span class="op" id="4489996">{</span><span class="ident" id="4489997">Func</span><span class="op" id="4490001">:</span>&nbsp;<span class="ident" id="4490003">pos</span><span class="op" id="4490006">,</span>&nbsp;<span class="ident" id="4490008">Params</span><span class="op" id="4490014">:</span>&nbsp;<span class="ident" id="4490016">params</span><span class="op" id="4490022">,</span>&nbsp;<span class="ident" id="4490024">Results</span><span class="op" id="4490031">:</span>&nbsp;<span class="ident" id="4490033">results</span><span class="op" id="4490040">}</span><span class="op" id="4490041">,</span>&nbsp;<span class="ident" id="4490043">scope</span><br>
<span class="lineno"></span><span class="op" id="4490049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="4490052">func</span>&nbsp;<span class="op" id="4490057">(</span><span class="ident" id="4490058">p</span>&nbsp;<span class="op" id="4490060">*</span><span class="ident" id="4490061">parser</span><span class="op" id="4490067">)</span>&nbsp;<span class="ident" id="4490069">parseMethodSpec</span><span class="op" id="4490084">(</span><span class="ident" id="4490085">scope</span>&nbsp;<span class="op" id="4490091">*</span><span class="ident" id="4490092">ast</span><span class="op" id="4490095">.</span><span class="ident" id="4490096">Scope</span><span class="op" id="4490101">)</span>&nbsp;<span class="op" id="4490103">*</span><span class="ident" id="4490104">ast</span><span class="op" id="4490107">.</span><span class="ident" id="4490108">Field</span>&nbsp;<span class="op" id="4490114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490117">if</span>&nbsp;<span class="ident" id="4490120">p</span><span class="op" id="4490121">.</span><span class="ident" id="4490122">trace</span>&nbsp;<span class="op" id="4490128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490132">defer</span>&nbsp;<span class="ident" id="4490138">un</span><span class="op" id="4490140">(</span><span class="ident" id="4490141">trace</span><span class="op" id="4490146">(</span><span class="ident" id="4490147">p</span><span class="op" id="4490148">,</span>&nbsp;<span class="string" id="4490150">&#34;MethodSpec&#34;</span><span class="op" id="4490162">)</span><span class="op" id="4490163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490170">doc</span>&nbsp;<span class="op" id="4490174">:=</span>&nbsp;<span class="ident" id="4490177">p</span><span class="op" id="4490178">.</span><span class="ident" id="4490179">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490192">var</span>&nbsp;<span class="ident" id="4490196">idents</span>&nbsp;<span class="op" id="4490203">[</span><span class="op" id="4490204">]</span><span class="op" id="4490205">*</span><span class="ident" id="4490206">ast</span><span class="op" id="4490209">.</span><span class="ident" id="4490210">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490217">var</span>&nbsp;<span class="ident" id="4490221">typ</span>&nbsp;<span class="ident" id="4490225">ast</span><span class="op" id="4490228">.</span><span class="ident" id="4490229">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490235">x</span>&nbsp;<span class="op" id="4490237">:=</span>&nbsp;<span class="ident" id="4490240">p</span><span class="op" id="4490241">.</span><span class="ident" id="4490242">parseTypeName</span><span class="op" id="4490255">(</span><span class="op" id="4490256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490259">if</span>&nbsp;<span class="ident" id="4490262">ident</span><span class="op" id="4490267">,</span>&nbsp;<span class="ident" id="4490269">isIdent</span>&nbsp;<span class="op" id="4490277">:=</span>&nbsp;<span class="ident" id="4490280">x</span><span class="op" id="4490281">.</span><span class="op" id="4490282">(</span><span class="op" id="4490283">*</span><span class="ident" id="4490284">ast</span><span class="op" id="4490287">.</span><span class="ident" id="4490288">Ident</span><span class="op" id="4490293">)</span><span class="op" id="4490294">;</span>&nbsp;<span class="ident" id="4490296">isIdent</span>&nbsp;<span class="op" id="4490304">&amp;&amp;</span>&nbsp;<span class="ident" id="4490307">p</span><span class="op" id="4490308">.</span><span class="ident" id="4490309">tok</span>&nbsp;<span class="op" id="4490313">==</span>&nbsp;<span class="ident" id="4490316">token</span><span class="op" id="4490321">.</span><span class="ident" id="4490322">LPAREN</span>&nbsp;<span class="op" id="4490329">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490333">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490345">idents</span>&nbsp;<span class="op" id="4490352">=</span>&nbsp;<span class="op" id="4490354">[</span><span class="op" id="4490355">]</span><span class="op" id="4490356">*</span><span class="ident" id="4490357">ast</span><span class="op" id="4490360">.</span><span class="ident" id="4490361">Ident</span><span class="op" id="4490366">{</span><span class="ident" id="4490367">ident</span><span class="op" id="4490372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490376">scope</span>&nbsp;<span class="op" id="4490382">:=</span>&nbsp;<span class="ident" id="4490385">ast</span><span class="op" id="4490388">.</span><span class="ident" id="4490389">NewScope</span><span class="op" id="4490397">(</span><span class="ident" id="4490398">nil</span><span class="op" id="4490401">)</span>&nbsp;<span class="comment" id="4490403">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490421">params</span><span class="op" id="4490427">,</span>&nbsp;<span class="ident" id="4490429">results</span>&nbsp;<span class="op" id="4490437">:=</span>&nbsp;<span class="ident" id="4490440">p</span><span class="op" id="4490441">.</span><span class="ident" id="4490442">parseSignature</span><span class="op" id="4490456">(</span><span class="ident" id="4490457">scope</span><span class="op" id="4490462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490466">typ</span>&nbsp;<span class="op" id="4490470">=</span>&nbsp;<span class="op" id="4490472">&amp;</span><span class="ident" id="4490473">ast</span><span class="op" id="4490476">.</span><span class="ident" id="4490477">FuncType</span><span class="op" id="4490485">{</span><span class="ident" id="4490486">Func</span><span class="op" id="4490490">:</span>&nbsp;<span class="ident" id="4490492">token</span><span class="op" id="4490497">.</span><span class="ident" id="4490498">NoPos</span><span class="op" id="4490503">,</span>&nbsp;<span class="ident" id="4490505">Params</span><span class="op" id="4490511">:</span>&nbsp;<span class="ident" id="4490513">params</span><span class="op" id="4490519">,</span>&nbsp;<span class="ident" id="4490521">Results</span><span class="op" id="4490528">:</span>&nbsp;<span class="ident" id="4490530">results</span><span class="op" id="4490537">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490540">}</span>&nbsp;<span class="keyword" id="4490542">else</span>&nbsp;<span class="op" id="4490547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490551">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490575">typ</span>&nbsp;<span class="op" id="4490579">=</span>&nbsp;<span class="ident" id="4490581">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490585">p</span><span class="op" id="4490586">.</span><span class="ident" id="4490587">resolve</span><span class="op" id="4490594">(</span><span class="ident" id="4490595">typ</span><span class="op" id="4490598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490601">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490604">p</span><span class="op" id="4490605">.</span><span class="ident" id="4490606">expectSemi</span><span class="op" id="4490616">(</span><span class="op" id="4490617">)</span>&nbsp;<span class="comment" id="4490619">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490660">spec</span>&nbsp;<span class="op" id="4490665">:=</span>&nbsp;<span class="op" id="4490668">&amp;</span><span class="ident" id="4490669">ast</span><span class="op" id="4490672">.</span><span class="ident" id="4490673">Field</span><span class="op" id="4490678">{</span><span class="ident" id="4490679">Doc</span><span class="op" id="4490682">:</span>&nbsp;<span class="ident" id="4490684">doc</span><span class="op" id="4490687">,</span>&nbsp;<span class="ident" id="4490689">Names</span><span class="op" id="4490694">:</span>&nbsp;<span class="ident" id="4490696">idents</span><span class="op" id="4490702">,</span>&nbsp;<span class="ident" id="4490704">Type</span><span class="op" id="4490708">:</span>&nbsp;<span class="ident" id="4490710">typ</span><span class="op" id="4490713">,</span>&nbsp;<span class="ident" id="4490715">Comment</span><span class="op" id="4490722">:</span>&nbsp;<span class="ident" id="4490724">p</span><span class="op" id="4490725">.</span><span class="ident" id="4490726">lineComment</span><span class="op" id="4490737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490740">p</span><span class="op" id="4490741">.</span><span class="ident" id="4490742">declare</span><span class="op" id="4490749">(</span><span class="ident" id="4490750">spec</span><span class="op" id="4490754">,</span>&nbsp;<span class="ident" id="4490756">nil</span><span class="op" id="4490759">,</span>&nbsp;<span class="ident" id="4490761">scope</span><span class="op" id="4490766">,</span>&nbsp;<span class="ident" id="4490768">ast</span><span class="op" id="4490771">.</span><span class="ident" id="4490772">Fun</span><span class="op" id="4490775">,</span>&nbsp;<span class="ident" id="4490777">idents</span><span class="op" id="4490783">...</span><span class="op" id="4490786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490790">return</span>&nbsp;<span class="ident" id="4490797">spec</span><br>
<span class="lineno"></span><span class="op" id="4490802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4490805">func</span>&nbsp;<span class="op" id="4490810">(</span><span class="ident" id="4490811">p</span>&nbsp;<span class="op" id="4490813">*</span><span class="ident" id="4490814">parser</span><span class="op" id="4490820">)</span>&nbsp;<span class="ident" id="4490822">parseInterfaceType</span><span class="op" id="4490840">(</span><span class="op" id="4490841">)</span>&nbsp;<span class="op" id="4490843">*</span><span class="ident" id="4490844">ast</span><span class="op" id="4490847">.</span><span class="ident" id="4490848">InterfaceType</span>&nbsp;<span class="op" id="4490862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490865">if</span>&nbsp;<span class="ident" id="4490868">p</span><span class="op" id="4490869">.</span><span class="ident" id="4490870">trace</span>&nbsp;<span class="op" id="4490876">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490880">defer</span>&nbsp;<span class="ident" id="4490886">un</span><span class="op" id="4490888">(</span><span class="ident" id="4490889">trace</span><span class="op" id="4490894">(</span><span class="ident" id="4490895">p</span><span class="op" id="4490896">,</span>&nbsp;<span class="string" id="4490898">&#34;InterfaceType&#34;</span><span class="op" id="4490913">)</span><span class="op" id="4490914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490921">pos</span>&nbsp;<span class="op" id="4490925">:=</span>&nbsp;<span class="ident" id="4490928">p</span><span class="op" id="4490929">.</span><span class="ident" id="4490930">expect</span><span class="op" id="4490936">(</span><span class="ident" id="4490937">token</span><span class="op" id="4490942">.</span><span class="ident" id="4490943">INTERFACE</span><span class="op" id="4490952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490955">lbrace</span>&nbsp;<span class="op" id="4490962">:=</span>&nbsp;<span class="ident" id="4490965">p</span><span class="op" id="4490966">.</span><span class="ident" id="4490967">expect</span><span class="op" id="4490973">(</span><span class="ident" id="4490974">token</span><span class="op" id="4490979">.</span><span class="ident" id="4490980">LBRACE</span><span class="op" id="4490986">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490989">scope</span>&nbsp;<span class="op" id="4490995">:=</span>&nbsp;<span class="ident" id="4490998">ast</span><span class="op" id="4491001">.</span><span class="ident" id="4491002">NewScope</span><span class="op" id="4491010">(</span><span class="ident" id="4491011">nil</span><span class="op" id="4491014">)</span>&nbsp;<span class="comment" id="4491016">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491036">var</span>&nbsp;<span class="ident" id="4491040">list</span>&nbsp;<span class="op" id="4491045">[</span><span class="op" id="4491046">]</span><span class="op" id="4491047">*</span><span class="ident" id="4491048">ast</span><span class="op" id="4491051">.</span><span class="ident" id="4491052">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491059">for</span>&nbsp;<span class="ident" id="4491063">p</span><span class="op" id="4491064">.</span><span class="ident" id="4491065">tok</span>&nbsp;<span class="op" id="4491069">==</span>&nbsp;<span class="ident" id="4491072">token</span><span class="op" id="4491077">.</span><span class="ident" id="4491078">IDENT</span>&nbsp;<span class="op" id="4491084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491088">list</span>&nbsp;<span class="op" id="4491093">=</span>&nbsp;<span class="builtinfunc" id="4491095">append</span><span class="op" id="4491101">(</span><span class="ident" id="4491102">list</span><span class="op" id="4491106">,</span>&nbsp;<span class="ident" id="4491108">p</span><span class="op" id="4491109">.</span><span class="ident" id="4491110">parseMethodSpec</span><span class="op" id="4491125">(</span><span class="ident" id="4491126">scope</span><span class="op" id="4491131">)</span><span class="op" id="4491132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491135">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491138">rbrace</span>&nbsp;<span class="op" id="4491145">:=</span>&nbsp;<span class="ident" id="4491148">p</span><span class="op" id="4491149">.</span><span class="ident" id="4491150">expect</span><span class="op" id="4491156">(</span><span class="ident" id="4491157">token</span><span class="op" id="4491162">.</span><span class="ident" id="4491163">RBRACE</span><span class="op" id="4491169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491173">return</span>&nbsp;<span class="op" id="4491180">&amp;</span><span class="ident" id="4491181">ast</span><span class="op" id="4491184">.</span><span class="ident" id="4491185">InterfaceType</span><span class="op" id="4491198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491202">Interface</span><span class="op" id="4491211">:</span>&nbsp;<span class="ident" id="4491213">pos</span><span class="op" id="4491216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491220">Methods</span><span class="op" id="4491227">:</span>&nbsp;<span class="op" id="4491229">&amp;</span><span class="ident" id="4491230">ast</span><span class="op" id="4491233">.</span><span class="ident" id="4491234">FieldList</span><span class="op" id="4491243">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491248">Opening</span><span class="op" id="4491255">:</span>&nbsp;<span class="ident" id="4491257">lbrace</span><span class="op" id="4491263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491268">List</span><span class="op" id="4491272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491277">list</span><span class="op" id="4491281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491286">Closing</span><span class="op" id="4491293">:</span>&nbsp;<span class="ident" id="4491295">rbrace</span><span class="op" id="4491301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491305">}</span><span class="op" id="4491306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491309">}</span><br>
<span class="lineno">965</span><span class="op" id="4491311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491314">func</span>&nbsp;<span class="op" id="4491319">(</span><span class="ident" id="4491320">p</span>&nbsp;<span class="op" id="4491322">*</span><span class="ident" id="4491323">parser</span><span class="op" id="4491329">)</span>&nbsp;<span class="ident" id="4491331">parseMapType</span><span class="op" id="4491343">(</span><span class="op" id="4491344">)</span>&nbsp;<span class="op" id="4491346">*</span><span class="ident" id="4491347">ast</span><span class="op" id="4491350">.</span><span class="ident" id="4491351">MapType</span>&nbsp;<span class="op" id="4491359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491362">if</span>&nbsp;<span class="ident" id="4491365">p</span><span class="op" id="4491366">.</span><span class="ident" id="4491367">trace</span>&nbsp;<span class="op" id="4491373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491377">defer</span>&nbsp;<span class="ident" id="4491383">un</span><span class="op" id="4491385">(</span><span class="ident" id="4491386">trace</span><span class="op" id="4491391">(</span><span class="ident" id="4491392">p</span><span class="op" id="4491393">,</span>&nbsp;<span class="string" id="4491395">&#34;MapType&#34;</span><span class="op" id="4491404">)</span><span class="op" id="4491405">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491412">pos</span>&nbsp;<span class="op" id="4491416">:=</span>&nbsp;<span class="ident" id="4491419">p</span><span class="op" id="4491420">.</span><span class="ident" id="4491421">expect</span><span class="op" id="4491427">(</span><span class="ident" id="4491428">token</span><span class="op" id="4491433">.</span><span class="ident" id="4491434">MAP</span><span class="op" id="4491437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491440">p</span><span class="op" id="4491441">.</span><span class="ident" id="4491442">expect</span><span class="op" id="4491448">(</span><span class="ident" id="4491449">token</span><span class="op" id="4491454">.</span><span class="ident" id="4491455">LBRACK</span><span class="op" id="4491461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491464">key</span>&nbsp;<span class="op" id="4491468">:=</span>&nbsp;<span class="ident" id="4491471">p</span><span class="op" id="4491472">.</span><span class="ident" id="4491473">parseType</span><span class="op" id="4491482">(</span><span class="op" id="4491483">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491486">p</span><span class="op" id="4491487">.</span><span class="ident" id="4491488">expect</span><span class="op" id="4491494">(</span><span class="ident" id="4491495">token</span><span class="op" id="4491500">.</span><span class="ident" id="4491501">RBRACK</span><span class="op" id="4491507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491510">value</span>&nbsp;<span class="op" id="4491516">:=</span>&nbsp;<span class="ident" id="4491519">p</span><span class="op" id="4491520">.</span><span class="ident" id="4491521">parseType</span><span class="op" id="4491530">(</span><span class="op" id="4491531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491535">return</span>&nbsp;<span class="op" id="4491542">&amp;</span><span class="ident" id="4491543">ast</span><span class="op" id="4491546">.</span><span class="ident" id="4491547">MapType</span><span class="op" id="4491554">{</span><span class="ident" id="4491555">Map</span><span class="op" id="4491558">:</span>&nbsp;<span class="ident" id="4491560">pos</span><span class="op" id="4491563">,</span>&nbsp;<span class="ident" id="4491565">Key</span><span class="op" id="4491568">:</span>&nbsp;<span class="ident" id="4491570">key</span><span class="op" id="4491573">,</span>&nbsp;<span class="ident" id="4491575">Value</span><span class="op" id="4491580">:</span>&nbsp;<span class="ident" id="4491582">value</span><span class="op" id="4491587">}</span><br>
<span class="lineno"></span><span class="op" id="4491589">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="4491592">func</span>&nbsp;<span class="op" id="4491597">(</span><span class="ident" id="4491598">p</span>&nbsp;<span class="op" id="4491600">*</span><span class="ident" id="4491601">parser</span><span class="op" id="4491607">)</span>&nbsp;<span class="ident" id="4491609">parseChanType</span><span class="op" id="4491622">(</span><span class="op" id="4491623">)</span>&nbsp;<span class="op" id="4491625">*</span><span class="ident" id="4491626">ast</span><span class="op" id="4491629">.</span><span class="ident" id="4491630">ChanType</span>&nbsp;<span class="op" id="4491639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491642">if</span>&nbsp;<span class="ident" id="4491645">p</span><span class="op" id="4491646">.</span><span class="ident" id="4491647">trace</span>&nbsp;<span class="op" id="4491653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491657">defer</span>&nbsp;<span class="ident" id="4491663">un</span><span class="op" id="4491665">(</span><span class="ident" id="4491666">trace</span><span class="op" id="4491671">(</span><span class="ident" id="4491672">p</span><span class="op" id="4491673">,</span>&nbsp;<span class="string" id="4491675">&#34;ChanType&#34;</span><span class="op" id="4491685">)</span><span class="op" id="4491686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491689">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491693">pos</span>&nbsp;<span class="op" id="4491697">:=</span>&nbsp;<span class="ident" id="4491700">p</span><span class="op" id="4491701">.</span><span class="ident" id="4491702">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491707">dir</span>&nbsp;<span class="op" id="4491711">:=</span>&nbsp;<span class="ident" id="4491714">ast</span><span class="op" id="4491717">.</span><span class="ident" id="4491718">SEND</span>&nbsp;<span class="op" id="4491723">|</span>&nbsp;<span class="ident" id="4491725">ast</span><span class="op" id="4491728">.</span><span class="ident" id="4491729">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491735">var</span>&nbsp;<span class="ident" id="4491739">arrow</span>&nbsp;<span class="ident" id="4491745">token</span><span class="op" id="4491750">.</span><span class="ident" id="4491751">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491756">if</span>&nbsp;<span class="ident" id="4491759">p</span><span class="op" id="4491760">.</span><span class="ident" id="4491761">tok</span>&nbsp;<span class="op" id="4491765">==</span>&nbsp;<span class="ident" id="4491768">token</span><span class="op" id="4491773">.</span><span class="ident" id="4491774">CHAN</span>&nbsp;<span class="op" id="4491779">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491783">p</span><span class="op" id="4491784">.</span><span class="ident" id="4491785">next</span><span class="op" id="4491789">(</span><span class="op" id="4491790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491794">if</span>&nbsp;<span class="ident" id="4491797">p</span><span class="op" id="4491798">.</span><span class="ident" id="4491799">tok</span>&nbsp;<span class="op" id="4491803">==</span>&nbsp;<span class="ident" id="4491806">token</span><span class="op" id="4491811">.</span><span class="ident" id="4491812">ARROW</span>&nbsp;<span class="op" id="4491818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491823">arrow</span>&nbsp;<span class="op" id="4491829">=</span>&nbsp;<span class="ident" id="4491831">p</span><span class="op" id="4491832">.</span><span class="ident" id="4491833">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491840">p</span><span class="op" id="4491841">.</span><span class="ident" id="4491842">next</span><span class="op" id="4491846">(</span><span class="op" id="4491847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491852">dir</span>&nbsp;<span class="op" id="4491856">=</span>&nbsp;<span class="ident" id="4491858">ast</span><span class="op" id="4491861">.</span><span class="ident" id="4491862">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491872">}</span>&nbsp;<span class="keyword" id="4491874">else</span>&nbsp;<span class="op" id="4491879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491883">arrow</span>&nbsp;<span class="op" id="4491889">=</span>&nbsp;<span class="ident" id="4491891">p</span><span class="op" id="4491892">.</span><span class="ident" id="4491893">expect</span><span class="op" id="4491899">(</span><span class="ident" id="4491900">token</span><span class="op" id="4491905">.</span><span class="ident" id="4491906">ARROW</span><span class="op" id="4491911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491915">p</span><span class="op" id="4491916">.</span><span class="ident" id="4491917">expect</span><span class="op" id="4491923">(</span><span class="ident" id="4491924">token</span><span class="op" id="4491929">.</span><span class="ident" id="4491930">CHAN</span><span class="op" id="4491934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491938">dir</span>&nbsp;<span class="op" id="4491942">=</span>&nbsp;<span class="ident" id="4491944">ast</span><span class="op" id="4491947">.</span><span class="ident" id="4491948">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491957">value</span>&nbsp;<span class="op" id="4491963">:=</span>&nbsp;<span class="ident" id="4491966">p</span><span class="op" id="4491967">.</span><span class="ident" id="4491968">parseType</span><span class="op" id="4491977">(</span><span class="op" id="4491978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491982">return</span>&nbsp;<span class="op" id="4491989">&amp;</span><span class="ident" id="4491990">ast</span><span class="op" id="4491993">.</span><span class="ident" id="4491994">ChanType</span><span class="op" id="4492002">{</span><span class="ident" id="4492003">Begin</span><span class="op" id="4492008">:</span>&nbsp;<span class="ident" id="4492010">pos</span><span class="op" id="4492013">,</span>&nbsp;<span class="ident" id="4492015">Arrow</span><span class="op" id="4492020">:</span>&nbsp;<span class="ident" id="4492022">arrow</span><span class="op" id="4492027">,</span>&nbsp;<span class="ident" id="4492029">Dir</span><span class="op" id="4492032">:</span>&nbsp;<span class="ident" id="4492034">dir</span><span class="op" id="4492037">,</span>&nbsp;<span class="ident" id="4492039">Value</span><span class="op" id="4492044">:</span>&nbsp;<span class="ident" id="4492046">value</span><span class="op" id="4492051">}</span><br>
<span class="lineno"></span><span class="op" id="4492053">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="4492056">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4492111">func</span>&nbsp;<span class="op" id="4492116">(</span><span class="ident" id="4492117">p</span>&nbsp;<span class="op" id="4492119">*</span><span class="ident" id="4492120">parser</span><span class="op" id="4492126">)</span>&nbsp;<span class="ident" id="4492128">tryIdentOrType</span><span class="op" id="4492142">(</span><span class="op" id="4492143">)</span>&nbsp;<span class="ident" id="4492145">ast</span><span class="op" id="4492148">.</span><span class="ident" id="4492149">Expr</span>&nbsp;<span class="op" id="4492154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492157">switch</span>&nbsp;<span class="ident" id="4492164">p</span><span class="op" id="4492165">.</span><span class="ident" id="4492166">tok</span>&nbsp;<span class="op" id="4492170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492173">case</span>&nbsp;<span class="ident" id="4492178">token</span><span class="op" id="4492183">.</span><span class="ident" id="4492184">IDENT</span><span class="op" id="4492189">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492193">return</span>&nbsp;<span class="ident" id="4492200">p</span><span class="op" id="4492201">.</span><span class="ident" id="4492202">parseTypeName</span><span class="op" id="4492215">(</span><span class="op" id="4492216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492219">case</span>&nbsp;<span class="ident" id="4492224">token</span><span class="op" id="4492229">.</span><span class="ident" id="4492230">LBRACK</span><span class="op" id="4492236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492240">return</span>&nbsp;<span class="ident" id="4492247">p</span><span class="op" id="4492248">.</span><span class="ident" id="4492249">parseArrayType</span><span class="op" id="4492263">(</span><span class="op" id="4492264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492267">case</span>&nbsp;<span class="ident" id="4492272">token</span><span class="op" id="4492277">.</span><span class="ident" id="4492278">STRUCT</span><span class="op" id="4492284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492288">return</span>&nbsp;<span class="ident" id="4492295">p</span><span class="op" id="4492296">.</span><span class="ident" id="4492297">parseStructType</span><span class="op" id="4492312">(</span><span class="op" id="4492313">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492316">case</span>&nbsp;<span class="ident" id="4492321">token</span><span class="op" id="4492326">.</span><span class="ident" id="4492327">MUL</span><span class="op" id="4492330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492334">return</span>&nbsp;<span class="ident" id="4492341">p</span><span class="op" id="4492342">.</span><span class="ident" id="4492343">parsePointerType</span><span class="op" id="4492359">(</span><span class="op" id="4492360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492363">case</span>&nbsp;<span class="ident" id="4492368">token</span><span class="op" id="4492373">.</span><span class="ident" id="4492374">FUNC</span><span class="op" id="4492378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492382">typ</span><span class="op" id="4492385">,</span>&nbsp;<span class="ident" id="4492387">_</span>&nbsp;<span class="op" id="4492389">:=</span>&nbsp;<span class="ident" id="4492392">p</span><span class="op" id="4492393">.</span><span class="ident" id="4492394">parseFuncType</span><span class="op" id="4492407">(</span><span class="op" id="4492408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492412">return</span>&nbsp;<span class="ident" id="4492419">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492424">case</span>&nbsp;<span class="ident" id="4492429">token</span><span class="op" id="4492434">.</span><span class="ident" id="4492435">INTERFACE</span><span class="op" id="4492444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492448">return</span>&nbsp;<span class="ident" id="4492455">p</span><span class="op" id="4492456">.</span><span class="ident" id="4492457">parseInterfaceType</span><span class="op" id="4492475">(</span><span class="op" id="4492476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492479">case</span>&nbsp;<span class="ident" id="4492484">token</span><span class="op" id="4492489">.</span><span class="ident" id="4492490">MAP</span><span class="op" id="4492493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492497">return</span>&nbsp;<span class="ident" id="4492504">p</span><span class="op" id="4492505">.</span><span class="ident" id="4492506">parseMapType</span><span class="op" id="4492518">(</span><span class="op" id="4492519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492522">case</span>&nbsp;<span class="ident" id="4492527">token</span><span class="op" id="4492532">.</span><span class="ident" id="4492533">CHAN</span><span class="op" id="4492537">,</span>&nbsp;<span class="ident" id="4492539">token</span><span class="op" id="4492544">.</span><span class="ident" id="4492545">ARROW</span><span class="op" id="4492550">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492554">return</span>&nbsp;<span class="ident" id="4492561">p</span><span class="op" id="4492562">.</span><span class="ident" id="4492563">parseChanType</span><span class="op" id="4492576">(</span><span class="op" id="4492577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492580">case</span>&nbsp;<span class="ident" id="4492585">token</span><span class="op" id="4492590">.</span><span class="ident" id="4492591">LPAREN</span><span class="op" id="4492597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492601">lparen</span>&nbsp;<span class="op" id="4492608">:=</span>&nbsp;<span class="ident" id="4492611">p</span><span class="op" id="4492612">.</span><span class="ident" id="4492613">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492619">p</span><span class="op" id="4492620">.</span><span class="ident" id="4492621">next</span><span class="op" id="4492625">(</span><span class="op" id="4492626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492630">typ</span>&nbsp;<span class="op" id="4492634">:=</span>&nbsp;<span class="ident" id="4492637">p</span><span class="op" id="4492638">.</span><span class="ident" id="4492639">parseType</span><span class="op" id="4492648">(</span><span class="op" id="4492649">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492653">rparen</span>&nbsp;<span class="op" id="4492660">:=</span>&nbsp;<span class="ident" id="4492663">p</span><span class="op" id="4492664">.</span><span class="ident" id="4492665">expect</span><span class="op" id="4492671">(</span><span class="ident" id="4492672">token</span><span class="op" id="4492677">.</span><span class="ident" id="4492678">RPAREN</span><span class="op" id="4492684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492688">return</span>&nbsp;<span class="op" id="4492695">&amp;</span><span class="ident" id="4492696">ast</span><span class="op" id="4492699">.</span><span class="ident" id="4492700">ParenExpr</span><span class="op" id="4492709">{</span><span class="ident" id="4492710">Lparen</span><span class="op" id="4492716">:</span>&nbsp;<span class="ident" id="4492718">lparen</span><span class="op" id="4492724">,</span>&nbsp;<span class="ident" id="4492726">X</span><span class="op" id="4492727">:</span>&nbsp;<span class="ident" id="4492729">typ</span><span class="op" id="4492732">,</span>&nbsp;<span class="ident" id="4492734">Rparen</span><span class="op" id="4492740">:</span>&nbsp;<span class="ident" id="4492742">rparen</span><span class="op" id="4492748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492755">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492773">return</span>&nbsp;<span class="ident" id="4492780">nil</span><br>
<span class="lineno"></span><span class="op" id="4492784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492787">func</span>&nbsp;<span class="op" id="4492792">(</span><span class="ident" id="4492793">p</span>&nbsp;<span class="op" id="4492795">*</span><span class="ident" id="4492796">parser</span><span class="op" id="4492802">)</span>&nbsp;<span class="ident" id="4492804">tryType</span><span class="op" id="4492811">(</span><span class="op" id="4492812">)</span>&nbsp;<span class="ident" id="4492814">ast</span><span class="op" id="4492817">.</span><span class="ident" id="4492818">Expr</span>&nbsp;<span class="op" id="4492823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492826">typ</span>&nbsp;<span class="op" id="4492830">:=</span>&nbsp;<span class="ident" id="4492833">p</span><span class="op" id="4492834">.</span><span class="ident" id="4492835">tryIdentOrType</span><span class="op" id="4492849">(</span><span class="op" id="4492850">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492853">if</span>&nbsp;<span class="ident" id="4492856">typ</span>&nbsp;<span class="op" id="4492860">!=</span>&nbsp;<span class="ident" id="4492863">nil</span>&nbsp;<span class="op" id="4492867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492871">p</span><span class="op" id="4492872">.</span><span class="ident" id="4492873">resolve</span><span class="op" id="4492880">(</span><span class="ident" id="4492881">typ</span><span class="op" id="4492884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492890">return</span>&nbsp;<span class="ident" id="4492897">typ</span><br>
<span class="lineno"></span><span class="op" id="4492901">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="4492904">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4492984">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4492995">func</span>&nbsp;<span class="op" id="4493000">(</span><span class="ident" id="4493001">p</span>&nbsp;<span class="op" id="4493003">*</span><span class="ident" id="4493004">parser</span><span class="op" id="4493010">)</span>&nbsp;<span class="ident" id="4493012">parseStmtList</span><span class="op" id="4493025">(</span><span class="op" id="4493026">)</span>&nbsp;<span class="op" id="4493028">(</span><span class="ident" id="4493029">list</span>&nbsp;<span class="op" id="4493034">[</span><span class="op" id="4493035">]</span><span class="ident" id="4493036">ast</span><span class="op" id="4493039">.</span><span class="ident" id="4493040">Stmt</span><span class="op" id="4493044">)</span>&nbsp;<span class="op" id="4493046">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493049">if</span>&nbsp;<span class="ident" id="4493052">p</span><span class="op" id="4493053">.</span><span class="ident" id="4493054">trace</span>&nbsp;<span class="op" id="4493060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493064">defer</span>&nbsp;<span class="ident" id="4493070">un</span><span class="op" id="4493072">(</span><span class="ident" id="4493073">trace</span><span class="op" id="4493078">(</span><span class="ident" id="4493079">p</span><span class="op" id="4493080">,</span>&nbsp;<span class="string" id="4493082">&#34;StatementList&#34;</span><span class="op" id="4493097">)</span><span class="op" id="4493098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493105">for</span>&nbsp;<span class="ident" id="4493109">p</span><span class="op" id="4493110">.</span><span class="ident" id="4493111">tok</span>&nbsp;<span class="op" id="4493115">!=</span>&nbsp;<span class="ident" id="4493118">token</span><span class="op" id="4493123">.</span><span class="ident" id="4493124">CASE</span>&nbsp;<span class="op" id="4493129">&amp;&amp;</span>&nbsp;<span class="ident" id="4493132">p</span><span class="op" id="4493133">.</span><span class="ident" id="4493134">tok</span>&nbsp;<span class="op" id="4493138">!=</span>&nbsp;<span class="ident" id="4493141">token</span><span class="op" id="4493146">.</span><span class="ident" id="4493147">DEFAULT</span>&nbsp;<span class="op" id="4493155">&amp;&amp;</span>&nbsp;<span class="ident" id="4493158">p</span><span class="op" id="4493159">.</span><span class="ident" id="4493160">tok</span>&nbsp;<span class="op" id="4493164">!=</span>&nbsp;<span class="ident" id="4493167">token</span><span class="op" id="4493172">.</span><span class="ident" id="4493173">RBRACE</span>&nbsp;<span class="op" id="4493180">&amp;&amp;</span>&nbsp;<span class="ident" id="4493183">p</span><span class="op" id="4493184">.</span><span class="ident" id="4493185">tok</span>&nbsp;<span class="op" id="4493189">!=</span>&nbsp;<span class="ident" id="4493192">token</span><span class="op" id="4493197">.</span><span class="ident" id="4493198">EOF</span>&nbsp;<span class="op" id="4493202">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493206">list</span>&nbsp;<span class="op" id="4493211">=</span>&nbsp;<span class="builtinfunc" id="4493213">append</span><span class="op" id="4493219">(</span><span class="ident" id="4493220">list</span><span class="op" id="4493224">,</span>&nbsp;<span class="ident" id="4493226">p</span><span class="op" id="4493227">.</span><span class="ident" id="4493228">parseStmt</span><span class="op" id="4493237">(</span><span class="op" id="4493238">)</span><span class="op" id="4493239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493246">return</span><br>
<span class="lineno"></span><span class="op" id="4493253">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="4493256">func</span>&nbsp;<span class="op" id="4493261">(</span><span class="ident" id="4493262">p</span>&nbsp;<span class="op" id="4493264">*</span><span class="ident" id="4493265">parser</span><span class="op" id="4493271">)</span>&nbsp;<span class="ident" id="4493273">parseBody</span><span class="op" id="4493282">(</span><span class="ident" id="4493283">scope</span>&nbsp;<span class="op" id="4493289">*</span><span class="ident" id="4493290">ast</span><span class="op" id="4493293">.</span><span class="ident" id="4493294">Scope</span><span class="op" id="4493299">)</span>&nbsp;<span class="op" id="4493301">*</span><span class="ident" id="4493302">ast</span><span class="op" id="4493305">.</span><span class="ident" id="4493306">BlockStmt</span>&nbsp;<span class="op" id="4493316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493319">if</span>&nbsp;<span class="ident" id="4493322">p</span><span class="op" id="4493323">.</span><span class="ident" id="4493324">trace</span>&nbsp;<span class="op" id="4493330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493334">defer</span>&nbsp;<span class="ident" id="4493340">un</span><span class="op" id="4493342">(</span><span class="ident" id="4493343">trace</span><span class="op" id="4493348">(</span><span class="ident" id="4493349">p</span><span class="op" id="4493350">,</span>&nbsp;<span class="string" id="4493352">&#34;Body&#34;</span><span class="op" id="4493358">)</span><span class="op" id="4493359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493362">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493366">lbrace</span>&nbsp;<span class="op" id="4493373">:=</span>&nbsp;<span class="ident" id="4493376">p</span><span class="op" id="4493377">.</span><span class="ident" id="4493378">expect</span><span class="op" id="4493384">(</span><span class="ident" id="4493385">token</span><span class="op" id="4493390">.</span><span class="ident" id="4493391">LBRACE</span><span class="op" id="4493397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493400">p</span><span class="op" id="4493401">.</span><span class="ident" id="4493402">topScope</span>&nbsp;<span class="op" id="4493411">=</span>&nbsp;<span class="ident" id="4493413">scope</span>&nbsp;<span class="comment" id="4493419">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493443">p</span><span class="op" id="4493444">.</span><span class="ident" id="4493445">openLabelScope</span><span class="op" id="4493459">(</span><span class="op" id="4493460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493463">list</span>&nbsp;<span class="op" id="4493468">:=</span>&nbsp;<span class="ident" id="4493471">p</span><span class="op" id="4493472">.</span><span class="ident" id="4493473">parseStmtList</span><span class="op" id="4493486">(</span><span class="op" id="4493487">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493490">p</span><span class="op" id="4493491">.</span><span class="ident" id="4493492">closeLabelScope</span><span class="op" id="4493507">(</span><span class="op" id="4493508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493511">p</span><span class="op" id="4493512">.</span><span class="ident" id="4493513">closeScope</span><span class="op" id="4493523">(</span><span class="op" id="4493524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493527">rbrace</span>&nbsp;<span class="op" id="4493534">:=</span>&nbsp;<span class="ident" id="4493537">p</span><span class="op" id="4493538">.</span><span class="ident" id="4493539">expect</span><span class="op" id="4493545">(</span><span class="ident" id="4493546">token</span><span class="op" id="4493551">.</span><span class="ident" id="4493552">RBRACE</span><span class="op" id="4493558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493562">return</span>&nbsp;<span class="op" id="4493569">&amp;</span><span class="ident" id="4493570">ast</span><span class="op" id="4493573">.</span><span class="ident" id="4493574">BlockStmt</span><span class="op" id="4493583">{</span><span class="ident" id="4493584">Lbrace</span><span class="op" id="4493590">:</span>&nbsp;<span class="ident" id="4493592">lbrace</span><span class="op" id="4493598">,</span>&nbsp;<span class="ident" id="4493600">List</span><span class="op" id="4493604">:</span>&nbsp;<span class="ident" id="4493606">list</span><span class="op" id="4493610">,</span>&nbsp;<span class="ident" id="4493612">Rbrace</span><span class="op" id="4493618">:</span>&nbsp;<span class="ident" id="4493620">rbrace</span><span class="op" id="4493626">}</span><br>
<span class="lineno">1075</span><span class="op" id="4493628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4493631">func</span>&nbsp;<span class="op" id="4493636">(</span><span class="ident" id="4493637">p</span>&nbsp;<span class="op" id="4493639">*</span><span class="ident" id="4493640">parser</span><span class="op" id="4493646">)</span>&nbsp;<span class="ident" id="4493648">parseBlockStmt</span><span class="op" id="4493662">(</span><span class="op" id="4493663">)</span>&nbsp;<span class="op" id="4493665">*</span><span class="ident" id="4493666">ast</span><span class="op" id="4493669">.</span><span class="ident" id="4493670">BlockStmt</span>&nbsp;<span class="op" id="4493680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493683">if</span>&nbsp;<span class="ident" id="4493686">p</span><span class="op" id="4493687">.</span><span class="ident" id="4493688">trace</span>&nbsp;<span class="op" id="4493694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493698">defer</span>&nbsp;<span class="ident" id="4493704">un</span><span class="op" id="4493706">(</span><span class="ident" id="4493707">trace</span><span class="op" id="4493712">(</span><span class="ident" id="4493713">p</span><span class="op" id="4493714">,</span>&nbsp;<span class="string" id="4493716">&#34;BlockStmt&#34;</span><span class="op" id="4493727">)</span><span class="op" id="4493728">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493735">lbrace</span>&nbsp;<span class="op" id="4493742">:=</span>&nbsp;<span class="ident" id="4493745">p</span><span class="op" id="4493746">.</span><span class="ident" id="4493747">expect</span><span class="op" id="4493753">(</span><span class="ident" id="4493754">token</span><span class="op" id="4493759">.</span><span class="ident" id="4493760">LBRACE</span><span class="op" id="4493766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493769">p</span><span class="op" id="4493770">.</span><span class="ident" id="4493771">openScope</span><span class="op" id="4493780">(</span><span class="op" id="4493781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493784">list</span>&nbsp;<span class="op" id="4493789">:=</span>&nbsp;<span class="ident" id="4493792">p</span><span class="op" id="4493793">.</span><span class="ident" id="4493794">parseStmtList</span><span class="op" id="4493807">(</span><span class="op" id="4493808">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493811">p</span><span class="op" id="4493812">.</span><span class="ident" id="4493813">closeScope</span><span class="op" id="4493823">(</span><span class="op" id="4493824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493827">rbrace</span>&nbsp;<span class="op" id="4493834">:=</span>&nbsp;<span class="ident" id="4493837">p</span><span class="op" id="4493838">.</span><span class="ident" id="4493839">expect</span><span class="op" id="4493845">(</span><span class="ident" id="4493846">token</span><span class="op" id="4493851">.</span><span class="ident" id="4493852">RBRACE</span><span class="op" id="4493858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493862">return</span>&nbsp;<span class="op" id="4493869">&amp;</span><span class="ident" id="4493870">ast</span><span class="op" id="4493873">.</span><span class="ident" id="4493874">BlockStmt</span><span class="op" id="4493883">{</span><span class="ident" id="4493884">Lbrace</span><span class="op" id="4493890">:</span>&nbsp;<span class="ident" id="4493892">lbrace</span><span class="op" id="4493898">,</span>&nbsp;<span class="ident" id="4493900">List</span><span class="op" id="4493904">:</span>&nbsp;<span class="ident" id="4493906">list</span><span class="op" id="4493910">,</span>&nbsp;<span class="ident" id="4493912">Rbrace</span><span class="op" id="4493918">:</span>&nbsp;<span class="ident" id="4493920">rbrace</span><span class="op" id="4493926">}</span><br>
<span class="lineno"></span><span class="op" id="4493928">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="4493931">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4494011">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4494027">func</span>&nbsp;<span class="op" id="4494032">(</span><span class="ident" id="4494033">p</span>&nbsp;<span class="op" id="4494035">*</span><span class="ident" id="4494036">parser</span><span class="op" id="4494042">)</span>&nbsp;<span class="ident" id="4494044">parseFuncTypeOrLit</span><span class="op" id="4494062">(</span><span class="op" id="4494063">)</span>&nbsp;<span class="ident" id="4494065">ast</span><span class="op" id="4494068">.</span><span class="ident" id="4494069">Expr</span>&nbsp;<span class="op" id="4494074">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494077">if</span>&nbsp;<span class="ident" id="4494080">p</span><span class="op" id="4494081">.</span><span class="ident" id="4494082">trace</span>&nbsp;<span class="op" id="4494088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494092">defer</span>&nbsp;<span class="ident" id="4494098">un</span><span class="op" id="4494100">(</span><span class="ident" id="4494101">trace</span><span class="op" id="4494106">(</span><span class="ident" id="4494107">p</span><span class="op" id="4494108">,</span>&nbsp;<span class="string" id="4494110">&#34;FuncTypeOrLit&#34;</span><span class="op" id="4494125">)</span><span class="op" id="4494126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494133">typ</span><span class="op" id="4494136">,</span>&nbsp;<span class="ident" id="4494138">scope</span>&nbsp;<span class="op" id="4494144">:=</span>&nbsp;<span class="ident" id="4494147">p</span><span class="op" id="4494148">.</span><span class="ident" id="4494149">parseFuncType</span><span class="op" id="4494162">(</span><span class="op" id="4494163">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494166">if</span>&nbsp;<span class="ident" id="4494169">p</span><span class="op" id="4494170">.</span><span class="ident" id="4494171">tok</span>&nbsp;<span class="op" id="4494175">!=</span>&nbsp;<span class="ident" id="4494178">token</span><span class="op" id="4494183">.</span><span class="ident" id="4494184">LBRACE</span>&nbsp;<span class="op" id="4494191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4494195">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494219">return</span>&nbsp;<span class="ident" id="4494226">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494235">p</span><span class="op" id="4494236">.</span><span class="ident" id="4494237">exprLev</span><span class="op" id="4494244">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494248">body</span>&nbsp;<span class="op" id="4494253">:=</span>&nbsp;<span class="ident" id="4494256">p</span><span class="op" id="4494257">.</span><span class="ident" id="4494258">parseBody</span><span class="op" id="4494267">(</span><span class="ident" id="4494268">scope</span><span class="op" id="4494273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494276">p</span><span class="op" id="4494277">.</span><span class="ident" id="4494278">exprLev</span><span class="op" id="4494285">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494290">return</span>&nbsp;<span class="op" id="4494297">&amp;</span><span class="ident" id="4494298">ast</span><span class="op" id="4494301">.</span><span class="ident" id="4494302">FuncLit</span><span class="op" id="4494309">{</span><span class="ident" id="4494310">Type</span><span class="op" id="4494314">:</span>&nbsp;<span class="ident" id="4494316">typ</span><span class="op" id="4494319">,</span>&nbsp;<span class="ident" id="4494321">Body</span><span class="op" id="4494325">:</span>&nbsp;<span class="ident" id="4494327">body</span><span class="op" id="4494331">}</span><br>
<span class="lineno">1110</span><span class="op" id="4494333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4494336">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="4494404">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="4494465">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="4494535">//</span><br>
<span class="lineno"></span><span class="keyword" id="4494538">func</span>&nbsp;<span class="op" id="4494543">(</span><span class="ident" id="4494544">p</span>&nbsp;<span class="op" id="4494546">*</span><span class="ident" id="4494547">parser</span><span class="op" id="4494553">)</span>&nbsp;<span class="ident" id="4494555">parseOperand</span><span class="op" id="4494567">(</span><span class="ident" id="4494568">lhs</span>&nbsp;<span class="builtintype" id="4494572">bool</span><span class="op" id="4494576">)</span>&nbsp;<span class="ident" id="4494578">ast</span><span class="op" id="4494581">.</span><span class="ident" id="4494582">Expr</span>&nbsp;<span class="op" id="4494587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494590">if</span>&nbsp;<span class="ident" id="4494593">p</span><span class="op" id="4494594">.</span><span class="ident" id="4494595">trace</span>&nbsp;<span class="op" id="4494601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494605">defer</span>&nbsp;<span class="ident" id="4494611">un</span><span class="op" id="4494613">(</span><span class="ident" id="4494614">trace</span><span class="op" id="4494619">(</span><span class="ident" id="4494620">p</span><span class="op" id="4494621">,</span>&nbsp;<span class="string" id="4494623">&#34;Operand&#34;</span><span class="op" id="4494632">)</span><span class="op" id="4494633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494636">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494640">switch</span>&nbsp;<span class="ident" id="4494647">p</span><span class="op" id="4494648">.</span><span class="ident" id="4494649">tok</span>&nbsp;<span class="op" id="4494653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494656">case</span>&nbsp;<span class="ident" id="4494661">token</span><span class="op" id="4494666">.</span><span class="ident" id="4494667">IDENT</span><span class="op" id="4494672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494676">x</span>&nbsp;<span class="op" id="4494678">:=</span>&nbsp;<span class="ident" id="4494681">p</span><span class="op" id="4494682">.</span><span class="ident" id="4494683">parseIdent</span><span class="op" id="4494693">(</span><span class="op" id="4494694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494698">if</span>&nbsp;<span class="op" id="4494701">!</span><span class="ident" id="4494702">lhs</span>&nbsp;<span class="op" id="4494706">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494711">p</span><span class="op" id="4494712">.</span><span class="ident" id="4494713">resolve</span><span class="op" id="4494720">(</span><span class="ident" id="4494721">x</span><span class="op" id="4494722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494730">return</span>&nbsp;<span class="ident" id="4494737">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494741">case</span>&nbsp;<span class="ident" id="4494746">token</span><span class="op" id="4494751">.</span><span class="ident" id="4494752">INT</span><span class="op" id="4494755">,</span>&nbsp;<span class="ident" id="4494757">token</span><span class="op" id="4494762">.</span><span class="ident" id="4494763">FLOAT</span><span class="op" id="4494768">,</span>&nbsp;<span class="ident" id="4494770">token</span><span class="op" id="4494775">.</span><span class="ident" id="4494776">IMAG</span><span class="op" id="4494780">,</span>&nbsp;<span class="ident" id="4494782">token</span><span class="op" id="4494787">.</span><span class="ident" id="4494788">CHAR</span><span class="op" id="4494792">,</span>&nbsp;<span class="ident" id="4494794">token</span><span class="op" id="4494799">.</span><span class="ident" id="4494800">STRING</span><span class="op" id="4494806">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494810">x</span>&nbsp;<span class="op" id="4494812">:=</span>&nbsp;<span class="op" id="4494815">&amp;</span><span class="ident" id="4494816">ast</span><span class="op" id="4494819">.</span><span class="ident" id="4494820">BasicLit</span><span class="op" id="4494828">{</span><span class="ident" id="4494829">ValuePos</span><span class="op" id="4494837">:</span>&nbsp;<span class="ident" id="4494839">p</span><span class="op" id="4494840">.</span><span class="ident" id="4494841">pos</span><span class="op" id="4494844">,</span>&nbsp;<span class="ident" id="4494846">Kind</span><span class="op" id="4494850">:</span>&nbsp;<span class="ident" id="4494852">p</span><span class="op" id="4494853">.</span><span class="ident" id="4494854">tok</span><span class="op" id="4494857">,</span>&nbsp;<span class="ident" id="4494859">Value</span><span class="op" id="4494864">:</span>&nbsp;<span class="ident" id="4494866">p</span><span class="op" id="4494867">.</span><span class="ident" id="4494868">lit</span><span class="op" id="4494871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494875">p</span><span class="op" id="4494876">.</span><span class="ident" id="4494877">next</span><span class="op" id="4494881">(</span><span class="op" id="4494882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494886">return</span>&nbsp;<span class="ident" id="4494893">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494897">case</span>&nbsp;<span class="ident" id="4494902">token</span><span class="op" id="4494907">.</span><span class="ident" id="4494908">LPAREN</span><span class="op" id="4494914">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494918">lparen</span>&nbsp;<span class="op" id="4494925">:=</span>&nbsp;<span class="ident" id="4494928">p</span><span class="op" id="4494929">.</span><span class="ident" id="4494930">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494936">p</span><span class="op" id="4494937">.</span><span class="ident" id="4494938">next</span><span class="op" id="4494942">(</span><span class="op" id="4494943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494947">p</span><span class="op" id="4494948">.</span><span class="ident" id="4494949">exprLev</span><span class="op" id="4494956">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494961">x</span>&nbsp;<span class="op" id="4494963">:=</span>&nbsp;<span class="ident" id="4494966">p</span><span class="op" id="4494967">.</span><span class="ident" id="4494968">parseRhsOrType</span><span class="op" id="4494982">(</span><span class="op" id="4494983">)</span>&nbsp;<span class="comment" id="4494985">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495030">p</span><span class="op" id="4495031">.</span><span class="ident" id="4495032">exprLev</span><span class="op" id="4495039">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495044">rparen</span>&nbsp;<span class="op" id="4495051">:=</span>&nbsp;<span class="ident" id="4495054">p</span><span class="op" id="4495055">.</span><span class="ident" id="4495056">expect</span><span class="op" id="4495062">(</span><span class="ident" id="4495063">token</span><span class="op" id="4495068">.</span><span class="ident" id="4495069">RPAREN</span><span class="op" id="4495075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495079">return</span>&nbsp;<span class="op" id="4495086">&amp;</span><span class="ident" id="4495087">ast</span><span class="op" id="4495090">.</span><span class="ident" id="4495091">ParenExpr</span><span class="op" id="4495100">{</span><span class="ident" id="4495101">Lparen</span><span class="op" id="4495107">:</span>&nbsp;<span class="ident" id="4495109">lparen</span><span class="op" id="4495115">,</span>&nbsp;<span class="ident" id="4495117">X</span><span class="op" id="4495118">:</span>&nbsp;<span class="ident" id="4495120">x</span><span class="op" id="4495121">,</span>&nbsp;<span class="ident" id="4495123">Rparen</span><span class="op" id="4495129">:</span>&nbsp;<span class="ident" id="4495131">rparen</span><span class="op" id="4495137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495141">case</span>&nbsp;<span class="ident" id="4495146">token</span><span class="op" id="4495151">.</span><span class="ident" id="4495152">FUNC</span><span class="op" id="4495156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495160">return</span>&nbsp;<span class="ident" id="4495167">p</span><span class="op" id="4495168">.</span><span class="ident" id="4495169">parseFuncTypeOrLit</span><span class="op" id="4495187">(</span><span class="op" id="4495188">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495195">if</span>&nbsp;<span class="ident" id="4495198">typ</span>&nbsp;<span class="op" id="4495202">:=</span>&nbsp;<span class="ident" id="4495205">p</span><span class="op" id="4495206">.</span><span class="ident" id="4495207">tryIdentOrType</span><span class="op" id="4495221">(</span><span class="op" id="4495222">)</span><span class="op" id="4495223">;</span>&nbsp;<span class="ident" id="4495225">typ</span>&nbsp;<span class="op" id="4495229">!=</span>&nbsp;<span class="ident" id="4495232">nil</span>&nbsp;<span class="op" id="4495236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4495240">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495295">_</span><span class="op" id="4495296">,</span>&nbsp;<span class="ident" id="4495298">isIdent</span>&nbsp;<span class="op" id="4495306">:=</span>&nbsp;<span class="ident" id="4495309">typ</span><span class="op" id="4495312">.</span><span class="op" id="4495313">(</span><span class="op" id="4495314">*</span><span class="ident" id="4495315">ast</span><span class="op" id="4495318">.</span><span class="ident" id="4495319">Ident</span><span class="op" id="4495324">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495328">assert</span><span class="op" id="4495334">(</span><span class="op" id="4495335">!</span><span class="ident" id="4495336">isIdent</span><span class="op" id="4495343">,</span>&nbsp;<span class="string" id="4495345">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="4495372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495376">return</span>&nbsp;<span class="ident" id="4495383">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4495392">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495413">pos</span>&nbsp;<span class="op" id="4495417">:=</span>&nbsp;<span class="ident" id="4495420">p</span><span class="op" id="4495421">.</span><span class="ident" id="4495422">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495427">p</span><span class="op" id="4495428">.</span><span class="ident" id="4495429">errorExpected</span><span class="op" id="4495442">(</span><span class="ident" id="4495443">pos</span><span class="op" id="4495446">,</span>&nbsp;<span class="string" id="4495448">&#34;operand&#34;</span><span class="op" id="4495457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495460">syncStmt</span><span class="op" id="4495468">(</span><span class="ident" id="4495469">p</span><span class="op" id="4495470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495473">return</span>&nbsp;<span class="op" id="4495480">&amp;</span><span class="ident" id="4495481">ast</span><span class="op" id="4495484">.</span><span class="ident" id="4495485">BadExpr</span><span class="op" id="4495492">{</span><span class="ident" id="4495493">From</span><span class="op" id="4495497">:</span>&nbsp;<span class="ident" id="4495499">pos</span><span class="op" id="4495502">,</span>&nbsp;<span class="ident" id="4495504">To</span><span class="op" id="4495506">:</span>&nbsp;<span class="ident" id="4495508">p</span><span class="op" id="4495509">.</span><span class="ident" id="4495510">pos</span><span class="op" id="4495513">}</span><br>
<span class="lineno"></span><span class="op" id="4495515">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="4495518">func</span>&nbsp;<span class="op" id="4495523">(</span><span class="ident" id="4495524">p</span>&nbsp;<span class="op" id="4495526">*</span><span class="ident" id="4495527">parser</span><span class="op" id="4495533">)</span>&nbsp;<span class="ident" id="4495535">parseSelector</span><span class="op" id="4495548">(</span><span class="ident" id="4495549">x</span>&nbsp;<span class="ident" id="4495551">ast</span><span class="op" id="4495554">.</span><span class="ident" id="4495555">Expr</span><span class="op" id="4495559">)</span>&nbsp;<span class="ident" id="4495561">ast</span><span class="op" id="4495564">.</span><span class="ident" id="4495565">Expr</span>&nbsp;<span class="op" id="4495570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495573">if</span>&nbsp;<span class="ident" id="4495576">p</span><span class="op" id="4495577">.</span><span class="ident" id="4495578">trace</span>&nbsp;<span class="op" id="4495584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495588">defer</span>&nbsp;<span class="ident" id="4495594">un</span><span class="op" id="4495596">(</span><span class="ident" id="4495597">trace</span><span class="op" id="4495602">(</span><span class="ident" id="4495603">p</span><span class="op" id="4495604">,</span>&nbsp;<span class="string" id="4495606">&#34;Selector&#34;</span><span class="op" id="4495616">)</span><span class="op" id="4495617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495620">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495624">sel</span>&nbsp;<span class="op" id="4495628">:=</span>&nbsp;<span class="ident" id="4495631">p</span><span class="op" id="4495632">.</span><span class="ident" id="4495633">parseIdent</span><span class="op" id="4495643">(</span><span class="op" id="4495644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495648">return</span>&nbsp;<span class="op" id="4495655">&amp;</span><span class="ident" id="4495656">ast</span><span class="op" id="4495659">.</span><span class="ident" id="4495660">SelectorExpr</span><span class="op" id="4495672">{</span><span class="ident" id="4495673">X</span><span class="op" id="4495674">:</span>&nbsp;<span class="ident" id="4495676">x</span><span class="op" id="4495677">,</span>&nbsp;<span class="ident" id="4495679">Sel</span><span class="op" id="4495682">:</span>&nbsp;<span class="ident" id="4495684">sel</span><span class="op" id="4495687">}</span><br>
<span class="lineno"></span><span class="op" id="4495689">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="4495692">func</span>&nbsp;<span class="op" id="4495697">(</span><span class="ident" id="4495698">p</span>&nbsp;<span class="op" id="4495700">*</span><span class="ident" id="4495701">parser</span><span class="op" id="4495707">)</span>&nbsp;<span class="ident" id="4495709">parseTypeAssertion</span><span class="op" id="4495727">(</span><span class="ident" id="4495728">x</span>&nbsp;<span class="ident" id="4495730">ast</span><span class="op" id="4495733">.</span><span class="ident" id="4495734">Expr</span><span class="op" id="4495738">)</span>&nbsp;<span class="ident" id="4495740">ast</span><span class="op" id="4495743">.</span><span class="ident" id="4495744">Expr</span>&nbsp;<span class="op" id="4495749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495752">if</span>&nbsp;<span class="ident" id="4495755">p</span><span class="op" id="4495756">.</span><span class="ident" id="4495757">trace</span>&nbsp;<span class="op" id="4495763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495767">defer</span>&nbsp;<span class="ident" id="4495773">un</span><span class="op" id="4495775">(</span><span class="ident" id="4495776">trace</span><span class="op" id="4495781">(</span><span class="ident" id="4495782">p</span><span class="op" id="4495783">,</span>&nbsp;<span class="string" id="4495785">&#34;TypeAssertion&#34;</span><span class="op" id="4495800">)</span><span class="op" id="4495801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495804">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495808">lparen</span>&nbsp;<span class="op" id="4495815">:=</span>&nbsp;<span class="ident" id="4495818">p</span><span class="op" id="4495819">.</span><span class="ident" id="4495820">expect</span><span class="op" id="4495826">(</span><span class="ident" id="4495827">token</span><span class="op" id="4495832">.</span><span class="ident" id="4495833">LPAREN</span><span class="op" id="4495839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495842">var</span>&nbsp;<span class="ident" id="4495846">typ</span>&nbsp;<span class="ident" id="4495850">ast</span><span class="op" id="4495853">.</span><span class="ident" id="4495854">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495860">if</span>&nbsp;<span class="ident" id="4495863">p</span><span class="op" id="4495864">.</span><span class="ident" id="4495865">tok</span>&nbsp;<span class="op" id="4495869">==</span>&nbsp;<span class="ident" id="4495872">token</span><span class="op" id="4495877">.</span><span class="ident" id="4495878">TYPE</span>&nbsp;<span class="op" id="4495883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4495887">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495916">p</span><span class="op" id="4495917">.</span><span class="ident" id="4495918">next</span><span class="op" id="4495922">(</span><span class="op" id="4495923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495926">}</span>&nbsp;<span class="keyword" id="4495928">else</span>&nbsp;<span class="op" id="4495933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495937">typ</span>&nbsp;<span class="op" id="4495941">=</span>&nbsp;<span class="ident" id="4495943">p</span><span class="op" id="4495944">.</span><span class="ident" id="4495945">parseType</span><span class="op" id="4495954">(</span><span class="op" id="4495955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495961">rparen</span>&nbsp;<span class="op" id="4495968">:=</span>&nbsp;<span class="ident" id="4495971">p</span><span class="op" id="4495972">.</span><span class="ident" id="4495973">expect</span><span class="op" id="4495979">(</span><span class="ident" id="4495980">token</span><span class="op" id="4495985">.</span><span class="ident" id="4495986">RPAREN</span><span class="op" id="4495992">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495996">return</span>&nbsp;<span class="op" id="4496003">&amp;</span><span class="ident" id="4496004">ast</span><span class="op" id="4496007">.</span><span class="ident" id="4496008">TypeAssertExpr</span><span class="op" id="4496022">{</span><span class="ident" id="4496023">X</span><span class="op" id="4496024">:</span>&nbsp;<span class="ident" id="4496026">x</span><span class="op" id="4496027">,</span>&nbsp;<span class="ident" id="4496029">Type</span><span class="op" id="4496033">:</span>&nbsp;<span class="ident" id="4496035">typ</span><span class="op" id="4496038">,</span>&nbsp;<span class="ident" id="4496040">Lparen</span><span class="op" id="4496046">:</span>&nbsp;<span class="ident" id="4496048">lparen</span><span class="op" id="4496054">,</span>&nbsp;<span class="ident" id="4496056">Rparen</span><span class="op" id="4496062">:</span>&nbsp;<span class="ident" id="4496064">rparen</span><span class="op" id="4496070">}</span><br>
<span class="lineno"></span><span class="op" id="4496072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4496075">func</span>&nbsp;<span class="op" id="4496080">(</span><span class="ident" id="4496081">p</span>&nbsp;<span class="op" id="4496083">*</span><span class="ident" id="4496084">parser</span><span class="op" id="4496090">)</span>&nbsp;<span class="ident" id="4496092">parseIndexOrSlice</span><span class="op" id="4496109">(</span><span class="ident" id="4496110">x</span>&nbsp;<span class="ident" id="4496112">ast</span><span class="op" id="4496115">.</span><span class="ident" id="4496116">Expr</span><span class="op" id="4496120">)</span>&nbsp;<span class="ident" id="4496122">ast</span><span class="op" id="4496125">.</span><span class="ident" id="4496126">Expr</span>&nbsp;<span class="op" id="4496131">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496134">if</span>&nbsp;<span class="ident" id="4496137">p</span><span class="op" id="4496138">.</span><span class="ident" id="4496139">trace</span>&nbsp;<span class="op" id="4496145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496149">defer</span>&nbsp;<span class="ident" id="4496155">un</span><span class="op" id="4496157">(</span><span class="ident" id="4496158">trace</span><span class="op" id="4496163">(</span><span class="ident" id="4496164">p</span><span class="op" id="4496165">,</span>&nbsp;<span class="string" id="4496167">&#34;IndexOrSlice&#34;</span><span class="op" id="4496181">)</span><span class="op" id="4496182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496189">const</span>&nbsp;<span class="ident" id="4496195">N</span>&nbsp;<span class="op" id="4496197">=</span>&nbsp;<span class="num" id="4496199">3</span>&nbsp;<span class="comment" id="4496201">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496249">lbrack</span>&nbsp;<span class="op" id="4496256">:=</span>&nbsp;<span class="ident" id="4496259">p</span><span class="op" id="4496260">.</span><span class="ident" id="4496261">expect</span><span class="op" id="4496267">(</span><span class="ident" id="4496268">token</span><span class="op" id="4496273">.</span><span class="ident" id="4496274">LBRACK</span><span class="op" id="4496280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496283">p</span><span class="op" id="4496284">.</span><span class="ident" id="4496285">exprLev</span><span class="op" id="4496292">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496296">var</span>&nbsp;<span class="ident" id="4496300">index</span>&nbsp;<span class="op" id="4496306">[</span><span class="ident" id="4496307">N</span><span class="op" id="4496308">]</span><span class="ident" id="4496309">ast</span><span class="op" id="4496312">.</span><span class="ident" id="4496313">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496319">var</span>&nbsp;<span class="ident" id="4496323">colons</span>&nbsp;<span class="op" id="4496330">[</span><span class="ident" id="4496331">N</span>&nbsp;<span class="op" id="4496333">-</span>&nbsp;<span class="num" id="4496335">1</span><span class="op" id="4496336">]</span><span class="ident" id="4496337">token</span><span class="op" id="4496342">.</span><span class="ident" id="4496343">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496348">if</span>&nbsp;<span class="ident" id="4496351">p</span><span class="op" id="4496352">.</span><span class="ident" id="4496353">tok</span>&nbsp;<span class="op" id="4496357">!=</span>&nbsp;<span class="ident" id="4496360">token</span><span class="op" id="4496365">.</span><span class="ident" id="4496366">COLON</span>&nbsp;<span class="op" id="4496372">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496376">index</span><span class="op" id="4496381">[</span><span class="num" id="4496382">0</span><span class="op" id="4496383">]</span>&nbsp;<span class="op" id="4496385">=</span>&nbsp;<span class="ident" id="4496387">p</span><span class="op" id="4496388">.</span><span class="ident" id="4496389">parseRhs</span><span class="op" id="4496397">(</span><span class="op" id="4496398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496404">ncolons</span>&nbsp;<span class="op" id="4496412">:=</span>&nbsp;<span class="num" id="4496415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496418">for</span>&nbsp;<span class="ident" id="4496422">p</span><span class="op" id="4496423">.</span><span class="ident" id="4496424">tok</span>&nbsp;<span class="op" id="4496428">==</span>&nbsp;<span class="ident" id="4496431">token</span><span class="op" id="4496436">.</span><span class="ident" id="4496437">COLON</span>&nbsp;<span class="op" id="4496443">&amp;&amp;</span>&nbsp;<span class="ident" id="4496446">ncolons</span>&nbsp;<span class="op" id="4496454">&lt;</span>&nbsp;<span class="builtinfunc" id="4496456">len</span><span class="op" id="4496459">(</span><span class="ident" id="4496460">colons</span><span class="op" id="4496466">)</span>&nbsp;<span class="op" id="4496468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496472">colons</span><span class="op" id="4496478">[</span><span class="ident" id="4496479">ncolons</span><span class="op" id="4496486">]</span>&nbsp;<span class="op" id="4496488">=</span>&nbsp;<span class="ident" id="4496490">p</span><span class="op" id="4496491">.</span><span class="ident" id="4496492">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496498">ncolons</span><span class="op" id="4496505">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496510">p</span><span class="op" id="4496511">.</span><span class="ident" id="4496512">next</span><span class="op" id="4496516">(</span><span class="op" id="4496517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496521">if</span>&nbsp;<span class="ident" id="4496524">p</span><span class="op" id="4496525">.</span><span class="ident" id="4496526">tok</span>&nbsp;<span class="op" id="4496530">!=</span>&nbsp;<span class="ident" id="4496533">token</span><span class="op" id="4496538">.</span><span class="ident" id="4496539">COLON</span>&nbsp;<span class="op" id="4496545">&amp;&amp;</span>&nbsp;<span class="ident" id="4496548">p</span><span class="op" id="4496549">.</span><span class="ident" id="4496550">tok</span>&nbsp;<span class="op" id="4496554">!=</span>&nbsp;<span class="ident" id="4496557">token</span><span class="op" id="4496562">.</span><span class="ident" id="4496563">RBRACK</span>&nbsp;<span class="op" id="4496570">&amp;&amp;</span>&nbsp;<span class="ident" id="4496573">p</span><span class="op" id="4496574">.</span><span class="ident" id="4496575">tok</span>&nbsp;<span class="op" id="4496579">!=</span>&nbsp;<span class="ident" id="4496582">token</span><span class="op" id="4496587">.</span><span class="ident" id="4496588">EOF</span>&nbsp;<span class="op" id="4496592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496597">index</span><span class="op" id="4496602">[</span><span class="ident" id="4496603">ncolons</span><span class="op" id="4496610">]</span>&nbsp;<span class="op" id="4496612">=</span>&nbsp;<span class="ident" id="4496614">p</span><span class="op" id="4496615">.</span><span class="ident" id="4496616">parseRhs</span><span class="op" id="4496624">(</span><span class="op" id="4496625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496629">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496635">p</span><span class="op" id="4496636">.</span><span class="ident" id="4496637">exprLev</span><span class="op" id="4496644">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496648">rbrack</span>&nbsp;<span class="op" id="4496655">:=</span>&nbsp;<span class="ident" id="4496658">p</span><span class="op" id="4496659">.</span><span class="ident" id="4496660">expect</span><span class="op" id="4496666">(</span><span class="ident" id="4496667">token</span><span class="op" id="4496672">.</span><span class="ident" id="4496673">RBRACK</span><span class="op" id="4496679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496683">if</span>&nbsp;<span class="ident" id="4496686">ncolons</span>&nbsp;<span class="op" id="4496694">&gt;</span>&nbsp;<span class="num" id="4496696">0</span>&nbsp;<span class="op" id="4496698">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4496702">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496724">slice3</span>&nbsp;<span class="op" id="4496731">:=</span>&nbsp;<span class="builtintype" id="4496734">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496742">if</span>&nbsp;<span class="ident" id="4496745">ncolons</span>&nbsp;<span class="op" id="4496753">==</span>&nbsp;<span class="num" id="4496756">2</span>&nbsp;<span class="op" id="4496758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496763">slice3</span>&nbsp;<span class="op" id="4496770">=</span>&nbsp;<span class="builtintype" id="4496772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4496780">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4496860">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496941">if</span>&nbsp;<span class="ident" id="4496944">index</span><span class="op" id="4496949">[</span><span class="num" id="4496950">1</span><span class="op" id="4496951">]</span>&nbsp;<span class="op" id="4496953">==</span>&nbsp;<span class="ident" id="4496956">nil</span>&nbsp;<span class="op" id="4496960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496966">p</span><span class="op" id="4496967">.</span><span class="builtintype" id="4496968">error</span><span class="op" id="4496973">(</span><span class="ident" id="4496974">colons</span><span class="op" id="4496980">[</span><span class="num" id="4496981">0</span><span class="op" id="4496982">]</span><span class="op" id="4496983">,</span>&nbsp;<span class="string" id="4496985">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4497022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497028">index</span><span class="op" id="4497033">[</span><span class="num" id="4497034">1</span><span class="op" id="4497035">]</span>&nbsp;<span class="op" id="4497037">=</span>&nbsp;<span class="op" id="4497039">&amp;</span><span class="ident" id="4497040">ast</span><span class="op" id="4497043">.</span><span class="ident" id="4497044">BadExpr</span><span class="op" id="4497051">{</span><span class="ident" id="4497052">From</span><span class="op" id="4497056">:</span>&nbsp;<span class="ident" id="4497058">colons</span><span class="op" id="4497064">[</span><span class="num" id="4497065">0</span><span class="op" id="4497066">]</span>&nbsp;<span class="op" id="4497068">+</span>&nbsp;<span class="num" id="4497070">1</span><span class="op" id="4497071">,</span>&nbsp;<span class="ident" id="4497073">To</span><span class="op" id="4497075">:</span>&nbsp;<span class="ident" id="4497077">colons</span><span class="op" id="4497083">[</span><span class="num" id="4497084">1</span><span class="op" id="4497085">]</span><span class="op" id="4497086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497091">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497096">if</span>&nbsp;<span class="ident" id="4497099">index</span><span class="op" id="4497104">[</span><span class="num" id="4497105">2</span><span class="op" id="4497106">]</span>&nbsp;<span class="op" id="4497108">==</span>&nbsp;<span class="ident" id="4497111">nil</span>&nbsp;<span class="op" id="4497115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497121">p</span><span class="op" id="4497122">.</span><span class="builtintype" id="4497123">error</span><span class="op" id="4497128">(</span><span class="ident" id="4497129">colons</span><span class="op" id="4497135">[</span><span class="num" id="4497136">1</span><span class="op" id="4497137">]</span><span class="op" id="4497138">,</span>&nbsp;<span class="string" id="4497140">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4497177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497183">index</span><span class="op" id="4497188">[</span><span class="num" id="4497189">2</span><span class="op" id="4497190">]</span>&nbsp;<span class="op" id="4497192">=</span>&nbsp;<span class="op" id="4497194">&amp;</span><span class="ident" id="4497195">ast</span><span class="op" id="4497198">.</span><span class="ident" id="4497199">BadExpr</span><span class="op" id="4497206">{</span><span class="ident" id="4497207">From</span><span class="op" id="4497211">:</span>&nbsp;<span class="ident" id="4497213">colons</span><span class="op" id="4497219">[</span><span class="num" id="4497220">1</span><span class="op" id="4497221">]</span>&nbsp;<span class="op" id="4497223">+</span>&nbsp;<span class="num" id="4497225">1</span><span class="op" id="4497226">,</span>&nbsp;<span class="ident" id="4497228">To</span><span class="op" id="4497230">:</span>&nbsp;<span class="ident" id="4497232">rbrack</span><span class="op" id="4497238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497247">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497251">return</span>&nbsp;<span class="op" id="4497258">&amp;</span><span class="ident" id="4497259">ast</span><span class="op" id="4497262">.</span><span class="ident" id="4497263">SliceExpr</span><span class="op" id="4497272">{</span><span class="ident" id="4497273">X</span><span class="op" id="4497274">:</span>&nbsp;<span class="ident" id="4497276">x</span><span class="op" id="4497277">,</span>&nbsp;<span class="ident" id="4497279">Lbrack</span><span class="op" id="4497285">:</span>&nbsp;<span class="ident" id="4497287">lbrack</span><span class="op" id="4497293">,</span>&nbsp;<span class="ident" id="4497295">Low</span><span class="op" id="4497298">:</span>&nbsp;<span class="ident" id="4497300">index</span><span class="op" id="4497305">[</span><span class="num" id="4497306">0</span><span class="op" id="4497307">]</span><span class="op" id="4497308">,</span>&nbsp;<span class="ident" id="4497310">High</span><span class="op" id="4497314">:</span>&nbsp;<span class="ident" id="4497316">index</span><span class="op" id="4497321">[</span><span class="num" id="4497322">1</span><span class="op" id="4497323">]</span><span class="op" id="4497324">,</span>&nbsp;<span class="ident" id="4497326">Max</span><span class="op" id="4497329">:</span>&nbsp;<span class="ident" id="4497331">index</span><span class="op" id="4497336">[</span><span class="num" id="4497337">2</span><span class="op" id="4497338">]</span><span class="op" id="4497339">,</span>&nbsp;<span class="ident" id="4497341">Slice3</span><span class="op" id="4497347">:</span>&nbsp;<span class="ident" id="4497349">slice3</span><span class="op" id="4497355">,</span>&nbsp;<span class="ident" id="4497357">Rbrack</span><span class="op" id="4497363">:</span>&nbsp;<span class="ident" id="4497365">rbrack</span><span class="op" id="4497371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497378">return</span>&nbsp;<span class="op" id="4497385">&amp;</span><span class="ident" id="4497386">ast</span><span class="op" id="4497389">.</span><span class="ident" id="4497390">IndexExpr</span><span class="op" id="4497399">{</span><span class="ident" id="4497400">X</span><span class="op" id="4497401">:</span>&nbsp;<span class="ident" id="4497403">x</span><span class="op" id="4497404">,</span>&nbsp;<span class="ident" id="4497406">Lbrack</span><span class="op" id="4497412">:</span>&nbsp;<span class="ident" id="4497414">lbrack</span><span class="op" id="4497420">,</span>&nbsp;<span class="ident" id="4497422">Index</span><span class="op" id="4497427">:</span>&nbsp;<span class="ident" id="4497429">index</span><span class="op" id="4497434">[</span><span class="num" id="4497435">0</span><span class="op" id="4497436">]</span><span class="op" id="4497437">,</span>&nbsp;<span class="ident" id="4497439">Rbrack</span><span class="op" id="4497445">:</span>&nbsp;<span class="ident" id="4497447">rbrack</span><span class="op" id="4497453">}</span><br>
<span class="lineno"></span><span class="op" id="4497455">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="4497458">func</span>&nbsp;<span class="op" id="4497463">(</span><span class="ident" id="4497464">p</span>&nbsp;<span class="op" id="4497466">*</span><span class="ident" id="4497467">parser</span><span class="op" id="4497473">)</span>&nbsp;<span class="ident" id="4497475">parseCallOrConversion</span><span class="op" id="4497496">(</span><span class="ident" id="4497497">fun</span>&nbsp;<span class="ident" id="4497501">ast</span><span class="op" id="4497504">.</span><span class="ident" id="4497505">Expr</span><span class="op" id="4497509">)</span>&nbsp;<span class="op" id="4497511">*</span><span class="ident" id="4497512">ast</span><span class="op" id="4497515">.</span><span class="ident" id="4497516">CallExpr</span>&nbsp;<span class="op" id="4497525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497528">if</span>&nbsp;<span class="ident" id="4497531">p</span><span class="op" id="4497532">.</span><span class="ident" id="4497533">trace</span>&nbsp;<span class="op" id="4497539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497543">defer</span>&nbsp;<span class="ident" id="4497549">un</span><span class="op" id="4497551">(</span><span class="ident" id="4497552">trace</span><span class="op" id="4497557">(</span><span class="ident" id="4497558">p</span><span class="op" id="4497559">,</span>&nbsp;<span class="string" id="4497561">&#34;CallOrConversion&#34;</span><span class="op" id="4497579">)</span><span class="op" id="4497580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497583">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497587">lparen</span>&nbsp;<span class="op" id="4497594">:=</span>&nbsp;<span class="ident" id="4497597">p</span><span class="op" id="4497598">.</span><span class="ident" id="4497599">expect</span><span class="op" id="4497605">(</span><span class="ident" id="4497606">token</span><span class="op" id="4497611">.</span><span class="ident" id="4497612">LPAREN</span><span class="op" id="4497618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497621">p</span><span class="op" id="4497622">.</span><span class="ident" id="4497623">exprLev</span><span class="op" id="4497630">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497634">var</span>&nbsp;<span class="ident" id="4497638">list</span>&nbsp;<span class="op" id="4497643">[</span><span class="op" id="4497644">]</span><span class="ident" id="4497645">ast</span><span class="op" id="4497648">.</span><span class="ident" id="4497649">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497655">var</span>&nbsp;<span class="ident" id="4497659">ellipsis</span>&nbsp;<span class="ident" id="4497668">token</span><span class="op" id="4497673">.</span><span class="ident" id="4497674">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497679">for</span>&nbsp;<span class="ident" id="4497683">p</span><span class="op" id="4497684">.</span><span class="ident" id="4497685">tok</span>&nbsp;<span class="op" id="4497689">!=</span>&nbsp;<span class="ident" id="4497692">token</span><span class="op" id="4497697">.</span><span class="ident" id="4497698">RPAREN</span>&nbsp;<span class="op" id="4497705">&amp;&amp;</span>&nbsp;<span class="ident" id="4497708">p</span><span class="op" id="4497709">.</span><span class="ident" id="4497710">tok</span>&nbsp;<span class="op" id="4497714">!=</span>&nbsp;<span class="ident" id="4497717">token</span><span class="op" id="4497722">.</span><span class="ident" id="4497723">EOF</span>&nbsp;<span class="op" id="4497727">&amp;&amp;</span>&nbsp;<span class="op" id="4497730">!</span><span class="ident" id="4497731">ellipsis</span><span class="op" id="4497739">.</span><span class="ident" id="4497740">IsValid</span><span class="op" id="4497747">(</span><span class="op" id="4497748">)</span>&nbsp;<span class="op" id="4497750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497754">list</span>&nbsp;<span class="op" id="4497759">=</span>&nbsp;<span class="builtinfunc" id="4497761">append</span><span class="op" id="4497767">(</span><span class="ident" id="4497768">list</span><span class="op" id="4497772">,</span>&nbsp;<span class="ident" id="4497774">p</span><span class="op" id="4497775">.</span><span class="ident" id="4497776">parseRhsOrType</span><span class="op" id="4497790">(</span><span class="op" id="4497791">)</span><span class="op" id="4497792">)</span>&nbsp;<span class="comment" id="4497794">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497848">if</span>&nbsp;<span class="ident" id="4497851">p</span><span class="op" id="4497852">.</span><span class="ident" id="4497853">tok</span>&nbsp;<span class="op" id="4497857">==</span>&nbsp;<span class="ident" id="4497860">token</span><span class="op" id="4497865">.</span><span class="ident" id="4497866">ELLIPSIS</span>&nbsp;<span class="op" id="4497875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497880">ellipsis</span>&nbsp;<span class="op" id="4497889">=</span>&nbsp;<span class="ident" id="4497891">p</span><span class="op" id="4497892">.</span><span class="ident" id="4497893">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497900">p</span><span class="op" id="4497901">.</span><span class="ident" id="4497902">next</span><span class="op" id="4497906">(</span><span class="op" id="4497907">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497915">if</span>&nbsp;<span class="op" id="4497918">!</span><span class="ident" id="4497919">p</span><span class="op" id="4497920">.</span><span class="ident" id="4497921">atComma</span><span class="op" id="4497928">(</span><span class="string" id="4497929">&#34;argument&nbsp;list&#34;</span><span class="op" id="4497944">)</span>&nbsp;<span class="op" id="4497946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497951">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497963">p</span><span class="op" id="4497964">.</span><span class="ident" id="4497965">next</span><span class="op" id="4497969">(</span><span class="op" id="4497970">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497976">p</span><span class="op" id="4497977">.</span><span class="ident" id="4497978">exprLev</span><span class="op" id="4497985">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497989">rparen</span>&nbsp;<span class="op" id="4497996">:=</span>&nbsp;<span class="ident" id="4497999">p</span><span class="op" id="4498000">.</span><span class="ident" id="4498001">expectClosing</span><span class="op" id="4498014">(</span><span class="ident" id="4498015">token</span><span class="op" id="4498020">.</span><span class="ident" id="4498021">RPAREN</span><span class="op" id="4498027">,</span>&nbsp;<span class="string" id="4498029">&#34;argument&nbsp;list&#34;</span><span class="op" id="4498044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498048">return</span>&nbsp;<span class="op" id="4498055">&amp;</span><span class="ident" id="4498056">ast</span><span class="op" id="4498059">.</span><span class="ident" id="4498060">CallExpr</span><span class="op" id="4498068">{</span><span class="ident" id="4498069">Fun</span><span class="op" id="4498072">:</span>&nbsp;<span class="ident" id="4498074">fun</span><span class="op" id="4498077">,</span>&nbsp;<span class="ident" id="4498079">Lparen</span><span class="op" id="4498085">:</span>&nbsp;<span class="ident" id="4498087">lparen</span><span class="op" id="4498093">,</span>&nbsp;<span class="ident" id="4498095">Args</span><span class="op" id="4498099">:</span>&nbsp;<span class="ident" id="4498101">list</span><span class="op" id="4498105">,</span>&nbsp;<span class="ident" id="4498107">Ellipsis</span><span class="op" id="4498115">:</span>&nbsp;<span class="ident" id="4498117">ellipsis</span><span class="op" id="4498125">,</span>&nbsp;<span class="ident" id="4498127">Rparen</span><span class="op" id="4498133">:</span>&nbsp;<span class="ident" id="4498135">rparen</span><span class="op" id="4498141">}</span><br>
<span class="lineno">1260</span><span class="op" id="4498143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4498146">func</span>&nbsp;<span class="op" id="4498151">(</span><span class="ident" id="4498152">p</span>&nbsp;<span class="op" id="4498154">*</span><span class="ident" id="4498155">parser</span><span class="op" id="4498161">)</span>&nbsp;<span class="ident" id="4498163">parseElement</span><span class="op" id="4498175">(</span><span class="ident" id="4498176">keyOk</span>&nbsp;<span class="builtintype" id="4498182">bool</span><span class="op" id="4498186">)</span>&nbsp;<span class="ident" id="4498188">ast</span><span class="op" id="4498191">.</span><span class="ident" id="4498192">Expr</span>&nbsp;<span class="op" id="4498197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498200">if</span>&nbsp;<span class="ident" id="4498203">p</span><span class="op" id="4498204">.</span><span class="ident" id="4498205">trace</span>&nbsp;<span class="op" id="4498211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498215">defer</span>&nbsp;<span class="ident" id="4498221">un</span><span class="op" id="4498223">(</span><span class="ident" id="4498224">trace</span><span class="op" id="4498229">(</span><span class="ident" id="4498230">p</span><span class="op" id="4498231">,</span>&nbsp;<span class="string" id="4498233">&#34;Element&#34;</span><span class="op" id="4498242">)</span><span class="op" id="4498243">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498250">if</span>&nbsp;<span class="ident" id="4498253">p</span><span class="op" id="4498254">.</span><span class="ident" id="4498255">tok</span>&nbsp;<span class="op" id="4498259">==</span>&nbsp;<span class="ident" id="4498262">token</span><span class="op" id="4498267">.</span><span class="ident" id="4498268">LBRACE</span>&nbsp;<span class="op" id="4498275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498279">return</span>&nbsp;<span class="ident" id="4498286">p</span><span class="op" id="4498287">.</span><span class="ident" id="4498288">parseLiteralValue</span><span class="op" id="4498305">(</span><span class="ident" id="4498306">nil</span><span class="op" id="4498309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498312">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498316">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498390">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498462">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498532">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498546">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498550">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498620">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498689">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498760">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498828">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498895">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498899">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498965">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499038">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499111">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499184">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499213">x</span>&nbsp;<span class="op" id="4499215">:=</span>&nbsp;<span class="ident" id="4499218">p</span><span class="op" id="4499219">.</span><span class="ident" id="4499220">checkExpr</span><span class="op" id="4499229">(</span><span class="ident" id="4499230">p</span><span class="op" id="4499231">.</span><span class="ident" id="4499232">parseExpr</span><span class="op" id="4499241">(</span><span class="ident" id="4499242">keyOk</span><span class="op" id="4499247">)</span><span class="op" id="4499248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499251">if</span>&nbsp;<span class="ident" id="4499254">keyOk</span>&nbsp;<span class="op" id="4499260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499264">if</span>&nbsp;<span class="ident" id="4499267">p</span><span class="op" id="4499268">.</span><span class="ident" id="4499269">tok</span>&nbsp;<span class="op" id="4499273">==</span>&nbsp;<span class="ident" id="4499276">token</span><span class="op" id="4499281">.</span><span class="ident" id="4499282">COLON</span>&nbsp;<span class="op" id="4499288">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499293">colon</span>&nbsp;<span class="op" id="4499299">:=</span>&nbsp;<span class="ident" id="4499302">p</span><span class="op" id="4499303">.</span><span class="ident" id="4499304">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499311">p</span><span class="op" id="4499312">.</span><span class="ident" id="4499313">next</span><span class="op" id="4499317">(</span><span class="op" id="4499318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499323">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499373">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499424">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499473">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499497">p</span><span class="op" id="4499498">.</span><span class="ident" id="4499499">tryResolve</span><span class="op" id="4499509">(</span><span class="ident" id="4499510">x</span><span class="op" id="4499511">,</span>&nbsp;<span class="builtintype" id="4499513">false</span><span class="op" id="4499518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499523">return</span>&nbsp;<span class="op" id="4499530">&amp;</span><span class="ident" id="4499531">ast</span><span class="op" id="4499534">.</span><span class="ident" id="4499535">KeyValueExpr</span><span class="op" id="4499547">{</span><span class="ident" id="4499548">Key</span><span class="op" id="4499551">:</span>&nbsp;<span class="ident" id="4499553">x</span><span class="op" id="4499554">,</span>&nbsp;<span class="ident" id="4499556">Colon</span><span class="op" id="4499561">:</span>&nbsp;<span class="ident" id="4499563">colon</span><span class="op" id="4499568">,</span>&nbsp;<span class="ident" id="4499570">Value</span><span class="op" id="4499575">:</span>&nbsp;<span class="ident" id="4499577">p</span><span class="op" id="4499578">.</span><span class="ident" id="4499579">parseElement</span><span class="op" id="4499591">(</span><span class="builtintype" id="4499592">false</span><span class="op" id="4499597">)</span><span class="op" id="4499598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499606">p</span><span class="op" id="4499607">.</span><span class="ident" id="4499608">resolve</span><span class="op" id="4499615">(</span><span class="ident" id="4499616">x</span><span class="op" id="4499617">)</span>&nbsp;<span class="comment" id="4499619">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499637">return</span>&nbsp;<span class="ident" id="4499644">x</span><br>
<span class="lineno"></span><span class="op" id="4499646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="4499649">func</span>&nbsp;<span class="op" id="4499654">(</span><span class="ident" id="4499655">p</span>&nbsp;<span class="op" id="4499657">*</span><span class="ident" id="4499658">parser</span><span class="op" id="4499664">)</span>&nbsp;<span class="ident" id="4499666">parseElementList</span><span class="op" id="4499682">(</span><span class="op" id="4499683">)</span>&nbsp;<span class="op" id="4499685">(</span><span class="ident" id="4499686">list</span>&nbsp;<span class="op" id="4499691">[</span><span class="op" id="4499692">]</span><span class="ident" id="4499693">ast</span><span class="op" id="4499696">.</span><span class="ident" id="4499697">Expr</span><span class="op" id="4499701">)</span>&nbsp;<span class="op" id="4499703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499706">if</span>&nbsp;<span class="ident" id="4499709">p</span><span class="op" id="4499710">.</span><span class="ident" id="4499711">trace</span>&nbsp;<span class="op" id="4499717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499721">defer</span>&nbsp;<span class="ident" id="4499727">un</span><span class="op" id="4499729">(</span><span class="ident" id="4499730">trace</span><span class="op" id="4499735">(</span><span class="ident" id="4499736">p</span><span class="op" id="4499737">,</span>&nbsp;<span class="string" id="4499739">&#34;ElementList&#34;</span><span class="op" id="4499752">)</span><span class="op" id="4499753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499760">for</span>&nbsp;<span class="ident" id="4499764">p</span><span class="op" id="4499765">.</span><span class="ident" id="4499766">tok</span>&nbsp;<span class="op" id="4499770">!=</span>&nbsp;<span class="ident" id="4499773">token</span><span class="op" id="4499778">.</span><span class="ident" id="4499779">RBRACE</span>&nbsp;<span class="op" id="4499786">&amp;&amp;</span>&nbsp;<span class="ident" id="4499789">p</span><span class="op" id="4499790">.</span><span class="ident" id="4499791">tok</span>&nbsp;<span class="op" id="4499795">!=</span>&nbsp;<span class="ident" id="4499798">token</span><span class="op" id="4499803">.</span><span class="ident" id="4499804">EOF</span>&nbsp;<span class="op" id="4499808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499812">list</span>&nbsp;<span class="op" id="4499817">=</span>&nbsp;<span class="builtinfunc" id="4499819">append</span><span class="op" id="4499825">(</span><span class="ident" id="4499826">list</span><span class="op" id="4499830">,</span>&nbsp;<span class="ident" id="4499832">p</span><span class="op" id="4499833">.</span><span class="ident" id="4499834">parseElement</span><span class="op" id="4499846">(</span><span class="builtintype" id="4499847">true</span><span class="op" id="4499851">)</span><span class="op" id="4499852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499856">if</span>&nbsp;<span class="op" id="4499859">!</span><span class="ident" id="4499860">p</span><span class="op" id="4499861">.</span><span class="ident" id="4499862">atComma</span><span class="op" id="4499869">(</span><span class="string" id="4499870">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4499889">)</span>&nbsp;<span class="op" id="4499891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499896">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499904">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499908">p</span><span class="op" id="4499909">.</span><span class="ident" id="4499910">next</span><span class="op" id="4499914">(</span><span class="op" id="4499915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499922">return</span><br>
<span class="lineno"></span><span class="op" id="4499929">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="4499932">func</span>&nbsp;<span class="op" id="4499937">(</span><span class="ident" id="4499938">p</span>&nbsp;<span class="op" id="4499940">*</span><span class="ident" id="4499941">parser</span><span class="op" id="4499947">)</span>&nbsp;<span class="ident" id="4499949">parseLiteralValue</span><span class="op" id="4499966">(</span><span class="ident" id="4499967">typ</span>&nbsp;<span class="ident" id="4499971">ast</span><span class="op" id="4499974">.</span><span class="ident" id="4499975">Expr</span><span class="op" id="4499979">)</span>&nbsp;<span class="ident" id="4499981">ast</span><span class="op" id="4499984">.</span><span class="ident" id="4499985">Expr</span>&nbsp;<span class="op" id="4499990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499993">if</span>&nbsp;<span class="ident" id="4499996">p</span><span class="op" id="4499997">.</span><span class="ident" id="4499998">trace</span>&nbsp;<span class="op" id="4500004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500008">defer</span>&nbsp;<span class="ident" id="4500014">un</span><span class="op" id="4500016">(</span><span class="ident" id="4500017">trace</span><span class="op" id="4500022">(</span><span class="ident" id="4500023">p</span><span class="op" id="4500024">,</span>&nbsp;<span class="string" id="4500026">&#34;LiteralValue&#34;</span><span class="op" id="4500040">)</span><span class="op" id="4500041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500044">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500048">lbrace</span>&nbsp;<span class="op" id="4500055">:=</span>&nbsp;<span class="ident" id="4500058">p</span><span class="op" id="4500059">.</span><span class="ident" id="4500060">expect</span><span class="op" id="4500066">(</span><span class="ident" id="4500067">token</span><span class="op" id="4500072">.</span><span class="ident" id="4500073">LBRACE</span><span class="op" id="4500079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500082">var</span>&nbsp;<span class="ident" id="4500086">elts</span>&nbsp;<span class="op" id="4500091">[</span><span class="op" id="4500092">]</span><span class="ident" id="4500093">ast</span><span class="op" id="4500096">.</span><span class="ident" id="4500097">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500103">p</span><span class="op" id="4500104">.</span><span class="ident" id="4500105">exprLev</span><span class="op" id="4500112">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500116">if</span>&nbsp;<span class="ident" id="4500119">p</span><span class="op" id="4500120">.</span><span class="ident" id="4500121">tok</span>&nbsp;<span class="op" id="4500125">!=</span>&nbsp;<span class="ident" id="4500128">token</span><span class="op" id="4500133">.</span><span class="ident" id="4500134">RBRACE</span>&nbsp;<span class="op" id="4500141">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500145">elts</span>&nbsp;<span class="op" id="4500150">=</span>&nbsp;<span class="ident" id="4500152">p</span><span class="op" id="4500153">.</span><span class="ident" id="4500154">parseElementList</span><span class="op" id="4500170">(</span><span class="op" id="4500171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500177">p</span><span class="op" id="4500178">.</span><span class="ident" id="4500179">exprLev</span><span class="op" id="4500186">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500190">rbrace</span>&nbsp;<span class="op" id="4500197">:=</span>&nbsp;<span class="ident" id="4500200">p</span><span class="op" id="4500201">.</span><span class="ident" id="4500202">expectClosing</span><span class="op" id="4500215">(</span><span class="ident" id="4500216">token</span><span class="op" id="4500221">.</span><span class="ident" id="4500222">RBRACE</span><span class="op" id="4500228">,</span>&nbsp;<span class="string" id="4500230">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4500249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500252">return</span>&nbsp;<span class="op" id="4500259">&amp;</span><span class="ident" id="4500260">ast</span><span class="op" id="4500263">.</span><span class="ident" id="4500264">CompositeLit</span><span class="op" id="4500276">{</span><span class="ident" id="4500277">Type</span><span class="op" id="4500281">:</span>&nbsp;<span class="ident" id="4500283">typ</span><span class="op" id="4500286">,</span>&nbsp;<span class="ident" id="4500288">Lbrace</span><span class="op" id="4500294">:</span>&nbsp;<span class="ident" id="4500296">lbrace</span><span class="op" id="4500302">,</span>&nbsp;<span class="ident" id="4500304">Elts</span><span class="op" id="4500308">:</span>&nbsp;<span class="ident" id="4500310">elts</span><span class="op" id="4500314">,</span>&nbsp;<span class="ident" id="4500316">Rbrace</span><span class="op" id="4500322">:</span>&nbsp;<span class="ident" id="4500324">rbrace</span><span class="op" id="4500330">}</span><br>
<span class="lineno">1335</span><span class="op" id="4500332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4500335">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="4500397">func</span>&nbsp;<span class="op" id="4500402">(</span><span class="ident" id="4500403">p</span>&nbsp;<span class="op" id="4500405">*</span><span class="ident" id="4500406">parser</span><span class="op" id="4500412">)</span>&nbsp;<span class="ident" id="4500414">checkExpr</span><span class="op" id="4500423">(</span><span class="ident" id="4500424">x</span>&nbsp;<span class="ident" id="4500426">ast</span><span class="op" id="4500429">.</span><span class="ident" id="4500430">Expr</span><span class="op" id="4500434">)</span>&nbsp;<span class="ident" id="4500436">ast</span><span class="op" id="4500439">.</span><span class="ident" id="4500440">Expr</span>&nbsp;<span class="op" id="4500445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500448">switch</span>&nbsp;<span class="ident" id="4500455">unparen</span><span class="op" id="4500462">(</span><span class="ident" id="4500463">x</span><span class="op" id="4500464">)</span><span class="op" id="4500465">.</span><span class="op" id="4500466">(</span><span class="keyword" id="4500467">type</span><span class="op" id="4500471">)</span>&nbsp;<span class="op" id="4500473">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500476">case</span>&nbsp;<span class="op" id="4500481">*</span><span class="ident" id="4500482">ast</span><span class="op" id="4500485">.</span><span class="ident" id="4500486">BadExpr</span><span class="op" id="4500493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500496">case</span>&nbsp;<span class="op" id="4500501">*</span><span class="ident" id="4500502">ast</span><span class="op" id="4500505">.</span><span class="ident" id="4500506">Ident</span><span class="op" id="4500511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500514">case</span>&nbsp;<span class="op" id="4500519">*</span><span class="ident" id="4500520">ast</span><span class="op" id="4500523">.</span><span class="ident" id="4500524">BasicLit</span><span class="op" id="4500532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500535">case</span>&nbsp;<span class="op" id="4500540">*</span><span class="ident" id="4500541">ast</span><span class="op" id="4500544">.</span><span class="ident" id="4500545">FuncLit</span><span class="op" id="4500552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500555">case</span>&nbsp;<span class="op" id="4500560">*</span><span class="ident" id="4500561">ast</span><span class="op" id="4500564">.</span><span class="ident" id="4500565">CompositeLit</span><span class="op" id="4500577">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500580">case</span>&nbsp;<span class="op" id="4500585">*</span><span class="ident" id="4500586">ast</span><span class="op" id="4500589">.</span><span class="ident" id="4500590">ParenExpr</span><span class="op" id="4500599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4500603">panic</span><span class="op" id="4500608">(</span><span class="string" id="4500609">&#34;unreachable&#34;</span><span class="op" id="4500622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500625">case</span>&nbsp;<span class="op" id="4500630">*</span><span class="ident" id="4500631">ast</span><span class="op" id="4500634">.</span><span class="ident" id="4500635">SelectorExpr</span><span class="op" id="4500647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500650">case</span>&nbsp;<span class="op" id="4500655">*</span><span class="ident" id="4500656">ast</span><span class="op" id="4500659">.</span><span class="ident" id="4500660">IndexExpr</span><span class="op" id="4500669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500672">case</span>&nbsp;<span class="op" id="4500677">*</span><span class="ident" id="4500678">ast</span><span class="op" id="4500681">.</span><span class="ident" id="4500682">SliceExpr</span><span class="op" id="4500691">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500694">case</span>&nbsp;<span class="op" id="4500699">*</span><span class="ident" id="4500700">ast</span><span class="op" id="4500703">.</span><span class="ident" id="4500704">TypeAssertExpr</span><span class="op" id="4500718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500722">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500781">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500846">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500911">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500976">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500989">case</span>&nbsp;<span class="op" id="4500994">*</span><span class="ident" id="4500995">ast</span><span class="op" id="4500998">.</span><span class="ident" id="4500999">CallExpr</span><span class="op" id="4501007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501010">case</span>&nbsp;<span class="op" id="4501015">*</span><span class="ident" id="4501016">ast</span><span class="op" id="4501019">.</span><span class="ident" id="4501020">StarExpr</span><span class="op" id="4501028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501031">case</span>&nbsp;<span class="op" id="4501036">*</span><span class="ident" id="4501037">ast</span><span class="op" id="4501040">.</span><span class="ident" id="4501041">UnaryExpr</span><span class="op" id="4501050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501053">case</span>&nbsp;<span class="op" id="4501058">*</span><span class="ident" id="4501059">ast</span><span class="op" id="4501062">.</span><span class="ident" id="4501063">BinaryExpr</span><span class="op" id="4501073">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501076">default</span><span class="op" id="4501083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4501087">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501135">p</span><span class="op" id="4501136">.</span><span class="ident" id="4501137">errorExpected</span><span class="op" id="4501150">(</span><span class="ident" id="4501151">x</span><span class="op" id="4501152">.</span><span class="ident" id="4501153">Pos</span><span class="op" id="4501156">(</span><span class="op" id="4501157">)</span><span class="op" id="4501158">,</span>&nbsp;<span class="string" id="4501160">&#34;expression&#34;</span><span class="op" id="4501172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501176">x</span>&nbsp;<span class="op" id="4501178">=</span>&nbsp;<span class="op" id="4501180">&amp;</span><span class="ident" id="4501181">ast</span><span class="op" id="4501184">.</span><span class="ident" id="4501185">BadExpr</span><span class="op" id="4501192">{</span><span class="ident" id="4501193">From</span><span class="op" id="4501197">:</span>&nbsp;<span class="ident" id="4501199">x</span><span class="op" id="4501200">.</span><span class="ident" id="4501201">Pos</span><span class="op" id="4501204">(</span><span class="op" id="4501205">)</span><span class="op" id="4501206">,</span>&nbsp;<span class="ident" id="4501208">To</span><span class="op" id="4501210">:</span>&nbsp;<span class="ident" id="4501212">p</span><span class="op" id="4501213">.</span><span class="ident" id="4501214">safePos</span><span class="op" id="4501221">(</span><span class="ident" id="4501222">x</span><span class="op" id="4501223">.</span><span class="ident" id="4501224">End</span><span class="op" id="4501227">(</span><span class="op" id="4501228">)</span><span class="op" id="4501229">)</span><span class="op" id="4501230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501233">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501236">return</span>&nbsp;<span class="ident" id="4501243">x</span><br>
<span class="lineno"></span><span class="op" id="4501245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501248">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="4501308">func</span>&nbsp;<span class="ident" id="4501313">isTypeName</span><span class="op" id="4501323">(</span><span class="ident" id="4501324">x</span>&nbsp;<span class="ident" id="4501326">ast</span><span class="op" id="4501329">.</span><span class="ident" id="4501330">Expr</span><span class="op" id="4501334">)</span>&nbsp;<span class="builtintype" id="4501336">bool</span>&nbsp;<span class="op" id="4501341">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501344">switch</span>&nbsp;<span class="ident" id="4501351">t</span>&nbsp;<span class="op" id="4501353">:=</span>&nbsp;<span class="ident" id="4501356">x</span><span class="op" id="4501357">.</span><span class="op" id="4501358">(</span><span class="keyword" id="4501359">type</span><span class="op" id="4501363">)</span>&nbsp;<span class="op" id="4501365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501368">case</span>&nbsp;<span class="op" id="4501373">*</span><span class="ident" id="4501374">ast</span><span class="op" id="4501377">.</span><span class="ident" id="4501378">BadExpr</span><span class="op" id="4501385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501388">case</span>&nbsp;<span class="op" id="4501393">*</span><span class="ident" id="4501394">ast</span><span class="op" id="4501397">.</span><span class="ident" id="4501398">Ident</span><span class="op" id="4501403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501406">case</span>&nbsp;<span class="op" id="4501411">*</span><span class="ident" id="4501412">ast</span><span class="op" id="4501415">.</span><span class="ident" id="4501416">SelectorExpr</span><span class="op" id="4501428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501432">_</span><span class="op" id="4501433">,</span>&nbsp;<span class="ident" id="4501435">isIdent</span>&nbsp;<span class="op" id="4501443">:=</span>&nbsp;<span class="ident" id="4501446">t</span><span class="op" id="4501447">.</span><span class="ident" id="4501448">X</span><span class="op" id="4501449">.</span><span class="op" id="4501450">(</span><span class="op" id="4501451">*</span><span class="ident" id="4501452">ast</span><span class="op" id="4501455">.</span><span class="ident" id="4501456">Ident</span><span class="op" id="4501461">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501465">return</span>&nbsp;<span class="ident" id="4501472">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501481">default</span><span class="op" id="4501488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501492">return</span>&nbsp;<span class="builtintype" id="4501499">false</span>&nbsp;<span class="comment" id="4501505">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501547">return</span>&nbsp;<span class="builtintype" id="4501554">true</span><br>
<span class="lineno">1380</span><span class="op" id="4501559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501562">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4501633">func</span>&nbsp;<span class="ident" id="4501638">isLiteralType</span><span class="op" id="4501651">(</span><span class="ident" id="4501652">x</span>&nbsp;<span class="ident" id="4501654">ast</span><span class="op" id="4501657">.</span><span class="ident" id="4501658">Expr</span><span class="op" id="4501662">)</span>&nbsp;<span class="builtintype" id="4501664">bool</span>&nbsp;<span class="op" id="4501669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501672">switch</span>&nbsp;<span class="ident" id="4501679">t</span>&nbsp;<span class="op" id="4501681">:=</span>&nbsp;<span class="ident" id="4501684">x</span><span class="op" id="4501685">.</span><span class="op" id="4501686">(</span><span class="keyword" id="4501687">type</span><span class="op" id="4501691">)</span>&nbsp;<span class="op" id="4501693">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501696">case</span>&nbsp;<span class="op" id="4501701">*</span><span class="ident" id="4501702">ast</span><span class="op" id="4501705">.</span><span class="ident" id="4501706">BadExpr</span><span class="op" id="4501713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501716">case</span>&nbsp;<span class="op" id="4501721">*</span><span class="ident" id="4501722">ast</span><span class="op" id="4501725">.</span><span class="ident" id="4501726">Ident</span><span class="op" id="4501731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501734">case</span>&nbsp;<span class="op" id="4501739">*</span><span class="ident" id="4501740">ast</span><span class="op" id="4501743">.</span><span class="ident" id="4501744">SelectorExpr</span><span class="op" id="4501756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501760">_</span><span class="op" id="4501761">,</span>&nbsp;<span class="ident" id="4501763">isIdent</span>&nbsp;<span class="op" id="4501771">:=</span>&nbsp;<span class="ident" id="4501774">t</span><span class="op" id="4501775">.</span><span class="ident" id="4501776">X</span><span class="op" id="4501777">.</span><span class="op" id="4501778">(</span><span class="op" id="4501779">*</span><span class="ident" id="4501780">ast</span><span class="op" id="4501783">.</span><span class="ident" id="4501784">Ident</span><span class="op" id="4501789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501793">return</span>&nbsp;<span class="ident" id="4501800">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501809">case</span>&nbsp;<span class="op" id="4501814">*</span><span class="ident" id="4501815">ast</span><span class="op" id="4501818">.</span><span class="ident" id="4501819">ArrayType</span><span class="op" id="4501828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501831">case</span>&nbsp;<span class="op" id="4501836">*</span><span class="ident" id="4501837">ast</span><span class="op" id="4501840">.</span><span class="ident" id="4501841">StructType</span><span class="op" id="4501851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501854">case</span>&nbsp;<span class="op" id="4501859">*</span><span class="ident" id="4501860">ast</span><span class="op" id="4501863">.</span><span class="ident" id="4501864">MapType</span><span class="op" id="4501871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501874">default</span><span class="op" id="4501881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501885">return</span>&nbsp;<span class="builtintype" id="4501892">false</span>&nbsp;<span class="comment" id="4501898">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501959">return</span>&nbsp;<span class="builtintype" id="4501966">true</span><br>
<span class="lineno"></span><span class="op" id="4501971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4501974">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="4502042">func</span>&nbsp;<span class="ident" id="4502047">deref</span><span class="op" id="4502052">(</span><span class="ident" id="4502053">x</span>&nbsp;<span class="ident" id="4502055">ast</span><span class="op" id="4502058">.</span><span class="ident" id="4502059">Expr</span><span class="op" id="4502063">)</span>&nbsp;<span class="ident" id="4502065">ast</span><span class="op" id="4502068">.</span><span class="ident" id="4502069">Expr</span>&nbsp;<span class="op" id="4502074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502077">if</span>&nbsp;<span class="ident" id="4502080">p</span><span class="op" id="4502081">,</span>&nbsp;<span class="ident" id="4502083">isPtr</span>&nbsp;<span class="op" id="4502089">:=</span>&nbsp;<span class="ident" id="4502092">x</span><span class="op" id="4502093">.</span><span class="op" id="4502094">(</span><span class="op" id="4502095">*</span><span class="ident" id="4502096">ast</span><span class="op" id="4502099">.</span><span class="ident" id="4502100">StarExpr</span><span class="op" id="4502108">)</span><span class="op" id="4502109">;</span>&nbsp;<span class="ident" id="4502111">isPtr</span>&nbsp;<span class="op" id="4502117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502121">x</span>&nbsp;<span class="op" id="4502123">=</span>&nbsp;<span class="ident" id="4502125">p</span><span class="op" id="4502126">.</span><span class="ident" id="4502127">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502133">return</span>&nbsp;<span class="ident" id="4502140">x</span><br>
<span class="lineno">1405</span><span class="op" id="4502142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502145">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4502225">func</span>&nbsp;<span class="ident" id="4502230">unparen</span><span class="op" id="4502237">(</span><span class="ident" id="4502238">x</span>&nbsp;<span class="ident" id="4502240">ast</span><span class="op" id="4502243">.</span><span class="ident" id="4502244">Expr</span><span class="op" id="4502248">)</span>&nbsp;<span class="ident" id="4502250">ast</span><span class="op" id="4502253">.</span><span class="ident" id="4502254">Expr</span>&nbsp;<span class="op" id="4502259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502262">if</span>&nbsp;<span class="ident" id="4502265">p</span><span class="op" id="4502266">,</span>&nbsp;<span class="ident" id="4502268">isParen</span>&nbsp;<span class="op" id="4502276">:=</span>&nbsp;<span class="ident" id="4502279">x</span><span class="op" id="4502280">.</span><span class="op" id="4502281">(</span><span class="op" id="4502282">*</span><span class="ident" id="4502283">ast</span><span class="op" id="4502286">.</span><span class="ident" id="4502287">ParenExpr</span><span class="op" id="4502296">)</span><span class="op" id="4502297">;</span>&nbsp;<span class="ident" id="4502299">isParen</span>&nbsp;<span class="op" id="4502307">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502311">x</span>&nbsp;<span class="op" id="4502313">=</span>&nbsp;<span class="ident" id="4502315">unparen</span><span class="op" id="4502322">(</span><span class="ident" id="4502323">p</span><span class="op" id="4502324">.</span><span class="ident" id="4502325">X</span><span class="op" id="4502326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502332">return</span>&nbsp;<span class="ident" id="4502339">x</span><br>
<span class="lineno"></span><span class="op" id="4502341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="4502344">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4502404">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="4502444">//</span><br>
<span class="lineno"></span><span class="keyword" id="4502447">func</span>&nbsp;<span class="op" id="4502452">(</span><span class="ident" id="4502453">p</span>&nbsp;<span class="op" id="4502455">*</span><span class="ident" id="4502456">parser</span><span class="op" id="4502462">)</span>&nbsp;<span class="ident" id="4502464">checkExprOrType</span><span class="op" id="4502479">(</span><span class="ident" id="4502480">x</span>&nbsp;<span class="ident" id="4502482">ast</span><span class="op" id="4502485">.</span><span class="ident" id="4502486">Expr</span><span class="op" id="4502490">)</span>&nbsp;<span class="ident" id="4502492">ast</span><span class="op" id="4502495">.</span><span class="ident" id="4502496">Expr</span>&nbsp;<span class="op" id="4502501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502504">switch</span>&nbsp;<span class="ident" id="4502511">t</span>&nbsp;<span class="op" id="4502513">:=</span>&nbsp;<span class="ident" id="4502516">unparen</span><span class="op" id="4502523">(</span><span class="ident" id="4502524">x</span><span class="op" id="4502525">)</span><span class="op" id="4502526">.</span><span class="op" id="4502527">(</span><span class="keyword" id="4502528">type</span><span class="op" id="4502532">)</span>&nbsp;<span class="op" id="4502534">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502537">case</span>&nbsp;<span class="op" id="4502542">*</span><span class="ident" id="4502543">ast</span><span class="op" id="4502546">.</span><span class="ident" id="4502547">ParenExpr</span><span class="op" id="4502556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4502560">panic</span><span class="op" id="4502565">(</span><span class="string" id="4502566">&#34;unreachable&#34;</span><span class="op" id="4502579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502582">case</span>&nbsp;<span class="op" id="4502587">*</span><span class="ident" id="4502588">ast</span><span class="op" id="4502591">.</span><span class="ident" id="4502592">UnaryExpr</span><span class="op" id="4502601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502604">case</span>&nbsp;<span class="op" id="4502609">*</span><span class="ident" id="4502610">ast</span><span class="op" id="4502613">.</span><span class="ident" id="4502614">ArrayType</span><span class="op" id="4502623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502627">if</span>&nbsp;<span class="builtinfunc" id="4502630">len</span><span class="op" id="4502633">,</span>&nbsp;<span class="ident" id="4502635">isEllipsis</span>&nbsp;<span class="op" id="4502646">:=</span>&nbsp;<span class="ident" id="4502649">t</span><span class="op" id="4502650">.</span><span class="ident" id="4502651">Len</span><span class="op" id="4502654">.</span><span class="op" id="4502655">(</span><span class="op" id="4502656">*</span><span class="ident" id="4502657">ast</span><span class="op" id="4502660">.</span><span class="ident" id="4502661">Ellipsis</span><span class="op" id="4502669">)</span><span class="op" id="4502670">;</span>&nbsp;<span class="ident" id="4502672">isEllipsis</span>&nbsp;<span class="op" id="4502683">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502688">p</span><span class="op" id="4502689">.</span><span class="builtintype" id="4502690">error</span><span class="op" id="4502695">(</span><span class="builtinfunc" id="4502696">len</span><span class="op" id="4502699">.</span><span class="ident" id="4502700">Pos</span><span class="op" id="4502703">(</span><span class="op" id="4502704">)</span><span class="op" id="4502705">,</span>&nbsp;<span class="string" id="4502707">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="4502743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502748">x</span>&nbsp;<span class="op" id="4502750">=</span>&nbsp;<span class="op" id="4502752">&amp;</span><span class="ident" id="4502753">ast</span><span class="op" id="4502756">.</span><span class="ident" id="4502757">BadExpr</span><span class="op" id="4502764">{</span><span class="ident" id="4502765">From</span><span class="op" id="4502769">:</span>&nbsp;<span class="ident" id="4502771">x</span><span class="op" id="4502772">.</span><span class="ident" id="4502773">Pos</span><span class="op" id="4502776">(</span><span class="op" id="4502777">)</span><span class="op" id="4502778">,</span>&nbsp;<span class="ident" id="4502780">To</span><span class="op" id="4502782">:</span>&nbsp;<span class="ident" id="4502784">p</span><span class="op" id="4502785">.</span><span class="ident" id="4502786">safePos</span><span class="op" id="4502793">(</span><span class="ident" id="4502794">x</span><span class="op" id="4502795">.</span><span class="ident" id="4502796">End</span><span class="op" id="4502799">(</span><span class="op" id="4502800">)</span><span class="op" id="4502801">)</span><span class="op" id="4502802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4502813">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502858">return</span>&nbsp;<span class="ident" id="4502865">x</span><br>
<span class="lineno"></span><span class="op" id="4502867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502870">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="4502940">func</span>&nbsp;<span class="op" id="4502945">(</span><span class="ident" id="4502946">p</span>&nbsp;<span class="op" id="4502948">*</span><span class="ident" id="4502949">parser</span><span class="op" id="4502955">)</span>&nbsp;<span class="ident" id="4502957">parsePrimaryExpr</span><span class="op" id="4502973">(</span><span class="ident" id="4502974">lhs</span>&nbsp;<span class="builtintype" id="4502978">bool</span><span class="op" id="4502982">)</span>&nbsp;<span class="ident" id="4502984">ast</span><span class="op" id="4502987">.</span><span class="ident" id="4502988">Expr</span>&nbsp;<span class="op" id="4502993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502996">if</span>&nbsp;<span class="ident" id="4502999">p</span><span class="op" id="4503000">.</span><span class="ident" id="4503001">trace</span>&nbsp;<span class="op" id="4503007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503011">defer</span>&nbsp;<span class="ident" id="4503017">un</span><span class="op" id="4503019">(</span><span class="ident" id="4503020">trace</span><span class="op" id="4503025">(</span><span class="ident" id="4503026">p</span><span class="op" id="4503027">,</span>&nbsp;<span class="string" id="4503029">&#34;PrimaryExpr&#34;</span><span class="op" id="4503042">)</span><span class="op" id="4503043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503050">x</span>&nbsp;<span class="op" id="4503052">:=</span>&nbsp;<span class="ident" id="4503055">p</span><span class="op" id="4503056">.</span><span class="ident" id="4503057">parseOperand</span><span class="op" id="4503069">(</span><span class="ident" id="4503070">lhs</span><span class="op" id="4503073">)</span><br>
<span class="lineno"></span><span class="ident" id="4503075">L</span><span class="op" id="4503076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503079">for</span>&nbsp;<span class="op" id="4503083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503087">switch</span>&nbsp;<span class="ident" id="4503094">p</span><span class="op" id="4503095">.</span><span class="ident" id="4503096">tok</span>&nbsp;<span class="op" id="4503100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503104">case</span>&nbsp;<span class="ident" id="4503109">token</span><span class="op" id="4503114">.</span><span class="ident" id="4503115">PERIOD</span><span class="op" id="4503121">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503126">p</span><span class="op" id="4503127">.</span><span class="ident" id="4503128">next</span><span class="op" id="4503132">(</span><span class="op" id="4503133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503138">if</span>&nbsp;<span class="ident" id="4503141">lhs</span>&nbsp;<span class="op" id="4503145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503151">p</span><span class="op" id="4503152">.</span><span class="ident" id="4503153">resolve</span><span class="op" id="4503160">(</span><span class="ident" id="4503161">x</span><span class="op" id="4503162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503172">switch</span>&nbsp;<span class="ident" id="4503179">p</span><span class="op" id="4503180">.</span><span class="ident" id="4503181">tok</span>&nbsp;<span class="op" id="4503185">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503190">case</span>&nbsp;<span class="ident" id="4503195">token</span><span class="op" id="4503200">.</span><span class="ident" id="4503201">IDENT</span><span class="op" id="4503206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503212">x</span>&nbsp;<span class="op" id="4503214">=</span>&nbsp;<span class="ident" id="4503216">p</span><span class="op" id="4503217">.</span><span class="ident" id="4503218">parseSelector</span><span class="op" id="4503231">(</span><span class="ident" id="4503232">p</span><span class="op" id="4503233">.</span><span class="ident" id="4503234">checkExprOrType</span><span class="op" id="4503249">(</span><span class="ident" id="4503250">x</span><span class="op" id="4503251">)</span><span class="op" id="4503252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503257">case</span>&nbsp;<span class="ident" id="4503262">token</span><span class="op" id="4503267">.</span><span class="ident" id="4503268">LPAREN</span><span class="op" id="4503274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503280">x</span>&nbsp;<span class="op" id="4503282">=</span>&nbsp;<span class="ident" id="4503284">p</span><span class="op" id="4503285">.</span><span class="ident" id="4503286">parseTypeAssertion</span><span class="op" id="4503304">(</span><span class="ident" id="4503305">p</span><span class="op" id="4503306">.</span><span class="ident" id="4503307">checkExpr</span><span class="op" id="4503316">(</span><span class="ident" id="4503317">x</span><span class="op" id="4503318">)</span><span class="op" id="4503319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503324">default</span><span class="op" id="4503331">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503337">pos</span>&nbsp;<span class="op" id="4503341">:=</span>&nbsp;<span class="ident" id="4503344">p</span><span class="op" id="4503345">.</span><span class="ident" id="4503346">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503354">p</span><span class="op" id="4503355">.</span><span class="ident" id="4503356">errorExpected</span><span class="op" id="4503369">(</span><span class="ident" id="4503370">pos</span><span class="op" id="4503373">,</span>&nbsp;<span class="string" id="4503375">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="4503403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503409">p</span><span class="op" id="4503410">.</span><span class="ident" id="4503411">next</span><span class="op" id="4503415">(</span><span class="op" id="4503416">)</span>&nbsp;<span class="comment" id="4503418">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503439">x</span>&nbsp;<span class="op" id="4503441">=</span>&nbsp;<span class="op" id="4503443">&amp;</span><span class="ident" id="4503444">ast</span><span class="op" id="4503447">.</span><span class="ident" id="4503448">BadExpr</span><span class="op" id="4503455">{</span><span class="ident" id="4503456">From</span><span class="op" id="4503460">:</span>&nbsp;<span class="ident" id="4503462">pos</span><span class="op" id="4503465">,</span>&nbsp;<span class="ident" id="4503467">To</span><span class="op" id="4503469">:</span>&nbsp;<span class="ident" id="4503471">p</span><span class="op" id="4503472">.</span><span class="ident" id="4503473">pos</span><span class="op" id="4503476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503481">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503485">case</span>&nbsp;<span class="ident" id="4503490">token</span><span class="op" id="4503495">.</span><span class="ident" id="4503496">LBRACK</span><span class="op" id="4503502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503507">if</span>&nbsp;<span class="ident" id="4503510">lhs</span>&nbsp;<span class="op" id="4503514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503520">p</span><span class="op" id="4503521">.</span><span class="ident" id="4503522">resolve</span><span class="op" id="4503529">(</span><span class="ident" id="4503530">x</span><span class="op" id="4503531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503541">x</span>&nbsp;<span class="op" id="4503543">=</span>&nbsp;<span class="ident" id="4503545">p</span><span class="op" id="4503546">.</span><span class="ident" id="4503547">parseIndexOrSlice</span><span class="op" id="4503564">(</span><span class="ident" id="4503565">p</span><span class="op" id="4503566">.</span><span class="ident" id="4503567">checkExpr</span><span class="op" id="4503576">(</span><span class="ident" id="4503577">x</span><span class="op" id="4503578">)</span><span class="op" id="4503579">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503583">case</span>&nbsp;<span class="ident" id="4503588">token</span><span class="op" id="4503593">.</span><span class="ident" id="4503594">LPAREN</span><span class="op" id="4503600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503605">if</span>&nbsp;<span class="ident" id="4503608">lhs</span>&nbsp;<span class="op" id="4503612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503618">p</span><span class="op" id="4503619">.</span><span class="ident" id="4503620">resolve</span><span class="op" id="4503627">(</span><span class="ident" id="4503628">x</span><span class="op" id="4503629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503639">x</span>&nbsp;<span class="op" id="4503641">=</span>&nbsp;<span class="ident" id="4503643">p</span><span class="op" id="4503644">.</span><span class="ident" id="4503645">parseCallOrConversion</span><span class="op" id="4503666">(</span><span class="ident" id="4503667">p</span><span class="op" id="4503668">.</span><span class="ident" id="4503669">checkExprOrType</span><span class="op" id="4503684">(</span><span class="ident" id="4503685">x</span><span class="op" id="4503686">)</span><span class="op" id="4503687">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503691">case</span>&nbsp;<span class="ident" id="4503696">token</span><span class="op" id="4503701">.</span><span class="ident" id="4503702">LBRACE</span><span class="op" id="4503708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503713">if</span>&nbsp;<span class="ident" id="4503716">isLiteralType</span><span class="op" id="4503729">(</span><span class="ident" id="4503730">x</span><span class="op" id="4503731">)</span>&nbsp;<span class="op" id="4503733">&amp;&amp;</span>&nbsp;<span class="op" id="4503736">(</span><span class="ident" id="4503737">p</span><span class="op" id="4503738">.</span><span class="ident" id="4503739">exprLev</span>&nbsp;<span class="op" id="4503747">&gt;=</span>&nbsp;<span class="num" id="4503750">0</span>&nbsp;<span class="op" id="4503752">||</span>&nbsp;<span class="op" id="4503755">!</span><span class="ident" id="4503756">isTypeName</span><span class="op" id="4503766">(</span><span class="ident" id="4503767">x</span><span class="op" id="4503768">)</span><span class="op" id="4503769">)</span>&nbsp;<span class="op" id="4503771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503777">if</span>&nbsp;<span class="ident" id="4503780">lhs</span>&nbsp;<span class="op" id="4503784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503791">p</span><span class="op" id="4503792">.</span><span class="ident" id="4503793">resolve</span><span class="op" id="4503800">(</span><span class="ident" id="4503801">x</span><span class="op" id="4503802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503808">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503814">x</span>&nbsp;<span class="op" id="4503816">=</span>&nbsp;<span class="ident" id="4503818">p</span><span class="op" id="4503819">.</span><span class="ident" id="4503820">parseLiteralValue</span><span class="op" id="4503837">(</span><span class="ident" id="4503838">x</span><span class="op" id="4503839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503844">}</span>&nbsp;<span class="keyword" id="4503846">else</span>&nbsp;<span class="op" id="4503851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503857">break</span>&nbsp;<span class="ident" id="4503863">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503872">default</span><span class="op" id="4503879">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503884">break</span>&nbsp;<span class="ident" id="4503890">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503898">lhs</span>&nbsp;<span class="op" id="4503902">=</span>&nbsp;<span class="builtintype" id="4503904">false</span>&nbsp;<span class="comment" id="4503910">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503950">return</span>&nbsp;<span class="ident" id="4503957">x</span><br>
<span class="lineno"></span><span class="op" id="4503959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503962">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4504032">func</span>&nbsp;<span class="op" id="4504037">(</span><span class="ident" id="4504038">p</span>&nbsp;<span class="op" id="4504040">*</span><span class="ident" id="4504041">parser</span><span class="op" id="4504047">)</span>&nbsp;<span class="ident" id="4504049">parseUnaryExpr</span><span class="op" id="4504063">(</span><span class="ident" id="4504064">lhs</span>&nbsp;<span class="builtintype" id="4504068">bool</span><span class="op" id="4504072">)</span>&nbsp;<span class="ident" id="4504074">ast</span><span class="op" id="4504077">.</span><span class="ident" id="4504078">Expr</span>&nbsp;<span class="op" id="4504083">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504086">if</span>&nbsp;<span class="ident" id="4504089">p</span><span class="op" id="4504090">.</span><span class="ident" id="4504091">trace</span>&nbsp;<span class="op" id="4504097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504101">defer</span>&nbsp;<span class="ident" id="4504107">un</span><span class="op" id="4504109">(</span><span class="ident" id="4504110">trace</span><span class="op" id="4504115">(</span><span class="ident" id="4504116">p</span><span class="op" id="4504117">,</span>&nbsp;<span class="string" id="4504119">&#34;UnaryExpr&#34;</span><span class="op" id="4504130">)</span><span class="op" id="4504131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504138">switch</span>&nbsp;<span class="ident" id="4504145">p</span><span class="op" id="4504146">.</span><span class="ident" id="4504147">tok</span>&nbsp;<span class="op" id="4504151">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504154">case</span>&nbsp;<span class="ident" id="4504159">token</span><span class="op" id="4504164">.</span><span class="ident" id="4504165">ADD</span><span class="op" id="4504168">,</span>&nbsp;<span class="ident" id="4504170">token</span><span class="op" id="4504175">.</span><span class="ident" id="4504176">SUB</span><span class="op" id="4504179">,</span>&nbsp;<span class="ident" id="4504181">token</span><span class="op" id="4504186">.</span><span class="ident" id="4504187">NOT</span><span class="op" id="4504190">,</span>&nbsp;<span class="ident" id="4504192">token</span><span class="op" id="4504197">.</span><span class="ident" id="4504198">XOR</span><span class="op" id="4504201">,</span>&nbsp;<span class="ident" id="4504203">token</span><span class="op" id="4504208">.</span><span class="ident" id="4504209">AND</span><span class="op" id="4504212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504216">pos</span><span class="op" id="4504219">,</span>&nbsp;<span class="ident" id="4504221">op</span>&nbsp;<span class="op" id="4504224">:=</span>&nbsp;<span class="ident" id="4504227">p</span><span class="op" id="4504228">.</span><span class="ident" id="4504229">pos</span><span class="op" id="4504232">,</span>&nbsp;<span class="ident" id="4504234">p</span><span class="op" id="4504235">.</span><span class="ident" id="4504236">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504242">p</span><span class="op" id="4504243">.</span><span class="ident" id="4504244">next</span><span class="op" id="4504248">(</span><span class="op" id="4504249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504253">x</span>&nbsp;<span class="op" id="4504255">:=</span>&nbsp;<span class="ident" id="4504258">p</span><span class="op" id="4504259">.</span><span class="ident" id="4504260">parseUnaryExpr</span><span class="op" id="4504274">(</span><span class="builtintype" id="4504275">false</span><span class="op" id="4504280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504284">return</span>&nbsp;<span class="op" id="4504291">&amp;</span><span class="ident" id="4504292">ast</span><span class="op" id="4504295">.</span><span class="ident" id="4504296">UnaryExpr</span><span class="op" id="4504305">{</span><span class="ident" id="4504306">OpPos</span><span class="op" id="4504311">:</span>&nbsp;<span class="ident" id="4504313">pos</span><span class="op" id="4504316">,</span>&nbsp;<span class="ident" id="4504318">Op</span><span class="op" id="4504320">:</span>&nbsp;<span class="ident" id="4504322">op</span><span class="op" id="4504324">,</span>&nbsp;<span class="ident" id="4504326">X</span><span class="op" id="4504327">:</span>&nbsp;<span class="ident" id="4504329">p</span><span class="op" id="4504330">.</span><span class="ident" id="4504331">checkExpr</span><span class="op" id="4504340">(</span><span class="ident" id="4504341">x</span><span class="op" id="4504342">)</span><span class="op" id="4504343">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504347">case</span>&nbsp;<span class="ident" id="4504352">token</span><span class="op" id="4504357">.</span><span class="ident" id="4504358">ARROW</span><span class="op" id="4504363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504367">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504407">arrow</span>&nbsp;<span class="op" id="4504413">:=</span>&nbsp;<span class="ident" id="4504416">p</span><span class="op" id="4504417">.</span><span class="ident" id="4504418">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504424">p</span><span class="op" id="4504425">.</span><span class="ident" id="4504426">next</span><span class="op" id="4504430">(</span><span class="op" id="4504431">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504436">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504499">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504560">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504623">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504643">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504648">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504697">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504757">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504762">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504823">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504861">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504866">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504909">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504957">x</span>&nbsp;<span class="op" id="4504959">:=</span>&nbsp;<span class="ident" id="4504962">p</span><span class="op" id="4504963">.</span><span class="ident" id="4504964">parseUnaryExpr</span><span class="op" id="4504978">(</span><span class="builtintype" id="4504979">false</span><span class="op" id="4504984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504989">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505023">if</span>&nbsp;<span class="ident" id="4505026">typ</span><span class="op" id="4505029">,</span>&nbsp;<span class="ident" id="4505031">ok</span>&nbsp;<span class="op" id="4505034">:=</span>&nbsp;<span class="ident" id="4505037">x</span><span class="op" id="4505038">.</span><span class="op" id="4505039">(</span><span class="op" id="4505040">*</span><span class="ident" id="4505041">ast</span><span class="op" id="4505044">.</span><span class="ident" id="4505045">ChanType</span><span class="op" id="4505053">)</span><span class="op" id="4505054">;</span>&nbsp;<span class="ident" id="4505056">ok</span>&nbsp;<span class="op" id="4505059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4505064">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4505080">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505120">dir</span>&nbsp;<span class="op" id="4505124">:=</span>&nbsp;<span class="ident" id="4505127">ast</span><span class="op" id="4505130">.</span><span class="ident" id="4505131">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505139">for</span>&nbsp;<span class="ident" id="4505143">ok</span>&nbsp;<span class="op" id="4505146">&amp;&amp;</span>&nbsp;<span class="ident" id="4505149">dir</span>&nbsp;<span class="op" id="4505153">==</span>&nbsp;<span class="ident" id="4505156">ast</span><span class="op" id="4505159">.</span><span class="ident" id="4505160">SEND</span>&nbsp;<span class="op" id="4505165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505171">if</span>&nbsp;<span class="ident" id="4505174">typ</span><span class="op" id="4505177">.</span><span class="ident" id="4505178">Dir</span>&nbsp;<span class="op" id="4505182">==</span>&nbsp;<span class="ident" id="4505185">ast</span><span class="op" id="4505188">.</span><span class="ident" id="4505189">RECV</span>&nbsp;<span class="op" id="4505194">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4505201">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505243">p</span><span class="op" id="4505244">.</span><span class="ident" id="4505245">errorExpected</span><span class="op" id="4505258">(</span><span class="ident" id="4505259">typ</span><span class="op" id="4505262">.</span><span class="ident" id="4505263">Arrow</span><span class="op" id="4505268">,</span>&nbsp;<span class="string" id="4505270">&#34;&#39;chan&#39;&#34;</span><span class="op" id="4505278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505290">arrow</span><span class="op" id="4505295">,</span>&nbsp;<span class="ident" id="4505297">typ</span><span class="op" id="4505300">.</span><span class="ident" id="4505301">Begin</span><span class="op" id="4505306">,</span>&nbsp;<span class="ident" id="4505308">typ</span><span class="op" id="4505311">.</span><span class="ident" id="4505312">Arrow</span>&nbsp;<span class="op" id="4505318">=</span>&nbsp;<span class="ident" id="4505320">typ</span><span class="op" id="4505323">.</span><span class="ident" id="4505324">Arrow</span><span class="op" id="4505329">,</span>&nbsp;<span class="ident" id="4505331">arrow</span><span class="op" id="4505336">,</span>&nbsp;<span class="ident" id="4505338">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505348">dir</span><span class="op" id="4505351">,</span>&nbsp;<span class="ident" id="4505353">typ</span><span class="op" id="4505356">.</span><span class="ident" id="4505357">Dir</span>&nbsp;<span class="op" id="4505361">=</span>&nbsp;<span class="ident" id="4505363">typ</span><span class="op" id="4505366">.</span><span class="ident" id="4505367">Dir</span><span class="op" id="4505370">,</span>&nbsp;<span class="ident" id="4505372">ast</span><span class="op" id="4505375">.</span><span class="ident" id="4505376">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505385">typ</span><span class="op" id="4505388">,</span>&nbsp;<span class="ident" id="4505390">ok</span>&nbsp;<span class="op" id="4505393">=</span>&nbsp;<span class="ident" id="4505395">typ</span><span class="op" id="4505398">.</span><span class="ident" id="4505399">Value</span><span class="op" id="4505404">.</span><span class="op" id="4505405">(</span><span class="op" id="4505406">*</span><span class="ident" id="4505407">ast</span><span class="op" id="4505410">.</span><span class="ident" id="4505411">ChanType</span><span class="op" id="4505419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505429">if</span>&nbsp;<span class="ident" id="4505432">dir</span>&nbsp;<span class="op" id="4505436">==</span>&nbsp;<span class="ident" id="4505439">ast</span><span class="op" id="4505442">.</span><span class="ident" id="4505443">SEND</span>&nbsp;<span class="op" id="4505448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505454">p</span><span class="op" id="4505455">.</span><span class="ident" id="4505456">errorExpected</span><span class="op" id="4505469">(</span><span class="ident" id="4505470">arrow</span><span class="op" id="4505475">,</span>&nbsp;<span class="string" id="4505477">&#34;channel&nbsp;type&#34;</span><span class="op" id="4505491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505496">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505502">return</span>&nbsp;<span class="ident" id="4505509">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4505518">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505532">return</span>&nbsp;<span class="op" id="4505539">&amp;</span><span class="ident" id="4505540">ast</span><span class="op" id="4505543">.</span><span class="ident" id="4505544">UnaryExpr</span><span class="op" id="4505553">{</span><span class="ident" id="4505554">OpPos</span><span class="op" id="4505559">:</span>&nbsp;<span class="ident" id="4505561">arrow</span><span class="op" id="4505566">,</span>&nbsp;<span class="ident" id="4505568">Op</span><span class="op" id="4505570">:</span>&nbsp;<span class="ident" id="4505572">token</span><span class="op" id="4505577">.</span><span class="ident" id="4505578">ARROW</span><span class="op" id="4505583">,</span>&nbsp;<span class="ident" id="4505585">X</span><span class="op" id="4505586">:</span>&nbsp;<span class="ident" id="4505588">p</span><span class="op" id="4505589">.</span><span class="ident" id="4505590">checkExpr</span><span class="op" id="4505599">(</span><span class="ident" id="4505600">x</span><span class="op" id="4505601">)</span><span class="op" id="4505602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505606">case</span>&nbsp;<span class="ident" id="4505611">token</span><span class="op" id="4505616">.</span><span class="ident" id="4505617">MUL</span><span class="op" id="4505620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4505624">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505666">pos</span>&nbsp;<span class="op" id="4505670">:=</span>&nbsp;<span class="ident" id="4505673">p</span><span class="op" id="4505674">.</span><span class="ident" id="4505675">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505681">p</span><span class="op" id="4505682">.</span><span class="ident" id="4505683">next</span><span class="op" id="4505687">(</span><span class="op" id="4505688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505692">x</span>&nbsp;<span class="op" id="4505694">:=</span>&nbsp;<span class="ident" id="4505697">p</span><span class="op" id="4505698">.</span><span class="ident" id="4505699">parseUnaryExpr</span><span class="op" id="4505713">(</span><span class="builtintype" id="4505714">false</span><span class="op" id="4505719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505723">return</span>&nbsp;<span class="op" id="4505730">&amp;</span><span class="ident" id="4505731">ast</span><span class="op" id="4505734">.</span><span class="ident" id="4505735">StarExpr</span><span class="op" id="4505743">{</span><span class="ident" id="4505744">Star</span><span class="op" id="4505748">:</span>&nbsp;<span class="ident" id="4505750">pos</span><span class="op" id="4505753">,</span>&nbsp;<span class="ident" id="4505755">X</span><span class="op" id="4505756">:</span>&nbsp;<span class="ident" id="4505758">p</span><span class="op" id="4505759">.</span><span class="ident" id="4505760">checkExprOrType</span><span class="op" id="4505775">(</span><span class="ident" id="4505776">x</span><span class="op" id="4505777">)</span><span class="op" id="4505778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505785">return</span>&nbsp;<span class="ident" id="4505792">p</span><span class="op" id="4505793">.</span><span class="ident" id="4505794">parsePrimaryExpr</span><span class="op" id="4505810">(</span><span class="ident" id="4505811">lhs</span><span class="op" id="4505814">)</span><br>
<span class="lineno"></span><span class="op" id="4505816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4505819">func</span>&nbsp;<span class="op" id="4505824">(</span><span class="ident" id="4505825">p</span>&nbsp;<span class="op" id="4505827">*</span><span class="ident" id="4505828">parser</span><span class="op" id="4505834">)</span>&nbsp;<span class="ident" id="4505836">tokPrec</span><span class="op" id="4505843">(</span><span class="op" id="4505844">)</span>&nbsp;<span class="op" id="4505846">(</span><span class="ident" id="4505847">token</span><span class="op" id="4505852">.</span><span class="ident" id="4505853">Token</span><span class="op" id="4505858">,</span>&nbsp;<span class="builtintype" id="4505860">int</span><span class="op" id="4505863">)</span>&nbsp;<span class="op" id="4505865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505868">tok</span>&nbsp;<span class="op" id="4505872">:=</span>&nbsp;<span class="ident" id="4505875">p</span><span class="op" id="4505876">.</span><span class="ident" id="4505877">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505882">if</span>&nbsp;<span class="ident" id="4505885">p</span><span class="op" id="4505886">.</span><span class="ident" id="4505887">inRhs</span>&nbsp;<span class="op" id="4505893">&amp;&amp;</span>&nbsp;<span class="ident" id="4505896">tok</span>&nbsp;<span class="op" id="4505900">==</span>&nbsp;<span class="ident" id="4505903">token</span><span class="op" id="4505908">.</span><span class="ident" id="4505909">ASSIGN</span>&nbsp;<span class="op" id="4505916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505920">tok</span>&nbsp;<span class="op" id="4505924">=</span>&nbsp;<span class="ident" id="4505926">token</span><span class="op" id="4505931">.</span><span class="ident" id="4505932">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505940">return</span>&nbsp;<span class="ident" id="4505947">tok</span><span class="op" id="4505950">,</span>&nbsp;<span class="ident" id="4505952">tok</span><span class="op" id="4505955">.</span><span class="ident" id="4505956">Precedence</span><span class="op" id="4505966">(</span><span class="op" id="4505967">)</span><br>
<span class="lineno"></span><span class="op" id="4505969">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="4505972">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4506042">func</span>&nbsp;<span class="op" id="4506047">(</span><span class="ident" id="4506048">p</span>&nbsp;<span class="op" id="4506050">*</span><span class="ident" id="4506051">parser</span><span class="op" id="4506057">)</span>&nbsp;<span class="ident" id="4506059">parseBinaryExpr</span><span class="op" id="4506074">(</span><span class="ident" id="4506075">lhs</span>&nbsp;<span class="builtintype" id="4506079">bool</span><span class="op" id="4506083">,</span>&nbsp;<span class="ident" id="4506085">prec1</span>&nbsp;<span class="builtintype" id="4506091">int</span><span class="op" id="4506094">)</span>&nbsp;<span class="ident" id="4506096">ast</span><span class="op" id="4506099">.</span><span class="ident" id="4506100">Expr</span>&nbsp;<span class="op" id="4506105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506108">if</span>&nbsp;<span class="ident" id="4506111">p</span><span class="op" id="4506112">.</span><span class="ident" id="4506113">trace</span>&nbsp;<span class="op" id="4506119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506123">defer</span>&nbsp;<span class="ident" id="4506129">un</span><span class="op" id="4506131">(</span><span class="ident" id="4506132">trace</span><span class="op" id="4506137">(</span><span class="ident" id="4506138">p</span><span class="op" id="4506139">,</span>&nbsp;<span class="string" id="4506141">&#34;BinaryExpr&#34;</span><span class="op" id="4506153">)</span><span class="op" id="4506154">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506161">x</span>&nbsp;<span class="op" id="4506163">:=</span>&nbsp;<span class="ident" id="4506166">p</span><span class="op" id="4506167">.</span><span class="ident" id="4506168">parseUnaryExpr</span><span class="op" id="4506182">(</span><span class="ident" id="4506183">lhs</span><span class="op" id="4506186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506189">for</span>&nbsp;<span class="ident" id="4506193">_</span><span class="op" id="4506194">,</span>&nbsp;<span class="ident" id="4506196">prec</span>&nbsp;<span class="op" id="4506201">:=</span>&nbsp;<span class="ident" id="4506204">p</span><span class="op" id="4506205">.</span><span class="ident" id="4506206">tokPrec</span><span class="op" id="4506213">(</span><span class="op" id="4506214">)</span><span class="op" id="4506215">;</span>&nbsp;<span class="ident" id="4506217">prec</span>&nbsp;<span class="op" id="4506222">&gt;=</span>&nbsp;<span class="ident" id="4506225">prec1</span><span class="op" id="4506230">;</span>&nbsp;<span class="ident" id="4506232">prec</span><span class="op" id="4506236">--</span>&nbsp;<span class="op" id="4506239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506243">for</span>&nbsp;<span class="op" id="4506247">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506252">op</span><span class="op" id="4506254">,</span>&nbsp;<span class="ident" id="4506256">oprec</span>&nbsp;<span class="op" id="4506262">:=</span>&nbsp;<span class="ident" id="4506265">p</span><span class="op" id="4506266">.</span><span class="ident" id="4506267">tokPrec</span><span class="op" id="4506274">(</span><span class="op" id="4506275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506280">if</span>&nbsp;<span class="ident" id="4506283">oprec</span>&nbsp;<span class="op" id="4506289">!=</span>&nbsp;<span class="ident" id="4506292">prec</span>&nbsp;<span class="op" id="4506297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506303">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506317">pos</span>&nbsp;<span class="op" id="4506321">:=</span>&nbsp;<span class="ident" id="4506324">p</span><span class="op" id="4506325">.</span><span class="ident" id="4506326">expect</span><span class="op" id="4506332">(</span><span class="ident" id="4506333">op</span><span class="op" id="4506335">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506340">if</span>&nbsp;<span class="ident" id="4506343">lhs</span>&nbsp;<span class="op" id="4506347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506353">p</span><span class="op" id="4506354">.</span><span class="ident" id="4506355">resolve</span><span class="op" id="4506362">(</span><span class="ident" id="4506363">x</span><span class="op" id="4506364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506370">lhs</span>&nbsp;<span class="op" id="4506374">=</span>&nbsp;<span class="builtintype" id="4506376">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506390">y</span>&nbsp;<span class="op" id="4506392">:=</span>&nbsp;<span class="ident" id="4506395">p</span><span class="op" id="4506396">.</span><span class="ident" id="4506397">parseBinaryExpr</span><span class="op" id="4506412">(</span><span class="builtintype" id="4506413">false</span><span class="op" id="4506418">,</span>&nbsp;<span class="ident" id="4506420">prec</span><span class="op" id="4506424">+</span><span class="num" id="4506425">1</span><span class="op" id="4506426">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506431">x</span>&nbsp;<span class="op" id="4506433">=</span>&nbsp;<span class="op" id="4506435">&amp;</span><span class="ident" id="4506436">ast</span><span class="op" id="4506439">.</span><span class="ident" id="4506440">BinaryExpr</span><span class="op" id="4506450">{</span><span class="ident" id="4506451">X</span><span class="op" id="4506452">:</span>&nbsp;<span class="ident" id="4506454">p</span><span class="op" id="4506455">.</span><span class="ident" id="4506456">checkExpr</span><span class="op" id="4506465">(</span><span class="ident" id="4506466">x</span><span class="op" id="4506467">)</span><span class="op" id="4506468">,</span>&nbsp;<span class="ident" id="4506470">OpPos</span><span class="op" id="4506475">:</span>&nbsp;<span class="ident" id="4506477">pos</span><span class="op" id="4506480">,</span>&nbsp;<span class="ident" id="4506482">Op</span><span class="op" id="4506484">:</span>&nbsp;<span class="ident" id="4506486">op</span><span class="op" id="4506488">,</span>&nbsp;<span class="ident" id="4506490">Y</span><span class="op" id="4506491">:</span>&nbsp;<span class="ident" id="4506493">p</span><span class="op" id="4506494">.</span><span class="ident" id="4506495">checkExpr</span><span class="op" id="4506504">(</span><span class="ident" id="4506505">y</span><span class="op" id="4506506">)</span><span class="op" id="4506507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506518">return</span>&nbsp;<span class="ident" id="4506525">x</span><br>
<span class="lineno">1590</span><span class="op" id="4506527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4506530">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="4506600">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4506672">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="4506743">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4506755">func</span>&nbsp;<span class="op" id="4506760">(</span><span class="ident" id="4506761">p</span>&nbsp;<span class="op" id="4506763">*</span><span class="ident" id="4506764">parser</span><span class="op" id="4506770">)</span>&nbsp;<span class="ident" id="4506772">parseExpr</span><span class="op" id="4506781">(</span><span class="ident" id="4506782">lhs</span>&nbsp;<span class="builtintype" id="4506786">bool</span><span class="op" id="4506790">)</span>&nbsp;<span class="ident" id="4506792">ast</span><span class="op" id="4506795">.</span><span class="ident" id="4506796">Expr</span>&nbsp;<span class="op" id="4506801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506804">if</span>&nbsp;<span class="ident" id="4506807">p</span><span class="op" id="4506808">.</span><span class="ident" id="4506809">trace</span>&nbsp;<span class="op" id="4506815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506819">defer</span>&nbsp;<span class="ident" id="4506825">un</span><span class="op" id="4506827">(</span><span class="ident" id="4506828">trace</span><span class="op" id="4506833">(</span><span class="ident" id="4506834">p</span><span class="op" id="4506835">,</span>&nbsp;<span class="string" id="4506837">&#34;Expression&#34;</span><span class="op" id="4506849">)</span><span class="op" id="4506850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506853">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506857">return</span>&nbsp;<span class="ident" id="4506864">p</span><span class="op" id="4506865">.</span><span class="ident" id="4506866">parseBinaryExpr</span><span class="op" id="4506881">(</span><span class="ident" id="4506882">lhs</span><span class="op" id="4506885">,</span>&nbsp;<span class="ident" id="4506887">token</span><span class="op" id="4506892">.</span><span class="ident" id="4506893">LowestPrec</span><span class="op" id="4506903">+</span><span class="num" id="4506904">1</span><span class="op" id="4506905">)</span><br>
<span class="lineno"></span><span class="op" id="4506907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4506910">func</span>&nbsp;<span class="op" id="4506915">(</span><span class="ident" id="4506916">p</span>&nbsp;<span class="op" id="4506918">*</span><span class="ident" id="4506919">parser</span><span class="op" id="4506925">)</span>&nbsp;<span class="ident" id="4506927">parseRhs</span><span class="op" id="4506935">(</span><span class="op" id="4506936">)</span>&nbsp;<span class="ident" id="4506938">ast</span><span class="op" id="4506941">.</span><span class="ident" id="4506942">Expr</span>&nbsp;<span class="op" id="4506947">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506950">old</span>&nbsp;<span class="op" id="4506954">:=</span>&nbsp;<span class="ident" id="4506957">p</span><span class="op" id="4506958">.</span><span class="ident" id="4506959">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506966">p</span><span class="op" id="4506967">.</span><span class="ident" id="4506968">inRhs</span>&nbsp;<span class="op" id="4506974">=</span>&nbsp;<span class="builtintype" id="4506976">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506982">x</span>&nbsp;<span class="op" id="4506984">:=</span>&nbsp;<span class="ident" id="4506987">p</span><span class="op" id="4506988">.</span><span class="ident" id="4506989">checkExpr</span><span class="op" id="4506998">(</span><span class="ident" id="4506999">p</span><span class="op" id="4507000">.</span><span class="ident" id="4507001">parseExpr</span><span class="op" id="4507010">(</span><span class="builtintype" id="4507011">false</span><span class="op" id="4507016">)</span><span class="op" id="4507017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507020">p</span><span class="op" id="4507021">.</span><span class="ident" id="4507022">inRhs</span>&nbsp;<span class="op" id="4507028">=</span>&nbsp;<span class="ident" id="4507030">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507035">return</span>&nbsp;<span class="ident" id="4507042">x</span><br>
<span class="lineno">1610</span><span class="op" id="4507044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4507047">func</span>&nbsp;<span class="op" id="4507052">(</span><span class="ident" id="4507053">p</span>&nbsp;<span class="op" id="4507055">*</span><span class="ident" id="4507056">parser</span><span class="op" id="4507062">)</span>&nbsp;<span class="ident" id="4507064">parseRhsOrType</span><span class="op" id="4507078">(</span><span class="op" id="4507079">)</span>&nbsp;<span class="ident" id="4507081">ast</span><span class="op" id="4507084">.</span><span class="ident" id="4507085">Expr</span>&nbsp;<span class="op" id="4507090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507093">old</span>&nbsp;<span class="op" id="4507097">:=</span>&nbsp;<span class="ident" id="4507100">p</span><span class="op" id="4507101">.</span><span class="ident" id="4507102">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507109">p</span><span class="op" id="4507110">.</span><span class="ident" id="4507111">inRhs</span>&nbsp;<span class="op" id="4507117">=</span>&nbsp;<span class="builtintype" id="4507119">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507125">x</span>&nbsp;<span class="op" id="4507127">:=</span>&nbsp;<span class="ident" id="4507130">p</span><span class="op" id="4507131">.</span><span class="ident" id="4507132">checkExprOrType</span><span class="op" id="4507147">(</span><span class="ident" id="4507148">p</span><span class="op" id="4507149">.</span><span class="ident" id="4507150">parseExpr</span><span class="op" id="4507159">(</span><span class="builtintype" id="4507160">false</span><span class="op" id="4507165">)</span><span class="op" id="4507166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507169">p</span><span class="op" id="4507170">.</span><span class="ident" id="4507171">inRhs</span>&nbsp;<span class="op" id="4507177">=</span>&nbsp;<span class="ident" id="4507179">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507184">return</span>&nbsp;<span class="ident" id="4507191">x</span><br>
<span class="lineno"></span><span class="op" id="4507193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="4507196">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4507276">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507291">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4507329">const</span>&nbsp;<span class="op" id="4507335">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507338">basic</span>&nbsp;<span class="op" id="4507344">=</span>&nbsp;<span class="ident" id="4507346">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507352">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507361">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="4507369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="4507372">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="4507446">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4507520">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4507594">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="4507665">func</span>&nbsp;<span class="op" id="4507670">(</span><span class="ident" id="4507671">p</span>&nbsp;<span class="op" id="4507673">*</span><span class="ident" id="4507674">parser</span><span class="op" id="4507680">)</span>&nbsp;<span class="ident" id="4507682">parseSimpleStmt</span><span class="op" id="4507697">(</span><span class="ident" id="4507698">mode</span>&nbsp;<span class="builtintype" id="4507703">int</span><span class="op" id="4507706">)</span>&nbsp;<span class="op" id="4507708">(</span><span class="ident" id="4507709">ast</span><span class="op" id="4507712">.</span><span class="ident" id="4507713">Stmt</span><span class="op" id="4507717">,</span>&nbsp;<span class="builtintype" id="4507719">bool</span><span class="op" id="4507723">)</span>&nbsp;<span class="op" id="4507725">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507728">if</span>&nbsp;<span class="ident" id="4507731">p</span><span class="op" id="4507732">.</span><span class="ident" id="4507733">trace</span>&nbsp;<span class="op" id="4507739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507743">defer</span>&nbsp;<span class="ident" id="4507749">un</span><span class="op" id="4507751">(</span><span class="ident" id="4507752">trace</span><span class="op" id="4507757">(</span><span class="ident" id="4507758">p</span><span class="op" id="4507759">,</span>&nbsp;<span class="string" id="4507761">&#34;SimpleStmt&#34;</span><span class="op" id="4507773">)</span><span class="op" id="4507774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4507777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507781">x</span>&nbsp;<span class="op" id="4507783">:=</span>&nbsp;<span class="ident" id="4507786">p</span><span class="op" id="4507787">.</span><span class="ident" id="4507788">parseLhsList</span><span class="op" id="4507800">(</span><span class="op" id="4507801">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507805">switch</span>&nbsp;<span class="ident" id="4507812">p</span><span class="op" id="4507813">.</span><span class="ident" id="4507814">tok</span>&nbsp;<span class="op" id="4507818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507821">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507828">token</span><span class="op" id="4507833">.</span><span class="ident" id="4507834">DEFINE</span><span class="op" id="4507840">,</span>&nbsp;<span class="ident" id="4507842">token</span><span class="op" id="4507847">.</span><span class="ident" id="4507848">ASSIGN</span><span class="op" id="4507854">,</span>&nbsp;<span class="ident" id="4507856">token</span><span class="op" id="4507861">.</span><span class="ident" id="4507862">ADD_ASSIGN</span><span class="op" id="4507872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507876">token</span><span class="op" id="4507881">.</span><span class="ident" id="4507882">SUB_ASSIGN</span><span class="op" id="4507892">,</span>&nbsp;<span class="ident" id="4507894">token</span><span class="op" id="4507899">.</span><span class="ident" id="4507900">MUL_ASSIGN</span><span class="op" id="4507910">,</span>&nbsp;<span class="ident" id="4507912">token</span><span class="op" id="4507917">.</span><span class="ident" id="4507918">QUO_ASSIGN</span><span class="op" id="4507928">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507932">token</span><span class="op" id="4507937">.</span><span class="ident" id="4507938">REM_ASSIGN</span><span class="op" id="4507948">,</span>&nbsp;<span class="ident" id="4507950">token</span><span class="op" id="4507955">.</span><span class="ident" id="4507956">AND_ASSIGN</span><span class="op" id="4507966">,</span>&nbsp;<span class="ident" id="4507968">token</span><span class="op" id="4507973">.</span><span class="ident" id="4507974">OR_ASSIGN</span><span class="op" id="4507983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507987">token</span><span class="op" id="4507992">.</span><span class="ident" id="4507993">XOR_ASSIGN</span><span class="op" id="4508003">,</span>&nbsp;<span class="ident" id="4508005">token</span><span class="op" id="4508010">.</span><span class="ident" id="4508011">SHL_ASSIGN</span><span class="op" id="4508021">,</span>&nbsp;<span class="ident" id="4508023">token</span><span class="op" id="4508028">.</span><span class="ident" id="4508029">SHR_ASSIGN</span><span class="op" id="4508039">,</span>&nbsp;<span class="ident" id="4508041">token</span><span class="op" id="4508046">.</span><span class="ident" id="4508047">AND_NOT_ASSIGN</span><span class="op" id="4508061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508065">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508124">pos</span><span class="op" id="4508127">,</span>&nbsp;<span class="ident" id="4508129">tok</span>&nbsp;<span class="op" id="4508133">:=</span>&nbsp;<span class="ident" id="4508136">p</span><span class="op" id="4508137">.</span><span class="ident" id="4508138">pos</span><span class="op" id="4508141">,</span>&nbsp;<span class="ident" id="4508143">p</span><span class="op" id="4508144">.</span><span class="ident" id="4508145">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508151">p</span><span class="op" id="4508152">.</span><span class="ident" id="4508153">next</span><span class="op" id="4508157">(</span><span class="op" id="4508158">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508162">var</span>&nbsp;<span class="ident" id="4508166">y</span>&nbsp;<span class="op" id="4508168">[</span><span class="op" id="4508169">]</span><span class="ident" id="4508170">ast</span><span class="op" id="4508173">.</span><span class="ident" id="4508174">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508181">isRange</span>&nbsp;<span class="op" id="4508189">:=</span>&nbsp;<span class="builtintype" id="4508192">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508200">if</span>&nbsp;<span class="ident" id="4508203">mode</span>&nbsp;<span class="op" id="4508208">==</span>&nbsp;<span class="ident" id="4508211">rangeOk</span>&nbsp;<span class="op" id="4508219">&amp;&amp;</span>&nbsp;<span class="ident" id="4508222">p</span><span class="op" id="4508223">.</span><span class="ident" id="4508224">tok</span>&nbsp;<span class="op" id="4508228">==</span>&nbsp;<span class="ident" id="4508231">token</span><span class="op" id="4508236">.</span><span class="ident" id="4508237">RANGE</span>&nbsp;<span class="op" id="4508243">&amp;&amp;</span>&nbsp;<span class="op" id="4508246">(</span><span class="ident" id="4508247">tok</span>&nbsp;<span class="op" id="4508251">==</span>&nbsp;<span class="ident" id="4508254">token</span><span class="op" id="4508259">.</span><span class="ident" id="4508260">DEFINE</span>&nbsp;<span class="op" id="4508267">||</span>&nbsp;<span class="ident" id="4508270">tok</span>&nbsp;<span class="op" id="4508274">==</span>&nbsp;<span class="ident" id="4508277">token</span><span class="op" id="4508282">.</span><span class="ident" id="4508283">ASSIGN</span><span class="op" id="4508289">)</span>&nbsp;<span class="op" id="4508291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508296">pos</span>&nbsp;<span class="op" id="4508300">:=</span>&nbsp;<span class="ident" id="4508303">p</span><span class="op" id="4508304">.</span><span class="ident" id="4508305">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508312">p</span><span class="op" id="4508313">.</span><span class="ident" id="4508314">next</span><span class="op" id="4508318">(</span><span class="op" id="4508319">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508324">y</span>&nbsp;<span class="op" id="4508326">=</span>&nbsp;<span class="op" id="4508328">[</span><span class="op" id="4508329">]</span><span class="ident" id="4508330">ast</span><span class="op" id="4508333">.</span><span class="ident" id="4508334">Expr</span><span class="op" id="4508338">{</span><span class="op" id="4508339">&amp;</span><span class="ident" id="4508340">ast</span><span class="op" id="4508343">.</span><span class="ident" id="4508344">UnaryExpr</span><span class="op" id="4508353">{</span><span class="ident" id="4508354">OpPos</span><span class="op" id="4508359">:</span>&nbsp;<span class="ident" id="4508361">pos</span><span class="op" id="4508364">,</span>&nbsp;<span class="ident" id="4508366">Op</span><span class="op" id="4508368">:</span>&nbsp;<span class="ident" id="4508370">token</span><span class="op" id="4508375">.</span><span class="ident" id="4508376">RANGE</span><span class="op" id="4508381">,</span>&nbsp;<span class="ident" id="4508383">X</span><span class="op" id="4508384">:</span>&nbsp;<span class="ident" id="4508386">p</span><span class="op" id="4508387">.</span><span class="ident" id="4508388">parseRhs</span><span class="op" id="4508396">(</span><span class="op" id="4508397">)</span><span class="op" id="4508398">}</span><span class="op" id="4508399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508404">isRange</span>&nbsp;<span class="op" id="4508412">=</span>&nbsp;<span class="builtintype" id="4508414">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508421">}</span>&nbsp;<span class="keyword" id="4508423">else</span>&nbsp;<span class="op" id="4508428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508433">y</span>&nbsp;<span class="op" id="4508435">=</span>&nbsp;<span class="ident" id="4508437">p</span><span class="op" id="4508438">.</span><span class="ident" id="4508439">parseRhsList</span><span class="op" id="4508451">(</span><span class="op" id="4508452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508456">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508460">as</span>&nbsp;<span class="op" id="4508463">:=</span>&nbsp;<span class="op" id="4508466">&amp;</span><span class="ident" id="4508467">ast</span><span class="op" id="4508470">.</span><span class="ident" id="4508471">AssignStmt</span><span class="op" id="4508481">{</span><span class="ident" id="4508482">Lhs</span><span class="op" id="4508485">:</span>&nbsp;<span class="ident" id="4508487">x</span><span class="op" id="4508488">,</span>&nbsp;<span class="ident" id="4508490">TokPos</span><span class="op" id="4508496">:</span>&nbsp;<span class="ident" id="4508498">pos</span><span class="op" id="4508501">,</span>&nbsp;<span class="ident" id="4508503">Tok</span><span class="op" id="4508506">:</span>&nbsp;<span class="ident" id="4508508">tok</span><span class="op" id="4508511">,</span>&nbsp;<span class="ident" id="4508513">Rhs</span><span class="op" id="4508516">:</span>&nbsp;<span class="ident" id="4508518">y</span><span class="op" id="4508519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508523">if</span>&nbsp;<span class="ident" id="4508526">tok</span>&nbsp;<span class="op" id="4508530">==</span>&nbsp;<span class="ident" id="4508533">token</span><span class="op" id="4508538">.</span><span class="ident" id="4508539">DEFINE</span>&nbsp;<span class="op" id="4508546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508551">p</span><span class="op" id="4508552">.</span><span class="ident" id="4508553">shortVarDecl</span><span class="op" id="4508565">(</span><span class="ident" id="4508566">as</span><span class="op" id="4508568">,</span>&nbsp;<span class="ident" id="4508570">x</span><span class="op" id="4508571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508579">return</span>&nbsp;<span class="ident" id="4508586">as</span><span class="op" id="4508588">,</span>&nbsp;<span class="ident" id="4508590">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508603">if</span>&nbsp;<span class="builtinfunc" id="4508606">len</span><span class="op" id="4508609">(</span><span class="ident" id="4508610">x</span><span class="op" id="4508611">)</span>&nbsp;<span class="op" id="4508613">&gt;</span>&nbsp;<span class="num" id="4508615">1</span>&nbsp;<span class="op" id="4508617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508621">p</span><span class="op" id="4508622">.</span><span class="ident" id="4508623">errorExpected</span><span class="op" id="4508636">(</span><span class="ident" id="4508637">x</span><span class="op" id="4508638">[</span><span class="num" id="4508639">0</span><span class="op" id="4508640">]</span><span class="op" id="4508641">.</span><span class="ident" id="4508642">Pos</span><span class="op" id="4508645">(</span><span class="op" id="4508646">)</span><span class="op" id="4508647">,</span>&nbsp;<span class="string" id="4508649">&#34;1&nbsp;expression&#34;</span><span class="op" id="4508663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508667">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508706">switch</span>&nbsp;<span class="ident" id="4508713">p</span><span class="op" id="4508714">.</span><span class="ident" id="4508715">tok</span>&nbsp;<span class="op" id="4508719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508722">case</span>&nbsp;<span class="ident" id="4508727">token</span><span class="op" id="4508732">.</span><span class="ident" id="4508733">COLON</span><span class="op" id="4508738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508742">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508765">colon</span>&nbsp;<span class="op" id="4508771">:=</span>&nbsp;<span class="ident" id="4508774">p</span><span class="op" id="4508775">.</span><span class="ident" id="4508776">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4508782">p</span><span class="op" id="4508783">.</span><span class="ident" id="4508784">next</span><span class="op" id="4508788">(</span><span class="op" id="4508789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508793">if</span>&nbsp;<span class="ident" id="4508796">label</span><span class="op" id="4508801">,</span>&nbsp;<span class="ident" id="4508803">isIdent</span>&nbsp;<span class="op" id="4508811">:=</span>&nbsp;<span class="ident" id="4508814">x</span><span class="op" id="4508815">[</span><span class="num" id="4508816">0</span><span class="op" id="4508817">]</span><span class="op" id="4508818">.</span><span class="op" id="4508819">(</span><span class="op" id="4508820">*</span><span class="ident" id="4508821">ast</span><span class="op" id="4508824">.</span><span class="ident" id="4508825">Ident</span><span class="op" id="4508830">)</span><span class="op" id="4508831">;</span>&nbsp;<span class="ident" id="4508833">mode</span>&nbsp;<span class="op" id="4508838">==</span>&nbsp;<span class="ident" id="4508841">labelOk</span>&nbsp;<span class="op" id="4508849">&amp;&amp;</span>&nbsp;<span class="ident" id="4508852">isIdent</span>&nbsp;<span class="op" id="4508860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508865">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508929">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4508995">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509011">stmt</span>&nbsp;<span class="op" id="4509016">:=</span>&nbsp;<span class="op" id="4509019">&amp;</span><span class="ident" id="4509020">ast</span><span class="op" id="4509023">.</span><span class="ident" id="4509024">LabeledStmt</span><span class="op" id="4509035">{</span><span class="ident" id="4509036">Label</span><span class="op" id="4509041">:</span>&nbsp;<span class="ident" id="4509043">label</span><span class="op" id="4509048">,</span>&nbsp;<span class="ident" id="4509050">Colon</span><span class="op" id="4509055">:</span>&nbsp;<span class="ident" id="4509057">colon</span><span class="op" id="4509062">,</span>&nbsp;<span class="ident" id="4509064">Stmt</span><span class="op" id="4509068">:</span>&nbsp;<span class="ident" id="4509070">p</span><span class="op" id="4509071">.</span><span class="ident" id="4509072">parseStmt</span><span class="op" id="4509081">(</span><span class="op" id="4509082">)</span><span class="op" id="4509083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509088">p</span><span class="op" id="4509089">.</span><span class="ident" id="4509090">declare</span><span class="op" id="4509097">(</span><span class="ident" id="4509098">stmt</span><span class="op" id="4509102">,</span>&nbsp;<span class="ident" id="4509104">nil</span><span class="op" id="4509107">,</span>&nbsp;<span class="ident" id="4509109">p</span><span class="op" id="4509110">.</span><span class="ident" id="4509111">labelScope</span><span class="op" id="4509121">,</span>&nbsp;<span class="ident" id="4509123">ast</span><span class="op" id="4509126">.</span><span class="ident" id="4509127">Lbl</span><span class="op" id="4509130">,</span>&nbsp;<span class="ident" id="4509132">label</span><span class="op" id="4509137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509142">return</span>&nbsp;<span class="ident" id="4509149">stmt</span><span class="op" id="4509153">,</span>&nbsp;<span class="builtintype" id="4509155">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509163">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509167">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509240">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509314">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509387">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509460">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509534">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509569">p</span><span class="op" id="4509570">.</span><span class="builtintype" id="4509571">error</span><span class="op" id="4509576">(</span><span class="ident" id="4509577">colon</span><span class="op" id="4509582">,</span>&nbsp;<span class="string" id="4509584">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="4509611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509615">return</span>&nbsp;<span class="op" id="4509622">&amp;</span><span class="ident" id="4509623">ast</span><span class="op" id="4509626">.</span><span class="ident" id="4509627">BadStmt</span><span class="op" id="4509634">{</span><span class="ident" id="4509635">From</span><span class="op" id="4509639">:</span>&nbsp;<span class="ident" id="4509641">x</span><span class="op" id="4509642">[</span><span class="num" id="4509643">0</span><span class="op" id="4509644">]</span><span class="op" id="4509645">.</span><span class="ident" id="4509646">Pos</span><span class="op" id="4509649">(</span><span class="op" id="4509650">)</span><span class="op" id="4509651">,</span>&nbsp;<span class="ident" id="4509653">To</span><span class="op" id="4509655">:</span>&nbsp;<span class="ident" id="4509657">colon</span>&nbsp;<span class="op" id="4509663">+</span>&nbsp;<span class="num" id="4509665">1</span><span class="op" id="4509666">}</span><span class="op" id="4509667">,</span>&nbsp;<span class="builtintype" id="4509669">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509677">case</span>&nbsp;<span class="ident" id="4509682">token</span><span class="op" id="4509687">.</span><span class="ident" id="4509688">ARROW</span><span class="op" id="4509693">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509697">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509717">arrow</span>&nbsp;<span class="op" id="4509723">:=</span>&nbsp;<span class="ident" id="4509726">p</span><span class="op" id="4509727">.</span><span class="ident" id="4509728">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509734">p</span><span class="op" id="4509735">.</span><span class="ident" id="4509736">next</span><span class="op" id="4509740">(</span><span class="op" id="4509741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509745">y</span>&nbsp;<span class="op" id="4509747">:=</span>&nbsp;<span class="ident" id="4509750">p</span><span class="op" id="4509751">.</span><span class="ident" id="4509752">parseRhs</span><span class="op" id="4509760">(</span><span class="op" id="4509761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509765">return</span>&nbsp;<span class="op" id="4509772">&amp;</span><span class="ident" id="4509773">ast</span><span class="op" id="4509776">.</span><span class="ident" id="4509777">SendStmt</span><span class="op" id="4509785">{</span><span class="ident" id="4509786">Chan</span><span class="op" id="4509790">:</span>&nbsp;<span class="ident" id="4509792">x</span><span class="op" id="4509793">[</span><span class="num" id="4509794">0</span><span class="op" id="4509795">]</span><span class="op" id="4509796">,</span>&nbsp;<span class="ident" id="4509798">Arrow</span><span class="op" id="4509803">:</span>&nbsp;<span class="ident" id="4509805">arrow</span><span class="op" id="4509810">,</span>&nbsp;<span class="ident" id="4509812">Value</span><span class="op" id="4509817">:</span>&nbsp;<span class="ident" id="4509819">y</span><span class="op" id="4509820">}</span><span class="op" id="4509821">,</span>&nbsp;<span class="builtintype" id="4509823">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509831">case</span>&nbsp;<span class="ident" id="4509836">token</span><span class="op" id="4509841">.</span><span class="ident" id="4509842">INC</span><span class="op" id="4509845">,</span>&nbsp;<span class="ident" id="4509847">token</span><span class="op" id="4509852">.</span><span class="ident" id="4509853">DEC</span><span class="op" id="4509856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509860">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509888">s</span>&nbsp;<span class="op" id="4509890">:=</span>&nbsp;<span class="op" id="4509893">&amp;</span><span class="ident" id="4509894">ast</span><span class="op" id="4509897">.</span><span class="ident" id="4509898">IncDecStmt</span><span class="op" id="4509908">{</span><span class="ident" id="4509909">X</span><span class="op" id="4509910">:</span>&nbsp;<span class="ident" id="4509912">x</span><span class="op" id="4509913">[</span><span class="num" id="4509914">0</span><span class="op" id="4509915">]</span><span class="op" id="4509916">,</span>&nbsp;<span class="ident" id="4509918">TokPos</span><span class="op" id="4509924">:</span>&nbsp;<span class="ident" id="4509926">p</span><span class="op" id="4509927">.</span><span class="ident" id="4509928">pos</span><span class="op" id="4509931">,</span>&nbsp;<span class="ident" id="4509933">Tok</span><span class="op" id="4509936">:</span>&nbsp;<span class="ident" id="4509938">p</span><span class="op" id="4509939">.</span><span class="ident" id="4509940">tok</span><span class="op" id="4509943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4509947">p</span><span class="op" id="4509948">.</span><span class="ident" id="4509949">next</span><span class="op" id="4509953">(</span><span class="op" id="4509954">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509958">return</span>&nbsp;<span class="ident" id="4509965">s</span><span class="op" id="4509966">,</span>&nbsp;<span class="builtintype" id="4509968">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4509975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4509979">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4509994">return</span>&nbsp;<span class="op" id="4510001">&amp;</span><span class="ident" id="4510002">ast</span><span class="op" id="4510005">.</span><span class="ident" id="4510006">ExprStmt</span><span class="op" id="4510014">{</span><span class="ident" id="4510015">X</span><span class="op" id="4510016">:</span>&nbsp;<span class="ident" id="4510018">x</span><span class="op" id="4510019">[</span><span class="num" id="4510020">0</span><span class="op" id="4510021">]</span><span class="op" id="4510022">}</span><span class="op" id="4510023">,</span>&nbsp;<span class="builtintype" id="4510025">false</span><br>
<span class="lineno">1710</span><span class="op" id="4510031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510034">func</span>&nbsp;<span class="op" id="4510039">(</span><span class="ident" id="4510040">p</span>&nbsp;<span class="op" id="4510042">*</span><span class="ident" id="4510043">parser</span><span class="op" id="4510049">)</span>&nbsp;<span class="ident" id="4510051">parseCallExpr</span><span class="op" id="4510064">(</span><span class="ident" id="4510065">callType</span>&nbsp;<span class="builtintype" id="4510074">string</span><span class="op" id="4510080">)</span>&nbsp;<span class="op" id="4510082">*</span><span class="ident" id="4510083">ast</span><span class="op" id="4510086">.</span><span class="ident" id="4510087">CallExpr</span>&nbsp;<span class="op" id="4510096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510099">x</span>&nbsp;<span class="op" id="4510101">:=</span>&nbsp;<span class="ident" id="4510104">p</span><span class="op" id="4510105">.</span><span class="ident" id="4510106">parseRhsOrType</span><span class="op" id="4510120">(</span><span class="op" id="4510121">)</span>&nbsp;<span class="comment" id="4510123">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510165">if</span>&nbsp;<span class="ident" id="4510168">call</span><span class="op" id="4510172">,</span>&nbsp;<span class="ident" id="4510174">isCall</span>&nbsp;<span class="op" id="4510181">:=</span>&nbsp;<span class="ident" id="4510184">x</span><span class="op" id="4510185">.</span><span class="op" id="4510186">(</span><span class="op" id="4510187">*</span><span class="ident" id="4510188">ast</span><span class="op" id="4510191">.</span><span class="ident" id="4510192">CallExpr</span><span class="op" id="4510200">)</span><span class="op" id="4510201">;</span>&nbsp;<span class="ident" id="4510203">isCall</span>&nbsp;<span class="op" id="4510210">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510214">return</span>&nbsp;<span class="ident" id="4510221">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510230">if</span>&nbsp;<span class="ident" id="4510233">_</span><span class="op" id="4510234">,</span>&nbsp;<span class="ident" id="4510236">isBad</span>&nbsp;<span class="op" id="4510242">:=</span>&nbsp;<span class="ident" id="4510245">x</span><span class="op" id="4510246">.</span><span class="op" id="4510247">(</span><span class="op" id="4510248">*</span><span class="ident" id="4510249">ast</span><span class="op" id="4510252">.</span><span class="ident" id="4510253">BadExpr</span><span class="op" id="4510260">)</span><span class="op" id="4510261">;</span>&nbsp;<span class="op" id="4510263">!</span><span class="ident" id="4510264">isBad</span>&nbsp;<span class="op" id="4510270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4510274">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510315">p</span><span class="op" id="4510316">.</span><span class="builtintype" id="4510317">error</span><span class="op" id="4510322">(</span><span class="ident" id="4510323">p</span><span class="op" id="4510324">.</span><span class="ident" id="4510325">safePos</span><span class="op" id="4510332">(</span><span class="ident" id="4510333">x</span><span class="op" id="4510334">.</span><span class="ident" id="4510335">End</span><span class="op" id="4510338">(</span><span class="op" id="4510339">)</span><span class="op" id="4510340">)</span><span class="op" id="4510341">,</span>&nbsp;<span class="ident" id="4510343">fmt</span><span class="op" id="4510346">.</span><span class="ident" id="4510347">Sprintf</span><span class="op" id="4510354">(</span><span class="string" id="4510355">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="4510397">,</span>&nbsp;<span class="ident" id="4510399">callType</span><span class="op" id="4510407">)</span><span class="op" id="4510408">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510414">return</span>&nbsp;<span class="ident" id="4510421">nil</span><br>
<span class="lineno"></span><span class="op" id="4510425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510428">func</span>&nbsp;<span class="op" id="4510433">(</span><span class="ident" id="4510434">p</span>&nbsp;<span class="op" id="4510436">*</span><span class="ident" id="4510437">parser</span><span class="op" id="4510443">)</span>&nbsp;<span class="ident" id="4510445">parseGoStmt</span><span class="op" id="4510456">(</span><span class="op" id="4510457">)</span>&nbsp;<span class="ident" id="4510459">ast</span><span class="op" id="4510462">.</span><span class="ident" id="4510463">Stmt</span>&nbsp;<span class="op" id="4510468">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510471">if</span>&nbsp;<span class="ident" id="4510474">p</span><span class="op" id="4510475">.</span><span class="ident" id="4510476">trace</span>&nbsp;<span class="op" id="4510482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510486">defer</span>&nbsp;<span class="ident" id="4510492">un</span><span class="op" id="4510494">(</span><span class="ident" id="4510495">trace</span><span class="op" id="4510500">(</span><span class="ident" id="4510501">p</span><span class="op" id="4510502">,</span>&nbsp;<span class="string" id="4510504">&#34;GoStmt&#34;</span><span class="op" id="4510512">)</span><span class="op" id="4510513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510520">pos</span>&nbsp;<span class="op" id="4510524">:=</span>&nbsp;<span class="ident" id="4510527">p</span><span class="op" id="4510528">.</span><span class="ident" id="4510529">expect</span><span class="op" id="4510535">(</span><span class="ident" id="4510536">token</span><span class="op" id="4510541">.</span><span class="ident" id="4510542">GO</span><span class="op" id="4510544">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510547">call</span>&nbsp;<span class="op" id="4510552">:=</span>&nbsp;<span class="ident" id="4510555">p</span><span class="op" id="4510556">.</span><span class="ident" id="4510557">parseCallExpr</span><span class="op" id="4510570">(</span><span class="string" id="4510571">&#34;go&#34;</span><span class="op" id="4510575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510578">p</span><span class="op" id="4510579">.</span><span class="ident" id="4510580">expectSemi</span><span class="op" id="4510590">(</span><span class="op" id="4510591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510594">if</span>&nbsp;<span class="ident" id="4510597">call</span>&nbsp;<span class="op" id="4510602">==</span>&nbsp;<span class="ident" id="4510605">nil</span>&nbsp;<span class="op" id="4510609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510613">return</span>&nbsp;<span class="op" id="4510620">&amp;</span><span class="ident" id="4510621">ast</span><span class="op" id="4510624">.</span><span class="ident" id="4510625">BadStmt</span><span class="op" id="4510632">{</span><span class="ident" id="4510633">From</span><span class="op" id="4510637">:</span>&nbsp;<span class="ident" id="4510639">pos</span><span class="op" id="4510642">,</span>&nbsp;<span class="ident" id="4510644">To</span><span class="op" id="4510646">:</span>&nbsp;<span class="ident" id="4510648">pos</span>&nbsp;<span class="op" id="4510652">+</span>&nbsp;<span class="num" id="4510654">2</span><span class="op" id="4510655">}</span>&nbsp;<span class="comment" id="4510657">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510671">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510675">return</span>&nbsp;<span class="op" id="4510682">&amp;</span><span class="ident" id="4510683">ast</span><span class="op" id="4510686">.</span><span class="ident" id="4510687">GoStmt</span><span class="op" id="4510693">{</span><span class="ident" id="4510694">Go</span><span class="op" id="4510696">:</span>&nbsp;<span class="ident" id="4510698">pos</span><span class="op" id="4510701">,</span>&nbsp;<span class="ident" id="4510703">Call</span><span class="op" id="4510707">:</span>&nbsp;<span class="ident" id="4510709">call</span><span class="op" id="4510713">}</span><br>
<span class="lineno"></span><span class="op" id="4510715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4510718">func</span>&nbsp;<span class="op" id="4510723">(</span><span class="ident" id="4510724">p</span>&nbsp;<span class="op" id="4510726">*</span><span class="ident" id="4510727">parser</span><span class="op" id="4510733">)</span>&nbsp;<span class="ident" id="4510735">parseDeferStmt</span><span class="op" id="4510749">(</span><span class="op" id="4510750">)</span>&nbsp;<span class="ident" id="4510752">ast</span><span class="op" id="4510755">.</span><span class="ident" id="4510756">Stmt</span>&nbsp;<span class="op" id="4510761">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510764">if</span>&nbsp;<span class="ident" id="4510767">p</span><span class="op" id="4510768">.</span><span class="ident" id="4510769">trace</span>&nbsp;<span class="op" id="4510775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510779">defer</span>&nbsp;<span class="ident" id="4510785">un</span><span class="op" id="4510787">(</span><span class="ident" id="4510788">trace</span><span class="op" id="4510793">(</span><span class="ident" id="4510794">p</span><span class="op" id="4510795">,</span>&nbsp;<span class="string" id="4510797">&#34;DeferStmt&#34;</span><span class="op" id="4510808">)</span><span class="op" id="4510809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510816">pos</span>&nbsp;<span class="op" id="4510820">:=</span>&nbsp;<span class="ident" id="4510823">p</span><span class="op" id="4510824">.</span><span class="ident" id="4510825">expect</span><span class="op" id="4510831">(</span><span class="ident" id="4510832">token</span><span class="op" id="4510837">.</span><span class="ident" id="4510838">DEFER</span><span class="op" id="4510843">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510846">call</span>&nbsp;<span class="op" id="4510851">:=</span>&nbsp;<span class="ident" id="4510854">p</span><span class="op" id="4510855">.</span><span class="ident" id="4510856">parseCallExpr</span><span class="op" id="4510869">(</span><span class="string" id="4510870">&#34;defer&#34;</span><span class="op" id="4510877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4510880">p</span><span class="op" id="4510881">.</span><span class="ident" id="4510882">expectSemi</span><span class="op" id="4510892">(</span><span class="op" id="4510893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510896">if</span>&nbsp;<span class="ident" id="4510899">call</span>&nbsp;<span class="op" id="4510904">==</span>&nbsp;<span class="ident" id="4510907">nil</span>&nbsp;<span class="op" id="4510911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510915">return</span>&nbsp;<span class="op" id="4510922">&amp;</span><span class="ident" id="4510923">ast</span><span class="op" id="4510926">.</span><span class="ident" id="4510927">BadStmt</span><span class="op" id="4510934">{</span><span class="ident" id="4510935">From</span><span class="op" id="4510939">:</span>&nbsp;<span class="ident" id="4510941">pos</span><span class="op" id="4510944">,</span>&nbsp;<span class="ident" id="4510946">To</span><span class="op" id="4510948">:</span>&nbsp;<span class="ident" id="4510950">pos</span>&nbsp;<span class="op" id="4510954">+</span>&nbsp;<span class="num" id="4510956">5</span><span class="op" id="4510957">}</span>&nbsp;<span class="comment" id="4510959">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4510976">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4510980">return</span>&nbsp;<span class="op" id="4510987">&amp;</span><span class="ident" id="4510988">ast</span><span class="op" id="4510991">.</span><span class="ident" id="4510992">DeferStmt</span><span class="op" id="4511001">{</span><span class="ident" id="4511002">Defer</span><span class="op" id="4511007">:</span>&nbsp;<span class="ident" id="4511009">pos</span><span class="op" id="4511012">,</span>&nbsp;<span class="ident" id="4511014">Call</span><span class="op" id="4511018">:</span>&nbsp;<span class="ident" id="4511020">call</span><span class="op" id="4511024">}</span><br>
<span class="lineno"></span><span class="op" id="4511026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511029">func</span>&nbsp;<span class="op" id="4511034">(</span><span class="ident" id="4511035">p</span>&nbsp;<span class="op" id="4511037">*</span><span class="ident" id="4511038">parser</span><span class="op" id="4511044">)</span>&nbsp;<span class="ident" id="4511046">parseReturnStmt</span><span class="op" id="4511061">(</span><span class="op" id="4511062">)</span>&nbsp;<span class="op" id="4511064">*</span><span class="ident" id="4511065">ast</span><span class="op" id="4511068">.</span><span class="ident" id="4511069">ReturnStmt</span>&nbsp;<span class="op" id="4511080">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511083">if</span>&nbsp;<span class="ident" id="4511086">p</span><span class="op" id="4511087">.</span><span class="ident" id="4511088">trace</span>&nbsp;<span class="op" id="4511094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511098">defer</span>&nbsp;<span class="ident" id="4511104">un</span><span class="op" id="4511106">(</span><span class="ident" id="4511107">trace</span><span class="op" id="4511112">(</span><span class="ident" id="4511113">p</span><span class="op" id="4511114">,</span>&nbsp;<span class="string" id="4511116">&#34;ReturnStmt&#34;</span><span class="op" id="4511128">)</span><span class="op" id="4511129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511136">pos</span>&nbsp;<span class="op" id="4511140">:=</span>&nbsp;<span class="ident" id="4511143">p</span><span class="op" id="4511144">.</span><span class="ident" id="4511145">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511150">p</span><span class="op" id="4511151">.</span><span class="ident" id="4511152">expect</span><span class="op" id="4511158">(</span><span class="ident" id="4511159">token</span><span class="op" id="4511164">.</span><span class="ident" id="4511165">RETURN</span><span class="op" id="4511171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511174">var</span>&nbsp;<span class="ident" id="4511178">x</span>&nbsp;<span class="op" id="4511180">[</span><span class="op" id="4511181">]</span><span class="ident" id="4511182">ast</span><span class="op" id="4511185">.</span><span class="ident" id="4511186">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511192">if</span>&nbsp;<span class="ident" id="4511195">p</span><span class="op" id="4511196">.</span><span class="ident" id="4511197">tok</span>&nbsp;<span class="op" id="4511201">!=</span>&nbsp;<span class="ident" id="4511204">token</span><span class="op" id="4511209">.</span><span class="ident" id="4511210">SEMICOLON</span>&nbsp;<span class="op" id="4511220">&amp;&amp;</span>&nbsp;<span class="ident" id="4511223">p</span><span class="op" id="4511224">.</span><span class="ident" id="4511225">tok</span>&nbsp;<span class="op" id="4511229">!=</span>&nbsp;<span class="ident" id="4511232">token</span><span class="op" id="4511237">.</span><span class="ident" id="4511238">RBRACE</span>&nbsp;<span class="op" id="4511245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511249">x</span>&nbsp;<span class="op" id="4511251">=</span>&nbsp;<span class="ident" id="4511253">p</span><span class="op" id="4511254">.</span><span class="ident" id="4511255">parseRhsList</span><span class="op" id="4511267">(</span><span class="op" id="4511268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511271">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511274">p</span><span class="op" id="4511275">.</span><span class="ident" id="4511276">expectSemi</span><span class="op" id="4511286">(</span><span class="op" id="4511287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511291">return</span>&nbsp;<span class="op" id="4511298">&amp;</span><span class="ident" id="4511299">ast</span><span class="op" id="4511302">.</span><span class="ident" id="4511303">ReturnStmt</span><span class="op" id="4511313">{</span><span class="ident" id="4511314">Return</span><span class="op" id="4511320">:</span>&nbsp;<span class="ident" id="4511322">pos</span><span class="op" id="4511325">,</span>&nbsp;<span class="ident" id="4511327">Results</span><span class="op" id="4511334">:</span>&nbsp;<span class="ident" id="4511336">x</span><span class="op" id="4511337">}</span><br>
<span class="lineno"></span><span class="op" id="4511339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="4511342">func</span>&nbsp;<span class="op" id="4511347">(</span><span class="ident" id="4511348">p</span>&nbsp;<span class="op" id="4511350">*</span><span class="ident" id="4511351">parser</span><span class="op" id="4511357">)</span>&nbsp;<span class="ident" id="4511359">parseBranchStmt</span><span class="op" id="4511374">(</span><span class="ident" id="4511375">tok</span>&nbsp;<span class="ident" id="4511379">token</span><span class="op" id="4511384">.</span><span class="ident" id="4511385">Token</span><span class="op" id="4511390">)</span>&nbsp;<span class="op" id="4511392">*</span><span class="ident" id="4511393">ast</span><span class="op" id="4511396">.</span><span class="ident" id="4511397">BranchStmt</span>&nbsp;<span class="op" id="4511408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511411">if</span>&nbsp;<span class="ident" id="4511414">p</span><span class="op" id="4511415">.</span><span class="ident" id="4511416">trace</span>&nbsp;<span class="op" id="4511422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511426">defer</span>&nbsp;<span class="ident" id="4511432">un</span><span class="op" id="4511434">(</span><span class="ident" id="4511435">trace</span><span class="op" id="4511440">(</span><span class="ident" id="4511441">p</span><span class="op" id="4511442">,</span>&nbsp;<span class="string" id="4511444">&#34;BranchStmt&#34;</span><span class="op" id="4511456">)</span><span class="op" id="4511457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511464">pos</span>&nbsp;<span class="op" id="4511468">:=</span>&nbsp;<span class="ident" id="4511471">p</span><span class="op" id="4511472">.</span><span class="ident" id="4511473">expect</span><span class="op" id="4511479">(</span><span class="ident" id="4511480">tok</span><span class="op" id="4511483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511486">var</span>&nbsp;<span class="ident" id="4511490">label</span>&nbsp;<span class="op" id="4511496">*</span><span class="ident" id="4511497">ast</span><span class="op" id="4511500">.</span><span class="ident" id="4511501">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511508">if</span>&nbsp;<span class="ident" id="4511511">tok</span>&nbsp;<span class="op" id="4511515">!=</span>&nbsp;<span class="ident" id="4511518">token</span><span class="op" id="4511523">.</span><span class="ident" id="4511524">FALLTHROUGH</span>&nbsp;<span class="op" id="4511536">&amp;&amp;</span>&nbsp;<span class="ident" id="4511539">p</span><span class="op" id="4511540">.</span><span class="ident" id="4511541">tok</span>&nbsp;<span class="op" id="4511545">==</span>&nbsp;<span class="ident" id="4511548">token</span><span class="op" id="4511553">.</span><span class="ident" id="4511554">IDENT</span>&nbsp;<span class="op" id="4511560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511564">label</span>&nbsp;<span class="op" id="4511570">=</span>&nbsp;<span class="ident" id="4511572">p</span><span class="op" id="4511573">.</span><span class="ident" id="4511574">parseIdent</span><span class="op" id="4511584">(</span><span class="op" id="4511585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4511589">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511628">n</span>&nbsp;<span class="op" id="4511630">:=</span>&nbsp;<span class="builtinfunc" id="4511633">len</span><span class="op" id="4511636">(</span><span class="ident" id="4511637">p</span><span class="op" id="4511638">.</span><span class="ident" id="4511639">targetStack</span><span class="op" id="4511650">)</span>&nbsp;<span class="op" id="4511652">-</span>&nbsp;<span class="num" id="4511654">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511658">p</span><span class="op" id="4511659">.</span><span class="ident" id="4511660">targetStack</span><span class="op" id="4511671">[</span><span class="ident" id="4511672">n</span><span class="op" id="4511673">]</span>&nbsp;<span class="op" id="4511675">=</span>&nbsp;<span class="builtinfunc" id="4511677">append</span><span class="op" id="4511683">(</span><span class="ident" id="4511684">p</span><span class="op" id="4511685">.</span><span class="ident" id="4511686">targetStack</span><span class="op" id="4511697">[</span><span class="ident" id="4511698">n</span><span class="op" id="4511699">]</span><span class="op" id="4511700">,</span>&nbsp;<span class="ident" id="4511702">label</span><span class="op" id="4511707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511713">p</span><span class="op" id="4511714">.</span><span class="ident" id="4511715">expectSemi</span><span class="op" id="4511725">(</span><span class="op" id="4511726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511730">return</span>&nbsp;<span class="op" id="4511737">&amp;</span><span class="ident" id="4511738">ast</span><span class="op" id="4511741">.</span><span class="ident" id="4511742">BranchStmt</span><span class="op" id="4511752">{</span><span class="ident" id="4511753">TokPos</span><span class="op" id="4511759">:</span>&nbsp;<span class="ident" id="4511761">pos</span><span class="op" id="4511764">,</span>&nbsp;<span class="ident" id="4511766">Tok</span><span class="op" id="4511769">:</span>&nbsp;<span class="ident" id="4511771">tok</span><span class="op" id="4511774">,</span>&nbsp;<span class="ident" id="4511776">Label</span><span class="op" id="4511781">:</span>&nbsp;<span class="ident" id="4511783">label</span><span class="op" id="4511788">}</span><br>
<span class="lineno"></span><span class="op" id="4511790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4511793">func</span>&nbsp;<span class="op" id="4511798">(</span><span class="ident" id="4511799">p</span>&nbsp;<span class="op" id="4511801">*</span><span class="ident" id="4511802">parser</span><span class="op" id="4511808">)</span>&nbsp;<span class="ident" id="4511810">makeExpr</span><span class="op" id="4511818">(</span><span class="ident" id="4511819">s</span>&nbsp;<span class="ident" id="4511821">ast</span><span class="op" id="4511824">.</span><span class="ident" id="4511825">Stmt</span><span class="op" id="4511829">,</span>&nbsp;<span class="ident" id="4511831">kind</span>&nbsp;<span class="builtintype" id="4511836">string</span><span class="op" id="4511842">)</span>&nbsp;<span class="ident" id="4511844">ast</span><span class="op" id="4511847">.</span><span class="ident" id="4511848">Expr</span>&nbsp;<span class="op" id="4511853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511856">if</span>&nbsp;<span class="ident" id="4511859">s</span>&nbsp;<span class="op" id="4511861">==</span>&nbsp;<span class="ident" id="4511864">nil</span>&nbsp;<span class="op" id="4511868">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511872">return</span>&nbsp;<span class="ident" id="4511879">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511887">if</span>&nbsp;<span class="ident" id="4511890">es</span><span class="op" id="4511892">,</span>&nbsp;<span class="ident" id="4511894">isExpr</span>&nbsp;<span class="op" id="4511901">:=</span>&nbsp;<span class="ident" id="4511904">s</span><span class="op" id="4511905">.</span><span class="op" id="4511906">(</span><span class="op" id="4511907">*</span><span class="ident" id="4511908">ast</span><span class="op" id="4511911">.</span><span class="ident" id="4511912">ExprStmt</span><span class="op" id="4511920">)</span><span class="op" id="4511921">;</span>&nbsp;<span class="ident" id="4511923">isExpr</span>&nbsp;<span class="op" id="4511930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4511934">return</span>&nbsp;<span class="ident" id="4511941">p</span><span class="op" id="4511942">.</span><span class="ident" id="4511943">checkExpr</span><span class="op" id="4511952">(</span><span class="ident" id="4511953">es</span><span class="op" id="4511955">.</span><span class="ident" id="4511956">X</span><span class="op" id="4511957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4511960">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4511963">p</span><span class="op" id="4511964">.</span><span class="builtintype" id="4511965">error</span><span class="op" id="4511970">(</span><span class="ident" id="4511971">s</span><span class="op" id="4511972">.</span><span class="ident" id="4511973">Pos</span><span class="op" id="4511976">(</span><span class="op" id="4511977">)</span><span class="op" id="4511978">,</span>&nbsp;<span class="ident" id="4511980">fmt</span><span class="op" id="4511983">.</span><span class="ident" id="4511984">Sprintf</span><span class="op" id="4511991">(</span><span class="string" id="4511992">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="4512077">,</span>&nbsp;<span class="ident" id="4512079">kind</span><span class="op" id="4512083">)</span><span class="op" id="4512084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512087">return</span>&nbsp;<span class="op" id="4512094">&amp;</span><span class="ident" id="4512095">ast</span><span class="op" id="4512098">.</span><span class="ident" id="4512099">BadExpr</span><span class="op" id="4512106">{</span><span class="ident" id="4512107">From</span><span class="op" id="4512111">:</span>&nbsp;<span class="ident" id="4512113">s</span><span class="op" id="4512114">.</span><span class="ident" id="4512115">Pos</span><span class="op" id="4512118">(</span><span class="op" id="4512119">)</span><span class="op" id="4512120">,</span>&nbsp;<span class="ident" id="4512122">To</span><span class="op" id="4512124">:</span>&nbsp;<span class="ident" id="4512126">p</span><span class="op" id="4512127">.</span><span class="ident" id="4512128">safePos</span><span class="op" id="4512135">(</span><span class="ident" id="4512136">s</span><span class="op" id="4512137">.</span><span class="ident" id="4512138">End</span><span class="op" id="4512141">(</span><span class="op" id="4512142">)</span><span class="op" id="4512143">)</span><span class="op" id="4512144">}</span><br>
<span class="lineno"></span><span class="op" id="4512146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512149">func</span>&nbsp;<span class="op" id="4512154">(</span><span class="ident" id="4512155">p</span>&nbsp;<span class="op" id="4512157">*</span><span class="ident" id="4512158">parser</span><span class="op" id="4512164">)</span>&nbsp;<span class="ident" id="4512166">parseIfStmt</span><span class="op" id="4512177">(</span><span class="op" id="4512178">)</span>&nbsp;<span class="op" id="4512180">*</span><span class="ident" id="4512181">ast</span><span class="op" id="4512184">.</span><span class="ident" id="4512185">IfStmt</span>&nbsp;<span class="op" id="4512192">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512195">if</span>&nbsp;<span class="ident" id="4512198">p</span><span class="op" id="4512199">.</span><span class="ident" id="4512200">trace</span>&nbsp;<span class="op" id="4512206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512210">defer</span>&nbsp;<span class="ident" id="4512216">un</span><span class="op" id="4512218">(</span><span class="ident" id="4512219">trace</span><span class="op" id="4512224">(</span><span class="ident" id="4512225">p</span><span class="op" id="4512226">,</span>&nbsp;<span class="string" id="4512228">&#34;IfStmt&#34;</span><span class="op" id="4512236">)</span><span class="op" id="4512237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512244">pos</span>&nbsp;<span class="op" id="4512248">:=</span>&nbsp;<span class="ident" id="4512251">p</span><span class="op" id="4512252">.</span><span class="ident" id="4512253">expect</span><span class="op" id="4512259">(</span><span class="ident" id="4512260">token</span><span class="op" id="4512265">.</span><span class="ident" id="4512266">IF</span><span class="op" id="4512268">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512271">p</span><span class="op" id="4512272">.</span><span class="ident" id="4512273">openScope</span><span class="op" id="4512282">(</span><span class="op" id="4512283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512286">defer</span>&nbsp;<span class="ident" id="4512292">p</span><span class="op" id="4512293">.</span><span class="ident" id="4512294">closeScope</span><span class="op" id="4512304">(</span><span class="op" id="4512305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512309">var</span>&nbsp;<span class="ident" id="4512313">s</span>&nbsp;<span class="ident" id="4512315">ast</span><span class="op" id="4512318">.</span><span class="ident" id="4512319">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512325">var</span>&nbsp;<span class="ident" id="4512329">x</span>&nbsp;<span class="ident" id="4512331">ast</span><span class="op" id="4512334">.</span><span class="ident" id="4512335">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512345">prevLev</span>&nbsp;<span class="op" id="4512353">:=</span>&nbsp;<span class="ident" id="4512356">p</span><span class="op" id="4512357">.</span><span class="ident" id="4512358">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512368">p</span><span class="op" id="4512369">.</span><span class="ident" id="4512370">exprLev</span>&nbsp;<span class="op" id="4512378">=</span>&nbsp;<span class="op" id="4512380">-</span><span class="num" id="4512381">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512385">if</span>&nbsp;<span class="ident" id="4512388">p</span><span class="op" id="4512389">.</span><span class="ident" id="4512390">tok</span>&nbsp;<span class="op" id="4512394">==</span>&nbsp;<span class="ident" id="4512397">token</span><span class="op" id="4512402">.</span><span class="ident" id="4512403">SEMICOLON</span>&nbsp;<span class="op" id="4512413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512418">p</span><span class="op" id="4512419">.</span><span class="ident" id="4512420">next</span><span class="op" id="4512424">(</span><span class="op" id="4512425">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512430">x</span>&nbsp;<span class="op" id="4512432">=</span>&nbsp;<span class="ident" id="4512434">p</span><span class="op" id="4512435">.</span><span class="ident" id="4512436">parseRhs</span><span class="op" id="4512444">(</span><span class="op" id="4512445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512449">}</span>&nbsp;<span class="keyword" id="4512451">else</span>&nbsp;<span class="op" id="4512456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512461">s</span><span class="op" id="4512462">,</span>&nbsp;<span class="ident" id="4512464">_</span>&nbsp;<span class="op" id="4512466">=</span>&nbsp;<span class="ident" id="4512468">p</span><span class="op" id="4512469">.</span><span class="ident" id="4512470">parseSimpleStmt</span><span class="op" id="4512485">(</span><span class="ident" id="4512486">basic</span><span class="op" id="4512491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512496">if</span>&nbsp;<span class="ident" id="4512499">p</span><span class="op" id="4512500">.</span><span class="ident" id="4512501">tok</span>&nbsp;<span class="op" id="4512505">==</span>&nbsp;<span class="ident" id="4512508">token</span><span class="op" id="4512513">.</span><span class="ident" id="4512514">SEMICOLON</span>&nbsp;<span class="op" id="4512524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512530">p</span><span class="op" id="4512531">.</span><span class="ident" id="4512532">next</span><span class="op" id="4512536">(</span><span class="op" id="4512537">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512543">x</span>&nbsp;<span class="op" id="4512545">=</span>&nbsp;<span class="ident" id="4512547">p</span><span class="op" id="4512548">.</span><span class="ident" id="4512549">parseRhs</span><span class="op" id="4512557">(</span><span class="op" id="4512558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512563">}</span>&nbsp;<span class="keyword" id="4512565">else</span>&nbsp;<span class="op" id="4512570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512576">x</span>&nbsp;<span class="op" id="4512578">=</span>&nbsp;<span class="ident" id="4512580">p</span><span class="op" id="4512581">.</span><span class="ident" id="4512582">makeExpr</span><span class="op" id="4512590">(</span><span class="ident" id="4512591">s</span><span class="op" id="4512592">,</span>&nbsp;<span class="string" id="4512594">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="4512614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512620">s</span>&nbsp;<span class="op" id="4512622">=</span>&nbsp;<span class="ident" id="4512624">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512631">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512639">p</span><span class="op" id="4512640">.</span><span class="ident" id="4512641">exprLev</span>&nbsp;<span class="op" id="4512649">=</span>&nbsp;<span class="ident" id="4512651">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512664">body</span>&nbsp;<span class="op" id="4512669">:=</span>&nbsp;<span class="ident" id="4512672">p</span><span class="op" id="4512673">.</span><span class="ident" id="4512674">parseBlockStmt</span><span class="op" id="4512688">(</span><span class="op" id="4512689">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512692">var</span>&nbsp;<span class="ident" id="4512696">else_</span>&nbsp;<span class="ident" id="4512702">ast</span><span class="op" id="4512705">.</span><span class="ident" id="4512706">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512712">if</span>&nbsp;<span class="ident" id="4512715">p</span><span class="op" id="4512716">.</span><span class="ident" id="4512717">tok</span>&nbsp;<span class="op" id="4512721">==</span>&nbsp;<span class="ident" id="4512724">token</span><span class="op" id="4512729">.</span><span class="ident" id="4512730">ELSE</span>&nbsp;<span class="op" id="4512735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512739">p</span><span class="op" id="4512740">.</span><span class="ident" id="4512741">next</span><span class="op" id="4512745">(</span><span class="op" id="4512746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512750">else_</span>&nbsp;<span class="op" id="4512756">=</span>&nbsp;<span class="ident" id="4512758">p</span><span class="op" id="4512759">.</span><span class="ident" id="4512760">parseStmt</span><span class="op" id="4512769">(</span><span class="op" id="4512770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512773">}</span>&nbsp;<span class="keyword" id="4512775">else</span>&nbsp;<span class="op" id="4512780">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512784">p</span><span class="op" id="4512785">.</span><span class="ident" id="4512786">expectSemi</span><span class="op" id="4512796">(</span><span class="op" id="4512797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512804">return</span>&nbsp;<span class="op" id="4512811">&amp;</span><span class="ident" id="4512812">ast</span><span class="op" id="4512815">.</span><span class="ident" id="4512816">IfStmt</span><span class="op" id="4512822">{</span><span class="ident" id="4512823">If</span><span class="op" id="4512825">:</span>&nbsp;<span class="ident" id="4512827">pos</span><span class="op" id="4512830">,</span>&nbsp;<span class="ident" id="4512832">Init</span><span class="op" id="4512836">:</span>&nbsp;<span class="ident" id="4512838">s</span><span class="op" id="4512839">,</span>&nbsp;<span class="ident" id="4512841">Cond</span><span class="op" id="4512845">:</span>&nbsp;<span class="ident" id="4512847">x</span><span class="op" id="4512848">,</span>&nbsp;<span class="ident" id="4512850">Body</span><span class="op" id="4512854">:</span>&nbsp;<span class="ident" id="4512856">body</span><span class="op" id="4512860">,</span>&nbsp;<span class="ident" id="4512862">Else</span><span class="op" id="4512866">:</span>&nbsp;<span class="ident" id="4512868">else_</span><span class="op" id="4512873">}</span><br>
<span class="lineno"></span><span class="op" id="4512875">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="4512878">func</span>&nbsp;<span class="op" id="4512883">(</span><span class="ident" id="4512884">p</span>&nbsp;<span class="op" id="4512886">*</span><span class="ident" id="4512887">parser</span><span class="op" id="4512893">)</span>&nbsp;<span class="ident" id="4512895">parseTypeList</span><span class="op" id="4512908">(</span><span class="op" id="4512909">)</span>&nbsp;<span class="op" id="4512911">(</span><span class="ident" id="4512912">list</span>&nbsp;<span class="op" id="4512917">[</span><span class="op" id="4512918">]</span><span class="ident" id="4512919">ast</span><span class="op" id="4512922">.</span><span class="ident" id="4512923">Expr</span><span class="op" id="4512927">)</span>&nbsp;<span class="op" id="4512929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512932">if</span>&nbsp;<span class="ident" id="4512935">p</span><span class="op" id="4512936">.</span><span class="ident" id="4512937">trace</span>&nbsp;<span class="op" id="4512943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4512947">defer</span>&nbsp;<span class="ident" id="4512953">un</span><span class="op" id="4512955">(</span><span class="ident" id="4512956">trace</span><span class="op" id="4512961">(</span><span class="ident" id="4512962">p</span><span class="op" id="4512963">,</span>&nbsp;<span class="string" id="4512965">&#34;TypeList&#34;</span><span class="op" id="4512975">)</span><span class="op" id="4512976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4512979">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4512983">list</span>&nbsp;<span class="op" id="4512988">=</span>&nbsp;<span class="builtinfunc" id="4512990">append</span><span class="op" id="4512996">(</span><span class="ident" id="4512997">list</span><span class="op" id="4513001">,</span>&nbsp;<span class="ident" id="4513003">p</span><span class="op" id="4513004">.</span><span class="ident" id="4513005">parseType</span><span class="op" id="4513014">(</span><span class="op" id="4513015">)</span><span class="op" id="4513016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513019">for</span>&nbsp;<span class="ident" id="4513023">p</span><span class="op" id="4513024">.</span><span class="ident" id="4513025">tok</span>&nbsp;<span class="op" id="4513029">==</span>&nbsp;<span class="ident" id="4513032">token</span><span class="op" id="4513037">.</span><span class="ident" id="4513038">COMMA</span>&nbsp;<span class="op" id="4513044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513048">p</span><span class="op" id="4513049">.</span><span class="ident" id="4513050">next</span><span class="op" id="4513054">(</span><span class="op" id="4513055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513059">list</span>&nbsp;<span class="op" id="4513064">=</span>&nbsp;<span class="builtinfunc" id="4513066">append</span><span class="op" id="4513072">(</span><span class="ident" id="4513073">list</span><span class="op" id="4513077">,</span>&nbsp;<span class="ident" id="4513079">p</span><span class="op" id="4513080">.</span><span class="ident" id="4513081">parseType</span><span class="op" id="4513090">(</span><span class="op" id="4513091">)</span><span class="op" id="4513092">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513099">return</span><br>
<span class="lineno"></span><span class="op" id="4513106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="4513109">func</span>&nbsp;<span class="op" id="4513114">(</span><span class="ident" id="4513115">p</span>&nbsp;<span class="op" id="4513117">*</span><span class="ident" id="4513118">parser</span><span class="op" id="4513124">)</span>&nbsp;<span class="ident" id="4513126">parseCaseClause</span><span class="op" id="4513141">(</span><span class="ident" id="4513142">typeSwitch</span>&nbsp;<span class="builtintype" id="4513153">bool</span><span class="op" id="4513157">)</span>&nbsp;<span class="op" id="4513159">*</span><span class="ident" id="4513160">ast</span><span class="op" id="4513163">.</span><span class="ident" id="4513164">CaseClause</span>&nbsp;<span class="op" id="4513175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513178">if</span>&nbsp;<span class="ident" id="4513181">p</span><span class="op" id="4513182">.</span><span class="ident" id="4513183">trace</span>&nbsp;<span class="op" id="4513189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513193">defer</span>&nbsp;<span class="ident" id="4513199">un</span><span class="op" id="4513201">(</span><span class="ident" id="4513202">trace</span><span class="op" id="4513207">(</span><span class="ident" id="4513208">p</span><span class="op" id="4513209">,</span>&nbsp;<span class="string" id="4513211">&#34;CaseClause&#34;</span><span class="op" id="4513223">)</span><span class="op" id="4513224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513231">pos</span>&nbsp;<span class="op" id="4513235">:=</span>&nbsp;<span class="ident" id="4513238">p</span><span class="op" id="4513239">.</span><span class="ident" id="4513240">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513245">var</span>&nbsp;<span class="ident" id="4513249">list</span>&nbsp;<span class="op" id="4513254">[</span><span class="op" id="4513255">]</span><span class="ident" id="4513256">ast</span><span class="op" id="4513259">.</span><span class="ident" id="4513260">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513266">if</span>&nbsp;<span class="ident" id="4513269">p</span><span class="op" id="4513270">.</span><span class="ident" id="4513271">tok</span>&nbsp;<span class="op" id="4513275">==</span>&nbsp;<span class="ident" id="4513278">token</span><span class="op" id="4513283">.</span><span class="ident" id="4513284">CASE</span>&nbsp;<span class="op" id="4513289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513293">p</span><span class="op" id="4513294">.</span><span class="ident" id="4513295">next</span><span class="op" id="4513299">(</span><span class="op" id="4513300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513304">if</span>&nbsp;<span class="ident" id="4513307">typeSwitch</span>&nbsp;<span class="op" id="4513318">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513323">list</span>&nbsp;<span class="op" id="4513328">=</span>&nbsp;<span class="ident" id="4513330">p</span><span class="op" id="4513331">.</span><span class="ident" id="4513332">parseTypeList</span><span class="op" id="4513345">(</span><span class="op" id="4513346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513350">}</span>&nbsp;<span class="keyword" id="4513352">else</span>&nbsp;<span class="op" id="4513357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513362">list</span>&nbsp;<span class="op" id="4513367">=</span>&nbsp;<span class="ident" id="4513369">p</span><span class="op" id="4513370">.</span><span class="ident" id="4513371">parseRhsList</span><span class="op" id="4513383">(</span><span class="op" id="4513384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513391">}</span>&nbsp;<span class="keyword" id="4513393">else</span>&nbsp;<span class="op" id="4513398">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513402">p</span><span class="op" id="4513403">.</span><span class="ident" id="4513404">expect</span><span class="op" id="4513410">(</span><span class="ident" id="4513411">token</span><span class="op" id="4513416">.</span><span class="ident" id="4513417">DEFAULT</span><span class="op" id="4513424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513431">colon</span>&nbsp;<span class="op" id="4513437">:=</span>&nbsp;<span class="ident" id="4513440">p</span><span class="op" id="4513441">.</span><span class="ident" id="4513442">expect</span><span class="op" id="4513448">(</span><span class="ident" id="4513449">token</span><span class="op" id="4513454">.</span><span class="ident" id="4513455">COLON</span><span class="op" id="4513460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513463">p</span><span class="op" id="4513464">.</span><span class="ident" id="4513465">openScope</span><span class="op" id="4513474">(</span><span class="op" id="4513475">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513478">body</span>&nbsp;<span class="op" id="4513483">:=</span>&nbsp;<span class="ident" id="4513486">p</span><span class="op" id="4513487">.</span><span class="ident" id="4513488">parseStmtList</span><span class="op" id="4513501">(</span><span class="op" id="4513502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513505">p</span><span class="op" id="4513506">.</span><span class="ident" id="4513507">closeScope</span><span class="op" id="4513517">(</span><span class="op" id="4513518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513522">return</span>&nbsp;<span class="op" id="4513529">&amp;</span><span class="ident" id="4513530">ast</span><span class="op" id="4513533">.</span><span class="ident" id="4513534">CaseClause</span><span class="op" id="4513544">{</span><span class="ident" id="4513545">Case</span><span class="op" id="4513549">:</span>&nbsp;<span class="ident" id="4513551">pos</span><span class="op" id="4513554">,</span>&nbsp;<span class="ident" id="4513556">List</span><span class="op" id="4513560">:</span>&nbsp;<span class="ident" id="4513562">list</span><span class="op" id="4513566">,</span>&nbsp;<span class="ident" id="4513568">Colon</span><span class="op" id="4513573">:</span>&nbsp;<span class="ident" id="4513575">colon</span><span class="op" id="4513580">,</span>&nbsp;<span class="ident" id="4513582">Body</span><span class="op" id="4513586">:</span>&nbsp;<span class="ident" id="4513588">body</span><span class="op" id="4513592">}</span><br>
<span class="lineno"></span><span class="op" id="4513594">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="4513597">func</span>&nbsp;<span class="ident" id="4513602">isTypeSwitchAssert</span><span class="op" id="4513620">(</span><span class="ident" id="4513621">x</span>&nbsp;<span class="ident" id="4513623">ast</span><span class="op" id="4513626">.</span><span class="ident" id="4513627">Expr</span><span class="op" id="4513631">)</span>&nbsp;<span class="builtintype" id="4513633">bool</span>&nbsp;<span class="op" id="4513638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4513641">a</span><span class="op" id="4513642">,</span>&nbsp;<span class="ident" id="4513644">ok</span>&nbsp;<span class="op" id="4513647">:=</span>&nbsp;<span class="ident" id="4513650">x</span><span class="op" id="4513651">.</span><span class="op" id="4513652">(</span><span class="op" id="4513653">*</span><span class="ident" id="4513654">ast</span><span class="op" id="4513657">.</span><span class="ident" id="4513658">TypeAssertExpr</span><span class="op" id="4513672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513675">return</span>&nbsp;<span class="ident" id="4513682">ok</span>&nbsp;<span class="op" id="4513685">&amp;&amp;</span>&nbsp;<span class="ident" id="4513688">a</span><span class="op" id="4513689">.</span><span class="ident" id="4513690">Type</span>&nbsp;<span class="op" id="4513695">==</span>&nbsp;<span class="ident" id="4513698">nil</span><br>
<span class="lineno"></span><span class="op" id="4513702">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="4513705">func</span>&nbsp;<span class="ident" id="4513710">isTypeSwitchGuard</span><span class="op" id="4513727">(</span><span class="ident" id="4513728">s</span>&nbsp;<span class="ident" id="4513730">ast</span><span class="op" id="4513733">.</span><span class="ident" id="4513734">Stmt</span><span class="op" id="4513738">)</span>&nbsp;<span class="builtintype" id="4513740">bool</span>&nbsp;<span class="op" id="4513745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513748">switch</span>&nbsp;<span class="ident" id="4513755">t</span>&nbsp;<span class="op" id="4513757">:=</span>&nbsp;<span class="ident" id="4513760">s</span><span class="op" id="4513761">.</span><span class="op" id="4513762">(</span><span class="keyword" id="4513763">type</span><span class="op" id="4513767">)</span>&nbsp;<span class="op" id="4513769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513772">case</span>&nbsp;<span class="op" id="4513777">*</span><span class="ident" id="4513778">ast</span><span class="op" id="4513781">.</span><span class="ident" id="4513782">ExprStmt</span><span class="op" id="4513790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4513794">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513807">return</span>&nbsp;<span class="ident" id="4513814">isTypeSwitchAssert</span><span class="op" id="4513832">(</span><span class="ident" id="4513833">t</span><span class="op" id="4513834">.</span><span class="ident" id="4513835">X</span><span class="op" id="4513836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513839">case</span>&nbsp;<span class="op" id="4513844">*</span><span class="ident" id="4513845">ast</span><span class="op" id="4513848">.</span><span class="ident" id="4513849">AssignStmt</span><span class="op" id="4513859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4513863">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513881">return</span>&nbsp;<span class="builtinfunc" id="4513888">len</span><span class="op" id="4513891">(</span><span class="ident" id="4513892">t</span><span class="op" id="4513893">.</span><span class="ident" id="4513894">Lhs</span><span class="op" id="4513897">)</span>&nbsp;<span class="op" id="4513899">==</span>&nbsp;<span class="num" id="4513902">1</span>&nbsp;<span class="op" id="4513904">&amp;&amp;</span>&nbsp;<span class="ident" id="4513907">t</span><span class="op" id="4513908">.</span><span class="ident" id="4513909">Tok</span>&nbsp;<span class="op" id="4513913">==</span>&nbsp;<span class="ident" id="4513916">token</span><span class="op" id="4513921">.</span><span class="ident" id="4513922">DEFINE</span>&nbsp;<span class="op" id="4513929">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4513932">len</span><span class="op" id="4513935">(</span><span class="ident" id="4513936">t</span><span class="op" id="4513937">.</span><span class="ident" id="4513938">Rhs</span><span class="op" id="4513941">)</span>&nbsp;<span class="op" id="4513943">==</span>&nbsp;<span class="num" id="4513946">1</span>&nbsp;<span class="op" id="4513948">&amp;&amp;</span>&nbsp;<span class="ident" id="4513951">isTypeSwitchAssert</span><span class="op" id="4513969">(</span><span class="ident" id="4513970">t</span><span class="op" id="4513971">.</span><span class="ident" id="4513972">Rhs</span><span class="op" id="4513975">[</span><span class="num" id="4513976">0</span><span class="op" id="4513977">]</span><span class="op" id="4513978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4513981">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4513984">return</span>&nbsp;<span class="builtintype" id="4513991">false</span><br>
<span class="lineno"></span><span class="op" id="4513997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4514000">func</span>&nbsp;<span class="op" id="4514005">(</span><span class="ident" id="4514006">p</span>&nbsp;<span class="op" id="4514008">*</span><span class="ident" id="4514009">parser</span><span class="op" id="4514015">)</span>&nbsp;<span class="ident" id="4514017">parseSwitchStmt</span><span class="op" id="4514032">(</span><span class="op" id="4514033">)</span>&nbsp;<span class="ident" id="4514035">ast</span><span class="op" id="4514038">.</span><span class="ident" id="4514039">Stmt</span>&nbsp;<span class="op" id="4514044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514047">if</span>&nbsp;<span class="ident" id="4514050">p</span><span class="op" id="4514051">.</span><span class="ident" id="4514052">trace</span>&nbsp;<span class="op" id="4514058">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514062">defer</span>&nbsp;<span class="ident" id="4514068">un</span><span class="op" id="4514070">(</span><span class="ident" id="4514071">trace</span><span class="op" id="4514076">(</span><span class="ident" id="4514077">p</span><span class="op" id="4514078">,</span>&nbsp;<span class="string" id="4514080">&#34;SwitchStmt&#34;</span><span class="op" id="4514092">)</span><span class="op" id="4514093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4514096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514100">pos</span>&nbsp;<span class="op" id="4514104">:=</span>&nbsp;<span class="ident" id="4514107">p</span><span class="op" id="4514108">.</span><span class="ident" id="4514109">expect</span><span class="op" id="4514115">(</span><span class="ident" id="4514116">token</span><span class="op" id="4514121">.</span><span class="ident" id="4514122">SWITCH</span><span class="op" id="4514128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514131">p</span><span class="op" id="4514132">.</span><span class="ident" id="4514133">openScope</span><span class="op" id="4514142">(</span><span class="op" id="4514143">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514146">defer</span>&nbsp;<span class="ident" id="4514152">p</span><span class="op" id="4514153">.</span><span class="ident" id="4514154">closeScope</span><span class="op" id="4514164">(</span><span class="op" id="4514165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514169">var</span>&nbsp;<span class="ident" id="4514173">s1</span><span class="op" id="4514175">,</span>&nbsp;<span class="ident" id="4514177">s2</span>&nbsp;<span class="ident" id="4514180">ast</span><span class="op" id="4514183">.</span><span class="ident" id="4514184">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514190">if</span>&nbsp;<span class="ident" id="4514193">p</span><span class="op" id="4514194">.</span><span class="ident" id="4514195">tok</span>&nbsp;<span class="op" id="4514199">!=</span>&nbsp;<span class="ident" id="4514202">token</span><span class="op" id="4514207">.</span><span class="ident" id="4514208">LBRACE</span>&nbsp;<span class="op" id="4514215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514219">prevLev</span>&nbsp;<span class="op" id="4514227">:=</span>&nbsp;<span class="ident" id="4514230">p</span><span class="op" id="4514231">.</span><span class="ident" id="4514232">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514242">p</span><span class="op" id="4514243">.</span><span class="ident" id="4514244">exprLev</span>&nbsp;<span class="op" id="4514252">=</span>&nbsp;<span class="op" id="4514254">-</span><span class="num" id="4514255">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514259">if</span>&nbsp;<span class="ident" id="4514262">p</span><span class="op" id="4514263">.</span><span class="ident" id="4514264">tok</span>&nbsp;<span class="op" id="4514268">!=</span>&nbsp;<span class="ident" id="4514271">token</span><span class="op" id="4514276">.</span><span class="ident" id="4514277">SEMICOLON</span>&nbsp;<span class="op" id="4514287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514292">s2</span><span class="op" id="4514294">,</span>&nbsp;<span class="ident" id="4514296">_</span>&nbsp;<span class="op" id="4514298">=</span>&nbsp;<span class="ident" id="4514300">p</span><span class="op" id="4514301">.</span><span class="ident" id="4514302">parseSimpleStmt</span><span class="op" id="4514317">(</span><span class="ident" id="4514318">basic</span><span class="op" id="4514323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4514327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514331">if</span>&nbsp;<span class="ident" id="4514334">p</span><span class="op" id="4514335">.</span><span class="ident" id="4514336">tok</span>&nbsp;<span class="op" id="4514340">==</span>&nbsp;<span class="ident" id="4514343">token</span><span class="op" id="4514348">.</span><span class="ident" id="4514349">SEMICOLON</span>&nbsp;<span class="op" id="4514359">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514364">p</span><span class="op" id="4514365">.</span><span class="ident" id="4514366">next</span><span class="op" id="4514370">(</span><span class="op" id="4514371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514376">s1</span>&nbsp;<span class="op" id="4514379">=</span>&nbsp;<span class="ident" id="4514381">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514387">s2</span>&nbsp;<span class="op" id="4514390">=</span>&nbsp;<span class="ident" id="4514392">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514399">if</span>&nbsp;<span class="ident" id="4514402">p</span><span class="op" id="4514403">.</span><span class="ident" id="4514404">tok</span>&nbsp;<span class="op" id="4514408">!=</span>&nbsp;<span class="ident" id="4514411">token</span><span class="op" id="4514416">.</span><span class="ident" id="4514417">LBRACE</span>&nbsp;<span class="op" id="4514424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514430">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514490">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514549">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514609">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514616">//&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514657">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514664">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514718">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514778">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514833">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514840">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4514905">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4514969">p</span><span class="op" id="4514970">.</span><span class="ident" id="4514971">openScope</span><span class="op" id="4514980">(</span><span class="op" id="4514981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4514987">defer</span>&nbsp;<span class="ident" id="4514993">p</span><span class="op" id="4514994">.</span><span class="ident" id="4514995">closeScope</span><span class="op" id="4515005">(</span><span class="op" id="4515006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515012">s2</span><span class="op" id="4515014">,</span>&nbsp;<span class="ident" id="4515016">_</span>&nbsp;<span class="op" id="4515018">=</span>&nbsp;<span class="ident" id="4515020">p</span><span class="op" id="4515021">.</span><span class="ident" id="4515022">parseSimpleStmt</span><span class="op" id="4515037">(</span><span class="ident" id="4515038">basic</span><span class="op" id="4515043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515048">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515056">p</span><span class="op" id="4515057">.</span><span class="ident" id="4515058">exprLev</span>&nbsp;<span class="op" id="4515066">=</span>&nbsp;<span class="ident" id="4515068">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515081">typeSwitch</span>&nbsp;<span class="op" id="4515092">:=</span>&nbsp;<span class="ident" id="4515095">isTypeSwitchGuard</span><span class="op" id="4515112">(</span><span class="ident" id="4515113">s2</span><span class="op" id="4515115">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515118">lbrace</span>&nbsp;<span class="op" id="4515125">:=</span>&nbsp;<span class="ident" id="4515128">p</span><span class="op" id="4515129">.</span><span class="ident" id="4515130">expect</span><span class="op" id="4515136">(</span><span class="ident" id="4515137">token</span><span class="op" id="4515142">.</span><span class="ident" id="4515143">LBRACE</span><span class="op" id="4515149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515152">var</span>&nbsp;<span class="ident" id="4515156">list</span>&nbsp;<span class="op" id="4515161">[</span><span class="op" id="4515162">]</span><span class="ident" id="4515163">ast</span><span class="op" id="4515166">.</span><span class="ident" id="4515167">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515173">for</span>&nbsp;<span class="ident" id="4515177">p</span><span class="op" id="4515178">.</span><span class="ident" id="4515179">tok</span>&nbsp;<span class="op" id="4515183">==</span>&nbsp;<span class="ident" id="4515186">token</span><span class="op" id="4515191">.</span><span class="ident" id="4515192">CASE</span>&nbsp;<span class="op" id="4515197">||</span>&nbsp;<span class="ident" id="4515200">p</span><span class="op" id="4515201">.</span><span class="ident" id="4515202">tok</span>&nbsp;<span class="op" id="4515206">==</span>&nbsp;<span class="ident" id="4515209">token</span><span class="op" id="4515214">.</span><span class="ident" id="4515215">DEFAULT</span>&nbsp;<span class="op" id="4515223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515227">list</span>&nbsp;<span class="op" id="4515232">=</span>&nbsp;<span class="builtinfunc" id="4515234">append</span><span class="op" id="4515240">(</span><span class="ident" id="4515241">list</span><span class="op" id="4515245">,</span>&nbsp;<span class="ident" id="4515247">p</span><span class="op" id="4515248">.</span><span class="ident" id="4515249">parseCaseClause</span><span class="op" id="4515264">(</span><span class="ident" id="4515265">typeSwitch</span><span class="op" id="4515275">)</span><span class="op" id="4515276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515279">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515282">rbrace</span>&nbsp;<span class="op" id="4515289">:=</span>&nbsp;<span class="ident" id="4515292">p</span><span class="op" id="4515293">.</span><span class="ident" id="4515294">expect</span><span class="op" id="4515300">(</span><span class="ident" id="4515301">token</span><span class="op" id="4515306">.</span><span class="ident" id="4515307">RBRACE</span><span class="op" id="4515313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515316">p</span><span class="op" id="4515317">.</span><span class="ident" id="4515318">expectSemi</span><span class="op" id="4515328">(</span><span class="op" id="4515329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515332">body</span>&nbsp;<span class="op" id="4515337">:=</span>&nbsp;<span class="op" id="4515340">&amp;</span><span class="ident" id="4515341">ast</span><span class="op" id="4515344">.</span><span class="ident" id="4515345">BlockStmt</span><span class="op" id="4515354">{</span><span class="ident" id="4515355">Lbrace</span><span class="op" id="4515361">:</span>&nbsp;<span class="ident" id="4515363">lbrace</span><span class="op" id="4515369">,</span>&nbsp;<span class="ident" id="4515371">List</span><span class="op" id="4515375">:</span>&nbsp;<span class="ident" id="4515377">list</span><span class="op" id="4515381">,</span>&nbsp;<span class="ident" id="4515383">Rbrace</span><span class="op" id="4515389">:</span>&nbsp;<span class="ident" id="4515391">rbrace</span><span class="op" id="4515397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515401">if</span>&nbsp;<span class="ident" id="4515404">typeSwitch</span>&nbsp;<span class="op" id="4515415">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515419">return</span>&nbsp;<span class="op" id="4515426">&amp;</span><span class="ident" id="4515427">ast</span><span class="op" id="4515430">.</span><span class="ident" id="4515431">TypeSwitchStmt</span><span class="op" id="4515445">{</span><span class="ident" id="4515446">Switch</span><span class="op" id="4515452">:</span>&nbsp;<span class="ident" id="4515454">pos</span><span class="op" id="4515457">,</span>&nbsp;<span class="ident" id="4515459">Init</span><span class="op" id="4515463">:</span>&nbsp;<span class="ident" id="4515465">s1</span><span class="op" id="4515467">,</span>&nbsp;<span class="ident" id="4515469">Assign</span><span class="op" id="4515475">:</span>&nbsp;<span class="ident" id="4515477">s2</span><span class="op" id="4515479">,</span>&nbsp;<span class="ident" id="4515481">Body</span><span class="op" id="4515485">:</span>&nbsp;<span class="ident" id="4515487">body</span><span class="op" id="4515491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515498">return</span>&nbsp;<span class="op" id="4515505">&amp;</span><span class="ident" id="4515506">ast</span><span class="op" id="4515509">.</span><span class="ident" id="4515510">SwitchStmt</span><span class="op" id="4515520">{</span><span class="ident" id="4515521">Switch</span><span class="op" id="4515527">:</span>&nbsp;<span class="ident" id="4515529">pos</span><span class="op" id="4515532">,</span>&nbsp;<span class="ident" id="4515534">Init</span><span class="op" id="4515538">:</span>&nbsp;<span class="ident" id="4515540">s1</span><span class="op" id="4515542">,</span>&nbsp;<span class="ident" id="4515544">Tag</span><span class="op" id="4515547">:</span>&nbsp;<span class="ident" id="4515549">p</span><span class="op" id="4515550">.</span><span class="ident" id="4515551">makeExpr</span><span class="op" id="4515559">(</span><span class="ident" id="4515560">s2</span><span class="op" id="4515562">,</span>&nbsp;<span class="string" id="4515564">&#34;switch&nbsp;expression&#34;</span><span class="op" id="4515583">)</span><span class="op" id="4515584">,</span>&nbsp;<span class="ident" id="4515586">Body</span><span class="op" id="4515590">:</span>&nbsp;<span class="ident" id="4515592">body</span><span class="op" id="4515596">}</span><br>
<span class="lineno"></span><span class="op" id="4515598">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="4515601">func</span>&nbsp;<span class="op" id="4515606">(</span><span class="ident" id="4515607">p</span>&nbsp;<span class="op" id="4515609">*</span><span class="ident" id="4515610">parser</span><span class="op" id="4515616">)</span>&nbsp;<span class="ident" id="4515618">parseCommClause</span><span class="op" id="4515633">(</span><span class="op" id="4515634">)</span>&nbsp;<span class="op" id="4515636">*</span><span class="ident" id="4515637">ast</span><span class="op" id="4515640">.</span><span class="ident" id="4515641">CommClause</span>&nbsp;<span class="op" id="4515652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515655">if</span>&nbsp;<span class="ident" id="4515658">p</span><span class="op" id="4515659">.</span><span class="ident" id="4515660">trace</span>&nbsp;<span class="op" id="4515666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515670">defer</span>&nbsp;<span class="ident" id="4515676">un</span><span class="op" id="4515678">(</span><span class="ident" id="4515679">trace</span><span class="op" id="4515684">(</span><span class="ident" id="4515685">p</span><span class="op" id="4515686">,</span>&nbsp;<span class="string" id="4515688">&#34;CommClause&#34;</span><span class="op" id="4515700">)</span><span class="op" id="4515701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515704">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515708">p</span><span class="op" id="4515709">.</span><span class="ident" id="4515710">openScope</span><span class="op" id="4515719">(</span><span class="op" id="4515720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515723">pos</span>&nbsp;<span class="op" id="4515727">:=</span>&nbsp;<span class="ident" id="4515730">p</span><span class="op" id="4515731">.</span><span class="ident" id="4515732">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515737">var</span>&nbsp;<span class="ident" id="4515741">comm</span>&nbsp;<span class="ident" id="4515746">ast</span><span class="op" id="4515749">.</span><span class="ident" id="4515750">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515756">if</span>&nbsp;<span class="ident" id="4515759">p</span><span class="op" id="4515760">.</span><span class="ident" id="4515761">tok</span>&nbsp;<span class="op" id="4515765">==</span>&nbsp;<span class="ident" id="4515768">token</span><span class="op" id="4515773">.</span><span class="ident" id="4515774">CASE</span>&nbsp;<span class="op" id="4515779">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515783">p</span><span class="op" id="4515784">.</span><span class="ident" id="4515785">next</span><span class="op" id="4515789">(</span><span class="op" id="4515790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515794">lhs</span>&nbsp;<span class="op" id="4515798">:=</span>&nbsp;<span class="ident" id="4515801">p</span><span class="op" id="4515802">.</span><span class="ident" id="4515803">parseLhsList</span><span class="op" id="4515815">(</span><span class="op" id="4515816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515820">if</span>&nbsp;<span class="ident" id="4515823">p</span><span class="op" id="4515824">.</span><span class="ident" id="4515825">tok</span>&nbsp;<span class="op" id="4515829">==</span>&nbsp;<span class="ident" id="4515832">token</span><span class="op" id="4515837">.</span><span class="ident" id="4515838">ARROW</span>&nbsp;<span class="op" id="4515844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4515849">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4515864">if</span>&nbsp;<span class="builtinfunc" id="4515867">len</span><span class="op" id="4515870">(</span><span class="ident" id="4515871">lhs</span><span class="op" id="4515874">)</span>&nbsp;<span class="op" id="4515876">&gt;</span>&nbsp;<span class="num" id="4515878">1</span>&nbsp;<span class="op" id="4515880">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515886">p</span><span class="op" id="4515887">.</span><span class="ident" id="4515888">errorExpected</span><span class="op" id="4515901">(</span><span class="ident" id="4515902">lhs</span><span class="op" id="4515905">[</span><span class="num" id="4515906">0</span><span class="op" id="4515907">]</span><span class="op" id="4515908">.</span><span class="ident" id="4515909">Pos</span><span class="op" id="4515912">(</span><span class="op" id="4515913">)</span><span class="op" id="4515914">,</span>&nbsp;<span class="string" id="4515916">&#34;1&nbsp;expression&#34;</span><span class="op" id="4515930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4515936">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4515973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515978">arrow</span>&nbsp;<span class="op" id="4515984">:=</span>&nbsp;<span class="ident" id="4515987">p</span><span class="op" id="4515988">.</span><span class="ident" id="4515989">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4515996">p</span><span class="op" id="4515997">.</span><span class="ident" id="4515998">next</span><span class="op" id="4516002">(</span><span class="op" id="4516003">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516008">rhs</span>&nbsp;<span class="op" id="4516012">:=</span>&nbsp;<span class="ident" id="4516015">p</span><span class="op" id="4516016">.</span><span class="ident" id="4516017">parseRhs</span><span class="op" id="4516025">(</span><span class="op" id="4516026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516031">comm</span>&nbsp;<span class="op" id="4516036">=</span>&nbsp;<span class="op" id="4516038">&amp;</span><span class="ident" id="4516039">ast</span><span class="op" id="4516042">.</span><span class="ident" id="4516043">SendStmt</span><span class="op" id="4516051">{</span><span class="ident" id="4516052">Chan</span><span class="op" id="4516056">:</span>&nbsp;<span class="ident" id="4516058">lhs</span><span class="op" id="4516061">[</span><span class="num" id="4516062">0</span><span class="op" id="4516063">]</span><span class="op" id="4516064">,</span>&nbsp;<span class="ident" id="4516066">Arrow</span><span class="op" id="4516071">:</span>&nbsp;<span class="ident" id="4516073">arrow</span><span class="op" id="4516078">,</span>&nbsp;<span class="ident" id="4516080">Value</span><span class="op" id="4516085">:</span>&nbsp;<span class="ident" id="4516087">rhs</span><span class="op" id="4516090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516094">}</span>&nbsp;<span class="keyword" id="4516096">else</span>&nbsp;<span class="op" id="4516101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4516106">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4516121">if</span>&nbsp;<span class="ident" id="4516124">tok</span>&nbsp;<span class="op" id="4516128">:=</span>&nbsp;<span class="ident" id="4516131">p</span><span class="op" id="4516132">.</span><span class="ident" id="4516133">tok</span><span class="op" id="4516136">;</span>&nbsp;<span class="ident" id="4516138">tok</span>&nbsp;<span class="op" id="4516142">==</span>&nbsp;<span class="ident" id="4516145">token</span><span class="op" id="4516150">.</span><span class="ident" id="4516151">ASSIGN</span>&nbsp;<span class="op" id="4516158">||</span>&nbsp;<span class="ident" id="4516161">tok</span>&nbsp;<span class="op" id="4516165">==</span>&nbsp;<span class="ident" id="4516168">token</span><span class="op" id="4516173">.</span><span class="ident" id="4516174">DEFINE</span>&nbsp;<span class="op" id="4516181">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4516187">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4516219">if</span>&nbsp;<span class="builtinfunc" id="4516222">len</span><span class="op" id="4516225">(</span><span class="ident" id="4516226">lhs</span><span class="op" id="4516229">)</span>&nbsp;<span class="op" id="4516231">&gt;</span>&nbsp;<span class="num" id="4516233">2</span>&nbsp;<span class="op" id="4516235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516242">p</span><span class="op" id="4516243">.</span><span class="ident" id="4516244">errorExpected</span><span class="op" id="4516257">(</span><span class="ident" id="4516258">lhs</span><span class="op" id="4516261">[</span><span class="num" id="4516262">0</span><span class="op" id="4516263">]</span><span class="op" id="4516264">.</span><span class="ident" id="4516265">Pos</span><span class="op" id="4516268">(</span><span class="op" id="4516269">)</span><span class="op" id="4516270">,</span>&nbsp;<span class="string" id="4516272">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4516292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4516299">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516343">lhs</span>&nbsp;<span class="op" id="4516347">=</span>&nbsp;<span class="ident" id="4516349">lhs</span><span class="op" id="4516352">[</span><span class="num" id="4516353">0</span><span class="op" id="4516354">:</span><span class="num" id="4516355">2</span><span class="op" id="4516356">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516368">pos</span>&nbsp;<span class="op" id="4516372">:=</span>&nbsp;<span class="ident" id="4516375">p</span><span class="op" id="4516376">.</span><span class="ident" id="4516377">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516385">p</span><span class="op" id="4516386">.</span><span class="ident" id="4516387">next</span><span class="op" id="4516391">(</span><span class="op" id="4516392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516398">rhs</span>&nbsp;<span class="op" id="4516402">:=</span>&nbsp;<span class="ident" id="4516405">p</span><span class="op" id="4516406">.</span><span class="ident" id="4516407">parseRhs</span><span class="op" id="4516415">(</span><span class="op" id="4516416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516422">as</span>&nbsp;<span class="op" id="4516425">:=</span>&nbsp;<span class="op" id="4516428">&amp;</span><span class="ident" id="4516429">ast</span><span class="op" id="4516432">.</span><span class="ident" id="4516433">AssignStmt</span><span class="op" id="4516443">{</span><span class="ident" id="4516444">Lhs</span><span class="op" id="4516447">:</span>&nbsp;<span class="ident" id="4516449">lhs</span><span class="op" id="4516452">,</span>&nbsp;<span class="ident" id="4516454">TokPos</span><span class="op" id="4516460">:</span>&nbsp;<span class="ident" id="4516462">pos</span><span class="op" id="4516465">,</span>&nbsp;<span class="ident" id="4516467">Tok</span><span class="op" id="4516470">:</span>&nbsp;<span class="ident" id="4516472">tok</span><span class="op" id="4516475">,</span>&nbsp;<span class="ident" id="4516477">Rhs</span><span class="op" id="4516480">:</span>&nbsp;<span class="op" id="4516482">[</span><span class="op" id="4516483">]</span><span class="ident" id="4516484">ast</span><span class="op" id="4516487">.</span><span class="ident" id="4516488">Expr</span><span class="op" id="4516492">{</span><span class="ident" id="4516493">rhs</span><span class="op" id="4516496">}</span><span class="op" id="4516497">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4516503">if</span>&nbsp;<span class="ident" id="4516506">tok</span>&nbsp;<span class="op" id="4516510">==</span>&nbsp;<span class="ident" id="4516513">token</span><span class="op" id="4516518">.</span><span class="ident" id="4516519">DEFINE</span>&nbsp;<span class="op" id="4516526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516533">p</span><span class="op" id="4516534">.</span><span class="ident" id="4516535">shortVarDecl</span><span class="op" id="4516547">(</span><span class="ident" id="4516548">as</span><span class="op" id="4516550">,</span>&nbsp;<span class="ident" id="4516552">lhs</span><span class="op" id="4516555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516567">comm</span>&nbsp;<span class="op" id="4516572">=</span>&nbsp;<span class="ident" id="4516574">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516580">}</span>&nbsp;<span class="keyword" id="4516582">else</span>&nbsp;<span class="op" id="4516587">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4516593">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4516637">if</span>&nbsp;<span class="builtinfunc" id="4516640">len</span><span class="op" id="4516643">(</span><span class="ident" id="4516644">lhs</span><span class="op" id="4516647">)</span>&nbsp;<span class="op" id="4516649">&gt;</span>&nbsp;<span class="num" id="4516651">1</span>&nbsp;<span class="op" id="4516653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516660">p</span><span class="op" id="4516661">.</span><span class="ident" id="4516662">errorExpected</span><span class="op" id="4516675">(</span><span class="ident" id="4516676">lhs</span><span class="op" id="4516679">[</span><span class="num" id="4516680">0</span><span class="op" id="4516681">]</span><span class="op" id="4516682">.</span><span class="ident" id="4516683">Pos</span><span class="op" id="4516686">(</span><span class="op" id="4516687">)</span><span class="op" id="4516688">,</span>&nbsp;<span class="string" id="4516690">&#34;1&nbsp;expression&#34;</span><span class="op" id="4516704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4516711">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516749">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516755">comm</span>&nbsp;<span class="op" id="4516760">=</span>&nbsp;<span class="op" id="4516762">&amp;</span><span class="ident" id="4516763">ast</span><span class="op" id="4516766">.</span><span class="ident" id="4516767">ExprStmt</span><span class="op" id="4516775">{</span><span class="ident" id="4516776">X</span><span class="op" id="4516777">:</span>&nbsp;<span class="ident" id="4516779">lhs</span><span class="op" id="4516782">[</span><span class="num" id="4516783">0</span><span class="op" id="4516784">]</span><span class="op" id="4516785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516797">}</span>&nbsp;<span class="keyword" id="4516799">else</span>&nbsp;<span class="op" id="4516804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516808">p</span><span class="op" id="4516809">.</span><span class="ident" id="4516810">expect</span><span class="op" id="4516816">(</span><span class="ident" id="4516817">token</span><span class="op" id="4516822">.</span><span class="ident" id="4516823">DEFAULT</span><span class="op" id="4516830">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4516833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516837">colon</span>&nbsp;<span class="op" id="4516843">:=</span>&nbsp;<span class="ident" id="4516846">p</span><span class="op" id="4516847">.</span><span class="ident" id="4516848">expect</span><span class="op" id="4516854">(</span><span class="ident" id="4516855">token</span><span class="op" id="4516860">.</span><span class="ident" id="4516861">COLON</span><span class="op" id="4516866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516869">body</span>&nbsp;<span class="op" id="4516874">:=</span>&nbsp;<span class="ident" id="4516877">p</span><span class="op" id="4516878">.</span><span class="ident" id="4516879">parseStmtList</span><span class="op" id="4516892">(</span><span class="op" id="4516893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4516896">p</span><span class="op" id="4516897">.</span><span class="ident" id="4516898">closeScope</span><span class="op" id="4516908">(</span><span class="op" id="4516909">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4516913">return</span>&nbsp;<span class="op" id="4516920">&amp;</span><span class="ident" id="4516921">ast</span><span class="op" id="4516924">.</span><span class="ident" id="4516925">CommClause</span><span class="op" id="4516935">{</span><span class="ident" id="4516936">Case</span><span class="op" id="4516940">:</span>&nbsp;<span class="ident" id="4516942">pos</span><span class="op" id="4516945">,</span>&nbsp;<span class="ident" id="4516947">Comm</span><span class="op" id="4516951">:</span>&nbsp;<span class="ident" id="4516953">comm</span><span class="op" id="4516957">,</span>&nbsp;<span class="ident" id="4516959">Colon</span><span class="op" id="4516964">:</span>&nbsp;<span class="ident" id="4516966">colon</span><span class="op" id="4516971">,</span>&nbsp;<span class="ident" id="4516973">Body</span><span class="op" id="4516977">:</span>&nbsp;<span class="ident" id="4516979">body</span><span class="op" id="4516983">}</span><br>
<span class="lineno"></span><span class="op" id="4516985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4516988">func</span>&nbsp;<span class="op" id="4516993">(</span><span class="ident" id="4516994">p</span>&nbsp;<span class="op" id="4516996">*</span><span class="ident" id="4516997">parser</span><span class="op" id="4517003">)</span>&nbsp;<span class="ident" id="4517005">parseSelectStmt</span><span class="op" id="4517020">(</span><span class="op" id="4517021">)</span>&nbsp;<span class="op" id="4517023">*</span><span class="ident" id="4517024">ast</span><span class="op" id="4517027">.</span><span class="ident" id="4517028">SelectStmt</span>&nbsp;<span class="op" id="4517039">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517042">if</span>&nbsp;<span class="ident" id="4517045">p</span><span class="op" id="4517046">.</span><span class="ident" id="4517047">trace</span>&nbsp;<span class="op" id="4517053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517057">defer</span>&nbsp;<span class="ident" id="4517063">un</span><span class="op" id="4517065">(</span><span class="ident" id="4517066">trace</span><span class="op" id="4517071">(</span><span class="ident" id="4517072">p</span><span class="op" id="4517073">,</span>&nbsp;<span class="string" id="4517075">&#34;SelectStmt&#34;</span><span class="op" id="4517087">)</span><span class="op" id="4517088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4517091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517095">pos</span>&nbsp;<span class="op" id="4517099">:=</span>&nbsp;<span class="ident" id="4517102">p</span><span class="op" id="4517103">.</span><span class="ident" id="4517104">expect</span><span class="op" id="4517110">(</span><span class="ident" id="4517111">token</span><span class="op" id="4517116">.</span><span class="ident" id="4517117">SELECT</span><span class="op" id="4517123">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517126">lbrace</span>&nbsp;<span class="op" id="4517133">:=</span>&nbsp;<span class="ident" id="4517136">p</span><span class="op" id="4517137">.</span><span class="ident" id="4517138">expect</span><span class="op" id="4517144">(</span><span class="ident" id="4517145">token</span><span class="op" id="4517150">.</span><span class="ident" id="4517151">LBRACE</span><span class="op" id="4517157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517160">var</span>&nbsp;<span class="ident" id="4517164">list</span>&nbsp;<span class="op" id="4517169">[</span><span class="op" id="4517170">]</span><span class="ident" id="4517171">ast</span><span class="op" id="4517174">.</span><span class="ident" id="4517175">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517181">for</span>&nbsp;<span class="ident" id="4517185">p</span><span class="op" id="4517186">.</span><span class="ident" id="4517187">tok</span>&nbsp;<span class="op" id="4517191">==</span>&nbsp;<span class="ident" id="4517194">token</span><span class="op" id="4517199">.</span><span class="ident" id="4517200">CASE</span>&nbsp;<span class="op" id="4517205">||</span>&nbsp;<span class="ident" id="4517208">p</span><span class="op" id="4517209">.</span><span class="ident" id="4517210">tok</span>&nbsp;<span class="op" id="4517214">==</span>&nbsp;<span class="ident" id="4517217">token</span><span class="op" id="4517222">.</span><span class="ident" id="4517223">DEFAULT</span>&nbsp;<span class="op" id="4517231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517235">list</span>&nbsp;<span class="op" id="4517240">=</span>&nbsp;<span class="builtinfunc" id="4517242">append</span><span class="op" id="4517248">(</span><span class="ident" id="4517249">list</span><span class="op" id="4517253">,</span>&nbsp;<span class="ident" id="4517255">p</span><span class="op" id="4517256">.</span><span class="ident" id="4517257">parseCommClause</span><span class="op" id="4517272">(</span><span class="op" id="4517273">)</span><span class="op" id="4517274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4517277">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517280">rbrace</span>&nbsp;<span class="op" id="4517287">:=</span>&nbsp;<span class="ident" id="4517290">p</span><span class="op" id="4517291">.</span><span class="ident" id="4517292">expect</span><span class="op" id="4517298">(</span><span class="ident" id="4517299">token</span><span class="op" id="4517304">.</span><span class="ident" id="4517305">RBRACE</span><span class="op" id="4517311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517314">p</span><span class="op" id="4517315">.</span><span class="ident" id="4517316">expectSemi</span><span class="op" id="4517326">(</span><span class="op" id="4517327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517330">body</span>&nbsp;<span class="op" id="4517335">:=</span>&nbsp;<span class="op" id="4517338">&amp;</span><span class="ident" id="4517339">ast</span><span class="op" id="4517342">.</span><span class="ident" id="4517343">BlockStmt</span><span class="op" id="4517352">{</span><span class="ident" id="4517353">Lbrace</span><span class="op" id="4517359">:</span>&nbsp;<span class="ident" id="4517361">lbrace</span><span class="op" id="4517367">,</span>&nbsp;<span class="ident" id="4517369">List</span><span class="op" id="4517373">:</span>&nbsp;<span class="ident" id="4517375">list</span><span class="op" id="4517379">,</span>&nbsp;<span class="ident" id="4517381">Rbrace</span><span class="op" id="4517387">:</span>&nbsp;<span class="ident" id="4517389">rbrace</span><span class="op" id="4517395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517399">return</span>&nbsp;<span class="op" id="4517406">&amp;</span><span class="ident" id="4517407">ast</span><span class="op" id="4517410">.</span><span class="ident" id="4517411">SelectStmt</span><span class="op" id="4517421">{</span><span class="ident" id="4517422">Select</span><span class="op" id="4517428">:</span>&nbsp;<span class="ident" id="4517430">pos</span><span class="op" id="4517433">,</span>&nbsp;<span class="ident" id="4517435">Body</span><span class="op" id="4517439">:</span>&nbsp;<span class="ident" id="4517441">body</span><span class="op" id="4517445">}</span><br>
<span class="lineno">2030</span><span class="op" id="4517447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4517450">func</span>&nbsp;<span class="op" id="4517455">(</span><span class="ident" id="4517456">p</span>&nbsp;<span class="op" id="4517458">*</span><span class="ident" id="4517459">parser</span><span class="op" id="4517465">)</span>&nbsp;<span class="ident" id="4517467">parseForStmt</span><span class="op" id="4517479">(</span><span class="op" id="4517480">)</span>&nbsp;<span class="ident" id="4517482">ast</span><span class="op" id="4517485">.</span><span class="ident" id="4517486">Stmt</span>&nbsp;<span class="op" id="4517491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517494">if</span>&nbsp;<span class="ident" id="4517497">p</span><span class="op" id="4517498">.</span><span class="ident" id="4517499">trace</span>&nbsp;<span class="op" id="4517505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517509">defer</span>&nbsp;<span class="ident" id="4517515">un</span><span class="op" id="4517517">(</span><span class="ident" id="4517518">trace</span><span class="op" id="4517523">(</span><span class="ident" id="4517524">p</span><span class="op" id="4517525">,</span>&nbsp;<span class="string" id="4517527">&#34;ForStmt&#34;</span><span class="op" id="4517536">)</span><span class="op" id="4517537">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4517540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517544">pos</span>&nbsp;<span class="op" id="4517548">:=</span>&nbsp;<span class="ident" id="4517551">p</span><span class="op" id="4517552">.</span><span class="ident" id="4517553">expect</span><span class="op" id="4517559">(</span><span class="ident" id="4517560">token</span><span class="op" id="4517565">.</span><span class="ident" id="4517566">FOR</span><span class="op" id="4517569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517572">p</span><span class="op" id="4517573">.</span><span class="ident" id="4517574">openScope</span><span class="op" id="4517583">(</span><span class="op" id="4517584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517587">defer</span>&nbsp;<span class="ident" id="4517593">p</span><span class="op" id="4517594">.</span><span class="ident" id="4517595">closeScope</span><span class="op" id="4517605">(</span><span class="op" id="4517606">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517610">var</span>&nbsp;<span class="ident" id="4517614">s1</span><span class="op" id="4517616">,</span>&nbsp;<span class="ident" id="4517618">s2</span><span class="op" id="4517620">,</span>&nbsp;<span class="ident" id="4517622">s3</span>&nbsp;<span class="ident" id="4517625">ast</span><span class="op" id="4517628">.</span><span class="ident" id="4517629">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517635">var</span>&nbsp;<span class="ident" id="4517639">isRange</span>&nbsp;<span class="builtintype" id="4517647">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517653">if</span>&nbsp;<span class="ident" id="4517656">p</span><span class="op" id="4517657">.</span><span class="ident" id="4517658">tok</span>&nbsp;<span class="op" id="4517662">!=</span>&nbsp;<span class="ident" id="4517665">token</span><span class="op" id="4517670">.</span><span class="ident" id="4517671">LBRACE</span>&nbsp;<span class="op" id="4517678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517682">prevLev</span>&nbsp;<span class="op" id="4517690">:=</span>&nbsp;<span class="ident" id="4517693">p</span><span class="op" id="4517694">.</span><span class="ident" id="4517695">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517705">p</span><span class="op" id="4517706">.</span><span class="ident" id="4517707">exprLev</span>&nbsp;<span class="op" id="4517715">=</span>&nbsp;<span class="op" id="4517717">-</span><span class="num" id="4517718">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517722">if</span>&nbsp;<span class="ident" id="4517725">p</span><span class="op" id="4517726">.</span><span class="ident" id="4517727">tok</span>&nbsp;<span class="op" id="4517731">!=</span>&nbsp;<span class="ident" id="4517734">token</span><span class="op" id="4517739">.</span><span class="ident" id="4517740">SEMICOLON</span>&nbsp;<span class="op" id="4517750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4517755">if</span>&nbsp;<span class="ident" id="4517758">p</span><span class="op" id="4517759">.</span><span class="ident" id="4517760">tok</span>&nbsp;<span class="op" id="4517764">==</span>&nbsp;<span class="ident" id="4517767">token</span><span class="op" id="4517772">.</span><span class="ident" id="4517773">RANGE</span>&nbsp;<span class="op" id="4517779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4517785">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517830">pos</span>&nbsp;<span class="op" id="4517834">:=</span>&nbsp;<span class="ident" id="4517837">p</span><span class="op" id="4517838">.</span><span class="ident" id="4517839">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517847">p</span><span class="op" id="4517848">.</span><span class="ident" id="4517849">next</span><span class="op" id="4517853">(</span><span class="op" id="4517854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517860">y</span>&nbsp;<span class="op" id="4517862">:=</span>&nbsp;<span class="op" id="4517865">[</span><span class="op" id="4517866">]</span><span class="ident" id="4517867">ast</span><span class="op" id="4517870">.</span><span class="ident" id="4517871">Expr</span><span class="op" id="4517875">{</span><span class="op" id="4517876">&amp;</span><span class="ident" id="4517877">ast</span><span class="op" id="4517880">.</span><span class="ident" id="4517881">UnaryExpr</span><span class="op" id="4517890">{</span><span class="ident" id="4517891">OpPos</span><span class="op" id="4517896">:</span>&nbsp;<span class="ident" id="4517898">pos</span><span class="op" id="4517901">,</span>&nbsp;<span class="ident" id="4517903">Op</span><span class="op" id="4517905">:</span>&nbsp;<span class="ident" id="4517907">token</span><span class="op" id="4517912">.</span><span class="ident" id="4517913">RANGE</span><span class="op" id="4517918">,</span>&nbsp;<span class="ident" id="4517920">X</span><span class="op" id="4517921">:</span>&nbsp;<span class="ident" id="4517923">p</span><span class="op" id="4517924">.</span><span class="ident" id="4517925">parseRhs</span><span class="op" id="4517933">(</span><span class="op" id="4517934">)</span><span class="op" id="4517935">}</span><span class="op" id="4517936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517942">s2</span>&nbsp;<span class="op" id="4517945">=</span>&nbsp;<span class="op" id="4517947">&amp;</span><span class="ident" id="4517948">ast</span><span class="op" id="4517951">.</span><span class="ident" id="4517952">AssignStmt</span><span class="op" id="4517962">{</span><span class="ident" id="4517963">Rhs</span><span class="op" id="4517966">:</span>&nbsp;<span class="ident" id="4517968">y</span><span class="op" id="4517969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4517975">isRange</span>&nbsp;<span class="op" id="4517983">=</span>&nbsp;<span class="builtintype" id="4517985">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4517993">}</span>&nbsp;<span class="keyword" id="4517995">else</span>&nbsp;<span class="op" id="4518000">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518006">s2</span><span class="op" id="4518008">,</span>&nbsp;<span class="ident" id="4518010">isRange</span>&nbsp;<span class="op" id="4518018">=</span>&nbsp;<span class="ident" id="4518020">p</span><span class="op" id="4518021">.</span><span class="ident" id="4518022">parseSimpleStmt</span><span class="op" id="4518037">(</span><span class="ident" id="4518038">rangeOk</span><span class="op" id="4518045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518058">if</span>&nbsp;<span class="op" id="4518061">!</span><span class="ident" id="4518062">isRange</span>&nbsp;<span class="op" id="4518070">&amp;&amp;</span>&nbsp;<span class="ident" id="4518073">p</span><span class="op" id="4518074">.</span><span class="ident" id="4518075">tok</span>&nbsp;<span class="op" id="4518079">==</span>&nbsp;<span class="ident" id="4518082">token</span><span class="op" id="4518087">.</span><span class="ident" id="4518088">SEMICOLON</span>&nbsp;<span class="op" id="4518098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518103">p</span><span class="op" id="4518104">.</span><span class="ident" id="4518105">next</span><span class="op" id="4518109">(</span><span class="op" id="4518110">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518115">s1</span>&nbsp;<span class="op" id="4518118">=</span>&nbsp;<span class="ident" id="4518120">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518126">s2</span>&nbsp;<span class="op" id="4518129">=</span>&nbsp;<span class="ident" id="4518131">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518138">if</span>&nbsp;<span class="ident" id="4518141">p</span><span class="op" id="4518142">.</span><span class="ident" id="4518143">tok</span>&nbsp;<span class="op" id="4518147">!=</span>&nbsp;<span class="ident" id="4518150">token</span><span class="op" id="4518155">.</span><span class="ident" id="4518156">SEMICOLON</span>&nbsp;<span class="op" id="4518166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518172">s2</span><span class="op" id="4518174">,</span>&nbsp;<span class="ident" id="4518176">_</span>&nbsp;<span class="op" id="4518178">=</span>&nbsp;<span class="ident" id="4518180">p</span><span class="op" id="4518181">.</span><span class="ident" id="4518182">parseSimpleStmt</span><span class="op" id="4518197">(</span><span class="ident" id="4518198">basic</span><span class="op" id="4518203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518208">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518213">p</span><span class="op" id="4518214">.</span><span class="ident" id="4518215">expectSemi</span><span class="op" id="4518225">(</span><span class="op" id="4518226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518231">if</span>&nbsp;<span class="ident" id="4518234">p</span><span class="op" id="4518235">.</span><span class="ident" id="4518236">tok</span>&nbsp;<span class="op" id="4518240">!=</span>&nbsp;<span class="ident" id="4518243">token</span><span class="op" id="4518248">.</span><span class="ident" id="4518249">LBRACE</span>&nbsp;<span class="op" id="4518256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518262">s3</span><span class="op" id="4518264">,</span>&nbsp;<span class="ident" id="4518266">_</span>&nbsp;<span class="op" id="4518268">=</span>&nbsp;<span class="ident" id="4518270">p</span><span class="op" id="4518271">.</span><span class="ident" id="4518272">parseSimpleStmt</span><span class="op" id="4518287">(</span><span class="ident" id="4518288">basic</span><span class="op" id="4518293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518302">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518306">p</span><span class="op" id="4518307">.</span><span class="ident" id="4518308">exprLev</span>&nbsp;<span class="op" id="4518316">=</span>&nbsp;<span class="ident" id="4518318">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518331">body</span>&nbsp;<span class="op" id="4518336">:=</span>&nbsp;<span class="ident" id="4518339">p</span><span class="op" id="4518340">.</span><span class="ident" id="4518341">parseBlockStmt</span><span class="op" id="4518355">(</span><span class="op" id="4518356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518359">p</span><span class="op" id="4518360">.</span><span class="ident" id="4518361">expectSemi</span><span class="op" id="4518371">(</span><span class="op" id="4518372">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518376">if</span>&nbsp;<span class="ident" id="4518379">isRange</span>&nbsp;<span class="op" id="4518387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518391">as</span>&nbsp;<span class="op" id="4518394">:=</span>&nbsp;<span class="ident" id="4518397">s2</span><span class="op" id="4518399">.</span><span class="op" id="4518400">(</span><span class="op" id="4518401">*</span><span class="ident" id="4518402">ast</span><span class="op" id="4518405">.</span><span class="ident" id="4518406">AssignStmt</span><span class="op" id="4518416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4518420">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518435">var</span>&nbsp;<span class="ident" id="4518439">key</span><span class="op" id="4518442">,</span>&nbsp;<span class="ident" id="4518444">value</span>&nbsp;<span class="ident" id="4518450">ast</span><span class="op" id="4518453">.</span><span class="ident" id="4518454">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518461">switch</span>&nbsp;<span class="builtinfunc" id="4518468">len</span><span class="op" id="4518471">(</span><span class="ident" id="4518472">as</span><span class="op" id="4518474">.</span><span class="ident" id="4518475">Lhs</span><span class="op" id="4518478">)</span>&nbsp;<span class="op" id="4518480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518484">case</span>&nbsp;<span class="num" id="4518489">0</span><span class="op" id="4518490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4518495">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518514">case</span>&nbsp;<span class="num" id="4518519">1</span><span class="op" id="4518520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518525">key</span>&nbsp;<span class="op" id="4518529">=</span>&nbsp;<span class="ident" id="4518531">as</span><span class="op" id="4518533">.</span><span class="ident" id="4518534">Lhs</span><span class="op" id="4518537">[</span><span class="num" id="4518538">0</span><span class="op" id="4518539">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518543">case</span>&nbsp;<span class="num" id="4518548">2</span><span class="op" id="4518549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518554">key</span><span class="op" id="4518557">,</span>&nbsp;<span class="ident" id="4518559">value</span>&nbsp;<span class="op" id="4518565">=</span>&nbsp;<span class="ident" id="4518567">as</span><span class="op" id="4518569">.</span><span class="ident" id="4518570">Lhs</span><span class="op" id="4518573">[</span><span class="num" id="4518574">0</span><span class="op" id="4518575">]</span><span class="op" id="4518576">,</span>&nbsp;<span class="ident" id="4518578">as</span><span class="op" id="4518580">.</span><span class="ident" id="4518581">Lhs</span><span class="op" id="4518584">[</span><span class="num" id="4518585">1</span><span class="op" id="4518586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518590">default</span><span class="op" id="4518597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518602">p</span><span class="op" id="4518603">.</span><span class="ident" id="4518604">errorExpected</span><span class="op" id="4518617">(</span><span class="ident" id="4518618">as</span><span class="op" id="4518620">.</span><span class="ident" id="4518621">Lhs</span><span class="op" id="4518624">[</span><span class="builtinfunc" id="4518625">len</span><span class="op" id="4518628">(</span><span class="ident" id="4518629">as</span><span class="op" id="4518631">.</span><span class="ident" id="4518632">Lhs</span><span class="op" id="4518635">)</span><span class="op" id="4518636">-</span><span class="num" id="4518637">1</span><span class="op" id="4518638">]</span><span class="op" id="4518639">.</span><span class="ident" id="4518640">Pos</span><span class="op" id="4518643">(</span><span class="op" id="4518644">)</span><span class="op" id="4518645">,</span>&nbsp;<span class="string" id="4518647">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="4518670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518675">return</span>&nbsp;<span class="op" id="4518682">&amp;</span><span class="ident" id="4518683">ast</span><span class="op" id="4518686">.</span><span class="ident" id="4518687">BadStmt</span><span class="op" id="4518694">{</span><span class="ident" id="4518695">From</span><span class="op" id="4518699">:</span>&nbsp;<span class="ident" id="4518701">pos</span><span class="op" id="4518704">,</span>&nbsp;<span class="ident" id="4518706">To</span><span class="op" id="4518708">:</span>&nbsp;<span class="ident" id="4518710">p</span><span class="op" id="4518711">.</span><span class="ident" id="4518712">safePos</span><span class="op" id="4518719">(</span><span class="ident" id="4518720">body</span><span class="op" id="4518724">.</span><span class="ident" id="4518725">End</span><span class="op" id="4518728">(</span><span class="op" id="4518729">)</span><span class="op" id="4518730">)</span><span class="op" id="4518731">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4518735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4518739">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4518792">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518848">x</span>&nbsp;<span class="op" id="4518850">:=</span>&nbsp;<span class="ident" id="4518853">as</span><span class="op" id="4518855">.</span><span class="ident" id="4518856">Rhs</span><span class="op" id="4518859">[</span><span class="num" id="4518860">0</span><span class="op" id="4518861">]</span><span class="op" id="4518862">.</span><span class="op" id="4518863">(</span><span class="op" id="4518864">*</span><span class="ident" id="4518865">ast</span><span class="op" id="4518868">.</span><span class="ident" id="4518869">UnaryExpr</span><span class="op" id="4518878">)</span><span class="op" id="4518879">.</span><span class="ident" id="4518880">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4518884">return</span>&nbsp;<span class="op" id="4518891">&amp;</span><span class="ident" id="4518892">ast</span><span class="op" id="4518895">.</span><span class="ident" id="4518896">RangeStmt</span><span class="op" id="4518905">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518910">For</span><span class="op" id="4518913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518918">pos</span><span class="op" id="4518921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518926">Key</span><span class="op" id="4518929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518934">key</span><span class="op" id="4518937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518942">Value</span><span class="op" id="4518947">:</span>&nbsp;&nbsp;<span class="ident" id="4518950">value</span><span class="op" id="4518955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518960">TokPos</span><span class="op" id="4518966">:</span>&nbsp;<span class="ident" id="4518968">as</span><span class="op" id="4518970">.</span><span class="ident" id="4518971">TokPos</span><span class="op" id="4518977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518982">Tok</span><span class="op" id="4518985">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4518990">as</span><span class="op" id="4518992">.</span><span class="ident" id="4518993">Tok</span><span class="op" id="4518996">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519001">X</span><span class="op" id="4519002">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519009">x</span><span class="op" id="4519010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519015">Body</span><span class="op" id="4519019">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4519023">body</span><span class="op" id="4519027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4519038">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519064">return</span>&nbsp;<span class="op" id="4519071">&amp;</span><span class="ident" id="4519072">ast</span><span class="op" id="4519075">.</span><span class="ident" id="4519076">ForStmt</span><span class="op" id="4519083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519087">For</span><span class="op" id="4519090">:</span>&nbsp;&nbsp;<span class="ident" id="4519093">pos</span><span class="op" id="4519096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519100">Init</span><span class="op" id="4519104">:</span>&nbsp;<span class="ident" id="4519106">s1</span><span class="op" id="4519108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519112">Cond</span><span class="op" id="4519116">:</span>&nbsp;<span class="ident" id="4519118">p</span><span class="op" id="4519119">.</span><span class="ident" id="4519120">makeExpr</span><span class="op" id="4519128">(</span><span class="ident" id="4519129">s2</span><span class="op" id="4519131">,</span>&nbsp;<span class="string" id="4519133">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="4519162">)</span><span class="op" id="4519163">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519167">Post</span><span class="op" id="4519171">:</span>&nbsp;<span class="ident" id="4519173">s3</span><span class="op" id="4519175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519179">Body</span><span class="op" id="4519183">:</span>&nbsp;<span class="ident" id="4519185">body</span><span class="op" id="4519189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519192">}</span><br>
<span class="lineno"></span><span class="op" id="4519194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="4519197">func</span>&nbsp;<span class="op" id="4519202">(</span><span class="ident" id="4519203">p</span>&nbsp;<span class="op" id="4519205">*</span><span class="ident" id="4519206">parser</span><span class="op" id="4519212">)</span>&nbsp;<span class="ident" id="4519214">parseStmt</span><span class="op" id="4519223">(</span><span class="op" id="4519224">)</span>&nbsp;<span class="op" id="4519226">(</span><span class="ident" id="4519227">s</span>&nbsp;<span class="ident" id="4519229">ast</span><span class="op" id="4519232">.</span><span class="ident" id="4519233">Stmt</span><span class="op" id="4519237">)</span>&nbsp;<span class="op" id="4519239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519242">if</span>&nbsp;<span class="ident" id="4519245">p</span><span class="op" id="4519246">.</span><span class="ident" id="4519247">trace</span>&nbsp;<span class="op" id="4519253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519257">defer</span>&nbsp;<span class="ident" id="4519263">un</span><span class="op" id="4519265">(</span><span class="ident" id="4519266">trace</span><span class="op" id="4519271">(</span><span class="ident" id="4519272">p</span><span class="op" id="4519273">,</span>&nbsp;<span class="string" id="4519275">&#34;Statement&#34;</span><span class="op" id="4519286">)</span><span class="op" id="4519287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519294">switch</span>&nbsp;<span class="ident" id="4519301">p</span><span class="op" id="4519302">.</span><span class="ident" id="4519303">tok</span>&nbsp;<span class="op" id="4519307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519310">case</span>&nbsp;<span class="ident" id="4519315">token</span><span class="op" id="4519320">.</span><span class="ident" id="4519321">CONST</span><span class="op" id="4519326">,</span>&nbsp;<span class="ident" id="4519328">token</span><span class="op" id="4519333">.</span><span class="ident" id="4519334">TYPE</span><span class="op" id="4519338">,</span>&nbsp;<span class="ident" id="4519340">token</span><span class="op" id="4519345">.</span><span class="ident" id="4519346">VAR</span><span class="op" id="4519349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519353">s</span>&nbsp;<span class="op" id="4519355">=</span>&nbsp;<span class="op" id="4519357">&amp;</span><span class="ident" id="4519358">ast</span><span class="op" id="4519361">.</span><span class="ident" id="4519362">DeclStmt</span><span class="op" id="4519370">{</span><span class="ident" id="4519371">Decl</span><span class="op" id="4519375">:</span>&nbsp;<span class="ident" id="4519377">p</span><span class="op" id="4519378">.</span><span class="ident" id="4519379">parseDecl</span><span class="op" id="4519388">(</span><span class="ident" id="4519389">syncStmt</span><span class="op" id="4519397">)</span><span class="op" id="4519398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519401">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4519408">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519449">token</span><span class="op" id="4519454">.</span><span class="ident" id="4519455">IDENT</span><span class="op" id="4519460">,</span>&nbsp;<span class="ident" id="4519462">token</span><span class="op" id="4519467">.</span><span class="ident" id="4519468">INT</span><span class="op" id="4519471">,</span>&nbsp;<span class="ident" id="4519473">token</span><span class="op" id="4519478">.</span><span class="ident" id="4519479">FLOAT</span><span class="op" id="4519484">,</span>&nbsp;<span class="ident" id="4519486">token</span><span class="op" id="4519491">.</span><span class="ident" id="4519492">IMAG</span><span class="op" id="4519496">,</span>&nbsp;<span class="ident" id="4519498">token</span><span class="op" id="4519503">.</span><span class="ident" id="4519504">CHAR</span><span class="op" id="4519508">,</span>&nbsp;<span class="ident" id="4519510">token</span><span class="op" id="4519515">.</span><span class="ident" id="4519516">STRING</span><span class="op" id="4519522">,</span>&nbsp;<span class="ident" id="4519524">token</span><span class="op" id="4519529">.</span><span class="ident" id="4519530">FUNC</span><span class="op" id="4519534">,</span>&nbsp;<span class="ident" id="4519536">token</span><span class="op" id="4519541">.</span><span class="ident" id="4519542">LPAREN</span><span class="op" id="4519548">,</span>&nbsp;<span class="comment" id="4519550">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519564">token</span><span class="op" id="4519569">.</span><span class="ident" id="4519570">LBRACK</span><span class="op" id="4519576">,</span>&nbsp;<span class="ident" id="4519578">token</span><span class="op" id="4519583">.</span><span class="ident" id="4519584">STRUCT</span><span class="op" id="4519590">,</span>&nbsp;<span class="comment" id="4519592">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519613">token</span><span class="op" id="4519618">.</span><span class="ident" id="4519619">ADD</span><span class="op" id="4519622">,</span>&nbsp;<span class="ident" id="4519624">token</span><span class="op" id="4519629">.</span><span class="ident" id="4519630">SUB</span><span class="op" id="4519633">,</span>&nbsp;<span class="ident" id="4519635">token</span><span class="op" id="4519640">.</span><span class="ident" id="4519641">MUL</span><span class="op" id="4519644">,</span>&nbsp;<span class="ident" id="4519646">token</span><span class="op" id="4519651">.</span><span class="ident" id="4519652">AND</span><span class="op" id="4519655">,</span>&nbsp;<span class="ident" id="4519657">token</span><span class="op" id="4519662">.</span><span class="ident" id="4519663">XOR</span><span class="op" id="4519666">,</span>&nbsp;<span class="ident" id="4519668">token</span><span class="op" id="4519673">.</span><span class="ident" id="4519674">ARROW</span><span class="op" id="4519679">,</span>&nbsp;<span class="ident" id="4519681">token</span><span class="op" id="4519686">.</span><span class="ident" id="4519687">NOT</span><span class="op" id="4519690">:</span>&nbsp;<span class="comment" id="4519692">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519713">s</span><span class="op" id="4519714">,</span>&nbsp;<span class="ident" id="4519716">_</span>&nbsp;<span class="op" id="4519718">=</span>&nbsp;<span class="ident" id="4519720">p</span><span class="op" id="4519721">.</span><span class="ident" id="4519722">parseSimpleStmt</span><span class="op" id="4519737">(</span><span class="ident" id="4519738">labelOk</span><span class="op" id="4519745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4519749">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4519813">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4519877">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519887">if</span>&nbsp;<span class="ident" id="4519890">_</span><span class="op" id="4519891">,</span>&nbsp;<span class="ident" id="4519893">isLabeledStmt</span>&nbsp;<span class="op" id="4519907">:=</span>&nbsp;<span class="ident" id="4519910">s</span><span class="op" id="4519911">.</span><span class="op" id="4519912">(</span><span class="op" id="4519913">*</span><span class="ident" id="4519914">ast</span><span class="op" id="4519917">.</span><span class="ident" id="4519918">LabeledStmt</span><span class="op" id="4519929">)</span><span class="op" id="4519930">;</span>&nbsp;<span class="op" id="4519932">!</span><span class="ident" id="4519933">isLabeledStmt</span>&nbsp;<span class="op" id="4519947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519952">p</span><span class="op" id="4519953">.</span><span class="ident" id="4519954">expectSemi</span><span class="op" id="4519964">(</span><span class="op" id="4519965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4519969">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4519972">case</span>&nbsp;<span class="ident" id="4519977">token</span><span class="op" id="4519982">.</span><span class="ident" id="4519983">GO</span><span class="op" id="4519985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4519989">s</span>&nbsp;<span class="op" id="4519991">=</span>&nbsp;<span class="ident" id="4519993">p</span><span class="op" id="4519994">.</span><span class="ident" id="4519995">parseGoStmt</span><span class="op" id="4520006">(</span><span class="op" id="4520007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520010">case</span>&nbsp;<span class="ident" id="4520015">token</span><span class="op" id="4520020">.</span><span class="ident" id="4520021">DEFER</span><span class="op" id="4520026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520030">s</span>&nbsp;<span class="op" id="4520032">=</span>&nbsp;<span class="ident" id="4520034">p</span><span class="op" id="4520035">.</span><span class="ident" id="4520036">parseDeferStmt</span><span class="op" id="4520050">(</span><span class="op" id="4520051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520054">case</span>&nbsp;<span class="ident" id="4520059">token</span><span class="op" id="4520064">.</span><span class="ident" id="4520065">RETURN</span><span class="op" id="4520071">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520075">s</span>&nbsp;<span class="op" id="4520077">=</span>&nbsp;<span class="ident" id="4520079">p</span><span class="op" id="4520080">.</span><span class="ident" id="4520081">parseReturnStmt</span><span class="op" id="4520096">(</span><span class="op" id="4520097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520100">case</span>&nbsp;<span class="ident" id="4520105">token</span><span class="op" id="4520110">.</span><span class="ident" id="4520111">BREAK</span><span class="op" id="4520116">,</span>&nbsp;<span class="ident" id="4520118">token</span><span class="op" id="4520123">.</span><span class="ident" id="4520124">CONTINUE</span><span class="op" id="4520132">,</span>&nbsp;<span class="ident" id="4520134">token</span><span class="op" id="4520139">.</span><span class="ident" id="4520140">GOTO</span><span class="op" id="4520144">,</span>&nbsp;<span class="ident" id="4520146">token</span><span class="op" id="4520151">.</span><span class="ident" id="4520152">FALLTHROUGH</span><span class="op" id="4520163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520167">s</span>&nbsp;<span class="op" id="4520169">=</span>&nbsp;<span class="ident" id="4520171">p</span><span class="op" id="4520172">.</span><span class="ident" id="4520173">parseBranchStmt</span><span class="op" id="4520188">(</span><span class="ident" id="4520189">p</span><span class="op" id="4520190">.</span><span class="ident" id="4520191">tok</span><span class="op" id="4520194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520197">case</span>&nbsp;<span class="ident" id="4520202">token</span><span class="op" id="4520207">.</span><span class="ident" id="4520208">LBRACE</span><span class="op" id="4520214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520218">s</span>&nbsp;<span class="op" id="4520220">=</span>&nbsp;<span class="ident" id="4520222">p</span><span class="op" id="4520223">.</span><span class="ident" id="4520224">parseBlockStmt</span><span class="op" id="4520238">(</span><span class="op" id="4520239">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520243">p</span><span class="op" id="4520244">.</span><span class="ident" id="4520245">expectSemi</span><span class="op" id="4520255">(</span><span class="op" id="4520256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520259">case</span>&nbsp;<span class="ident" id="4520264">token</span><span class="op" id="4520269">.</span><span class="ident" id="4520270">IF</span><span class="op" id="4520272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520276">s</span>&nbsp;<span class="op" id="4520278">=</span>&nbsp;<span class="ident" id="4520280">p</span><span class="op" id="4520281">.</span><span class="ident" id="4520282">parseIfStmt</span><span class="op" id="4520293">(</span><span class="op" id="4520294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520297">case</span>&nbsp;<span class="ident" id="4520302">token</span><span class="op" id="4520307">.</span><span class="ident" id="4520308">SWITCH</span><span class="op" id="4520314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520318">s</span>&nbsp;<span class="op" id="4520320">=</span>&nbsp;<span class="ident" id="4520322">p</span><span class="op" id="4520323">.</span><span class="ident" id="4520324">parseSwitchStmt</span><span class="op" id="4520339">(</span><span class="op" id="4520340">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520343">case</span>&nbsp;<span class="ident" id="4520348">token</span><span class="op" id="4520353">.</span><span class="ident" id="4520354">SELECT</span><span class="op" id="4520360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520364">s</span>&nbsp;<span class="op" id="4520366">=</span>&nbsp;<span class="ident" id="4520368">p</span><span class="op" id="4520369">.</span><span class="ident" id="4520370">parseSelectStmt</span><span class="op" id="4520385">(</span><span class="op" id="4520386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520389">case</span>&nbsp;<span class="ident" id="4520394">token</span><span class="op" id="4520399">.</span><span class="ident" id="4520400">FOR</span><span class="op" id="4520403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520407">s</span>&nbsp;<span class="op" id="4520409">=</span>&nbsp;<span class="ident" id="4520411">p</span><span class="op" id="4520412">.</span><span class="ident" id="4520413">parseForStmt</span><span class="op" id="4520425">(</span><span class="op" id="4520426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520429">case</span>&nbsp;<span class="ident" id="4520434">token</span><span class="op" id="4520439">.</span><span class="ident" id="4520440">SEMICOLON</span><span class="op" id="4520449">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520453">s</span>&nbsp;<span class="op" id="4520455">=</span>&nbsp;<span class="op" id="4520457">&amp;</span><span class="ident" id="4520458">ast</span><span class="op" id="4520461">.</span><span class="ident" id="4520462">EmptyStmt</span><span class="op" id="4520471">{</span><span class="ident" id="4520472">Semicolon</span><span class="op" id="4520481">:</span>&nbsp;<span class="ident" id="4520483">p</span><span class="op" id="4520484">.</span><span class="ident" id="4520485">pos</span><span class="op" id="4520488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520492">p</span><span class="op" id="4520493">.</span><span class="ident" id="4520494">next</span><span class="op" id="4520498">(</span><span class="op" id="4520499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520502">case</span>&nbsp;<span class="ident" id="4520507">token</span><span class="op" id="4520512">.</span><span class="ident" id="4520513">RBRACE</span><span class="op" id="4520519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4520523">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520576">s</span>&nbsp;<span class="op" id="4520578">=</span>&nbsp;<span class="op" id="4520580">&amp;</span><span class="ident" id="4520581">ast</span><span class="op" id="4520584">.</span><span class="ident" id="4520585">EmptyStmt</span><span class="op" id="4520594">{</span><span class="ident" id="4520595">Semicolon</span><span class="op" id="4520604">:</span>&nbsp;<span class="ident" id="4520606">p</span><span class="op" id="4520607">.</span><span class="ident" id="4520608">pos</span><span class="op" id="4520611">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520614">default</span><span class="op" id="4520621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4520625">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520649">pos</span>&nbsp;<span class="op" id="4520653">:=</span>&nbsp;<span class="ident" id="4520656">p</span><span class="op" id="4520657">.</span><span class="ident" id="4520658">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520664">p</span><span class="op" id="4520665">.</span><span class="ident" id="4520666">errorExpected</span><span class="op" id="4520679">(</span><span class="ident" id="4520680">pos</span><span class="op" id="4520683">,</span>&nbsp;<span class="string" id="4520685">&#34;statement&#34;</span><span class="op" id="4520696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520700">syncStmt</span><span class="op" id="4520708">(</span><span class="ident" id="4520709">p</span><span class="op" id="4520710">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4520714">s</span>&nbsp;<span class="op" id="4520716">=</span>&nbsp;<span class="op" id="4520718">&amp;</span><span class="ident" id="4520719">ast</span><span class="op" id="4520722">.</span><span class="ident" id="4520723">BadStmt</span><span class="op" id="4520730">{</span><span class="ident" id="4520731">From</span><span class="op" id="4520735">:</span>&nbsp;<span class="ident" id="4520737">pos</span><span class="op" id="4520740">,</span>&nbsp;<span class="ident" id="4520742">To</span><span class="op" id="4520744">:</span>&nbsp;<span class="ident" id="4520746">p</span><span class="op" id="4520747">.</span><span class="ident" id="4520748">pos</span><span class="op" id="4520751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4520754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520758">return</span><br>
<span class="lineno"></span><span class="op" id="4520765">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="4520768">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4520848">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4520865">type</span>&nbsp;<span class="ident" id="4520870">parseSpecFunction</span>&nbsp;<span class="keyword" id="4520888">func</span><span class="op" id="4520892">(</span><span class="ident" id="4520893">doc</span>&nbsp;<span class="op" id="4520897">*</span><span class="ident" id="4520898">ast</span><span class="op" id="4520901">.</span><span class="ident" id="4520902">CommentGroup</span><span class="op" id="4520914">,</span>&nbsp;<span class="ident" id="4520916">keyword</span>&nbsp;<span class="ident" id="4520924">token</span><span class="op" id="4520929">.</span><span class="ident" id="4520930">Token</span><span class="op" id="4520935">,</span>&nbsp;<span class="ident" id="4520937">iota</span>&nbsp;<span class="builtintype" id="4520942">int</span><span class="op" id="4520945">)</span>&nbsp;<span class="ident" id="4520947">ast</span><span class="op" id="4520950">.</span><span class="ident" id="4520951">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="4520957">func</span>&nbsp;<span class="ident" id="4520962">isValidImport</span><span class="op" id="4520975">(</span><span class="ident" id="4520976">lit</span>&nbsp;<span class="builtintype" id="4520980">string</span><span class="op" id="4520986">)</span>&nbsp;<span class="builtintype" id="4520988">bool</span>&nbsp;<span class="op" id="4520993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4520996">const</span>&nbsp;<span class="ident" id="4521002">illegalChars</span>&nbsp;<span class="op" id="4521015">=</span>&nbsp;<span class="string" id="4521017">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="4521044">+</span>&nbsp;<span class="string" id="4521046">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521057">s</span><span class="op" id="4521058">,</span>&nbsp;<span class="ident" id="4521060">_</span>&nbsp;<span class="op" id="4521062">:=</span>&nbsp;<span class="ident" id="4521065">strconv</span><span class="op" id="4521072">.</span><span class="ident" id="4521073">Unquote</span><span class="op" id="4521080">(</span><span class="ident" id="4521081">lit</span><span class="op" id="4521084">)</span>&nbsp;<span class="comment" id="4521086">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521132">for</span>&nbsp;<span class="ident" id="4521136">_</span><span class="op" id="4521137">,</span>&nbsp;<span class="ident" id="4521139">r</span>&nbsp;<span class="op" id="4521141">:=</span>&nbsp;<span class="keyword" id="4521144">range</span>&nbsp;<span class="ident" id="4521150">s</span>&nbsp;<span class="op" id="4521152">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521156">if</span>&nbsp;<span class="op" id="4521159">!</span><span class="ident" id="4521160">unicode</span><span class="op" id="4521167">.</span><span class="ident" id="4521168">IsGraphic</span><span class="op" id="4521177">(</span><span class="ident" id="4521178">r</span><span class="op" id="4521179">)</span>&nbsp;<span class="op" id="4521181">||</span>&nbsp;<span class="ident" id="4521184">unicode</span><span class="op" id="4521191">.</span><span class="ident" id="4521192">IsSpace</span><span class="op" id="4521199">(</span><span class="ident" id="4521200">r</span><span class="op" id="4521201">)</span>&nbsp;<span class="op" id="4521203">||</span>&nbsp;<span class="ident" id="4521206">strings</span><span class="op" id="4521213">.</span><span class="ident" id="4521214">ContainsRune</span><span class="op" id="4521226">(</span><span class="ident" id="4521227">illegalChars</span><span class="op" id="4521239">,</span>&nbsp;<span class="ident" id="4521241">r</span><span class="op" id="4521242">)</span>&nbsp;<span class="op" id="4521244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521249">return</span>&nbsp;<span class="builtintype" id="4521256">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521270">return</span>&nbsp;<span class="ident" id="4521277">s</span>&nbsp;<span class="op" id="4521279">!=</span>&nbsp;<span class="string" id="4521282">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="4521285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4521288">func</span>&nbsp;<span class="op" id="4521293">(</span><span class="ident" id="4521294">p</span>&nbsp;<span class="op" id="4521296">*</span><span class="ident" id="4521297">parser</span><span class="op" id="4521303">)</span>&nbsp;<span class="ident" id="4521305">parseImportSpec</span><span class="op" id="4521320">(</span><span class="ident" id="4521321">doc</span>&nbsp;<span class="op" id="4521325">*</span><span class="ident" id="4521326">ast</span><span class="op" id="4521329">.</span><span class="ident" id="4521330">CommentGroup</span><span class="op" id="4521342">,</span>&nbsp;<span class="ident" id="4521344">_</span>&nbsp;<span class="ident" id="4521346">token</span><span class="op" id="4521351">.</span><span class="ident" id="4521352">Token</span><span class="op" id="4521357">,</span>&nbsp;<span class="ident" id="4521359">_</span>&nbsp;<span class="builtintype" id="4521361">int</span><span class="op" id="4521364">)</span>&nbsp;<span class="ident" id="4521366">ast</span><span class="op" id="4521369">.</span><span class="ident" id="4521370">Spec</span>&nbsp;<span class="op" id="4521375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521378">if</span>&nbsp;<span class="ident" id="4521381">p</span><span class="op" id="4521382">.</span><span class="ident" id="4521383">trace</span>&nbsp;<span class="op" id="4521389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521393">defer</span>&nbsp;<span class="ident" id="4521399">un</span><span class="op" id="4521401">(</span><span class="ident" id="4521402">trace</span><span class="op" id="4521407">(</span><span class="ident" id="4521408">p</span><span class="op" id="4521409">,</span>&nbsp;<span class="string" id="4521411">&#34;ImportSpec&#34;</span><span class="op" id="4521423">)</span><span class="op" id="4521424">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521431">var</span>&nbsp;<span class="ident" id="4521435">ident</span>&nbsp;<span class="op" id="4521441">*</span><span class="ident" id="4521442">ast</span><span class="op" id="4521445">.</span><span class="ident" id="4521446">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521453">switch</span>&nbsp;<span class="ident" id="4521460">p</span><span class="op" id="4521461">.</span><span class="ident" id="4521462">tok</span>&nbsp;<span class="op" id="4521466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521469">case</span>&nbsp;<span class="ident" id="4521474">token</span><span class="op" id="4521479">.</span><span class="ident" id="4521480">PERIOD</span><span class="op" id="4521486">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521490">ident</span>&nbsp;<span class="op" id="4521496">=</span>&nbsp;<span class="op" id="4521498">&amp;</span><span class="ident" id="4521499">ast</span><span class="op" id="4521502">.</span><span class="ident" id="4521503">Ident</span><span class="op" id="4521508">{</span><span class="ident" id="4521509">NamePos</span><span class="op" id="4521516">:</span>&nbsp;<span class="ident" id="4521518">p</span><span class="op" id="4521519">.</span><span class="ident" id="4521520">pos</span><span class="op" id="4521523">,</span>&nbsp;<span class="ident" id="4521525">Name</span><span class="op" id="4521529">:</span>&nbsp;<span class="string" id="4521531">&#34;.&#34;</span><span class="op" id="4521534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521538">p</span><span class="op" id="4521539">.</span><span class="ident" id="4521540">next</span><span class="op" id="4521544">(</span><span class="op" id="4521545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521548">case</span>&nbsp;<span class="ident" id="4521553">token</span><span class="op" id="4521558">.</span><span class="ident" id="4521559">IDENT</span><span class="op" id="4521564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521568">ident</span>&nbsp;<span class="op" id="4521574">=</span>&nbsp;<span class="ident" id="4521576">p</span><span class="op" id="4521577">.</span><span class="ident" id="4521578">parseIdent</span><span class="op" id="4521588">(</span><span class="op" id="4521589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521592">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521596">pos</span>&nbsp;<span class="op" id="4521600">:=</span>&nbsp;<span class="ident" id="4521603">p</span><span class="op" id="4521604">.</span><span class="ident" id="4521605">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521610">var</span>&nbsp;<span class="ident" id="4521614">path</span>&nbsp;<span class="builtintype" id="4521619">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521627">if</span>&nbsp;<span class="ident" id="4521630">p</span><span class="op" id="4521631">.</span><span class="ident" id="4521632">tok</span>&nbsp;<span class="op" id="4521636">==</span>&nbsp;<span class="ident" id="4521639">token</span><span class="op" id="4521644">.</span><span class="ident" id="4521645">STRING</span>&nbsp;<span class="op" id="4521652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521656">path</span>&nbsp;<span class="op" id="4521661">=</span>&nbsp;<span class="ident" id="4521663">p</span><span class="op" id="4521664">.</span><span class="ident" id="4521665">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4521671">if</span>&nbsp;<span class="op" id="4521674">!</span><span class="ident" id="4521675">isValidImport</span><span class="op" id="4521688">(</span><span class="ident" id="4521689">path</span><span class="op" id="4521693">)</span>&nbsp;<span class="op" id="4521695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521700">p</span><span class="op" id="4521701">.</span><span class="builtintype" id="4521702">error</span><span class="op" id="4521707">(</span><span class="ident" id="4521708">pos</span><span class="op" id="4521711">,</span>&nbsp;<span class="string" id="4521713">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="4521736">+</span><span class="ident" id="4521737">path</span><span class="op" id="4521741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521749">p</span><span class="op" id="4521750">.</span><span class="ident" id="4521751">next</span><span class="op" id="4521755">(</span><span class="op" id="4521756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521759">}</span>&nbsp;<span class="keyword" id="4521761">else</span>&nbsp;<span class="op" id="4521766">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521770">p</span><span class="op" id="4521771">.</span><span class="ident" id="4521772">expect</span><span class="op" id="4521778">(</span><span class="ident" id="4521779">token</span><span class="op" id="4521784">.</span><span class="ident" id="4521785">STRING</span><span class="op" id="4521791">)</span>&nbsp;<span class="comment" id="4521793">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521828">p</span><span class="op" id="4521829">.</span><span class="ident" id="4521830">expectSemi</span><span class="op" id="4521840">(</span><span class="op" id="4521841">)</span>&nbsp;<span class="comment" id="4521843">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4521884">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521904">spec</span>&nbsp;<span class="op" id="4521909">:=</span>&nbsp;<span class="op" id="4521912">&amp;</span><span class="ident" id="4521913">ast</span><span class="op" id="4521916">.</span><span class="ident" id="4521917">ImportSpec</span><span class="op" id="4521927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521931">Doc</span><span class="op" id="4521934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521940">doc</span><span class="op" id="4521943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521947">Name</span><span class="op" id="4521951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521956">ident</span><span class="op" id="4521961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4521965">Path</span><span class="op" id="4521969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4521974">&amp;</span><span class="ident" id="4521975">ast</span><span class="op" id="4521978">.</span><span class="ident" id="4521979">BasicLit</span><span class="op" id="4521987">{</span><span class="ident" id="4521988">ValuePos</span><span class="op" id="4521996">:</span>&nbsp;<span class="ident" id="4521998">pos</span><span class="op" id="4522001">,</span>&nbsp;<span class="ident" id="4522003">Kind</span><span class="op" id="4522007">:</span>&nbsp;<span class="ident" id="4522009">token</span><span class="op" id="4522014">.</span><span class="ident" id="4522015">STRING</span><span class="op" id="4522021">,</span>&nbsp;<span class="ident" id="4522023">Value</span><span class="op" id="4522028">:</span>&nbsp;<span class="ident" id="4522030">path</span><span class="op" id="4522034">}</span><span class="op" id="4522035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522039">Comment</span><span class="op" id="4522046">:</span>&nbsp;<span class="ident" id="4522048">p</span><span class="op" id="4522049">.</span><span class="ident" id="4522050">lineComment</span><span class="op" id="4522061">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4522064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522067">p</span><span class="op" id="4522068">.</span><span class="ident" id="4522069">imports</span>&nbsp;<span class="op" id="4522077">=</span>&nbsp;<span class="builtinfunc" id="4522079">append</span><span class="op" id="4522085">(</span><span class="ident" id="4522086">p</span><span class="op" id="4522087">.</span><span class="ident" id="4522088">imports</span><span class="op" id="4522095">,</span>&nbsp;<span class="ident" id="4522097">spec</span><span class="op" id="4522101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522105">return</span>&nbsp;<span class="ident" id="4522112">spec</span><br>
<span class="lineno"></span><span class="op" id="4522117">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="4522120">func</span>&nbsp;<span class="op" id="4522125">(</span><span class="ident" id="4522126">p</span>&nbsp;<span class="op" id="4522128">*</span><span class="ident" id="4522129">parser</span><span class="op" id="4522135">)</span>&nbsp;<span class="ident" id="4522137">parseValueSpec</span><span class="op" id="4522151">(</span><span class="ident" id="4522152">doc</span>&nbsp;<span class="op" id="4522156">*</span><span class="ident" id="4522157">ast</span><span class="op" id="4522160">.</span><span class="ident" id="4522161">CommentGroup</span><span class="op" id="4522173">,</span>&nbsp;<span class="ident" id="4522175">keyword</span>&nbsp;<span class="ident" id="4522183">token</span><span class="op" id="4522188">.</span><span class="ident" id="4522189">Token</span><span class="op" id="4522194">,</span>&nbsp;<span class="ident" id="4522196">iota</span>&nbsp;<span class="builtintype" id="4522201">int</span><span class="op" id="4522204">)</span>&nbsp;<span class="ident" id="4522206">ast</span><span class="op" id="4522209">.</span><span class="ident" id="4522210">Spec</span>&nbsp;<span class="op" id="4522215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522218">if</span>&nbsp;<span class="ident" id="4522221">p</span><span class="op" id="4522222">.</span><span class="ident" id="4522223">trace</span>&nbsp;<span class="op" id="4522229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522233">defer</span>&nbsp;<span class="ident" id="4522239">un</span><span class="op" id="4522241">(</span><span class="ident" id="4522242">trace</span><span class="op" id="4522247">(</span><span class="ident" id="4522248">p</span><span class="op" id="4522249">,</span>&nbsp;<span class="ident" id="4522251">keyword</span><span class="op" id="4522258">.</span><span class="ident" id="4522259">String</span><span class="op" id="4522265">(</span><span class="op" id="4522266">)</span><span class="op" id="4522267">+</span><span class="string" id="4522268">&#34;Spec&#34;</span><span class="op" id="4522274">)</span><span class="op" id="4522275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4522278">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522282">idents</span>&nbsp;<span class="op" id="4522289">:=</span>&nbsp;<span class="ident" id="4522292">p</span><span class="op" id="4522293">.</span><span class="ident" id="4522294">parseIdentList</span><span class="op" id="4522308">(</span><span class="op" id="4522309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522312">typ</span>&nbsp;<span class="op" id="4522316">:=</span>&nbsp;<span class="ident" id="4522319">p</span><span class="op" id="4522320">.</span><span class="ident" id="4522321">tryType</span><span class="op" id="4522328">(</span><span class="op" id="4522329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522332">var</span>&nbsp;<span class="ident" id="4522336">values</span>&nbsp;<span class="op" id="4522343">[</span><span class="op" id="4522344">]</span><span class="ident" id="4522345">ast</span><span class="op" id="4522348">.</span><span class="ident" id="4522349">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4522355">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522423">if</span>&nbsp;<span class="ident" id="4522426">p</span><span class="op" id="4522427">.</span><span class="ident" id="4522428">tok</span>&nbsp;<span class="op" id="4522432">==</span>&nbsp;<span class="ident" id="4522435">token</span><span class="op" id="4522440">.</span><span class="ident" id="4522441">ASSIGN</span>&nbsp;<span class="op" id="4522448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522452">p</span><span class="op" id="4522453">.</span><span class="ident" id="4522454">next</span><span class="op" id="4522458">(</span><span class="op" id="4522459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522463">values</span>&nbsp;<span class="op" id="4522470">=</span>&nbsp;<span class="ident" id="4522472">p</span><span class="op" id="4522473">.</span><span class="ident" id="4522474">parseRhsList</span><span class="op" id="4522486">(</span><span class="op" id="4522487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4522490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522493">p</span><span class="op" id="4522494">.</span><span class="ident" id="4522495">expectSemi</span><span class="op" id="4522505">(</span><span class="op" id="4522506">)</span>&nbsp;<span class="comment" id="4522508">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4522549">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4522625">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4522698">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4522745">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522818">spec</span>&nbsp;<span class="op" id="4522823">:=</span>&nbsp;<span class="op" id="4522826">&amp;</span><span class="ident" id="4522827">ast</span><span class="op" id="4522830">.</span><span class="ident" id="4522831">ValueSpec</span><span class="op" id="4522840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522844">Doc</span><span class="op" id="4522847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522853">doc</span><span class="op" id="4522856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522860">Names</span><span class="op" id="4522865">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4522869">idents</span><span class="op" id="4522875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522879">Type</span><span class="op" id="4522883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522888">typ</span><span class="op" id="4522891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522895">Values</span><span class="op" id="4522901">:</span>&nbsp;&nbsp;<span class="ident" id="4522904">values</span><span class="op" id="4522910">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522914">Comment</span><span class="op" id="4522921">:</span>&nbsp;<span class="ident" id="4522923">p</span><span class="op" id="4522924">.</span><span class="ident" id="4522925">lineComment</span><span class="op" id="4522936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4522939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522942">kind</span>&nbsp;<span class="op" id="4522947">:=</span>&nbsp;<span class="ident" id="4522950">ast</span><span class="op" id="4522953">.</span><span class="ident" id="4522954">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4522959">if</span>&nbsp;<span class="ident" id="4522962">keyword</span>&nbsp;<span class="op" id="4522970">==</span>&nbsp;<span class="ident" id="4522973">token</span><span class="op" id="4522978">.</span><span class="ident" id="4522979">VAR</span>&nbsp;<span class="op" id="4522983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4522987">kind</span>&nbsp;<span class="op" id="4522992">=</span>&nbsp;<span class="ident" id="4522994">ast</span><span class="op" id="4522997">.</span><span class="ident" id="4522998">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4523003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523006">p</span><span class="op" id="4523007">.</span><span class="ident" id="4523008">declare</span><span class="op" id="4523015">(</span><span class="ident" id="4523016">spec</span><span class="op" id="4523020">,</span>&nbsp;<span class="ident" id="4523022">iota</span><span class="op" id="4523026">,</span>&nbsp;<span class="ident" id="4523028">p</span><span class="op" id="4523029">.</span><span class="ident" id="4523030">topScope</span><span class="op" id="4523038">,</span>&nbsp;<span class="ident" id="4523040">kind</span><span class="op" id="4523044">,</span>&nbsp;<span class="ident" id="4523046">idents</span><span class="op" id="4523052">...</span><span class="op" id="4523055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523059">return</span>&nbsp;<span class="ident" id="4523066">spec</span><br>
<span class="lineno"></span><span class="op" id="4523071">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="4523074">func</span>&nbsp;<span class="op" id="4523079">(</span><span class="ident" id="4523080">p</span>&nbsp;<span class="op" id="4523082">*</span><span class="ident" id="4523083">parser</span><span class="op" id="4523089">)</span>&nbsp;<span class="ident" id="4523091">parseTypeSpec</span><span class="op" id="4523104">(</span><span class="ident" id="4523105">doc</span>&nbsp;<span class="op" id="4523109">*</span><span class="ident" id="4523110">ast</span><span class="op" id="4523113">.</span><span class="ident" id="4523114">CommentGroup</span><span class="op" id="4523126">,</span>&nbsp;<span class="ident" id="4523128">_</span>&nbsp;<span class="ident" id="4523130">token</span><span class="op" id="4523135">.</span><span class="ident" id="4523136">Token</span><span class="op" id="4523141">,</span>&nbsp;<span class="ident" id="4523143">_</span>&nbsp;<span class="builtintype" id="4523145">int</span><span class="op" id="4523148">)</span>&nbsp;<span class="ident" id="4523150">ast</span><span class="op" id="4523153">.</span><span class="ident" id="4523154">Spec</span>&nbsp;<span class="op" id="4523159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523162">if</span>&nbsp;<span class="ident" id="4523165">p</span><span class="op" id="4523166">.</span><span class="ident" id="4523167">trace</span>&nbsp;<span class="op" id="4523173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523177">defer</span>&nbsp;<span class="ident" id="4523183">un</span><span class="op" id="4523185">(</span><span class="ident" id="4523186">trace</span><span class="op" id="4523191">(</span><span class="ident" id="4523192">p</span><span class="op" id="4523193">,</span>&nbsp;<span class="string" id="4523195">&#34;TypeSpec&#34;</span><span class="op" id="4523205">)</span><span class="op" id="4523206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4523209">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523213">ident</span>&nbsp;<span class="op" id="4523219">:=</span>&nbsp;<span class="ident" id="4523222">p</span><span class="op" id="4523223">.</span><span class="ident" id="4523224">parseIdent</span><span class="op" id="4523234">(</span><span class="op" id="4523235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4523239">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4523317">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4523392">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4523414">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523487">spec</span>&nbsp;<span class="op" id="4523492">:=</span>&nbsp;<span class="op" id="4523495">&amp;</span><span class="ident" id="4523496">ast</span><span class="op" id="4523499">.</span><span class="ident" id="4523500">TypeSpec</span><span class="op" id="4523508">{</span><span class="ident" id="4523509">Doc</span><span class="op" id="4523512">:</span>&nbsp;<span class="ident" id="4523514">doc</span><span class="op" id="4523517">,</span>&nbsp;<span class="ident" id="4523519">Name</span><span class="op" id="4523523">:</span>&nbsp;<span class="ident" id="4523525">ident</span><span class="op" id="4523530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523533">p</span><span class="op" id="4523534">.</span><span class="ident" id="4523535">declare</span><span class="op" id="4523542">(</span><span class="ident" id="4523543">spec</span><span class="op" id="4523547">,</span>&nbsp;<span class="ident" id="4523549">nil</span><span class="op" id="4523552">,</span>&nbsp;<span class="ident" id="4523554">p</span><span class="op" id="4523555">.</span><span class="ident" id="4523556">topScope</span><span class="op" id="4523564">,</span>&nbsp;<span class="ident" id="4523566">ast</span><span class="op" id="4523569">.</span><span class="ident" id="4523570">Typ</span><span class="op" id="4523573">,</span>&nbsp;<span class="ident" id="4523575">ident</span><span class="op" id="4523580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523584">spec</span><span class="op" id="4523588">.</span><span class="ident" id="4523589">Type</span>&nbsp;<span class="op" id="4523594">=</span>&nbsp;<span class="ident" id="4523596">p</span><span class="op" id="4523597">.</span><span class="ident" id="4523598">parseType</span><span class="op" id="4523607">(</span><span class="op" id="4523608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523611">p</span><span class="op" id="4523612">.</span><span class="ident" id="4523613">expectSemi</span><span class="op" id="4523623">(</span><span class="op" id="4523624">)</span>&nbsp;<span class="comment" id="4523626">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523666">spec</span><span class="op" id="4523670">.</span><span class="ident" id="4523671">Comment</span>&nbsp;<span class="op" id="4523679">=</span>&nbsp;<span class="ident" id="4523681">p</span><span class="op" id="4523682">.</span><span class="ident" id="4523683">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523697">return</span>&nbsp;<span class="ident" id="4523704">spec</span><br>
<span class="lineno">2280</span><span class="op" id="4523709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4523712">func</span>&nbsp;<span class="op" id="4523717">(</span><span class="ident" id="4523718">p</span>&nbsp;<span class="op" id="4523720">*</span><span class="ident" id="4523721">parser</span><span class="op" id="4523727">)</span>&nbsp;<span class="ident" id="4523729">parseGenDecl</span><span class="op" id="4523741">(</span><span class="ident" id="4523742">keyword</span>&nbsp;<span class="ident" id="4523750">token</span><span class="op" id="4523755">.</span><span class="ident" id="4523756">Token</span><span class="op" id="4523761">,</span>&nbsp;<span class="ident" id="4523763">f</span>&nbsp;<span class="ident" id="4523765">parseSpecFunction</span><span class="op" id="4523782">)</span>&nbsp;<span class="op" id="4523784">*</span><span class="ident" id="4523785">ast</span><span class="op" id="4523788">.</span><span class="ident" id="4523789">GenDecl</span>&nbsp;<span class="op" id="4523797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523800">if</span>&nbsp;<span class="ident" id="4523803">p</span><span class="op" id="4523804">.</span><span class="ident" id="4523805">trace</span>&nbsp;<span class="op" id="4523811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523815">defer</span>&nbsp;<span class="ident" id="4523821">un</span><span class="op" id="4523823">(</span><span class="ident" id="4523824">trace</span><span class="op" id="4523829">(</span><span class="ident" id="4523830">p</span><span class="op" id="4523831">,</span>&nbsp;<span class="string" id="4523833">&#34;GenDecl(&#34;</span><span class="op" id="4523843">+</span><span class="ident" id="4523844">keyword</span><span class="op" id="4523851">.</span><span class="ident" id="4523852">String</span><span class="op" id="4523858">(</span><span class="op" id="4523859">)</span><span class="op" id="4523860">+</span><span class="string" id="4523861">&#34;)&#34;</span><span class="op" id="4523864">)</span><span class="op" id="4523865">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4523868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523872">doc</span>&nbsp;<span class="op" id="4523876">:=</span>&nbsp;<span class="ident" id="4523879">p</span><span class="op" id="4523880">.</span><span class="ident" id="4523881">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4523894">pos</span>&nbsp;<span class="op" id="4523898">:=</span>&nbsp;<span class="ident" id="4523901">p</span><span class="op" id="4523902">.</span><span class="ident" id="4523903">expect</span><span class="op" id="4523909">(</span><span class="ident" id="4523910">keyword</span><span class="op" id="4523917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523920">var</span>&nbsp;<span class="ident" id="4523924">lparen</span><span class="op" id="4523930">,</span>&nbsp;<span class="ident" id="4523932">rparen</span>&nbsp;<span class="ident" id="4523939">token</span><span class="op" id="4523944">.</span><span class="ident" id="4523945">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523950">var</span>&nbsp;<span class="ident" id="4523954">list</span>&nbsp;<span class="op" id="4523959">[</span><span class="op" id="4523960">]</span><span class="ident" id="4523961">ast</span><span class="op" id="4523964">.</span><span class="ident" id="4523965">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4523971">if</span>&nbsp;<span class="ident" id="4523974">p</span><span class="op" id="4523975">.</span><span class="ident" id="4523976">tok</span>&nbsp;<span class="op" id="4523980">==</span>&nbsp;<span class="ident" id="4523983">token</span><span class="op" id="4523988">.</span><span class="ident" id="4523989">LPAREN</span>&nbsp;<span class="op" id="4523996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524000">lparen</span>&nbsp;<span class="op" id="4524007">=</span>&nbsp;<span class="ident" id="4524009">p</span><span class="op" id="4524010">.</span><span class="ident" id="4524011">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524017">p</span><span class="op" id="4524018">.</span><span class="ident" id="4524019">next</span><span class="op" id="4524023">(</span><span class="op" id="4524024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524028">for</span>&nbsp;<span class="ident" id="4524032">iota</span>&nbsp;<span class="op" id="4524037">:=</span>&nbsp;<span class="num" id="4524040">0</span><span class="op" id="4524041">;</span>&nbsp;<span class="ident" id="4524043">p</span><span class="op" id="4524044">.</span><span class="ident" id="4524045">tok</span>&nbsp;<span class="op" id="4524049">!=</span>&nbsp;<span class="ident" id="4524052">token</span><span class="op" id="4524057">.</span><span class="ident" id="4524058">RPAREN</span>&nbsp;<span class="op" id="4524065">&amp;&amp;</span>&nbsp;<span class="ident" id="4524068">p</span><span class="op" id="4524069">.</span><span class="ident" id="4524070">tok</span>&nbsp;<span class="op" id="4524074">!=</span>&nbsp;<span class="ident" id="4524077">token</span><span class="op" id="4524082">.</span><span class="ident" id="4524083">EOF</span><span class="op" id="4524086">;</span>&nbsp;<span class="ident" id="4524088">iota</span><span class="op" id="4524092">++</span>&nbsp;<span class="op" id="4524095">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524100">list</span>&nbsp;<span class="op" id="4524105">=</span>&nbsp;<span class="builtinfunc" id="4524107">append</span><span class="op" id="4524113">(</span><span class="ident" id="4524114">list</span><span class="op" id="4524118">,</span>&nbsp;<span class="ident" id="4524120">f</span><span class="op" id="4524121">(</span><span class="ident" id="4524122">p</span><span class="op" id="4524123">.</span><span class="ident" id="4524124">leadComment</span><span class="op" id="4524135">,</span>&nbsp;<span class="ident" id="4524137">keyword</span><span class="op" id="4524144">,</span>&nbsp;<span class="ident" id="4524146">iota</span><span class="op" id="4524150">)</span><span class="op" id="4524151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524159">rparen</span>&nbsp;<span class="op" id="4524166">=</span>&nbsp;<span class="ident" id="4524168">p</span><span class="op" id="4524169">.</span><span class="ident" id="4524170">expect</span><span class="op" id="4524176">(</span><span class="ident" id="4524177">token</span><span class="op" id="4524182">.</span><span class="ident" id="4524183">RPAREN</span><span class="op" id="4524189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524193">p</span><span class="op" id="4524194">.</span><span class="ident" id="4524195">expectSemi</span><span class="op" id="4524205">(</span><span class="op" id="4524206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524209">}</span>&nbsp;<span class="keyword" id="4524211">else</span>&nbsp;<span class="op" id="4524216">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524220">list</span>&nbsp;<span class="op" id="4524225">=</span>&nbsp;<span class="builtinfunc" id="4524227">append</span><span class="op" id="4524233">(</span><span class="ident" id="4524234">list</span><span class="op" id="4524238">,</span>&nbsp;<span class="ident" id="4524240">f</span><span class="op" id="4524241">(</span><span class="ident" id="4524242">nil</span><span class="op" id="4524245">,</span>&nbsp;<span class="ident" id="4524247">keyword</span><span class="op" id="4524254">,</span>&nbsp;<span class="num" id="4524256">0</span><span class="op" id="4524257">)</span><span class="op" id="4524258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524265">return</span>&nbsp;<span class="op" id="4524272">&amp;</span><span class="ident" id="4524273">ast</span><span class="op" id="4524276">.</span><span class="ident" id="4524277">GenDecl</span><span class="op" id="4524284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524288">Doc</span><span class="op" id="4524291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524296">doc</span><span class="op" id="4524299">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524303">TokPos</span><span class="op" id="4524309">:</span>&nbsp;<span class="ident" id="4524311">pos</span><span class="op" id="4524314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524318">Tok</span><span class="op" id="4524321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524326">keyword</span><span class="op" id="4524333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524337">Lparen</span><span class="op" id="4524343">:</span>&nbsp;<span class="ident" id="4524345">lparen</span><span class="op" id="4524351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524355">Specs</span><span class="op" id="4524360">:</span>&nbsp;&nbsp;<span class="ident" id="4524363">list</span><span class="op" id="4524367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524371">Rparen</span><span class="op" id="4524377">:</span>&nbsp;<span class="ident" id="4524379">rparen</span><span class="op" id="4524385">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524388">}</span><br>
<span class="lineno"></span><span class="op" id="4524390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4524393">func</span>&nbsp;<span class="op" id="4524398">(</span><span class="ident" id="4524399">p</span>&nbsp;<span class="op" id="4524401">*</span><span class="ident" id="4524402">parser</span><span class="op" id="4524408">)</span>&nbsp;<span class="ident" id="4524410">parseFuncDecl</span><span class="op" id="4524423">(</span><span class="op" id="4524424">)</span>&nbsp;<span class="op" id="4524426">*</span><span class="ident" id="4524427">ast</span><span class="op" id="4524430">.</span><span class="ident" id="4524431">FuncDecl</span>&nbsp;<span class="op" id="4524440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524443">if</span>&nbsp;<span class="ident" id="4524446">p</span><span class="op" id="4524447">.</span><span class="ident" id="4524448">trace</span>&nbsp;<span class="op" id="4524454">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524458">defer</span>&nbsp;<span class="ident" id="4524464">un</span><span class="op" id="4524466">(</span><span class="ident" id="4524467">trace</span><span class="op" id="4524472">(</span><span class="ident" id="4524473">p</span><span class="op" id="4524474">,</span>&nbsp;<span class="string" id="4524476">&#34;FunctionDecl&#34;</span><span class="op" id="4524490">)</span><span class="op" id="4524491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524498">doc</span>&nbsp;<span class="op" id="4524502">:=</span>&nbsp;<span class="ident" id="4524505">p</span><span class="op" id="4524506">.</span><span class="ident" id="4524507">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524520">pos</span>&nbsp;<span class="op" id="4524524">:=</span>&nbsp;<span class="ident" id="4524527">p</span><span class="op" id="4524528">.</span><span class="ident" id="4524529">expect</span><span class="op" id="4524535">(</span><span class="ident" id="4524536">token</span><span class="op" id="4524541">.</span><span class="ident" id="4524542">FUNC</span><span class="op" id="4524546">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524549">scope</span>&nbsp;<span class="op" id="4524555">:=</span>&nbsp;<span class="ident" id="4524558">ast</span><span class="op" id="4524561">.</span><span class="ident" id="4524562">NewScope</span><span class="op" id="4524570">(</span><span class="ident" id="4524571">p</span><span class="op" id="4524572">.</span><span class="ident" id="4524573">topScope</span><span class="op" id="4524581">)</span>&nbsp;<span class="comment" id="4524583">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524603">var</span>&nbsp;<span class="ident" id="4524607">recv</span>&nbsp;<span class="op" id="4524612">*</span><span class="ident" id="4524613">ast</span><span class="op" id="4524616">.</span><span class="ident" id="4524617">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524628">if</span>&nbsp;<span class="ident" id="4524631">p</span><span class="op" id="4524632">.</span><span class="ident" id="4524633">tok</span>&nbsp;<span class="op" id="4524637">==</span>&nbsp;<span class="ident" id="4524640">token</span><span class="op" id="4524645">.</span><span class="ident" id="4524646">LPAREN</span>&nbsp;<span class="op" id="4524653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524657">recv</span>&nbsp;<span class="op" id="4524662">=</span>&nbsp;<span class="ident" id="4524664">p</span><span class="op" id="4524665">.</span><span class="ident" id="4524666">parseParameters</span><span class="op" id="4524681">(</span><span class="ident" id="4524682">scope</span><span class="op" id="4524687">,</span>&nbsp;<span class="builtintype" id="4524689">false</span><span class="op" id="4524694">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524701">ident</span>&nbsp;<span class="op" id="4524707">:=</span>&nbsp;<span class="ident" id="4524710">p</span><span class="op" id="4524711">.</span><span class="ident" id="4524712">parseIdent</span><span class="op" id="4524722">(</span><span class="op" id="4524723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524727">params</span><span class="op" id="4524733">,</span>&nbsp;<span class="ident" id="4524735">results</span>&nbsp;<span class="op" id="4524743">:=</span>&nbsp;<span class="ident" id="4524746">p</span><span class="op" id="4524747">.</span><span class="ident" id="4524748">parseSignature</span><span class="op" id="4524762">(</span><span class="ident" id="4524763">scope</span><span class="op" id="4524768">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524772">var</span>&nbsp;<span class="ident" id="4524776">body</span>&nbsp;<span class="op" id="4524781">*</span><span class="ident" id="4524782">ast</span><span class="op" id="4524785">.</span><span class="ident" id="4524786">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4524797">if</span>&nbsp;<span class="ident" id="4524800">p</span><span class="op" id="4524801">.</span><span class="ident" id="4524802">tok</span>&nbsp;<span class="op" id="4524806">==</span>&nbsp;<span class="ident" id="4524809">token</span><span class="op" id="4524814">.</span><span class="ident" id="4524815">LBRACE</span>&nbsp;<span class="op" id="4524822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524826">body</span>&nbsp;<span class="op" id="4524831">=</span>&nbsp;<span class="ident" id="4524833">p</span><span class="op" id="4524834">.</span><span class="ident" id="4524835">parseBody</span><span class="op" id="4524844">(</span><span class="ident" id="4524845">scope</span><span class="op" id="4524850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4524853">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524856">p</span><span class="op" id="4524857">.</span><span class="ident" id="4524858">expectSemi</span><span class="op" id="4524868">(</span><span class="op" id="4524869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524873">decl</span>&nbsp;<span class="op" id="4524878">:=</span>&nbsp;<span class="op" id="4524881">&amp;</span><span class="ident" id="4524882">ast</span><span class="op" id="4524885">.</span><span class="ident" id="4524886">FuncDecl</span><span class="op" id="4524894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524898">Doc</span><span class="op" id="4524901">:</span>&nbsp;&nbsp;<span class="ident" id="4524904">doc</span><span class="op" id="4524907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524911">Recv</span><span class="op" id="4524915">:</span>&nbsp;<span class="ident" id="4524917">recv</span><span class="op" id="4524921">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524925">Name</span><span class="op" id="4524929">:</span>&nbsp;<span class="ident" id="4524931">ident</span><span class="op" id="4524936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524940">Type</span><span class="op" id="4524944">:</span>&nbsp;<span class="op" id="4524946">&amp;</span><span class="ident" id="4524947">ast</span><span class="op" id="4524950">.</span><span class="ident" id="4524951">FuncType</span><span class="op" id="4524959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524964">Func</span><span class="op" id="4524968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524973">pos</span><span class="op" id="4524976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4524981">Params</span><span class="op" id="4524987">:</span>&nbsp;&nbsp;<span class="ident" id="4524990">params</span><span class="op" id="4524996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525001">Results</span><span class="op" id="4525008">:</span>&nbsp;<span class="ident" id="4525010">results</span><span class="op" id="4525017">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525021">}</span><span class="op" id="4525022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525026">Body</span><span class="op" id="4525030">:</span>&nbsp;<span class="ident" id="4525032">body</span><span class="op" id="4525036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525042">if</span>&nbsp;<span class="ident" id="4525045">recv</span>&nbsp;<span class="op" id="4525050">==</span>&nbsp;<span class="ident" id="4525053">nil</span>&nbsp;<span class="op" id="4525057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525061">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525129">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525195">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525245">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525250">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4525308">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525363">if</span>&nbsp;<span class="ident" id="4525366">ident</span><span class="op" id="4525371">.</span><span class="ident" id="4525372">Name</span>&nbsp;<span class="op" id="4525377">!=</span>&nbsp;<span class="string" id="4525380">&#34;init&#34;</span>&nbsp;<span class="op" id="4525387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525392">p</span><span class="op" id="4525393">.</span><span class="ident" id="4525394">declare</span><span class="op" id="4525401">(</span><span class="ident" id="4525402">decl</span><span class="op" id="4525406">,</span>&nbsp;<span class="ident" id="4525408">nil</span><span class="op" id="4525411">,</span>&nbsp;<span class="ident" id="4525413">p</span><span class="op" id="4525414">.</span><span class="ident" id="4525415">pkgScope</span><span class="op" id="4525423">,</span>&nbsp;<span class="ident" id="4525425">ast</span><span class="op" id="4525428">.</span><span class="ident" id="4525429">Fun</span><span class="op" id="4525432">,</span>&nbsp;<span class="ident" id="4525434">ident</span><span class="op" id="4525439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525450">return</span>&nbsp;<span class="ident" id="4525457">decl</span><br>
<span class="lineno"></span><span class="op" id="4525462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4525465">func</span>&nbsp;<span class="op" id="4525470">(</span><span class="ident" id="4525471">p</span>&nbsp;<span class="op" id="4525473">*</span><span class="ident" id="4525474">parser</span><span class="op" id="4525480">)</span>&nbsp;<span class="ident" id="4525482">parseDecl</span><span class="op" id="4525491">(</span><span class="ident" id="4525492">sync</span>&nbsp;<span class="keyword" id="4525497">func</span><span class="op" id="4525501">(</span><span class="op" id="4525502">*</span><span class="ident" id="4525503">parser</span><span class="op" id="4525509">)</span><span class="op" id="4525510">)</span>&nbsp;<span class="ident" id="4525512">ast</span><span class="op" id="4525515">.</span><span class="ident" id="4525516">Decl</span>&nbsp;<span class="op" id="4525521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525524">if</span>&nbsp;<span class="ident" id="4525527">p</span><span class="op" id="4525528">.</span><span class="ident" id="4525529">trace</span>&nbsp;<span class="op" id="4525535">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525539">defer</span>&nbsp;<span class="ident" id="4525545">un</span><span class="op" id="4525547">(</span><span class="ident" id="4525548">trace</span><span class="op" id="4525553">(</span><span class="ident" id="4525554">p</span><span class="op" id="4525555">,</span>&nbsp;<span class="string" id="4525557">&#34;Declaration&#34;</span><span class="op" id="4525570">)</span><span class="op" id="4525571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525578">var</span>&nbsp;<span class="ident" id="4525582">f</span>&nbsp;<span class="ident" id="4525584">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525603">switch</span>&nbsp;<span class="ident" id="4525610">p</span><span class="op" id="4525611">.</span><span class="ident" id="4525612">tok</span>&nbsp;<span class="op" id="4525616">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525619">case</span>&nbsp;<span class="ident" id="4525624">token</span><span class="op" id="4525629">.</span><span class="ident" id="4525630">CONST</span><span class="op" id="4525635">,</span>&nbsp;<span class="ident" id="4525637">token</span><span class="op" id="4525642">.</span><span class="ident" id="4525643">VAR</span><span class="op" id="4525646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525650">f</span>&nbsp;<span class="op" id="4525652">=</span>&nbsp;<span class="ident" id="4525654">p</span><span class="op" id="4525655">.</span><span class="ident" id="4525656">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525673">case</span>&nbsp;<span class="ident" id="4525678">token</span><span class="op" id="4525683">.</span><span class="ident" id="4525684">TYPE</span><span class="op" id="4525688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525692">f</span>&nbsp;<span class="op" id="4525694">=</span>&nbsp;<span class="ident" id="4525696">p</span><span class="op" id="4525697">.</span><span class="ident" id="4525698">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525714">case</span>&nbsp;<span class="ident" id="4525719">token</span><span class="op" id="4525724">.</span><span class="ident" id="4525725">FUNC</span><span class="op" id="4525729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525733">return</span>&nbsp;<span class="ident" id="4525740">p</span><span class="op" id="4525741">.</span><span class="ident" id="4525742">parseFuncDecl</span><span class="op" id="4525755">(</span><span class="op" id="4525756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525760">default</span><span class="op" id="4525767">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525771">pos</span>&nbsp;<span class="op" id="4525775">:=</span>&nbsp;<span class="ident" id="4525778">p</span><span class="op" id="4525779">.</span><span class="ident" id="4525780">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525786">p</span><span class="op" id="4525787">.</span><span class="ident" id="4525788">errorExpected</span><span class="op" id="4525801">(</span><span class="ident" id="4525802">pos</span><span class="op" id="4525805">,</span>&nbsp;<span class="string" id="4525807">&#34;declaration&#34;</span><span class="op" id="4525820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4525824">sync</span><span class="op" id="4525828">(</span><span class="ident" id="4525829">p</span><span class="op" id="4525830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525834">return</span>&nbsp;<span class="op" id="4525841">&amp;</span><span class="ident" id="4525842">ast</span><span class="op" id="4525845">.</span><span class="ident" id="4525846">BadDecl</span><span class="op" id="4525853">{</span><span class="ident" id="4525854">From</span><span class="op" id="4525858">:</span>&nbsp;<span class="ident" id="4525860">pos</span><span class="op" id="4525863">,</span>&nbsp;<span class="ident" id="4525865">To</span><span class="op" id="4525867">:</span>&nbsp;<span class="ident" id="4525869">p</span><span class="op" id="4525870">.</span><span class="ident" id="4525871">pos</span><span class="op" id="4525874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4525877">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4525881">return</span>&nbsp;<span class="ident" id="4525888">p</span><span class="op" id="4525889">.</span><span class="ident" id="4525890">parseGenDecl</span><span class="op" id="4525902">(</span><span class="ident" id="4525903">p</span><span class="op" id="4525904">.</span><span class="ident" id="4525905">tok</span><span class="op" id="4525908">,</span>&nbsp;<span class="ident" id="4525910">f</span><span class="op" id="4525911">)</span><br>
<span class="lineno"></span><span class="op" id="4525913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4525916">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="4525996">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4526013">func</span>&nbsp;<span class="op" id="4526018">(</span><span class="ident" id="4526019">p</span>&nbsp;<span class="op" id="4526021">*</span><span class="ident" id="4526022">parser</span><span class="op" id="4526028">)</span>&nbsp;<span class="ident" id="4526030">parseFile</span><span class="op" id="4526039">(</span><span class="op" id="4526040">)</span>&nbsp;<span class="op" id="4526042">*</span><span class="ident" id="4526043">ast</span><span class="op" id="4526046">.</span><span class="ident" id="4526047">File</span>&nbsp;<span class="op" id="4526052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526055">if</span>&nbsp;<span class="ident" id="4526058">p</span><span class="op" id="4526059">.</span><span class="ident" id="4526060">trace</span>&nbsp;<span class="op" id="4526066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526070">defer</span>&nbsp;<span class="ident" id="4526076">un</span><span class="op" id="4526078">(</span><span class="ident" id="4526079">trace</span><span class="op" id="4526084">(</span><span class="ident" id="4526085">p</span><span class="op" id="4526086">,</span>&nbsp;<span class="string" id="4526088">&#34;File&#34;</span><span class="op" id="4526094">)</span><span class="op" id="4526095">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4526098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526102">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526179">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526219">if</span>&nbsp;<span class="ident" id="4526222">p</span><span class="op" id="4526223">.</span><span class="ident" id="4526224">errors</span><span class="op" id="4526230">.</span><span class="ident" id="4526231">Len</span><span class="op" id="4526234">(</span><span class="op" id="4526235">)</span>&nbsp;<span class="op" id="4526237">!=</span>&nbsp;<span class="num" id="4526240">0</span>&nbsp;<span class="op" id="4526242">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526246">return</span>&nbsp;<span class="ident" id="4526253">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4526258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526262">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526281">doc</span>&nbsp;<span class="op" id="4526285">:=</span>&nbsp;<span class="ident" id="4526288">p</span><span class="op" id="4526289">.</span><span class="ident" id="4526290">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526303">pos</span>&nbsp;<span class="op" id="4526307">:=</span>&nbsp;<span class="ident" id="4526310">p</span><span class="op" id="4526311">.</span><span class="ident" id="4526312">expect</span><span class="op" id="4526318">(</span><span class="ident" id="4526319">token</span><span class="op" id="4526324">.</span><span class="ident" id="4526325">PACKAGE</span><span class="op" id="4526332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526335">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526389">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526440">ident</span>&nbsp;<span class="op" id="4526446">:=</span>&nbsp;<span class="ident" id="4526449">p</span><span class="op" id="4526450">.</span><span class="ident" id="4526451">parseIdent</span><span class="op" id="4526461">(</span><span class="op" id="4526462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526465">if</span>&nbsp;<span class="ident" id="4526468">ident</span><span class="op" id="4526473">.</span><span class="ident" id="4526474">Name</span>&nbsp;<span class="op" id="4526479">==</span>&nbsp;<span class="string" id="4526482">&#34;_&#34;</span>&nbsp;<span class="op" id="4526486">&amp;&amp;</span>&nbsp;<span class="ident" id="4526489">p</span><span class="op" id="4526490">.</span><span class="ident" id="4526491">mode</span><span class="op" id="4526495">&amp;</span><span class="ident" id="4526496">DeclarationErrors</span>&nbsp;<span class="op" id="4526514">!=</span>&nbsp;<span class="num" id="4526517">0</span>&nbsp;<span class="op" id="4526519">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526523">p</span><span class="op" id="4526524">.</span><span class="builtintype" id="4526525">error</span><span class="op" id="4526530">(</span><span class="ident" id="4526531">p</span><span class="op" id="4526532">.</span><span class="ident" id="4526533">pos</span><span class="op" id="4526536">,</span>&nbsp;<span class="string" id="4526538">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="4526562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4526565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526568">p</span><span class="op" id="4526569">.</span><span class="ident" id="4526570">expectSemi</span><span class="op" id="4526580">(</span><span class="op" id="4526581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526585">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526664">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526704">if</span>&nbsp;<span class="ident" id="4526707">p</span><span class="op" id="4526708">.</span><span class="ident" id="4526709">errors</span><span class="op" id="4526715">.</span><span class="ident" id="4526716">Len</span><span class="op" id="4526719">(</span><span class="op" id="4526720">)</span>&nbsp;<span class="op" id="4526722">!=</span>&nbsp;<span class="num" id="4526725">0</span>&nbsp;<span class="op" id="4526727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526731">return</span>&nbsp;<span class="ident" id="4526738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4526743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526747">p</span><span class="op" id="4526748">.</span><span class="ident" id="4526749">openScope</span><span class="op" id="4526758">(</span><span class="op" id="4526759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526762">p</span><span class="op" id="4526763">.</span><span class="ident" id="4526764">pkgScope</span>&nbsp;<span class="op" id="4526773">=</span>&nbsp;<span class="ident" id="4526775">p</span><span class="op" id="4526776">.</span><span class="ident" id="4526777">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526787">var</span>&nbsp;<span class="ident" id="4526791">decls</span>&nbsp;<span class="op" id="4526797">[</span><span class="op" id="4526798">]</span><span class="ident" id="4526799">ast</span><span class="op" id="4526802">.</span><span class="ident" id="4526803">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526809">if</span>&nbsp;<span class="ident" id="4526812">p</span><span class="op" id="4526813">.</span><span class="ident" id="4526814">mode</span><span class="op" id="4526818">&amp;</span><span class="ident" id="4526819">PackageClauseOnly</span>&nbsp;<span class="op" id="4526837">==</span>&nbsp;<span class="num" id="4526840">0</span>&nbsp;<span class="op" id="4526842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4526846">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526864">for</span>&nbsp;<span class="ident" id="4526868">p</span><span class="op" id="4526869">.</span><span class="ident" id="4526870">tok</span>&nbsp;<span class="op" id="4526874">==</span>&nbsp;<span class="ident" id="4526877">token</span><span class="op" id="4526882">.</span><span class="ident" id="4526883">IMPORT</span>&nbsp;<span class="op" id="4526890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4526895">decls</span>&nbsp;<span class="op" id="4526901">=</span>&nbsp;<span class="builtinfunc" id="4526903">append</span><span class="op" id="4526909">(</span><span class="ident" id="4526910">decls</span><span class="op" id="4526915">,</span>&nbsp;<span class="ident" id="4526917">p</span><span class="op" id="4526918">.</span><span class="ident" id="4526919">parseGenDecl</span><span class="op" id="4526931">(</span><span class="ident" id="4526932">token</span><span class="op" id="4526937">.</span><span class="ident" id="4526938">IMPORT</span><span class="op" id="4526944">,</span>&nbsp;<span class="ident" id="4526946">p</span><span class="op" id="4526947">.</span><span class="ident" id="4526948">parseImportSpec</span><span class="op" id="4526963">)</span><span class="op" id="4526964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4526968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4526973">if</span>&nbsp;<span class="ident" id="4526976">p</span><span class="op" id="4526977">.</span><span class="ident" id="4526978">mode</span><span class="op" id="4526982">&amp;</span><span class="ident" id="4526983">ImportsOnly</span>&nbsp;<span class="op" id="4526995">==</span>&nbsp;<span class="num" id="4526998">0</span>&nbsp;<span class="op" id="4527000">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4527005">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4527032">for</span>&nbsp;<span class="ident" id="4527036">p</span><span class="op" id="4527037">.</span><span class="ident" id="4527038">tok</span>&nbsp;<span class="op" id="4527042">!=</span>&nbsp;<span class="ident" id="4527045">token</span><span class="op" id="4527050">.</span><span class="ident" id="4527051">EOF</span>&nbsp;<span class="op" id="4527055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527061">decls</span>&nbsp;<span class="op" id="4527067">=</span>&nbsp;<span class="builtinfunc" id="4527069">append</span><span class="op" id="4527075">(</span><span class="ident" id="4527076">decls</span><span class="op" id="4527081">,</span>&nbsp;<span class="ident" id="4527083">p</span><span class="op" id="4527084">.</span><span class="ident" id="4527085">parseDecl</span><span class="op" id="4527094">(</span><span class="ident" id="4527095">syncDecl</span><span class="op" id="4527103">)</span><span class="op" id="4527104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527113">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527119">p</span><span class="op" id="4527120">.</span><span class="ident" id="4527121">closeScope</span><span class="op" id="4527131">(</span><span class="op" id="4527132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527135">assert</span><span class="op" id="4527141">(</span><span class="ident" id="4527142">p</span><span class="op" id="4527143">.</span><span class="ident" id="4527144">topScope</span>&nbsp;<span class="op" id="4527153">==</span>&nbsp;<span class="ident" id="4527156">nil</span><span class="op" id="4527159">,</span>&nbsp;<span class="string" id="4527161">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4527180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527183">assert</span><span class="op" id="4527189">(</span><span class="ident" id="4527190">p</span><span class="op" id="4527191">.</span><span class="ident" id="4527192">labelScope</span>&nbsp;<span class="op" id="4527203">==</span>&nbsp;<span class="ident" id="4527206">nil</span><span class="op" id="4527209">,</span>&nbsp;<span class="string" id="4527211">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="4527236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4527240">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527292">i</span>&nbsp;<span class="op" id="4527294">:=</span>&nbsp;<span class="num" id="4527297">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4527300">for</span>&nbsp;<span class="ident" id="4527304">_</span><span class="op" id="4527305">,</span>&nbsp;<span class="ident" id="4527307">ident</span>&nbsp;<span class="op" id="4527313">:=</span>&nbsp;<span class="keyword" id="4527316">range</span>&nbsp;<span class="ident" id="4527322">p</span><span class="op" id="4527323">.</span><span class="ident" id="4527324">unresolved</span>&nbsp;<span class="op" id="4527335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4527339">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527373">assert</span><span class="op" id="4527379">(</span><span class="ident" id="4527380">ident</span><span class="op" id="4527385">.</span><span class="ident" id="4527386">Obj</span>&nbsp;<span class="op" id="4527390">==</span>&nbsp;<span class="ident" id="4527393">unresolved</span><span class="op" id="4527403">,</span>&nbsp;<span class="string" id="4527405">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="4527430">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527434">ident</span><span class="op" id="4527439">.</span><span class="ident" id="4527440">Obj</span>&nbsp;<span class="op" id="4527444">=</span>&nbsp;<span class="ident" id="4527446">p</span><span class="op" id="4527447">.</span><span class="ident" id="4527448">pkgScope</span><span class="op" id="4527456">.</span><span class="ident" id="4527457">Lookup</span><span class="op" id="4527463">(</span><span class="ident" id="4527464">ident</span><span class="op" id="4527469">.</span><span class="ident" id="4527470">Name</span><span class="op" id="4527474">)</span>&nbsp;<span class="comment" id="4527476">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4527514">if</span>&nbsp;<span class="ident" id="4527517">ident</span><span class="op" id="4527522">.</span><span class="ident" id="4527523">Obj</span>&nbsp;<span class="op" id="4527527">==</span>&nbsp;<span class="ident" id="4527530">nil</span>&nbsp;<span class="op" id="4527534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527539">p</span><span class="op" id="4527540">.</span><span class="ident" id="4527541">unresolved</span><span class="op" id="4527551">[</span><span class="ident" id="4527552">i</span><span class="op" id="4527553">]</span>&nbsp;<span class="op" id="4527555">=</span>&nbsp;<span class="ident" id="4527557">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527566">i</span><span class="op" id="4527567">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527572">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4527579">return</span>&nbsp;<span class="op" id="4527586">&amp;</span><span class="ident" id="4527587">ast</span><span class="op" id="4527590">.</span><span class="ident" id="4527591">File</span><span class="op" id="4527595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527599">Doc</span><span class="op" id="4527602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527611">doc</span><span class="op" id="4527614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527618">Package</span><span class="op" id="4527625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527630">pos</span><span class="op" id="4527633">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527637">Name</span><span class="op" id="4527641">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527649">ident</span><span class="op" id="4527654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527658">Decls</span><span class="op" id="4527663">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527670">decls</span><span class="op" id="4527675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527679">Scope</span><span class="op" id="4527684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527691">p</span><span class="op" id="4527692">.</span><span class="ident" id="4527693">pkgScope</span><span class="op" id="4527701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527705">Imports</span><span class="op" id="4527712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527717">p</span><span class="op" id="4527718">.</span><span class="ident" id="4527719">imports</span><span class="op" id="4527726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527730">Unresolved</span><span class="op" id="4527740">:</span>&nbsp;<span class="ident" id="4527742">p</span><span class="op" id="4527743">.</span><span class="ident" id="4527744">unresolved</span><span class="op" id="4527754">[</span><span class="num" id="4527755">0</span><span class="op" id="4527756">:</span><span class="ident" id="4527757">i</span><span class="op" id="4527758">]</span><span class="op" id="4527759">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4527763">Comments</span><span class="op" id="4527771">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4527775">p</span><span class="op" id="4527776">.</span><span class="ident" id="4527777">comments</span><span class="op" id="4527785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4527788">}</span><br>
<span class="lineno"></span><span class="op" id="4527790">}</span>
</div>
</body>
</html>
