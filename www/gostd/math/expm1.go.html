<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2124845">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2124900">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2124954">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2125005">package</span>&nbsp;<span class="ident" id="2125013">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2125019">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2125079">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2125139">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2125198">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2125228">//</span><br>
<span class="lineno"></span><span class="comment" id="2125231">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2125287">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2125356">//</span><br>
<span class="lineno">15</span><span class="comment" id="2125359">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2125418">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2125474">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2125531">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2125548">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2125604">//</span><br>
<span class="lineno"></span><span class="comment" id="2125607">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2125619">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2125670">//</span><br>
<span class="lineno"></span><span class="comment" id="2125673">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2125683">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2125711">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2125759">//</span><br>
<span class="lineno"></span><span class="comment" id="2125762">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2125820">//</span><br>
<span class="lineno">30</span><span class="comment" id="2125823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2125887">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2125951">//</span><br>
<span class="lineno"></span><span class="comment" id="2125954">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2126019">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2126053">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2126067">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2126132">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2126161">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2126219">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2126236">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2126294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2126355">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2126422">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2126487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2126550">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2126616">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2126651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2126722">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2126772">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2126822">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2126872">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2126922">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2126972">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2127039">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2127069">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2127122">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2127172">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2127217">//</span><br>
<span class="lineno"></span><span class="comment" id="2127220">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2127282">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2127351">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2127390">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2127454">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2127518">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2127582">//</span><br>
<span class="lineno"></span><span class="comment" id="2127585">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2127651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2127706">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2127754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2127818">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2127883">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2127901">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2127973">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2128045">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2128117">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2128189">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2128261">//</span><br>
<span class="lineno"></span><span class="comment" id="2128264">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2128291">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2128330">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2128359">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2128410">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2128467">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2128497">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2128566">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2128618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2128683">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2128754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2128789">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2128835">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2128894">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2128954">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2129025">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2129088">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2129133">//</span><br>
<span class="lineno"></span><span class="comment" id="2129136">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2129154">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2129200">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2129231">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2129286">//</span><br>
<span class="lineno"></span><span class="comment" id="2129289">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2129302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2129372">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2129412">//</span><br>
<span class="lineno">105</span><span class="comment" id="2129415">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2129430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2129454">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2129524">//</span><br>
<span class="lineno"></span><span class="comment" id="2129527">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2129541">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2129607">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2129671">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2129737">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2129781">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2129785">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2129849">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2129909">//</span><br>
<span class="lineno"></span><span class="comment" id="2129912">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2129934">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2129956">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2129976">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2129996">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2130041">func</span>&nbsp;<span class="ident" id="2130046">Expm1</span><span class="op" id="2130051">(</span><span class="ident" id="2130052">x</span>&nbsp;<span class="builtintype" id="2130054">float64</span><span class="op" id="2130061">)</span>&nbsp;<span class="builtintype" id="2130063">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2130072">func</span>&nbsp;<span class="ident" id="2130077">expm1</span><span class="op" id="2130082">(</span><span class="ident" id="2130083">x</span>&nbsp;<span class="builtintype" id="2130085">float64</span><span class="op" id="2130092">)</span>&nbsp;<span class="builtintype" id="2130094">float64</span>&nbsp;<span class="op" id="2130102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2130105">const</span>&nbsp;<span class="op" id="2130111">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130115">Othreshold</span>&nbsp;<span class="op" id="2130126">=</span>&nbsp;<span class="num" id="2130128">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2130155">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130179">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130190">=</span>&nbsp;<span class="num" id="2130192">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2130219">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130243">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2130254">=</span>&nbsp;<span class="num" id="2130256">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2130283">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130307">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130318">=</span>&nbsp;<span class="num" id="2130320">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2130347">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130371">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130382">=</span>&nbsp;<span class="num" id="2130384">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2130411">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130435">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130446">=</span>&nbsp;<span class="num" id="2130448">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2130475">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130499">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130510">=</span>&nbsp;<span class="num" id="2130512">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2130539">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130563">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2130574">=</span>&nbsp;<span class="num" id="2130576">1.0</span>&nbsp;<span class="op" id="2130580">/</span>&nbsp;<span class="op" id="2130582">(</span><span class="num" id="2130583">1</span>&nbsp;<span class="op" id="2130585">&lt;&lt;</span>&nbsp;<span class="num" id="2130588">54</span><span class="op" id="2130590">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2130603">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2130636">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130678">Q1</span>&nbsp;<span class="op" id="2130681">=</span>&nbsp;<span class="op" id="2130683">-</span><span class="num" id="2130684">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2130711">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130735">Q2</span>&nbsp;<span class="op" id="2130738">=</span>&nbsp;<span class="num" id="2130740">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2130768">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130792">Q3</span>&nbsp;<span class="op" id="2130795">=</span>&nbsp;<span class="op" id="2130797">-</span><span class="num" id="2130798">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2130825">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130849">Q4</span>&nbsp;<span class="op" id="2130852">=</span>&nbsp;<span class="num" id="2130854">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2130882">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2130906">Q5</span>&nbsp;<span class="op" id="2130909">=</span>&nbsp;<span class="op" id="2130911">-</span><span class="num" id="2130912">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2130939">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2130962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2130966">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2130984">switch</span>&nbsp;<span class="op" id="2130991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2130994">case</span>&nbsp;<span class="ident" id="2130999">IsInf</span><span class="op" id="2131004">(</span><span class="ident" id="2131005">x</span><span class="op" id="2131006">,</span>&nbsp;<span class="num" id="2131008">1</span><span class="op" id="2131009">)</span>&nbsp;<span class="op" id="2131011">||</span>&nbsp;<span class="ident" id="2131014">IsNaN</span><span class="op" id="2131019">(</span><span class="ident" id="2131020">x</span><span class="op" id="2131021">)</span><span class="op" id="2131022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131026">return</span>&nbsp;<span class="ident" id="2131033">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131036">case</span>&nbsp;<span class="ident" id="2131041">IsInf</span><span class="op" id="2131046">(</span><span class="ident" id="2131047">x</span><span class="op" id="2131048">,</span>&nbsp;<span class="op" id="2131050">-</span><span class="num" id="2131051">1</span><span class="op" id="2131052">)</span><span class="op" id="2131053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131057">return</span>&nbsp;<span class="op" id="2131064">-</span><span class="num" id="2131065">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131072">absx</span>&nbsp;<span class="op" id="2131077">:=</span>&nbsp;<span class="ident" id="2131080">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131083">sign</span>&nbsp;<span class="op" id="2131088">:=</span>&nbsp;<span class="builtintype" id="2131091">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131098">if</span>&nbsp;<span class="ident" id="2131101">x</span>&nbsp;<span class="op" id="2131103">&lt;</span>&nbsp;<span class="num" id="2131105">0</span>&nbsp;<span class="op" id="2131107">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131111">absx</span>&nbsp;<span class="op" id="2131116">=</span>&nbsp;<span class="op" id="2131118">-</span><span class="ident" id="2131119">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131126">sign</span>&nbsp;<span class="op" id="2131131">=</span>&nbsp;<span class="builtintype" id="2131133">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2131143">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131172">if</span>&nbsp;<span class="ident" id="2131175">absx</span>&nbsp;<span class="op" id="2131180">&gt;=</span>&nbsp;<span class="ident" id="2131183">Ln2X56</span>&nbsp;<span class="op" id="2131190">{</span>&nbsp;<span class="comment" id="2131192">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131216">if</span>&nbsp;<span class="ident" id="2131219">absx</span>&nbsp;<span class="op" id="2131224">&gt;=</span>&nbsp;<span class="ident" id="2131227">Othreshold</span>&nbsp;<span class="op" id="2131238">{</span>&nbsp;<span class="comment" id="2131240">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131266">return</span>&nbsp;<span class="ident" id="2131273">Inf</span><span class="op" id="2131276">(</span><span class="num" id="2131277">1</span><span class="op" id="2131278">)</span>&nbsp;<span class="comment" id="2131280">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131298">if</span>&nbsp;<span class="ident" id="2131301">sign</span>&nbsp;<span class="op" id="2131306">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131311">return</span>&nbsp;<span class="op" id="2131318">-</span><span class="num" id="2131319">1</span>&nbsp;<span class="comment" id="2131321">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2131358">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131381">var</span>&nbsp;<span class="ident" id="2131385">c</span>&nbsp;<span class="builtintype" id="2131387">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131396">var</span>&nbsp;<span class="ident" id="2131400">k</span>&nbsp;<span class="builtintype" id="2131402">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131407">if</span>&nbsp;<span class="ident" id="2131410">absx</span>&nbsp;<span class="op" id="2131415">&gt;</span>&nbsp;<span class="ident" id="2131417">Ln2Half</span>&nbsp;<span class="op" id="2131425">{</span>&nbsp;<span class="comment" id="2131427">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131452">var</span>&nbsp;<span class="ident" id="2131456">hi</span><span class="op" id="2131458">,</span>&nbsp;<span class="ident" id="2131460">lo</span>&nbsp;<span class="builtintype" id="2131463">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131473">if</span>&nbsp;<span class="ident" id="2131476">absx</span>&nbsp;<span class="op" id="2131481">&lt;</span>&nbsp;<span class="ident" id="2131483">Ln2HalfX3</span>&nbsp;<span class="op" id="2131493">{</span>&nbsp;<span class="comment" id="2131495">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131521">if</span>&nbsp;<span class="op" id="2131524">!</span><span class="ident" id="2131525">sign</span>&nbsp;<span class="op" id="2131530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131536">hi</span>&nbsp;<span class="op" id="2131539">=</span>&nbsp;<span class="ident" id="2131541">x</span>&nbsp;<span class="op" id="2131543">-</span>&nbsp;<span class="ident" id="2131545">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131555">lo</span>&nbsp;<span class="op" id="2131558">=</span>&nbsp;<span class="ident" id="2131560">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131570">k</span>&nbsp;<span class="op" id="2131572">=</span>&nbsp;<span class="num" id="2131574">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131579">}</span>&nbsp;<span class="keyword" id="2131581">else</span>&nbsp;<span class="op" id="2131586">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131592">hi</span>&nbsp;<span class="op" id="2131595">=</span>&nbsp;<span class="ident" id="2131597">x</span>&nbsp;<span class="op" id="2131599">+</span>&nbsp;<span class="ident" id="2131601">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131611">lo</span>&nbsp;<span class="op" id="2131614">=</span>&nbsp;<span class="op" id="2131616">-</span><span class="ident" id="2131617">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131627">k</span>&nbsp;<span class="op" id="2131629">=</span>&nbsp;<span class="op" id="2131631">-</span><span class="num" id="2131632">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131641">}</span>&nbsp;<span class="keyword" id="2131643">else</span>&nbsp;<span class="op" id="2131648">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131653">if</span>&nbsp;<span class="op" id="2131656">!</span><span class="ident" id="2131657">sign</span>&nbsp;<span class="op" id="2131662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131668">k</span>&nbsp;<span class="op" id="2131670">=</span>&nbsp;<span class="builtintype" id="2131672">int</span><span class="op" id="2131675">(</span><span class="ident" id="2131676">InvLn2</span><span class="op" id="2131682">*</span><span class="ident" id="2131683">x</span>&nbsp;<span class="op" id="2131685">+</span>&nbsp;<span class="num" id="2131687">0.5</span><span class="op" id="2131690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131695">}</span>&nbsp;<span class="keyword" id="2131697">else</span>&nbsp;<span class="op" id="2131702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131708">k</span>&nbsp;<span class="op" id="2131710">=</span>&nbsp;<span class="builtintype" id="2131712">int</span><span class="op" id="2131715">(</span><span class="ident" id="2131716">InvLn2</span><span class="op" id="2131722">*</span><span class="ident" id="2131723">x</span>&nbsp;<span class="op" id="2131725">-</span>&nbsp;<span class="num" id="2131727">0.5</span><span class="op" id="2131730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131735">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131740">t</span>&nbsp;<span class="op" id="2131742">:=</span>&nbsp;<span class="builtintype" id="2131745">float64</span><span class="op" id="2131752">(</span><span class="ident" id="2131753">k</span><span class="op" id="2131754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131759">hi</span>&nbsp;<span class="op" id="2131762">=</span>&nbsp;<span class="ident" id="2131764">x</span>&nbsp;<span class="op" id="2131766">-</span>&nbsp;<span class="ident" id="2131768">t</span><span class="op" id="2131769">*</span><span class="ident" id="2131770">Ln2Hi</span>&nbsp;<span class="comment" id="2131776">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131806">lo</span>&nbsp;<span class="op" id="2131809">=</span>&nbsp;<span class="ident" id="2131811">t</span>&nbsp;<span class="op" id="2131813">*</span>&nbsp;<span class="ident" id="2131815">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131827">x</span>&nbsp;<span class="op" id="2131829">=</span>&nbsp;<span class="ident" id="2131831">hi</span>&nbsp;<span class="op" id="2131834">-</span>&nbsp;<span class="ident" id="2131836">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131841">c</span>&nbsp;<span class="op" id="2131843">=</span>&nbsp;<span class="op" id="2131845">(</span><span class="ident" id="2131846">hi</span>&nbsp;<span class="op" id="2131849">-</span>&nbsp;<span class="ident" id="2131851">x</span><span class="op" id="2131852">)</span>&nbsp;<span class="op" id="2131854">-</span>&nbsp;<span class="ident" id="2131856">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131860">}</span>&nbsp;<span class="keyword" id="2131862">else</span>&nbsp;<span class="keyword" id="2131867">if</span>&nbsp;<span class="ident" id="2131870">absx</span>&nbsp;<span class="op" id="2131875">&lt;</span>&nbsp;<span class="ident" id="2131877">Tiny</span>&nbsp;<span class="op" id="2131882">{</span>&nbsp;<span class="comment" id="2131884">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2131917">return</span>&nbsp;<span class="ident" id="2131924">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131927">}</span>&nbsp;<span class="keyword" id="2131929">else</span>&nbsp;<span class="op" id="2131934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131938">k</span>&nbsp;<span class="op" id="2131940">=</span>&nbsp;<span class="num" id="2131942">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2131945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2131949">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131979">hfx</span>&nbsp;<span class="op" id="2131983">:=</span>&nbsp;<span class="num" id="2131986">0.5</span>&nbsp;<span class="op" id="2131990">*</span>&nbsp;<span class="ident" id="2131992">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2131995">hxs</span>&nbsp;<span class="op" id="2131999">:=</span>&nbsp;<span class="ident" id="2132002">x</span>&nbsp;<span class="op" id="2132004">*</span>&nbsp;<span class="ident" id="2132006">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132011">r1</span>&nbsp;<span class="op" id="2132014">:=</span>&nbsp;<span class="num" id="2132017">1</span>&nbsp;<span class="op" id="2132019">+</span>&nbsp;<span class="ident" id="2132021">hxs</span><span class="op" id="2132024">*</span><span class="op" id="2132025">(</span><span class="ident" id="2132026">Q1</span><span class="op" id="2132028">+</span><span class="ident" id="2132029">hxs</span><span class="op" id="2132032">*</span><span class="op" id="2132033">(</span><span class="ident" id="2132034">Q2</span><span class="op" id="2132036">+</span><span class="ident" id="2132037">hxs</span><span class="op" id="2132040">*</span><span class="op" id="2132041">(</span><span class="ident" id="2132042">Q3</span><span class="op" id="2132044">+</span><span class="ident" id="2132045">hxs</span><span class="op" id="2132048">*</span><span class="op" id="2132049">(</span><span class="ident" id="2132050">Q4</span><span class="op" id="2132052">+</span><span class="ident" id="2132053">hxs</span><span class="op" id="2132056">*</span><span class="ident" id="2132057">Q5</span><span class="op" id="2132059">)</span><span class="op" id="2132060">)</span><span class="op" id="2132061">)</span><span class="op" id="2132062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132065">t</span>&nbsp;<span class="op" id="2132067">:=</span>&nbsp;<span class="num" id="2132070">3</span>&nbsp;<span class="op" id="2132072">-</span>&nbsp;<span class="ident" id="2132074">r1</span><span class="op" id="2132076">*</span><span class="ident" id="2132077">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132082">e</span>&nbsp;<span class="op" id="2132084">:=</span>&nbsp;<span class="ident" id="2132087">hxs</span>&nbsp;<span class="op" id="2132091">*</span>&nbsp;<span class="op" id="2132093">(</span><span class="op" id="2132094">(</span><span class="ident" id="2132095">r1</span>&nbsp;<span class="op" id="2132098">-</span>&nbsp;<span class="ident" id="2132100">t</span><span class="op" id="2132101">)</span>&nbsp;<span class="op" id="2132103">/</span>&nbsp;<span class="op" id="2132105">(</span><span class="num" id="2132106">6.0</span>&nbsp;<span class="op" id="2132110">-</span>&nbsp;<span class="ident" id="2132112">x</span><span class="op" id="2132113">*</span><span class="ident" id="2132114">t</span><span class="op" id="2132115">)</span><span class="op" id="2132116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132119">if</span>&nbsp;<span class="ident" id="2132122">k</span>&nbsp;<span class="op" id="2132124">!=</span>&nbsp;<span class="num" id="2132127">0</span>&nbsp;<span class="op" id="2132129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132133">e</span>&nbsp;<span class="op" id="2132135">=</span>&nbsp;<span class="op" id="2132137">(</span><span class="ident" id="2132138">x</span><span class="op" id="2132139">*</span><span class="op" id="2132140">(</span><span class="ident" id="2132141">e</span><span class="op" id="2132142">-</span><span class="ident" id="2132143">c</span><span class="op" id="2132144">)</span>&nbsp;<span class="op" id="2132146">-</span>&nbsp;<span class="ident" id="2132148">c</span><span class="op" id="2132149">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132153">e</span>&nbsp;<span class="op" id="2132155">-=</span>&nbsp;<span class="ident" id="2132158">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132164">switch</span>&nbsp;<span class="op" id="2132171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132175">case</span>&nbsp;<span class="ident" id="2132180">k</span>&nbsp;<span class="op" id="2132182">==</span>&nbsp;<span class="op" id="2132185">-</span><span class="num" id="2132186">1</span><span class="op" id="2132187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132192">return</span>&nbsp;<span class="num" id="2132199">0.5</span><span class="op" id="2132202">*</span><span class="op" id="2132203">(</span><span class="ident" id="2132204">x</span><span class="op" id="2132205">-</span><span class="ident" id="2132206">e</span><span class="op" id="2132207">)</span>&nbsp;<span class="op" id="2132209">-</span>&nbsp;<span class="num" id="2132211">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132217">case</span>&nbsp;<span class="ident" id="2132222">k</span>&nbsp;<span class="op" id="2132224">==</span>&nbsp;<span class="num" id="2132227">1</span><span class="op" id="2132228">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132233">if</span>&nbsp;<span class="ident" id="2132236">x</span>&nbsp;<span class="op" id="2132238">&lt;</span>&nbsp;<span class="op" id="2132240">-</span><span class="num" id="2132241">0.25</span>&nbsp;<span class="op" id="2132246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132252">return</span>&nbsp;<span class="op" id="2132259">-</span><span class="num" id="2132260">2</span>&nbsp;<span class="op" id="2132262">*</span>&nbsp;<span class="op" id="2132264">(</span><span class="ident" id="2132265">e</span>&nbsp;<span class="op" id="2132267">-</span>&nbsp;<span class="op" id="2132269">(</span><span class="ident" id="2132270">x</span>&nbsp;<span class="op" id="2132272">+</span>&nbsp;<span class="num" id="2132274">0.5</span><span class="op" id="2132277">)</span><span class="op" id="2132278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2132283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132288">return</span>&nbsp;<span class="num" id="2132295">1</span>&nbsp;<span class="op" id="2132297">+</span>&nbsp;<span class="num" id="2132299">2</span><span class="op" id="2132300">*</span><span class="op" id="2132301">(</span><span class="ident" id="2132302">x</span><span class="op" id="2132303">-</span><span class="ident" id="2132304">e</span><span class="op" id="2132305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132309">case</span>&nbsp;<span class="ident" id="2132314">k</span>&nbsp;<span class="op" id="2132316">&lt;=</span>&nbsp;<span class="op" id="2132319">-</span><span class="num" id="2132320">2</span>&nbsp;<span class="op" id="2132322">||</span>&nbsp;<span class="ident" id="2132325">k</span>&nbsp;<span class="op" id="2132327">&gt;</span>&nbsp;<span class="num" id="2132329">56</span><span class="op" id="2132331">:</span>&nbsp;<span class="comment" id="2132333">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132366">y</span>&nbsp;<span class="op" id="2132368">:=</span>&nbsp;<span class="num" id="2132371">1</span>&nbsp;<span class="op" id="2132373">-</span>&nbsp;<span class="op" id="2132375">(</span><span class="ident" id="2132376">e</span>&nbsp;<span class="op" id="2132378">-</span>&nbsp;<span class="ident" id="2132380">x</span><span class="op" id="2132381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132386">y</span>&nbsp;<span class="op" id="2132388">=</span>&nbsp;<span class="ident" id="2132390">Float64frombits</span><span class="op" id="2132405">(</span><span class="ident" id="2132406">Float64bits</span><span class="op" id="2132417">(</span><span class="ident" id="2132418">y</span><span class="op" id="2132419">)</span>&nbsp;<span class="op" id="2132421">+</span>&nbsp;<span class="ident" id="2132423">uint64</span><span class="op" id="2132429">(</span><span class="ident" id="2132430">k</span><span class="op" id="2132431">)</span><span class="op" id="2132432">&lt;&lt;</span><span class="num" id="2132434">52</span><span class="op" id="2132436">)</span>&nbsp;<span class="comment" id="2132438">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132466">return</span>&nbsp;<span class="ident" id="2132473">y</span>&nbsp;<span class="op" id="2132475">-</span>&nbsp;<span class="num" id="2132477">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2132481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132485">if</span>&nbsp;<span class="ident" id="2132488">k</span>&nbsp;<span class="op" id="2132490">&lt;</span>&nbsp;<span class="num" id="2132492">20</span>&nbsp;<span class="op" id="2132495">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132500">t</span>&nbsp;<span class="op" id="2132502">:=</span>&nbsp;<span class="ident" id="2132505">Float64frombits</span><span class="op" id="2132520">(</span><span class="num" id="2132521">0x3ff0000000000000</span>&nbsp;<span class="op" id="2132540">-</span>&nbsp;<span class="op" id="2132542">(</span><span class="num" id="2132543">0x20000000000000</span>&nbsp;<span class="op" id="2132560">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2132563">uint</span><span class="op" id="2132567">(</span><span class="ident" id="2132568">k</span><span class="op" id="2132569">)</span><span class="op" id="2132570">)</span><span class="op" id="2132571">)</span>&nbsp;<span class="comment" id="2132573">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132589">y</span>&nbsp;<span class="op" id="2132591">:=</span>&nbsp;<span class="ident" id="2132594">t</span>&nbsp;<span class="op" id="2132596">-</span>&nbsp;<span class="op" id="2132598">(</span><span class="ident" id="2132599">e</span>&nbsp;<span class="op" id="2132601">-</span>&nbsp;<span class="ident" id="2132603">x</span><span class="op" id="2132604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132609">y</span>&nbsp;<span class="op" id="2132611">=</span>&nbsp;<span class="ident" id="2132613">Float64frombits</span><span class="op" id="2132628">(</span><span class="ident" id="2132629">Float64bits</span><span class="op" id="2132640">(</span><span class="ident" id="2132641">y</span><span class="op" id="2132642">)</span>&nbsp;<span class="op" id="2132644">+</span>&nbsp;<span class="ident" id="2132646">uint64</span><span class="op" id="2132652">(</span><span class="ident" id="2132653">k</span><span class="op" id="2132654">)</span><span class="op" id="2132655">&lt;&lt;</span><span class="num" id="2132657">52</span><span class="op" id="2132659">)</span>&nbsp;<span class="comment" id="2132661">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132689">return</span>&nbsp;<span class="ident" id="2132696">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2132700">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132704">t</span>&nbsp;<span class="op" id="2132706">:=</span>&nbsp;<span class="ident" id="2132709">Float64frombits</span><span class="op" id="2132724">(</span><span class="ident" id="2132725">uint64</span><span class="op" id="2132731">(</span><span class="op" id="2132732">(</span><span class="num" id="2132733">0x3ff</span>&nbsp;<span class="op" id="2132739">-</span>&nbsp;<span class="ident" id="2132741">k</span><span class="op" id="2132742">)</span>&nbsp;<span class="op" id="2132744">&lt;&lt;</span>&nbsp;<span class="num" id="2132747">52</span><span class="op" id="2132749">)</span><span class="op" id="2132750">)</span>&nbsp;<span class="comment" id="2132752">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132763">y</span>&nbsp;<span class="op" id="2132765">:=</span>&nbsp;<span class="ident" id="2132768">x</span>&nbsp;<span class="op" id="2132770">-</span>&nbsp;<span class="op" id="2132772">(</span><span class="ident" id="2132773">e</span>&nbsp;<span class="op" id="2132775">+</span>&nbsp;<span class="ident" id="2132777">t</span><span class="op" id="2132778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132782">y</span>&nbsp;<span class="op" id="2132784">+=</span>&nbsp;<span class="num" id="2132787">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2132791">y</span>&nbsp;<span class="op" id="2132793">=</span>&nbsp;<span class="ident" id="2132795">Float64frombits</span><span class="op" id="2132810">(</span><span class="ident" id="2132811">Float64bits</span><span class="op" id="2132822">(</span><span class="ident" id="2132823">y</span><span class="op" id="2132824">)</span>&nbsp;<span class="op" id="2132826">+</span>&nbsp;<span class="ident" id="2132828">uint64</span><span class="op" id="2132834">(</span><span class="ident" id="2132835">k</span><span class="op" id="2132836">)</span><span class="op" id="2132837">&lt;&lt;</span><span class="num" id="2132839">52</span><span class="op" id="2132841">)</span>&nbsp;<span class="comment" id="2132843">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132870">return</span>&nbsp;<span class="ident" id="2132877">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2132880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2132883">return</span>&nbsp;<span class="ident" id="2132890">x</span>&nbsp;<span class="op" id="2132892">-</span>&nbsp;<span class="op" id="2132894">(</span><span class="ident" id="2132895">x</span><span class="op" id="2132896">*</span><span class="ident" id="2132897">e</span>&nbsp;<span class="op" id="2132899">-</span>&nbsp;<span class="ident" id="2132901">hxs</span><span class="op" id="2132904">)</span>&nbsp;<span class="comment" id="2132906">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2132916">}</span>
</div>
</body>
</html>
