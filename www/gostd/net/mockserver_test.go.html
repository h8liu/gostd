<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html" class="current">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6665997">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6666052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6666106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6666157">package</span>&nbsp;<span class="ident" id="6666165">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666170">import</span>&nbsp;<span class="string" id="6666177">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666185">type</span>&nbsp;<span class="ident" id="6666190">streamListener</span>&nbsp;<span class="keyword" id="6666205">struct</span>&nbsp;<span class="op" id="6666212">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666215">net</span><span class="op" id="6666218">,</span>&nbsp;<span class="ident" id="6666220">addr</span>&nbsp;<span class="builtintype" id="6666225">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666233">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6666243">Listener</span><br>
<span class="lineno"></span><span class="op" id="6666252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666255">type</span>&nbsp;<span class="ident" id="6666260">dualStackServer</span>&nbsp;<span class="keyword" id="6666276">struct</span>&nbsp;<span class="op" id="6666283">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666286">lnmu</span>&nbsp;<span class="ident" id="6666291">sync</span><span class="op" id="6666295">.</span><span class="ident" id="6666296">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666305">lns</span>&nbsp;&nbsp;<span class="op" id="6666310">[</span><span class="op" id="6666311">]</span><span class="ident" id="6666312">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666328">port</span>&nbsp;<span class="builtintype" id="6666333">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666342">cmu</span>&nbsp;<span class="ident" id="6666346">sync</span><span class="op" id="6666350">.</span><span class="ident" id="6666351">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666360">cs</span>&nbsp;&nbsp;<span class="op" id="6666364">[</span><span class="op" id="6666365">]</span><span class="ident" id="6666366">Conn</span>&nbsp;<span class="comment" id="6666371">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="6666423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666426">func</span>&nbsp;<span class="op" id="6666431">(</span><span class="ident" id="6666432">dss</span>&nbsp;<span class="op" id="6666436">*</span><span class="ident" id="6666437">dualStackServer</span><span class="op" id="6666452">)</span>&nbsp;<span class="ident" id="6666454">buildup</span><span class="op" id="6666461">(</span><span class="ident" id="6666462">server</span>&nbsp;<span class="keyword" id="6666469">func</span><span class="op" id="6666473">(</span><span class="op" id="6666474">*</span><span class="ident" id="6666475">dualStackServer</span><span class="op" id="6666490">,</span>&nbsp;<span class="ident" id="6666492">Listener</span><span class="op" id="6666500">)</span><span class="op" id="6666501">)</span>&nbsp;<span class="builtintype" id="6666503">error</span>&nbsp;<span class="op" id="6666509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666512">for</span>&nbsp;<span class="ident" id="6666516">i</span>&nbsp;<span class="op" id="6666518">:=</span>&nbsp;<span class="keyword" id="6666521">range</span>&nbsp;<span class="ident" id="6666527">dss</span><span class="op" id="6666530">.</span><span class="ident" id="6666531">lns</span>&nbsp;<span class="op" id="6666535">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666539">go</span>&nbsp;<span class="ident" id="6666542">server</span><span class="op" id="6666548">(</span><span class="ident" id="6666549">dss</span><span class="op" id="6666552">,</span>&nbsp;<span class="ident" id="6666554">dss</span><span class="op" id="6666557">.</span><span class="ident" id="6666558">lns</span><span class="op" id="6666561">[</span><span class="ident" id="6666562">i</span><span class="op" id="6666563">]</span><span class="op" id="6666564">.</span><span class="ident" id="6666565">ln</span><span class="op" id="6666567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666573">return</span>&nbsp;<span class="ident" id="6666580">nil</span><br>
<span class="lineno"></span><span class="op" id="6666584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6666587">func</span>&nbsp;<span class="op" id="6666592">(</span><span class="ident" id="6666593">dss</span>&nbsp;<span class="op" id="6666597">*</span><span class="ident" id="6666598">dualStackServer</span><span class="op" id="6666613">)</span>&nbsp;<span class="ident" id="6666615">putConn</span><span class="op" id="6666622">(</span><span class="ident" id="6666623">c</span>&nbsp;<span class="ident" id="6666625">Conn</span><span class="op" id="6666629">)</span>&nbsp;<span class="builtintype" id="6666631">error</span>&nbsp;<span class="op" id="6666637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666640">dss</span><span class="op" id="6666643">.</span><span class="ident" id="6666644">cmu</span><span class="op" id="6666647">.</span><span class="ident" id="6666648">Lock</span><span class="op" id="6666652">(</span><span class="op" id="6666653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666656">dss</span><span class="op" id="6666659">.</span><span class="ident" id="6666660">cs</span>&nbsp;<span class="op" id="6666663">=</span>&nbsp;<span class="builtinfunc" id="6666665">append</span><span class="op" id="6666671">(</span><span class="ident" id="6666672">dss</span><span class="op" id="6666675">.</span><span class="ident" id="6666676">cs</span><span class="op" id="6666678">,</span>&nbsp;<span class="ident" id="6666680">c</span><span class="op" id="6666681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666684">dss</span><span class="op" id="6666687">.</span><span class="ident" id="6666688">cmu</span><span class="op" id="6666691">.</span><span class="ident" id="6666692">Unlock</span><span class="op" id="6666698">(</span><span class="op" id="6666699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666702">return</span>&nbsp;<span class="ident" id="6666709">nil</span><br>
<span class="lineno">35</span><span class="op" id="6666713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666716">func</span>&nbsp;<span class="op" id="6666721">(</span><span class="ident" id="6666722">dss</span>&nbsp;<span class="op" id="6666726">*</span><span class="ident" id="6666727">dualStackServer</span><span class="op" id="6666742">)</span>&nbsp;<span class="ident" id="6666744">teardownNetwork</span><span class="op" id="6666759">(</span><span class="ident" id="6666760">net</span>&nbsp;<span class="builtintype" id="6666764">string</span><span class="op" id="6666770">)</span>&nbsp;<span class="builtintype" id="6666772">error</span>&nbsp;<span class="op" id="6666778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666781">dss</span><span class="op" id="6666784">.</span><span class="ident" id="6666785">lnmu</span><span class="op" id="6666789">.</span><span class="ident" id="6666790">Lock</span><span class="op" id="6666794">(</span><span class="op" id="6666795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666798">for</span>&nbsp;<span class="ident" id="6666802">i</span>&nbsp;<span class="op" id="6666804">:=</span>&nbsp;<span class="keyword" id="6666807">range</span>&nbsp;<span class="ident" id="6666813">dss</span><span class="op" id="6666816">.</span><span class="ident" id="6666817">lns</span>&nbsp;<span class="op" id="6666821">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666825">if</span>&nbsp;<span class="ident" id="6666828">net</span>&nbsp;<span class="op" id="6666832">==</span>&nbsp;<span class="ident" id="6666835">dss</span><span class="op" id="6666838">.</span><span class="ident" id="6666839">lns</span><span class="op" id="6666842">[</span><span class="ident" id="6666843">i</span><span class="op" id="6666844">]</span><span class="op" id="6666845">.</span><span class="ident" id="6666846">net</span>&nbsp;<span class="op" id="6666850">&amp;&amp;</span>&nbsp;<span class="ident" id="6666853">dss</span><span class="op" id="6666856">.</span><span class="ident" id="6666857">lns</span><span class="op" id="6666860">[</span><span class="ident" id="6666861">i</span><span class="op" id="6666862">]</span><span class="op" id="6666863">.</span><span class="ident" id="6666864">ln</span>&nbsp;<span class="op" id="6666867">!=</span>&nbsp;<span class="ident" id="6666870">nil</span>&nbsp;<span class="op" id="6666874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666879">dss</span><span class="op" id="6666882">.</span><span class="ident" id="6666883">lns</span><span class="op" id="6666886">[</span><span class="ident" id="6666887">i</span><span class="op" id="6666888">]</span><span class="op" id="6666889">.</span><span class="ident" id="6666890">ln</span><span class="op" id="6666892">.</span><span class="ident" id="6666893">Close</span><span class="op" id="6666898">(</span><span class="op" id="6666899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666904">dss</span><span class="op" id="6666907">.</span><span class="ident" id="6666908">lns</span><span class="op" id="6666911">[</span><span class="ident" id="6666912">i</span><span class="op" id="6666913">]</span><span class="op" id="6666914">.</span><span class="ident" id="6666915">ln</span>&nbsp;<span class="op" id="6666918">=</span>&nbsp;<span class="ident" id="6666920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666929">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666932">dss</span><span class="op" id="6666935">.</span><span class="ident" id="6666936">lnmu</span><span class="op" id="6666940">.</span><span class="ident" id="6666941">Unlock</span><span class="op" id="6666947">(</span><span class="op" id="6666948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666951">return</span>&nbsp;<span class="ident" id="6666958">nil</span><br>
<span class="lineno"></span><span class="op" id="6666962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6666965">func</span>&nbsp;<span class="op" id="6666970">(</span><span class="ident" id="6666971">dss</span>&nbsp;<span class="op" id="6666975">*</span><span class="ident" id="6666976">dualStackServer</span><span class="op" id="6666991">)</span>&nbsp;<span class="ident" id="6666993">teardown</span><span class="op" id="6667001">(</span><span class="op" id="6667002">)</span>&nbsp;<span class="builtintype" id="6667004">error</span>&nbsp;<span class="op" id="6667010">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667013">dss</span><span class="op" id="6667016">.</span><span class="ident" id="6667017">lnmu</span><span class="op" id="6667021">.</span><span class="ident" id="6667022">Lock</span><span class="op" id="6667026">(</span><span class="op" id="6667027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667030">for</span>&nbsp;<span class="ident" id="6667034">i</span>&nbsp;<span class="op" id="6667036">:=</span>&nbsp;<span class="keyword" id="6667039">range</span>&nbsp;<span class="ident" id="6667045">dss</span><span class="op" id="6667048">.</span><span class="ident" id="6667049">lns</span>&nbsp;<span class="op" id="6667053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667057">if</span>&nbsp;<span class="ident" id="6667060">dss</span><span class="op" id="6667063">.</span><span class="ident" id="6667064">lns</span><span class="op" id="6667067">[</span><span class="ident" id="6667068">i</span><span class="op" id="6667069">]</span><span class="op" id="6667070">.</span><span class="ident" id="6667071">ln</span>&nbsp;<span class="op" id="6667074">!=</span>&nbsp;<span class="ident" id="6667077">nil</span>&nbsp;<span class="op" id="6667081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667086">dss</span><span class="op" id="6667089">.</span><span class="ident" id="6667090">lns</span><span class="op" id="6667093">[</span><span class="ident" id="6667094">i</span><span class="op" id="6667095">]</span><span class="op" id="6667096">.</span><span class="ident" id="6667097">ln</span><span class="op" id="6667099">.</span><span class="ident" id="6667100">Close</span><span class="op" id="6667105">(</span><span class="op" id="6667106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667110">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667116">dss</span><span class="op" id="6667119">.</span><span class="ident" id="6667120">lnmu</span><span class="op" id="6667124">.</span><span class="ident" id="6667125">Unlock</span><span class="op" id="6667131">(</span><span class="op" id="6667132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667135">dss</span><span class="op" id="6667138">.</span><span class="ident" id="6667139">cmu</span><span class="op" id="6667142">.</span><span class="ident" id="6667143">Lock</span><span class="op" id="6667147">(</span><span class="op" id="6667148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667151">for</span>&nbsp;<span class="ident" id="6667155">_</span><span class="op" id="6667156">,</span>&nbsp;<span class="ident" id="6667158">c</span>&nbsp;<span class="op" id="6667160">:=</span>&nbsp;<span class="keyword" id="6667163">range</span>&nbsp;<span class="ident" id="6667169">dss</span><span class="op" id="6667172">.</span><span class="ident" id="6667173">cs</span>&nbsp;<span class="op" id="6667176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667180">c</span><span class="op" id="6667181">.</span><span class="ident" id="6667182">Close</span><span class="op" id="6667187">(</span><span class="op" id="6667188">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667194">dss</span><span class="op" id="6667197">.</span><span class="ident" id="6667198">cmu</span><span class="op" id="6667201">.</span><span class="ident" id="6667202">Unlock</span><span class="op" id="6667208">(</span><span class="op" id="6667209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667212">return</span>&nbsp;<span class="ident" id="6667219">nil</span><br>
<span class="lineno"></span><span class="op" id="6667223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6667226">func</span>&nbsp;<span class="ident" id="6667231">newDualStackServer</span><span class="op" id="6667249">(</span><span class="ident" id="6667250">lns</span>&nbsp;<span class="op" id="6667254">[</span><span class="op" id="6667255">]</span><span class="ident" id="6667256">streamListener</span><span class="op" id="6667270">)</span>&nbsp;<span class="op" id="6667272">(</span><span class="op" id="6667273">*</span><span class="ident" id="6667274">dualStackServer</span><span class="op" id="6667289">,</span>&nbsp;<span class="builtintype" id="6667291">error</span><span class="op" id="6667296">)</span>&nbsp;<span class="op" id="6667298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667301">dss</span>&nbsp;<span class="op" id="6667305">:=</span>&nbsp;<span class="op" id="6667308">&amp;</span><span class="ident" id="6667309">dualStackServer</span><span class="op" id="6667324">{</span><span class="ident" id="6667325">lns</span><span class="op" id="6667328">:</span>&nbsp;<span class="ident" id="6667330">lns</span><span class="op" id="6667333">,</span>&nbsp;<span class="ident" id="6667335">port</span><span class="op" id="6667339">:</span>&nbsp;<span class="string" id="6667341">&#34;0&#34;</span><span class="op" id="6667344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667347">for</span>&nbsp;<span class="ident" id="6667351">i</span>&nbsp;<span class="op" id="6667353">:=</span>&nbsp;<span class="keyword" id="6667356">range</span>&nbsp;<span class="ident" id="6667362">dss</span><span class="op" id="6667365">.</span><span class="ident" id="6667366">lns</span>&nbsp;<span class="op" id="6667370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667374">ln</span><span class="op" id="6667376">,</span>&nbsp;<span class="ident" id="6667378">err</span>&nbsp;<span class="op" id="6667382">:=</span>&nbsp;<span class="ident" id="6667385">Listen</span><span class="op" id="6667391">(</span><span class="ident" id="6667392">dss</span><span class="op" id="6667395">.</span><span class="ident" id="6667396">lns</span><span class="op" id="6667399">[</span><span class="ident" id="6667400">i</span><span class="op" id="6667401">]</span><span class="op" id="6667402">.</span><span class="ident" id="6667403">net</span><span class="op" id="6667406">,</span>&nbsp;<span class="ident" id="6667408">dss</span><span class="op" id="6667411">.</span><span class="ident" id="6667412">lns</span><span class="op" id="6667415">[</span><span class="ident" id="6667416">i</span><span class="op" id="6667417">]</span><span class="op" id="6667418">.</span><span class="ident" id="6667419">addr</span><span class="op" id="6667423">+</span><span class="string" id="6667424">&#34;:&#34;</span><span class="op" id="6667427">+</span><span class="ident" id="6667428">dss</span><span class="op" id="6667431">.</span><span class="ident" id="6667432">port</span><span class="op" id="6667436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667440">if</span>&nbsp;<span class="ident" id="6667443">err</span>&nbsp;<span class="op" id="6667447">!=</span>&nbsp;<span class="ident" id="6667450">nil</span>&nbsp;<span class="op" id="6667454">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667459">dss</span><span class="op" id="6667462">.</span><span class="ident" id="6667463">teardown</span><span class="op" id="6667471">(</span><span class="op" id="6667472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667477">return</span>&nbsp;<span class="ident" id="6667484">nil</span><span class="op" id="6667487">,</span>&nbsp;<span class="ident" id="6667489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667499">dss</span><span class="op" id="6667502">.</span><span class="ident" id="6667503">lns</span><span class="op" id="6667506">[</span><span class="ident" id="6667507">i</span><span class="op" id="6667508">]</span><span class="op" id="6667509">.</span><span class="ident" id="6667510">ln</span>&nbsp;<span class="op" id="6667513">=</span>&nbsp;<span class="ident" id="6667515">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667520">if</span>&nbsp;<span class="ident" id="6667523">dss</span><span class="op" id="6667526">.</span><span class="ident" id="6667527">port</span>&nbsp;<span class="op" id="6667532">==</span>&nbsp;<span class="string" id="6667535">&#34;0&#34;</span>&nbsp;<span class="op" id="6667539">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667544">if</span>&nbsp;<span class="ident" id="6667547">_</span><span class="op" id="6667548">,</span>&nbsp;<span class="ident" id="6667550">dss</span><span class="op" id="6667553">.</span><span class="ident" id="6667554">port</span><span class="op" id="6667558">,</span>&nbsp;<span class="ident" id="6667560">err</span>&nbsp;<span class="op" id="6667564">=</span>&nbsp;<span class="ident" id="6667566">SplitHostPort</span><span class="op" id="6667579">(</span><span class="ident" id="6667580">ln</span><span class="op" id="6667582">.</span><span class="ident" id="6667583">Addr</span><span class="op" id="6667587">(</span><span class="op" id="6667588">)</span><span class="op" id="6667589">.</span><span class="ident" id="6667590">String</span><span class="op" id="6667596">(</span><span class="op" id="6667597">)</span><span class="op" id="6667598">)</span><span class="op" id="6667599">;</span>&nbsp;<span class="ident" id="6667601">err</span>&nbsp;<span class="op" id="6667605">!=</span>&nbsp;<span class="ident" id="6667608">nil</span>&nbsp;<span class="op" id="6667612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667618">dss</span><span class="op" id="6667621">.</span><span class="ident" id="6667622">teardown</span><span class="op" id="6667630">(</span><span class="op" id="6667631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667637">return</span>&nbsp;<span class="ident" id="6667644">nil</span><span class="op" id="6667647">,</span>&nbsp;<span class="ident" id="6667649">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667660">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667666">return</span>&nbsp;<span class="ident" id="6667673">dss</span><span class="op" id="6667676">,</span>&nbsp;<span class="ident" id="6667678">nil</span><br>
<span class="lineno"></span><span class="op" id="6667682">}</span>
</div>
</body>
</html>
