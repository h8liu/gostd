<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io/ioutil</h2>
<ul>
<li><a href="/gostd/io/ioutil/ioutil.go.html">ioutil.go</a></li>
<li><a href="/gostd/io/ioutil/ioutil_test.go.html">ioutil_test.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile.go.html">tempfile.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile_test.go.html" class="current">tempfile_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6661299">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6661354">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6661408">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6661459">package</span>&nbsp;<span class="ident" id="6661467">ioutil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6661475">import</span>&nbsp;<span class="op" id="6661482">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6661485">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6661491">&#34;path/filepath&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6661508">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6661518">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6661528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6661531">func</span>&nbsp;<span class="ident" id="6661536">TestTempFile</span><span class="op" id="6661548">(</span><span class="ident" id="6661549">t</span>&nbsp;<span class="op" id="6661551">*</span><span class="ident" id="6661552">testing</span><span class="op" id="6661559">.</span><span class="ident" id="6661560">T</span><span class="op" id="6661561">)</span>&nbsp;<span class="op" id="6661563">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661566">f</span><span class="op" id="6661567">,</span>&nbsp;<span class="ident" id="6661569">err</span>&nbsp;<span class="op" id="6661573">:=</span>&nbsp;<span class="ident" id="6661576">TempFile</span><span class="op" id="6661584">(</span><span class="string" id="6661585">&#34;/_not_exists_&#34;</span><span class="op" id="6661600">,</span>&nbsp;<span class="string" id="6661602">&#34;foo&#34;</span><span class="op" id="6661607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6661610">if</span>&nbsp;<span class="ident" id="6661613">f</span>&nbsp;<span class="op" id="6661615">!=</span>&nbsp;<span class="builtintype" id="6661618">nil</span>&nbsp;<span class="op" id="6661622">||</span>&nbsp;<span class="ident" id="6661625">err</span>&nbsp;<span class="op" id="6661629">==</span>&nbsp;<span class="builtintype" id="6661632">nil</span>&nbsp;<span class="op" id="6661636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661640">t</span><span class="op" id="6661641">.</span><span class="ident" id="6661642">Errorf</span><span class="op" id="6661648">(</span><span class="string" id="6661649">&#34;TempFile(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6661692">,</span>&nbsp;<span class="ident" id="6661694">f</span><span class="op" id="6661695">,</span>&nbsp;<span class="ident" id="6661697">err</span><span class="op" id="6661700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6661703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661707">dir</span>&nbsp;<span class="op" id="6661711">:=</span>&nbsp;<span class="ident" id="6661714">os</span><span class="op" id="6661716">.</span><span class="ident" id="6661717">TempDir</span><span class="op" id="6661724">(</span><span class="op" id="6661725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661728">f</span><span class="op" id="6661729">,</span>&nbsp;<span class="ident" id="6661731">err</span>&nbsp;<span class="op" id="6661735">=</span>&nbsp;<span class="ident" id="6661737">TempFile</span><span class="op" id="6661745">(</span><span class="ident" id="6661746">dir</span><span class="op" id="6661749">,</span>&nbsp;<span class="string" id="6661751">&#34;ioutil_test&#34;</span><span class="op" id="6661764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6661767">if</span>&nbsp;<span class="ident" id="6661770">f</span>&nbsp;<span class="op" id="6661772">==</span>&nbsp;<span class="builtintype" id="6661775">nil</span>&nbsp;<span class="op" id="6661779">||</span>&nbsp;<span class="ident" id="6661782">err</span>&nbsp;<span class="op" id="6661786">!=</span>&nbsp;<span class="builtintype" id="6661789">nil</span>&nbsp;<span class="op" id="6661793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661797">t</span><span class="op" id="6661798">.</span><span class="ident" id="6661799">Errorf</span><span class="op" id="6661805">(</span><span class="string" id="6661806">&#34;TempFile(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6661845">,</span>&nbsp;<span class="ident" id="6661847">f</span><span class="op" id="6661848">,</span>&nbsp;<span class="ident" id="6661850">err</span><span class="op" id="6661853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6661856">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6661859">if</span>&nbsp;<span class="ident" id="6661862">f</span>&nbsp;<span class="op" id="6661864">!=</span>&nbsp;<span class="builtintype" id="6661867">nil</span>&nbsp;<span class="op" id="6661871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661875">f</span><span class="op" id="6661876">.</span><span class="ident" id="6661877">Close</span><span class="op" id="6661882">(</span><span class="op" id="6661883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661887">os</span><span class="op" id="6661889">.</span><span class="ident" id="6661890">Remove</span><span class="op" id="6661896">(</span><span class="ident" id="6661897">f</span><span class="op" id="6661898">.</span><span class="ident" id="6661899">Name</span><span class="op" id="6661903">(</span><span class="op" id="6661904">)</span><span class="op" id="6661905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6661909">re</span>&nbsp;<span class="op" id="6661912">:=</span>&nbsp;<span class="ident" id="6661915">regexp</span><span class="op" id="6661921">.</span><span class="ident" id="6661922">MustCompile</span><span class="op" id="6661933">(</span><span class="string" id="6661934">&#34;^&#34;</span>&nbsp;<span class="op" id="6661938">+</span>&nbsp;<span class="ident" id="6661940">regexp</span><span class="op" id="6661946">.</span><span class="ident" id="6661947">QuoteMeta</span><span class="op" id="6661956">(</span><span class="ident" id="6661957">filepath</span><span class="op" id="6661965">.</span><span class="ident" id="6661966">Join</span><span class="op" id="6661970">(</span><span class="ident" id="6661971">dir</span><span class="op" id="6661974">,</span>&nbsp;<span class="string" id="6661976">&#34;ioutil_test&#34;</span><span class="op" id="6661989">)</span><span class="op" id="6661990">)</span>&nbsp;<span class="op" id="6661992">+</span>&nbsp;<span class="string" id="6661994">&#34;[0-9]+$&#34;</span><span class="op" id="6662003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6662007">if</span>&nbsp;<span class="op" id="6662010">!</span><span class="ident" id="6662011">re</span><span class="op" id="6662013">.</span><span class="ident" id="6662014">MatchString</span><span class="op" id="6662025">(</span><span class="ident" id="6662026">f</span><span class="op" id="6662027">.</span><span class="ident" id="6662028">Name</span><span class="op" id="6662032">(</span><span class="op" id="6662033">)</span><span class="op" id="6662034">)</span>&nbsp;<span class="op" id="6662036">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662041">t</span><span class="op" id="6662042">.</span><span class="ident" id="6662043">Errorf</span><span class="op" id="6662049">(</span><span class="string" id="6662050">&#34;TempFile(`&#34;</span><span class="op" id="6662062">+</span><span class="ident" id="6662063">dir</span><span class="op" id="6662066">+</span><span class="string" id="6662067">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="6662106">,</span>&nbsp;<span class="ident" id="6662108">f</span><span class="op" id="6662109">.</span><span class="ident" id="6662110">Name</span><span class="op" id="6662114">(</span><span class="op" id="6662115">)</span><span class="op" id="6662116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662123">}</span><br>
<span class="lineno"></span><span class="op" id="6662125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="6662128">func</span>&nbsp;<span class="ident" id="6662133">TestTempDir</span><span class="op" id="6662144">(</span><span class="ident" id="6662145">t</span>&nbsp;<span class="op" id="6662147">*</span><span class="ident" id="6662148">testing</span><span class="op" id="6662155">.</span><span class="ident" id="6662156">T</span><span class="op" id="6662157">)</span>&nbsp;<span class="op" id="6662159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662162">name</span><span class="op" id="6662166">,</span>&nbsp;<span class="ident" id="6662168">err</span>&nbsp;<span class="op" id="6662172">:=</span>&nbsp;<span class="ident" id="6662175">TempDir</span><span class="op" id="6662182">(</span><span class="string" id="6662183">&#34;/_not_exists_&#34;</span><span class="op" id="6662198">,</span>&nbsp;<span class="string" id="6662200">&#34;foo&#34;</span><span class="op" id="6662205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6662208">if</span>&nbsp;<span class="ident" id="6662211">name</span>&nbsp;<span class="op" id="6662216">!=</span>&nbsp;<span class="string" id="6662219">&#34;&#34;</span>&nbsp;<span class="op" id="6662222">||</span>&nbsp;<span class="ident" id="6662225">err</span>&nbsp;<span class="op" id="6662229">==</span>&nbsp;<span class="builtintype" id="6662232">nil</span>&nbsp;<span class="op" id="6662236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662240">t</span><span class="op" id="6662241">.</span><span class="ident" id="6662242">Errorf</span><span class="op" id="6662248">(</span><span class="string" id="6662249">&#34;TempDir(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6662291">,</span>&nbsp;<span class="ident" id="6662293">name</span><span class="op" id="6662297">,</span>&nbsp;<span class="ident" id="6662299">err</span><span class="op" id="6662302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662305">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662309">dir</span>&nbsp;<span class="op" id="6662313">:=</span>&nbsp;<span class="ident" id="6662316">os</span><span class="op" id="6662318">.</span><span class="ident" id="6662319">TempDir</span><span class="op" id="6662326">(</span><span class="op" id="6662327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662330">name</span><span class="op" id="6662334">,</span>&nbsp;<span class="ident" id="6662336">err</span>&nbsp;<span class="op" id="6662340">=</span>&nbsp;<span class="ident" id="6662342">TempDir</span><span class="op" id="6662349">(</span><span class="ident" id="6662350">dir</span><span class="op" id="6662353">,</span>&nbsp;<span class="string" id="6662355">&#34;ioutil_test&#34;</span><span class="op" id="6662368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6662371">if</span>&nbsp;<span class="ident" id="6662374">name</span>&nbsp;<span class="op" id="6662379">==</span>&nbsp;<span class="string" id="6662382">&#34;&#34;</span>&nbsp;<span class="op" id="6662385">||</span>&nbsp;<span class="ident" id="6662388">err</span>&nbsp;<span class="op" id="6662392">!=</span>&nbsp;<span class="builtintype" id="6662395">nil</span>&nbsp;<span class="op" id="6662399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662403">t</span><span class="op" id="6662404">.</span><span class="ident" id="6662405">Errorf</span><span class="op" id="6662411">(</span><span class="string" id="6662412">&#34;TempDir(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6662450">,</span>&nbsp;<span class="ident" id="6662452">name</span><span class="op" id="6662456">,</span>&nbsp;<span class="ident" id="6662458">err</span><span class="op" id="6662461">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6662467">if</span>&nbsp;<span class="ident" id="6662470">name</span>&nbsp;<span class="op" id="6662475">!=</span>&nbsp;<span class="string" id="6662478">&#34;&#34;</span>&nbsp;<span class="op" id="6662481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662485">os</span><span class="op" id="6662487">.</span><span class="ident" id="6662488">Remove</span><span class="op" id="6662494">(</span><span class="ident" id="6662495">name</span><span class="op" id="6662499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662503">re</span>&nbsp;<span class="op" id="6662506">:=</span>&nbsp;<span class="ident" id="6662509">regexp</span><span class="op" id="6662515">.</span><span class="ident" id="6662516">MustCompile</span><span class="op" id="6662527">(</span><span class="string" id="6662528">&#34;^&#34;</span>&nbsp;<span class="op" id="6662532">+</span>&nbsp;<span class="ident" id="6662534">regexp</span><span class="op" id="6662540">.</span><span class="ident" id="6662541">QuoteMeta</span><span class="op" id="6662550">(</span><span class="ident" id="6662551">filepath</span><span class="op" id="6662559">.</span><span class="ident" id="6662560">Join</span><span class="op" id="6662564">(</span><span class="ident" id="6662565">dir</span><span class="op" id="6662568">,</span>&nbsp;<span class="string" id="6662570">&#34;ioutil_test&#34;</span><span class="op" id="6662583">)</span><span class="op" id="6662584">)</span>&nbsp;<span class="op" id="6662586">+</span>&nbsp;<span class="string" id="6662588">&#34;[0-9]+$&#34;</span><span class="op" id="6662597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6662601">if</span>&nbsp;<span class="op" id="6662604">!</span><span class="ident" id="6662605">re</span><span class="op" id="6662607">.</span><span class="ident" id="6662608">MatchString</span><span class="op" id="6662619">(</span><span class="ident" id="6662620">name</span><span class="op" id="6662624">)</span>&nbsp;<span class="op" id="6662626">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6662631">t</span><span class="op" id="6662632">.</span><span class="ident" id="6662633">Errorf</span><span class="op" id="6662639">(</span><span class="string" id="6662640">&#34;TempDir(`&#34;</span><span class="op" id="6662651">+</span><span class="ident" id="6662652">dir</span><span class="op" id="6662655">+</span><span class="string" id="6662656">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="6662695">,</span>&nbsp;<span class="ident" id="6662697">name</span><span class="op" id="6662701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6662708">}</span><br>
<span class="lineno"></span><span class="op" id="6662710">}</span>
</div>
</body>
</html>
