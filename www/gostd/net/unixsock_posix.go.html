<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html" class="current">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4031187">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4031243">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4031297">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4031348">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031426">package</span>&nbsp;<span class="ident" id="4031434">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4031439">import</span>&nbsp;<span class="op" id="4031446">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031449">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031459">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031465">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4031476">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4031483">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4031486">func</span>&nbsp;<span class="ident" id="4031491">unixSocket</span><span class="op" id="4031501">(</span><span class="ident" id="4031502">net</span>&nbsp;<span class="builtintype" id="4031506">string</span><span class="op" id="4031512">,</span>&nbsp;<span class="ident" id="4031514">laddr</span><span class="op" id="4031519">,</span>&nbsp;<span class="ident" id="4031521">raddr</span>&nbsp;<span class="ident" id="4031527">sockaddr</span><span class="op" id="4031535">,</span>&nbsp;<span class="ident" id="4031537">mode</span>&nbsp;<span class="builtintype" id="4031542">string</span><span class="op" id="4031548">,</span>&nbsp;<span class="ident" id="4031550">deadline</span>&nbsp;<span class="ident" id="4031559">time</span><span class="op" id="4031563">.</span><span class="ident" id="4031564">Time</span><span class="op" id="4031568">)</span>&nbsp;<span class="op" id="4031570">(</span><span class="op" id="4031571">*</span><span class="ident" id="4031572">netFD</span><span class="op" id="4031577">,</span>&nbsp;<span class="builtintype" id="4031579">error</span><span class="op" id="4031584">)</span>&nbsp;<span class="op" id="4031586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031589">var</span>&nbsp;<span class="ident" id="4031593">sotype</span>&nbsp;<span class="builtintype" id="4031600">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031605">switch</span>&nbsp;<span class="ident" id="4031612">net</span>&nbsp;<span class="op" id="4031616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031619">case</span>&nbsp;<span class="string" id="4031624">&#34;unix&#34;</span><span class="op" id="4031630">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031634">sotype</span>&nbsp;<span class="op" id="4031641">=</span>&nbsp;<span class="ident" id="4031643">syscall</span><span class="op" id="4031650">.</span><span class="ident" id="4031651">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031664">case</span>&nbsp;<span class="string" id="4031669">&#34;unixgram&#34;</span><span class="op" id="4031679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031683">sotype</span>&nbsp;<span class="op" id="4031690">=</span>&nbsp;<span class="ident" id="4031692">syscall</span><span class="op" id="4031699">.</span><span class="ident" id="4031700">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031712">case</span>&nbsp;<span class="string" id="4031717">&#34;unixpacket&#34;</span><span class="op" id="4031729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031733">sotype</span>&nbsp;<span class="op" id="4031740">=</span>&nbsp;<span class="ident" id="4031742">syscall</span><span class="op" id="4031749">.</span><span class="ident" id="4031750">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031766">default</span><span class="op" id="4031773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031777">return</span>&nbsp;<span class="builtintype" id="4031784">nil</span><span class="op" id="4031787">,</span>&nbsp;<span class="ident" id="4031789">UnknownNetworkError</span><span class="op" id="4031808">(</span><span class="ident" id="4031809">net</span><span class="op" id="4031812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031819">switch</span>&nbsp;<span class="ident" id="4031826">mode</span>&nbsp;<span class="op" id="4031831">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031834">case</span>&nbsp;<span class="string" id="4031839">&#34;dial&#34;</span><span class="op" id="4031845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031849">if</span>&nbsp;<span class="ident" id="4031852">laddr</span>&nbsp;<span class="op" id="4031858">!=</span>&nbsp;<span class="builtintype" id="4031861">nil</span>&nbsp;<span class="op" id="4031865">&amp;&amp;</span>&nbsp;<span class="ident" id="4031868">laddr</span><span class="op" id="4031873">.</span><span class="ident" id="4031874">isWildcard</span><span class="op" id="4031884">(</span><span class="op" id="4031885">)</span>&nbsp;<span class="op" id="4031887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031892">laddr</span>&nbsp;<span class="op" id="4031898">=</span>&nbsp;<span class="builtintype" id="4031900">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031910">if</span>&nbsp;<span class="ident" id="4031913">raddr</span>&nbsp;<span class="op" id="4031919">!=</span>&nbsp;<span class="builtintype" id="4031922">nil</span>&nbsp;<span class="op" id="4031926">&amp;&amp;</span>&nbsp;<span class="ident" id="4031929">raddr</span><span class="op" id="4031934">.</span><span class="ident" id="4031935">isWildcard</span><span class="op" id="4031945">(</span><span class="op" id="4031946">)</span>&nbsp;<span class="op" id="4031948">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031953">raddr</span>&nbsp;<span class="op" id="4031959">=</span>&nbsp;<span class="builtintype" id="4031961">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031971">if</span>&nbsp;<span class="ident" id="4031974">raddr</span>&nbsp;<span class="op" id="4031980">==</span>&nbsp;<span class="builtintype" id="4031983">nil</span>&nbsp;<span class="op" id="4031987">&amp;&amp;</span>&nbsp;<span class="op" id="4031990">(</span><span class="ident" id="4031991">sotype</span>&nbsp;<span class="op" id="4031998">!=</span>&nbsp;<span class="ident" id="4032001">syscall</span><span class="op" id="4032008">.</span><span class="ident" id="4032009">SOCK_DGRAM</span>&nbsp;<span class="op" id="4032020">||</span>&nbsp;<span class="ident" id="4032023">laddr</span>&nbsp;<span class="op" id="4032029">==</span>&nbsp;<span class="builtintype" id="4032032">nil</span><span class="op" id="4032035">)</span>&nbsp;<span class="op" id="4032037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032042">return</span>&nbsp;<span class="builtintype" id="4032049">nil</span><span class="op" id="4032052">,</span>&nbsp;<span class="ident" id="4032054">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032074">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032077">case</span>&nbsp;<span class="string" id="4032082">&#34;listen&#34;</span><span class="op" id="4032090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032093">default</span><span class="op" id="4032100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032104">return</span>&nbsp;<span class="builtintype" id="4032111">nil</span><span class="op" id="4032114">,</span>&nbsp;<span class="ident" id="4032116">errors</span><span class="op" id="4032122">.</span><span class="ident" id="4032123">New</span><span class="op" id="4032126">(</span><span class="string" id="4032127">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="4032144">+</span>&nbsp;<span class="ident" id="4032146">mode</span><span class="op" id="4032150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4032157">fd</span><span class="op" id="4032159">,</span>&nbsp;<span class="ident" id="4032161">err</span>&nbsp;<span class="op" id="4032165">:=</span>&nbsp;<span class="ident" id="4032168">socket</span><span class="op" id="4032174">(</span><span class="ident" id="4032175">net</span><span class="op" id="4032178">,</span>&nbsp;<span class="ident" id="4032180">syscall</span><span class="op" id="4032187">.</span><span class="ident" id="4032188">AF_UNIX</span><span class="op" id="4032195">,</span>&nbsp;<span class="ident" id="4032197">sotype</span><span class="op" id="4032203">,</span>&nbsp;<span class="num" id="4032205">0</span><span class="op" id="4032206">,</span>&nbsp;<span class="builtintype" id="4032208">false</span><span class="op" id="4032213">,</span>&nbsp;<span class="ident" id="4032215">laddr</span><span class="op" id="4032220">,</span>&nbsp;<span class="ident" id="4032222">raddr</span><span class="op" id="4032227">,</span>&nbsp;<span class="ident" id="4032229">deadline</span><span class="op" id="4032237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032240">if</span>&nbsp;<span class="ident" id="4032243">err</span>&nbsp;<span class="op" id="4032247">!=</span>&nbsp;<span class="builtintype" id="4032250">nil</span>&nbsp;<span class="op" id="4032254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032258">return</span>&nbsp;<span class="builtintype" id="4032265">nil</span><span class="op" id="4032268">,</span>&nbsp;<span class="ident" id="4032270">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032278">return</span>&nbsp;<span class="ident" id="4032285">fd</span><span class="op" id="4032287">,</span>&nbsp;<span class="builtintype" id="4032289">nil</span><br>
<span class="lineno">50</span><span class="op" id="4032293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4032296">func</span>&nbsp;<span class="ident" id="4032301">sockaddrToUnix</span><span class="op" id="4032315">(</span><span class="ident" id="4032316">sa</span>&nbsp;<span class="ident" id="4032319">syscall</span><span class="op" id="4032326">.</span><span class="ident" id="4032327">Sockaddr</span><span class="op" id="4032335">)</span>&nbsp;<span class="ident" id="4032337">Addr</span>&nbsp;<span class="op" id="4032342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032345">if</span>&nbsp;<span class="ident" id="4032348">s</span><span class="op" id="4032349">,</span>&nbsp;<span class="ident" id="4032351">ok</span>&nbsp;<span class="op" id="4032354">:=</span>&nbsp;<span class="ident" id="4032357">sa</span><span class="op" id="4032359">.</span><span class="op" id="4032360">(</span><span class="op" id="4032361">*</span><span class="ident" id="4032362">syscall</span><span class="op" id="4032369">.</span><span class="ident" id="4032370">SockaddrUnix</span><span class="op" id="4032382">)</span><span class="op" id="4032383">;</span>&nbsp;<span class="ident" id="4032385">ok</span>&nbsp;<span class="op" id="4032388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032392">return</span>&nbsp;<span class="op" id="4032399">&amp;</span><span class="ident" id="4032400">UnixAddr</span><span class="op" id="4032408">{</span><span class="ident" id="4032409">Name</span><span class="op" id="4032413">:</span>&nbsp;<span class="ident" id="4032415">s</span><span class="op" id="4032416">.</span><span class="ident" id="4032417">Name</span><span class="op" id="4032421">,</span>&nbsp;<span class="ident" id="4032423">Net</span><span class="op" id="4032426">:</span>&nbsp;<span class="string" id="4032428">&#34;unix&#34;</span><span class="op" id="4032434">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032440">return</span>&nbsp;<span class="builtintype" id="4032447">nil</span><br>
<span class="lineno"></span><span class="op" id="4032451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4032454">func</span>&nbsp;<span class="ident" id="4032459">sockaddrToUnixgram</span><span class="op" id="4032477">(</span><span class="ident" id="4032478">sa</span>&nbsp;<span class="ident" id="4032481">syscall</span><span class="op" id="4032488">.</span><span class="ident" id="4032489">Sockaddr</span><span class="op" id="4032497">)</span>&nbsp;<span class="ident" id="4032499">Addr</span>&nbsp;<span class="op" id="4032504">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032507">if</span>&nbsp;<span class="ident" id="4032510">s</span><span class="op" id="4032511">,</span>&nbsp;<span class="ident" id="4032513">ok</span>&nbsp;<span class="op" id="4032516">:=</span>&nbsp;<span class="ident" id="4032519">sa</span><span class="op" id="4032521">.</span><span class="op" id="4032522">(</span><span class="op" id="4032523">*</span><span class="ident" id="4032524">syscall</span><span class="op" id="4032531">.</span><span class="ident" id="4032532">SockaddrUnix</span><span class="op" id="4032544">)</span><span class="op" id="4032545">;</span>&nbsp;<span class="ident" id="4032547">ok</span>&nbsp;<span class="op" id="4032550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032554">return</span>&nbsp;<span class="op" id="4032561">&amp;</span><span class="ident" id="4032562">UnixAddr</span><span class="op" id="4032570">{</span><span class="ident" id="4032571">Name</span><span class="op" id="4032575">:</span>&nbsp;<span class="ident" id="4032577">s</span><span class="op" id="4032578">.</span><span class="ident" id="4032579">Name</span><span class="op" id="4032583">,</span>&nbsp;<span class="ident" id="4032585">Net</span><span class="op" id="4032588">:</span>&nbsp;<span class="string" id="4032590">&#34;unixgram&#34;</span><span class="op" id="4032600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032606">return</span>&nbsp;<span class="builtintype" id="4032613">nil</span><br>
<span class="lineno"></span><span class="op" id="4032617">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4032620">func</span>&nbsp;<span class="ident" id="4032625">sockaddrToUnixpacket</span><span class="op" id="4032645">(</span><span class="ident" id="4032646">sa</span>&nbsp;<span class="ident" id="4032649">syscall</span><span class="op" id="4032656">.</span><span class="ident" id="4032657">Sockaddr</span><span class="op" id="4032665">)</span>&nbsp;<span class="ident" id="4032667">Addr</span>&nbsp;<span class="op" id="4032672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032675">if</span>&nbsp;<span class="ident" id="4032678">s</span><span class="op" id="4032679">,</span>&nbsp;<span class="ident" id="4032681">ok</span>&nbsp;<span class="op" id="4032684">:=</span>&nbsp;<span class="ident" id="4032687">sa</span><span class="op" id="4032689">.</span><span class="op" id="4032690">(</span><span class="op" id="4032691">*</span><span class="ident" id="4032692">syscall</span><span class="op" id="4032699">.</span><span class="ident" id="4032700">SockaddrUnix</span><span class="op" id="4032712">)</span><span class="op" id="4032713">;</span>&nbsp;<span class="ident" id="4032715">ok</span>&nbsp;<span class="op" id="4032718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032722">return</span>&nbsp;<span class="op" id="4032729">&amp;</span><span class="ident" id="4032730">UnixAddr</span><span class="op" id="4032738">{</span><span class="ident" id="4032739">Name</span><span class="op" id="4032743">:</span>&nbsp;<span class="ident" id="4032745">s</span><span class="op" id="4032746">.</span><span class="ident" id="4032747">Name</span><span class="op" id="4032751">,</span>&nbsp;<span class="ident" id="4032753">Net</span><span class="op" id="4032756">:</span>&nbsp;<span class="string" id="4032758">&#34;unixpacket&#34;</span><span class="op" id="4032770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4032773">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032776">return</span>&nbsp;<span class="builtintype" id="4032783">nil</span><br>
<span class="lineno"></span><span class="op" id="4032787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4032790">func</span>&nbsp;<span class="ident" id="4032795">sotypeToNet</span><span class="op" id="4032806">(</span><span class="ident" id="4032807">sotype</span>&nbsp;<span class="builtintype" id="4032814">int</span><span class="op" id="4032817">)</span>&nbsp;<span class="builtintype" id="4032819">string</span>&nbsp;<span class="op" id="4032826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032829">switch</span>&nbsp;<span class="ident" id="4032836">sotype</span>&nbsp;<span class="op" id="4032843">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032846">case</span>&nbsp;<span class="ident" id="4032851">syscall</span><span class="op" id="4032858">.</span><span class="ident" id="4032859">SOCK_STREAM</span><span class="op" id="4032870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032874">return</span>&nbsp;<span class="string" id="4032881">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032889">case</span>&nbsp;<span class="ident" id="4032894">syscall</span><span class="op" id="4032901">.</span><span class="ident" id="4032902">SOCK_DGRAM</span><span class="op" id="4032912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032916">return</span>&nbsp;<span class="string" id="4032923">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032935">case</span>&nbsp;<span class="ident" id="4032940">syscall</span><span class="op" id="4032947">.</span><span class="ident" id="4032948">SOCK_SEQPACKET</span><span class="op" id="4032962">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032966">return</span>&nbsp;<span class="string" id="4032973">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4032987">default</span><span class="op" id="4032994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4032998">panic</span><span class="op" id="4033003">(</span><span class="string" id="4033004">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="4033037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4033040">}</span><br>
<span class="lineno"></span><span class="op" id="4033042">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4033045">func</span>&nbsp;<span class="op" id="4033050">(</span><span class="ident" id="4033051">a</span>&nbsp;<span class="op" id="4033053">*</span><span class="ident" id="4033054">UnixAddr</span><span class="op" id="4033062">)</span>&nbsp;<span class="ident" id="4033064">family</span><span class="op" id="4033070">(</span><span class="op" id="4033071">)</span>&nbsp;<span class="builtintype" id="4033073">int</span>&nbsp;<span class="op" id="4033077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033080">return</span>&nbsp;<span class="ident" id="4033087">syscall</span><span class="op" id="4033094">.</span><span class="ident" id="4033095">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="4033103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4033106">func</span>&nbsp;<span class="op" id="4033111">(</span><span class="ident" id="4033112">a</span>&nbsp;<span class="op" id="4033114">*</span><span class="ident" id="4033115">UnixAddr</span><span class="op" id="4033123">)</span>&nbsp;<span class="ident" id="4033125">isWildcard</span><span class="op" id="4033135">(</span><span class="op" id="4033136">)</span>&nbsp;<span class="builtintype" id="4033138">bool</span>&nbsp;<span class="op" id="4033143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033146">return</span>&nbsp;<span class="ident" id="4033153">a</span>&nbsp;<span class="op" id="4033155">==</span>&nbsp;<span class="builtintype" id="4033158">nil</span>&nbsp;<span class="op" id="4033162">||</span>&nbsp;<span class="ident" id="4033165">a</span><span class="op" id="4033166">.</span><span class="ident" id="4033167">Name</span>&nbsp;<span class="op" id="4033172">==</span>&nbsp;<span class="string" id="4033175">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4033178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4033181">func</span>&nbsp;<span class="op" id="4033186">(</span><span class="ident" id="4033187">a</span>&nbsp;<span class="op" id="4033189">*</span><span class="ident" id="4033190">UnixAddr</span><span class="op" id="4033198">)</span>&nbsp;<span class="ident" id="4033200">sockaddr</span><span class="op" id="4033208">(</span><span class="ident" id="4033209">family</span>&nbsp;<span class="builtintype" id="4033216">int</span><span class="op" id="4033219">)</span>&nbsp;<span class="op" id="4033221">(</span><span class="ident" id="4033222">syscall</span><span class="op" id="4033229">.</span><span class="ident" id="4033230">Sockaddr</span><span class="op" id="4033238">,</span>&nbsp;<span class="builtintype" id="4033240">error</span><span class="op" id="4033245">)</span>&nbsp;<span class="op" id="4033247">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033250">if</span>&nbsp;<span class="ident" id="4033253">a</span>&nbsp;<span class="op" id="4033255">==</span>&nbsp;<span class="builtintype" id="4033258">nil</span>&nbsp;<span class="op" id="4033262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033266">return</span>&nbsp;<span class="builtintype" id="4033273">nil</span><span class="op" id="4033276">,</span>&nbsp;<span class="builtintype" id="4033278">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4033283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033286">return</span>&nbsp;<span class="op" id="4033293">&amp;</span><span class="ident" id="4033294">syscall</span><span class="op" id="4033301">.</span><span class="ident" id="4033302">SockaddrUnix</span><span class="op" id="4033314">{</span><span class="ident" id="4033315">Name</span><span class="op" id="4033319">:</span>&nbsp;<span class="ident" id="4033321">a</span><span class="op" id="4033322">.</span><span class="ident" id="4033323">Name</span><span class="op" id="4033327">}</span><span class="op" id="4033328">,</span>&nbsp;<span class="builtintype" id="4033330">nil</span><br>
<span class="lineno"></span><span class="op" id="4033334">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4033337">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="4033408">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4033435">type</span>&nbsp;<span class="ident" id="4033440">UnixConn</span>&nbsp;<span class="keyword" id="4033449">struct</span>&nbsp;<span class="op" id="4033456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033459">conn</span><br>
<span class="lineno">105</span><span class="op" id="4033464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4033467">func</span>&nbsp;<span class="ident" id="4033472">newUnixConn</span><span class="op" id="4033483">(</span><span class="ident" id="4033484">fd</span>&nbsp;<span class="op" id="4033487">*</span><span class="ident" id="4033488">netFD</span><span class="op" id="4033493">)</span>&nbsp;<span class="op" id="4033495">*</span><span class="ident" id="4033496">UnixConn</span>&nbsp;<span class="op" id="4033505">{</span>&nbsp;<span class="keyword" id="4033507">return</span>&nbsp;<span class="op" id="4033514">&amp;</span><span class="ident" id="4033515">UnixConn</span><span class="op" id="4033523">{</span><span class="ident" id="4033524">conn</span><span class="op" id="4033528">{</span><span class="ident" id="4033529">fd</span><span class="op" id="4033531">}</span><span class="op" id="4033532">}</span>&nbsp;<span class="op" id="4033534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4033537">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="4033608">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4033679">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="4033694">//</span><br>
<span class="lineno"></span><span class="comment" id="4033697">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4033762">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4033829">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4033849">func</span>&nbsp;<span class="op" id="4033854">(</span><span class="ident" id="4033855">c</span>&nbsp;<span class="op" id="4033857">*</span><span class="ident" id="4033858">UnixConn</span><span class="op" id="4033866">)</span>&nbsp;<span class="ident" id="4033868">ReadFromUnix</span><span class="op" id="4033880">(</span><span class="ident" id="4033881">b</span>&nbsp;<span class="op" id="4033883">[</span><span class="op" id="4033884">]</span><span class="builtintype" id="4033885">byte</span><span class="op" id="4033889">)</span>&nbsp;<span class="op" id="4033891">(</span><span class="ident" id="4033892">n</span>&nbsp;<span class="builtintype" id="4033894">int</span><span class="op" id="4033897">,</span>&nbsp;<span class="ident" id="4033899">addr</span>&nbsp;<span class="op" id="4033904">*</span><span class="ident" id="4033905">UnixAddr</span><span class="op" id="4033913">,</span>&nbsp;<span class="ident" id="4033915">err</span>&nbsp;<span class="builtintype" id="4033919">error</span><span class="op" id="4033924">)</span>&nbsp;<span class="op" id="4033926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033929">if</span>&nbsp;<span class="op" id="4033932">!</span><span class="ident" id="4033933">c</span><span class="op" id="4033934">.</span><span class="ident" id="4033935">ok</span><span class="op" id="4033937">(</span><span class="op" id="4033938">)</span>&nbsp;<span class="op" id="4033940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4033944">return</span>&nbsp;<span class="num" id="4033951">0</span><span class="op" id="4033952">,</span>&nbsp;<span class="builtintype" id="4033954">nil</span><span class="op" id="4033957">,</span>&nbsp;<span class="ident" id="4033959">syscall</span><span class="op" id="4033966">.</span><span class="ident" id="4033967">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4033975">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4033978">n</span><span class="op" id="4033979">,</span>&nbsp;<span class="ident" id="4033981">sa</span><span class="op" id="4033983">,</span>&nbsp;<span class="ident" id="4033985">err</span>&nbsp;<span class="op" id="4033989">:=</span>&nbsp;<span class="ident" id="4033992">c</span><span class="op" id="4033993">.</span><span class="ident" id="4033994">fd</span><span class="op" id="4033996">.</span><span class="ident" id="4033997">readFrom</span><span class="op" id="4034005">(</span><span class="ident" id="4034006">b</span><span class="op" id="4034007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034010">switch</span>&nbsp;<span class="ident" id="4034017">sa</span>&nbsp;<span class="op" id="4034020">:=</span>&nbsp;<span class="ident" id="4034023">sa</span><span class="op" id="4034025">.</span><span class="op" id="4034026">(</span><span class="keyword" id="4034027">type</span><span class="op" id="4034031">)</span>&nbsp;<span class="op" id="4034033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034036">case</span>&nbsp;<span class="op" id="4034041">*</span><span class="ident" id="4034042">syscall</span><span class="op" id="4034049">.</span><span class="ident" id="4034050">SockaddrUnix</span><span class="op" id="4034062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034066">if</span>&nbsp;<span class="ident" id="4034069">sa</span><span class="op" id="4034071">.</span><span class="ident" id="4034072">Name</span>&nbsp;<span class="op" id="4034077">!=</span>&nbsp;<span class="string" id="4034080">&#34;&#34;</span>&nbsp;<span class="op" id="4034083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034088">addr</span>&nbsp;<span class="op" id="4034093">=</span>&nbsp;<span class="op" id="4034095">&amp;</span><span class="ident" id="4034096">UnixAddr</span><span class="op" id="4034104">{</span><span class="ident" id="4034105">Name</span><span class="op" id="4034109">:</span>&nbsp;<span class="ident" id="4034111">sa</span><span class="op" id="4034113">.</span><span class="ident" id="4034114">Name</span><span class="op" id="4034118">,</span>&nbsp;<span class="ident" id="4034120">Net</span><span class="op" id="4034123">:</span>&nbsp;<span class="ident" id="4034125">sotypeToNet</span><span class="op" id="4034136">(</span><span class="ident" id="4034137">c</span><span class="op" id="4034138">.</span><span class="ident" id="4034139">fd</span><span class="op" id="4034141">.</span><span class="ident" id="4034142">sotype</span><span class="op" id="4034148">)</span><span class="op" id="4034149">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034159">return</span><br>
<span class="lineno"></span><span class="op" id="4034166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4034169">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4034224">func</span>&nbsp;<span class="op" id="4034229">(</span><span class="ident" id="4034230">c</span>&nbsp;<span class="op" id="4034232">*</span><span class="ident" id="4034233">UnixConn</span><span class="op" id="4034241">)</span>&nbsp;<span class="ident" id="4034243">ReadFrom</span><span class="op" id="4034251">(</span><span class="ident" id="4034252">b</span>&nbsp;<span class="op" id="4034254">[</span><span class="op" id="4034255">]</span><span class="builtintype" id="4034256">byte</span><span class="op" id="4034260">)</span>&nbsp;<span class="op" id="4034262">(</span><span class="builtintype" id="4034263">int</span><span class="op" id="4034266">,</span>&nbsp;<span class="ident" id="4034268">Addr</span><span class="op" id="4034272">,</span>&nbsp;<span class="builtintype" id="4034274">error</span><span class="op" id="4034279">)</span>&nbsp;<span class="op" id="4034281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034284">if</span>&nbsp;<span class="op" id="4034287">!</span><span class="ident" id="4034288">c</span><span class="op" id="4034289">.</span><span class="ident" id="4034290">ok</span><span class="op" id="4034292">(</span><span class="op" id="4034293">)</span>&nbsp;<span class="op" id="4034295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034299">return</span>&nbsp;<span class="num" id="4034306">0</span><span class="op" id="4034307">,</span>&nbsp;<span class="builtintype" id="4034309">nil</span><span class="op" id="4034312">,</span>&nbsp;<span class="ident" id="4034314">syscall</span><span class="op" id="4034321">.</span><span class="ident" id="4034322">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034330">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034333">n</span><span class="op" id="4034334">,</span>&nbsp;<span class="ident" id="4034336">addr</span><span class="op" id="4034340">,</span>&nbsp;<span class="ident" id="4034342">err</span>&nbsp;<span class="op" id="4034346">:=</span>&nbsp;<span class="ident" id="4034349">c</span><span class="op" id="4034350">.</span><span class="ident" id="4034351">ReadFromUnix</span><span class="op" id="4034363">(</span><span class="ident" id="4034364">b</span><span class="op" id="4034365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034368">return</span>&nbsp;<span class="ident" id="4034375">n</span><span class="op" id="4034376">,</span>&nbsp;<span class="ident" id="4034378">addr</span><span class="op" id="4034382">.</span><span class="ident" id="4034383">toAddr</span><span class="op" id="4034389">(</span><span class="op" id="4034390">)</span><span class="op" id="4034391">,</span>&nbsp;<span class="ident" id="4034393">err</span><br>
<span class="lineno"></span><span class="op" id="4034397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4034400">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="4034469">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4034540">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="4034611">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="4034681">func</span>&nbsp;<span class="op" id="4034686">(</span><span class="ident" id="4034687">c</span>&nbsp;<span class="op" id="4034689">*</span><span class="ident" id="4034690">UnixConn</span><span class="op" id="4034698">)</span>&nbsp;<span class="ident" id="4034700">ReadMsgUnix</span><span class="op" id="4034711">(</span><span class="ident" id="4034712">b</span><span class="op" id="4034713">,</span>&nbsp;<span class="ident" id="4034715">oob</span>&nbsp;<span class="op" id="4034719">[</span><span class="op" id="4034720">]</span><span class="builtintype" id="4034721">byte</span><span class="op" id="4034725">)</span>&nbsp;<span class="op" id="4034727">(</span><span class="ident" id="4034728">n</span><span class="op" id="4034729">,</span>&nbsp;<span class="ident" id="4034731">oobn</span><span class="op" id="4034735">,</span>&nbsp;<span class="ident" id="4034737">flags</span>&nbsp;<span class="builtintype" id="4034743">int</span><span class="op" id="4034746">,</span>&nbsp;<span class="ident" id="4034748">addr</span>&nbsp;<span class="op" id="4034753">*</span><span class="ident" id="4034754">UnixAddr</span><span class="op" id="4034762">,</span>&nbsp;<span class="ident" id="4034764">err</span>&nbsp;<span class="builtintype" id="4034768">error</span><span class="op" id="4034773">)</span>&nbsp;<span class="op" id="4034775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034778">if</span>&nbsp;<span class="op" id="4034781">!</span><span class="ident" id="4034782">c</span><span class="op" id="4034783">.</span><span class="ident" id="4034784">ok</span><span class="op" id="4034786">(</span><span class="op" id="4034787">)</span>&nbsp;<span class="op" id="4034789">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034793">return</span>&nbsp;<span class="num" id="4034800">0</span><span class="op" id="4034801">,</span>&nbsp;<span class="num" id="4034803">0</span><span class="op" id="4034804">,</span>&nbsp;<span class="num" id="4034806">0</span><span class="op" id="4034807">,</span>&nbsp;<span class="builtintype" id="4034809">nil</span><span class="op" id="4034812">,</span>&nbsp;<span class="ident" id="4034814">syscall</span><span class="op" id="4034821">.</span><span class="ident" id="4034822">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034833">n</span><span class="op" id="4034834">,</span>&nbsp;<span class="ident" id="4034836">oobn</span><span class="op" id="4034840">,</span>&nbsp;<span class="ident" id="4034842">flags</span><span class="op" id="4034847">,</span>&nbsp;<span class="ident" id="4034849">sa</span><span class="op" id="4034851">,</span>&nbsp;<span class="ident" id="4034853">err</span>&nbsp;<span class="op" id="4034857">:=</span>&nbsp;<span class="ident" id="4034860">c</span><span class="op" id="4034861">.</span><span class="ident" id="4034862">fd</span><span class="op" id="4034864">.</span><span class="ident" id="4034865">readMsg</span><span class="op" id="4034872">(</span><span class="ident" id="4034873">b</span><span class="op" id="4034874">,</span>&nbsp;<span class="ident" id="4034876">oob</span><span class="op" id="4034879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034882">switch</span>&nbsp;<span class="ident" id="4034889">sa</span>&nbsp;<span class="op" id="4034892">:=</span>&nbsp;<span class="ident" id="4034895">sa</span><span class="op" id="4034897">.</span><span class="op" id="4034898">(</span><span class="keyword" id="4034899">type</span><span class="op" id="4034903">)</span>&nbsp;<span class="op" id="4034905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034908">case</span>&nbsp;<span class="op" id="4034913">*</span><span class="ident" id="4034914">syscall</span><span class="op" id="4034921">.</span><span class="ident" id="4034922">SockaddrUnix</span><span class="op" id="4034934">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4034938">if</span>&nbsp;<span class="ident" id="4034941">sa</span><span class="op" id="4034943">.</span><span class="ident" id="4034944">Name</span>&nbsp;<span class="op" id="4034949">!=</span>&nbsp;<span class="string" id="4034952">&#34;&#34;</span>&nbsp;<span class="op" id="4034955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4034960">addr</span>&nbsp;<span class="op" id="4034965">=</span>&nbsp;<span class="op" id="4034967">&amp;</span><span class="ident" id="4034968">UnixAddr</span><span class="op" id="4034976">{</span><span class="ident" id="4034977">Name</span><span class="op" id="4034981">:</span>&nbsp;<span class="ident" id="4034983">sa</span><span class="op" id="4034985">.</span><span class="ident" id="4034986">Name</span><span class="op" id="4034990">,</span>&nbsp;<span class="ident" id="4034992">Net</span><span class="op" id="4034995">:</span>&nbsp;<span class="ident" id="4034997">sotypeToNet</span><span class="op" id="4035008">(</span><span class="ident" id="4035009">c</span><span class="op" id="4035010">.</span><span class="ident" id="4035011">fd</span><span class="op" id="4035013">.</span><span class="ident" id="4035014">sotype</span><span class="op" id="4035020">)</span><span class="op" id="4035021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035031">return</span><br>
<span class="lineno">155</span><span class="op" id="4035038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4035041">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4035115">//</span><br>
<span class="lineno"></span><span class="comment" id="4035118">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="4035182">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4035249">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="4035318">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="4035331">func</span>&nbsp;<span class="op" id="4035336">(</span><span class="ident" id="4035337">c</span>&nbsp;<span class="op" id="4035339">*</span><span class="ident" id="4035340">UnixConn</span><span class="op" id="4035348">)</span>&nbsp;<span class="ident" id="4035350">WriteToUnix</span><span class="op" id="4035361">(</span><span class="ident" id="4035362">b</span>&nbsp;<span class="op" id="4035364">[</span><span class="op" id="4035365">]</span><span class="builtintype" id="4035366">byte</span><span class="op" id="4035370">,</span>&nbsp;<span class="ident" id="4035372">addr</span>&nbsp;<span class="op" id="4035377">*</span><span class="ident" id="4035378">UnixAddr</span><span class="op" id="4035386">)</span>&nbsp;<span class="op" id="4035388">(</span><span class="ident" id="4035389">n</span>&nbsp;<span class="builtintype" id="4035391">int</span><span class="op" id="4035394">,</span>&nbsp;<span class="ident" id="4035396">err</span>&nbsp;<span class="builtintype" id="4035400">error</span><span class="op" id="4035405">)</span>&nbsp;<span class="op" id="4035407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035410">if</span>&nbsp;<span class="op" id="4035413">!</span><span class="ident" id="4035414">c</span><span class="op" id="4035415">.</span><span class="ident" id="4035416">ok</span><span class="op" id="4035418">(</span><span class="op" id="4035419">)</span>&nbsp;<span class="op" id="4035421">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035425">return</span>&nbsp;<span class="num" id="4035432">0</span><span class="op" id="4035433">,</span>&nbsp;<span class="ident" id="4035435">syscall</span><span class="op" id="4035442">.</span><span class="ident" id="4035443">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035454">if</span>&nbsp;<span class="ident" id="4035457">c</span><span class="op" id="4035458">.</span><span class="ident" id="4035459">fd</span><span class="op" id="4035461">.</span><span class="ident" id="4035462">isConnected</span>&nbsp;<span class="op" id="4035474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035478">return</span>&nbsp;<span class="num" id="4035485">0</span><span class="op" id="4035486">,</span>&nbsp;<span class="op" id="4035488">&amp;</span><span class="ident" id="4035489">OpError</span><span class="op" id="4035496">{</span><span class="ident" id="4035497">Op</span><span class="op" id="4035499">:</span>&nbsp;<span class="string" id="4035501">&#34;write&#34;</span><span class="op" id="4035508">,</span>&nbsp;<span class="ident" id="4035510">Net</span><span class="op" id="4035513">:</span>&nbsp;<span class="ident" id="4035515">c</span><span class="op" id="4035516">.</span><span class="ident" id="4035517">fd</span><span class="op" id="4035519">.</span><span class="ident" id="4035520">net</span><span class="op" id="4035523">,</span>&nbsp;<span class="ident" id="4035525">Addr</span><span class="op" id="4035529">:</span>&nbsp;<span class="ident" id="4035531">addr</span><span class="op" id="4035535">,</span>&nbsp;<span class="ident" id="4035537">Err</span><span class="op" id="4035540">:</span>&nbsp;<span class="ident" id="4035542">ErrWriteToConnected</span><span class="op" id="4035561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035564">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035567">if</span>&nbsp;<span class="ident" id="4035570">addr</span>&nbsp;<span class="op" id="4035575">==</span>&nbsp;<span class="builtintype" id="4035578">nil</span>&nbsp;<span class="op" id="4035582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035586">return</span>&nbsp;<span class="num" id="4035593">0</span><span class="op" id="4035594">,</span>&nbsp;<span class="op" id="4035596">&amp;</span><span class="ident" id="4035597">OpError</span><span class="op" id="4035604">{</span><span class="ident" id="4035605">Op</span><span class="op" id="4035607">:</span>&nbsp;<span class="string" id="4035609">&#34;write&#34;</span><span class="op" id="4035616">,</span>&nbsp;<span class="ident" id="4035618">Net</span><span class="op" id="4035621">:</span>&nbsp;<span class="ident" id="4035623">c</span><span class="op" id="4035624">.</span><span class="ident" id="4035625">fd</span><span class="op" id="4035627">.</span><span class="ident" id="4035628">net</span><span class="op" id="4035631">,</span>&nbsp;<span class="ident" id="4035633">Addr</span><span class="op" id="4035637">:</span>&nbsp;<span class="builtintype" id="4035639">nil</span><span class="op" id="4035642">,</span>&nbsp;<span class="ident" id="4035644">Err</span><span class="op" id="4035647">:</span>&nbsp;<span class="ident" id="4035649">errMissingAddress</span><span class="op" id="4035666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035672">if</span>&nbsp;<span class="ident" id="4035675">addr</span><span class="op" id="4035679">.</span><span class="ident" id="4035680">Net</span>&nbsp;<span class="op" id="4035684">!=</span>&nbsp;<span class="ident" id="4035687">sotypeToNet</span><span class="op" id="4035698">(</span><span class="ident" id="4035699">c</span><span class="op" id="4035700">.</span><span class="ident" id="4035701">fd</span><span class="op" id="4035703">.</span><span class="ident" id="4035704">sotype</span><span class="op" id="4035710">)</span>&nbsp;<span class="op" id="4035712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035716">return</span>&nbsp;<span class="num" id="4035723">0</span><span class="op" id="4035724">,</span>&nbsp;<span class="ident" id="4035726">syscall</span><span class="op" id="4035733">.</span><span class="ident" id="4035734">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035751">sa</span>&nbsp;<span class="op" id="4035754">:=</span>&nbsp;<span class="op" id="4035757">&amp;</span><span class="ident" id="4035758">syscall</span><span class="op" id="4035765">.</span><span class="ident" id="4035766">SockaddrUnix</span><span class="op" id="4035778">{</span><span class="ident" id="4035779">Name</span><span class="op" id="4035783">:</span>&nbsp;<span class="ident" id="4035785">addr</span><span class="op" id="4035789">.</span><span class="ident" id="4035790">Name</span><span class="op" id="4035794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035797">return</span>&nbsp;<span class="ident" id="4035804">c</span><span class="op" id="4035805">.</span><span class="ident" id="4035806">fd</span><span class="op" id="4035808">.</span><span class="ident" id="4035809">writeTo</span><span class="op" id="4035816">(</span><span class="ident" id="4035817">b</span><span class="op" id="4035818">,</span>&nbsp;<span class="ident" id="4035820">sa</span><span class="op" id="4035822">)</span><br>
<span class="lineno"></span><span class="op" id="4035824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4035827">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4035880">func</span>&nbsp;<span class="op" id="4035885">(</span><span class="ident" id="4035886">c</span>&nbsp;<span class="op" id="4035888">*</span><span class="ident" id="4035889">UnixConn</span><span class="op" id="4035897">)</span>&nbsp;<span class="ident" id="4035899">WriteTo</span><span class="op" id="4035906">(</span><span class="ident" id="4035907">b</span>&nbsp;<span class="op" id="4035909">[</span><span class="op" id="4035910">]</span><span class="builtintype" id="4035911">byte</span><span class="op" id="4035915">,</span>&nbsp;<span class="ident" id="4035917">addr</span>&nbsp;<span class="ident" id="4035922">Addr</span><span class="op" id="4035926">)</span>&nbsp;<span class="op" id="4035928">(</span><span class="ident" id="4035929">n</span>&nbsp;<span class="builtintype" id="4035931">int</span><span class="op" id="4035934">,</span>&nbsp;<span class="ident" id="4035936">err</span>&nbsp;<span class="builtintype" id="4035940">error</span><span class="op" id="4035945">)</span>&nbsp;<span class="op" id="4035947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035950">if</span>&nbsp;<span class="op" id="4035953">!</span><span class="ident" id="4035954">c</span><span class="op" id="4035955">.</span><span class="ident" id="4035956">ok</span><span class="op" id="4035958">(</span><span class="op" id="4035959">)</span>&nbsp;<span class="op" id="4035961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4035965">return</span>&nbsp;<span class="num" id="4035972">0</span><span class="op" id="4035973">,</span>&nbsp;<span class="ident" id="4035975">syscall</span><span class="op" id="4035982">.</span><span class="ident" id="4035983">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035991">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035994">a</span><span class="op" id="4035995">,</span>&nbsp;<span class="ident" id="4035997">ok</span>&nbsp;<span class="op" id="4036000">:=</span>&nbsp;<span class="ident" id="4036003">addr</span><span class="op" id="4036007">.</span><span class="op" id="4036008">(</span><span class="op" id="4036009">*</span><span class="ident" id="4036010">UnixAddr</span><span class="op" id="4036018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036021">if</span>&nbsp;<span class="op" id="4036024">!</span><span class="ident" id="4036025">ok</span>&nbsp;<span class="op" id="4036028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036032">return</span>&nbsp;<span class="num" id="4036039">0</span><span class="op" id="4036040">,</span>&nbsp;<span class="op" id="4036042">&amp;</span><span class="ident" id="4036043">OpError</span><span class="op" id="4036050">{</span><span class="string" id="4036051">&#34;write&#34;</span><span class="op" id="4036058">,</span>&nbsp;<span class="ident" id="4036060">c</span><span class="op" id="4036061">.</span><span class="ident" id="4036062">fd</span><span class="op" id="4036064">.</span><span class="ident" id="4036065">net</span><span class="op" id="4036068">,</span>&nbsp;<span class="ident" id="4036070">addr</span><span class="op" id="4036074">,</span>&nbsp;<span class="ident" id="4036076">syscall</span><span class="op" id="4036083">.</span><span class="ident" id="4036084">EINVAL</span><span class="op" id="4036090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036096">return</span>&nbsp;<span class="ident" id="4036103">c</span><span class="op" id="4036104">.</span><span class="ident" id="4036105">WriteToUnix</span><span class="op" id="4036116">(</span><span class="ident" id="4036117">b</span><span class="op" id="4036118">,</span>&nbsp;<span class="ident" id="4036120">a</span><span class="op" id="4036121">)</span><br>
<span class="lineno">190</span><span class="op" id="4036123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036126">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="4036193">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4036261">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="4036317">func</span>&nbsp;<span class="op" id="4036322">(</span><span class="ident" id="4036323">c</span>&nbsp;<span class="op" id="4036325">*</span><span class="ident" id="4036326">UnixConn</span><span class="op" id="4036334">)</span>&nbsp;<span class="ident" id="4036336">WriteMsgUnix</span><span class="op" id="4036348">(</span><span class="ident" id="4036349">b</span><span class="op" id="4036350">,</span>&nbsp;<span class="ident" id="4036352">oob</span>&nbsp;<span class="op" id="4036356">[</span><span class="op" id="4036357">]</span><span class="builtintype" id="4036358">byte</span><span class="op" id="4036362">,</span>&nbsp;<span class="ident" id="4036364">addr</span>&nbsp;<span class="op" id="4036369">*</span><span class="ident" id="4036370">UnixAddr</span><span class="op" id="4036378">)</span>&nbsp;<span class="op" id="4036380">(</span><span class="ident" id="4036381">n</span><span class="op" id="4036382">,</span>&nbsp;<span class="ident" id="4036384">oobn</span>&nbsp;<span class="builtintype" id="4036389">int</span><span class="op" id="4036392">,</span>&nbsp;<span class="ident" id="4036394">err</span>&nbsp;<span class="builtintype" id="4036398">error</span><span class="op" id="4036403">)</span>&nbsp;<span class="op" id="4036405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036408">if</span>&nbsp;<span class="op" id="4036411">!</span><span class="ident" id="4036412">c</span><span class="op" id="4036413">.</span><span class="ident" id="4036414">ok</span><span class="op" id="4036416">(</span><span class="op" id="4036417">)</span>&nbsp;<span class="op" id="4036419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036423">return</span>&nbsp;<span class="num" id="4036430">0</span><span class="op" id="4036431">,</span>&nbsp;<span class="num" id="4036433">0</span><span class="op" id="4036434">,</span>&nbsp;<span class="ident" id="4036436">syscall</span><span class="op" id="4036443">.</span><span class="ident" id="4036444">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036455">if</span>&nbsp;<span class="ident" id="4036458">c</span><span class="op" id="4036459">.</span><span class="ident" id="4036460">fd</span><span class="op" id="4036462">.</span><span class="ident" id="4036463">sotype</span>&nbsp;<span class="op" id="4036470">==</span>&nbsp;<span class="ident" id="4036473">syscall</span><span class="op" id="4036480">.</span><span class="ident" id="4036481">SOCK_DGRAM</span>&nbsp;<span class="op" id="4036492">&amp;&amp;</span>&nbsp;<span class="ident" id="4036495">c</span><span class="op" id="4036496">.</span><span class="ident" id="4036497">fd</span><span class="op" id="4036499">.</span><span class="ident" id="4036500">isConnected</span>&nbsp;<span class="op" id="4036512">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036516">return</span>&nbsp;<span class="num" id="4036523">0</span><span class="op" id="4036524">,</span>&nbsp;<span class="num" id="4036526">0</span><span class="op" id="4036527">,</span>&nbsp;<span class="op" id="4036529">&amp;</span><span class="ident" id="4036530">OpError</span><span class="op" id="4036537">{</span><span class="ident" id="4036538">Op</span><span class="op" id="4036540">:</span>&nbsp;<span class="string" id="4036542">&#34;write&#34;</span><span class="op" id="4036549">,</span>&nbsp;<span class="ident" id="4036551">Net</span><span class="op" id="4036554">:</span>&nbsp;<span class="ident" id="4036556">c</span><span class="op" id="4036557">.</span><span class="ident" id="4036558">fd</span><span class="op" id="4036560">.</span><span class="ident" id="4036561">net</span><span class="op" id="4036564">,</span>&nbsp;<span class="ident" id="4036566">Addr</span><span class="op" id="4036570">:</span>&nbsp;<span class="ident" id="4036572">addr</span><span class="op" id="4036576">,</span>&nbsp;<span class="ident" id="4036578">Err</span><span class="op" id="4036581">:</span>&nbsp;<span class="ident" id="4036583">ErrWriteToConnected</span><span class="op" id="4036602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036608">if</span>&nbsp;<span class="ident" id="4036611">addr</span>&nbsp;<span class="op" id="4036616">!=</span>&nbsp;<span class="builtintype" id="4036619">nil</span>&nbsp;<span class="op" id="4036623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036627">if</span>&nbsp;<span class="ident" id="4036630">addr</span><span class="op" id="4036634">.</span><span class="ident" id="4036635">Net</span>&nbsp;<span class="op" id="4036639">!=</span>&nbsp;<span class="ident" id="4036642">sotypeToNet</span><span class="op" id="4036653">(</span><span class="ident" id="4036654">c</span><span class="op" id="4036655">.</span><span class="ident" id="4036656">fd</span><span class="op" id="4036658">.</span><span class="ident" id="4036659">sotype</span><span class="op" id="4036665">)</span>&nbsp;<span class="op" id="4036667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036672">return</span>&nbsp;<span class="num" id="4036679">0</span><span class="op" id="4036680">,</span>&nbsp;<span class="num" id="4036682">0</span><span class="op" id="4036683">,</span>&nbsp;<span class="ident" id="4036685">syscall</span><span class="op" id="4036692">.</span><span class="ident" id="4036693">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4036712">sa</span>&nbsp;<span class="op" id="4036715">:=</span>&nbsp;<span class="op" id="4036718">&amp;</span><span class="ident" id="4036719">syscall</span><span class="op" id="4036726">.</span><span class="ident" id="4036727">SockaddrUnix</span><span class="op" id="4036739">{</span><span class="ident" id="4036740">Name</span><span class="op" id="4036744">:</span>&nbsp;<span class="ident" id="4036746">addr</span><span class="op" id="4036750">.</span><span class="ident" id="4036751">Name</span><span class="op" id="4036755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036759">return</span>&nbsp;<span class="ident" id="4036766">c</span><span class="op" id="4036767">.</span><span class="ident" id="4036768">fd</span><span class="op" id="4036770">.</span><span class="ident" id="4036771">writeMsg</span><span class="op" id="4036779">(</span><span class="ident" id="4036780">b</span><span class="op" id="4036781">,</span>&nbsp;<span class="ident" id="4036783">oob</span><span class="op" id="4036786">,</span>&nbsp;<span class="ident" id="4036788">sa</span><span class="op" id="4036790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4036793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036796">return</span>&nbsp;<span class="ident" id="4036803">c</span><span class="op" id="4036804">.</span><span class="ident" id="4036805">fd</span><span class="op" id="4036807">.</span><span class="ident" id="4036808">writeMsg</span><span class="op" id="4036816">(</span><span class="ident" id="4036817">b</span><span class="op" id="4036818">,</span>&nbsp;<span class="ident" id="4036820">oob</span><span class="op" id="4036823">,</span>&nbsp;<span class="builtintype" id="4036825">nil</span><span class="op" id="4036828">)</span><br>
<span class="lineno">210</span><span class="op" id="4036830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036833">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4036905">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4036944">func</span>&nbsp;<span class="op" id="4036949">(</span><span class="ident" id="4036950">c</span>&nbsp;<span class="op" id="4036952">*</span><span class="ident" id="4036953">UnixConn</span><span class="op" id="4036961">)</span>&nbsp;<span class="ident" id="4036963">CloseRead</span><span class="op" id="4036972">(</span><span class="op" id="4036973">)</span>&nbsp;<span class="builtintype" id="4036975">error</span>&nbsp;<span class="op" id="4036981">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036984">if</span>&nbsp;<span class="op" id="4036987">!</span><span class="ident" id="4036988">c</span><span class="op" id="4036989">.</span><span class="ident" id="4036990">ok</span><span class="op" id="4036992">(</span><span class="op" id="4036993">)</span>&nbsp;<span class="op" id="4036995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4036999">return</span>&nbsp;<span class="ident" id="4037006">syscall</span><span class="op" id="4037013">.</span><span class="ident" id="4037014">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037025">return</span>&nbsp;<span class="ident" id="4037032">c</span><span class="op" id="4037033">.</span><span class="ident" id="4037034">fd</span><span class="op" id="4037036">.</span><span class="ident" id="4037037">closeRead</span><span class="op" id="4037046">(</span><span class="op" id="4037047">)</span><br>
<span class="lineno"></span><span class="op" id="4037049">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4037052">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4037125">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4037164">func</span>&nbsp;<span class="op" id="4037169">(</span><span class="ident" id="4037170">c</span>&nbsp;<span class="op" id="4037172">*</span><span class="ident" id="4037173">UnixConn</span><span class="op" id="4037181">)</span>&nbsp;<span class="ident" id="4037183">CloseWrite</span><span class="op" id="4037193">(</span><span class="op" id="4037194">)</span>&nbsp;<span class="builtintype" id="4037196">error</span>&nbsp;<span class="op" id="4037202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037205">if</span>&nbsp;<span class="op" id="4037208">!</span><span class="ident" id="4037209">c</span><span class="op" id="4037210">.</span><span class="ident" id="4037211">ok</span><span class="op" id="4037213">(</span><span class="op" id="4037214">)</span>&nbsp;<span class="op" id="4037216">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037220">return</span>&nbsp;<span class="ident" id="4037227">syscall</span><span class="op" id="4037234">.</span><span class="ident" id="4037235">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037246">return</span>&nbsp;<span class="ident" id="4037253">c</span><span class="op" id="4037254">.</span><span class="ident" id="4037255">fd</span><span class="op" id="4037257">.</span><span class="ident" id="4037258">closeWrite</span><span class="op" id="4037268">(</span><span class="op" id="4037269">)</span><br>
<span class="lineno"></span><span class="op" id="4037271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="4037274">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4037343">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4037413">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4037473">func</span>&nbsp;<span class="ident" id="4037478">DialUnix</span><span class="op" id="4037486">(</span><span class="ident" id="4037487">net</span>&nbsp;<span class="builtintype" id="4037491">string</span><span class="op" id="4037497">,</span>&nbsp;<span class="ident" id="4037499">laddr</span><span class="op" id="4037504">,</span>&nbsp;<span class="ident" id="4037506">raddr</span>&nbsp;<span class="op" id="4037512">*</span><span class="ident" id="4037513">UnixAddr</span><span class="op" id="4037521">)</span>&nbsp;<span class="op" id="4037523">(</span><span class="op" id="4037524">*</span><span class="ident" id="4037525">UnixConn</span><span class="op" id="4037533">,</span>&nbsp;<span class="builtintype" id="4037535">error</span><span class="op" id="4037540">)</span>&nbsp;<span class="op" id="4037542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037545">switch</span>&nbsp;<span class="ident" id="4037552">net</span>&nbsp;<span class="op" id="4037556">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037559">case</span>&nbsp;<span class="string" id="4037564">&#34;unix&#34;</span><span class="op" id="4037570">,</span>&nbsp;<span class="string" id="4037572">&#34;unixgram&#34;</span><span class="op" id="4037582">,</span>&nbsp;<span class="string" id="4037584">&#34;unixpacket&#34;</span><span class="op" id="4037596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037599">default</span><span class="op" id="4037606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037610">return</span>&nbsp;<span class="builtintype" id="4037617">nil</span><span class="op" id="4037620">,</span>&nbsp;<span class="op" id="4037622">&amp;</span><span class="ident" id="4037623">OpError</span><span class="op" id="4037630">{</span><span class="ident" id="4037631">Op</span><span class="op" id="4037633">:</span>&nbsp;<span class="string" id="4037635">&#34;dial&#34;</span><span class="op" id="4037641">,</span>&nbsp;<span class="ident" id="4037643">Net</span><span class="op" id="4037646">:</span>&nbsp;<span class="ident" id="4037648">net</span><span class="op" id="4037651">,</span>&nbsp;<span class="ident" id="4037653">Addr</span><span class="op" id="4037657">:</span>&nbsp;<span class="ident" id="4037659">raddr</span><span class="op" id="4037664">,</span>&nbsp;<span class="ident" id="4037666">Err</span><span class="op" id="4037669">:</span>&nbsp;<span class="ident" id="4037671">UnknownNetworkError</span><span class="op" id="4037690">(</span><span class="ident" id="4037691">net</span><span class="op" id="4037694">)</span><span class="op" id="4037695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037701">return</span>&nbsp;<span class="ident" id="4037708">dialUnix</span><span class="op" id="4037716">(</span><span class="ident" id="4037717">net</span><span class="op" id="4037720">,</span>&nbsp;<span class="ident" id="4037722">laddr</span><span class="op" id="4037727">,</span>&nbsp;<span class="ident" id="4037729">raddr</span><span class="op" id="4037734">,</span>&nbsp;<span class="ident" id="4037736">noDeadline</span><span class="op" id="4037746">)</span><br>
<span class="lineno">240</span><span class="op" id="4037748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4037751">func</span>&nbsp;<span class="ident" id="4037756">dialUnix</span><span class="op" id="4037764">(</span><span class="ident" id="4037765">net</span>&nbsp;<span class="builtintype" id="4037769">string</span><span class="op" id="4037775">,</span>&nbsp;<span class="ident" id="4037777">laddr</span><span class="op" id="4037782">,</span>&nbsp;<span class="ident" id="4037784">raddr</span>&nbsp;<span class="op" id="4037790">*</span><span class="ident" id="4037791">UnixAddr</span><span class="op" id="4037799">,</span>&nbsp;<span class="ident" id="4037801">deadline</span>&nbsp;<span class="ident" id="4037810">time</span><span class="op" id="4037814">.</span><span class="ident" id="4037815">Time</span><span class="op" id="4037819">)</span>&nbsp;<span class="op" id="4037821">(</span><span class="op" id="4037822">*</span><span class="ident" id="4037823">UnixConn</span><span class="op" id="4037831">,</span>&nbsp;<span class="builtintype" id="4037833">error</span><span class="op" id="4037838">)</span>&nbsp;<span class="op" id="4037840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4037843">fd</span><span class="op" id="4037845">,</span>&nbsp;<span class="ident" id="4037847">err</span>&nbsp;<span class="op" id="4037851">:=</span>&nbsp;<span class="ident" id="4037854">unixSocket</span><span class="op" id="4037864">(</span><span class="ident" id="4037865">net</span><span class="op" id="4037868">,</span>&nbsp;<span class="ident" id="4037870">laddr</span><span class="op" id="4037875">,</span>&nbsp;<span class="ident" id="4037877">raddr</span><span class="op" id="4037882">,</span>&nbsp;<span class="string" id="4037884">&#34;dial&#34;</span><span class="op" id="4037890">,</span>&nbsp;<span class="ident" id="4037892">deadline</span><span class="op" id="4037900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037903">if</span>&nbsp;<span class="ident" id="4037906">err</span>&nbsp;<span class="op" id="4037910">!=</span>&nbsp;<span class="builtintype" id="4037913">nil</span>&nbsp;<span class="op" id="4037917">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037921">return</span>&nbsp;<span class="builtintype" id="4037928">nil</span><span class="op" id="4037931">,</span>&nbsp;<span class="op" id="4037933">&amp;</span><span class="ident" id="4037934">OpError</span><span class="op" id="4037941">{</span><span class="ident" id="4037942">Op</span><span class="op" id="4037944">:</span>&nbsp;<span class="string" id="4037946">&#34;dial&#34;</span><span class="op" id="4037952">,</span>&nbsp;<span class="ident" id="4037954">Net</span><span class="op" id="4037957">:</span>&nbsp;<span class="ident" id="4037959">net</span><span class="op" id="4037962">,</span>&nbsp;<span class="ident" id="4037964">Addr</span><span class="op" id="4037968">:</span>&nbsp;<span class="ident" id="4037970">raddr</span><span class="op" id="4037975">,</span>&nbsp;<span class="ident" id="4037977">Err</span><span class="op" id="4037980">:</span>&nbsp;<span class="ident" id="4037982">err</span><span class="op" id="4037985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4037988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4037991">return</span>&nbsp;<span class="ident" id="4037998">newUnixConn</span><span class="op" id="4038009">(</span><span class="ident" id="4038010">fd</span><span class="op" id="4038012">)</span><span class="op" id="4038013">,</span>&nbsp;<span class="builtintype" id="4038015">nil</span><br>
<span class="lineno"></span><span class="op" id="4038019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4038022">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4038088">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="4038157">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="4038176">type</span>&nbsp;<span class="ident" id="4038181">UnixListener</span>&nbsp;<span class="keyword" id="4038194">struct</span>&nbsp;<span class="op" id="4038201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038204">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4038209">*</span><span class="ident" id="4038210">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038217">path</span>&nbsp;<span class="builtintype" id="4038222">string</span><br>
<span class="lineno"></span><span class="op" id="4038229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4038232">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4038302">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="4038369">func</span>&nbsp;<span class="ident" id="4038374">ListenUnix</span><span class="op" id="4038384">(</span><span class="ident" id="4038385">net</span>&nbsp;<span class="builtintype" id="4038389">string</span><span class="op" id="4038395">,</span>&nbsp;<span class="ident" id="4038397">laddr</span>&nbsp;<span class="op" id="4038403">*</span><span class="ident" id="4038404">UnixAddr</span><span class="op" id="4038412">)</span>&nbsp;<span class="op" id="4038414">(</span><span class="op" id="4038415">*</span><span class="ident" id="4038416">UnixListener</span><span class="op" id="4038428">,</span>&nbsp;<span class="builtintype" id="4038430">error</span><span class="op" id="4038435">)</span>&nbsp;<span class="op" id="4038437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038440">switch</span>&nbsp;<span class="ident" id="4038447">net</span>&nbsp;<span class="op" id="4038451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038454">case</span>&nbsp;<span class="string" id="4038459">&#34;unix&#34;</span><span class="op" id="4038465">,</span>&nbsp;<span class="string" id="4038467">&#34;unixpacket&#34;</span><span class="op" id="4038479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038482">default</span><span class="op" id="4038489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038493">return</span>&nbsp;<span class="builtintype" id="4038500">nil</span><span class="op" id="4038503">,</span>&nbsp;<span class="op" id="4038505">&amp;</span><span class="ident" id="4038506">OpError</span><span class="op" id="4038513">{</span><span class="ident" id="4038514">Op</span><span class="op" id="4038516">:</span>&nbsp;<span class="string" id="4038518">&#34;listen&#34;</span><span class="op" id="4038526">,</span>&nbsp;<span class="ident" id="4038528">Net</span><span class="op" id="4038531">:</span>&nbsp;<span class="ident" id="4038533">net</span><span class="op" id="4038536">,</span>&nbsp;<span class="ident" id="4038538">Addr</span><span class="op" id="4038542">:</span>&nbsp;<span class="ident" id="4038544">laddr</span><span class="op" id="4038549">,</span>&nbsp;<span class="ident" id="4038551">Err</span><span class="op" id="4038554">:</span>&nbsp;<span class="ident" id="4038556">UnknownNetworkError</span><span class="op" id="4038575">(</span><span class="ident" id="4038576">net</span><span class="op" id="4038579">)</span><span class="op" id="4038580">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038586">if</span>&nbsp;<span class="ident" id="4038589">laddr</span>&nbsp;<span class="op" id="4038595">==</span>&nbsp;<span class="builtintype" id="4038598">nil</span>&nbsp;<span class="op" id="4038602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038606">return</span>&nbsp;<span class="builtintype" id="4038613">nil</span><span class="op" id="4038616">,</span>&nbsp;<span class="op" id="4038618">&amp;</span><span class="ident" id="4038619">OpError</span><span class="op" id="4038626">{</span><span class="ident" id="4038627">Op</span><span class="op" id="4038629">:</span>&nbsp;<span class="string" id="4038631">&#34;listen&#34;</span><span class="op" id="4038639">,</span>&nbsp;<span class="ident" id="4038641">Net</span><span class="op" id="4038644">:</span>&nbsp;<span class="ident" id="4038646">net</span><span class="op" id="4038649">,</span>&nbsp;<span class="ident" id="4038651">Addr</span><span class="op" id="4038655">:</span>&nbsp;<span class="builtintype" id="4038657">nil</span><span class="op" id="4038660">,</span>&nbsp;<span class="ident" id="4038662">Err</span><span class="op" id="4038665">:</span>&nbsp;<span class="ident" id="4038667">errMissingAddress</span><span class="op" id="4038684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4038690">fd</span><span class="op" id="4038692">,</span>&nbsp;<span class="ident" id="4038694">err</span>&nbsp;<span class="op" id="4038698">:=</span>&nbsp;<span class="ident" id="4038701">unixSocket</span><span class="op" id="4038711">(</span><span class="ident" id="4038712">net</span><span class="op" id="4038715">,</span>&nbsp;<span class="ident" id="4038717">laddr</span><span class="op" id="4038722">,</span>&nbsp;<span class="builtintype" id="4038724">nil</span><span class="op" id="4038727">,</span>&nbsp;<span class="string" id="4038729">&#34;listen&#34;</span><span class="op" id="4038737">,</span>&nbsp;<span class="ident" id="4038739">noDeadline</span><span class="op" id="4038749">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038752">if</span>&nbsp;<span class="ident" id="4038755">err</span>&nbsp;<span class="op" id="4038759">!=</span>&nbsp;<span class="builtintype" id="4038762">nil</span>&nbsp;<span class="op" id="4038766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038770">return</span>&nbsp;<span class="builtintype" id="4038777">nil</span><span class="op" id="4038780">,</span>&nbsp;<span class="op" id="4038782">&amp;</span><span class="ident" id="4038783">OpError</span><span class="op" id="4038790">{</span><span class="ident" id="4038791">Op</span><span class="op" id="4038793">:</span>&nbsp;<span class="string" id="4038795">&#34;listen&#34;</span><span class="op" id="4038803">,</span>&nbsp;<span class="ident" id="4038805">Net</span><span class="op" id="4038808">:</span>&nbsp;<span class="ident" id="4038810">net</span><span class="op" id="4038813">,</span>&nbsp;<span class="ident" id="4038815">Addr</span><span class="op" id="4038819">:</span>&nbsp;<span class="ident" id="4038821">laddr</span><span class="op" id="4038826">,</span>&nbsp;<span class="ident" id="4038828">Err</span><span class="op" id="4038831">:</span>&nbsp;<span class="ident" id="4038833">err</span><span class="op" id="4038836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4038839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4038842">return</span>&nbsp;<span class="op" id="4038849">&amp;</span><span class="ident" id="4038850">UnixListener</span><span class="op" id="4038862">{</span><span class="ident" id="4038863">fd</span><span class="op" id="4038865">,</span>&nbsp;<span class="ident" id="4038867">fd</span><span class="op" id="4038869">.</span><span class="ident" id="4038870">laddr</span><span class="op" id="4038875">.</span><span class="ident" id="4038876">String</span><span class="op" id="4038882">(</span><span class="op" id="4038883">)</span><span class="op" id="4038884">}</span><span class="op" id="4038885">,</span>&nbsp;<span class="builtintype" id="4038887">nil</span><br>
<span class="lineno"></span><span class="op" id="4038891">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="4038894">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4038959">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4038974">func</span>&nbsp;<span class="op" id="4038979">(</span><span class="ident" id="4038980">l</span>&nbsp;<span class="op" id="4038982">*</span><span class="ident" id="4038983">UnixListener</span><span class="op" id="4038995">)</span>&nbsp;<span class="ident" id="4038997">AcceptUnix</span><span class="op" id="4039007">(</span><span class="op" id="4039008">)</span>&nbsp;<span class="op" id="4039010">(</span><span class="op" id="4039011">*</span><span class="ident" id="4039012">UnixConn</span><span class="op" id="4039020">,</span>&nbsp;<span class="builtintype" id="4039022">error</span><span class="op" id="4039027">)</span>&nbsp;<span class="op" id="4039029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039032">if</span>&nbsp;<span class="ident" id="4039035">l</span>&nbsp;<span class="op" id="4039037">==</span>&nbsp;<span class="builtintype" id="4039040">nil</span>&nbsp;<span class="op" id="4039044">||</span>&nbsp;<span class="ident" id="4039047">l</span><span class="op" id="4039048">.</span><span class="ident" id="4039049">fd</span>&nbsp;<span class="op" id="4039052">==</span>&nbsp;<span class="builtintype" id="4039055">nil</span>&nbsp;<span class="op" id="4039059">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039063">return</span>&nbsp;<span class="builtintype" id="4039070">nil</span><span class="op" id="4039073">,</span>&nbsp;<span class="ident" id="4039075">syscall</span><span class="op" id="4039082">.</span><span class="ident" id="4039083">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039094">fd</span><span class="op" id="4039096">,</span>&nbsp;<span class="ident" id="4039098">err</span>&nbsp;<span class="op" id="4039102">:=</span>&nbsp;<span class="ident" id="4039105">l</span><span class="op" id="4039106">.</span><span class="ident" id="4039107">fd</span><span class="op" id="4039109">.</span><span class="ident" id="4039110">accept</span><span class="op" id="4039116">(</span><span class="op" id="4039117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039120">if</span>&nbsp;<span class="ident" id="4039123">err</span>&nbsp;<span class="op" id="4039127">!=</span>&nbsp;<span class="builtintype" id="4039130">nil</span>&nbsp;<span class="op" id="4039134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039138">return</span>&nbsp;<span class="builtintype" id="4039145">nil</span><span class="op" id="4039148">,</span>&nbsp;<span class="ident" id="4039150">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039158">c</span>&nbsp;<span class="op" id="4039160">:=</span>&nbsp;<span class="ident" id="4039163">newUnixConn</span><span class="op" id="4039174">(</span><span class="ident" id="4039175">fd</span><span class="op" id="4039177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039180">return</span>&nbsp;<span class="ident" id="4039187">c</span><span class="op" id="4039188">,</span>&nbsp;<span class="builtintype" id="4039190">nil</span><br>
<span class="lineno"></span><span class="op" id="4039194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="4039197">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4039266">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="4039321">func</span>&nbsp;<span class="op" id="4039326">(</span><span class="ident" id="4039327">l</span>&nbsp;<span class="op" id="4039329">*</span><span class="ident" id="4039330">UnixListener</span><span class="op" id="4039342">)</span>&nbsp;<span class="ident" id="4039344">Accept</span><span class="op" id="4039350">(</span><span class="op" id="4039351">)</span>&nbsp;<span class="op" id="4039353">(</span><span class="ident" id="4039354">c</span>&nbsp;<span class="ident" id="4039356">Conn</span><span class="op" id="4039360">,</span>&nbsp;<span class="ident" id="4039362">err</span>&nbsp;<span class="builtintype" id="4039366">error</span><span class="op" id="4039371">)</span>&nbsp;<span class="op" id="4039373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039376">c1</span><span class="op" id="4039378">,</span>&nbsp;<span class="ident" id="4039380">err</span>&nbsp;<span class="op" id="4039384">:=</span>&nbsp;<span class="ident" id="4039387">l</span><span class="op" id="4039388">.</span><span class="ident" id="4039389">AcceptUnix</span><span class="op" id="4039399">(</span><span class="op" id="4039400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039403">if</span>&nbsp;<span class="ident" id="4039406">err</span>&nbsp;<span class="op" id="4039410">!=</span>&nbsp;<span class="builtintype" id="4039413">nil</span>&nbsp;<span class="op" id="4039417">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039421">return</span>&nbsp;<span class="builtintype" id="4039428">nil</span><span class="op" id="4039431">,</span>&nbsp;<span class="ident" id="4039433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039441">return</span>&nbsp;<span class="ident" id="4039448">c1</span><span class="op" id="4039450">,</span>&nbsp;<span class="builtintype" id="4039452">nil</span><br>
<span class="lineno"></span><span class="op" id="4039456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4039459">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="4039523">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4039554">func</span>&nbsp;<span class="op" id="4039559">(</span><span class="ident" id="4039560">l</span>&nbsp;<span class="op" id="4039562">*</span><span class="ident" id="4039563">UnixListener</span><span class="op" id="4039575">)</span>&nbsp;<span class="ident" id="4039577">Close</span><span class="op" id="4039582">(</span><span class="op" id="4039583">)</span>&nbsp;<span class="builtintype" id="4039585">error</span>&nbsp;<span class="op" id="4039591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039594">if</span>&nbsp;<span class="ident" id="4039597">l</span>&nbsp;<span class="op" id="4039599">==</span>&nbsp;<span class="builtintype" id="4039602">nil</span>&nbsp;<span class="op" id="4039606">||</span>&nbsp;<span class="ident" id="4039609">l</span><span class="op" id="4039610">.</span><span class="ident" id="4039611">fd</span>&nbsp;<span class="op" id="4039614">==</span>&nbsp;<span class="builtintype" id="4039617">nil</span>&nbsp;<span class="op" id="4039621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4039625">return</span>&nbsp;<span class="ident" id="4039632">syscall</span><span class="op" id="4039639">.</span><span class="ident" id="4039640">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4039648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039652">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039694">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039735">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039773">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039816">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039861">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039904">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039946">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4039994">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4040040">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040074">if</span>&nbsp;<span class="ident" id="4040077">l</span><span class="op" id="4040078">.</span><span class="ident" id="4040079">path</span><span class="op" id="4040083">[</span><span class="num" id="4040084">0</span><span class="op" id="4040085">]</span>&nbsp;<span class="op" id="4040087">!=</span>&nbsp;<span class="string" id="4040090">&#39;@&#39;</span>&nbsp;<span class="op" id="4040094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4040098">syscall</span><span class="op" id="4040105">.</span><span class="ident" id="4040106">Unlink</span><span class="op" id="4040112">(</span><span class="ident" id="4040113">l</span><span class="op" id="4040114">.</span><span class="ident" id="4040115">path</span><span class="op" id="4040119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040122">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040125">return</span>&nbsp;<span class="ident" id="4040132">l</span><span class="op" id="4040133">.</span><span class="ident" id="4040134">fd</span><span class="op" id="4040136">.</span><span class="ident" id="4040137">Close</span><span class="op" id="4040142">(</span><span class="op" id="4040143">)</span><br>
<span class="lineno"></span><span class="op" id="4040145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4040148">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4040196">func</span>&nbsp;<span class="op" id="4040201">(</span><span class="ident" id="4040202">l</span>&nbsp;<span class="op" id="4040204">*</span><span class="ident" id="4040205">UnixListener</span><span class="op" id="4040217">)</span>&nbsp;<span class="ident" id="4040219">Addr</span><span class="op" id="4040223">(</span><span class="op" id="4040224">)</span>&nbsp;<span class="ident" id="4040226">Addr</span>&nbsp;<span class="op" id="4040231">{</span>&nbsp;<span class="keyword" id="4040233">return</span>&nbsp;<span class="ident" id="4040240">l</span><span class="op" id="4040241">.</span><span class="ident" id="4040242">fd</span><span class="op" id="4040244">.</span><span class="ident" id="4040245">laddr</span>&nbsp;<span class="op" id="4040251">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4040254">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="4040317">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="4040361">func</span>&nbsp;<span class="op" id="4040366">(</span><span class="ident" id="4040367">l</span>&nbsp;<span class="op" id="4040369">*</span><span class="ident" id="4040370">UnixListener</span><span class="op" id="4040382">)</span>&nbsp;<span class="ident" id="4040384">SetDeadline</span><span class="op" id="4040395">(</span><span class="ident" id="4040396">t</span>&nbsp;<span class="ident" id="4040398">time</span><span class="op" id="4040402">.</span><span class="ident" id="4040403">Time</span><span class="op" id="4040407">)</span>&nbsp;<span class="op" id="4040409">(</span><span class="ident" id="4040410">err</span>&nbsp;<span class="builtintype" id="4040414">error</span><span class="op" id="4040419">)</span>&nbsp;<span class="op" id="4040421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040424">if</span>&nbsp;<span class="ident" id="4040427">l</span>&nbsp;<span class="op" id="4040429">==</span>&nbsp;<span class="builtintype" id="4040432">nil</span>&nbsp;<span class="op" id="4040436">||</span>&nbsp;<span class="ident" id="4040439">l</span><span class="op" id="4040440">.</span><span class="ident" id="4040441">fd</span>&nbsp;<span class="op" id="4040444">==</span>&nbsp;<span class="builtintype" id="4040447">nil</span>&nbsp;<span class="op" id="4040451">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040455">return</span>&nbsp;<span class="ident" id="4040462">syscall</span><span class="op" id="4040469">.</span><span class="ident" id="4040470">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4040478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4040481">return</span>&nbsp;<span class="ident" id="4040488">l</span><span class="op" id="4040489">.</span><span class="ident" id="4040490">fd</span><span class="op" id="4040492">.</span><span class="ident" id="4040493">setDeadline</span><span class="op" id="4040504">(</span><span class="ident" id="4040505">t</span><span class="op" id="4040506">)</span><br>
<span class="lineno"></span><span class="op" id="4040508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="4040511">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="4040577">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="4040647">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="4040712">//</span><br>
<span class="lineno"></span><span class="comment" id="4040715">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="4040779">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="4040845">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="4040909">func</span>&nbsp;<span class="op" id="4040914">(</span><span class="ident" id="4040915">l</span>&nbsp;<span class="op" id="4040917">*</span><span class="ident" id="4040918">UnixListener</span><span class="op" id="4040930">)</span>&nbsp;<span class="ident" id="4040932">File</span><span class="op" id="4040936">(</span><span class="op" id="4040937">)</span>&nbsp;<span class="op" id="4040939">(</span><span class="ident" id="4040940">f</span>&nbsp;<span class="op" id="4040942">*</span><span class="ident" id="4040943">os</span><span class="op" id="4040945">.</span><span class="ident" id="4040946">File</span><span class="op" id="4040950">,</span>&nbsp;<span class="ident" id="4040952">err</span>&nbsp;<span class="builtintype" id="4040956">error</span><span class="op" id="4040961">)</span>&nbsp;<span class="op" id="4040963">{</span>&nbsp;<span class="keyword" id="4040965">return</span>&nbsp;<span class="ident" id="4040972">l</span><span class="op" id="4040973">.</span><span class="ident" id="4040974">fd</span><span class="op" id="4040976">.</span><span class="ident" id="4040977">dup</span><span class="op" id="4040980">(</span><span class="op" id="4040981">)</span>&nbsp;<span class="op" id="4040983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4040986">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="4041057">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4041125">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4041195">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="4041254">func</span>&nbsp;<span class="ident" id="4041259">ListenUnixgram</span><span class="op" id="4041273">(</span><span class="ident" id="4041274">net</span>&nbsp;<span class="builtintype" id="4041278">string</span><span class="op" id="4041284">,</span>&nbsp;<span class="ident" id="4041286">laddr</span>&nbsp;<span class="op" id="4041292">*</span><span class="ident" id="4041293">UnixAddr</span><span class="op" id="4041301">)</span>&nbsp;<span class="op" id="4041303">(</span><span class="op" id="4041304">*</span><span class="ident" id="4041305">UnixConn</span><span class="op" id="4041313">,</span>&nbsp;<span class="builtintype" id="4041315">error</span><span class="op" id="4041320">)</span>&nbsp;<span class="op" id="4041322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041325">switch</span>&nbsp;<span class="ident" id="4041332">net</span>&nbsp;<span class="op" id="4041336">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041339">case</span>&nbsp;<span class="string" id="4041344">&#34;unixgram&#34;</span><span class="op" id="4041354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041357">default</span><span class="op" id="4041364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041368">return</span>&nbsp;<span class="builtintype" id="4041375">nil</span><span class="op" id="4041378">,</span>&nbsp;<span class="op" id="4041380">&amp;</span><span class="ident" id="4041381">OpError</span><span class="op" id="4041388">{</span><span class="ident" id="4041389">Op</span><span class="op" id="4041391">:</span>&nbsp;<span class="string" id="4041393">&#34;listen&#34;</span><span class="op" id="4041401">,</span>&nbsp;<span class="ident" id="4041403">Net</span><span class="op" id="4041406">:</span>&nbsp;<span class="ident" id="4041408">net</span><span class="op" id="4041411">,</span>&nbsp;<span class="ident" id="4041413">Addr</span><span class="op" id="4041417">:</span>&nbsp;<span class="ident" id="4041419">laddr</span><span class="op" id="4041424">,</span>&nbsp;<span class="ident" id="4041426">Err</span><span class="op" id="4041429">:</span>&nbsp;<span class="ident" id="4041431">UnknownNetworkError</span><span class="op" id="4041450">(</span><span class="ident" id="4041451">net</span><span class="op" id="4041454">)</span><span class="op" id="4041455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041461">if</span>&nbsp;<span class="ident" id="4041464">laddr</span>&nbsp;<span class="op" id="4041470">==</span>&nbsp;<span class="builtintype" id="4041473">nil</span>&nbsp;<span class="op" id="4041477">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041481">return</span>&nbsp;<span class="builtintype" id="4041488">nil</span><span class="op" id="4041491">,</span>&nbsp;<span class="op" id="4041493">&amp;</span><span class="ident" id="4041494">OpError</span><span class="op" id="4041501">{</span><span class="ident" id="4041502">Op</span><span class="op" id="4041504">:</span>&nbsp;<span class="string" id="4041506">&#34;listen&#34;</span><span class="op" id="4041514">,</span>&nbsp;<span class="ident" id="4041516">Net</span><span class="op" id="4041519">:</span>&nbsp;<span class="ident" id="4041521">net</span><span class="op" id="4041524">,</span>&nbsp;<span class="ident" id="4041526">Addr</span><span class="op" id="4041530">:</span>&nbsp;<span class="builtintype" id="4041532">nil</span><span class="op" id="4041535">,</span>&nbsp;<span class="ident" id="4041537">Err</span><span class="op" id="4041540">:</span>&nbsp;<span class="ident" id="4041542">errMissingAddress</span><span class="op" id="4041559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041565">fd</span><span class="op" id="4041567">,</span>&nbsp;<span class="ident" id="4041569">err</span>&nbsp;<span class="op" id="4041573">:=</span>&nbsp;<span class="ident" id="4041576">unixSocket</span><span class="op" id="4041586">(</span><span class="ident" id="4041587">net</span><span class="op" id="4041590">,</span>&nbsp;<span class="ident" id="4041592">laddr</span><span class="op" id="4041597">,</span>&nbsp;<span class="builtintype" id="4041599">nil</span><span class="op" id="4041602">,</span>&nbsp;<span class="string" id="4041604">&#34;listen&#34;</span><span class="op" id="4041612">,</span>&nbsp;<span class="ident" id="4041614">noDeadline</span><span class="op" id="4041624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041627">if</span>&nbsp;<span class="ident" id="4041630">err</span>&nbsp;<span class="op" id="4041634">!=</span>&nbsp;<span class="builtintype" id="4041637">nil</span>&nbsp;<span class="op" id="4041641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041645">return</span>&nbsp;<span class="builtintype" id="4041652">nil</span><span class="op" id="4041655">,</span>&nbsp;<span class="op" id="4041657">&amp;</span><span class="ident" id="4041658">OpError</span><span class="op" id="4041665">{</span><span class="ident" id="4041666">Op</span><span class="op" id="4041668">:</span>&nbsp;<span class="string" id="4041670">&#34;listen&#34;</span><span class="op" id="4041678">,</span>&nbsp;<span class="ident" id="4041680">Net</span><span class="op" id="4041683">:</span>&nbsp;<span class="ident" id="4041685">net</span><span class="op" id="4041688">,</span>&nbsp;<span class="ident" id="4041690">Addr</span><span class="op" id="4041694">:</span>&nbsp;<span class="ident" id="4041696">laddr</span><span class="op" id="4041701">,</span>&nbsp;<span class="ident" id="4041703">Err</span><span class="op" id="4041706">:</span>&nbsp;<span class="ident" id="4041708">err</span><span class="op" id="4041711">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4041714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041717">return</span>&nbsp;<span class="ident" id="4041724">newUnixConn</span><span class="op" id="4041735">(</span><span class="ident" id="4041736">fd</span><span class="op" id="4041738">)</span><span class="op" id="4041739">,</span>&nbsp;<span class="builtintype" id="4041741">nil</span><br>
<span class="lineno"></span><span class="op" id="4041745">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
