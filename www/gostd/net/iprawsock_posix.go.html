<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3662249">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3662305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3662359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3662410">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3662488">package</span>&nbsp;<span class="ident" id="3662496">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3662501">import</span>&nbsp;<span class="op" id="3662508">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3662511">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3662522">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3662529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3662532">//&nbsp;BUG(mikio):&nbsp;On&nbsp;every&nbsp;POSIX&nbsp;platform,&nbsp;reads&nbsp;from&nbsp;the&nbsp;&#34;ip4&#34;&nbsp;network</span><br>
<span class="lineno">15</span><span class="comment" id="3662601">//&nbsp;using&nbsp;the&nbsp;ReadFrom&nbsp;or&nbsp;ReadFromIP&nbsp;method&nbsp;might&nbsp;not&nbsp;return&nbsp;a&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3662672">//&nbsp;IPv4&nbsp;packet,&nbsp;including&nbsp;its&nbsp;header,&nbsp;even&nbsp;if&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3662733">//&nbsp;available.&nbsp;This&nbsp;can&nbsp;occur&nbsp;even&nbsp;in&nbsp;cases&nbsp;where&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3662800">//&nbsp;could&nbsp;return&nbsp;a&nbsp;complete&nbsp;packet.&nbsp;For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;is&nbsp;recommended</span><br>
<span class="lineno"></span><span class="comment" id="3662870">//&nbsp;that&nbsp;you&nbsp;do&nbsp;not&nbsp;uses&nbsp;these&nbsp;methods&nbsp;if&nbsp;it&nbsp;is&nbsp;important&nbsp;to&nbsp;receive&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3662940">//&nbsp;full&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3662956">//</span><br>
<span class="lineno"></span><span class="comment" id="3662959">//&nbsp;The&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines&nbsp;make&nbsp;it&nbsp;impossible&nbsp;for&nbsp;us&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3663025">//&nbsp;change&nbsp;the&nbsp;behavior&nbsp;of&nbsp;these&nbsp;methods;&nbsp;use&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3663088">//&nbsp;instead.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3663101">func</span>&nbsp;<span class="ident" id="3663106">sockaddrToIP</span><span class="op" id="3663118">(</span><span class="ident" id="3663119">sa</span>&nbsp;<span class="ident" id="3663122">syscall</span><span class="op" id="3663129">.</span><span class="ident" id="3663130">Sockaddr</span><span class="op" id="3663138">)</span>&nbsp;<span class="ident" id="3663140">Addr</span>&nbsp;<span class="op" id="3663145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663148">switch</span>&nbsp;<span class="ident" id="3663155">sa</span>&nbsp;<span class="op" id="3663158">:=</span>&nbsp;<span class="ident" id="3663161">sa</span><span class="op" id="3663163">.</span><span class="op" id="3663164">(</span><span class="keyword" id="3663165">type</span><span class="op" id="3663169">)</span>&nbsp;<span class="op" id="3663171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663174">case</span>&nbsp;<span class="op" id="3663179">*</span><span class="ident" id="3663180">syscall</span><span class="op" id="3663187">.</span><span class="ident" id="3663188">SockaddrInet4</span><span class="op" id="3663201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663205">return</span>&nbsp;<span class="op" id="3663212">&amp;</span><span class="ident" id="3663213">IPAddr</span><span class="op" id="3663219">{</span><span class="ident" id="3663220">IP</span><span class="op" id="3663222">:</span>&nbsp;<span class="ident" id="3663224">sa</span><span class="op" id="3663226">.</span><span class="ident" id="3663227">Addr</span><span class="op" id="3663231">[</span><span class="num" id="3663232">0</span><span class="op" id="3663233">:</span><span class="op" id="3663234">]</span><span class="op" id="3663235">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663238">case</span>&nbsp;<span class="op" id="3663243">*</span><span class="ident" id="3663244">syscall</span><span class="op" id="3663251">.</span><span class="ident" id="3663252">SockaddrInet6</span><span class="op" id="3663265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663269">return</span>&nbsp;<span class="op" id="3663276">&amp;</span><span class="ident" id="3663277">IPAddr</span><span class="op" id="3663283">{</span><span class="ident" id="3663284">IP</span><span class="op" id="3663286">:</span>&nbsp;<span class="ident" id="3663288">sa</span><span class="op" id="3663290">.</span><span class="ident" id="3663291">Addr</span><span class="op" id="3663295">[</span><span class="num" id="3663296">0</span><span class="op" id="3663297">:</span><span class="op" id="3663298">]</span><span class="op" id="3663299">,</span>&nbsp;<span class="ident" id="3663301">Zone</span><span class="op" id="3663305">:</span>&nbsp;<span class="ident" id="3663307">zoneToString</span><span class="op" id="3663319">(</span><span class="builtintype" id="3663320">int</span><span class="op" id="3663323">(</span><span class="ident" id="3663324">sa</span><span class="op" id="3663326">.</span><span class="ident" id="3663327">ZoneId</span><span class="op" id="3663333">)</span><span class="op" id="3663334">)</span><span class="op" id="3663335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3663338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663341">return</span>&nbsp;<span class="ident" id="3663348">nil</span><br>
<span class="lineno"></span><span class="op" id="3663352">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3663355">func</span>&nbsp;<span class="op" id="3663360">(</span><span class="ident" id="3663361">a</span>&nbsp;<span class="op" id="3663363">*</span><span class="ident" id="3663364">IPAddr</span><span class="op" id="3663370">)</span>&nbsp;<span class="ident" id="3663372">family</span><span class="op" id="3663378">(</span><span class="op" id="3663379">)</span>&nbsp;<span class="builtintype" id="3663381">int</span>&nbsp;<span class="op" id="3663385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663388">if</span>&nbsp;<span class="ident" id="3663391">a</span>&nbsp;<span class="op" id="3663393">==</span>&nbsp;<span class="ident" id="3663396">nil</span>&nbsp;<span class="op" id="3663400">||</span>&nbsp;<span class="builtinfunc" id="3663403">len</span><span class="op" id="3663406">(</span><span class="ident" id="3663407">a</span><span class="op" id="3663408">.</span><span class="ident" id="3663409">IP</span><span class="op" id="3663411">)</span>&nbsp;<span class="op" id="3663413">&lt;=</span>&nbsp;<span class="ident" id="3663416">IPv4len</span>&nbsp;<span class="op" id="3663424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663428">return</span>&nbsp;<span class="ident" id="3663435">syscall</span><span class="op" id="3663442">.</span><span class="ident" id="3663443">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3663452">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663455">if</span>&nbsp;<span class="ident" id="3663458">a</span><span class="op" id="3663459">.</span><span class="ident" id="3663460">IP</span><span class="op" id="3663462">.</span><span class="ident" id="3663463">To4</span><span class="op" id="3663466">(</span><span class="op" id="3663467">)</span>&nbsp;<span class="op" id="3663469">!=</span>&nbsp;<span class="ident" id="3663472">nil</span>&nbsp;<span class="op" id="3663476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663480">return</span>&nbsp;<span class="ident" id="3663487">syscall</span><span class="op" id="3663494">.</span><span class="ident" id="3663495">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3663504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663507">return</span>&nbsp;<span class="ident" id="3663514">syscall</span><span class="op" id="3663521">.</span><span class="ident" id="3663522">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3663531">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3663534">func</span>&nbsp;<span class="op" id="3663539">(</span><span class="ident" id="3663540">a</span>&nbsp;<span class="op" id="3663542">*</span><span class="ident" id="3663543">IPAddr</span><span class="op" id="3663549">)</span>&nbsp;<span class="ident" id="3663551">isWildcard</span><span class="op" id="3663561">(</span><span class="op" id="3663562">)</span>&nbsp;<span class="builtintype" id="3663564">bool</span>&nbsp;<span class="op" id="3663569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663572">if</span>&nbsp;<span class="ident" id="3663575">a</span>&nbsp;<span class="op" id="3663577">==</span>&nbsp;<span class="ident" id="3663580">nil</span>&nbsp;<span class="op" id="3663584">||</span>&nbsp;<span class="ident" id="3663587">a</span><span class="op" id="3663588">.</span><span class="ident" id="3663589">IP</span>&nbsp;<span class="op" id="3663592">==</span>&nbsp;<span class="ident" id="3663595">nil</span>&nbsp;<span class="op" id="3663599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663603">return</span>&nbsp;<span class="builtintype" id="3663610">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3663616">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663619">return</span>&nbsp;<span class="ident" id="3663626">a</span><span class="op" id="3663627">.</span><span class="ident" id="3663628">IP</span><span class="op" id="3663630">.</span><span class="ident" id="3663631">IsUnspecified</span><span class="op" id="3663644">(</span><span class="op" id="3663645">)</span><br>
<span class="lineno"></span><span class="op" id="3663647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3663650">func</span>&nbsp;<span class="op" id="3663655">(</span><span class="ident" id="3663656">a</span>&nbsp;<span class="op" id="3663658">*</span><span class="ident" id="3663659">IPAddr</span><span class="op" id="3663665">)</span>&nbsp;<span class="ident" id="3663667">sockaddr</span><span class="op" id="3663675">(</span><span class="ident" id="3663676">family</span>&nbsp;<span class="builtintype" id="3663683">int</span><span class="op" id="3663686">)</span>&nbsp;<span class="op" id="3663688">(</span><span class="ident" id="3663689">syscall</span><span class="op" id="3663696">.</span><span class="ident" id="3663697">Sockaddr</span><span class="op" id="3663705">,</span>&nbsp;<span class="builtintype" id="3663707">error</span><span class="op" id="3663712">)</span>&nbsp;<span class="op" id="3663714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663717">if</span>&nbsp;<span class="ident" id="3663720">a</span>&nbsp;<span class="op" id="3663722">==</span>&nbsp;<span class="ident" id="3663725">nil</span>&nbsp;<span class="op" id="3663729">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663733">return</span>&nbsp;<span class="ident" id="3663740">nil</span><span class="op" id="3663743">,</span>&nbsp;<span class="ident" id="3663745">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3663750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3663753">return</span>&nbsp;<span class="ident" id="3663760">ipToSockaddr</span><span class="op" id="3663772">(</span><span class="ident" id="3663773">family</span><span class="op" id="3663779">,</span>&nbsp;<span class="ident" id="3663781">a</span><span class="op" id="3663782">.</span><span class="ident" id="3663783">IP</span><span class="op" id="3663785">,</span>&nbsp;<span class="num" id="3663787">0</span><span class="op" id="3663788">,</span>&nbsp;<span class="ident" id="3663790">a</span><span class="op" id="3663791">.</span><span class="ident" id="3663792">Zone</span><span class="op" id="3663796">)</span><br>
<span class="lineno"></span><span class="op" id="3663798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3663801">//&nbsp;IPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3663871">//&nbsp;for&nbsp;IP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3663902">type</span>&nbsp;<span class="ident" id="3663907">IPConn</span>&nbsp;<span class="keyword" id="3663914">struct</span>&nbsp;<span class="op" id="3663921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3663924">conn</span><br>
<span class="lineno"></span><span class="op" id="3663929">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3663932">func</span>&nbsp;<span class="ident" id="3663937">newIPConn</span><span class="op" id="3663946">(</span><span class="ident" id="3663947">fd</span>&nbsp;<span class="op" id="3663950">*</span><span class="ident" id="3663951">netFD</span><span class="op" id="3663956">)</span>&nbsp;<span class="op" id="3663958">*</span><span class="ident" id="3663959">IPConn</span>&nbsp;<span class="op" id="3663966">{</span>&nbsp;<span class="keyword" id="3663968">return</span>&nbsp;<span class="op" id="3663975">&amp;</span><span class="ident" id="3663976">IPConn</span><span class="op" id="3663982">{</span><span class="ident" id="3663983">conn</span><span class="op" id="3663987">{</span><span class="ident" id="3663988">fd</span><span class="op" id="3663990">}</span><span class="op" id="3663991">}</span>&nbsp;<span class="op" id="3663993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3663996">//&nbsp;ReadFromIP&nbsp;reads&nbsp;an&nbsp;IP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3664065">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno">70</span><span class="comment" id="3664136">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3664163">//</span><br>
<span class="lineno"></span><span class="comment" id="3664166">//&nbsp;ReadFromIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3664229">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3664296">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno">75</span><span class="keyword" id="3664316">func</span>&nbsp;<span class="op" id="3664321">(</span><span class="ident" id="3664322">c</span>&nbsp;<span class="op" id="3664324">*</span><span class="ident" id="3664325">IPConn</span><span class="op" id="3664331">)</span>&nbsp;<span class="ident" id="3664333">ReadFromIP</span><span class="op" id="3664343">(</span><span class="ident" id="3664344">b</span>&nbsp;<span class="op" id="3664346">[</span><span class="op" id="3664347">]</span><span class="builtintype" id="3664348">byte</span><span class="op" id="3664352">)</span>&nbsp;<span class="op" id="3664354">(</span><span class="builtintype" id="3664355">int</span><span class="op" id="3664358">,</span>&nbsp;<span class="op" id="3664360">*</span><span class="ident" id="3664361">IPAddr</span><span class="op" id="3664367">,</span>&nbsp;<span class="builtintype" id="3664369">error</span><span class="op" id="3664374">)</span>&nbsp;<span class="op" id="3664376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664379">if</span>&nbsp;<span class="op" id="3664382">!</span><span class="ident" id="3664383">c</span><span class="op" id="3664384">.</span><span class="ident" id="3664385">ok</span><span class="op" id="3664387">(</span><span class="op" id="3664388">)</span>&nbsp;<span class="op" id="3664390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664394">return</span>&nbsp;<span class="num" id="3664401">0</span><span class="op" id="3664402">,</span>&nbsp;<span class="ident" id="3664404">nil</span><span class="op" id="3664407">,</span>&nbsp;<span class="ident" id="3664409">syscall</span><span class="op" id="3664416">.</span><span class="ident" id="3664417">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3664425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3664428">//&nbsp;TODO(cw,rsc):&nbsp;consider&nbsp;using&nbsp;readv&nbsp;if&nbsp;we&nbsp;know&nbsp;the&nbsp;family</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3664489">//&nbsp;type&nbsp;to&nbsp;avoid&nbsp;the&nbsp;header&nbsp;trim/copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664528">var</span>&nbsp;<span class="ident" id="3664532">addr</span>&nbsp;<span class="op" id="3664537">*</span><span class="ident" id="3664538">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3664546">n</span><span class="op" id="3664547">,</span>&nbsp;<span class="ident" id="3664549">sa</span><span class="op" id="3664551">,</span>&nbsp;<span class="ident" id="3664553">err</span>&nbsp;<span class="op" id="3664557">:=</span>&nbsp;<span class="ident" id="3664560">c</span><span class="op" id="3664561">.</span><span class="ident" id="3664562">fd</span><span class="op" id="3664564">.</span><span class="ident" id="3664565">readFrom</span><span class="op" id="3664573">(</span><span class="ident" id="3664574">b</span><span class="op" id="3664575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664578">switch</span>&nbsp;<span class="ident" id="3664585">sa</span>&nbsp;<span class="op" id="3664588">:=</span>&nbsp;<span class="ident" id="3664591">sa</span><span class="op" id="3664593">.</span><span class="op" id="3664594">(</span><span class="keyword" id="3664595">type</span><span class="op" id="3664599">)</span>&nbsp;<span class="op" id="3664601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664604">case</span>&nbsp;<span class="op" id="3664609">*</span><span class="ident" id="3664610">syscall</span><span class="op" id="3664617">.</span><span class="ident" id="3664618">SockaddrInet4</span><span class="op" id="3664631">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3664635">addr</span>&nbsp;<span class="op" id="3664640">=</span>&nbsp;<span class="op" id="3664642">&amp;</span><span class="ident" id="3664643">IPAddr</span><span class="op" id="3664649">{</span><span class="ident" id="3664650">IP</span><span class="op" id="3664652">:</span>&nbsp;<span class="ident" id="3664654">sa</span><span class="op" id="3664656">.</span><span class="ident" id="3664657">Addr</span><span class="op" id="3664661">[</span><span class="num" id="3664662">0</span><span class="op" id="3664663">:</span><span class="op" id="3664664">]</span><span class="op" id="3664665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664669">if</span>&nbsp;<span class="builtinfunc" id="3664672">len</span><span class="op" id="3664675">(</span><span class="ident" id="3664676">b</span><span class="op" id="3664677">)</span>&nbsp;<span class="op" id="3664679">&gt;=</span>&nbsp;<span class="ident" id="3664682">IPv4len</span>&nbsp;<span class="op" id="3664690">{</span>&nbsp;<span class="comment" id="3664692">//&nbsp;discard&nbsp;ipv4&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3664718">hsize</span>&nbsp;<span class="op" id="3664724">:=</span>&nbsp;<span class="op" id="3664727">(</span><span class="builtintype" id="3664728">int</span><span class="op" id="3664731">(</span><span class="ident" id="3664732">b</span><span class="op" id="3664733">[</span><span class="num" id="3664734">0</span><span class="op" id="3664735">]</span><span class="op" id="3664736">)</span>&nbsp;<span class="op" id="3664738">&amp;</span>&nbsp;<span class="num" id="3664740">0xf</span><span class="op" id="3664743">)</span>&nbsp;<span class="op" id="3664745">*</span>&nbsp;<span class="num" id="3664747">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3664752">copy</span><span class="op" id="3664756">(</span><span class="ident" id="3664757">b</span><span class="op" id="3664758">,</span>&nbsp;<span class="ident" id="3664760">b</span><span class="op" id="3664761">[</span><span class="ident" id="3664762">hsize</span><span class="op" id="3664767">:</span><span class="op" id="3664768">]</span><span class="op" id="3664769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3664774">n</span>&nbsp;<span class="op" id="3664776">-=</span>&nbsp;<span class="ident" id="3664779">hsize</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3664787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664790">case</span>&nbsp;<span class="op" id="3664795">*</span><span class="ident" id="3664796">syscall</span><span class="op" id="3664803">.</span><span class="ident" id="3664804">SockaddrInet6</span><span class="op" id="3664817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3664821">addr</span>&nbsp;<span class="op" id="3664826">=</span>&nbsp;<span class="op" id="3664828">&amp;</span><span class="ident" id="3664829">IPAddr</span><span class="op" id="3664835">{</span><span class="ident" id="3664836">IP</span><span class="op" id="3664838">:</span>&nbsp;<span class="ident" id="3664840">sa</span><span class="op" id="3664842">.</span><span class="ident" id="3664843">Addr</span><span class="op" id="3664847">[</span><span class="num" id="3664848">0</span><span class="op" id="3664849">:</span><span class="op" id="3664850">]</span><span class="op" id="3664851">,</span>&nbsp;<span class="ident" id="3664853">Zone</span><span class="op" id="3664857">:</span>&nbsp;<span class="ident" id="3664859">zoneToString</span><span class="op" id="3664871">(</span><span class="builtintype" id="3664872">int</span><span class="op" id="3664875">(</span><span class="ident" id="3664876">sa</span><span class="op" id="3664878">.</span><span class="ident" id="3664879">ZoneId</span><span class="op" id="3664885">)</span><span class="op" id="3664886">)</span><span class="op" id="3664887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3664890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3664893">return</span>&nbsp;<span class="ident" id="3664900">n</span><span class="op" id="3664901">,</span>&nbsp;<span class="ident" id="3664903">addr</span><span class="op" id="3664907">,</span>&nbsp;<span class="ident" id="3664909">err</span><br>
<span class="lineno">95</span><span class="op" id="3664913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3664916">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3664971">func</span>&nbsp;<span class="op" id="3664976">(</span><span class="ident" id="3664977">c</span>&nbsp;<span class="op" id="3664979">*</span><span class="ident" id="3664980">IPConn</span><span class="op" id="3664986">)</span>&nbsp;<span class="ident" id="3664988">ReadFrom</span><span class="op" id="3664996">(</span><span class="ident" id="3664997">b</span>&nbsp;<span class="op" id="3664999">[</span><span class="op" id="3665000">]</span><span class="builtintype" id="3665001">byte</span><span class="op" id="3665005">)</span>&nbsp;<span class="op" id="3665007">(</span><span class="builtintype" id="3665008">int</span><span class="op" id="3665011">,</span>&nbsp;<span class="ident" id="3665013">Addr</span><span class="op" id="3665017">,</span>&nbsp;<span class="builtintype" id="3665019">error</span><span class="op" id="3665024">)</span>&nbsp;<span class="op" id="3665026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665029">if</span>&nbsp;<span class="op" id="3665032">!</span><span class="ident" id="3665033">c</span><span class="op" id="3665034">.</span><span class="ident" id="3665035">ok</span><span class="op" id="3665037">(</span><span class="op" id="3665038">)</span>&nbsp;<span class="op" id="3665040">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665044">return</span>&nbsp;<span class="num" id="3665051">0</span><span class="op" id="3665052">,</span>&nbsp;<span class="ident" id="3665054">nil</span><span class="op" id="3665057">,</span>&nbsp;<span class="ident" id="3665059">syscall</span><span class="op" id="3665066">.</span><span class="ident" id="3665067">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3665075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3665078">n</span><span class="op" id="3665079">,</span>&nbsp;<span class="ident" id="3665081">addr</span><span class="op" id="3665085">,</span>&nbsp;<span class="ident" id="3665087">err</span>&nbsp;<span class="op" id="3665091">:=</span>&nbsp;<span class="ident" id="3665094">c</span><span class="op" id="3665095">.</span><span class="ident" id="3665096">ReadFromIP</span><span class="op" id="3665106">(</span><span class="ident" id="3665107">b</span><span class="op" id="3665108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665111">return</span>&nbsp;<span class="ident" id="3665118">n</span><span class="op" id="3665119">,</span>&nbsp;<span class="ident" id="3665121">addr</span><span class="op" id="3665125">.</span><span class="ident" id="3665126">toAddr</span><span class="op" id="3665132">(</span><span class="op" id="3665133">)</span><span class="op" id="3665134">,</span>&nbsp;<span class="ident" id="3665136">err</span><br>
<span class="lineno"></span><span class="op" id="3665140">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3665143">//&nbsp;ReadMsgIP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3665214">//&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3665281">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3665352">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno">110</span><span class="keyword" id="3665421">func</span>&nbsp;<span class="op" id="3665426">(</span><span class="ident" id="3665427">c</span>&nbsp;<span class="op" id="3665429">*</span><span class="ident" id="3665430">IPConn</span><span class="op" id="3665436">)</span>&nbsp;<span class="ident" id="3665438">ReadMsgIP</span><span class="op" id="3665447">(</span><span class="ident" id="3665448">b</span><span class="op" id="3665449">,</span>&nbsp;<span class="ident" id="3665451">oob</span>&nbsp;<span class="op" id="3665455">[</span><span class="op" id="3665456">]</span><span class="builtintype" id="3665457">byte</span><span class="op" id="3665461">)</span>&nbsp;<span class="op" id="3665463">(</span><span class="ident" id="3665464">n</span><span class="op" id="3665465">,</span>&nbsp;<span class="ident" id="3665467">oobn</span><span class="op" id="3665471">,</span>&nbsp;<span class="ident" id="3665473">flags</span>&nbsp;<span class="builtintype" id="3665479">int</span><span class="op" id="3665482">,</span>&nbsp;<span class="ident" id="3665484">addr</span>&nbsp;<span class="op" id="3665489">*</span><span class="ident" id="3665490">IPAddr</span><span class="op" id="3665496">,</span>&nbsp;<span class="ident" id="3665498">err</span>&nbsp;<span class="builtintype" id="3665502">error</span><span class="op" id="3665507">)</span>&nbsp;<span class="op" id="3665509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665512">if</span>&nbsp;<span class="op" id="3665515">!</span><span class="ident" id="3665516">c</span><span class="op" id="3665517">.</span><span class="ident" id="3665518">ok</span><span class="op" id="3665520">(</span><span class="op" id="3665521">)</span>&nbsp;<span class="op" id="3665523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665527">return</span>&nbsp;<span class="num" id="3665534">0</span><span class="op" id="3665535">,</span>&nbsp;<span class="num" id="3665537">0</span><span class="op" id="3665538">,</span>&nbsp;<span class="num" id="3665540">0</span><span class="op" id="3665541">,</span>&nbsp;<span class="ident" id="3665543">nil</span><span class="op" id="3665546">,</span>&nbsp;<span class="ident" id="3665548">syscall</span><span class="op" id="3665555">.</span><span class="ident" id="3665556">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3665564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665567">var</span>&nbsp;<span class="ident" id="3665571">sa</span>&nbsp;<span class="ident" id="3665574">syscall</span><span class="op" id="3665581">.</span><span class="ident" id="3665582">Sockaddr</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3665592">n</span><span class="op" id="3665593">,</span>&nbsp;<span class="ident" id="3665595">oobn</span><span class="op" id="3665599">,</span>&nbsp;<span class="ident" id="3665601">flags</span><span class="op" id="3665606">,</span>&nbsp;<span class="ident" id="3665608">sa</span><span class="op" id="3665610">,</span>&nbsp;<span class="ident" id="3665612">err</span>&nbsp;<span class="op" id="3665616">=</span>&nbsp;<span class="ident" id="3665618">c</span><span class="op" id="3665619">.</span><span class="ident" id="3665620">fd</span><span class="op" id="3665622">.</span><span class="ident" id="3665623">readMsg</span><span class="op" id="3665630">(</span><span class="ident" id="3665631">b</span><span class="op" id="3665632">,</span>&nbsp;<span class="ident" id="3665634">oob</span><span class="op" id="3665637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665640">switch</span>&nbsp;<span class="ident" id="3665647">sa</span>&nbsp;<span class="op" id="3665650">:=</span>&nbsp;<span class="ident" id="3665653">sa</span><span class="op" id="3665655">.</span><span class="op" id="3665656">(</span><span class="keyword" id="3665657">type</span><span class="op" id="3665661">)</span>&nbsp;<span class="op" id="3665663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665666">case</span>&nbsp;<span class="op" id="3665671">*</span><span class="ident" id="3665672">syscall</span><span class="op" id="3665679">.</span><span class="ident" id="3665680">SockaddrInet4</span><span class="op" id="3665693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3665697">addr</span>&nbsp;<span class="op" id="3665702">=</span>&nbsp;<span class="op" id="3665704">&amp;</span><span class="ident" id="3665705">IPAddr</span><span class="op" id="3665711">{</span><span class="ident" id="3665712">IP</span><span class="op" id="3665714">:</span>&nbsp;<span class="ident" id="3665716">sa</span><span class="op" id="3665718">.</span><span class="ident" id="3665719">Addr</span><span class="op" id="3665723">[</span><span class="num" id="3665724">0</span><span class="op" id="3665725">:</span><span class="op" id="3665726">]</span><span class="op" id="3665727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665730">case</span>&nbsp;<span class="op" id="3665735">*</span><span class="ident" id="3665736">syscall</span><span class="op" id="3665743">.</span><span class="ident" id="3665744">SockaddrInet6</span><span class="op" id="3665757">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3665761">addr</span>&nbsp;<span class="op" id="3665766">=</span>&nbsp;<span class="op" id="3665768">&amp;</span><span class="ident" id="3665769">IPAddr</span><span class="op" id="3665775">{</span><span class="ident" id="3665776">IP</span><span class="op" id="3665778">:</span>&nbsp;<span class="ident" id="3665780">sa</span><span class="op" id="3665782">.</span><span class="ident" id="3665783">Addr</span><span class="op" id="3665787">[</span><span class="num" id="3665788">0</span><span class="op" id="3665789">:</span><span class="op" id="3665790">]</span><span class="op" id="3665791">,</span>&nbsp;<span class="ident" id="3665793">Zone</span><span class="op" id="3665797">:</span>&nbsp;<span class="ident" id="3665799">zoneToString</span><span class="op" id="3665811">(</span><span class="builtintype" id="3665812">int</span><span class="op" id="3665815">(</span><span class="ident" id="3665816">sa</span><span class="op" id="3665818">.</span><span class="ident" id="3665819">ZoneId</span><span class="op" id="3665825">)</span><span class="op" id="3665826">)</span><span class="op" id="3665827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3665830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3665833">return</span><br>
<span class="lineno"></span><span class="op" id="3665840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3665843">//&nbsp;WriteToIP&nbsp;writes&nbsp;an&nbsp;IP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3665911">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3665922">//</span><br>
<span class="lineno"></span><span class="comment" id="3665925">//&nbsp;WriteToIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3665987">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">130</span><span class="comment" id="3666054">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3666123">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3666136">func</span>&nbsp;<span class="op" id="3666141">(</span><span class="ident" id="3666142">c</span>&nbsp;<span class="op" id="3666144">*</span><span class="ident" id="3666145">IPConn</span><span class="op" id="3666151">)</span>&nbsp;<span class="ident" id="3666153">WriteToIP</span><span class="op" id="3666162">(</span><span class="ident" id="3666163">b</span>&nbsp;<span class="op" id="3666165">[</span><span class="op" id="3666166">]</span><span class="builtintype" id="3666167">byte</span><span class="op" id="3666171">,</span>&nbsp;<span class="ident" id="3666173">addr</span>&nbsp;<span class="op" id="3666178">*</span><span class="ident" id="3666179">IPAddr</span><span class="op" id="3666185">)</span>&nbsp;<span class="op" id="3666187">(</span><span class="builtintype" id="3666188">int</span><span class="op" id="3666191">,</span>&nbsp;<span class="builtintype" id="3666193">error</span><span class="op" id="3666198">)</span>&nbsp;<span class="op" id="3666200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666203">if</span>&nbsp;<span class="op" id="3666206">!</span><span class="ident" id="3666207">c</span><span class="op" id="3666208">.</span><span class="ident" id="3666209">ok</span><span class="op" id="3666211">(</span><span class="op" id="3666212">)</span>&nbsp;<span class="op" id="3666214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666218">return</span>&nbsp;<span class="num" id="3666225">0</span><span class="op" id="3666226">,</span>&nbsp;<span class="ident" id="3666228">syscall</span><span class="op" id="3666235">.</span><span class="ident" id="3666236">EINVAL</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666247">if</span>&nbsp;<span class="ident" id="3666250">c</span><span class="op" id="3666251">.</span><span class="ident" id="3666252">fd</span><span class="op" id="3666254">.</span><span class="ident" id="3666255">isConnected</span>&nbsp;<span class="op" id="3666267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666271">return</span>&nbsp;<span class="num" id="3666278">0</span><span class="op" id="3666279">,</span>&nbsp;<span class="op" id="3666281">&amp;</span><span class="ident" id="3666282">OpError</span><span class="op" id="3666289">{</span><span class="ident" id="3666290">Op</span><span class="op" id="3666292">:</span>&nbsp;<span class="string" id="3666294">&#34;write&#34;</span><span class="op" id="3666301">,</span>&nbsp;<span class="ident" id="3666303">Net</span><span class="op" id="3666306">:</span>&nbsp;<span class="ident" id="3666308">c</span><span class="op" id="3666309">.</span><span class="ident" id="3666310">fd</span><span class="op" id="3666312">.</span><span class="ident" id="3666313">net</span><span class="op" id="3666316">,</span>&nbsp;<span class="ident" id="3666318">Addr</span><span class="op" id="3666322">:</span>&nbsp;<span class="ident" id="3666324">addr</span><span class="op" id="3666328">,</span>&nbsp;<span class="ident" id="3666330">Err</span><span class="op" id="3666333">:</span>&nbsp;<span class="ident" id="3666335">ErrWriteToConnected</span><span class="op" id="3666354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666360">if</span>&nbsp;<span class="ident" id="3666363">addr</span>&nbsp;<span class="op" id="3666368">==</span>&nbsp;<span class="ident" id="3666371">nil</span>&nbsp;<span class="op" id="3666375">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666379">return</span>&nbsp;<span class="num" id="3666386">0</span><span class="op" id="3666387">,</span>&nbsp;<span class="op" id="3666389">&amp;</span><span class="ident" id="3666390">OpError</span><span class="op" id="3666397">{</span><span class="ident" id="3666398">Op</span><span class="op" id="3666400">:</span>&nbsp;<span class="string" id="3666402">&#34;write&#34;</span><span class="op" id="3666409">,</span>&nbsp;<span class="ident" id="3666411">Net</span><span class="op" id="3666414">:</span>&nbsp;<span class="ident" id="3666416">c</span><span class="op" id="3666417">.</span><span class="ident" id="3666418">fd</span><span class="op" id="3666420">.</span><span class="ident" id="3666421">net</span><span class="op" id="3666424">,</span>&nbsp;<span class="ident" id="3666426">Addr</span><span class="op" id="3666430">:</span>&nbsp;<span class="ident" id="3666432">nil</span><span class="op" id="3666435">,</span>&nbsp;<span class="ident" id="3666437">Err</span><span class="op" id="3666440">:</span>&nbsp;<span class="ident" id="3666442">errMissingAddress</span><span class="op" id="3666459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3666465">sa</span><span class="op" id="3666467">,</span>&nbsp;<span class="ident" id="3666469">err</span>&nbsp;<span class="op" id="3666473">:=</span>&nbsp;<span class="ident" id="3666476">addr</span><span class="op" id="3666480">.</span><span class="ident" id="3666481">sockaddr</span><span class="op" id="3666489">(</span><span class="ident" id="3666490">c</span><span class="op" id="3666491">.</span><span class="ident" id="3666492">fd</span><span class="op" id="3666494">.</span><span class="ident" id="3666495">family</span><span class="op" id="3666501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666504">if</span>&nbsp;<span class="ident" id="3666507">err</span>&nbsp;<span class="op" id="3666511">!=</span>&nbsp;<span class="ident" id="3666514">nil</span>&nbsp;<span class="op" id="3666518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666522">return</span>&nbsp;<span class="num" id="3666529">0</span><span class="op" id="3666530">,</span>&nbsp;<span class="op" id="3666532">&amp;</span><span class="ident" id="3666533">OpError</span><span class="op" id="3666540">{</span><span class="string" id="3666541">&#34;write&#34;</span><span class="op" id="3666548">,</span>&nbsp;<span class="ident" id="3666550">c</span><span class="op" id="3666551">.</span><span class="ident" id="3666552">fd</span><span class="op" id="3666554">.</span><span class="ident" id="3666555">net</span><span class="op" id="3666558">,</span>&nbsp;<span class="ident" id="3666560">addr</span><span class="op" id="3666564">,</span>&nbsp;<span class="ident" id="3666566">err</span><span class="op" id="3666569">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666575">return</span>&nbsp;<span class="ident" id="3666582">c</span><span class="op" id="3666583">.</span><span class="ident" id="3666584">fd</span><span class="op" id="3666586">.</span><span class="ident" id="3666587">writeTo</span><span class="op" id="3666594">(</span><span class="ident" id="3666595">b</span><span class="op" id="3666596">,</span>&nbsp;<span class="ident" id="3666598">sa</span><span class="op" id="3666600">)</span><br>
<span class="lineno"></span><span class="op" id="3666602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3666605">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno">150</span><span class="keyword" id="3666658">func</span>&nbsp;<span class="op" id="3666663">(</span><span class="ident" id="3666664">c</span>&nbsp;<span class="op" id="3666666">*</span><span class="ident" id="3666667">IPConn</span><span class="op" id="3666673">)</span>&nbsp;<span class="ident" id="3666675">WriteTo</span><span class="op" id="3666682">(</span><span class="ident" id="3666683">b</span>&nbsp;<span class="op" id="3666685">[</span><span class="op" id="3666686">]</span><span class="builtintype" id="3666687">byte</span><span class="op" id="3666691">,</span>&nbsp;<span class="ident" id="3666693">addr</span>&nbsp;<span class="ident" id="3666698">Addr</span><span class="op" id="3666702">)</span>&nbsp;<span class="op" id="3666704">(</span><span class="builtintype" id="3666705">int</span><span class="op" id="3666708">,</span>&nbsp;<span class="builtintype" id="3666710">error</span><span class="op" id="3666715">)</span>&nbsp;<span class="op" id="3666717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666720">if</span>&nbsp;<span class="op" id="3666723">!</span><span class="ident" id="3666724">c</span><span class="op" id="3666725">.</span><span class="ident" id="3666726">ok</span><span class="op" id="3666728">(</span><span class="op" id="3666729">)</span>&nbsp;<span class="op" id="3666731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666735">return</span>&nbsp;<span class="num" id="3666742">0</span><span class="op" id="3666743">,</span>&nbsp;<span class="ident" id="3666745">syscall</span><span class="op" id="3666752">.</span><span class="ident" id="3666753">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3666764">a</span><span class="op" id="3666765">,</span>&nbsp;<span class="ident" id="3666767">ok</span>&nbsp;<span class="op" id="3666770">:=</span>&nbsp;<span class="ident" id="3666773">addr</span><span class="op" id="3666777">.</span><span class="op" id="3666778">(</span><span class="op" id="3666779">*</span><span class="ident" id="3666780">IPAddr</span><span class="op" id="3666786">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666789">if</span>&nbsp;<span class="op" id="3666792">!</span><span class="ident" id="3666793">ok</span>&nbsp;<span class="op" id="3666796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666800">return</span>&nbsp;<span class="num" id="3666807">0</span><span class="op" id="3666808">,</span>&nbsp;<span class="op" id="3666810">&amp;</span><span class="ident" id="3666811">OpError</span><span class="op" id="3666818">{</span><span class="string" id="3666819">&#34;write&#34;</span><span class="op" id="3666826">,</span>&nbsp;<span class="ident" id="3666828">c</span><span class="op" id="3666829">.</span><span class="ident" id="3666830">fd</span><span class="op" id="3666832">.</span><span class="ident" id="3666833">net</span><span class="op" id="3666836">,</span>&nbsp;<span class="ident" id="3666838">addr</span><span class="op" id="3666842">,</span>&nbsp;<span class="ident" id="3666844">syscall</span><span class="op" id="3666851">.</span><span class="ident" id="3666852">EINVAL</span><span class="op" id="3666858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3666861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3666864">return</span>&nbsp;<span class="ident" id="3666871">c</span><span class="op" id="3666872">.</span><span class="ident" id="3666873">WriteToIP</span><span class="op" id="3666882">(</span><span class="ident" id="3666883">b</span><span class="op" id="3666884">,</span>&nbsp;<span class="ident" id="3666886">a</span><span class="op" id="3666887">)</span><br>
<span class="lineno"></span><span class="op" id="3666889">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3666892">//&nbsp;WriteMsgIP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3666962">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3667029">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="3667081">func</span>&nbsp;<span class="op" id="3667086">(</span><span class="ident" id="3667087">c</span>&nbsp;<span class="op" id="3667089">*</span><span class="ident" id="3667090">IPConn</span><span class="op" id="3667096">)</span>&nbsp;<span class="ident" id="3667098">WriteMsgIP</span><span class="op" id="3667108">(</span><span class="ident" id="3667109">b</span><span class="op" id="3667110">,</span>&nbsp;<span class="ident" id="3667112">oob</span>&nbsp;<span class="op" id="3667116">[</span><span class="op" id="3667117">]</span><span class="builtintype" id="3667118">byte</span><span class="op" id="3667122">,</span>&nbsp;<span class="ident" id="3667124">addr</span>&nbsp;<span class="op" id="3667129">*</span><span class="ident" id="3667130">IPAddr</span><span class="op" id="3667136">)</span>&nbsp;<span class="op" id="3667138">(</span><span class="ident" id="3667139">n</span><span class="op" id="3667140">,</span>&nbsp;<span class="ident" id="3667142">oobn</span>&nbsp;<span class="builtintype" id="3667147">int</span><span class="op" id="3667150">,</span>&nbsp;<span class="ident" id="3667152">err</span>&nbsp;<span class="builtintype" id="3667156">error</span><span class="op" id="3667161">)</span>&nbsp;<span class="op" id="3667163">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667166">if</span>&nbsp;<span class="op" id="3667169">!</span><span class="ident" id="3667170">c</span><span class="op" id="3667171">.</span><span class="ident" id="3667172">ok</span><span class="op" id="3667174">(</span><span class="op" id="3667175">)</span>&nbsp;<span class="op" id="3667177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667181">return</span>&nbsp;<span class="num" id="3667188">0</span><span class="op" id="3667189">,</span>&nbsp;<span class="num" id="3667191">0</span><span class="op" id="3667192">,</span>&nbsp;<span class="ident" id="3667194">syscall</span><span class="op" id="3667201">.</span><span class="ident" id="3667202">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3667210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667213">if</span>&nbsp;<span class="ident" id="3667216">c</span><span class="op" id="3667217">.</span><span class="ident" id="3667218">fd</span><span class="op" id="3667220">.</span><span class="ident" id="3667221">isConnected</span>&nbsp;<span class="op" id="3667233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667237">return</span>&nbsp;<span class="num" id="3667244">0</span><span class="op" id="3667245">,</span>&nbsp;<span class="num" id="3667247">0</span><span class="op" id="3667248">,</span>&nbsp;<span class="op" id="3667250">&amp;</span><span class="ident" id="3667251">OpError</span><span class="op" id="3667258">{</span><span class="ident" id="3667259">Op</span><span class="op" id="3667261">:</span>&nbsp;<span class="string" id="3667263">&#34;write&#34;</span><span class="op" id="3667270">,</span>&nbsp;<span class="ident" id="3667272">Net</span><span class="op" id="3667275">:</span>&nbsp;<span class="ident" id="3667277">c</span><span class="op" id="3667278">.</span><span class="ident" id="3667279">fd</span><span class="op" id="3667281">.</span><span class="ident" id="3667282">net</span><span class="op" id="3667285">,</span>&nbsp;<span class="ident" id="3667287">Addr</span><span class="op" id="3667291">:</span>&nbsp;<span class="ident" id="3667293">addr</span><span class="op" id="3667297">,</span>&nbsp;<span class="ident" id="3667299">Err</span><span class="op" id="3667302">:</span>&nbsp;<span class="ident" id="3667304">ErrWriteToConnected</span><span class="op" id="3667323">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3667326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667329">if</span>&nbsp;<span class="ident" id="3667332">addr</span>&nbsp;<span class="op" id="3667337">==</span>&nbsp;<span class="ident" id="3667340">nil</span>&nbsp;<span class="op" id="3667344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667348">return</span>&nbsp;<span class="num" id="3667355">0</span><span class="op" id="3667356">,</span>&nbsp;<span class="num" id="3667358">0</span><span class="op" id="3667359">,</span>&nbsp;<span class="op" id="3667361">&amp;</span><span class="ident" id="3667362">OpError</span><span class="op" id="3667369">{</span><span class="ident" id="3667370">Op</span><span class="op" id="3667372">:</span>&nbsp;<span class="string" id="3667374">&#34;write&#34;</span><span class="op" id="3667381">,</span>&nbsp;<span class="ident" id="3667383">Net</span><span class="op" id="3667386">:</span>&nbsp;<span class="ident" id="3667388">c</span><span class="op" id="3667389">.</span><span class="ident" id="3667390">fd</span><span class="op" id="3667392">.</span><span class="ident" id="3667393">net</span><span class="op" id="3667396">,</span>&nbsp;<span class="ident" id="3667398">Addr</span><span class="op" id="3667402">:</span>&nbsp;<span class="ident" id="3667404">nil</span><span class="op" id="3667407">,</span>&nbsp;<span class="ident" id="3667409">Err</span><span class="op" id="3667412">:</span>&nbsp;<span class="ident" id="3667414">errMissingAddress</span><span class="op" id="3667431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3667434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3667437">sa</span><span class="op" id="3667439">,</span>&nbsp;<span class="ident" id="3667441">err</span>&nbsp;<span class="op" id="3667445">:=</span>&nbsp;<span class="ident" id="3667448">addr</span><span class="op" id="3667452">.</span><span class="ident" id="3667453">sockaddr</span><span class="op" id="3667461">(</span><span class="ident" id="3667462">c</span><span class="op" id="3667463">.</span><span class="ident" id="3667464">fd</span><span class="op" id="3667466">.</span><span class="ident" id="3667467">family</span><span class="op" id="3667473">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667476">if</span>&nbsp;<span class="ident" id="3667479">err</span>&nbsp;<span class="op" id="3667483">!=</span>&nbsp;<span class="ident" id="3667486">nil</span>&nbsp;<span class="op" id="3667490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667494">return</span>&nbsp;<span class="num" id="3667501">0</span><span class="op" id="3667502">,</span>&nbsp;<span class="num" id="3667504">0</span><span class="op" id="3667505">,</span>&nbsp;<span class="op" id="3667507">&amp;</span><span class="ident" id="3667508">OpError</span><span class="op" id="3667515">{</span><span class="string" id="3667516">&#34;write&#34;</span><span class="op" id="3667523">,</span>&nbsp;<span class="ident" id="3667525">c</span><span class="op" id="3667526">.</span><span class="ident" id="3667527">fd</span><span class="op" id="3667529">.</span><span class="ident" id="3667530">net</span><span class="op" id="3667533">,</span>&nbsp;<span class="ident" id="3667535">addr</span><span class="op" id="3667539">,</span>&nbsp;<span class="ident" id="3667541">err</span><span class="op" id="3667544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3667547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667550">return</span>&nbsp;<span class="ident" id="3667557">c</span><span class="op" id="3667558">.</span><span class="ident" id="3667559">fd</span><span class="op" id="3667561">.</span><span class="ident" id="3667562">writeMsg</span><span class="op" id="3667570">(</span><span class="ident" id="3667571">b</span><span class="op" id="3667572">,</span>&nbsp;<span class="ident" id="3667574">oob</span><span class="op" id="3667577">,</span>&nbsp;<span class="ident" id="3667579">sa</span><span class="op" id="3667581">)</span><br>
<span class="lineno"></span><span class="op" id="3667583">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="3667586">//&nbsp;DialIP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;protocol</span><br>
<span class="lineno"></span><span class="comment" id="3667657">//&nbsp;netProto,&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon</span><br>
<span class="lineno"></span><span class="comment" id="3667726">//&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3667760">func</span>&nbsp;<span class="ident" id="3667765">DialIP</span><span class="op" id="3667771">(</span><span class="ident" id="3667772">netProto</span>&nbsp;<span class="builtintype" id="3667781">string</span><span class="op" id="3667787">,</span>&nbsp;<span class="ident" id="3667789">laddr</span><span class="op" id="3667794">,</span>&nbsp;<span class="ident" id="3667796">raddr</span>&nbsp;<span class="op" id="3667802">*</span><span class="ident" id="3667803">IPAddr</span><span class="op" id="3667809">)</span>&nbsp;<span class="op" id="3667811">(</span><span class="op" id="3667812">*</span><span class="ident" id="3667813">IPConn</span><span class="op" id="3667819">,</span>&nbsp;<span class="builtintype" id="3667821">error</span><span class="op" id="3667826">)</span>&nbsp;<span class="op" id="3667828">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3667831">return</span>&nbsp;<span class="ident" id="3667838">dialIP</span><span class="op" id="3667844">(</span><span class="ident" id="3667845">netProto</span><span class="op" id="3667853">,</span>&nbsp;<span class="ident" id="3667855">laddr</span><span class="op" id="3667860">,</span>&nbsp;<span class="ident" id="3667862">raddr</span><span class="op" id="3667867">,</span>&nbsp;<span class="ident" id="3667869">noDeadline</span><span class="op" id="3667879">)</span><br>
<span class="lineno"></span><span class="op" id="3667881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3667884">func</span>&nbsp;<span class="ident" id="3667889">dialIP</span><span class="op" id="3667895">(</span><span class="ident" id="3667896">netProto</span>&nbsp;<span class="builtintype" id="3667905">string</span><span class="op" id="3667911">,</span>&nbsp;<span class="ident" id="3667913">laddr</span><span class="op" id="3667918">,</span>&nbsp;<span class="ident" id="3667920">raddr</span>&nbsp;<span class="op" id="3667926">*</span><span class="ident" id="3667927">IPAddr</span><span class="op" id="3667933">,</span>&nbsp;<span class="ident" id="3667935">deadline</span>&nbsp;<span class="ident" id="3667944">time</span><span class="op" id="3667948">.</span><span class="ident" id="3667949">Time</span><span class="op" id="3667953">)</span>&nbsp;<span class="op" id="3667955">(</span><span class="op" id="3667956">*</span><span class="ident" id="3667957">IPConn</span><span class="op" id="3667963">,</span>&nbsp;<span class="builtintype" id="3667965">error</span><span class="op" id="3667970">)</span>&nbsp;<span class="op" id="3667972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3667975">net</span><span class="op" id="3667978">,</span>&nbsp;<span class="ident" id="3667980">proto</span><span class="op" id="3667985">,</span>&nbsp;<span class="ident" id="3667987">err</span>&nbsp;<span class="op" id="3667991">:=</span>&nbsp;<span class="ident" id="3667994">parseNetwork</span><span class="op" id="3668006">(</span><span class="ident" id="3668007">netProto</span><span class="op" id="3668015">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668018">if</span>&nbsp;<span class="ident" id="3668021">err</span>&nbsp;<span class="op" id="3668025">!=</span>&nbsp;<span class="ident" id="3668028">nil</span>&nbsp;<span class="op" id="3668032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668036">return</span>&nbsp;<span class="ident" id="3668043">nil</span><span class="op" id="3668046">,</span>&nbsp;<span class="op" id="3668048">&amp;</span><span class="ident" id="3668049">OpError</span><span class="op" id="3668056">{</span><span class="ident" id="3668057">Op</span><span class="op" id="3668059">:</span>&nbsp;<span class="string" id="3668061">&#34;dial&#34;</span><span class="op" id="3668067">,</span>&nbsp;<span class="ident" id="3668069">Net</span><span class="op" id="3668072">:</span>&nbsp;<span class="ident" id="3668074">netProto</span><span class="op" id="3668082">,</span>&nbsp;<span class="ident" id="3668084">Addr</span><span class="op" id="3668088">:</span>&nbsp;<span class="ident" id="3668090">raddr</span><span class="op" id="3668095">,</span>&nbsp;<span class="ident" id="3668097">Err</span><span class="op" id="3668100">:</span>&nbsp;<span class="ident" id="3668102">err</span><span class="op" id="3668105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3668108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668111">switch</span>&nbsp;<span class="ident" id="3668118">net</span>&nbsp;<span class="op" id="3668122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668125">case</span>&nbsp;<span class="string" id="3668130">&#34;ip&#34;</span><span class="op" id="3668134">,</span>&nbsp;<span class="string" id="3668136">&#34;ip4&#34;</span><span class="op" id="3668141">,</span>&nbsp;<span class="string" id="3668143">&#34;ip6&#34;</span><span class="op" id="3668148">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668151">default</span><span class="op" id="3668158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668162">return</span>&nbsp;<span class="ident" id="3668169">nil</span><span class="op" id="3668172">,</span>&nbsp;<span class="op" id="3668174">&amp;</span><span class="ident" id="3668175">OpError</span><span class="op" id="3668182">{</span><span class="ident" id="3668183">Op</span><span class="op" id="3668185">:</span>&nbsp;<span class="string" id="3668187">&#34;dial&#34;</span><span class="op" id="3668193">,</span>&nbsp;<span class="ident" id="3668195">Net</span><span class="op" id="3668198">:</span>&nbsp;<span class="ident" id="3668200">netProto</span><span class="op" id="3668208">,</span>&nbsp;<span class="ident" id="3668210">Addr</span><span class="op" id="3668214">:</span>&nbsp;<span class="ident" id="3668216">raddr</span><span class="op" id="3668221">,</span>&nbsp;<span class="ident" id="3668223">Err</span><span class="op" id="3668226">:</span>&nbsp;<span class="ident" id="3668228">UnknownNetworkError</span><span class="op" id="3668247">(</span><span class="ident" id="3668248">netProto</span><span class="op" id="3668256">)</span><span class="op" id="3668257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3668260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668263">if</span>&nbsp;<span class="ident" id="3668266">raddr</span>&nbsp;<span class="op" id="3668272">==</span>&nbsp;<span class="ident" id="3668275">nil</span>&nbsp;<span class="op" id="3668279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668283">return</span>&nbsp;<span class="ident" id="3668290">nil</span><span class="op" id="3668293">,</span>&nbsp;<span class="op" id="3668295">&amp;</span><span class="ident" id="3668296">OpError</span><span class="op" id="3668303">{</span><span class="ident" id="3668304">Op</span><span class="op" id="3668306">:</span>&nbsp;<span class="string" id="3668308">&#34;dial&#34;</span><span class="op" id="3668314">,</span>&nbsp;<span class="ident" id="3668316">Net</span><span class="op" id="3668319">:</span>&nbsp;<span class="ident" id="3668321">netProto</span><span class="op" id="3668329">,</span>&nbsp;<span class="ident" id="3668331">Addr</span><span class="op" id="3668335">:</span>&nbsp;<span class="ident" id="3668337">nil</span><span class="op" id="3668340">,</span>&nbsp;<span class="ident" id="3668342">Err</span><span class="op" id="3668345">:</span>&nbsp;<span class="ident" id="3668347">errMissingAddress</span><span class="op" id="3668364">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3668367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3668370">fd</span><span class="op" id="3668372">,</span>&nbsp;<span class="ident" id="3668374">err</span>&nbsp;<span class="op" id="3668378">:=</span>&nbsp;<span class="ident" id="3668381">internetSocket</span><span class="op" id="3668395">(</span><span class="ident" id="3668396">net</span><span class="op" id="3668399">,</span>&nbsp;<span class="ident" id="3668401">laddr</span><span class="op" id="3668406">,</span>&nbsp;<span class="ident" id="3668408">raddr</span><span class="op" id="3668413">,</span>&nbsp;<span class="ident" id="3668415">deadline</span><span class="op" id="3668423">,</span>&nbsp;<span class="ident" id="3668425">syscall</span><span class="op" id="3668432">.</span><span class="ident" id="3668433">SOCK_RAW</span><span class="op" id="3668441">,</span>&nbsp;<span class="ident" id="3668443">proto</span><span class="op" id="3668448">,</span>&nbsp;<span class="string" id="3668450">&#34;dial&#34;</span><span class="op" id="3668456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668459">if</span>&nbsp;<span class="ident" id="3668462">err</span>&nbsp;<span class="op" id="3668466">!=</span>&nbsp;<span class="ident" id="3668469">nil</span>&nbsp;<span class="op" id="3668473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668477">return</span>&nbsp;<span class="ident" id="3668484">nil</span><span class="op" id="3668487">,</span>&nbsp;<span class="op" id="3668489">&amp;</span><span class="ident" id="3668490">OpError</span><span class="op" id="3668497">{</span><span class="ident" id="3668498">Op</span><span class="op" id="3668500">:</span>&nbsp;<span class="string" id="3668502">&#34;dial&#34;</span><span class="op" id="3668508">,</span>&nbsp;<span class="ident" id="3668510">Net</span><span class="op" id="3668513">:</span>&nbsp;<span class="ident" id="3668515">netProto</span><span class="op" id="3668523">,</span>&nbsp;<span class="ident" id="3668525">Addr</span><span class="op" id="3668529">:</span>&nbsp;<span class="ident" id="3668531">raddr</span><span class="op" id="3668536">,</span>&nbsp;<span class="ident" id="3668538">Err</span><span class="op" id="3668541">:</span>&nbsp;<span class="ident" id="3668543">err</span><span class="op" id="3668546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3668549">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668552">return</span>&nbsp;<span class="ident" id="3668559">newIPConn</span><span class="op" id="3668568">(</span><span class="ident" id="3668569">fd</span><span class="op" id="3668571">)</span><span class="op" id="3668572">,</span>&nbsp;<span class="ident" id="3668574">nil</span><br>
<span class="lineno"></span><span class="op" id="3668578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3668581">//&nbsp;ListenIP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;IP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3668648">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">210</span><span class="comment" id="3668714">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;IP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3668784">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3668799">func</span>&nbsp;<span class="ident" id="3668804">ListenIP</span><span class="op" id="3668812">(</span><span class="ident" id="3668813">netProto</span>&nbsp;<span class="builtintype" id="3668822">string</span><span class="op" id="3668828">,</span>&nbsp;<span class="ident" id="3668830">laddr</span>&nbsp;<span class="op" id="3668836">*</span><span class="ident" id="3668837">IPAddr</span><span class="op" id="3668843">)</span>&nbsp;<span class="op" id="3668845">(</span><span class="op" id="3668846">*</span><span class="ident" id="3668847">IPConn</span><span class="op" id="3668853">,</span>&nbsp;<span class="builtintype" id="3668855">error</span><span class="op" id="3668860">)</span>&nbsp;<span class="op" id="3668862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3668865">net</span><span class="op" id="3668868">,</span>&nbsp;<span class="ident" id="3668870">proto</span><span class="op" id="3668875">,</span>&nbsp;<span class="ident" id="3668877">err</span>&nbsp;<span class="op" id="3668881">:=</span>&nbsp;<span class="ident" id="3668884">parseNetwork</span><span class="op" id="3668896">(</span><span class="ident" id="3668897">netProto</span><span class="op" id="3668905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668908">if</span>&nbsp;<span class="ident" id="3668911">err</span>&nbsp;<span class="op" id="3668915">!=</span>&nbsp;<span class="ident" id="3668918">nil</span>&nbsp;<span class="op" id="3668922">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3668926">return</span>&nbsp;<span class="ident" id="3668933">nil</span><span class="op" id="3668936">,</span>&nbsp;<span class="op" id="3668938">&amp;</span><span class="ident" id="3668939">OpError</span><span class="op" id="3668946">{</span><span class="ident" id="3668947">Op</span><span class="op" id="3668949">:</span>&nbsp;<span class="string" id="3668951">&#34;dial&#34;</span><span class="op" id="3668957">,</span>&nbsp;<span class="ident" id="3668959">Net</span><span class="op" id="3668962">:</span>&nbsp;<span class="ident" id="3668964">netProto</span><span class="op" id="3668972">,</span>&nbsp;<span class="ident" id="3668974">Addr</span><span class="op" id="3668978">:</span>&nbsp;<span class="ident" id="3668980">laddr</span><span class="op" id="3668985">,</span>&nbsp;<span class="ident" id="3668987">Err</span><span class="op" id="3668990">:</span>&nbsp;<span class="ident" id="3668992">err</span><span class="op" id="3668995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3668998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669001">switch</span>&nbsp;<span class="ident" id="3669008">net</span>&nbsp;<span class="op" id="3669012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669015">case</span>&nbsp;<span class="string" id="3669020">&#34;ip&#34;</span><span class="op" id="3669024">,</span>&nbsp;<span class="string" id="3669026">&#34;ip4&#34;</span><span class="op" id="3669031">,</span>&nbsp;<span class="string" id="3669033">&#34;ip6&#34;</span><span class="op" id="3669038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669041">default</span><span class="op" id="3669048">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669052">return</span>&nbsp;<span class="ident" id="3669059">nil</span><span class="op" id="3669062">,</span>&nbsp;<span class="op" id="3669064">&amp;</span><span class="ident" id="3669065">OpError</span><span class="op" id="3669072">{</span><span class="ident" id="3669073">Op</span><span class="op" id="3669075">:</span>&nbsp;<span class="string" id="3669077">&#34;listen&#34;</span><span class="op" id="3669085">,</span>&nbsp;<span class="ident" id="3669087">Net</span><span class="op" id="3669090">:</span>&nbsp;<span class="ident" id="3669092">netProto</span><span class="op" id="3669100">,</span>&nbsp;<span class="ident" id="3669102">Addr</span><span class="op" id="3669106">:</span>&nbsp;<span class="ident" id="3669108">laddr</span><span class="op" id="3669113">,</span>&nbsp;<span class="ident" id="3669115">Err</span><span class="op" id="3669118">:</span>&nbsp;<span class="ident" id="3669120">UnknownNetworkError</span><span class="op" id="3669139">(</span><span class="ident" id="3669140">netProto</span><span class="op" id="3669148">)</span><span class="op" id="3669149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3669152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669155">fd</span><span class="op" id="3669157">,</span>&nbsp;<span class="ident" id="3669159">err</span>&nbsp;<span class="op" id="3669163">:=</span>&nbsp;<span class="ident" id="3669166">internetSocket</span><span class="op" id="3669180">(</span><span class="ident" id="3669181">net</span><span class="op" id="3669184">,</span>&nbsp;<span class="ident" id="3669186">laddr</span><span class="op" id="3669191">,</span>&nbsp;<span class="ident" id="3669193">nil</span><span class="op" id="3669196">,</span>&nbsp;<span class="ident" id="3669198">noDeadline</span><span class="op" id="3669208">,</span>&nbsp;<span class="ident" id="3669210">syscall</span><span class="op" id="3669217">.</span><span class="ident" id="3669218">SOCK_RAW</span><span class="op" id="3669226">,</span>&nbsp;<span class="ident" id="3669228">proto</span><span class="op" id="3669233">,</span>&nbsp;<span class="string" id="3669235">&#34;listen&#34;</span><span class="op" id="3669243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669246">if</span>&nbsp;<span class="ident" id="3669249">err</span>&nbsp;<span class="op" id="3669253">!=</span>&nbsp;<span class="ident" id="3669256">nil</span>&nbsp;<span class="op" id="3669260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669264">return</span>&nbsp;<span class="ident" id="3669271">nil</span><span class="op" id="3669274">,</span>&nbsp;<span class="op" id="3669276">&amp;</span><span class="ident" id="3669277">OpError</span><span class="op" id="3669284">{</span><span class="ident" id="3669285">Op</span><span class="op" id="3669287">:</span>&nbsp;<span class="string" id="3669289">&#34;listen&#34;</span><span class="op" id="3669297">,</span>&nbsp;<span class="ident" id="3669299">Net</span><span class="op" id="3669302">:</span>&nbsp;<span class="ident" id="3669304">netProto</span><span class="op" id="3669312">,</span>&nbsp;<span class="ident" id="3669314">Addr</span><span class="op" id="3669318">:</span>&nbsp;<span class="ident" id="3669320">laddr</span><span class="op" id="3669325">,</span>&nbsp;<span class="ident" id="3669327">Err</span><span class="op" id="3669330">:</span>&nbsp;<span class="ident" id="3669332">err</span><span class="op" id="3669335">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3669338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3669341">return</span>&nbsp;<span class="ident" id="3669348">newIPConn</span><span class="op" id="3669357">(</span><span class="ident" id="3669358">fd</span><span class="op" id="3669360">)</span><span class="op" id="3669361">,</span>&nbsp;<span class="ident" id="3669363">nil</span><br>
<span class="lineno"></span><span class="op" id="3669367">}</span>
</div>
</body>
</html>
