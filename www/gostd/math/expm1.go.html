<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html" class="current">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2075236">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2075291">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2075345">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2075396">package</span>&nbsp;<span class="ident" id="2075404">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2075410">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2075470">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2075530">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2075589">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2075619">//</span><br>
<span class="lineno"></span><span class="comment" id="2075622">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2075678">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2075747">//</span><br>
<span class="lineno">15</span><span class="comment" id="2075750">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2075809">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2075865">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2075922">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2075939">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2075995">//</span><br>
<span class="lineno"></span><span class="comment" id="2075998">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2076010">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2076061">//</span><br>
<span class="lineno"></span><span class="comment" id="2076064">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2076074">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2076102">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2076150">//</span><br>
<span class="lineno"></span><span class="comment" id="2076153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2076211">//</span><br>
<span class="lineno">30</span><span class="comment" id="2076214">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2076278">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2076342">//</span><br>
<span class="lineno"></span><span class="comment" id="2076345">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2076410">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2076444">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2076458">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2076523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2076552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2076610">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2076627">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2076685">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2076746">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2076813">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2076878">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2076941">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2077007">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2077042">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2077113">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2077163">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2077213">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2077263">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2077313">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2077363">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2077430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2077460">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2077513">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2077563">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2077608">//</span><br>
<span class="lineno"></span><span class="comment" id="2077611">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2077673">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2077742">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2077781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2077845">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2077909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2077973">//</span><br>
<span class="lineno"></span><span class="comment" id="2077976">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2078042">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2078097">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2078145">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2078209">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2078274">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2078292">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2078364">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2078436">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2078508">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2078580">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2078652">//</span><br>
<span class="lineno"></span><span class="comment" id="2078655">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2078682">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2078721">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2078750">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2078801">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2078858">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2078888">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2078957">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2079009">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2079074">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2079145">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2079180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2079226">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2079285">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2079345">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2079416">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2079479">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2079524">//</span><br>
<span class="lineno"></span><span class="comment" id="2079527">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2079545">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2079591">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2079622">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2079677">//</span><br>
<span class="lineno"></span><span class="comment" id="2079680">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2079693">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2079763">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2079803">//</span><br>
<span class="lineno">105</span><span class="comment" id="2079806">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2079821">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2079845">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2079915">//</span><br>
<span class="lineno"></span><span class="comment" id="2079918">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2079932">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2079998">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2080062">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2080128">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2080172">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2080176">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2080240">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2080300">//</span><br>
<span class="lineno"></span><span class="comment" id="2080303">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2080325">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2080347">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2080367">//&nbsp;&nbsp;&nbsp;&nbsp;Expm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2080387">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2080432">func</span>&nbsp;<span class="ident" id="2080437">Expm1</span><span class="op" id="2080442">(</span><span class="ident" id="2080443">x</span>&nbsp;<span class="builtintype" id="2080445">float64</span><span class="op" id="2080452">)</span>&nbsp;<span class="builtintype" id="2080454">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2080463">func</span>&nbsp;<span class="ident" id="2080468">expm1</span><span class="op" id="2080473">(</span><span class="ident" id="2080474">x</span>&nbsp;<span class="builtintype" id="2080476">float64</span><span class="op" id="2080483">)</span>&nbsp;<span class="builtintype" id="2080485">float64</span>&nbsp;<span class="op" id="2080493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2080496">const</span>&nbsp;<span class="op" id="2080502">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080506">Othreshold</span>&nbsp;<span class="op" id="2080517">=</span>&nbsp;<span class="num" id="2080519">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2080546">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080570">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080581">=</span>&nbsp;<span class="num" id="2080583">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2080610">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080634">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2080645">=</span>&nbsp;<span class="num" id="2080647">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2080674">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080698">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080709">=</span>&nbsp;<span class="num" id="2080711">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2080738">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080762">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080773">=</span>&nbsp;<span class="num" id="2080775">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2080802">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080826">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080837">=</span>&nbsp;<span class="num" id="2080839">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2080866">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080890">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080901">=</span>&nbsp;<span class="num" id="2080903">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2080930">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2080954">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2080965">=</span>&nbsp;<span class="num" id="2080967">1.0</span>&nbsp;<span class="op" id="2080971">/</span>&nbsp;<span class="op" id="2080973">(</span><span class="num" id="2080974">1</span>&nbsp;<span class="op" id="2080976">&lt;&lt;</span>&nbsp;<span class="num" id="2080979">54</span><span class="op" id="2080981">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2080994">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081027">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081069">Q1</span>&nbsp;<span class="op" id="2081072">=</span>&nbsp;<span class="op" id="2081074">-</span><span class="num" id="2081075">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2081102">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081126">Q2</span>&nbsp;<span class="op" id="2081129">=</span>&nbsp;<span class="num" id="2081131">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2081159">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081183">Q3</span>&nbsp;<span class="op" id="2081186">=</span>&nbsp;<span class="op" id="2081188">-</span><span class="num" id="2081189">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2081216">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081240">Q4</span>&nbsp;<span class="op" id="2081243">=</span>&nbsp;<span class="num" id="2081245">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2081273">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081297">Q5</span>&nbsp;<span class="op" id="2081300">=</span>&nbsp;<span class="op" id="2081302">-</span><span class="num" id="2081303">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2081330">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081357">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081375">switch</span>&nbsp;<span class="op" id="2081382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081385">case</span>&nbsp;<span class="ident" id="2081390">IsInf</span><span class="op" id="2081395">(</span><span class="ident" id="2081396">x</span><span class="op" id="2081397">,</span>&nbsp;<span class="num" id="2081399">1</span><span class="op" id="2081400">)</span>&nbsp;<span class="op" id="2081402">||</span>&nbsp;<span class="ident" id="2081405">IsNaN</span><span class="op" id="2081410">(</span><span class="ident" id="2081411">x</span><span class="op" id="2081412">)</span><span class="op" id="2081413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081417">return</span>&nbsp;<span class="ident" id="2081424">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081427">case</span>&nbsp;<span class="ident" id="2081432">IsInf</span><span class="op" id="2081437">(</span><span class="ident" id="2081438">x</span><span class="op" id="2081439">,</span>&nbsp;<span class="op" id="2081441">-</span><span class="num" id="2081442">1</span><span class="op" id="2081443">)</span><span class="op" id="2081444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081448">return</span>&nbsp;<span class="op" id="2081455">-</span><span class="num" id="2081456">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081463">absx</span>&nbsp;<span class="op" id="2081468">:=</span>&nbsp;<span class="ident" id="2081471">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081474">sign</span>&nbsp;<span class="op" id="2081479">:=</span>&nbsp;<span class="builtintype" id="2081482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081489">if</span>&nbsp;<span class="ident" id="2081492">x</span>&nbsp;<span class="op" id="2081494">&lt;</span>&nbsp;<span class="num" id="2081496">0</span>&nbsp;<span class="op" id="2081498">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081502">absx</span>&nbsp;<span class="op" id="2081507">=</span>&nbsp;<span class="op" id="2081509">-</span><span class="ident" id="2081510">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081517">sign</span>&nbsp;<span class="op" id="2081522">=</span>&nbsp;<span class="builtintype" id="2081524">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081534">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081563">if</span>&nbsp;<span class="ident" id="2081566">absx</span>&nbsp;<span class="op" id="2081571">&gt;=</span>&nbsp;<span class="ident" id="2081574">Ln2X56</span>&nbsp;<span class="op" id="2081581">{</span>&nbsp;<span class="comment" id="2081583">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081607">if</span>&nbsp;<span class="ident" id="2081610">absx</span>&nbsp;<span class="op" id="2081615">&gt;=</span>&nbsp;<span class="ident" id="2081618">Othreshold</span>&nbsp;<span class="op" id="2081629">{</span>&nbsp;<span class="comment" id="2081631">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081657">return</span>&nbsp;<span class="ident" id="2081664">Inf</span><span class="op" id="2081667">(</span><span class="num" id="2081668">1</span><span class="op" id="2081669">)</span>&nbsp;<span class="comment" id="2081671">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081689">if</span>&nbsp;<span class="ident" id="2081692">sign</span>&nbsp;<span class="op" id="2081697">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081702">return</span>&nbsp;<span class="op" id="2081709">-</span><span class="num" id="2081710">1</span>&nbsp;<span class="comment" id="2081712">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2081749">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081772">var</span>&nbsp;<span class="ident" id="2081776">c</span>&nbsp;<span class="builtintype" id="2081778">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081787">var</span>&nbsp;<span class="ident" id="2081791">k</span>&nbsp;<span class="builtintype" id="2081793">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081798">if</span>&nbsp;<span class="ident" id="2081801">absx</span>&nbsp;<span class="op" id="2081806">&gt;</span>&nbsp;<span class="ident" id="2081808">Ln2Half</span>&nbsp;<span class="op" id="2081816">{</span>&nbsp;<span class="comment" id="2081818">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081843">var</span>&nbsp;<span class="ident" id="2081847">hi</span><span class="op" id="2081849">,</span>&nbsp;<span class="ident" id="2081851">lo</span>&nbsp;<span class="builtintype" id="2081854">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081864">if</span>&nbsp;<span class="ident" id="2081867">absx</span>&nbsp;<span class="op" id="2081872">&lt;</span>&nbsp;<span class="ident" id="2081874">Ln2HalfX3</span>&nbsp;<span class="op" id="2081884">{</span>&nbsp;<span class="comment" id="2081886">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2081912">if</span>&nbsp;<span class="op" id="2081915">!</span><span class="ident" id="2081916">sign</span>&nbsp;<span class="op" id="2081921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081927">hi</span>&nbsp;<span class="op" id="2081930">=</span>&nbsp;<span class="ident" id="2081932">x</span>&nbsp;<span class="op" id="2081934">-</span>&nbsp;<span class="ident" id="2081936">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081946">lo</span>&nbsp;<span class="op" id="2081949">=</span>&nbsp;<span class="ident" id="2081951">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081961">k</span>&nbsp;<span class="op" id="2081963">=</span>&nbsp;<span class="num" id="2081965">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2081970">}</span>&nbsp;<span class="keyword" id="2081972">else</span>&nbsp;<span class="op" id="2081977">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2081983">hi</span>&nbsp;<span class="op" id="2081986">=</span>&nbsp;<span class="ident" id="2081988">x</span>&nbsp;<span class="op" id="2081990">+</span>&nbsp;<span class="ident" id="2081992">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082002">lo</span>&nbsp;<span class="op" id="2082005">=</span>&nbsp;<span class="op" id="2082007">-</span><span class="ident" id="2082008">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082018">k</span>&nbsp;<span class="op" id="2082020">=</span>&nbsp;<span class="op" id="2082022">-</span><span class="num" id="2082023">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082032">}</span>&nbsp;<span class="keyword" id="2082034">else</span>&nbsp;<span class="op" id="2082039">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082044">if</span>&nbsp;<span class="op" id="2082047">!</span><span class="ident" id="2082048">sign</span>&nbsp;<span class="op" id="2082053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082059">k</span>&nbsp;<span class="op" id="2082061">=</span>&nbsp;<span class="builtintype" id="2082063">int</span><span class="op" id="2082066">(</span><span class="ident" id="2082067">InvLn2</span><span class="op" id="2082073">*</span><span class="ident" id="2082074">x</span>&nbsp;<span class="op" id="2082076">+</span>&nbsp;<span class="num" id="2082078">0.5</span><span class="op" id="2082081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082086">}</span>&nbsp;<span class="keyword" id="2082088">else</span>&nbsp;<span class="op" id="2082093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082099">k</span>&nbsp;<span class="op" id="2082101">=</span>&nbsp;<span class="builtintype" id="2082103">int</span><span class="op" id="2082106">(</span><span class="ident" id="2082107">InvLn2</span><span class="op" id="2082113">*</span><span class="ident" id="2082114">x</span>&nbsp;<span class="op" id="2082116">-</span>&nbsp;<span class="num" id="2082118">0.5</span><span class="op" id="2082121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082126">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082131">t</span>&nbsp;<span class="op" id="2082133">:=</span>&nbsp;<span class="builtintype" id="2082136">float64</span><span class="op" id="2082143">(</span><span class="ident" id="2082144">k</span><span class="op" id="2082145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082150">hi</span>&nbsp;<span class="op" id="2082153">=</span>&nbsp;<span class="ident" id="2082155">x</span>&nbsp;<span class="op" id="2082157">-</span>&nbsp;<span class="ident" id="2082159">t</span><span class="op" id="2082160">*</span><span class="ident" id="2082161">Ln2Hi</span>&nbsp;<span class="comment" id="2082167">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082197">lo</span>&nbsp;<span class="op" id="2082200">=</span>&nbsp;<span class="ident" id="2082202">t</span>&nbsp;<span class="op" id="2082204">*</span>&nbsp;<span class="ident" id="2082206">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082218">x</span>&nbsp;<span class="op" id="2082220">=</span>&nbsp;<span class="ident" id="2082222">hi</span>&nbsp;<span class="op" id="2082225">-</span>&nbsp;<span class="ident" id="2082227">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082232">c</span>&nbsp;<span class="op" id="2082234">=</span>&nbsp;<span class="op" id="2082236">(</span><span class="ident" id="2082237">hi</span>&nbsp;<span class="op" id="2082240">-</span>&nbsp;<span class="ident" id="2082242">x</span><span class="op" id="2082243">)</span>&nbsp;<span class="op" id="2082245">-</span>&nbsp;<span class="ident" id="2082247">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082251">}</span>&nbsp;<span class="keyword" id="2082253">else</span>&nbsp;<span class="keyword" id="2082258">if</span>&nbsp;<span class="ident" id="2082261">absx</span>&nbsp;<span class="op" id="2082266">&lt;</span>&nbsp;<span class="ident" id="2082268">Tiny</span>&nbsp;<span class="op" id="2082273">{</span>&nbsp;<span class="comment" id="2082275">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082308">return</span>&nbsp;<span class="ident" id="2082315">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082318">}</span>&nbsp;<span class="keyword" id="2082320">else</span>&nbsp;<span class="op" id="2082325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082329">k</span>&nbsp;<span class="op" id="2082331">=</span>&nbsp;<span class="num" id="2082333">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2082340">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082370">hfx</span>&nbsp;<span class="op" id="2082374">:=</span>&nbsp;<span class="num" id="2082377">0.5</span>&nbsp;<span class="op" id="2082381">*</span>&nbsp;<span class="ident" id="2082383">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082386">hxs</span>&nbsp;<span class="op" id="2082390">:=</span>&nbsp;<span class="ident" id="2082393">x</span>&nbsp;<span class="op" id="2082395">*</span>&nbsp;<span class="ident" id="2082397">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082402">r1</span>&nbsp;<span class="op" id="2082405">:=</span>&nbsp;<span class="num" id="2082408">1</span>&nbsp;<span class="op" id="2082410">+</span>&nbsp;<span class="ident" id="2082412">hxs</span><span class="op" id="2082415">*</span><span class="op" id="2082416">(</span><span class="ident" id="2082417">Q1</span><span class="op" id="2082419">+</span><span class="ident" id="2082420">hxs</span><span class="op" id="2082423">*</span><span class="op" id="2082424">(</span><span class="ident" id="2082425">Q2</span><span class="op" id="2082427">+</span><span class="ident" id="2082428">hxs</span><span class="op" id="2082431">*</span><span class="op" id="2082432">(</span><span class="ident" id="2082433">Q3</span><span class="op" id="2082435">+</span><span class="ident" id="2082436">hxs</span><span class="op" id="2082439">*</span><span class="op" id="2082440">(</span><span class="ident" id="2082441">Q4</span><span class="op" id="2082443">+</span><span class="ident" id="2082444">hxs</span><span class="op" id="2082447">*</span><span class="ident" id="2082448">Q5</span><span class="op" id="2082450">)</span><span class="op" id="2082451">)</span><span class="op" id="2082452">)</span><span class="op" id="2082453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082456">t</span>&nbsp;<span class="op" id="2082458">:=</span>&nbsp;<span class="num" id="2082461">3</span>&nbsp;<span class="op" id="2082463">-</span>&nbsp;<span class="ident" id="2082465">r1</span><span class="op" id="2082467">*</span><span class="ident" id="2082468">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082473">e</span>&nbsp;<span class="op" id="2082475">:=</span>&nbsp;<span class="ident" id="2082478">hxs</span>&nbsp;<span class="op" id="2082482">*</span>&nbsp;<span class="op" id="2082484">(</span><span class="op" id="2082485">(</span><span class="ident" id="2082486">r1</span>&nbsp;<span class="op" id="2082489">-</span>&nbsp;<span class="ident" id="2082491">t</span><span class="op" id="2082492">)</span>&nbsp;<span class="op" id="2082494">/</span>&nbsp;<span class="op" id="2082496">(</span><span class="num" id="2082497">6.0</span>&nbsp;<span class="op" id="2082501">-</span>&nbsp;<span class="ident" id="2082503">x</span><span class="op" id="2082504">*</span><span class="ident" id="2082505">t</span><span class="op" id="2082506">)</span><span class="op" id="2082507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082510">if</span>&nbsp;<span class="ident" id="2082513">k</span>&nbsp;<span class="op" id="2082515">!=</span>&nbsp;<span class="num" id="2082518">0</span>&nbsp;<span class="op" id="2082520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082524">e</span>&nbsp;<span class="op" id="2082526">=</span>&nbsp;<span class="op" id="2082528">(</span><span class="ident" id="2082529">x</span><span class="op" id="2082530">*</span><span class="op" id="2082531">(</span><span class="ident" id="2082532">e</span><span class="op" id="2082533">-</span><span class="ident" id="2082534">c</span><span class="op" id="2082535">)</span>&nbsp;<span class="op" id="2082537">-</span>&nbsp;<span class="ident" id="2082539">c</span><span class="op" id="2082540">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082544">e</span>&nbsp;<span class="op" id="2082546">-=</span>&nbsp;<span class="ident" id="2082549">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082555">switch</span>&nbsp;<span class="op" id="2082562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082566">case</span>&nbsp;<span class="ident" id="2082571">k</span>&nbsp;<span class="op" id="2082573">==</span>&nbsp;<span class="op" id="2082576">-</span><span class="num" id="2082577">1</span><span class="op" id="2082578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082583">return</span>&nbsp;<span class="num" id="2082590">0.5</span><span class="op" id="2082593">*</span><span class="op" id="2082594">(</span><span class="ident" id="2082595">x</span><span class="op" id="2082596">-</span><span class="ident" id="2082597">e</span><span class="op" id="2082598">)</span>&nbsp;<span class="op" id="2082600">-</span>&nbsp;<span class="num" id="2082602">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082608">case</span>&nbsp;<span class="ident" id="2082613">k</span>&nbsp;<span class="op" id="2082615">==</span>&nbsp;<span class="num" id="2082618">1</span><span class="op" id="2082619">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082624">if</span>&nbsp;<span class="ident" id="2082627">x</span>&nbsp;<span class="op" id="2082629">&lt;</span>&nbsp;<span class="op" id="2082631">-</span><span class="num" id="2082632">0.25</span>&nbsp;<span class="op" id="2082637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082643">return</span>&nbsp;<span class="op" id="2082650">-</span><span class="num" id="2082651">2</span>&nbsp;<span class="op" id="2082653">*</span>&nbsp;<span class="op" id="2082655">(</span><span class="ident" id="2082656">e</span>&nbsp;<span class="op" id="2082658">-</span>&nbsp;<span class="op" id="2082660">(</span><span class="ident" id="2082661">x</span>&nbsp;<span class="op" id="2082663">+</span>&nbsp;<span class="num" id="2082665">0.5</span><span class="op" id="2082668">)</span><span class="op" id="2082669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082679">return</span>&nbsp;<span class="num" id="2082686">1</span>&nbsp;<span class="op" id="2082688">+</span>&nbsp;<span class="num" id="2082690">2</span><span class="op" id="2082691">*</span><span class="op" id="2082692">(</span><span class="ident" id="2082693">x</span><span class="op" id="2082694">-</span><span class="ident" id="2082695">e</span><span class="op" id="2082696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082700">case</span>&nbsp;<span class="ident" id="2082705">k</span>&nbsp;<span class="op" id="2082707">&lt;=</span>&nbsp;<span class="op" id="2082710">-</span><span class="num" id="2082711">2</span>&nbsp;<span class="op" id="2082713">||</span>&nbsp;<span class="ident" id="2082716">k</span>&nbsp;<span class="op" id="2082718">&gt;</span>&nbsp;<span class="num" id="2082720">56</span><span class="op" id="2082722">:</span>&nbsp;<span class="comment" id="2082724">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082757">y</span>&nbsp;<span class="op" id="2082759">:=</span>&nbsp;<span class="num" id="2082762">1</span>&nbsp;<span class="op" id="2082764">-</span>&nbsp;<span class="op" id="2082766">(</span><span class="ident" id="2082767">e</span>&nbsp;<span class="op" id="2082769">-</span>&nbsp;<span class="ident" id="2082771">x</span><span class="op" id="2082772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082777">y</span>&nbsp;<span class="op" id="2082779">=</span>&nbsp;<span class="ident" id="2082781">Float64frombits</span><span class="op" id="2082796">(</span><span class="ident" id="2082797">Float64bits</span><span class="op" id="2082808">(</span><span class="ident" id="2082809">y</span><span class="op" id="2082810">)</span>&nbsp;<span class="op" id="2082812">+</span>&nbsp;<span class="ident" id="2082814">uint64</span><span class="op" id="2082820">(</span><span class="ident" id="2082821">k</span><span class="op" id="2082822">)</span><span class="op" id="2082823">&lt;&lt;</span><span class="num" id="2082825">52</span><span class="op" id="2082827">)</span>&nbsp;<span class="comment" id="2082829">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082857">return</span>&nbsp;<span class="ident" id="2082864">y</span>&nbsp;<span class="op" id="2082866">-</span>&nbsp;<span class="num" id="2082868">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2082872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2082876">if</span>&nbsp;<span class="ident" id="2082879">k</span>&nbsp;<span class="op" id="2082881">&lt;</span>&nbsp;<span class="num" id="2082883">20</span>&nbsp;<span class="op" id="2082886">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082891">t</span>&nbsp;<span class="op" id="2082893">:=</span>&nbsp;<span class="ident" id="2082896">Float64frombits</span><span class="op" id="2082911">(</span><span class="num" id="2082912">0x3ff0000000000000</span>&nbsp;<span class="op" id="2082931">-</span>&nbsp;<span class="op" id="2082933">(</span><span class="num" id="2082934">0x20000000000000</span>&nbsp;<span class="op" id="2082951">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2082954">uint</span><span class="op" id="2082958">(</span><span class="ident" id="2082959">k</span><span class="op" id="2082960">)</span><span class="op" id="2082961">)</span><span class="op" id="2082962">)</span>&nbsp;<span class="comment" id="2082964">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2082980">y</span>&nbsp;<span class="op" id="2082982">:=</span>&nbsp;<span class="ident" id="2082985">t</span>&nbsp;<span class="op" id="2082987">-</span>&nbsp;<span class="op" id="2082989">(</span><span class="ident" id="2082990">e</span>&nbsp;<span class="op" id="2082992">-</span>&nbsp;<span class="ident" id="2082994">x</span><span class="op" id="2082995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2083000">y</span>&nbsp;<span class="op" id="2083002">=</span>&nbsp;<span class="ident" id="2083004">Float64frombits</span><span class="op" id="2083019">(</span><span class="ident" id="2083020">Float64bits</span><span class="op" id="2083031">(</span><span class="ident" id="2083032">y</span><span class="op" id="2083033">)</span>&nbsp;<span class="op" id="2083035">+</span>&nbsp;<span class="ident" id="2083037">uint64</span><span class="op" id="2083043">(</span><span class="ident" id="2083044">k</span><span class="op" id="2083045">)</span><span class="op" id="2083046">&lt;&lt;</span><span class="num" id="2083048">52</span><span class="op" id="2083050">)</span>&nbsp;<span class="comment" id="2083052">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2083080">return</span>&nbsp;<span class="ident" id="2083087">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2083091">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2083095">t</span>&nbsp;<span class="op" id="2083097">:=</span>&nbsp;<span class="ident" id="2083100">Float64frombits</span><span class="op" id="2083115">(</span><span class="ident" id="2083116">uint64</span><span class="op" id="2083122">(</span><span class="op" id="2083123">(</span><span class="num" id="2083124">0x3ff</span>&nbsp;<span class="op" id="2083130">-</span>&nbsp;<span class="ident" id="2083132">k</span><span class="op" id="2083133">)</span>&nbsp;<span class="op" id="2083135">&lt;&lt;</span>&nbsp;<span class="num" id="2083138">52</span><span class="op" id="2083140">)</span><span class="op" id="2083141">)</span>&nbsp;<span class="comment" id="2083143">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2083154">y</span>&nbsp;<span class="op" id="2083156">:=</span>&nbsp;<span class="ident" id="2083159">x</span>&nbsp;<span class="op" id="2083161">-</span>&nbsp;<span class="op" id="2083163">(</span><span class="ident" id="2083164">e</span>&nbsp;<span class="op" id="2083166">+</span>&nbsp;<span class="ident" id="2083168">t</span><span class="op" id="2083169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2083173">y</span>&nbsp;<span class="op" id="2083175">+=</span>&nbsp;<span class="num" id="2083178">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2083182">y</span>&nbsp;<span class="op" id="2083184">=</span>&nbsp;<span class="ident" id="2083186">Float64frombits</span><span class="op" id="2083201">(</span><span class="ident" id="2083202">Float64bits</span><span class="op" id="2083213">(</span><span class="ident" id="2083214">y</span><span class="op" id="2083215">)</span>&nbsp;<span class="op" id="2083217">+</span>&nbsp;<span class="ident" id="2083219">uint64</span><span class="op" id="2083225">(</span><span class="ident" id="2083226">k</span><span class="op" id="2083227">)</span><span class="op" id="2083228">&lt;&lt;</span><span class="num" id="2083230">52</span><span class="op" id="2083232">)</span>&nbsp;<span class="comment" id="2083234">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2083261">return</span>&nbsp;<span class="ident" id="2083268">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2083271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2083274">return</span>&nbsp;<span class="ident" id="2083281">x</span>&nbsp;<span class="op" id="2083283">-</span>&nbsp;<span class="op" id="2083285">(</span><span class="ident" id="2083286">x</span><span class="op" id="2083287">*</span><span class="ident" id="2083288">e</span>&nbsp;<span class="op" id="2083290">-</span>&nbsp;<span class="ident" id="2083292">hxs</span><span class="op" id="2083295">)</span>&nbsp;<span class="comment" id="2083297">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2083307">}</span>
</div>
</body>
</html>
