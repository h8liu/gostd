<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>database/sql</h2>
<ul>
<li><a href="/gostd/database/sql/convert.go.html">convert.go</a></li>
<li><a href="/gostd/database/sql/convert_test.go.html">convert_test.go</a></li>
<li><a href="/gostd/database/sql/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/database/sql/fakedb_test.go.html" class="current">fakedb_test.go</a></li>
<li><a href="/gostd/database/sql/sql.go.html">sql.go</a></li>
<li><a href="/gostd/database/sql/sql_test.go.html">sql_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7148436">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7148491">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7148545">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7148596">package</span>&nbsp;<span class="ident" id="7148604">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7148609">import</span>&nbsp;<span class="op" id="7148616">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148619">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148642">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148652">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148659">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148665">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148672">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148680">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148691">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148702">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148710">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7148721">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7148728">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7148731">var</span>&nbsp;<span class="ident" id="7148735">_</span>&nbsp;<span class="op" id="7148737">=</span>&nbsp;<span class="ident" id="7148739"><a href="/gostd/database/sql/fakedb_test.go.html#7148665">log</a></span><span class="op" id="7148742">.</span><span class="ident" id="7148743"><a href="/gostd/log/log.go.html#4078664">Printf</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7148751">//&nbsp;fakeDriver&nbsp;is&nbsp;a&nbsp;fake&nbsp;database&nbsp;that&nbsp;implements&nbsp;Go&#39;s&nbsp;driver.Driver</span><br>
<span class="lineno"></span><span class="comment" id="7148819">//&nbsp;interface,&nbsp;just&nbsp;for&nbsp;testing.</span><br>
<span class="lineno">25</span><span class="comment" id="7148851">//</span><br>
<span class="lineno"></span><span class="comment" id="7148854">//&nbsp;It&nbsp;speaks&nbsp;a&nbsp;query&nbsp;language&nbsp;that&#39;s&nbsp;semantically&nbsp;similar&nbsp;to&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="7148919">//&nbsp;syntactically&nbsp;different&nbsp;and&nbsp;simpler&nbsp;than&nbsp;SQL.&nbsp;&nbsp;The&nbsp;syntax&nbsp;is&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="7148986">//&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="7148998">//</span><br>
<span class="lineno">30</span><span class="comment" id="7149001">//&nbsp;&nbsp;&nbsp;WIPE</span><br>
<span class="lineno"></span><span class="comment" id="7149011">//&nbsp;&nbsp;&nbsp;CREATE|&lt;tablename&gt;|&lt;col&gt;=&lt;type&gt;,&lt;col&gt;=&lt;type&gt;,...</span><br>
<span class="lineno"></span><span class="comment" id="7149065">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;types&nbsp;are:&nbsp;&#34;string&#34;,&nbsp;[u]int{8,16,32,64},&nbsp;&#34;bool&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7149126">//&nbsp;&nbsp;&nbsp;INSERT|&lt;tablename&gt;|col=val,col2=val2,col3=?</span><br>
<span class="lineno"></span><span class="comment" id="7149175">//&nbsp;&nbsp;&nbsp;SELECT|&lt;tablename&gt;|projectcol1,projectcol2|filtercol=?,filtercol2=?</span><br>
<span class="lineno">35</span><span class="comment" id="7149248">//</span><br>
<span class="lineno"></span><span class="comment" id="7149251">//&nbsp;When&nbsp;opening&nbsp;a&nbsp;fakeDriver&#39;s&nbsp;database,&nbsp;it&nbsp;starts&nbsp;empty&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7149316">//&nbsp;tables.&nbsp;&nbsp;All&nbsp;tables&nbsp;and&nbsp;data&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="7149375">type</span>&nbsp;<span class="ident" id="7149380">fakeDriver</span>&nbsp;<span class="keyword" id="7149391">struct</span>&nbsp;<span class="op" id="7149398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149401">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149412"><a href="/gostd/database/sql/fakedb_test.go.html#7148702">sync</a></span><span class="op" id="7149416">.</span><span class="ident" id="7149417"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="7149423">//&nbsp;guards&nbsp;3&nbsp;following&nbsp;fields</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149453">openCount</span>&nbsp;&nbsp;<span class="builtintype" id="7149464">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7149475">//&nbsp;conn&nbsp;opens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149490">closeCount</span>&nbsp;<span class="builtintype" id="7149501">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7149512">//&nbsp;conn&nbsp;closes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149528">waitCh</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149539">chan</span>&nbsp;<span class="keyword" id="7149544">struct</span><span class="op" id="7149550">{</span><span class="op" id="7149551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149554">waitingCh</span>&nbsp;&nbsp;<span class="keyword" id="7149565">chan</span>&nbsp;<span class="keyword" id="7149570">struct</span><span class="op" id="7149576">{</span><span class="op" id="7149577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149580">dbs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149591">map</span><span class="op" id="7149594">[</span><span class="builtintype" id="7149595">string</span><span class="op" id="7149601">]</span><span class="op" id="7149602">*</span><span class="ident" id="7149603"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><br>
<span class="lineno">45</span><span class="op" id="7149610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7149613">type</span>&nbsp;<span class="ident" id="7149618">fakeDB</span>&nbsp;<span class="keyword" id="7149625">struct</span>&nbsp;<span class="op" id="7149632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149635">name</span>&nbsp;<span class="builtintype" id="7149640">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149649">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149657"><a href="/gostd/database/sql/fakedb_test.go.html#7148702">sync</a></span><span class="op" id="7149661">.</span><span class="ident" id="7149662"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149669">free</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7149677">[</span><span class="op" id="7149678">]</span><span class="op" id="7149679">*</span><span class="ident" id="7149680"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149690">tables</span>&nbsp;&nbsp;<span class="keyword" id="7149698">map</span><span class="op" id="7149701">[</span><span class="builtintype" id="7149702">string</span><span class="op" id="7149708">]</span><span class="op" id="7149709">*</span><span class="ident" id="7149710"><a href="/gostd/database/sql/fakedb_test.go.html#7149738">table</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149717">badConn</span>&nbsp;<span class="builtintype" id="7149725">bool</span><br>
<span class="lineno"></span><span class="op" id="7149730">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7149733">type</span>&nbsp;<span class="ident" id="7149738">table</span>&nbsp;<span class="keyword" id="7149744">struct</span>&nbsp;<span class="op" id="7149751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149754">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149762"><a href="/gostd/database/sql/fakedb_test.go.html#7148702">sync</a></span><span class="op" id="7149766">.</span><span class="ident" id="7149767"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149774">colname</span>&nbsp;<span class="op" id="7149782">[</span><span class="op" id="7149783">]</span><span class="builtintype" id="7149784">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149792">coltype</span>&nbsp;<span class="op" id="7149800">[</span><span class="op" id="7149801">]</span><span class="builtintype" id="7149802">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149810">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7149818">[</span><span class="op" id="7149819">]</span><span class="op" id="7149820">*</span><span class="ident" id="7149821"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><br>
<span class="lineno"></span><span class="op" id="7149825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7149828">func</span>&nbsp;<span class="op" id="7149833">(</span><span class="ident" id="7149834">t</span>&nbsp;<span class="op" id="7149836">*</span><span class="ident" id="7149837"><a href="/gostd/database/sql/fakedb_test.go.html#7149738">table</a></span><span class="op" id="7149842">)</span>&nbsp;<span class="ident" id="7149844">columnIndex</span><span class="op" id="7149855">(</span><span class="ident" id="7149856">name</span>&nbsp;<span class="builtintype" id="7149861">string</span><span class="op" id="7149867">)</span>&nbsp;<span class="builtintype" id="7149869">int</span>&nbsp;<span class="op" id="7149873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149876">for</span>&nbsp;<span class="ident" id="7149880">n</span><span class="op" id="7149881">,</span>&nbsp;<span class="ident" id="7149883">nname</span>&nbsp;<span class="op" id="7149889">:=</span>&nbsp;<span class="keyword" id="7149892">range</span>&nbsp;<span class="ident" id="7149898"><a href="/gostd/database/sql/fakedb_test.go.html#7149834">t</a></span><span class="op" id="7149899">.</span><span class="ident" id="7149900"><a href="/gostd/database/sql/fakedb_test.go.html#7149774">colname</a></span>&nbsp;<span class="op" id="7149908">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149912">if</span>&nbsp;<span class="ident" id="7149915"><a href="/gostd/database/sql/fakedb_test.go.html#7149856">name</a></span>&nbsp;<span class="op" id="7149920">==</span>&nbsp;<span class="ident" id="7149923"><a href="/gostd/database/sql/fakedb_test.go.html#7149883">nname</a></span>&nbsp;<span class="op" id="7149929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149934">return</span>&nbsp;<span class="ident" id="7149941"><a href="/gostd/database/sql/fakedb_test.go.html#7149880">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7149945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7149948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7149951">return</span>&nbsp;<span class="op" id="7149958">-</span><span class="num" id="7149959">1</span><br>
<span class="lineno">70</span><span class="op" id="7149961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7149964">type</span>&nbsp;<span class="ident" id="7149969">row</span>&nbsp;<span class="keyword" id="7149973">struct</span>&nbsp;<span class="op" id="7149980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7149983">cols</span>&nbsp;<span class="op" id="7149988">[</span><span class="op" id="7149989">]</span><span class="keyword" id="7149990">interface</span><span class="op" id="7149999">{</span><span class="op" id="7150000">}</span>&nbsp;<span class="comment" id="7150002">//&nbsp;must&nbsp;be&nbsp;same&nbsp;size&nbsp;as&nbsp;its&nbsp;table&nbsp;colname&nbsp;+&nbsp;coltype</span><br>
<span class="lineno"></span><span class="op" id="7150054">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7150057">func</span>&nbsp;<span class="op" id="7150062">(</span><span class="ident" id="7150063">r</span>&nbsp;<span class="op" id="7150065">*</span><span class="ident" id="7150066"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><span class="op" id="7150069">)</span>&nbsp;<span class="ident" id="7150071">clone</span><span class="op" id="7150076">(</span><span class="op" id="7150077">)</span>&nbsp;<span class="op" id="7150079">*</span><span class="ident" id="7150080"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span>&nbsp;<span class="op" id="7150084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150087">nrow</span>&nbsp;<span class="op" id="7150092">:=</span>&nbsp;<span class="op" id="7150095">&amp;</span><span class="ident" id="7150096"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><span class="op" id="7150099">{</span><span class="ident" id="7150100"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7150104">:</span>&nbsp;<span class="builtinfunc" id="7150106">make</span><span class="op" id="7150110">(</span><span class="op" id="7150111">[</span><span class="op" id="7150112">]</span><span class="keyword" id="7150113">interface</span><span class="op" id="7150122">{</span><span class="op" id="7150123">}</span><span class="op" id="7150124">,</span>&nbsp;<span class="builtinfunc" id="7150126">len</span><span class="op" id="7150129">(</span><span class="ident" id="7150130"><a href="/gostd/database/sql/fakedb_test.go.html#7150063">r</a></span><span class="op" id="7150131">.</span><span class="ident" id="7150132"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7150136">)</span><span class="op" id="7150137">)</span><span class="op" id="7150138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7150141">copy</span><span class="op" id="7150145">(</span><span class="ident" id="7150146"><a href="/gostd/database/sql/fakedb_test.go.html#7150087">nrow</a></span><span class="op" id="7150150">.</span><span class="ident" id="7150151"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7150155">,</span>&nbsp;<span class="ident" id="7150157"><a href="/gostd/database/sql/fakedb_test.go.html#7150063">r</a></span><span class="op" id="7150158">.</span><span class="ident" id="7150159"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7150163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7150166">return</span>&nbsp;<span class="ident" id="7150173"><a href="/gostd/database/sql/fakedb_test.go.html#7150087">nrow</a></span><br>
<span class="lineno">80</span><span class="op" id="7150178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7150181">type</span>&nbsp;<span class="ident" id="7150186">fakeConn</span>&nbsp;<span class="keyword" id="7150195">struct</span>&nbsp;<span class="op" id="7150202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150205">db</span>&nbsp;<span class="op" id="7150208">*</span><span class="ident" id="7150209"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span>&nbsp;<span class="comment" id="7150216">//&nbsp;where&nbsp;to&nbsp;return&nbsp;ourselves&nbsp;to</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150250">currTx</span>&nbsp;<span class="op" id="7150257">*</span><span class="ident" id="7150258"><a href="/gostd/database/sql/fakedb_test.go.html#7150463">fakeTx</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7150267">//&nbsp;Stats&nbsp;for&nbsp;tests:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150288">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150300"><a href="/gostd/database/sql/fakedb_test.go.html#7148702">sync</a></span><span class="op" id="7150304">.</span><span class="ident" id="7150305"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150312">stmtsMade</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7150324">int</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150329">stmtsClosed</span>&nbsp;<span class="builtintype" id="7150341">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150346">numPrepare</span>&nbsp;&nbsp;<span class="builtintype" id="7150358">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150363">bad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7150375">bool</span><br>
<span class="lineno"></span><span class="op" id="7150380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7150383">func</span>&nbsp;<span class="op" id="7150388">(</span><span class="ident" id="7150389">c</span>&nbsp;<span class="op" id="7150391">*</span><span class="ident" id="7150392"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7150400">)</span>&nbsp;<span class="ident" id="7150402">incrStat</span><span class="op" id="7150410">(</span><span class="ident" id="7150411">v</span>&nbsp;<span class="op" id="7150413">*</span><span class="builtintype" id="7150414">int</span><span class="op" id="7150417">)</span>&nbsp;<span class="op" id="7150419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150422"><a href="/gostd/database/sql/fakedb_test.go.html#7150389">c</a></span><span class="op" id="7150423">.</span><span class="ident" id="7150424"><a href="/gostd/database/sql/fakedb_test.go.html#7150288">mu</a></span><span class="op" id="7150426">.</span><span class="ident" id="7150427"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7150431">(</span><span class="op" id="7150432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7150435">*</span><span class="ident" id="7150436"><a href="/gostd/database/sql/fakedb_test.go.html#7150411">v</a></span><span class="op" id="7150437">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150441"><a href="/gostd/database/sql/fakedb_test.go.html#7150389">c</a></span><span class="op" id="7150442">.</span><span class="ident" id="7150443"><a href="/gostd/database/sql/fakedb_test.go.html#7150288">mu</a></span><span class="op" id="7150445">.</span><span class="ident" id="7150446"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7150452">(</span><span class="op" id="7150453">)</span><br>
<span class="lineno"></span><span class="op" id="7150455">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7150458">type</span>&nbsp;<span class="ident" id="7150463">fakeTx</span>&nbsp;<span class="keyword" id="7150470">struct</span>&nbsp;<span class="op" id="7150477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150480">c</span>&nbsp;<span class="op" id="7150482">*</span><span class="ident" id="7150483"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><br>
<span class="lineno"></span><span class="op" id="7150492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7150495">type</span>&nbsp;<span class="ident" id="7150500">fakeStmt</span>&nbsp;<span class="keyword" id="7150509">struct</span>&nbsp;<span class="op" id="7150516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150519">c</span>&nbsp;<span class="op" id="7150521">*</span><span class="ident" id="7150522"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150532">q</span>&nbsp;<span class="builtintype" id="7150534">string</span>&nbsp;<span class="comment" id="7150541">//&nbsp;just&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150565">cmd</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7150571">string</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150579">table</span>&nbsp;<span class="builtintype" id="7150585">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150594">closed</span>&nbsp;<span class="builtintype" id="7150601">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150608">colName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7150621">[</span><span class="op" id="7150622">]</span><span class="builtintype" id="7150623">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7150635">//&nbsp;used&nbsp;by&nbsp;CREATE,&nbsp;INSERT,&nbsp;SELECT&nbsp;(selected&nbsp;columns)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150689">colType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7150702">[</span><span class="op" id="7150703">]</span><span class="builtintype" id="7150704">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7150716">//&nbsp;used&nbsp;by&nbsp;CREATE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150735">colValue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7150748">[</span><span class="op" id="7150749">]</span><span class="keyword" id="7150750">interface</span><span class="op" id="7150759">{</span><span class="op" id="7150760">}</span>&nbsp;<span class="comment" id="7150762">//&nbsp;used&nbsp;by&nbsp;INSERT&nbsp;(mix&nbsp;of&nbsp;strings&nbsp;and&nbsp;&#34;?&#34;&nbsp;for&nbsp;bound&nbsp;params)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150823">placeholders</span>&nbsp;<span class="builtintype" id="7150836">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7150850">//&nbsp;used&nbsp;by&nbsp;INSERT/SELECT:&nbsp;number&nbsp;of&nbsp;?&nbsp;params</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150897">whereCol</span>&nbsp;<span class="op" id="7150906">[</span><span class="op" id="7150907">]</span><span class="builtintype" id="7150908">string</span>&nbsp;<span class="comment" id="7150915">//&nbsp;used&nbsp;by&nbsp;SELECT&nbsp;(all&nbsp;placeholders)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7150954">placeholderConverter</span>&nbsp;<span class="op" id="7150975">[</span><span class="op" id="7150976">]</span><span class="ident" id="7150977"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7150983">.</span><span class="ident" id="7150984"><a href="/gostd/database/sql/driver/types.go.html#5255195">ValueConverter</a></span>&nbsp;<span class="comment" id="7150999">//&nbsp;used&nbsp;by&nbsp;INSERT</span><br>
<span class="lineno"></span><span class="op" id="7151017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151020">var</span>&nbsp;<span class="ident" id="7151024">fdriver</span>&nbsp;<span class="ident" id="7151032"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7151038">.</span><span class="ident" id="7151039"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span>&nbsp;<span class="op" id="7151046">=</span>&nbsp;<span class="op" id="7151048">&amp;</span><span class="ident" id="7151049"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7151059">{</span><span class="op" id="7151060">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7151063">func</span>&nbsp;<span class="ident" id="7151068">init</span><span class="op" id="7151072">(</span><span class="op" id="7151073">)</span>&nbsp;<span class="op" id="7151075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151078"><a href="/gostd/database/sql/sql.go.html#5202343">Register</a></span><span class="op" id="7151086">(</span><span class="string" id="7151087">&#34;test&#34;</span><span class="op" id="7151093">,</span>&nbsp;<span class="ident" id="7151095"><a href="/gostd/database/sql/fakedb_test.go.html#7151024">fdriver</a></span><span class="op" id="7151102">)</span><br>
<span class="lineno"></span><span class="op" id="7151104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7151107">func</span>&nbsp;<span class="ident" id="7151112">contains</span><span class="op" id="7151120">(</span><span class="ident" id="7151121">list</span>&nbsp;<span class="op" id="7151126">[</span><span class="op" id="7151127">]</span><span class="builtintype" id="7151128">string</span><span class="op" id="7151134">,</span>&nbsp;<span class="ident" id="7151136">y</span>&nbsp;<span class="builtintype" id="7151138">string</span><span class="op" id="7151144">)</span>&nbsp;<span class="builtintype" id="7151146">bool</span>&nbsp;<span class="op" id="7151151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151154">for</span>&nbsp;<span class="ident" id="7151158">_</span><span class="op" id="7151159">,</span>&nbsp;<span class="ident" id="7151161">x</span>&nbsp;<span class="op" id="7151163">:=</span>&nbsp;<span class="keyword" id="7151166">range</span>&nbsp;<span class="ident" id="7151172"><a href="/gostd/database/sql/fakedb_test.go.html#7151121">list</a></span>&nbsp;<span class="op" id="7151177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151181">if</span>&nbsp;<span class="ident" id="7151184"><a href="/gostd/database/sql/fakedb_test.go.html#7151161">x</a></span>&nbsp;<span class="op" id="7151186">==</span>&nbsp;<span class="ident" id="7151189"><a href="/gostd/database/sql/fakedb_test.go.html#7151136">y</a></span>&nbsp;<span class="op" id="7151191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151196">return</span>&nbsp;<span class="builtintype" id="7151203">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151210">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151216">return</span>&nbsp;<span class="builtintype" id="7151223">false</span><br>
<span class="lineno"></span><span class="op" id="7151229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151232">type</span>&nbsp;<span class="ident" id="7151237">Dummy</span>&nbsp;<span class="keyword" id="7151243">struct</span>&nbsp;<span class="op" id="7151250">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151253"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7151259">.</span><span class="ident" id="7151260"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span><br>
<span class="lineno"></span><span class="op" id="7151267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7151270">func</span>&nbsp;<span class="ident" id="7151275">TestDrivers</span><span class="op" id="7151286">(</span><span class="ident" id="7151287">t</span>&nbsp;<span class="op" id="7151289">*</span><span class="ident" id="7151290"><a href="/gostd/database/sql/fakedb_test.go.html#7148710">testing</a></span><span class="op" id="7151297">.</span><span class="ident" id="7151298"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7151299">)</span>&nbsp;<span class="op" id="7151301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151304"><a href="/gostd/database/sql/sql.go.html#5202578">unregisterAllDrivers</a></span><span class="op" id="7151324">(</span><span class="op" id="7151325">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151328"><a href="/gostd/database/sql/sql.go.html#5202343">Register</a></span><span class="op" id="7151336">(</span><span class="string" id="7151337">&#34;test&#34;</span><span class="op" id="7151343">,</span>&nbsp;<span class="ident" id="7151345"><a href="/gostd/database/sql/fakedb_test.go.html#7151024">fdriver</a></span><span class="op" id="7151352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151355"><a href="/gostd/database/sql/sql.go.html#5202343">Register</a></span><span class="op" id="7151363">(</span><span class="string" id="7151364">&#34;invalid&#34;</span><span class="op" id="7151373">,</span>&nbsp;<span class="ident" id="7151375"><a href="/gostd/database/sql/fakedb_test.go.html#7151237">Dummy</a></span><span class="op" id="7151380">{</span><span class="op" id="7151381">}</span><span class="op" id="7151382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151385">all</span>&nbsp;<span class="op" id="7151389">:=</span>&nbsp;<span class="ident" id="7151392"><a href="/gostd/database/sql/sql.go.html#5202741">Drivers</a></span><span class="op" id="7151399">(</span><span class="op" id="7151400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151403">if</span>&nbsp;<span class="builtinfunc" id="7151406">len</span><span class="op" id="7151409">(</span><span class="ident" id="7151410"><a href="/gostd/database/sql/fakedb_test.go.html#7151385">all</a></span><span class="op" id="7151413">)</span>&nbsp;<span class="op" id="7151415">&lt;</span>&nbsp;<span class="num" id="7151417">2</span>&nbsp;<span class="op" id="7151419">||</span>&nbsp;<span class="op" id="7151422">!</span><span class="ident" id="7151423"><a href="/gostd/database/sql/fakedb_test.go.html#7148672">sort</a></span><span class="op" id="7151427">.</span><span class="ident" id="7151428"><a href="/gostd/sort/sort.go.html#2018276">StringsAreSorted</a></span><span class="op" id="7151444">(</span><span class="ident" id="7151445"><a href="/gostd/database/sql/fakedb_test.go.html#7151385">all</a></span><span class="op" id="7151448">)</span>&nbsp;<span class="op" id="7151450">||</span>&nbsp;<span class="op" id="7151453">!</span><span class="ident" id="7151454"><a href="/gostd/database/sql/fakedb_test.go.html#7151112">contains</a></span><span class="op" id="7151462">(</span><span class="ident" id="7151463"><a href="/gostd/database/sql/fakedb_test.go.html#7151385">all</a></span><span class="op" id="7151466">,</span>&nbsp;<span class="string" id="7151468">&#34;test&#34;</span><span class="op" id="7151474">)</span>&nbsp;<span class="op" id="7151476">||</span>&nbsp;<span class="op" id="7151479">!</span><span class="ident" id="7151480"><a href="/gostd/database/sql/fakedb_test.go.html#7151112">contains</a></span><span class="op" id="7151488">(</span><span class="ident" id="7151489"><a href="/gostd/database/sql/fakedb_test.go.html#7151385">all</a></span><span class="op" id="7151492">,</span>&nbsp;<span class="string" id="7151494">&#34;invalid&#34;</span><span class="op" id="7151503">)</span>&nbsp;<span class="op" id="7151505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151509"><a href="/gostd/database/sql/fakedb_test.go.html#7151287">t</a></span><span class="op" id="7151510">.</span><span class="ident" id="7151511"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="7151517">(</span><span class="string" id="7151518">&#34;Drivers&nbsp;=&nbsp;%v,&nbsp;want&nbsp;sorted&nbsp;list&nbsp;with&nbsp;at&nbsp;least&nbsp;[invalid,&nbsp;test]&#34;</span><span class="op" id="7151580">,</span>&nbsp;<span class="ident" id="7151582"><a href="/gostd/database/sql/fakedb_test.go.html#7151385">all</a></span><span class="op" id="7151585">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151588">}</span><br>
<span class="lineno"></span><span class="op" id="7151590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7151593">//&nbsp;Supports&nbsp;dsn&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="7151616">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;</span><br>
<span class="lineno">155</span><span class="comment" id="7151631">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;;&lt;opts&gt;&nbsp;&nbsp;(only&nbsp;currently&nbsp;supported&nbsp;option&nbsp;is&nbsp;`badConn`,</span><br>
<span class="lineno"></span><span class="comment" id="7151701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;causes&nbsp;driver.ErrBadConn&nbsp;to&nbsp;be&nbsp;returned&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="7151774">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;every&nbsp;other&nbsp;conn.Begin())</span><br>
<span class="lineno"></span><span class="keyword" id="7151824">func</span>&nbsp;<span class="op" id="7151829">(</span><span class="ident" id="7151830">d</span>&nbsp;<span class="op" id="7151832">*</span><span class="ident" id="7151833"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7151843">)</span>&nbsp;<span class="ident" id="7151845">Open</span><span class="op" id="7151849">(</span><span class="ident" id="7151850">dsn</span>&nbsp;<span class="builtintype" id="7151854">string</span><span class="op" id="7151860">)</span>&nbsp;<span class="op" id="7151862">(</span><span class="ident" id="7151863"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7151869">.</span><span class="ident" id="7151870"><a href="/gostd/database/sql/driver/driver.go.html#5250262">Conn</a></span><span class="op" id="7151874">,</span>&nbsp;<span class="builtintype" id="7151876">error</span><span class="op" id="7151881">)</span>&nbsp;<span class="op" id="7151883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151886">parts</span>&nbsp;<span class="op" id="7151892">:=</span>&nbsp;<span class="ident" id="7151895"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7151902">.</span><span class="ident" id="7151903"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7151908">(</span><span class="ident" id="7151909"><a href="/gostd/database/sql/fakedb_test.go.html#7151850">dsn</a></span><span class="op" id="7151912">,</span>&nbsp;<span class="string" id="7151914">&#34;;&#34;</span><span class="op" id="7151917">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151920">if</span>&nbsp;<span class="builtinfunc" id="7151923">len</span><span class="op" id="7151926">(</span><span class="ident" id="7151927"><a href="/gostd/database/sql/fakedb_test.go.html#7151886">parts</a></span><span class="op" id="7151932">)</span>&nbsp;<span class="op" id="7151934">&lt;</span>&nbsp;<span class="num" id="7151936">1</span>&nbsp;<span class="op" id="7151938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7151942">return</span>&nbsp;<span class="builtintype" id="7151949">nil</span><span class="op" id="7151952">,</span>&nbsp;<span class="ident" id="7151954"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7151960">.</span><span class="ident" id="7151961"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7151964">(</span><span class="string" id="7151965">&#34;fakedb:&nbsp;no&nbsp;database&nbsp;name&#34;</span><span class="op" id="7151991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7151994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7151997">name</span>&nbsp;<span class="op" id="7152002">:=</span>&nbsp;<span class="ident" id="7152005"><a href="/gostd/database/sql/fakedb_test.go.html#7151886">parts</a></span><span class="op" id="7152010">[</span><span class="num" id="7152011">0</span><span class="op" id="7152012">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152016">db</span>&nbsp;<span class="op" id="7152019">:=</span>&nbsp;<span class="ident" id="7152022"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152023">.</span><span class="ident" id="7152024"><a href="/gostd/database/sql/fakedb_test.go.html#7152321">getDB</a></span><span class="op" id="7152029">(</span><span class="ident" id="7152030"><a href="/gostd/database/sql/fakedb_test.go.html#7151997">name</a></span><span class="op" id="7152034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152038"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152039">.</span><span class="ident" id="7152040"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7152042">.</span><span class="ident" id="7152043"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7152047">(</span><span class="op" id="7152048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152051"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152052">.</span><span class="ident" id="7152053"><a href="/gostd/database/sql/fakedb_test.go.html#7149453">openCount</a></span><span class="op" id="7152062">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152066"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152067">.</span><span class="ident" id="7152068"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7152070">.</span><span class="ident" id="7152071"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7152077">(</span><span class="op" id="7152078">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152081">conn</span>&nbsp;<span class="op" id="7152086">:=</span>&nbsp;<span class="op" id="7152089">&amp;</span><span class="ident" id="7152090"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7152098">{</span><span class="ident" id="7152099"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7152101">:</span>&nbsp;<span class="ident" id="7152103"><a href="/gostd/database/sql/fakedb_test.go.html#7152016">db</a></span><span class="op" id="7152105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152109">if</span>&nbsp;<span class="builtinfunc" id="7152112">len</span><span class="op" id="7152115">(</span><span class="ident" id="7152116"><a href="/gostd/database/sql/fakedb_test.go.html#7151886">parts</a></span><span class="op" id="7152121">)</span>&nbsp;<span class="op" id="7152123">&gt;=</span>&nbsp;<span class="num" id="7152126">2</span>&nbsp;<span class="op" id="7152128">&amp;&amp;</span>&nbsp;<span class="ident" id="7152131"><a href="/gostd/database/sql/fakedb_test.go.html#7151886">parts</a></span><span class="op" id="7152136">[</span><span class="num" id="7152137">1</span><span class="op" id="7152138">]</span>&nbsp;<span class="op" id="7152140">==</span>&nbsp;<span class="string" id="7152143">&#34;badConn&#34;</span>&nbsp;<span class="op" id="7152153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152157"><a href="/gostd/database/sql/fakedb_test.go.html#7152081">conn</a></span><span class="op" id="7152161">.</span><span class="ident" id="7152162"><a href="/gostd/database/sql/fakedb_test.go.html#7150363">bad</a></span>&nbsp;<span class="op" id="7152166">=</span>&nbsp;<span class="builtintype" id="7152168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152174">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152177">if</span>&nbsp;<span class="ident" id="7152180"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152181">.</span><span class="ident" id="7152182"><a href="/gostd/database/sql/fakedb_test.go.html#7149528">waitCh</a></span>&nbsp;<span class="op" id="7152189">!=</span>&nbsp;<span class="builtintype" id="7152192">nil</span>&nbsp;<span class="op" id="7152196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152200"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152201">.</span><span class="ident" id="7152202"><a href="/gostd/database/sql/fakedb_test.go.html#7149554">waitingCh</a></span>&nbsp;<span class="op" id="7152212">&lt;-</span>&nbsp;<span class="keyword" id="7152215">struct</span><span class="op" id="7152221">{</span><span class="op" id="7152222">}</span><span class="op" id="7152223">{</span><span class="op" id="7152224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152228">&lt;-</span><span class="ident" id="7152230"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152231">.</span><span class="ident" id="7152232"><a href="/gostd/database/sql/fakedb_test.go.html#7149528">waitCh</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152241"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152242">.</span><span class="ident" id="7152243"><a href="/gostd/database/sql/fakedb_test.go.html#7149528">waitCh</a></span>&nbsp;<span class="op" id="7152250">=</span>&nbsp;<span class="builtintype" id="7152252">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152258"><a href="/gostd/database/sql/fakedb_test.go.html#7151830">d</a></span><span class="op" id="7152259">.</span><span class="ident" id="7152260"><a href="/gostd/database/sql/fakedb_test.go.html#7149554">waitingCh</a></span>&nbsp;<span class="op" id="7152270">=</span>&nbsp;<span class="builtintype" id="7152272">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152280">return</span>&nbsp;<span class="ident" id="7152287"><a href="/gostd/database/sql/fakedb_test.go.html#7152081">conn</a></span><span class="op" id="7152291">,</span>&nbsp;<span class="builtintype" id="7152293">nil</span><br>
<span class="lineno"></span><span class="op" id="7152297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152300">func</span>&nbsp;<span class="op" id="7152305">(</span><span class="ident" id="7152306">d</span>&nbsp;<span class="op" id="7152308">*</span><span class="ident" id="7152309"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7152319">)</span>&nbsp;<span class="ident" id="7152321">getDB</span><span class="op" id="7152326">(</span><span class="ident" id="7152327">name</span>&nbsp;<span class="builtintype" id="7152332">string</span><span class="op" id="7152338">)</span>&nbsp;<span class="op" id="7152340">*</span><span class="ident" id="7152341"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span>&nbsp;<span class="op" id="7152348">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152351"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152352">.</span><span class="ident" id="7152353"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7152355">.</span><span class="ident" id="7152356"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7152360">(</span><span class="op" id="7152361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152364">defer</span>&nbsp;<span class="ident" id="7152370"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152371">.</span><span class="ident" id="7152372"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7152374">.</span><span class="ident" id="7152375"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7152381">(</span><span class="op" id="7152382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152385">if</span>&nbsp;<span class="ident" id="7152388"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152389">.</span><span class="ident" id="7152390"><a href="/gostd/database/sql/fakedb_test.go.html#7149580">dbs</a></span>&nbsp;<span class="op" id="7152394">==</span>&nbsp;<span class="builtintype" id="7152397">nil</span>&nbsp;<span class="op" id="7152401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152405"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152406">.</span><span class="ident" id="7152407"><a href="/gostd/database/sql/fakedb_test.go.html#7149580">dbs</a></span>&nbsp;<span class="op" id="7152411">=</span>&nbsp;<span class="builtinfunc" id="7152413">make</span><span class="op" id="7152417">(</span><span class="keyword" id="7152418">map</span><span class="op" id="7152421">[</span><span class="builtintype" id="7152422">string</span><span class="op" id="7152428">]</span><span class="op" id="7152429">*</span><span class="ident" id="7152430"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7152436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152439">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152442">db</span><span class="op" id="7152444">,</span>&nbsp;<span class="ident" id="7152446">ok</span>&nbsp;<span class="op" id="7152449">:=</span>&nbsp;<span class="ident" id="7152452"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152453">.</span><span class="ident" id="7152454"><a href="/gostd/database/sql/fakedb_test.go.html#7149580">dbs</a></span><span class="op" id="7152457">[</span><span class="ident" id="7152458"><a href="/gostd/database/sql/fakedb_test.go.html#7152327">name</a></span><span class="op" id="7152462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152465">if</span>&nbsp;<span class="op" id="7152468">!</span><span class="ident" id="7152469"><a href="/gostd/database/sql/fakedb_test.go.html#7152446">ok</a></span>&nbsp;<span class="op" id="7152472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152476"><a href="/gostd/database/sql/fakedb_test.go.html#7152442">db</a></span>&nbsp;<span class="op" id="7152479">=</span>&nbsp;<span class="op" id="7152481">&amp;</span><span class="ident" id="7152482"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7152488">{</span><span class="ident" id="7152489"><a href="/gostd/database/sql/fakedb_test.go.html#7149635">name</a></span><span class="op" id="7152493">:</span>&nbsp;<span class="ident" id="7152495"><a href="/gostd/database/sql/fakedb_test.go.html#7152327">name</a></span><span class="op" id="7152499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152503"><a href="/gostd/database/sql/fakedb_test.go.html#7152306">d</a></span><span class="op" id="7152504">.</span><span class="ident" id="7152505"><a href="/gostd/database/sql/fakedb_test.go.html#7149580">dbs</a></span><span class="op" id="7152508">[</span><span class="ident" id="7152509"><a href="/gostd/database/sql/fakedb_test.go.html#7152327">name</a></span><span class="op" id="7152513">]</span>&nbsp;<span class="op" id="7152515">=</span>&nbsp;<span class="ident" id="7152517"><a href="/gostd/database/sql/fakedb_test.go.html#7152442">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152521">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152524">return</span>&nbsp;<span class="ident" id="7152531"><a href="/gostd/database/sql/fakedb_test.go.html#7152442">db</a></span><br>
<span class="lineno"></span><span class="op" id="7152534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152537">func</span>&nbsp;<span class="op" id="7152542">(</span><span class="ident" id="7152543">db</span>&nbsp;<span class="op" id="7152546">*</span><span class="ident" id="7152547"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7152553">)</span>&nbsp;<span class="ident" id="7152555">wipe</span><span class="op" id="7152559">(</span><span class="op" id="7152560">)</span>&nbsp;<span class="op" id="7152562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152565"><a href="/gostd/database/sql/fakedb_test.go.html#7152543">db</a></span><span class="op" id="7152567">.</span><span class="ident" id="7152568"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7152570">.</span><span class="ident" id="7152571"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7152575">(</span><span class="op" id="7152576">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152579">defer</span>&nbsp;<span class="ident" id="7152585"><a href="/gostd/database/sql/fakedb_test.go.html#7152543">db</a></span><span class="op" id="7152587">.</span><span class="ident" id="7152588"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7152590">.</span><span class="ident" id="7152591"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7152597">(</span><span class="op" id="7152598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152601"><a href="/gostd/database/sql/fakedb_test.go.html#7152543">db</a></span><span class="op" id="7152603">.</span><span class="ident" id="7152604"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span>&nbsp;<span class="op" id="7152611">=</span>&nbsp;<span class="builtintype" id="7152613">nil</span><br>
<span class="lineno"></span><span class="op" id="7152617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7152620">func</span>&nbsp;<span class="op" id="7152625">(</span><span class="ident" id="7152626">db</span>&nbsp;<span class="op" id="7152629">*</span><span class="ident" id="7152630"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7152636">)</span>&nbsp;<span class="ident" id="7152638">createTable</span><span class="op" id="7152649">(</span><span class="ident" id="7152650">name</span>&nbsp;<span class="builtintype" id="7152655">string</span><span class="op" id="7152661">,</span>&nbsp;<span class="ident" id="7152663">columnNames</span><span class="op" id="7152674">,</span>&nbsp;<span class="ident" id="7152676">columnTypes</span>&nbsp;<span class="op" id="7152688">[</span><span class="op" id="7152689">]</span><span class="builtintype" id="7152690">string</span><span class="op" id="7152696">)</span>&nbsp;<span class="builtintype" id="7152698">error</span>&nbsp;<span class="op" id="7152704">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152707"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7152709">.</span><span class="ident" id="7152710"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7152712">.</span><span class="ident" id="7152713"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7152717">(</span><span class="op" id="7152718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152721">defer</span>&nbsp;<span class="ident" id="7152727"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7152729">.</span><span class="ident" id="7152730"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7152732">.</span><span class="ident" id="7152733"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7152739">(</span><span class="op" id="7152740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152743">if</span>&nbsp;<span class="ident" id="7152746"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7152748">.</span><span class="ident" id="7152749"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span>&nbsp;<span class="op" id="7152756">==</span>&nbsp;<span class="builtintype" id="7152759">nil</span>&nbsp;<span class="op" id="7152763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7152767"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7152769">.</span><span class="ident" id="7152770"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span>&nbsp;<span class="op" id="7152777">=</span>&nbsp;<span class="builtinfunc" id="7152779">make</span><span class="op" id="7152783">(</span><span class="keyword" id="7152784">map</span><span class="op" id="7152787">[</span><span class="builtintype" id="7152788">string</span><span class="op" id="7152794">]</span><span class="op" id="7152795">*</span><span class="ident" id="7152796"><a href="/gostd/database/sql/fakedb_test.go.html#7149738">table</a></span><span class="op" id="7152801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152804">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152807">if</span>&nbsp;<span class="ident" id="7152810">_</span><span class="op" id="7152811">,</span>&nbsp;<span class="ident" id="7152813">exist</span>&nbsp;<span class="op" id="7152819">:=</span>&nbsp;<span class="ident" id="7152822"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7152824">.</span><span class="ident" id="7152825"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span><span class="op" id="7152831">[</span><span class="ident" id="7152832"><a href="/gostd/database/sql/fakedb_test.go.html#7152650">name</a></span><span class="op" id="7152836">]</span><span class="op" id="7152837">;</span>&nbsp;<span class="ident" id="7152839"><a href="/gostd/database/sql/fakedb_test.go.html#7152813">exist</a></span>&nbsp;<span class="op" id="7152845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152849">return</span>&nbsp;<span class="ident" id="7152856"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7152859">.</span><span class="ident" id="7152860"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7152866">(</span><span class="string" id="7152867">&#34;table&nbsp;%q&nbsp;already&nbsp;exists&#34;</span><span class="op" id="7152892">,</span>&nbsp;<span class="ident" id="7152894"><a href="/gostd/database/sql/fakedb_test.go.html#7152650">name</a></span><span class="op" id="7152898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7152901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152904">if</span>&nbsp;<span class="builtinfunc" id="7152907">len</span><span class="op" id="7152910">(</span><span class="ident" id="7152911"><a href="/gostd/database/sql/fakedb_test.go.html#7152663">columnNames</a></span><span class="op" id="7152922">)</span>&nbsp;<span class="op" id="7152924">!=</span>&nbsp;<span class="builtinfunc" id="7152927">len</span><span class="op" id="7152930">(</span><span class="ident" id="7152931"><a href="/gostd/database/sql/fakedb_test.go.html#7152676">columnTypes</a></span><span class="op" id="7152942">)</span>&nbsp;<span class="op" id="7152944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7152948">return</span>&nbsp;<span class="ident" id="7152955"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7152958">.</span><span class="ident" id="7152959"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7152965">(</span><span class="string" id="7152966">&#34;create&nbsp;table&nbsp;of&nbsp;%q&nbsp;len(names)&nbsp;!=&nbsp;len(types):&nbsp;%d&nbsp;vs&nbsp;%d&#34;</span><span class="op" id="7153021">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153026"><a href="/gostd/database/sql/fakedb_test.go.html#7152650">name</a></span><span class="op" id="7153030">,</span>&nbsp;<span class="builtinfunc" id="7153032">len</span><span class="op" id="7153035">(</span><span class="ident" id="7153036"><a href="/gostd/database/sql/fakedb_test.go.html#7152663">columnNames</a></span><span class="op" id="7153047">)</span><span class="op" id="7153048">,</span>&nbsp;<span class="builtinfunc" id="7153050">len</span><span class="op" id="7153053">(</span><span class="ident" id="7153054"><a href="/gostd/database/sql/fakedb_test.go.html#7152676">columnTypes</a></span><span class="op" id="7153065">)</span><span class="op" id="7153066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153072"><a href="/gostd/database/sql/fakedb_test.go.html#7152626">db</a></span><span class="op" id="7153074">.</span><span class="ident" id="7153075"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span><span class="op" id="7153081">[</span><span class="ident" id="7153082"><a href="/gostd/database/sql/fakedb_test.go.html#7152650">name</a></span><span class="op" id="7153086">]</span>&nbsp;<span class="op" id="7153088">=</span>&nbsp;<span class="op" id="7153090">&amp;</span><span class="ident" id="7153091"><a href="/gostd/database/sql/fakedb_test.go.html#7149738">table</a></span><span class="op" id="7153096">{</span><span class="ident" id="7153097"><a href="/gostd/database/sql/fakedb_test.go.html#7149774">colname</a></span><span class="op" id="7153104">:</span>&nbsp;<span class="ident" id="7153106"><a href="/gostd/database/sql/fakedb_test.go.html#7152663">columnNames</a></span><span class="op" id="7153117">,</span>&nbsp;<span class="ident" id="7153119"><a href="/gostd/database/sql/fakedb_test.go.html#7149792">coltype</a></span><span class="op" id="7153126">:</span>&nbsp;<span class="ident" id="7153128"><a href="/gostd/database/sql/fakedb_test.go.html#7152676">columnTypes</a></span><span class="op" id="7153139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153142">return</span>&nbsp;<span class="builtintype" id="7153149">nil</span><br>
<span class="lineno"></span><span class="op" id="7153153">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="7153156">//&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;db.mu&nbsp;lock&nbsp;held</span><br>
<span class="lineno"></span><span class="keyword" id="7153195">func</span>&nbsp;<span class="op" id="7153200">(</span><span class="ident" id="7153201">db</span>&nbsp;<span class="op" id="7153204">*</span><span class="ident" id="7153205"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7153211">)</span>&nbsp;<span class="ident" id="7153213">table</span><span class="op" id="7153218">(</span><span class="ident" id="7153219">table</span>&nbsp;<span class="builtintype" id="7153225">string</span><span class="op" id="7153231">)</span>&nbsp;<span class="op" id="7153233">(</span><span class="op" id="7153234">*</span><span class="ident" id="7153235"><a href="/gostd/database/sql/fakedb_test.go.html#7149738">table</a></span><span class="op" id="7153240">,</span>&nbsp;<span class="builtintype" id="7153242">bool</span><span class="op" id="7153246">)</span>&nbsp;<span class="op" id="7153248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153251">if</span>&nbsp;<span class="ident" id="7153254"><a href="/gostd/database/sql/fakedb_test.go.html#7153201">db</a></span><span class="op" id="7153256">.</span><span class="ident" id="7153257"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span>&nbsp;<span class="op" id="7153264">==</span>&nbsp;<span class="builtintype" id="7153267">nil</span>&nbsp;<span class="op" id="7153271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153275">return</span>&nbsp;<span class="builtintype" id="7153282">nil</span><span class="op" id="7153285">,</span>&nbsp;<span class="builtintype" id="7153287">false</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153297">t</span><span class="op" id="7153298">,</span>&nbsp;<span class="ident" id="7153300">ok</span>&nbsp;<span class="op" id="7153303">:=</span>&nbsp;<span class="ident" id="7153306"><a href="/gostd/database/sql/fakedb_test.go.html#7153201">db</a></span><span class="op" id="7153308">.</span><span class="ident" id="7153309"><a href="/gostd/database/sql/fakedb_test.go.html#7149690">tables</a></span><span class="op" id="7153315">[</span><span class="ident" id="7153316"><a href="/gostd/database/sql/fakedb_test.go.html#7153219">table</a></span><span class="op" id="7153321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153324">return</span>&nbsp;<span class="ident" id="7153331"><a href="/gostd/database/sql/fakedb_test.go.html#7153297">t</a></span><span class="op" id="7153332">,</span>&nbsp;<span class="ident" id="7153334"><a href="/gostd/database/sql/fakedb_test.go.html#7153300">ok</a></span><br>
<span class="lineno"></span><span class="op" id="7153337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7153340">func</span>&nbsp;<span class="op" id="7153345">(</span><span class="ident" id="7153346">db</span>&nbsp;<span class="op" id="7153349">*</span><span class="ident" id="7153350"><a href="/gostd/database/sql/fakedb_test.go.html#7149618">fakeDB</a></span><span class="op" id="7153356">)</span>&nbsp;<span class="ident" id="7153358">columnType</span><span class="op" id="7153368">(</span><span class="ident" id="7153369">table</span><span class="op" id="7153374">,</span>&nbsp;<span class="ident" id="7153376">column</span>&nbsp;<span class="builtintype" id="7153383">string</span><span class="op" id="7153389">)</span>&nbsp;<span class="op" id="7153391">(</span><span class="ident" id="7153392">typ</span>&nbsp;<span class="builtintype" id="7153396">string</span><span class="op" id="7153402">,</span>&nbsp;<span class="ident" id="7153404">ok</span>&nbsp;<span class="builtintype" id="7153407">bool</span><span class="op" id="7153411">)</span>&nbsp;<span class="op" id="7153413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153416"><a href="/gostd/database/sql/fakedb_test.go.html#7153346">db</a></span><span class="op" id="7153418">.</span><span class="ident" id="7153419"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7153421">.</span><span class="ident" id="7153422"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7153426">(</span><span class="op" id="7153427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153430">defer</span>&nbsp;<span class="ident" id="7153436"><a href="/gostd/database/sql/fakedb_test.go.html#7153346">db</a></span><span class="op" id="7153438">.</span><span class="ident" id="7153439"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7153441">.</span><span class="ident" id="7153442"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7153448">(</span><span class="op" id="7153449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153452">t</span><span class="op" id="7153453">,</span>&nbsp;<span class="ident" id="7153455"><a href="/gostd/database/sql/fakedb_test.go.html#7153404">ok</a></span>&nbsp;<span class="op" id="7153458">:=</span>&nbsp;<span class="ident" id="7153461"><a href="/gostd/database/sql/fakedb_test.go.html#7153346">db</a></span><span class="op" id="7153463">.</span><span class="ident" id="7153464"><a href="/gostd/database/sql/fakedb_test.go.html#7153213">table</a></span><span class="op" id="7153469">(</span><span class="ident" id="7153470"><a href="/gostd/database/sql/fakedb_test.go.html#7153369">table</a></span><span class="op" id="7153475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153478">if</span>&nbsp;<span class="op" id="7153481">!</span><span class="ident" id="7153482"><a href="/gostd/database/sql/fakedb_test.go.html#7153404">ok</a></span>&nbsp;<span class="op" id="7153485">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153489">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153500">for</span>&nbsp;<span class="ident" id="7153504">n</span><span class="op" id="7153505">,</span>&nbsp;<span class="ident" id="7153507">cname</span>&nbsp;<span class="op" id="7153513">:=</span>&nbsp;<span class="keyword" id="7153516">range</span>&nbsp;<span class="ident" id="7153522"><a href="/gostd/database/sql/fakedb_test.go.html#7153452">t</a></span><span class="op" id="7153523">.</span><span class="ident" id="7153524"><a href="/gostd/database/sql/fakedb_test.go.html#7149774">colname</a></span>&nbsp;<span class="op" id="7153532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153536">if</span>&nbsp;<span class="ident" id="7153539"><a href="/gostd/database/sql/fakedb_test.go.html#7153507">cname</a></span>&nbsp;<span class="op" id="7153545">==</span>&nbsp;<span class="ident" id="7153548"><a href="/gostd/database/sql/fakedb_test.go.html#7153376">column</a></span>&nbsp;<span class="op" id="7153555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153560">return</span>&nbsp;<span class="ident" id="7153567"><a href="/gostd/database/sql/fakedb_test.go.html#7153452">t</a></span><span class="op" id="7153568">.</span><span class="ident" id="7153569"><a href="/gostd/database/sql/fakedb_test.go.html#7149792">coltype</a></span><span class="op" id="7153576">[</span><span class="ident" id="7153577"><a href="/gostd/database/sql/fakedb_test.go.html#7153504">n</a></span><span class="op" id="7153578">]</span><span class="op" id="7153579">,</span>&nbsp;<span class="builtintype" id="7153581">true</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153594">return</span>&nbsp;<span class="string" id="7153601">&#34;&#34;</span><span class="op" id="7153603">,</span>&nbsp;<span class="builtintype" id="7153605">false</span><br>
<span class="lineno"></span><span class="op" id="7153611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="7153614">func</span>&nbsp;<span class="op" id="7153619">(</span><span class="ident" id="7153620">c</span>&nbsp;<span class="op" id="7153622">*</span><span class="ident" id="7153623"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7153631">)</span>&nbsp;<span class="ident" id="7153633">isBad</span><span class="op" id="7153638">(</span><span class="op" id="7153639">)</span>&nbsp;<span class="builtintype" id="7153641">bool</span>&nbsp;<span class="op" id="7153646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7153649">//&nbsp;if&nbsp;not&nbsp;simulating&nbsp;bad&nbsp;conn,&nbsp;do&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153692">if</span>&nbsp;<span class="op" id="7153695">!</span><span class="ident" id="7153696"><a href="/gostd/database/sql/fakedb_test.go.html#7153620">c</a></span><span class="op" id="7153697">.</span><span class="ident" id="7153698"><a href="/gostd/database/sql/fakedb_test.go.html#7150363">bad</a></span>&nbsp;<span class="op" id="7153702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153706">return</span>&nbsp;<span class="builtintype" id="7153713">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153720">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7153723">//&nbsp;alternate&nbsp;between&nbsp;bad&nbsp;conn&nbsp;and&nbsp;not&nbsp;bad&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7153771"><a href="/gostd/database/sql/fakedb_test.go.html#7153620">c</a></span><span class="op" id="7153772">.</span><span class="ident" id="7153773"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7153775">.</span><span class="ident" id="7153776"><a href="/gostd/database/sql/fakedb_test.go.html#7149717">badConn</a></span>&nbsp;<span class="op" id="7153784">=</span>&nbsp;<span class="op" id="7153786">!</span><span class="ident" id="7153787"><a href="/gostd/database/sql/fakedb_test.go.html#7153620">c</a></span><span class="op" id="7153788">.</span><span class="ident" id="7153789"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7153791">.</span><span class="ident" id="7153792"><a href="/gostd/database/sql/fakedb_test.go.html#7149717">badConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153801">return</span>&nbsp;<span class="ident" id="7153808"><a href="/gostd/database/sql/fakedb_test.go.html#7153620">c</a></span><span class="op" id="7153809">.</span><span class="ident" id="7153810"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7153812">.</span><span class="ident" id="7153813"><a href="/gostd/database/sql/fakedb_test.go.html#7149717">badConn</a></span><br>
<span class="lineno"></span><span class="op" id="7153821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7153824">func</span>&nbsp;<span class="op" id="7153829">(</span><span class="ident" id="7153830">c</span>&nbsp;<span class="op" id="7153832">*</span><span class="ident" id="7153833"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7153841">)</span>&nbsp;<span class="ident" id="7153843">Begin</span><span class="op" id="7153848">(</span><span class="op" id="7153849">)</span>&nbsp;<span class="op" id="7153851">(</span><span class="ident" id="7153852"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7153858">.</span><span class="ident" id="7153859"><a href="/gostd/database/sql/driver/driver.go.html#5253371">Tx</a></span><span class="op" id="7153861">,</span>&nbsp;<span class="builtintype" id="7153863">error</span><span class="op" id="7153868">)</span>&nbsp;<span class="op" id="7153870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153873">if</span>&nbsp;<span class="ident" id="7153876"><a href="/gostd/database/sql/fakedb_test.go.html#7153830">c</a></span><span class="op" id="7153877">.</span><span class="ident" id="7153878"><a href="/gostd/database/sql/fakedb_test.go.html#7153633">isBad</a></span><span class="op" id="7153883">(</span><span class="op" id="7153884">)</span>&nbsp;<span class="op" id="7153886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153890">return</span>&nbsp;<span class="builtintype" id="7153897">nil</span><span class="op" id="7153900">,</span>&nbsp;<span class="ident" id="7153902"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7153908">.</span><span class="ident" id="7153909"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153924">if</span>&nbsp;<span class="ident" id="7153927"><a href="/gostd/database/sql/fakedb_test.go.html#7153830">c</a></span><span class="op" id="7153928">.</span><span class="ident" id="7153929"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span>&nbsp;<span class="op" id="7153936">!=</span>&nbsp;<span class="builtintype" id="7153939">nil</span>&nbsp;<span class="op" id="7153943">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7153947">return</span>&nbsp;<span class="builtintype" id="7153954">nil</span><span class="op" id="7153957">,</span>&nbsp;<span class="ident" id="7153959"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7153965">.</span><span class="ident" id="7153966"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7153969">(</span><span class="string" id="7153970">&#34;already&nbsp;in&nbsp;a&nbsp;transaction&#34;</span><span class="op" id="7153996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7153999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154002"><a href="/gostd/database/sql/fakedb_test.go.html#7153830">c</a></span><span class="op" id="7154003">.</span><span class="ident" id="7154004"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span>&nbsp;<span class="op" id="7154011">=</span>&nbsp;<span class="op" id="7154013">&amp;</span><span class="ident" id="7154014"><a href="/gostd/database/sql/fakedb_test.go.html#7150463">fakeTx</a></span><span class="op" id="7154020">{</span><span class="ident" id="7154021"><a href="/gostd/database/sql/fakedb_test.go.html#7150480">c</a></span><span class="op" id="7154022">:</span>&nbsp;<span class="ident" id="7154024"><a href="/gostd/database/sql/fakedb_test.go.html#7153830">c</a></span><span class="op" id="7154025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154028">return</span>&nbsp;<span class="ident" id="7154035"><a href="/gostd/database/sql/fakedb_test.go.html#7153830">c</a></span><span class="op" id="7154036">.</span><span class="ident" id="7154037"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span><span class="op" id="7154043">,</span>&nbsp;<span class="builtintype" id="7154045">nil</span><br>
<span class="lineno"></span><span class="op" id="7154049">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7154052">var</span>&nbsp;<span class="ident" id="7154056">hookPostCloseConn</span>&nbsp;<span class="keyword" id="7154074">struct</span>&nbsp;<span class="op" id="7154081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154084"><a href="/gostd/database/sql/fakedb_test.go.html#7148702">sync</a></span><span class="op" id="7154088">.</span><span class="ident" id="7154089"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154096">fn</span>&nbsp;<span class="keyword" id="7154099">func</span><span class="op" id="7154103">(</span><span class="op" id="7154104">*</span><span class="ident" id="7154105"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7154113">,</span>&nbsp;<span class="builtintype" id="7154115">error</span><span class="op" id="7154120">)</span><br>
<span class="lineno"></span><span class="op" id="7154122">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7154125">func</span>&nbsp;<span class="ident" id="7154130">setHookpostCloseConn</span><span class="op" id="7154150">(</span><span class="ident" id="7154151">fn</span>&nbsp;<span class="keyword" id="7154154">func</span><span class="op" id="7154158">(</span><span class="op" id="7154159">*</span><span class="ident" id="7154160"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7154168">,</span>&nbsp;<span class="builtintype" id="7154170">error</span><span class="op" id="7154175">)</span><span class="op" id="7154176">)</span>&nbsp;<span class="op" id="7154178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154181"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154198">.</span><span class="ident" id="7154199"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7154203">(</span><span class="op" id="7154204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154207">defer</span>&nbsp;<span class="ident" id="7154213"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154230">.</span><span class="ident" id="7154231"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7154237">(</span><span class="op" id="7154238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154241"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154258">.</span><span class="ident" id="7154259"><a href="/gostd/database/sql/fakedb_test.go.html#7154096">fn</a></span>&nbsp;<span class="op" id="7154262">=</span>&nbsp;<span class="ident" id="7154264"><a href="/gostd/database/sql/fakedb_test.go.html#7154151">fn</a></span><br>
<span class="lineno">275</span><span class="op" id="7154267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7154270">var</span>&nbsp;<span class="ident" id="7154274">testStrictClose</span>&nbsp;<span class="op" id="7154290">*</span><span class="ident" id="7154291"><a href="/gostd/database/sql/fakedb_test.go.html#7148710">testing</a></span><span class="op" id="7154298">.</span><span class="ident" id="7154299"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7154302">//&nbsp;setStrictFakeConnClose&nbsp;sets&nbsp;the&nbsp;t&nbsp;to&nbsp;Errorf&nbsp;on&nbsp;when&nbsp;fakeConn.Close</span><br>
<span class="lineno">280</span><span class="comment" id="7154372">//&nbsp;fails&nbsp;to&nbsp;close.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;check&nbsp;is&nbsp;disabled.</span><br>
<span class="lineno"></span><span class="keyword" id="7154422">func</span>&nbsp;<span class="ident" id="7154427">setStrictFakeConnClose</span><span class="op" id="7154449">(</span><span class="ident" id="7154450">t</span>&nbsp;<span class="op" id="7154452">*</span><span class="ident" id="7154453"><a href="/gostd/database/sql/fakedb_test.go.html#7148710">testing</a></span><span class="op" id="7154460">.</span><span class="ident" id="7154461"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="7154462">)</span>&nbsp;<span class="op" id="7154464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154467"><a href="/gostd/database/sql/fakedb_test.go.html#7154274">testStrictClose</a></span>&nbsp;<span class="op" id="7154483">=</span>&nbsp;<span class="ident" id="7154485"><a href="/gostd/database/sql/fakedb_test.go.html#7154450">t</a></span><br>
<span class="lineno"></span><span class="op" id="7154487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="7154490">func</span>&nbsp;<span class="op" id="7154495">(</span><span class="ident" id="7154496">c</span>&nbsp;<span class="op" id="7154498">*</span><span class="ident" id="7154499"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7154507">)</span>&nbsp;<span class="ident" id="7154509">Close</span><span class="op" id="7154514">(</span><span class="op" id="7154515">)</span>&nbsp;<span class="op" id="7154517">(</span><span class="ident" id="7154518">err</span>&nbsp;<span class="builtintype" id="7154522">error</span><span class="op" id="7154527">)</span>&nbsp;<span class="op" id="7154529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154532">drv</span>&nbsp;<span class="op" id="7154536">:=</span>&nbsp;<span class="ident" id="7154539"><a href="/gostd/database/sql/fakedb_test.go.html#7151024">fdriver</a></span><span class="op" id="7154546">.</span><span class="op" id="7154547">(</span><span class="op" id="7154548">*</span><span class="ident" id="7154549"><a href="/gostd/database/sql/fakedb_test.go.html#7149380">fakeDriver</a></span><span class="op" id="7154559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154562">defer</span>&nbsp;<span class="keyword" id="7154568">func</span><span class="op" id="7154572">(</span><span class="op" id="7154573">)</span>&nbsp;<span class="op" id="7154575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154579">if</span>&nbsp;<span class="ident" id="7154582"><a href="/gostd/database/sql/fakedb_test.go.html#7154518">err</a></span>&nbsp;<span class="op" id="7154586">!=</span>&nbsp;<span class="builtintype" id="7154589">nil</span>&nbsp;<span class="op" id="7154593">&amp;&amp;</span>&nbsp;<span class="ident" id="7154596"><a href="/gostd/database/sql/fakedb_test.go.html#7154274">testStrictClose</a></span>&nbsp;<span class="op" id="7154612">!=</span>&nbsp;<span class="builtintype" id="7154615">nil</span>&nbsp;<span class="op" id="7154619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154624"><a href="/gostd/database/sql/fakedb_test.go.html#7154274">testStrictClose</a></span><span class="op" id="7154639">.</span><span class="ident" id="7154640"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="7154646">(</span><span class="string" id="7154647">&#34;failed&nbsp;to&nbsp;close&nbsp;a&nbsp;test&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7154684">,</span>&nbsp;<span class="ident" id="7154686"><a href="/gostd/database/sql/fakedb_test.go.html#7154518">err</a></span><span class="op" id="7154689">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154697"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154714">.</span><span class="ident" id="7154715"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7154719">(</span><span class="op" id="7154720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154724">fn</span>&nbsp;<span class="op" id="7154727">:=</span>&nbsp;<span class="ident" id="7154730"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154747">.</span><span class="ident" id="7154748"><a href="/gostd/database/sql/fakedb_test.go.html#7154096">fn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154753"><a href="/gostd/database/sql/fakedb_test.go.html#7154056">hookPostCloseConn</a></span><span class="op" id="7154770">.</span><span class="ident" id="7154771"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7154777">(</span><span class="op" id="7154778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154782">if</span>&nbsp;<span class="ident" id="7154785"><a href="/gostd/database/sql/fakedb_test.go.html#7154724">fn</a></span>&nbsp;<span class="op" id="7154788">!=</span>&nbsp;<span class="builtintype" id="7154791">nil</span>&nbsp;<span class="op" id="7154795">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154800"><a href="/gostd/database/sql/fakedb_test.go.html#7154724">fn</a></span><span class="op" id="7154802">(</span><span class="ident" id="7154803"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7154804">,</span>&nbsp;<span class="ident" id="7154806"><a href="/gostd/database/sql/fakedb_test.go.html#7154518">err</a></span><span class="op" id="7154809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154817">if</span>&nbsp;<span class="ident" id="7154820"><a href="/gostd/database/sql/fakedb_test.go.html#7154518">err</a></span>&nbsp;<span class="op" id="7154824">==</span>&nbsp;<span class="builtintype" id="7154827">nil</span>&nbsp;<span class="op" id="7154831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154836"><a href="/gostd/database/sql/fakedb_test.go.html#7154532">drv</a></span><span class="op" id="7154839">.</span><span class="ident" id="7154840"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7154842">.</span><span class="ident" id="7154843"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7154847">(</span><span class="op" id="7154848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154853"><a href="/gostd/database/sql/fakedb_test.go.html#7154532">drv</a></span><span class="op" id="7154856">.</span><span class="ident" id="7154857"><a href="/gostd/database/sql/fakedb_test.go.html#7149490">closeCount</a></span><span class="op" id="7154867">++</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7154873"><a href="/gostd/database/sql/fakedb_test.go.html#7154532">drv</a></span><span class="op" id="7154876">.</span><span class="ident" id="7154877"><a href="/gostd/database/sql/fakedb_test.go.html#7149401">mu</a></span><span class="op" id="7154879">.</span><span class="ident" id="7154880"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7154886">(</span><span class="op" id="7154887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154894">}</span><span class="op" id="7154895">(</span><span class="op" id="7154896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154899">if</span>&nbsp;<span class="ident" id="7154902"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7154903">.</span><span class="ident" id="7154904"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span>&nbsp;<span class="op" id="7154911">!=</span>&nbsp;<span class="builtintype" id="7154914">nil</span>&nbsp;<span class="op" id="7154918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154922">return</span>&nbsp;<span class="ident" id="7154929"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7154935">.</span><span class="ident" id="7154936"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7154939">(</span><span class="string" id="7154940">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;in&nbsp;a&nbsp;Transaction&#34;</span><span class="op" id="7154980">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7154983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7154986">if</span>&nbsp;<span class="ident" id="7154989"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7154990">.</span><span class="ident" id="7154991"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span>&nbsp;<span class="op" id="7154994">==</span>&nbsp;<span class="builtintype" id="7154997">nil</span>&nbsp;<span class="op" id="7155001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155005">return</span>&nbsp;<span class="ident" id="7155012"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7155018">.</span><span class="ident" id="7155019"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7155022">(</span><span class="string" id="7155023">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;already&nbsp;closed&#34;</span><span class="op" id="7155061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155067">if</span>&nbsp;<span class="ident" id="7155070"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7155071">.</span><span class="ident" id="7155072"><a href="/gostd/database/sql/fakedb_test.go.html#7150312">stmtsMade</a></span>&nbsp;<span class="op" id="7155082">&gt;</span>&nbsp;<span class="ident" id="7155084"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7155085">.</span><span class="ident" id="7155086"><a href="/gostd/database/sql/fakedb_test.go.html#7150329">stmtsClosed</a></span>&nbsp;<span class="op" id="7155098">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155102">return</span>&nbsp;<span class="ident" id="7155109"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7155115">.</span><span class="ident" id="7155116"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7155119">(</span><span class="string" id="7155120">&#34;can&#39;t&nbsp;close;&nbsp;dangling&nbsp;statement(s)&#34;</span><span class="op" id="7155156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155162"><a href="/gostd/database/sql/fakedb_test.go.html#7154496">c</a></span><span class="op" id="7155163">.</span><span class="ident" id="7155164"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span>&nbsp;<span class="op" id="7155167">=</span>&nbsp;<span class="builtintype" id="7155169">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155174">return</span>&nbsp;<span class="builtintype" id="7155181">nil</span><br>
<span class="lineno"></span><span class="op" id="7155185">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7155188">func</span>&nbsp;<span class="ident" id="7155193">checkSubsetTypes</span><span class="op" id="7155209">(</span><span class="ident" id="7155210">args</span>&nbsp;<span class="op" id="7155215">[</span><span class="op" id="7155216">]</span><span class="ident" id="7155217"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155223">.</span><span class="ident" id="7155224"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7155229">)</span>&nbsp;<span class="builtintype" id="7155231">error</span>&nbsp;<span class="op" id="7155237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155240">for</span>&nbsp;<span class="ident" id="7155244">n</span><span class="op" id="7155245">,</span>&nbsp;<span class="ident" id="7155247">arg</span>&nbsp;<span class="op" id="7155251">:=</span>&nbsp;<span class="keyword" id="7155254">range</span>&nbsp;<span class="ident" id="7155260"><a href="/gostd/database/sql/fakedb_test.go.html#7155210">args</a></span>&nbsp;<span class="op" id="7155265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155269">switch</span>&nbsp;<span class="ident" id="7155276"><a href="/gostd/database/sql/fakedb_test.go.html#7155247">arg</a></span><span class="op" id="7155279">.</span><span class="op" id="7155280">(</span><span class="keyword" id="7155281">type</span><span class="op" id="7155285">)</span>&nbsp;<span class="op" id="7155287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155291">case</span>&nbsp;<span class="builtintype" id="7155296">int64</span><span class="op" id="7155301">,</span>&nbsp;<span class="builtintype" id="7155303">float64</span><span class="op" id="7155310">,</span>&nbsp;<span class="builtintype" id="7155312">bool</span><span class="op" id="7155316">,</span>&nbsp;<span class="builtintype" id="7155318">nil</span><span class="op" id="7155321">,</span>&nbsp;<span class="op" id="7155323">[</span><span class="op" id="7155324">]</span><span class="builtintype" id="7155325">byte</span><span class="op" id="7155329">,</span>&nbsp;<span class="builtintype" id="7155331">string</span><span class="op" id="7155337">,</span>&nbsp;<span class="ident" id="7155339"><a href="/gostd/database/sql/fakedb_test.go.html#7148721">time</a></span><span class="op" id="7155343">.</span><span class="ident" id="7155344"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="7155348">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155352">default</span><span class="op" id="7155359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155364">return</span>&nbsp;<span class="ident" id="7155371"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7155374">.</span><span class="ident" id="7155375"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7155381">(</span><span class="string" id="7155382">&#34;fakedb_test:&nbsp;invalid&nbsp;argument&nbsp;#%d:&nbsp;%v,&nbsp;type&nbsp;%T&#34;</span><span class="op" id="7155430">,</span>&nbsp;<span class="ident" id="7155432"><a href="/gostd/database/sql/fakedb_test.go.html#7155244">n</a></span><span class="op" id="7155433">+</span><span class="num" id="7155434">1</span><span class="op" id="7155435">,</span>&nbsp;<span class="ident" id="7155437"><a href="/gostd/database/sql/fakedb_test.go.html#7155247">arg</a></span><span class="op" id="7155440">,</span>&nbsp;<span class="ident" id="7155442"><a href="/gostd/database/sql/fakedb_test.go.html#7155247">arg</a></span><span class="op" id="7155445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155455">return</span>&nbsp;<span class="builtintype" id="7155462">nil</span><br>
<span class="lineno">325</span><span class="op" id="7155466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155469">func</span>&nbsp;<span class="op" id="7155474">(</span><span class="ident" id="7155475">c</span>&nbsp;<span class="op" id="7155477">*</span><span class="ident" id="7155478"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7155486">)</span>&nbsp;<span class="ident" id="7155488">Exec</span><span class="op" id="7155492">(</span><span class="ident" id="7155493">query</span>&nbsp;<span class="builtintype" id="7155499">string</span><span class="op" id="7155505">,</span>&nbsp;<span class="ident" id="7155507">args</span>&nbsp;<span class="op" id="7155512">[</span><span class="op" id="7155513">]</span><span class="ident" id="7155514"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155520">.</span><span class="ident" id="7155521"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7155526">)</span>&nbsp;<span class="op" id="7155528">(</span><span class="ident" id="7155529"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155535">.</span><span class="ident" id="7155536"><a href="/gostd/database/sql/driver/driver.go.html#5250891">Result</a></span><span class="op" id="7155542">,</span>&nbsp;<span class="builtintype" id="7155544">error</span><span class="op" id="7155549">)</span>&nbsp;<span class="op" id="7155551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155554">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155615">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155676">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155735">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7155762">err</span>&nbsp;<span class="op" id="7155766">:=</span>&nbsp;<span class="ident" id="7155769"><a href="/gostd/database/sql/fakedb_test.go.html#7155193">checkSubsetTypes</a></span><span class="op" id="7155785">(</span><span class="ident" id="7155786"><a href="/gostd/database/sql/fakedb_test.go.html#7155507">args</a></span><span class="op" id="7155790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155793">if</span>&nbsp;<span class="ident" id="7155796"><a href="/gostd/database/sql/fakedb_test.go.html#7155762">err</a></span>&nbsp;<span class="op" id="7155800">!=</span>&nbsp;<span class="builtintype" id="7155803">nil</span>&nbsp;<span class="op" id="7155807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155811">return</span>&nbsp;<span class="builtintype" id="7155818">nil</span><span class="op" id="7155821">,</span>&nbsp;<span class="ident" id="7155823"><a href="/gostd/database/sql/fakedb_test.go.html#7155762">err</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7155828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7155831">return</span>&nbsp;<span class="builtintype" id="7155838">nil</span><span class="op" id="7155841">,</span>&nbsp;<span class="ident" id="7155843"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155849">.</span><span class="ident" id="7155850"><a href="/gostd/database/sql/driver/driver.go.html#5248847">ErrSkip</a></span><br>
<span class="lineno"></span><span class="op" id="7155858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7155861">func</span>&nbsp;<span class="op" id="7155866">(</span><span class="ident" id="7155867">c</span>&nbsp;<span class="op" id="7155869">*</span><span class="ident" id="7155870"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7155878">)</span>&nbsp;<span class="ident" id="7155880">Query</span><span class="op" id="7155885">(</span><span class="ident" id="7155886">query</span>&nbsp;<span class="builtintype" id="7155892">string</span><span class="op" id="7155898">,</span>&nbsp;<span class="ident" id="7155900">args</span>&nbsp;<span class="op" id="7155905">[</span><span class="op" id="7155906">]</span><span class="ident" id="7155907"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155913">.</span><span class="ident" id="7155914"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7155919">)</span>&nbsp;<span class="op" id="7155921">(</span><span class="ident" id="7155922"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7155928">.</span><span class="ident" id="7155929"><a href="/gostd/database/sql/driver/driver.go.html#5252630">Rows</a></span><span class="op" id="7155933">,</span>&nbsp;<span class="builtintype" id="7155935">error</span><span class="op" id="7155940">)</span>&nbsp;<span class="op" id="7155942">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7155945">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156006">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156067">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7156126">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156153">err</span>&nbsp;<span class="op" id="7156157">:=</span>&nbsp;<span class="ident" id="7156160"><a href="/gostd/database/sql/fakedb_test.go.html#7155193">checkSubsetTypes</a></span><span class="op" id="7156176">(</span><span class="ident" id="7156177"><a href="/gostd/database/sql/fakedb_test.go.html#7155900">args</a></span><span class="op" id="7156181">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156184">if</span>&nbsp;<span class="ident" id="7156187"><a href="/gostd/database/sql/fakedb_test.go.html#7156153">err</a></span>&nbsp;<span class="op" id="7156191">!=</span>&nbsp;<span class="builtintype" id="7156194">nil</span>&nbsp;<span class="op" id="7156198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156202">return</span>&nbsp;<span class="builtintype" id="7156209">nil</span><span class="op" id="7156212">,</span>&nbsp;<span class="ident" id="7156214"><a href="/gostd/database/sql/fakedb_test.go.html#7156153">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156222">return</span>&nbsp;<span class="builtintype" id="7156229">nil</span><span class="op" id="7156232">,</span>&nbsp;<span class="ident" id="7156234"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7156240">.</span><span class="ident" id="7156241"><a href="/gostd/database/sql/driver/driver.go.html#5248847">ErrSkip</a></span><br>
<span class="lineno"></span><span class="op" id="7156249">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="7156252">func</span>&nbsp;<span class="ident" id="7156257">errf</span><span class="op" id="7156261">(</span><span class="ident" id="7156262">msg</span>&nbsp;<span class="builtintype" id="7156266">string</span><span class="op" id="7156272">,</span>&nbsp;<span class="ident" id="7156274">args</span>&nbsp;<span class="op" id="7156279">...</span><span class="keyword" id="7156282">interface</span><span class="op" id="7156291">{</span><span class="op" id="7156292">}</span><span class="op" id="7156293">)</span>&nbsp;<span class="builtintype" id="7156295">error</span>&nbsp;<span class="op" id="7156301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156304">return</span>&nbsp;<span class="ident" id="7156311"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7156317">.</span><span class="ident" id="7156318"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7156321">(</span><span class="string" id="7156322">&#34;fakedb:&nbsp;&#34;</span>&nbsp;<span class="op" id="7156333">+</span>&nbsp;<span class="ident" id="7156335"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7156338">.</span><span class="ident" id="7156339"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7156346">(</span><span class="ident" id="7156347"><a href="/gostd/database/sql/fakedb_test.go.html#7156262">msg</a></span><span class="op" id="7156350">,</span>&nbsp;<span class="ident" id="7156352"><a href="/gostd/database/sql/fakedb_test.go.html#7156274">args</a></span><span class="op" id="7156356">...</span><span class="op" id="7156359">)</span><span class="op" id="7156360">)</span><br>
<span class="lineno"></span><span class="op" id="7156362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="7156365">//&nbsp;parts&nbsp;are&nbsp;table|selectCol1,selectCol2|whereCol=?,whereCol2=?</span><br>
<span class="lineno"></span><span class="comment" id="7156429">//&nbsp;(note&nbsp;that&nbsp;where&nbsp;columns&nbsp;must&nbsp;always&nbsp;contain&nbsp;?&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="7156486">//&nbsp;&nbsp;just&nbsp;a&nbsp;limitation&nbsp;for&nbsp;fakedb)</span><br>
<span class="lineno"></span><span class="keyword" id="7156520">func</span>&nbsp;<span class="op" id="7156525">(</span><span class="ident" id="7156526">c</span>&nbsp;<span class="op" id="7156528">*</span><span class="ident" id="7156529"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7156537">)</span>&nbsp;<span class="ident" id="7156539">prepareSelect</span><span class="op" id="7156552">(</span><span class="ident" id="7156553">stmt</span>&nbsp;<span class="op" id="7156558">*</span><span class="ident" id="7156559"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7156567">,</span>&nbsp;<span class="ident" id="7156569">parts</span>&nbsp;<span class="op" id="7156575">[</span><span class="op" id="7156576">]</span><span class="builtintype" id="7156577">string</span><span class="op" id="7156583">)</span>&nbsp;<span class="op" id="7156585">(</span><span class="ident" id="7156586"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7156592">.</span><span class="ident" id="7156593"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="7156597">,</span>&nbsp;<span class="builtintype" id="7156599">error</span><span class="op" id="7156604">)</span>&nbsp;<span class="op" id="7156606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156609">if</span>&nbsp;<span class="builtinfunc" id="7156612">len</span><span class="op" id="7156615">(</span><span class="ident" id="7156616"><a href="/gostd/database/sql/fakedb_test.go.html#7156569">parts</a></span><span class="op" id="7156621">)</span>&nbsp;<span class="op" id="7156623">!=</span>&nbsp;<span class="num" id="7156626">3</span>&nbsp;<span class="op" id="7156628">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156632"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7156636">.</span><span class="ident" id="7156637"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7156642">(</span><span class="op" id="7156643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156647">return</span>&nbsp;<span class="builtintype" id="7156654">nil</span><span class="op" id="7156657">,</span>&nbsp;<span class="ident" id="7156659"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7156663">(</span><span class="string" id="7156664">&#34;invalid&nbsp;SELECT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;3&#34;</span><span class="op" id="7156709">,</span>&nbsp;<span class="builtinfunc" id="7156711">len</span><span class="op" id="7156714">(</span><span class="ident" id="7156715"><a href="/gostd/database/sql/fakedb_test.go.html#7156569">parts</a></span><span class="op" id="7156720">)</span><span class="op" id="7156721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156727"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7156731">.</span><span class="ident" id="7156732"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span>&nbsp;<span class="op" id="7156738">=</span>&nbsp;<span class="ident" id="7156740"><a href="/gostd/database/sql/fakedb_test.go.html#7156569">parts</a></span><span class="op" id="7156745">[</span><span class="num" id="7156746">0</span><span class="op" id="7156747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156750"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7156754">.</span><span class="ident" id="7156755"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7156763">=</span>&nbsp;<span class="ident" id="7156765"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7156772">.</span><span class="ident" id="7156773"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7156778">(</span><span class="ident" id="7156779"><a href="/gostd/database/sql/fakedb_test.go.html#7156569">parts</a></span><span class="op" id="7156784">[</span><span class="num" id="7156785">1</span><span class="op" id="7156786">]</span><span class="op" id="7156787">,</span>&nbsp;<span class="string" id="7156789">&#34;,&#34;</span><span class="op" id="7156792">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156795">for</span>&nbsp;<span class="ident" id="7156799">n</span><span class="op" id="7156800">,</span>&nbsp;<span class="ident" id="7156802">colspec</span>&nbsp;<span class="op" id="7156810">:=</span>&nbsp;<span class="keyword" id="7156813">range</span>&nbsp;<span class="ident" id="7156819"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7156826">.</span><span class="ident" id="7156827"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7156832">(</span><span class="ident" id="7156833"><a href="/gostd/database/sql/fakedb_test.go.html#7156569">parts</a></span><span class="op" id="7156838">[</span><span class="num" id="7156839">2</span><span class="op" id="7156840">]</span><span class="op" id="7156841">,</span>&nbsp;<span class="string" id="7156843">&#34;,&#34;</span><span class="op" id="7156846">)</span>&nbsp;<span class="op" id="7156848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156852">if</span>&nbsp;<span class="ident" id="7156855"><a href="/gostd/database/sql/fakedb_test.go.html#7156802">colspec</a></span>&nbsp;<span class="op" id="7156863">==</span>&nbsp;<span class="string" id="7156866">&#34;&#34;</span>&nbsp;<span class="op" id="7156869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156874">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7156885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156889">nameVal</span>&nbsp;<span class="op" id="7156897">:=</span>&nbsp;<span class="ident" id="7156900"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7156907">.</span><span class="ident" id="7156908"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7156913">(</span><span class="ident" id="7156914"><a href="/gostd/database/sql/fakedb_test.go.html#7156802">colspec</a></span><span class="op" id="7156921">,</span>&nbsp;<span class="string" id="7156923">&#34;=&#34;</span><span class="op" id="7156926">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156930">if</span>&nbsp;<span class="builtinfunc" id="7156933">len</span><span class="op" id="7156936">(</span><span class="ident" id="7156937"><a href="/gostd/database/sql/fakedb_test.go.html#7156889">nameVal</a></span><span class="op" id="7156944">)</span>&nbsp;<span class="op" id="7156946">!=</span>&nbsp;<span class="num" id="7156949">2</span>&nbsp;<span class="op" id="7156951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7156956"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7156960">.</span><span class="ident" id="7156961"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7156966">(</span><span class="op" id="7156967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7156972">return</span>&nbsp;<span class="builtintype" id="7156979">nil</span><span class="op" id="7156982">,</span>&nbsp;<span class="ident" id="7156984"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7156988">(</span><span class="string" id="7156989">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7157050">,</span>&nbsp;<span class="ident" id="7157052"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157056">.</span><span class="ident" id="7157057"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7157062">,</span>&nbsp;<span class="ident" id="7157064"><a href="/gostd/database/sql/fakedb_test.go.html#7156802">colspec</a></span><span class="op" id="7157071">,</span>&nbsp;<span class="ident" id="7157073"><a href="/gostd/database/sql/fakedb_test.go.html#7156799">n</a></span><span class="op" id="7157074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157082">column</span><span class="op" id="7157088">,</span>&nbsp;<span class="ident" id="7157090">value</span>&nbsp;<span class="op" id="7157096">:=</span>&nbsp;<span class="ident" id="7157099"><a href="/gostd/database/sql/fakedb_test.go.html#7156889">nameVal</a></span><span class="op" id="7157106">[</span><span class="num" id="7157107">0</span><span class="op" id="7157108">]</span><span class="op" id="7157109">,</span>&nbsp;<span class="ident" id="7157111"><a href="/gostd/database/sql/fakedb_test.go.html#7156889">nameVal</a></span><span class="op" id="7157118">[</span><span class="num" id="7157119">1</span><span class="op" id="7157120">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157124">_</span><span class="op" id="7157125">,</span>&nbsp;<span class="ident" id="7157127">ok</span>&nbsp;<span class="op" id="7157130">:=</span>&nbsp;<span class="ident" id="7157133"><a href="/gostd/database/sql/fakedb_test.go.html#7156526">c</a></span><span class="op" id="7157134">.</span><span class="ident" id="7157135"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7157137">.</span><span class="ident" id="7157138"><a href="/gostd/database/sql/fakedb_test.go.html#7153358">columnType</a></span><span class="op" id="7157148">(</span><span class="ident" id="7157149"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157153">.</span><span class="ident" id="7157154"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7157159">,</span>&nbsp;<span class="ident" id="7157161"><a href="/gostd/database/sql/fakedb_test.go.html#7157082">column</a></span><span class="op" id="7157167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157171">if</span>&nbsp;<span class="op" id="7157174">!</span><span class="ident" id="7157175"><a href="/gostd/database/sql/fakedb_test.go.html#7157127">ok</a></span>&nbsp;<span class="op" id="7157178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157183"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157187">.</span><span class="ident" id="7157188"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7157193">(</span><span class="op" id="7157194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157199">return</span>&nbsp;<span class="builtintype" id="7157206">nil</span><span class="op" id="7157209">,</span>&nbsp;<span class="ident" id="7157211"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7157215">(</span><span class="string" id="7157216">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7157270">,</span>&nbsp;<span class="ident" id="7157272"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157276">.</span><span class="ident" id="7157277"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7157282">,</span>&nbsp;<span class="ident" id="7157284"><a href="/gostd/database/sql/fakedb_test.go.html#7157082">column</a></span><span class="op" id="7157290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157294">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157298">if</span>&nbsp;<span class="ident" id="7157301"><a href="/gostd/database/sql/fakedb_test.go.html#7157090">value</a></span>&nbsp;<span class="op" id="7157307">!=</span>&nbsp;<span class="string" id="7157310">&#34;?&#34;</span>&nbsp;<span class="op" id="7157314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157319"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157323">.</span><span class="ident" id="7157324"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7157329">(</span><span class="op" id="7157330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157335">return</span>&nbsp;<span class="builtintype" id="7157342">nil</span><span class="op" id="7157345">,</span>&nbsp;<span class="ident" id="7157347"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7157351">(</span><span class="string" id="7157352">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;pre-bound&nbsp;value&nbsp;for&nbsp;where&nbsp;column&nbsp;%q;&nbsp;need&nbsp;a&nbsp;question&nbsp;mark&#34;</span><span class="op" id="7157434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157440"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157444">.</span><span class="ident" id="7157445"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7157450">,</span>&nbsp;<span class="ident" id="7157452"><a href="/gostd/database/sql/fakedb_test.go.html#7157082">column</a></span><span class="op" id="7157458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157462">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157466"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157470">.</span><span class="ident" id="7157471"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span>&nbsp;<span class="op" id="7157480">=</span>&nbsp;<span class="builtinfunc" id="7157482">append</span><span class="op" id="7157488">(</span><span class="ident" id="7157489"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157493">.</span><span class="ident" id="7157494"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span><span class="op" id="7157502">,</span>&nbsp;<span class="ident" id="7157504"><a href="/gostd/database/sql/fakedb_test.go.html#7157082">column</a></span><span class="op" id="7157510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157514"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157518">.</span><span class="ident" id="7157519"><a href="/gostd/database/sql/fakedb_test.go.html#7150823">placeholders</a></span><span class="op" id="7157531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157538">return</span>&nbsp;<span class="ident" id="7157545"><a href="/gostd/database/sql/fakedb_test.go.html#7156553">stmt</a></span><span class="op" id="7157549">,</span>&nbsp;<span class="builtintype" id="7157551">nil</span><br>
<span class="lineno"></span><span class="op" id="7157555">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="7157558">//&nbsp;parts&nbsp;are&nbsp;table|col=type,col2=type2</span><br>
<span class="lineno"></span><span class="keyword" id="7157597">func</span>&nbsp;<span class="op" id="7157602">(</span><span class="ident" id="7157603">c</span>&nbsp;<span class="op" id="7157605">*</span><span class="ident" id="7157606"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7157614">)</span>&nbsp;<span class="ident" id="7157616">prepareCreate</span><span class="op" id="7157629">(</span><span class="ident" id="7157630">stmt</span>&nbsp;<span class="op" id="7157635">*</span><span class="ident" id="7157636"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7157644">,</span>&nbsp;<span class="ident" id="7157646">parts</span>&nbsp;<span class="op" id="7157652">[</span><span class="op" id="7157653">]</span><span class="builtintype" id="7157654">string</span><span class="op" id="7157660">)</span>&nbsp;<span class="op" id="7157662">(</span><span class="ident" id="7157663"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7157669">.</span><span class="ident" id="7157670"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="7157674">,</span>&nbsp;<span class="builtintype" id="7157676">error</span><span class="op" id="7157681">)</span>&nbsp;<span class="op" id="7157683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157686">if</span>&nbsp;<span class="builtinfunc" id="7157689">len</span><span class="op" id="7157692">(</span><span class="ident" id="7157693"><a href="/gostd/database/sql/fakedb_test.go.html#7157646">parts</a></span><span class="op" id="7157698">)</span>&nbsp;<span class="op" id="7157700">!=</span>&nbsp;<span class="num" id="7157703">2</span>&nbsp;<span class="op" id="7157705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157709"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7157713">.</span><span class="ident" id="7157714"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7157719">(</span><span class="op" id="7157720">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157724">return</span>&nbsp;<span class="builtintype" id="7157731">nil</span><span class="op" id="7157734">,</span>&nbsp;<span class="ident" id="7157736"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7157740">(</span><span class="string" id="7157741">&#34;invalid&nbsp;CREATE&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7157786">,</span>&nbsp;<span class="builtinfunc" id="7157788">len</span><span class="op" id="7157791">(</span><span class="ident" id="7157792"><a href="/gostd/database/sql/fakedb_test.go.html#7157646">parts</a></span><span class="op" id="7157797">)</span><span class="op" id="7157798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7157801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157804"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7157808">.</span><span class="ident" id="7157809"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span>&nbsp;<span class="op" id="7157815">=</span>&nbsp;<span class="ident" id="7157817"><a href="/gostd/database/sql/fakedb_test.go.html#7157646">parts</a></span><span class="op" id="7157822">[</span><span class="num" id="7157823">0</span><span class="op" id="7157824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157827">for</span>&nbsp;<span class="ident" id="7157831">n</span><span class="op" id="7157832">,</span>&nbsp;<span class="ident" id="7157834">colspec</span>&nbsp;<span class="op" id="7157842">:=</span>&nbsp;<span class="keyword" id="7157845">range</span>&nbsp;<span class="ident" id="7157851"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7157858">.</span><span class="ident" id="7157859"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7157864">(</span><span class="ident" id="7157865"><a href="/gostd/database/sql/fakedb_test.go.html#7157646">parts</a></span><span class="op" id="7157870">[</span><span class="num" id="7157871">1</span><span class="op" id="7157872">]</span><span class="op" id="7157873">,</span>&nbsp;<span class="string" id="7157875">&#34;,&#34;</span><span class="op" id="7157878">)</span>&nbsp;<span class="op" id="7157880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157884">nameType</span>&nbsp;<span class="op" id="7157893">:=</span>&nbsp;<span class="ident" id="7157896"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7157903">.</span><span class="ident" id="7157904"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7157909">(</span><span class="ident" id="7157910"><a href="/gostd/database/sql/fakedb_test.go.html#7157834">colspec</a></span><span class="op" id="7157917">,</span>&nbsp;<span class="string" id="7157919">&#34;=&#34;</span><span class="op" id="7157922">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157926">if</span>&nbsp;<span class="builtinfunc" id="7157929">len</span><span class="op" id="7157932">(</span><span class="ident" id="7157933"><a href="/gostd/database/sql/fakedb_test.go.html#7157884">nameType</a></span><span class="op" id="7157941">)</span>&nbsp;<span class="op" id="7157943">!=</span>&nbsp;<span class="num" id="7157946">2</span>&nbsp;<span class="op" id="7157948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7157953"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7157957">.</span><span class="ident" id="7157958"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7157963">(</span><span class="op" id="7157964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7157969">return</span>&nbsp;<span class="builtintype" id="7157976">nil</span><span class="op" id="7157979">,</span>&nbsp;<span class="ident" id="7157981"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7157985">(</span><span class="string" id="7157986">&#34;CREATE&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7158044">,</span>&nbsp;<span class="ident" id="7158046"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158050">.</span><span class="ident" id="7158051"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7158056">,</span>&nbsp;<span class="ident" id="7158058"><a href="/gostd/database/sql/fakedb_test.go.html#7157834">colspec</a></span><span class="op" id="7158065">,</span>&nbsp;<span class="ident" id="7158067"><a href="/gostd/database/sql/fakedb_test.go.html#7157831">n</a></span><span class="op" id="7158068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158076"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158080">.</span><span class="ident" id="7158081"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7158089">=</span>&nbsp;<span class="builtinfunc" id="7158091">append</span><span class="op" id="7158097">(</span><span class="ident" id="7158098"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158102">.</span><span class="ident" id="7158103"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span><span class="op" id="7158110">,</span>&nbsp;<span class="ident" id="7158112"><a href="/gostd/database/sql/fakedb_test.go.html#7157884">nameType</a></span><span class="op" id="7158120">[</span><span class="num" id="7158121">0</span><span class="op" id="7158122">]</span><span class="op" id="7158123">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158127"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158131">.</span><span class="ident" id="7158132"><a href="/gostd/database/sql/fakedb_test.go.html#7150689">colType</a></span>&nbsp;<span class="op" id="7158140">=</span>&nbsp;<span class="builtinfunc" id="7158142">append</span><span class="op" id="7158148">(</span><span class="ident" id="7158149"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158153">.</span><span class="ident" id="7158154"><a href="/gostd/database/sql/fakedb_test.go.html#7150689">colType</a></span><span class="op" id="7158161">,</span>&nbsp;<span class="ident" id="7158163"><a href="/gostd/database/sql/fakedb_test.go.html#7157884">nameType</a></span><span class="op" id="7158171">[</span><span class="num" id="7158172">1</span><span class="op" id="7158173">]</span><span class="op" id="7158174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158180">return</span>&nbsp;<span class="ident" id="7158187"><a href="/gostd/database/sql/fakedb_test.go.html#7157630">stmt</a></span><span class="op" id="7158191">,</span>&nbsp;<span class="builtintype" id="7158193">nil</span><br>
<span class="lineno"></span><span class="op" id="7158197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7158200">//&nbsp;parts&nbsp;are&nbsp;table|col=?,col2=val</span><br>
<span class="lineno"></span><span class="keyword" id="7158234">func</span>&nbsp;<span class="op" id="7158239">(</span><span class="ident" id="7158240">c</span>&nbsp;<span class="op" id="7158242">*</span><span class="ident" id="7158243"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7158251">)</span>&nbsp;<span class="ident" id="7158253">prepareInsert</span><span class="op" id="7158266">(</span><span class="ident" id="7158267">stmt</span>&nbsp;<span class="op" id="7158272">*</span><span class="ident" id="7158273"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7158281">,</span>&nbsp;<span class="ident" id="7158283">parts</span>&nbsp;<span class="op" id="7158289">[</span><span class="op" id="7158290">]</span><span class="builtintype" id="7158291">string</span><span class="op" id="7158297">)</span>&nbsp;<span class="op" id="7158299">(</span><span class="ident" id="7158300"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7158306">.</span><span class="ident" id="7158307"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="7158311">,</span>&nbsp;<span class="builtintype" id="7158313">error</span><span class="op" id="7158318">)</span>&nbsp;<span class="op" id="7158320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158323">if</span>&nbsp;<span class="builtinfunc" id="7158326">len</span><span class="op" id="7158329">(</span><span class="ident" id="7158330"><a href="/gostd/database/sql/fakedb_test.go.html#7158283">parts</a></span><span class="op" id="7158335">)</span>&nbsp;<span class="op" id="7158337">!=</span>&nbsp;<span class="num" id="7158340">2</span>&nbsp;<span class="op" id="7158342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158346"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158350">.</span><span class="ident" id="7158351"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7158356">(</span><span class="op" id="7158357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158361">return</span>&nbsp;<span class="builtintype" id="7158368">nil</span><span class="op" id="7158371">,</span>&nbsp;<span class="ident" id="7158373"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7158377">(</span><span class="string" id="7158378">&#34;invalid&nbsp;INSERT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7158423">,</span>&nbsp;<span class="builtinfunc" id="7158425">len</span><span class="op" id="7158428">(</span><span class="ident" id="7158429"><a href="/gostd/database/sql/fakedb_test.go.html#7158283">parts</a></span><span class="op" id="7158434">)</span><span class="op" id="7158435">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158441"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158445">.</span><span class="ident" id="7158446"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span>&nbsp;<span class="op" id="7158452">=</span>&nbsp;<span class="ident" id="7158454"><a href="/gostd/database/sql/fakedb_test.go.html#7158283">parts</a></span><span class="op" id="7158459">[</span><span class="num" id="7158460">0</span><span class="op" id="7158461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158464">for</span>&nbsp;<span class="ident" id="7158468">n</span><span class="op" id="7158469">,</span>&nbsp;<span class="ident" id="7158471">colspec</span>&nbsp;<span class="op" id="7158479">:=</span>&nbsp;<span class="keyword" id="7158482">range</span>&nbsp;<span class="ident" id="7158488"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7158495">.</span><span class="ident" id="7158496"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7158501">(</span><span class="ident" id="7158502"><a href="/gostd/database/sql/fakedb_test.go.html#7158283">parts</a></span><span class="op" id="7158507">[</span><span class="num" id="7158508">1</span><span class="op" id="7158509">]</span><span class="op" id="7158510">,</span>&nbsp;<span class="string" id="7158512">&#34;,&#34;</span><span class="op" id="7158515">)</span>&nbsp;<span class="op" id="7158517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158521">nameVal</span>&nbsp;<span class="op" id="7158529">:=</span>&nbsp;<span class="ident" id="7158532"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7158539">.</span><span class="ident" id="7158540"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7158545">(</span><span class="ident" id="7158546"><a href="/gostd/database/sql/fakedb_test.go.html#7158471">colspec</a></span><span class="op" id="7158553">,</span>&nbsp;<span class="string" id="7158555">&#34;=&#34;</span><span class="op" id="7158558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158562">if</span>&nbsp;<span class="builtinfunc" id="7158565">len</span><span class="op" id="7158568">(</span><span class="ident" id="7158569"><a href="/gostd/database/sql/fakedb_test.go.html#7158521">nameVal</a></span><span class="op" id="7158576">)</span>&nbsp;<span class="op" id="7158578">!=</span>&nbsp;<span class="num" id="7158581">2</span>&nbsp;<span class="op" id="7158583">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158588"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158592">.</span><span class="ident" id="7158593"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7158598">(</span><span class="op" id="7158599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158604">return</span>&nbsp;<span class="builtintype" id="7158611">nil</span><span class="op" id="7158614">,</span>&nbsp;<span class="ident" id="7158616"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7158620">(</span><span class="string" id="7158621">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7158679">,</span>&nbsp;<span class="ident" id="7158681"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158685">.</span><span class="ident" id="7158686"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7158691">,</span>&nbsp;<span class="ident" id="7158693"><a href="/gostd/database/sql/fakedb_test.go.html#7158471">colspec</a></span><span class="op" id="7158700">,</span>&nbsp;<span class="ident" id="7158702"><a href="/gostd/database/sql/fakedb_test.go.html#7158468">n</a></span><span class="op" id="7158703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158711">column</span><span class="op" id="7158717">,</span>&nbsp;<span class="ident" id="7158719">value</span>&nbsp;<span class="op" id="7158725">:=</span>&nbsp;<span class="ident" id="7158728"><a href="/gostd/database/sql/fakedb_test.go.html#7158521">nameVal</a></span><span class="op" id="7158735">[</span><span class="num" id="7158736">0</span><span class="op" id="7158737">]</span><span class="op" id="7158738">,</span>&nbsp;<span class="ident" id="7158740"><a href="/gostd/database/sql/fakedb_test.go.html#7158521">nameVal</a></span><span class="op" id="7158747">[</span><span class="num" id="7158748">1</span><span class="op" id="7158749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158753">ctype</span><span class="op" id="7158758">,</span>&nbsp;<span class="ident" id="7158760">ok</span>&nbsp;<span class="op" id="7158763">:=</span>&nbsp;<span class="ident" id="7158766"><a href="/gostd/database/sql/fakedb_test.go.html#7158240">c</a></span><span class="op" id="7158767">.</span><span class="ident" id="7158768"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><span class="op" id="7158770">.</span><span class="ident" id="7158771"><a href="/gostd/database/sql/fakedb_test.go.html#7153358">columnType</a></span><span class="op" id="7158781">(</span><span class="ident" id="7158782"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158786">.</span><span class="ident" id="7158787"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7158792">,</span>&nbsp;<span class="ident" id="7158794"><a href="/gostd/database/sql/fakedb_test.go.html#7158711">column</a></span><span class="op" id="7158800">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158804">if</span>&nbsp;<span class="op" id="7158807">!</span><span class="ident" id="7158808"><a href="/gostd/database/sql/fakedb_test.go.html#7158760">ok</a></span>&nbsp;<span class="op" id="7158811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158816"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158820">.</span><span class="ident" id="7158821"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7158826">(</span><span class="op" id="7158827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158832">return</span>&nbsp;<span class="builtintype" id="7158839">nil</span><span class="op" id="7158842">,</span>&nbsp;<span class="ident" id="7158844"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7158848">(</span><span class="string" id="7158849">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7158900">,</span>&nbsp;<span class="ident" id="7158902"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158906">.</span><span class="ident" id="7158907"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7158912">,</span>&nbsp;<span class="ident" id="7158914"><a href="/gostd/database/sql/fakedb_test.go.html#7158711">column</a></span><span class="op" id="7158920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7158924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7158928"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158932">.</span><span class="ident" id="7158933"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7158941">=</span>&nbsp;<span class="builtinfunc" id="7158943">append</span><span class="op" id="7158949">(</span><span class="ident" id="7158950"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7158954">.</span><span class="ident" id="7158955"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span><span class="op" id="7158962">,</span>&nbsp;<span class="ident" id="7158964"><a href="/gostd/database/sql/fakedb_test.go.html#7158711">column</a></span><span class="op" id="7158970">)</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158975">if</span>&nbsp;<span class="ident" id="7158978"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span>&nbsp;<span class="op" id="7158984">!=</span>&nbsp;<span class="string" id="7158987">&#34;?&#34;</span>&nbsp;<span class="op" id="7158991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7158996">var</span>&nbsp;<span class="ident" id="7159000">subsetVal</span>&nbsp;<span class="keyword" id="7159010">interface</span><span class="op" id="7159019">{</span><span class="op" id="7159020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7159025">//&nbsp;Convert&nbsp;to&nbsp;driver&nbsp;subset&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159061">switch</span>&nbsp;<span class="ident" id="7159068"><a href="/gostd/database/sql/fakedb_test.go.html#7158753">ctype</a></span>&nbsp;<span class="op" id="7159074">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159079">case</span>&nbsp;<span class="string" id="7159084">&#34;string&#34;</span><span class="op" id="7159092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159098"><a href="/gostd/database/sql/fakedb_test.go.html#7159000">subsetVal</a></span>&nbsp;<span class="op" id="7159108">=</span>&nbsp;<span class="op" id="7159110">[</span><span class="op" id="7159111">]</span><span class="builtintype" id="7159112">byte</span><span class="op" id="7159116">(</span><span class="ident" id="7159117"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span><span class="op" id="7159122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159127">case</span>&nbsp;<span class="string" id="7159132">&#34;blob&#34;</span><span class="op" id="7159138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159144"><a href="/gostd/database/sql/fakedb_test.go.html#7159000">subsetVal</a></span>&nbsp;<span class="op" id="7159154">=</span>&nbsp;<span class="op" id="7159156">[</span><span class="op" id="7159157">]</span><span class="builtintype" id="7159158">byte</span><span class="op" id="7159162">(</span><span class="ident" id="7159163"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span><span class="op" id="7159168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159173">case</span>&nbsp;<span class="string" id="7159178">&#34;int32&#34;</span><span class="op" id="7159185">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159191">i</span><span class="op" id="7159192">,</span>&nbsp;<span class="ident" id="7159194">err</span>&nbsp;<span class="op" id="7159198">:=</span>&nbsp;<span class="ident" id="7159201"><a href="/gostd/database/sql/fakedb_test.go.html#7148680">strconv</a></span><span class="op" id="7159208">.</span><span class="ident" id="7159209"><a href="/gostd/strconv/atoi.go.html#2357032">Atoi</a></span><span class="op" id="7159213">(</span><span class="ident" id="7159214"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span><span class="op" id="7159219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159225">if</span>&nbsp;<span class="ident" id="7159228"><a href="/gostd/database/sql/fakedb_test.go.html#7159194">err</a></span>&nbsp;<span class="op" id="7159232">!=</span>&nbsp;<span class="builtintype" id="7159235">nil</span>&nbsp;<span class="op" id="7159239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159246"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159250">.</span><span class="ident" id="7159251"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7159256">(</span><span class="op" id="7159257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159264">return</span>&nbsp;<span class="builtintype" id="7159271">nil</span><span class="op" id="7159274">,</span>&nbsp;<span class="ident" id="7159276"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7159280">(</span><span class="string" id="7159281">&#34;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;%q&#34;</span><span class="op" id="7159318">,</span>&nbsp;<span class="ident" id="7159320"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span><span class="op" id="7159325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159331">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159337"><a href="/gostd/database/sql/fakedb_test.go.html#7159000">subsetVal</a></span>&nbsp;<span class="op" id="7159347">=</span>&nbsp;<span class="builtintype" id="7159349">int64</span><span class="op" id="7159354">(</span><span class="ident" id="7159355"><a href="/gostd/database/sql/fakedb_test.go.html#7159191">i</a></span><span class="op" id="7159356">)</span>&nbsp;<span class="comment" id="7159358">//&nbsp;int64&nbsp;is&nbsp;a&nbsp;subset&nbsp;type,&nbsp;but&nbsp;not&nbsp;int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159402">default</span><span class="op" id="7159409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159415"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159419">.</span><span class="ident" id="7159420"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7159425">(</span><span class="op" id="7159426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159432">return</span>&nbsp;<span class="builtintype" id="7159439">nil</span><span class="op" id="7159442">,</span>&nbsp;<span class="ident" id="7159444"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7159448">(</span><span class="string" id="7159449">&#34;unsupported&nbsp;conversion&nbsp;for&nbsp;pre-bound&nbsp;parameter&nbsp;%q&nbsp;to&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7159511">,</span>&nbsp;<span class="ident" id="7159513"><a href="/gostd/database/sql/fakedb_test.go.html#7158719">value</a></span><span class="op" id="7159518">,</span>&nbsp;<span class="ident" id="7159520"><a href="/gostd/database/sql/fakedb_test.go.html#7158753">ctype</a></span><span class="op" id="7159525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159530">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159535"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159539">.</span><span class="ident" id="7159540"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span>&nbsp;<span class="op" id="7159549">=</span>&nbsp;<span class="builtinfunc" id="7159551">append</span><span class="op" id="7159557">(</span><span class="ident" id="7159558"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159562">.</span><span class="ident" id="7159563"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span><span class="op" id="7159571">,</span>&nbsp;<span class="ident" id="7159573"><a href="/gostd/database/sql/fakedb_test.go.html#7159000">subsetVal</a></span><span class="op" id="7159582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159586">}</span>&nbsp;<span class="keyword" id="7159588">else</span>&nbsp;<span class="op" id="7159593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159598"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159602">.</span><span class="ident" id="7159603"><a href="/gostd/database/sql/fakedb_test.go.html#7150823">placeholders</a></span><span class="op" id="7159615">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159621"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159625">.</span><span class="ident" id="7159626"><a href="/gostd/database/sql/fakedb_test.go.html#7150954">placeholderConverter</a></span>&nbsp;<span class="op" id="7159647">=</span>&nbsp;<span class="builtinfunc" id="7159649">append</span><span class="op" id="7159655">(</span><span class="ident" id="7159656"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159660">.</span><span class="ident" id="7159661"><a href="/gostd/database/sql/fakedb_test.go.html#7150954">placeholderConverter</a></span><span class="op" id="7159681">,</span>&nbsp;<span class="ident" id="7159683"><a href="/gostd/database/sql/fakedb_test.go.html#7167848">converterForType</a></span><span class="op" id="7159699">(</span><span class="ident" id="7159700"><a href="/gostd/database/sql/fakedb_test.go.html#7158753">ctype</a></span><span class="op" id="7159705">)</span><span class="op" id="7159706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159711"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159715">.</span><span class="ident" id="7159716"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span>&nbsp;<span class="op" id="7159725">=</span>&nbsp;<span class="builtinfunc" id="7159727">append</span><span class="op" id="7159733">(</span><span class="ident" id="7159734"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159738">.</span><span class="ident" id="7159739"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span><span class="op" id="7159747">,</span>&nbsp;<span class="string" id="7159749">&#34;?&#34;</span><span class="op" id="7159752">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7159759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159762">return</span>&nbsp;<span class="ident" id="7159769"><a href="/gostd/database/sql/fakedb_test.go.html#7158267">stmt</a></span><span class="op" id="7159773">,</span>&nbsp;<span class="builtintype" id="7159775">nil</span><br>
<span class="lineno"></span><span class="op" id="7159779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7159782">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7159821">var</span>&nbsp;<span class="ident" id="7159825">hookPrepareBadConn</span>&nbsp;<span class="keyword" id="7159844">func</span><span class="op" id="7159848">(</span><span class="op" id="7159849">)</span>&nbsp;<span class="builtintype" id="7159851">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7159857">func</span>&nbsp;<span class="op" id="7159862">(</span><span class="ident" id="7159863">c</span>&nbsp;<span class="op" id="7159865">*</span><span class="ident" id="7159866"><a href="/gostd/database/sql/fakedb_test.go.html#7150186">fakeConn</a></span><span class="op" id="7159874">)</span>&nbsp;<span class="ident" id="7159876">Prepare</span><span class="op" id="7159883">(</span><span class="ident" id="7159884">query</span>&nbsp;<span class="builtintype" id="7159890">string</span><span class="op" id="7159896">)</span>&nbsp;<span class="op" id="7159898">(</span><span class="ident" id="7159899"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7159905">.</span><span class="ident" id="7159906"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="7159910">,</span>&nbsp;<span class="builtintype" id="7159912">error</span><span class="op" id="7159917">)</span>&nbsp;<span class="op" id="7159919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7159922"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7159923">.</span><span class="ident" id="7159924"><a href="/gostd/database/sql/fakedb_test.go.html#7150346">numPrepare</a></span><span class="op" id="7159934">++</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7159938">if</span>&nbsp;<span class="ident" id="7159941"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7159942">.</span><span class="ident" id="7159943"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span>&nbsp;<span class="op" id="7159946">==</span>&nbsp;<span class="builtintype" id="7159949">nil</span>&nbsp;<span class="op" id="7159953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7159957">panic</span><span class="op" id="7159962">(</span><span class="string" id="7159963">&#34;nil&nbsp;c.db;&nbsp;conn&nbsp;=&nbsp;&#34;</span>&nbsp;<span class="op" id="7159983">+</span>&nbsp;<span class="ident" id="7159985"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7159988">.</span><span class="ident" id="7159989"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7159996">(</span><span class="string" id="7159997">&#34;%#v&#34;</span><span class="op" id="7160002">,</span>&nbsp;<span class="ident" id="7160004"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160005">)</span><span class="op" id="7160006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160013">if</span>&nbsp;<span class="ident" id="7160016"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span>&nbsp;<span class="op" id="7160035">!=</span>&nbsp;<span class="builtintype" id="7160038">nil</span>&nbsp;<span class="op" id="7160042">&amp;&amp;</span>&nbsp;<span class="ident" id="7160045"><a href="/gostd/database/sql/fakedb_test.go.html#7159825">hookPrepareBadConn</a></span><span class="op" id="7160063">(</span><span class="op" id="7160064">)</span>&nbsp;<span class="op" id="7160066">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160070">return</span>&nbsp;<span class="builtintype" id="7160077">nil</span><span class="op" id="7160080">,</span>&nbsp;<span class="ident" id="7160082"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7160088">.</span><span class="ident" id="7160089"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160105">parts</span>&nbsp;<span class="op" id="7160111">:=</span>&nbsp;<span class="ident" id="7160114"><a href="/gostd/database/sql/fakedb_test.go.html#7148691">strings</a></span><span class="op" id="7160121">.</span><span class="ident" id="7160122"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="7160127">(</span><span class="ident" id="7160128"><a href="/gostd/database/sql/fakedb_test.go.html#7159884">query</a></span><span class="op" id="7160133">,</span>&nbsp;<span class="string" id="7160135">&#34;|&#34;</span><span class="op" id="7160138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160141">if</span>&nbsp;<span class="builtinfunc" id="7160144">len</span><span class="op" id="7160147">(</span><span class="ident" id="7160148"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160153">)</span>&nbsp;<span class="op" id="7160155">&lt;</span>&nbsp;<span class="num" id="7160157">1</span>&nbsp;<span class="op" id="7160159">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160163">return</span>&nbsp;<span class="builtintype" id="7160170">nil</span><span class="op" id="7160173">,</span>&nbsp;<span class="ident" id="7160175"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7160179">(</span><span class="string" id="7160180">&#34;empty&nbsp;query&#34;</span><span class="op" id="7160193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160199">cmd</span>&nbsp;<span class="op" id="7160203">:=</span>&nbsp;<span class="ident" id="7160206"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160211">[</span><span class="num" id="7160212">0</span><span class="op" id="7160213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160216"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span>&nbsp;<span class="op" id="7160222">=</span>&nbsp;<span class="ident" id="7160224"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160229">[</span><span class="num" id="7160230">1</span><span class="op" id="7160231">:</span><span class="op" id="7160232">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160235">stmt</span>&nbsp;<span class="op" id="7160240">:=</span>&nbsp;<span class="op" id="7160243">&amp;</span><span class="ident" id="7160244"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7160252">{</span><span class="ident" id="7160253"><a href="/gostd/database/sql/fakedb_test.go.html#7150532">q</a></span><span class="op" id="7160254">:</span>&nbsp;<span class="ident" id="7160256"><a href="/gostd/database/sql/fakedb_test.go.html#7159884">query</a></span><span class="op" id="7160261">,</span>&nbsp;<span class="ident" id="7160263"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7160264">:</span>&nbsp;<span class="ident" id="7160266"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160267">,</span>&nbsp;<span class="ident" id="7160269"><a href="/gostd/database/sql/fakedb_test.go.html#7150565">cmd</a></span><span class="op" id="7160272">:</span>&nbsp;<span class="ident" id="7160274"><a href="/gostd/database/sql/fakedb_test.go.html#7160199">cmd</a></span><span class="op" id="7160277">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160280"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160281">.</span><span class="ident" id="7160282"><a href="/gostd/database/sql/fakedb_test.go.html#7150402">incrStat</a></span><span class="op" id="7160290">(</span><span class="op" id="7160291">&amp;</span><span class="ident" id="7160292"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160293">.</span><span class="ident" id="7160294"><a href="/gostd/database/sql/fakedb_test.go.html#7150312">stmtsMade</a></span><span class="op" id="7160303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160306">switch</span>&nbsp;<span class="ident" id="7160313"><a href="/gostd/database/sql/fakedb_test.go.html#7160199">cmd</a></span>&nbsp;<span class="op" id="7160317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160320">case</span>&nbsp;<span class="string" id="7160325">&#34;WIPE&#34;</span><span class="op" id="7160331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7160335">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160347">case</span>&nbsp;<span class="string" id="7160352">&#34;SELECT&#34;</span><span class="op" id="7160360">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160364">return</span>&nbsp;<span class="ident" id="7160371"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160372">.</span><span class="ident" id="7160373"><a href="/gostd/database/sql/fakedb_test.go.html#7156539">prepareSelect</a></span><span class="op" id="7160386">(</span><span class="ident" id="7160387"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160391">,</span>&nbsp;<span class="ident" id="7160393"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160401">case</span>&nbsp;<span class="string" id="7160406">&#34;CREATE&#34;</span><span class="op" id="7160414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160418">return</span>&nbsp;<span class="ident" id="7160425"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160426">.</span><span class="ident" id="7160427"><a href="/gostd/database/sql/fakedb_test.go.html#7157616">prepareCreate</a></span><span class="op" id="7160440">(</span><span class="ident" id="7160441"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160445">,</span>&nbsp;<span class="ident" id="7160447"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160455">case</span>&nbsp;<span class="string" id="7160460">&#34;INSERT&#34;</span><span class="op" id="7160468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160472">return</span>&nbsp;<span class="ident" id="7160479"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160480">.</span><span class="ident" id="7160481"><a href="/gostd/database/sql/fakedb_test.go.html#7158253">prepareInsert</a></span><span class="op" id="7160494">(</span><span class="ident" id="7160495"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160499">,</span>&nbsp;<span class="ident" id="7160501"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160506">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160509">case</span>&nbsp;<span class="string" id="7160514">&#34;NOSERT&#34;</span><span class="op" id="7160522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7160526">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7160606">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160650">return</span>&nbsp;<span class="ident" id="7160657"><a href="/gostd/database/sql/fakedb_test.go.html#7159863">c</a></span><span class="op" id="7160658">.</span><span class="ident" id="7160659"><a href="/gostd/database/sql/fakedb_test.go.html#7158253">prepareInsert</a></span><span class="op" id="7160672">(</span><span class="ident" id="7160673"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160677">,</span>&nbsp;<span class="ident" id="7160679"><a href="/gostd/database/sql/fakedb_test.go.html#7160105">parts</a></span><span class="op" id="7160684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160687">default</span><span class="op" id="7160694">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7160698"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160702">.</span><span class="ident" id="7160703"><a href="/gostd/database/sql/fakedb_test.go.html#7161000">Close</a></span><span class="op" id="7160708">(</span><span class="op" id="7160709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160713">return</span>&nbsp;<span class="builtintype" id="7160720">nil</span><span class="op" id="7160723">,</span>&nbsp;<span class="ident" id="7160725"><a href="/gostd/database/sql/fakedb_test.go.html#7156257">errf</a></span><span class="op" id="7160729">(</span><span class="string" id="7160730">&#34;unsupported&nbsp;command&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7160759">,</span>&nbsp;<span class="ident" id="7160761"><a href="/gostd/database/sql/fakedb_test.go.html#7160199">cmd</a></span><span class="op" id="7160764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160770">return</span>&nbsp;<span class="ident" id="7160777"><a href="/gostd/database/sql/fakedb_test.go.html#7160235">stmt</a></span><span class="op" id="7160781">,</span>&nbsp;<span class="builtintype" id="7160783">nil</span><br>
<span class="lineno"></span><span class="op" id="7160787">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7160790">func</span>&nbsp;<span class="op" id="7160795">(</span><span class="ident" id="7160796">s</span>&nbsp;<span class="op" id="7160798">*</span><span class="ident" id="7160799"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7160807">)</span>&nbsp;<span class="ident" id="7160809">ColumnConverter</span><span class="op" id="7160824">(</span><span class="ident" id="7160825">idx</span>&nbsp;<span class="builtintype" id="7160829">int</span><span class="op" id="7160832">)</span>&nbsp;<span class="ident" id="7160834"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7160840">.</span><span class="ident" id="7160841"><a href="/gostd/database/sql/driver/types.go.html#5255195">ValueConverter</a></span>&nbsp;<span class="op" id="7160856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160859">if</span>&nbsp;<span class="builtinfunc" id="7160862">len</span><span class="op" id="7160865">(</span><span class="ident" id="7160866"><a href="/gostd/database/sql/fakedb_test.go.html#7160796">s</a></span><span class="op" id="7160867">.</span><span class="ident" id="7160868"><a href="/gostd/database/sql/fakedb_test.go.html#7150954">placeholderConverter</a></span><span class="op" id="7160888">)</span>&nbsp;<span class="op" id="7160890">==</span>&nbsp;<span class="num" id="7160893">0</span>&nbsp;<span class="op" id="7160895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160899">return</span>&nbsp;<span class="ident" id="7160906"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7160912">.</span><span class="ident" id="7160913"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7160940">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7160943">return</span>&nbsp;<span class="ident" id="7160950"><a href="/gostd/database/sql/fakedb_test.go.html#7160796">s</a></span><span class="op" id="7160951">.</span><span class="ident" id="7160952"><a href="/gostd/database/sql/fakedb_test.go.html#7150954">placeholderConverter</a></span><span class="op" id="7160972">[</span><span class="ident" id="7160973"><a href="/gostd/database/sql/fakedb_test.go.html#7160825">idx</a></span><span class="op" id="7160976">]</span><br>
<span class="lineno"></span><span class="op" id="7160978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7160981">func</span>&nbsp;<span class="op" id="7160986">(</span><span class="ident" id="7160987">s</span>&nbsp;<span class="op" id="7160989">*</span><span class="ident" id="7160990"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7160998">)</span>&nbsp;<span class="ident" id="7161000">Close</span><span class="op" id="7161005">(</span><span class="op" id="7161006">)</span>&nbsp;<span class="builtintype" id="7161008">error</span>&nbsp;<span class="op" id="7161014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161017">if</span>&nbsp;<span class="ident" id="7161020"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161021">.</span><span class="ident" id="7161022"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span>&nbsp;<span class="op" id="7161024">==</span>&nbsp;<span class="builtintype" id="7161027">nil</span>&nbsp;<span class="op" id="7161031">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7161035">panic</span><span class="op" id="7161040">(</span><span class="string" id="7161041">&#34;nil&nbsp;conn&nbsp;in&nbsp;fakeStmt.Close&#34;</span><span class="op" id="7161069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161075">if</span>&nbsp;<span class="ident" id="7161078"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161079">.</span><span class="ident" id="7161080"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7161081">.</span><span class="ident" id="7161082"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span>&nbsp;<span class="op" id="7161085">==</span>&nbsp;<span class="builtintype" id="7161088">nil</span>&nbsp;<span class="op" id="7161092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7161096">panic</span><span class="op" id="7161101">(</span><span class="string" id="7161102">&#34;in&nbsp;fakeStmt.Close,&nbsp;conn&#39;s&nbsp;db&nbsp;is&nbsp;nil&nbsp;(already&nbsp;closed)&#34;</span><span class="op" id="7161156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161159">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161162">if</span>&nbsp;<span class="op" id="7161165">!</span><span class="ident" id="7161166"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161167">.</span><span class="ident" id="7161168"><a href="/gostd/database/sql/fakedb_test.go.html#7150594">closed</a></span>&nbsp;<span class="op" id="7161175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161179"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161180">.</span><span class="ident" id="7161181"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7161182">.</span><span class="ident" id="7161183"><a href="/gostd/database/sql/fakedb_test.go.html#7150402">incrStat</a></span><span class="op" id="7161191">(</span><span class="op" id="7161192">&amp;</span><span class="ident" id="7161193"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161194">.</span><span class="ident" id="7161195"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7161196">.</span><span class="ident" id="7161197"><a href="/gostd/database/sql/fakedb_test.go.html#7150329">stmtsClosed</a></span><span class="op" id="7161208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161212"><a href="/gostd/database/sql/fakedb_test.go.html#7160987">s</a></span><span class="op" id="7161213">.</span><span class="ident" id="7161214"><a href="/gostd/database/sql/fakedb_test.go.html#7150594">closed</a></span>&nbsp;<span class="op" id="7161221">=</span>&nbsp;<span class="builtintype" id="7161223">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161232">return</span>&nbsp;<span class="builtintype" id="7161239">nil</span><br>
<span class="lineno">520</span><span class="op" id="7161243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161246">var</span>&nbsp;<span class="ident" id="7161250">errClosed</span>&nbsp;<span class="op" id="7161260">=</span>&nbsp;<span class="ident" id="7161262"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7161268">.</span><span class="ident" id="7161269"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7161272">(</span><span class="string" id="7161273">&#34;fakedb:&nbsp;statement&nbsp;has&nbsp;been&nbsp;closed&#34;</span><span class="op" id="7161308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7161311">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno">525</span><span class="keyword" id="7161350">var</span>&nbsp;<span class="ident" id="7161354">hookExecBadConn</span>&nbsp;<span class="keyword" id="7161370">func</span><span class="op" id="7161374">(</span><span class="op" id="7161375">)</span>&nbsp;<span class="builtintype" id="7161377">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7161383">func</span>&nbsp;<span class="op" id="7161388">(</span><span class="ident" id="7161389">s</span>&nbsp;<span class="op" id="7161391">*</span><span class="ident" id="7161392"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7161400">)</span>&nbsp;<span class="ident" id="7161402">Exec</span><span class="op" id="7161406">(</span><span class="ident" id="7161407">args</span>&nbsp;<span class="op" id="7161412">[</span><span class="op" id="7161413">]</span><span class="ident" id="7161414"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7161420">.</span><span class="ident" id="7161421"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7161426">)</span>&nbsp;<span class="op" id="7161428">(</span><span class="ident" id="7161429"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7161435">.</span><span class="ident" id="7161436"><a href="/gostd/database/sql/driver/driver.go.html#5250891">Result</a></span><span class="op" id="7161442">,</span>&nbsp;<span class="builtintype" id="7161444">error</span><span class="op" id="7161449">)</span>&nbsp;<span class="op" id="7161451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161454">if</span>&nbsp;<span class="ident" id="7161457"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161458">.</span><span class="ident" id="7161459"><a href="/gostd/database/sql/fakedb_test.go.html#7150594">closed</a></span>&nbsp;<span class="op" id="7161466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161470">return</span>&nbsp;<span class="builtintype" id="7161477">nil</span><span class="op" id="7161480">,</span>&nbsp;<span class="ident" id="7161482"><a href="/gostd/database/sql/fakedb_test.go.html#7161250">errClosed</a></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161497">if</span>&nbsp;<span class="ident" id="7161500"><a href="/gostd/database/sql/fakedb_test.go.html#7161354">hookExecBadConn</a></span>&nbsp;<span class="op" id="7161516">!=</span>&nbsp;<span class="builtintype" id="7161519">nil</span>&nbsp;<span class="op" id="7161523">&amp;&amp;</span>&nbsp;<span class="ident" id="7161526"><a href="/gostd/database/sql/fakedb_test.go.html#7161354">hookExecBadConn</a></span><span class="op" id="7161541">(</span><span class="op" id="7161542">)</span>&nbsp;<span class="op" id="7161544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161548">return</span>&nbsp;<span class="builtintype" id="7161555">nil</span><span class="op" id="7161558">,</span>&nbsp;<span class="ident" id="7161560"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7161566">.</span><span class="ident" id="7161567"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161579">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161583">err</span>&nbsp;<span class="op" id="7161587">:=</span>&nbsp;<span class="ident" id="7161590"><a href="/gostd/database/sql/fakedb_test.go.html#7155193">checkSubsetTypes</a></span><span class="op" id="7161606">(</span><span class="ident" id="7161607"><a href="/gostd/database/sql/fakedb_test.go.html#7161407">args</a></span><span class="op" id="7161611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161614">if</span>&nbsp;<span class="ident" id="7161617"><a href="/gostd/database/sql/fakedb_test.go.html#7161583">err</a></span>&nbsp;<span class="op" id="7161621">!=</span>&nbsp;<span class="builtintype" id="7161624">nil</span>&nbsp;<span class="op" id="7161628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161632">return</span>&nbsp;<span class="builtintype" id="7161639">nil</span><span class="op" id="7161642">,</span>&nbsp;<span class="ident" id="7161644"><a href="/gostd/database/sql/fakedb_test.go.html#7161583">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161649">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161653">db</span>&nbsp;<span class="op" id="7161656">:=</span>&nbsp;<span class="ident" id="7161659"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161660">.</span><span class="ident" id="7161661"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7161662">.</span><span class="ident" id="7161663"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161667">switch</span>&nbsp;<span class="ident" id="7161674"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161675">.</span><span class="ident" id="7161676"><a href="/gostd/database/sql/fakedb_test.go.html#7150565">cmd</a></span>&nbsp;<span class="op" id="7161680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161683">case</span>&nbsp;<span class="string" id="7161688">&#34;WIPE&#34;</span><span class="op" id="7161694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7161698"><a href="/gostd/database/sql/fakedb_test.go.html#7161653">db</a></span><span class="op" id="7161700">.</span><span class="ident" id="7161701"><a href="/gostd/database/sql/fakedb_test.go.html#7152555">wipe</a></span><span class="op" id="7161705">(</span><span class="op" id="7161706">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161710">return</span>&nbsp;<span class="ident" id="7161717"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7161723">.</span><span class="ident" id="7161724"><a href="/gostd/database/sql/driver/driver.go.html#5253954">ResultNoRows</a></span><span class="op" id="7161736">,</span>&nbsp;<span class="builtintype" id="7161738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161743">case</span>&nbsp;<span class="string" id="7161748">&#34;CREATE&#34;</span><span class="op" id="7161756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161760">if</span>&nbsp;<span class="ident" id="7161763">err</span>&nbsp;<span class="op" id="7161767">:=</span>&nbsp;<span class="ident" id="7161770"><a href="/gostd/database/sql/fakedb_test.go.html#7161653">db</a></span><span class="op" id="7161772">.</span><span class="ident" id="7161773"><a href="/gostd/database/sql/fakedb_test.go.html#7152638">createTable</a></span><span class="op" id="7161784">(</span><span class="ident" id="7161785"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161786">.</span><span class="ident" id="7161787"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7161792">,</span>&nbsp;<span class="ident" id="7161794"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161795">.</span><span class="ident" id="7161796"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span><span class="op" id="7161803">,</span>&nbsp;<span class="ident" id="7161805"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161806">.</span><span class="ident" id="7161807"><a href="/gostd/database/sql/fakedb_test.go.html#7150689">colType</a></span><span class="op" id="7161814">)</span><span class="op" id="7161815">;</span>&nbsp;<span class="ident" id="7161817"><a href="/gostd/database/sql/fakedb_test.go.html#7161763">err</a></span>&nbsp;<span class="op" id="7161821">!=</span>&nbsp;<span class="builtintype" id="7161824">nil</span>&nbsp;<span class="op" id="7161828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161833">return</span>&nbsp;<span class="builtintype" id="7161840">nil</span><span class="op" id="7161843">,</span>&nbsp;<span class="ident" id="7161845"><a href="/gostd/database/sql/fakedb_test.go.html#7161763">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7161851">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161855">return</span>&nbsp;<span class="ident" id="7161862"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7161868">.</span><span class="ident" id="7161869"><a href="/gostd/database/sql/driver/driver.go.html#5253954">ResultNoRows</a></span><span class="op" id="7161881">,</span>&nbsp;<span class="builtintype" id="7161883">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161888">case</span>&nbsp;<span class="string" id="7161893">&#34;INSERT&#34;</span><span class="op" id="7161901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161905">return</span>&nbsp;<span class="ident" id="7161912"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7161913">.</span><span class="ident" id="7161914"><a href="/gostd/database/sql/fakedb_test.go.html#7162433">execInsert</a></span><span class="op" id="7161924">(</span><span class="ident" id="7161925"><a href="/gostd/database/sql/fakedb_test.go.html#7161407">args</a></span><span class="op" id="7161929">,</span>&nbsp;<span class="builtintype" id="7161931">true</span><span class="op" id="7161935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7161938">case</span>&nbsp;<span class="string" id="7161943">&#34;NOSERT&#34;</span><span class="op" id="7161951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7161955">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7162035">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162079">return</span>&nbsp;<span class="ident" id="7162086"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7162087">.</span><span class="ident" id="7162088"><a href="/gostd/database/sql/fakedb_test.go.html#7162433">execInsert</a></span><span class="op" id="7162098">(</span><span class="ident" id="7162099"><a href="/gostd/database/sql/fakedb_test.go.html#7161407">args</a></span><span class="op" id="7162103">,</span>&nbsp;<span class="builtintype" id="7162105">false</span><span class="op" id="7162110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162116"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7162119">.</span><span class="ident" id="7162120"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="7162126">(</span><span class="string" id="7162127">&#34;EXEC&nbsp;statement,&nbsp;cmd=%q:&nbsp;%#v\n&#34;</span><span class="op" id="7162158">,</span>&nbsp;<span class="ident" id="7162160"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7162161">.</span><span class="ident" id="7162162"><a href="/gostd/database/sql/fakedb_test.go.html#7150565">cmd</a></span><span class="op" id="7162165">,</span>&nbsp;<span class="ident" id="7162167"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7162168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162171">return</span>&nbsp;<span class="builtintype" id="7162178">nil</span><span class="op" id="7162181">,</span>&nbsp;<span class="ident" id="7162183"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7162186">.</span><span class="ident" id="7162187"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7162193">(</span><span class="string" id="7162194">&#34;unimplemented&nbsp;statement&nbsp;Exec&nbsp;command&nbsp;type&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7162243">,</span>&nbsp;<span class="ident" id="7162245"><a href="/gostd/database/sql/fakedb_test.go.html#7161389">s</a></span><span class="op" id="7162246">.</span><span class="ident" id="7162247"><a href="/gostd/database/sql/fakedb_test.go.html#7150565">cmd</a></span><span class="op" id="7162250">)</span><br>
<span class="lineno">560</span><span class="op" id="7162252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7162255">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;true,&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="7162307">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;false&nbsp;do&nbsp;prep-work&nbsp;and&nbsp;error&nbsp;checking,&nbsp;but&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="7162376">//&nbsp;actually&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno">565</span><span class="keyword" id="7162414">func</span>&nbsp;<span class="op" id="7162419">(</span><span class="ident" id="7162420">s</span>&nbsp;<span class="op" id="7162422">*</span><span class="ident" id="7162423"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7162431">)</span>&nbsp;<span class="ident" id="7162433">execInsert</span><span class="op" id="7162443">(</span><span class="ident" id="7162444">args</span>&nbsp;<span class="op" id="7162449">[</span><span class="op" id="7162450">]</span><span class="ident" id="7162451"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7162457">.</span><span class="ident" id="7162458"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7162463">,</span>&nbsp;<span class="ident" id="7162465">doInsert</span>&nbsp;<span class="builtintype" id="7162474">bool</span><span class="op" id="7162478">)</span>&nbsp;<span class="op" id="7162480">(</span><span class="ident" id="7162481"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7162487">.</span><span class="ident" id="7162488"><a href="/gostd/database/sql/driver/driver.go.html#5250891">Result</a></span><span class="op" id="7162494">,</span>&nbsp;<span class="builtintype" id="7162496">error</span><span class="op" id="7162501">)</span>&nbsp;<span class="op" id="7162503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162506">db</span>&nbsp;<span class="op" id="7162509">:=</span>&nbsp;<span class="ident" id="7162512"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7162513">.</span><span class="ident" id="7162514"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7162515">.</span><span class="ident" id="7162516"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162520">if</span>&nbsp;<span class="builtinfunc" id="7162523">len</span><span class="op" id="7162526">(</span><span class="ident" id="7162527"><a href="/gostd/database/sql/fakedb_test.go.html#7162444">args</a></span><span class="op" id="7162531">)</span>&nbsp;<span class="op" id="7162533">!=</span>&nbsp;<span class="ident" id="7162536"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7162537">.</span><span class="ident" id="7162538"><a href="/gostd/database/sql/fakedb_test.go.html#7150823">placeholders</a></span>&nbsp;<span class="op" id="7162551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7162555">panic</span><span class="op" id="7162560">(</span><span class="string" id="7162561">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7162619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162622">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162625"><a href="/gostd/database/sql/fakedb_test.go.html#7162506">db</a></span><span class="op" id="7162627">.</span><span class="ident" id="7162628"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7162630">.</span><span class="ident" id="7162631"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7162635">(</span><span class="op" id="7162636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162639">t</span><span class="op" id="7162640">,</span>&nbsp;<span class="ident" id="7162642">ok</span>&nbsp;<span class="op" id="7162645">:=</span>&nbsp;<span class="ident" id="7162648"><a href="/gostd/database/sql/fakedb_test.go.html#7162506">db</a></span><span class="op" id="7162650">.</span><span class="ident" id="7162651"><a href="/gostd/database/sql/fakedb_test.go.html#7153213">table</a></span><span class="op" id="7162656">(</span><span class="ident" id="7162657"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7162658">.</span><span class="ident" id="7162659"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7162664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162667"><a href="/gostd/database/sql/fakedb_test.go.html#7162506">db</a></span><span class="op" id="7162669">.</span><span class="ident" id="7162670"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7162672">.</span><span class="ident" id="7162673"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7162679">(</span><span class="op" id="7162680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162683">if</span>&nbsp;<span class="op" id="7162686">!</span><span class="ident" id="7162687"><a href="/gostd/database/sql/fakedb_test.go.html#7162642">ok</a></span>&nbsp;<span class="op" id="7162690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162694">return</span>&nbsp;<span class="builtintype" id="7162701">nil</span><span class="op" id="7162704">,</span>&nbsp;<span class="ident" id="7162706"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7162709">.</span><span class="ident" id="7162710"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7162716">(</span><span class="string" id="7162717">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7162749">,</span>&nbsp;<span class="ident" id="7162751"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7162752">.</span><span class="ident" id="7162753"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7162758">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162765"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7162766">.</span><span class="ident" id="7162767"><a href="/gostd/database/sql/fakedb_test.go.html#7149754">mu</a></span><span class="op" id="7162769">.</span><span class="ident" id="7162770"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7162774">(</span><span class="op" id="7162775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162778">defer</span>&nbsp;<span class="ident" id="7162784"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7162785">.</span><span class="ident" id="7162786"><a href="/gostd/database/sql/fakedb_test.go.html#7149754">mu</a></span><span class="op" id="7162788">.</span><span class="ident" id="7162789"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7162795">(</span><span class="op" id="7162796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162800">var</span>&nbsp;<span class="ident" id="7162804">cols</span>&nbsp;<span class="op" id="7162809">[</span><span class="op" id="7162810">]</span><span class="keyword" id="7162811">interface</span><span class="op" id="7162820">{</span><span class="op" id="7162821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162824">if</span>&nbsp;<span class="ident" id="7162827"><a href="/gostd/database/sql/fakedb_test.go.html#7162465">doInsert</a></span>&nbsp;<span class="op" id="7162836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162840"><a href="/gostd/database/sql/fakedb_test.go.html#7162804">cols</a></span>&nbsp;<span class="op" id="7162845">=</span>&nbsp;<span class="builtinfunc" id="7162847">make</span><span class="op" id="7162851">(</span><span class="op" id="7162852">[</span><span class="op" id="7162853">]</span><span class="keyword" id="7162854">interface</span><span class="op" id="7162863">{</span><span class="op" id="7162864">}</span><span class="op" id="7162865">,</span>&nbsp;<span class="builtinfunc" id="7162867">len</span><span class="op" id="7162870">(</span><span class="ident" id="7162871"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7162872">.</span><span class="ident" id="7162873"><a href="/gostd/database/sql/fakedb_test.go.html#7149774">colname</a></span><span class="op" id="7162880">)</span><span class="op" id="7162881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7162884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162887">argPos</span>&nbsp;<span class="op" id="7162894">:=</span>&nbsp;<span class="num" id="7162897">0</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162900">for</span>&nbsp;<span class="ident" id="7162904">n</span><span class="op" id="7162905">,</span>&nbsp;<span class="ident" id="7162907">colname</span>&nbsp;<span class="op" id="7162915">:=</span>&nbsp;<span class="keyword" id="7162918">range</span>&nbsp;<span class="ident" id="7162924"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7162925">.</span><span class="ident" id="7162926"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7162934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7162938">colidx</span>&nbsp;<span class="op" id="7162945">:=</span>&nbsp;<span class="ident" id="7162948"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7162949">.</span><span class="ident" id="7162950"><a href="/gostd/database/sql/fakedb_test.go.html#7149844">columnIndex</a></span><span class="op" id="7162961">(</span><span class="ident" id="7162962"><a href="/gostd/database/sql/fakedb_test.go.html#7162907">colname</a></span><span class="op" id="7162969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162973">if</span>&nbsp;<span class="ident" id="7162976"><a href="/gostd/database/sql/fakedb_test.go.html#7162938">colidx</a></span>&nbsp;<span class="op" id="7162983">==</span>&nbsp;<span class="op" id="7162986">-</span><span class="num" id="7162987">1</span>&nbsp;<span class="op" id="7162989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7162994">return</span>&nbsp;<span class="builtintype" id="7163001">nil</span><span class="op" id="7163004">,</span>&nbsp;<span class="ident" id="7163006"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7163009">.</span><span class="ident" id="7163010"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7163016">(</span><span class="string" id="7163017">&#34;fakedb:&nbsp;column&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&nbsp;or&nbsp;dropped&nbsp;since&nbsp;prepared&nbsp;statement&nbsp;was&nbsp;created&#34;</span><span class="op" id="7163098">,</span>&nbsp;<span class="ident" id="7163100"><a href="/gostd/database/sql/fakedb_test.go.html#7162907">colname</a></span><span class="op" id="7163107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163111">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163115">var</span>&nbsp;<span class="ident" id="7163119">val</span>&nbsp;<span class="keyword" id="7163123">interface</span><span class="op" id="7163132">{</span><span class="op" id="7163133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163137">if</span>&nbsp;<span class="ident" id="7163140">strvalue</span><span class="op" id="7163148">,</span>&nbsp;<span class="ident" id="7163150">ok</span>&nbsp;<span class="op" id="7163153">:=</span>&nbsp;<span class="ident" id="7163156"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7163157">.</span><span class="ident" id="7163158"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span><span class="op" id="7163166">[</span><span class="ident" id="7163167"><a href="/gostd/database/sql/fakedb_test.go.html#7162904">n</a></span><span class="op" id="7163168">]</span><span class="op" id="7163169">.</span><span class="op" id="7163170">(</span><span class="builtintype" id="7163171">string</span><span class="op" id="7163177">)</span><span class="op" id="7163178">;</span>&nbsp;<span class="ident" id="7163180"><a href="/gostd/database/sql/fakedb_test.go.html#7163150">ok</a></span>&nbsp;<span class="op" id="7163183">&amp;&amp;</span>&nbsp;<span class="ident" id="7163186"><a href="/gostd/database/sql/fakedb_test.go.html#7163140">strvalue</a></span>&nbsp;<span class="op" id="7163195">==</span>&nbsp;<span class="string" id="7163198">&#34;?&#34;</span>&nbsp;<span class="op" id="7163202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163207"><a href="/gostd/database/sql/fakedb_test.go.html#7163119">val</a></span>&nbsp;<span class="op" id="7163211">=</span>&nbsp;<span class="ident" id="7163213"><a href="/gostd/database/sql/fakedb_test.go.html#7162444">args</a></span><span class="op" id="7163217">[</span><span class="ident" id="7163218"><a href="/gostd/database/sql/fakedb_test.go.html#7162887">argPos</a></span><span class="op" id="7163224">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163229"><a href="/gostd/database/sql/fakedb_test.go.html#7162887">argPos</a></span><span class="op" id="7163235">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163240">}</span>&nbsp;<span class="keyword" id="7163242">else</span>&nbsp;<span class="op" id="7163247">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163252"><a href="/gostd/database/sql/fakedb_test.go.html#7163119">val</a></span>&nbsp;<span class="op" id="7163256">=</span>&nbsp;<span class="ident" id="7163258"><a href="/gostd/database/sql/fakedb_test.go.html#7162420">s</a></span><span class="op" id="7163259">.</span><span class="ident" id="7163260"><a href="/gostd/database/sql/fakedb_test.go.html#7150735">colValue</a></span><span class="op" id="7163268">[</span><span class="ident" id="7163269"><a href="/gostd/database/sql/fakedb_test.go.html#7162904">n</a></span><span class="op" id="7163270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163278">if</span>&nbsp;<span class="ident" id="7163281"><a href="/gostd/database/sql/fakedb_test.go.html#7162465">doInsert</a></span>&nbsp;<span class="op" id="7163290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163295"><a href="/gostd/database/sql/fakedb_test.go.html#7162804">cols</a></span><span class="op" id="7163299">[</span><span class="ident" id="7163300"><a href="/gostd/database/sql/fakedb_test.go.html#7162938">colidx</a></span><span class="op" id="7163306">]</span>&nbsp;<span class="op" id="7163308">=</span>&nbsp;<span class="ident" id="7163310"><a href="/gostd/database/sql/fakedb_test.go.html#7163119">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163316">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163323">if</span>&nbsp;<span class="ident" id="7163326"><a href="/gostd/database/sql/fakedb_test.go.html#7162465">doInsert</a></span>&nbsp;<span class="op" id="7163335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163339"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7163340">.</span><span class="ident" id="7163341"><a href="/gostd/database/sql/fakedb_test.go.html#7149810">rows</a></span>&nbsp;<span class="op" id="7163346">=</span>&nbsp;<span class="builtinfunc" id="7163348">append</span><span class="op" id="7163354">(</span><span class="ident" id="7163355"><a href="/gostd/database/sql/fakedb_test.go.html#7162639">t</a></span><span class="op" id="7163356">.</span><span class="ident" id="7163357"><a href="/gostd/database/sql/fakedb_test.go.html#7149810">rows</a></span><span class="op" id="7163361">,</span>&nbsp;<span class="op" id="7163363">&amp;</span><span class="ident" id="7163364"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><span class="op" id="7163367">{</span><span class="ident" id="7163368"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7163372">:</span>&nbsp;<span class="ident" id="7163374"><a href="/gostd/database/sql/fakedb_test.go.html#7162804">cols</a></span><span class="op" id="7163378">}</span><span class="op" id="7163379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163382">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163385">return</span>&nbsp;<span class="ident" id="7163392"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7163398">.</span><span class="ident" id="7163399"><a href="/gostd/database/sql/driver/driver.go.html#5253531">RowsAffected</a></span><span class="op" id="7163411">(</span><span class="num" id="7163412">1</span><span class="op" id="7163413">)</span><span class="op" id="7163414">,</span>&nbsp;<span class="builtintype" id="7163416">nil</span><br>
<span class="lineno"></span><span class="op" id="7163420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7163423">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7163462">var</span>&nbsp;<span class="ident" id="7163466">hookQueryBadConn</span>&nbsp;<span class="keyword" id="7163483">func</span><span class="op" id="7163487">(</span><span class="op" id="7163488">)</span>&nbsp;<span class="builtintype" id="7163490">bool</span><br>
<span class="lineno">610</span><br>
<span class="lineno"></span><span class="keyword" id="7163496">func</span>&nbsp;<span class="op" id="7163501">(</span><span class="ident" id="7163502">s</span>&nbsp;<span class="op" id="7163504">*</span><span class="ident" id="7163505"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7163513">)</span>&nbsp;<span class="ident" id="7163515">Query</span><span class="op" id="7163520">(</span><span class="ident" id="7163521">args</span>&nbsp;<span class="op" id="7163526">[</span><span class="op" id="7163527">]</span><span class="ident" id="7163528"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7163534">.</span><span class="ident" id="7163535"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7163540">)</span>&nbsp;<span class="op" id="7163542">(</span><span class="ident" id="7163543"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7163549">.</span><span class="ident" id="7163550"><a href="/gostd/database/sql/driver/driver.go.html#5252630">Rows</a></span><span class="op" id="7163554">,</span>&nbsp;<span class="builtintype" id="7163556">error</span><span class="op" id="7163561">)</span>&nbsp;<span class="op" id="7163563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163566">if</span>&nbsp;<span class="ident" id="7163569"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7163570">.</span><span class="ident" id="7163571"><a href="/gostd/database/sql/fakedb_test.go.html#7150594">closed</a></span>&nbsp;<span class="op" id="7163578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163582">return</span>&nbsp;<span class="builtintype" id="7163589">nil</span><span class="op" id="7163592">,</span>&nbsp;<span class="ident" id="7163594"><a href="/gostd/database/sql/fakedb_test.go.html#7161250">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163605">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163609">if</span>&nbsp;<span class="ident" id="7163612"><a href="/gostd/database/sql/fakedb_test.go.html#7163466">hookQueryBadConn</a></span>&nbsp;<span class="op" id="7163629">!=</span>&nbsp;<span class="builtintype" id="7163632">nil</span>&nbsp;<span class="op" id="7163636">&amp;&amp;</span>&nbsp;<span class="ident" id="7163639"><a href="/gostd/database/sql/fakedb_test.go.html#7163466">hookQueryBadConn</a></span><span class="op" id="7163655">(</span><span class="op" id="7163656">)</span>&nbsp;<span class="op" id="7163658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163662">return</span>&nbsp;<span class="builtintype" id="7163669">nil</span><span class="op" id="7163672">,</span>&nbsp;<span class="ident" id="7163674"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7163680">.</span><span class="ident" id="7163681"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163697">err</span>&nbsp;<span class="op" id="7163701">:=</span>&nbsp;<span class="ident" id="7163704"><a href="/gostd/database/sql/fakedb_test.go.html#7155193">checkSubsetTypes</a></span><span class="op" id="7163720">(</span><span class="ident" id="7163721"><a href="/gostd/database/sql/fakedb_test.go.html#7163521">args</a></span><span class="op" id="7163725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163728">if</span>&nbsp;<span class="ident" id="7163731"><a href="/gostd/database/sql/fakedb_test.go.html#7163697">err</a></span>&nbsp;<span class="op" id="7163735">!=</span>&nbsp;<span class="builtintype" id="7163738">nil</span>&nbsp;<span class="op" id="7163742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163746">return</span>&nbsp;<span class="builtintype" id="7163753">nil</span><span class="op" id="7163756">,</span>&nbsp;<span class="ident" id="7163758"><a href="/gostd/database/sql/fakedb_test.go.html#7163697">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163767">db</span>&nbsp;<span class="op" id="7163770">:=</span>&nbsp;<span class="ident" id="7163773"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7163774">.</span><span class="ident" id="7163775"><a href="/gostd/database/sql/fakedb_test.go.html#7150519">c</a></span><span class="op" id="7163776">.</span><span class="ident" id="7163777"><a href="/gostd/database/sql/fakedb_test.go.html#7150205">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163781">if</span>&nbsp;<span class="builtinfunc" id="7163784">len</span><span class="op" id="7163787">(</span><span class="ident" id="7163788"><a href="/gostd/database/sql/fakedb_test.go.html#7163521">args</a></span><span class="op" id="7163792">)</span>&nbsp;<span class="op" id="7163794">!=</span>&nbsp;<span class="ident" id="7163797"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7163798">.</span><span class="ident" id="7163799"><a href="/gostd/database/sql/fakedb_test.go.html#7150823">placeholders</a></span>&nbsp;<span class="op" id="7163812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7163816">panic</span><span class="op" id="7163821">(</span><span class="string" id="7163822">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7163880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7163883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163887"><a href="/gostd/database/sql/fakedb_test.go.html#7163767">db</a></span><span class="op" id="7163889">.</span><span class="ident" id="7163890"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7163892">.</span><span class="ident" id="7163893"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7163897">(</span><span class="op" id="7163898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163901">t</span><span class="op" id="7163902">,</span>&nbsp;<span class="ident" id="7163904">ok</span>&nbsp;<span class="op" id="7163907">:=</span>&nbsp;<span class="ident" id="7163910"><a href="/gostd/database/sql/fakedb_test.go.html#7163767">db</a></span><span class="op" id="7163912">.</span><span class="ident" id="7163913"><a href="/gostd/database/sql/fakedb_test.go.html#7153213">table</a></span><span class="op" id="7163918">(</span><span class="ident" id="7163919"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7163920">.</span><span class="ident" id="7163921"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7163926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7163929"><a href="/gostd/database/sql/fakedb_test.go.html#7163767">db</a></span><span class="op" id="7163931">.</span><span class="ident" id="7163932"><a href="/gostd/database/sql/fakedb_test.go.html#7149649">mu</a></span><span class="op" id="7163934">.</span><span class="ident" id="7163935"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7163941">(</span><span class="op" id="7163942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163945">if</span>&nbsp;<span class="op" id="7163948">!</span><span class="ident" id="7163949"><a href="/gostd/database/sql/fakedb_test.go.html#7163904">ok</a></span>&nbsp;<span class="op" id="7163952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7163956">return</span>&nbsp;<span class="builtintype" id="7163963">nil</span><span class="op" id="7163966">,</span>&nbsp;<span class="ident" id="7163968"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7163971">.</span><span class="ident" id="7163972"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7163978">(</span><span class="string" id="7163979">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7164011">,</span>&nbsp;<span class="ident" id="7164013"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164014">.</span><span class="ident" id="7164015"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span><span class="op" id="7164020">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164027">if</span>&nbsp;<span class="ident" id="7164030"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164031">.</span><span class="ident" id="7164032"><a href="/gostd/database/sql/fakedb_test.go.html#7150579">table</a></span>&nbsp;<span class="op" id="7164038">==</span>&nbsp;<span class="string" id="7164041">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7164054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164058">if</span>&nbsp;<span class="builtinfunc" id="7164061">len</span><span class="op" id="7164064">(</span><span class="ident" id="7164065"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164066">.</span><span class="ident" id="7164067"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span><span class="op" id="7164075">)</span>&nbsp;<span class="op" id="7164077">==</span>&nbsp;<span class="num" id="7164080">2</span>&nbsp;<span class="op" id="7164082">&amp;&amp;</span>&nbsp;<span class="ident" id="7164085"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164086">.</span><span class="ident" id="7164087"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span><span class="op" id="7164095">[</span><span class="num" id="7164096">0</span><span class="op" id="7164097">]</span>&nbsp;<span class="op" id="7164099">==</span>&nbsp;<span class="string" id="7164102">&#34;op&#34;</span>&nbsp;<span class="op" id="7164107">&amp;&amp;</span>&nbsp;<span class="ident" id="7164110"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164111">.</span><span class="ident" id="7164112"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span><span class="op" id="7164120">[</span><span class="num" id="7164121">1</span><span class="op" id="7164122">]</span>&nbsp;<span class="op" id="7164124">==</span>&nbsp;<span class="string" id="7164127">&#34;millis&#34;</span>&nbsp;<span class="op" id="7164136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164141">if</span>&nbsp;<span class="ident" id="7164144"><a href="/gostd/database/sql/fakedb_test.go.html#7163521">args</a></span><span class="op" id="7164148">[</span><span class="num" id="7164149">0</span><span class="op" id="7164150">]</span>&nbsp;<span class="op" id="7164152">==</span>&nbsp;<span class="string" id="7164155">&#34;sleep&#34;</span>&nbsp;<span class="op" id="7164163">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164169"><a href="/gostd/database/sql/fakedb_test.go.html#7148721">time</a></span><span class="op" id="7164173">.</span><span class="ident" id="7164174"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="7164179">(</span><span class="ident" id="7164180"><a href="/gostd/database/sql/fakedb_test.go.html#7148721">time</a></span><span class="op" id="7164184">.</span><span class="ident" id="7164185"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><span class="op" id="7164193">(</span><span class="ident" id="7164194"><a href="/gostd/database/sql/fakedb_test.go.html#7163521">args</a></span><span class="op" id="7164198">[</span><span class="num" id="7164199">1</span><span class="op" id="7164200">]</span><span class="op" id="7164201">.</span><span class="op" id="7164202">(</span><span class="builtintype" id="7164203">int64</span><span class="op" id="7164208">)</span><span class="op" id="7164209">)</span>&nbsp;<span class="op" id="7164211">*</span>&nbsp;<span class="ident" id="7164213"><a href="/gostd/database/sql/fakedb_test.go.html#7148721">time</a></span><span class="op" id="7164217">.</span><span class="ident" id="7164218"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="7164229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164245"><a href="/gostd/database/sql/fakedb_test.go.html#7163901">t</a></span><span class="op" id="7164246">.</span><span class="ident" id="7164247"><a href="/gostd/database/sql/fakedb_test.go.html#7149754">mu</a></span><span class="op" id="7164249">.</span><span class="ident" id="7164250"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="7164254">(</span><span class="op" id="7164255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164258">defer</span>&nbsp;<span class="ident" id="7164264"><a href="/gostd/database/sql/fakedb_test.go.html#7163901">t</a></span><span class="op" id="7164265">.</span><span class="ident" id="7164266"><a href="/gostd/database/sql/fakedb_test.go.html#7149754">mu</a></span><span class="op" id="7164268">.</span><span class="ident" id="7164269"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="7164275">(</span><span class="op" id="7164276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164280">colIdx</span>&nbsp;<span class="op" id="7164287">:=</span>&nbsp;<span class="builtinfunc" id="7164290">make</span><span class="op" id="7164294">(</span><span class="keyword" id="7164295">map</span><span class="op" id="7164298">[</span><span class="builtintype" id="7164299">string</span><span class="op" id="7164305">]</span><span class="builtintype" id="7164306">int</span><span class="op" id="7164309">)</span>&nbsp;<span class="comment" id="7164311">//&nbsp;select&nbsp;column&nbsp;name&nbsp;-&gt;&nbsp;column&nbsp;index&nbsp;in&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164359">for</span>&nbsp;<span class="ident" id="7164363">_</span><span class="op" id="7164364">,</span>&nbsp;<span class="ident" id="7164366">name</span>&nbsp;<span class="op" id="7164371">:=</span>&nbsp;<span class="keyword" id="7164374">range</span>&nbsp;<span class="ident" id="7164380"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164381">.</span><span class="ident" id="7164382"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7164390">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164394">idx</span>&nbsp;<span class="op" id="7164398">:=</span>&nbsp;<span class="ident" id="7164401"><a href="/gostd/database/sql/fakedb_test.go.html#7163901">t</a></span><span class="op" id="7164402">.</span><span class="ident" id="7164403"><a href="/gostd/database/sql/fakedb_test.go.html#7149844">columnIndex</a></span><span class="op" id="7164414">(</span><span class="ident" id="7164415"><a href="/gostd/database/sql/fakedb_test.go.html#7164366">name</a></span><span class="op" id="7164419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164423">if</span>&nbsp;<span class="ident" id="7164426"><a href="/gostd/database/sql/fakedb_test.go.html#7164394">idx</a></span>&nbsp;<span class="op" id="7164430">==</span>&nbsp;<span class="op" id="7164433">-</span><span class="num" id="7164434">1</span>&nbsp;<span class="op" id="7164436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164441">return</span>&nbsp;<span class="builtintype" id="7164448">nil</span><span class="op" id="7164451">,</span>&nbsp;<span class="ident" id="7164453"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7164456">.</span><span class="ident" id="7164457"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7164463">(</span><span class="string" id="7164464">&#34;fakedb:&nbsp;unknown&nbsp;column&nbsp;name&nbsp;%q&#34;</span><span class="op" id="7164496">,</span>&nbsp;<span class="ident" id="7164498"><a href="/gostd/database/sql/fakedb_test.go.html#7164366">name</a></span><span class="op" id="7164502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164510"><a href="/gostd/database/sql/fakedb_test.go.html#7164280">colIdx</a></span><span class="op" id="7164516">[</span><span class="ident" id="7164517"><a href="/gostd/database/sql/fakedb_test.go.html#7164366">name</a></span><span class="op" id="7164521">]</span>&nbsp;<span class="op" id="7164523">=</span>&nbsp;<span class="ident" id="7164525"><a href="/gostd/database/sql/fakedb_test.go.html#7164394">idx</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164534">mrows</span>&nbsp;<span class="op" id="7164540">:=</span>&nbsp;<span class="op" id="7164543">[</span><span class="op" id="7164544">]</span><span class="op" id="7164545">*</span><span class="ident" id="7164546"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><span class="op" id="7164549">{</span><span class="op" id="7164550">}</span><br>
<span class="lineno"></span><span class="ident" id="7164552">rows</span><span class="op" id="7164556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164559">for</span>&nbsp;<span class="ident" id="7164563">_</span><span class="op" id="7164564">,</span>&nbsp;<span class="ident" id="7164566">trow</span>&nbsp;<span class="op" id="7164571">:=</span>&nbsp;<span class="keyword" id="7164574">range</span>&nbsp;<span class="ident" id="7164580"><a href="/gostd/database/sql/fakedb_test.go.html#7163901">t</a></span><span class="op" id="7164581">.</span><span class="ident" id="7164582"><a href="/gostd/database/sql/fakedb_test.go.html#7149810">rows</a></span>&nbsp;<span class="op" id="7164587">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7164591">//&nbsp;Process&nbsp;the&nbsp;where&nbsp;clause,&nbsp;skipping&nbsp;non-match&nbsp;rows.&nbsp;This&nbsp;is&nbsp;lazy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7164660">//&nbsp;and&nbsp;just&nbsp;uses&nbsp;fmt.Sprintf(&#34;%v&#34;)&nbsp;to&nbsp;test&nbsp;equality.&nbsp;&nbsp;Good&nbsp;enough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7164728">//&nbsp;for&nbsp;test&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164748">for</span>&nbsp;<span class="ident" id="7164752">widx</span><span class="op" id="7164756">,</span>&nbsp;<span class="ident" id="7164758">wcol</span>&nbsp;<span class="op" id="7164763">:=</span>&nbsp;<span class="keyword" id="7164766">range</span>&nbsp;<span class="ident" id="7164772"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7164773">.</span><span class="ident" id="7164774"><a href="/gostd/database/sql/fakedb_test.go.html#7150897">whereCol</a></span>&nbsp;<span class="op" id="7164783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164788">idx</span>&nbsp;<span class="op" id="7164792">:=</span>&nbsp;<span class="ident" id="7164795"><a href="/gostd/database/sql/fakedb_test.go.html#7163901">t</a></span><span class="op" id="7164796">.</span><span class="ident" id="7164797"><a href="/gostd/database/sql/fakedb_test.go.html#7149844">columnIndex</a></span><span class="op" id="7164808">(</span><span class="ident" id="7164809"><a href="/gostd/database/sql/fakedb_test.go.html#7164758">wcol</a></span><span class="op" id="7164813">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164818">if</span>&nbsp;<span class="ident" id="7164821"><a href="/gostd/database/sql/fakedb_test.go.html#7164788">idx</a></span>&nbsp;<span class="op" id="7164825">==</span>&nbsp;<span class="op" id="7164828">-</span><span class="num" id="7164829">1</span>&nbsp;<span class="op" id="7164831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164837">return</span>&nbsp;<span class="builtintype" id="7164844">nil</span><span class="op" id="7164847">,</span>&nbsp;<span class="ident" id="7164849"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7164852">.</span><span class="ident" id="7164853"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="7164859">(</span><span class="string" id="7164860">&#34;db:&nbsp;invalid&nbsp;where&nbsp;clause&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7164896">,</span>&nbsp;<span class="ident" id="7164898"><a href="/gostd/database/sql/fakedb_test.go.html#7164758">wcol</a></span><span class="op" id="7164902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7164907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7164912">tcol</span>&nbsp;<span class="op" id="7164917">:=</span>&nbsp;<span class="ident" id="7164920"><a href="/gostd/database/sql/fakedb_test.go.html#7164566">trow</a></span><span class="op" id="7164924">.</span><span class="ident" id="7164925"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7164929">[</span><span class="ident" id="7164930"><a href="/gostd/database/sql/fakedb_test.go.html#7164788">idx</a></span><span class="op" id="7164933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7164938">if</span>&nbsp;<span class="ident" id="7164941">bs</span><span class="op" id="7164943">,</span>&nbsp;<span class="ident" id="7164945">ok</span>&nbsp;<span class="op" id="7164948">:=</span>&nbsp;<span class="ident" id="7164951"><a href="/gostd/database/sql/fakedb_test.go.html#7164912">tcol</a></span><span class="op" id="7164955">.</span><span class="op" id="7164956">(</span><span class="op" id="7164957">[</span><span class="op" id="7164958">]</span><span class="builtintype" id="7164959">byte</span><span class="op" id="7164963">)</span><span class="op" id="7164964">;</span>&nbsp;<span class="ident" id="7164966"><a href="/gostd/database/sql/fakedb_test.go.html#7164945">ok</a></span>&nbsp;<span class="op" id="7164969">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7164975">//&nbsp;lazy&nbsp;hack&nbsp;to&nbsp;avoid&nbsp;sprintf&nbsp;%v&nbsp;on&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165024"><a href="/gostd/database/sql/fakedb_test.go.html#7164912">tcol</a></span>&nbsp;<span class="op" id="7165029">=</span>&nbsp;<span class="builtintype" id="7165031">string</span><span class="op" id="7165037">(</span><span class="ident" id="7165038"><a href="/gostd/database/sql/fakedb_test.go.html#7164941">bs</a></span><span class="op" id="7165040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165050">if</span>&nbsp;<span class="ident" id="7165053"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7165056">.</span><span class="ident" id="7165057"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7165064">(</span><span class="string" id="7165065">&#34;%v&#34;</span><span class="op" id="7165069">,</span>&nbsp;<span class="ident" id="7165071"><a href="/gostd/database/sql/fakedb_test.go.html#7164912">tcol</a></span><span class="op" id="7165075">)</span>&nbsp;<span class="op" id="7165077">!=</span>&nbsp;<span class="ident" id="7165080"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7165083">.</span><span class="ident" id="7165084"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7165091">(</span><span class="string" id="7165092">&#34;%v&#34;</span><span class="op" id="7165096">,</span>&nbsp;<span class="ident" id="7165098"><a href="/gostd/database/sql/fakedb_test.go.html#7163521">args</a></span><span class="op" id="7165102">[</span><span class="ident" id="7165103"><a href="/gostd/database/sql/fakedb_test.go.html#7164752">widx</a></span><span class="op" id="7165107">]</span><span class="op" id="7165108">)</span>&nbsp;<span class="op" id="7165110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165116">continue</span>&nbsp;<span class="ident" id="7165125"><a href="/gostd/database/sql/fakedb_test.go.html#7164552">rows</a></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165141">mrow</span>&nbsp;<span class="op" id="7165146">:=</span>&nbsp;<span class="op" id="7165149">&amp;</span><span class="ident" id="7165150"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><span class="op" id="7165153">{</span><span class="ident" id="7165154"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7165158">:</span>&nbsp;<span class="builtinfunc" id="7165160">make</span><span class="op" id="7165164">(</span><span class="op" id="7165165">[</span><span class="op" id="7165166">]</span><span class="keyword" id="7165167">interface</span><span class="op" id="7165176">{</span><span class="op" id="7165177">}</span><span class="op" id="7165178">,</span>&nbsp;<span class="builtinfunc" id="7165180">len</span><span class="op" id="7165183">(</span><span class="ident" id="7165184"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7165185">.</span><span class="ident" id="7165186"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span><span class="op" id="7165193">)</span><span class="op" id="7165194">)</span><span class="op" id="7165195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165199">for</span>&nbsp;<span class="ident" id="7165203">seli</span><span class="op" id="7165207">,</span>&nbsp;<span class="ident" id="7165209">name</span>&nbsp;<span class="op" id="7165214">:=</span>&nbsp;<span class="keyword" id="7165217">range</span>&nbsp;<span class="ident" id="7165223"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7165224">.</span><span class="ident" id="7165225"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span>&nbsp;<span class="op" id="7165233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165238"><a href="/gostd/database/sql/fakedb_test.go.html#7165141">mrow</a></span><span class="op" id="7165242">.</span><span class="ident" id="7165243"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7165247">[</span><span class="ident" id="7165248"><a href="/gostd/database/sql/fakedb_test.go.html#7165203">seli</a></span><span class="op" id="7165252">]</span>&nbsp;<span class="op" id="7165254">=</span>&nbsp;<span class="ident" id="7165256"><a href="/gostd/database/sql/fakedb_test.go.html#7164566">trow</a></span><span class="op" id="7165260">.</span><span class="ident" id="7165261"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span><span class="op" id="7165265">[</span><span class="ident" id="7165266"><a href="/gostd/database/sql/fakedb_test.go.html#7164280">colIdx</a></span><span class="op" id="7165272">[</span><span class="ident" id="7165273"><a href="/gostd/database/sql/fakedb_test.go.html#7165209">name</a></span><span class="op" id="7165277">]</span><span class="op" id="7165278">]</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165286"><a href="/gostd/database/sql/fakedb_test.go.html#7164534">mrows</a></span>&nbsp;<span class="op" id="7165292">=</span>&nbsp;<span class="builtinfunc" id="7165294">append</span><span class="op" id="7165300">(</span><span class="ident" id="7165301"><a href="/gostd/database/sql/fakedb_test.go.html#7164534">mrows</a></span><span class="op" id="7165306">,</span>&nbsp;<span class="ident" id="7165308"><a href="/gostd/database/sql/fakedb_test.go.html#7165141">mrow</a></span><span class="op" id="7165312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165319">cursor</span>&nbsp;<span class="op" id="7165326">:=</span>&nbsp;<span class="op" id="7165329">&amp;</span><span class="ident" id="7165330"><a href="/gostd/database/sql/fakedb_test.go.html#7165641">rowsCursor</a></span><span class="op" id="7165340">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165344"><a href="/gostd/database/sql/fakedb_test.go.html#7165679">pos</a></span><span class="op" id="7165347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165352">-</span><span class="num" id="7165353">1</span><span class="op" id="7165354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165358"><a href="/gostd/database/sql/fakedb_test.go.html#7165691">rows</a></span><span class="op" id="7165362">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7165366"><a href="/gostd/database/sql/fakedb_test.go.html#7164534">mrows</a></span><span class="op" id="7165371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165375"><a href="/gostd/database/sql/fakedb_test.go.html#7165662">cols</a></span><span class="op" id="7165379">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7165383"><a href="/gostd/database/sql/fakedb_test.go.html#7163502">s</a></span><span class="op" id="7165384">.</span><span class="ident" id="7165385"><a href="/gostd/database/sql/fakedb_test.go.html#7150608">colName</a></span><span class="op" id="7165392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165396"><a href="/gostd/database/sql/fakedb_test.go.html#7165784">errPos</a></span><span class="op" id="7165402">:</span>&nbsp;<span class="op" id="7165404">-</span><span class="num" id="7165405">1</span><span class="op" id="7165406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7165409">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165412">return</span>&nbsp;<span class="ident" id="7165419"><a href="/gostd/database/sql/fakedb_test.go.html#7165319">cursor</a></span><span class="op" id="7165425">,</span>&nbsp;<span class="builtintype" id="7165427">nil</span><br>
<span class="lineno"></span><span class="op" id="7165431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7165434">func</span>&nbsp;<span class="op" id="7165439">(</span><span class="ident" id="7165440">s</span>&nbsp;<span class="op" id="7165442">*</span><span class="ident" id="7165443"><a href="/gostd/database/sql/fakedb_test.go.html#7150500">fakeStmt</a></span><span class="op" id="7165451">)</span>&nbsp;<span class="ident" id="7165453">NumInput</span><span class="op" id="7165461">(</span><span class="op" id="7165462">)</span>&nbsp;<span class="builtintype" id="7165464">int</span>&nbsp;<span class="op" id="7165468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165471">return</span>&nbsp;<span class="ident" id="7165478"><a href="/gostd/database/sql/fakedb_test.go.html#7165440">s</a></span><span class="op" id="7165479">.</span><span class="ident" id="7165480"><a href="/gostd/database/sql/fakedb_test.go.html#7150823">placeholders</a></span><br>
<span class="lineno">695</span><span class="op" id="7165493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7165496">func</span>&nbsp;<span class="op" id="7165501">(</span><span class="ident" id="7165502">tx</span>&nbsp;<span class="op" id="7165505">*</span><span class="ident" id="7165506"><a href="/gostd/database/sql/fakedb_test.go.html#7150463">fakeTx</a></span><span class="op" id="7165512">)</span>&nbsp;<span class="ident" id="7165514">Commit</span><span class="op" id="7165520">(</span><span class="op" id="7165521">)</span>&nbsp;<span class="builtintype" id="7165523">error</span>&nbsp;<span class="op" id="7165529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165532"><a href="/gostd/database/sql/fakedb_test.go.html#7165502">tx</a></span><span class="op" id="7165534">.</span><span class="ident" id="7165535"><a href="/gostd/database/sql/fakedb_test.go.html#7150480">c</a></span><span class="op" id="7165536">.</span><span class="ident" id="7165537"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span>&nbsp;<span class="op" id="7165544">=</span>&nbsp;<span class="builtintype" id="7165546">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165551">return</span>&nbsp;<span class="builtintype" id="7165558">nil</span><br>
<span class="lineno">700</span><span class="op" id="7165562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7165565">func</span>&nbsp;<span class="op" id="7165570">(</span><span class="ident" id="7165571">tx</span>&nbsp;<span class="op" id="7165574">*</span><span class="ident" id="7165575"><a href="/gostd/database/sql/fakedb_test.go.html#7150463">fakeTx</a></span><span class="op" id="7165581">)</span>&nbsp;<span class="ident" id="7165583">Rollback</span><span class="op" id="7165591">(</span><span class="op" id="7165592">)</span>&nbsp;<span class="builtintype" id="7165594">error</span>&nbsp;<span class="op" id="7165600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165603"><a href="/gostd/database/sql/fakedb_test.go.html#7165571">tx</a></span><span class="op" id="7165605">.</span><span class="ident" id="7165606"><a href="/gostd/database/sql/fakedb_test.go.html#7150480">c</a></span><span class="op" id="7165607">.</span><span class="ident" id="7165608"><a href="/gostd/database/sql/fakedb_test.go.html#7150250">currTx</a></span>&nbsp;<span class="op" id="7165615">=</span>&nbsp;<span class="builtintype" id="7165617">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7165622">return</span>&nbsp;<span class="builtintype" id="7165629">nil</span><br>
<span class="lineno">705</span><span class="op" id="7165633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7165636">type</span>&nbsp;<span class="ident" id="7165641">rowsCursor</span>&nbsp;<span class="keyword" id="7165652">struct</span>&nbsp;<span class="op" id="7165659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165662">cols</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7165669">[</span><span class="op" id="7165670">]</span><span class="builtintype" id="7165671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165679">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7165686">int</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165691">rows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7165698">[</span><span class="op" id="7165699">]</span><span class="op" id="7165700">*</span><span class="ident" id="7165701"><a href="/gostd/database/sql/fakedb_test.go.html#7149969">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165706">closed</span>&nbsp;<span class="builtintype" id="7165713">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7165720">//&nbsp;errPos&nbsp;and&nbsp;err&nbsp;are&nbsp;for&nbsp;making&nbsp;Next&nbsp;return&nbsp;early&nbsp;with&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165784">errPos</span>&nbsp;<span class="builtintype" id="7165791">int</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165796">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7165803">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7165811">//&nbsp;a&nbsp;clone&nbsp;of&nbsp;slices&nbsp;to&nbsp;give&nbsp;out&nbsp;to&nbsp;clients,&nbsp;indexed&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7165872">//&nbsp;the&nbsp;original&nbsp;slice&#39;s&nbsp;first&nbsp;byte&nbsp;address.&nbsp;&nbsp;we&nbsp;clone&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7165932">//&nbsp;just&nbsp;so&nbsp;we&#39;re&nbsp;able&nbsp;to&nbsp;corrupt&nbsp;them&nbsp;on&nbsp;close.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7165981">bytesClone</span>&nbsp;<span class="keyword" id="7165992">map</span><span class="op" id="7165995">[</span><span class="op" id="7165996">*</span><span class="builtintype" id="7165997">byte</span><span class="op" id="7166001">]</span><span class="op" id="7166002">[</span><span class="op" id="7166003">]</span><span class="builtintype" id="7166004">byte</span><br>
<span class="lineno"></span><span class="op" id="7166009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7166012">func</span>&nbsp;<span class="op" id="7166017">(</span><span class="ident" id="7166018">rc</span>&nbsp;<span class="op" id="7166021">*</span><span class="ident" id="7166022"><a href="/gostd/database/sql/fakedb_test.go.html#7165641">rowsCursor</a></span><span class="op" id="7166032">)</span>&nbsp;<span class="ident" id="7166034">Close</span><span class="op" id="7166039">(</span><span class="op" id="7166040">)</span>&nbsp;<span class="builtintype" id="7166042">error</span>&nbsp;<span class="op" id="7166048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166051">if</span>&nbsp;<span class="op" id="7166054">!</span><span class="ident" id="7166055"><a href="/gostd/database/sql/fakedb_test.go.html#7166018">rc</a></span><span class="op" id="7166057">.</span><span class="ident" id="7166058"><a href="/gostd/database/sql/fakedb_test.go.html#7165706">closed</a></span>&nbsp;<span class="op" id="7166065">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166069">for</span>&nbsp;<span class="ident" id="7166073">_</span><span class="op" id="7166074">,</span>&nbsp;<span class="ident" id="7166076">bs</span>&nbsp;<span class="op" id="7166079">:=</span>&nbsp;<span class="keyword" id="7166082">range</span>&nbsp;<span class="ident" id="7166088"><a href="/gostd/database/sql/fakedb_test.go.html#7166018">rc</a></span><span class="op" id="7166090">.</span><span class="ident" id="7166091"><a href="/gostd/database/sql/fakedb_test.go.html#7165981">bytesClone</a></span>&nbsp;<span class="op" id="7166102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7166107"><a href="/gostd/database/sql/fakedb_test.go.html#7166076">bs</a></span><span class="op" id="7166109">[</span><span class="num" id="7166110">0</span><span class="op" id="7166111">]</span>&nbsp;<span class="op" id="7166113">=</span>&nbsp;<span class="num" id="7166115">255</span>&nbsp;<span class="comment" id="7166119">//&nbsp;first&nbsp;byte&nbsp;corrupted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7166151"><a href="/gostd/database/sql/fakedb_test.go.html#7166018">rc</a></span><span class="op" id="7166153">.</span><span class="ident" id="7166154"><a href="/gostd/database/sql/fakedb_test.go.html#7165706">closed</a></span>&nbsp;<span class="op" id="7166161">=</span>&nbsp;<span class="builtintype" id="7166163">true</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166169">return</span>&nbsp;<span class="builtintype" id="7166176">nil</span><br>
<span class="lineno"></span><span class="op" id="7166180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7166183">func</span>&nbsp;<span class="op" id="7166188">(</span><span class="ident" id="7166189">rc</span>&nbsp;<span class="op" id="7166192">*</span><span class="ident" id="7166193"><a href="/gostd/database/sql/fakedb_test.go.html#7165641">rowsCursor</a></span><span class="op" id="7166203">)</span>&nbsp;<span class="ident" id="7166205">Columns</span><span class="op" id="7166212">(</span><span class="op" id="7166213">)</span>&nbsp;<span class="op" id="7166215">[</span><span class="op" id="7166216">]</span><span class="builtintype" id="7166217">string</span>&nbsp;<span class="op" id="7166224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166227">return</span>&nbsp;<span class="ident" id="7166234"><a href="/gostd/database/sql/fakedb_test.go.html#7166189">rc</a></span><span class="op" id="7166236">.</span><span class="ident" id="7166237"><a href="/gostd/database/sql/fakedb_test.go.html#7165662">cols</a></span><br>
<span class="lineno">735</span><span class="op" id="7166242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7166245">var</span>&nbsp;<span class="ident" id="7166249">rowsCursorNextHook</span>&nbsp;<span class="keyword" id="7166268">func</span><span class="op" id="7166272">(</span><span class="ident" id="7166273">dest</span>&nbsp;<span class="op" id="7166278">[</span><span class="op" id="7166279">]</span><span class="ident" id="7166280"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7166286">.</span><span class="ident" id="7166287"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7166292">)</span>&nbsp;<span class="builtintype" id="7166294">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7166301">func</span>&nbsp;<span class="op" id="7166306">(</span><span class="ident" id="7166307">rc</span>&nbsp;<span class="op" id="7166310">*</span><span class="ident" id="7166311"><a href="/gostd/database/sql/fakedb_test.go.html#7165641">rowsCursor</a></span><span class="op" id="7166321">)</span>&nbsp;<span class="ident" id="7166323">Next</span><span class="op" id="7166327">(</span><span class="ident" id="7166328">dest</span>&nbsp;<span class="op" id="7166333">[</span><span class="op" id="7166334">]</span><span class="ident" id="7166335"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7166341">.</span><span class="ident" id="7166342"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7166347">)</span>&nbsp;<span class="builtintype" id="7166349">error</span>&nbsp;<span class="op" id="7166355">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166358">if</span>&nbsp;<span class="ident" id="7166361"><a href="/gostd/database/sql/fakedb_test.go.html#7166249">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7166380">!=</span>&nbsp;<span class="builtintype" id="7166383">nil</span>&nbsp;<span class="op" id="7166387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166391">return</span>&nbsp;<span class="ident" id="7166398"><a href="/gostd/database/sql/fakedb_test.go.html#7166249">rowsCursorNextHook</a></span><span class="op" id="7166416">(</span><span class="ident" id="7166417"><a href="/gostd/database/sql/fakedb_test.go.html#7166328">dest</a></span><span class="op" id="7166421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166428">if</span>&nbsp;<span class="ident" id="7166431"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166433">.</span><span class="ident" id="7166434"><a href="/gostd/database/sql/fakedb_test.go.html#7165706">closed</a></span>&nbsp;<span class="op" id="7166441">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166445">return</span>&nbsp;<span class="ident" id="7166452"><a href="/gostd/database/sql/fakedb_test.go.html#7148642">errors</a></span><span class="op" id="7166458">.</span><span class="ident" id="7166459"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="7166462">(</span><span class="string" id="7166463">&#34;fakedb:&nbsp;cursor&nbsp;is&nbsp;closed&#34;</span><span class="op" id="7166489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7166495"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166497">.</span><span class="ident" id="7166498"><a href="/gostd/database/sql/fakedb_test.go.html#7165679">pos</a></span><span class="op" id="7166501">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166505">if</span>&nbsp;<span class="ident" id="7166508"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166510">.</span><span class="ident" id="7166511"><a href="/gostd/database/sql/fakedb_test.go.html#7165679">pos</a></span>&nbsp;<span class="op" id="7166515">==</span>&nbsp;<span class="ident" id="7166518"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166520">.</span><span class="ident" id="7166521"><a href="/gostd/database/sql/fakedb_test.go.html#7165784">errPos</a></span>&nbsp;<span class="op" id="7166528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166532">return</span>&nbsp;<span class="ident" id="7166539"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166541">.</span><span class="ident" id="7166542"><a href="/gostd/database/sql/fakedb_test.go.html#7165796">err</a></span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166550">if</span>&nbsp;<span class="ident" id="7166553"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166555">.</span><span class="ident" id="7166556"><a href="/gostd/database/sql/fakedb_test.go.html#7165679">pos</a></span>&nbsp;<span class="op" id="7166560">&gt;=</span>&nbsp;<span class="builtinfunc" id="7166563">len</span><span class="op" id="7166566">(</span><span class="ident" id="7166567"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166569">.</span><span class="ident" id="7166570"><a href="/gostd/database/sql/fakedb_test.go.html#7165691">rows</a></span><span class="op" id="7166574">)</span>&nbsp;<span class="op" id="7166576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166580">return</span>&nbsp;<span class="ident" id="7166587"><a href="/gostd/database/sql/fakedb_test.go.html#7148659">io</a></span><span class="op" id="7166589">.</span><span class="ident" id="7166590"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="comment" id="7166594">//&nbsp;per&nbsp;interface&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7166617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7166620">for</span>&nbsp;<span class="ident" id="7166624">i</span><span class="op" id="7166625">,</span>&nbsp;<span class="ident" id="7166627">v</span>&nbsp;<span class="op" id="7166629">:=</span>&nbsp;<span class="keyword" id="7166632">range</span>&nbsp;<span class="ident" id="7166638"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166640">.</span><span class="ident" id="7166641"><a href="/gostd/database/sql/fakedb_test.go.html#7165691">rows</a></span><span class="op" id="7166645">[</span><span class="ident" id="7166646"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7166648">.</span><span class="ident" id="7166649"><a href="/gostd/database/sql/fakedb_test.go.html#7165679">pos</a></span><span class="op" id="7166652">]</span><span class="op" id="7166653">.</span><span class="ident" id="7166654"><a href="/gostd/database/sql/fakedb_test.go.html#7149983">cols</a></span>&nbsp;<span class="op" id="7166659">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166663">//&nbsp;TODO(bradfitz):&nbsp;convert&nbsp;to&nbsp;subset&nbsp;types?&nbsp;naah,&nbsp;I</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166717">//&nbsp;think&nbsp;the&nbsp;subset&nbsp;types&nbsp;should&nbsp;only&nbsp;be&nbsp;input&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166769">//&nbsp;driver,&nbsp;but&nbsp;the&nbsp;sql&nbsp;package&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166827">//&nbsp;a&nbsp;wider&nbsp;range&nbsp;of&nbsp;types&nbsp;coming&nbsp;out&nbsp;of&nbsp;drivers.&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166882">//&nbsp;for&nbsp;ease&nbsp;of&nbsp;drivers,&nbsp;and&nbsp;to&nbsp;prevent&nbsp;drivers&nbsp;from</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7166936">//&nbsp;messing&nbsp;up&nbsp;conversions&nbsp;or&nbsp;doing&nbsp;them&nbsp;differently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7166991"><a href="/gostd/database/sql/fakedb_test.go.html#7166328">dest</a></span><span class="op" id="7166995">[</span><span class="ident" id="7166996"><a href="/gostd/database/sql/fakedb_test.go.html#7166624">i</a></span><span class="op" id="7166997">]</span>&nbsp;<span class="op" id="7166999">=</span>&nbsp;<span class="ident" id="7167001"><a href="/gostd/database/sql/fakedb_test.go.html#7166627">v</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167006">if</span>&nbsp;<span class="ident" id="7167009">bs</span><span class="op" id="7167011">,</span>&nbsp;<span class="ident" id="7167013">ok</span>&nbsp;<span class="op" id="7167016">:=</span>&nbsp;<span class="ident" id="7167019"><a href="/gostd/database/sql/fakedb_test.go.html#7166627">v</a></span><span class="op" id="7167020">.</span><span class="op" id="7167021">(</span><span class="op" id="7167022">[</span><span class="op" id="7167023">]</span><span class="builtintype" id="7167024">byte</span><span class="op" id="7167028">)</span><span class="op" id="7167029">;</span>&nbsp;<span class="ident" id="7167031"><a href="/gostd/database/sql/fakedb_test.go.html#7167013">ok</a></span>&nbsp;<span class="op" id="7167034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167039">if</span>&nbsp;<span class="ident" id="7167042"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7167044">.</span><span class="ident" id="7167045"><a href="/gostd/database/sql/fakedb_test.go.html#7165981">bytesClone</a></span>&nbsp;<span class="op" id="7167056">==</span>&nbsp;<span class="builtintype" id="7167059">nil</span>&nbsp;<span class="op" id="7167063">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7167069"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7167071">.</span><span class="ident" id="7167072"><a href="/gostd/database/sql/fakedb_test.go.html#7165981">bytesClone</a></span>&nbsp;<span class="op" id="7167083">=</span>&nbsp;<span class="builtinfunc" id="7167085">make</span><span class="op" id="7167089">(</span><span class="keyword" id="7167090">map</span><span class="op" id="7167093">[</span><span class="op" id="7167094">*</span><span class="builtintype" id="7167095">byte</span><span class="op" id="7167099">]</span><span class="op" id="7167100">[</span><span class="op" id="7167101">]</span><span class="builtintype" id="7167102">byte</span><span class="op" id="7167106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7167116">clone</span><span class="op" id="7167121">,</span>&nbsp;<span class="ident" id="7167123">ok</span>&nbsp;<span class="op" id="7167126">:=</span>&nbsp;<span class="ident" id="7167129"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7167131">.</span><span class="ident" id="7167132"><a href="/gostd/database/sql/fakedb_test.go.html#7165981">bytesClone</a></span><span class="op" id="7167142">[</span><span class="op" id="7167143">&amp;</span><span class="ident" id="7167144"><a href="/gostd/database/sql/fakedb_test.go.html#7167009">bs</a></span><span class="op" id="7167146">[</span><span class="num" id="7167147">0</span><span class="op" id="7167148">]</span><span class="op" id="7167149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167154">if</span>&nbsp;<span class="op" id="7167157">!</span><span class="ident" id="7167158"><a href="/gostd/database/sql/fakedb_test.go.html#7167123">ok</a></span>&nbsp;<span class="op" id="7167161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7167167"><a href="/gostd/database/sql/fakedb_test.go.html#7167116">clone</a></span>&nbsp;<span class="op" id="7167173">=</span>&nbsp;<span class="builtinfunc" id="7167175">make</span><span class="op" id="7167179">(</span><span class="op" id="7167180">[</span><span class="op" id="7167181">]</span><span class="builtintype" id="7167182">byte</span><span class="op" id="7167186">,</span>&nbsp;<span class="builtinfunc" id="7167188">len</span><span class="op" id="7167191">(</span><span class="ident" id="7167192"><a href="/gostd/database/sql/fakedb_test.go.html#7167009">bs</a></span><span class="op" id="7167194">)</span><span class="op" id="7167195">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7167201">copy</span><span class="op" id="7167205">(</span><span class="ident" id="7167206"><a href="/gostd/database/sql/fakedb_test.go.html#7167116">clone</a></span><span class="op" id="7167211">,</span>&nbsp;<span class="ident" id="7167213"><a href="/gostd/database/sql/fakedb_test.go.html#7167009">bs</a></span><span class="op" id="7167215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7167221"><a href="/gostd/database/sql/fakedb_test.go.html#7166307">rc</a></span><span class="op" id="7167223">.</span><span class="ident" id="7167224"><a href="/gostd/database/sql/fakedb_test.go.html#7165981">bytesClone</a></span><span class="op" id="7167234">[</span><span class="op" id="7167235">&amp;</span><span class="ident" id="7167236"><a href="/gostd/database/sql/fakedb_test.go.html#7167009">bs</a></span><span class="op" id="7167238">[</span><span class="num" id="7167239">0</span><span class="op" id="7167240">]</span><span class="op" id="7167241">]</span>&nbsp;<span class="op" id="7167243">=</span>&nbsp;<span class="ident" id="7167245"><a href="/gostd/database/sql/fakedb_test.go.html#7167116">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7167259"><a href="/gostd/database/sql/fakedb_test.go.html#7166328">dest</a></span><span class="op" id="7167263">[</span><span class="ident" id="7167264"><a href="/gostd/database/sql/fakedb_test.go.html#7166624">i</a></span><span class="op" id="7167265">]</span>&nbsp;<span class="op" id="7167267">=</span>&nbsp;<span class="ident" id="7167269"><a href="/gostd/database/sql/fakedb_test.go.html#7167116">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167277">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167283">return</span>&nbsp;<span class="builtintype" id="7167290">nil</span><br>
<span class="lineno"></span><span class="op" id="7167294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7167297">//&nbsp;fakeDriverString&nbsp;is&nbsp;like&nbsp;driver.String,&nbsp;but&nbsp;indirects&nbsp;pointers&nbsp;like</span><br>
<span class="lineno">780</span><span class="comment" id="7167368">//&nbsp;DefaultValueConverter.</span><br>
<span class="lineno"></span><span class="comment" id="7167394">//</span><br>
<span class="lineno"></span><span class="comment" id="7167397">//&nbsp;This&nbsp;could&nbsp;be&nbsp;surprising&nbsp;behavior&nbsp;to&nbsp;retroactively&nbsp;apply&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="7167460">//&nbsp;driver.String&nbsp;now&nbsp;that&nbsp;Go1&nbsp;is&nbsp;out,&nbsp;but&nbsp;this&nbsp;is&nbsp;convenient&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7167525">//&nbsp;our&nbsp;TestPointerParamsAndScans.</span><br>
<span class="lineno">785</span><span class="comment" id="7167559">//</span><br>
<span class="lineno"></span><span class="keyword" id="7167562">type</span>&nbsp;<span class="ident" id="7167567">fakeDriverString</span>&nbsp;<span class="keyword" id="7167584">struct</span><span class="op" id="7167590">{</span><span class="op" id="7167591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7167594">func</span>&nbsp;<span class="op" id="7167599">(</span><span class="ident" id="7167600"><a href="/gostd/database/sql/fakedb_test.go.html#7167567">fakeDriverString</a></span><span class="op" id="7167616">)</span>&nbsp;<span class="ident" id="7167618">ConvertValue</span><span class="op" id="7167630">(</span><span class="ident" id="7167631">v</span>&nbsp;<span class="keyword" id="7167633">interface</span><span class="op" id="7167642">{</span><span class="op" id="7167643">}</span><span class="op" id="7167644">)</span>&nbsp;<span class="op" id="7167646">(</span><span class="ident" id="7167647"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7167653">.</span><span class="ident" id="7167654"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="7167659">,</span>&nbsp;<span class="builtintype" id="7167661">error</span><span class="op" id="7167666">)</span>&nbsp;<span class="op" id="7167668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167671">switch</span>&nbsp;<span class="ident" id="7167678">c</span>&nbsp;<span class="op" id="7167680">:=</span>&nbsp;<span class="ident" id="7167683"><a href="/gostd/database/sql/fakedb_test.go.html#7167631">v</a></span><span class="op" id="7167684">.</span><span class="op" id="7167685">(</span><span class="keyword" id="7167686">type</span><span class="op" id="7167690">)</span>&nbsp;<span class="op" id="7167692">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167695">case</span>&nbsp;<span class="builtintype" id="7167700">string</span><span class="op" id="7167706">,</span>&nbsp;<span class="op" id="7167708">[</span><span class="op" id="7167709">]</span><span class="builtintype" id="7167710">byte</span><span class="op" id="7167714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167718">return</span>&nbsp;<span class="ident" id="7167725"><a href="/gostd/database/sql/fakedb_test.go.html#7167631">v</a></span><span class="op" id="7167726">,</span>&nbsp;<span class="builtintype" id="7167728">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167733">case</span>&nbsp;<span class="op" id="7167738">*</span><span class="builtintype" id="7167739">string</span><span class="op" id="7167745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167749">if</span>&nbsp;<span class="ident" id="7167752"><a href="/gostd/database/sql/fakedb_test.go.html#7167678">c</a></span>&nbsp;<span class="op" id="7167754">==</span>&nbsp;<span class="builtintype" id="7167757">nil</span>&nbsp;<span class="op" id="7167761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167766">return</span>&nbsp;<span class="builtintype" id="7167773">nil</span><span class="op" id="7167776">,</span>&nbsp;<span class="builtintype" id="7167778">nil</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167788">return</span>&nbsp;<span class="op" id="7167795">*</span><span class="ident" id="7167796"><a href="/gostd/database/sql/fakedb_test.go.html#7167678">c</a></span><span class="op" id="7167797">,</span>&nbsp;<span class="builtintype" id="7167799">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7167804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167807">return</span>&nbsp;<span class="ident" id="7167814"><a href="/gostd/database/sql/fakedb_test.go.html#7148652">fmt</a></span><span class="op" id="7167817">.</span><span class="ident" id="7167818"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="7167825">(</span><span class="string" id="7167826">&#34;%v&#34;</span><span class="op" id="7167830">,</span>&nbsp;<span class="ident" id="7167832"><a href="/gostd/database/sql/fakedb_test.go.html#7167631">v</a></span><span class="op" id="7167833">)</span><span class="op" id="7167834">,</span>&nbsp;<span class="builtintype" id="7167836">nil</span><br>
<span class="lineno"></span><span class="op" id="7167840">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="keyword" id="7167843">func</span>&nbsp;<span class="ident" id="7167848">converterForType</span><span class="op" id="7167864">(</span><span class="ident" id="7167865">typ</span>&nbsp;<span class="builtintype" id="7167869">string</span><span class="op" id="7167875">)</span>&nbsp;<span class="ident" id="7167877"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7167883">.</span><span class="ident" id="7167884"><a href="/gostd/database/sql/driver/types.go.html#5255195">ValueConverter</a></span>&nbsp;<span class="op" id="7167899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167902">switch</span>&nbsp;<span class="ident" id="7167909"><a href="/gostd/database/sql/fakedb_test.go.html#7167865">typ</a></span>&nbsp;<span class="op" id="7167913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167916">case</span>&nbsp;<span class="string" id="7167921">&#34;bool&#34;</span><span class="op" id="7167927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167931">return</span>&nbsp;<span class="ident" id="7167938"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7167944">.</span><span class="ident" id="7167945"><a href="/gostd/database/sql/driver/types.go.html#5255895">Bool</a></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167951">case</span>&nbsp;<span class="string" id="7167956">&#34;nullbool&#34;</span><span class="op" id="7167966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7167970">return</span>&nbsp;<span class="ident" id="7167977"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7167983">.</span><span class="ident" id="7167984"><a href="/gostd/database/sql/driver/types.go.html#5258686">Null</a></span><span class="op" id="7167988">{</span><span class="ident" id="7167989"><a href="/gostd/database/sql/driver/types.go.html#5258701">Converter</a></span><span class="op" id="7167998">:</span>&nbsp;<span class="ident" id="7168000"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168006">.</span><span class="ident" id="7168007"><a href="/gostd/database/sql/driver/types.go.html#5255895">Bool</a></span><span class="op" id="7168011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168014">case</span>&nbsp;<span class="string" id="7168019">&#34;int32&#34;</span><span class="op" id="7168026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168030">return</span>&nbsp;<span class="ident" id="7168037"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168043">.</span><span class="ident" id="7168044"><a href="/gostd/database/sql/driver/types.go.html#5257195">Int32</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168051">case</span>&nbsp;<span class="string" id="7168056">&#34;string&#34;</span><span class="op" id="7168064">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168068">return</span>&nbsp;<span class="ident" id="7168075"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168081">.</span><span class="ident" id="7168082"><a href="/gostd/database/sql/driver/types.go.html#5259001">NotNull</a></span><span class="op" id="7168089">{</span><span class="ident" id="7168090"><a href="/gostd/database/sql/driver/types.go.html#5259019">Converter</a></span><span class="op" id="7168099">:</span>&nbsp;<span class="ident" id="7168101"><a href="/gostd/database/sql/fakedb_test.go.html#7167567">fakeDriverString</a></span><span class="op" id="7168117">{</span><span class="op" id="7168118">}</span><span class="op" id="7168119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168122">case</span>&nbsp;<span class="string" id="7168127">&#34;nullstring&#34;</span><span class="op" id="7168139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168143">return</span>&nbsp;<span class="ident" id="7168150"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168156">.</span><span class="ident" id="7168157"><a href="/gostd/database/sql/driver/types.go.html#5258686">Null</a></span><span class="op" id="7168161">{</span><span class="ident" id="7168162"><a href="/gostd/database/sql/driver/types.go.html#5258701">Converter</a></span><span class="op" id="7168171">:</span>&nbsp;<span class="ident" id="7168173"><a href="/gostd/database/sql/fakedb_test.go.html#7167567">fakeDriverString</a></span><span class="op" id="7168189">{</span><span class="op" id="7168190">}</span><span class="op" id="7168191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168194">case</span>&nbsp;<span class="string" id="7168199">&#34;int64&#34;</span><span class="op" id="7168206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7168210">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168262">return</span>&nbsp;<span class="ident" id="7168269"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168275">.</span><span class="ident" id="7168276"><a href="/gostd/database/sql/driver/types.go.html#5259001">NotNull</a></span><span class="op" id="7168283">{</span><span class="ident" id="7168284"><a href="/gostd/database/sql/driver/types.go.html#5259019">Converter</a></span><span class="op" id="7168293">:</span>&nbsp;<span class="ident" id="7168295"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168301">.</span><span class="ident" id="7168302"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><span class="op" id="7168327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168330">case</span>&nbsp;<span class="string" id="7168335">&#34;nullint64&#34;</span><span class="op" id="7168346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7168350">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168402">return</span>&nbsp;<span class="ident" id="7168409"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168415">.</span><span class="ident" id="7168416"><a href="/gostd/database/sql/driver/types.go.html#5258686">Null</a></span><span class="op" id="7168420">{</span><span class="ident" id="7168421"><a href="/gostd/database/sql/driver/types.go.html#5258701">Converter</a></span><span class="op" id="7168430">:</span>&nbsp;<span class="ident" id="7168432"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168438">.</span><span class="ident" id="7168439"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><span class="op" id="7168464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168467">case</span>&nbsp;<span class="string" id="7168472">&#34;float64&#34;</span><span class="op" id="7168481">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7168485">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168537">return</span>&nbsp;<span class="ident" id="7168544"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168550">.</span><span class="ident" id="7168551"><a href="/gostd/database/sql/driver/types.go.html#5259001">NotNull</a></span><span class="op" id="7168558">{</span><span class="ident" id="7168559"><a href="/gostd/database/sql/driver/types.go.html#5259019">Converter</a></span><span class="op" id="7168568">:</span>&nbsp;<span class="ident" id="7168570"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168576">.</span><span class="ident" id="7168577"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><span class="op" id="7168602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168605">case</span>&nbsp;<span class="string" id="7168610">&#34;nullfloat64&#34;</span><span class="op" id="7168623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7168627">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168679">return</span>&nbsp;<span class="ident" id="7168686"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168692">.</span><span class="ident" id="7168693"><a href="/gostd/database/sql/driver/types.go.html#5258686">Null</a></span><span class="op" id="7168697">{</span><span class="ident" id="7168698"><a href="/gostd/database/sql/driver/types.go.html#5258701">Converter</a></span><span class="op" id="7168707">:</span>&nbsp;<span class="ident" id="7168709"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168715">.</span><span class="ident" id="7168716"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><span class="op" id="7168741">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168744">case</span>&nbsp;<span class="string" id="7168749">&#34;datetime&#34;</span><span class="op" id="7168759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7168763">return</span>&nbsp;<span class="ident" id="7168770"><a href="/gostd/database/sql/fakedb_test.go.html#7148619">driver</a></span><span class="op" id="7168776">.</span><span class="ident" id="7168777"><a href="/gostd/database/sql/driver/types.go.html#5260123">DefaultParameterConverter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7168804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7168807">panic</span><span class="op" id="7168812">(</span><span class="string" id="7168813">&#34;invalid&nbsp;fakedb&nbsp;column&nbsp;type&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="7168846">+</span>&nbsp;<span class="ident" id="7168848"><a href="/gostd/database/sql/fakedb_test.go.html#7167865">typ</a></span><span class="op" id="7168851">)</span><br>
<span class="lineno"></span><span class="op" id="7168853">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
