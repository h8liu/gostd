<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3942018">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3942073">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3942127">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3942178">package</span>&nbsp;<span class="ident" id="3942186">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3942192">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3942266">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="3942340">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3942360">import</span>&nbsp;<span class="op" id="3942367">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942370">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942384">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942401">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942415">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942429">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942445">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942461">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942471">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3942477">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3942487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3942490">type</span>&nbsp;<span class="ident" id="3942495">PEMCipher</span>&nbsp;<span class="builtintype" id="3942505">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3942510">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="3942575">const</span>&nbsp;<span class="op" id="3942581">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942584">_</span>&nbsp;<span class="ident" id="3942586">PEMCipher</span>&nbsp;<span class="op" id="3942596">=</span>&nbsp;<span class="ident" id="3942598">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942604">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942618">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942633">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942650">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942667">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="3942683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3942686">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="3942745">type</span>&nbsp;<span class="ident" id="3942750">rfc1423Algo</span>&nbsp;<span class="keyword" id="3942762">struct</span>&nbsp;<span class="op" id="3942769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942772">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3942783">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942794">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3942805">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942813">cipherFunc</span>&nbsp;<span class="keyword" id="3942824">func</span><span class="op" id="3942828">(</span><span class="ident" id="3942829">key</span>&nbsp;<span class="op" id="3942833">[</span><span class="op" id="3942834">]</span><span class="builtintype" id="3942835">byte</span><span class="op" id="3942839">)</span>&nbsp;<span class="op" id="3942841">(</span><span class="ident" id="3942842">cipher</span><span class="op" id="3942848">.</span><span class="ident" id="3942849">Block</span><span class="op" id="3942854">,</span>&nbsp;<span class="builtintype" id="3942856">error</span><span class="op" id="3942861">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942864">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3942875">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942880">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="3942891">int</span><br>
<span class="lineno"></span><span class="op" id="3942895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3942898">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="3942966">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3943032">var</span>&nbsp;<span class="ident" id="3943036">rfc1423Algos</span>&nbsp;<span class="op" id="3943049">=</span>&nbsp;<span class="op" id="3943051">[</span><span class="op" id="3943052">]</span><span class="ident" id="3943053">rfc1423Algo</span><span class="op" id="3943064">{</span><span class="op" id="3943065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943068">cipher</span><span class="op" id="3943074">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943080">PEMCipherDES</span><span class="op" id="3943092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943095">name</span><span class="op" id="3943099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3943107">&#34;DES-CBC&#34;</span><span class="op" id="3943116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943119">cipherFunc</span><span class="op" id="3943129">:</span>&nbsp;<span class="ident" id="3943131">des</span><span class="op" id="3943134">.</span><span class="ident" id="3943135">NewCipher</span><span class="op" id="3943144">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943147">keySize</span><span class="op" id="3943154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3943159">8</span><span class="op" id="3943160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943163">blockSize</span><span class="op" id="3943172">:</span>&nbsp;&nbsp;<span class="ident" id="3943175">des</span><span class="op" id="3943178">.</span><span class="ident" id="3943179">BlockSize</span><span class="op" id="3943188">,</span><br>
<span class="lineno"></span><span class="op" id="3943190">}</span><span class="op" id="3943191">,</span>&nbsp;<span class="op" id="3943193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943196">cipher</span><span class="op" id="3943202">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943208">PEMCipher3DES</span><span class="op" id="3943221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943224">name</span><span class="op" id="3943228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3943236">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="3943250">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943253">cipherFunc</span><span class="op" id="3943263">:</span>&nbsp;<span class="ident" id="3943265">des</span><span class="op" id="3943268">.</span><span class="ident" id="3943269">NewTripleDESCipher</span><span class="op" id="3943287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943290">keySize</span><span class="op" id="3943297">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3943302">24</span><span class="op" id="3943304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943307">blockSize</span><span class="op" id="3943316">:</span>&nbsp;&nbsp;<span class="ident" id="3943319">des</span><span class="op" id="3943322">.</span><span class="ident" id="3943323">BlockSize</span><span class="op" id="3943332">,</span><br>
<span class="lineno"></span><span class="op" id="3943334">}</span><span class="op" id="3943335">,</span>&nbsp;<span class="op" id="3943337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943340">cipher</span><span class="op" id="3943346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943352">PEMCipherAES128</span><span class="op" id="3943367">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943370">name</span><span class="op" id="3943374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3943382">&#34;AES-128-CBC&#34;</span><span class="op" id="3943395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943398">cipherFunc</span><span class="op" id="3943408">:</span>&nbsp;<span class="ident" id="3943410">aes</span><span class="op" id="3943413">.</span><span class="ident" id="3943414">NewCipher</span><span class="op" id="3943423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943426">keySize</span><span class="op" id="3943433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3943438">16</span><span class="op" id="3943440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943443">blockSize</span><span class="op" id="3943452">:</span>&nbsp;&nbsp;<span class="ident" id="3943455">aes</span><span class="op" id="3943458">.</span><span class="ident" id="3943459">BlockSize</span><span class="op" id="3943468">,</span><br>
<span class="lineno"></span><span class="op" id="3943470">}</span><span class="op" id="3943471">,</span>&nbsp;<span class="op" id="3943473">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943476">cipher</span><span class="op" id="3943482">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943488">PEMCipherAES192</span><span class="op" id="3943503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943506">name</span><span class="op" id="3943510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3943518">&#34;AES-192-CBC&#34;</span><span class="op" id="3943531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943534">cipherFunc</span><span class="op" id="3943544">:</span>&nbsp;<span class="ident" id="3943546">aes</span><span class="op" id="3943549">.</span><span class="ident" id="3943550">NewCipher</span><span class="op" id="3943559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943562">keySize</span><span class="op" id="3943569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3943574">24</span><span class="op" id="3943576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943579">blockSize</span><span class="op" id="3943588">:</span>&nbsp;&nbsp;<span class="ident" id="3943591">aes</span><span class="op" id="3943594">.</span><span class="ident" id="3943595">BlockSize</span><span class="op" id="3943604">,</span><br>
<span class="lineno">70</span><span class="op" id="3943606">}</span><span class="op" id="3943607">,</span>&nbsp;<span class="op" id="3943609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943612">cipher</span><span class="op" id="3943618">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3943624">PEMCipherAES256</span><span class="op" id="3943639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943642">name</span><span class="op" id="3943646">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3943654">&#34;AES-256-CBC&#34;</span><span class="op" id="3943667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943670">cipherFunc</span><span class="op" id="3943680">:</span>&nbsp;<span class="ident" id="3943682">aes</span><span class="op" id="3943685">.</span><span class="ident" id="3943686">NewCipher</span><span class="op" id="3943695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943698">keySize</span><span class="op" id="3943705">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3943710">32</span><span class="op" id="3943712">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943715">blockSize</span><span class="op" id="3943724">:</span>&nbsp;&nbsp;<span class="ident" id="3943727">aes</span><span class="op" id="3943730">.</span><span class="ident" id="3943731">BlockSize</span><span class="op" id="3943740">,</span><br>
<span class="lineno"></span><span class="op" id="3943742">}</span><span class="op" id="3943743">,</span><br>
<span class="lineno"></span><span class="op" id="3943745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3943748">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="3943827">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3943907">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="3943930">func</span>&nbsp;<span class="op" id="3943935">(</span><span class="ident" id="3943936">c</span>&nbsp;<span class="ident" id="3943938">rfc1423Algo</span><span class="op" id="3943949">)</span>&nbsp;<span class="ident" id="3943951">deriveKey</span><span class="op" id="3943960">(</span><span class="ident" id="3943961">password</span><span class="op" id="3943969">,</span>&nbsp;<span class="ident" id="3943971">salt</span>&nbsp;<span class="op" id="3943976">[</span><span class="op" id="3943977">]</span><span class="builtintype" id="3943978">byte</span><span class="op" id="3943982">)</span>&nbsp;<span class="op" id="3943984">[</span><span class="op" id="3943985">]</span><span class="builtintype" id="3943986">byte</span>&nbsp;<span class="op" id="3943991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943994">hash</span>&nbsp;<span class="op" id="3943999">:=</span>&nbsp;<span class="ident" id="3944002">md5</span><span class="op" id="3944005">.</span><span class="ident" id="3944006">New</span><span class="op" id="3944009">(</span><span class="op" id="3944010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944013">out</span>&nbsp;<span class="op" id="3944017">:=</span>&nbsp;<span class="builtinfunc" id="3944020">make</span><span class="op" id="3944024">(</span><span class="op" id="3944025">[</span><span class="op" id="3944026">]</span><span class="builtintype" id="3944027">byte</span><span class="op" id="3944031">,</span>&nbsp;<span class="ident" id="3944033">c</span><span class="op" id="3944034">.</span><span class="ident" id="3944035">keySize</span><span class="op" id="3944042">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944045">var</span>&nbsp;<span class="ident" id="3944049">digest</span>&nbsp;<span class="op" id="3944056">[</span><span class="op" id="3944057">]</span><span class="builtintype" id="3944058">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944065">for</span>&nbsp;<span class="ident" id="3944069">i</span>&nbsp;<span class="op" id="3944071">:=</span>&nbsp;<span class="num" id="3944074">0</span><span class="op" id="3944075">;</span>&nbsp;<span class="ident" id="3944077">i</span>&nbsp;<span class="op" id="3944079">&lt;</span>&nbsp;<span class="builtinfunc" id="3944081">len</span><span class="op" id="3944084">(</span><span class="ident" id="3944085">out</span><span class="op" id="3944088">)</span><span class="op" id="3944089">;</span>&nbsp;<span class="ident" id="3944091">i</span>&nbsp;<span class="op" id="3944093">+=</span>&nbsp;<span class="builtinfunc" id="3944096">len</span><span class="op" id="3944099">(</span><span class="ident" id="3944100">digest</span><span class="op" id="3944106">)</span>&nbsp;<span class="op" id="3944108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944112">hash</span><span class="op" id="3944116">.</span><span class="ident" id="3944117">Reset</span><span class="op" id="3944122">(</span><span class="op" id="3944123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944127">hash</span><span class="op" id="3944131">.</span><span class="ident" id="3944132">Write</span><span class="op" id="3944137">(</span><span class="ident" id="3944138">digest</span><span class="op" id="3944144">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944148">hash</span><span class="op" id="3944152">.</span><span class="ident" id="3944153">Write</span><span class="op" id="3944158">(</span><span class="ident" id="3944159">password</span><span class="op" id="3944167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944171">hash</span><span class="op" id="3944175">.</span><span class="ident" id="3944176">Write</span><span class="op" id="3944181">(</span><span class="ident" id="3944182">salt</span><span class="op" id="3944186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944190">digest</span>&nbsp;<span class="op" id="3944197">=</span>&nbsp;<span class="ident" id="3944199">hash</span><span class="op" id="3944203">.</span><span class="ident" id="3944204">Sum</span><span class="op" id="3944207">(</span><span class="ident" id="3944208">digest</span><span class="op" id="3944214">[</span><span class="op" id="3944215">:</span><span class="num" id="3944216">0</span><span class="op" id="3944217">]</span><span class="op" id="3944218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3944222">copy</span><span class="op" id="3944226">(</span><span class="ident" id="3944227">out</span><span class="op" id="3944230">[</span><span class="ident" id="3944231">i</span><span class="op" id="3944232">:</span><span class="op" id="3944233">]</span><span class="op" id="3944234">,</span>&nbsp;<span class="ident" id="3944236">digest</span><span class="op" id="3944242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944245">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944248">return</span>&nbsp;<span class="ident" id="3944255">out</span><br>
<span class="lineno"></span><span class="op" id="3944259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944262">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3944333">func</span>&nbsp;<span class="ident" id="3944338">IsEncryptedPEMBlock</span><span class="op" id="3944357">(</span><span class="ident" id="3944358">b</span>&nbsp;<span class="op" id="3944360">*</span><span class="ident" id="3944361">pem</span><span class="op" id="3944364">.</span><span class="ident" id="3944365">Block</span><span class="op" id="3944370">)</span>&nbsp;<span class="builtintype" id="3944372">bool</span>&nbsp;<span class="op" id="3944377">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944380">_</span><span class="op" id="3944381">,</span>&nbsp;<span class="ident" id="3944383">ok</span>&nbsp;<span class="op" id="3944386">:=</span>&nbsp;<span class="ident" id="3944389">b</span><span class="op" id="3944390">.</span><span class="ident" id="3944391">Headers</span><span class="op" id="3944398">[</span><span class="string" id="3944399">&#34;DEK-Info&#34;</span><span class="op" id="3944409">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944412">return</span>&nbsp;<span class="ident" id="3944419">ok</span><br>
<span class="lineno"></span><span class="op" id="3944422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944425">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="3944503">var</span>&nbsp;<span class="ident" id="3944507">IncorrectPasswordError</span>&nbsp;<span class="op" id="3944530">=</span>&nbsp;<span class="ident" id="3944532">errors</span><span class="op" id="3944538">.</span><span class="ident" id="3944539">New</span><span class="op" id="3944542">(</span><span class="string" id="3944543">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="3944580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3944583">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3944664">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="3944742">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="3944819">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3944897">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3944951">func</span>&nbsp;<span class="ident" id="3944956">DecryptPEMBlock</span><span class="op" id="3944971">(</span><span class="ident" id="3944972">b</span>&nbsp;<span class="op" id="3944974">*</span><span class="ident" id="3944975">pem</span><span class="op" id="3944978">.</span><span class="ident" id="3944979">Block</span><span class="op" id="3944984">,</span>&nbsp;<span class="ident" id="3944986">password</span>&nbsp;<span class="op" id="3944995">[</span><span class="op" id="3944996">]</span><span class="builtintype" id="3944997">byte</span><span class="op" id="3945001">)</span>&nbsp;<span class="op" id="3945003">(</span><span class="op" id="3945004">[</span><span class="op" id="3945005">]</span><span class="builtintype" id="3945006">byte</span><span class="op" id="3945010">,</span>&nbsp;<span class="builtintype" id="3945012">error</span><span class="op" id="3945017">)</span>&nbsp;<span class="op" id="3945019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945022">dek</span><span class="op" id="3945025">,</span>&nbsp;<span class="ident" id="3945027">ok</span>&nbsp;<span class="op" id="3945030">:=</span>&nbsp;<span class="ident" id="3945033">b</span><span class="op" id="3945034">.</span><span class="ident" id="3945035">Headers</span><span class="op" id="3945042">[</span><span class="string" id="3945043">&#34;DEK-Info&#34;</span><span class="op" id="3945053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945056">if</span>&nbsp;<span class="op" id="3945059">!</span><span class="ident" id="3945060">ok</span>&nbsp;<span class="op" id="3945063">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945067">return</span>&nbsp;<span class="ident" id="3945074">nil</span><span class="op" id="3945077">,</span>&nbsp;<span class="ident" id="3945079">errors</span><span class="op" id="3945085">.</span><span class="ident" id="3945086">New</span><span class="op" id="3945089">(</span><span class="string" id="3945090">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="3945125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945132">idx</span>&nbsp;<span class="op" id="3945136">:=</span>&nbsp;<span class="ident" id="3945139">strings</span><span class="op" id="3945146">.</span><span class="ident" id="3945147">Index</span><span class="op" id="3945152">(</span><span class="ident" id="3945153">dek</span><span class="op" id="3945156">,</span>&nbsp;<span class="string" id="3945158">&#34;,&#34;</span><span class="op" id="3945161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945164">if</span>&nbsp;<span class="ident" id="3945167">idx</span>&nbsp;<span class="op" id="3945171">==</span>&nbsp;<span class="op" id="3945174">-</span><span class="num" id="3945175">1</span>&nbsp;<span class="op" id="3945177">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945181">return</span>&nbsp;<span class="ident" id="3945188">nil</span><span class="op" id="3945191">,</span>&nbsp;<span class="ident" id="3945193">errors</span><span class="op" id="3945199">.</span><span class="ident" id="3945200">New</span><span class="op" id="3945203">(</span><span class="string" id="3945204">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="3945237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945244">mode</span><span class="op" id="3945248">,</span>&nbsp;<span class="ident" id="3945250">hexIV</span>&nbsp;<span class="op" id="3945256">:=</span>&nbsp;<span class="ident" id="3945259">dek</span><span class="op" id="3945262">[</span><span class="op" id="3945263">:</span><span class="ident" id="3945264">idx</span><span class="op" id="3945267">]</span><span class="op" id="3945268">,</span>&nbsp;<span class="ident" id="3945270">dek</span><span class="op" id="3945273">[</span><span class="ident" id="3945274">idx</span><span class="op" id="3945277">+</span><span class="num" id="3945278">1</span><span class="op" id="3945279">:</span><span class="op" id="3945280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945283">ciph</span>&nbsp;<span class="op" id="3945288">:=</span>&nbsp;<span class="ident" id="3945291">cipherByName</span><span class="op" id="3945303">(</span><span class="ident" id="3945304">mode</span><span class="op" id="3945308">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945311">if</span>&nbsp;<span class="ident" id="3945314">ciph</span>&nbsp;<span class="op" id="3945319">==</span>&nbsp;<span class="ident" id="3945322">nil</span>&nbsp;<span class="op" id="3945326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945330">return</span>&nbsp;<span class="ident" id="3945337">nil</span><span class="op" id="3945340">,</span>&nbsp;<span class="ident" id="3945342">errors</span><span class="op" id="3945348">.</span><span class="ident" id="3945349">New</span><span class="op" id="3945352">(</span><span class="string" id="3945353">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3945384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945390">iv</span><span class="op" id="3945392">,</span>&nbsp;<span class="ident" id="3945394">err</span>&nbsp;<span class="op" id="3945398">:=</span>&nbsp;<span class="ident" id="3945401">hex</span><span class="op" id="3945404">.</span><span class="ident" id="3945405">DecodeString</span><span class="op" id="3945417">(</span><span class="ident" id="3945418">hexIV</span><span class="op" id="3945423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945426">if</span>&nbsp;<span class="ident" id="3945429">err</span>&nbsp;<span class="op" id="3945433">!=</span>&nbsp;<span class="ident" id="3945436">nil</span>&nbsp;<span class="op" id="3945440">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945444">return</span>&nbsp;<span class="ident" id="3945451">nil</span><span class="op" id="3945454">,</span>&nbsp;<span class="ident" id="3945456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945464">if</span>&nbsp;<span class="builtinfunc" id="3945467">len</span><span class="op" id="3945470">(</span><span class="ident" id="3945471">iv</span><span class="op" id="3945473">)</span>&nbsp;<span class="op" id="3945475">!=</span>&nbsp;<span class="ident" id="3945478">ciph</span><span class="op" id="3945482">.</span><span class="ident" id="3945483">blockSize</span>&nbsp;<span class="op" id="3945493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945497">return</span>&nbsp;<span class="ident" id="3945504">nil</span><span class="op" id="3945507">,</span>&nbsp;<span class="ident" id="3945509">errors</span><span class="op" id="3945515">.</span><span class="ident" id="3945516">New</span><span class="op" id="3945519">(</span><span class="string" id="3945520">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="3945545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945548">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945552">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945623">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945657">key</span>&nbsp;<span class="op" id="3945661">:=</span>&nbsp;<span class="ident" id="3945664">ciph</span><span class="op" id="3945668">.</span><span class="ident" id="3945669">deriveKey</span><span class="op" id="3945678">(</span><span class="ident" id="3945679">password</span><span class="op" id="3945687">,</span>&nbsp;<span class="ident" id="3945689">iv</span><span class="op" id="3945691">[</span><span class="op" id="3945692">:</span><span class="num" id="3945693">8</span><span class="op" id="3945694">]</span><span class="op" id="3945695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945698">block</span><span class="op" id="3945703">,</span>&nbsp;<span class="ident" id="3945705">err</span>&nbsp;<span class="op" id="3945709">:=</span>&nbsp;<span class="ident" id="3945712">ciph</span><span class="op" id="3945716">.</span><span class="ident" id="3945717">cipherFunc</span><span class="op" id="3945727">(</span><span class="ident" id="3945728">key</span><span class="op" id="3945731">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945734">if</span>&nbsp;<span class="ident" id="3945737">err</span>&nbsp;<span class="op" id="3945741">!=</span>&nbsp;<span class="ident" id="3945744">nil</span>&nbsp;<span class="op" id="3945748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945752">return</span>&nbsp;<span class="ident" id="3945759">nil</span><span class="op" id="3945762">,</span>&nbsp;<span class="ident" id="3945764">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945773">data</span>&nbsp;<span class="op" id="3945778">:=</span>&nbsp;<span class="builtinfunc" id="3945781">make</span><span class="op" id="3945785">(</span><span class="op" id="3945786">[</span><span class="op" id="3945787">]</span><span class="builtintype" id="3945788">byte</span><span class="op" id="3945792">,</span>&nbsp;<span class="builtinfunc" id="3945794">len</span><span class="op" id="3945797">(</span><span class="ident" id="3945798">b</span><span class="op" id="3945799">.</span><span class="ident" id="3945800">Bytes</span><span class="op" id="3945805">)</span><span class="op" id="3945806">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945809">dec</span>&nbsp;<span class="op" id="3945813">:=</span>&nbsp;<span class="ident" id="3945816">cipher</span><span class="op" id="3945822">.</span><span class="ident" id="3945823">NewCBCDecrypter</span><span class="op" id="3945838">(</span><span class="ident" id="3945839">block</span><span class="op" id="3945844">,</span>&nbsp;<span class="ident" id="3945846">iv</span><span class="op" id="3945848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945851">dec</span><span class="op" id="3945854">.</span><span class="ident" id="3945855">CryptBlocks</span><span class="op" id="3945866">(</span><span class="ident" id="3945867">data</span><span class="op" id="3945871">,</span>&nbsp;<span class="ident" id="3945873">b</span><span class="op" id="3945874">.</span><span class="ident" id="3945875">Bytes</span><span class="op" id="3945880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945884">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945963">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946041">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946058">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946074">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3946098">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946167">dlen</span>&nbsp;<span class="op" id="3946172">:=</span>&nbsp;<span class="builtinfunc" id="3946175">len</span><span class="op" id="3946178">(</span><span class="ident" id="3946179">data</span><span class="op" id="3946183">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946186">if</span>&nbsp;<span class="ident" id="3946189">dlen</span>&nbsp;<span class="op" id="3946194">==</span>&nbsp;<span class="num" id="3946197">0</span>&nbsp;<span class="op" id="3946199">||</span>&nbsp;<span class="ident" id="3946202">dlen</span><span class="op" id="3946206">%</span><span class="ident" id="3946207">ciph</span><span class="op" id="3946211">.</span><span class="ident" id="3946212">blockSize</span>&nbsp;<span class="op" id="3946222">!=</span>&nbsp;<span class="num" id="3946225">0</span>&nbsp;<span class="op" id="3946227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946231">return</span>&nbsp;<span class="ident" id="3946238">nil</span><span class="op" id="3946241">,</span>&nbsp;<span class="ident" id="3946243">errors</span><span class="op" id="3946249">.</span><span class="ident" id="3946250">New</span><span class="op" id="3946253">(</span><span class="string" id="3946254">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="3946277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946283">last</span>&nbsp;<span class="op" id="3946288">:=</span>&nbsp;<span class="builtintype" id="3946291">int</span><span class="op" id="3946294">(</span><span class="ident" id="3946295">data</span><span class="op" id="3946299">[</span><span class="ident" id="3946300">dlen</span><span class="op" id="3946304">-</span><span class="num" id="3946305">1</span><span class="op" id="3946306">]</span><span class="op" id="3946307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946310">if</span>&nbsp;<span class="ident" id="3946313">dlen</span>&nbsp;<span class="op" id="3946318">&lt;</span>&nbsp;<span class="ident" id="3946320">last</span>&nbsp;<span class="op" id="3946325">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946329">return</span>&nbsp;<span class="ident" id="3946336">nil</span><span class="op" id="3946339">,</span>&nbsp;<span class="ident" id="3946341">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946368">if</span>&nbsp;<span class="ident" id="3946371">last</span>&nbsp;<span class="op" id="3946376">==</span>&nbsp;<span class="num" id="3946379">0</span>&nbsp;<span class="op" id="3946381">||</span>&nbsp;<span class="ident" id="3946384">last</span>&nbsp;<span class="op" id="3946389">&gt;</span>&nbsp;<span class="ident" id="3946391">ciph</span><span class="op" id="3946395">.</span><span class="ident" id="3946396">blockSize</span>&nbsp;<span class="op" id="3946406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946410">return</span>&nbsp;<span class="ident" id="3946417">nil</span><span class="op" id="3946420">,</span>&nbsp;<span class="ident" id="3946422">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946446">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946449">for</span>&nbsp;<span class="ident" id="3946453">_</span><span class="op" id="3946454">,</span>&nbsp;<span class="ident" id="3946456">val</span>&nbsp;<span class="op" id="3946460">:=</span>&nbsp;<span class="keyword" id="3946463">range</span>&nbsp;<span class="ident" id="3946469">data</span><span class="op" id="3946473">[</span><span class="ident" id="3946474">dlen</span><span class="op" id="3946478">-</span><span class="ident" id="3946479">last</span><span class="op" id="3946483">:</span><span class="op" id="3946484">]</span>&nbsp;<span class="op" id="3946486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946490">if</span>&nbsp;<span class="builtintype" id="3946493">int</span><span class="op" id="3946496">(</span><span class="ident" id="3946497">val</span><span class="op" id="3946500">)</span>&nbsp;<span class="op" id="3946502">!=</span>&nbsp;<span class="ident" id="3946505">last</span>&nbsp;<span class="op" id="3946510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946515">return</span>&nbsp;<span class="ident" id="3946522">nil</span><span class="op" id="3946525">,</span>&nbsp;<span class="ident" id="3946527">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946555">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946558">return</span>&nbsp;<span class="ident" id="3946565">data</span><span class="op" id="3946569">[</span><span class="op" id="3946570">:</span><span class="ident" id="3946571">dlen</span><span class="op" id="3946575">-</span><span class="ident" id="3946576">last</span><span class="op" id="3946580">]</span><span class="op" id="3946581">,</span>&nbsp;<span class="ident" id="3946583">nil</span><br>
<span class="lineno"></span><span class="op" id="3946587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3946590">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3946663">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="3946732">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3946745">func</span>&nbsp;<span class="ident" id="3946750">EncryptPEMBlock</span><span class="op" id="3946765">(</span><span class="ident" id="3946766">rand</span>&nbsp;<span class="ident" id="3946771">io</span><span class="op" id="3946773">.</span><span class="ident" id="3946774">Reader</span><span class="op" id="3946780">,</span>&nbsp;<span class="ident" id="3946782">blockType</span>&nbsp;<span class="builtintype" id="3946792">string</span><span class="op" id="3946798">,</span>&nbsp;<span class="ident" id="3946800">data</span><span class="op" id="3946804">,</span>&nbsp;<span class="ident" id="3946806">password</span>&nbsp;<span class="op" id="3946815">[</span><span class="op" id="3946816">]</span><span class="builtintype" id="3946817">byte</span><span class="op" id="3946821">,</span>&nbsp;<span class="ident" id="3946823">alg</span>&nbsp;<span class="ident" id="3946827">PEMCipher</span><span class="op" id="3946836">)</span>&nbsp;<span class="op" id="3946838">(</span><span class="op" id="3946839">*</span><span class="ident" id="3946840">pem</span><span class="op" id="3946843">.</span><span class="ident" id="3946844">Block</span><span class="op" id="3946849">,</span>&nbsp;<span class="builtintype" id="3946851">error</span><span class="op" id="3946856">)</span>&nbsp;<span class="op" id="3946858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946861">ciph</span>&nbsp;<span class="op" id="3946866">:=</span>&nbsp;<span class="ident" id="3946869">cipherByKey</span><span class="op" id="3946880">(</span><span class="ident" id="3946881">alg</span><span class="op" id="3946884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946887">if</span>&nbsp;<span class="ident" id="3946890">ciph</span>&nbsp;<span class="op" id="3946895">==</span>&nbsp;<span class="ident" id="3946898">nil</span>&nbsp;<span class="op" id="3946902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946906">return</span>&nbsp;<span class="ident" id="3946913">nil</span><span class="op" id="3946916">,</span>&nbsp;<span class="ident" id="3946918">errors</span><span class="op" id="3946924">.</span><span class="ident" id="3946925">New</span><span class="op" id="3946928">(</span><span class="string" id="3946929">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="3946960">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946966">iv</span>&nbsp;<span class="op" id="3946969">:=</span>&nbsp;<span class="builtinfunc" id="3946972">make</span><span class="op" id="3946976">(</span><span class="op" id="3946977">[</span><span class="op" id="3946978">]</span><span class="builtintype" id="3946979">byte</span><span class="op" id="3946983">,</span>&nbsp;<span class="ident" id="3946985">ciph</span><span class="op" id="3946989">.</span><span class="ident" id="3946990">blockSize</span><span class="op" id="3946999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947002">if</span>&nbsp;<span class="ident" id="3947005">_</span><span class="op" id="3947006">,</span>&nbsp;<span class="ident" id="3947008">err</span>&nbsp;<span class="op" id="3947012">:=</span>&nbsp;<span class="ident" id="3947015">io</span><span class="op" id="3947017">.</span><span class="ident" id="3947018">ReadFull</span><span class="op" id="3947026">(</span><span class="ident" id="3947027">rand</span><span class="op" id="3947031">,</span>&nbsp;<span class="ident" id="3947033">iv</span><span class="op" id="3947035">)</span><span class="op" id="3947036">;</span>&nbsp;<span class="ident" id="3947038">err</span>&nbsp;<span class="op" id="3947042">!=</span>&nbsp;<span class="ident" id="3947045">nil</span>&nbsp;<span class="op" id="3947049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947053">return</span>&nbsp;<span class="ident" id="3947060">nil</span><span class="op" id="3947063">,</span>&nbsp;<span class="ident" id="3947065">errors</span><span class="op" id="3947071">.</span><span class="ident" id="3947072">New</span><span class="op" id="3947075">(</span><span class="string" id="3947076">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="3947105">+</span>&nbsp;<span class="ident" id="3947107">err</span><span class="op" id="3947110">.</span><span class="ident" id="3947111">Error</span><span class="op" id="3947116">(</span><span class="op" id="3947117">)</span><span class="op" id="3947118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947121">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947124">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947188">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947240">key</span>&nbsp;<span class="op" id="3947244">:=</span>&nbsp;<span class="ident" id="3947247">ciph</span><span class="op" id="3947251">.</span><span class="ident" id="3947252">deriveKey</span><span class="op" id="3947261">(</span><span class="ident" id="3947262">password</span><span class="op" id="3947270">,</span>&nbsp;<span class="ident" id="3947272">iv</span><span class="op" id="3947274">[</span><span class="op" id="3947275">:</span><span class="num" id="3947276">8</span><span class="op" id="3947277">]</span><span class="op" id="3947278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947281">block</span><span class="op" id="3947286">,</span>&nbsp;<span class="ident" id="3947288">err</span>&nbsp;<span class="op" id="3947292">:=</span>&nbsp;<span class="ident" id="3947295">ciph</span><span class="op" id="3947299">.</span><span class="ident" id="3947300">cipherFunc</span><span class="op" id="3947310">(</span><span class="ident" id="3947311">key</span><span class="op" id="3947314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947317">if</span>&nbsp;<span class="ident" id="3947320">err</span>&nbsp;<span class="op" id="3947324">!=</span>&nbsp;<span class="ident" id="3947327">nil</span>&nbsp;<span class="op" id="3947331">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947335">return</span>&nbsp;<span class="ident" id="3947342">nil</span><span class="op" id="3947345">,</span>&nbsp;<span class="ident" id="3947347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947355">enc</span>&nbsp;<span class="op" id="3947359">:=</span>&nbsp;<span class="ident" id="3947362">cipher</span><span class="op" id="3947368">.</span><span class="ident" id="3947369">NewCBCEncrypter</span><span class="op" id="3947384">(</span><span class="ident" id="3947385">block</span><span class="op" id="3947390">,</span>&nbsp;<span class="ident" id="3947392">iv</span><span class="op" id="3947394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947397">pad</span>&nbsp;<span class="op" id="3947401">:=</span>&nbsp;<span class="ident" id="3947404">ciph</span><span class="op" id="3947408">.</span><span class="ident" id="3947409">blockSize</span>&nbsp;<span class="op" id="3947419">-</span>&nbsp;<span class="builtinfunc" id="3947421">len</span><span class="op" id="3947424">(</span><span class="ident" id="3947425">data</span><span class="op" id="3947429">)</span><span class="op" id="3947430">%</span><span class="ident" id="3947431">ciph</span><span class="op" id="3947435">.</span><span class="ident" id="3947436">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947447">encrypted</span>&nbsp;<span class="op" id="3947457">:=</span>&nbsp;<span class="builtinfunc" id="3947460">make</span><span class="op" id="3947464">(</span><span class="op" id="3947465">[</span><span class="op" id="3947466">]</span><span class="builtintype" id="3947467">byte</span><span class="op" id="3947471">,</span>&nbsp;<span class="builtinfunc" id="3947473">len</span><span class="op" id="3947476">(</span><span class="ident" id="3947477">data</span><span class="op" id="3947481">)</span><span class="op" id="3947482">,</span>&nbsp;<span class="builtinfunc" id="3947484">len</span><span class="op" id="3947487">(</span><span class="ident" id="3947488">data</span><span class="op" id="3947492">)</span><span class="op" id="3947493">+</span><span class="ident" id="3947494">pad</span><span class="op" id="3947497">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947500">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947566">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947632">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3947642">copy</span><span class="op" id="3947646">(</span><span class="ident" id="3947647">encrypted</span><span class="op" id="3947656">,</span>&nbsp;<span class="ident" id="3947658">data</span><span class="op" id="3947662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3947665">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947695">for</span>&nbsp;<span class="ident" id="3947699">i</span>&nbsp;<span class="op" id="3947701">:=</span>&nbsp;<span class="num" id="3947704">0</span><span class="op" id="3947705">;</span>&nbsp;<span class="ident" id="3947707">i</span>&nbsp;<span class="op" id="3947709">&lt;</span>&nbsp;<span class="ident" id="3947711">pad</span><span class="op" id="3947714">;</span>&nbsp;<span class="ident" id="3947716">i</span><span class="op" id="3947717">++</span>&nbsp;<span class="op" id="3947720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947724">encrypted</span>&nbsp;<span class="op" id="3947734">=</span>&nbsp;<span class="builtinfunc" id="3947736">append</span><span class="op" id="3947742">(</span><span class="ident" id="3947743">encrypted</span><span class="op" id="3947752">,</span>&nbsp;<span class="builtintype" id="3947754">byte</span><span class="op" id="3947758">(</span><span class="ident" id="3947759">pad</span><span class="op" id="3947762">)</span><span class="op" id="3947763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947769">enc</span><span class="op" id="3947772">.</span><span class="ident" id="3947773">CryptBlocks</span><span class="op" id="3947784">(</span><span class="ident" id="3947785">encrypted</span><span class="op" id="3947794">,</span>&nbsp;<span class="ident" id="3947796">encrypted</span><span class="op" id="3947805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947809">return</span>&nbsp;<span class="op" id="3947816">&amp;</span><span class="ident" id="3947817">pem</span><span class="op" id="3947820">.</span><span class="ident" id="3947821">Block</span><span class="op" id="3947826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947830">Type</span><span class="op" id="3947834">:</span>&nbsp;<span class="ident" id="3947836">blockType</span><span class="op" id="3947845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947849">Headers</span><span class="op" id="3947856">:</span>&nbsp;<span class="keyword" id="3947858">map</span><span class="op" id="3947861">[</span><span class="builtintype" id="3947862">string</span><span class="op" id="3947868">]</span><span class="builtintype" id="3947869">string</span><span class="op" id="3947875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3947880">&#34;Proc-Type&#34;</span><span class="op" id="3947891">:</span>&nbsp;<span class="string" id="3947893">&#34;4,ENCRYPTED&#34;</span><span class="op" id="3947906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3947911">&#34;DEK-Info&#34;</span><span class="op" id="3947921">:</span>&nbsp;&nbsp;<span class="ident" id="3947924">ciph</span><span class="op" id="3947928">.</span><span class="ident" id="3947929">name</span>&nbsp;<span class="op" id="3947934">+</span>&nbsp;<span class="string" id="3947936">&#34;,&#34;</span>&nbsp;<span class="op" id="3947940">+</span>&nbsp;<span class="ident" id="3947942">hex</span><span class="op" id="3947945">.</span><span class="ident" id="3947946">EncodeToString</span><span class="op" id="3947960">(</span><span class="ident" id="3947961">iv</span><span class="op" id="3947963">)</span><span class="op" id="3947964">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947968">}</span><span class="op" id="3947969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947973">Bytes</span><span class="op" id="3947978">:</span>&nbsp;<span class="ident" id="3947980">encrypted</span><span class="op" id="3947989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947992">}</span><span class="op" id="3947993">,</span>&nbsp;<span class="ident" id="3947995">nil</span><br>
<span class="lineno"></span><span class="op" id="3947999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3948002">func</span>&nbsp;<span class="ident" id="3948007">cipherByName</span><span class="op" id="3948019">(</span><span class="ident" id="3948020">name</span>&nbsp;<span class="builtintype" id="3948025">string</span><span class="op" id="3948031">)</span>&nbsp;<span class="op" id="3948033">*</span><span class="ident" id="3948034">rfc1423Algo</span>&nbsp;<span class="op" id="3948046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948049">for</span>&nbsp;<span class="ident" id="3948053">i</span>&nbsp;<span class="op" id="3948055">:=</span>&nbsp;<span class="keyword" id="3948058">range</span>&nbsp;<span class="ident" id="3948064">rfc1423Algos</span>&nbsp;<span class="op" id="3948077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948081">alg</span>&nbsp;<span class="op" id="3948085">:=</span>&nbsp;<span class="op" id="3948088">&amp;</span><span class="ident" id="3948089">rfc1423Algos</span><span class="op" id="3948101">[</span><span class="ident" id="3948102">i</span><span class="op" id="3948103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948107">if</span>&nbsp;<span class="ident" id="3948110">alg</span><span class="op" id="3948113">.</span><span class="ident" id="3948114">name</span>&nbsp;<span class="op" id="3948119">==</span>&nbsp;<span class="ident" id="3948122">name</span>&nbsp;<span class="op" id="3948127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948132">return</span>&nbsp;<span class="ident" id="3948139">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948151">return</span>&nbsp;<span class="ident" id="3948158">nil</span><br>
<span class="lineno"></span><span class="op" id="3948162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="3948165">func</span>&nbsp;<span class="ident" id="3948170">cipherByKey</span><span class="op" id="3948181">(</span><span class="ident" id="3948182">key</span>&nbsp;<span class="ident" id="3948186">PEMCipher</span><span class="op" id="3948195">)</span>&nbsp;<span class="op" id="3948197">*</span><span class="ident" id="3948198">rfc1423Algo</span>&nbsp;<span class="op" id="3948210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948213">for</span>&nbsp;<span class="ident" id="3948217">i</span>&nbsp;<span class="op" id="3948219">:=</span>&nbsp;<span class="keyword" id="3948222">range</span>&nbsp;<span class="ident" id="3948228">rfc1423Algos</span>&nbsp;<span class="op" id="3948241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948245">alg</span>&nbsp;<span class="op" id="3948249">:=</span>&nbsp;<span class="op" id="3948252">&amp;</span><span class="ident" id="3948253">rfc1423Algos</span><span class="op" id="3948265">[</span><span class="ident" id="3948266">i</span><span class="op" id="3948267">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948271">if</span>&nbsp;<span class="ident" id="3948274">alg</span><span class="op" id="3948277">.</span><span class="ident" id="3948278">cipher</span>&nbsp;<span class="op" id="3948285">==</span>&nbsp;<span class="ident" id="3948288">key</span>&nbsp;<span class="op" id="3948292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948297">return</span>&nbsp;<span class="ident" id="3948304">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948316">return</span>&nbsp;<span class="ident" id="3948323">nil</span><br>
<span class="lineno"></span><span class="op" id="3948327">}</span>
</div>
</body>
</html>
