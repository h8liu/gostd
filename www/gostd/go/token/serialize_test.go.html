<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7684669">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7684724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7684778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7684829">package</span>&nbsp;<span class="ident" id="7684837">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7684844">import</span>&nbsp;<span class="op" id="7684851">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7684854">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7684863">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7684879">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7684886">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7684896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7684899">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7684959">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7685020">func</span>&nbsp;<span class="ident" id="7685025">equal</span><span class="op" id="7685030">(</span><span class="ident" id="7685031">p</span><span class="op" id="7685032">,</span>&nbsp;<span class="ident" id="7685034">q</span>&nbsp;<span class="op" id="7685036">*</span><span class="ident" id="7685037">FileSet</span><span class="op" id="7685044">)</span>&nbsp;<span class="builtintype" id="7685046">error</span>&nbsp;<span class="op" id="7685052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685055">if</span>&nbsp;<span class="ident" id="7685058">p</span>&nbsp;<span class="op" id="7685060">==</span>&nbsp;<span class="ident" id="7685063">q</span>&nbsp;<span class="op" id="7685065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685069">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685099">return</span>&nbsp;<span class="ident" id="7685106">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7685115">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685152">p</span><span class="op" id="7685153">.</span><span class="ident" id="7685154">mutex</span><span class="op" id="7685159">.</span><span class="ident" id="7685160">Lock</span><span class="op" id="7685164">(</span><span class="op" id="7685165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685168">q</span><span class="op" id="7685169">.</span><span class="ident" id="7685170">mutex</span><span class="op" id="7685175">.</span><span class="ident" id="7685176">Lock</span><span class="op" id="7685180">(</span><span class="op" id="7685181">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685184">defer</span>&nbsp;<span class="ident" id="7685190">q</span><span class="op" id="7685191">.</span><span class="ident" id="7685192">mutex</span><span class="op" id="7685197">.</span><span class="ident" id="7685198">Unlock</span><span class="op" id="7685204">(</span><span class="op" id="7685205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685208">defer</span>&nbsp;<span class="ident" id="7685214">p</span><span class="op" id="7685215">.</span><span class="ident" id="7685216">mutex</span><span class="op" id="7685221">.</span><span class="ident" id="7685222">Unlock</span><span class="op" id="7685228">(</span><span class="op" id="7685229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685233">if</span>&nbsp;<span class="ident" id="7685236">p</span><span class="op" id="7685237">.</span><span class="ident" id="7685238">base</span>&nbsp;<span class="op" id="7685243">!=</span>&nbsp;<span class="ident" id="7685246">q</span><span class="op" id="7685247">.</span><span class="ident" id="7685248">base</span>&nbsp;<span class="op" id="7685253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685257">return</span>&nbsp;<span class="ident" id="7685264">fmt</span><span class="op" id="7685267">.</span><span class="ident" id="7685268">Errorf</span><span class="op" id="7685274">(</span><span class="string" id="7685275">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7685302">,</span>&nbsp;<span class="ident" id="7685304">p</span><span class="op" id="7685305">.</span><span class="ident" id="7685306">base</span><span class="op" id="7685310">,</span>&nbsp;<span class="ident" id="7685312">q</span><span class="op" id="7685313">.</span><span class="ident" id="7685314">base</span><span class="op" id="7685318">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685325">if</span>&nbsp;<span class="builtinfunc" id="7685328">len</span><span class="op" id="7685331">(</span><span class="ident" id="7685332">p</span><span class="op" id="7685333">.</span><span class="ident" id="7685334">files</span><span class="op" id="7685339">)</span>&nbsp;<span class="op" id="7685341">!=</span>&nbsp;<span class="builtinfunc" id="7685344">len</span><span class="op" id="7685347">(</span><span class="ident" id="7685348">q</span><span class="op" id="7685349">.</span><span class="ident" id="7685350">files</span><span class="op" id="7685355">)</span>&nbsp;<span class="op" id="7685357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685361">return</span>&nbsp;<span class="ident" id="7685368">fmt</span><span class="op" id="7685371">.</span><span class="ident" id="7685372">Errorf</span><span class="op" id="7685378">(</span><span class="string" id="7685379">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7685416">,</span>&nbsp;<span class="builtinfunc" id="7685418">len</span><span class="op" id="7685421">(</span><span class="ident" id="7685422">p</span><span class="op" id="7685423">.</span><span class="ident" id="7685424">files</span><span class="op" id="7685429">)</span><span class="op" id="7685430">,</span>&nbsp;<span class="builtinfunc" id="7685432">len</span><span class="op" id="7685435">(</span><span class="ident" id="7685436">q</span><span class="op" id="7685437">.</span><span class="ident" id="7685438">files</span><span class="op" id="7685443">)</span><span class="op" id="7685444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685447">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685451">for</span>&nbsp;<span class="ident" id="7685455">i</span><span class="op" id="7685456">,</span>&nbsp;<span class="ident" id="7685458">f</span>&nbsp;<span class="op" id="7685460">:=</span>&nbsp;<span class="keyword" id="7685463">range</span>&nbsp;<span class="ident" id="7685469">p</span><span class="op" id="7685470">.</span><span class="ident" id="7685471">files</span>&nbsp;<span class="op" id="7685477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685481">g</span>&nbsp;<span class="op" id="7685483">:=</span>&nbsp;<span class="ident" id="7685486">q</span><span class="op" id="7685487">.</span><span class="ident" id="7685488">files</span><span class="op" id="7685493">[</span><span class="ident" id="7685494">i</span><span class="op" id="7685495">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685499">if</span>&nbsp;<span class="ident" id="7685502">f</span><span class="op" id="7685503">.</span><span class="ident" id="7685504">set</span>&nbsp;<span class="op" id="7685508">!=</span>&nbsp;<span class="ident" id="7685511">p</span>&nbsp;<span class="op" id="7685513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685518">return</span>&nbsp;<span class="ident" id="7685525">fmt</span><span class="op" id="7685528">.</span><span class="ident" id="7685529">Errorf</span><span class="op" id="7685535">(</span><span class="string" id="7685536">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7685558">,</span>&nbsp;<span class="ident" id="7685560">f</span><span class="op" id="7685561">.</span><span class="ident" id="7685562">name</span><span class="op" id="7685566">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685574">if</span>&nbsp;<span class="ident" id="7685577">g</span><span class="op" id="7685578">.</span><span class="ident" id="7685579">set</span>&nbsp;<span class="op" id="7685583">!=</span>&nbsp;<span class="ident" id="7685586">q</span>&nbsp;<span class="op" id="7685588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685593">return</span>&nbsp;<span class="ident" id="7685600">fmt</span><span class="op" id="7685603">.</span><span class="ident" id="7685604">Errorf</span><span class="op" id="7685610">(</span><span class="string" id="7685611">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7685633">,</span>&nbsp;<span class="ident" id="7685635">g</span><span class="op" id="7685636">.</span><span class="ident" id="7685637">name</span><span class="op" id="7685641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685649">if</span>&nbsp;<span class="ident" id="7685652">f</span><span class="op" id="7685653">.</span><span class="ident" id="7685654">name</span>&nbsp;<span class="op" id="7685659">!=</span>&nbsp;<span class="ident" id="7685662">g</span><span class="op" id="7685663">.</span><span class="ident" id="7685664">name</span>&nbsp;<span class="op" id="7685669">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685674">return</span>&nbsp;<span class="ident" id="7685681">fmt</span><span class="op" id="7685684">.</span><span class="ident" id="7685685">Errorf</span><span class="op" id="7685691">(</span><span class="string" id="7685692">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7685723">,</span>&nbsp;<span class="ident" id="7685725">f</span><span class="op" id="7685726">.</span><span class="ident" id="7685727">name</span><span class="op" id="7685731">,</span>&nbsp;<span class="ident" id="7685733">g</span><span class="op" id="7685734">.</span><span class="ident" id="7685735">name</span><span class="op" id="7685739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685747">if</span>&nbsp;<span class="ident" id="7685750">f</span><span class="op" id="7685751">.</span><span class="ident" id="7685752">base</span>&nbsp;<span class="op" id="7685757">!=</span>&nbsp;<span class="ident" id="7685760">g</span><span class="op" id="7685761">.</span><span class="ident" id="7685762">base</span>&nbsp;<span class="op" id="7685767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685772">return</span>&nbsp;<span class="ident" id="7685779">fmt</span><span class="op" id="7685782">.</span><span class="ident" id="7685783">Errorf</span><span class="op" id="7685789">(</span><span class="string" id="7685790">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7685823">,</span>&nbsp;<span class="ident" id="7685825">f</span><span class="op" id="7685826">.</span><span class="ident" id="7685827">name</span><span class="op" id="7685831">,</span>&nbsp;<span class="ident" id="7685833">f</span><span class="op" id="7685834">.</span><span class="ident" id="7685835">base</span><span class="op" id="7685839">,</span>&nbsp;<span class="ident" id="7685841">g</span><span class="op" id="7685842">.</span><span class="ident" id="7685843">base</span><span class="op" id="7685847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685851">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685855">if</span>&nbsp;<span class="ident" id="7685858">f</span><span class="op" id="7685859">.</span><span class="ident" id="7685860">size</span>&nbsp;<span class="op" id="7685865">!=</span>&nbsp;<span class="ident" id="7685868">g</span><span class="op" id="7685869">.</span><span class="ident" id="7685870">size</span>&nbsp;<span class="op" id="7685875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685880">return</span>&nbsp;<span class="ident" id="7685887">fmt</span><span class="op" id="7685890">.</span><span class="ident" id="7685891">Errorf</span><span class="op" id="7685897">(</span><span class="string" id="7685898">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7685931">,</span>&nbsp;<span class="ident" id="7685933">f</span><span class="op" id="7685934">.</span><span class="ident" id="7685935">name</span><span class="op" id="7685939">,</span>&nbsp;<span class="ident" id="7685941">f</span><span class="op" id="7685942">.</span><span class="ident" id="7685943">size</span><span class="op" id="7685947">,</span>&nbsp;<span class="ident" id="7685949">g</span><span class="op" id="7685950">.</span><span class="ident" id="7685951">size</span><span class="op" id="7685955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7685959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685963">for</span>&nbsp;<span class="ident" id="7685967">j</span><span class="op" id="7685968">,</span>&nbsp;<span class="ident" id="7685970">l</span>&nbsp;<span class="op" id="7685972">:=</span>&nbsp;<span class="keyword" id="7685975">range</span>&nbsp;<span class="ident" id="7685981">f</span><span class="op" id="7685982">.</span><span class="ident" id="7685983">lines</span>&nbsp;<span class="op" id="7685989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685994">m</span>&nbsp;<span class="op" id="7685996">:=</span>&nbsp;<span class="ident" id="7685999">g</span><span class="op" id="7686000">.</span><span class="ident" id="7686001">lines</span><span class="op" id="7686006">[</span><span class="ident" id="7686007">j</span><span class="op" id="7686008">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686013">if</span>&nbsp;<span class="ident" id="7686016">l</span>&nbsp;<span class="op" id="7686018">!=</span>&nbsp;<span class="ident" id="7686021">m</span>&nbsp;<span class="op" id="7686023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686029">return</span>&nbsp;<span class="ident" id="7686036">fmt</span><span class="op" id="7686039">.</span><span class="ident" id="7686040">Errorf</span><span class="op" id="7686046">(</span><span class="string" id="7686047">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7686073">,</span>&nbsp;<span class="ident" id="7686075">f</span><span class="op" id="7686076">.</span><span class="ident" id="7686077">name</span><span class="op" id="7686081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686094">for</span>&nbsp;<span class="ident" id="7686098">j</span><span class="op" id="7686099">,</span>&nbsp;<span class="ident" id="7686101">l</span>&nbsp;<span class="op" id="7686103">:=</span>&nbsp;<span class="keyword" id="7686106">range</span>&nbsp;<span class="ident" id="7686112">f</span><span class="op" id="7686113">.</span><span class="ident" id="7686114">infos</span>&nbsp;<span class="op" id="7686120">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686125">m</span>&nbsp;<span class="op" id="7686127">:=</span>&nbsp;<span class="ident" id="7686130">g</span><span class="op" id="7686131">.</span><span class="ident" id="7686132">infos</span><span class="op" id="7686137">[</span><span class="ident" id="7686138">j</span><span class="op" id="7686139">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686144">if</span>&nbsp;<span class="ident" id="7686147">l</span><span class="op" id="7686148">.</span><span class="ident" id="7686149">Offset</span>&nbsp;<span class="op" id="7686156">!=</span>&nbsp;<span class="ident" id="7686159">m</span><span class="op" id="7686160">.</span><span class="ident" id="7686161">Offset</span>&nbsp;<span class="op" id="7686168">||</span>&nbsp;<span class="ident" id="7686171">l</span><span class="op" id="7686172">.</span><span class="ident" id="7686173">Filename</span>&nbsp;<span class="op" id="7686182">!=</span>&nbsp;<span class="ident" id="7686185">m</span><span class="op" id="7686186">.</span><span class="ident" id="7686187">Filename</span>&nbsp;<span class="op" id="7686196">||</span>&nbsp;<span class="ident" id="7686199">l</span><span class="op" id="7686200">.</span><span class="ident" id="7686201">Line</span>&nbsp;<span class="op" id="7686206">!=</span>&nbsp;<span class="ident" id="7686209">m</span><span class="op" id="7686210">.</span><span class="ident" id="7686211">Line</span>&nbsp;<span class="op" id="7686216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686222">return</span>&nbsp;<span class="ident" id="7686229">fmt</span><span class="op" id="7686232">.</span><span class="ident" id="7686233">Errorf</span><span class="op" id="7686239">(</span><span class="string" id="7686240">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7686264">,</span>&nbsp;<span class="ident" id="7686266">f</span><span class="op" id="7686267">.</span><span class="ident" id="7686268">name</span><span class="op" id="7686272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686281">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7686288">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686338">return</span>&nbsp;<span class="ident" id="7686345">nil</span><br>
<span class="lineno"></span><span class="op" id="7686349">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7686352">func</span>&nbsp;<span class="ident" id="7686357">checkSerialize</span><span class="op" id="7686371">(</span><span class="ident" id="7686372">t</span>&nbsp;<span class="op" id="7686374">*</span><span class="ident" id="7686375">testing</span><span class="op" id="7686382">.</span><span class="ident" id="7686383">T</span><span class="op" id="7686384">,</span>&nbsp;<span class="ident" id="7686386">p</span>&nbsp;<span class="op" id="7686388">*</span><span class="ident" id="7686389">FileSet</span><span class="op" id="7686396">)</span>&nbsp;<span class="op" id="7686398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686401">var</span>&nbsp;<span class="ident" id="7686405">buf</span>&nbsp;<span class="ident" id="7686409">bytes</span><span class="op" id="7686414">.</span><span class="ident" id="7686415">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686423">encode</span>&nbsp;<span class="op" id="7686430">:=</span>&nbsp;<span class="keyword" id="7686433">func</span><span class="op" id="7686437">(</span><span class="ident" id="7686438">x</span>&nbsp;<span class="keyword" id="7686440">interface</span><span class="op" id="7686449">{</span><span class="op" id="7686450">}</span><span class="op" id="7686451">)</span>&nbsp;<span class="builtintype" id="7686453">error</span>&nbsp;<span class="op" id="7686459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686463">return</span>&nbsp;<span class="ident" id="7686470">gob</span><span class="op" id="7686473">.</span><span class="ident" id="7686474">NewEncoder</span><span class="op" id="7686484">(</span><span class="op" id="7686485">&amp;</span><span class="ident" id="7686486">buf</span><span class="op" id="7686489">)</span><span class="op" id="7686490">.</span><span class="ident" id="7686491">Encode</span><span class="op" id="7686497">(</span><span class="ident" id="7686498">x</span><span class="op" id="7686499">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686505">if</span>&nbsp;<span class="ident" id="7686508">err</span>&nbsp;<span class="op" id="7686512">:=</span>&nbsp;<span class="ident" id="7686515">p</span><span class="op" id="7686516">.</span><span class="ident" id="7686517">Write</span><span class="op" id="7686522">(</span><span class="ident" id="7686523">encode</span><span class="op" id="7686529">)</span><span class="op" id="7686530">;</span>&nbsp;<span class="ident" id="7686532">err</span>&nbsp;<span class="op" id="7686536">!=</span>&nbsp;<span class="ident" id="7686539">nil</span>&nbsp;<span class="op" id="7686543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686547">t</span><span class="op" id="7686548">.</span><span class="ident" id="7686549">Errorf</span><span class="op" id="7686555">(</span><span class="string" id="7686556">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7686584">,</span>&nbsp;<span class="ident" id="7686586">err</span><span class="op" id="7686589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686593">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686601">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686604">q</span>&nbsp;<span class="op" id="7686606">:=</span>&nbsp;<span class="ident" id="7686609">NewFileSet</span><span class="op" id="7686619">(</span><span class="op" id="7686620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686623">decode</span>&nbsp;<span class="op" id="7686630">:=</span>&nbsp;<span class="keyword" id="7686633">func</span><span class="op" id="7686637">(</span><span class="ident" id="7686638">x</span>&nbsp;<span class="keyword" id="7686640">interface</span><span class="op" id="7686649">{</span><span class="op" id="7686650">}</span><span class="op" id="7686651">)</span>&nbsp;<span class="builtintype" id="7686653">error</span>&nbsp;<span class="op" id="7686659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686663">return</span>&nbsp;<span class="ident" id="7686670">gob</span><span class="op" id="7686673">.</span><span class="ident" id="7686674">NewDecoder</span><span class="op" id="7686684">(</span><span class="op" id="7686685">&amp;</span><span class="ident" id="7686686">buf</span><span class="op" id="7686689">)</span><span class="op" id="7686690">.</span><span class="ident" id="7686691">Decode</span><span class="op" id="7686697">(</span><span class="ident" id="7686698">x</span><span class="op" id="7686699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686705">if</span>&nbsp;<span class="ident" id="7686708">err</span>&nbsp;<span class="op" id="7686712">:=</span>&nbsp;<span class="ident" id="7686715">q</span><span class="op" id="7686716">.</span><span class="ident" id="7686717">Read</span><span class="op" id="7686721">(</span><span class="ident" id="7686722">decode</span><span class="op" id="7686728">)</span><span class="op" id="7686729">;</span>&nbsp;<span class="ident" id="7686731">err</span>&nbsp;<span class="op" id="7686735">!=</span>&nbsp;<span class="ident" id="7686738">nil</span>&nbsp;<span class="op" id="7686742">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686746">t</span><span class="op" id="7686747">.</span><span class="ident" id="7686748">Errorf</span><span class="op" id="7686754">(</span><span class="string" id="7686755">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7686783">,</span>&nbsp;<span class="ident" id="7686785">err</span><span class="op" id="7686788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686803">if</span>&nbsp;<span class="ident" id="7686806">err</span>&nbsp;<span class="op" id="7686810">:=</span>&nbsp;<span class="ident" id="7686813">equal</span><span class="op" id="7686818">(</span><span class="ident" id="7686819">p</span><span class="op" id="7686820">,</span>&nbsp;<span class="ident" id="7686822">q</span><span class="op" id="7686823">)</span><span class="op" id="7686824">;</span>&nbsp;<span class="ident" id="7686826">err</span>&nbsp;<span class="op" id="7686830">!=</span>&nbsp;<span class="ident" id="7686833">nil</span>&nbsp;<span class="op" id="7686837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686841">t</span><span class="op" id="7686842">.</span><span class="ident" id="7686843">Errorf</span><span class="op" id="7686849">(</span><span class="string" id="7686850">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7686878">,</span>&nbsp;<span class="ident" id="7686880">err</span><span class="op" id="7686883">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686886">}</span><br>
<span class="lineno"></span><span class="op" id="7686888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686891">func</span>&nbsp;<span class="ident" id="7686896">TestSerialization</span><span class="op" id="7686913">(</span><span class="ident" id="7686914">t</span>&nbsp;<span class="op" id="7686916">*</span><span class="ident" id="7686917">testing</span><span class="op" id="7686924">.</span><span class="ident" id="7686925">T</span><span class="op" id="7686926">)</span>&nbsp;<span class="op" id="7686928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686931">p</span>&nbsp;<span class="op" id="7686933">:=</span>&nbsp;<span class="ident" id="7686936">NewFileSet</span><span class="op" id="7686946">(</span><span class="op" id="7686947">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686950">checkSerialize</span><span class="op" id="7686964">(</span><span class="ident" id="7686965">t</span><span class="op" id="7686966">,</span>&nbsp;<span class="ident" id="7686968">p</span><span class="op" id="7686969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7686972">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686991">for</span>&nbsp;<span class="ident" id="7686995">i</span>&nbsp;<span class="op" id="7686997">:=</span>&nbsp;<span class="num" id="7687000">0</span><span class="op" id="7687001">;</span>&nbsp;<span class="ident" id="7687003">i</span>&nbsp;<span class="op" id="7687005">&lt;</span>&nbsp;<span class="num" id="7687007">10</span><span class="op" id="7687009">;</span>&nbsp;<span class="ident" id="7687011">i</span><span class="op" id="7687012">++</span>&nbsp;<span class="op" id="7687015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687019">f</span>&nbsp;<span class="op" id="7687021">:=</span>&nbsp;<span class="ident" id="7687024">p</span><span class="op" id="7687025">.</span><span class="ident" id="7687026">AddFile</span><span class="op" id="7687033">(</span><span class="ident" id="7687034">fmt</span><span class="op" id="7687037">.</span><span class="ident" id="7687038">Sprintf</span><span class="op" id="7687045">(</span><span class="string" id="7687046">&#34;file%d&#34;</span><span class="op" id="7687054">,</span>&nbsp;<span class="ident" id="7687056">i</span><span class="op" id="7687057">)</span><span class="op" id="7687058">,</span>&nbsp;<span class="ident" id="7687060">p</span><span class="op" id="7687061">.</span><span class="ident" id="7687062">Base</span><span class="op" id="7687066">(</span><span class="op" id="7687067">)</span><span class="op" id="7687068">+</span><span class="ident" id="7687069">i</span><span class="op" id="7687070">,</span>&nbsp;<span class="ident" id="7687072">i</span><span class="op" id="7687073">*</span><span class="num" id="7687074">100</span><span class="op" id="7687077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687081">checkSerialize</span><span class="op" id="7687095">(</span><span class="ident" id="7687096">t</span><span class="op" id="7687097">,</span>&nbsp;<span class="ident" id="7687099">p</span><span class="op" id="7687100">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687104">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687151">line</span>&nbsp;<span class="op" id="7687156">:=</span>&nbsp;<span class="num" id="7687159">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687166">for</span>&nbsp;<span class="ident" id="7687170">offs</span>&nbsp;<span class="op" id="7687175">:=</span>&nbsp;<span class="num" id="7687178">0</span><span class="op" id="7687179">;</span>&nbsp;<span class="ident" id="7687181">offs</span>&nbsp;<span class="op" id="7687186">&lt;</span>&nbsp;<span class="ident" id="7687188">f</span><span class="op" id="7687189">.</span><span class="ident" id="7687190">Size</span><span class="op" id="7687194">(</span><span class="op" id="7687195">)</span><span class="op" id="7687196">;</span>&nbsp;<span class="ident" id="7687198">offs</span>&nbsp;<span class="op" id="7687203">+=</span>&nbsp;<span class="num" id="7687206">40</span>&nbsp;<span class="op" id="7687209">+</span>&nbsp;<span class="ident" id="7687211">i</span>&nbsp;<span class="op" id="7687213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687218">f</span><span class="op" id="7687219">.</span><span class="ident" id="7687220">AddLine</span><span class="op" id="7687227">(</span><span class="ident" id="7687228">offs</span><span class="op" id="7687232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687237">if</span>&nbsp;<span class="ident" id="7687240">offs</span><span class="op" id="7687244">%</span><span class="num" id="7687245">7</span>&nbsp;<span class="op" id="7687247">==</span>&nbsp;<span class="num" id="7687250">0</span>&nbsp;<span class="op" id="7687252">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687258">f</span><span class="op" id="7687259">.</span><span class="ident" id="7687260">AddLineInfo</span><span class="op" id="7687271">(</span><span class="ident" id="7687272">offs</span><span class="op" id="7687276">,</span>&nbsp;<span class="ident" id="7687278">fmt</span><span class="op" id="7687281">.</span><span class="ident" id="7687282">Sprintf</span><span class="op" id="7687289">(</span><span class="string" id="7687290">&#34;file%d&#34;</span><span class="op" id="7687298">,</span>&nbsp;<span class="ident" id="7687300">offs</span><span class="op" id="7687304">)</span><span class="op" id="7687305">,</span>&nbsp;<span class="ident" id="7687307">line</span><span class="op" id="7687311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687317">line</span>&nbsp;<span class="op" id="7687322">+=</span>&nbsp;<span class="num" id="7687325">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687339">checkSerialize</span><span class="op" id="7687353">(</span><span class="ident" id="7687354">t</span><span class="op" id="7687355">,</span>&nbsp;<span class="ident" id="7687357">p</span><span class="op" id="7687358">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687361">}</span><br>
<span class="lineno"></span><span class="op" id="7687363">}</span>
</div>
</body>
</html>
