<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5089717">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5089772">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5089826">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5089877">package</span>&nbsp;<span class="ident" id="5089885">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089892">import</span>&nbsp;<span class="op" id="5089899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5089902">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5089909">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5089917">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5089924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089927">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5090008">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5090022">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5090073">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="5090123">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5090173">//</span><br>
<span class="lineno">20</span><span class="keyword" id="5090176">type</span>&nbsp;<span class="ident" id="5090181">Position</span>&nbsp;<span class="keyword" id="5090190">struct</span>&nbsp;<span class="op" id="5090197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090200">Filename</span>&nbsp;<span class="builtintype" id="5090209">string</span>&nbsp;<span class="comment" id="5090216">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090237">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5090246">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090253">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090279">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5090288">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090295">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090326">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5090335">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090342">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="5090392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5090395">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5090445">func</span>&nbsp;<span class="op" id="5090450">(</span><span class="ident" id="5090451">pos</span>&nbsp;<span class="op" id="5090455">*</span><span class="ident" id="5090456">Position</span><span class="op" id="5090464">)</span>&nbsp;<span class="ident" id="5090466">IsValid</span><span class="op" id="5090473">(</span><span class="op" id="5090474">)</span>&nbsp;<span class="builtintype" id="5090476">bool</span>&nbsp;<span class="op" id="5090481">{</span>&nbsp;<span class="keyword" id="5090483">return</span>&nbsp;<span class="ident" id="5090490">pos</span><span class="op" id="5090493">.</span><span class="ident" id="5090494">Line</span>&nbsp;<span class="op" id="5090499">&gt;</span>&nbsp;<span class="num" id="5090501">0</span>&nbsp;<span class="op" id="5090503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5090506">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="5090558">//</span><br>
<span class="lineno"></span><span class="comment" id="5090561">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5090614">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5090670">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5090725">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5090783">//</span><br>
<span class="lineno"></span><span class="keyword" id="5090786">func</span>&nbsp;<span class="op" id="5090791">(</span><span class="ident" id="5090792">pos</span>&nbsp;<span class="ident" id="5090796">Position</span><span class="op" id="5090804">)</span>&nbsp;<span class="ident" id="5090806">String</span><span class="op" id="5090812">(</span><span class="op" id="5090813">)</span>&nbsp;<span class="builtintype" id="5090815">string</span>&nbsp;<span class="op" id="5090822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090825">s</span>&nbsp;<span class="op" id="5090827">:=</span>&nbsp;<span class="ident" id="5090830">pos</span><span class="op" id="5090833">.</span><span class="ident" id="5090834">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090844">if</span>&nbsp;<span class="ident" id="5090847">pos</span><span class="op" id="5090850">.</span><span class="ident" id="5090851">IsValid</span><span class="op" id="5090858">(</span><span class="op" id="5090859">)</span>&nbsp;<span class="op" id="5090861">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090865">if</span>&nbsp;<span class="ident" id="5090868">s</span>&nbsp;<span class="op" id="5090870">!=</span>&nbsp;<span class="string" id="5090873">&#34;&#34;</span>&nbsp;<span class="op" id="5090876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090881">s</span>&nbsp;<span class="op" id="5090883">+=</span>&nbsp;<span class="string" id="5090886">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090896">s</span>&nbsp;<span class="op" id="5090898">+=</span>&nbsp;<span class="ident" id="5090901">fmt</span><span class="op" id="5090904">.</span><span class="ident" id="5090905">Sprintf</span><span class="op" id="5090912">(</span><span class="string" id="5090913">&#34;%d:%d&#34;</span><span class="op" id="5090920">,</span>&nbsp;<span class="ident" id="5090922">pos</span><span class="op" id="5090925">.</span><span class="ident" id="5090926">Line</span><span class="op" id="5090930">,</span>&nbsp;<span class="ident" id="5090932">pos</span><span class="op" id="5090935">.</span><span class="ident" id="5090936">Column</span><span class="op" id="5090942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090945">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090948">if</span>&nbsp;<span class="ident" id="5090951">s</span>&nbsp;<span class="op" id="5090953">==</span>&nbsp;<span class="string" id="5090956">&#34;&#34;</span>&nbsp;<span class="op" id="5090959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090963">s</span>&nbsp;<span class="op" id="5090965">=</span>&nbsp;<span class="string" id="5090967">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090975">return</span>&nbsp;<span class="ident" id="5090982">s</span><br>
<span class="lineno"></span><span class="op" id="5090984">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5090987">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5091056">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="5091127">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="5091154">//</span><br>
<span class="lineno">55</span><span class="comment" id="5091157">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="5091235">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5091313">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="5091325">//</span><br>
<span class="lineno"></span><span class="comment" id="5091328">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="5091395">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="5091464">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="5091533">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5091602">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="5091643">//</span><br>
<span class="lineno">65</span><span class="comment" id="5091646">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="5091722">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5091794">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="5091868">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5091944">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="5092004">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092007">type</span>&nbsp;<span class="ident" id="5092012">Pos</span>&nbsp;<span class="builtintype" id="5092016">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092021">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5092095">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="5092166">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5092236">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="5092281">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092284">const</span>&nbsp;<span class="ident" id="5092290">NoPos</span>&nbsp;<span class="ident" id="5092296">Pos</span>&nbsp;<span class="op" id="5092300">=</span>&nbsp;<span class="num" id="5092302">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5092305">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5092355">func</span>&nbsp;<span class="op" id="5092360">(</span><span class="ident" id="5092361">p</span>&nbsp;<span class="ident" id="5092363">Pos</span><span class="op" id="5092366">)</span>&nbsp;<span class="ident" id="5092368">IsValid</span><span class="op" id="5092375">(</span><span class="op" id="5092376">)</span>&nbsp;<span class="builtintype" id="5092378">bool</span>&nbsp;<span class="op" id="5092383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092386">return</span>&nbsp;<span class="ident" id="5092393">p</span>&nbsp;<span class="op" id="5092395">!=</span>&nbsp;<span class="ident" id="5092398">NoPos</span><br>
<span class="lineno"></span><span class="op" id="5092404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5092407">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5092488">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092497">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="5092554">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="5092605">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092608">type</span>&nbsp;<span class="ident" id="5092613">File</span>&nbsp;<span class="keyword" id="5092618">struct</span>&nbsp;<span class="op" id="5092625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092628">set</span>&nbsp;&nbsp;<span class="op" id="5092633">*</span><span class="ident" id="5092634">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092643">name</span>&nbsp;<span class="builtintype" id="5092648">string</span>&nbsp;<span class="comment" id="5092655">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092692">base</span>&nbsp;<span class="builtintype" id="5092697">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092704">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092760">size</span>&nbsp;<span class="builtintype" id="5092765">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092772">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5092810">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092857">lines</span>&nbsp;<span class="op" id="5092863">[</span><span class="op" id="5092864">]</span><span class="builtintype" id="5092865">int</span>&nbsp;<span class="comment" id="5092869">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092966">infos</span>&nbsp;<span class="op" id="5092972">[</span><span class="op" id="5092973">]</span><span class="ident" id="5092974">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="5092983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092986">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5093054">func</span>&nbsp;<span class="op" id="5093059">(</span><span class="ident" id="5093060">f</span>&nbsp;<span class="op" id="5093062">*</span><span class="ident" id="5093063">File</span><span class="op" id="5093067">)</span>&nbsp;<span class="ident" id="5093069">Name</span><span class="op" id="5093073">(</span><span class="op" id="5093074">)</span>&nbsp;<span class="builtintype" id="5093076">string</span>&nbsp;<span class="op" id="5093083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093086">return</span>&nbsp;<span class="ident" id="5093093">f</span><span class="op" id="5093094">.</span><span class="ident" id="5093095">name</span><br>
<span class="lineno">105</span><span class="op" id="5093100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093103">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5093173">func</span>&nbsp;<span class="op" id="5093178">(</span><span class="ident" id="5093179">f</span>&nbsp;<span class="op" id="5093181">*</span><span class="ident" id="5093182">File</span><span class="op" id="5093186">)</span>&nbsp;<span class="ident" id="5093188">Base</span><span class="op" id="5093192">(</span><span class="op" id="5093193">)</span>&nbsp;<span class="builtintype" id="5093195">int</span>&nbsp;<span class="op" id="5093199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093202">return</span>&nbsp;<span class="ident" id="5093209">f</span><span class="op" id="5093210">.</span><span class="ident" id="5093211">base</span><br>
<span class="lineno">110</span><span class="op" id="5093216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093219">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5093282">func</span>&nbsp;<span class="op" id="5093287">(</span><span class="ident" id="5093288">f</span>&nbsp;<span class="op" id="5093290">*</span><span class="ident" id="5093291">File</span><span class="op" id="5093295">)</span>&nbsp;<span class="ident" id="5093297">Size</span><span class="op" id="5093301">(</span><span class="op" id="5093302">)</span>&nbsp;<span class="builtintype" id="5093304">int</span>&nbsp;<span class="op" id="5093308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093311">return</span>&nbsp;<span class="ident" id="5093318">f</span><span class="op" id="5093319">.</span><span class="ident" id="5093320">size</span><br>
<span class="lineno">115</span><span class="op" id="5093325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093328">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5093380">func</span>&nbsp;<span class="op" id="5093385">(</span><span class="ident" id="5093386">f</span>&nbsp;<span class="op" id="5093388">*</span><span class="ident" id="5093389">File</span><span class="op" id="5093393">)</span>&nbsp;<span class="ident" id="5093395">LineCount</span><span class="op" id="5093404">(</span><span class="op" id="5093405">)</span>&nbsp;<span class="builtintype" id="5093407">int</span>&nbsp;<span class="op" id="5093411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093414">f</span><span class="op" id="5093415">.</span><span class="ident" id="5093416">set</span><span class="op" id="5093419">.</span><span class="ident" id="5093420">mutex</span><span class="op" id="5093425">.</span><span class="ident" id="5093426">RLock</span><span class="op" id="5093431">(</span><span class="op" id="5093432">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093435">n</span>&nbsp;<span class="op" id="5093437">:=</span>&nbsp;<span class="builtinfunc" id="5093440">len</span><span class="op" id="5093443">(</span><span class="ident" id="5093444">f</span><span class="op" id="5093445">.</span><span class="ident" id="5093446">lines</span><span class="op" id="5093451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093454">f</span><span class="op" id="5093455">.</span><span class="ident" id="5093456">set</span><span class="op" id="5093459">.</span><span class="ident" id="5093460">mutex</span><span class="op" id="5093465">.</span><span class="ident" id="5093466">RUnlock</span><span class="op" id="5093473">(</span><span class="op" id="5093474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093477">return</span>&nbsp;<span class="ident" id="5093484">n</span><br>
<span class="lineno"></span><span class="op" id="5093486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5093489">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5093537">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5093609">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5093682">//</span><br>
<span class="lineno"></span><span class="keyword" id="5093685">func</span>&nbsp;<span class="op" id="5093690">(</span><span class="ident" id="5093691">f</span>&nbsp;<span class="op" id="5093693">*</span><span class="ident" id="5093694">File</span><span class="op" id="5093698">)</span>&nbsp;<span class="ident" id="5093700">AddLine</span><span class="op" id="5093707">(</span><span class="ident" id="5093708">offset</span>&nbsp;<span class="builtintype" id="5093715">int</span><span class="op" id="5093718">)</span>&nbsp;<span class="op" id="5093720">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093723">f</span><span class="op" id="5093724">.</span><span class="ident" id="5093725">set</span><span class="op" id="5093728">.</span><span class="ident" id="5093729">mutex</span><span class="op" id="5093734">.</span><span class="ident" id="5093735">Lock</span><span class="op" id="5093739">(</span><span class="op" id="5093740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093743">if</span>&nbsp;<span class="ident" id="5093746">i</span>&nbsp;<span class="op" id="5093748">:=</span>&nbsp;<span class="builtinfunc" id="5093751">len</span><span class="op" id="5093754">(</span><span class="ident" id="5093755">f</span><span class="op" id="5093756">.</span><span class="ident" id="5093757">lines</span><span class="op" id="5093762">)</span><span class="op" id="5093763">;</span>&nbsp;<span class="op" id="5093765">(</span><span class="ident" id="5093766">i</span>&nbsp;<span class="op" id="5093768">==</span>&nbsp;<span class="num" id="5093771">0</span>&nbsp;<span class="op" id="5093773">||</span>&nbsp;<span class="ident" id="5093776">f</span><span class="op" id="5093777">.</span><span class="ident" id="5093778">lines</span><span class="op" id="5093783">[</span><span class="ident" id="5093784">i</span><span class="op" id="5093785">-</span><span class="num" id="5093786">1</span><span class="op" id="5093787">]</span>&nbsp;<span class="op" id="5093789">&lt;</span>&nbsp;<span class="ident" id="5093791">offset</span><span class="op" id="5093797">)</span>&nbsp;<span class="op" id="5093799">&amp;&amp;</span>&nbsp;<span class="ident" id="5093802">offset</span>&nbsp;<span class="op" id="5093809">&lt;</span>&nbsp;<span class="ident" id="5093811">f</span><span class="op" id="5093812">.</span><span class="ident" id="5093813">size</span>&nbsp;<span class="op" id="5093818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093822">f</span><span class="op" id="5093823">.</span><span class="ident" id="5093824">lines</span>&nbsp;<span class="op" id="5093830">=</span>&nbsp;<span class="builtinfunc" id="5093832">append</span><span class="op" id="5093838">(</span><span class="ident" id="5093839">f</span><span class="op" id="5093840">.</span><span class="ident" id="5093841">lines</span><span class="op" id="5093846">,</span>&nbsp;<span class="ident" id="5093848">offset</span><span class="op" id="5093854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093860">f</span><span class="op" id="5093861">.</span><span class="ident" id="5093862">set</span><span class="op" id="5093865">.</span><span class="ident" id="5093866">mutex</span><span class="op" id="5093871">.</span><span class="ident" id="5093872">Unlock</span><span class="op" id="5093878">(</span><span class="op" id="5093879">)</span><br>
<span class="lineno">135</span><span class="op" id="5093881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5093884">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="5093960">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5094040">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="5094118">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="5094175">//</span><br>
<span class="lineno"></span><span class="keyword" id="5094178">func</span>&nbsp;<span class="op" id="5094183">(</span><span class="ident" id="5094184">f</span>&nbsp;<span class="op" id="5094186">*</span><span class="ident" id="5094187">File</span><span class="op" id="5094191">)</span>&nbsp;<span class="ident" id="5094193">MergeLine</span><span class="op" id="5094202">(</span><span class="ident" id="5094203">line</span>&nbsp;<span class="builtintype" id="5094208">int</span><span class="op" id="5094211">)</span>&nbsp;<span class="op" id="5094213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094216">if</span>&nbsp;<span class="ident" id="5094219">line</span>&nbsp;<span class="op" id="5094224">&lt;=</span>&nbsp;<span class="num" id="5094227">0</span>&nbsp;<span class="op" id="5094229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5094233">panic</span><span class="op" id="5094238">(</span><span class="string" id="5094239">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="5094289">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094295">f</span><span class="op" id="5094296">.</span><span class="ident" id="5094297">set</span><span class="op" id="5094300">.</span><span class="ident" id="5094301">mutex</span><span class="op" id="5094306">.</span><span class="ident" id="5094307">Lock</span><span class="op" id="5094311">(</span><span class="op" id="5094312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094315">defer</span>&nbsp;<span class="ident" id="5094321">f</span><span class="op" id="5094322">.</span><span class="ident" id="5094323">set</span><span class="op" id="5094326">.</span><span class="ident" id="5094327">mutex</span><span class="op" id="5094332">.</span><span class="ident" id="5094333">Unlock</span><span class="op" id="5094339">(</span><span class="op" id="5094340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094343">if</span>&nbsp;<span class="ident" id="5094346">line</span>&nbsp;<span class="op" id="5094351">&gt;=</span>&nbsp;<span class="builtinfunc" id="5094354">len</span><span class="op" id="5094357">(</span><span class="ident" id="5094358">f</span><span class="op" id="5094359">.</span><span class="ident" id="5094360">lines</span><span class="op" id="5094365">)</span>&nbsp;<span class="op" id="5094367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5094371">panic</span><span class="op" id="5094376">(</span><span class="string" id="5094377">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="5094398">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094404">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094475">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094542">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094610">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094683">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5094729">copy</span><span class="op" id="5094733">(</span><span class="ident" id="5094734">f</span><span class="op" id="5094735">.</span><span class="ident" id="5094736">lines</span><span class="op" id="5094741">[</span><span class="ident" id="5094742">line</span><span class="op" id="5094746">:</span><span class="op" id="5094747">]</span><span class="op" id="5094748">,</span>&nbsp;<span class="ident" id="5094750">f</span><span class="op" id="5094751">.</span><span class="ident" id="5094752">lines</span><span class="op" id="5094757">[</span><span class="ident" id="5094758">line</span><span class="op" id="5094762">+</span><span class="num" id="5094763">1</span><span class="op" id="5094764">:</span><span class="op" id="5094765">]</span><span class="op" id="5094766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094769">f</span><span class="op" id="5094770">.</span><span class="ident" id="5094771">lines</span>&nbsp;<span class="op" id="5094777">=</span>&nbsp;<span class="ident" id="5094779">f</span><span class="op" id="5094780">.</span><span class="ident" id="5094781">lines</span><span class="op" id="5094786">[</span><span class="op" id="5094787">:</span><span class="builtinfunc" id="5094788">len</span><span class="op" id="5094791">(</span><span class="ident" id="5094792">f</span><span class="op" id="5094793">.</span><span class="ident" id="5094794">lines</span><span class="op" id="5094799">)</span><span class="op" id="5094800">-</span><span class="num" id="5094801">1</span><span class="op" id="5094802">]</span><br>
<span class="lineno"></span><span class="op" id="5094804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5094807">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="5094884">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="5094957">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="5095028">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="5095077">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="5095150">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5095222">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5095232">//</span><br>
<span class="lineno"></span><span class="keyword" id="5095235">func</span>&nbsp;<span class="op" id="5095240">(</span><span class="ident" id="5095241">f</span>&nbsp;<span class="op" id="5095243">*</span><span class="ident" id="5095244">File</span><span class="op" id="5095248">)</span>&nbsp;<span class="ident" id="5095250">SetLines</span><span class="op" id="5095258">(</span><span class="ident" id="5095259">lines</span>&nbsp;<span class="op" id="5095265">[</span><span class="op" id="5095266">]</span><span class="builtintype" id="5095267">int</span><span class="op" id="5095270">)</span>&nbsp;<span class="builtintype" id="5095272">bool</span>&nbsp;<span class="op" id="5095277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095280">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095315">size</span>&nbsp;<span class="op" id="5095320">:=</span>&nbsp;<span class="ident" id="5095323">f</span><span class="op" id="5095324">.</span><span class="ident" id="5095325">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095331">for</span>&nbsp;<span class="ident" id="5095335">i</span><span class="op" id="5095336">,</span>&nbsp;<span class="ident" id="5095338">offset</span>&nbsp;<span class="op" id="5095345">:=</span>&nbsp;<span class="keyword" id="5095348">range</span>&nbsp;<span class="ident" id="5095354">lines</span>&nbsp;<span class="op" id="5095360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095364">if</span>&nbsp;<span class="ident" id="5095367">i</span>&nbsp;<span class="op" id="5095369">&gt;</span>&nbsp;<span class="num" id="5095371">0</span>&nbsp;<span class="op" id="5095373">&amp;&amp;</span>&nbsp;<span class="ident" id="5095376">offset</span>&nbsp;<span class="op" id="5095383">&lt;=</span>&nbsp;<span class="ident" id="5095386">lines</span><span class="op" id="5095391">[</span><span class="ident" id="5095392">i</span><span class="op" id="5095393">-</span><span class="num" id="5095394">1</span><span class="op" id="5095395">]</span>&nbsp;<span class="op" id="5095397">||</span>&nbsp;<span class="ident" id="5095400">size</span>&nbsp;<span class="op" id="5095405">&lt;=</span>&nbsp;<span class="ident" id="5095408">offset</span>&nbsp;<span class="op" id="5095415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095420">return</span>&nbsp;<span class="builtintype" id="5095427">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095435">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095442">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095462">f</span><span class="op" id="5095463">.</span><span class="ident" id="5095464">set</span><span class="op" id="5095467">.</span><span class="ident" id="5095468">mutex</span><span class="op" id="5095473">.</span><span class="ident" id="5095474">Lock</span><span class="op" id="5095478">(</span><span class="op" id="5095479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095482">f</span><span class="op" id="5095483">.</span><span class="ident" id="5095484">lines</span>&nbsp;<span class="op" id="5095490">=</span>&nbsp;<span class="ident" id="5095492">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095499">f</span><span class="op" id="5095500">.</span><span class="ident" id="5095501">set</span><span class="op" id="5095504">.</span><span class="ident" id="5095505">mutex</span><span class="op" id="5095510">.</span><span class="ident" id="5095511">Unlock</span><span class="op" id="5095517">(</span><span class="op" id="5095518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095521">return</span>&nbsp;<span class="builtintype" id="5095528">true</span><br>
<span class="lineno"></span><span class="op" id="5095533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5095536">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="5095608">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="5095657">func</span>&nbsp;<span class="op" id="5095662">(</span><span class="ident" id="5095663">f</span>&nbsp;<span class="op" id="5095665">*</span><span class="ident" id="5095666">File</span><span class="op" id="5095670">)</span>&nbsp;<span class="ident" id="5095672">SetLinesForContent</span><span class="op" id="5095690">(</span><span class="ident" id="5095691">content</span>&nbsp;<span class="op" id="5095699">[</span><span class="op" id="5095700">]</span><span class="builtintype" id="5095701">byte</span><span class="op" id="5095705">)</span>&nbsp;<span class="op" id="5095707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095710">var</span>&nbsp;<span class="ident" id="5095714">lines</span>&nbsp;<span class="op" id="5095720">[</span><span class="op" id="5095721">]</span><span class="builtintype" id="5095722">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095727">line</span>&nbsp;<span class="op" id="5095732">:=</span>&nbsp;<span class="num" id="5095735">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095738">for</span>&nbsp;<span class="ident" id="5095742">offset</span><span class="op" id="5095748">,</span>&nbsp;<span class="ident" id="5095750">b</span>&nbsp;<span class="op" id="5095752">:=</span>&nbsp;<span class="keyword" id="5095755">range</span>&nbsp;<span class="ident" id="5095761">content</span>&nbsp;<span class="op" id="5095769">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095773">if</span>&nbsp;<span class="ident" id="5095776">line</span>&nbsp;<span class="op" id="5095781">&gt;=</span>&nbsp;<span class="num" id="5095784">0</span>&nbsp;<span class="op" id="5095786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095791">lines</span>&nbsp;<span class="op" id="5095797">=</span>&nbsp;<span class="builtinfunc" id="5095799">append</span><span class="op" id="5095805">(</span><span class="ident" id="5095806">lines</span><span class="op" id="5095811">,</span>&nbsp;<span class="ident" id="5095813">line</span><span class="op" id="5095817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095825">line</span>&nbsp;<span class="op" id="5095830">=</span>&nbsp;<span class="op" id="5095832">-</span><span class="num" id="5095833">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5095837">if</span>&nbsp;<span class="ident" id="5095840">b</span>&nbsp;<span class="op" id="5095842">==</span>&nbsp;<span class="string" id="5095845">&#39;\n&#39;</span>&nbsp;<span class="op" id="5095850">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095855">line</span>&nbsp;<span class="op" id="5095860">=</span>&nbsp;<span class="ident" id="5095862">offset</span>&nbsp;<span class="op" id="5095869">+</span>&nbsp;<span class="num" id="5095871">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5095878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5095882">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095902">f</span><span class="op" id="5095903">.</span><span class="ident" id="5095904">set</span><span class="op" id="5095907">.</span><span class="ident" id="5095908">mutex</span><span class="op" id="5095913">.</span><span class="ident" id="5095914">Lock</span><span class="op" id="5095918">(</span><span class="op" id="5095919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095922">f</span><span class="op" id="5095923">.</span><span class="ident" id="5095924">lines</span>&nbsp;<span class="op" id="5095930">=</span>&nbsp;<span class="ident" id="5095932">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5095939">f</span><span class="op" id="5095940">.</span><span class="ident" id="5095941">set</span><span class="op" id="5095944">.</span><span class="ident" id="5095945">mutex</span><span class="op" id="5095950">.</span><span class="ident" id="5095951">Unlock</span><span class="op" id="5095957">(</span><span class="op" id="5095958">)</span><br>
<span class="lineno"></span><span class="op" id="5095960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5095963">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5096027">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="5096090">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5096124">type</span>&nbsp;<span class="ident" id="5096129">lineInfo</span>&nbsp;<span class="keyword" id="5096138">struct</span>&nbsp;<span class="op" id="5096145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5096148">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096203">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5096212">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096217">Filename</span>&nbsp;<span class="builtintype" id="5096226">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096234">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5096243">int</span><br>
<span class="lineno"></span><span class="op" id="5096247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5096250">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5096319">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5096389">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5096456">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5096508">//</span><br>
<span class="lineno">220</span><span class="comment" id="5096511">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5096577">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5096643">//</span><br>
<span class="lineno"></span><span class="keyword" id="5096646">func</span>&nbsp;<span class="op" id="5096651">(</span><span class="ident" id="5096652">f</span>&nbsp;<span class="op" id="5096654">*</span><span class="ident" id="5096655">File</span><span class="op" id="5096659">)</span>&nbsp;<span class="ident" id="5096661">AddLineInfo</span><span class="op" id="5096672">(</span><span class="ident" id="5096673">offset</span>&nbsp;<span class="builtintype" id="5096680">int</span><span class="op" id="5096683">,</span>&nbsp;<span class="ident" id="5096685">filename</span>&nbsp;<span class="builtintype" id="5096694">string</span><span class="op" id="5096700">,</span>&nbsp;<span class="ident" id="5096702">line</span>&nbsp;<span class="builtintype" id="5096707">int</span><span class="op" id="5096710">)</span>&nbsp;<span class="op" id="5096712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096715">f</span><span class="op" id="5096716">.</span><span class="ident" id="5096717">set</span><span class="op" id="5096720">.</span><span class="ident" id="5096721">mutex</span><span class="op" id="5096726">.</span><span class="ident" id="5096727">Lock</span><span class="op" id="5096731">(</span><span class="op" id="5096732">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5096735">if</span>&nbsp;<span class="ident" id="5096738">i</span>&nbsp;<span class="op" id="5096740">:=</span>&nbsp;<span class="builtinfunc" id="5096743">len</span><span class="op" id="5096746">(</span><span class="ident" id="5096747">f</span><span class="op" id="5096748">.</span><span class="ident" id="5096749">infos</span><span class="op" id="5096754">)</span><span class="op" id="5096755">;</span>&nbsp;<span class="ident" id="5096757">i</span>&nbsp;<span class="op" id="5096759">==</span>&nbsp;<span class="num" id="5096762">0</span>&nbsp;<span class="op" id="5096764">||</span>&nbsp;<span class="ident" id="5096767">f</span><span class="op" id="5096768">.</span><span class="ident" id="5096769">infos</span><span class="op" id="5096774">[</span><span class="ident" id="5096775">i</span><span class="op" id="5096776">-</span><span class="num" id="5096777">1</span><span class="op" id="5096778">]</span><span class="op" id="5096779">.</span><span class="ident" id="5096780">Offset</span>&nbsp;<span class="op" id="5096787">&lt;</span>&nbsp;<span class="ident" id="5096789">offset</span>&nbsp;<span class="op" id="5096796">&amp;&amp;</span>&nbsp;<span class="ident" id="5096799">offset</span>&nbsp;<span class="op" id="5096806">&lt;</span>&nbsp;<span class="ident" id="5096808">f</span><span class="op" id="5096809">.</span><span class="ident" id="5096810">size</span>&nbsp;<span class="op" id="5096815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096819">f</span><span class="op" id="5096820">.</span><span class="ident" id="5096821">infos</span>&nbsp;<span class="op" id="5096827">=</span>&nbsp;<span class="builtinfunc" id="5096829">append</span><span class="op" id="5096835">(</span><span class="ident" id="5096836">f</span><span class="op" id="5096837">.</span><span class="ident" id="5096838">infos</span><span class="op" id="5096843">,</span>&nbsp;<span class="ident" id="5096845">lineInfo</span><span class="op" id="5096853">{</span><span class="ident" id="5096854">offset</span><span class="op" id="5096860">,</span>&nbsp;<span class="ident" id="5096862">filename</span><span class="op" id="5096870">,</span>&nbsp;<span class="ident" id="5096872">line</span><span class="op" id="5096876">}</span><span class="op" id="5096877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5096880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5096883">f</span><span class="op" id="5096884">.</span><span class="ident" id="5096885">set</span><span class="op" id="5096888">.</span><span class="ident" id="5096889">mutex</span><span class="op" id="5096894">.</span><span class="ident" id="5096895">Unlock</span><span class="op" id="5096901">(</span><span class="op" id="5096902">)</span><br>
<span class="lineno"></span><span class="op" id="5096904">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5096907">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="5096963">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="5096998">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5097026">//</span><br>
<span class="lineno">235</span><span class="keyword" id="5097029">func</span>&nbsp;<span class="op" id="5097034">(</span><span class="ident" id="5097035">f</span>&nbsp;<span class="op" id="5097037">*</span><span class="ident" id="5097038">File</span><span class="op" id="5097042">)</span>&nbsp;<span class="ident" id="5097044">Pos</span><span class="op" id="5097047">(</span><span class="ident" id="5097048">offset</span>&nbsp;<span class="builtintype" id="5097055">int</span><span class="op" id="5097058">)</span>&nbsp;<span class="ident" id="5097060">Pos</span>&nbsp;<span class="op" id="5097064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097067">if</span>&nbsp;<span class="ident" id="5097070">offset</span>&nbsp;<span class="op" id="5097077">&gt;</span>&nbsp;<span class="ident" id="5097079">f</span><span class="op" id="5097080">.</span><span class="ident" id="5097081">size</span>&nbsp;<span class="op" id="5097086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5097090">panic</span><span class="op" id="5097095">(</span><span class="string" id="5097096">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="5097117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097123">return</span>&nbsp;<span class="ident" id="5097130">Pos</span><span class="op" id="5097133">(</span><span class="ident" id="5097134">f</span><span class="op" id="5097135">.</span><span class="ident" id="5097136">base</span>&nbsp;<span class="op" id="5097141">+</span>&nbsp;<span class="ident" id="5097143">offset</span><span class="op" id="5097149">)</span><br>
<span class="lineno">240</span><span class="op" id="5097151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5097154">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5097214">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5097259">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="5097297">//</span><br>
<span class="lineno"></span><span class="keyword" id="5097300">func</span>&nbsp;<span class="op" id="5097305">(</span><span class="ident" id="5097306">f</span>&nbsp;<span class="op" id="5097308">*</span><span class="ident" id="5097309">File</span><span class="op" id="5097313">)</span>&nbsp;<span class="ident" id="5097315">Offset</span><span class="op" id="5097321">(</span><span class="ident" id="5097322">p</span>&nbsp;<span class="ident" id="5097324">Pos</span><span class="op" id="5097327">)</span>&nbsp;<span class="builtintype" id="5097329">int</span>&nbsp;<span class="op" id="5097333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097336">if</span>&nbsp;<span class="builtintype" id="5097339">int</span><span class="op" id="5097342">(</span><span class="ident" id="5097343">p</span><span class="op" id="5097344">)</span>&nbsp;<span class="op" id="5097346">&lt;</span>&nbsp;<span class="ident" id="5097348">f</span><span class="op" id="5097349">.</span><span class="ident" id="5097350">base</span>&nbsp;<span class="op" id="5097355">||</span>&nbsp;<span class="builtintype" id="5097358">int</span><span class="op" id="5097361">(</span><span class="ident" id="5097362">p</span><span class="op" id="5097363">)</span>&nbsp;<span class="op" id="5097365">&gt;</span>&nbsp;<span class="ident" id="5097367">f</span><span class="op" id="5097368">.</span><span class="ident" id="5097369">base</span><span class="op" id="5097373">+</span><span class="ident" id="5097374">f</span><span class="op" id="5097375">.</span><span class="ident" id="5097376">size</span>&nbsp;<span class="op" id="5097381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5097385">panic</span><span class="op" id="5097390">(</span><span class="string" id="5097391">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5097410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5097413">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097416">return</span>&nbsp;<span class="builtintype" id="5097423">int</span><span class="op" id="5097426">(</span><span class="ident" id="5097427">p</span><span class="op" id="5097428">)</span>&nbsp;<span class="op" id="5097430">-</span>&nbsp;<span class="ident" id="5097432">f</span><span class="op" id="5097433">.</span><span class="ident" id="5097434">base</span><br>
<span class="lineno"></span><span class="op" id="5097439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5097442">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5097505">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="5097553">//</span><br>
<span class="lineno"></span><span class="keyword" id="5097556">func</span>&nbsp;<span class="op" id="5097561">(</span><span class="ident" id="5097562">f</span>&nbsp;<span class="op" id="5097564">*</span><span class="ident" id="5097565">File</span><span class="op" id="5097569">)</span>&nbsp;<span class="ident" id="5097571">Line</span><span class="op" id="5097575">(</span><span class="ident" id="5097576">p</span>&nbsp;<span class="ident" id="5097578">Pos</span><span class="op" id="5097581">)</span>&nbsp;<span class="builtintype" id="5097583">int</span>&nbsp;<span class="op" id="5097587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097590">return</span>&nbsp;<span class="ident" id="5097597">f</span><span class="op" id="5097598">.</span><span class="ident" id="5097599">Position</span><span class="op" id="5097607">(</span><span class="ident" id="5097608">p</span><span class="op" id="5097609">)</span><span class="op" id="5097610">.</span><span class="ident" id="5097611">Line</span><br>
<span class="lineno"></span><span class="op" id="5097616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5097619">func</span>&nbsp;<span class="ident" id="5097624">searchLineInfos</span><span class="op" id="5097639">(</span><span class="ident" id="5097640">a</span>&nbsp;<span class="op" id="5097642">[</span><span class="op" id="5097643">]</span><span class="ident" id="5097644">lineInfo</span><span class="op" id="5097652">,</span>&nbsp;<span class="ident" id="5097654">x</span>&nbsp;<span class="builtintype" id="5097656">int</span><span class="op" id="5097659">)</span>&nbsp;<span class="builtintype" id="5097661">int</span>&nbsp;<span class="op" id="5097665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5097668">return</span>&nbsp;<span class="ident" id="5097675">sort</span><span class="op" id="5097679">.</span><span class="ident" id="5097680">Search</span><span class="op" id="5097686">(</span><span class="builtinfunc" id="5097687">len</span><span class="op" id="5097690">(</span><span class="ident" id="5097691">a</span><span class="op" id="5097692">)</span><span class="op" id="5097693">,</span>&nbsp;<span class="keyword" id="5097695">func</span><span class="op" id="5097699">(</span><span class="ident" id="5097700">i</span>&nbsp;<span class="builtintype" id="5097702">int</span><span class="op" id="5097705">)</span>&nbsp;<span class="builtintype" id="5097707">bool</span>&nbsp;<span class="op" id="5097712">{</span>&nbsp;<span class="keyword" id="5097714">return</span>&nbsp;<span class="ident" id="5097721">a</span><span class="op" id="5097722">[</span><span class="ident" id="5097723">i</span><span class="op" id="5097724">]</span><span class="op" id="5097725">.</span><span class="ident" id="5097726">Offset</span>&nbsp;<span class="op" id="5097733">&gt;</span>&nbsp;<span class="ident" id="5097735">x</span>&nbsp;<span class="op" id="5097737">}</span><span class="op" id="5097738">)</span>&nbsp;<span class="op" id="5097740">-</span>&nbsp;<span class="num" id="5097742">1</span><br>
<span class="lineno"></span><span class="op" id="5097744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5097747">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="5097824">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5097900">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5097979">//</span><br>
<span class="lineno"></span><span class="keyword" id="5097982">func</span>&nbsp;<span class="op" id="5097987">(</span><span class="ident" id="5097988">f</span>&nbsp;<span class="op" id="5097990">*</span><span class="ident" id="5097991">File</span><span class="op" id="5097995">)</span>&nbsp;<span class="ident" id="5097997">unpack</span><span class="op" id="5098003">(</span><span class="ident" id="5098004">offset</span>&nbsp;<span class="builtintype" id="5098011">int</span><span class="op" id="5098014">,</span>&nbsp;<span class="ident" id="5098016">adjusted</span>&nbsp;<span class="builtintype" id="5098025">bool</span><span class="op" id="5098029">)</span>&nbsp;<span class="op" id="5098031">(</span><span class="ident" id="5098032">filename</span>&nbsp;<span class="builtintype" id="5098041">string</span><span class="op" id="5098047">,</span>&nbsp;<span class="ident" id="5098049">line</span><span class="op" id="5098053">,</span>&nbsp;<span class="ident" id="5098055">column</span>&nbsp;<span class="builtintype" id="5098062">int</span><span class="op" id="5098065">)</span>&nbsp;<span class="op" id="5098067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098070">filename</span>&nbsp;<span class="op" id="5098079">=</span>&nbsp;<span class="ident" id="5098081">f</span><span class="op" id="5098082">.</span><span class="ident" id="5098083">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098089">if</span>&nbsp;<span class="ident" id="5098092">i</span>&nbsp;<span class="op" id="5098094">:=</span>&nbsp;<span class="ident" id="5098097">searchInts</span><span class="op" id="5098107">(</span><span class="ident" id="5098108">f</span><span class="op" id="5098109">.</span><span class="ident" id="5098110">lines</span><span class="op" id="5098115">,</span>&nbsp;<span class="ident" id="5098117">offset</span><span class="op" id="5098123">)</span><span class="op" id="5098124">;</span>&nbsp;<span class="ident" id="5098126">i</span>&nbsp;<span class="op" id="5098128">&gt;=</span>&nbsp;<span class="num" id="5098131">0</span>&nbsp;<span class="op" id="5098133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098137">line</span><span class="op" id="5098141">,</span>&nbsp;<span class="ident" id="5098143">column</span>&nbsp;<span class="op" id="5098150">=</span>&nbsp;<span class="ident" id="5098152">i</span><span class="op" id="5098153">+</span><span class="num" id="5098154">1</span><span class="op" id="5098155">,</span>&nbsp;<span class="ident" id="5098157">offset</span><span class="op" id="5098163">-</span><span class="ident" id="5098164">f</span><span class="op" id="5098165">.</span><span class="ident" id="5098166">lines</span><span class="op" id="5098171">[</span><span class="ident" id="5098172">i</span><span class="op" id="5098173">]</span><span class="op" id="5098174">+</span><span class="num" id="5098175">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098181">if</span>&nbsp;<span class="ident" id="5098184">adjusted</span>&nbsp;<span class="op" id="5098193">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5098196">len</span><span class="op" id="5098199">(</span><span class="ident" id="5098200">f</span><span class="op" id="5098201">.</span><span class="ident" id="5098202">infos</span><span class="op" id="5098207">)</span>&nbsp;<span class="op" id="5098209">&gt;</span>&nbsp;<span class="num" id="5098211">0</span>&nbsp;<span class="op" id="5098213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5098217">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098260">if</span>&nbsp;<span class="ident" id="5098263">i</span>&nbsp;<span class="op" id="5098265">:=</span>&nbsp;<span class="ident" id="5098268">searchLineInfos</span><span class="op" id="5098283">(</span><span class="ident" id="5098284">f</span><span class="op" id="5098285">.</span><span class="ident" id="5098286">infos</span><span class="op" id="5098291">,</span>&nbsp;<span class="ident" id="5098293">offset</span><span class="op" id="5098299">)</span><span class="op" id="5098300">;</span>&nbsp;<span class="ident" id="5098302">i</span>&nbsp;<span class="op" id="5098304">&gt;=</span>&nbsp;<span class="num" id="5098307">0</span>&nbsp;<span class="op" id="5098309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098314">alt</span>&nbsp;<span class="op" id="5098318">:=</span>&nbsp;<span class="op" id="5098321">&amp;</span><span class="ident" id="5098322">f</span><span class="op" id="5098323">.</span><span class="ident" id="5098324">infos</span><span class="op" id="5098329">[</span><span class="ident" id="5098330">i</span><span class="op" id="5098331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098336">filename</span>&nbsp;<span class="op" id="5098345">=</span>&nbsp;<span class="ident" id="5098347">alt</span><span class="op" id="5098350">.</span><span class="ident" id="5098351">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098363">if</span>&nbsp;<span class="ident" id="5098366">i</span>&nbsp;<span class="op" id="5098368">:=</span>&nbsp;<span class="ident" id="5098371">searchInts</span><span class="op" id="5098381">(</span><span class="ident" id="5098382">f</span><span class="op" id="5098383">.</span><span class="ident" id="5098384">lines</span><span class="op" id="5098389">,</span>&nbsp;<span class="ident" id="5098391">alt</span><span class="op" id="5098394">.</span><span class="ident" id="5098395">Offset</span><span class="op" id="5098401">)</span><span class="op" id="5098402">;</span>&nbsp;<span class="ident" id="5098404">i</span>&nbsp;<span class="op" id="5098406">&gt;=</span>&nbsp;<span class="num" id="5098409">0</span>&nbsp;<span class="op" id="5098411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098417">line</span>&nbsp;<span class="op" id="5098422">+=</span>&nbsp;<span class="ident" id="5098425">alt</span><span class="op" id="5098428">.</span><span class="ident" id="5098429">Line</span>&nbsp;<span class="op" id="5098434">-</span>&nbsp;<span class="ident" id="5098436">i</span>&nbsp;<span class="op" id="5098438">-</span>&nbsp;<span class="num" id="5098440">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5098452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098455">return</span><br>
<span class="lineno"></span><span class="op" id="5098462">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5098465">func</span>&nbsp;<span class="op" id="5098470">(</span><span class="ident" id="5098471">f</span>&nbsp;<span class="op" id="5098473">*</span><span class="ident" id="5098474">File</span><span class="op" id="5098478">)</span>&nbsp;<span class="ident" id="5098480">position</span><span class="op" id="5098488">(</span><span class="ident" id="5098489">p</span>&nbsp;<span class="ident" id="5098491">Pos</span><span class="op" id="5098494">,</span>&nbsp;<span class="ident" id="5098496">adjusted</span>&nbsp;<span class="builtintype" id="5098505">bool</span><span class="op" id="5098509">)</span>&nbsp;<span class="op" id="5098511">(</span><span class="ident" id="5098512">pos</span>&nbsp;<span class="ident" id="5098516">Position</span><span class="op" id="5098524">)</span>&nbsp;<span class="op" id="5098526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098529">offset</span>&nbsp;<span class="op" id="5098536">:=</span>&nbsp;<span class="builtintype" id="5098539">int</span><span class="op" id="5098542">(</span><span class="ident" id="5098543">p</span><span class="op" id="5098544">)</span>&nbsp;<span class="op" id="5098546">-</span>&nbsp;<span class="ident" id="5098548">f</span><span class="op" id="5098549">.</span><span class="ident" id="5098550">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098556">pos</span><span class="op" id="5098559">.</span><span class="ident" id="5098560">Offset</span>&nbsp;<span class="op" id="5098567">=</span>&nbsp;<span class="ident" id="5098569">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5098577">pos</span><span class="op" id="5098580">.</span><span class="ident" id="5098581">Filename</span><span class="op" id="5098589">,</span>&nbsp;<span class="ident" id="5098591">pos</span><span class="op" id="5098594">.</span><span class="ident" id="5098595">Line</span><span class="op" id="5098599">,</span>&nbsp;<span class="ident" id="5098601">pos</span><span class="op" id="5098604">.</span><span class="ident" id="5098605">Column</span>&nbsp;<span class="op" id="5098612">=</span>&nbsp;<span class="ident" id="5098614">f</span><span class="op" id="5098615">.</span><span class="ident" id="5098616">unpack</span><span class="op" id="5098622">(</span><span class="ident" id="5098623">offset</span><span class="op" id="5098629">,</span>&nbsp;<span class="ident" id="5098631">adjusted</span><span class="op" id="5098639">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098642">return</span><br>
<span class="lineno"></span><span class="op" id="5098649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5098652">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5098725">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="5098798">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5098856">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5098896">//</span><br>
<span class="lineno"></span><span class="keyword" id="5098899">func</span>&nbsp;<span class="op" id="5098904">(</span><span class="ident" id="5098905">f</span>&nbsp;<span class="op" id="5098907">*</span><span class="ident" id="5098908">File</span><span class="op" id="5098912">)</span>&nbsp;<span class="ident" id="5098914">PositionFor</span><span class="op" id="5098925">(</span><span class="ident" id="5098926">p</span>&nbsp;<span class="ident" id="5098928">Pos</span><span class="op" id="5098931">,</span>&nbsp;<span class="ident" id="5098933">adjusted</span>&nbsp;<span class="builtintype" id="5098942">bool</span><span class="op" id="5098946">)</span>&nbsp;<span class="op" id="5098948">(</span><span class="ident" id="5098949">pos</span>&nbsp;<span class="ident" id="5098953">Position</span><span class="op" id="5098961">)</span>&nbsp;<span class="op" id="5098963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098966">if</span>&nbsp;<span class="ident" id="5098969">p</span>&nbsp;<span class="op" id="5098971">!=</span>&nbsp;<span class="ident" id="5098974">NoPos</span>&nbsp;<span class="op" id="5098980">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5098984">if</span>&nbsp;<span class="builtintype" id="5098987">int</span><span class="op" id="5098990">(</span><span class="ident" id="5098991">p</span><span class="op" id="5098992">)</span>&nbsp;<span class="op" id="5098994">&lt;</span>&nbsp;<span class="ident" id="5098996">f</span><span class="op" id="5098997">.</span><span class="ident" id="5098998">base</span>&nbsp;<span class="op" id="5099003">||</span>&nbsp;<span class="builtintype" id="5099006">int</span><span class="op" id="5099009">(</span><span class="ident" id="5099010">p</span><span class="op" id="5099011">)</span>&nbsp;<span class="op" id="5099013">&gt;</span>&nbsp;<span class="ident" id="5099015">f</span><span class="op" id="5099016">.</span><span class="ident" id="5099017">base</span><span class="op" id="5099021">+</span><span class="ident" id="5099022">f</span><span class="op" id="5099023">.</span><span class="ident" id="5099024">size</span>&nbsp;<span class="op" id="5099029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5099034">panic</span><span class="op" id="5099039">(</span><span class="string" id="5099040">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5099059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099067">pos</span>&nbsp;<span class="op" id="5099071">=</span>&nbsp;<span class="ident" id="5099073">f</span><span class="op" id="5099074">.</span><span class="ident" id="5099075">position</span><span class="op" id="5099083">(</span><span class="ident" id="5099084">p</span><span class="op" id="5099085">,</span>&nbsp;<span class="ident" id="5099087">adjusted</span><span class="op" id="5099095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099098">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099101">return</span><br>
<span class="lineno"></span><span class="op" id="5099108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5099111">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5099181">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="5099255">//</span><br>
<span class="lineno"></span><span class="keyword" id="5099258">func</span>&nbsp;<span class="op" id="5099263">(</span><span class="ident" id="5099264">f</span>&nbsp;<span class="op" id="5099266">*</span><span class="ident" id="5099267">File</span><span class="op" id="5099271">)</span>&nbsp;<span class="ident" id="5099273">Position</span><span class="op" id="5099281">(</span><span class="ident" id="5099282">p</span>&nbsp;<span class="ident" id="5099284">Pos</span><span class="op" id="5099287">)</span>&nbsp;<span class="op" id="5099289">(</span><span class="ident" id="5099290">pos</span>&nbsp;<span class="ident" id="5099294">Position</span><span class="op" id="5099302">)</span>&nbsp;<span class="op" id="5099304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099307">return</span>&nbsp;<span class="ident" id="5099314">f</span><span class="op" id="5099315">.</span><span class="ident" id="5099316">PositionFor</span><span class="op" id="5099327">(</span><span class="ident" id="5099328">p</span><span class="op" id="5099329">,</span>&nbsp;<span class="builtintype" id="5099331">true</span><span class="op" id="5099335">)</span><br>
<span class="lineno"></span><span class="op" id="5099337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5099340">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5099421">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5099433">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5099480">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="5099542">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="5099575">//</span><br>
<span class="lineno"></span><span class="keyword" id="5099578">type</span>&nbsp;<span class="ident" id="5099583">FileSet</span>&nbsp;<span class="keyword" id="5099591">struct</span>&nbsp;<span class="op" id="5099598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099601">mutex</span>&nbsp;<span class="ident" id="5099607">sync</span><span class="op" id="5099611">.</span><span class="ident" id="5099612">RWMutex</span>&nbsp;<span class="comment" id="5099620">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099646">base</span>&nbsp;&nbsp;<span class="builtintype" id="5099652">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099665">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099699">files</span>&nbsp;<span class="op" id="5099705">[</span><span class="op" id="5099706">]</span><span class="op" id="5099707">*</span><span class="ident" id="5099708">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099718">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099766">last</span>&nbsp;&nbsp;<span class="op" id="5099772">*</span><span class="ident" id="5099773">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099785">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="5099817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5099820">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="5099858">func</span>&nbsp;<span class="ident" id="5099863">NewFileSet</span><span class="op" id="5099873">(</span><span class="op" id="5099874">)</span>&nbsp;<span class="op" id="5099876">*</span><span class="ident" id="5099877">FileSet</span>&nbsp;<span class="op" id="5099885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5099888">return</span>&nbsp;<span class="op" id="5099895">&amp;</span><span class="ident" id="5099896">FileSet</span><span class="op" id="5099903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5099907">base</span><span class="op" id="5099911">:</span>&nbsp;<span class="num" id="5099913">1</span><span class="op" id="5099914">,</span>&nbsp;<span class="comment" id="5099916">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5099931">}</span><br>
<span class="lineno"></span><span class="op" id="5099933">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="5099936">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5100001">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5100039">//</span><br>
<span class="lineno"></span><span class="keyword" id="5100042">func</span>&nbsp;<span class="op" id="5100047">(</span><span class="ident" id="5100048">s</span>&nbsp;<span class="op" id="5100050">*</span><span class="ident" id="5100051">FileSet</span><span class="op" id="5100058">)</span>&nbsp;<span class="ident" id="5100060">Base</span><span class="op" id="5100064">(</span><span class="op" id="5100065">)</span>&nbsp;<span class="builtintype" id="5100067">int</span>&nbsp;<span class="op" id="5100071">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100074">s</span><span class="op" id="5100075">.</span><span class="ident" id="5100076">mutex</span><span class="op" id="5100081">.</span><span class="ident" id="5100082">RLock</span><span class="op" id="5100087">(</span><span class="op" id="5100088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100091">b</span>&nbsp;<span class="op" id="5100093">:=</span>&nbsp;<span class="ident" id="5100096">s</span><span class="op" id="5100097">.</span><span class="ident" id="5100098">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5100104">s</span><span class="op" id="5100105">.</span><span class="ident" id="5100106">mutex</span><span class="op" id="5100111">.</span><span class="ident" id="5100112">RUnlock</span><span class="op" id="5100119">(</span><span class="op" id="5100120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5100123">return</span>&nbsp;<span class="ident" id="5100130">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="5100133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5100136">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="5100213">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5100289">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="5100365">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="5100446">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5100508">//</span><br>
<span class="lineno"></span><span class="comment" id="5100511">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5100586">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="5100661">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="5100723">//</span><br>
<span class="lineno"></span><span class="comment" id="5100726">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="5100750">//</span><br>
<span class="lineno"></span><span class="comment" id="5100753">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="5100832">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5100906">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="5100936">//</span><br>
<span class="lineno"></span><span class="keyword" id="5100939">func</span>&nbsp;<span class="op" id="5100944">(</span><span class="ident" id="5100945">s</span>&nbsp;<span class="op" id="5100947">*</span><span class="ident" id="5100948">FileSet</span><span class="op" id="5100955">)</span>&nbsp;<span class="ident" id="5100957">AddFile</span><span class="op" id="5100964">(</span><span class="ident" id="5100965">filename</span>&nbsp;<span class="builtintype" id="5100974">string</span><span class="op" id="5100980">,</span>&nbsp;<span class="ident" id="5100982">base</span><span class="op" id="5100986">,</span>&nbsp;<span class="ident" id="5100988">size</span>&nbsp;<span class="builtintype" id="5100993">int</span><span class="op" id="5100996">)</span>&nbsp;<span class="op" id="5100998">*</span><span class="ident" id="5100999">File</span>&nbsp;<span class="op" id="5101004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101007">s</span><span class="op" id="5101008">.</span><span class="ident" id="5101009">mutex</span><span class="op" id="5101014">.</span><span class="ident" id="5101015">Lock</span><span class="op" id="5101019">(</span><span class="op" id="5101020">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101023">defer</span>&nbsp;<span class="ident" id="5101029">s</span><span class="op" id="5101030">.</span><span class="ident" id="5101031">mutex</span><span class="op" id="5101036">.</span><span class="ident" id="5101037">Unlock</span><span class="op" id="5101043">(</span><span class="op" id="5101044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101047">if</span>&nbsp;<span class="ident" id="5101050">base</span>&nbsp;<span class="op" id="5101055">&lt;</span>&nbsp;<span class="num" id="5101057">0</span>&nbsp;<span class="op" id="5101059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101063">base</span>&nbsp;<span class="op" id="5101068">=</span>&nbsp;<span class="ident" id="5101070">s</span><span class="op" id="5101071">.</span><span class="ident" id="5101072">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101081">if</span>&nbsp;<span class="ident" id="5101084">base</span>&nbsp;<span class="op" id="5101089">&lt;</span>&nbsp;<span class="ident" id="5101091">s</span><span class="op" id="5101092">.</span><span class="ident" id="5101093">base</span>&nbsp;<span class="op" id="5101098">||</span>&nbsp;<span class="ident" id="5101101">size</span>&nbsp;<span class="op" id="5101106">&lt;</span>&nbsp;<span class="num" id="5101108">0</span>&nbsp;<span class="op" id="5101110">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5101114">panic</span><span class="op" id="5101119">(</span><span class="string" id="5101120">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="5101142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101148">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101180">f</span>&nbsp;<span class="op" id="5101182">:=</span>&nbsp;<span class="op" id="5101185">&amp;</span><span class="ident" id="5101186">File</span><span class="op" id="5101190">{</span><span class="ident" id="5101191">s</span><span class="op" id="5101192">,</span>&nbsp;<span class="ident" id="5101194">filename</span><span class="op" id="5101202">,</span>&nbsp;<span class="ident" id="5101204">base</span><span class="op" id="5101208">,</span>&nbsp;<span class="ident" id="5101210">size</span><span class="op" id="5101214">,</span>&nbsp;<span class="op" id="5101216">[</span><span class="op" id="5101217">]</span><span class="builtintype" id="5101218">int</span><span class="op" id="5101221">{</span><span class="num" id="5101222">0</span><span class="op" id="5101223">}</span><span class="op" id="5101224">,</span>&nbsp;<span class="ident" id="5101226">nil</span><span class="op" id="5101229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101232">base</span>&nbsp;<span class="op" id="5101237">+=</span>&nbsp;<span class="ident" id="5101240">size</span>&nbsp;<span class="op" id="5101245">+</span>&nbsp;<span class="num" id="5101247">1</span>&nbsp;<span class="comment" id="5101249">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101288">if</span>&nbsp;<span class="ident" id="5101291">base</span>&nbsp;<span class="op" id="5101296">&lt;</span>&nbsp;<span class="num" id="5101298">0</span>&nbsp;<span class="op" id="5101300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5101304">panic</span><span class="op" id="5101309">(</span><span class="string" id="5101310">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="5101371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101377">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101410">s</span><span class="op" id="5101411">.</span><span class="ident" id="5101412">base</span>&nbsp;<span class="op" id="5101417">=</span>&nbsp;<span class="ident" id="5101419">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101425">s</span><span class="op" id="5101426">.</span><span class="ident" id="5101427">files</span>&nbsp;<span class="op" id="5101433">=</span>&nbsp;<span class="builtinfunc" id="5101435">append</span><span class="op" id="5101441">(</span><span class="ident" id="5101442">s</span><span class="op" id="5101443">.</span><span class="ident" id="5101444">files</span><span class="op" id="5101449">,</span>&nbsp;<span class="ident" id="5101451">f</span><span class="op" id="5101452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101455">s</span><span class="op" id="5101456">.</span><span class="ident" id="5101457">last</span>&nbsp;<span class="op" id="5101462">=</span>&nbsp;<span class="ident" id="5101464">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101467">return</span>&nbsp;<span class="ident" id="5101474">f</span><br>
<span class="lineno"></span><span class="op" id="5101476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5101479">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5101557">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5101583">//</span><br>
<span class="lineno"></span><span class="keyword" id="5101586">func</span>&nbsp;<span class="op" id="5101591">(</span><span class="ident" id="5101592">s</span>&nbsp;<span class="op" id="5101594">*</span><span class="ident" id="5101595">FileSet</span><span class="op" id="5101602">)</span>&nbsp;<span class="ident" id="5101604">Iterate</span><span class="op" id="5101611">(</span><span class="ident" id="5101612">f</span>&nbsp;<span class="keyword" id="5101614">func</span><span class="op" id="5101618">(</span><span class="op" id="5101619">*</span><span class="ident" id="5101620">File</span><span class="op" id="5101624">)</span>&nbsp;<span class="builtintype" id="5101626">bool</span><span class="op" id="5101630">)</span>&nbsp;<span class="op" id="5101632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101635">for</span>&nbsp;<span class="ident" id="5101639">i</span>&nbsp;<span class="op" id="5101641">:=</span>&nbsp;<span class="num" id="5101644">0</span><span class="op" id="5101645">;</span>&nbsp;<span class="op" id="5101647">;</span>&nbsp;<span class="ident" id="5101649">i</span><span class="op" id="5101650">++</span>&nbsp;<span class="op" id="5101653">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101657">var</span>&nbsp;<span class="ident" id="5101661">file</span>&nbsp;<span class="op" id="5101666">*</span><span class="ident" id="5101667">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101674">s</span><span class="op" id="5101675">.</span><span class="ident" id="5101676">mutex</span><span class="op" id="5101681">.</span><span class="ident" id="5101682">RLock</span><span class="op" id="5101687">(</span><span class="op" id="5101688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101692">if</span>&nbsp;<span class="ident" id="5101695">i</span>&nbsp;<span class="op" id="5101697">&lt;</span>&nbsp;<span class="builtinfunc" id="5101699">len</span><span class="op" id="5101702">(</span><span class="ident" id="5101703">s</span><span class="op" id="5101704">.</span><span class="ident" id="5101705">files</span><span class="op" id="5101710">)</span>&nbsp;<span class="op" id="5101712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101717">file</span>&nbsp;<span class="op" id="5101722">=</span>&nbsp;<span class="ident" id="5101724">s</span><span class="op" id="5101725">.</span><span class="ident" id="5101726">files</span><span class="op" id="5101731">[</span><span class="ident" id="5101732">i</span><span class="op" id="5101733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101737">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101741">s</span><span class="op" id="5101742">.</span><span class="ident" id="5101743">mutex</span><span class="op" id="5101748">.</span><span class="ident" id="5101749">RUnlock</span><span class="op" id="5101756">(</span><span class="op" id="5101757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101761">if</span>&nbsp;<span class="ident" id="5101764">file</span>&nbsp;<span class="op" id="5101769">==</span>&nbsp;<span class="ident" id="5101772">nil</span>&nbsp;<span class="op" id="5101776">||</span>&nbsp;<span class="op" id="5101779">!</span><span class="ident" id="5101780">f</span><span class="op" id="5101781">(</span><span class="ident" id="5101782">file</span><span class="op" id="5101786">)</span>&nbsp;<span class="op" id="5101788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101793">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5101804">}</span><br>
<span class="lineno">400</span><span class="op" id="5101806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5101809">func</span>&nbsp;<span class="ident" id="5101814">searchFiles</span><span class="op" id="5101825">(</span><span class="ident" id="5101826">a</span>&nbsp;<span class="op" id="5101828">[</span><span class="op" id="5101829">]</span><span class="op" id="5101830">*</span><span class="ident" id="5101831">File</span><span class="op" id="5101835">,</span>&nbsp;<span class="ident" id="5101837">x</span>&nbsp;<span class="builtintype" id="5101839">int</span><span class="op" id="5101842">)</span>&nbsp;<span class="builtintype" id="5101844">int</span>&nbsp;<span class="op" id="5101848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5101851">return</span>&nbsp;<span class="ident" id="5101858">sort</span><span class="op" id="5101862">.</span><span class="ident" id="5101863">Search</span><span class="op" id="5101869">(</span><span class="builtinfunc" id="5101870">len</span><span class="op" id="5101873">(</span><span class="ident" id="5101874">a</span><span class="op" id="5101875">)</span><span class="op" id="5101876">,</span>&nbsp;<span class="keyword" id="5101878">func</span><span class="op" id="5101882">(</span><span class="ident" id="5101883">i</span>&nbsp;<span class="builtintype" id="5101885">int</span><span class="op" id="5101888">)</span>&nbsp;<span class="builtintype" id="5101890">bool</span>&nbsp;<span class="op" id="5101895">{</span>&nbsp;<span class="keyword" id="5101897">return</span>&nbsp;<span class="ident" id="5101904">a</span><span class="op" id="5101905">[</span><span class="ident" id="5101906">i</span><span class="op" id="5101907">]</span><span class="op" id="5101908">.</span><span class="ident" id="5101909">base</span>&nbsp;<span class="op" id="5101914">&gt;</span>&nbsp;<span class="ident" id="5101916">x</span>&nbsp;<span class="op" id="5101918">}</span><span class="op" id="5101919">)</span>&nbsp;<span class="op" id="5101921">-</span>&nbsp;<span class="num" id="5101923">1</span><br>
<span class="lineno"></span><span class="op" id="5101925">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5101928">func</span>&nbsp;<span class="op" id="5101933">(</span><span class="ident" id="5101934">s</span>&nbsp;<span class="op" id="5101936">*</span><span class="ident" id="5101937">FileSet</span><span class="op" id="5101944">)</span>&nbsp;<span class="ident" id="5101946">file</span><span class="op" id="5101950">(</span><span class="ident" id="5101951">p</span>&nbsp;<span class="ident" id="5101953">Pos</span><span class="op" id="5101956">)</span>&nbsp;<span class="op" id="5101958">*</span><span class="ident" id="5101959">File</span>&nbsp;<span class="op" id="5101964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5101967">s</span><span class="op" id="5101968">.</span><span class="ident" id="5101969">mutex</span><span class="op" id="5101974">.</span><span class="ident" id="5101975">RLock</span><span class="op" id="5101980">(</span><span class="op" id="5101981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5101984">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102019">if</span>&nbsp;<span class="ident" id="5102022">f</span>&nbsp;<span class="op" id="5102024">:=</span>&nbsp;<span class="ident" id="5102027">s</span><span class="op" id="5102028">.</span><span class="ident" id="5102029">last</span><span class="op" id="5102033">;</span>&nbsp;<span class="ident" id="5102035">f</span>&nbsp;<span class="op" id="5102037">!=</span>&nbsp;<span class="ident" id="5102040">nil</span>&nbsp;<span class="op" id="5102044">&amp;&amp;</span>&nbsp;<span class="ident" id="5102047">f</span><span class="op" id="5102048">.</span><span class="ident" id="5102049">base</span>&nbsp;<span class="op" id="5102054">&lt;=</span>&nbsp;<span class="builtintype" id="5102057">int</span><span class="op" id="5102060">(</span><span class="ident" id="5102061">p</span><span class="op" id="5102062">)</span>&nbsp;<span class="op" id="5102064">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5102067">int</span><span class="op" id="5102070">(</span><span class="ident" id="5102071">p</span><span class="op" id="5102072">)</span>&nbsp;<span class="op" id="5102074">&lt;=</span>&nbsp;<span class="ident" id="5102077">f</span><span class="op" id="5102078">.</span><span class="ident" id="5102079">base</span><span class="op" id="5102083">+</span><span class="ident" id="5102084">f</span><span class="op" id="5102085">.</span><span class="ident" id="5102086">size</span>&nbsp;<span class="op" id="5102091">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102095">s</span><span class="op" id="5102096">.</span><span class="ident" id="5102097">mutex</span><span class="op" id="5102102">.</span><span class="ident" id="5102103">RUnlock</span><span class="op" id="5102110">(</span><span class="op" id="5102111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102115">return</span>&nbsp;<span class="ident" id="5102122">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102128">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102173">if</span>&nbsp;<span class="ident" id="5102176">i</span>&nbsp;<span class="op" id="5102178">:=</span>&nbsp;<span class="ident" id="5102181">searchFiles</span><span class="op" id="5102192">(</span><span class="ident" id="5102193">s</span><span class="op" id="5102194">.</span><span class="ident" id="5102195">files</span><span class="op" id="5102200">,</span>&nbsp;<span class="builtintype" id="5102202">int</span><span class="op" id="5102205">(</span><span class="ident" id="5102206">p</span><span class="op" id="5102207">)</span><span class="op" id="5102208">)</span><span class="op" id="5102209">;</span>&nbsp;<span class="ident" id="5102211">i</span>&nbsp;<span class="op" id="5102213">&gt;=</span>&nbsp;<span class="num" id="5102216">0</span>&nbsp;<span class="op" id="5102218">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102222">f</span>&nbsp;<span class="op" id="5102224">:=</span>&nbsp;<span class="ident" id="5102227">s</span><span class="op" id="5102228">.</span><span class="ident" id="5102229">files</span><span class="op" id="5102234">[</span><span class="ident" id="5102235">i</span><span class="op" id="5102236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5102240">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102291">if</span>&nbsp;<span class="builtintype" id="5102294">int</span><span class="op" id="5102297">(</span><span class="ident" id="5102298">p</span><span class="op" id="5102299">)</span>&nbsp;<span class="op" id="5102301">&lt;=</span>&nbsp;<span class="ident" id="5102304">f</span><span class="op" id="5102305">.</span><span class="ident" id="5102306">base</span><span class="op" id="5102310">+</span><span class="ident" id="5102311">f</span><span class="op" id="5102312">.</span><span class="ident" id="5102313">size</span>&nbsp;<span class="op" id="5102318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102323">s</span><span class="op" id="5102324">.</span><span class="ident" id="5102325">mutex</span><span class="op" id="5102330">.</span><span class="ident" id="5102331">RUnlock</span><span class="op" id="5102338">(</span><span class="op" id="5102339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102344">s</span><span class="op" id="5102345">.</span><span class="ident" id="5102346">mutex</span><span class="op" id="5102351">.</span><span class="ident" id="5102352">Lock</span><span class="op" id="5102356">(</span><span class="op" id="5102357">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102362">s</span><span class="op" id="5102363">.</span><span class="ident" id="5102364">last</span>&nbsp;<span class="op" id="5102369">=</span>&nbsp;<span class="ident" id="5102371">f</span>&nbsp;<span class="comment" id="5102373">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102415">s</span><span class="op" id="5102416">.</span><span class="ident" id="5102417">mutex</span><span class="op" id="5102422">.</span><span class="ident" id="5102423">Unlock</span><span class="op" id="5102429">(</span><span class="op" id="5102430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102435">return</span>&nbsp;<span class="ident" id="5102442">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102449">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102452">s</span><span class="op" id="5102453">.</span><span class="ident" id="5102454">mutex</span><span class="op" id="5102459">.</span><span class="ident" id="5102460">RUnlock</span><span class="op" id="5102467">(</span><span class="op" id="5102468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102471">return</span>&nbsp;<span class="ident" id="5102478">nil</span><br>
<span class="lineno"></span><span class="op" id="5102482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5102485">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="5102540">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="5102599">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5102621">//</span><br>
<span class="lineno"></span><span class="keyword" id="5102624">func</span>&nbsp;<span class="op" id="5102629">(</span><span class="ident" id="5102630">s</span>&nbsp;<span class="op" id="5102632">*</span><span class="ident" id="5102633">FileSet</span><span class="op" id="5102640">)</span>&nbsp;<span class="ident" id="5102642">File</span><span class="op" id="5102646">(</span><span class="ident" id="5102647">p</span>&nbsp;<span class="ident" id="5102649">Pos</span><span class="op" id="5102652">)</span>&nbsp;<span class="op" id="5102654">(</span><span class="ident" id="5102655">f</span>&nbsp;<span class="op" id="5102657">*</span><span class="ident" id="5102658">File</span><span class="op" id="5102662">)</span>&nbsp;<span class="op" id="5102664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102667">if</span>&nbsp;<span class="ident" id="5102670">p</span>&nbsp;<span class="op" id="5102672">!=</span>&nbsp;<span class="ident" id="5102675">NoPos</span>&nbsp;<span class="op" id="5102681">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5102685">f</span>&nbsp;<span class="op" id="5102687">=</span>&nbsp;<span class="ident" id="5102689">s</span><span class="op" id="5102690">.</span><span class="ident" id="5102691">file</span><span class="op" id="5102695">(</span><span class="ident" id="5102696">p</span><span class="op" id="5102697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5102700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5102703">return</span><br>
<span class="lineno"></span><span class="op" id="5102710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5102713">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5102783">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="5102856">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5102914">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5102954">//</span><br>
<span class="lineno">445</span><span class="keyword" id="5102957">func</span>&nbsp;<span class="op" id="5102962">(</span><span class="ident" id="5102963">s</span>&nbsp;<span class="op" id="5102965">*</span><span class="ident" id="5102966">FileSet</span><span class="op" id="5102973">)</span>&nbsp;<span class="ident" id="5102975">PositionFor</span><span class="op" id="5102986">(</span><span class="ident" id="5102987">p</span>&nbsp;<span class="ident" id="5102989">Pos</span><span class="op" id="5102992">,</span>&nbsp;<span class="ident" id="5102994">adjusted</span>&nbsp;<span class="builtintype" id="5103003">bool</span><span class="op" id="5103007">)</span>&nbsp;<span class="op" id="5103009">(</span><span class="ident" id="5103010">pos</span>&nbsp;<span class="ident" id="5103014">Position</span><span class="op" id="5103022">)</span>&nbsp;<span class="op" id="5103024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103027">if</span>&nbsp;<span class="ident" id="5103030">p</span>&nbsp;<span class="op" id="5103032">!=</span>&nbsp;<span class="ident" id="5103035">NoPos</span>&nbsp;<span class="op" id="5103041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103045">if</span>&nbsp;<span class="ident" id="5103048">f</span>&nbsp;<span class="op" id="5103050">:=</span>&nbsp;<span class="ident" id="5103053">s</span><span class="op" id="5103054">.</span><span class="ident" id="5103055">file</span><span class="op" id="5103059">(</span><span class="ident" id="5103060">p</span><span class="op" id="5103061">)</span><span class="op" id="5103062">;</span>&nbsp;<span class="ident" id="5103064">f</span>&nbsp;<span class="op" id="5103066">!=</span>&nbsp;<span class="ident" id="5103069">nil</span>&nbsp;<span class="op" id="5103073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103078">pos</span>&nbsp;<span class="op" id="5103082">=</span>&nbsp;<span class="ident" id="5103084">f</span><span class="op" id="5103085">.</span><span class="ident" id="5103086">position</span><span class="op" id="5103094">(</span><span class="ident" id="5103095">p</span><span class="op" id="5103096">,</span>&nbsp;<span class="ident" id="5103098">adjusted</span><span class="op" id="5103106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103110">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5103113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103116">return</span><br>
<span class="lineno"></span><span class="op" id="5103123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5103126">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="5103193">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="5103267">//</span><br>
<span class="lineno"></span><span class="keyword" id="5103270">func</span>&nbsp;<span class="op" id="5103275">(</span><span class="ident" id="5103276">s</span>&nbsp;<span class="op" id="5103278">*</span><span class="ident" id="5103279">FileSet</span><span class="op" id="5103286">)</span>&nbsp;<span class="ident" id="5103288">Position</span><span class="op" id="5103296">(</span><span class="ident" id="5103297">p</span>&nbsp;<span class="ident" id="5103299">Pos</span><span class="op" id="5103302">)</span>&nbsp;<span class="op" id="5103304">(</span><span class="ident" id="5103305">pos</span>&nbsp;<span class="ident" id="5103309">Position</span><span class="op" id="5103317">)</span>&nbsp;<span class="op" id="5103319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103322">return</span>&nbsp;<span class="ident" id="5103329">s</span><span class="op" id="5103330">.</span><span class="ident" id="5103331">PositionFor</span><span class="op" id="5103342">(</span><span class="ident" id="5103343">p</span><span class="op" id="5103344">,</span>&nbsp;<span class="builtintype" id="5103346">true</span><span class="op" id="5103350">)</span><br>
<span class="lineno"></span><span class="op" id="5103352">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="5103355">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5103436">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5103457">func</span>&nbsp;<span class="ident" id="5103462">searchInts</span><span class="op" id="5103472">(</span><span class="ident" id="5103473">a</span>&nbsp;<span class="op" id="5103475">[</span><span class="op" id="5103476">]</span><span class="builtintype" id="5103477">int</span><span class="op" id="5103480">,</span>&nbsp;<span class="ident" id="5103482">x</span>&nbsp;<span class="builtintype" id="5103484">int</span><span class="op" id="5103487">)</span>&nbsp;<span class="builtintype" id="5103489">int</span>&nbsp;<span class="op" id="5103493">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103496">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103553">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103557">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103632">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103636">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103706">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103772">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103839">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5103898">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103956">i</span><span class="op" id="5103957">,</span>&nbsp;<span class="ident" id="5103959">j</span>&nbsp;<span class="op" id="5103961">:=</span>&nbsp;<span class="num" id="5103964">0</span><span class="op" id="5103965">,</span>&nbsp;<span class="builtinfunc" id="5103967">len</span><span class="op" id="5103970">(</span><span class="ident" id="5103971">a</span><span class="op" id="5103972">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5103975">for</span>&nbsp;<span class="ident" id="5103979">i</span>&nbsp;<span class="op" id="5103981">&lt;</span>&nbsp;<span class="ident" id="5103983">j</span>&nbsp;<span class="op" id="5103985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5103989">h</span>&nbsp;<span class="op" id="5103991">:=</span>&nbsp;<span class="ident" id="5103994">i</span>&nbsp;<span class="op" id="5103996">+</span>&nbsp;<span class="op" id="5103998">(</span><span class="ident" id="5103999">j</span><span class="op" id="5104000">-</span><span class="ident" id="5104001">i</span><span class="op" id="5104002">)</span><span class="op" id="5104003">/</span><span class="num" id="5104004">2</span>&nbsp;<span class="comment" id="5104006">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104043">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104060">if</span>&nbsp;<span class="ident" id="5104063">a</span><span class="op" id="5104064">[</span><span class="ident" id="5104065">h</span><span class="op" id="5104066">]</span>&nbsp;<span class="op" id="5104068">&lt;=</span>&nbsp;<span class="ident" id="5104071">x</span>&nbsp;<span class="op" id="5104073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104078">i</span>&nbsp;<span class="op" id="5104080">=</span>&nbsp;<span class="ident" id="5104082">h</span>&nbsp;<span class="op" id="5104084">+</span>&nbsp;<span class="num" id="5104086">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104090">}</span>&nbsp;<span class="keyword" id="5104092">else</span>&nbsp;<span class="op" id="5104097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104102">j</span>&nbsp;<span class="op" id="5104104">=</span>&nbsp;<span class="ident" id="5104106">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104116">return</span>&nbsp;<span class="ident" id="5104123">i</span>&nbsp;<span class="op" id="5104125">-</span>&nbsp;<span class="num" id="5104127">1</span><br>
<span class="lineno">485</span><span class="op" id="5104129">}</span>
</div>
</body>
</html>
