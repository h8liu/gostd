<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1381576">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1381631">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1381685">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1381736">package</span>&nbsp;<span class="ident" id="1381744">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1381752">import</span>&nbsp;<span class="op" id="1381759">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1381762">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1381771">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1381774">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1381850">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1381909">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1381962">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1382021">type</span>&nbsp;<span class="ident" id="1382026">Value</span>&nbsp;<span class="keyword" id="1382032">struct</span>&nbsp;<span class="op" id="1382039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382042">v</span>&nbsp;<span class="keyword" id="1382044">interface</span><span class="op" id="1382053">{</span><span class="op" id="1382054">}</span><br>
<span class="lineno"></span><span class="op" id="1382056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1382059">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1382113">type</span>&nbsp;<span class="ident" id="1382118">ifaceWords</span>&nbsp;<span class="keyword" id="1382129">struct</span>&nbsp;<span class="op" id="1382136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382139">typ</span>&nbsp;&nbsp;<span class="ident" id="1382144">unsafe</span><span class="op" id="1382150">.</span><span class="ident" id="1382151">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382160">data</span>&nbsp;<span class="ident" id="1382165">unsafe</span><span class="op" id="1382171">.</span><span class="ident" id="1382172">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1382180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1382183">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1382239">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1382308">func</span>&nbsp;<span class="op" id="1382313">(</span><span class="ident" id="1382314">v</span>&nbsp;<span class="op" id="1382316">*</span><span class="ident" id="1382317">Value</span><span class="op" id="1382322">)</span>&nbsp;<span class="ident" id="1382324">Load</span><span class="op" id="1382328">(</span><span class="op" id="1382329">)</span>&nbsp;<span class="op" id="1382331">(</span><span class="ident" id="1382332">x</span>&nbsp;<span class="keyword" id="1382334">interface</span><span class="op" id="1382343">{</span><span class="op" id="1382344">}</span><span class="op" id="1382345">)</span>&nbsp;<span class="op" id="1382347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382350">vp</span>&nbsp;<span class="op" id="1382353">:=</span>&nbsp;<span class="op" id="1382356">(</span><span class="op" id="1382357">*</span><span class="ident" id="1382358">ifaceWords</span><span class="op" id="1382368">)</span><span class="op" id="1382369">(</span><span class="ident" id="1382370">unsafe</span><span class="op" id="1382376">.</span><span class="ident" id="1382377">Pointer</span><span class="op" id="1382384">(</span><span class="ident" id="1382385">v</span><span class="op" id="1382386">)</span><span class="op" id="1382387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382390">typ</span>&nbsp;<span class="op" id="1382394">:=</span>&nbsp;<span class="ident" id="1382397">LoadPointer</span><span class="op" id="1382408">(</span><span class="op" id="1382409">&amp;</span><span class="ident" id="1382410">vp</span><span class="op" id="1382412">.</span><span class="ident" id="1382413">typ</span><span class="op" id="1382416">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382419">if</span>&nbsp;<span class="ident" id="1382422">typ</span>&nbsp;<span class="op" id="1382426">==</span>&nbsp;<span class="builtintype" id="1382429">nil</span>&nbsp;<span class="op" id="1382433">||</span>&nbsp;<span class="builtintype" id="1382436">uintptr</span><span class="op" id="1382443">(</span><span class="ident" id="1382444">typ</span><span class="op" id="1382447">)</span>&nbsp;<span class="op" id="1382449">==</span>&nbsp;<span class="op" id="1382452">^</span><span class="builtintype" id="1382453">uintptr</span><span class="op" id="1382460">(</span><span class="num" id="1382461">0</span><span class="op" id="1382462">)</span>&nbsp;<span class="op" id="1382464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1382468">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382504">return</span>&nbsp;<span class="builtintype" id="1382511">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1382516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382519">data</span>&nbsp;<span class="op" id="1382524">:=</span>&nbsp;<span class="ident" id="1382527">LoadPointer</span><span class="op" id="1382538">(</span><span class="op" id="1382539">&amp;</span><span class="ident" id="1382540">vp</span><span class="op" id="1382542">.</span><span class="ident" id="1382543">data</span><span class="op" id="1382547">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382550">xp</span>&nbsp;<span class="op" id="1382553">:=</span>&nbsp;<span class="op" id="1382556">(</span><span class="op" id="1382557">*</span><span class="ident" id="1382558">ifaceWords</span><span class="op" id="1382568">)</span><span class="op" id="1382569">(</span><span class="ident" id="1382570">unsafe</span><span class="op" id="1382576">.</span><span class="ident" id="1382577">Pointer</span><span class="op" id="1382584">(</span><span class="op" id="1382585">&amp;</span><span class="ident" id="1382586">x</span><span class="op" id="1382587">)</span><span class="op" id="1382588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382591">xp</span><span class="op" id="1382593">.</span><span class="ident" id="1382594">typ</span>&nbsp;<span class="op" id="1382598">=</span>&nbsp;<span class="ident" id="1382600">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382605">xp</span><span class="op" id="1382607">.</span><span class="ident" id="1382608">data</span>&nbsp;<span class="op" id="1382613">=</span>&nbsp;<span class="ident" id="1382615">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382621">return</span><br>
<span class="lineno"></span><span class="op" id="1382628">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1382631">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1382674">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1382757">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1382818">func</span>&nbsp;<span class="op" id="1382823">(</span><span class="ident" id="1382824">v</span>&nbsp;<span class="op" id="1382826">*</span><span class="ident" id="1382827">Value</span><span class="op" id="1382832">)</span>&nbsp;<span class="ident" id="1382834">Store</span><span class="op" id="1382839">(</span><span class="ident" id="1382840">x</span>&nbsp;<span class="keyword" id="1382842">interface</span><span class="op" id="1382851">{</span><span class="op" id="1382852">}</span><span class="op" id="1382853">)</span>&nbsp;<span class="op" id="1382855">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382858">if</span>&nbsp;<span class="ident" id="1382861">x</span>&nbsp;<span class="op" id="1382863">==</span>&nbsp;<span class="builtintype" id="1382866">nil</span>&nbsp;<span class="op" id="1382870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1382874">panic</span><span class="op" id="1382879">(</span><span class="string" id="1382880">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1382924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1382927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382930">vp</span>&nbsp;<span class="op" id="1382933">:=</span>&nbsp;<span class="op" id="1382936">(</span><span class="op" id="1382937">*</span><span class="ident" id="1382938">ifaceWords</span><span class="op" id="1382948">)</span><span class="op" id="1382949">(</span><span class="ident" id="1382950">unsafe</span><span class="op" id="1382956">.</span><span class="ident" id="1382957">Pointer</span><span class="op" id="1382964">(</span><span class="ident" id="1382965">v</span><span class="op" id="1382966">)</span><span class="op" id="1382967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382970">xp</span>&nbsp;<span class="op" id="1382973">:=</span>&nbsp;<span class="op" id="1382976">(</span><span class="op" id="1382977">*</span><span class="ident" id="1382978">ifaceWords</span><span class="op" id="1382988">)</span><span class="op" id="1382989">(</span><span class="ident" id="1382990">unsafe</span><span class="op" id="1382996">.</span><span class="ident" id="1382997">Pointer</span><span class="op" id="1383004">(</span><span class="op" id="1383005">&amp;</span><span class="ident" id="1383006">x</span><span class="op" id="1383007">)</span><span class="op" id="1383008">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383011">for</span>&nbsp;<span class="op" id="1383015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383019">typ</span>&nbsp;<span class="op" id="1383023">:=</span>&nbsp;<span class="ident" id="1383026">LoadPointer</span><span class="op" id="1383037">(</span><span class="op" id="1383038">&amp;</span><span class="ident" id="1383039">vp</span><span class="op" id="1383041">.</span><span class="ident" id="1383042">typ</span><span class="op" id="1383045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383049">if</span>&nbsp;<span class="ident" id="1383052">typ</span>&nbsp;<span class="op" id="1383056">==</span>&nbsp;<span class="builtintype" id="1383059">nil</span>&nbsp;<span class="op" id="1383063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383068">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383104">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383162">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383221">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383271">runtime_procPin</span><span class="op" id="1383286">(</span><span class="op" id="1383287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383292">if</span>&nbsp;<span class="op" id="1383295">!</span><span class="ident" id="1383296">CompareAndSwapPointer</span><span class="op" id="1383317">(</span><span class="op" id="1383318">&amp;</span><span class="ident" id="1383319">vp</span><span class="op" id="1383321">.</span><span class="ident" id="1383322">typ</span><span class="op" id="1383325">,</span>&nbsp;<span class="builtintype" id="1383327">nil</span><span class="op" id="1383330">,</span>&nbsp;<span class="ident" id="1383332">unsafe</span><span class="op" id="1383338">.</span><span class="ident" id="1383339">Pointer</span><span class="op" id="1383346">(</span><span class="op" id="1383347">^</span><span class="builtintype" id="1383348">uintptr</span><span class="op" id="1383355">(</span><span class="num" id="1383356">0</span><span class="op" id="1383357">)</span><span class="op" id="1383358">)</span><span class="op" id="1383359">)</span>&nbsp;<span class="op" id="1383361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383367">runtime_procUnpin</span><span class="op" id="1383384">(</span><span class="op" id="1383385">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383391">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383408">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383436">StorePointer</span><span class="op" id="1383448">(</span><span class="op" id="1383449">&amp;</span><span class="ident" id="1383450">vp</span><span class="op" id="1383452">.</span><span class="ident" id="1383453">data</span><span class="op" id="1383457">,</span>&nbsp;<span class="ident" id="1383459">xp</span><span class="op" id="1383461">.</span><span class="ident" id="1383462">data</span><span class="op" id="1383466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383471">StorePointer</span><span class="op" id="1383483">(</span><span class="op" id="1383484">&amp;</span><span class="ident" id="1383485">vp</span><span class="op" id="1383487">.</span><span class="ident" id="1383488">typ</span><span class="op" id="1383491">,</span>&nbsp;<span class="ident" id="1383493">xp</span><span class="op" id="1383495">.</span><span class="ident" id="1383496">typ</span><span class="op" id="1383499">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383504">runtime_procUnpin</span><span class="op" id="1383521">(</span><span class="op" id="1383522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383527">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383540">if</span>&nbsp;<span class="builtintype" id="1383543">uintptr</span><span class="op" id="1383550">(</span><span class="ident" id="1383551">typ</span><span class="op" id="1383554">)</span>&nbsp;<span class="op" id="1383556">==</span>&nbsp;<span class="op" id="1383559">^</span><span class="builtintype" id="1383560">uintptr</span><span class="op" id="1383567">(</span><span class="num" id="1383568">0</span><span class="op" id="1383569">)</span>&nbsp;<span class="op" id="1383571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383576">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383613">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383671">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383711">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1383726">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383785">if</span>&nbsp;<span class="ident" id="1383788">typ</span>&nbsp;<span class="op" id="1383792">!=</span>&nbsp;<span class="ident" id="1383795">xp</span><span class="op" id="1383797">.</span><span class="ident" id="1383798">typ</span>&nbsp;<span class="op" id="1383802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1383807">panic</span><span class="op" id="1383812">(</span><span class="string" id="1383813">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1383874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1383882">StorePointer</span><span class="op" id="1383894">(</span><span class="op" id="1383895">&amp;</span><span class="ident" id="1383896">vp</span><span class="op" id="1383898">.</span><span class="ident" id="1383899">data</span><span class="op" id="1383903">,</span>&nbsp;<span class="ident" id="1383905">xp</span><span class="op" id="1383907">.</span><span class="ident" id="1383908">data</span><span class="op" id="1383912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1383916">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1383924">}</span><br>
<span class="lineno"></span><span class="op" id="1383926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1383929">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1383983">func</span>&nbsp;<span class="ident" id="1383988">runtime_procPin</span><span class="op" id="1384003">(</span><span class="op" id="1384004">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1384006">func</span>&nbsp;<span class="ident" id="1384011">runtime_procUnpin</span><span class="op" id="1384028">(</span><span class="op" id="1384029">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
