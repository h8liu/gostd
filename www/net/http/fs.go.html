<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3765081">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3765136">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3765190">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3765241">//&nbsp;HTTP&nbsp;file&nbsp;system&nbsp;request&nbsp;handler</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3765278">package</span>&nbsp;<span class="ident" id="3765286">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3765292">import</span>&nbsp;<span class="op" id="3765299">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765302">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765312">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765319">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765325">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765333">&#34;mime/multipart&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765351">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765368">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765379">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765385">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765393">&#34;path/filepath&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765410">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765421">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3765432">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3765439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3765442">//&nbsp;A&nbsp;Dir&nbsp;implements&nbsp;FileSystem&nbsp;using&nbsp;the&nbsp;native&nbsp;file&nbsp;system&nbsp;restricted&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3765518">//&nbsp;specific&nbsp;directory&nbsp;tree.</span><br>
<span class="lineno"></span><span class="comment" id="3765546">//</span><br>
<span class="lineno"></span><span class="comment" id="3765549">//&nbsp;While&nbsp;the&nbsp;FileSystem.Open&nbsp;method&nbsp;takes&nbsp;&#39;/&#39;-separated&nbsp;paths,&nbsp;a&nbsp;Dir&#39;s&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="3765627">//&nbsp;value&nbsp;is&nbsp;a&nbsp;filename&nbsp;on&nbsp;the&nbsp;native&nbsp;file&nbsp;system,&nbsp;not&nbsp;a&nbsp;URL,&nbsp;so&nbsp;it&nbsp;is&nbsp;separated</span><br>
<span class="lineno">30</span><span class="comment" id="3765707">//&nbsp;by&nbsp;filepath.Separator,&nbsp;which&nbsp;isn&#39;t&nbsp;necessarily&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3765762">//</span><br>
<span class="lineno"></span><span class="comment" id="3765765">//&nbsp;An&nbsp;empty&nbsp;Dir&nbsp;is&nbsp;treated&nbsp;as&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3765800">type</span>&nbsp;<span class="ident" id="3765805">Dir</span>&nbsp;<span class="builtintype" id="3765809">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3765817">func</span>&nbsp;<span class="op" id="3765822">(</span><span class="ident" id="3765823">d</span>&nbsp;<span class="ident" id="3765825"><a href="/net/http/fs.go.html#3765805">Dir</a></span><span class="op" id="3765828">)</span>&nbsp;<span class="ident" id="3765830">Open</span><span class="op" id="3765834">(</span><span class="ident" id="3765835">name</span>&nbsp;<span class="builtintype" id="3765840">string</span><span class="op" id="3765846">)</span>&nbsp;<span class="op" id="3765848">(</span><span class="ident" id="3765849"><a href="/net/http/fs.go.html#3766677">File</a></span><span class="op" id="3765853">,</span>&nbsp;<span class="builtintype" id="3765855">error</span><span class="op" id="3765860">)</span>&nbsp;<span class="op" id="3765862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765865">if</span>&nbsp;<span class="ident" id="3765868"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3765876">.</span><span class="ident" id="3765877">Separator</span>&nbsp;<span class="op" id="3765887">!=</span>&nbsp;<span class="string" id="3765890">&#39;/&#39;</span>&nbsp;<span class="op" id="3765894">&amp;&amp;</span>&nbsp;<span class="ident" id="3765897"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3765904">.</span><span class="ident" id="3765905">IndexRune</span><span class="op" id="3765914">(</span><span class="ident" id="3765915"><a href="/net/http/fs.go.html#3765835">name</a></span><span class="op" id="3765919">,</span>&nbsp;<span class="ident" id="3765921"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3765929">.</span><span class="ident" id="3765930">Separator</span><span class="op" id="3765939">)</span>&nbsp;<span class="op" id="3765941">&gt;=</span>&nbsp;<span class="num" id="3765944">0</span>&nbsp;<span class="op" id="3765946">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765951"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3765958">.</span><span class="ident" id="3765959">Contains</span><span class="op" id="3765967">(</span><span class="ident" id="3765968"><a href="/net/http/fs.go.html#3765835">name</a></span><span class="op" id="3765972">,</span>&nbsp;<span class="string" id="3765974">&#34;\x00&#34;</span><span class="op" id="3765980">)</span>&nbsp;<span class="op" id="3765982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765986">return</span>&nbsp;<span class="ident" id="3765993">nil</span><span class="op" id="3765996">,</span>&nbsp;<span class="ident" id="3765998"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3766004">.</span><span class="ident" id="3766005">New</span><span class="op" id="3766008">(</span><span class="string" id="3766009">&#34;http:&nbsp;invalid&nbsp;character&nbsp;in&nbsp;file&nbsp;path&#34;</span><span class="op" id="3766047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766050">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766053">dir</span>&nbsp;<span class="op" id="3766057">:=</span>&nbsp;<span class="builtintype" id="3766060">string</span><span class="op" id="3766066">(</span><span class="ident" id="3766067"><a href="/net/http/fs.go.html#3765823">d</a></span><span class="op" id="3766068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766071">if</span>&nbsp;<span class="ident" id="3766074"><a href="/net/http/fs.go.html#3766053">dir</a></span>&nbsp;<span class="op" id="3766078">==</span>&nbsp;<span class="string" id="3766081">&#34;&#34;</span>&nbsp;<span class="op" id="3766084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766088"><a href="/net/http/fs.go.html#3766053">dir</a></span>&nbsp;<span class="op" id="3766092">=</span>&nbsp;<span class="string" id="3766094">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766102">f</span><span class="op" id="3766103">,</span>&nbsp;<span class="ident" id="3766105">err</span>&nbsp;<span class="op" id="3766109">:=</span>&nbsp;<span class="ident" id="3766112"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3766114">.</span><span class="ident" id="3766115">Open</span><span class="op" id="3766119">(</span><span class="ident" id="3766120"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3766128">.</span><span class="ident" id="3766129">Join</span><span class="op" id="3766133">(</span><span class="ident" id="3766134"><a href="/net/http/fs.go.html#3766053">dir</a></span><span class="op" id="3766137">,</span>&nbsp;<span class="ident" id="3766139"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3766147">.</span><span class="ident" id="3766148">FromSlash</span><span class="op" id="3766157">(</span><span class="ident" id="3766158"><a href="/net/http/fs.go.html#3765385">path</a></span><span class="op" id="3766162">.</span><span class="ident" id="3766163">Clean</span><span class="op" id="3766168">(</span><span class="string" id="3766169">&#34;/&#34;</span><span class="op" id="3766172">+</span><span class="ident" id="3766173"><a href="/net/http/fs.go.html#3765835">name</a></span><span class="op" id="3766177">)</span><span class="op" id="3766178">)</span><span class="op" id="3766179">)</span><span class="op" id="3766180">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766183">if</span>&nbsp;<span class="ident" id="3766186"><a href="/net/http/fs.go.html#3766105">err</a></span>&nbsp;<span class="op" id="3766190">!=</span>&nbsp;<span class="ident" id="3766193">nil</span>&nbsp;<span class="op" id="3766197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766201">return</span>&nbsp;<span class="ident" id="3766208">nil</span><span class="op" id="3766211">,</span>&nbsp;<span class="ident" id="3766213"><a href="/net/http/fs.go.html#3766105">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766221">return</span>&nbsp;<span class="ident" id="3766228"><a href="/net/http/fs.go.html#3766102">f</a></span><span class="op" id="3766229">,</span>&nbsp;<span class="ident" id="3766231">nil</span><br>
<span class="lineno"></span><span class="op" id="3766235">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3766238">//&nbsp;A&nbsp;FileSystem&nbsp;implements&nbsp;access&nbsp;to&nbsp;a&nbsp;collection&nbsp;of&nbsp;named&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3766304">//&nbsp;The&nbsp;elements&nbsp;in&nbsp;a&nbsp;file&nbsp;path&nbsp;are&nbsp;separated&nbsp;by&nbsp;slash&nbsp;(&#39;/&#39;,&nbsp;U+002F)</span><br>
<span class="lineno"></span><span class="comment" id="3766372">//&nbsp;characters,&nbsp;regardless&nbsp;of&nbsp;host&nbsp;operating&nbsp;system&nbsp;convention.</span><br>
<span class="lineno"></span><span class="keyword" id="3766435">type</span>&nbsp;<span class="ident" id="3766440">FileSystem</span>&nbsp;<span class="keyword" id="3766451">interface</span>&nbsp;<span class="op" id="3766461">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766464">Open</span><span class="op" id="3766468">(</span><span class="ident" id="3766469">name</span>&nbsp;<span class="builtintype" id="3766474">string</span><span class="op" id="3766480">)</span>&nbsp;<span class="op" id="3766482">(</span><span class="ident" id="3766483"><a href="/net/http/fs.go.html#3766677">File</a></span><span class="op" id="3766487">,</span>&nbsp;<span class="builtintype" id="3766489">error</span><span class="op" id="3766494">)</span><br>
<span class="lineno"></span><span class="op" id="3766496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766499">//&nbsp;A&nbsp;File&nbsp;is&nbsp;returned&nbsp;by&nbsp;a&nbsp;FileSystem&#39;s&nbsp;Open&nbsp;method&nbsp;and&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3766562">//&nbsp;served&nbsp;by&nbsp;the&nbsp;FileServer&nbsp;implementation.</span><br>
<span class="lineno">60</span><span class="comment" id="3766606">//</span><br>
<span class="lineno"></span><span class="comment" id="3766609">//&nbsp;The&nbsp;methods&nbsp;should&nbsp;behave&nbsp;the&nbsp;same&nbsp;as&nbsp;those&nbsp;on&nbsp;an&nbsp;*os.File.</span><br>
<span class="lineno"></span><span class="keyword" id="3766672">type</span>&nbsp;<span class="ident" id="3766677">File</span>&nbsp;<span class="keyword" id="3766682">interface</span>&nbsp;<span class="op" id="3766692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766695"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3766697">.</span><span class="ident" id="3766698">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766706"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3766708">.</span><span class="ident" id="3766709">Reader</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766717">Readdir</span><span class="op" id="3766724">(</span><span class="ident" id="3766725">count</span>&nbsp;<span class="builtintype" id="3766731">int</span><span class="op" id="3766734">)</span>&nbsp;<span class="op" id="3766736">(</span><span class="op" id="3766737">[</span><span class="op" id="3766738">]</span><span class="ident" id="3766739"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3766741">.</span><span class="ident" id="3766742">FileInfo</span><span class="op" id="3766750">,</span>&nbsp;<span class="builtintype" id="3766752">error</span><span class="op" id="3766757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766760">Seek</span><span class="op" id="3766764">(</span><span class="ident" id="3766765">offset</span>&nbsp;<span class="ident" id="3766772">int64</span><span class="op" id="3766777">,</span>&nbsp;<span class="ident" id="3766779">whence</span>&nbsp;<span class="builtintype" id="3766786">int</span><span class="op" id="3766789">)</span>&nbsp;<span class="op" id="3766791">(</span><span class="ident" id="3766792">int64</span><span class="op" id="3766797">,</span>&nbsp;<span class="builtintype" id="3766799">error</span><span class="op" id="3766804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766807">Stat</span><span class="op" id="3766811">(</span><span class="op" id="3766812">)</span>&nbsp;<span class="op" id="3766814">(</span><span class="ident" id="3766815"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3766817">.</span><span class="ident" id="3766818">FileInfo</span><span class="op" id="3766826">,</span>&nbsp;<span class="builtintype" id="3766828">error</span><span class="op" id="3766833">)</span><br>
<span class="lineno"></span><span class="op" id="3766835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3766838">func</span>&nbsp;<span class="ident" id="3766843">dirList</span><span class="op" id="3766850">(</span><span class="ident" id="3766851">w</span>&nbsp;<span class="ident" id="3766853"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3766867">,</span>&nbsp;<span class="ident" id="3766869">f</span>&nbsp;<span class="ident" id="3766871"><a href="/net/http/fs.go.html#3766677">File</a></span><span class="op" id="3766875">)</span>&nbsp;<span class="op" id="3766877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766880"><a href="/net/http/fs.go.html#3766851">w</a></span><span class="op" id="3766881">.</span><span class="ident" id="3766882">Header</span><span class="op" id="3766888">(</span><span class="op" id="3766889">)</span><span class="op" id="3766890">.</span><span class="ident" id="3766891">Set</span><span class="op" id="3766894">(</span><span class="string" id="3766895">&#34;Content-Type&#34;</span><span class="op" id="3766909">,</span>&nbsp;<span class="string" id="3766911">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3766937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766940"><a href="/net/http/fs.go.html#3765312">fmt</a></span><span class="op" id="3766943">.</span><span class="ident" id="3766944">Fprintf</span><span class="op" id="3766951">(</span><span class="ident" id="3766952"><a href="/net/http/fs.go.html#3766851">w</a></span><span class="op" id="3766953">,</span>&nbsp;<span class="string" id="3766955">&#34;&lt;pre&gt;\n&#34;</span><span class="op" id="3766964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766967">for</span>&nbsp;<span class="op" id="3766971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766975">dirs</span><span class="op" id="3766979">,</span>&nbsp;<span class="ident" id="3766981">err</span>&nbsp;<span class="op" id="3766985">:=</span>&nbsp;<span class="ident" id="3766988"><a href="/net/http/fs.go.html#3766869">f</a></span><span class="op" id="3766989">.</span><span class="ident" id="3766990">Readdir</span><span class="op" id="3766997">(</span><span class="num" id="3766998">100</span><span class="op" id="3767001">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767005">if</span>&nbsp;<span class="ident" id="3767008"><a href="/net/http/fs.go.html#3766981">err</a></span>&nbsp;<span class="op" id="3767012">!=</span>&nbsp;<span class="ident" id="3767015">nil</span>&nbsp;<span class="op" id="3767019">||</span>&nbsp;<span class="builtinfunc" id="3767022">len</span><span class="op" id="3767025">(</span><span class="ident" id="3767026"><a href="/net/http/fs.go.html#3766975">dirs</a></span><span class="op" id="3767030">)</span>&nbsp;<span class="op" id="3767032">==</span>&nbsp;<span class="num" id="3767035">0</span>&nbsp;<span class="op" id="3767037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767042">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767054">for</span>&nbsp;<span class="ident" id="3767058">_</span><span class="op" id="3767059">,</span>&nbsp;<span class="ident" id="3767061">d</span>&nbsp;<span class="op" id="3767063">:=</span>&nbsp;<span class="keyword" id="3767066">range</span>&nbsp;<span class="ident" id="3767072"><a href="/net/http/fs.go.html#3766975">dirs</a></span>&nbsp;<span class="op" id="3767077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767082">name</span>&nbsp;<span class="op" id="3767087">:=</span>&nbsp;<span class="ident" id="3767090"><a href="/net/http/fs.go.html#3767061">d</a></span><span class="op" id="3767091">.</span><span class="ident" id="3767092">Name</span><span class="op" id="3767096">(</span><span class="op" id="3767097">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767102">if</span>&nbsp;<span class="ident" id="3767105"><a href="/net/http/fs.go.html#3767061">d</a></span><span class="op" id="3767106">.</span><span class="ident" id="3767107">IsDir</span><span class="op" id="3767112">(</span><span class="op" id="3767113">)</span>&nbsp;<span class="op" id="3767115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767121"><a href="/net/http/fs.go.html#3767082">name</a></span>&nbsp;<span class="op" id="3767126">+=</span>&nbsp;<span class="string" id="3767129">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767141">//&nbsp;name&nbsp;may&nbsp;contain&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;which&nbsp;must&nbsp;be&nbsp;escaped&nbsp;to&nbsp;remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767208">//&nbsp;part&nbsp;of&nbsp;the&nbsp;URL&nbsp;path,&nbsp;and&nbsp;not&nbsp;indicate&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;query</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767274">//&nbsp;string&nbsp;or&nbsp;fragment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767300">url</span>&nbsp;<span class="op" id="3767304">:=</span>&nbsp;<span class="ident" id="3767307"><a href="/net/http/fs.go.html#3765368">url</a></span><span class="op" id="3767310">.</span><span class="ident" id="3767311">URL</span><span class="op" id="3767314">{</span><span class="ident" id="3767315">Path</span><span class="op" id="3767319">:</span>&nbsp;<span class="ident" id="3767321"><a href="/net/http/fs.go.html#3767082">name</a></span><span class="op" id="3767325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767330"><a href="/net/http/fs.go.html#3765312">fmt</a></span><span class="op" id="3767333">.</span><span class="ident" id="3767334">Fprintf</span><span class="op" id="3767341">(</span><span class="ident" id="3767342"><a href="/net/http/fs.go.html#3766851">w</a></span><span class="op" id="3767343">,</span>&nbsp;<span class="string" id="3767345">&#34;&lt;a&nbsp;href=\&#34;%s\&#34;&gt;%s&lt;/a&gt;\n&#34;</span><span class="op" id="3767370">,</span>&nbsp;<span class="ident" id="3767372"><a href="/net/http/fs.go.html#3767300">url</a></span><span class="op" id="3767375">.</span><span class="ident" id="3767376">String</span><span class="op" id="3767382">(</span><span class="op" id="3767383">)</span><span class="op" id="3767384">,</span>&nbsp;<span class="ident" id="3767386"><a href="/net/http/server.go.html#3864391">htmlReplacer</a></span><span class="op" id="3767398">.</span><span class="ident" id="3767399">Replace</span><span class="op" id="3767406">(</span><span class="ident" id="3767407"><a href="/net/http/fs.go.html#3767082">name</a></span><span class="op" id="3767411">)</span><span class="op" id="3767412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767419">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767422"><a href="/net/http/fs.go.html#3765312">fmt</a></span><span class="op" id="3767425">.</span><span class="ident" id="3767426">Fprintf</span><span class="op" id="3767433">(</span><span class="ident" id="3767434"><a href="/net/http/fs.go.html#3766851">w</a></span><span class="op" id="3767435">,</span>&nbsp;<span class="string" id="3767437">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="3767447">)</span><br>
<span class="lineno"></span><span class="op" id="3767449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3767452">//&nbsp;ServeContent&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;using&nbsp;the&nbsp;content&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3767516">//&nbsp;provided&nbsp;ReadSeeker.&nbsp;&nbsp;The&nbsp;main&nbsp;benefit&nbsp;of&nbsp;ServeContent&nbsp;over&nbsp;io.Copy</span><br>
<span class="lineno">95</span><span class="comment" id="3767587">//&nbsp;is&nbsp;that&nbsp;it&nbsp;handles&nbsp;Range&nbsp;requests&nbsp;properly,&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3767658">//&nbsp;handles&nbsp;If-Modified-Since&nbsp;requests.</span><br>
<span class="lineno"></span><span class="comment" id="3767697">//</span><br>
<span class="lineno"></span><span class="comment" id="3767700">//&nbsp;If&nbsp;the&nbsp;response&#39;s&nbsp;Content-Type&nbsp;header&nbsp;is&nbsp;not&nbsp;set,&nbsp;ServeContent</span><br>
<span class="lineno"></span><span class="comment" id="3767766">//&nbsp;first&nbsp;tries&nbsp;to&nbsp;deduce&nbsp;the&nbsp;type&nbsp;from&nbsp;name&#39;s&nbsp;file&nbsp;extension&nbsp;and,</span><br>
<span class="lineno">100</span><span class="comment" id="3767832">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;falls&nbsp;back&nbsp;to&nbsp;reading&nbsp;the&nbsp;first&nbsp;block&nbsp;of&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="3767903">//&nbsp;and&nbsp;passing&nbsp;it&nbsp;to&nbsp;DetectContentType.</span><br>
<span class="lineno"></span><span class="comment" id="3767943">//&nbsp;The&nbsp;name&nbsp;is&nbsp;otherwise&nbsp;unused;&nbsp;in&nbsp;particular&nbsp;it&nbsp;can&nbsp;be&nbsp;empty&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3768013">//&nbsp;never&nbsp;sent&nbsp;in&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="3768044">//</span><br>
<span class="lineno">105</span><span class="comment" id="3768047">//&nbsp;If&nbsp;modtime&nbsp;is&nbsp;not&nbsp;the&nbsp;zero&nbsp;time,&nbsp;ServeContent&nbsp;includes&nbsp;it&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3768113">//&nbsp;Last-Modified&nbsp;header&nbsp;in&nbsp;the&nbsp;response.&nbsp;&nbsp;If&nbsp;the&nbsp;request&nbsp;includes&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3768182">//&nbsp;If-Modified-Since&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;modtime&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span><span class="comment" id="3768247">//&nbsp;whether&nbsp;the&nbsp;content&nbsp;needs&nbsp;to&nbsp;be&nbsp;sent&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span><span class="comment" id="3768295">//</span><br>
<span class="lineno">110</span><span class="comment" id="3768298">//&nbsp;The&nbsp;content&#39;s&nbsp;Seek&nbsp;method&nbsp;must&nbsp;work:&nbsp;ServeContent&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="3768356">//&nbsp;a&nbsp;seek&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;content&nbsp;to&nbsp;determine&nbsp;its&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="3768415">//</span><br>
<span class="lineno"></span><span class="comment" id="3768418">//&nbsp;If&nbsp;the&nbsp;caller&nbsp;has&nbsp;set&nbsp;w&#39;s&nbsp;ETag&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3768484">//&nbsp;handle&nbsp;requests&nbsp;using&nbsp;If-Range&nbsp;and&nbsp;If-None-Match.</span><br>
<span class="lineno">115</span><span class="comment" id="3768537">//</span><br>
<span class="lineno"></span><span class="comment" id="3768540">//&nbsp;Note&nbsp;that&nbsp;*os.File&nbsp;implements&nbsp;the&nbsp;io.ReadSeeker&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3768602">func</span>&nbsp;<span class="ident" id="3768607">ServeContent</span><span class="op" id="3768619">(</span><span class="ident" id="3768620">w</span>&nbsp;<span class="ident" id="3768622"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3768636">,</span>&nbsp;<span class="ident" id="3768638">req</span>&nbsp;<span class="op" id="3768642">*</span><span class="ident" id="3768643"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3768650">,</span>&nbsp;<span class="ident" id="3768652">name</span>&nbsp;<span class="builtintype" id="3768657">string</span><span class="op" id="3768663">,</span>&nbsp;<span class="ident" id="3768665">modtime</span>&nbsp;<span class="ident" id="3768673"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3768677">.</span><span class="ident" id="3768678">Time</span><span class="op" id="3768682">,</span>&nbsp;<span class="ident" id="3768684">content</span>&nbsp;<span class="ident" id="3768692"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3768694">.</span><span class="ident" id="3768695">ReadSeeker</span><span class="op" id="3768705">)</span>&nbsp;<span class="op" id="3768707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768710">sizeFunc</span>&nbsp;<span class="op" id="3768719">:=</span>&nbsp;<span class="keyword" id="3768722">func</span><span class="op" id="3768726">(</span><span class="op" id="3768727">)</span>&nbsp;<span class="op" id="3768729">(</span><span class="ident" id="3768730">int64</span><span class="op" id="3768735">,</span>&nbsp;<span class="builtintype" id="3768737">error</span><span class="op" id="3768742">)</span>&nbsp;<span class="op" id="3768744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768748">size</span><span class="op" id="3768752">,</span>&nbsp;<span class="ident" id="3768754">err</span>&nbsp;<span class="op" id="3768758">:=</span>&nbsp;<span class="ident" id="3768761"><a href="/net/http/fs.go.html#3768684">content</a></span><span class="op" id="3768768">.</span><span class="ident" id="3768769">Seek</span><span class="op" id="3768773">(</span><span class="num" id="3768774">0</span><span class="op" id="3768775">,</span>&nbsp;<span class="ident" id="3768777"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3768779">.</span><span class="ident" id="3768780">SEEK_END</span><span class="op" id="3768788">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768792">if</span>&nbsp;<span class="ident" id="3768795"><a href="/net/http/fs.go.html#3768754">err</a></span>&nbsp;<span class="op" id="3768799">!=</span>&nbsp;<span class="ident" id="3768802">nil</span>&nbsp;<span class="op" id="3768806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768811">return</span>&nbsp;<span class="num" id="3768818">0</span><span class="op" id="3768819">,</span>&nbsp;<span class="ident" id="3768821"><a href="/net/http/fs.go.html#3769219">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768837">_</span><span class="op" id="3768838">,</span>&nbsp;<span class="ident" id="3768840"><a href="/net/http/fs.go.html#3768754">err</a></span>&nbsp;<span class="op" id="3768844">=</span>&nbsp;<span class="ident" id="3768846"><a href="/net/http/fs.go.html#3768684">content</a></span><span class="op" id="3768853">.</span><span class="ident" id="3768854">Seek</span><span class="op" id="3768858">(</span><span class="num" id="3768859">0</span><span class="op" id="3768860">,</span>&nbsp;<span class="ident" id="3768862"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3768864">.</span><span class="ident" id="3768865">SEEK_SET</span><span class="op" id="3768873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768877">if</span>&nbsp;<span class="ident" id="3768880"><a href="/net/http/fs.go.html#3768754">err</a></span>&nbsp;<span class="op" id="3768884">!=</span>&nbsp;<span class="ident" id="3768887">nil</span>&nbsp;<span class="op" id="3768891">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768896">return</span>&nbsp;<span class="num" id="3768903">0</span><span class="op" id="3768904">,</span>&nbsp;<span class="ident" id="3768906"><a href="/net/http/fs.go.html#3769219">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768922">return</span>&nbsp;<span class="ident" id="3768929"><a href="/net/http/fs.go.html#3768748">size</a></span><span class="op" id="3768933">,</span>&nbsp;<span class="ident" id="3768935">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768943"><a href="/net/http/fs.go.html#3769538">serveContent</a></span><span class="op" id="3768955">(</span><span class="ident" id="3768956"><a href="/net/http/fs.go.html#3768620">w</a></span><span class="op" id="3768957">,</span>&nbsp;<span class="ident" id="3768959"><a href="/net/http/fs.go.html#3768638">req</a></span><span class="op" id="3768962">,</span>&nbsp;<span class="ident" id="3768964"><a href="/net/http/fs.go.html#3768652">name</a></span><span class="op" id="3768968">,</span>&nbsp;<span class="ident" id="3768970"><a href="/net/http/fs.go.html#3768665">modtime</a></span><span class="op" id="3768977">,</span>&nbsp;<span class="ident" id="3768979"><a href="/net/http/fs.go.html#3768710">sizeFunc</a></span><span class="op" id="3768987">,</span>&nbsp;<span class="ident" id="3768989"><a href="/net/http/fs.go.html#3768684">content</a></span><span class="op" id="3768996">)</span><br>
<span class="lineno">130</span><span class="op" id="3768998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769001">//&nbsp;errSeeker&nbsp;is&nbsp;returned&nbsp;by&nbsp;ServeContent&#39;s&nbsp;sizeFunc&nbsp;when&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="3769070">//&nbsp;doesn&#39;t&nbsp;seek&nbsp;properly.&nbsp;The&nbsp;underlying&nbsp;Seeker&#39;s&nbsp;error&nbsp;text&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3769137">//&nbsp;included&nbsp;in&nbsp;the&nbsp;sizeFunc&nbsp;reply&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;sent&nbsp;over&nbsp;HTTP&nbsp;to&nbsp;end</span><br>
<span class="lineno">135</span><span class="comment" id="3769205">//&nbsp;users.</span><br>
<span class="lineno"></span><span class="keyword" id="3769215">var</span>&nbsp;<span class="ident" id="3769219">errSeeker</span>&nbsp;<span class="op" id="3769229">=</span>&nbsp;<span class="ident" id="3769231"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3769237">.</span><span class="ident" id="3769238">New</span><span class="op" id="3769241">(</span><span class="string" id="3769242">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="3769261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769264">//&nbsp;if&nbsp;name&nbsp;is&nbsp;empty,&nbsp;filename&nbsp;is&nbsp;unknown.&nbsp;(used&nbsp;for&nbsp;mime&nbsp;type,&nbsp;before&nbsp;sniffing)</span><br>
<span class="lineno"></span><span class="comment" id="3769344">//&nbsp;if&nbsp;modtime.IsZero(),&nbsp;modtime&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno">140</span><span class="comment" id="3769388">//&nbsp;content&nbsp;must&nbsp;be&nbsp;seeked&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3769444">//&nbsp;The&nbsp;sizeFunc&nbsp;is&nbsp;called&nbsp;at&nbsp;most&nbsp;once.&nbsp;Its&nbsp;error,&nbsp;if&nbsp;any,&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;HTTP&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="3769533">func</span>&nbsp;<span class="ident" id="3769538">serveContent</span><span class="op" id="3769550">(</span><span class="ident" id="3769551">w</span>&nbsp;<span class="ident" id="3769553"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3769567">,</span>&nbsp;<span class="ident" id="3769569">r</span>&nbsp;<span class="op" id="3769571">*</span><span class="ident" id="3769572"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3769579">,</span>&nbsp;<span class="ident" id="3769581">name</span>&nbsp;<span class="builtintype" id="3769586">string</span><span class="op" id="3769592">,</span>&nbsp;<span class="ident" id="3769594">modtime</span>&nbsp;<span class="ident" id="3769602"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3769606">.</span><span class="ident" id="3769607">Time</span><span class="op" id="3769611">,</span>&nbsp;<span class="ident" id="3769613">sizeFunc</span>&nbsp;<span class="keyword" id="3769622">func</span><span class="op" id="3769626">(</span><span class="op" id="3769627">)</span>&nbsp;<span class="op" id="3769629">(</span><span class="ident" id="3769630">int64</span><span class="op" id="3769635">,</span>&nbsp;<span class="builtintype" id="3769637">error</span><span class="op" id="3769642">)</span><span class="op" id="3769643">,</span>&nbsp;<span class="ident" id="3769645">content</span>&nbsp;<span class="ident" id="3769653"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3769655">.</span><span class="ident" id="3769656">ReadSeeker</span><span class="op" id="3769666">)</span>&nbsp;<span class="op" id="3769668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769671">if</span>&nbsp;<span class="ident" id="3769674"><a href="/net/http/fs.go.html#3773168">checkLastModified</a></span><span class="op" id="3769691">(</span><span class="ident" id="3769692"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3769693">,</span>&nbsp;<span class="ident" id="3769695"><a href="/net/http/fs.go.html#3769569">r</a></span><span class="op" id="3769696">,</span>&nbsp;<span class="ident" id="3769698"><a href="/net/http/fs.go.html#3769594">modtime</a></span><span class="op" id="3769705">)</span>&nbsp;<span class="op" id="3769707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769711">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769722">rangeReq</span><span class="op" id="3769730">,</span>&nbsp;<span class="ident" id="3769732">done</span>&nbsp;<span class="op" id="3769737">:=</span>&nbsp;<span class="ident" id="3769740"><a href="/net/http/fs.go.html#3774130">checkETag</a></span><span class="op" id="3769749">(</span><span class="ident" id="3769750"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3769751">,</span>&nbsp;<span class="ident" id="3769753"><a href="/net/http/fs.go.html#3769569">r</a></span><span class="op" id="3769754">,</span>&nbsp;<span class="ident" id="3769756"><a href="/net/http/fs.go.html#3769594">modtime</a></span><span class="op" id="3769763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769766">if</span>&nbsp;<span class="ident" id="3769769"><a href="/net/http/fs.go.html#3769732">done</a></span>&nbsp;<span class="op" id="3769774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769778">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769786">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769790">code</span>&nbsp;<span class="op" id="3769795">:=</span>&nbsp;<span class="ident" id="3769798"><a href="/net/http/status.go.html#3891674">StatusOK</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769809">//&nbsp;If&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;set,&nbsp;use&nbsp;the&nbsp;file&#39;s&nbsp;extension&nbsp;to&nbsp;find&nbsp;it,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769881">//&nbsp;if&nbsp;the&nbsp;Content-Type&nbsp;is&nbsp;unset&nbsp;explicitly,&nbsp;do&nbsp;not&nbsp;sniff&nbsp;the&nbsp;type.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769949">ctypes</span><span class="op" id="3769955">,</span>&nbsp;<span class="ident" id="3769957">haveType</span>&nbsp;<span class="op" id="3769966">:=</span>&nbsp;<span class="ident" id="3769969"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3769970">.</span><span class="ident" id="3769971">Header</span><span class="op" id="3769977">(</span><span class="op" id="3769978">)</span><span class="op" id="3769979">[</span><span class="string" id="3769980">&#34;Content-Type&#34;</span><span class="op" id="3769994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769997">var</span>&nbsp;<span class="ident" id="3770001">ctype</span>&nbsp;<span class="builtintype" id="3770007">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770015">if</span>&nbsp;<span class="op" id="3770018">!</span><span class="ident" id="3770019"><a href="/net/http/fs.go.html#3769957">haveType</a></span>&nbsp;<span class="op" id="3770028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770032"><a href="/net/http/fs.go.html#3770001">ctype</a></span>&nbsp;<span class="op" id="3770038">=</span>&nbsp;<span class="ident" id="3770040"><a href="/net/http/fs.go.html#3765325">mime</a></span><span class="op" id="3770044">.</span><span class="ident" id="3770045">TypeByExtension</span><span class="op" id="3770060">(</span><span class="ident" id="3770061"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3770069">.</span><span class="ident" id="3770070">Ext</span><span class="op" id="3770073">(</span><span class="ident" id="3770074"><a href="/net/http/fs.go.html#3769581">name</a></span><span class="op" id="3770078">)</span><span class="op" id="3770079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770083">if</span>&nbsp;<span class="ident" id="3770086"><a href="/net/http/fs.go.html#3770001">ctype</a></span>&nbsp;<span class="op" id="3770092">==</span>&nbsp;<span class="string" id="3770095">&#34;&#34;</span>&nbsp;<span class="op" id="3770098">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770103">//&nbsp;read&nbsp;a&nbsp;chunk&nbsp;to&nbsp;decide&nbsp;between&nbsp;utf-8&nbsp;text&nbsp;and&nbsp;binary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770162">var</span>&nbsp;<span class="ident" id="3770166">buf</span>&nbsp;<span class="op" id="3770170">[</span><span class="ident" id="3770171"><a href="/net/http/sniff.go.html#3886376">sniffLen</a></span><span class="op" id="3770179">]</span><span class="builtintype" id="3770180">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770188">n</span><span class="op" id="3770189">,</span>&nbsp;<span class="ident" id="3770191">_</span>&nbsp;<span class="op" id="3770193">:=</span>&nbsp;<span class="ident" id="3770196"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3770198">.</span><span class="ident" id="3770199">ReadFull</span><span class="op" id="3770207">(</span><span class="ident" id="3770208"><a href="/net/http/fs.go.html#3769645">content</a></span><span class="op" id="3770215">,</span>&nbsp;<span class="ident" id="3770217"><a href="/net/http/fs.go.html#3770166">buf</a></span><span class="op" id="3770220">[</span><span class="op" id="3770221">:</span><span class="op" id="3770222">]</span><span class="op" id="3770223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770228"><a href="/net/http/fs.go.html#3770001">ctype</a></span>&nbsp;<span class="op" id="3770234">=</span>&nbsp;<span class="ident" id="3770236"><a href="/net/http/sniff.go.html#3886741">DetectContentType</a></span><span class="op" id="3770253">(</span><span class="ident" id="3770254"><a href="/net/http/fs.go.html#3770166">buf</a></span><span class="op" id="3770257">[</span><span class="op" id="3770258">:</span><span class="ident" id="3770259"><a href="/net/http/fs.go.html#3770188">n</a></span><span class="op" id="3770260">]</span><span class="op" id="3770261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770266">_</span><span class="op" id="3770267">,</span>&nbsp;<span class="ident" id="3770269">err</span>&nbsp;<span class="op" id="3770273">:=</span>&nbsp;<span class="ident" id="3770276"><a href="/net/http/fs.go.html#3769645">content</a></span><span class="op" id="3770283">.</span><span class="ident" id="3770284">Seek</span><span class="op" id="3770288">(</span><span class="num" id="3770289">0</span><span class="op" id="3770290">,</span>&nbsp;<span class="ident" id="3770292"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3770294">.</span><span class="ident" id="3770295">SEEK_SET</span><span class="op" id="3770303">)</span>&nbsp;<span class="comment" id="3770305">//&nbsp;rewind&nbsp;to&nbsp;output&nbsp;whole&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770339">if</span>&nbsp;<span class="ident" id="3770342"><a href="/net/http/fs.go.html#3770269">err</a></span>&nbsp;<span class="op" id="3770346">!=</span>&nbsp;<span class="ident" id="3770349">nil</span>&nbsp;<span class="op" id="3770353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770359"><a href="/net/http/server.go.html#3861382">Error</a></span><span class="op" id="3770364">(</span><span class="ident" id="3770365"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3770366">,</span>&nbsp;<span class="string" id="3770368">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="3770387">,</span>&nbsp;<span class="ident" id="3770389"><a href="/net/http/status.go.html#3892930">StatusInternalServerError</a></span><span class="op" id="3770414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770420">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770434">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770438"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3770439">.</span><span class="ident" id="3770440">Header</span><span class="op" id="3770446">(</span><span class="op" id="3770447">)</span><span class="op" id="3770448">.</span><span class="ident" id="3770449">Set</span><span class="op" id="3770452">(</span><span class="string" id="3770453">&#34;Content-Type&#34;</span><span class="op" id="3770467">,</span>&nbsp;<span class="ident" id="3770469"><a href="/net/http/fs.go.html#3770001">ctype</a></span><span class="op" id="3770474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770477">}</span>&nbsp;<span class="keyword" id="3770479">else</span>&nbsp;<span class="keyword" id="3770484">if</span>&nbsp;<span class="builtinfunc" id="3770487">len</span><span class="op" id="3770490">(</span><span class="ident" id="3770491"><a href="/net/http/fs.go.html#3769949">ctypes</a></span><span class="op" id="3770497">)</span>&nbsp;<span class="op" id="3770499">&gt;</span>&nbsp;<span class="num" id="3770501">0</span>&nbsp;<span class="op" id="3770503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770507"><a href="/net/http/fs.go.html#3770001">ctype</a></span>&nbsp;<span class="op" id="3770513">=</span>&nbsp;<span class="ident" id="3770515"><a href="/net/http/fs.go.html#3769949">ctypes</a></span><span class="op" id="3770521">[</span><span class="num" id="3770522">0</span><span class="op" id="3770523">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770530">size</span><span class="op" id="3770534">,</span>&nbsp;<span class="ident" id="3770536">err</span>&nbsp;<span class="op" id="3770540">:=</span>&nbsp;<span class="ident" id="3770543"><a href="/net/http/fs.go.html#3769613">sizeFunc</a></span><span class="op" id="3770551">(</span><span class="op" id="3770552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770555">if</span>&nbsp;<span class="ident" id="3770558"><a href="/net/http/fs.go.html#3770536">err</a></span>&nbsp;<span class="op" id="3770562">!=</span>&nbsp;<span class="ident" id="3770565">nil</span>&nbsp;<span class="op" id="3770569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770573"><a href="/net/http/server.go.html#3861382">Error</a></span><span class="op" id="3770578">(</span><span class="ident" id="3770579"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3770580">,</span>&nbsp;<span class="ident" id="3770582"><a href="/net/http/fs.go.html#3770536">err</a></span><span class="op" id="3770585">.</span><span class="ident" id="3770586">Error</span><span class="op" id="3770591">(</span><span class="op" id="3770592">)</span><span class="op" id="3770593">,</span>&nbsp;<span class="ident" id="3770595"><a href="/net/http/status.go.html#3892930">StatusInternalServerError</a></span><span class="op" id="3770620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770624">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770632">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770636">//&nbsp;handle&nbsp;Content-Range&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770669">sendSize</span>&nbsp;<span class="op" id="3770678">:=</span>&nbsp;<span class="ident" id="3770681"><a href="/net/http/fs.go.html#3770530">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770687">var</span>&nbsp;<span class="ident" id="3770691">sendContent</span>&nbsp;<span class="ident" id="3770703"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3770705">.</span><span class="ident" id="3770706">Reader</span>&nbsp;<span class="op" id="3770713">=</span>&nbsp;<span class="ident" id="3770715"><a href="/net/http/fs.go.html#3769645">content</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770724">if</span>&nbsp;<span class="ident" id="3770727"><a href="/net/http/fs.go.html#3770530">size</a></span>&nbsp;<span class="op" id="3770732">&gt;=</span>&nbsp;<span class="num" id="3770735">0</span>&nbsp;<span class="op" id="3770737">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770741">ranges</span><span class="op" id="3770747">,</span>&nbsp;<span class="ident" id="3770749">err</span>&nbsp;<span class="op" id="3770753">:=</span>&nbsp;<span class="ident" id="3770756"><a href="/net/http/fs.go.html#3779087">parseRange</a></span><span class="op" id="3770766">(</span><span class="ident" id="3770767"><a href="/net/http/fs.go.html#3769722">rangeReq</a></span><span class="op" id="3770775">,</span>&nbsp;<span class="ident" id="3770777"><a href="/net/http/fs.go.html#3770530">size</a></span><span class="op" id="3770781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770785">if</span>&nbsp;<span class="ident" id="3770788"><a href="/net/http/fs.go.html#3770749">err</a></span>&nbsp;<span class="op" id="3770792">!=</span>&nbsp;<span class="ident" id="3770795">nil</span>&nbsp;<span class="op" id="3770799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770804"><a href="/net/http/server.go.html#3861382">Error</a></span><span class="op" id="3770809">(</span><span class="ident" id="3770810"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3770811">,</span>&nbsp;<span class="ident" id="3770813"><a href="/net/http/fs.go.html#3770749">err</a></span><span class="op" id="3770816">.</span><span class="ident" id="3770817">Error</span><span class="op" id="3770822">(</span><span class="op" id="3770823">)</span><span class="op" id="3770824">,</span>&nbsp;<span class="ident" id="3770826"><a href="/net/http/status.go.html#3892803">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="3770860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770865">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770874">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770878">if</span>&nbsp;<span class="ident" id="3770881"><a href="/net/http/fs.go.html#3781114">sumRangesSize</a></span><span class="op" id="3770894">(</span><span class="ident" id="3770895"><a href="/net/http/fs.go.html#3770741">ranges</a></span><span class="op" id="3770901">)</span>&nbsp;<span class="op" id="3770903">&gt;</span>&nbsp;<span class="ident" id="3770905"><a href="/net/http/fs.go.html#3770530">size</a></span>&nbsp;<span class="op" id="3770910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770915">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;all&nbsp;the&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770965">//&nbsp;is&nbsp;larger&nbsp;than&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;file&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771010">//&nbsp;itself,&nbsp;so&nbsp;this&nbsp;is&nbsp;probably&nbsp;an&nbsp;attack,&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771060">//&nbsp;dumb&nbsp;client.&nbsp;&nbsp;Ignore&nbsp;the&nbsp;range&nbsp;request.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771106"><a href="/net/http/fs.go.html#3770741">ranges</a></span>&nbsp;<span class="op" id="3771113">=</span>&nbsp;<span class="ident" id="3771115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771125">switch</span>&nbsp;<span class="op" id="3771132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771136">case</span>&nbsp;<span class="builtinfunc" id="3771141">len</span><span class="op" id="3771144">(</span><span class="ident" id="3771145"><a href="/net/http/fs.go.html#3770741">ranges</a></span><span class="op" id="3771151">)</span>&nbsp;<span class="op" id="3771153">==</span>&nbsp;<span class="num" id="3771156">1</span><span class="op" id="3771157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771162">//&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;14.16:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771193">//&nbsp;&#34;When&nbsp;an&nbsp;HTTP&nbsp;message&nbsp;includes&nbsp;the&nbsp;content&nbsp;of&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771254">//&nbsp;range&nbsp;(for&nbsp;example,&nbsp;a&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771310">//&nbsp;single&nbsp;range,&nbsp;or&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;set&nbsp;of&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771366">//&nbsp;that&nbsp;overlap&nbsp;without&nbsp;any&nbsp;holes),&nbsp;this&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771421">//&nbsp;transmitted&nbsp;with&nbsp;a&nbsp;Content-Range&nbsp;header,&nbsp;and&nbsp;a</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771474">//&nbsp;Content-Length&nbsp;header&nbsp;showing&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771530">//&nbsp;actually&nbsp;transferred.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771558">//&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771568">//&nbsp;A&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;single&nbsp;range&nbsp;MUST&nbsp;NOT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771626">//&nbsp;be&nbsp;sent&nbsp;using&nbsp;the&nbsp;multipart/byteranges&nbsp;media&nbsp;type.&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771684">ra</span>&nbsp;<span class="op" id="3771687">:=</span>&nbsp;<span class="ident" id="3771690"><a href="/net/http/fs.go.html#3770741">ranges</a></span><span class="op" id="3771696">[</span><span class="num" id="3771697">0</span><span class="op" id="3771698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771703">if</span>&nbsp;<span class="ident" id="3771706">_</span><span class="op" id="3771707">,</span>&nbsp;<span class="ident" id="3771709">err</span>&nbsp;<span class="op" id="3771713">:=</span>&nbsp;<span class="ident" id="3771716"><a href="/net/http/fs.go.html#3769645">content</a></span><span class="op" id="3771723">.</span><span class="ident" id="3771724">Seek</span><span class="op" id="3771728">(</span><span class="ident" id="3771729"><a href="/net/http/fs.go.html#3771684">ra</a></span><span class="op" id="3771731">.</span><span class="ident" id="3771732">start</span><span class="op" id="3771737">,</span>&nbsp;<span class="ident" id="3771739"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3771741">.</span><span class="ident" id="3771742">SEEK_SET</span><span class="op" id="3771750">)</span><span class="op" id="3771751">;</span>&nbsp;<span class="ident" id="3771753"><a href="/net/http/fs.go.html#3771709">err</a></span>&nbsp;<span class="op" id="3771757">!=</span>&nbsp;<span class="ident" id="3771760">nil</span>&nbsp;<span class="op" id="3771764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771770"><a href="/net/http/server.go.html#3861382">Error</a></span><span class="op" id="3771775">(</span><span class="ident" id="3771776"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3771777">,</span>&nbsp;<span class="ident" id="3771779"><a href="/net/http/fs.go.html#3771709">err</a></span><span class="op" id="3771782">.</span><span class="ident" id="3771783">Error</span><span class="op" id="3771788">(</span><span class="op" id="3771789">)</span><span class="op" id="3771790">,</span>&nbsp;<span class="ident" id="3771792"><a href="/net/http/status.go.html#3892803">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="3771826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771832">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771842">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771847"><a href="/net/http/fs.go.html#3770669">sendSize</a></span>&nbsp;<span class="op" id="3771856">=</span>&nbsp;<span class="ident" id="3771858"><a href="/net/http/fs.go.html#3771684">ra</a></span><span class="op" id="3771860">.</span><span class="ident" id="3771861">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771871"><a href="/net/http/fs.go.html#3769790">code</a></span>&nbsp;<span class="op" id="3771876">=</span>&nbsp;<span class="ident" id="3771878"><a href="/net/http/status.go.html#3891878">StatusPartialContent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771902"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3771903">.</span><span class="ident" id="3771904">Header</span><span class="op" id="3771910">(</span><span class="op" id="3771911">)</span><span class="op" id="3771912">.</span><span class="ident" id="3771913">Set</span><span class="op" id="3771916">(</span><span class="string" id="3771917">&#34;Content-Range&#34;</span><span class="op" id="3771932">,</span>&nbsp;<span class="ident" id="3771934"><a href="/net/http/fs.go.html#3771684">ra</a></span><span class="op" id="3771936">.</span><span class="ident" id="3771937">contentRange</span><span class="op" id="3771949">(</span><span class="ident" id="3771950"><a href="/net/http/fs.go.html#3770530">size</a></span><span class="op" id="3771954">)</span><span class="op" id="3771955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771959">case</span>&nbsp;<span class="builtinfunc" id="3771964">len</span><span class="op" id="3771967">(</span><span class="ident" id="3771968"><a href="/net/http/fs.go.html#3770741">ranges</a></span><span class="op" id="3771974">)</span>&nbsp;<span class="op" id="3771976">&gt;</span>&nbsp;<span class="num" id="3771978">1</span><span class="op" id="3771979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771984"><a href="/net/http/fs.go.html#3770669">sendSize</a></span>&nbsp;<span class="op" id="3771993">=</span>&nbsp;<span class="ident" id="3771995"><a href="/net/http/fs.go.html#3780808">rangesMIMESize</a></span><span class="op" id="3772009">(</span><span class="ident" id="3772010"><a href="/net/http/fs.go.html#3770741">ranges</a></span><span class="op" id="3772016">,</span>&nbsp;<span class="ident" id="3772018"><a href="/net/http/fs.go.html#3770001">ctype</a></span><span class="op" id="3772023">,</span>&nbsp;<span class="ident" id="3772025"><a href="/net/http/fs.go.html#3770530">size</a></span><span class="op" id="3772029">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772034"><a href="/net/http/fs.go.html#3769790">code</a></span>&nbsp;<span class="op" id="3772039">=</span>&nbsp;<span class="ident" id="3772041"><a href="/net/http/status.go.html#3891878">StatusPartialContent</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772066">pr</span><span class="op" id="3772068">,</span>&nbsp;<span class="ident" id="3772070">pw</span>&nbsp;<span class="op" id="3772073">:=</span>&nbsp;<span class="ident" id="3772076"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3772078">.</span><span class="ident" id="3772079">Pipe</span><span class="op" id="3772083">(</span><span class="op" id="3772084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772089">mw</span>&nbsp;<span class="op" id="3772092">:=</span>&nbsp;<span class="ident" id="3772095"><a href="/net/http/fs.go.html#3765333">multipart</a></span><span class="op" id="3772104">.</span><span class="ident" id="3772105">NewWriter</span><span class="op" id="3772114">(</span><span class="ident" id="3772115"><a href="/net/http/fs.go.html#3772070">pw</a></span><span class="op" id="3772117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772122"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772123">.</span><span class="ident" id="3772124">Header</span><span class="op" id="3772130">(</span><span class="op" id="3772131">)</span><span class="op" id="3772132">.</span><span class="ident" id="3772133">Set</span><span class="op" id="3772136">(</span><span class="string" id="3772137">&#34;Content-Type&#34;</span><span class="op" id="3772151">,</span>&nbsp;<span class="string" id="3772153">&#34;multipart/byteranges;&nbsp;boundary=&#34;</span><span class="op" id="3772186">+</span><span class="ident" id="3772187"><a href="/net/http/fs.go.html#3772089">mw</a></span><span class="op" id="3772189">.</span><span class="ident" id="3772190">Boundary</span><span class="op" id="3772198">(</span><span class="op" id="3772199">)</span><span class="op" id="3772200">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772205"><a href="/net/http/fs.go.html#3770691">sendContent</a></span>&nbsp;<span class="op" id="3772217">=</span>&nbsp;<span class="ident" id="3772219"><a href="/net/http/fs.go.html#3772066">pr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772225">defer</span>&nbsp;<span class="ident" id="3772231"><a href="/net/http/fs.go.html#3772066">pr</a></span><span class="op" id="3772233">.</span><span class="ident" id="3772234">Close</span><span class="op" id="3772239">(</span><span class="op" id="3772240">)</span>&nbsp;<span class="comment" id="3772242">//&nbsp;cause&nbsp;writing&nbsp;goroutine&nbsp;to&nbsp;fail&nbsp;and&nbsp;exit&nbsp;if&nbsp;CopyN&nbsp;doesn&#39;t&nbsp;finish.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772314">go</span>&nbsp;<span class="keyword" id="3772317">func</span><span class="op" id="3772321">(</span><span class="op" id="3772322">)</span>&nbsp;<span class="op" id="3772324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772330">for</span>&nbsp;<span class="ident" id="3772334">_</span><span class="op" id="3772335">,</span>&nbsp;<span class="ident" id="3772337">ra</span>&nbsp;<span class="op" id="3772340">:=</span>&nbsp;<span class="keyword" id="3772343">range</span>&nbsp;<span class="ident" id="3772349"><a href="/net/http/fs.go.html#3770741">ranges</a></span>&nbsp;<span class="op" id="3772356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772363">part</span><span class="op" id="3772367">,</span>&nbsp;<span class="ident" id="3772369">err</span>&nbsp;<span class="op" id="3772373">:=</span>&nbsp;<span class="ident" id="3772376"><a href="/net/http/fs.go.html#3772089">mw</a></span><span class="op" id="3772378">.</span><span class="ident" id="3772379">CreatePart</span><span class="op" id="3772389">(</span><span class="ident" id="3772390"><a href="/net/http/fs.go.html#3772337">ra</a></span><span class="op" id="3772392">.</span><span class="ident" id="3772393">mimeHeader</span><span class="op" id="3772403">(</span><span class="ident" id="3772404"><a href="/net/http/fs.go.html#3770001">ctype</a></span><span class="op" id="3772409">,</span>&nbsp;<span class="ident" id="3772411"><a href="/net/http/fs.go.html#3770530">size</a></span><span class="op" id="3772415">)</span><span class="op" id="3772416">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772423">if</span>&nbsp;<span class="ident" id="3772426"><a href="/net/http/fs.go.html#3772369">err</a></span>&nbsp;<span class="op" id="3772430">!=</span>&nbsp;<span class="ident" id="3772433">nil</span>&nbsp;<span class="op" id="3772437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772445"><a href="/net/http/fs.go.html#3772070">pw</a></span><span class="op" id="3772447">.</span><span class="ident" id="3772448">CloseWithError</span><span class="op" id="3772462">(</span><span class="ident" id="3772463"><a href="/net/http/fs.go.html#3772369">err</a></span><span class="op" id="3772466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772493">if</span>&nbsp;<span class="ident" id="3772496">_</span><span class="op" id="3772497">,</span>&nbsp;<span class="ident" id="3772499">err</span>&nbsp;<span class="op" id="3772503">:=</span>&nbsp;<span class="ident" id="3772506"><a href="/net/http/fs.go.html#3769645">content</a></span><span class="op" id="3772513">.</span><span class="ident" id="3772514">Seek</span><span class="op" id="3772518">(</span><span class="ident" id="3772519"><a href="/net/http/fs.go.html#3772337">ra</a></span><span class="op" id="3772521">.</span><span class="ident" id="3772522">start</span><span class="op" id="3772527">,</span>&nbsp;<span class="ident" id="3772529"><a href="/net/http/fs.go.html#3765379">os</a></span><span class="op" id="3772531">.</span><span class="ident" id="3772532">SEEK_SET</span><span class="op" id="3772540">)</span><span class="op" id="3772541">;</span>&nbsp;<span class="ident" id="3772543"><a href="/net/http/fs.go.html#3772499">err</a></span>&nbsp;<span class="op" id="3772547">!=</span>&nbsp;<span class="ident" id="3772550">nil</span>&nbsp;<span class="op" id="3772554">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772562"><a href="/net/http/fs.go.html#3772070">pw</a></span><span class="op" id="3772564">.</span><span class="ident" id="3772565">CloseWithError</span><span class="op" id="3772579">(</span><span class="ident" id="3772580"><a href="/net/http/fs.go.html#3772499">err</a></span><span class="op" id="3772583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772591">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772610">if</span>&nbsp;<span class="ident" id="3772613">_</span><span class="op" id="3772614">,</span>&nbsp;<span class="ident" id="3772616">err</span>&nbsp;<span class="op" id="3772620">:=</span>&nbsp;<span class="ident" id="3772623"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3772625">.</span><span class="ident" id="3772626">CopyN</span><span class="op" id="3772631">(</span><span class="ident" id="3772632"><a href="/net/http/fs.go.html#3772363">part</a></span><span class="op" id="3772636">,</span>&nbsp;<span class="ident" id="3772638"><a href="/net/http/fs.go.html#3769645">content</a></span><span class="op" id="3772645">,</span>&nbsp;<span class="ident" id="3772647"><a href="/net/http/fs.go.html#3772337">ra</a></span><span class="op" id="3772649">.</span><span class="ident" id="3772650">length</span><span class="op" id="3772656">)</span><span class="op" id="3772657">;</span>&nbsp;<span class="ident" id="3772659"><a href="/net/http/fs.go.html#3772616">err</a></span>&nbsp;<span class="op" id="3772663">!=</span>&nbsp;<span class="ident" id="3772666">nil</span>&nbsp;<span class="op" id="3772670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772678"><a href="/net/http/fs.go.html#3772070">pw</a></span><span class="op" id="3772680">.</span><span class="ident" id="3772681">CloseWithError</span><span class="op" id="3772695">(</span><span class="ident" id="3772696"><a href="/net/http/fs.go.html#3772616">err</a></span><span class="op" id="3772699">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772707">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772731"><a href="/net/http/fs.go.html#3772089">mw</a></span><span class="op" id="3772733">.</span><span class="ident" id="3772734">Close</span><span class="op" id="3772739">(</span><span class="op" id="3772740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772746"><a href="/net/http/fs.go.html#3772070">pw</a></span><span class="op" id="3772748">.</span><span class="ident" id="3772749">Close</span><span class="op" id="3772754">(</span><span class="op" id="3772755">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772760">}</span><span class="op" id="3772761">(</span><span class="op" id="3772762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772771"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772772">.</span><span class="ident" id="3772773">Header</span><span class="op" id="3772779">(</span><span class="op" id="3772780">)</span><span class="op" id="3772781">.</span><span class="ident" id="3772782">Set</span><span class="op" id="3772785">(</span><span class="string" id="3772786">&#34;Accept-Ranges&#34;</span><span class="op" id="3772801">,</span>&nbsp;<span class="string" id="3772803">&#34;bytes&#34;</span><span class="op" id="3772810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772814">if</span>&nbsp;<span class="ident" id="3772817"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772818">.</span><span class="ident" id="3772819">Header</span><span class="op" id="3772825">(</span><span class="op" id="3772826">)</span><span class="op" id="3772827">.</span><span class="ident" id="3772828">Get</span><span class="op" id="3772831">(</span><span class="string" id="3772832">&#34;Content-Encoding&#34;</span><span class="op" id="3772850">)</span>&nbsp;<span class="op" id="3772852">==</span>&nbsp;<span class="string" id="3772855">&#34;&#34;</span>&nbsp;<span class="op" id="3772858">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772863"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772864">.</span><span class="ident" id="3772865">Header</span><span class="op" id="3772871">(</span><span class="op" id="3772872">)</span><span class="op" id="3772873">.</span><span class="ident" id="3772874">Set</span><span class="op" id="3772877">(</span><span class="string" id="3772878">&#34;Content-Length&#34;</span><span class="op" id="3772894">,</span>&nbsp;<span class="ident" id="3772896"><a href="/net/http/fs.go.html#3765410">strconv</a></span><span class="op" id="3772903">.</span><span class="ident" id="3772904">FormatInt</span><span class="op" id="3772913">(</span><span class="ident" id="3772914"><a href="/net/http/fs.go.html#3770669">sendSize</a></span><span class="op" id="3772922">,</span>&nbsp;<span class="num" id="3772924">10</span><span class="op" id="3772926">)</span><span class="op" id="3772927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772938"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772939">.</span><span class="ident" id="3772940">WriteHeader</span><span class="op" id="3772951">(</span><span class="ident" id="3772952"><a href="/net/http/fs.go.html#3769790">code</a></span><span class="op" id="3772956">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772960">if</span>&nbsp;<span class="ident" id="3772963"><a href="/net/http/fs.go.html#3769569">r</a></span><span class="op" id="3772964">.</span><span class="ident" id="3772965">Method</span>&nbsp;<span class="op" id="3772972">!=</span>&nbsp;<span class="string" id="3772975">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3772982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772986"><a href="/net/http/fs.go.html#3765319">io</a></span><span class="op" id="3772988">.</span><span class="ident" id="3772989">CopyN</span><span class="op" id="3772994">(</span><span class="ident" id="3772995"><a href="/net/http/fs.go.html#3769551">w</a></span><span class="op" id="3772996">,</span>&nbsp;<span class="ident" id="3772998"><a href="/net/http/fs.go.html#3770691">sendContent</a></span><span class="op" id="3773009">,</span>&nbsp;<span class="ident" id="3773011"><a href="/net/http/fs.go.html#3770669">sendSize</a></span><span class="op" id="3773019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773022">}</span><br>
<span class="lineno"></span><span class="op" id="3773024">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="3773027">//&nbsp;modtime&nbsp;is&nbsp;the&nbsp;modification&nbsp;time&nbsp;of&nbsp;the&nbsp;resource&nbsp;to&nbsp;be&nbsp;served,&nbsp;or&nbsp;IsZero().</span><br>
<span class="lineno"></span><span class="comment" id="3773106">//&nbsp;return&nbsp;value&nbsp;is&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;complete.</span><br>
<span class="lineno"></span><span class="keyword" id="3773163">func</span>&nbsp;<span class="ident" id="3773168">checkLastModified</span><span class="op" id="3773185">(</span><span class="ident" id="3773186">w</span>&nbsp;<span class="ident" id="3773188"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3773202">,</span>&nbsp;<span class="ident" id="3773204">r</span>&nbsp;<span class="op" id="3773206">*</span><span class="ident" id="3773207"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3773214">,</span>&nbsp;<span class="ident" id="3773216">modtime</span>&nbsp;<span class="ident" id="3773224"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3773228">.</span><span class="ident" id="3773229">Time</span><span class="op" id="3773233">)</span>&nbsp;<span class="builtintype" id="3773235">bool</span>&nbsp;<span class="op" id="3773240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773243">if</span>&nbsp;<span class="ident" id="3773246"><a href="/net/http/fs.go.html#3773216">modtime</a></span><span class="op" id="3773253">.</span><span class="ident" id="3773254">IsZero</span><span class="op" id="3773260">(</span><span class="op" id="3773261">)</span>&nbsp;<span class="op" id="3773263">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773267">return</span>&nbsp;<span class="ident" id="3773274">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773285">//&nbsp;The&nbsp;Date-Modified&nbsp;header&nbsp;truncates&nbsp;sub-second&nbsp;precision,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773349">//&nbsp;use&nbsp;mtime&nbsp;&lt;&nbsp;t+1s&nbsp;instead&nbsp;of&nbsp;mtime&nbsp;&lt;=&nbsp;t&nbsp;to&nbsp;check&nbsp;for&nbsp;unmodified.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773417">if</span>&nbsp;<span class="ident" id="3773420">t</span><span class="op" id="3773421">,</span>&nbsp;<span class="ident" id="3773423">err</span>&nbsp;<span class="op" id="3773427">:=</span>&nbsp;<span class="ident" id="3773430"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3773434">.</span><span class="ident" id="3773435">Parse</span><span class="op" id="3773440">(</span><span class="ident" id="3773441"><a href="/net/http/server.go.html#3839717">TimeFormat</a></span><span class="op" id="3773451">,</span>&nbsp;<span class="ident" id="3773453"><a href="/net/http/fs.go.html#3773204">r</a></span><span class="op" id="3773454">.</span><span class="ident" id="3773455">Header</span><span class="op" id="3773461">.</span><span class="ident" id="3773462">Get</span><span class="op" id="3773465">(</span><span class="string" id="3773466">&#34;If-Modified-Since&#34;</span><span class="op" id="3773485">)</span><span class="op" id="3773486">)</span><span class="op" id="3773487">;</span>&nbsp;<span class="ident" id="3773489"><a href="/net/http/fs.go.html#3773423">err</a></span>&nbsp;<span class="op" id="3773493">==</span>&nbsp;<span class="ident" id="3773496">nil</span>&nbsp;<span class="op" id="3773500">&amp;&amp;</span>&nbsp;<span class="ident" id="3773503"><a href="/net/http/fs.go.html#3773216">modtime</a></span><span class="op" id="3773510">.</span><span class="ident" id="3773511">Before</span><span class="op" id="3773517">(</span><span class="ident" id="3773518"><a href="/net/http/fs.go.html#3773420">t</a></span><span class="op" id="3773519">.</span><span class="ident" id="3773520">Add</span><span class="op" id="3773523">(</span><span class="num" id="3773524">1</span><span class="op" id="3773525">*</span><span class="ident" id="3773526"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3773530">.</span><span class="ident" id="3773531">Second</span><span class="op" id="3773537">)</span><span class="op" id="3773538">)</span>&nbsp;<span class="op" id="3773540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773544">h</span>&nbsp;<span class="op" id="3773546">:=</span>&nbsp;<span class="ident" id="3773549"><a href="/net/http/fs.go.html#3773186">w</a></span><span class="op" id="3773550">.</span><span class="ident" id="3773551">Header</span><span class="op" id="3773557">(</span><span class="op" id="3773558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3773562">delete</span><span class="op" id="3773568">(</span><span class="ident" id="3773569"><a href="/net/http/fs.go.html#3773544">h</a></span><span class="op" id="3773570">,</span>&nbsp;<span class="string" id="3773572">&#34;Content-Type&#34;</span><span class="op" id="3773586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3773590">delete</span><span class="op" id="3773596">(</span><span class="ident" id="3773597"><a href="/net/http/fs.go.html#3773544">h</a></span><span class="op" id="3773598">,</span>&nbsp;<span class="string" id="3773600">&#34;Content-Length&#34;</span><span class="op" id="3773616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773620"><a href="/net/http/fs.go.html#3773186">w</a></span><span class="op" id="3773621">.</span><span class="ident" id="3773622">WriteHeader</span><span class="op" id="3773633">(</span><span class="ident" id="3773634"><a href="/net/http/status.go.html#3892037">StatusNotModified</a></span><span class="op" id="3773651">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773655">return</span>&nbsp;<span class="ident" id="3773662">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773671"><a href="/net/http/fs.go.html#3773186">w</a></span><span class="op" id="3773672">.</span><span class="ident" id="3773673">Header</span><span class="op" id="3773679">(</span><span class="op" id="3773680">)</span><span class="op" id="3773681">.</span><span class="ident" id="3773682">Set</span><span class="op" id="3773685">(</span><span class="string" id="3773686">&#34;Last-Modified&#34;</span><span class="op" id="3773701">,</span>&nbsp;<span class="ident" id="3773703"><a href="/net/http/fs.go.html#3773216">modtime</a></span><span class="op" id="3773710">.</span><span class="ident" id="3773711">UTC</span><span class="op" id="3773714">(</span><span class="op" id="3773715">)</span><span class="op" id="3773716">.</span><span class="ident" id="3773717">Format</span><span class="op" id="3773723">(</span><span class="ident" id="3773724"><a href="/net/http/server.go.html#3839717">TimeFormat</a></span><span class="op" id="3773734">)</span><span class="op" id="3773735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773738">return</span>&nbsp;<span class="ident" id="3773745">false</span><br>
<span class="lineno"></span><span class="op" id="3773751">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3773754">//&nbsp;checkETag&nbsp;implements&nbsp;If-None-Match&nbsp;and&nbsp;If-Range&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3773813">//</span><br>
<span class="lineno"></span><span class="comment" id="3773816">//&nbsp;The&nbsp;ETag&nbsp;or&nbsp;modtime&nbsp;must&nbsp;have&nbsp;been&nbsp;previously&nbsp;set&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3773876">//&nbsp;ResponseWriter&#39;s&nbsp;headers.&nbsp;&nbsp;The&nbsp;modtime&nbsp;is&nbsp;only&nbsp;compared&nbsp;at&nbsp;second</span><br>
<span class="lineno">285</span><span class="comment" id="3773945">//&nbsp;granularity&nbsp;and&nbsp;may&nbsp;be&nbsp;the&nbsp;zero&nbsp;value&nbsp;to&nbsp;mean&nbsp;unknown.</span><br>
<span class="lineno"></span><span class="comment" id="3774003">//</span><br>
<span class="lineno"></span><span class="comment" id="3774006">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;effective&nbsp;request&nbsp;&#34;Range&#34;&nbsp;header&nbsp;to&nbsp;use&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3774077">//&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;considered&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="3774125">func</span>&nbsp;<span class="ident" id="3774130">checkETag</span><span class="op" id="3774139">(</span><span class="ident" id="3774140">w</span>&nbsp;<span class="ident" id="3774142"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3774156">,</span>&nbsp;<span class="ident" id="3774158">r</span>&nbsp;<span class="op" id="3774160">*</span><span class="ident" id="3774161"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3774168">,</span>&nbsp;<span class="ident" id="3774170">modtime</span>&nbsp;<span class="ident" id="3774178"><a href="/net/http/fs.go.html#3765432">time</a></span><span class="op" id="3774182">.</span><span class="ident" id="3774183">Time</span><span class="op" id="3774187">)</span>&nbsp;<span class="op" id="3774189">(</span><span class="ident" id="3774190">rangeReq</span>&nbsp;<span class="builtintype" id="3774199">string</span><span class="op" id="3774205">,</span>&nbsp;<span class="ident" id="3774207">done</span>&nbsp;<span class="builtintype" id="3774212">bool</span><span class="op" id="3774216">)</span>&nbsp;<span class="op" id="3774218">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774221">etag</span>&nbsp;<span class="op" id="3774226">:=</span>&nbsp;<span class="ident" id="3774229"><a href="/net/http/fs.go.html#3774140">w</a></span><span class="op" id="3774230">.</span><span class="ident" id="3774231">Header</span><span class="op" id="3774237">(</span><span class="op" id="3774238">)</span><span class="op" id="3774239">.</span><span class="ident" id="3774240">get</span><span class="op" id="3774243">(</span><span class="string" id="3774244">&#34;Etag&#34;</span><span class="op" id="3774250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774253"><a href="/net/http/fs.go.html#3774190">rangeReq</a></span>&nbsp;<span class="op" id="3774262">=</span>&nbsp;<span class="ident" id="3774264"><a href="/net/http/fs.go.html#3774158">r</a></span><span class="op" id="3774265">.</span><span class="ident" id="3774266">Header</span><span class="op" id="3774272">.</span><span class="ident" id="3774273">get</span><span class="op" id="3774276">(</span><span class="string" id="3774277">&#34;Range&#34;</span><span class="op" id="3774284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774288">//&nbsp;Invalidate&nbsp;the&nbsp;range&nbsp;request&nbsp;if&nbsp;the&nbsp;entity&nbsp;doesn&#39;t&nbsp;match&nbsp;the&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774357">//&nbsp;the&nbsp;client&nbsp;was&nbsp;expecting.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774387">//&nbsp;&#34;If-Range:&nbsp;version&#34;&nbsp;means&nbsp;&#34;ignore&nbsp;the&nbsp;Range:&nbsp;header&nbsp;unless&nbsp;version&nbsp;matches&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774470">//&nbsp;current&nbsp;file.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774489">//&nbsp;We&nbsp;only&nbsp;support&nbsp;ETag&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774524">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;set&nbsp;the&nbsp;ETag&nbsp;on&nbsp;the&nbsp;response&nbsp;already.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774587">if</span>&nbsp;<span class="ident" id="3774590">ir</span>&nbsp;<span class="op" id="3774593">:=</span>&nbsp;<span class="ident" id="3774596"><a href="/net/http/fs.go.html#3774158">r</a></span><span class="op" id="3774597">.</span><span class="ident" id="3774598">Header</span><span class="op" id="3774604">.</span><span class="ident" id="3774605">get</span><span class="op" id="3774608">(</span><span class="string" id="3774609">&#34;If-Range&#34;</span><span class="op" id="3774619">)</span><span class="op" id="3774620">;</span>&nbsp;<span class="ident" id="3774622"><a href="/net/http/fs.go.html#3774590">ir</a></span>&nbsp;<span class="op" id="3774625">!=</span>&nbsp;<span class="string" id="3774628">&#34;&#34;</span>&nbsp;<span class="op" id="3774631">&amp;&amp;</span>&nbsp;<span class="ident" id="3774634"><a href="/net/http/fs.go.html#3774590">ir</a></span>&nbsp;<span class="op" id="3774637">!=</span>&nbsp;<span class="ident" id="3774640"><a href="/net/http/fs.go.html#3774221">etag</a></span>&nbsp;<span class="op" id="3774645">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774649">//&nbsp;The&nbsp;If-Range&nbsp;value&nbsp;is&nbsp;typically&nbsp;the&nbsp;ETag&nbsp;value,&nbsp;but&nbsp;it&nbsp;may&nbsp;also&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774721">//&nbsp;the&nbsp;modtime&nbsp;date.&nbsp;See&nbsp;golang.org/issue/8367.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774771">timeMatches</span>&nbsp;<span class="op" id="3774783">:=</span>&nbsp;<span class="ident" id="3774786">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774794">if</span>&nbsp;<span class="op" id="3774797">!</span><span class="ident" id="3774798"><a href="/net/http/fs.go.html#3774170">modtime</a></span><span class="op" id="3774805">.</span><span class="ident" id="3774806">IsZero</span><span class="op" id="3774812">(</span><span class="op" id="3774813">)</span>&nbsp;<span class="op" id="3774815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774820">if</span>&nbsp;<span class="ident" id="3774823">t</span><span class="op" id="3774824">,</span>&nbsp;<span class="ident" id="3774826">err</span>&nbsp;<span class="op" id="3774830">:=</span>&nbsp;<span class="ident" id="3774833"><a href="/net/http/header.go.html#3783139">ParseTime</a></span><span class="op" id="3774842">(</span><span class="ident" id="3774843"><a href="/net/http/fs.go.html#3774590">ir</a></span><span class="op" id="3774845">)</span><span class="op" id="3774846">;</span>&nbsp;<span class="ident" id="3774848"><a href="/net/http/fs.go.html#3774826">err</a></span>&nbsp;<span class="op" id="3774852">==</span>&nbsp;<span class="ident" id="3774855">nil</span>&nbsp;<span class="op" id="3774859">&amp;&amp;</span>&nbsp;<span class="ident" id="3774862"><a href="/net/http/fs.go.html#3774823">t</a></span><span class="op" id="3774863">.</span><span class="ident" id="3774864">Unix</span><span class="op" id="3774868">(</span><span class="op" id="3774869">)</span>&nbsp;<span class="op" id="3774871">==</span>&nbsp;<span class="ident" id="3774874"><a href="/net/http/fs.go.html#3774170">modtime</a></span><span class="op" id="3774881">.</span><span class="ident" id="3774882">Unix</span><span class="op" id="3774886">(</span><span class="op" id="3774887">)</span>&nbsp;<span class="op" id="3774889">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774895"><a href="/net/http/fs.go.html#3774771">timeMatches</a></span>&nbsp;<span class="op" id="3774907">=</span>&nbsp;<span class="ident" id="3774909">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774925">if</span>&nbsp;<span class="op" id="3774928">!</span><span class="ident" id="3774929"><a href="/net/http/fs.go.html#3774771">timeMatches</a></span>&nbsp;<span class="op" id="3774941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774946"><a href="/net/http/fs.go.html#3774190">rangeReq</a></span>&nbsp;<span class="op" id="3774955">=</span>&nbsp;<span class="string" id="3774957">&#34;&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774969">if</span>&nbsp;<span class="ident" id="3774972">inm</span>&nbsp;<span class="op" id="3774976">:=</span>&nbsp;<span class="ident" id="3774979"><a href="/net/http/fs.go.html#3774158">r</a></span><span class="op" id="3774980">.</span><span class="ident" id="3774981">Header</span><span class="op" id="3774987">.</span><span class="ident" id="3774988">get</span><span class="op" id="3774991">(</span><span class="string" id="3774992">&#34;If-None-Match&#34;</span><span class="op" id="3775007">)</span><span class="op" id="3775008">;</span>&nbsp;<span class="ident" id="3775010"><a href="/net/http/fs.go.html#3774972">inm</a></span>&nbsp;<span class="op" id="3775014">!=</span>&nbsp;<span class="string" id="3775017">&#34;&#34;</span>&nbsp;<span class="op" id="3775020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775024">//&nbsp;Must&nbsp;know&nbsp;ETag.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775045">if</span>&nbsp;<span class="ident" id="3775048"><a href="/net/http/fs.go.html#3774221">etag</a></span>&nbsp;<span class="op" id="3775053">==</span>&nbsp;<span class="string" id="3775056">&#34;&#34;</span>&nbsp;<span class="op" id="3775059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775064">return</span>&nbsp;<span class="ident" id="3775071"><a href="/net/http/fs.go.html#3774190">rangeReq</a></span><span class="op" id="3775079">,</span>&nbsp;<span class="ident" id="3775081">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775094">//&nbsp;TODO(bradfitz):&nbsp;non-GET/HEAD&nbsp;requests&nbsp;require&nbsp;more&nbsp;work:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775156">//&nbsp;sending&nbsp;a&nbsp;different&nbsp;status&nbsp;code&nbsp;on&nbsp;matches,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775209">//&nbsp;also&nbsp;can&#39;t&nbsp;use&nbsp;weak&nbsp;cache&nbsp;validators&nbsp;(those&nbsp;with&nbsp;a&nbsp;&#34;W/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775269">//&nbsp;prefix).&nbsp;&nbsp;But&nbsp;most&nbsp;users&nbsp;of&nbsp;ServeContent&nbsp;will&nbsp;be&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775329">//&nbsp;it&nbsp;on&nbsp;GET&nbsp;or&nbsp;HEAD,&nbsp;so&nbsp;only&nbsp;support&nbsp;those&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775384">if</span>&nbsp;<span class="ident" id="3775387"><a href="/net/http/fs.go.html#3774158">r</a></span><span class="op" id="3775388">.</span><span class="ident" id="3775389">Method</span>&nbsp;<span class="op" id="3775396">!=</span>&nbsp;<span class="string" id="3775399">&#34;GET&#34;</span>&nbsp;<span class="op" id="3775405">&amp;&amp;</span>&nbsp;<span class="ident" id="3775408"><a href="/net/http/fs.go.html#3774158">r</a></span><span class="op" id="3775409">.</span><span class="ident" id="3775410">Method</span>&nbsp;<span class="op" id="3775417">!=</span>&nbsp;<span class="string" id="3775420">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3775427">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775432">return</span>&nbsp;<span class="ident" id="3775439"><a href="/net/http/fs.go.html#3774190">rangeReq</a></span><span class="op" id="3775447">,</span>&nbsp;<span class="ident" id="3775449">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775462">//&nbsp;TODO(bradfitz):&nbsp;deal&nbsp;with&nbsp;comma-separated&nbsp;or&nbsp;multiple-valued</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775528">//&nbsp;list&nbsp;of&nbsp;If-None-match&nbsp;values.&nbsp;&nbsp;For&nbsp;now&nbsp;just&nbsp;handle&nbsp;the&nbsp;common</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775595">//&nbsp;case&nbsp;of&nbsp;a&nbsp;single&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775623">if</span>&nbsp;<span class="ident" id="3775626"><a href="/net/http/fs.go.html#3774972">inm</a></span>&nbsp;<span class="op" id="3775630">==</span>&nbsp;<span class="ident" id="3775633"><a href="/net/http/fs.go.html#3774221">etag</a></span>&nbsp;<span class="op" id="3775638">||</span>&nbsp;<span class="ident" id="3775641"><a href="/net/http/fs.go.html#3774972">inm</a></span>&nbsp;<span class="op" id="3775645">==</span>&nbsp;<span class="string" id="3775648">&#34;*&#34;</span>&nbsp;<span class="op" id="3775652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775657">h</span>&nbsp;<span class="op" id="3775659">:=</span>&nbsp;<span class="ident" id="3775662"><a href="/net/http/fs.go.html#3774140">w</a></span><span class="op" id="3775663">.</span><span class="ident" id="3775664">Header</span><span class="op" id="3775670">(</span><span class="op" id="3775671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3775676">delete</span><span class="op" id="3775682">(</span><span class="ident" id="3775683"><a href="/net/http/fs.go.html#3775657">h</a></span><span class="op" id="3775684">,</span>&nbsp;<span class="string" id="3775686">&#34;Content-Type&#34;</span><span class="op" id="3775700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3775705">delete</span><span class="op" id="3775711">(</span><span class="ident" id="3775712"><a href="/net/http/fs.go.html#3775657">h</a></span><span class="op" id="3775713">,</span>&nbsp;<span class="string" id="3775715">&#34;Content-Length&#34;</span><span class="op" id="3775731">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775736"><a href="/net/http/fs.go.html#3774140">w</a></span><span class="op" id="3775737">.</span><span class="ident" id="3775738">WriteHeader</span><span class="op" id="3775749">(</span><span class="ident" id="3775750"><a href="/net/http/status.go.html#3892037">StatusNotModified</a></span><span class="op" id="3775767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775772">return</span>&nbsp;<span class="string" id="3775779">&#34;&#34;</span><span class="op" id="3775781">,</span>&nbsp;<span class="ident" id="3775783">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775796">return</span>&nbsp;<span class="ident" id="3775803"><a href="/net/http/fs.go.html#3774190">rangeReq</a></span><span class="op" id="3775811">,</span>&nbsp;<span class="ident" id="3775813">false</span><br>
<span class="lineno">340</span><span class="op" id="3775819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3775822">//&nbsp;name&nbsp;is&nbsp;&#39;/&#39;-separated,&nbsp;not&nbsp;filepath.Separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3775872">func</span>&nbsp;<span class="ident" id="3775877">serveFile</span><span class="op" id="3775886">(</span><span class="ident" id="3775887">w</span>&nbsp;<span class="ident" id="3775889"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3775903">,</span>&nbsp;<span class="ident" id="3775905">r</span>&nbsp;<span class="op" id="3775907">*</span><span class="ident" id="3775908"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3775915">,</span>&nbsp;<span class="ident" id="3775917">fs</span>&nbsp;<span class="ident" id="3775920"><a href="/net/http/fs.go.html#3766440">FileSystem</a></span><span class="op" id="3775930">,</span>&nbsp;<span class="ident" id="3775932">name</span>&nbsp;<span class="builtintype" id="3775937">string</span><span class="op" id="3775943">,</span>&nbsp;<span class="ident" id="3775945">redirect</span>&nbsp;<span class="builtintype" id="3775954">bool</span><span class="op" id="3775958">)</span>&nbsp;<span class="op" id="3775960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775963">const</span>&nbsp;<span class="ident" id="3775969">indexPage</span>&nbsp;<span class="op" id="3775979">=</span>&nbsp;<span class="string" id="3775981">&#34;/index.html&#34;</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775997">//&nbsp;redirect&nbsp;.../index.html&nbsp;to&nbsp;.../</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776033">//&nbsp;can&#39;t&nbsp;use&nbsp;Redirect()&nbsp;because&nbsp;that&nbsp;would&nbsp;make&nbsp;the&nbsp;path&nbsp;absolute,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776101">//&nbsp;which&nbsp;would&nbsp;be&nbsp;a&nbsp;problem&nbsp;running&nbsp;under&nbsp;StripPrefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776156">if</span>&nbsp;<span class="ident" id="3776159"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3776166">.</span><span class="ident" id="3776167">HasSuffix</span><span class="op" id="3776176">(</span><span class="ident" id="3776177"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776178">.</span><span class="ident" id="3776179">URL</span><span class="op" id="3776182">.</span><span class="ident" id="3776183">Path</span><span class="op" id="3776187">,</span>&nbsp;<span class="ident" id="3776189"><a href="/net/http/fs.go.html#3775969">indexPage</a></span><span class="op" id="3776198">)</span>&nbsp;<span class="op" id="3776200">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776204"><a href="/net/http/fs.go.html#3777562">localRedirect</a></span><span class="op" id="3776217">(</span><span class="ident" id="3776218"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3776219">,</span>&nbsp;<span class="ident" id="3776221"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776222">,</span>&nbsp;<span class="string" id="3776224">&#34;./&#34;</span><span class="op" id="3776228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776244">f</span><span class="op" id="3776245">,</span>&nbsp;<span class="ident" id="3776247">err</span>&nbsp;<span class="op" id="3776251">:=</span>&nbsp;<span class="ident" id="3776254"><a href="/net/http/fs.go.html#3775917">fs</a></span><span class="op" id="3776256">.</span><span class="ident" id="3776257">Open</span><span class="op" id="3776261">(</span><span class="ident" id="3776262"><a href="/net/http/fs.go.html#3775932">name</a></span><span class="op" id="3776266">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776269">if</span>&nbsp;<span class="ident" id="3776272"><a href="/net/http/fs.go.html#3776247">err</a></span>&nbsp;<span class="op" id="3776276">!=</span>&nbsp;<span class="ident" id="3776279">nil</span>&nbsp;<span class="op" id="3776283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776287">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776318"><a href="/net/http/server.go.html#3861615">NotFound</a></span><span class="op" id="3776326">(</span><span class="ident" id="3776327"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3776328">,</span>&nbsp;<span class="ident" id="3776330"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776335">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776343">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776346">defer</span>&nbsp;<span class="ident" id="3776352"><a href="/net/http/fs.go.html#3776244">f</a></span><span class="op" id="3776353">.</span><span class="ident" id="3776354">Close</span><span class="op" id="3776359">(</span><span class="op" id="3776360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776364">d</span><span class="op" id="3776365">,</span>&nbsp;<span class="ident" id="3776367">err1</span>&nbsp;<span class="op" id="3776372">:=</span>&nbsp;<span class="ident" id="3776375"><a href="/net/http/fs.go.html#3776244">f</a></span><span class="op" id="3776376">.</span><span class="ident" id="3776377">Stat</span><span class="op" id="3776381">(</span><span class="op" id="3776382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776385">if</span>&nbsp;<span class="ident" id="3776388"><a href="/net/http/fs.go.html#3776367">err1</a></span>&nbsp;<span class="op" id="3776393">!=</span>&nbsp;<span class="ident" id="3776396">nil</span>&nbsp;<span class="op" id="3776400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776404">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776435"><a href="/net/http/server.go.html#3861615">NotFound</a></span><span class="op" id="3776443">(</span><span class="ident" id="3776444"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3776445">,</span>&nbsp;<span class="ident" id="3776447"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776452">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776464">if</span>&nbsp;<span class="ident" id="3776467"><a href="/net/http/fs.go.html#3775945">redirect</a></span>&nbsp;<span class="op" id="3776476">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776480">//&nbsp;redirect&nbsp;to&nbsp;canonical&nbsp;path:&nbsp;/&nbsp;at&nbsp;end&nbsp;of&nbsp;directory&nbsp;url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776539">//&nbsp;r.URL.Path&nbsp;always&nbsp;begins&nbsp;with&nbsp;/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776576">url</span>&nbsp;<span class="op" id="3776580">:=</span>&nbsp;<span class="ident" id="3776583"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776584">.</span><span class="ident" id="3776585">URL</span><span class="op" id="3776588">.</span><span class="ident" id="3776589">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776596">if</span>&nbsp;<span class="ident" id="3776599"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3776600">.</span><span class="ident" id="3776601">IsDir</span><span class="op" id="3776606">(</span><span class="op" id="3776607">)</span>&nbsp;<span class="op" id="3776609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776614">if</span>&nbsp;<span class="ident" id="3776617"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776620">[</span><span class="builtinfunc" id="3776621">len</span><span class="op" id="3776624">(</span><span class="ident" id="3776625"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776628">)</span><span class="op" id="3776629">-</span><span class="num" id="3776630">1</span><span class="op" id="3776631">]</span>&nbsp;<span class="op" id="3776633">!=</span>&nbsp;<span class="string" id="3776636">&#39;/&#39;</span>&nbsp;<span class="op" id="3776640">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776646"><a href="/net/http/fs.go.html#3777562">localRedirect</a></span><span class="op" id="3776659">(</span><span class="ident" id="3776660"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3776661">,</span>&nbsp;<span class="ident" id="3776663"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776664">,</span>&nbsp;<span class="ident" id="3776666"><a href="/net/http/fs.go.html#3765385">path</a></span><span class="op" id="3776670">.</span><span class="ident" id="3776671">Base</span><span class="op" id="3776675">(</span><span class="ident" id="3776676"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776679">)</span><span class="op" id="3776680">+</span><span class="string" id="3776681">&#34;/&#34;</span><span class="op" id="3776684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776704">}</span>&nbsp;<span class="keyword" id="3776706">else</span>&nbsp;<span class="op" id="3776711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776716">if</span>&nbsp;<span class="ident" id="3776719"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776722">[</span><span class="builtinfunc" id="3776723">len</span><span class="op" id="3776726">(</span><span class="ident" id="3776727"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776730">)</span><span class="op" id="3776731">-</span><span class="num" id="3776732">1</span><span class="op" id="3776733">]</span>&nbsp;<span class="op" id="3776735">==</span>&nbsp;<span class="string" id="3776738">&#39;/&#39;</span>&nbsp;<span class="op" id="3776742">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776748"><a href="/net/http/fs.go.html#3777562">localRedirect</a></span><span class="op" id="3776761">(</span><span class="ident" id="3776762"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3776763">,</span>&nbsp;<span class="ident" id="3776765"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3776766">,</span>&nbsp;<span class="string" id="3776768">&#34;../&#34;</span><span class="op" id="3776773">+</span><span class="ident" id="3776774"><a href="/net/http/fs.go.html#3765385">path</a></span><span class="op" id="3776778">.</span><span class="ident" id="3776779">Base</span><span class="op" id="3776783">(</span><span class="ident" id="3776784"><a href="/net/http/fs.go.html#3776576">url</a></span><span class="op" id="3776787">)</span><span class="op" id="3776788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776794">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776811">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776815">//&nbsp;use&nbsp;contents&nbsp;of&nbsp;index.html&nbsp;for&nbsp;directory,&nbsp;if&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776872">if</span>&nbsp;<span class="ident" id="3776875"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3776876">.</span><span class="ident" id="3776877">IsDir</span><span class="op" id="3776882">(</span><span class="op" id="3776883">)</span>&nbsp;<span class="op" id="3776885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776889">index</span>&nbsp;<span class="op" id="3776895">:=</span>&nbsp;<span class="ident" id="3776898"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3776905">.</span><span class="ident" id="3776906">TrimSuffix</span><span class="op" id="3776916">(</span><span class="ident" id="3776917"><a href="/net/http/fs.go.html#3775932">name</a></span><span class="op" id="3776921">,</span>&nbsp;<span class="string" id="3776923">&#34;/&#34;</span><span class="op" id="3776926">)</span>&nbsp;<span class="op" id="3776928">+</span>&nbsp;<span class="ident" id="3776930"><a href="/net/http/fs.go.html#3775969">indexPage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776942">ff</span><span class="op" id="3776944">,</span>&nbsp;<span class="ident" id="3776946">err</span>&nbsp;<span class="op" id="3776950">:=</span>&nbsp;<span class="ident" id="3776953"><a href="/net/http/fs.go.html#3775917">fs</a></span><span class="op" id="3776955">.</span><span class="ident" id="3776956">Open</span><span class="op" id="3776960">(</span><span class="ident" id="3776961"><a href="/net/http/fs.go.html#3776889">index</a></span><span class="op" id="3776966">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776970">if</span>&nbsp;<span class="ident" id="3776973"><a href="/net/http/fs.go.html#3776946">err</a></span>&nbsp;<span class="op" id="3776977">==</span>&nbsp;<span class="ident" id="3776980">nil</span>&nbsp;<span class="op" id="3776984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776989">defer</span>&nbsp;<span class="ident" id="3776995"><a href="/net/http/fs.go.html#3776942">ff</a></span><span class="op" id="3776997">.</span><span class="ident" id="3776998">Close</span><span class="op" id="3777003">(</span><span class="op" id="3777004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777009">dd</span><span class="op" id="3777011">,</span>&nbsp;<span class="ident" id="3777013">err</span>&nbsp;<span class="op" id="3777017">:=</span>&nbsp;<span class="ident" id="3777020"><a href="/net/http/fs.go.html#3776942">ff</a></span><span class="op" id="3777022">.</span><span class="ident" id="3777023">Stat</span><span class="op" id="3777027">(</span><span class="op" id="3777028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777033">if</span>&nbsp;<span class="ident" id="3777036"><a href="/net/http/fs.go.html#3777013">err</a></span>&nbsp;<span class="op" id="3777040">==</span>&nbsp;<span class="ident" id="3777043">nil</span>&nbsp;<span class="op" id="3777047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777053"><a href="/net/http/fs.go.html#3775932">name</a></span>&nbsp;<span class="op" id="3777058">=</span>&nbsp;<span class="ident" id="3777060"><a href="/net/http/fs.go.html#3776889">index</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777070"><a href="/net/http/fs.go.html#3776364">d</a></span>&nbsp;<span class="op" id="3777072">=</span>&nbsp;<span class="ident" id="3777074"><a href="/net/http/fs.go.html#3777009">dd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777081"><a href="/net/http/fs.go.html#3776244">f</a></span>&nbsp;<span class="op" id="3777083">=</span>&nbsp;<span class="ident" id="3777085"><a href="/net/http/fs.go.html#3776942">ff</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777098">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777102">//&nbsp;Still&nbsp;a&nbsp;directory?&nbsp;(we&nbsp;didn&#39;t&nbsp;find&nbsp;an&nbsp;index.html&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777161">if</span>&nbsp;<span class="ident" id="3777164"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3777165">.</span><span class="ident" id="3777166">IsDir</span><span class="op" id="3777171">(</span><span class="op" id="3777172">)</span>&nbsp;<span class="op" id="3777174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777178">if</span>&nbsp;<span class="ident" id="3777181"><a href="/net/http/fs.go.html#3773168">checkLastModified</a></span><span class="op" id="3777198">(</span><span class="ident" id="3777199"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3777200">,</span>&nbsp;<span class="ident" id="3777202"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3777203">,</span>&nbsp;<span class="ident" id="3777205"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3777206">.</span><span class="ident" id="3777207">ModTime</span><span class="op" id="3777214">(</span><span class="op" id="3777215">)</span><span class="op" id="3777216">)</span>&nbsp;<span class="op" id="3777218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777223">return</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777236"><a href="/net/http/fs.go.html#3766843">dirList</a></span><span class="op" id="3777243">(</span><span class="ident" id="3777244"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3777245">,</span>&nbsp;<span class="ident" id="3777247"><a href="/net/http/fs.go.html#3776244">f</a></span><span class="op" id="3777248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777252">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777264">//&nbsp;serveContent&nbsp;will&nbsp;check&nbsp;modification&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777310">sizeFunc</span>&nbsp;<span class="op" id="3777319">:=</span>&nbsp;<span class="keyword" id="3777322">func</span><span class="op" id="3777326">(</span><span class="op" id="3777327">)</span>&nbsp;<span class="op" id="3777329">(</span><span class="ident" id="3777330">int64</span><span class="op" id="3777335">,</span>&nbsp;<span class="builtintype" id="3777337">error</span><span class="op" id="3777342">)</span>&nbsp;<span class="op" id="3777344">{</span>&nbsp;<span class="keyword" id="3777346">return</span>&nbsp;<span class="ident" id="3777353"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3777354">.</span><span class="ident" id="3777355">Size</span><span class="op" id="3777359">(</span><span class="op" id="3777360">)</span><span class="op" id="3777361">,</span>&nbsp;<span class="ident" id="3777363">nil</span>&nbsp;<span class="op" id="3777367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777370"><a href="/net/http/fs.go.html#3769538">serveContent</a></span><span class="op" id="3777382">(</span><span class="ident" id="3777383"><a href="/net/http/fs.go.html#3775887">w</a></span><span class="op" id="3777384">,</span>&nbsp;<span class="ident" id="3777386"><a href="/net/http/fs.go.html#3775905">r</a></span><span class="op" id="3777387">,</span>&nbsp;<span class="ident" id="3777389"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3777390">.</span><span class="ident" id="3777391">Name</span><span class="op" id="3777395">(</span><span class="op" id="3777396">)</span><span class="op" id="3777397">,</span>&nbsp;<span class="ident" id="3777399"><a href="/net/http/fs.go.html#3776364">d</a></span><span class="op" id="3777400">.</span><span class="ident" id="3777401">ModTime</span><span class="op" id="3777408">(</span><span class="op" id="3777409">)</span><span class="op" id="3777410">,</span>&nbsp;<span class="ident" id="3777412"><a href="/net/http/fs.go.html#3777310">sizeFunc</a></span><span class="op" id="3777420">,</span>&nbsp;<span class="ident" id="3777422"><a href="/net/http/fs.go.html#3776244">f</a></span><span class="op" id="3777423">)</span><br>
<span class="lineno"></span><span class="op" id="3777425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3777428">//&nbsp;localRedirect&nbsp;gives&nbsp;a&nbsp;Moved&nbsp;Permanently&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="3777481">//&nbsp;It&nbsp;does&nbsp;not&nbsp;convert&nbsp;relative&nbsp;paths&nbsp;to&nbsp;absolute&nbsp;paths&nbsp;like&nbsp;Redirect&nbsp;does.</span><br>
<span class="lineno"></span><span class="keyword" id="3777557">func</span>&nbsp;<span class="ident" id="3777562">localRedirect</span><span class="op" id="3777575">(</span><span class="ident" id="3777576">w</span>&nbsp;<span class="ident" id="3777578"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3777592">,</span>&nbsp;<span class="ident" id="3777594">r</span>&nbsp;<span class="op" id="3777596">*</span><span class="ident" id="3777597"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3777604">,</span>&nbsp;<span class="ident" id="3777606">newPath</span>&nbsp;<span class="builtintype" id="3777614">string</span><span class="op" id="3777620">)</span>&nbsp;<span class="op" id="3777622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777625">if</span>&nbsp;<span class="ident" id="3777628">q</span>&nbsp;<span class="op" id="3777630">:=</span>&nbsp;<span class="ident" id="3777633"><a href="/net/http/fs.go.html#3777594">r</a></span><span class="op" id="3777634">.</span><span class="ident" id="3777635">URL</span><span class="op" id="3777638">.</span><span class="ident" id="3777639">RawQuery</span><span class="op" id="3777647">;</span>&nbsp;<span class="ident" id="3777649"><a href="/net/http/fs.go.html#3777628">q</a></span>&nbsp;<span class="op" id="3777651">!=</span>&nbsp;<span class="string" id="3777654">&#34;&#34;</span>&nbsp;<span class="op" id="3777657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777661"><a href="/net/http/fs.go.html#3777606">newPath</a></span>&nbsp;<span class="op" id="3777669">+=</span>&nbsp;<span class="string" id="3777672">&#34;?&#34;</span>&nbsp;<span class="op" id="3777676">+</span>&nbsp;<span class="ident" id="3777678"><a href="/net/http/fs.go.html#3777628">q</a></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777684"><a href="/net/http/fs.go.html#3777576">w</a></span><span class="op" id="3777685">.</span><span class="ident" id="3777686">Header</span><span class="op" id="3777692">(</span><span class="op" id="3777693">)</span><span class="op" id="3777694">.</span><span class="ident" id="3777695">Set</span><span class="op" id="3777698">(</span><span class="string" id="3777699">&#34;Location&#34;</span><span class="op" id="3777709">,</span>&nbsp;<span class="ident" id="3777711"><a href="/net/http/fs.go.html#3777606">newPath</a></span><span class="op" id="3777718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777721"><a href="/net/http/fs.go.html#3777576">w</a></span><span class="op" id="3777722">.</span><span class="ident" id="3777723">WriteHeader</span><span class="op" id="3777734">(</span><span class="ident" id="3777735"><a href="/net/http/status.go.html#3891944">StatusMovedPermanently</a></span><span class="op" id="3777757">)</span><br>
<span class="lineno"></span><span class="op" id="3777759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="comment" id="3777762">//&nbsp;ServeFile&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3777848">func</span>&nbsp;<span class="ident" id="3777853">ServeFile</span><span class="op" id="3777862">(</span><span class="ident" id="3777863">w</span>&nbsp;<span class="ident" id="3777865"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3777879">,</span>&nbsp;<span class="ident" id="3777881">r</span>&nbsp;<span class="op" id="3777883">*</span><span class="ident" id="3777884"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3777891">,</span>&nbsp;<span class="ident" id="3777893">name</span>&nbsp;<span class="builtintype" id="3777898">string</span><span class="op" id="3777904">)</span>&nbsp;<span class="op" id="3777906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777909">dir</span><span class="op" id="3777912">,</span>&nbsp;<span class="ident" id="3777914">file</span>&nbsp;<span class="op" id="3777919">:=</span>&nbsp;<span class="ident" id="3777922"><a href="/net/http/fs.go.html#3765393">filepath</a></span><span class="op" id="3777930">.</span><span class="ident" id="3777931">Split</span><span class="op" id="3777936">(</span><span class="ident" id="3777937"><a href="/net/http/fs.go.html#3777893">name</a></span><span class="op" id="3777941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777944"><a href="/net/http/fs.go.html#3775877">serveFile</a></span><span class="op" id="3777953">(</span><span class="ident" id="3777954"><a href="/net/http/fs.go.html#3777863">w</a></span><span class="op" id="3777955">,</span>&nbsp;<span class="ident" id="3777957"><a href="/net/http/fs.go.html#3777881">r</a></span><span class="op" id="3777958">,</span>&nbsp;<span class="ident" id="3777960"><a href="/net/http/fs.go.html#3765805">Dir</a></span><span class="op" id="3777963">(</span><span class="ident" id="3777964"><a href="/net/http/fs.go.html#3777909">dir</a></span><span class="op" id="3777967">)</span><span class="op" id="3777968">,</span>&nbsp;<span class="ident" id="3777970"><a href="/net/http/fs.go.html#3777914">file</a></span><span class="op" id="3777974">,</span>&nbsp;<span class="ident" id="3777976">false</span><span class="op" id="3777981">)</span><br>
<span class="lineno"></span><span class="op" id="3777983">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="3777986">type</span>&nbsp;<span class="ident" id="3777991">fileHandler</span>&nbsp;<span class="keyword" id="3778003">struct</span>&nbsp;<span class="op" id="3778010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778013">root</span>&nbsp;<span class="ident" id="3778018"><a href="/net/http/fs.go.html#3766440">FileSystem</a></span><br>
<span class="lineno"></span><span class="op" id="3778029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="3778032">//&nbsp;FileServer&nbsp;returns&nbsp;a&nbsp;handler&nbsp;that&nbsp;serves&nbsp;HTTP&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3778090">//&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;file&nbsp;system&nbsp;rooted&nbsp;at&nbsp;root.</span><br>
<span class="lineno"></span><span class="comment" id="3778146">//</span><br>
<span class="lineno"></span><span class="comment" id="3778149">//&nbsp;To&nbsp;use&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;file&nbsp;system&nbsp;implementation,</span><br>
<span class="lineno"></span><span class="comment" id="3778210">//&nbsp;use&nbsp;http.Dir:</span><br>
<span class="lineno">440</span><span class="comment" id="3778227">//</span><br>
<span class="lineno"></span><span class="comment" id="3778230">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http.Handle(&#34;/&#34;,&nbsp;http.FileServer(http.Dir(&#34;/tmp&#34;)))</span><br>
<span class="lineno"></span><span class="keyword" id="3778289">func</span>&nbsp;<span class="ident" id="3778294">FileServer</span><span class="op" id="3778304">(</span><span class="ident" id="3778305">root</span>&nbsp;<span class="ident" id="3778310"><a href="/net/http/fs.go.html#3766440">FileSystem</a></span><span class="op" id="3778320">)</span>&nbsp;<span class="ident" id="3778322"><a href="/net/http/server.go.html#3825877">Handler</a></span>&nbsp;<span class="op" id="3778330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778333">return</span>&nbsp;<span class="op" id="3778340">&amp;</span><span class="ident" id="3778341"><a href="/net/http/fs.go.html#3777991">fileHandler</a></span><span class="op" id="3778352">{</span><span class="ident" id="3778353"><a href="/net/http/fs.go.html#3778305">root</a></span><span class="op" id="3778357">}</span><br>
<span class="lineno"></span><span class="op" id="3778359">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="3778362">func</span>&nbsp;<span class="op" id="3778367">(</span><span class="ident" id="3778368">f</span>&nbsp;<span class="op" id="3778370">*</span><span class="ident" id="3778371"><a href="/net/http/fs.go.html#3777991">fileHandler</a></span><span class="op" id="3778382">)</span>&nbsp;<span class="ident" id="3778384">ServeHTTP</span><span class="op" id="3778393">(</span><span class="ident" id="3778394">w</span>&nbsp;<span class="ident" id="3778396"><a href="/net/http/server.go.html#3826033">ResponseWriter</a></span><span class="op" id="3778410">,</span>&nbsp;<span class="ident" id="3778412">r</span>&nbsp;<span class="op" id="3778414">*</span><span class="ident" id="3778415"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3778422">)</span>&nbsp;<span class="op" id="3778424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778427">upath</span>&nbsp;<span class="op" id="3778433">:=</span>&nbsp;<span class="ident" id="3778436"><a href="/net/http/fs.go.html#3778412">r</a></span><span class="op" id="3778437">.</span><span class="ident" id="3778438">URL</span><span class="op" id="3778441">.</span><span class="ident" id="3778442">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778448">if</span>&nbsp;<span class="op" id="3778451">!</span><span class="ident" id="3778452"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3778459">.</span><span class="ident" id="3778460">HasPrefix</span><span class="op" id="3778469">(</span><span class="ident" id="3778470"><a href="/net/http/fs.go.html#3778427">upath</a></span><span class="op" id="3778475">,</span>&nbsp;<span class="string" id="3778477">&#34;/&#34;</span><span class="op" id="3778480">)</span>&nbsp;<span class="op" id="3778482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778486"><a href="/net/http/fs.go.html#3778427">upath</a></span>&nbsp;<span class="op" id="3778492">=</span>&nbsp;<span class="string" id="3778494">&#34;/&#34;</span>&nbsp;<span class="op" id="3778498">+</span>&nbsp;<span class="ident" id="3778500"><a href="/net/http/fs.go.html#3778427">upath</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778508"><a href="/net/http/fs.go.html#3778412">r</a></span><span class="op" id="3778509">.</span><span class="ident" id="3778510">URL</span><span class="op" id="3778513">.</span><span class="ident" id="3778514">Path</span>&nbsp;<span class="op" id="3778519">=</span>&nbsp;<span class="ident" id="3778521"><a href="/net/http/fs.go.html#3778427">upath</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778531"><a href="/net/http/fs.go.html#3775877">serveFile</a></span><span class="op" id="3778540">(</span><span class="ident" id="3778541"><a href="/net/http/fs.go.html#3778394">w</a></span><span class="op" id="3778542">,</span>&nbsp;<span class="ident" id="3778544"><a href="/net/http/fs.go.html#3778412">r</a></span><span class="op" id="3778545">,</span>&nbsp;<span class="ident" id="3778547"><a href="/net/http/fs.go.html#3778368">f</a></span><span class="op" id="3778548">.</span><span class="ident" id="3778549">root</span><span class="op" id="3778553">,</span>&nbsp;<span class="ident" id="3778555"><a href="/net/http/fs.go.html#3765385">path</a></span><span class="op" id="3778559">.</span><span class="ident" id="3778560">Clean</span><span class="op" id="3778565">(</span><span class="ident" id="3778566"><a href="/net/http/fs.go.html#3778427">upath</a></span><span class="op" id="3778571">)</span><span class="op" id="3778572">,</span>&nbsp;<span class="ident" id="3778574">true</span><span class="op" id="3778578">)</span><br>
<span class="lineno"></span><span class="op" id="3778580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3778583">//&nbsp;httpRange&nbsp;specifies&nbsp;the&nbsp;byte&nbsp;range&nbsp;to&nbsp;be&nbsp;sent&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="keyword" id="3778647">type</span>&nbsp;<span class="ident" id="3778652">httpRange</span>&nbsp;<span class="keyword" id="3778662">struct</span>&nbsp;<span class="op" id="3778669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778672">start</span><span class="op" id="3778677">,</span>&nbsp;<span class="ident" id="3778679">length</span>&nbsp;<span class="ident" id="3778686">int64</span><br>
<span class="lineno"></span><span class="op" id="3778692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="keyword" id="3778695">func</span>&nbsp;<span class="op" id="3778700">(</span><span class="ident" id="3778701">r</span>&nbsp;<span class="ident" id="3778703"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><span class="op" id="3778712">)</span>&nbsp;<span class="ident" id="3778714">contentRange</span><span class="op" id="3778726">(</span><span class="ident" id="3778727">size</span>&nbsp;<span class="ident" id="3778732">int64</span><span class="op" id="3778737">)</span>&nbsp;<span class="builtintype" id="3778739">string</span>&nbsp;<span class="op" id="3778746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778749">return</span>&nbsp;<span class="ident" id="3778756"><a href="/net/http/fs.go.html#3765312">fmt</a></span><span class="op" id="3778759">.</span><span class="ident" id="3778760">Sprintf</span><span class="op" id="3778767">(</span><span class="string" id="3778768">&#34;bytes&nbsp;%d-%d/%d&#34;</span><span class="op" id="3778784">,</span>&nbsp;<span class="ident" id="3778786"><a href="/net/http/fs.go.html#3778701">r</a></span><span class="op" id="3778787">.</span><span class="ident" id="3778788">start</span><span class="op" id="3778793">,</span>&nbsp;<span class="ident" id="3778795"><a href="/net/http/fs.go.html#3778701">r</a></span><span class="op" id="3778796">.</span><span class="ident" id="3778797">start</span><span class="op" id="3778802">+</span><span class="ident" id="3778803"><a href="/net/http/fs.go.html#3778701">r</a></span><span class="op" id="3778804">.</span><span class="ident" id="3778805">length</span><span class="op" id="3778811">-</span><span class="num" id="3778812">1</span><span class="op" id="3778813">,</span>&nbsp;<span class="ident" id="3778815"><a href="/net/http/fs.go.html#3778727">size</a></span><span class="op" id="3778819">)</span><br>
<span class="lineno"></span><span class="op" id="3778821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3778824">func</span>&nbsp;<span class="op" id="3778829">(</span><span class="ident" id="3778830">r</span>&nbsp;<span class="ident" id="3778832"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><span class="op" id="3778841">)</span>&nbsp;<span class="ident" id="3778843">mimeHeader</span><span class="op" id="3778853">(</span><span class="ident" id="3778854">contentType</span>&nbsp;<span class="builtintype" id="3778866">string</span><span class="op" id="3778872">,</span>&nbsp;<span class="ident" id="3778874">size</span>&nbsp;<span class="ident" id="3778879">int64</span><span class="op" id="3778884">)</span>&nbsp;<span class="ident" id="3778886"><a href="/net/http/fs.go.html#3765351">textproto</a></span><span class="op" id="3778895">.</span><span class="ident" id="3778896">MIMEHeader</span>&nbsp;<span class="op" id="3778907">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778910">return</span>&nbsp;<span class="ident" id="3778917"><a href="/net/http/fs.go.html#3765351">textproto</a></span><span class="op" id="3778926">.</span><span class="ident" id="3778927">MIMEHeader</span><span class="op" id="3778937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778941">&#34;Content-Range&#34;</span><span class="op" id="3778956">:</span>&nbsp;<span class="op" id="3778958">{</span><span class="ident" id="3778959"><a href="/net/http/fs.go.html#3778830">r</a></span><span class="op" id="3778960">.</span><span class="ident" id="3778961">contentRange</span><span class="op" id="3778973">(</span><span class="ident" id="3778974"><a href="/net/http/fs.go.html#3778874">size</a></span><span class="op" id="3778978">)</span><span class="op" id="3778979">}</span><span class="op" id="3778980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778984">&#34;Content-Type&#34;</span><span class="op" id="3778998">:</span>&nbsp;&nbsp;<span class="op" id="3779001">{</span><span class="ident" id="3779002"><a href="/net/http/fs.go.html#3778854">contentType</a></span><span class="op" id="3779013">}</span><span class="op" id="3779014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779017">}</span><br>
<span class="lineno"></span><span class="op" id="3779019">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3779022">//&nbsp;parseRange&nbsp;parses&nbsp;a&nbsp;Range&nbsp;header&nbsp;string&nbsp;as&nbsp;per&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="keyword" id="3779082">func</span>&nbsp;<span class="ident" id="3779087">parseRange</span><span class="op" id="3779097">(</span><span class="ident" id="3779098">s</span>&nbsp;<span class="builtintype" id="3779100">string</span><span class="op" id="3779106">,</span>&nbsp;<span class="ident" id="3779108">size</span>&nbsp;<span class="ident" id="3779113">int64</span><span class="op" id="3779118">)</span>&nbsp;<span class="op" id="3779120">(</span><span class="op" id="3779121">[</span><span class="op" id="3779122">]</span><span class="ident" id="3779123"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><span class="op" id="3779132">,</span>&nbsp;<span class="builtintype" id="3779134">error</span><span class="op" id="3779139">)</span>&nbsp;<span class="op" id="3779141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779144">if</span>&nbsp;<span class="ident" id="3779147"><a href="/net/http/fs.go.html#3779098">s</a></span>&nbsp;<span class="op" id="3779149">==</span>&nbsp;<span class="string" id="3779152">&#34;&#34;</span>&nbsp;<span class="op" id="3779155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779159">return</span>&nbsp;<span class="ident" id="3779166">nil</span><span class="op" id="3779169">,</span>&nbsp;<span class="ident" id="3779171">nil</span>&nbsp;<span class="comment" id="3779175">//&nbsp;header&nbsp;not&nbsp;present</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779201">const</span>&nbsp;<span class="ident" id="3779207">b</span>&nbsp;<span class="op" id="3779209">=</span>&nbsp;<span class="string" id="3779211">&#34;bytes=&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779221">if</span>&nbsp;<span class="op" id="3779224">!</span><span class="ident" id="3779225"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779232">.</span><span class="ident" id="3779233">HasPrefix</span><span class="op" id="3779242">(</span><span class="ident" id="3779243"><a href="/net/http/fs.go.html#3779098">s</a></span><span class="op" id="3779244">,</span>&nbsp;<span class="ident" id="3779246"><a href="/net/http/fs.go.html#3779207">b</a></span><span class="op" id="3779247">)</span>&nbsp;<span class="op" id="3779249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779253">return</span>&nbsp;<span class="ident" id="3779260">nil</span><span class="op" id="3779263">,</span>&nbsp;<span class="ident" id="3779265"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3779271">.</span><span class="ident" id="3779272">New</span><span class="op" id="3779275">(</span><span class="string" id="3779276">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3779291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779294">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779297">var</span>&nbsp;<span class="ident" id="3779301">ranges</span>&nbsp;<span class="op" id="3779308">[</span><span class="op" id="3779309">]</span><span class="ident" id="3779310"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779321">for</span>&nbsp;<span class="ident" id="3779325">_</span><span class="op" id="3779326">,</span>&nbsp;<span class="ident" id="3779328">ra</span>&nbsp;<span class="op" id="3779331">:=</span>&nbsp;<span class="keyword" id="3779334">range</span>&nbsp;<span class="ident" id="3779340"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779347">.</span><span class="ident" id="3779348">Split</span><span class="op" id="3779353">(</span><span class="ident" id="3779354"><a href="/net/http/fs.go.html#3779098">s</a></span><span class="op" id="3779355">[</span><span class="builtinfunc" id="3779356">len</span><span class="op" id="3779359">(</span><span class="ident" id="3779360"><a href="/net/http/fs.go.html#3779207">b</a></span><span class="op" id="3779361">)</span><span class="op" id="3779362">:</span><span class="op" id="3779363">]</span><span class="op" id="3779364">,</span>&nbsp;<span class="string" id="3779366">&#34;,&#34;</span><span class="op" id="3779369">)</span>&nbsp;<span class="op" id="3779371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779375"><a href="/net/http/fs.go.html#3779328">ra</a></span>&nbsp;<span class="op" id="3779378">=</span>&nbsp;<span class="ident" id="3779380"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779387">.</span><span class="ident" id="3779388">TrimSpace</span><span class="op" id="3779397">(</span><span class="ident" id="3779398"><a href="/net/http/fs.go.html#3779328">ra</a></span><span class="op" id="3779400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779404">if</span>&nbsp;<span class="ident" id="3779407"><a href="/net/http/fs.go.html#3779328">ra</a></span>&nbsp;<span class="op" id="3779410">==</span>&nbsp;<span class="string" id="3779413">&#34;&#34;</span>&nbsp;<span class="op" id="3779416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779421">continue</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779436">i</span>&nbsp;<span class="op" id="3779438">:=</span>&nbsp;<span class="ident" id="3779441"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779448">.</span><span class="ident" id="3779449">Index</span><span class="op" id="3779454">(</span><span class="ident" id="3779455"><a href="/net/http/fs.go.html#3779328">ra</a></span><span class="op" id="3779457">,</span>&nbsp;<span class="string" id="3779459">&#34;-&#34;</span><span class="op" id="3779462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779466">if</span>&nbsp;<span class="ident" id="3779469"><a href="/net/http/fs.go.html#3779436">i</a></span>&nbsp;<span class="op" id="3779471">&lt;</span>&nbsp;<span class="num" id="3779473">0</span>&nbsp;<span class="op" id="3779475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779480">return</span>&nbsp;<span class="ident" id="3779487">nil</span><span class="op" id="3779490">,</span>&nbsp;<span class="ident" id="3779492"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3779498">.</span><span class="ident" id="3779499">New</span><span class="op" id="3779502">(</span><span class="string" id="3779503">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3779518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779522">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779526">start</span><span class="op" id="3779531">,</span>&nbsp;<span class="ident" id="3779533">end</span>&nbsp;<span class="op" id="3779537">:=</span>&nbsp;<span class="ident" id="3779540"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779547">.</span><span class="ident" id="3779548">TrimSpace</span><span class="op" id="3779557">(</span><span class="ident" id="3779558"><a href="/net/http/fs.go.html#3779328">ra</a></span><span class="op" id="3779560">[</span><span class="op" id="3779561">:</span><span class="ident" id="3779562"><a href="/net/http/fs.go.html#3779436">i</a></span><span class="op" id="3779563">]</span><span class="op" id="3779564">)</span><span class="op" id="3779565">,</span>&nbsp;<span class="ident" id="3779567"><a href="/net/http/fs.go.html#3765421">strings</a></span><span class="op" id="3779574">.</span><span class="ident" id="3779575">TrimSpace</span><span class="op" id="3779584">(</span><span class="ident" id="3779585"><a href="/net/http/fs.go.html#3779328">ra</a></span><span class="op" id="3779587">[</span><span class="ident" id="3779588"><a href="/net/http/fs.go.html#3779436">i</a></span><span class="op" id="3779589">+</span><span class="num" id="3779590">1</span><span class="op" id="3779591">:</span><span class="op" id="3779592">]</span><span class="op" id="3779593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779597">var</span>&nbsp;<span class="ident" id="3779601">r</span>&nbsp;<span class="ident" id="3779603"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779615">if</span>&nbsp;<span class="ident" id="3779618"><a href="/net/http/fs.go.html#3779526">start</a></span>&nbsp;<span class="op" id="3779624">==</span>&nbsp;<span class="string" id="3779627">&#34;&#34;</span>&nbsp;<span class="op" id="3779630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779635">//&nbsp;If&nbsp;no&nbsp;start&nbsp;is&nbsp;specified,&nbsp;end&nbsp;specifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779685">//&nbsp;range&nbsp;start&nbsp;relative&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779736">i</span><span class="op" id="3779737">,</span>&nbsp;<span class="ident" id="3779739">err</span>&nbsp;<span class="op" id="3779743">:=</span>&nbsp;<span class="ident" id="3779746"><a href="/net/http/fs.go.html#3765410">strconv</a></span><span class="op" id="3779753">.</span><span class="ident" id="3779754">ParseInt</span><span class="op" id="3779762">(</span><span class="ident" id="3779763"><a href="/net/http/fs.go.html#3779533">end</a></span><span class="op" id="3779766">,</span>&nbsp;<span class="num" id="3779768">10</span><span class="op" id="3779770">,</span>&nbsp;<span class="num" id="3779772">64</span><span class="op" id="3779774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779779">if</span>&nbsp;<span class="ident" id="3779782"><a href="/net/http/fs.go.html#3779739">err</a></span>&nbsp;<span class="op" id="3779786">!=</span>&nbsp;<span class="ident" id="3779789">nil</span>&nbsp;<span class="op" id="3779793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779799">return</span>&nbsp;<span class="ident" id="3779806">nil</span><span class="op" id="3779809">,</span>&nbsp;<span class="ident" id="3779811"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3779817">.</span><span class="ident" id="3779818">New</span><span class="op" id="3779821">(</span><span class="string" id="3779822">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3779837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779847">if</span>&nbsp;<span class="ident" id="3779850"><a href="/net/http/fs.go.html#3779736">i</a></span>&nbsp;<span class="op" id="3779852">&gt;</span>&nbsp;<span class="ident" id="3779854"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3779859">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779865"><a href="/net/http/fs.go.html#3779736">i</a></span>&nbsp;<span class="op" id="3779867">=</span>&nbsp;<span class="ident" id="3779869"><a href="/net/http/fs.go.html#3779108">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779882"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3779883">.</span><span class="ident" id="3779884">start</span>&nbsp;<span class="op" id="3779890">=</span>&nbsp;<span class="ident" id="3779892"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3779897">-</span>&nbsp;<span class="ident" id="3779899"><a href="/net/http/fs.go.html#3779736">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779904"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3779905">.</span><span class="ident" id="3779906">length</span>&nbsp;<span class="op" id="3779913">=</span>&nbsp;<span class="ident" id="3779915"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3779920">-</span>&nbsp;<span class="ident" id="3779922"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3779923">.</span><span class="ident" id="3779924">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779932">}</span>&nbsp;<span class="keyword" id="3779934">else</span>&nbsp;<span class="op" id="3779939">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779944">i</span><span class="op" id="3779945">,</span>&nbsp;<span class="ident" id="3779947">err</span>&nbsp;<span class="op" id="3779951">:=</span>&nbsp;<span class="ident" id="3779954"><a href="/net/http/fs.go.html#3765410">strconv</a></span><span class="op" id="3779961">.</span><span class="ident" id="3779962">ParseInt</span><span class="op" id="3779970">(</span><span class="ident" id="3779971"><a href="/net/http/fs.go.html#3779526">start</a></span><span class="op" id="3779976">,</span>&nbsp;<span class="num" id="3779978">10</span><span class="op" id="3779980">,</span>&nbsp;<span class="num" id="3779982">64</span><span class="op" id="3779984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779989">if</span>&nbsp;<span class="ident" id="3779992"><a href="/net/http/fs.go.html#3779947">err</a></span>&nbsp;<span class="op" id="3779996">!=</span>&nbsp;<span class="ident" id="3779999">nil</span>&nbsp;<span class="op" id="3780003">||</span>&nbsp;<span class="ident" id="3780006"><a href="/net/http/fs.go.html#3779944">i</a></span>&nbsp;<span class="op" id="3780008">&gt;</span>&nbsp;<span class="ident" id="3780010"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3780015">||</span>&nbsp;<span class="ident" id="3780018"><a href="/net/http/fs.go.html#3779944">i</a></span>&nbsp;<span class="op" id="3780020">&lt;</span>&nbsp;<span class="num" id="3780022">0</span>&nbsp;<span class="op" id="3780024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780030">return</span>&nbsp;<span class="ident" id="3780037">nil</span><span class="op" id="3780040">,</span>&nbsp;<span class="ident" id="3780042"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3780048">.</span><span class="ident" id="3780049">New</span><span class="op" id="3780052">(</span><span class="string" id="3780053">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3780068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780078"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780079">.</span><span class="ident" id="3780080">start</span>&nbsp;<span class="op" id="3780086">=</span>&nbsp;<span class="ident" id="3780088"><a href="/net/http/fs.go.html#3779944">i</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780093">if</span>&nbsp;<span class="ident" id="3780096"><a href="/net/http/fs.go.html#3779533">end</a></span>&nbsp;<span class="op" id="3780100">==</span>&nbsp;<span class="string" id="3780103">&#34;&#34;</span>&nbsp;<span class="op" id="3780106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3780112">//&nbsp;If&nbsp;no&nbsp;end&nbsp;is&nbsp;specified,&nbsp;range&nbsp;extends&nbsp;to&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780177"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780178">.</span><span class="ident" id="3780179">length</span>&nbsp;<span class="op" id="3780186">=</span>&nbsp;<span class="ident" id="3780188"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3780193">-</span>&nbsp;<span class="ident" id="3780195"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780196">.</span><span class="ident" id="3780197">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780206">}</span>&nbsp;<span class="keyword" id="3780208">else</span>&nbsp;<span class="op" id="3780213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780219">i</span><span class="op" id="3780220">,</span>&nbsp;<span class="ident" id="3780222">err</span>&nbsp;<span class="op" id="3780226">:=</span>&nbsp;<span class="ident" id="3780229"><a href="/net/http/fs.go.html#3765410">strconv</a></span><span class="op" id="3780236">.</span><span class="ident" id="3780237">ParseInt</span><span class="op" id="3780245">(</span><span class="ident" id="3780246"><a href="/net/http/fs.go.html#3779533">end</a></span><span class="op" id="3780249">,</span>&nbsp;<span class="num" id="3780251">10</span><span class="op" id="3780253">,</span>&nbsp;<span class="num" id="3780255">64</span><span class="op" id="3780257">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780263">if</span>&nbsp;<span class="ident" id="3780266"><a href="/net/http/fs.go.html#3780222">err</a></span>&nbsp;<span class="op" id="3780270">!=</span>&nbsp;<span class="ident" id="3780273">nil</span>&nbsp;<span class="op" id="3780277">||</span>&nbsp;<span class="ident" id="3780280"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780281">.</span><span class="ident" id="3780282">start</span>&nbsp;<span class="op" id="3780288">&gt;</span>&nbsp;<span class="ident" id="3780290"><a href="/net/http/fs.go.html#3780219">i</a></span>&nbsp;<span class="op" id="3780292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780299">return</span>&nbsp;<span class="ident" id="3780306">nil</span><span class="op" id="3780309">,</span>&nbsp;<span class="ident" id="3780311"><a href="/net/http/fs.go.html#3765302">errors</a></span><span class="op" id="3780317">.</span><span class="ident" id="3780318">New</span><span class="op" id="3780321">(</span><span class="string" id="3780322">&#34;invalid&nbsp;range&#34;</span><span class="op" id="3780337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780349">if</span>&nbsp;<span class="ident" id="3780352"><a href="/net/http/fs.go.html#3780219">i</a></span>&nbsp;<span class="op" id="3780354">&gt;=</span>&nbsp;<span class="ident" id="3780357"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3780362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780369"><a href="/net/http/fs.go.html#3780219">i</a></span>&nbsp;<span class="op" id="3780371">=</span>&nbsp;<span class="ident" id="3780373"><a href="/net/http/fs.go.html#3779108">size</a></span>&nbsp;<span class="op" id="3780378">-</span>&nbsp;<span class="num" id="3780380">1</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780392"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780393">.</span><span class="ident" id="3780394">length</span>&nbsp;<span class="op" id="3780401">=</span>&nbsp;<span class="ident" id="3780403"><a href="/net/http/fs.go.html#3780219">i</a></span>&nbsp;<span class="op" id="3780405">-</span>&nbsp;<span class="ident" id="3780407"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780408">.</span><span class="ident" id="3780409">start</span>&nbsp;<span class="op" id="3780415">+</span>&nbsp;<span class="num" id="3780417">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780430"><a href="/net/http/fs.go.html#3779301">ranges</a></span>&nbsp;<span class="op" id="3780437">=</span>&nbsp;<span class="builtinfunc" id="3780439">append</span><span class="op" id="3780445">(</span><span class="ident" id="3780446"><a href="/net/http/fs.go.html#3779301">ranges</a></span><span class="op" id="3780452">,</span>&nbsp;<span class="ident" id="3780454"><a href="/net/http/fs.go.html#3779601">r</a></span><span class="op" id="3780455">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780461">return</span>&nbsp;<span class="ident" id="3780468"><a href="/net/http/fs.go.html#3779301">ranges</a></span><span class="op" id="3780474">,</span>&nbsp;<span class="ident" id="3780476">nil</span><br>
<span class="lineno"></span><span class="op" id="3780480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780483">//&nbsp;countingWriter&nbsp;counts&nbsp;how&nbsp;many&nbsp;bytes&nbsp;have&nbsp;been&nbsp;written&nbsp;to&nbsp;it.</span><br>
<span class="lineno">530</span><span class="keyword" id="3780548">type</span>&nbsp;<span class="ident" id="3780553">countingWriter</span>&nbsp;<span class="ident" id="3780568">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780575">func</span>&nbsp;<span class="op" id="3780580">(</span><span class="ident" id="3780581">w</span>&nbsp;<span class="op" id="3780583">*</span><span class="ident" id="3780584"><a href="/net/http/fs.go.html#3780553">countingWriter</a></span><span class="op" id="3780598">)</span>&nbsp;<span class="ident" id="3780600">Write</span><span class="op" id="3780605">(</span><span class="ident" id="3780606">p</span>&nbsp;<span class="op" id="3780608">[</span><span class="op" id="3780609">]</span><span class="builtintype" id="3780610">byte</span><span class="op" id="3780614">)</span>&nbsp;<span class="op" id="3780616">(</span><span class="ident" id="3780617">n</span>&nbsp;<span class="builtintype" id="3780619">int</span><span class="op" id="3780622">,</span>&nbsp;<span class="ident" id="3780624">err</span>&nbsp;<span class="builtintype" id="3780628">error</span><span class="op" id="3780633">)</span>&nbsp;<span class="op" id="3780635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780638">*</span><span class="ident" id="3780639"><a href="/net/http/fs.go.html#3780581">w</a></span>&nbsp;<span class="op" id="3780641">+=</span>&nbsp;<span class="ident" id="3780644"><a href="/net/http/fs.go.html#3780553">countingWriter</a></span><span class="op" id="3780658">(</span><span class="builtinfunc" id="3780659">len</span><span class="op" id="3780662">(</span><span class="ident" id="3780663"><a href="/net/http/fs.go.html#3780606">p</a></span><span class="op" id="3780664">)</span><span class="op" id="3780665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780668">return</span>&nbsp;<span class="builtinfunc" id="3780675">len</span><span class="op" id="3780678">(</span><span class="ident" id="3780679"><a href="/net/http/fs.go.html#3780606">p</a></span><span class="op" id="3780680">)</span><span class="op" id="3780681">,</span>&nbsp;<span class="ident" id="3780683">nil</span><br>
<span class="lineno">535</span><span class="op" id="3780687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780690">//&nbsp;rangesMIMESize&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;it&nbsp;takes&nbsp;to&nbsp;encode&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3780759">//&nbsp;provided&nbsp;ranges&nbsp;as&nbsp;a&nbsp;multipart&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="3780803">func</span>&nbsp;<span class="ident" id="3780808">rangesMIMESize</span><span class="op" id="3780822">(</span><span class="ident" id="3780823">ranges</span>&nbsp;<span class="op" id="3780830">[</span><span class="op" id="3780831">]</span><span class="ident" id="3780832"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><span class="op" id="3780841">,</span>&nbsp;<span class="ident" id="3780843">contentType</span>&nbsp;<span class="builtintype" id="3780855">string</span><span class="op" id="3780861">,</span>&nbsp;<span class="ident" id="3780863">contentSize</span>&nbsp;<span class="ident" id="3780875">int64</span><span class="op" id="3780880">)</span>&nbsp;<span class="op" id="3780882">(</span><span class="ident" id="3780883">encSize</span>&nbsp;<span class="ident" id="3780891">int64</span><span class="op" id="3780896">)</span>&nbsp;<span class="op" id="3780898">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780901">var</span>&nbsp;<span class="ident" id="3780905">w</span>&nbsp;<span class="ident" id="3780907"><a href="/net/http/fs.go.html#3780553">countingWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780923">mw</span>&nbsp;<span class="op" id="3780926">:=</span>&nbsp;<span class="ident" id="3780929"><a href="/net/http/fs.go.html#3765333">multipart</a></span><span class="op" id="3780938">.</span><span class="ident" id="3780939">NewWriter</span><span class="op" id="3780948">(</span><span class="op" id="3780949">&amp;</span><span class="ident" id="3780950"><a href="/net/http/fs.go.html#3780905">w</a></span><span class="op" id="3780951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780954">for</span>&nbsp;<span class="ident" id="3780958">_</span><span class="op" id="3780959">,</span>&nbsp;<span class="ident" id="3780961">ra</span>&nbsp;<span class="op" id="3780964">:=</span>&nbsp;<span class="keyword" id="3780967">range</span>&nbsp;<span class="ident" id="3780973"><a href="/net/http/fs.go.html#3780823">ranges</a></span>&nbsp;<span class="op" id="3780980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780984"><a href="/net/http/fs.go.html#3780923">mw</a></span><span class="op" id="3780986">.</span><span class="ident" id="3780987">CreatePart</span><span class="op" id="3780997">(</span><span class="ident" id="3780998"><a href="/net/http/fs.go.html#3780961">ra</a></span><span class="op" id="3781000">.</span><span class="ident" id="3781001">mimeHeader</span><span class="op" id="3781011">(</span><span class="ident" id="3781012"><a href="/net/http/fs.go.html#3780843">contentType</a></span><span class="op" id="3781023">,</span>&nbsp;<span class="ident" id="3781025"><a href="/net/http/fs.go.html#3780863">contentSize</a></span><span class="op" id="3781036">)</span><span class="op" id="3781037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781041"><a href="/net/http/fs.go.html#3780883">encSize</a></span>&nbsp;<span class="op" id="3781049">+=</span>&nbsp;<span class="ident" id="3781052"><a href="/net/http/fs.go.html#3780961">ra</a></span><span class="op" id="3781054">.</span><span class="ident" id="3781055">length</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781066"><a href="/net/http/fs.go.html#3780923">mw</a></span><span class="op" id="3781068">.</span><span class="ident" id="3781069">Close</span><span class="op" id="3781074">(</span><span class="op" id="3781075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781078"><a href="/net/http/fs.go.html#3780883">encSize</a></span>&nbsp;<span class="op" id="3781086">+=</span>&nbsp;<span class="ident" id="3781089">int64</span><span class="op" id="3781094">(</span><span class="ident" id="3781095"><a href="/net/http/fs.go.html#3780905">w</a></span><span class="op" id="3781096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781099">return</span><br>
<span class="lineno"></span><span class="op" id="3781106">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="3781109">func</span>&nbsp;<span class="ident" id="3781114">sumRangesSize</span><span class="op" id="3781127">(</span><span class="ident" id="3781128">ranges</span>&nbsp;<span class="op" id="3781135">[</span><span class="op" id="3781136">]</span><span class="ident" id="3781137"><a href="/net/http/fs.go.html#3778652">httpRange</a></span><span class="op" id="3781146">)</span>&nbsp;<span class="op" id="3781148">(</span><span class="ident" id="3781149">size</span>&nbsp;<span class="ident" id="3781154">int64</span><span class="op" id="3781159">)</span>&nbsp;<span class="op" id="3781161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781164">for</span>&nbsp;<span class="ident" id="3781168">_</span><span class="op" id="3781169">,</span>&nbsp;<span class="ident" id="3781171">ra</span>&nbsp;<span class="op" id="3781174">:=</span>&nbsp;<span class="keyword" id="3781177">range</span>&nbsp;<span class="ident" id="3781183"><a href="/net/http/fs.go.html#3781128">ranges</a></span>&nbsp;<span class="op" id="3781190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781194"><a href="/net/http/fs.go.html#3781149">size</a></span>&nbsp;<span class="op" id="3781199">+=</span>&nbsp;<span class="ident" id="3781202"><a href="/net/http/fs.go.html#3781171">ra</a></span><span class="op" id="3781204">.</span><span class="ident" id="3781205">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781213">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781216">return</span><br>
<span class="lineno"></span><span class="op" id="3781223">}</span>
</div>
</body>
</html>
