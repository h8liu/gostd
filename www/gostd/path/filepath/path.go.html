<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3218993">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3219048">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3219102">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3219153">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3219233">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3219309">package</span>&nbsp;<span class="ident" id="3219317">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3219327">import</span>&nbsp;<span class="op" id="3219334">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3219337">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3219347">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3219353">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3219361">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3219371">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3219374">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3219424">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3219482">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3219548">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3219605">type</span>&nbsp;<span class="ident" id="3219610">lazybuf</span>&nbsp;<span class="keyword" id="3219618">struct</span>&nbsp;<span class="op" id="3219625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219628">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3219639">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219647">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3219658">[</span><span class="op" id="3219659">]</span><span class="builtintype" id="3219660">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219666">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3219677">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219682">volAndPath</span>&nbsp;<span class="builtintype" id="3219693">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219701">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3219712">int</span><br>
<span class="lineno"></span><span class="op" id="3219716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3219719">func</span>&nbsp;<span class="op" id="3219724">(</span><span class="ident" id="3219725">b</span>&nbsp;<span class="op" id="3219727">*</span><span class="ident" id="3219728">lazybuf</span><span class="op" id="3219735">)</span>&nbsp;<span class="ident" id="3219737">index</span><span class="op" id="3219742">(</span><span class="ident" id="3219743">i</span>&nbsp;<span class="builtintype" id="3219745">int</span><span class="op" id="3219748">)</span>&nbsp;<span class="builtintype" id="3219750">byte</span>&nbsp;<span class="op" id="3219755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219758">if</span>&nbsp;<span class="ident" id="3219761">b</span><span class="op" id="3219762">.</span><span class="ident" id="3219763">buf</span>&nbsp;<span class="op" id="3219767">!=</span>&nbsp;<span class="ident" id="3219770">nil</span>&nbsp;<span class="op" id="3219774">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219778">return</span>&nbsp;<span class="ident" id="3219785">b</span><span class="op" id="3219786">.</span><span class="ident" id="3219787">buf</span><span class="op" id="3219790">[</span><span class="ident" id="3219791">i</span><span class="op" id="3219792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219798">return</span>&nbsp;<span class="ident" id="3219805">b</span><span class="op" id="3219806">.</span><span class="ident" id="3219807">path</span><span class="op" id="3219811">[</span><span class="ident" id="3219812">i</span><span class="op" id="3219813">]</span><br>
<span class="lineno"></span><span class="op" id="3219815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3219818">func</span>&nbsp;<span class="op" id="3219823">(</span><span class="ident" id="3219824">b</span>&nbsp;<span class="op" id="3219826">*</span><span class="ident" id="3219827">lazybuf</span><span class="op" id="3219834">)</span>&nbsp;<span class="builtinfunc" id="3219836">append</span><span class="op" id="3219842">(</span><span class="ident" id="3219843">c</span>&nbsp;<span class="builtintype" id="3219845">byte</span><span class="op" id="3219849">)</span>&nbsp;<span class="op" id="3219851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219854">if</span>&nbsp;<span class="ident" id="3219857">b</span><span class="op" id="3219858">.</span><span class="ident" id="3219859">buf</span>&nbsp;<span class="op" id="3219863">==</span>&nbsp;<span class="ident" id="3219866">nil</span>&nbsp;<span class="op" id="3219870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219874">if</span>&nbsp;<span class="ident" id="3219877">b</span><span class="op" id="3219878">.</span><span class="ident" id="3219879">w</span>&nbsp;<span class="op" id="3219881">&lt;</span>&nbsp;<span class="builtinfunc" id="3219883">len</span><span class="op" id="3219886">(</span><span class="ident" id="3219887">b</span><span class="op" id="3219888">.</span><span class="ident" id="3219889">path</span><span class="op" id="3219893">)</span>&nbsp;<span class="op" id="3219895">&amp;&amp;</span>&nbsp;<span class="ident" id="3219898">b</span><span class="op" id="3219899">.</span><span class="ident" id="3219900">path</span><span class="op" id="3219904">[</span><span class="ident" id="3219905">b</span><span class="op" id="3219906">.</span><span class="ident" id="3219907">w</span><span class="op" id="3219908">]</span>&nbsp;<span class="op" id="3219910">==</span>&nbsp;<span class="ident" id="3219913">c</span>&nbsp;<span class="op" id="3219915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219920">b</span><span class="op" id="3219921">.</span><span class="ident" id="3219922">w</span><span class="op" id="3219923">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219929">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219942">b</span><span class="op" id="3219943">.</span><span class="ident" id="3219944">buf</span>&nbsp;<span class="op" id="3219948">=</span>&nbsp;<span class="builtinfunc" id="3219950">make</span><span class="op" id="3219954">(</span><span class="op" id="3219955">[</span><span class="op" id="3219956">]</span><span class="builtintype" id="3219957">byte</span><span class="op" id="3219961">,</span>&nbsp;<span class="builtinfunc" id="3219963">len</span><span class="op" id="3219966">(</span><span class="ident" id="3219967">b</span><span class="op" id="3219968">.</span><span class="ident" id="3219969">path</span><span class="op" id="3219973">)</span><span class="op" id="3219974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3219978">copy</span><span class="op" id="3219982">(</span><span class="ident" id="3219983">b</span><span class="op" id="3219984">.</span><span class="ident" id="3219985">buf</span><span class="op" id="3219988">,</span>&nbsp;<span class="ident" id="3219990">b</span><span class="op" id="3219991">.</span><span class="ident" id="3219992">path</span><span class="op" id="3219996">[</span><span class="op" id="3219997">:</span><span class="ident" id="3219998">b</span><span class="op" id="3219999">.</span><span class="ident" id="3220000">w</span><span class="op" id="3220001">]</span><span class="op" id="3220002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220008">b</span><span class="op" id="3220009">.</span><span class="ident" id="3220010">buf</span><span class="op" id="3220013">[</span><span class="ident" id="3220014">b</span><span class="op" id="3220015">.</span><span class="ident" id="3220016">w</span><span class="op" id="3220017">]</span>&nbsp;<span class="op" id="3220019">=</span>&nbsp;<span class="ident" id="3220021">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220024">b</span><span class="op" id="3220025">.</span><span class="ident" id="3220026">w</span><span class="op" id="3220027">++</span><br>
<span class="lineno"></span><span class="op" id="3220030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3220033">func</span>&nbsp;<span class="op" id="3220038">(</span><span class="ident" id="3220039">b</span>&nbsp;<span class="op" id="3220041">*</span><span class="ident" id="3220042">lazybuf</span><span class="op" id="3220049">)</span>&nbsp;<span class="builtintype" id="3220051">string</span><span class="op" id="3220057">(</span><span class="op" id="3220058">)</span>&nbsp;<span class="builtintype" id="3220060">string</span>&nbsp;<span class="op" id="3220067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220070">if</span>&nbsp;<span class="ident" id="3220073">b</span><span class="op" id="3220074">.</span><span class="ident" id="3220075">buf</span>&nbsp;<span class="op" id="3220079">==</span>&nbsp;<span class="ident" id="3220082">nil</span>&nbsp;<span class="op" id="3220086">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220090">return</span>&nbsp;<span class="ident" id="3220097">b</span><span class="op" id="3220098">.</span><span class="ident" id="3220099">volAndPath</span><span class="op" id="3220109">[</span><span class="op" id="3220110">:</span><span class="ident" id="3220111">b</span><span class="op" id="3220112">.</span><span class="ident" id="3220113">volLen</span><span class="op" id="3220119">+</span><span class="ident" id="3220120">b</span><span class="op" id="3220121">.</span><span class="ident" id="3220122">w</span><span class="op" id="3220123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220129">return</span>&nbsp;<span class="ident" id="3220136">b</span><span class="op" id="3220137">.</span><span class="ident" id="3220138">volAndPath</span><span class="op" id="3220148">[</span><span class="op" id="3220149">:</span><span class="ident" id="3220150">b</span><span class="op" id="3220151">.</span><span class="ident" id="3220152">volLen</span><span class="op" id="3220158">]</span>&nbsp;<span class="op" id="3220160">+</span>&nbsp;<span class="builtintype" id="3220162">string</span><span class="op" id="3220168">(</span><span class="ident" id="3220169">b</span><span class="op" id="3220170">.</span><span class="ident" id="3220171">buf</span><span class="op" id="3220174">[</span><span class="op" id="3220175">:</span><span class="ident" id="3220176">b</span><span class="op" id="3220177">.</span><span class="ident" id="3220178">w</span><span class="op" id="3220179">]</span><span class="op" id="3220180">)</span><br>
<span class="lineno"></span><span class="op" id="3220182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3220185">const</span>&nbsp;<span class="op" id="3220191">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220194">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3220208">=</span>&nbsp;<span class="ident" id="3220210">os</span><span class="op" id="3220212">.</span><span class="ident" id="3220213">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220228">ListSeparator</span>&nbsp;<span class="op" id="3220242">=</span>&nbsp;<span class="ident" id="3220244">os</span><span class="op" id="3220246">.</span><span class="ident" id="3220247">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3220265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3220268">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3220327">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3220392">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3220448">//</span><br>
<span class="lineno"></span><span class="comment" id="3220451">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3220512">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3220578">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3220649">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3220703">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3220757">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3220821">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3220854">//</span><br>
<span class="lineno"></span><span class="comment" id="3220857">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3220934">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3220978">//</span><br>
<span class="lineno">75</span><span class="comment" id="3220981">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3221040">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3221067">//</span><br>
<span class="lineno"></span><span class="comment" id="3221070">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3221126">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3221154">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3221206">func</span>&nbsp;<span class="ident" id="3221211">Clean</span><span class="op" id="3221216">(</span><span class="ident" id="3221217">path</span>&nbsp;<span class="builtintype" id="3221222">string</span><span class="op" id="3221228">)</span>&nbsp;<span class="builtintype" id="3221230">string</span>&nbsp;<span class="op" id="3221237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221240">originalPath</span>&nbsp;<span class="op" id="3221253">:=</span>&nbsp;<span class="ident" id="3221256">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221262">volLen</span>&nbsp;<span class="op" id="3221269">:=</span>&nbsp;<span class="ident" id="3221272">volumeNameLen</span><span class="op" id="3221285">(</span><span class="ident" id="3221286">path</span><span class="op" id="3221290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221293">path</span>&nbsp;<span class="op" id="3221298">=</span>&nbsp;<span class="ident" id="3221300">path</span><span class="op" id="3221304">[</span><span class="ident" id="3221305">volLen</span><span class="op" id="3221311">:</span><span class="op" id="3221312">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221315">if</span>&nbsp;<span class="ident" id="3221318">path</span>&nbsp;<span class="op" id="3221323">==</span>&nbsp;<span class="string" id="3221326">&#34;&#34;</span>&nbsp;<span class="op" id="3221329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221333">if</span>&nbsp;<span class="ident" id="3221336">volLen</span>&nbsp;<span class="op" id="3221343">&gt;</span>&nbsp;<span class="num" id="3221345">1</span>&nbsp;<span class="op" id="3221347">&amp;&amp;</span>&nbsp;<span class="ident" id="3221350">originalPath</span><span class="op" id="3221362">[</span><span class="num" id="3221363">1</span><span class="op" id="3221364">]</span>&nbsp;<span class="op" id="3221366">!=</span>&nbsp;<span class="string" id="3221369">&#39;:&#39;</span>&nbsp;<span class="op" id="3221373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221378">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221398">return</span>&nbsp;<span class="ident" id="3221405">FromSlash</span><span class="op" id="3221414">(</span><span class="ident" id="3221415">originalPath</span><span class="op" id="3221427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221431">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221435">return</span>&nbsp;<span class="ident" id="3221442">originalPath</span>&nbsp;<span class="op" id="3221455">+</span>&nbsp;<span class="string" id="3221457">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221465">rooted</span>&nbsp;<span class="op" id="3221472">:=</span>&nbsp;<span class="ident" id="3221475">os</span><span class="op" id="3221477">.</span><span class="ident" id="3221478">IsPathSeparator</span><span class="op" id="3221493">(</span><span class="ident" id="3221494">path</span><span class="op" id="3221498">[</span><span class="num" id="3221499">0</span><span class="op" id="3221500">]</span><span class="op" id="3221501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221505">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221521">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221580">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221634">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221696">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221761">n</span>&nbsp;<span class="op" id="3221763">:=</span>&nbsp;<span class="builtinfunc" id="3221766">len</span><span class="op" id="3221769">(</span><span class="ident" id="3221770">path</span><span class="op" id="3221774">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221777">out</span>&nbsp;<span class="op" id="3221781">:=</span>&nbsp;<span class="ident" id="3221784">lazybuf</span><span class="op" id="3221791">{</span><span class="ident" id="3221792">path</span><span class="op" id="3221796">:</span>&nbsp;<span class="ident" id="3221798">path</span><span class="op" id="3221802">,</span>&nbsp;<span class="ident" id="3221804">volAndPath</span><span class="op" id="3221814">:</span>&nbsp;<span class="ident" id="3221816">originalPath</span><span class="op" id="3221828">,</span>&nbsp;<span class="ident" id="3221830">volLen</span><span class="op" id="3221836">:</span>&nbsp;<span class="ident" id="3221838">volLen</span><span class="op" id="3221844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221847">r</span><span class="op" id="3221848">,</span>&nbsp;<span class="ident" id="3221850">dotdot</span>&nbsp;<span class="op" id="3221857">:=</span>&nbsp;<span class="num" id="3221860">0</span><span class="op" id="3221861">,</span>&nbsp;<span class="num" id="3221863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221866">if</span>&nbsp;<span class="ident" id="3221869">rooted</span>&nbsp;<span class="op" id="3221876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221880">out</span><span class="op" id="3221883">.</span><span class="builtinfunc" id="3221884">append</span><span class="op" id="3221890">(</span><span class="ident" id="3221891">Separator</span><span class="op" id="3221900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221904">r</span><span class="op" id="3221905">,</span>&nbsp;<span class="ident" id="3221907">dotdot</span>&nbsp;<span class="op" id="3221914">=</span>&nbsp;<span class="num" id="3221916">1</span><span class="op" id="3221917">,</span>&nbsp;<span class="num" id="3221919">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221926">for</span>&nbsp;<span class="ident" id="3221930">r</span>&nbsp;<span class="op" id="3221932">&lt;</span>&nbsp;<span class="ident" id="3221934">n</span>&nbsp;<span class="op" id="3221936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221940">switch</span>&nbsp;<span class="op" id="3221947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221951">case</span>&nbsp;<span class="ident" id="3221956">os</span><span class="op" id="3221958">.</span><span class="ident" id="3221959">IsPathSeparator</span><span class="op" id="3221974">(</span><span class="ident" id="3221975">path</span><span class="op" id="3221979">[</span><span class="ident" id="3221980">r</span><span class="op" id="3221981">]</span><span class="op" id="3221982">)</span><span class="op" id="3221983">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221988">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222013">r</span><span class="op" id="3222014">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222019">case</span>&nbsp;<span class="ident" id="3222024">path</span><span class="op" id="3222028">[</span><span class="ident" id="3222029">r</span><span class="op" id="3222030">]</span>&nbsp;<span class="op" id="3222032">==</span>&nbsp;<span class="string" id="3222035">&#39;.&#39;</span>&nbsp;<span class="op" id="3222039">&amp;&amp;</span>&nbsp;<span class="op" id="3222042">(</span><span class="ident" id="3222043">r</span><span class="op" id="3222044">+</span><span class="num" id="3222045">1</span>&nbsp;<span class="op" id="3222047">==</span>&nbsp;<span class="ident" id="3222050">n</span>&nbsp;<span class="op" id="3222052">||</span>&nbsp;<span class="ident" id="3222055">os</span><span class="op" id="3222057">.</span><span class="ident" id="3222058">IsPathSeparator</span><span class="op" id="3222073">(</span><span class="ident" id="3222074">path</span><span class="op" id="3222078">[</span><span class="ident" id="3222079">r</span><span class="op" id="3222080">+</span><span class="num" id="3222081">1</span><span class="op" id="3222082">]</span><span class="op" id="3222083">)</span><span class="op" id="3222084">)</span><span class="op" id="3222085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222090">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222106">r</span><span class="op" id="3222107">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222112">case</span>&nbsp;<span class="ident" id="3222117">path</span><span class="op" id="3222121">[</span><span class="ident" id="3222122">r</span><span class="op" id="3222123">]</span>&nbsp;<span class="op" id="3222125">==</span>&nbsp;<span class="string" id="3222128">&#39;.&#39;</span>&nbsp;<span class="op" id="3222132">&amp;&amp;</span>&nbsp;<span class="ident" id="3222135">path</span><span class="op" id="3222139">[</span><span class="ident" id="3222140">r</span><span class="op" id="3222141">+</span><span class="num" id="3222142">1</span><span class="op" id="3222143">]</span>&nbsp;<span class="op" id="3222145">==</span>&nbsp;<span class="string" id="3222148">&#39;.&#39;</span>&nbsp;<span class="op" id="3222152">&amp;&amp;</span>&nbsp;<span class="op" id="3222155">(</span><span class="ident" id="3222156">r</span><span class="op" id="3222157">+</span><span class="num" id="3222158">2</span>&nbsp;<span class="op" id="3222160">==</span>&nbsp;<span class="ident" id="3222163">n</span>&nbsp;<span class="op" id="3222165">||</span>&nbsp;<span class="ident" id="3222168">os</span><span class="op" id="3222170">.</span><span class="ident" id="3222171">IsPathSeparator</span><span class="op" id="3222186">(</span><span class="ident" id="3222187">path</span><span class="op" id="3222191">[</span><span class="ident" id="3222192">r</span><span class="op" id="3222193">+</span><span class="num" id="3222194">2</span><span class="op" id="3222195">]</span><span class="op" id="3222196">)</span><span class="op" id="3222197">)</span><span class="op" id="3222198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222203">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222246">r</span>&nbsp;<span class="op" id="3222248">+=</span>&nbsp;<span class="num" id="3222251">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222256">switch</span>&nbsp;<span class="op" id="3222263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222268">case</span>&nbsp;<span class="ident" id="3222273">out</span><span class="op" id="3222276">.</span><span class="ident" id="3222277">w</span>&nbsp;<span class="op" id="3222279">&gt;</span>&nbsp;<span class="ident" id="3222281">dotdot</span><span class="op" id="3222287">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222293">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222314">out</span><span class="op" id="3222317">.</span><span class="ident" id="3222318">w</span><span class="op" id="3222319">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222326">for</span>&nbsp;<span class="ident" id="3222330">out</span><span class="op" id="3222333">.</span><span class="ident" id="3222334">w</span>&nbsp;<span class="op" id="3222336">&gt;</span>&nbsp;<span class="ident" id="3222338">dotdot</span>&nbsp;<span class="op" id="3222345">&amp;&amp;</span>&nbsp;<span class="op" id="3222348">!</span><span class="ident" id="3222349">os</span><span class="op" id="3222351">.</span><span class="ident" id="3222352">IsPathSeparator</span><span class="op" id="3222367">(</span><span class="ident" id="3222368">out</span><span class="op" id="3222371">.</span><span class="ident" id="3222372">index</span><span class="op" id="3222377">(</span><span class="ident" id="3222378">out</span><span class="op" id="3222381">.</span><span class="ident" id="3222382">w</span><span class="op" id="3222383">)</span><span class="op" id="3222384">)</span>&nbsp;<span class="op" id="3222386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222393">out</span><span class="op" id="3222396">.</span><span class="ident" id="3222397">w</span><span class="op" id="3222398">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222405">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222410">case</span>&nbsp;<span class="op" id="3222415">!</span><span class="ident" id="3222416">rooted</span><span class="op" id="3222422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222428">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222491">if</span>&nbsp;<span class="ident" id="3222494">out</span><span class="op" id="3222497">.</span><span class="ident" id="3222498">w</span>&nbsp;<span class="op" id="3222500">&gt;</span>&nbsp;<span class="num" id="3222502">0</span>&nbsp;<span class="op" id="3222504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222511">out</span><span class="op" id="3222514">.</span><span class="builtinfunc" id="3222515">append</span><span class="op" id="3222521">(</span><span class="ident" id="3222522">Separator</span><span class="op" id="3222531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222537">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222543">out</span><span class="op" id="3222546">.</span><span class="builtinfunc" id="3222547">append</span><span class="op" id="3222553">(</span><span class="string" id="3222554">&#39;.&#39;</span><span class="op" id="3222557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222563">out</span><span class="op" id="3222566">.</span><span class="builtinfunc" id="3222567">append</span><span class="op" id="3222573">(</span><span class="string" id="3222574">&#39;.&#39;</span><span class="op" id="3222577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222583">dotdot</span>&nbsp;<span class="op" id="3222590">=</span>&nbsp;<span class="ident" id="3222592">out</span><span class="op" id="3222595">.</span><span class="ident" id="3222596">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222605">default</span><span class="op" id="3222612">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222617">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222642">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222668">if</span>&nbsp;<span class="ident" id="3222671">rooted</span>&nbsp;<span class="op" id="3222678">&amp;&amp;</span>&nbsp;<span class="ident" id="3222681">out</span><span class="op" id="3222684">.</span><span class="ident" id="3222685">w</span>&nbsp;<span class="op" id="3222687">!=</span>&nbsp;<span class="num" id="3222690">1</span>&nbsp;<span class="op" id="3222692">||</span>&nbsp;<span class="op" id="3222695">!</span><span class="ident" id="3222696">rooted</span>&nbsp;<span class="op" id="3222703">&amp;&amp;</span>&nbsp;<span class="ident" id="3222706">out</span><span class="op" id="3222709">.</span><span class="ident" id="3222710">w</span>&nbsp;<span class="op" id="3222712">!=</span>&nbsp;<span class="num" id="3222715">0</span>&nbsp;<span class="op" id="3222717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222723">out</span><span class="op" id="3222726">.</span><span class="builtinfunc" id="3222727">append</span><span class="op" id="3222733">(</span><span class="ident" id="3222734">Separator</span><span class="op" id="3222743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222748">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222753">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222772">for</span>&nbsp;<span class="op" id="3222776">;</span>&nbsp;<span class="ident" id="3222778">r</span>&nbsp;<span class="op" id="3222780">&lt;</span>&nbsp;<span class="ident" id="3222782">n</span>&nbsp;<span class="op" id="3222784">&amp;&amp;</span>&nbsp;<span class="op" id="3222787">!</span><span class="ident" id="3222788">os</span><span class="op" id="3222790">.</span><span class="ident" id="3222791">IsPathSeparator</span><span class="op" id="3222806">(</span><span class="ident" id="3222807">path</span><span class="op" id="3222811">[</span><span class="ident" id="3222812">r</span><span class="op" id="3222813">]</span><span class="op" id="3222814">)</span><span class="op" id="3222815">;</span>&nbsp;<span class="ident" id="3222817">r</span><span class="op" id="3222818">++</span>&nbsp;<span class="op" id="3222821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222827">out</span><span class="op" id="3222830">.</span><span class="builtinfunc" id="3222831">append</span><span class="op" id="3222837">(</span><span class="ident" id="3222838">path</span><span class="op" id="3222842">[</span><span class="ident" id="3222843">r</span><span class="op" id="3222844">]</span><span class="op" id="3222845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222854">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222861">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222892">if</span>&nbsp;<span class="ident" id="3222895">out</span><span class="op" id="3222898">.</span><span class="ident" id="3222899">w</span>&nbsp;<span class="op" id="3222901">==</span>&nbsp;<span class="num" id="3222904">0</span>&nbsp;<span class="op" id="3222906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222910">out</span><span class="op" id="3222913">.</span><span class="builtinfunc" id="3222914">append</span><span class="op" id="3222920">(</span><span class="string" id="3222921">&#39;.&#39;</span><span class="op" id="3222924">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222931">return</span>&nbsp;<span class="ident" id="3222938">FromSlash</span><span class="op" id="3222947">(</span><span class="ident" id="3222948">out</span><span class="op" id="3222951">.</span><span class="builtintype" id="3222952">string</span><span class="op" id="3222958">(</span><span class="op" id="3222959">)</span><span class="op" id="3222960">)</span><br>
<span class="lineno"></span><span class="op" id="3222962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3222965">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3223033">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3223098">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3223131">func</span>&nbsp;<span class="ident" id="3223136">ToSlash</span><span class="op" id="3223143">(</span><span class="ident" id="3223144">path</span>&nbsp;<span class="builtintype" id="3223149">string</span><span class="op" id="3223155">)</span>&nbsp;<span class="builtintype" id="3223157">string</span>&nbsp;<span class="op" id="3223164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223167">if</span>&nbsp;<span class="ident" id="3223170">Separator</span>&nbsp;<span class="op" id="3223180">==</span>&nbsp;<span class="string" id="3223183">&#39;/&#39;</span>&nbsp;<span class="op" id="3223187">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223191">return</span>&nbsp;<span class="ident" id="3223198">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223207">return</span>&nbsp;<span class="ident" id="3223214">strings</span><span class="op" id="3223221">.</span><span class="ident" id="3223222">Replace</span><span class="op" id="3223229">(</span><span class="ident" id="3223230">path</span><span class="op" id="3223234">,</span>&nbsp;<span class="builtintype" id="3223236">string</span><span class="op" id="3223242">(</span><span class="ident" id="3223243">Separator</span><span class="op" id="3223252">)</span><span class="op" id="3223253">,</span>&nbsp;<span class="string" id="3223255">&#34;/&#34;</span><span class="op" id="3223258">,</span>&nbsp;<span class="op" id="3223260">-</span><span class="num" id="3223261">1</span><span class="op" id="3223262">)</span><br>
<span class="lineno"></span><span class="op" id="3223264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3223267">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3223339">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3223408">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3223435">func</span>&nbsp;<span class="ident" id="3223440">FromSlash</span><span class="op" id="3223449">(</span><span class="ident" id="3223450">path</span>&nbsp;<span class="builtintype" id="3223455">string</span><span class="op" id="3223461">)</span>&nbsp;<span class="builtintype" id="3223463">string</span>&nbsp;<span class="op" id="3223470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223473">if</span>&nbsp;<span class="ident" id="3223476">Separator</span>&nbsp;<span class="op" id="3223486">==</span>&nbsp;<span class="string" id="3223489">&#39;/&#39;</span>&nbsp;<span class="op" id="3223493">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223497">return</span>&nbsp;<span class="ident" id="3223504">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223513">return</span>&nbsp;<span class="ident" id="3223520">strings</span><span class="op" id="3223527">.</span><span class="ident" id="3223528">Replace</span><span class="op" id="3223535">(</span><span class="ident" id="3223536">path</span><span class="op" id="3223540">,</span>&nbsp;<span class="string" id="3223542">&#34;/&#34;</span><span class="op" id="3223545">,</span>&nbsp;<span class="builtintype" id="3223547">string</span><span class="op" id="3223553">(</span><span class="ident" id="3223554">Separator</span><span class="op" id="3223563">)</span><span class="op" id="3223564">,</span>&nbsp;<span class="op" id="3223566">-</span><span class="num" id="3223567">1</span><span class="op" id="3223568">)</span><br>
<span class="lineno"></span><span class="op" id="3223570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3223573">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3223650">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3223708">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3223795">func</span>&nbsp;<span class="ident" id="3223800">SplitList</span><span class="op" id="3223809">(</span><span class="ident" id="3223810">path</span>&nbsp;<span class="builtintype" id="3223815">string</span><span class="op" id="3223821">)</span>&nbsp;<span class="op" id="3223823">[</span><span class="op" id="3223824">]</span><span class="builtintype" id="3223825">string</span>&nbsp;<span class="op" id="3223832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223835">return</span>&nbsp;<span class="ident" id="3223842">splitList</span><span class="op" id="3223851">(</span><span class="ident" id="3223852">path</span><span class="op" id="3223856">)</span><br>
<span class="lineno">180</span><span class="op" id="3223858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3223861">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3223925">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3223984">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3224048">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3224073">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3224136">func</span>&nbsp;<span class="ident" id="3224141">Split</span><span class="op" id="3224146">(</span><span class="ident" id="3224147">path</span>&nbsp;<span class="builtintype" id="3224152">string</span><span class="op" id="3224158">)</span>&nbsp;<span class="op" id="3224160">(</span><span class="ident" id="3224161">dir</span><span class="op" id="3224164">,</span>&nbsp;<span class="ident" id="3224166">file</span>&nbsp;<span class="builtintype" id="3224171">string</span><span class="op" id="3224177">)</span>&nbsp;<span class="op" id="3224179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224182">vol</span>&nbsp;<span class="op" id="3224186">:=</span>&nbsp;<span class="ident" id="3224189">VolumeName</span><span class="op" id="3224199">(</span><span class="ident" id="3224200">path</span><span class="op" id="3224204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224207">i</span>&nbsp;<span class="op" id="3224209">:=</span>&nbsp;<span class="builtinfunc" id="3224212">len</span><span class="op" id="3224215">(</span><span class="ident" id="3224216">path</span><span class="op" id="3224220">)</span>&nbsp;<span class="op" id="3224222">-</span>&nbsp;<span class="num" id="3224224">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224227">for</span>&nbsp;<span class="ident" id="3224231">i</span>&nbsp;<span class="op" id="3224233">&gt;=</span>&nbsp;<span class="builtinfunc" id="3224236">len</span><span class="op" id="3224239">(</span><span class="ident" id="3224240">vol</span><span class="op" id="3224243">)</span>&nbsp;<span class="op" id="3224245">&amp;&amp;</span>&nbsp;<span class="op" id="3224248">!</span><span class="ident" id="3224249">os</span><span class="op" id="3224251">.</span><span class="ident" id="3224252">IsPathSeparator</span><span class="op" id="3224267">(</span><span class="ident" id="3224268">path</span><span class="op" id="3224272">[</span><span class="ident" id="3224273">i</span><span class="op" id="3224274">]</span><span class="op" id="3224275">)</span>&nbsp;<span class="op" id="3224277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224281">i</span><span class="op" id="3224282">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224289">return</span>&nbsp;<span class="ident" id="3224296">path</span><span class="op" id="3224300">[</span><span class="op" id="3224301">:</span><span class="ident" id="3224302">i</span><span class="op" id="3224303">+</span><span class="num" id="3224304">1</span><span class="op" id="3224305">]</span><span class="op" id="3224306">,</span>&nbsp;<span class="ident" id="3224308">path</span><span class="op" id="3224312">[</span><span class="ident" id="3224313">i</span><span class="op" id="3224314">+</span><span class="num" id="3224315">1</span><span class="op" id="3224316">:</span><span class="op" id="3224317">]</span><br>
<span class="lineno"></span><span class="op" id="3224319">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3224322">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3224391">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3224457">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3224491">func</span>&nbsp;<span class="ident" id="3224496">Join</span><span class="op" id="3224500">(</span><span class="ident" id="3224501">elem</span>&nbsp;<span class="op" id="3224506">...</span><span class="builtintype" id="3224509">string</span><span class="op" id="3224515">)</span>&nbsp;<span class="builtintype" id="3224517">string</span>&nbsp;<span class="op" id="3224524">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224527">for</span>&nbsp;<span class="ident" id="3224531">i</span><span class="op" id="3224532">,</span>&nbsp;<span class="ident" id="3224534">e</span>&nbsp;<span class="op" id="3224536">:=</span>&nbsp;<span class="keyword" id="3224539">range</span>&nbsp;<span class="ident" id="3224545">elem</span>&nbsp;<span class="op" id="3224550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224554">if</span>&nbsp;<span class="ident" id="3224557">e</span>&nbsp;<span class="op" id="3224559">!=</span>&nbsp;<span class="string" id="3224562">&#34;&#34;</span>&nbsp;<span class="op" id="3224565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224570">return</span>&nbsp;<span class="ident" id="3224577">Clean</span><span class="op" id="3224582">(</span><span class="ident" id="3224583">strings</span><span class="op" id="3224590">.</span><span class="ident" id="3224591">Join</span><span class="op" id="3224595">(</span><span class="ident" id="3224596">elem</span><span class="op" id="3224600">[</span><span class="ident" id="3224601">i</span><span class="op" id="3224602">:</span><span class="op" id="3224603">]</span><span class="op" id="3224604">,</span>&nbsp;<span class="builtintype" id="3224606">string</span><span class="op" id="3224612">(</span><span class="ident" id="3224613">Separator</span><span class="op" id="3224622">)</span><span class="op" id="3224623">)</span><span class="op" id="3224624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224631">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224634">return</span>&nbsp;<span class="string" id="3224641">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3224644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3224647">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3224700">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3224758">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3224815">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3224826">func</span>&nbsp;<span class="ident" id="3224831">Ext</span><span class="op" id="3224834">(</span><span class="ident" id="3224835">path</span>&nbsp;<span class="builtintype" id="3224840">string</span><span class="op" id="3224846">)</span>&nbsp;<span class="builtintype" id="3224848">string</span>&nbsp;<span class="op" id="3224855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224858">for</span>&nbsp;<span class="ident" id="3224862">i</span>&nbsp;<span class="op" id="3224864">:=</span>&nbsp;<span class="builtinfunc" id="3224867">len</span><span class="op" id="3224870">(</span><span class="ident" id="3224871">path</span><span class="op" id="3224875">)</span>&nbsp;<span class="op" id="3224877">-</span>&nbsp;<span class="num" id="3224879">1</span><span class="op" id="3224880">;</span>&nbsp;<span class="ident" id="3224882">i</span>&nbsp;<span class="op" id="3224884">&gt;=</span>&nbsp;<span class="num" id="3224887">0</span>&nbsp;<span class="op" id="3224889">&amp;&amp;</span>&nbsp;<span class="op" id="3224892">!</span><span class="ident" id="3224893">os</span><span class="op" id="3224895">.</span><span class="ident" id="3224896">IsPathSeparator</span><span class="op" id="3224911">(</span><span class="ident" id="3224912">path</span><span class="op" id="3224916">[</span><span class="ident" id="3224917">i</span><span class="op" id="3224918">]</span><span class="op" id="3224919">)</span><span class="op" id="3224920">;</span>&nbsp;<span class="ident" id="3224922">i</span><span class="op" id="3224923">--</span>&nbsp;<span class="op" id="3224926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224930">if</span>&nbsp;<span class="ident" id="3224933">path</span><span class="op" id="3224937">[</span><span class="ident" id="3224938">i</span><span class="op" id="3224939">]</span>&nbsp;<span class="op" id="3224941">==</span>&nbsp;<span class="string" id="3224944">&#39;.&#39;</span>&nbsp;<span class="op" id="3224948">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224953">return</span>&nbsp;<span class="ident" id="3224960">path</span><span class="op" id="3224964">[</span><span class="ident" id="3224965">i</span><span class="op" id="3224966">:</span><span class="op" id="3224967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224977">return</span>&nbsp;<span class="string" id="3224984">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3224987">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3224990">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3225065">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3225075">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3225152">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3225214">func</span>&nbsp;<span class="ident" id="3225219">EvalSymlinks</span><span class="op" id="3225231">(</span><span class="ident" id="3225232">path</span>&nbsp;<span class="builtintype" id="3225237">string</span><span class="op" id="3225243">)</span>&nbsp;<span class="op" id="3225245">(</span><span class="builtintype" id="3225246">string</span><span class="op" id="3225252">,</span>&nbsp;<span class="builtintype" id="3225254">error</span><span class="op" id="3225259">)</span>&nbsp;<span class="op" id="3225261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225264">return</span>&nbsp;<span class="ident" id="3225271">evalSymlinks</span><span class="op" id="3225283">(</span><span class="ident" id="3225284">path</span><span class="op" id="3225288">)</span><br>
<span class="lineno"></span><span class="op" id="3225290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3225293">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3225344">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3225410">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3225479">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3225541">func</span>&nbsp;<span class="ident" id="3225546">Abs</span><span class="op" id="3225549">(</span><span class="ident" id="3225550">path</span>&nbsp;<span class="builtintype" id="3225555">string</span><span class="op" id="3225561">)</span>&nbsp;<span class="op" id="3225563">(</span><span class="builtintype" id="3225564">string</span><span class="op" id="3225570">,</span>&nbsp;<span class="builtintype" id="3225572">error</span><span class="op" id="3225577">)</span>&nbsp;<span class="op" id="3225579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225582">return</span>&nbsp;<span class="ident" id="3225589">abs</span><span class="op" id="3225592">(</span><span class="ident" id="3225593">path</span><span class="op" id="3225597">)</span><br>
<span class="lineno">235</span><span class="op" id="3225599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3225602">func</span>&nbsp;<span class="ident" id="3225607">unixAbs</span><span class="op" id="3225614">(</span><span class="ident" id="3225615">path</span>&nbsp;<span class="builtintype" id="3225620">string</span><span class="op" id="3225626">)</span>&nbsp;<span class="op" id="3225628">(</span><span class="builtintype" id="3225629">string</span><span class="op" id="3225635">,</span>&nbsp;<span class="builtintype" id="3225637">error</span><span class="op" id="3225642">)</span>&nbsp;<span class="op" id="3225644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225647">if</span>&nbsp;<span class="ident" id="3225650">IsAbs</span><span class="op" id="3225655">(</span><span class="ident" id="3225656">path</span><span class="op" id="3225660">)</span>&nbsp;<span class="op" id="3225662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225666">return</span>&nbsp;<span class="ident" id="3225673">Clean</span><span class="op" id="3225678">(</span><span class="ident" id="3225679">path</span><span class="op" id="3225683">)</span><span class="op" id="3225684">,</span>&nbsp;<span class="ident" id="3225686">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225694">wd</span><span class="op" id="3225696">,</span>&nbsp;<span class="ident" id="3225698">err</span>&nbsp;<span class="op" id="3225702">:=</span>&nbsp;<span class="ident" id="3225705">os</span><span class="op" id="3225707">.</span><span class="ident" id="3225708">Getwd</span><span class="op" id="3225713">(</span><span class="op" id="3225714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225717">if</span>&nbsp;<span class="ident" id="3225720">err</span>&nbsp;<span class="op" id="3225724">!=</span>&nbsp;<span class="ident" id="3225727">nil</span>&nbsp;<span class="op" id="3225731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225735">return</span>&nbsp;<span class="string" id="3225742">&#34;&#34;</span><span class="op" id="3225744">,</span>&nbsp;<span class="ident" id="3225746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225751">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225754">return</span>&nbsp;<span class="ident" id="3225761">Join</span><span class="op" id="3225765">(</span><span class="ident" id="3225766">wd</span><span class="op" id="3225768">,</span>&nbsp;<span class="ident" id="3225770">path</span><span class="op" id="3225774">)</span><span class="op" id="3225775">,</span>&nbsp;<span class="ident" id="3225777">nil</span><br>
<span class="lineno"></span><span class="op" id="3225781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3225784">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3225861">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3225923">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3226000">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3226070">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3226122">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3226199">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3226274">func</span>&nbsp;<span class="ident" id="3226279">Rel</span><span class="op" id="3226282">(</span><span class="ident" id="3226283">basepath</span><span class="op" id="3226291">,</span>&nbsp;<span class="ident" id="3226293">targpath</span>&nbsp;<span class="builtintype" id="3226302">string</span><span class="op" id="3226308">)</span>&nbsp;<span class="op" id="3226310">(</span><span class="builtintype" id="3226311">string</span><span class="op" id="3226317">,</span>&nbsp;<span class="builtintype" id="3226319">error</span><span class="op" id="3226324">)</span>&nbsp;<span class="op" id="3226326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226329">baseVol</span>&nbsp;<span class="op" id="3226337">:=</span>&nbsp;<span class="ident" id="3226340">VolumeName</span><span class="op" id="3226350">(</span><span class="ident" id="3226351">basepath</span><span class="op" id="3226359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226362">targVol</span>&nbsp;<span class="op" id="3226370">:=</span>&nbsp;<span class="ident" id="3226373">VolumeName</span><span class="op" id="3226383">(</span><span class="ident" id="3226384">targpath</span><span class="op" id="3226392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226395">base</span>&nbsp;<span class="op" id="3226400">:=</span>&nbsp;<span class="ident" id="3226403">Clean</span><span class="op" id="3226408">(</span><span class="ident" id="3226409">basepath</span><span class="op" id="3226417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226420">targ</span>&nbsp;<span class="op" id="3226425">:=</span>&nbsp;<span class="ident" id="3226428">Clean</span><span class="op" id="3226433">(</span><span class="ident" id="3226434">targpath</span><span class="op" id="3226442">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226445">if</span>&nbsp;<span class="ident" id="3226448">targ</span>&nbsp;<span class="op" id="3226453">==</span>&nbsp;<span class="ident" id="3226456">base</span>&nbsp;<span class="op" id="3226461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226465">return</span>&nbsp;<span class="string" id="3226472">&#34;.&#34;</span><span class="op" id="3226475">,</span>&nbsp;<span class="ident" id="3226477">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226485">base</span>&nbsp;<span class="op" id="3226490">=</span>&nbsp;<span class="ident" id="3226492">base</span><span class="op" id="3226496">[</span><span class="builtinfunc" id="3226497">len</span><span class="op" id="3226500">(</span><span class="ident" id="3226501">baseVol</span><span class="op" id="3226508">)</span><span class="op" id="3226509">:</span><span class="op" id="3226510">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226513">targ</span>&nbsp;<span class="op" id="3226518">=</span>&nbsp;<span class="ident" id="3226520">targ</span><span class="op" id="3226524">[</span><span class="builtinfunc" id="3226525">len</span><span class="op" id="3226528">(</span><span class="ident" id="3226529">targVol</span><span class="op" id="3226536">)</span><span class="op" id="3226537">:</span><span class="op" id="3226538">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226541">if</span>&nbsp;<span class="ident" id="3226544">base</span>&nbsp;<span class="op" id="3226549">==</span>&nbsp;<span class="string" id="3226552">&#34;.&#34;</span>&nbsp;<span class="op" id="3226556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226560">base</span>&nbsp;<span class="op" id="3226565">=</span>&nbsp;<span class="string" id="3226567">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226574">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226639">baseSlashed</span>&nbsp;<span class="op" id="3226651">:=</span>&nbsp;<span class="builtinfunc" id="3226654">len</span><span class="op" id="3226657">(</span><span class="ident" id="3226658">base</span><span class="op" id="3226662">)</span>&nbsp;<span class="op" id="3226664">&gt;</span>&nbsp;<span class="num" id="3226666">0</span>&nbsp;<span class="op" id="3226668">&amp;&amp;</span>&nbsp;<span class="ident" id="3226671">base</span><span class="op" id="3226675">[</span><span class="num" id="3226676">0</span><span class="op" id="3226677">]</span>&nbsp;<span class="op" id="3226679">==</span>&nbsp;<span class="ident" id="3226682">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226693">targSlashed</span>&nbsp;<span class="op" id="3226705">:=</span>&nbsp;<span class="builtinfunc" id="3226708">len</span><span class="op" id="3226711">(</span><span class="ident" id="3226712">targ</span><span class="op" id="3226716">)</span>&nbsp;<span class="op" id="3226718">&gt;</span>&nbsp;<span class="num" id="3226720">0</span>&nbsp;<span class="op" id="3226722">&amp;&amp;</span>&nbsp;<span class="ident" id="3226725">targ</span><span class="op" id="3226729">[</span><span class="num" id="3226730">0</span><span class="op" id="3226731">]</span>&nbsp;<span class="op" id="3226733">==</span>&nbsp;<span class="ident" id="3226736">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226747">if</span>&nbsp;<span class="ident" id="3226750">baseSlashed</span>&nbsp;<span class="op" id="3226762">!=</span>&nbsp;<span class="ident" id="3226765">targSlashed</span>&nbsp;<span class="op" id="3226777">||</span>&nbsp;<span class="ident" id="3226780">baseVol</span>&nbsp;<span class="op" id="3226788">!=</span>&nbsp;<span class="ident" id="3226791">targVol</span>&nbsp;<span class="op" id="3226799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226803">return</span>&nbsp;<span class="string" id="3226810">&#34;&#34;</span><span class="op" id="3226812">,</span>&nbsp;<span class="ident" id="3226814">errors</span><span class="op" id="3226820">.</span><span class="ident" id="3226821">New</span><span class="op" id="3226824">(</span><span class="string" id="3226825">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3226844">+</span>&nbsp;<span class="ident" id="3226846">targ</span>&nbsp;<span class="op" id="3226851">+</span>&nbsp;<span class="string" id="3226853">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3226869">+</span>&nbsp;<span class="ident" id="3226871">base</span><span class="op" id="3226875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226881">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226955">bl</span>&nbsp;<span class="op" id="3226958">:=</span>&nbsp;<span class="builtinfunc" id="3226961">len</span><span class="op" id="3226964">(</span><span class="ident" id="3226965">base</span><span class="op" id="3226969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226972">tl</span>&nbsp;<span class="op" id="3226975">:=</span>&nbsp;<span class="builtinfunc" id="3226978">len</span><span class="op" id="3226981">(</span><span class="ident" id="3226982">targ</span><span class="op" id="3226986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226989">var</span>&nbsp;<span class="ident" id="3226993">b0</span><span class="op" id="3226995">,</span>&nbsp;<span class="ident" id="3226997">bi</span><span class="op" id="3226999">,</span>&nbsp;<span class="ident" id="3227001">t0</span><span class="op" id="3227003">,</span>&nbsp;<span class="ident" id="3227005">ti</span>&nbsp;<span class="builtintype" id="3227008">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227013">for</span>&nbsp;<span class="op" id="3227017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227021">for</span>&nbsp;<span class="ident" id="3227025">bi</span>&nbsp;<span class="op" id="3227028">&lt;</span>&nbsp;<span class="ident" id="3227030">bl</span>&nbsp;<span class="op" id="3227033">&amp;&amp;</span>&nbsp;<span class="ident" id="3227036">base</span><span class="op" id="3227040">[</span><span class="ident" id="3227041">bi</span><span class="op" id="3227043">]</span>&nbsp;<span class="op" id="3227045">!=</span>&nbsp;<span class="ident" id="3227048">Separator</span>&nbsp;<span class="op" id="3227058">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227063">bi</span><span class="op" id="3227065">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227074">for</span>&nbsp;<span class="ident" id="3227078">ti</span>&nbsp;<span class="op" id="3227081">&lt;</span>&nbsp;<span class="ident" id="3227083">tl</span>&nbsp;<span class="op" id="3227086">&amp;&amp;</span>&nbsp;<span class="ident" id="3227089">targ</span><span class="op" id="3227093">[</span><span class="ident" id="3227094">ti</span><span class="op" id="3227096">]</span>&nbsp;<span class="op" id="3227098">!=</span>&nbsp;<span class="ident" id="3227101">Separator</span>&nbsp;<span class="op" id="3227111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227116">ti</span><span class="op" id="3227118">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227123">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227127">if</span>&nbsp;<span class="ident" id="3227130">targ</span><span class="op" id="3227134">[</span><span class="ident" id="3227135">t0</span><span class="op" id="3227137">:</span><span class="ident" id="3227138">ti</span><span class="op" id="3227140">]</span>&nbsp;<span class="op" id="3227142">!=</span>&nbsp;<span class="ident" id="3227145">base</span><span class="op" id="3227149">[</span><span class="ident" id="3227150">b0</span><span class="op" id="3227152">:</span><span class="ident" id="3227153">bi</span><span class="op" id="3227155">]</span>&nbsp;<span class="op" id="3227157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227162">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227174">if</span>&nbsp;<span class="ident" id="3227177">bi</span>&nbsp;<span class="op" id="3227180">&lt;</span>&nbsp;<span class="ident" id="3227182">bl</span>&nbsp;<span class="op" id="3227185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227190">bi</span><span class="op" id="3227192">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227201">if</span>&nbsp;<span class="ident" id="3227204">ti</span>&nbsp;<span class="op" id="3227207">&lt;</span>&nbsp;<span class="ident" id="3227209">tl</span>&nbsp;<span class="op" id="3227212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227217">ti</span><span class="op" id="3227219">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227228">b0</span>&nbsp;<span class="op" id="3227231">=</span>&nbsp;<span class="ident" id="3227233">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227238">t0</span>&nbsp;<span class="op" id="3227241">=</span>&nbsp;<span class="ident" id="3227243">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227250">if</span>&nbsp;<span class="ident" id="3227253">base</span><span class="op" id="3227257">[</span><span class="ident" id="3227258">b0</span><span class="op" id="3227260">:</span><span class="ident" id="3227261">bi</span><span class="op" id="3227263">]</span>&nbsp;<span class="op" id="3227265">==</span>&nbsp;<span class="string" id="3227268">&#34;..&#34;</span>&nbsp;<span class="op" id="3227273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227277">return</span>&nbsp;<span class="string" id="3227284">&#34;&#34;</span><span class="op" id="3227286">,</span>&nbsp;<span class="ident" id="3227288">errors</span><span class="op" id="3227294">.</span><span class="ident" id="3227295">New</span><span class="op" id="3227298">(</span><span class="string" id="3227299">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3227318">+</span>&nbsp;<span class="ident" id="3227320">targ</span>&nbsp;<span class="op" id="3227325">+</span>&nbsp;<span class="string" id="3227327">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3227343">+</span>&nbsp;<span class="ident" id="3227345">base</span><span class="op" id="3227349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227352">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227355">if</span>&nbsp;<span class="ident" id="3227358">b0</span>&nbsp;<span class="op" id="3227361">!=</span>&nbsp;<span class="ident" id="3227364">bl</span>&nbsp;<span class="op" id="3227367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227371">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227426">seps</span>&nbsp;<span class="op" id="3227431">:=</span>&nbsp;<span class="ident" id="3227434">strings</span><span class="op" id="3227441">.</span><span class="ident" id="3227442">Count</span><span class="op" id="3227447">(</span><span class="ident" id="3227448">base</span><span class="op" id="3227452">[</span><span class="ident" id="3227453">b0</span><span class="op" id="3227455">:</span><span class="ident" id="3227456">bl</span><span class="op" id="3227458">]</span><span class="op" id="3227459">,</span>&nbsp;<span class="builtintype" id="3227461">string</span><span class="op" id="3227467">(</span><span class="ident" id="3227468">Separator</span><span class="op" id="3227477">)</span><span class="op" id="3227478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227482">size</span>&nbsp;<span class="op" id="3227487">:=</span>&nbsp;<span class="num" id="3227490">2</span>&nbsp;<span class="op" id="3227492">+</span>&nbsp;<span class="ident" id="3227494">seps</span><span class="op" id="3227498">*</span><span class="num" id="3227499">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227503">if</span>&nbsp;<span class="ident" id="3227506">tl</span>&nbsp;<span class="op" id="3227509">!=</span>&nbsp;<span class="ident" id="3227512">t0</span>&nbsp;<span class="op" id="3227515">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227520">size</span>&nbsp;<span class="op" id="3227525">+=</span>&nbsp;<span class="num" id="3227528">1</span>&nbsp;<span class="op" id="3227530">+</span>&nbsp;<span class="ident" id="3227532">tl</span>&nbsp;<span class="op" id="3227535">-</span>&nbsp;<span class="ident" id="3227537">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227546">buf</span>&nbsp;<span class="op" id="3227550">:=</span>&nbsp;<span class="builtinfunc" id="3227553">make</span><span class="op" id="3227557">(</span><span class="op" id="3227558">[</span><span class="op" id="3227559">]</span><span class="builtintype" id="3227560">byte</span><span class="op" id="3227564">,</span>&nbsp;<span class="ident" id="3227566">size</span><span class="op" id="3227570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227574">n</span>&nbsp;<span class="op" id="3227576">:=</span>&nbsp;<span class="builtinfunc" id="3227579">copy</span><span class="op" id="3227583">(</span><span class="ident" id="3227584">buf</span><span class="op" id="3227587">,</span>&nbsp;<span class="string" id="3227589">&#34;..&#34;</span><span class="op" id="3227593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227597">for</span>&nbsp;<span class="ident" id="3227601">i</span>&nbsp;<span class="op" id="3227603">:=</span>&nbsp;<span class="num" id="3227606">0</span><span class="op" id="3227607">;</span>&nbsp;<span class="ident" id="3227609">i</span>&nbsp;<span class="op" id="3227611">&lt;</span>&nbsp;<span class="ident" id="3227613">seps</span><span class="op" id="3227617">;</span>&nbsp;<span class="ident" id="3227619">i</span><span class="op" id="3227620">++</span>&nbsp;<span class="op" id="3227623">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227628">buf</span><span class="op" id="3227631">[</span><span class="ident" id="3227632">n</span><span class="op" id="3227633">]</span>&nbsp;<span class="op" id="3227635">=</span>&nbsp;<span class="ident" id="3227637">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3227650">copy</span><span class="op" id="3227654">(</span><span class="ident" id="3227655">buf</span><span class="op" id="3227658">[</span><span class="ident" id="3227659">n</span><span class="op" id="3227660">+</span><span class="num" id="3227661">1</span><span class="op" id="3227662">:</span><span class="op" id="3227663">]</span><span class="op" id="3227664">,</span>&nbsp;<span class="string" id="3227666">&#34;..&#34;</span><span class="op" id="3227670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227675">n</span>&nbsp;<span class="op" id="3227677">+=</span>&nbsp;<span class="num" id="3227680">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227688">if</span>&nbsp;<span class="ident" id="3227691">t0</span>&nbsp;<span class="op" id="3227694">!=</span>&nbsp;<span class="ident" id="3227697">tl</span>&nbsp;<span class="op" id="3227700">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227705">buf</span><span class="op" id="3227708">[</span><span class="ident" id="3227709">n</span><span class="op" id="3227710">]</span>&nbsp;<span class="op" id="3227712">=</span>&nbsp;<span class="ident" id="3227714">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3227727">copy</span><span class="op" id="3227731">(</span><span class="ident" id="3227732">buf</span><span class="op" id="3227735">[</span><span class="ident" id="3227736">n</span><span class="op" id="3227737">+</span><span class="num" id="3227738">1</span><span class="op" id="3227739">:</span><span class="op" id="3227740">]</span><span class="op" id="3227741">,</span>&nbsp;<span class="ident" id="3227743">targ</span><span class="op" id="3227747">[</span><span class="ident" id="3227748">t0</span><span class="op" id="3227750">:</span><span class="op" id="3227751">]</span><span class="op" id="3227752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227760">return</span>&nbsp;<span class="builtintype" id="3227767">string</span><span class="op" id="3227773">(</span><span class="ident" id="3227774">buf</span><span class="op" id="3227777">)</span><span class="op" id="3227778">,</span>&nbsp;<span class="ident" id="3227780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227785">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227788">return</span>&nbsp;<span class="ident" id="3227795">targ</span><span class="op" id="3227799">[</span><span class="ident" id="3227800">t0</span><span class="op" id="3227802">:</span><span class="op" id="3227803">]</span><span class="op" id="3227804">,</span>&nbsp;<span class="ident" id="3227806">nil</span><br>
<span class="lineno"></span><span class="op" id="3227810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3227813">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3227882">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3227954">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3227986">var</span>&nbsp;<span class="ident" id="3227990">SkipDir</span>&nbsp;<span class="op" id="3227998">=</span>&nbsp;<span class="ident" id="3228000">errors</span><span class="op" id="3228006">.</span><span class="ident" id="3228007">New</span><span class="op" id="3228010">(</span><span class="string" id="3228011">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3228032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3228035">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3228109">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3228182">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3228253">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3228328">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3228397">//</span><br>
<span class="lineno"></span><span class="comment" id="3228400">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3228478">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3228554">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3228630">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3228708">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3228782">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3228860">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3228878">type</span>&nbsp;<span class="ident" id="3228883">WalkFunc</span>&nbsp;<span class="keyword" id="3228892">func</span><span class="op" id="3228896">(</span><span class="ident" id="3228897">path</span>&nbsp;<span class="builtintype" id="3228902">string</span><span class="op" id="3228908">,</span>&nbsp;<span class="ident" id="3228910">info</span>&nbsp;<span class="ident" id="3228915">os</span><span class="op" id="3228917">.</span><span class="ident" id="3228918">FileInfo</span><span class="op" id="3228926">,</span>&nbsp;<span class="ident" id="3228928">err</span>&nbsp;<span class="builtintype" id="3228932">error</span><span class="op" id="3228937">)</span>&nbsp;<span class="builtintype" id="3228939">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3228946">var</span>&nbsp;<span class="ident" id="3228950">lstat</span>&nbsp;<span class="op" id="3228956">=</span>&nbsp;<span class="ident" id="3228958">os</span><span class="op" id="3228960">.</span><span class="ident" id="3228961">Lstat</span>&nbsp;<span class="comment" id="3228967">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3228983">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3229029">func</span>&nbsp;<span class="ident" id="3229034">walk</span><span class="op" id="3229038">(</span><span class="ident" id="3229039">path</span>&nbsp;<span class="builtintype" id="3229044">string</span><span class="op" id="3229050">,</span>&nbsp;<span class="ident" id="3229052">info</span>&nbsp;<span class="ident" id="3229057">os</span><span class="op" id="3229059">.</span><span class="ident" id="3229060">FileInfo</span><span class="op" id="3229068">,</span>&nbsp;<span class="ident" id="3229070">walkFn</span>&nbsp;<span class="ident" id="3229077">WalkFunc</span><span class="op" id="3229085">)</span>&nbsp;<span class="builtintype" id="3229087">error</span>&nbsp;<span class="op" id="3229093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229096">err</span>&nbsp;<span class="op" id="3229100">:=</span>&nbsp;<span class="ident" id="3229103">walkFn</span><span class="op" id="3229109">(</span><span class="ident" id="3229110">path</span><span class="op" id="3229114">,</span>&nbsp;<span class="ident" id="3229116">info</span><span class="op" id="3229120">,</span>&nbsp;<span class="ident" id="3229122">nil</span><span class="op" id="3229125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229128">if</span>&nbsp;<span class="ident" id="3229131">err</span>&nbsp;<span class="op" id="3229135">!=</span>&nbsp;<span class="ident" id="3229138">nil</span>&nbsp;<span class="op" id="3229142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229146">if</span>&nbsp;<span class="ident" id="3229149">info</span><span class="op" id="3229153">.</span><span class="ident" id="3229154">IsDir</span><span class="op" id="3229159">(</span><span class="op" id="3229160">)</span>&nbsp;<span class="op" id="3229162">&amp;&amp;</span>&nbsp;<span class="ident" id="3229165">err</span>&nbsp;<span class="op" id="3229169">==</span>&nbsp;<span class="ident" id="3229172">SkipDir</span>&nbsp;<span class="op" id="3229180">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229185">return</span>&nbsp;<span class="ident" id="3229192">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229202">return</span>&nbsp;<span class="ident" id="3229209">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229218">if</span>&nbsp;<span class="op" id="3229221">!</span><span class="ident" id="3229222">info</span><span class="op" id="3229226">.</span><span class="ident" id="3229227">IsDir</span><span class="op" id="3229232">(</span><span class="op" id="3229233">)</span>&nbsp;<span class="op" id="3229235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229239">return</span>&nbsp;<span class="ident" id="3229246">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229255">names</span><span class="op" id="3229260">,</span>&nbsp;<span class="ident" id="3229262">err</span>&nbsp;<span class="op" id="3229266">:=</span>&nbsp;<span class="ident" id="3229269">readDirNames</span><span class="op" id="3229281">(</span><span class="ident" id="3229282">path</span><span class="op" id="3229286">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229289">if</span>&nbsp;<span class="ident" id="3229292">err</span>&nbsp;<span class="op" id="3229296">!=</span>&nbsp;<span class="ident" id="3229299">nil</span>&nbsp;<span class="op" id="3229303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229307">return</span>&nbsp;<span class="ident" id="3229314">walkFn</span><span class="op" id="3229320">(</span><span class="ident" id="3229321">path</span><span class="op" id="3229325">,</span>&nbsp;<span class="ident" id="3229327">info</span><span class="op" id="3229331">,</span>&nbsp;<span class="ident" id="3229333">err</span><span class="op" id="3229336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229343">for</span>&nbsp;<span class="ident" id="3229347">_</span><span class="op" id="3229348">,</span>&nbsp;<span class="ident" id="3229350">name</span>&nbsp;<span class="op" id="3229355">:=</span>&nbsp;<span class="keyword" id="3229358">range</span>&nbsp;<span class="ident" id="3229364">names</span>&nbsp;<span class="op" id="3229370">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229374">filename</span>&nbsp;<span class="op" id="3229383">:=</span>&nbsp;<span class="ident" id="3229386">Join</span><span class="op" id="3229390">(</span><span class="ident" id="3229391">path</span><span class="op" id="3229395">,</span>&nbsp;<span class="ident" id="3229397">name</span><span class="op" id="3229401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229405">fileInfo</span><span class="op" id="3229413">,</span>&nbsp;<span class="ident" id="3229415">err</span>&nbsp;<span class="op" id="3229419">:=</span>&nbsp;<span class="ident" id="3229422">lstat</span><span class="op" id="3229427">(</span><span class="ident" id="3229428">filename</span><span class="op" id="3229436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229440">if</span>&nbsp;<span class="ident" id="3229443">err</span>&nbsp;<span class="op" id="3229447">!=</span>&nbsp;<span class="ident" id="3229450">nil</span>&nbsp;<span class="op" id="3229454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229459">if</span>&nbsp;<span class="ident" id="3229462">err</span>&nbsp;<span class="op" id="3229466">:=</span>&nbsp;<span class="ident" id="3229469">walkFn</span><span class="op" id="3229475">(</span><span class="ident" id="3229476">filename</span><span class="op" id="3229484">,</span>&nbsp;<span class="ident" id="3229486">fileInfo</span><span class="op" id="3229494">,</span>&nbsp;<span class="ident" id="3229496">err</span><span class="op" id="3229499">)</span><span class="op" id="3229500">;</span>&nbsp;<span class="ident" id="3229502">err</span>&nbsp;<span class="op" id="3229506">!=</span>&nbsp;<span class="ident" id="3229509">nil</span>&nbsp;<span class="op" id="3229513">&amp;&amp;</span>&nbsp;<span class="ident" id="3229516">err</span>&nbsp;<span class="op" id="3229520">!=</span>&nbsp;<span class="ident" id="3229523">SkipDir</span>&nbsp;<span class="op" id="3229531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229537">return</span>&nbsp;<span class="ident" id="3229544">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229555">}</span>&nbsp;<span class="keyword" id="3229557">else</span>&nbsp;<span class="op" id="3229562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229567">err</span>&nbsp;<span class="op" id="3229571">=</span>&nbsp;<span class="ident" id="3229573">walk</span><span class="op" id="3229577">(</span><span class="ident" id="3229578">filename</span><span class="op" id="3229586">,</span>&nbsp;<span class="ident" id="3229588">fileInfo</span><span class="op" id="3229596">,</span>&nbsp;<span class="ident" id="3229598">walkFn</span><span class="op" id="3229604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229609">if</span>&nbsp;<span class="ident" id="3229612">err</span>&nbsp;<span class="op" id="3229616">!=</span>&nbsp;<span class="ident" id="3229619">nil</span>&nbsp;<span class="op" id="3229623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229629">if</span>&nbsp;<span class="op" id="3229632">!</span><span class="ident" id="3229633">fileInfo</span><span class="op" id="3229641">.</span><span class="ident" id="3229642">IsDir</span><span class="op" id="3229647">(</span><span class="op" id="3229648">)</span>&nbsp;<span class="op" id="3229650">||</span>&nbsp;<span class="ident" id="3229653">err</span>&nbsp;<span class="op" id="3229657">!=</span>&nbsp;<span class="ident" id="3229660">SkipDir</span>&nbsp;<span class="op" id="3229668">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229675">return</span>&nbsp;<span class="ident" id="3229682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229702">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229705">return</span>&nbsp;<span class="ident" id="3229712">nil</span><br>
<span class="lineno"></span><span class="op" id="3229716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3229719">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3229795">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3229874">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3229949">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3230020">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3230066">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3230106">func</span>&nbsp;<span class="ident" id="3230111">Walk</span><span class="op" id="3230115">(</span><span class="ident" id="3230116">root</span>&nbsp;<span class="builtintype" id="3230121">string</span><span class="op" id="3230127">,</span>&nbsp;<span class="ident" id="3230129">walkFn</span>&nbsp;<span class="ident" id="3230136">WalkFunc</span><span class="op" id="3230144">)</span>&nbsp;<span class="builtintype" id="3230146">error</span>&nbsp;<span class="op" id="3230152">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230155">info</span><span class="op" id="3230159">,</span>&nbsp;<span class="ident" id="3230161">err</span>&nbsp;<span class="op" id="3230165">:=</span>&nbsp;<span class="ident" id="3230168">os</span><span class="op" id="3230170">.</span><span class="ident" id="3230171">Lstat</span><span class="op" id="3230176">(</span><span class="ident" id="3230177">root</span><span class="op" id="3230181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230184">if</span>&nbsp;<span class="ident" id="3230187">err</span>&nbsp;<span class="op" id="3230191">!=</span>&nbsp;<span class="ident" id="3230194">nil</span>&nbsp;<span class="op" id="3230198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230202">return</span>&nbsp;<span class="ident" id="3230209">walkFn</span><span class="op" id="3230215">(</span><span class="ident" id="3230216">root</span><span class="op" id="3230220">,</span>&nbsp;<span class="ident" id="3230222">nil</span><span class="op" id="3230225">,</span>&nbsp;<span class="ident" id="3230227">err</span><span class="op" id="3230230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230236">return</span>&nbsp;<span class="ident" id="3230243">walk</span><span class="op" id="3230247">(</span><span class="ident" id="3230248">root</span><span class="op" id="3230252">,</span>&nbsp;<span class="ident" id="3230254">info</span><span class="op" id="3230258">,</span>&nbsp;<span class="ident" id="3230260">walkFn</span><span class="op" id="3230266">)</span><br>
<span class="lineno">395</span><span class="op" id="3230268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3230271">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3230336">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3230375">func</span>&nbsp;<span class="ident" id="3230380">readDirNames</span><span class="op" id="3230392">(</span><span class="ident" id="3230393">dirname</span>&nbsp;<span class="builtintype" id="3230401">string</span><span class="op" id="3230407">)</span>&nbsp;<span class="op" id="3230409">(</span><span class="op" id="3230410">[</span><span class="op" id="3230411">]</span><span class="builtintype" id="3230412">string</span><span class="op" id="3230418">,</span>&nbsp;<span class="builtintype" id="3230420">error</span><span class="op" id="3230425">)</span>&nbsp;<span class="op" id="3230427">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230430">f</span><span class="op" id="3230431">,</span>&nbsp;<span class="ident" id="3230433">err</span>&nbsp;<span class="op" id="3230437">:=</span>&nbsp;<span class="ident" id="3230440">os</span><span class="op" id="3230442">.</span><span class="ident" id="3230443">Open</span><span class="op" id="3230447">(</span><span class="ident" id="3230448">dirname</span><span class="op" id="3230455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230458">if</span>&nbsp;<span class="ident" id="3230461">err</span>&nbsp;<span class="op" id="3230465">!=</span>&nbsp;<span class="ident" id="3230468">nil</span>&nbsp;<span class="op" id="3230472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230476">return</span>&nbsp;<span class="ident" id="3230483">nil</span><span class="op" id="3230486">,</span>&nbsp;<span class="ident" id="3230488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230496">names</span><span class="op" id="3230501">,</span>&nbsp;<span class="ident" id="3230503">err</span>&nbsp;<span class="op" id="3230507">:=</span>&nbsp;<span class="ident" id="3230510">f</span><span class="op" id="3230511">.</span><span class="ident" id="3230512">Readdirnames</span><span class="op" id="3230524">(</span><span class="op" id="3230525">-</span><span class="num" id="3230526">1</span><span class="op" id="3230527">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230530">f</span><span class="op" id="3230531">.</span><span class="ident" id="3230532">Close</span><span class="op" id="3230537">(</span><span class="op" id="3230538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230541">if</span>&nbsp;<span class="ident" id="3230544">err</span>&nbsp;<span class="op" id="3230548">!=</span>&nbsp;<span class="ident" id="3230551">nil</span>&nbsp;<span class="op" id="3230555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230559">return</span>&nbsp;<span class="ident" id="3230566">nil</span><span class="op" id="3230569">,</span>&nbsp;<span class="ident" id="3230571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230579">sort</span><span class="op" id="3230583">.</span><span class="ident" id="3230584">Strings</span><span class="op" id="3230591">(</span><span class="ident" id="3230592">names</span><span class="op" id="3230597">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230600">return</span>&nbsp;<span class="ident" id="3230607">names</span><span class="op" id="3230612">,</span>&nbsp;<span class="ident" id="3230614">nil</span><br>
<span class="lineno"></span><span class="op" id="3230618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3230621">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3230663">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3230739">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3230782">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3230863">func</span>&nbsp;<span class="ident" id="3230868">Base</span><span class="op" id="3230872">(</span><span class="ident" id="3230873">path</span>&nbsp;<span class="builtintype" id="3230878">string</span><span class="op" id="3230884">)</span>&nbsp;<span class="builtintype" id="3230886">string</span>&nbsp;<span class="op" id="3230893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230896">if</span>&nbsp;<span class="ident" id="3230899">path</span>&nbsp;<span class="op" id="3230904">==</span>&nbsp;<span class="string" id="3230907">&#34;&#34;</span>&nbsp;<span class="op" id="3230910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230914">return</span>&nbsp;<span class="string" id="3230921">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230929">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230957">for</span>&nbsp;<span class="builtinfunc" id="3230961">len</span><span class="op" id="3230964">(</span><span class="ident" id="3230965">path</span><span class="op" id="3230969">)</span>&nbsp;<span class="op" id="3230971">&gt;</span>&nbsp;<span class="num" id="3230973">0</span>&nbsp;<span class="op" id="3230975">&amp;&amp;</span>&nbsp;<span class="ident" id="3230978">os</span><span class="op" id="3230980">.</span><span class="ident" id="3230981">IsPathSeparator</span><span class="op" id="3230996">(</span><span class="ident" id="3230997">path</span><span class="op" id="3231001">[</span><span class="builtinfunc" id="3231002">len</span><span class="op" id="3231005">(</span><span class="ident" id="3231006">path</span><span class="op" id="3231010">)</span><span class="op" id="3231011">-</span><span class="num" id="3231012">1</span><span class="op" id="3231013">]</span><span class="op" id="3231014">)</span>&nbsp;<span class="op" id="3231016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231020">path</span>&nbsp;<span class="op" id="3231025">=</span>&nbsp;<span class="ident" id="3231027">path</span><span class="op" id="3231031">[</span><span class="num" id="3231032">0</span>&nbsp;<span class="op" id="3231034">:</span>&nbsp;<span class="builtinfunc" id="3231036">len</span><span class="op" id="3231039">(</span><span class="ident" id="3231040">path</span><span class="op" id="3231044">)</span><span class="op" id="3231045">-</span><span class="num" id="3231046">1</span><span class="op" id="3231047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231050">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231053">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231080">path</span>&nbsp;<span class="op" id="3231085">=</span>&nbsp;<span class="ident" id="3231087">path</span><span class="op" id="3231091">[</span><span class="builtinfunc" id="3231092">len</span><span class="op" id="3231095">(</span><span class="ident" id="3231096">VolumeName</span><span class="op" id="3231106">(</span><span class="ident" id="3231107">path</span><span class="op" id="3231111">)</span><span class="op" id="3231112">)</span><span class="op" id="3231113">:</span><span class="op" id="3231114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231117">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231143">i</span>&nbsp;<span class="op" id="3231145">:=</span>&nbsp;<span class="builtinfunc" id="3231148">len</span><span class="op" id="3231151">(</span><span class="ident" id="3231152">path</span><span class="op" id="3231156">)</span>&nbsp;<span class="op" id="3231158">-</span>&nbsp;<span class="num" id="3231160">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231163">for</span>&nbsp;<span class="ident" id="3231167">i</span>&nbsp;<span class="op" id="3231169">&gt;=</span>&nbsp;<span class="num" id="3231172">0</span>&nbsp;<span class="op" id="3231174">&amp;&amp;</span>&nbsp;<span class="op" id="3231177">!</span><span class="ident" id="3231178">os</span><span class="op" id="3231180">.</span><span class="ident" id="3231181">IsPathSeparator</span><span class="op" id="3231196">(</span><span class="ident" id="3231197">path</span><span class="op" id="3231201">[</span><span class="ident" id="3231202">i</span><span class="op" id="3231203">]</span><span class="op" id="3231204">)</span>&nbsp;<span class="op" id="3231206">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231210">i</span><span class="op" id="3231211">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231218">if</span>&nbsp;<span class="ident" id="3231221">i</span>&nbsp;<span class="op" id="3231223">&gt;=</span>&nbsp;<span class="num" id="3231226">0</span>&nbsp;<span class="op" id="3231228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231232">path</span>&nbsp;<span class="op" id="3231237">=</span>&nbsp;<span class="ident" id="3231239">path</span><span class="op" id="3231243">[</span><span class="ident" id="3231244">i</span><span class="op" id="3231245">+</span><span class="num" id="3231246">1</span><span class="op" id="3231247">:</span><span class="op" id="3231248">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231251">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231254">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231293">if</span>&nbsp;<span class="ident" id="3231296">path</span>&nbsp;<span class="op" id="3231301">==</span>&nbsp;<span class="string" id="3231304">&#34;&#34;</span>&nbsp;<span class="op" id="3231307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231311">return</span>&nbsp;<span class="builtintype" id="3231318">string</span><span class="op" id="3231324">(</span><span class="ident" id="3231325">Separator</span><span class="op" id="3231334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231340">return</span>&nbsp;<span class="ident" id="3231347">path</span><br>
<span class="lineno">440</span><span class="op" id="3231352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3231355">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3231436">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3231506">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3231530">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3231572">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3231652">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3231734">func</span>&nbsp;<span class="ident" id="3231739">Dir</span><span class="op" id="3231742">(</span><span class="ident" id="3231743">path</span>&nbsp;<span class="builtintype" id="3231748">string</span><span class="op" id="3231754">)</span>&nbsp;<span class="builtintype" id="3231756">string</span>&nbsp;<span class="op" id="3231763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231766">vol</span>&nbsp;<span class="op" id="3231770">:=</span>&nbsp;<span class="ident" id="3231773">VolumeName</span><span class="op" id="3231783">(</span><span class="ident" id="3231784">path</span><span class="op" id="3231788">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231791">i</span>&nbsp;<span class="op" id="3231793">:=</span>&nbsp;<span class="builtinfunc" id="3231796">len</span><span class="op" id="3231799">(</span><span class="ident" id="3231800">path</span><span class="op" id="3231804">)</span>&nbsp;<span class="op" id="3231806">-</span>&nbsp;<span class="num" id="3231808">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231811">for</span>&nbsp;<span class="ident" id="3231815">i</span>&nbsp;<span class="op" id="3231817">&gt;=</span>&nbsp;<span class="builtinfunc" id="3231820">len</span><span class="op" id="3231823">(</span><span class="ident" id="3231824">vol</span><span class="op" id="3231827">)</span>&nbsp;<span class="op" id="3231829">&amp;&amp;</span>&nbsp;<span class="op" id="3231832">!</span><span class="ident" id="3231833">os</span><span class="op" id="3231835">.</span><span class="ident" id="3231836">IsPathSeparator</span><span class="op" id="3231851">(</span><span class="ident" id="3231852">path</span><span class="op" id="3231856">[</span><span class="ident" id="3231857">i</span><span class="op" id="3231858">]</span><span class="op" id="3231859">)</span>&nbsp;<span class="op" id="3231861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231865">i</span><span class="op" id="3231866">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231873">dir</span>&nbsp;<span class="op" id="3231877">:=</span>&nbsp;<span class="ident" id="3231880">Clean</span><span class="op" id="3231885">(</span><span class="ident" id="3231886">path</span><span class="op" id="3231890">[</span><span class="builtinfunc" id="3231891">len</span><span class="op" id="3231894">(</span><span class="ident" id="3231895">vol</span><span class="op" id="3231898">)</span>&nbsp;<span class="op" id="3231900">:</span>&nbsp;<span class="ident" id="3231902">i</span><span class="op" id="3231903">+</span><span class="num" id="3231904">1</span><span class="op" id="3231905">]</span><span class="op" id="3231906">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231909">return</span>&nbsp;<span class="ident" id="3231916">vol</span>&nbsp;<span class="op" id="3231920">+</span>&nbsp;<span class="ident" id="3231922">dir</span><br>
<span class="lineno"></span><span class="op" id="3231926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3231929">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3231972">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3232025">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3232080">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3232117">func</span>&nbsp;<span class="ident" id="3232122">VolumeName</span><span class="op" id="3232132">(</span><span class="ident" id="3232133">path</span>&nbsp;<span class="builtintype" id="3232138">string</span><span class="op" id="3232144">)</span>&nbsp;<span class="op" id="3232146">(</span><span class="ident" id="3232147">v</span>&nbsp;<span class="builtintype" id="3232149">string</span><span class="op" id="3232155">)</span>&nbsp;<span class="op" id="3232157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232160">return</span>&nbsp;<span class="ident" id="3232167">path</span><span class="op" id="3232171">[</span><span class="op" id="3232172">:</span><span class="ident" id="3232173">volumeNameLen</span><span class="op" id="3232186">(</span><span class="ident" id="3232187">path</span><span class="op" id="3232191">)</span><span class="op" id="3232192">]</span><br>
<span class="lineno"></span><span class="op" id="3232194">}</span>
</div>
</body>
</html>
