<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7083050">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7083105">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7083159">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7083210">package</span>&nbsp;<span class="ident" id="7083218">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7083225">import</span>&nbsp;<span class="op" id="7083232">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083235">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083244">&#34;compress/bzip2&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083262">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083281">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083296">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083311">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083328">&#34;crypto/sha512&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083345">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083361">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083369">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083375">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083387">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083393">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083404">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7083414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7083417">func</span>&nbsp;<span class="ident" id="7083422">testKeyGeneration</span><span class="op" id="7083439">(</span><span class="ident" id="7083440">t</span>&nbsp;<span class="op" id="7083442">*</span><span class="ident" id="7083443">testing</span><span class="op" id="7083450">.</span><span class="ident" id="7083451">T</span><span class="op" id="7083452">,</span>&nbsp;<span class="ident" id="7083454">c</span>&nbsp;<span class="ident" id="7083456">elliptic</span><span class="op" id="7083464">.</span><span class="ident" id="7083465">Curve</span><span class="op" id="7083470">,</span>&nbsp;<span class="ident" id="7083472">tag</span>&nbsp;<span class="builtintype" id="7083476">string</span><span class="op" id="7083482">)</span>&nbsp;<span class="op" id="7083484">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083487">priv</span><span class="op" id="7083491">,</span>&nbsp;<span class="ident" id="7083493">err</span>&nbsp;<span class="op" id="7083497">:=</span>&nbsp;<span class="ident" id="7083500">GenerateKey</span><span class="op" id="7083511">(</span><span class="ident" id="7083512">c</span><span class="op" id="7083513">,</span>&nbsp;<span class="ident" id="7083515">rand</span><span class="op" id="7083519">.</span><span class="ident" id="7083520">Reader</span><span class="op" id="7083526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083529">if</span>&nbsp;<span class="ident" id="7083532">err</span>&nbsp;<span class="op" id="7083536">!=</span>&nbsp;<span class="ident" id="7083539">nil</span>&nbsp;<span class="op" id="7083543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083547">t</span><span class="op" id="7083548">.</span><span class="ident" id="7083549">Errorf</span><span class="op" id="7083555">(</span><span class="string" id="7083556">&#34;%s:&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7083571">,</span>&nbsp;<span class="ident" id="7083573">tag</span><span class="op" id="7083576">,</span>&nbsp;<span class="ident" id="7083578">err</span><span class="op" id="7083581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083585">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083593">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083596">if</span>&nbsp;<span class="op" id="7083599">!</span><span class="ident" id="7083600">c</span><span class="op" id="7083601">.</span><span class="ident" id="7083602">IsOnCurve</span><span class="op" id="7083611">(</span><span class="ident" id="7083612">priv</span><span class="op" id="7083616">.</span><span class="ident" id="7083617">PublicKey</span><span class="op" id="7083626">.</span><span class="ident" id="7083627">X</span><span class="op" id="7083628">,</span>&nbsp;<span class="ident" id="7083630">priv</span><span class="op" id="7083634">.</span><span class="ident" id="7083635">PublicKey</span><span class="op" id="7083644">.</span><span class="ident" id="7083645">Y</span><span class="op" id="7083646">)</span>&nbsp;<span class="op" id="7083648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083652">t</span><span class="op" id="7083653">.</span><span class="ident" id="7083654">Errorf</span><span class="op" id="7083660">(</span><span class="string" id="7083661">&#34;%s:&nbsp;public&nbsp;key&nbsp;invalid:&nbsp;%s&#34;</span><span class="op" id="7083689">,</span>&nbsp;<span class="ident" id="7083691">tag</span><span class="op" id="7083694">,</span>&nbsp;<span class="ident" id="7083696">err</span><span class="op" id="7083699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083702">}</span><br>
<span class="lineno"></span><span class="op" id="7083704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7083707">func</span>&nbsp;<span class="ident" id="7083712">TestKeyGeneration</span><span class="op" id="7083729">(</span><span class="ident" id="7083730">t</span>&nbsp;<span class="op" id="7083732">*</span><span class="ident" id="7083733">testing</span><span class="op" id="7083740">.</span><span class="ident" id="7083741">T</span><span class="op" id="7083742">)</span>&nbsp;<span class="op" id="7083744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083747">testKeyGeneration</span><span class="op" id="7083764">(</span><span class="ident" id="7083765">t</span><span class="op" id="7083766">,</span>&nbsp;<span class="ident" id="7083768">elliptic</span><span class="op" id="7083776">.</span><span class="ident" id="7083777">P224</span><span class="op" id="7083781">(</span><span class="op" id="7083782">)</span><span class="op" id="7083783">,</span>&nbsp;<span class="string" id="7083785">&#34;p224&#34;</span><span class="op" id="7083791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083794">if</span>&nbsp;<span class="ident" id="7083797">testing</span><span class="op" id="7083804">.</span><span class="ident" id="7083805">Short</span><span class="op" id="7083810">(</span><span class="op" id="7083811">)</span>&nbsp;<span class="op" id="7083813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083817">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083825">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083828">testKeyGeneration</span><span class="op" id="7083845">(</span><span class="ident" id="7083846">t</span><span class="op" id="7083847">,</span>&nbsp;<span class="ident" id="7083849">elliptic</span><span class="op" id="7083857">.</span><span class="ident" id="7083858">P256</span><span class="op" id="7083862">(</span><span class="op" id="7083863">)</span><span class="op" id="7083864">,</span>&nbsp;<span class="string" id="7083866">&#34;p256&#34;</span><span class="op" id="7083872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083875">testKeyGeneration</span><span class="op" id="7083892">(</span><span class="ident" id="7083893">t</span><span class="op" id="7083894">,</span>&nbsp;<span class="ident" id="7083896">elliptic</span><span class="op" id="7083904">.</span><span class="ident" id="7083905">P384</span><span class="op" id="7083909">(</span><span class="op" id="7083910">)</span><span class="op" id="7083911">,</span>&nbsp;<span class="string" id="7083913">&#34;p384&#34;</span><span class="op" id="7083919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083922">testKeyGeneration</span><span class="op" id="7083939">(</span><span class="ident" id="7083940">t</span><span class="op" id="7083941">,</span>&nbsp;<span class="ident" id="7083943">elliptic</span><span class="op" id="7083951">.</span><span class="ident" id="7083952">P521</span><span class="op" id="7083956">(</span><span class="op" id="7083957">)</span><span class="op" id="7083958">,</span>&nbsp;<span class="string" id="7083960">&#34;p521&#34;</span><span class="op" id="7083966">)</span><br>
<span class="lineno"></span><span class="op" id="7083968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7083971">func</span>&nbsp;<span class="ident" id="7083976">testSignAndVerify</span><span class="op" id="7083993">(</span><span class="ident" id="7083994">t</span>&nbsp;<span class="op" id="7083996">*</span><span class="ident" id="7083997">testing</span><span class="op" id="7084004">.</span><span class="ident" id="7084005">T</span><span class="op" id="7084006">,</span>&nbsp;<span class="ident" id="7084008">c</span>&nbsp;<span class="ident" id="7084010">elliptic</span><span class="op" id="7084018">.</span><span class="ident" id="7084019">Curve</span><span class="op" id="7084024">,</span>&nbsp;<span class="ident" id="7084026">tag</span>&nbsp;<span class="builtintype" id="7084030">string</span><span class="op" id="7084036">)</span>&nbsp;<span class="op" id="7084038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084041">priv</span><span class="op" id="7084045">,</span>&nbsp;<span class="ident" id="7084047">_</span>&nbsp;<span class="op" id="7084049">:=</span>&nbsp;<span class="ident" id="7084052">GenerateKey</span><span class="op" id="7084063">(</span><span class="ident" id="7084064">c</span><span class="op" id="7084065">,</span>&nbsp;<span class="ident" id="7084067">rand</span><span class="op" id="7084071">.</span><span class="ident" id="7084072">Reader</span><span class="op" id="7084078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084082">hashed</span>&nbsp;<span class="op" id="7084089">:=</span>&nbsp;<span class="op" id="7084092">[</span><span class="op" id="7084093">]</span><span class="builtintype" id="7084094">byte</span><span class="op" id="7084098">(</span><span class="string" id="7084099">&#34;testing&#34;</span><span class="op" id="7084108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084111">r</span><span class="op" id="7084112">,</span>&nbsp;<span class="ident" id="7084114">s</span><span class="op" id="7084115">,</span>&nbsp;<span class="ident" id="7084117">err</span>&nbsp;<span class="op" id="7084121">:=</span>&nbsp;<span class="ident" id="7084124">Sign</span><span class="op" id="7084128">(</span><span class="ident" id="7084129">rand</span><span class="op" id="7084133">.</span><span class="ident" id="7084134">Reader</span><span class="op" id="7084140">,</span>&nbsp;<span class="ident" id="7084142">priv</span><span class="op" id="7084146">,</span>&nbsp;<span class="ident" id="7084148">hashed</span><span class="op" id="7084154">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084157">if</span>&nbsp;<span class="ident" id="7084160">err</span>&nbsp;<span class="op" id="7084164">!=</span>&nbsp;<span class="ident" id="7084167">nil</span>&nbsp;<span class="op" id="7084171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084175">t</span><span class="op" id="7084176">.</span><span class="ident" id="7084177">Errorf</span><span class="op" id="7084183">(</span><span class="string" id="7084184">&#34;%s:&nbsp;error&nbsp;signing:&nbsp;%s&#34;</span><span class="op" id="7084207">,</span>&nbsp;<span class="ident" id="7084209">tag</span><span class="op" id="7084212">,</span>&nbsp;<span class="ident" id="7084214">err</span><span class="op" id="7084217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084221">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7084229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084233">if</span>&nbsp;<span class="op" id="7084236">!</span><span class="ident" id="7084237">Verify</span><span class="op" id="7084243">(</span><span class="op" id="7084244">&amp;</span><span class="ident" id="7084245">priv</span><span class="op" id="7084249">.</span><span class="ident" id="7084250">PublicKey</span><span class="op" id="7084259">,</span>&nbsp;<span class="ident" id="7084261">hashed</span><span class="op" id="7084267">,</span>&nbsp;<span class="ident" id="7084269">r</span><span class="op" id="7084270">,</span>&nbsp;<span class="ident" id="7084272">s</span><span class="op" id="7084273">)</span>&nbsp;<span class="op" id="7084275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084279">t</span><span class="op" id="7084280">.</span><span class="ident" id="7084281">Errorf</span><span class="op" id="7084287">(</span><span class="string" id="7084288">&#34;%s:&nbsp;Verify&nbsp;failed&#34;</span><span class="op" id="7084307">,</span>&nbsp;<span class="ident" id="7084309">tag</span><span class="op" id="7084312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7084315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084319">hashed</span><span class="op" id="7084325">[</span><span class="num" id="7084326">0</span><span class="op" id="7084327">]</span>&nbsp;<span class="op" id="7084329">^=</span>&nbsp;<span class="num" id="7084332">0xff</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084338">if</span>&nbsp;<span class="ident" id="7084341">Verify</span><span class="op" id="7084347">(</span><span class="op" id="7084348">&amp;</span><span class="ident" id="7084349">priv</span><span class="op" id="7084353">.</span><span class="ident" id="7084354">PublicKey</span><span class="op" id="7084363">,</span>&nbsp;<span class="ident" id="7084365">hashed</span><span class="op" id="7084371">,</span>&nbsp;<span class="ident" id="7084373">r</span><span class="op" id="7084374">,</span>&nbsp;<span class="ident" id="7084376">s</span><span class="op" id="7084377">)</span>&nbsp;<span class="op" id="7084379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084383">t</span><span class="op" id="7084384">.</span><span class="ident" id="7084385">Errorf</span><span class="op" id="7084391">(</span><span class="string" id="7084392">&#34;%s:&nbsp;Verify&nbsp;always&nbsp;works!&#34;</span><span class="op" id="7084418">,</span>&nbsp;<span class="ident" id="7084420">tag</span><span class="op" id="7084423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7084426">}</span><br>
<span class="lineno"></span><span class="op" id="7084428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7084431">func</span>&nbsp;<span class="ident" id="7084436">TestSignAndVerify</span><span class="op" id="7084453">(</span><span class="ident" id="7084454">t</span>&nbsp;<span class="op" id="7084456">*</span><span class="ident" id="7084457">testing</span><span class="op" id="7084464">.</span><span class="ident" id="7084465">T</span><span class="op" id="7084466">)</span>&nbsp;<span class="op" id="7084468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084471">testSignAndVerify</span><span class="op" id="7084488">(</span><span class="ident" id="7084489">t</span><span class="op" id="7084490">,</span>&nbsp;<span class="ident" id="7084492">elliptic</span><span class="op" id="7084500">.</span><span class="ident" id="7084501">P224</span><span class="op" id="7084505">(</span><span class="op" id="7084506">)</span><span class="op" id="7084507">,</span>&nbsp;<span class="string" id="7084509">&#34;p224&#34;</span><span class="op" id="7084515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084518">if</span>&nbsp;<span class="ident" id="7084521">testing</span><span class="op" id="7084528">.</span><span class="ident" id="7084529">Short</span><span class="op" id="7084534">(</span><span class="op" id="7084535">)</span>&nbsp;<span class="op" id="7084537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084541">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7084549">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084552">testSignAndVerify</span><span class="op" id="7084569">(</span><span class="ident" id="7084570">t</span><span class="op" id="7084571">,</span>&nbsp;<span class="ident" id="7084573">elliptic</span><span class="op" id="7084581">.</span><span class="ident" id="7084582">P256</span><span class="op" id="7084586">(</span><span class="op" id="7084587">)</span><span class="op" id="7084588">,</span>&nbsp;<span class="string" id="7084590">&#34;p256&#34;</span><span class="op" id="7084596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084599">testSignAndVerify</span><span class="op" id="7084616">(</span><span class="ident" id="7084617">t</span><span class="op" id="7084618">,</span>&nbsp;<span class="ident" id="7084620">elliptic</span><span class="op" id="7084628">.</span><span class="ident" id="7084629">P384</span><span class="op" id="7084633">(</span><span class="op" id="7084634">)</span><span class="op" id="7084635">,</span>&nbsp;<span class="string" id="7084637">&#34;p384&#34;</span><span class="op" id="7084643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084646">testSignAndVerify</span><span class="op" id="7084663">(</span><span class="ident" id="7084664">t</span><span class="op" id="7084665">,</span>&nbsp;<span class="ident" id="7084667">elliptic</span><span class="op" id="7084675">.</span><span class="ident" id="7084676">P521</span><span class="op" id="7084680">(</span><span class="op" id="7084681">)</span><span class="op" id="7084682">,</span>&nbsp;<span class="string" id="7084684">&#34;p521&#34;</span><span class="op" id="7084690">)</span><br>
<span class="lineno"></span><span class="op" id="7084692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7084695">func</span>&nbsp;<span class="ident" id="7084700">fromHex</span><span class="op" id="7084707">(</span><span class="ident" id="7084708">s</span>&nbsp;<span class="builtintype" id="7084710">string</span><span class="op" id="7084716">)</span>&nbsp;<span class="op" id="7084718">*</span><span class="ident" id="7084719">big</span><span class="op" id="7084722">.</span><span class="ident" id="7084723">Int</span>&nbsp;<span class="op" id="7084727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7084730">r</span><span class="op" id="7084731">,</span>&nbsp;<span class="ident" id="7084733">ok</span>&nbsp;<span class="op" id="7084736">:=</span>&nbsp;<span class="builtinfunc" id="7084739">new</span><span class="op" id="7084742">(</span><span class="ident" id="7084743">big</span><span class="op" id="7084746">.</span><span class="ident" id="7084747">Int</span><span class="op" id="7084750">)</span><span class="op" id="7084751">.</span><span class="ident" id="7084752">SetString</span><span class="op" id="7084761">(</span><span class="ident" id="7084762">s</span><span class="op" id="7084763">,</span>&nbsp;<span class="num" id="7084765">16</span><span class="op" id="7084767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084770">if</span>&nbsp;<span class="op" id="7084773">!</span><span class="ident" id="7084774">ok</span>&nbsp;<span class="op" id="7084777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7084781">panic</span><span class="op" id="7084786">(</span><span class="string" id="7084787">&#34;bad&nbsp;hex&#34;</span><span class="op" id="7084796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7084799">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7084802">return</span>&nbsp;<span class="ident" id="7084809">r</span><br>
<span class="lineno"></span><span class="op" id="7084811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7084814">func</span>&nbsp;<span class="ident" id="7084819">TestVectors</span><span class="op" id="7084830">(</span><span class="ident" id="7084831">t</span>&nbsp;<span class="op" id="7084833">*</span><span class="ident" id="7084834">testing</span><span class="op" id="7084841">.</span><span class="ident" id="7084842">T</span><span class="op" id="7084843">)</span>&nbsp;<span class="op" id="7084845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7084848">//&nbsp;This&nbsp;test&nbsp;runs&nbsp;the&nbsp;full&nbsp;set&nbsp;of&nbsp;NIST&nbsp;test&nbsp;vectors&nbsp;from</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7084906">//&nbsp;http://csrc.nist.gov/groups/STM/cavp/documents/dss/186-3ecdsatestvectors.zip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7084987">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7084991">//&nbsp;The&nbsp;SigVer.rsp&nbsp;file&nbsp;has&nbsp;been&nbsp;edited&nbsp;to&nbsp;remove&nbsp;test&nbsp;vectors&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7085058">//&nbsp;unsupported&nbsp;algorithms&nbsp;and&nbsp;has&nbsp;been&nbsp;compressed.</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085111">if</span>&nbsp;<span class="ident" id="7085114">testing</span><span class="op" id="7085121">.</span><span class="ident" id="7085122">Short</span><span class="op" id="7085127">(</span><span class="op" id="7085128">)</span>&nbsp;<span class="op" id="7085130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085134">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085146">f</span><span class="op" id="7085147">,</span>&nbsp;<span class="ident" id="7085149">err</span>&nbsp;<span class="op" id="7085153">:=</span>&nbsp;<span class="ident" id="7085156">os</span><span class="op" id="7085158">.</span><span class="ident" id="7085159">Open</span><span class="op" id="7085163">(</span><span class="string" id="7085164">&#34;testdata/SigVer.rsp.bz2&#34;</span><span class="op" id="7085189">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085192">if</span>&nbsp;<span class="ident" id="7085195">err</span>&nbsp;<span class="op" id="7085199">!=</span>&nbsp;<span class="ident" id="7085202">nil</span>&nbsp;<span class="op" id="7085206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085210">t</span><span class="op" id="7085211">.</span><span class="ident" id="7085212">Fatal</span><span class="op" id="7085217">(</span><span class="ident" id="7085218">err</span><span class="op" id="7085221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085228">buf</span>&nbsp;<span class="op" id="7085232">:=</span>&nbsp;<span class="ident" id="7085235">bufio</span><span class="op" id="7085240">.</span><span class="ident" id="7085241">NewReader</span><span class="op" id="7085250">(</span><span class="ident" id="7085251">bzip2</span><span class="op" id="7085256">.</span><span class="ident" id="7085257">NewReader</span><span class="op" id="7085266">(</span><span class="ident" id="7085267">f</span><span class="op" id="7085268">)</span><span class="op" id="7085269">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085273">lineNo</span>&nbsp;<span class="op" id="7085280">:=</span>&nbsp;<span class="num" id="7085283">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085286">var</span>&nbsp;<span class="ident" id="7085290">h</span>&nbsp;<span class="ident" id="7085292">hash</span><span class="op" id="7085296">.</span><span class="ident" id="7085297">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085303">var</span>&nbsp;<span class="ident" id="7085307">msg</span>&nbsp;<span class="op" id="7085311">[</span><span class="op" id="7085312">]</span><span class="builtintype" id="7085313">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085319">var</span>&nbsp;<span class="ident" id="7085323">hashed</span>&nbsp;<span class="op" id="7085330">[</span><span class="op" id="7085331">]</span><span class="builtintype" id="7085332">byte</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085338">var</span>&nbsp;<span class="ident" id="7085342">r</span><span class="op" id="7085343">,</span>&nbsp;<span class="ident" id="7085345">s</span>&nbsp;<span class="op" id="7085347">*</span><span class="ident" id="7085348">big</span><span class="op" id="7085351">.</span><span class="ident" id="7085352">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085357">pub</span>&nbsp;<span class="op" id="7085361">:=</span>&nbsp;<span class="builtinfunc" id="7085364">new</span><span class="op" id="7085367">(</span><span class="ident" id="7085368">PublicKey</span><span class="op" id="7085377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085381">for</span>&nbsp;<span class="op" id="7085385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085389">line</span><span class="op" id="7085393">,</span>&nbsp;<span class="ident" id="7085395">err</span>&nbsp;<span class="op" id="7085399">:=</span>&nbsp;<span class="ident" id="7085402">buf</span><span class="op" id="7085405">.</span><span class="ident" id="7085406">ReadString</span><span class="op" id="7085416">(</span><span class="string" id="7085417">&#39;\n&#39;</span><span class="op" id="7085421">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085425">if</span>&nbsp;<span class="builtinfunc" id="7085428">len</span><span class="op" id="7085431">(</span><span class="ident" id="7085432">line</span><span class="op" id="7085436">)</span>&nbsp;<span class="op" id="7085438">==</span>&nbsp;<span class="num" id="7085441">0</span>&nbsp;<span class="op" id="7085443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085448">if</span>&nbsp;<span class="ident" id="7085451">err</span>&nbsp;<span class="op" id="7085455">==</span>&nbsp;<span class="ident" id="7085458">io</span><span class="op" id="7085460">.</span><span class="ident" id="7085461">EOF</span>&nbsp;<span class="op" id="7085465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085471">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085485">t</span><span class="op" id="7085486">.</span><span class="ident" id="7085487">Fatalf</span><span class="op" id="7085493">(</span><span class="string" id="7085494">&#34;error&nbsp;reading&nbsp;from&nbsp;input:&nbsp;%s&#34;</span><span class="op" id="7085524">,</span>&nbsp;<span class="ident" id="7085526">err</span><span class="op" id="7085529">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085537">lineNo</span><span class="op" id="7085543">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7085548">//&nbsp;Need&nbsp;to&nbsp;remove&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085599">if</span>&nbsp;<span class="op" id="7085602">!</span><span class="ident" id="7085603">strings</span><span class="op" id="7085610">.</span><span class="ident" id="7085611">HasSuffix</span><span class="op" id="7085620">(</span><span class="ident" id="7085621">line</span><span class="op" id="7085625">,</span>&nbsp;<span class="string" id="7085627">&#34;\r\n&#34;</span><span class="op" id="7085633">)</span>&nbsp;<span class="op" id="7085635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085640">t</span><span class="op" id="7085641">.</span><span class="ident" id="7085642">Fatalf</span><span class="op" id="7085648">(</span><span class="string" id="7085649">&#34;bad&nbsp;line&nbsp;ending&nbsp;(expected&nbsp;\\r\\n)&nbsp;on&nbsp;line&nbsp;%d&#34;</span><span class="op" id="7085695">,</span>&nbsp;<span class="ident" id="7085697">lineNo</span><span class="op" id="7085703">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085711">line</span>&nbsp;<span class="op" id="7085716">=</span>&nbsp;<span class="ident" id="7085718">line</span><span class="op" id="7085722">[</span><span class="op" id="7085723">:</span><span class="builtinfunc" id="7085724">len</span><span class="op" id="7085727">(</span><span class="ident" id="7085728">line</span><span class="op" id="7085732">)</span><span class="op" id="7085733">-</span><span class="num" id="7085734">2</span><span class="op" id="7085735">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085740">if</span>&nbsp;<span class="builtinfunc" id="7085743">len</span><span class="op" id="7085746">(</span><span class="ident" id="7085747">line</span><span class="op" id="7085751">)</span>&nbsp;<span class="op" id="7085753">==</span>&nbsp;<span class="num" id="7085756">0</span>&nbsp;<span class="op" id="7085758">||</span>&nbsp;<span class="ident" id="7085761">line</span><span class="op" id="7085765">[</span><span class="num" id="7085766">0</span><span class="op" id="7085767">]</span>&nbsp;<span class="op" id="7085769">==</span>&nbsp;<span class="string" id="7085772">&#39;#&#39;</span>&nbsp;<span class="op" id="7085776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085781">continue</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7085792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085797">if</span>&nbsp;<span class="ident" id="7085800">line</span><span class="op" id="7085804">[</span><span class="num" id="7085805">0</span><span class="op" id="7085806">]</span>&nbsp;<span class="op" id="7085808">==</span>&nbsp;<span class="string" id="7085811">&#39;[&#39;</span>&nbsp;<span class="op" id="7085815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085820">line</span>&nbsp;<span class="op" id="7085825">=</span>&nbsp;<span class="ident" id="7085827">line</span><span class="op" id="7085831">[</span><span class="num" id="7085832">1</span>&nbsp;<span class="op" id="7085834">:</span>&nbsp;<span class="builtinfunc" id="7085836">len</span><span class="op" id="7085839">(</span><span class="ident" id="7085840">line</span><span class="op" id="7085844">)</span><span class="op" id="7085845">-</span><span class="num" id="7085846">1</span><span class="op" id="7085847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085852">parts</span>&nbsp;<span class="op" id="7085858">:=</span>&nbsp;<span class="ident" id="7085861">strings</span><span class="op" id="7085868">.</span><span class="ident" id="7085869">SplitN</span><span class="op" id="7085875">(</span><span class="ident" id="7085876">line</span><span class="op" id="7085880">,</span>&nbsp;<span class="string" id="7085882">&#34;,&#34;</span><span class="op" id="7085885">,</span>&nbsp;<span class="num" id="7085887">2</span><span class="op" id="7085888">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085894">switch</span>&nbsp;<span class="ident" id="7085901">parts</span><span class="op" id="7085906">[</span><span class="num" id="7085907">0</span><span class="op" id="7085908">]</span>&nbsp;<span class="op" id="7085910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085915">case</span>&nbsp;<span class="string" id="7085920">&#34;P-224&#34;</span><span class="op" id="7085927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085933">pub</span><span class="op" id="7085936">.</span><span class="ident" id="7085937">Curve</span>&nbsp;<span class="op" id="7085943">=</span>&nbsp;<span class="ident" id="7085945">elliptic</span><span class="op" id="7085953">.</span><span class="ident" id="7085954">P224</span><span class="op" id="7085958">(</span><span class="op" id="7085959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7085964">case</span>&nbsp;<span class="string" id="7085969">&#34;P-256&#34;</span><span class="op" id="7085976">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7085982">pub</span><span class="op" id="7085985">.</span><span class="ident" id="7085986">Curve</span>&nbsp;<span class="op" id="7085992">=</span>&nbsp;<span class="ident" id="7085994">elliptic</span><span class="op" id="7086002">.</span><span class="ident" id="7086003">P256</span><span class="op" id="7086007">(</span><span class="op" id="7086008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086013">case</span>&nbsp;<span class="string" id="7086018">&#34;P-384&#34;</span><span class="op" id="7086025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086031">pub</span><span class="op" id="7086034">.</span><span class="ident" id="7086035">Curve</span>&nbsp;<span class="op" id="7086041">=</span>&nbsp;<span class="ident" id="7086043">elliptic</span><span class="op" id="7086051">.</span><span class="ident" id="7086052">P384</span><span class="op" id="7086056">(</span><span class="op" id="7086057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086062">case</span>&nbsp;<span class="string" id="7086067">&#34;P-521&#34;</span><span class="op" id="7086074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086080">pub</span><span class="op" id="7086083">.</span><span class="ident" id="7086084">Curve</span>&nbsp;<span class="op" id="7086090">=</span>&nbsp;<span class="ident" id="7086092">elliptic</span><span class="op" id="7086100">.</span><span class="ident" id="7086101">P521</span><span class="op" id="7086105">(</span><span class="op" id="7086106">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086111">default</span><span class="op" id="7086118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086124">pub</span><span class="op" id="7086127">.</span><span class="ident" id="7086128">Curve</span>&nbsp;<span class="op" id="7086134">=</span>&nbsp;<span class="ident" id="7086136">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086149">switch</span>&nbsp;<span class="ident" id="7086156">parts</span><span class="op" id="7086161">[</span><span class="num" id="7086162">1</span><span class="op" id="7086163">]</span>&nbsp;<span class="op" id="7086165">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086170">case</span>&nbsp;<span class="string" id="7086175">&#34;SHA-1&#34;</span><span class="op" id="7086182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086188">h</span>&nbsp;<span class="op" id="7086190">=</span>&nbsp;<span class="ident" id="7086192">sha1</span><span class="op" id="7086196">.</span><span class="ident" id="7086197">New</span><span class="op" id="7086200">(</span><span class="op" id="7086201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086206">case</span>&nbsp;<span class="string" id="7086211">&#34;SHA-224&#34;</span><span class="op" id="7086220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086226">h</span>&nbsp;<span class="op" id="7086228">=</span>&nbsp;<span class="ident" id="7086230">sha256</span><span class="op" id="7086236">.</span><span class="ident" id="7086237">New224</span><span class="op" id="7086243">(</span><span class="op" id="7086244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086249">case</span>&nbsp;<span class="string" id="7086254">&#34;SHA-256&#34;</span><span class="op" id="7086263">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086269">h</span>&nbsp;<span class="op" id="7086271">=</span>&nbsp;<span class="ident" id="7086273">sha256</span><span class="op" id="7086279">.</span><span class="ident" id="7086280">New</span><span class="op" id="7086283">(</span><span class="op" id="7086284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086289">case</span>&nbsp;<span class="string" id="7086294">&#34;SHA-384&#34;</span><span class="op" id="7086303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086309">h</span>&nbsp;<span class="op" id="7086311">=</span>&nbsp;<span class="ident" id="7086313">sha512</span><span class="op" id="7086319">.</span><span class="ident" id="7086320">New384</span><span class="op" id="7086326">(</span><span class="op" id="7086327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086332">case</span>&nbsp;<span class="string" id="7086337">&#34;SHA-512&#34;</span><span class="op" id="7086346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086352">h</span>&nbsp;<span class="op" id="7086354">=</span>&nbsp;<span class="ident" id="7086356">sha512</span><span class="op" id="7086362">.</span><span class="ident" id="7086363">New</span><span class="op" id="7086366">(</span><span class="op" id="7086367">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086372">default</span><span class="op" id="7086379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086385">h</span>&nbsp;<span class="op" id="7086387">=</span>&nbsp;<span class="ident" id="7086389">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086402">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086418">if</span>&nbsp;<span class="ident" id="7086421">h</span>&nbsp;<span class="op" id="7086423">==</span>&nbsp;<span class="ident" id="7086426">nil</span>&nbsp;<span class="op" id="7086430">||</span>&nbsp;<span class="ident" id="7086433">pub</span><span class="op" id="7086436">.</span><span class="ident" id="7086437">Curve</span>&nbsp;<span class="op" id="7086443">==</span>&nbsp;<span class="ident" id="7086446">nil</span>&nbsp;<span class="op" id="7086450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086455">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086466">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086471">switch</span>&nbsp;<span class="op" id="7086478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086482">case</span>&nbsp;<span class="ident" id="7086487">strings</span><span class="op" id="7086494">.</span><span class="ident" id="7086495">HasPrefix</span><span class="op" id="7086504">(</span><span class="ident" id="7086505">line</span><span class="op" id="7086509">,</span>&nbsp;<span class="string" id="7086511">&#34;Msg&nbsp;=&nbsp;&#34;</span><span class="op" id="7086519">)</span><span class="op" id="7086520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086525">if</span>&nbsp;<span class="ident" id="7086528">msg</span><span class="op" id="7086531">,</span>&nbsp;<span class="ident" id="7086533">err</span>&nbsp;<span class="op" id="7086537">=</span>&nbsp;<span class="ident" id="7086539">hex</span><span class="op" id="7086542">.</span><span class="ident" id="7086543">DecodeString</span><span class="op" id="7086555">(</span><span class="ident" id="7086556">line</span><span class="op" id="7086560">[</span><span class="num" id="7086561">6</span><span class="op" id="7086562">:</span><span class="op" id="7086563">]</span><span class="op" id="7086564">)</span><span class="op" id="7086565">;</span>&nbsp;<span class="ident" id="7086567">err</span>&nbsp;<span class="op" id="7086571">!=</span>&nbsp;<span class="ident" id="7086574">nil</span>&nbsp;<span class="op" id="7086578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086584">t</span><span class="op" id="7086585">.</span><span class="ident" id="7086586">Fatalf</span><span class="op" id="7086592">(</span><span class="string" id="7086593">&#34;failed&nbsp;to&nbsp;decode&nbsp;message&nbsp;on&nbsp;line&nbsp;%d:&nbsp;%s&#34;</span><span class="op" id="7086634">,</span>&nbsp;<span class="ident" id="7086636">lineNo</span><span class="op" id="7086642">,</span>&nbsp;<span class="ident" id="7086644">err</span><span class="op" id="7086647">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7086652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086656">case</span>&nbsp;<span class="ident" id="7086661">strings</span><span class="op" id="7086668">.</span><span class="ident" id="7086669">HasPrefix</span><span class="op" id="7086678">(</span><span class="ident" id="7086679">line</span><span class="op" id="7086683">,</span>&nbsp;<span class="string" id="7086685">&#34;Qx&nbsp;=&nbsp;&#34;</span><span class="op" id="7086692">)</span><span class="op" id="7086693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086698">pub</span><span class="op" id="7086701">.</span><span class="ident" id="7086702">X</span>&nbsp;<span class="op" id="7086704">=</span>&nbsp;<span class="ident" id="7086706">fromHex</span><span class="op" id="7086713">(</span><span class="ident" id="7086714">line</span><span class="op" id="7086718">[</span><span class="num" id="7086719">5</span><span class="op" id="7086720">:</span><span class="op" id="7086721">]</span><span class="op" id="7086722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086726">case</span>&nbsp;<span class="ident" id="7086731">strings</span><span class="op" id="7086738">.</span><span class="ident" id="7086739">HasPrefix</span><span class="op" id="7086748">(</span><span class="ident" id="7086749">line</span><span class="op" id="7086753">,</span>&nbsp;<span class="string" id="7086755">&#34;Qy&nbsp;=&nbsp;&#34;</span><span class="op" id="7086762">)</span><span class="op" id="7086763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086768">pub</span><span class="op" id="7086771">.</span><span class="ident" id="7086772">Y</span>&nbsp;<span class="op" id="7086774">=</span>&nbsp;<span class="ident" id="7086776">fromHex</span><span class="op" id="7086783">(</span><span class="ident" id="7086784">line</span><span class="op" id="7086788">[</span><span class="num" id="7086789">5</span><span class="op" id="7086790">:</span><span class="op" id="7086791">]</span><span class="op" id="7086792">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086796">case</span>&nbsp;<span class="ident" id="7086801">strings</span><span class="op" id="7086808">.</span><span class="ident" id="7086809">HasPrefix</span><span class="op" id="7086818">(</span><span class="ident" id="7086819">line</span><span class="op" id="7086823">,</span>&nbsp;<span class="string" id="7086825">&#34;R&nbsp;=&nbsp;&#34;</span><span class="op" id="7086831">)</span><span class="op" id="7086832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086837">r</span>&nbsp;<span class="op" id="7086839">=</span>&nbsp;<span class="ident" id="7086841">fromHex</span><span class="op" id="7086848">(</span><span class="ident" id="7086849">line</span><span class="op" id="7086853">[</span><span class="num" id="7086854">4</span><span class="op" id="7086855">:</span><span class="op" id="7086856">]</span><span class="op" id="7086857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086861">case</span>&nbsp;<span class="ident" id="7086866">strings</span><span class="op" id="7086873">.</span><span class="ident" id="7086874">HasPrefix</span><span class="op" id="7086883">(</span><span class="ident" id="7086884">line</span><span class="op" id="7086888">,</span>&nbsp;<span class="string" id="7086890">&#34;S&nbsp;=&nbsp;&#34;</span><span class="op" id="7086896">)</span><span class="op" id="7086897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086902">s</span>&nbsp;<span class="op" id="7086904">=</span>&nbsp;<span class="ident" id="7086906">fromHex</span><span class="op" id="7086913">(</span><span class="ident" id="7086914">line</span><span class="op" id="7086918">[</span><span class="num" id="7086919">4</span><span class="op" id="7086920">:</span><span class="op" id="7086921">]</span><span class="op" id="7086922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7086926">case</span>&nbsp;<span class="ident" id="7086931">strings</span><span class="op" id="7086938">.</span><span class="ident" id="7086939">HasPrefix</span><span class="op" id="7086948">(</span><span class="ident" id="7086949">line</span><span class="op" id="7086953">,</span>&nbsp;<span class="string" id="7086955">&#34;Result&nbsp;=&nbsp;&#34;</span><span class="op" id="7086966">)</span><span class="op" id="7086967">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7086972">expected</span>&nbsp;<span class="op" id="7086981">:=</span>&nbsp;<span class="ident" id="7086984">line</span><span class="op" id="7086988">[</span><span class="num" id="7086989">9</span><span class="op" id="7086990">]</span>&nbsp;<span class="op" id="7086992">==</span>&nbsp;<span class="string" id="7086995">&#39;P&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087002">h</span><span class="op" id="7087003">.</span><span class="ident" id="7087004">Reset</span><span class="op" id="7087009">(</span><span class="op" id="7087010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087015">h</span><span class="op" id="7087016">.</span><span class="ident" id="7087017">Write</span><span class="op" id="7087022">(</span><span class="ident" id="7087023">msg</span><span class="op" id="7087026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087031">hashed</span>&nbsp;<span class="op" id="7087038">:=</span>&nbsp;<span class="ident" id="7087041">h</span><span class="op" id="7087042">.</span><span class="ident" id="7087043">Sum</span><span class="op" id="7087046">(</span><span class="ident" id="7087047">hashed</span><span class="op" id="7087053">[</span><span class="op" id="7087054">:</span><span class="num" id="7087055">0</span><span class="op" id="7087056">]</span><span class="op" id="7087057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7087062">if</span>&nbsp;<span class="ident" id="7087065">Verify</span><span class="op" id="7087071">(</span><span class="ident" id="7087072">pub</span><span class="op" id="7087075">,</span>&nbsp;<span class="ident" id="7087077">hashed</span><span class="op" id="7087083">,</span>&nbsp;<span class="ident" id="7087085">r</span><span class="op" id="7087086">,</span>&nbsp;<span class="ident" id="7087088">s</span><span class="op" id="7087089">)</span>&nbsp;<span class="op" id="7087091">!=</span>&nbsp;<span class="ident" id="7087094">expected</span>&nbsp;<span class="op" id="7087103">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087109">t</span><span class="op" id="7087110">.</span><span class="ident" id="7087111">Fatalf</span><span class="op" id="7087117">(</span><span class="string" id="7087118">&#34;incorrect&nbsp;result&nbsp;on&nbsp;line&nbsp;%d&#34;</span><span class="op" id="7087147">,</span>&nbsp;<span class="ident" id="7087149">lineNo</span><span class="op" id="7087155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7087164">default</span><span class="op" id="7087171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087176">t</span><span class="op" id="7087177">.</span><span class="ident" id="7087178">Fatalf</span><span class="op" id="7087184">(</span><span class="string" id="7087185">&#34;unknown&nbsp;variable&nbsp;on&nbsp;line&nbsp;%d:&nbsp;%s&#34;</span><span class="op" id="7087218">,</span>&nbsp;<span class="ident" id="7087220">lineNo</span><span class="op" id="7087226">,</span>&nbsp;<span class="ident" id="7087228">line</span><span class="op" id="7087232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087236">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087239">}</span><br>
<span class="lineno"></span><span class="op" id="7087241">}</span>
</div>
</body>
</html>
