<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3167694">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3167749">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3167803">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3167854">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3167912">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3167929">package</span>&nbsp;<span class="ident" id="3167937">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3167942">import</span>&nbsp;<span class="op" id="3167949">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167952">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167961">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167971">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167979">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167990">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3168000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3168003">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3168071">type</span>&nbsp;<span class="ident" id="3168076">Error</span>&nbsp;<span class="keyword" id="3168082">struct</span>&nbsp;<span class="op" id="3168089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168092">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3168096">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168104">URL</span>&nbsp;<span class="builtintype" id="3168108">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168116">Err</span>&nbsp;<span class="builtintype" id="3168120">error</span><br>
<span class="lineno"></span><span class="op" id="3168126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3168129">func</span>&nbsp;<span class="op" id="3168134">(</span><span class="ident" id="3168135">e</span>&nbsp;<span class="op" id="3168137">*</span><span class="ident" id="3168138">Error</span><span class="op" id="3168143">)</span>&nbsp;<span class="ident" id="3168145">Error</span><span class="op" id="3168150">(</span><span class="op" id="3168151">)</span>&nbsp;<span class="builtintype" id="3168153">string</span>&nbsp;<span class="op" id="3168160">{</span>&nbsp;<span class="keyword" id="3168162">return</span>&nbsp;<span class="ident" id="3168169">e</span><span class="op" id="3168170">.</span><span class="ident" id="3168171">Op</span>&nbsp;<span class="op" id="3168174">+</span>&nbsp;<span class="string" id="3168176">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3168180">+</span>&nbsp;<span class="ident" id="3168182">e</span><span class="op" id="3168183">.</span><span class="ident" id="3168184">URL</span>&nbsp;<span class="op" id="3168188">+</span>&nbsp;<span class="string" id="3168190">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3168195">+</span>&nbsp;<span class="ident" id="3168197">e</span><span class="op" id="3168198">.</span><span class="ident" id="3168199">Err</span><span class="op" id="3168202">.</span><span class="ident" id="3168203">Error</span><span class="op" id="3168208">(</span><span class="op" id="3168209">)</span>&nbsp;<span class="op" id="3168211">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3168214">func</span>&nbsp;<span class="ident" id="3168219">ishex</span><span class="op" id="3168224">(</span><span class="ident" id="3168225">c</span>&nbsp;<span class="builtintype" id="3168227">byte</span><span class="op" id="3168231">)</span>&nbsp;<span class="builtintype" id="3168233">bool</span>&nbsp;<span class="op" id="3168238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168241">switch</span>&nbsp;<span class="op" id="3168248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168251">case</span>&nbsp;<span class="string" id="3168256">&#39;0&#39;</span>&nbsp;<span class="op" id="3168260">&lt;=</span>&nbsp;<span class="ident" id="3168263">c</span>&nbsp;<span class="op" id="3168265">&amp;&amp;</span>&nbsp;<span class="ident" id="3168268">c</span>&nbsp;<span class="op" id="3168270">&lt;=</span>&nbsp;<span class="string" id="3168273">&#39;9&#39;</span><span class="op" id="3168276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168280">return</span>&nbsp;<span class="builtintype" id="3168287">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168293">case</span>&nbsp;<span class="string" id="3168298">&#39;a&#39;</span>&nbsp;<span class="op" id="3168302">&lt;=</span>&nbsp;<span class="ident" id="3168305">c</span>&nbsp;<span class="op" id="3168307">&amp;&amp;</span>&nbsp;<span class="ident" id="3168310">c</span>&nbsp;<span class="op" id="3168312">&lt;=</span>&nbsp;<span class="string" id="3168315">&#39;f&#39;</span><span class="op" id="3168318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168322">return</span>&nbsp;<span class="builtintype" id="3168329">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168335">case</span>&nbsp;<span class="string" id="3168340">&#39;A&#39;</span>&nbsp;<span class="op" id="3168344">&lt;=</span>&nbsp;<span class="ident" id="3168347">c</span>&nbsp;<span class="op" id="3168349">&amp;&amp;</span>&nbsp;<span class="ident" id="3168352">c</span>&nbsp;<span class="op" id="3168354">&lt;=</span>&nbsp;<span class="string" id="3168357">&#39;F&#39;</span><span class="op" id="3168360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168364">return</span>&nbsp;<span class="builtintype" id="3168371">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3168377">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168380">return</span>&nbsp;<span class="builtintype" id="3168387">false</span><br>
<span class="lineno"></span><span class="op" id="3168393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3168396">func</span>&nbsp;<span class="ident" id="3168401">unhex</span><span class="op" id="3168406">(</span><span class="ident" id="3168407">c</span>&nbsp;<span class="builtintype" id="3168409">byte</span><span class="op" id="3168413">)</span>&nbsp;<span class="builtintype" id="3168415">byte</span>&nbsp;<span class="op" id="3168420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168423">switch</span>&nbsp;<span class="op" id="3168430">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168433">case</span>&nbsp;<span class="string" id="3168438">&#39;0&#39;</span>&nbsp;<span class="op" id="3168442">&lt;=</span>&nbsp;<span class="ident" id="3168445">c</span>&nbsp;<span class="op" id="3168447">&amp;&amp;</span>&nbsp;<span class="ident" id="3168450">c</span>&nbsp;<span class="op" id="3168452">&lt;=</span>&nbsp;<span class="string" id="3168455">&#39;9&#39;</span><span class="op" id="3168458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168462">return</span>&nbsp;<span class="ident" id="3168469">c</span>&nbsp;<span class="op" id="3168471">-</span>&nbsp;<span class="string" id="3168473">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168478">case</span>&nbsp;<span class="string" id="3168483">&#39;a&#39;</span>&nbsp;<span class="op" id="3168487">&lt;=</span>&nbsp;<span class="ident" id="3168490">c</span>&nbsp;<span class="op" id="3168492">&amp;&amp;</span>&nbsp;<span class="ident" id="3168495">c</span>&nbsp;<span class="op" id="3168497">&lt;=</span>&nbsp;<span class="string" id="3168500">&#39;f&#39;</span><span class="op" id="3168503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168507">return</span>&nbsp;<span class="ident" id="3168514">c</span>&nbsp;<span class="op" id="3168516">-</span>&nbsp;<span class="string" id="3168518">&#39;a&#39;</span>&nbsp;<span class="op" id="3168522">+</span>&nbsp;<span class="num" id="3168524">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168528">case</span>&nbsp;<span class="string" id="3168533">&#39;A&#39;</span>&nbsp;<span class="op" id="3168537">&lt;=</span>&nbsp;<span class="ident" id="3168540">c</span>&nbsp;<span class="op" id="3168542">&amp;&amp;</span>&nbsp;<span class="ident" id="3168545">c</span>&nbsp;<span class="op" id="3168547">&lt;=</span>&nbsp;<span class="string" id="3168550">&#39;F&#39;</span><span class="op" id="3168553">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168557">return</span>&nbsp;<span class="ident" id="3168564">c</span>&nbsp;<span class="op" id="3168566">-</span>&nbsp;<span class="string" id="3168568">&#39;A&#39;</span>&nbsp;<span class="op" id="3168572">+</span>&nbsp;<span class="num" id="3168574">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3168578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168581">return</span>&nbsp;<span class="num" id="3168588">0</span><br>
<span class="lineno"></span><span class="op" id="3168590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3168593">type</span>&nbsp;<span class="ident" id="3168598">encoding</span>&nbsp;<span class="builtintype" id="3168607">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3168612">const</span>&nbsp;<span class="op" id="3168618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168621">encodePath</span>&nbsp;<span class="ident" id="3168632">encoding</span>&nbsp;<span class="op" id="3168641">=</span>&nbsp;<span class="num" id="3168643">1</span>&nbsp;<span class="op" id="3168645">+</span>&nbsp;<span class="ident" id="3168647">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168653">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168673">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168695">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3168710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3168713">type</span>&nbsp;<span class="ident" id="3168718">EscapeError</span>&nbsp;<span class="builtintype" id="3168730">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3168738">func</span>&nbsp;<span class="op" id="3168743">(</span><span class="ident" id="3168744">e</span>&nbsp;<span class="ident" id="3168746">EscapeError</span><span class="op" id="3168757">)</span>&nbsp;<span class="ident" id="3168759">Error</span><span class="op" id="3168764">(</span><span class="op" id="3168765">)</span>&nbsp;<span class="builtintype" id="3168767">string</span>&nbsp;<span class="op" id="3168774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168777">return</span>&nbsp;<span class="string" id="3168784">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3168806">+</span>&nbsp;<span class="ident" id="3168808">strconv</span><span class="op" id="3168815">.</span><span class="ident" id="3168816">Quote</span><span class="op" id="3168821">(</span><span class="builtintype" id="3168822">string</span><span class="op" id="3168828">(</span><span class="ident" id="3168829">e</span><span class="op" id="3168830">)</span><span class="op" id="3168831">)</span><br>
<span class="lineno"></span><span class="op" id="3168833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3168836">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3168901">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3168954">func</span>&nbsp;<span class="ident" id="3168959">shouldEscape</span><span class="op" id="3168971">(</span><span class="ident" id="3168972">c</span>&nbsp;<span class="builtintype" id="3168974">byte</span><span class="op" id="3168978">,</span>&nbsp;<span class="ident" id="3168980">mode</span>&nbsp;<span class="ident" id="3168985">encoding</span><span class="op" id="3168993">)</span>&nbsp;<span class="builtintype" id="3168995">bool</span>&nbsp;<span class="op" id="3169000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169003">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169046">if</span>&nbsp;<span class="string" id="3169049">&#39;A&#39;</span>&nbsp;<span class="op" id="3169053">&lt;=</span>&nbsp;<span class="ident" id="3169056">c</span>&nbsp;<span class="op" id="3169058">&amp;&amp;</span>&nbsp;<span class="ident" id="3169061">c</span>&nbsp;<span class="op" id="3169063">&lt;=</span>&nbsp;<span class="string" id="3169066">&#39;Z&#39;</span>&nbsp;<span class="op" id="3169070">||</span>&nbsp;<span class="string" id="3169073">&#39;a&#39;</span>&nbsp;<span class="op" id="3169077">&lt;=</span>&nbsp;<span class="ident" id="3169080">c</span>&nbsp;<span class="op" id="3169082">&amp;&amp;</span>&nbsp;<span class="ident" id="3169085">c</span>&nbsp;<span class="op" id="3169087">&lt;=</span>&nbsp;<span class="string" id="3169090">&#39;z&#39;</span>&nbsp;<span class="op" id="3169094">||</span>&nbsp;<span class="string" id="3169097">&#39;0&#39;</span>&nbsp;<span class="op" id="3169101">&lt;=</span>&nbsp;<span class="ident" id="3169104">c</span>&nbsp;<span class="op" id="3169106">&amp;&amp;</span>&nbsp;<span class="ident" id="3169109">c</span>&nbsp;<span class="op" id="3169111">&lt;=</span>&nbsp;<span class="string" id="3169114">&#39;9&#39;</span>&nbsp;<span class="op" id="3169118">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169122">return</span>&nbsp;<span class="builtintype" id="3169129">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169140">switch</span>&nbsp;<span class="ident" id="3169147">c</span>&nbsp;<span class="op" id="3169149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169152">case</span>&nbsp;<span class="string" id="3169157">&#39;-&#39;</span><span class="op" id="3169160">,</span>&nbsp;<span class="string" id="3169162">&#39;_&#39;</span><span class="op" id="3169165">,</span>&nbsp;<span class="string" id="3169167">&#39;.&#39;</span><span class="op" id="3169170">,</span>&nbsp;<span class="string" id="3169172">&#39;~&#39;</span><span class="op" id="3169175">:</span>&nbsp;<span class="comment" id="3169177">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169217">return</span>&nbsp;<span class="builtintype" id="3169224">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169232">case</span>&nbsp;<span class="string" id="3169237">&#39;$&#39;</span><span class="op" id="3169240">,</span>&nbsp;<span class="string" id="3169242">&#39;&amp;&#39;</span><span class="op" id="3169245">,</span>&nbsp;<span class="string" id="3169247">&#39;+&#39;</span><span class="op" id="3169250">,</span>&nbsp;<span class="string" id="3169252">&#39;,&#39;</span><span class="op" id="3169255">,</span>&nbsp;<span class="string" id="3169257">&#39;/&#39;</span><span class="op" id="3169260">,</span>&nbsp;<span class="string" id="3169262">&#39;:&#39;</span><span class="op" id="3169265">,</span>&nbsp;<span class="string" id="3169267">&#39;;&#39;</span><span class="op" id="3169270">,</span>&nbsp;<span class="string" id="3169272">&#39;=&#39;</span><span class="op" id="3169275">,</span>&nbsp;<span class="string" id="3169277">&#39;?&#39;</span><span class="op" id="3169280">,</span>&nbsp;<span class="string" id="3169282">&#39;@&#39;</span><span class="op" id="3169285">:</span>&nbsp;<span class="comment" id="3169287">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169329">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169379">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169429">switch</span>&nbsp;<span class="ident" id="3169436">mode</span>&nbsp;<span class="op" id="3169441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169445">case</span>&nbsp;<span class="ident" id="3169450">encodePath</span><span class="op" id="3169460">:</span>&nbsp;<span class="comment" id="3169462">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169474">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169537">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169593">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169655">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169709">return</span>&nbsp;<span class="ident" id="3169716">c</span>&nbsp;<span class="op" id="3169718">==</span>&nbsp;<span class="string" id="3169721">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169728">case</span>&nbsp;<span class="ident" id="3169733">encodeUserPassword</span><span class="op" id="3169751">:</span>&nbsp;<span class="comment" id="3169753">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169767">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169829">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169887">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169957">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169973">return</span>&nbsp;<span class="ident" id="3169980">c</span>&nbsp;<span class="op" id="3169982">==</span>&nbsp;<span class="string" id="3169985">&#39;@&#39;</span>&nbsp;<span class="op" id="3169989">||</span>&nbsp;<span class="ident" id="3169992">c</span>&nbsp;<span class="op" id="3169994">==</span>&nbsp;<span class="string" id="3169997">&#39;/&#39;</span>&nbsp;<span class="op" id="3170001">||</span>&nbsp;<span class="ident" id="3170004">c</span>&nbsp;<span class="op" id="3170006">==</span>&nbsp;<span class="string" id="3170009">&#39;?&#39;</span>&nbsp;<span class="op" id="3170013">||</span>&nbsp;<span class="ident" id="3170016">c</span>&nbsp;<span class="op" id="3170018">==</span>&nbsp;<span class="string" id="3170021">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170028">case</span>&nbsp;<span class="ident" id="3170033">encodeQueryComponent</span><span class="op" id="3170053">:</span>&nbsp;<span class="comment" id="3170055">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3170067">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170122">return</span>&nbsp;<span class="builtintype" id="3170129">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170137">case</span>&nbsp;<span class="ident" id="3170142">encodeFragment</span><span class="op" id="3170156">:</span>&nbsp;<span class="comment" id="3170158">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3170170">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3170222">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170259">return</span>&nbsp;<span class="builtintype" id="3170266">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170277">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3170281">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170318">return</span>&nbsp;<span class="builtintype" id="3170325">true</span><br>
<span class="lineno"></span><span class="op" id="3170330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3170333">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3170409">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3170484">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3170536">func</span>&nbsp;<span class="ident" id="3170541">QueryUnescape</span><span class="op" id="3170554">(</span><span class="ident" id="3170555">s</span>&nbsp;<span class="builtintype" id="3170557">string</span><span class="op" id="3170563">)</span>&nbsp;<span class="op" id="3170565">(</span><span class="builtintype" id="3170566">string</span><span class="op" id="3170572">,</span>&nbsp;<span class="builtintype" id="3170574">error</span><span class="op" id="3170579">)</span>&nbsp;<span class="op" id="3170581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170584">return</span>&nbsp;<span class="ident" id="3170591">unescape</span><span class="op" id="3170599">(</span><span class="ident" id="3170600">s</span><span class="op" id="3170601">,</span>&nbsp;<span class="ident" id="3170603">encodeQueryComponent</span><span class="op" id="3170623">)</span><br>
<span class="lineno">115</span><span class="op" id="3170625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170628">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3170679">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3170734">func</span>&nbsp;<span class="ident" id="3170739">unescape</span><span class="op" id="3170747">(</span><span class="ident" id="3170748">s</span>&nbsp;<span class="builtintype" id="3170750">string</span><span class="op" id="3170756">,</span>&nbsp;<span class="ident" id="3170758">mode</span>&nbsp;<span class="ident" id="3170763">encoding</span><span class="op" id="3170771">)</span>&nbsp;<span class="op" id="3170773">(</span><span class="builtintype" id="3170774">string</span><span class="op" id="3170780">,</span>&nbsp;<span class="builtintype" id="3170782">error</span><span class="op" id="3170787">)</span>&nbsp;<span class="op" id="3170789">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3170792">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170837">n</span>&nbsp;<span class="op" id="3170839">:=</span>&nbsp;<span class="num" id="3170842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170845">hasPlus</span>&nbsp;<span class="op" id="3170853">:=</span>&nbsp;<span class="builtintype" id="3170856">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170863">for</span>&nbsp;<span class="ident" id="3170867">i</span>&nbsp;<span class="op" id="3170869">:=</span>&nbsp;<span class="num" id="3170872">0</span><span class="op" id="3170873">;</span>&nbsp;<span class="ident" id="3170875">i</span>&nbsp;<span class="op" id="3170877">&lt;</span>&nbsp;<span class="builtinfunc" id="3170879">len</span><span class="op" id="3170882">(</span><span class="ident" id="3170883">s</span><span class="op" id="3170884">)</span><span class="op" id="3170885">;</span>&nbsp;<span class="op" id="3170887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170891">switch</span>&nbsp;<span class="ident" id="3170898">s</span><span class="op" id="3170899">[</span><span class="ident" id="3170900">i</span><span class="op" id="3170901">]</span>&nbsp;<span class="op" id="3170903">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170907">case</span>&nbsp;<span class="string" id="3170912">&#39;%&#39;</span><span class="op" id="3170915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170920">n</span><span class="op" id="3170921">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170927">if</span>&nbsp;<span class="ident" id="3170930">i</span><span class="op" id="3170931">+</span><span class="num" id="3170932">2</span>&nbsp;<span class="op" id="3170934">&gt;=</span>&nbsp;<span class="builtinfunc" id="3170937">len</span><span class="op" id="3170940">(</span><span class="ident" id="3170941">s</span><span class="op" id="3170942">)</span>&nbsp;<span class="op" id="3170944">||</span>&nbsp;<span class="op" id="3170947">!</span><span class="ident" id="3170948">ishex</span><span class="op" id="3170953">(</span><span class="ident" id="3170954">s</span><span class="op" id="3170955">[</span><span class="ident" id="3170956">i</span><span class="op" id="3170957">+</span><span class="num" id="3170958">1</span><span class="op" id="3170959">]</span><span class="op" id="3170960">)</span>&nbsp;<span class="op" id="3170962">||</span>&nbsp;<span class="op" id="3170965">!</span><span class="ident" id="3170966">ishex</span><span class="op" id="3170971">(</span><span class="ident" id="3170972">s</span><span class="op" id="3170973">[</span><span class="ident" id="3170974">i</span><span class="op" id="3170975">+</span><span class="num" id="3170976">2</span><span class="op" id="3170977">]</span><span class="op" id="3170978">)</span>&nbsp;<span class="op" id="3170980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170986">s</span>&nbsp;<span class="op" id="3170988">=</span>&nbsp;<span class="ident" id="3170990">s</span><span class="op" id="3170991">[</span><span class="ident" id="3170992">i</span><span class="op" id="3170993">:</span><span class="op" id="3170994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171000">if</span>&nbsp;<span class="builtinfunc" id="3171003">len</span><span class="op" id="3171006">(</span><span class="ident" id="3171007">s</span><span class="op" id="3171008">)</span>&nbsp;<span class="op" id="3171010">&gt;</span>&nbsp;<span class="num" id="3171012">3</span>&nbsp;<span class="op" id="3171014">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171021">s</span>&nbsp;<span class="op" id="3171023">=</span>&nbsp;<span class="ident" id="3171025">s</span><span class="op" id="3171026">[</span><span class="num" id="3171027">0</span><span class="op" id="3171028">:</span><span class="num" id="3171029">3</span><span class="op" id="3171030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171042">return</span>&nbsp;<span class="string" id="3171049">&#34;&#34;</span><span class="op" id="3171051">,</span>&nbsp;<span class="ident" id="3171053">EscapeError</span><span class="op" id="3171064">(</span><span class="ident" id="3171065">s</span><span class="op" id="3171066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171076">i</span>&nbsp;<span class="op" id="3171078">+=</span>&nbsp;<span class="num" id="3171081">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171085">case</span>&nbsp;<span class="string" id="3171090">&#39;+&#39;</span><span class="op" id="3171093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171098">hasPlus</span>&nbsp;<span class="op" id="3171106">=</span>&nbsp;<span class="ident" id="3171108">mode</span>&nbsp;<span class="op" id="3171113">==</span>&nbsp;<span class="ident" id="3171116">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171140">i</span><span class="op" id="3171141">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171146">default</span><span class="op" id="3171153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171158">i</span><span class="op" id="3171159">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171171">if</span>&nbsp;<span class="ident" id="3171174">n</span>&nbsp;<span class="op" id="3171176">==</span>&nbsp;<span class="num" id="3171179">0</span>&nbsp;<span class="op" id="3171181">&amp;&amp;</span>&nbsp;<span class="op" id="3171184">!</span><span class="ident" id="3171185">hasPlus</span>&nbsp;<span class="op" id="3171193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171197">return</span>&nbsp;<span class="ident" id="3171204">s</span><span class="op" id="3171205">,</span>&nbsp;<span class="builtintype" id="3171207">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171216">t</span>&nbsp;<span class="op" id="3171218">:=</span>&nbsp;<span class="builtinfunc" id="3171221">make</span><span class="op" id="3171225">(</span><span class="op" id="3171226">[</span><span class="op" id="3171227">]</span><span class="builtintype" id="3171228">byte</span><span class="op" id="3171232">,</span>&nbsp;<span class="builtinfunc" id="3171234">len</span><span class="op" id="3171237">(</span><span class="ident" id="3171238">s</span><span class="op" id="3171239">)</span><span class="op" id="3171240">-</span><span class="num" id="3171241">2</span><span class="op" id="3171242">*</span><span class="ident" id="3171243">n</span><span class="op" id="3171244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171247">j</span>&nbsp;<span class="op" id="3171249">:=</span>&nbsp;<span class="num" id="3171252">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171255">for</span>&nbsp;<span class="ident" id="3171259">i</span>&nbsp;<span class="op" id="3171261">:=</span>&nbsp;<span class="num" id="3171264">0</span><span class="op" id="3171265">;</span>&nbsp;<span class="ident" id="3171267">i</span>&nbsp;<span class="op" id="3171269">&lt;</span>&nbsp;<span class="builtinfunc" id="3171271">len</span><span class="op" id="3171274">(</span><span class="ident" id="3171275">s</span><span class="op" id="3171276">)</span><span class="op" id="3171277">;</span>&nbsp;<span class="op" id="3171279">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171283">switch</span>&nbsp;<span class="ident" id="3171290">s</span><span class="op" id="3171291">[</span><span class="ident" id="3171292">i</span><span class="op" id="3171293">]</span>&nbsp;<span class="op" id="3171295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171299">case</span>&nbsp;<span class="string" id="3171304">&#39;%&#39;</span><span class="op" id="3171307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171312">t</span><span class="op" id="3171313">[</span><span class="ident" id="3171314">j</span><span class="op" id="3171315">]</span>&nbsp;<span class="op" id="3171317">=</span>&nbsp;<span class="ident" id="3171319">unhex</span><span class="op" id="3171324">(</span><span class="ident" id="3171325">s</span><span class="op" id="3171326">[</span><span class="ident" id="3171327">i</span><span class="op" id="3171328">+</span><span class="num" id="3171329">1</span><span class="op" id="3171330">]</span><span class="op" id="3171331">)</span><span class="op" id="3171332">&lt;&lt;</span><span class="num" id="3171334">4</span>&nbsp;<span class="op" id="3171336">|</span>&nbsp;<span class="ident" id="3171338">unhex</span><span class="op" id="3171343">(</span><span class="ident" id="3171344">s</span><span class="op" id="3171345">[</span><span class="ident" id="3171346">i</span><span class="op" id="3171347">+</span><span class="num" id="3171348">2</span><span class="op" id="3171349">]</span><span class="op" id="3171350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171355">j</span><span class="op" id="3171356">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171362">i</span>&nbsp;<span class="op" id="3171364">+=</span>&nbsp;<span class="num" id="3171367">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171371">case</span>&nbsp;<span class="string" id="3171376">&#39;+&#39;</span><span class="op" id="3171379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171384">if</span>&nbsp;<span class="ident" id="3171387">mode</span>&nbsp;<span class="op" id="3171392">==</span>&nbsp;<span class="ident" id="3171395">encodeQueryComponent</span>&nbsp;<span class="op" id="3171416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171422">t</span><span class="op" id="3171423">[</span><span class="ident" id="3171424">j</span><span class="op" id="3171425">]</span>&nbsp;<span class="op" id="3171427">=</span>&nbsp;<span class="string" id="3171429">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171436">}</span>&nbsp;<span class="keyword" id="3171438">else</span>&nbsp;<span class="op" id="3171443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171449">t</span><span class="op" id="3171450">[</span><span class="ident" id="3171451">j</span><span class="op" id="3171452">]</span>&nbsp;<span class="op" id="3171454">=</span>&nbsp;<span class="string" id="3171456">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171468">j</span><span class="op" id="3171469">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171475">i</span><span class="op" id="3171476">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171481">default</span><span class="op" id="3171488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171493">t</span><span class="op" id="3171494">[</span><span class="ident" id="3171495">j</span><span class="op" id="3171496">]</span>&nbsp;<span class="op" id="3171498">=</span>&nbsp;<span class="ident" id="3171500">s</span><span class="op" id="3171501">[</span><span class="ident" id="3171502">i</span><span class="op" id="3171503">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171508">j</span><span class="op" id="3171509">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171515">i</span><span class="op" id="3171516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171527">return</span>&nbsp;<span class="builtintype" id="3171534">string</span><span class="op" id="3171540">(</span><span class="ident" id="3171541">t</span><span class="op" id="3171542">)</span><span class="op" id="3171543">,</span>&nbsp;<span class="builtintype" id="3171545">nil</span><br>
<span class="lineno">170</span><span class="op" id="3171549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171552">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3171613">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3171636">func</span>&nbsp;<span class="ident" id="3171641">QueryEscape</span><span class="op" id="3171652">(</span><span class="ident" id="3171653">s</span>&nbsp;<span class="builtintype" id="3171655">string</span><span class="op" id="3171661">)</span>&nbsp;<span class="builtintype" id="3171663">string</span>&nbsp;<span class="op" id="3171670">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171673">return</span>&nbsp;<span class="ident" id="3171680">escape</span><span class="op" id="3171686">(</span><span class="ident" id="3171687">s</span><span class="op" id="3171688">,</span>&nbsp;<span class="ident" id="3171690">encodeQueryComponent</span><span class="op" id="3171710">)</span><br>
<span class="lineno"></span><span class="op" id="3171712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3171715">func</span>&nbsp;<span class="ident" id="3171720">escape</span><span class="op" id="3171726">(</span><span class="ident" id="3171727">s</span>&nbsp;<span class="builtintype" id="3171729">string</span><span class="op" id="3171735">,</span>&nbsp;<span class="ident" id="3171737">mode</span>&nbsp;<span class="ident" id="3171742">encoding</span><span class="op" id="3171750">)</span>&nbsp;<span class="builtintype" id="3171752">string</span>&nbsp;<span class="op" id="3171759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171762">spaceCount</span><span class="op" id="3171772">,</span>&nbsp;<span class="ident" id="3171774">hexCount</span>&nbsp;<span class="op" id="3171783">:=</span>&nbsp;<span class="num" id="3171786">0</span><span class="op" id="3171787">,</span>&nbsp;<span class="num" id="3171789">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171792">for</span>&nbsp;<span class="ident" id="3171796">i</span>&nbsp;<span class="op" id="3171798">:=</span>&nbsp;<span class="num" id="3171801">0</span><span class="op" id="3171802">;</span>&nbsp;<span class="ident" id="3171804">i</span>&nbsp;<span class="op" id="3171806">&lt;</span>&nbsp;<span class="builtinfunc" id="3171808">len</span><span class="op" id="3171811">(</span><span class="ident" id="3171812">s</span><span class="op" id="3171813">)</span><span class="op" id="3171814">;</span>&nbsp;<span class="ident" id="3171816">i</span><span class="op" id="3171817">++</span>&nbsp;<span class="op" id="3171820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171824">c</span>&nbsp;<span class="op" id="3171826">:=</span>&nbsp;<span class="ident" id="3171829">s</span><span class="op" id="3171830">[</span><span class="ident" id="3171831">i</span><span class="op" id="3171832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171836">if</span>&nbsp;<span class="ident" id="3171839">shouldEscape</span><span class="op" id="3171851">(</span><span class="ident" id="3171852">c</span><span class="op" id="3171853">,</span>&nbsp;<span class="ident" id="3171855">mode</span><span class="op" id="3171859">)</span>&nbsp;<span class="op" id="3171861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171866">if</span>&nbsp;<span class="ident" id="3171869">c</span>&nbsp;<span class="op" id="3171871">==</span>&nbsp;<span class="string" id="3171874">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3171878">&amp;&amp;</span>&nbsp;<span class="ident" id="3171881">mode</span>&nbsp;<span class="op" id="3171886">==</span>&nbsp;<span class="ident" id="3171889">encodeQueryComponent</span>&nbsp;<span class="op" id="3171910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171916">spaceCount</span><span class="op" id="3171926">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171932">}</span>&nbsp;<span class="keyword" id="3171934">else</span>&nbsp;<span class="op" id="3171939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171945">hexCount</span><span class="op" id="3171953">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171966">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171970">if</span>&nbsp;<span class="ident" id="3171973">spaceCount</span>&nbsp;<span class="op" id="3171984">==</span>&nbsp;<span class="num" id="3171987">0</span>&nbsp;<span class="op" id="3171989">&amp;&amp;</span>&nbsp;<span class="ident" id="3171992">hexCount</span>&nbsp;<span class="op" id="3172001">==</span>&nbsp;<span class="num" id="3172004">0</span>&nbsp;<span class="op" id="3172006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172010">return</span>&nbsp;<span class="ident" id="3172017">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172024">t</span>&nbsp;<span class="op" id="3172026">:=</span>&nbsp;<span class="builtinfunc" id="3172029">make</span><span class="op" id="3172033">(</span><span class="op" id="3172034">[</span><span class="op" id="3172035">]</span><span class="builtintype" id="3172036">byte</span><span class="op" id="3172040">,</span>&nbsp;<span class="builtinfunc" id="3172042">len</span><span class="op" id="3172045">(</span><span class="ident" id="3172046">s</span><span class="op" id="3172047">)</span><span class="op" id="3172048">+</span><span class="num" id="3172049">2</span><span class="op" id="3172050">*</span><span class="ident" id="3172051">hexCount</span><span class="op" id="3172059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172062">j</span>&nbsp;<span class="op" id="3172064">:=</span>&nbsp;<span class="num" id="3172067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172070">for</span>&nbsp;<span class="ident" id="3172074">i</span>&nbsp;<span class="op" id="3172076">:=</span>&nbsp;<span class="num" id="3172079">0</span><span class="op" id="3172080">;</span>&nbsp;<span class="ident" id="3172082">i</span>&nbsp;<span class="op" id="3172084">&lt;</span>&nbsp;<span class="builtinfunc" id="3172086">len</span><span class="op" id="3172089">(</span><span class="ident" id="3172090">s</span><span class="op" id="3172091">)</span><span class="op" id="3172092">;</span>&nbsp;<span class="ident" id="3172094">i</span><span class="op" id="3172095">++</span>&nbsp;<span class="op" id="3172098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172102">switch</span>&nbsp;<span class="ident" id="3172109">c</span>&nbsp;<span class="op" id="3172111">:=</span>&nbsp;<span class="ident" id="3172114">s</span><span class="op" id="3172115">[</span><span class="ident" id="3172116">i</span><span class="op" id="3172117">]</span><span class="op" id="3172118">;</span>&nbsp;<span class="op" id="3172120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172124">case</span>&nbsp;<span class="ident" id="3172129">c</span>&nbsp;<span class="op" id="3172131">==</span>&nbsp;<span class="string" id="3172134">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3172138">&amp;&amp;</span>&nbsp;<span class="ident" id="3172141">mode</span>&nbsp;<span class="op" id="3172146">==</span>&nbsp;<span class="ident" id="3172149">encodeQueryComponent</span><span class="op" id="3172169">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172174">t</span><span class="op" id="3172175">[</span><span class="ident" id="3172176">j</span><span class="op" id="3172177">]</span>&nbsp;<span class="op" id="3172179">=</span>&nbsp;<span class="string" id="3172181">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172188">j</span><span class="op" id="3172189">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172194">case</span>&nbsp;<span class="ident" id="3172199">shouldEscape</span><span class="op" id="3172211">(</span><span class="ident" id="3172212">c</span><span class="op" id="3172213">,</span>&nbsp;<span class="ident" id="3172215">mode</span><span class="op" id="3172219">)</span><span class="op" id="3172220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172225">t</span><span class="op" id="3172226">[</span><span class="ident" id="3172227">j</span><span class="op" id="3172228">]</span>&nbsp;<span class="op" id="3172230">=</span>&nbsp;<span class="string" id="3172232">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172239">t</span><span class="op" id="3172240">[</span><span class="ident" id="3172241">j</span><span class="op" id="3172242">+</span><span class="num" id="3172243">1</span><span class="op" id="3172244">]</span>&nbsp;<span class="op" id="3172246">=</span>&nbsp;<span class="string" id="3172248">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3172266">[</span><span class="ident" id="3172267">c</span><span class="op" id="3172268">&gt;&gt;</span><span class="num" id="3172270">4</span><span class="op" id="3172271">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172276">t</span><span class="op" id="3172277">[</span><span class="ident" id="3172278">j</span><span class="op" id="3172279">+</span><span class="num" id="3172280">2</span><span class="op" id="3172281">]</span>&nbsp;<span class="op" id="3172283">=</span>&nbsp;<span class="string" id="3172285">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3172303">[</span><span class="ident" id="3172304">c</span><span class="op" id="3172305">&amp;</span><span class="num" id="3172306">15</span><span class="op" id="3172308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172313">j</span>&nbsp;<span class="op" id="3172315">+=</span>&nbsp;<span class="num" id="3172318">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172322">default</span><span class="op" id="3172329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172334">t</span><span class="op" id="3172335">[</span><span class="ident" id="3172336">j</span><span class="op" id="3172337">]</span>&nbsp;<span class="op" id="3172339">=</span>&nbsp;<span class="ident" id="3172341">s</span><span class="op" id="3172342">[</span><span class="ident" id="3172343">i</span><span class="op" id="3172344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172349">j</span><span class="op" id="3172350">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172361">return</span>&nbsp;<span class="builtintype" id="3172368">string</span><span class="op" id="3172374">(</span><span class="ident" id="3172375">t</span><span class="op" id="3172376">)</span><br>
<span class="lineno"></span><span class="op" id="3172378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3172381">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3172446">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3172482">//</span><br>
<span class="lineno"></span><span class="comment" id="3172485">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3172537">//</span><br>
<span class="lineno">220</span><span class="comment" id="3172540">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3172616">//</span><br>
<span class="lineno"></span><span class="comment" id="3172619">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3172655">//</span><br>
<span class="lineno"></span><span class="comment" id="3172658">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3172738">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3172819">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3172903">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3172988">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3173067">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3173149">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3173203">type</span>&nbsp;<span class="ident" id="3173208">URL</span>&nbsp;<span class="keyword" id="3173212">struct</span>&nbsp;<span class="op" id="3173219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173222">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3173231">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173239">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3173248">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3173258">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173282">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3173291">*</span><span class="ident" id="3173292">Userinfo</span>&nbsp;<span class="comment" id="3173301">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173339">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3173348">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3173358">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173380">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3173389">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173397">RawQuery</span>&nbsp;<span class="builtintype" id="3173406">string</span>&nbsp;<span class="comment" id="3173413">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3173451">Fragment</span>&nbsp;<span class="builtintype" id="3173460">string</span>&nbsp;<span class="comment" id="3173467">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3173507">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3173510">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3173570">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3173594">func</span>&nbsp;<span class="ident" id="3173599">User</span><span class="op" id="3173603">(</span><span class="ident" id="3173604">username</span>&nbsp;<span class="builtintype" id="3173613">string</span><span class="op" id="3173619">)</span>&nbsp;<span class="op" id="3173621">*</span><span class="ident" id="3173622">Userinfo</span>&nbsp;<span class="op" id="3173631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3173634">return</span>&nbsp;<span class="op" id="3173641">&amp;</span><span class="ident" id="3173642">Userinfo</span><span class="op" id="3173650">{</span><span class="ident" id="3173651">username</span><span class="op" id="3173659">,</span>&nbsp;<span class="string" id="3173661">&#34;&#34;</span><span class="op" id="3173663">,</span>&nbsp;<span class="builtintype" id="3173665">false</span><span class="op" id="3173670">}</span><br>
<span class="lineno">245</span><span class="op" id="3173672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3173675">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3173743">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3173760">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3173825">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3173879">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3173942">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3174004">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3174068">func</span>&nbsp;<span class="ident" id="3174073">UserPassword</span><span class="op" id="3174085">(</span><span class="ident" id="3174086">username</span><span class="op" id="3174094">,</span>&nbsp;<span class="ident" id="3174096">password</span>&nbsp;<span class="builtintype" id="3174105">string</span><span class="op" id="3174111">)</span>&nbsp;<span class="op" id="3174113">*</span><span class="ident" id="3174114">Userinfo</span>&nbsp;<span class="op" id="3174123">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174126">return</span>&nbsp;<span class="op" id="3174133">&amp;</span><span class="ident" id="3174134">Userinfo</span><span class="op" id="3174142">{</span><span class="ident" id="3174143">username</span><span class="op" id="3174151">,</span>&nbsp;<span class="ident" id="3174153">password</span><span class="op" id="3174161">,</span>&nbsp;<span class="builtintype" id="3174163">true</span><span class="op" id="3174167">}</span><br>
<span class="lineno"></span><span class="op" id="3174169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3174172">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3174239">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3174311">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3174382">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3174412">type</span>&nbsp;<span class="ident" id="3174417">Userinfo</span>&nbsp;<span class="keyword" id="3174426">struct</span>&nbsp;<span class="op" id="3174433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174436">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3174448">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174456">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3174468">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174476">passwordSet</span>&nbsp;<span class="builtintype" id="3174488">bool</span><br>
<span class="lineno"></span><span class="op" id="3174493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3174496">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3174530">func</span>&nbsp;<span class="op" id="3174535">(</span><span class="ident" id="3174536">u</span>&nbsp;<span class="op" id="3174538">*</span><span class="ident" id="3174539">Userinfo</span><span class="op" id="3174547">)</span>&nbsp;<span class="ident" id="3174549">Username</span><span class="op" id="3174557">(</span><span class="op" id="3174558">)</span>&nbsp;<span class="builtintype" id="3174560">string</span>&nbsp;<span class="op" id="3174567">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174570">return</span>&nbsp;<span class="ident" id="3174577">u</span><span class="op" id="3174578">.</span><span class="ident" id="3174579">username</span><br>
<span class="lineno"></span><span class="op" id="3174588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3174591">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3174666">func</span>&nbsp;<span class="op" id="3174671">(</span><span class="ident" id="3174672">u</span>&nbsp;<span class="op" id="3174674">*</span><span class="ident" id="3174675">Userinfo</span><span class="op" id="3174683">)</span>&nbsp;<span class="ident" id="3174685">Password</span><span class="op" id="3174693">(</span><span class="op" id="3174694">)</span>&nbsp;<span class="op" id="3174696">(</span><span class="builtintype" id="3174697">string</span><span class="op" id="3174703">,</span>&nbsp;<span class="builtintype" id="3174705">bool</span><span class="op" id="3174709">)</span>&nbsp;<span class="op" id="3174711">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174714">if</span>&nbsp;<span class="ident" id="3174717">u</span><span class="op" id="3174718">.</span><span class="ident" id="3174719">passwordSet</span>&nbsp;<span class="op" id="3174731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174735">return</span>&nbsp;<span class="ident" id="3174742">u</span><span class="op" id="3174743">.</span><span class="ident" id="3174744">password</span><span class="op" id="3174752">,</span>&nbsp;<span class="builtintype" id="3174754">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174763">return</span>&nbsp;<span class="string" id="3174770">&#34;&#34;</span><span class="op" id="3174772">,</span>&nbsp;<span class="builtintype" id="3174774">false</span><br>
<span class="lineno"></span><span class="op" id="3174780">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3174783">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3174855">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3174884">func</span>&nbsp;<span class="op" id="3174889">(</span><span class="ident" id="3174890">u</span>&nbsp;<span class="op" id="3174892">*</span><span class="ident" id="3174893">Userinfo</span><span class="op" id="3174901">)</span>&nbsp;<span class="ident" id="3174903">String</span><span class="op" id="3174909">(</span><span class="op" id="3174910">)</span>&nbsp;<span class="builtintype" id="3174912">string</span>&nbsp;<span class="op" id="3174919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174922">s</span>&nbsp;<span class="op" id="3174924">:=</span>&nbsp;<span class="ident" id="3174927">escape</span><span class="op" id="3174933">(</span><span class="ident" id="3174934">u</span><span class="op" id="3174935">.</span><span class="ident" id="3174936">username</span><span class="op" id="3174944">,</span>&nbsp;<span class="ident" id="3174946">encodeUserPassword</span><span class="op" id="3174964">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174967">if</span>&nbsp;<span class="ident" id="3174970">u</span><span class="op" id="3174971">.</span><span class="ident" id="3174972">passwordSet</span>&nbsp;<span class="op" id="3174984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174988">s</span>&nbsp;<span class="op" id="3174990">+=</span>&nbsp;<span class="string" id="3174993">&#34;:&#34;</span>&nbsp;<span class="op" id="3174997">+</span>&nbsp;<span class="ident" id="3174999">escape</span><span class="op" id="3175005">(</span><span class="ident" id="3175006">u</span><span class="op" id="3175007">.</span><span class="ident" id="3175008">password</span><span class="op" id="3175016">,</span>&nbsp;<span class="ident" id="3175018">encodeUserPassword</span><span class="op" id="3175036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175042">return</span>&nbsp;<span class="ident" id="3175049">s</span><br>
<span class="lineno"></span><span class="op" id="3175051">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3175054">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3175098">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3175142">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3175197">func</span>&nbsp;<span class="ident" id="3175202">getscheme</span><span class="op" id="3175211">(</span><span class="ident" id="3175212">rawurl</span>&nbsp;<span class="builtintype" id="3175219">string</span><span class="op" id="3175225">)</span>&nbsp;<span class="op" id="3175227">(</span><span class="ident" id="3175228">scheme</span><span class="op" id="3175234">,</span>&nbsp;<span class="ident" id="3175236">path</span>&nbsp;<span class="builtintype" id="3175241">string</span><span class="op" id="3175247">,</span>&nbsp;<span class="ident" id="3175249">err</span>&nbsp;<span class="builtintype" id="3175253">error</span><span class="op" id="3175258">)</span>&nbsp;<span class="op" id="3175260">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175263">for</span>&nbsp;<span class="ident" id="3175267">i</span>&nbsp;<span class="op" id="3175269">:=</span>&nbsp;<span class="num" id="3175272">0</span><span class="op" id="3175273">;</span>&nbsp;<span class="ident" id="3175275">i</span>&nbsp;<span class="op" id="3175277">&lt;</span>&nbsp;<span class="builtinfunc" id="3175279">len</span><span class="op" id="3175282">(</span><span class="ident" id="3175283">rawurl</span><span class="op" id="3175289">)</span><span class="op" id="3175290">;</span>&nbsp;<span class="ident" id="3175292">i</span><span class="op" id="3175293">++</span>&nbsp;<span class="op" id="3175296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3175300">c</span>&nbsp;<span class="op" id="3175302">:=</span>&nbsp;<span class="ident" id="3175305">rawurl</span><span class="op" id="3175311">[</span><span class="ident" id="3175312">i</span><span class="op" id="3175313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175317">switch</span>&nbsp;<span class="op" id="3175324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175328">case</span>&nbsp;<span class="string" id="3175333">&#39;a&#39;</span>&nbsp;<span class="op" id="3175337">&lt;=</span>&nbsp;<span class="ident" id="3175340">c</span>&nbsp;<span class="op" id="3175342">&amp;&amp;</span>&nbsp;<span class="ident" id="3175345">c</span>&nbsp;<span class="op" id="3175347">&lt;=</span>&nbsp;<span class="string" id="3175350">&#39;z&#39;</span>&nbsp;<span class="op" id="3175354">||</span>&nbsp;<span class="string" id="3175357">&#39;A&#39;</span>&nbsp;<span class="op" id="3175361">&lt;=</span>&nbsp;<span class="ident" id="3175364">c</span>&nbsp;<span class="op" id="3175366">&amp;&amp;</span>&nbsp;<span class="ident" id="3175369">c</span>&nbsp;<span class="op" id="3175371">&lt;=</span>&nbsp;<span class="string" id="3175374">&#39;Z&#39;</span><span class="op" id="3175377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3175381">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175397">case</span>&nbsp;<span class="string" id="3175402">&#39;0&#39;</span>&nbsp;<span class="op" id="3175406">&lt;=</span>&nbsp;<span class="ident" id="3175409">c</span>&nbsp;<span class="op" id="3175411">&amp;&amp;</span>&nbsp;<span class="ident" id="3175414">c</span>&nbsp;<span class="op" id="3175416">&lt;=</span>&nbsp;<span class="string" id="3175419">&#39;9&#39;</span>&nbsp;<span class="op" id="3175423">||</span>&nbsp;<span class="ident" id="3175426">c</span>&nbsp;<span class="op" id="3175428">==</span>&nbsp;<span class="string" id="3175431">&#39;+&#39;</span>&nbsp;<span class="op" id="3175435">||</span>&nbsp;<span class="ident" id="3175438">c</span>&nbsp;<span class="op" id="3175440">==</span>&nbsp;<span class="string" id="3175443">&#39;-&#39;</span>&nbsp;<span class="op" id="3175447">||</span>&nbsp;<span class="ident" id="3175450">c</span>&nbsp;<span class="op" id="3175452">==</span>&nbsp;<span class="string" id="3175455">&#39;.&#39;</span><span class="op" id="3175458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175463">if</span>&nbsp;<span class="ident" id="3175466">i</span>&nbsp;<span class="op" id="3175468">==</span>&nbsp;<span class="num" id="3175471">0</span>&nbsp;<span class="op" id="3175473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175479">return</span>&nbsp;<span class="string" id="3175486">&#34;&#34;</span><span class="op" id="3175488">,</span>&nbsp;<span class="ident" id="3175490">rawurl</span><span class="op" id="3175496">,</span>&nbsp;<span class="builtintype" id="3175498">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175509">case</span>&nbsp;<span class="ident" id="3175514">c</span>&nbsp;<span class="op" id="3175516">==</span>&nbsp;<span class="string" id="3175519">&#39;:&#39;</span><span class="op" id="3175522">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175527">if</span>&nbsp;<span class="ident" id="3175530">i</span>&nbsp;<span class="op" id="3175532">==</span>&nbsp;<span class="num" id="3175535">0</span>&nbsp;<span class="op" id="3175537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175543">return</span>&nbsp;<span class="string" id="3175550">&#34;&#34;</span><span class="op" id="3175552">,</span>&nbsp;<span class="string" id="3175554">&#34;&#34;</span><span class="op" id="3175556">,</span>&nbsp;<span class="ident" id="3175558">errors</span><span class="op" id="3175564">.</span><span class="ident" id="3175565">New</span><span class="op" id="3175568">(</span><span class="string" id="3175569">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3175594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175604">return</span>&nbsp;<span class="ident" id="3175611">rawurl</span><span class="op" id="3175617">[</span><span class="num" id="3175618">0</span><span class="op" id="3175619">:</span><span class="ident" id="3175620">i</span><span class="op" id="3175621">]</span><span class="op" id="3175622">,</span>&nbsp;<span class="ident" id="3175624">rawurl</span><span class="op" id="3175630">[</span><span class="ident" id="3175631">i</span><span class="op" id="3175632">+</span><span class="num" id="3175633">1</span><span class="op" id="3175634">:</span><span class="op" id="3175635">]</span><span class="op" id="3175636">,</span>&nbsp;<span class="builtintype" id="3175638">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175644">default</span><span class="op" id="3175651">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3175656">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3175704">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175738">return</span>&nbsp;<span class="string" id="3175745">&#34;&#34;</span><span class="op" id="3175747">,</span>&nbsp;<span class="ident" id="3175749">rawurl</span><span class="op" id="3175755">,</span>&nbsp;<span class="builtintype" id="3175757">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175766">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175769">return</span>&nbsp;<span class="string" id="3175776">&#34;&#34;</span><span class="op" id="3175778">,</span>&nbsp;<span class="ident" id="3175780">rawurl</span><span class="op" id="3175786">,</span>&nbsp;<span class="builtintype" id="3175788">nil</span><br>
<span class="lineno"></span><span class="op" id="3175792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3175795">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3175828">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3175879">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3175904">func</span>&nbsp;<span class="ident" id="3175909">split</span><span class="op" id="3175914">(</span><span class="ident" id="3175915">s</span>&nbsp;<span class="builtintype" id="3175917">string</span><span class="op" id="3175923">,</span>&nbsp;<span class="ident" id="3175925">c</span>&nbsp;<span class="builtintype" id="3175927">string</span><span class="op" id="3175933">,</span>&nbsp;<span class="ident" id="3175935">cutc</span>&nbsp;<span class="builtintype" id="3175940">bool</span><span class="op" id="3175944">)</span>&nbsp;<span class="op" id="3175946">(</span><span class="builtintype" id="3175947">string</span><span class="op" id="3175953">,</span>&nbsp;<span class="builtintype" id="3175955">string</span><span class="op" id="3175961">)</span>&nbsp;<span class="op" id="3175963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3175966">i</span>&nbsp;<span class="op" id="3175968">:=</span>&nbsp;<span class="ident" id="3175971">strings</span><span class="op" id="3175978">.</span><span class="ident" id="3175979">Index</span><span class="op" id="3175984">(</span><span class="ident" id="3175985">s</span><span class="op" id="3175986">,</span>&nbsp;<span class="ident" id="3175988">c</span><span class="op" id="3175989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175992">if</span>&nbsp;<span class="ident" id="3175995">i</span>&nbsp;<span class="op" id="3175997">&lt;</span>&nbsp;<span class="num" id="3175999">0</span>&nbsp;<span class="op" id="3176001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176005">return</span>&nbsp;<span class="ident" id="3176012">s</span><span class="op" id="3176013">,</span>&nbsp;<span class="string" id="3176015">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176022">if</span>&nbsp;<span class="ident" id="3176025">cutc</span>&nbsp;<span class="op" id="3176030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176034">return</span>&nbsp;<span class="ident" id="3176041">s</span><span class="op" id="3176042">[</span><span class="num" id="3176043">0</span><span class="op" id="3176044">:</span><span class="ident" id="3176045">i</span><span class="op" id="3176046">]</span><span class="op" id="3176047">,</span>&nbsp;<span class="ident" id="3176049">s</span><span class="op" id="3176050">[</span><span class="ident" id="3176051">i</span><span class="op" id="3176052">+</span><span class="builtinfunc" id="3176053">len</span><span class="op" id="3176056">(</span><span class="ident" id="3176057">c</span><span class="op" id="3176058">)</span><span class="op" id="3176059">:</span><span class="op" id="3176060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176066">return</span>&nbsp;<span class="ident" id="3176073">s</span><span class="op" id="3176074">[</span><span class="num" id="3176075">0</span><span class="op" id="3176076">:</span><span class="ident" id="3176077">i</span><span class="op" id="3176078">]</span><span class="op" id="3176079">,</span>&nbsp;<span class="ident" id="3176081">s</span><span class="op" id="3176082">[</span><span class="ident" id="3176083">i</span><span class="op" id="3176084">:</span><span class="op" id="3176085">]</span><br>
<span class="lineno">330</span><span class="op" id="3176087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176090">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3176135">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3176178">func</span>&nbsp;<span class="ident" id="3176183">Parse</span><span class="op" id="3176188">(</span><span class="ident" id="3176189">rawurl</span>&nbsp;<span class="builtintype" id="3176196">string</span><span class="op" id="3176202">)</span>&nbsp;<span class="op" id="3176204">(</span><span class="ident" id="3176205">url</span>&nbsp;<span class="op" id="3176209">*</span><span class="ident" id="3176210">URL</span><span class="op" id="3176213">,</span>&nbsp;<span class="ident" id="3176215">err</span>&nbsp;<span class="builtintype" id="3176219">error</span><span class="op" id="3176224">)</span>&nbsp;<span class="op" id="3176226">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3176229">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3176247">u</span><span class="op" id="3176248">,</span>&nbsp;<span class="ident" id="3176250">frag</span>&nbsp;<span class="op" id="3176255">:=</span>&nbsp;<span class="ident" id="3176258">split</span><span class="op" id="3176263">(</span><span class="ident" id="3176264">rawurl</span><span class="op" id="3176270">,</span>&nbsp;<span class="string" id="3176272">&#34;#&#34;</span><span class="op" id="3176275">,</span>&nbsp;<span class="builtintype" id="3176277">true</span><span class="op" id="3176281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176284">if</span>&nbsp;<span class="ident" id="3176287">url</span><span class="op" id="3176290">,</span>&nbsp;<span class="ident" id="3176292">err</span>&nbsp;<span class="op" id="3176296">=</span>&nbsp;<span class="ident" id="3176298">parse</span><span class="op" id="3176303">(</span><span class="ident" id="3176304">u</span><span class="op" id="3176305">,</span>&nbsp;<span class="builtintype" id="3176307">false</span><span class="op" id="3176312">)</span><span class="op" id="3176313">;</span>&nbsp;<span class="ident" id="3176315">err</span>&nbsp;<span class="op" id="3176319">!=</span>&nbsp;<span class="builtintype" id="3176322">nil</span>&nbsp;<span class="op" id="3176326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176330">return</span>&nbsp;<span class="builtintype" id="3176337">nil</span><span class="op" id="3176340">,</span>&nbsp;<span class="ident" id="3176342">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176347">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176350">if</span>&nbsp;<span class="ident" id="3176353">frag</span>&nbsp;<span class="op" id="3176358">==</span>&nbsp;<span class="string" id="3176361">&#34;&#34;</span>&nbsp;<span class="op" id="3176364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176368">return</span>&nbsp;<span class="ident" id="3176375">url</span><span class="op" id="3176378">,</span>&nbsp;<span class="builtintype" id="3176380">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176388">if</span>&nbsp;<span class="ident" id="3176391">url</span><span class="op" id="3176394">.</span><span class="ident" id="3176395">Fragment</span><span class="op" id="3176403">,</span>&nbsp;<span class="ident" id="3176405">err</span>&nbsp;<span class="op" id="3176409">=</span>&nbsp;<span class="ident" id="3176411">unescape</span><span class="op" id="3176419">(</span><span class="ident" id="3176420">frag</span><span class="op" id="3176424">,</span>&nbsp;<span class="ident" id="3176426">encodeFragment</span><span class="op" id="3176440">)</span><span class="op" id="3176441">;</span>&nbsp;<span class="ident" id="3176443">err</span>&nbsp;<span class="op" id="3176447">!=</span>&nbsp;<span class="builtintype" id="3176450">nil</span>&nbsp;<span class="op" id="3176454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176458">return</span>&nbsp;<span class="builtintype" id="3176465">nil</span><span class="op" id="3176468">,</span>&nbsp;<span class="op" id="3176470">&amp;</span><span class="ident" id="3176471">Error</span><span class="op" id="3176476">{</span><span class="string" id="3176477">&#34;parse&#34;</span><span class="op" id="3176484">,</span>&nbsp;<span class="ident" id="3176486">rawurl</span><span class="op" id="3176492">,</span>&nbsp;<span class="ident" id="3176494">err</span><span class="op" id="3176497">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176503">return</span>&nbsp;<span class="ident" id="3176510">url</span><span class="op" id="3176513">,</span>&nbsp;<span class="builtintype" id="3176515">nil</span><br>
<span class="lineno"></span><span class="op" id="3176519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176522">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3176594">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3176666">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3176714">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3176778">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3176852">func</span>&nbsp;<span class="ident" id="3176857">ParseRequestURI</span><span class="op" id="3176872">(</span><span class="ident" id="3176873">rawurl</span>&nbsp;<span class="builtintype" id="3176880">string</span><span class="op" id="3176886">)</span>&nbsp;<span class="op" id="3176888">(</span><span class="ident" id="3176889">url</span>&nbsp;<span class="op" id="3176893">*</span><span class="ident" id="3176894">URL</span><span class="op" id="3176897">,</span>&nbsp;<span class="ident" id="3176899">err</span>&nbsp;<span class="builtintype" id="3176903">error</span><span class="op" id="3176908">)</span>&nbsp;<span class="op" id="3176910">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176913">return</span>&nbsp;<span class="ident" id="3176920">parse</span><span class="op" id="3176925">(</span><span class="ident" id="3176926">rawurl</span><span class="op" id="3176932">,</span>&nbsp;<span class="builtintype" id="3176934">true</span><span class="op" id="3176938">)</span><br>
<span class="lineno"></span><span class="op" id="3176940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3176943">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3177007">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3177086">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3177166">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3177233">func</span>&nbsp;<span class="ident" id="3177238">parse</span><span class="op" id="3177243">(</span><span class="ident" id="3177244">rawurl</span>&nbsp;<span class="builtintype" id="3177251">string</span><span class="op" id="3177257">,</span>&nbsp;<span class="ident" id="3177259">viaRequest</span>&nbsp;<span class="builtintype" id="3177270">bool</span><span class="op" id="3177274">)</span>&nbsp;<span class="op" id="3177276">(</span><span class="ident" id="3177277">url</span>&nbsp;<span class="op" id="3177281">*</span><span class="ident" id="3177282">URL</span><span class="op" id="3177285">,</span>&nbsp;<span class="ident" id="3177287">err</span>&nbsp;<span class="builtintype" id="3177291">error</span><span class="op" id="3177296">)</span>&nbsp;<span class="op" id="3177298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177301">var</span>&nbsp;<span class="ident" id="3177305">rest</span>&nbsp;<span class="builtintype" id="3177310">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177319">if</span>&nbsp;<span class="ident" id="3177322">rawurl</span>&nbsp;<span class="op" id="3177329">==</span>&nbsp;<span class="string" id="3177332">&#34;&#34;</span>&nbsp;<span class="op" id="3177335">&amp;&amp;</span>&nbsp;<span class="ident" id="3177338">viaRequest</span>&nbsp;<span class="op" id="3177349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177353">err</span>&nbsp;<span class="op" id="3177357">=</span>&nbsp;<span class="ident" id="3177359">errors</span><span class="op" id="3177365">.</span><span class="ident" id="3177366">New</span><span class="op" id="3177369">(</span><span class="string" id="3177370">&#34;empty&nbsp;url&#34;</span><span class="op" id="3177381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177385">goto</span>&nbsp;<span class="ident" id="3177390">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177400">url</span>&nbsp;<span class="op" id="3177404">=</span>&nbsp;<span class="builtinfunc" id="3177406">new</span><span class="op" id="3177409">(</span><span class="ident" id="3177410">URL</span><span class="op" id="3177413">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177417">if</span>&nbsp;<span class="ident" id="3177420">rawurl</span>&nbsp;<span class="op" id="3177427">==</span>&nbsp;<span class="string" id="3177430">&#34;*&#34;</span>&nbsp;<span class="op" id="3177434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177438">url</span><span class="op" id="3177441">.</span><span class="ident" id="3177442">Path</span>&nbsp;<span class="op" id="3177447">=</span>&nbsp;<span class="string" id="3177449">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177455">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177463">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3177467">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3177523">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177562">if</span>&nbsp;<span class="ident" id="3177565">url</span><span class="op" id="3177568">.</span><span class="ident" id="3177569">Scheme</span><span class="op" id="3177575">,</span>&nbsp;<span class="ident" id="3177577">rest</span><span class="op" id="3177581">,</span>&nbsp;<span class="ident" id="3177583">err</span>&nbsp;<span class="op" id="3177587">=</span>&nbsp;<span class="ident" id="3177589">getscheme</span><span class="op" id="3177598">(</span><span class="ident" id="3177599">rawurl</span><span class="op" id="3177605">)</span><span class="op" id="3177606">;</span>&nbsp;<span class="ident" id="3177608">err</span>&nbsp;<span class="op" id="3177612">!=</span>&nbsp;<span class="builtintype" id="3177615">nil</span>&nbsp;<span class="op" id="3177619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177623">goto</span>&nbsp;<span class="ident" id="3177628">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177638">url</span><span class="op" id="3177641">.</span><span class="ident" id="3177642">Scheme</span>&nbsp;<span class="op" id="3177649">=</span>&nbsp;<span class="ident" id="3177651">strings</span><span class="op" id="3177658">.</span><span class="ident" id="3177659">ToLower</span><span class="op" id="3177666">(</span><span class="ident" id="3177667">url</span><span class="op" id="3177670">.</span><span class="ident" id="3177671">Scheme</span><span class="op" id="3177677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177681">rest</span><span class="op" id="3177685">,</span>&nbsp;<span class="ident" id="3177687">url</span><span class="op" id="3177690">.</span><span class="ident" id="3177691">RawQuery</span>&nbsp;<span class="op" id="3177700">=</span>&nbsp;<span class="ident" id="3177702">split</span><span class="op" id="3177707">(</span><span class="ident" id="3177708">rest</span><span class="op" id="3177712">,</span>&nbsp;<span class="string" id="3177714">&#34;?&#34;</span><span class="op" id="3177717">,</span>&nbsp;<span class="builtintype" id="3177719">true</span><span class="op" id="3177723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177727">if</span>&nbsp;<span class="op" id="3177730">!</span><span class="ident" id="3177731">strings</span><span class="op" id="3177738">.</span><span class="ident" id="3177739">HasPrefix</span><span class="op" id="3177748">(</span><span class="ident" id="3177749">rest</span><span class="op" id="3177753">,</span>&nbsp;<span class="string" id="3177755">&#34;/&#34;</span><span class="op" id="3177758">)</span>&nbsp;<span class="op" id="3177760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177764">if</span>&nbsp;<span class="ident" id="3177767">url</span><span class="op" id="3177770">.</span><span class="ident" id="3177771">Scheme</span>&nbsp;<span class="op" id="3177778">!=</span>&nbsp;<span class="string" id="3177781">&#34;&#34;</span>&nbsp;<span class="op" id="3177784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3177789">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177846">url</span><span class="op" id="3177849">.</span><span class="ident" id="3177850">Opaque</span>&nbsp;<span class="op" id="3177857">=</span>&nbsp;<span class="ident" id="3177859">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177867">return</span>&nbsp;<span class="ident" id="3177874">url</span><span class="op" id="3177877">,</span>&nbsp;<span class="builtintype" id="3177879">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177889">if</span>&nbsp;<span class="ident" id="3177892">viaRequest</span>&nbsp;<span class="op" id="3177903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3177908">err</span>&nbsp;<span class="op" id="3177912">=</span>&nbsp;<span class="ident" id="3177914">errors</span><span class="op" id="3177920">.</span><span class="ident" id="3177921">New</span><span class="op" id="3177924">(</span><span class="string" id="3177925">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3177950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177955">goto</span>&nbsp;<span class="ident" id="3177960">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177968">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3177971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3177975">if</span>&nbsp;<span class="op" id="3177978">(</span><span class="ident" id="3177979">url</span><span class="op" id="3177982">.</span><span class="ident" id="3177983">Scheme</span>&nbsp;<span class="op" id="3177990">!=</span>&nbsp;<span class="string" id="3177993">&#34;&#34;</span>&nbsp;<span class="op" id="3177996">||</span>&nbsp;<span class="op" id="3177999">!</span><span class="ident" id="3178000">viaRequest</span>&nbsp;<span class="op" id="3178011">&amp;&amp;</span>&nbsp;<span class="op" id="3178014">!</span><span class="ident" id="3178015">strings</span><span class="op" id="3178022">.</span><span class="ident" id="3178023">HasPrefix</span><span class="op" id="3178032">(</span><span class="ident" id="3178033">rest</span><span class="op" id="3178037">,</span>&nbsp;<span class="string" id="3178039">&#34;///&#34;</span><span class="op" id="3178044">)</span><span class="op" id="3178045">)</span>&nbsp;<span class="op" id="3178047">&amp;&amp;</span>&nbsp;<span class="ident" id="3178050">strings</span><span class="op" id="3178057">.</span><span class="ident" id="3178058">HasPrefix</span><span class="op" id="3178067">(</span><span class="ident" id="3178068">rest</span><span class="op" id="3178072">,</span>&nbsp;<span class="string" id="3178074">&#34;//&#34;</span><span class="op" id="3178078">)</span>&nbsp;<span class="op" id="3178080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178084">var</span>&nbsp;<span class="ident" id="3178088">authority</span>&nbsp;<span class="builtintype" id="3178098">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178107">authority</span><span class="op" id="3178116">,</span>&nbsp;<span class="ident" id="3178118">rest</span>&nbsp;<span class="op" id="3178123">=</span>&nbsp;<span class="ident" id="3178125">split</span><span class="op" id="3178130">(</span><span class="ident" id="3178131">rest</span><span class="op" id="3178135">[</span><span class="num" id="3178136">2</span><span class="op" id="3178137">:</span><span class="op" id="3178138">]</span><span class="op" id="3178139">,</span>&nbsp;<span class="string" id="3178141">&#34;/&#34;</span><span class="op" id="3178144">,</span>&nbsp;<span class="builtintype" id="3178146">false</span><span class="op" id="3178151">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178155">url</span><span class="op" id="3178158">.</span><span class="ident" id="3178159">User</span><span class="op" id="3178163">,</span>&nbsp;<span class="ident" id="3178165">url</span><span class="op" id="3178168">.</span><span class="ident" id="3178169">Host</span><span class="op" id="3178173">,</span>&nbsp;<span class="ident" id="3178175">err</span>&nbsp;<span class="op" id="3178179">=</span>&nbsp;<span class="ident" id="3178181">parseAuthority</span><span class="op" id="3178195">(</span><span class="ident" id="3178196">authority</span><span class="op" id="3178205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178209">if</span>&nbsp;<span class="ident" id="3178212">err</span>&nbsp;<span class="op" id="3178216">!=</span>&nbsp;<span class="builtintype" id="3178219">nil</span>&nbsp;<span class="op" id="3178223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178228">goto</span>&nbsp;<span class="ident" id="3178233">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178245">if</span>&nbsp;<span class="ident" id="3178248">strings</span><span class="op" id="3178255">.</span><span class="ident" id="3178256">Contains</span><span class="op" id="3178264">(</span><span class="ident" id="3178265">url</span><span class="op" id="3178268">.</span><span class="ident" id="3178269">Host</span><span class="op" id="3178273">,</span>&nbsp;<span class="string" id="3178275">&#34;%&#34;</span><span class="op" id="3178278">)</span>&nbsp;<span class="op" id="3178280">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178285">err</span>&nbsp;<span class="op" id="3178289">=</span>&nbsp;<span class="ident" id="3178291">errors</span><span class="op" id="3178297">.</span><span class="ident" id="3178298">New</span><span class="op" id="3178301">(</span><span class="string" id="3178302">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3178330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178335">goto</span>&nbsp;<span class="ident" id="3178340">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178354">if</span>&nbsp;<span class="ident" id="3178357">url</span><span class="op" id="3178360">.</span><span class="ident" id="3178361">Path</span><span class="op" id="3178365">,</span>&nbsp;<span class="ident" id="3178367">err</span>&nbsp;<span class="op" id="3178371">=</span>&nbsp;<span class="ident" id="3178373">unescape</span><span class="op" id="3178381">(</span><span class="ident" id="3178382">rest</span><span class="op" id="3178386">,</span>&nbsp;<span class="ident" id="3178388">encodePath</span><span class="op" id="3178398">)</span><span class="op" id="3178399">;</span>&nbsp;<span class="ident" id="3178401">err</span>&nbsp;<span class="op" id="3178405">!=</span>&nbsp;<span class="builtintype" id="3178408">nil</span>&nbsp;<span class="op" id="3178412">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178416">goto</span>&nbsp;<span class="ident" id="3178421">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178431">return</span>&nbsp;<span class="ident" id="3178438">url</span><span class="op" id="3178441">,</span>&nbsp;<span class="builtintype" id="3178443">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3178448">Error</span><span class="op" id="3178453">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178456">return</span>&nbsp;<span class="builtintype" id="3178463">nil</span><span class="op" id="3178466">,</span>&nbsp;<span class="op" id="3178468">&amp;</span><span class="ident" id="3178469">Error</span><span class="op" id="3178474">{</span><span class="string" id="3178475">&#34;parse&#34;</span><span class="op" id="3178482">,</span>&nbsp;<span class="ident" id="3178484">rawurl</span><span class="op" id="3178490">,</span>&nbsp;<span class="ident" id="3178492">err</span><span class="op" id="3178495">}</span><br>
<span class="lineno"></span><span class="op" id="3178497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3178500">func</span>&nbsp;<span class="ident" id="3178505">parseAuthority</span><span class="op" id="3178519">(</span><span class="ident" id="3178520">authority</span>&nbsp;<span class="builtintype" id="3178530">string</span><span class="op" id="3178536">)</span>&nbsp;<span class="op" id="3178538">(</span><span class="ident" id="3178539">user</span>&nbsp;<span class="op" id="3178544">*</span><span class="ident" id="3178545">Userinfo</span><span class="op" id="3178553">,</span>&nbsp;<span class="ident" id="3178555">host</span>&nbsp;<span class="builtintype" id="3178560">string</span><span class="op" id="3178566">,</span>&nbsp;<span class="ident" id="3178568">err</span>&nbsp;<span class="builtintype" id="3178572">error</span><span class="op" id="3178577">)</span>&nbsp;<span class="op" id="3178579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178582">i</span>&nbsp;<span class="op" id="3178584">:=</span>&nbsp;<span class="ident" id="3178587">strings</span><span class="op" id="3178594">.</span><span class="ident" id="3178595">LastIndex</span><span class="op" id="3178604">(</span><span class="ident" id="3178605">authority</span><span class="op" id="3178614">,</span>&nbsp;<span class="string" id="3178616">&#34;@&#34;</span><span class="op" id="3178619">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178622">if</span>&nbsp;<span class="ident" id="3178625">i</span>&nbsp;<span class="op" id="3178627">&lt;</span>&nbsp;<span class="num" id="3178629">0</span>&nbsp;<span class="op" id="3178631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178635">host</span>&nbsp;<span class="op" id="3178640">=</span>&nbsp;<span class="ident" id="3178642">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178665">userinfo</span><span class="op" id="3178673">,</span>&nbsp;<span class="ident" id="3178675">host</span>&nbsp;<span class="op" id="3178680">:=</span>&nbsp;<span class="ident" id="3178683">authority</span><span class="op" id="3178692">[</span><span class="op" id="3178693">:</span><span class="ident" id="3178694">i</span><span class="op" id="3178695">]</span><span class="op" id="3178696">,</span>&nbsp;<span class="ident" id="3178698">authority</span><span class="op" id="3178707">[</span><span class="ident" id="3178708">i</span><span class="op" id="3178709">+</span><span class="num" id="3178710">1</span><span class="op" id="3178711">:</span><span class="op" id="3178712">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178715">if</span>&nbsp;<span class="ident" id="3178718">strings</span><span class="op" id="3178725">.</span><span class="ident" id="3178726">Index</span><span class="op" id="3178731">(</span><span class="ident" id="3178732">userinfo</span><span class="op" id="3178740">,</span>&nbsp;<span class="string" id="3178742">&#34;:&#34;</span><span class="op" id="3178745">)</span>&nbsp;<span class="op" id="3178747">&lt;</span>&nbsp;<span class="num" id="3178749">0</span>&nbsp;<span class="op" id="3178751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178755">if</span>&nbsp;<span class="ident" id="3178758">userinfo</span><span class="op" id="3178766">,</span>&nbsp;<span class="ident" id="3178768">err</span>&nbsp;<span class="op" id="3178772">=</span>&nbsp;<span class="ident" id="3178774">unescape</span><span class="op" id="3178782">(</span><span class="ident" id="3178783">userinfo</span><span class="op" id="3178791">,</span>&nbsp;<span class="ident" id="3178793">encodeUserPassword</span><span class="op" id="3178811">)</span><span class="op" id="3178812">;</span>&nbsp;<span class="ident" id="3178814">err</span>&nbsp;<span class="op" id="3178818">!=</span>&nbsp;<span class="builtintype" id="3178821">nil</span>&nbsp;<span class="op" id="3178825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178843">user</span>&nbsp;<span class="op" id="3178848">=</span>&nbsp;<span class="ident" id="3178850">User</span><span class="op" id="3178854">(</span><span class="ident" id="3178855">userinfo</span><span class="op" id="3178863">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3178866">}</span>&nbsp;<span class="keyword" id="3178868">else</span>&nbsp;<span class="op" id="3178873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3178877">username</span><span class="op" id="3178885">,</span>&nbsp;<span class="ident" id="3178887">password</span>&nbsp;<span class="op" id="3178896">:=</span>&nbsp;<span class="ident" id="3178899">split</span><span class="op" id="3178904">(</span><span class="ident" id="3178905">userinfo</span><span class="op" id="3178913">,</span>&nbsp;<span class="string" id="3178915">&#34;:&#34;</span><span class="op" id="3178918">,</span>&nbsp;<span class="builtintype" id="3178920">true</span><span class="op" id="3178924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3178928">if</span>&nbsp;<span class="ident" id="3178931">username</span><span class="op" id="3178939">,</span>&nbsp;<span class="ident" id="3178941">err</span>&nbsp;<span class="op" id="3178945">=</span>&nbsp;<span class="ident" id="3178947">unescape</span><span class="op" id="3178955">(</span><span class="ident" id="3178956">username</span><span class="op" id="3178964">,</span>&nbsp;<span class="ident" id="3178966">encodeUserPassword</span><span class="op" id="3178984">)</span><span class="op" id="3178985">;</span>&nbsp;<span class="ident" id="3178987">err</span>&nbsp;<span class="op" id="3178991">!=</span>&nbsp;<span class="builtintype" id="3178994">nil</span>&nbsp;<span class="op" id="3178998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3179012">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179016">if</span>&nbsp;<span class="ident" id="3179019">password</span><span class="op" id="3179027">,</span>&nbsp;<span class="ident" id="3179029">err</span>&nbsp;<span class="op" id="3179033">=</span>&nbsp;<span class="ident" id="3179035">unescape</span><span class="op" id="3179043">(</span><span class="ident" id="3179044">password</span><span class="op" id="3179052">,</span>&nbsp;<span class="ident" id="3179054">encodeUserPassword</span><span class="op" id="3179072">)</span><span class="op" id="3179073">;</span>&nbsp;<span class="ident" id="3179075">err</span>&nbsp;<span class="op" id="3179079">!=</span>&nbsp;<span class="builtintype" id="3179082">nil</span>&nbsp;<span class="op" id="3179086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179091">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3179100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3179104">user</span>&nbsp;<span class="op" id="3179109">=</span>&nbsp;<span class="ident" id="3179111">UserPassword</span><span class="op" id="3179123">(</span><span class="ident" id="3179124">username</span><span class="op" id="3179132">,</span>&nbsp;<span class="ident" id="3179134">password</span><span class="op" id="3179142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3179145">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179148">return</span><br>
<span class="lineno"></span><span class="op" id="3179155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3179158">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3179213">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3179258">//</span><br>
<span class="lineno"></span><span class="comment" id="3179261">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3179278">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3179324">//</span><br>
<span class="lineno"></span><span class="comment" id="3179327">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3179384">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3179422">//</span><br>
<span class="lineno"></span><span class="comment" id="3179425">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3179475">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3179522">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3179567">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3179610">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3179667">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3179720">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3179776">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3179825">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3179873">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3179924">func</span>&nbsp;<span class="op" id="3179929">(</span><span class="ident" id="3179930">u</span>&nbsp;<span class="op" id="3179932">*</span><span class="ident" id="3179933">URL</span><span class="op" id="3179936">)</span>&nbsp;<span class="ident" id="3179938">String</span><span class="op" id="3179944">(</span><span class="op" id="3179945">)</span>&nbsp;<span class="builtintype" id="3179947">string</span>&nbsp;<span class="op" id="3179954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179957">var</span>&nbsp;<span class="ident" id="3179961">buf</span>&nbsp;<span class="ident" id="3179965">bytes</span><span class="op" id="3179970">.</span><span class="ident" id="3179971">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3179979">if</span>&nbsp;<span class="ident" id="3179982">u</span><span class="op" id="3179983">.</span><span class="ident" id="3179984">Scheme</span>&nbsp;<span class="op" id="3179991">!=</span>&nbsp;<span class="string" id="3179994">&#34;&#34;</span>&nbsp;<span class="op" id="3179997">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180001">buf</span><span class="op" id="3180004">.</span><span class="ident" id="3180005">WriteString</span><span class="op" id="3180016">(</span><span class="ident" id="3180017">u</span><span class="op" id="3180018">.</span><span class="ident" id="3180019">Scheme</span><span class="op" id="3180025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180029">buf</span><span class="op" id="3180032">.</span><span class="ident" id="3180033">WriteByte</span><span class="op" id="3180042">(</span><span class="string" id="3180043">&#39;:&#39;</span><span class="op" id="3180046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180052">if</span>&nbsp;<span class="ident" id="3180055">u</span><span class="op" id="3180056">.</span><span class="ident" id="3180057">Opaque</span>&nbsp;<span class="op" id="3180064">!=</span>&nbsp;<span class="string" id="3180067">&#34;&#34;</span>&nbsp;<span class="op" id="3180070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180074">buf</span><span class="op" id="3180077">.</span><span class="ident" id="3180078">WriteString</span><span class="op" id="3180089">(</span><span class="ident" id="3180090">u</span><span class="op" id="3180091">.</span><span class="ident" id="3180092">Opaque</span><span class="op" id="3180098">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180101">}</span>&nbsp;<span class="keyword" id="3180103">else</span>&nbsp;<span class="op" id="3180108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180112">if</span>&nbsp;<span class="ident" id="3180115">u</span><span class="op" id="3180116">.</span><span class="ident" id="3180117">Scheme</span>&nbsp;<span class="op" id="3180124">!=</span>&nbsp;<span class="string" id="3180127">&#34;&#34;</span>&nbsp;<span class="op" id="3180130">||</span>&nbsp;<span class="ident" id="3180133">u</span><span class="op" id="3180134">.</span><span class="ident" id="3180135">Host</span>&nbsp;<span class="op" id="3180140">!=</span>&nbsp;<span class="string" id="3180143">&#34;&#34;</span>&nbsp;<span class="op" id="3180146">||</span>&nbsp;<span class="ident" id="3180149">u</span><span class="op" id="3180150">.</span><span class="ident" id="3180151">User</span>&nbsp;<span class="op" id="3180156">!=</span>&nbsp;<span class="builtintype" id="3180159">nil</span>&nbsp;<span class="op" id="3180163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180168">buf</span><span class="op" id="3180171">.</span><span class="ident" id="3180172">WriteString</span><span class="op" id="3180183">(</span><span class="string" id="3180184">&#34;//&#34;</span><span class="op" id="3180188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180193">if</span>&nbsp;<span class="ident" id="3180196">ui</span>&nbsp;<span class="op" id="3180199">:=</span>&nbsp;<span class="ident" id="3180202">u</span><span class="op" id="3180203">.</span><span class="ident" id="3180204">User</span><span class="op" id="3180208">;</span>&nbsp;<span class="ident" id="3180210">ui</span>&nbsp;<span class="op" id="3180213">!=</span>&nbsp;<span class="builtintype" id="3180216">nil</span>&nbsp;<span class="op" id="3180220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180226">buf</span><span class="op" id="3180229">.</span><span class="ident" id="3180230">WriteString</span><span class="op" id="3180241">(</span><span class="ident" id="3180242">ui</span><span class="op" id="3180244">.</span><span class="ident" id="3180245">String</span><span class="op" id="3180251">(</span><span class="op" id="3180252">)</span><span class="op" id="3180253">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180259">buf</span><span class="op" id="3180262">.</span><span class="ident" id="3180263">WriteByte</span><span class="op" id="3180272">(</span><span class="string" id="3180273">&#39;@&#39;</span><span class="op" id="3180276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180286">if</span>&nbsp;<span class="ident" id="3180289">h</span>&nbsp;<span class="op" id="3180291">:=</span>&nbsp;<span class="ident" id="3180294">u</span><span class="op" id="3180295">.</span><span class="ident" id="3180296">Host</span><span class="op" id="3180300">;</span>&nbsp;<span class="ident" id="3180302">h</span>&nbsp;<span class="op" id="3180304">!=</span>&nbsp;<span class="string" id="3180307">&#34;&#34;</span>&nbsp;<span class="op" id="3180310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180316">buf</span><span class="op" id="3180319">.</span><span class="ident" id="3180320">WriteString</span><span class="op" id="3180331">(</span><span class="ident" id="3180332">h</span><span class="op" id="3180333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180338">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180346">if</span>&nbsp;<span class="ident" id="3180349">u</span><span class="op" id="3180350">.</span><span class="ident" id="3180351">Path</span>&nbsp;<span class="op" id="3180356">!=</span>&nbsp;<span class="string" id="3180359">&#34;&#34;</span>&nbsp;<span class="op" id="3180362">&amp;&amp;</span>&nbsp;<span class="ident" id="3180365">u</span><span class="op" id="3180366">.</span><span class="ident" id="3180367">Path</span><span class="op" id="3180371">[</span><span class="num" id="3180372">0</span><span class="op" id="3180373">]</span>&nbsp;<span class="op" id="3180375">!=</span>&nbsp;<span class="string" id="3180378">&#39;/&#39;</span>&nbsp;<span class="op" id="3180382">&amp;&amp;</span>&nbsp;<span class="ident" id="3180385">u</span><span class="op" id="3180386">.</span><span class="ident" id="3180387">Host</span>&nbsp;<span class="op" id="3180392">!=</span>&nbsp;<span class="string" id="3180395">&#34;&#34;</span>&nbsp;<span class="op" id="3180398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180403">buf</span><span class="op" id="3180406">.</span><span class="ident" id="3180407">WriteByte</span><span class="op" id="3180416">(</span><span class="string" id="3180417">&#39;/&#39;</span><span class="op" id="3180420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180428">buf</span><span class="op" id="3180431">.</span><span class="ident" id="3180432">WriteString</span><span class="op" id="3180443">(</span><span class="ident" id="3180444">escape</span><span class="op" id="3180450">(</span><span class="ident" id="3180451">u</span><span class="op" id="3180452">.</span><span class="ident" id="3180453">Path</span><span class="op" id="3180457">,</span>&nbsp;<span class="ident" id="3180459">encodePath</span><span class="op" id="3180469">)</span><span class="op" id="3180470">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180476">if</span>&nbsp;<span class="ident" id="3180479">u</span><span class="op" id="3180480">.</span><span class="ident" id="3180481">RawQuery</span>&nbsp;<span class="op" id="3180490">!=</span>&nbsp;<span class="string" id="3180493">&#34;&#34;</span>&nbsp;<span class="op" id="3180496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180500">buf</span><span class="op" id="3180503">.</span><span class="ident" id="3180504">WriteByte</span><span class="op" id="3180513">(</span><span class="string" id="3180514">&#39;?&#39;</span><span class="op" id="3180517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180521">buf</span><span class="op" id="3180524">.</span><span class="ident" id="3180525">WriteString</span><span class="op" id="3180536">(</span><span class="ident" id="3180537">u</span><span class="op" id="3180538">.</span><span class="ident" id="3180539">RawQuery</span><span class="op" id="3180547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180550">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180553">if</span>&nbsp;<span class="ident" id="3180556">u</span><span class="op" id="3180557">.</span><span class="ident" id="3180558">Fragment</span>&nbsp;<span class="op" id="3180567">!=</span>&nbsp;<span class="string" id="3180570">&#34;&#34;</span>&nbsp;<span class="op" id="3180573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180577">buf</span><span class="op" id="3180580">.</span><span class="ident" id="3180581">WriteByte</span><span class="op" id="3180590">(</span><span class="string" id="3180591">&#39;#&#39;</span><span class="op" id="3180594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3180598">buf</span><span class="op" id="3180601">.</span><span class="ident" id="3180602">WriteString</span><span class="op" id="3180613">(</span><span class="ident" id="3180614">escape</span><span class="op" id="3180620">(</span><span class="ident" id="3180621">u</span><span class="op" id="3180622">.</span><span class="ident" id="3180623">Fragment</span><span class="op" id="3180631">,</span>&nbsp;<span class="ident" id="3180633">encodeFragment</span><span class="op" id="3180647">)</span><span class="op" id="3180648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3180651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3180654">return</span>&nbsp;<span class="ident" id="3180661">buf</span><span class="op" id="3180664">.</span><span class="ident" id="3180665">String</span><span class="op" id="3180671">(</span><span class="op" id="3180672">)</span><br>
<span class="lineno">495</span><span class="op" id="3180674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3180677">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3180726">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3180788">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3180847">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3180870">type</span>&nbsp;<span class="ident" id="3180875">Values</span>&nbsp;<span class="keyword" id="3180882">map</span><span class="op" id="3180885">[</span><span class="builtintype" id="3180886">string</span><span class="op" id="3180892">]</span><span class="op" id="3180893">[</span><span class="op" id="3180894">]</span><span class="builtintype" id="3180895">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3180903">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3180962">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3181025">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3181085">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3181098">func</span>&nbsp;<span class="op" id="3181103">(</span><span class="ident" id="3181104">v</span>&nbsp;<span class="ident" id="3181106">Values</span><span class="op" id="3181112">)</span>&nbsp;<span class="ident" id="3181114">Get</span><span class="op" id="3181117">(</span><span class="ident" id="3181118">key</span>&nbsp;<span class="builtintype" id="3181122">string</span><span class="op" id="3181128">)</span>&nbsp;<span class="builtintype" id="3181130">string</span>&nbsp;<span class="op" id="3181137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3181140">if</span>&nbsp;<span class="ident" id="3181143">v</span>&nbsp;<span class="op" id="3181145">==</span>&nbsp;<span class="builtintype" id="3181148">nil</span>&nbsp;<span class="op" id="3181152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3181156">return</span>&nbsp;<span class="string" id="3181163">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3181167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3181170">vs</span><span class="op" id="3181172">,</span>&nbsp;<span class="ident" id="3181174">ok</span>&nbsp;<span class="op" id="3181177">:=</span>&nbsp;<span class="ident" id="3181180">v</span><span class="op" id="3181181">[</span><span class="ident" id="3181182">key</span><span class="op" id="3181185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3181188">if</span>&nbsp;<span class="op" id="3181191">!</span><span class="ident" id="3181192">ok</span>&nbsp;<span class="op" id="3181195">||</span>&nbsp;<span class="builtinfunc" id="3181198">len</span><span class="op" id="3181201">(</span><span class="ident" id="3181202">vs</span><span class="op" id="3181204">)</span>&nbsp;<span class="op" id="3181206">==</span>&nbsp;<span class="num" id="3181209">0</span>&nbsp;<span class="op" id="3181211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3181215">return</span>&nbsp;<span class="string" id="3181222">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3181226">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3181229">return</span>&nbsp;<span class="ident" id="3181236">vs</span><span class="op" id="3181238">[</span><span class="num" id="3181239">0</span><span class="op" id="3181240">]</span><br>
<span class="lineno"></span><span class="op" id="3181242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3181245">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3181300">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3181311">func</span>&nbsp;<span class="op" id="3181316">(</span><span class="ident" id="3181317">v</span>&nbsp;<span class="ident" id="3181319">Values</span><span class="op" id="3181325">)</span>&nbsp;<span class="ident" id="3181327">Set</span><span class="op" id="3181330">(</span><span class="ident" id="3181331">key</span><span class="op" id="3181334">,</span>&nbsp;<span class="ident" id="3181336">value</span>&nbsp;<span class="builtintype" id="3181342">string</span><span class="op" id="3181348">)</span>&nbsp;<span class="op" id="3181350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3181353">v</span><span class="op" id="3181354">[</span><span class="ident" id="3181355">key</span><span class="op" id="3181358">]</span>&nbsp;<span class="op" id="3181360">=</span>&nbsp;<span class="op" id="3181362">[</span><span class="op" id="3181363">]</span><span class="builtintype" id="3181364">string</span><span class="op" id="3181370">{</span><span class="ident" id="3181371">value</span><span class="op" id="3181376">}</span><br>
<span class="lineno"></span><span class="op" id="3181378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3181381">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3181438">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3181469">func</span>&nbsp;<span class="op" id="3181474">(</span><span class="ident" id="3181475">v</span>&nbsp;<span class="ident" id="3181477">Values</span><span class="op" id="3181483">)</span>&nbsp;<span class="ident" id="3181485">Add</span><span class="op" id="3181488">(</span><span class="ident" id="3181489">key</span><span class="op" id="3181492">,</span>&nbsp;<span class="ident" id="3181494">value</span>&nbsp;<span class="builtintype" id="3181500">string</span><span class="op" id="3181506">)</span>&nbsp;<span class="op" id="3181508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3181511">v</span><span class="op" id="3181512">[</span><span class="ident" id="3181513">key</span><span class="op" id="3181516">]</span>&nbsp;<span class="op" id="3181518">=</span>&nbsp;<span class="builtinfunc" id="3181520">append</span><span class="op" id="3181526">(</span><span class="ident" id="3181527">v</span><span class="op" id="3181528">[</span><span class="ident" id="3181529">key</span><span class="op" id="3181532">]</span><span class="op" id="3181533">,</span>&nbsp;<span class="ident" id="3181535">value</span><span class="op" id="3181540">)</span><br>
<span class="lineno"></span><span class="op" id="3181542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3181545">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3181592">func</span>&nbsp;<span class="op" id="3181597">(</span><span class="ident" id="3181598">v</span>&nbsp;<span class="ident" id="3181600">Values</span><span class="op" id="3181606">)</span>&nbsp;<span class="ident" id="3181608">Del</span><span class="op" id="3181611">(</span><span class="ident" id="3181612">key</span>&nbsp;<span class="builtintype" id="3181616">string</span><span class="op" id="3181622">)</span>&nbsp;<span class="op" id="3181624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3181627">delete</span><span class="op" id="3181633">(</span><span class="ident" id="3181634">v</span><span class="op" id="3181635">,</span>&nbsp;<span class="ident" id="3181637">key</span><span class="op" id="3181640">)</span><br>
<span class="lineno"></span><span class="op" id="3181642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3181645">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3181707">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3181759">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3181821">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3181893">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3181917">func</span>&nbsp;<span class="ident" id="3181922">ParseQuery</span><span class="op" id="3181932">(</span><span class="ident" id="3181933">query</span>&nbsp;<span class="builtintype" id="3181939">string</span><span class="op" id="3181945">)</span>&nbsp;<span class="op" id="3181947">(</span><span class="ident" id="3181948">m</span>&nbsp;<span class="ident" id="3181950">Values</span><span class="op" id="3181956">,</span>&nbsp;<span class="ident" id="3181958">err</span>&nbsp;<span class="builtintype" id="3181962">error</span><span class="op" id="3181967">)</span>&nbsp;<span class="op" id="3181969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3181972">m</span>&nbsp;<span class="op" id="3181974">=</span>&nbsp;<span class="builtinfunc" id="3181976">make</span><span class="op" id="3181980">(</span><span class="ident" id="3181981">Values</span><span class="op" id="3181987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3181990">err</span>&nbsp;<span class="op" id="3181994">=</span>&nbsp;<span class="ident" id="3181996">parseQuery</span><span class="op" id="3182006">(</span><span class="ident" id="3182007">m</span><span class="op" id="3182008">,</span>&nbsp;<span class="ident" id="3182010">query</span><span class="op" id="3182015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182018">return</span><br>
<span class="lineno"></span><span class="op" id="3182025">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3182028">func</span>&nbsp;<span class="ident" id="3182033">parseQuery</span><span class="op" id="3182043">(</span><span class="ident" id="3182044">m</span>&nbsp;<span class="ident" id="3182046">Values</span><span class="op" id="3182052">,</span>&nbsp;<span class="ident" id="3182054">query</span>&nbsp;<span class="builtintype" id="3182060">string</span><span class="op" id="3182066">)</span>&nbsp;<span class="op" id="3182068">(</span><span class="ident" id="3182069">err</span>&nbsp;<span class="builtintype" id="3182073">error</span><span class="op" id="3182078">)</span>&nbsp;<span class="op" id="3182080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182083">for</span>&nbsp;<span class="ident" id="3182087">query</span>&nbsp;<span class="op" id="3182093">!=</span>&nbsp;<span class="string" id="3182096">&#34;&#34;</span>&nbsp;<span class="op" id="3182099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182103">key</span>&nbsp;<span class="op" id="3182107">:=</span>&nbsp;<span class="ident" id="3182110">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182118">if</span>&nbsp;<span class="ident" id="3182121">i</span>&nbsp;<span class="op" id="3182123">:=</span>&nbsp;<span class="ident" id="3182126">strings</span><span class="op" id="3182133">.</span><span class="ident" id="3182134">IndexAny</span><span class="op" id="3182142">(</span><span class="ident" id="3182143">key</span><span class="op" id="3182146">,</span>&nbsp;<span class="string" id="3182148">&#34;&amp;;&#34;</span><span class="op" id="3182152">)</span><span class="op" id="3182153">;</span>&nbsp;<span class="ident" id="3182155">i</span>&nbsp;<span class="op" id="3182157">&gt;=</span>&nbsp;<span class="num" id="3182160">0</span>&nbsp;<span class="op" id="3182162">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182167">key</span><span class="op" id="3182170">,</span>&nbsp;<span class="ident" id="3182172">query</span>&nbsp;<span class="op" id="3182178">=</span>&nbsp;<span class="ident" id="3182180">key</span><span class="op" id="3182183">[</span><span class="op" id="3182184">:</span><span class="ident" id="3182185">i</span><span class="op" id="3182186">]</span><span class="op" id="3182187">,</span>&nbsp;<span class="ident" id="3182189">key</span><span class="op" id="3182192">[</span><span class="ident" id="3182193">i</span><span class="op" id="3182194">+</span><span class="num" id="3182195">1</span><span class="op" id="3182196">:</span><span class="op" id="3182197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182201">}</span>&nbsp;<span class="keyword" id="3182203">else</span>&nbsp;<span class="op" id="3182208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182213">query</span>&nbsp;<span class="op" id="3182219">=</span>&nbsp;<span class="string" id="3182221">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182230">if</span>&nbsp;<span class="ident" id="3182233">key</span>&nbsp;<span class="op" id="3182237">==</span>&nbsp;<span class="string" id="3182240">&#34;&#34;</span>&nbsp;<span class="op" id="3182243">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182248">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182263">value</span>&nbsp;<span class="op" id="3182269">:=</span>&nbsp;<span class="string" id="3182272">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182277">if</span>&nbsp;<span class="ident" id="3182280">i</span>&nbsp;<span class="op" id="3182282">:=</span>&nbsp;<span class="ident" id="3182285">strings</span><span class="op" id="3182292">.</span><span class="ident" id="3182293">Index</span><span class="op" id="3182298">(</span><span class="ident" id="3182299">key</span><span class="op" id="3182302">,</span>&nbsp;<span class="string" id="3182304">&#34;=&#34;</span><span class="op" id="3182307">)</span><span class="op" id="3182308">;</span>&nbsp;<span class="ident" id="3182310">i</span>&nbsp;<span class="op" id="3182312">&gt;=</span>&nbsp;<span class="num" id="3182315">0</span>&nbsp;<span class="op" id="3182317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182322">key</span><span class="op" id="3182325">,</span>&nbsp;<span class="ident" id="3182327">value</span>&nbsp;<span class="op" id="3182333">=</span>&nbsp;<span class="ident" id="3182335">key</span><span class="op" id="3182338">[</span><span class="op" id="3182339">:</span><span class="ident" id="3182340">i</span><span class="op" id="3182341">]</span><span class="op" id="3182342">,</span>&nbsp;<span class="ident" id="3182344">key</span><span class="op" id="3182347">[</span><span class="ident" id="3182348">i</span><span class="op" id="3182349">+</span><span class="num" id="3182350">1</span><span class="op" id="3182351">:</span><span class="op" id="3182352">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182360">key</span><span class="op" id="3182363">,</span>&nbsp;<span class="ident" id="3182365">err1</span>&nbsp;<span class="op" id="3182370">:=</span>&nbsp;<span class="ident" id="3182373">QueryUnescape</span><span class="op" id="3182386">(</span><span class="ident" id="3182387">key</span><span class="op" id="3182390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182394">if</span>&nbsp;<span class="ident" id="3182397">err1</span>&nbsp;<span class="op" id="3182402">!=</span>&nbsp;<span class="builtintype" id="3182405">nil</span>&nbsp;<span class="op" id="3182409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182414">if</span>&nbsp;<span class="ident" id="3182417">err</span>&nbsp;<span class="op" id="3182421">==</span>&nbsp;<span class="builtintype" id="3182424">nil</span>&nbsp;<span class="op" id="3182428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182434">err</span>&nbsp;<span class="op" id="3182438">=</span>&nbsp;<span class="ident" id="3182440">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182453">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182468">value</span><span class="op" id="3182473">,</span>&nbsp;<span class="ident" id="3182475">err1</span>&nbsp;<span class="op" id="3182480">=</span>&nbsp;<span class="ident" id="3182482">QueryUnescape</span><span class="op" id="3182495">(</span><span class="ident" id="3182496">value</span><span class="op" id="3182501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182505">if</span>&nbsp;<span class="ident" id="3182508">err1</span>&nbsp;<span class="op" id="3182513">!=</span>&nbsp;<span class="builtintype" id="3182516">nil</span>&nbsp;<span class="op" id="3182520">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182525">if</span>&nbsp;<span class="ident" id="3182528">err</span>&nbsp;<span class="op" id="3182532">==</span>&nbsp;<span class="builtintype" id="3182535">nil</span>&nbsp;<span class="op" id="3182539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182545">err</span>&nbsp;<span class="op" id="3182549">=</span>&nbsp;<span class="ident" id="3182551">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182575">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182579">m</span><span class="op" id="3182580">[</span><span class="ident" id="3182581">key</span><span class="op" id="3182584">]</span>&nbsp;<span class="op" id="3182586">=</span>&nbsp;<span class="builtinfunc" id="3182588">append</span><span class="op" id="3182594">(</span><span class="ident" id="3182595">m</span><span class="op" id="3182596">[</span><span class="ident" id="3182597">key</span><span class="op" id="3182600">]</span><span class="op" id="3182601">,</span>&nbsp;<span class="ident" id="3182603">value</span><span class="op" id="3182608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182614">return</span>&nbsp;<span class="ident" id="3182621">err</span><br>
<span class="lineno"></span><span class="op" id="3182625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3182628">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3182683">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3182722">func</span>&nbsp;<span class="op" id="3182727">(</span><span class="ident" id="3182728">v</span>&nbsp;<span class="ident" id="3182730">Values</span><span class="op" id="3182736">)</span>&nbsp;<span class="ident" id="3182738">Encode</span><span class="op" id="3182744">(</span><span class="op" id="3182745">)</span>&nbsp;<span class="builtintype" id="3182747">string</span>&nbsp;<span class="op" id="3182754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182757">if</span>&nbsp;<span class="ident" id="3182760">v</span>&nbsp;<span class="op" id="3182762">==</span>&nbsp;<span class="builtintype" id="3182765">nil</span>&nbsp;<span class="op" id="3182769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182773">return</span>&nbsp;<span class="string" id="3182780">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182787">var</span>&nbsp;<span class="ident" id="3182791">buf</span>&nbsp;<span class="ident" id="3182795">bytes</span><span class="op" id="3182800">.</span><span class="ident" id="3182801">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182809">keys</span>&nbsp;<span class="op" id="3182814">:=</span>&nbsp;<span class="builtinfunc" id="3182817">make</span><span class="op" id="3182821">(</span><span class="op" id="3182822">[</span><span class="op" id="3182823">]</span><span class="builtintype" id="3182824">string</span><span class="op" id="3182830">,</span>&nbsp;<span class="num" id="3182832">0</span><span class="op" id="3182833">,</span>&nbsp;<span class="builtinfunc" id="3182835">len</span><span class="op" id="3182838">(</span><span class="ident" id="3182839">v</span><span class="op" id="3182840">)</span><span class="op" id="3182841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182844">for</span>&nbsp;<span class="ident" id="3182848">k</span>&nbsp;<span class="op" id="3182850">:=</span>&nbsp;<span class="keyword" id="3182853">range</span>&nbsp;<span class="ident" id="3182859">v</span>&nbsp;<span class="op" id="3182861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182865">keys</span>&nbsp;<span class="op" id="3182870">=</span>&nbsp;<span class="builtinfunc" id="3182872">append</span><span class="op" id="3182878">(</span><span class="ident" id="3182879">keys</span><span class="op" id="3182883">,</span>&nbsp;<span class="ident" id="3182885">k</span><span class="op" id="3182886">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3182889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182892">sort</span><span class="op" id="3182896">.</span><span class="ident" id="3182897">Strings</span><span class="op" id="3182904">(</span><span class="ident" id="3182905">keys</span><span class="op" id="3182909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182912">for</span>&nbsp;<span class="ident" id="3182916">_</span><span class="op" id="3182917">,</span>&nbsp;<span class="ident" id="3182919">k</span>&nbsp;<span class="op" id="3182921">:=</span>&nbsp;<span class="keyword" id="3182924">range</span>&nbsp;<span class="ident" id="3182930">keys</span>&nbsp;<span class="op" id="3182935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182939">vs</span>&nbsp;<span class="op" id="3182942">:=</span>&nbsp;<span class="ident" id="3182945">v</span><span class="op" id="3182946">[</span><span class="ident" id="3182947">k</span><span class="op" id="3182948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3182952">prefix</span>&nbsp;<span class="op" id="3182959">:=</span>&nbsp;<span class="ident" id="3182962">QueryEscape</span><span class="op" id="3182973">(</span><span class="ident" id="3182974">k</span><span class="op" id="3182975">)</span>&nbsp;<span class="op" id="3182977">+</span>&nbsp;<span class="string" id="3182979">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3182985">for</span>&nbsp;<span class="ident" id="3182989">_</span><span class="op" id="3182990">,</span>&nbsp;<span class="ident" id="3182992">v</span>&nbsp;<span class="op" id="3182994">:=</span>&nbsp;<span class="keyword" id="3182997">range</span>&nbsp;<span class="ident" id="3183003">vs</span>&nbsp;<span class="op" id="3183006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183011">if</span>&nbsp;<span class="ident" id="3183014">buf</span><span class="op" id="3183017">.</span><span class="ident" id="3183018">Len</span><span class="op" id="3183021">(</span><span class="op" id="3183022">)</span>&nbsp;<span class="op" id="3183024">&gt;</span>&nbsp;<span class="num" id="3183026">0</span>&nbsp;<span class="op" id="3183028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183034">buf</span><span class="op" id="3183037">.</span><span class="ident" id="3183038">WriteByte</span><span class="op" id="3183047">(</span><span class="string" id="3183048">&#39;&amp;&#39;</span><span class="op" id="3183051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183061">buf</span><span class="op" id="3183064">.</span><span class="ident" id="3183065">WriteString</span><span class="op" id="3183076">(</span><span class="ident" id="3183077">prefix</span><span class="op" id="3183083">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183088">buf</span><span class="op" id="3183091">.</span><span class="ident" id="3183092">WriteString</span><span class="op" id="3183103">(</span><span class="ident" id="3183104">QueryEscape</span><span class="op" id="3183115">(</span><span class="ident" id="3183116">v</span><span class="op" id="3183117">)</span><span class="op" id="3183118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183128">return</span>&nbsp;<span class="ident" id="3183135">buf</span><span class="op" id="3183138">.</span><span class="ident" id="3183139">String</span><span class="op" id="3183145">(</span><span class="op" id="3183146">)</span><br>
<span class="lineno"></span><span class="op" id="3183148">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3183151">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3183218">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3183249">func</span>&nbsp;<span class="ident" id="3183254">resolvePath</span><span class="op" id="3183265">(</span><span class="ident" id="3183266">base</span><span class="op" id="3183270">,</span>&nbsp;<span class="ident" id="3183272">ref</span>&nbsp;<span class="builtintype" id="3183276">string</span><span class="op" id="3183282">)</span>&nbsp;<span class="builtintype" id="3183284">string</span>&nbsp;<span class="op" id="3183291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183294">var</span>&nbsp;<span class="ident" id="3183298">full</span>&nbsp;<span class="builtintype" id="3183303">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183311">if</span>&nbsp;<span class="ident" id="3183314">ref</span>&nbsp;<span class="op" id="3183318">==</span>&nbsp;<span class="string" id="3183321">&#34;&#34;</span>&nbsp;<span class="op" id="3183324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183328">full</span>&nbsp;<span class="op" id="3183333">=</span>&nbsp;<span class="ident" id="3183335">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183341">}</span>&nbsp;<span class="keyword" id="3183343">else</span>&nbsp;<span class="keyword" id="3183348">if</span>&nbsp;<span class="ident" id="3183351">ref</span><span class="op" id="3183354">[</span><span class="num" id="3183355">0</span><span class="op" id="3183356">]</span>&nbsp;<span class="op" id="3183358">!=</span>&nbsp;<span class="string" id="3183361">&#39;/&#39;</span>&nbsp;<span class="op" id="3183365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183369">i</span>&nbsp;<span class="op" id="3183371">:=</span>&nbsp;<span class="ident" id="3183374">strings</span><span class="op" id="3183381">.</span><span class="ident" id="3183382">LastIndex</span><span class="op" id="3183391">(</span><span class="ident" id="3183392">base</span><span class="op" id="3183396">,</span>&nbsp;<span class="string" id="3183398">&#34;/&#34;</span><span class="op" id="3183401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183405">full</span>&nbsp;<span class="op" id="3183410">=</span>&nbsp;<span class="ident" id="3183412">base</span><span class="op" id="3183416">[</span><span class="op" id="3183417">:</span><span class="ident" id="3183418">i</span><span class="op" id="3183419">+</span><span class="num" id="3183420">1</span><span class="op" id="3183421">]</span>&nbsp;<span class="op" id="3183423">+</span>&nbsp;<span class="ident" id="3183425">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183430">}</span>&nbsp;<span class="keyword" id="3183432">else</span>&nbsp;<span class="op" id="3183437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183441">full</span>&nbsp;<span class="op" id="3183446">=</span>&nbsp;<span class="ident" id="3183448">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183456">if</span>&nbsp;<span class="ident" id="3183459">full</span>&nbsp;<span class="op" id="3183464">==</span>&nbsp;<span class="string" id="3183467">&#34;&#34;</span>&nbsp;<span class="op" id="3183470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183474">return</span>&nbsp;<span class="string" id="3183481">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183488">var</span>&nbsp;<span class="ident" id="3183492">dst</span>&nbsp;<span class="op" id="3183496">[</span><span class="op" id="3183497">]</span><span class="builtintype" id="3183498">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183506">src</span>&nbsp;<span class="op" id="3183510">:=</span>&nbsp;<span class="ident" id="3183513">strings</span><span class="op" id="3183520">.</span><span class="ident" id="3183521">Split</span><span class="op" id="3183526">(</span><span class="ident" id="3183527">full</span><span class="op" id="3183531">,</span>&nbsp;<span class="string" id="3183533">&#34;/&#34;</span><span class="op" id="3183536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183539">for</span>&nbsp;<span class="ident" id="3183543">_</span><span class="op" id="3183544">,</span>&nbsp;<span class="ident" id="3183546">elem</span>&nbsp;<span class="op" id="3183551">:=</span>&nbsp;<span class="keyword" id="3183554">range</span>&nbsp;<span class="ident" id="3183560">src</span>&nbsp;<span class="op" id="3183564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183568">switch</span>&nbsp;<span class="ident" id="3183575">elem</span>&nbsp;<span class="op" id="3183580">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183584">case</span>&nbsp;<span class="string" id="3183589">&#34;.&#34;</span><span class="op" id="3183592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3183597">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183607">case</span>&nbsp;<span class="string" id="3183612">&#34;..&#34;</span><span class="op" id="3183616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183621">if</span>&nbsp;<span class="builtinfunc" id="3183624">len</span><span class="op" id="3183627">(</span><span class="ident" id="3183628">dst</span><span class="op" id="3183631">)</span>&nbsp;<span class="op" id="3183633">&gt;</span>&nbsp;<span class="num" id="3183635">0</span>&nbsp;<span class="op" id="3183637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183643">dst</span>&nbsp;<span class="op" id="3183647">=</span>&nbsp;<span class="ident" id="3183649">dst</span><span class="op" id="3183652">[</span><span class="op" id="3183653">:</span><span class="builtinfunc" id="3183654">len</span><span class="op" id="3183657">(</span><span class="ident" id="3183658">dst</span><span class="op" id="3183661">)</span><span class="op" id="3183662">-</span><span class="num" id="3183663">1</span><span class="op" id="3183664">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183673">default</span><span class="op" id="3183680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183685">dst</span>&nbsp;<span class="op" id="3183689">=</span>&nbsp;<span class="builtinfunc" id="3183691">append</span><span class="op" id="3183697">(</span><span class="ident" id="3183698">dst</span><span class="op" id="3183701">,</span>&nbsp;<span class="ident" id="3183703">elem</span><span class="op" id="3183707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183714">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183717">if</span>&nbsp;<span class="ident" id="3183720">last</span>&nbsp;<span class="op" id="3183725">:=</span>&nbsp;<span class="ident" id="3183728">src</span><span class="op" id="3183731">[</span><span class="builtinfunc" id="3183732">len</span><span class="op" id="3183735">(</span><span class="ident" id="3183736">src</span><span class="op" id="3183739">)</span><span class="op" id="3183740">-</span><span class="num" id="3183741">1</span><span class="op" id="3183742">]</span><span class="op" id="3183743">;</span>&nbsp;<span class="ident" id="3183745">last</span>&nbsp;<span class="op" id="3183750">==</span>&nbsp;<span class="string" id="3183753">&#34;.&#34;</span>&nbsp;<span class="op" id="3183757">||</span>&nbsp;<span class="ident" id="3183760">last</span>&nbsp;<span class="op" id="3183765">==</span>&nbsp;<span class="string" id="3183768">&#34;..&#34;</span>&nbsp;<span class="op" id="3183773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3183777">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3183818">dst</span>&nbsp;<span class="op" id="3183822">=</span>&nbsp;<span class="builtinfunc" id="3183824">append</span><span class="op" id="3183830">(</span><span class="ident" id="3183831">dst</span><span class="op" id="3183834">,</span>&nbsp;<span class="string" id="3183836">&#34;&#34;</span><span class="op" id="3183838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3183841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183844">return</span>&nbsp;<span class="string" id="3183851">&#34;/&#34;</span>&nbsp;<span class="op" id="3183855">+</span>&nbsp;<span class="ident" id="3183857">strings</span><span class="op" id="3183864">.</span><span class="ident" id="3183865">TrimLeft</span><span class="op" id="3183873">(</span><span class="ident" id="3183874">strings</span><span class="op" id="3183881">.</span><span class="ident" id="3183882">Join</span><span class="op" id="3183886">(</span><span class="ident" id="3183887">dst</span><span class="op" id="3183890">,</span>&nbsp;<span class="string" id="3183892">&#34;/&#34;</span><span class="op" id="3183895">)</span><span class="op" id="3183896">,</span>&nbsp;<span class="string" id="3183898">&#34;/&#34;</span><span class="op" id="3183901">)</span><br>
<span class="lineno">640</span><span class="op" id="3183903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3183906">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3183952">func</span>&nbsp;<span class="op" id="3183957">(</span><span class="ident" id="3183958">u</span>&nbsp;<span class="op" id="3183960">*</span><span class="ident" id="3183961">URL</span><span class="op" id="3183964">)</span>&nbsp;<span class="ident" id="3183966">IsAbs</span><span class="op" id="3183971">(</span><span class="op" id="3183972">)</span>&nbsp;<span class="builtintype" id="3183974">bool</span>&nbsp;<span class="op" id="3183979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3183982">return</span>&nbsp;<span class="ident" id="3183989">u</span><span class="op" id="3183990">.</span><span class="ident" id="3183991">Scheme</span>&nbsp;<span class="op" id="3183998">!=</span>&nbsp;<span class="string" id="3184001">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3184004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3184007">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3184079">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3184144">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3184216">func</span>&nbsp;<span class="op" id="3184221">(</span><span class="ident" id="3184222">u</span>&nbsp;<span class="op" id="3184224">*</span><span class="ident" id="3184225">URL</span><span class="op" id="3184228">)</span>&nbsp;<span class="ident" id="3184230">Parse</span><span class="op" id="3184235">(</span><span class="ident" id="3184236">ref</span>&nbsp;<span class="builtintype" id="3184240">string</span><span class="op" id="3184246">)</span>&nbsp;<span class="op" id="3184248">(</span><span class="op" id="3184249">*</span><span class="ident" id="3184250">URL</span><span class="op" id="3184253">,</span>&nbsp;<span class="builtintype" id="3184255">error</span><span class="op" id="3184260">)</span>&nbsp;<span class="op" id="3184262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3184265">refurl</span><span class="op" id="3184271">,</span>&nbsp;<span class="ident" id="3184273">err</span>&nbsp;<span class="op" id="3184277">:=</span>&nbsp;<span class="ident" id="3184280">Parse</span><span class="op" id="3184285">(</span><span class="ident" id="3184286">ref</span><span class="op" id="3184289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3184292">if</span>&nbsp;<span class="ident" id="3184295">err</span>&nbsp;<span class="op" id="3184299">!=</span>&nbsp;<span class="builtintype" id="3184302">nil</span>&nbsp;<span class="op" id="3184306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3184310">return</span>&nbsp;<span class="builtintype" id="3184317">nil</span><span class="op" id="3184320">,</span>&nbsp;<span class="ident" id="3184322">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3184327">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3184330">return</span>&nbsp;<span class="ident" id="3184337">u</span><span class="op" id="3184338">.</span><span class="ident" id="3184339">ResolveReference</span><span class="op" id="3184355">(</span><span class="ident" id="3184356">refurl</span><span class="op" id="3184362">)</span><span class="op" id="3184363">,</span>&nbsp;<span class="builtintype" id="3184365">nil</span><br>
<span class="lineno"></span><span class="op" id="3184369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3184372">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3184441">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3184511">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3184582">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3184651">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3184722">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3184765">func</span>&nbsp;<span class="op" id="3184770">(</span><span class="ident" id="3184771">u</span>&nbsp;<span class="op" id="3184773">*</span><span class="ident" id="3184774">URL</span><span class="op" id="3184777">)</span>&nbsp;<span class="ident" id="3184779">ResolveReference</span><span class="op" id="3184795">(</span><span class="ident" id="3184796">ref</span>&nbsp;<span class="op" id="3184800">*</span><span class="ident" id="3184801">URL</span><span class="op" id="3184804">)</span>&nbsp;<span class="op" id="3184806">*</span><span class="ident" id="3184807">URL</span>&nbsp;<span class="op" id="3184811">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3184814">url</span>&nbsp;<span class="op" id="3184818">:=</span>&nbsp;<span class="op" id="3184821">*</span><span class="ident" id="3184822">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3184827">if</span>&nbsp;<span class="ident" id="3184830">ref</span><span class="op" id="3184833">.</span><span class="ident" id="3184834">Scheme</span>&nbsp;<span class="op" id="3184841">==</span>&nbsp;<span class="string" id="3184844">&#34;&#34;</span>&nbsp;<span class="op" id="3184847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3184851">url</span><span class="op" id="3184854">.</span><span class="ident" id="3184855">Scheme</span>&nbsp;<span class="op" id="3184862">=</span>&nbsp;<span class="ident" id="3184864">u</span><span class="op" id="3184865">.</span><span class="ident" id="3184866">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3184874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3184877">if</span>&nbsp;<span class="ident" id="3184880">ref</span><span class="op" id="3184883">.</span><span class="ident" id="3184884">Scheme</span>&nbsp;<span class="op" id="3184891">!=</span>&nbsp;<span class="string" id="3184894">&#34;&#34;</span>&nbsp;<span class="op" id="3184897">||</span>&nbsp;<span class="ident" id="3184900">ref</span><span class="op" id="3184903">.</span><span class="ident" id="3184904">Host</span>&nbsp;<span class="op" id="3184909">!=</span>&nbsp;<span class="string" id="3184912">&#34;&#34;</span>&nbsp;<span class="op" id="3184915">||</span>&nbsp;<span class="ident" id="3184918">ref</span><span class="op" id="3184921">.</span><span class="ident" id="3184922">User</span>&nbsp;<span class="op" id="3184927">!=</span>&nbsp;<span class="builtintype" id="3184930">nil</span>&nbsp;<span class="op" id="3184934">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3184938">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3184982">url</span><span class="op" id="3184985">.</span><span class="ident" id="3184986">Path</span>&nbsp;<span class="op" id="3184991">=</span>&nbsp;<span class="ident" id="3184993">resolvePath</span><span class="op" id="3185004">(</span><span class="ident" id="3185005">ref</span><span class="op" id="3185008">.</span><span class="ident" id="3185009">Path</span><span class="op" id="3185013">,</span>&nbsp;<span class="string" id="3185015">&#34;&#34;</span><span class="op" id="3185017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185021">return</span>&nbsp;<span class="op" id="3185028">&amp;</span><span class="ident" id="3185029">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185037">if</span>&nbsp;<span class="ident" id="3185040">ref</span><span class="op" id="3185043">.</span><span class="ident" id="3185044">Opaque</span>&nbsp;<span class="op" id="3185051">!=</span>&nbsp;<span class="string" id="3185054">&#34;&#34;</span>&nbsp;<span class="op" id="3185057">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185061">url</span><span class="op" id="3185064">.</span><span class="ident" id="3185065">User</span>&nbsp;<span class="op" id="3185070">=</span>&nbsp;<span class="builtintype" id="3185072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185078">url</span><span class="op" id="3185081">.</span><span class="ident" id="3185082">Host</span>&nbsp;<span class="op" id="3185087">=</span>&nbsp;<span class="string" id="3185089">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185094">url</span><span class="op" id="3185097">.</span><span class="ident" id="3185098">Path</span>&nbsp;<span class="op" id="3185103">=</span>&nbsp;<span class="string" id="3185105">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185110">return</span>&nbsp;<span class="op" id="3185117">&amp;</span><span class="ident" id="3185118">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185123">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185126">if</span>&nbsp;<span class="ident" id="3185129">ref</span><span class="op" id="3185132">.</span><span class="ident" id="3185133">Path</span>&nbsp;<span class="op" id="3185138">==</span>&nbsp;<span class="string" id="3185141">&#34;&#34;</span>&nbsp;<span class="op" id="3185144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185148">if</span>&nbsp;<span class="ident" id="3185151">ref</span><span class="op" id="3185154">.</span><span class="ident" id="3185155">RawQuery</span>&nbsp;<span class="op" id="3185164">==</span>&nbsp;<span class="string" id="3185167">&#34;&#34;</span>&nbsp;<span class="op" id="3185170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185175">url</span><span class="op" id="3185178">.</span><span class="ident" id="3185179">RawQuery</span>&nbsp;<span class="op" id="3185188">=</span>&nbsp;<span class="ident" id="3185190">u</span><span class="op" id="3185191">.</span><span class="ident" id="3185192">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185204">if</span>&nbsp;<span class="ident" id="3185207">ref</span><span class="op" id="3185210">.</span><span class="ident" id="3185211">Fragment</span>&nbsp;<span class="op" id="3185220">==</span>&nbsp;<span class="string" id="3185223">&#34;&#34;</span>&nbsp;<span class="op" id="3185226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185232">url</span><span class="op" id="3185235">.</span><span class="ident" id="3185236">Fragment</span>&nbsp;<span class="op" id="3185245">=</span>&nbsp;<span class="ident" id="3185247">u</span><span class="op" id="3185248">.</span><span class="ident" id="3185249">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3185271">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185311">url</span><span class="op" id="3185314">.</span><span class="ident" id="3185315">Host</span>&nbsp;<span class="op" id="3185320">=</span>&nbsp;<span class="ident" id="3185322">u</span><span class="op" id="3185323">.</span><span class="ident" id="3185324">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185330">url</span><span class="op" id="3185333">.</span><span class="ident" id="3185334">User</span>&nbsp;<span class="op" id="3185339">=</span>&nbsp;<span class="ident" id="3185341">u</span><span class="op" id="3185342">.</span><span class="ident" id="3185343">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185349">url</span><span class="op" id="3185352">.</span><span class="ident" id="3185353">Path</span>&nbsp;<span class="op" id="3185358">=</span>&nbsp;<span class="ident" id="3185360">resolvePath</span><span class="op" id="3185371">(</span><span class="ident" id="3185372">u</span><span class="op" id="3185373">.</span><span class="ident" id="3185374">Path</span><span class="op" id="3185378">,</span>&nbsp;<span class="ident" id="3185380">ref</span><span class="op" id="3185383">.</span><span class="ident" id="3185384">Path</span><span class="op" id="3185388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185391">return</span>&nbsp;<span class="op" id="3185398">&amp;</span><span class="ident" id="3185399">url</span><br>
<span class="lineno"></span><span class="op" id="3185403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3185406">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3185469">func</span>&nbsp;<span class="op" id="3185474">(</span><span class="ident" id="3185475">u</span>&nbsp;<span class="op" id="3185477">*</span><span class="ident" id="3185478">URL</span><span class="op" id="3185481">)</span>&nbsp;<span class="ident" id="3185483">Query</span><span class="op" id="3185488">(</span><span class="op" id="3185489">)</span>&nbsp;<span class="ident" id="3185491">Values</span>&nbsp;<span class="op" id="3185498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185501">v</span><span class="op" id="3185502">,</span>&nbsp;<span class="ident" id="3185504">_</span>&nbsp;<span class="op" id="3185506">:=</span>&nbsp;<span class="ident" id="3185509">ParseQuery</span><span class="op" id="3185519">(</span><span class="ident" id="3185520">u</span><span class="op" id="3185521">.</span><span class="ident" id="3185522">RawQuery</span><span class="op" id="3185530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185533">return</span>&nbsp;<span class="ident" id="3185540">v</span><br>
<span class="lineno"></span><span class="op" id="3185542">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3185545">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3185606">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3185661">func</span>&nbsp;<span class="op" id="3185666">(</span><span class="ident" id="3185667">u</span>&nbsp;<span class="op" id="3185669">*</span><span class="ident" id="3185670">URL</span><span class="op" id="3185673">)</span>&nbsp;<span class="ident" id="3185675">RequestURI</span><span class="op" id="3185685">(</span><span class="op" id="3185686">)</span>&nbsp;<span class="builtintype" id="3185688">string</span>&nbsp;<span class="op" id="3185695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185698">result</span>&nbsp;<span class="op" id="3185705">:=</span>&nbsp;<span class="ident" id="3185708">u</span><span class="op" id="3185709">.</span><span class="ident" id="3185710">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185718">if</span>&nbsp;<span class="ident" id="3185721">result</span>&nbsp;<span class="op" id="3185728">==</span>&nbsp;<span class="string" id="3185731">&#34;&#34;</span>&nbsp;<span class="op" id="3185734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185738">result</span>&nbsp;<span class="op" id="3185745">=</span>&nbsp;<span class="ident" id="3185747">escape</span><span class="op" id="3185753">(</span><span class="ident" id="3185754">u</span><span class="op" id="3185755">.</span><span class="ident" id="3185756">Path</span><span class="op" id="3185760">,</span>&nbsp;<span class="ident" id="3185762">encodePath</span><span class="op" id="3185772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185776">if</span>&nbsp;<span class="ident" id="3185779">result</span>&nbsp;<span class="op" id="3185786">==</span>&nbsp;<span class="string" id="3185789">&#34;&#34;</span>&nbsp;<span class="op" id="3185792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185797">result</span>&nbsp;<span class="op" id="3185804">=</span>&nbsp;<span class="string" id="3185806">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185812">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185815">}</span>&nbsp;<span class="keyword" id="3185817">else</span>&nbsp;<span class="op" id="3185822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185826">if</span>&nbsp;<span class="ident" id="3185829">strings</span><span class="op" id="3185836">.</span><span class="ident" id="3185837">HasPrefix</span><span class="op" id="3185846">(</span><span class="ident" id="3185847">result</span><span class="op" id="3185853">,</span>&nbsp;<span class="string" id="3185855">&#34;//&#34;</span><span class="op" id="3185859">)</span>&nbsp;<span class="op" id="3185861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185866">result</span>&nbsp;<span class="op" id="3185873">=</span>&nbsp;<span class="ident" id="3185875">u</span><span class="op" id="3185876">.</span><span class="ident" id="3185877">Scheme</span>&nbsp;<span class="op" id="3185884">+</span>&nbsp;<span class="string" id="3185886">&#34;:&#34;</span>&nbsp;<span class="op" id="3185890">+</span>&nbsp;<span class="ident" id="3185892">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185904">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185907">if</span>&nbsp;<span class="ident" id="3185910">u</span><span class="op" id="3185911">.</span><span class="ident" id="3185912">RawQuery</span>&nbsp;<span class="op" id="3185921">!=</span>&nbsp;<span class="string" id="3185924">&#34;&#34;</span>&nbsp;<span class="op" id="3185927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3185931">result</span>&nbsp;<span class="op" id="3185938">+=</span>&nbsp;<span class="string" id="3185941">&#34;?&#34;</span>&nbsp;<span class="op" id="3185945">+</span>&nbsp;<span class="ident" id="3185947">u</span><span class="op" id="3185948">.</span><span class="ident" id="3185949">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3185959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3185962">return</span>&nbsp;<span class="ident" id="3185969">result</span><br>
<span class="lineno"></span><span class="op" id="3185976">}</span>
</div>
</body>
</html>
