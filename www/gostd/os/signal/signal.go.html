<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6372308">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6372363">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6372417">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6372468">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6372525">package</span>&nbsp;<span class="ident" id="6372533">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372541">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6372602">import</span>&nbsp;<span class="op" id="6372609">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6372612">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6372618">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6372625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6372628">var</span>&nbsp;<span class="ident" id="6372632">handlers</span>&nbsp;<span class="keyword" id="6372641">struct</span>&nbsp;<span class="op" id="6372648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372651">sync</span><span class="op" id="6372655">.</span><span class="ident" id="6372656">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372663">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6372667">map</span><span class="op" id="6372670">[</span><span class="keyword" id="6372671">chan</span><span class="op" id="6372675">&lt;-</span>&nbsp;<span class="ident" id="6372678">os</span><span class="op" id="6372680">.</span><span class="ident" id="6372681">Signal</span><span class="op" id="6372687">]</span><span class="op" id="6372688">*</span><span class="ident" id="6372689">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372698">ref</span>&nbsp;<span class="op" id="6372702">[</span><span class="ident" id="6372703">numSig</span><span class="op" id="6372709">]</span><span class="ident" id="6372710">int64</span><br>
<span class="lineno"></span><span class="op" id="6372716">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6372719">type</span>&nbsp;<span class="ident" id="6372724">handler</span>&nbsp;<span class="keyword" id="6372732">struct</span>&nbsp;<span class="op" id="6372739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372742">mask</span>&nbsp;<span class="op" id="6372747">[</span><span class="op" id="6372748">(</span><span class="ident" id="6372749">numSig</span>&nbsp;<span class="op" id="6372756">+</span>&nbsp;<span class="num" id="6372758">31</span><span class="op" id="6372760">)</span>&nbsp;<span class="op" id="6372762">/</span>&nbsp;<span class="num" id="6372764">32</span><span class="op" id="6372766">]</span><span class="builtintype" id="6372767">uint32</span><br>
<span class="lineno"></span><span class="op" id="6372774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6372777">func</span>&nbsp;<span class="op" id="6372782">(</span><span class="ident" id="6372783">h</span>&nbsp;<span class="op" id="6372785">*</span><span class="ident" id="6372786">handler</span><span class="op" id="6372793">)</span>&nbsp;<span class="ident" id="6372795">want</span><span class="op" id="6372799">(</span><span class="ident" id="6372800">sig</span>&nbsp;<span class="builtintype" id="6372804">int</span><span class="op" id="6372807">)</span>&nbsp;<span class="builtintype" id="6372809">bool</span>&nbsp;<span class="op" id="6372814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372817">return</span>&nbsp;<span class="op" id="6372824">(</span><span class="ident" id="6372825">h</span><span class="op" id="6372826">.</span><span class="ident" id="6372827">mask</span><span class="op" id="6372831">[</span><span class="ident" id="6372832">sig</span><span class="op" id="6372835">/</span><span class="num" id="6372836">32</span><span class="op" id="6372838">]</span><span class="op" id="6372839">&gt;&gt;</span><span class="builtintype" id="6372841">uint</span><span class="op" id="6372845">(</span><span class="ident" id="6372846">sig</span><span class="op" id="6372849">&amp;</span><span class="num" id="6372850">31</span><span class="op" id="6372852">)</span><span class="op" id="6372853">)</span><span class="op" id="6372854">&amp;</span><span class="num" id="6372855">1</span>&nbsp;<span class="op" id="6372857">!=</span>&nbsp;<span class="num" id="6372860">0</span><br>
<span class="lineno"></span><span class="op" id="6372862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372865">func</span>&nbsp;<span class="op" id="6372870">(</span><span class="ident" id="6372871">h</span>&nbsp;<span class="op" id="6372873">*</span><span class="ident" id="6372874">handler</span><span class="op" id="6372881">)</span>&nbsp;<span class="ident" id="6372883">set</span><span class="op" id="6372886">(</span><span class="ident" id="6372887">sig</span>&nbsp;<span class="builtintype" id="6372891">int</span><span class="op" id="6372894">)</span>&nbsp;<span class="op" id="6372896">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372899">h</span><span class="op" id="6372900">.</span><span class="ident" id="6372901">mask</span><span class="op" id="6372905">[</span><span class="ident" id="6372906">sig</span><span class="op" id="6372909">/</span><span class="num" id="6372910">32</span><span class="op" id="6372912">]</span>&nbsp;<span class="op" id="6372914">|=</span>&nbsp;<span class="num" id="6372917">1</span>&nbsp;<span class="op" id="6372919">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6372922">uint</span><span class="op" id="6372926">(</span><span class="ident" id="6372927">sig</span><span class="op" id="6372930">&amp;</span><span class="num" id="6372931">31</span><span class="op" id="6372933">)</span><br>
<span class="lineno"></span><span class="op" id="6372935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372938">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6373002">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="6373074">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="6373118">//</span><br>
<span class="lineno"></span><span class="comment" id="6373121">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6373191">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6373258">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="6373337">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="6373374">//</span><br>
<span class="lineno"></span><span class="comment" id="6373377">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="6373447">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="6373509">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="6373573">//</span><br>
<span class="lineno"></span><span class="comment" id="6373576">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="6373647">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="6373713">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="6373739">func</span>&nbsp;<span class="ident" id="6373744">Notify</span><span class="op" id="6373750">(</span><span class="ident" id="6373751">c</span>&nbsp;<span class="keyword" id="6373753">chan</span><span class="op" id="6373757">&lt;-</span>&nbsp;<span class="ident" id="6373760">os</span><span class="op" id="6373762">.</span><span class="ident" id="6373763">Signal</span><span class="op" id="6373769">,</span>&nbsp;<span class="ident" id="6373771">sig</span>&nbsp;<span class="op" id="6373775">...</span><span class="ident" id="6373778">os</span><span class="op" id="6373780">.</span><span class="ident" id="6373781">Signal</span><span class="op" id="6373787">)</span>&nbsp;<span class="op" id="6373789">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373792">if</span>&nbsp;<span class="ident" id="6373795">c</span>&nbsp;<span class="op" id="6373797">==</span>&nbsp;<span class="ident" id="6373800">nil</span>&nbsp;<span class="op" id="6373804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6373808">panic</span><span class="op" id="6373813">(</span><span class="string" id="6373814">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="6373851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373858">handlers</span><span class="op" id="6373866">.</span><span class="ident" id="6373867">Lock</span><span class="op" id="6373871">(</span><span class="op" id="6373872">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373875">defer</span>&nbsp;<span class="ident" id="6373881">handlers</span><span class="op" id="6373889">.</span><span class="ident" id="6373890">Unlock</span><span class="op" id="6373896">(</span><span class="op" id="6373897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373901">h</span>&nbsp;<span class="op" id="6373903">:=</span>&nbsp;<span class="ident" id="6373906">handlers</span><span class="op" id="6373914">.</span><span class="ident" id="6373915">m</span><span class="op" id="6373916">[</span><span class="ident" id="6373917">c</span><span class="op" id="6373918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373921">if</span>&nbsp;<span class="ident" id="6373924">h</span>&nbsp;<span class="op" id="6373926">==</span>&nbsp;<span class="ident" id="6373929">nil</span>&nbsp;<span class="op" id="6373933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373937">if</span>&nbsp;<span class="ident" id="6373940">handlers</span><span class="op" id="6373948">.</span><span class="ident" id="6373949">m</span>&nbsp;<span class="op" id="6373951">==</span>&nbsp;<span class="ident" id="6373954">nil</span>&nbsp;<span class="op" id="6373958">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373963">handlers</span><span class="op" id="6373971">.</span><span class="ident" id="6373972">m</span>&nbsp;<span class="op" id="6373974">=</span>&nbsp;<span class="builtinfunc" id="6373976">make</span><span class="op" id="6373980">(</span><span class="keyword" id="6373981">map</span><span class="op" id="6373984">[</span><span class="keyword" id="6373985">chan</span><span class="op" id="6373989">&lt;-</span>&nbsp;<span class="ident" id="6373992">os</span><span class="op" id="6373994">.</span><span class="ident" id="6373995">Signal</span><span class="op" id="6374001">]</span><span class="op" id="6374002">*</span><span class="ident" id="6374003">handler</span><span class="op" id="6374010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374018">h</span>&nbsp;<span class="op" id="6374020">=</span>&nbsp;<span class="builtinfunc" id="6374022">new</span><span class="op" id="6374025">(</span><span class="ident" id="6374026">handler</span><span class="op" id="6374033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374037">handlers</span><span class="op" id="6374045">.</span><span class="ident" id="6374046">m</span><span class="op" id="6374047">[</span><span class="ident" id="6374048">c</span><span class="op" id="6374049">]</span>&nbsp;<span class="op" id="6374051">=</span>&nbsp;<span class="ident" id="6374053">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374056">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374060">add</span>&nbsp;<span class="op" id="6374064">:=</span>&nbsp;<span class="keyword" id="6374067">func</span><span class="op" id="6374071">(</span><span class="ident" id="6374072">n</span>&nbsp;<span class="builtintype" id="6374074">int</span><span class="op" id="6374077">)</span>&nbsp;<span class="op" id="6374079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374083">if</span>&nbsp;<span class="ident" id="6374086">n</span>&nbsp;<span class="op" id="6374088">&lt;</span>&nbsp;<span class="num" id="6374090">0</span>&nbsp;<span class="op" id="6374092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374106">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374110">if</span>&nbsp;<span class="op" id="6374113">!</span><span class="ident" id="6374114">h</span><span class="op" id="6374115">.</span><span class="ident" id="6374116">want</span><span class="op" id="6374120">(</span><span class="ident" id="6374121">n</span><span class="op" id="6374122">)</span>&nbsp;<span class="op" id="6374124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374129">h</span><span class="op" id="6374130">.</span><span class="ident" id="6374131">set</span><span class="op" id="6374134">(</span><span class="ident" id="6374135">n</span><span class="op" id="6374136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374141">if</span>&nbsp;<span class="ident" id="6374144">handlers</span><span class="op" id="6374152">.</span><span class="ident" id="6374153">ref</span><span class="op" id="6374156">[</span><span class="ident" id="6374157">n</span><span class="op" id="6374158">]</span>&nbsp;<span class="op" id="6374160">==</span>&nbsp;<span class="num" id="6374163">0</span>&nbsp;<span class="op" id="6374165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374171">enableSignal</span><span class="op" id="6374183">(</span><span class="ident" id="6374184">n</span><span class="op" id="6374185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374190">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374195">handlers</span><span class="op" id="6374203">.</span><span class="ident" id="6374204">ref</span><span class="op" id="6374207">[</span><span class="ident" id="6374208">n</span><span class="op" id="6374209">]</span><span class="op" id="6374210">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374222">if</span>&nbsp;<span class="builtinfunc" id="6374225">len</span><span class="op" id="6374228">(</span><span class="ident" id="6374229">sig</span><span class="op" id="6374232">)</span>&nbsp;<span class="op" id="6374234">==</span>&nbsp;<span class="num" id="6374237">0</span>&nbsp;<span class="op" id="6374239">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374243">for</span>&nbsp;<span class="ident" id="6374247">n</span>&nbsp;<span class="op" id="6374249">:=</span>&nbsp;<span class="num" id="6374252">0</span><span class="op" id="6374253">;</span>&nbsp;<span class="ident" id="6374255">n</span>&nbsp;<span class="op" id="6374257">&lt;</span>&nbsp;<span class="ident" id="6374259">numSig</span><span class="op" id="6374265">;</span>&nbsp;<span class="ident" id="6374267">n</span><span class="op" id="6374268">++</span>&nbsp;<span class="op" id="6374271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374276">add</span><span class="op" id="6374279">(</span><span class="ident" id="6374280">n</span><span class="op" id="6374281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374288">}</span>&nbsp;<span class="keyword" id="6374290">else</span>&nbsp;<span class="op" id="6374295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374299">for</span>&nbsp;<span class="ident" id="6374303">_</span><span class="op" id="6374304">,</span>&nbsp;<span class="ident" id="6374306">s</span>&nbsp;<span class="op" id="6374308">:=</span>&nbsp;<span class="keyword" id="6374311">range</span>&nbsp;<span class="ident" id="6374317">sig</span>&nbsp;<span class="op" id="6374321">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374326">add</span><span class="op" id="6374329">(</span><span class="ident" id="6374330">signum</span><span class="op" id="6374336">(</span><span class="ident" id="6374337">s</span><span class="op" id="6374338">)</span><span class="op" id="6374339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374346">}</span><br>
<span class="lineno"></span><span class="op" id="6374348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6374351">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6374421">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6374483">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6374559">func</span>&nbsp;<span class="ident" id="6374564">Stop</span><span class="op" id="6374568">(</span><span class="ident" id="6374569">c</span>&nbsp;<span class="keyword" id="6374571">chan</span><span class="op" id="6374575">&lt;-</span>&nbsp;<span class="ident" id="6374578">os</span><span class="op" id="6374580">.</span><span class="ident" id="6374581">Signal</span><span class="op" id="6374587">)</span>&nbsp;<span class="op" id="6374589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374592">handlers</span><span class="op" id="6374600">.</span><span class="ident" id="6374601">Lock</span><span class="op" id="6374605">(</span><span class="op" id="6374606">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374609">defer</span>&nbsp;<span class="ident" id="6374615">handlers</span><span class="op" id="6374623">.</span><span class="ident" id="6374624">Unlock</span><span class="op" id="6374630">(</span><span class="op" id="6374631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374635">h</span>&nbsp;<span class="op" id="6374637">:=</span>&nbsp;<span class="ident" id="6374640">handlers</span><span class="op" id="6374648">.</span><span class="ident" id="6374649">m</span><span class="op" id="6374650">[</span><span class="ident" id="6374651">c</span><span class="op" id="6374652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374655">if</span>&nbsp;<span class="ident" id="6374658">h</span>&nbsp;<span class="op" id="6374660">==</span>&nbsp;<span class="ident" id="6374663">nil</span>&nbsp;<span class="op" id="6374667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374671">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6374682">delete</span><span class="op" id="6374688">(</span><span class="ident" id="6374689">handlers</span><span class="op" id="6374697">.</span><span class="ident" id="6374698">m</span><span class="op" id="6374699">,</span>&nbsp;<span class="ident" id="6374701">c</span><span class="op" id="6374702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374706">for</span>&nbsp;<span class="ident" id="6374710">n</span>&nbsp;<span class="op" id="6374712">:=</span>&nbsp;<span class="num" id="6374715">0</span><span class="op" id="6374716">;</span>&nbsp;<span class="ident" id="6374718">n</span>&nbsp;<span class="op" id="6374720">&lt;</span>&nbsp;<span class="ident" id="6374722">numSig</span><span class="op" id="6374728">;</span>&nbsp;<span class="ident" id="6374730">n</span><span class="op" id="6374731">++</span>&nbsp;<span class="op" id="6374734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374738">if</span>&nbsp;<span class="ident" id="6374741">h</span><span class="op" id="6374742">.</span><span class="ident" id="6374743">want</span><span class="op" id="6374747">(</span><span class="ident" id="6374748">n</span><span class="op" id="6374749">)</span>&nbsp;<span class="op" id="6374751">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374756">handlers</span><span class="op" id="6374764">.</span><span class="ident" id="6374765">ref</span><span class="op" id="6374768">[</span><span class="ident" id="6374769">n</span><span class="op" id="6374770">]</span><span class="op" id="6374771">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374777">if</span>&nbsp;<span class="ident" id="6374780">handlers</span><span class="op" id="6374788">.</span><span class="ident" id="6374789">ref</span><span class="op" id="6374792">[</span><span class="ident" id="6374793">n</span><span class="op" id="6374794">]</span>&nbsp;<span class="op" id="6374796">==</span>&nbsp;<span class="num" id="6374799">0</span>&nbsp;<span class="op" id="6374801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374807">disableSignal</span><span class="op" id="6374820">(</span><span class="ident" id="6374821">n</span><span class="op" id="6374822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374831">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374834">}</span><br>
<span class="lineno"></span><span class="op" id="6374836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6374839">func</span>&nbsp;<span class="ident" id="6374844">process</span><span class="op" id="6374851">(</span><span class="ident" id="6374852">sig</span>&nbsp;<span class="ident" id="6374856">os</span><span class="op" id="6374858">.</span><span class="ident" id="6374859">Signal</span><span class="op" id="6374865">)</span>&nbsp;<span class="op" id="6374867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374870">n</span>&nbsp;<span class="op" id="6374872">:=</span>&nbsp;<span class="ident" id="6374875">signum</span><span class="op" id="6374881">(</span><span class="ident" id="6374882">sig</span><span class="op" id="6374885">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374888">if</span>&nbsp;<span class="ident" id="6374891">n</span>&nbsp;<span class="op" id="6374893">&lt;</span>&nbsp;<span class="num" id="6374895">0</span>&nbsp;<span class="op" id="6374897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374913">handlers</span><span class="op" id="6374921">.</span><span class="ident" id="6374922">Lock</span><span class="op" id="6374926">(</span><span class="op" id="6374927">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374930">defer</span>&nbsp;<span class="ident" id="6374936">handlers</span><span class="op" id="6374944">.</span><span class="ident" id="6374945">Unlock</span><span class="op" id="6374951">(</span><span class="op" id="6374952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374956">for</span>&nbsp;<span class="ident" id="6374960">c</span><span class="op" id="6374961">,</span>&nbsp;<span class="ident" id="6374963">h</span>&nbsp;<span class="op" id="6374965">:=</span>&nbsp;<span class="keyword" id="6374968">range</span>&nbsp;<span class="ident" id="6374974">handlers</span><span class="op" id="6374982">.</span><span class="ident" id="6374983">m</span>&nbsp;<span class="op" id="6374985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374989">if</span>&nbsp;<span class="ident" id="6374992">h</span><span class="op" id="6374993">.</span><span class="ident" id="6374994">want</span><span class="op" id="6374998">(</span><span class="ident" id="6374999">n</span><span class="op" id="6375000">)</span>&nbsp;<span class="op" id="6375002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375007">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375042">select</span>&nbsp;<span class="op" id="6375049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375054">case</span>&nbsp;<span class="ident" id="6375059">c</span>&nbsp;<span class="op" id="6375061">&lt;-</span>&nbsp;<span class="ident" id="6375064">sig</span><span class="op" id="6375067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375072">default</span><span class="op" id="6375079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375088">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375091">}</span><br>
<span class="lineno"></span><span class="op" id="6375093">}</span>
</div>
</body>
</html>
