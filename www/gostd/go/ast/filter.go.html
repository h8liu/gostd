<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html" class="current">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3229676">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3229731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3229785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3229836">package</span>&nbsp;<span class="ident" id="3229844">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3229849">import</span>&nbsp;<span class="op" id="3229856">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3229859">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3229871">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3229878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3229881">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3229961">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3229982">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="3230054">func</span>&nbsp;<span class="ident" id="3230059">exportFilter</span><span class="op" id="3230071">(</span><span class="ident" id="3230072">name</span>&nbsp;<span class="builtintype" id="3230077">string</span><span class="op" id="3230083">)</span>&nbsp;<span class="builtintype" id="3230085">bool</span>&nbsp;<span class="op" id="3230090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3230093">return</span>&nbsp;<span class="ident" id="3230100">IsExported</span><span class="op" id="3230110">(</span><span class="ident" id="3230111">name</span><span class="op" id="3230115">)</span><br>
<span class="lineno"></span><span class="op" id="3230117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3230120">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3230189">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="3230269">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3230347">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3230423">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="3230475">//</span><br>
<span class="lineno"></span><span class="comment" id="3230478">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3230542">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3230573">//</span><br>
<span class="lineno"></span><span class="keyword" id="3230576">func</span>&nbsp;<span class="ident" id="3230581">FileExports</span><span class="op" id="3230592">(</span><span class="ident" id="3230593">src</span>&nbsp;<span class="op" id="3230597">*</span><span class="ident" id="3230598">File</span><span class="op" id="3230602">)</span>&nbsp;<span class="builtintype" id="3230604">bool</span>&nbsp;<span class="op" id="3230609">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3230612">return</span>&nbsp;<span class="ident" id="3230619">filterFile</span><span class="op" id="3230629">(</span><span class="ident" id="3230630">src</span><span class="op" id="3230633">,</span>&nbsp;<span class="ident" id="3230635">exportFilter</span><span class="op" id="3230647">,</span>&nbsp;<span class="builtintype" id="3230649">true</span><span class="op" id="3230653">)</span><br>
<span class="lineno"></span><span class="op" id="3230655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3230658">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3230726">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="3230800">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3230861">//</span><br>
<span class="lineno"></span><span class="comment" id="3230864">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3230931">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3230962">//</span><br>
<span class="lineno">40</span><span class="keyword" id="3230965">func</span>&nbsp;<span class="ident" id="3230970">PackageExports</span><span class="op" id="3230984">(</span><span class="ident" id="3230985">pkg</span>&nbsp;<span class="op" id="3230989">*</span><span class="ident" id="3230990">Package</span><span class="op" id="3230997">)</span>&nbsp;<span class="builtintype" id="3230999">bool</span>&nbsp;<span class="op" id="3231004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231007">return</span>&nbsp;<span class="ident" id="3231014">filterPackage</span><span class="op" id="3231027">(</span><span class="ident" id="3231028">pkg</span><span class="op" id="3231031">,</span>&nbsp;<span class="ident" id="3231033">exportFilter</span><span class="op" id="3231045">,</span>&nbsp;<span class="builtintype" id="3231047">true</span><span class="op" id="3231051">)</span><br>
<span class="lineno"></span><span class="op" id="3231053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3231056">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="3231136">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3231158">type</span>&nbsp;<span class="ident" id="3231163">Filter</span>&nbsp;<span class="keyword" id="3231170">func</span><span class="op" id="3231174">(</span><span class="builtintype" id="3231175">string</span><span class="op" id="3231181">)</span>&nbsp;<span class="builtintype" id="3231183">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3231189">func</span>&nbsp;<span class="ident" id="3231194">filterIdentList</span><span class="op" id="3231209">(</span><span class="ident" id="3231210">list</span>&nbsp;<span class="op" id="3231215">[</span><span class="op" id="3231216">]</span><span class="op" id="3231217">*</span><span class="ident" id="3231218">Ident</span><span class="op" id="3231223">,</span>&nbsp;<span class="ident" id="3231225">f</span>&nbsp;<span class="ident" id="3231227">Filter</span><span class="op" id="3231233">)</span>&nbsp;<span class="op" id="3231235">[</span><span class="op" id="3231236">]</span><span class="op" id="3231237">*</span><span class="ident" id="3231238">Ident</span>&nbsp;<span class="op" id="3231244">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231247">j</span>&nbsp;<span class="op" id="3231249">:=</span>&nbsp;<span class="num" id="3231252">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231255">for</span>&nbsp;<span class="ident" id="3231259">_</span><span class="op" id="3231260">,</span>&nbsp;<span class="ident" id="3231262">x</span>&nbsp;<span class="op" id="3231264">:=</span>&nbsp;<span class="keyword" id="3231267">range</span>&nbsp;<span class="ident" id="3231273">list</span>&nbsp;<span class="op" id="3231278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231282">if</span>&nbsp;<span class="ident" id="3231285">f</span><span class="op" id="3231286">(</span><span class="ident" id="3231287">x</span><span class="op" id="3231288">.</span><span class="ident" id="3231289">Name</span><span class="op" id="3231293">)</span>&nbsp;<span class="op" id="3231295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231300">list</span><span class="op" id="3231304">[</span><span class="ident" id="3231305">j</span><span class="op" id="3231306">]</span>&nbsp;<span class="op" id="3231308">=</span>&nbsp;<span class="ident" id="3231310">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231315">j</span><span class="op" id="3231316">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3231321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3231324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231327">return</span>&nbsp;<span class="ident" id="3231334">list</span><span class="op" id="3231338">[</span><span class="num" id="3231339">0</span><span class="op" id="3231340">:</span><span class="ident" id="3231341">j</span><span class="op" id="3231342">]</span><br>
<span class="lineno"></span><span class="op" id="3231344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3231347">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3231413">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="3231480">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3231519">//</span><br>
<span class="lineno"></span><span class="keyword" id="3231522">func</span>&nbsp;<span class="ident" id="3231527">fieldName</span><span class="op" id="3231536">(</span><span class="ident" id="3231537">x</span>&nbsp;<span class="ident" id="3231539">Expr</span><span class="op" id="3231543">)</span>&nbsp;<span class="op" id="3231545">*</span><span class="ident" id="3231546">Ident</span>&nbsp;<span class="op" id="3231552">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231555">switch</span>&nbsp;<span class="ident" id="3231562">t</span>&nbsp;<span class="op" id="3231564">:=</span>&nbsp;<span class="ident" id="3231567">x</span><span class="op" id="3231568">.</span><span class="op" id="3231569">(</span><span class="keyword" id="3231570">type</span><span class="op" id="3231574">)</span>&nbsp;<span class="op" id="3231576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231579">case</span>&nbsp;<span class="op" id="3231584">*</span><span class="ident" id="3231585">Ident</span><span class="op" id="3231590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231594">return</span>&nbsp;<span class="ident" id="3231601">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231604">case</span>&nbsp;<span class="op" id="3231609">*</span><span class="ident" id="3231610">SelectorExpr</span><span class="op" id="3231622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231626">if</span>&nbsp;<span class="ident" id="3231629">_</span><span class="op" id="3231630">,</span>&nbsp;<span class="ident" id="3231632">ok</span>&nbsp;<span class="op" id="3231635">:=</span>&nbsp;<span class="ident" id="3231638">t</span><span class="op" id="3231639">.</span><span class="ident" id="3231640">X</span><span class="op" id="3231641">.</span><span class="op" id="3231642">(</span><span class="op" id="3231643">*</span><span class="ident" id="3231644">Ident</span><span class="op" id="3231649">)</span><span class="op" id="3231650">;</span>&nbsp;<span class="ident" id="3231652">ok</span>&nbsp;<span class="op" id="3231655">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231660">return</span>&nbsp;<span class="ident" id="3231667">t</span><span class="op" id="3231668">.</span><span class="ident" id="3231669">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3231675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231678">case</span>&nbsp;<span class="op" id="3231683">*</span><span class="ident" id="3231684">StarExpr</span><span class="op" id="3231692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231696">return</span>&nbsp;<span class="ident" id="3231703">fieldName</span><span class="op" id="3231712">(</span><span class="ident" id="3231713">t</span><span class="op" id="3231714">.</span><span class="ident" id="3231715">X</span><span class="op" id="3231716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3231719">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231722">return</span>&nbsp;<span class="builtintype" id="3231729">nil</span><br>
<span class="lineno"></span><span class="op" id="3231733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3231736">func</span>&nbsp;<span class="ident" id="3231741">filterFieldList</span><span class="op" id="3231756">(</span><span class="ident" id="3231757">fields</span>&nbsp;<span class="op" id="3231764">*</span><span class="ident" id="3231765">FieldList</span><span class="op" id="3231774">,</span>&nbsp;<span class="ident" id="3231776">filter</span>&nbsp;<span class="ident" id="3231783">Filter</span><span class="op" id="3231789">,</span>&nbsp;<span class="ident" id="3231791">export</span>&nbsp;<span class="builtintype" id="3231798">bool</span><span class="op" id="3231802">)</span>&nbsp;<span class="op" id="3231804">(</span><span class="ident" id="3231805">removedFields</span>&nbsp;<span class="builtintype" id="3231819">bool</span><span class="op" id="3231823">)</span>&nbsp;<span class="op" id="3231825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231828">if</span>&nbsp;<span class="ident" id="3231831">fields</span>&nbsp;<span class="op" id="3231838">==</span>&nbsp;<span class="builtintype" id="3231841">nil</span>&nbsp;<span class="op" id="3231845">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231849">return</span>&nbsp;<span class="builtintype" id="3231856">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3231863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231866">list</span>&nbsp;<span class="op" id="3231871">:=</span>&nbsp;<span class="ident" id="3231874">fields</span><span class="op" id="3231880">.</span><span class="ident" id="3231881">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231887">j</span>&nbsp;<span class="op" id="3231889">:=</span>&nbsp;<span class="num" id="3231892">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231895">for</span>&nbsp;<span class="ident" id="3231899">_</span><span class="op" id="3231900">,</span>&nbsp;<span class="ident" id="3231902">f</span>&nbsp;<span class="op" id="3231904">:=</span>&nbsp;<span class="keyword" id="3231907">range</span>&nbsp;<span class="ident" id="3231913">list</span>&nbsp;<span class="op" id="3231918">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231922">keepField</span>&nbsp;<span class="op" id="3231932">:=</span>&nbsp;<span class="builtintype" id="3231935">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3231943">if</span>&nbsp;<span class="builtinfunc" id="3231946">len</span><span class="op" id="3231949">(</span><span class="ident" id="3231950">f</span><span class="op" id="3231951">.</span><span class="ident" id="3231952">Names</span><span class="op" id="3231957">)</span>&nbsp;<span class="op" id="3231959">==</span>&nbsp;<span class="num" id="3231962">0</span>&nbsp;<span class="op" id="3231964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3231969">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3231991">name</span>&nbsp;<span class="op" id="3231996">:=</span>&nbsp;<span class="ident" id="3231999">fieldName</span><span class="op" id="3232008">(</span><span class="ident" id="3232009">f</span><span class="op" id="3232010">.</span><span class="ident" id="3232011">Type</span><span class="op" id="3232015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232020">keepField</span>&nbsp;<span class="op" id="3232030">=</span>&nbsp;<span class="ident" id="3232032">name</span>&nbsp;<span class="op" id="3232037">!=</span>&nbsp;<span class="builtintype" id="3232040">nil</span>&nbsp;<span class="op" id="3232044">&amp;&amp;</span>&nbsp;<span class="ident" id="3232047">filter</span><span class="op" id="3232053">(</span><span class="ident" id="3232054">name</span><span class="op" id="3232058">.</span><span class="ident" id="3232059">Name</span><span class="op" id="3232063">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232067">}</span>&nbsp;<span class="keyword" id="3232069">else</span>&nbsp;<span class="op" id="3232074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232079">n</span>&nbsp;<span class="op" id="3232081">:=</span>&nbsp;<span class="builtinfunc" id="3232084">len</span><span class="op" id="3232087">(</span><span class="ident" id="3232088">f</span><span class="op" id="3232089">.</span><span class="ident" id="3232090">Names</span><span class="op" id="3232095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232100">f</span><span class="op" id="3232101">.</span><span class="ident" id="3232102">Names</span>&nbsp;<span class="op" id="3232108">=</span>&nbsp;<span class="ident" id="3232110">filterIdentList</span><span class="op" id="3232125">(</span><span class="ident" id="3232126">f</span><span class="op" id="3232127">.</span><span class="ident" id="3232128">Names</span><span class="op" id="3232133">,</span>&nbsp;<span class="ident" id="3232135">filter</span><span class="op" id="3232141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232146">if</span>&nbsp;<span class="builtinfunc" id="3232149">len</span><span class="op" id="3232152">(</span><span class="ident" id="3232153">f</span><span class="op" id="3232154">.</span><span class="ident" id="3232155">Names</span><span class="op" id="3232160">)</span>&nbsp;<span class="op" id="3232162">&lt;</span>&nbsp;<span class="ident" id="3232164">n</span>&nbsp;<span class="op" id="3232166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232172">removedFields</span>&nbsp;<span class="op" id="3232186">=</span>&nbsp;<span class="builtintype" id="3232188">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232201">keepField</span>&nbsp;<span class="op" id="3232211">=</span>&nbsp;<span class="builtinfunc" id="3232213">len</span><span class="op" id="3232216">(</span><span class="ident" id="3232217">f</span><span class="op" id="3232218">.</span><span class="ident" id="3232219">Names</span><span class="op" id="3232224">)</span>&nbsp;<span class="op" id="3232226">&gt;</span>&nbsp;<span class="num" id="3232228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232236">if</span>&nbsp;<span class="ident" id="3232239">keepField</span>&nbsp;<span class="op" id="3232249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232254">if</span>&nbsp;<span class="ident" id="3232257">export</span>&nbsp;<span class="op" id="3232264">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232270">filterType</span><span class="op" id="3232280">(</span><span class="ident" id="3232281">f</span><span class="op" id="3232282">.</span><span class="ident" id="3232283">Type</span><span class="op" id="3232287">,</span>&nbsp;<span class="ident" id="3232289">filter</span><span class="op" id="3232295">,</span>&nbsp;<span class="ident" id="3232297">export</span><span class="op" id="3232303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232313">list</span><span class="op" id="3232317">[</span><span class="ident" id="3232318">j</span><span class="op" id="3232319">]</span>&nbsp;<span class="op" id="3232321">=</span>&nbsp;<span class="ident" id="3232323">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232328">j</span><span class="op" id="3232329">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232334">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232340">if</span>&nbsp;<span class="ident" id="3232343">j</span>&nbsp;<span class="op" id="3232345">&lt;</span>&nbsp;<span class="builtinfunc" id="3232347">len</span><span class="op" id="3232350">(</span><span class="ident" id="3232351">list</span><span class="op" id="3232355">)</span>&nbsp;<span class="op" id="3232357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232361">removedFields</span>&nbsp;<span class="op" id="3232375">=</span>&nbsp;<span class="builtintype" id="3232377">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232386">fields</span><span class="op" id="3232392">.</span><span class="ident" id="3232393">List</span>&nbsp;<span class="op" id="3232398">=</span>&nbsp;<span class="ident" id="3232400">list</span><span class="op" id="3232404">[</span><span class="num" id="3232405">0</span><span class="op" id="3232406">:</span><span class="ident" id="3232407">j</span><span class="op" id="3232408">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232411">return</span><br>
<span class="lineno"></span><span class="op" id="3232418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3232421">func</span>&nbsp;<span class="ident" id="3232426">filterParamList</span><span class="op" id="3232441">(</span><span class="ident" id="3232442">fields</span>&nbsp;<span class="op" id="3232449">*</span><span class="ident" id="3232450">FieldList</span><span class="op" id="3232459">,</span>&nbsp;<span class="ident" id="3232461">filter</span>&nbsp;<span class="ident" id="3232468">Filter</span><span class="op" id="3232474">,</span>&nbsp;<span class="ident" id="3232476">export</span>&nbsp;<span class="builtintype" id="3232483">bool</span><span class="op" id="3232487">)</span>&nbsp;<span class="builtintype" id="3232489">bool</span>&nbsp;<span class="op" id="3232494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232497">if</span>&nbsp;<span class="ident" id="3232500">fields</span>&nbsp;<span class="op" id="3232507">==</span>&nbsp;<span class="builtintype" id="3232510">nil</span>&nbsp;<span class="op" id="3232514">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232518">return</span>&nbsp;<span class="builtintype" id="3232525">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232535">var</span>&nbsp;<span class="ident" id="3232539">b</span>&nbsp;<span class="builtintype" id="3232541">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232547">for</span>&nbsp;<span class="ident" id="3232551">_</span><span class="op" id="3232552">,</span>&nbsp;<span class="ident" id="3232554">f</span>&nbsp;<span class="op" id="3232556">:=</span>&nbsp;<span class="keyword" id="3232559">range</span>&nbsp;<span class="ident" id="3232565">fields</span><span class="op" id="3232571">.</span><span class="ident" id="3232572">List</span>&nbsp;<span class="op" id="3232577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232581">if</span>&nbsp;<span class="ident" id="3232584">filterType</span><span class="op" id="3232594">(</span><span class="ident" id="3232595">f</span><span class="op" id="3232596">.</span><span class="ident" id="3232597">Type</span><span class="op" id="3232601">,</span>&nbsp;<span class="ident" id="3232603">filter</span><span class="op" id="3232609">,</span>&nbsp;<span class="ident" id="3232611">export</span><span class="op" id="3232617">)</span>&nbsp;<span class="op" id="3232619">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232624">b</span>&nbsp;<span class="op" id="3232626">=</span>&nbsp;<span class="builtintype" id="3232628">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232641">return</span>&nbsp;<span class="ident" id="3232648">b</span><br>
<span class="lineno"></span><span class="op" id="3232650">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3232653">func</span>&nbsp;<span class="ident" id="3232658">filterType</span><span class="op" id="3232668">(</span><span class="ident" id="3232669">typ</span>&nbsp;<span class="ident" id="3232673">Expr</span><span class="op" id="3232677">,</span>&nbsp;<span class="ident" id="3232679">f</span>&nbsp;<span class="ident" id="3232681">Filter</span><span class="op" id="3232687">,</span>&nbsp;<span class="ident" id="3232689">export</span>&nbsp;<span class="builtintype" id="3232696">bool</span><span class="op" id="3232700">)</span>&nbsp;<span class="builtintype" id="3232702">bool</span>&nbsp;<span class="op" id="3232707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232710">switch</span>&nbsp;<span class="ident" id="3232717">t</span>&nbsp;<span class="op" id="3232719">:=</span>&nbsp;<span class="ident" id="3232722">typ</span><span class="op" id="3232725">.</span><span class="op" id="3232726">(</span><span class="keyword" id="3232727">type</span><span class="op" id="3232731">)</span>&nbsp;<span class="op" id="3232733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232736">case</span>&nbsp;<span class="op" id="3232741">*</span><span class="ident" id="3232742">Ident</span><span class="op" id="3232747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232751">return</span>&nbsp;<span class="ident" id="3232758">f</span><span class="op" id="3232759">(</span><span class="ident" id="3232760">t</span><span class="op" id="3232761">.</span><span class="ident" id="3232762">Name</span><span class="op" id="3232766">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232769">case</span>&nbsp;<span class="op" id="3232774">*</span><span class="ident" id="3232775">ParenExpr</span><span class="op" id="3232784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232788">return</span>&nbsp;<span class="ident" id="3232795">filterType</span><span class="op" id="3232805">(</span><span class="ident" id="3232806">t</span><span class="op" id="3232807">.</span><span class="ident" id="3232808">X</span><span class="op" id="3232809">,</span>&nbsp;<span class="ident" id="3232811">f</span><span class="op" id="3232812">,</span>&nbsp;<span class="ident" id="3232814">export</span><span class="op" id="3232820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232823">case</span>&nbsp;<span class="op" id="3232828">*</span><span class="ident" id="3232829">ArrayType</span><span class="op" id="3232838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232842">return</span>&nbsp;<span class="ident" id="3232849">filterType</span><span class="op" id="3232859">(</span><span class="ident" id="3232860">t</span><span class="op" id="3232861">.</span><span class="ident" id="3232862">Elt</span><span class="op" id="3232865">,</span>&nbsp;<span class="ident" id="3232867">f</span><span class="op" id="3232868">,</span>&nbsp;<span class="ident" id="3232870">export</span><span class="op" id="3232876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232879">case</span>&nbsp;<span class="op" id="3232884">*</span><span class="ident" id="3232885">StructType</span><span class="op" id="3232895">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232899">if</span>&nbsp;<span class="ident" id="3232902">filterFieldList</span><span class="op" id="3232917">(</span><span class="ident" id="3232918">t</span><span class="op" id="3232919">.</span><span class="ident" id="3232920">Fields</span><span class="op" id="3232926">,</span>&nbsp;<span class="ident" id="3232928">f</span><span class="op" id="3232929">,</span>&nbsp;<span class="ident" id="3232931">export</span><span class="op" id="3232937">)</span>&nbsp;<span class="op" id="3232939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3232944">t</span><span class="op" id="3232945">.</span><span class="ident" id="3232946">Incomplete</span>&nbsp;<span class="op" id="3232957">=</span>&nbsp;<span class="builtintype" id="3232959">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3232966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3232970">return</span>&nbsp;<span class="builtinfunc" id="3232977">len</span><span class="op" id="3232980">(</span><span class="ident" id="3232981">t</span><span class="op" id="3232982">.</span><span class="ident" id="3232983">Fields</span><span class="op" id="3232989">.</span><span class="ident" id="3232990">List</span><span class="op" id="3232994">)</span>&nbsp;<span class="op" id="3232996">&gt;</span>&nbsp;<span class="num" id="3232998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233001">case</span>&nbsp;<span class="op" id="3233006">*</span><span class="ident" id="3233007">FuncType</span><span class="op" id="3233015">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233019">b1</span>&nbsp;<span class="op" id="3233022">:=</span>&nbsp;<span class="ident" id="3233025">filterParamList</span><span class="op" id="3233040">(</span><span class="ident" id="3233041">t</span><span class="op" id="3233042">.</span><span class="ident" id="3233043">Params</span><span class="op" id="3233049">,</span>&nbsp;<span class="ident" id="3233051">f</span><span class="op" id="3233052">,</span>&nbsp;<span class="ident" id="3233054">export</span><span class="op" id="3233060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233064">b2</span>&nbsp;<span class="op" id="3233067">:=</span>&nbsp;<span class="ident" id="3233070">filterParamList</span><span class="op" id="3233085">(</span><span class="ident" id="3233086">t</span><span class="op" id="3233087">.</span><span class="ident" id="3233088">Results</span><span class="op" id="3233095">,</span>&nbsp;<span class="ident" id="3233097">f</span><span class="op" id="3233098">,</span>&nbsp;<span class="ident" id="3233100">export</span><span class="op" id="3233106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233110">return</span>&nbsp;<span class="ident" id="3233117">b1</span>&nbsp;<span class="op" id="3233120">||</span>&nbsp;<span class="ident" id="3233123">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233127">case</span>&nbsp;<span class="op" id="3233132">*</span><span class="ident" id="3233133">InterfaceType</span><span class="op" id="3233146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233150">if</span>&nbsp;<span class="ident" id="3233153">filterFieldList</span><span class="op" id="3233168">(</span><span class="ident" id="3233169">t</span><span class="op" id="3233170">.</span><span class="ident" id="3233171">Methods</span><span class="op" id="3233178">,</span>&nbsp;<span class="ident" id="3233180">f</span><span class="op" id="3233181">,</span>&nbsp;<span class="ident" id="3233183">export</span><span class="op" id="3233189">)</span>&nbsp;<span class="op" id="3233191">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233196">t</span><span class="op" id="3233197">.</span><span class="ident" id="3233198">Incomplete</span>&nbsp;<span class="op" id="3233209">=</span>&nbsp;<span class="builtintype" id="3233211">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233222">return</span>&nbsp;<span class="builtinfunc" id="3233229">len</span><span class="op" id="3233232">(</span><span class="ident" id="3233233">t</span><span class="op" id="3233234">.</span><span class="ident" id="3233235">Methods</span><span class="op" id="3233242">.</span><span class="ident" id="3233243">List</span><span class="op" id="3233247">)</span>&nbsp;<span class="op" id="3233249">&gt;</span>&nbsp;<span class="num" id="3233251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233254">case</span>&nbsp;<span class="op" id="3233259">*</span><span class="ident" id="3233260">MapType</span><span class="op" id="3233267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233271">b1</span>&nbsp;<span class="op" id="3233274">:=</span>&nbsp;<span class="ident" id="3233277">filterType</span><span class="op" id="3233287">(</span><span class="ident" id="3233288">t</span><span class="op" id="3233289">.</span><span class="ident" id="3233290">Key</span><span class="op" id="3233293">,</span>&nbsp;<span class="ident" id="3233295">f</span><span class="op" id="3233296">,</span>&nbsp;<span class="ident" id="3233298">export</span><span class="op" id="3233304">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233308">b2</span>&nbsp;<span class="op" id="3233311">:=</span>&nbsp;<span class="ident" id="3233314">filterType</span><span class="op" id="3233324">(</span><span class="ident" id="3233325">t</span><span class="op" id="3233326">.</span><span class="ident" id="3233327">Value</span><span class="op" id="3233332">,</span>&nbsp;<span class="ident" id="3233334">f</span><span class="op" id="3233335">,</span>&nbsp;<span class="ident" id="3233337">export</span><span class="op" id="3233343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233347">return</span>&nbsp;<span class="ident" id="3233354">b1</span>&nbsp;<span class="op" id="3233357">||</span>&nbsp;<span class="ident" id="3233360">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233364">case</span>&nbsp;<span class="op" id="3233369">*</span><span class="ident" id="3233370">ChanType</span><span class="op" id="3233378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233382">return</span>&nbsp;<span class="ident" id="3233389">filterType</span><span class="op" id="3233399">(</span><span class="ident" id="3233400">t</span><span class="op" id="3233401">.</span><span class="ident" id="3233402">Value</span><span class="op" id="3233407">,</span>&nbsp;<span class="ident" id="3233409">f</span><span class="op" id="3233410">,</span>&nbsp;<span class="ident" id="3233412">export</span><span class="op" id="3233418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233421">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233424">return</span>&nbsp;<span class="builtintype" id="3233431">false</span><br>
<span class="lineno"></span><span class="op" id="3233437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3233440">func</span>&nbsp;<span class="ident" id="3233445">filterSpec</span><span class="op" id="3233455">(</span><span class="ident" id="3233456">spec</span>&nbsp;<span class="ident" id="3233461">Spec</span><span class="op" id="3233465">,</span>&nbsp;<span class="ident" id="3233467">f</span>&nbsp;<span class="ident" id="3233469">Filter</span><span class="op" id="3233475">,</span>&nbsp;<span class="ident" id="3233477">export</span>&nbsp;<span class="builtintype" id="3233484">bool</span><span class="op" id="3233488">)</span>&nbsp;<span class="builtintype" id="3233490">bool</span>&nbsp;<span class="op" id="3233495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233498">switch</span>&nbsp;<span class="ident" id="3233505">s</span>&nbsp;<span class="op" id="3233507">:=</span>&nbsp;<span class="ident" id="3233510">spec</span><span class="op" id="3233514">.</span><span class="op" id="3233515">(</span><span class="keyword" id="3233516">type</span><span class="op" id="3233520">)</span>&nbsp;<span class="op" id="3233522">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233525">case</span>&nbsp;<span class="op" id="3233530">*</span><span class="ident" id="3233531">ValueSpec</span><span class="op" id="3233540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233544">s</span><span class="op" id="3233545">.</span><span class="ident" id="3233546">Names</span>&nbsp;<span class="op" id="3233552">=</span>&nbsp;<span class="ident" id="3233554">filterIdentList</span><span class="op" id="3233569">(</span><span class="ident" id="3233570">s</span><span class="op" id="3233571">.</span><span class="ident" id="3233572">Names</span><span class="op" id="3233577">,</span>&nbsp;<span class="ident" id="3233579">f</span><span class="op" id="3233580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233584">if</span>&nbsp;<span class="builtinfunc" id="3233587">len</span><span class="op" id="3233590">(</span><span class="ident" id="3233591">s</span><span class="op" id="3233592">.</span><span class="ident" id="3233593">Names</span><span class="op" id="3233598">)</span>&nbsp;<span class="op" id="3233600">&gt;</span>&nbsp;<span class="num" id="3233602">0</span>&nbsp;<span class="op" id="3233604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233609">if</span>&nbsp;<span class="ident" id="3233612">export</span>&nbsp;<span class="op" id="3233619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233625">filterType</span><span class="op" id="3233635">(</span><span class="ident" id="3233636">s</span><span class="op" id="3233637">.</span><span class="ident" id="3233638">Type</span><span class="op" id="3233642">,</span>&nbsp;<span class="ident" id="3233644">f</span><span class="op" id="3233645">,</span>&nbsp;<span class="ident" id="3233647">export</span><span class="op" id="3233653">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233663">return</span>&nbsp;<span class="builtintype" id="3233670">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233680">case</span>&nbsp;<span class="op" id="3233685">*</span><span class="ident" id="3233686">TypeSpec</span><span class="op" id="3233694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233698">if</span>&nbsp;<span class="ident" id="3233701">f</span><span class="op" id="3233702">(</span><span class="ident" id="3233703">s</span><span class="op" id="3233704">.</span><span class="ident" id="3233705">Name</span><span class="op" id="3233709">.</span><span class="ident" id="3233710">Name</span><span class="op" id="3233714">)</span>&nbsp;<span class="op" id="3233716">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233721">if</span>&nbsp;<span class="ident" id="3233724">export</span>&nbsp;<span class="op" id="3233731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3233737">filterType</span><span class="op" id="3233747">(</span><span class="ident" id="3233748">s</span><span class="op" id="3233749">.</span><span class="ident" id="3233750">Type</span><span class="op" id="3233754">,</span>&nbsp;<span class="ident" id="3233756">f</span><span class="op" id="3233757">,</span>&nbsp;<span class="ident" id="3233759">export</span><span class="op" id="3233765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233775">return</span>&nbsp;<span class="builtintype" id="3233782">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3233789">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233793">if</span>&nbsp;<span class="op" id="3233796">!</span><span class="ident" id="3233797">export</span>&nbsp;<span class="op" id="3233804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3233809">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3233857">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3233904">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3233915">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3233961">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3233989">return</span>&nbsp;<span class="ident" id="3233996">filterType</span><span class="op" id="3234006">(</span><span class="ident" id="3234007">s</span><span class="op" id="3234008">.</span><span class="ident" id="3234009">Type</span><span class="op" id="3234013">,</span>&nbsp;<span class="ident" id="3234015">f</span><span class="op" id="3234016">,</span>&nbsp;<span class="ident" id="3234018">export</span><span class="op" id="3234024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3234028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3234031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234034">return</span>&nbsp;<span class="builtintype" id="3234041">false</span><br>
<span class="lineno">185</span><span class="op" id="3234047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3234050">func</span>&nbsp;<span class="ident" id="3234055">filterSpecList</span><span class="op" id="3234069">(</span><span class="ident" id="3234070">list</span>&nbsp;<span class="op" id="3234075">[</span><span class="op" id="3234076">]</span><span class="ident" id="3234077">Spec</span><span class="op" id="3234081">,</span>&nbsp;<span class="ident" id="3234083">f</span>&nbsp;<span class="ident" id="3234085">Filter</span><span class="op" id="3234091">,</span>&nbsp;<span class="ident" id="3234093">export</span>&nbsp;<span class="builtintype" id="3234100">bool</span><span class="op" id="3234104">)</span>&nbsp;<span class="op" id="3234106">[</span><span class="op" id="3234107">]</span><span class="ident" id="3234108">Spec</span>&nbsp;<span class="op" id="3234113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3234116">j</span>&nbsp;<span class="op" id="3234118">:=</span>&nbsp;<span class="num" id="3234121">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234124">for</span>&nbsp;<span class="ident" id="3234128">_</span><span class="op" id="3234129">,</span>&nbsp;<span class="ident" id="3234131">s</span>&nbsp;<span class="op" id="3234133">:=</span>&nbsp;<span class="keyword" id="3234136">range</span>&nbsp;<span class="ident" id="3234142">list</span>&nbsp;<span class="op" id="3234147">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234151">if</span>&nbsp;<span class="ident" id="3234154">filterSpec</span><span class="op" id="3234164">(</span><span class="ident" id="3234165">s</span><span class="op" id="3234166">,</span>&nbsp;<span class="ident" id="3234168">f</span><span class="op" id="3234169">,</span>&nbsp;<span class="ident" id="3234171">export</span><span class="op" id="3234177">)</span>&nbsp;<span class="op" id="3234179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3234184">list</span><span class="op" id="3234188">[</span><span class="ident" id="3234189">j</span><span class="op" id="3234190">]</span>&nbsp;<span class="op" id="3234192">=</span>&nbsp;<span class="ident" id="3234194">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3234199">j</span><span class="op" id="3234200">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3234205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3234208">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234211">return</span>&nbsp;<span class="ident" id="3234218">list</span><span class="op" id="3234222">[</span><span class="num" id="3234223">0</span><span class="op" id="3234224">:</span><span class="ident" id="3234225">j</span><span class="op" id="3234226">]</span><br>
<span class="lineno"></span><span class="op" id="3234228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3234231">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3234301">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="3234370">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="3234437">//</span><br>
<span class="lineno"></span><span class="comment" id="3234440">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="3234510">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3234552">//</span><br>
<span class="lineno">205</span><span class="keyword" id="3234555">func</span>&nbsp;<span class="ident" id="3234560">FilterDecl</span><span class="op" id="3234570">(</span><span class="ident" id="3234571">decl</span>&nbsp;<span class="ident" id="3234576">Decl</span><span class="op" id="3234580">,</span>&nbsp;<span class="ident" id="3234582">f</span>&nbsp;<span class="ident" id="3234584">Filter</span><span class="op" id="3234590">)</span>&nbsp;<span class="builtintype" id="3234592">bool</span>&nbsp;<span class="op" id="3234597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234600">return</span>&nbsp;<span class="ident" id="3234607">filterDecl</span><span class="op" id="3234617">(</span><span class="ident" id="3234618">decl</span><span class="op" id="3234622">,</span>&nbsp;<span class="ident" id="3234624">f</span><span class="op" id="3234625">,</span>&nbsp;<span class="builtintype" id="3234627">false</span><span class="op" id="3234632">)</span><br>
<span class="lineno"></span><span class="op" id="3234634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3234637">func</span>&nbsp;<span class="ident" id="3234642">filterDecl</span><span class="op" id="3234652">(</span><span class="ident" id="3234653">decl</span>&nbsp;<span class="ident" id="3234658">Decl</span><span class="op" id="3234662">,</span>&nbsp;<span class="ident" id="3234664">f</span>&nbsp;<span class="ident" id="3234666">Filter</span><span class="op" id="3234672">,</span>&nbsp;<span class="ident" id="3234674">export</span>&nbsp;<span class="builtintype" id="3234681">bool</span><span class="op" id="3234685">)</span>&nbsp;<span class="builtintype" id="3234687">bool</span>&nbsp;<span class="op" id="3234692">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234695">switch</span>&nbsp;<span class="ident" id="3234702">d</span>&nbsp;<span class="op" id="3234704">:=</span>&nbsp;<span class="ident" id="3234707">decl</span><span class="op" id="3234711">.</span><span class="op" id="3234712">(</span><span class="keyword" id="3234713">type</span><span class="op" id="3234717">)</span>&nbsp;<span class="op" id="3234719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234722">case</span>&nbsp;<span class="op" id="3234727">*</span><span class="ident" id="3234728">GenDecl</span><span class="op" id="3234735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3234739">d</span><span class="op" id="3234740">.</span><span class="ident" id="3234741">Specs</span>&nbsp;<span class="op" id="3234747">=</span>&nbsp;<span class="ident" id="3234749">filterSpecList</span><span class="op" id="3234763">(</span><span class="ident" id="3234764">d</span><span class="op" id="3234765">.</span><span class="ident" id="3234766">Specs</span><span class="op" id="3234771">,</span>&nbsp;<span class="ident" id="3234773">f</span><span class="op" id="3234774">,</span>&nbsp;<span class="ident" id="3234776">export</span><span class="op" id="3234782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234786">return</span>&nbsp;<span class="builtinfunc" id="3234793">len</span><span class="op" id="3234796">(</span><span class="ident" id="3234797">d</span><span class="op" id="3234798">.</span><span class="ident" id="3234799">Specs</span><span class="op" id="3234804">)</span>&nbsp;<span class="op" id="3234806">&gt;</span>&nbsp;<span class="num" id="3234808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234811">case</span>&nbsp;<span class="op" id="3234816">*</span><span class="ident" id="3234817">FuncDecl</span><span class="op" id="3234825">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234829">return</span>&nbsp;<span class="ident" id="3234836">f</span><span class="op" id="3234837">(</span><span class="ident" id="3234838">d</span><span class="op" id="3234839">.</span><span class="ident" id="3234840">Name</span><span class="op" id="3234844">.</span><span class="ident" id="3234845">Name</span><span class="op" id="3234849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3234852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3234855">return</span>&nbsp;<span class="builtintype" id="3234862">false</span><br>
<span class="lineno"></span><span class="op" id="3234868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3234871">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3234938">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3235003">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3235071">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="3235141">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="3235208">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="3235227">//</span><br>
<span class="lineno"></span><span class="comment" id="3235230">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="3235297">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3235350">//</span><br>
<span class="lineno">230</span><span class="keyword" id="3235353">func</span>&nbsp;<span class="ident" id="3235358">FilterFile</span><span class="op" id="3235368">(</span><span class="ident" id="3235369">src</span>&nbsp;<span class="op" id="3235373">*</span><span class="ident" id="3235374">File</span><span class="op" id="3235378">,</span>&nbsp;<span class="ident" id="3235380">f</span>&nbsp;<span class="ident" id="3235382">Filter</span><span class="op" id="3235388">)</span>&nbsp;<span class="builtintype" id="3235390">bool</span>&nbsp;<span class="op" id="3235395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3235398">return</span>&nbsp;<span class="ident" id="3235405">filterFile</span><span class="op" id="3235415">(</span><span class="ident" id="3235416">src</span><span class="op" id="3235419">,</span>&nbsp;<span class="ident" id="3235421">f</span><span class="op" id="3235422">,</span>&nbsp;<span class="builtintype" id="3235424">false</span><span class="op" id="3235429">)</span><br>
<span class="lineno"></span><span class="op" id="3235431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3235434">func</span>&nbsp;<span class="ident" id="3235439">filterFile</span><span class="op" id="3235449">(</span><span class="ident" id="3235450">src</span>&nbsp;<span class="op" id="3235454">*</span><span class="ident" id="3235455">File</span><span class="op" id="3235459">,</span>&nbsp;<span class="ident" id="3235461">f</span>&nbsp;<span class="ident" id="3235463">Filter</span><span class="op" id="3235469">,</span>&nbsp;<span class="ident" id="3235471">export</span>&nbsp;<span class="builtintype" id="3235478">bool</span><span class="op" id="3235482">)</span>&nbsp;<span class="builtintype" id="3235484">bool</span>&nbsp;<span class="op" id="3235489">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3235492">j</span>&nbsp;<span class="op" id="3235494">:=</span>&nbsp;<span class="num" id="3235497">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3235500">for</span>&nbsp;<span class="ident" id="3235504">_</span><span class="op" id="3235505">,</span>&nbsp;<span class="ident" id="3235507">d</span>&nbsp;<span class="op" id="3235509">:=</span>&nbsp;<span class="keyword" id="3235512">range</span>&nbsp;<span class="ident" id="3235518">src</span><span class="op" id="3235521">.</span><span class="ident" id="3235522">Decls</span>&nbsp;<span class="op" id="3235528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3235532">if</span>&nbsp;<span class="ident" id="3235535">filterDecl</span><span class="op" id="3235545">(</span><span class="ident" id="3235546">d</span><span class="op" id="3235547">,</span>&nbsp;<span class="ident" id="3235549">f</span><span class="op" id="3235550">,</span>&nbsp;<span class="ident" id="3235552">export</span><span class="op" id="3235558">)</span>&nbsp;<span class="op" id="3235560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3235565">src</span><span class="op" id="3235568">.</span><span class="ident" id="3235569">Decls</span><span class="op" id="3235574">[</span><span class="ident" id="3235575">j</span><span class="op" id="3235576">]</span>&nbsp;<span class="op" id="3235578">=</span>&nbsp;<span class="ident" id="3235580">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3235585">j</span><span class="op" id="3235586">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3235591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3235594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3235597">src</span><span class="op" id="3235600">.</span><span class="ident" id="3235601">Decls</span>&nbsp;<span class="op" id="3235607">=</span>&nbsp;<span class="ident" id="3235609">src</span><span class="op" id="3235612">.</span><span class="ident" id="3235613">Decls</span><span class="op" id="3235618">[</span><span class="num" id="3235619">0</span><span class="op" id="3235620">:</span><span class="ident" id="3235621">j</span><span class="op" id="3235622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3235625">return</span>&nbsp;<span class="ident" id="3235632">j</span>&nbsp;<span class="op" id="3235634">&gt;</span>&nbsp;<span class="num" id="3235636">0</span><br>
<span class="lineno"></span><span class="op" id="3235638">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="3235641">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3235710">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3235779">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3235847">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="3235917">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3235987">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="3236059">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3236068">//</span><br>
<span class="lineno"></span><span class="comment" id="3236071">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="3236141">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3236194">//</span><br>
<span class="lineno"></span><span class="keyword" id="3236197">func</span>&nbsp;<span class="ident" id="3236202">FilterPackage</span><span class="op" id="3236215">(</span><span class="ident" id="3236216">pkg</span>&nbsp;<span class="op" id="3236220">*</span><span class="ident" id="3236221">Package</span><span class="op" id="3236228">,</span>&nbsp;<span class="ident" id="3236230">f</span>&nbsp;<span class="ident" id="3236232">Filter</span><span class="op" id="3236238">)</span>&nbsp;<span class="builtintype" id="3236240">bool</span>&nbsp;<span class="op" id="3236245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3236248">return</span>&nbsp;<span class="ident" id="3236255">filterPackage</span><span class="op" id="3236268">(</span><span class="ident" id="3236269">pkg</span><span class="op" id="3236272">,</span>&nbsp;<span class="ident" id="3236274">f</span><span class="op" id="3236275">,</span>&nbsp;<span class="builtintype" id="3236277">false</span><span class="op" id="3236282">)</span><br>
<span class="lineno"></span><span class="op" id="3236284">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="3236287">func</span>&nbsp;<span class="ident" id="3236292">filterPackage</span><span class="op" id="3236305">(</span><span class="ident" id="3236306">pkg</span>&nbsp;<span class="op" id="3236310">*</span><span class="ident" id="3236311">Package</span><span class="op" id="3236318">,</span>&nbsp;<span class="ident" id="3236320">f</span>&nbsp;<span class="ident" id="3236322">Filter</span><span class="op" id="3236328">,</span>&nbsp;<span class="ident" id="3236330">export</span>&nbsp;<span class="builtintype" id="3236337">bool</span><span class="op" id="3236341">)</span>&nbsp;<span class="builtintype" id="3236343">bool</span>&nbsp;<span class="op" id="3236348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236351">hasDecls</span>&nbsp;<span class="op" id="3236360">:=</span>&nbsp;<span class="builtintype" id="3236363">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3236370">for</span>&nbsp;<span class="ident" id="3236374">_</span><span class="op" id="3236375">,</span>&nbsp;<span class="ident" id="3236377">src</span>&nbsp;<span class="op" id="3236381">:=</span>&nbsp;<span class="keyword" id="3236384">range</span>&nbsp;<span class="ident" id="3236390">pkg</span><span class="op" id="3236393">.</span><span class="ident" id="3236394">Files</span>&nbsp;<span class="op" id="3236400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3236404">if</span>&nbsp;<span class="ident" id="3236407">filterFile</span><span class="op" id="3236417">(</span><span class="ident" id="3236418">src</span><span class="op" id="3236421">,</span>&nbsp;<span class="ident" id="3236423">f</span><span class="op" id="3236424">,</span>&nbsp;<span class="ident" id="3236426">export</span><span class="op" id="3236432">)</span>&nbsp;<span class="op" id="3236434">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236439">hasDecls</span>&nbsp;<span class="op" id="3236448">=</span>&nbsp;<span class="builtintype" id="3236450">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3236457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3236460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3236463">return</span>&nbsp;<span class="ident" id="3236470">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="3236479">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="3236482">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3236562">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3236591">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="3236657">type</span>&nbsp;<span class="ident" id="3236662">MergeMode</span>&nbsp;<span class="builtintype" id="3236672">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3236678">const</span>&nbsp;<span class="op" id="3236684">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236687">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236745">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="3236766">MergeMode</span>&nbsp;<span class="op" id="3236776">=</span>&nbsp;<span class="num" id="3236778">1</span>&nbsp;<span class="op" id="3236780">&lt;&lt;</span>&nbsp;<span class="ident" id="3236783">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236789">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236850">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236897">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3236925">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3236981">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="3237004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3237007">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3237073">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3237140">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="3237184">//</span><br>
<span class="lineno"></span><span class="keyword" id="3237187">func</span>&nbsp;<span class="ident" id="3237192">nameOf</span><span class="op" id="3237198">(</span><span class="ident" id="3237199">f</span>&nbsp;<span class="op" id="3237201">*</span><span class="ident" id="3237202">FuncDecl</span><span class="op" id="3237210">)</span>&nbsp;<span class="builtintype" id="3237212">string</span>&nbsp;<span class="op" id="3237219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3237222">if</span>&nbsp;<span class="ident" id="3237225">r</span>&nbsp;<span class="op" id="3237227">:=</span>&nbsp;<span class="ident" id="3237230">f</span><span class="op" id="3237231">.</span><span class="ident" id="3237232">Recv</span><span class="op" id="3237236">;</span>&nbsp;<span class="ident" id="3237238">r</span>&nbsp;<span class="op" id="3237240">!=</span>&nbsp;<span class="builtintype" id="3237243">nil</span>&nbsp;<span class="op" id="3237247">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3237250">len</span><span class="op" id="3237253">(</span><span class="ident" id="3237254">r</span><span class="op" id="3237255">.</span><span class="ident" id="3237256">List</span><span class="op" id="3237260">)</span>&nbsp;<span class="op" id="3237262">==</span>&nbsp;<span class="num" id="3237265">1</span>&nbsp;<span class="op" id="3237267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3237271">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3237318">t</span>&nbsp;<span class="op" id="3237320">:=</span>&nbsp;<span class="ident" id="3237323">r</span><span class="op" id="3237324">.</span><span class="ident" id="3237325">List</span><span class="op" id="3237329">[</span><span class="num" id="3237330">0</span><span class="op" id="3237331">]</span><span class="op" id="3237332">.</span><span class="ident" id="3237333">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3237340">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3237380">if</span>&nbsp;<span class="ident" id="3237383">p</span><span class="op" id="3237384">,</span>&nbsp;<span class="ident" id="3237386">_</span>&nbsp;<span class="op" id="3237388">:=</span>&nbsp;<span class="ident" id="3237391">t</span><span class="op" id="3237392">.</span><span class="op" id="3237393">(</span><span class="op" id="3237394">*</span><span class="ident" id="3237395">StarExpr</span><span class="op" id="3237403">)</span><span class="op" id="3237404">;</span>&nbsp;<span class="ident" id="3237406">p</span>&nbsp;<span class="op" id="3237408">!=</span>&nbsp;<span class="builtintype" id="3237411">nil</span>&nbsp;<span class="op" id="3237415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3237420">t</span>&nbsp;<span class="op" id="3237422">=</span>&nbsp;<span class="ident" id="3237424">p</span><span class="op" id="3237425">.</span><span class="ident" id="3237426">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3237430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3237434">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3237477">if</span>&nbsp;<span class="ident" id="3237480">p</span><span class="op" id="3237481">,</span>&nbsp;<span class="ident" id="3237483">_</span>&nbsp;<span class="op" id="3237485">:=</span>&nbsp;<span class="ident" id="3237488">t</span><span class="op" id="3237489">.</span><span class="op" id="3237490">(</span><span class="op" id="3237491">*</span><span class="ident" id="3237492">Ident</span><span class="op" id="3237497">)</span><span class="op" id="3237498">;</span>&nbsp;<span class="ident" id="3237500">p</span>&nbsp;<span class="op" id="3237502">!=</span>&nbsp;<span class="builtintype" id="3237505">nil</span>&nbsp;<span class="op" id="3237509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3237514">return</span>&nbsp;<span class="ident" id="3237521">p</span><span class="op" id="3237522">.</span><span class="ident" id="3237523">Name</span>&nbsp;<span class="op" id="3237528">+</span>&nbsp;<span class="string" id="3237530">&#34;.&#34;</span>&nbsp;<span class="op" id="3237534">+</span>&nbsp;<span class="ident" id="3237536">f</span><span class="op" id="3237537">.</span><span class="ident" id="3237538">Name</span><span class="op" id="3237542">.</span><span class="ident" id="3237543">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3237550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3237554">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3237594">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3237597">return</span>&nbsp;<span class="ident" id="3237604">f</span><span class="op" id="3237605">.</span><span class="ident" id="3237606">Name</span><span class="op" id="3237610">.</span><span class="ident" id="3237611">Name</span><br>
<span class="lineno"></span><span class="op" id="3237616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3237619">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="3237690">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="3237765">//</span><br>
<span class="lineno"></span><span class="keyword" id="3237768">var</span>&nbsp;<span class="ident" id="3237772">separator</span>&nbsp;<span class="op" id="3237782">=</span>&nbsp;<span class="op" id="3237784">&amp;</span><span class="ident" id="3237785">Comment</span><span class="op" id="3237792">{</span><span class="ident" id="3237793">token</span><span class="op" id="3237798">.</span><span class="ident" id="3237799">NoPos</span><span class="op" id="3237804">,</span>&nbsp;<span class="string" id="3237806">&#34;//&#34;</span><span class="op" id="3237810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3237813">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3237880">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="3237954">//</span><br>
<span class="lineno"></span><span class="keyword" id="3237957">func</span>&nbsp;<span class="ident" id="3237962">MergePackageFiles</span><span class="op" id="3237979">(</span><span class="ident" id="3237980">pkg</span>&nbsp;<span class="op" id="3237984">*</span><span class="ident" id="3237985">Package</span><span class="op" id="3237992">,</span>&nbsp;<span class="ident" id="3237994">mode</span>&nbsp;<span class="ident" id="3237999">MergeMode</span><span class="op" id="3238008">)</span>&nbsp;<span class="op" id="3238010">*</span><span class="ident" id="3238011">File</span>&nbsp;<span class="op" id="3238016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238019">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238090">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238161">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238225">ndocs</span>&nbsp;<span class="op" id="3238231">:=</span>&nbsp;<span class="num" id="3238234">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238237">ncomments</span>&nbsp;<span class="op" id="3238247">:=</span>&nbsp;<span class="num" id="3238250">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238253">ndecls</span>&nbsp;<span class="op" id="3238260">:=</span>&nbsp;<span class="num" id="3238263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238266">filenames</span>&nbsp;<span class="op" id="3238276">:=</span>&nbsp;<span class="builtinfunc" id="3238279">make</span><span class="op" id="3238283">(</span><span class="op" id="3238284">[</span><span class="op" id="3238285">]</span><span class="builtintype" id="3238286">string</span><span class="op" id="3238292">,</span>&nbsp;<span class="builtinfunc" id="3238294">len</span><span class="op" id="3238297">(</span><span class="ident" id="3238298">pkg</span><span class="op" id="3238301">.</span><span class="ident" id="3238302">Files</span><span class="op" id="3238307">)</span><span class="op" id="3238308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238311">i</span>&nbsp;<span class="op" id="3238313">:=</span>&nbsp;<span class="num" id="3238316">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238319">for</span>&nbsp;<span class="ident" id="3238323">filename</span><span class="op" id="3238331">,</span>&nbsp;<span class="ident" id="3238333">f</span>&nbsp;<span class="op" id="3238335">:=</span>&nbsp;<span class="keyword" id="3238338">range</span>&nbsp;<span class="ident" id="3238344">pkg</span><span class="op" id="3238347">.</span><span class="ident" id="3238348">Files</span>&nbsp;<span class="op" id="3238354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238358">filenames</span><span class="op" id="3238367">[</span><span class="ident" id="3238368">i</span><span class="op" id="3238369">]</span>&nbsp;<span class="op" id="3238371">=</span>&nbsp;<span class="ident" id="3238373">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238384">i</span><span class="op" id="3238385">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238390">if</span>&nbsp;<span class="ident" id="3238393">f</span><span class="op" id="3238394">.</span><span class="ident" id="3238395">Doc</span>&nbsp;<span class="op" id="3238399">!=</span>&nbsp;<span class="builtintype" id="3238402">nil</span>&nbsp;<span class="op" id="3238406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238411">ndocs</span>&nbsp;<span class="op" id="3238417">+=</span>&nbsp;<span class="builtinfunc" id="3238420">len</span><span class="op" id="3238423">(</span><span class="ident" id="3238424">f</span><span class="op" id="3238425">.</span><span class="ident" id="3238426">Doc</span><span class="op" id="3238429">.</span><span class="ident" id="3238430">List</span><span class="op" id="3238434">)</span>&nbsp;<span class="op" id="3238436">+</span>&nbsp;<span class="num" id="3238438">1</span>&nbsp;<span class="comment" id="3238440">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3238462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238466">ncomments</span>&nbsp;<span class="op" id="3238476">+=</span>&nbsp;<span class="builtinfunc" id="3238479">len</span><span class="op" id="3238482">(</span><span class="ident" id="3238483">f</span><span class="op" id="3238484">.</span><span class="ident" id="3238485">Comments</span><span class="op" id="3238493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238497">ndecls</span>&nbsp;<span class="op" id="3238504">+=</span>&nbsp;<span class="builtinfunc" id="3238507">len</span><span class="op" id="3238510">(</span><span class="ident" id="3238511">f</span><span class="op" id="3238512">.</span><span class="ident" id="3238513">Decls</span><span class="op" id="3238518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3238521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238524">sort</span><span class="op" id="3238528">.</span><span class="ident" id="3238529">Strings</span><span class="op" id="3238536">(</span><span class="ident" id="3238537">filenames</span><span class="op" id="3238546">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238550">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238616">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238683">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3238750">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238816">var</span>&nbsp;<span class="ident" id="3238820">doc</span>&nbsp;<span class="op" id="3238824">*</span><span class="ident" id="3238825">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238839">var</span>&nbsp;<span class="ident" id="3238843">pos</span>&nbsp;<span class="ident" id="3238847">token</span><span class="op" id="3238852">.</span><span class="ident" id="3238853">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238858">if</span>&nbsp;<span class="ident" id="3238861">ndocs</span>&nbsp;<span class="op" id="3238867">&gt;</span>&nbsp;<span class="num" id="3238869">0</span>&nbsp;<span class="op" id="3238871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238875">list</span>&nbsp;<span class="op" id="3238880">:=</span>&nbsp;<span class="builtinfunc" id="3238883">make</span><span class="op" id="3238887">(</span><span class="op" id="3238888">[</span><span class="op" id="3238889">]</span><span class="op" id="3238890">*</span><span class="ident" id="3238891">Comment</span><span class="op" id="3238898">,</span>&nbsp;<span class="ident" id="3238900">ndocs</span><span class="op" id="3238905">-</span><span class="num" id="3238906">1</span><span class="op" id="3238907">)</span>&nbsp;<span class="comment" id="3238909">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238950">i</span>&nbsp;<span class="op" id="3238952">:=</span>&nbsp;<span class="num" id="3238955">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3238959">for</span>&nbsp;<span class="ident" id="3238963">_</span><span class="op" id="3238964">,</span>&nbsp;<span class="ident" id="3238966">filename</span>&nbsp;<span class="op" id="3238975">:=</span>&nbsp;<span class="keyword" id="3238978">range</span>&nbsp;<span class="ident" id="3238984">filenames</span>&nbsp;<span class="op" id="3238994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3238999">f</span>&nbsp;<span class="op" id="3239001">:=</span>&nbsp;<span class="ident" id="3239004">pkg</span><span class="op" id="3239007">.</span><span class="ident" id="3239008">Files</span><span class="op" id="3239013">[</span><span class="ident" id="3239014">filename</span><span class="op" id="3239022">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239027">if</span>&nbsp;<span class="ident" id="3239030">f</span><span class="op" id="3239031">.</span><span class="ident" id="3239032">Doc</span>&nbsp;<span class="op" id="3239036">!=</span>&nbsp;<span class="builtintype" id="3239039">nil</span>&nbsp;<span class="op" id="3239043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239049">if</span>&nbsp;<span class="ident" id="3239052">i</span>&nbsp;<span class="op" id="3239054">&gt;</span>&nbsp;<span class="num" id="3239056">0</span>&nbsp;<span class="op" id="3239058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239065">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239109">list</span><span class="op" id="3239113">[</span><span class="ident" id="3239114">i</span><span class="op" id="3239115">]</span>&nbsp;<span class="op" id="3239117">=</span>&nbsp;<span class="ident" id="3239119">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239134">i</span><span class="op" id="3239135">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239148">for</span>&nbsp;<span class="ident" id="3239152">_</span><span class="op" id="3239153">,</span>&nbsp;<span class="ident" id="3239155">c</span>&nbsp;<span class="op" id="3239157">:=</span>&nbsp;<span class="keyword" id="3239160">range</span>&nbsp;<span class="ident" id="3239166">f</span><span class="op" id="3239167">.</span><span class="ident" id="3239168">Doc</span><span class="op" id="3239171">.</span><span class="ident" id="3239172">List</span>&nbsp;<span class="op" id="3239177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239184">list</span><span class="op" id="3239188">[</span><span class="ident" id="3239189">i</span><span class="op" id="3239190">]</span>&nbsp;<span class="op" id="3239192">=</span>&nbsp;<span class="ident" id="3239194">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239201">i</span><span class="op" id="3239202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239215">if</span>&nbsp;<span class="ident" id="3239218">f</span><span class="op" id="3239219">.</span><span class="ident" id="3239220">Package</span>&nbsp;<span class="op" id="3239228">&gt;</span>&nbsp;<span class="ident" id="3239230">pos</span>&nbsp;<span class="op" id="3239234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239241">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239293">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239347">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239362">pos</span>&nbsp;<span class="op" id="3239366">=</span>&nbsp;<span class="ident" id="3239368">f</span><span class="op" id="3239369">.</span><span class="ident" id="3239370">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239391">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239395">doc</span>&nbsp;<span class="op" id="3239399">=</span>&nbsp;<span class="op" id="3239401">&amp;</span><span class="ident" id="3239402">CommentGroup</span><span class="op" id="3239414">{</span><span class="ident" id="3239415">list</span><span class="op" id="3239419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3239422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239426">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239475">var</span>&nbsp;<span class="ident" id="3239479">decls</span>&nbsp;<span class="op" id="3239485">[</span><span class="op" id="3239486">]</span><span class="ident" id="3239487">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239493">if</span>&nbsp;<span class="ident" id="3239496">ndecls</span>&nbsp;<span class="op" id="3239503">&gt;</span>&nbsp;<span class="num" id="3239505">0</span>&nbsp;<span class="op" id="3239507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239511">decls</span>&nbsp;<span class="op" id="3239517">=</span>&nbsp;<span class="builtinfunc" id="3239519">make</span><span class="op" id="3239523">(</span><span class="op" id="3239524">[</span><span class="op" id="3239525">]</span><span class="ident" id="3239526">Decl</span><span class="op" id="3239530">,</span>&nbsp;<span class="ident" id="3239532">ndecls</span><span class="op" id="3239538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239542">funcs</span>&nbsp;<span class="op" id="3239548">:=</span>&nbsp;<span class="builtinfunc" id="3239551">make</span><span class="op" id="3239555">(</span><span class="keyword" id="3239556">map</span><span class="op" id="3239559">[</span><span class="builtintype" id="3239560">string</span><span class="op" id="3239566">]</span><span class="builtintype" id="3239567">int</span><span class="op" id="3239570">)</span>&nbsp;<span class="comment" id="3239572">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239609">i</span>&nbsp;<span class="op" id="3239611">:=</span>&nbsp;<span class="num" id="3239614">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239639">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239658">n</span>&nbsp;<span class="op" id="3239660">:=</span>&nbsp;<span class="num" id="3239663">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239688">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239720">for</span>&nbsp;<span class="ident" id="3239724">_</span><span class="op" id="3239725">,</span>&nbsp;<span class="ident" id="3239727">filename</span>&nbsp;<span class="op" id="3239736">:=</span>&nbsp;<span class="keyword" id="3239739">range</span>&nbsp;<span class="ident" id="3239745">filenames</span>&nbsp;<span class="op" id="3239755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3239760">f</span>&nbsp;<span class="op" id="3239762">:=</span>&nbsp;<span class="ident" id="3239765">pkg</span><span class="op" id="3239768">.</span><span class="ident" id="3239769">Files</span><span class="op" id="3239774">[</span><span class="ident" id="3239775">filename</span><span class="op" id="3239783">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239788">for</span>&nbsp;<span class="ident" id="3239792">_</span><span class="op" id="3239793">,</span>&nbsp;<span class="ident" id="3239795">d</span>&nbsp;<span class="op" id="3239797">:=</span>&nbsp;<span class="keyword" id="3239800">range</span>&nbsp;<span class="ident" id="3239806">f</span><span class="op" id="3239807">.</span><span class="ident" id="3239808">Decls</span>&nbsp;<span class="op" id="3239814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3239820">if</span>&nbsp;<span class="ident" id="3239823">mode</span><span class="op" id="3239827">&amp;</span><span class="ident" id="3239828">FilterFuncDuplicates</span>&nbsp;<span class="op" id="3239849">!=</span>&nbsp;<span class="num" id="3239852">0</span>&nbsp;<span class="op" id="3239854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239861">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239912">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3239962">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240010">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240060">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240113">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240121">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240171">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240222">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3240275">if</span>&nbsp;<span class="ident" id="3240278">f</span><span class="op" id="3240279">,</span>&nbsp;<span class="ident" id="3240281">isFun</span>&nbsp;<span class="op" id="3240287">:=</span>&nbsp;<span class="ident" id="3240290">d</span><span class="op" id="3240291">.</span><span class="op" id="3240292">(</span><span class="op" id="3240293">*</span><span class="ident" id="3240294">FuncDecl</span><span class="op" id="3240302">)</span><span class="op" id="3240303">;</span>&nbsp;<span class="ident" id="3240305">isFun</span>&nbsp;<span class="op" id="3240311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240319">name</span>&nbsp;<span class="op" id="3240324">:=</span>&nbsp;<span class="ident" id="3240327">nameOf</span><span class="op" id="3240333">(</span><span class="ident" id="3240334">f</span><span class="op" id="3240335">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3240343">if</span>&nbsp;<span class="ident" id="3240346">j</span><span class="op" id="3240347">,</span>&nbsp;<span class="ident" id="3240349">exists</span>&nbsp;<span class="op" id="3240356">:=</span>&nbsp;<span class="ident" id="3240359">funcs</span><span class="op" id="3240364">[</span><span class="ident" id="3240365">name</span><span class="op" id="3240369">]</span><span class="op" id="3240370">;</span>&nbsp;<span class="ident" id="3240372">exists</span>&nbsp;<span class="op" id="3240379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240388">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3240424">if</span>&nbsp;<span class="ident" id="3240427">decls</span><span class="op" id="3240432">[</span><span class="ident" id="3240433">j</span><span class="op" id="3240434">]</span>&nbsp;<span class="op" id="3240436">!=</span>&nbsp;<span class="builtintype" id="3240439">nil</span>&nbsp;<span class="op" id="3240443">&amp;&amp;</span>&nbsp;<span class="ident" id="3240446">decls</span><span class="op" id="3240451">[</span><span class="ident" id="3240452">j</span><span class="op" id="3240453">]</span><span class="op" id="3240454">.</span><span class="op" id="3240455">(</span><span class="op" id="3240456">*</span><span class="ident" id="3240457">FuncDecl</span><span class="op" id="3240465">)</span><span class="op" id="3240466">.</span><span class="ident" id="3240467">Doc</span>&nbsp;<span class="op" id="3240471">==</span>&nbsp;<span class="builtintype" id="3240474">nil</span>&nbsp;<span class="op" id="3240478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240488">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240542">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240585">decls</span><span class="op" id="3240590">[</span><span class="ident" id="3240591">j</span><span class="op" id="3240592">]</span>&nbsp;<span class="op" id="3240594">=</span>&nbsp;<span class="builtintype" id="3240596">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240607">}</span>&nbsp;<span class="keyword" id="3240609">else</span>&nbsp;<span class="op" id="3240614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240624">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240662">d</span>&nbsp;<span class="op" id="3240664">=</span>&nbsp;<span class="builtintype" id="3240666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240677">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240686">n</span><span class="op" id="3240687">++</span>&nbsp;<span class="comment" id="3240690">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240717">}</span>&nbsp;<span class="keyword" id="3240719">else</span>&nbsp;<span class="op" id="3240724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240733">funcs</span><span class="op" id="3240738">[</span><span class="ident" id="3240739">name</span><span class="op" id="3240743">]</span>&nbsp;<span class="op" id="3240745">=</span>&nbsp;<span class="ident" id="3240747">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240762">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240774">decls</span><span class="op" id="3240779">[</span><span class="ident" id="3240780">i</span><span class="op" id="3240781">]</span>&nbsp;<span class="op" id="3240783">=</span>&nbsp;<span class="ident" id="3240785">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3240791">i</span><span class="op" id="3240792">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3240802">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240807">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240870">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3240937">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241004">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241069">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241102">if</span>&nbsp;<span class="ident" id="3241105">n</span>&nbsp;<span class="op" id="3241107">&gt;</span>&nbsp;<span class="num" id="3241109">0</span>&nbsp;<span class="op" id="3241111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241116">i</span>&nbsp;<span class="op" id="3241118">=</span>&nbsp;<span class="num" id="3241120">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241125">for</span>&nbsp;<span class="ident" id="3241129">_</span><span class="op" id="3241130">,</span>&nbsp;<span class="ident" id="3241132">d</span>&nbsp;<span class="op" id="3241134">:=</span>&nbsp;<span class="keyword" id="3241137">range</span>&nbsp;<span class="ident" id="3241143">decls</span>&nbsp;<span class="op" id="3241149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241155">if</span>&nbsp;<span class="ident" id="3241158">d</span>&nbsp;<span class="op" id="3241160">!=</span>&nbsp;<span class="builtintype" id="3241163">nil</span>&nbsp;<span class="op" id="3241167">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241174">decls</span><span class="op" id="3241179">[</span><span class="ident" id="3241180">i</span><span class="op" id="3241181">]</span>&nbsp;<span class="op" id="3241183">=</span>&nbsp;<span class="ident" id="3241185">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241192">i</span><span class="op" id="3241193">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241210">decls</span>&nbsp;<span class="op" id="3241216">=</span>&nbsp;<span class="ident" id="3241218">decls</span><span class="op" id="3241223">[</span><span class="num" id="3241224">0</span><span class="op" id="3241225">:</span><span class="ident" id="3241226">i</span><span class="op" id="3241227">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241238">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241287">var</span>&nbsp;<span class="ident" id="3241291">imports</span>&nbsp;<span class="op" id="3241299">[</span><span class="op" id="3241300">]</span><span class="op" id="3241301">*</span><span class="ident" id="3241302">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241314">if</span>&nbsp;<span class="ident" id="3241317">mode</span><span class="op" id="3241321">&amp;</span><span class="ident" id="3241322">FilterImportDuplicates</span>&nbsp;<span class="op" id="3241345">!=</span>&nbsp;<span class="num" id="3241348">0</span>&nbsp;<span class="op" id="3241350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241354">seen</span>&nbsp;<span class="op" id="3241359">:=</span>&nbsp;<span class="builtinfunc" id="3241362">make</span><span class="op" id="3241366">(</span><span class="keyword" id="3241367">map</span><span class="op" id="3241370">[</span><span class="builtintype" id="3241371">string</span><span class="op" id="3241377">]</span><span class="builtintype" id="3241378">bool</span><span class="op" id="3241382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241386">for</span>&nbsp;<span class="ident" id="3241390">_</span><span class="op" id="3241391">,</span>&nbsp;<span class="ident" id="3241393">filename</span>&nbsp;<span class="op" id="3241402">:=</span>&nbsp;<span class="keyword" id="3241405">range</span>&nbsp;<span class="ident" id="3241411">filenames</span>&nbsp;<span class="op" id="3241421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241426">f</span>&nbsp;<span class="op" id="3241428">:=</span>&nbsp;<span class="ident" id="3241431">pkg</span><span class="op" id="3241434">.</span><span class="ident" id="3241435">Files</span><span class="op" id="3241440">[</span><span class="ident" id="3241441">filename</span><span class="op" id="3241449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241454">for</span>&nbsp;<span class="ident" id="3241458">_</span><span class="op" id="3241459">,</span>&nbsp;<span class="ident" id="3241461">imp</span>&nbsp;<span class="op" id="3241465">:=</span>&nbsp;<span class="keyword" id="3241468">range</span>&nbsp;<span class="ident" id="3241474">f</span><span class="op" id="3241475">.</span><span class="ident" id="3241476">Imports</span>&nbsp;<span class="op" id="3241484">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241490">if</span>&nbsp;<span class="ident" id="3241493">path</span>&nbsp;<span class="op" id="3241498">:=</span>&nbsp;<span class="ident" id="3241501">imp</span><span class="op" id="3241504">.</span><span class="ident" id="3241505">Path</span><span class="op" id="3241509">.</span><span class="ident" id="3241510">Value</span><span class="op" id="3241515">;</span>&nbsp;<span class="op" id="3241517">!</span><span class="ident" id="3241518">seen</span><span class="op" id="3241522">[</span><span class="ident" id="3241523">path</span><span class="op" id="3241527">]</span>&nbsp;<span class="op" id="3241529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241536">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241581">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241637">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241695">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241724">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241777">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3241832">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241862">imports</span>&nbsp;<span class="op" id="3241870">=</span>&nbsp;<span class="builtinfunc" id="3241872">append</span><span class="op" id="3241878">(</span><span class="ident" id="3241879">imports</span><span class="op" id="3241886">,</span>&nbsp;<span class="ident" id="3241888">imp</span><span class="op" id="3241891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241898">seen</span><span class="op" id="3241902">[</span><span class="ident" id="3241903">path</span><span class="op" id="3241907">]</span>&nbsp;<span class="op" id="3241909">=</span>&nbsp;<span class="builtintype" id="3241911">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3241932">}</span>&nbsp;<span class="keyword" id="3241934">else</span>&nbsp;<span class="op" id="3241939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3241943">for</span>&nbsp;<span class="ident" id="3241947">_</span><span class="op" id="3241948">,</span>&nbsp;<span class="ident" id="3241950">f</span>&nbsp;<span class="op" id="3241952">:=</span>&nbsp;<span class="keyword" id="3241955">range</span>&nbsp;<span class="ident" id="3241961">pkg</span><span class="op" id="3241964">.</span><span class="ident" id="3241965">Files</span>&nbsp;<span class="op" id="3241971">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3241976">imports</span>&nbsp;<span class="op" id="3241984">=</span>&nbsp;<span class="builtinfunc" id="3241986">append</span><span class="op" id="3241992">(</span><span class="ident" id="3241993">imports</span><span class="op" id="3242000">,</span>&nbsp;<span class="ident" id="3242002">f</span><span class="op" id="3242003">.</span><span class="ident" id="3242004">Imports</span><span class="op" id="3242011">...</span><span class="op" id="3242014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3242018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3242021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3242025">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3242070">var</span>&nbsp;<span class="ident" id="3242074">comments</span>&nbsp;<span class="op" id="3242083">[</span><span class="op" id="3242084">]</span><span class="op" id="3242085">*</span><span class="ident" id="3242086">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3242100">if</span>&nbsp;<span class="ident" id="3242103">mode</span><span class="op" id="3242107">&amp;</span><span class="ident" id="3242108">FilterUnassociatedComments</span>&nbsp;<span class="op" id="3242135">==</span>&nbsp;<span class="num" id="3242138">0</span>&nbsp;<span class="op" id="3242140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3242144">comments</span>&nbsp;<span class="op" id="3242153">=</span>&nbsp;<span class="builtinfunc" id="3242155">make</span><span class="op" id="3242159">(</span><span class="op" id="3242160">[</span><span class="op" id="3242161">]</span><span class="op" id="3242162">*</span><span class="ident" id="3242163">CommentGroup</span><span class="op" id="3242175">,</span>&nbsp;<span class="ident" id="3242177">ncomments</span><span class="op" id="3242186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3242190">i</span>&nbsp;<span class="op" id="3242192">:=</span>&nbsp;<span class="num" id="3242195">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3242199">for</span>&nbsp;<span class="ident" id="3242203">_</span><span class="op" id="3242204">,</span>&nbsp;<span class="ident" id="3242206">f</span>&nbsp;<span class="op" id="3242208">:=</span>&nbsp;<span class="keyword" id="3242211">range</span>&nbsp;<span class="ident" id="3242217">pkg</span><span class="op" id="3242220">.</span><span class="ident" id="3242221">Files</span>&nbsp;<span class="op" id="3242227">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3242232">i</span>&nbsp;<span class="op" id="3242234">+=</span>&nbsp;<span class="builtinfunc" id="3242237">copy</span><span class="op" id="3242241">(</span><span class="ident" id="3242242">comments</span><span class="op" id="3242250">[</span><span class="ident" id="3242251">i</span><span class="op" id="3242252">:</span><span class="op" id="3242253">]</span><span class="op" id="3242254">,</span>&nbsp;<span class="ident" id="3242256">f</span><span class="op" id="3242257">.</span><span class="ident" id="3242258">Comments</span><span class="op" id="3242266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3242270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3242273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3242277">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3242331">return</span>&nbsp;<span class="op" id="3242338">&amp;</span><span class="ident" id="3242339">File</span><span class="op" id="3242343">{</span><span class="ident" id="3242344">doc</span><span class="op" id="3242347">,</span>&nbsp;<span class="ident" id="3242349">pos</span><span class="op" id="3242352">,</span>&nbsp;<span class="ident" id="3242354">NewIdent</span><span class="op" id="3242362">(</span><span class="ident" id="3242363">pkg</span><span class="op" id="3242366">.</span><span class="ident" id="3242367">Name</span><span class="op" id="3242371">)</span><span class="op" id="3242372">,</span>&nbsp;<span class="ident" id="3242374">decls</span><span class="op" id="3242379">,</span>&nbsp;<span class="ident" id="3242381">pkg</span><span class="op" id="3242384">.</span><span class="ident" id="3242385">Scope</span><span class="op" id="3242390">,</span>&nbsp;<span class="ident" id="3242392">imports</span><span class="op" id="3242399">,</span>&nbsp;<span class="builtintype" id="3242401">nil</span><span class="op" id="3242404">,</span>&nbsp;<span class="ident" id="3242406">comments</span><span class="op" id="3242414">}</span><br>
<span class="lineno"></span><span class="op" id="3242416">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
